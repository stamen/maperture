function t(t,e){return e.forEach((function(e){e&&"string"!=typeof e&&!Array.isArray(e)&&Object.keys(e).forEach((function(i){if("default"!==i&&!(i in t)){var r=Object.getOwnPropertyDescriptor(e,i);Object.defineProperty(t,i,r.get?r:{enumerable:!0,get:function(){return e[i]}})}}))})),Object.freeze(t)}function e(){}function i(t,e){for(const i in e)t[i]=e[i];return t}function r(t){return t()}function n(){return Object.create(null)}function o(t){t.forEach(r)}function s(t){return"function"==typeof t}function a(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function l(t,i,r){t.$$.on_destroy.push(function(t,...i){if(null==t)return e;const r=t.subscribe(...i);return r.unsubscribe?()=>r.unsubscribe():r}(i,r))}function c(t,e,i,r){if(t){const n=u(t,e,i,r);return t[0](n)}}function u(t,e,r,n){return t[1]&&n?i(r.ctx.slice(),t[1](n(e))):r.ctx}function h(t,e,i,r){if(t[2]&&r){const n=t[2](r(i));if(void 0===e.dirty)return n;if("object"==typeof n){const t=[],i=Math.max(e.dirty.length,n.length);for(let r=0;r<i;r+=1)t[r]=e.dirty[r]|n[r];return t}return e.dirty|n}return e.dirty}function d(t,e,i,r,n,o){if(n){const s=u(e,i,r,o);t.p(s,n)}}function p(t){if(t.ctx.length>32){const e=[],i=t.ctx.length/32;for(let t=0;t<i;t++)e[t]=-1;return e}return-1}function f(t){const e={};for(const i in t)"$"!==i[0]&&(e[i]=t[i]);return e}function A(t,e){const i={};e=new Set(e);for(const r in t)e.has(r)||"$"===r[0]||(i[r]=t[r]);return i}function m(t){return null==t?"":t}function g(t){return t&&s(t.destroy)?t.destroy:e}function _(t,e){t.appendChild(e)}function y(t,e,i){t.insertBefore(e,i||null)}function v(t){t.parentNode&&t.parentNode.removeChild(t)}function x(t,e){for(let i=0;i<t.length;i+=1)t[i]&&t[i].d(e)}function b(t){return document.createElement(t)}function w(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function T(t){return document.createTextNode(t)}function B(){return T(" ")}function E(){return T("")}function C(t,e,i,r){return t.addEventListener(e,i,r),()=>t.removeEventListener(e,i,r)}function S(t,e,i){null==i?t.removeAttribute(e):t.getAttribute(e)!==i&&t.setAttribute(e,i)}function I(t){return""===t?null:+t}function M(t,e){e=""+e,t.data!==e&&(t.data=e)}function k(t,e){t.value=null==e?"":e}function P(t,e,i,r){null==i?t.style.removeProperty(e):t.style.setProperty(e,i,r?"important":"")}let z,F;function D(){if(void 0===z){z=!1;try{"undefined"!=typeof window&&window.parent&&window.parent.document}catch(t){z=!0}}return z}function R(t,e,i){t.classList[i?"add":"remove"](e)}function U(t,e){return new t(e)}function O(t){F=t}function N(){if(!F)throw new Error("Function called outside component initialization");return F}function Q(t){N().$$.on_mount.push(t)}function V(t){N().$$.on_destroy.push(t)}function j(){const t=N();return(e,i,{cancelable:r=!1}={})=>{const n=t.$$.callbacks[e];if(n){const o=function(t,e,{bubbles:i=!1,cancelable:r=!1}={}){const n=document.createEvent("CustomEvent");return n.initCustomEvent(t,i,r,e),n}(e,i,{cancelable:r});return n.slice().forEach((e=>{e.call(t,o)})),!o.defaultPrevented}return!0}}function H(t,e){const i=t.$$.callbacks[e.type];i&&i.slice().forEach((t=>t.call(this,e)))}const G=[],$=[];let Z=[];const q=[],K=Promise.resolve();let W=!1;function X(){W||(W=!0,K.then(et))}function J(t){Z.push(t)}const Y=new Set;let tt=0;function et(){if(0!==tt)return;const t=F;do{try{for(;tt<G.length;){const t=G[tt];tt++,O(t),it(t.$$)}}catch(t){throw G.length=0,tt=0,t}for(O(null),G.length=0,tt=0;$.length;)$.pop()();for(let t=0;t<Z.length;t+=1){const e=Z[t];Y.has(e)||(Y.add(e),e())}Z.length=0}while(G.length);for(;q.length;)q.pop()();W=!1,Y.clear(),O(t)}function it(t){if(null!==t.fragment){t.update(),o(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(J)}}const rt=new Set;let nt;function ot(){nt={r:0,c:[],p:nt}}function st(){nt.r||o(nt.c),nt=nt.p}function at(t,e){t&&t.i&&(rt.delete(t),t.i(e))}function lt(t,e,i,r){if(t&&t.o){if(rt.has(t))return;rt.add(t),nt.c.push((()=>{rt.delete(t),r&&(i&&t.d(1),r())})),t.o(e)}else r&&r()}function ct(t,e){const i={},r={},n={$$scope:1};let o=t.length;for(;o--;){const s=t[o],a=e[o];if(a){for(const t in s)t in a||(r[t]=1);for(const t in a)n[t]||(i[t]=a[t],n[t]=1);t[o]=a}else for(const t in s)n[t]=1}for(const t in r)t in i||(i[t]=void 0);return i}function ut(t){return"object"==typeof t&&null!==t?t:{}}function ht(t){t&&t.c()}function dt(t,e,i,n){const{fragment:a,after_update:l}=t.$$;a&&a.m(e,i),n||J((()=>{const e=t.$$.on_mount.map(r).filter(s);t.$$.on_destroy?t.$$.on_destroy.push(...e):o(e),t.$$.on_mount=[]})),l.forEach(J)}function pt(t,e){const i=t.$$;null!==i.fragment&&(!function(t){const e=[],i=[];Z.forEach((r=>-1===t.indexOf(r)?e.push(r):i.push(r))),i.forEach((t=>t())),Z=e}(i.after_update),o(i.on_destroy),i.fragment&&i.fragment.d(e),i.on_destroy=i.fragment=null,i.ctx=[])}function ft(t,i,r,s,a,l,c,u=[-1]){const h=F;O(t);const d=t.$$={fragment:null,ctx:[],props:l,update:e,not_equal:a,bound:n(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(i.context||(h?h.$$.context:[])),callbacks:n(),dirty:u,skip_bound:!1,root:i.target||h.$$.root};c&&c(d.root);let p=!1;if(d.ctx=r?r(t,i.props||{},((e,i,...r)=>{const n=r.length?r[0]:i;return d.ctx&&a(d.ctx[e],d.ctx[e]=n)&&(!d.skip_bound&&d.bound[e]&&d.bound[e](n),p&&function(t,e){-1===t.$$.dirty[0]&&(G.push(t),X(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}(t,e)),i})):[],d.update(),p=!0,o(d.before_update),d.fragment=!!s&&s(d.ctx),i.target){if(i.hydrate){const t=function(t){return Array.from(t.childNodes)}(i.target);d.fragment&&d.fragment.l(t),t.forEach(v)}else d.fragment&&d.fragment.c();i.intro&&at(t.$$.fragment),dt(t,i.target,i.anchor,i.customElement),et()}O(h)}class At{$destroy(){pt(this,1),this.$destroy=e}$on(t,i){if(!s(i))return e;const r=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return r.push(i),()=>{const t=r.indexOf(i);-1!==t&&r.splice(t,1)}}$set(t){var e;this.$$set&&(e=t,0!==Object.keys(e).length)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}var mt="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function gt(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function _t(t){if(t.__esModule)return t;var e=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(t).forEach((function(i){var r=Object.getOwnPropertyDescriptor(t,i);Object.defineProperty(e,i,r.get?r:{enumerable:!0,get:function(){return t[i]}})})),e}var yt={exports:{}};yt.exports=function(){var t,e,i;function r(r,n){if(t)if(e){var o="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+t+")(sharedChunk); ("+e+")(sharedChunk); self.onerror = null;",s={};t(s),i=n(s),"undefined"!=typeof window&&window&&window.URL&&window.URL.createObjectURL&&(i.workerUrl=window.URL.createObjectURL(new Blob([o],{type:"text/javascript"})))}else e=n;else t=n}r(["exports"],(function(t){var e="undefined"!=typeof self?self:{},i="2.15.0";let r;const n={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==r){const t=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{r=null!=process.env.API_URL_REGEX?new RegExp(process.env.API_URL_REGEX):t}catch(e){r=t}}return r},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!n.API_URL)return null;try{const t=new URL(n.API_URL);return"api.mapbox.cn"===t.hostname?"https://events.mapbox.cn/events/v2":"api.mapbox.com"===t.hostname?"https://events.mapbox.com/events/v2":null}catch(t){return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},o={supported:!1,testSupport:function(t){!l&&a&&(c?u(t):s=t)}};let s,a,l=!1,c=!1;function u(t){const e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,a),t.isContextLost())return;o.supported=!0}catch(t){}t.deleteTexture(e),l=!0}e.document&&(a=e.document.createElement("img"),a.onload=function(){s&&u(s),s=null,c=!0},a.onerror=function(){l=!0,s=null},a.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const h="01";function d(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var p=f;function f(t,e,i,r){this.cx=3*t,this.bx=3*(i-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(r-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=e,this.p2x=i,this.p2y=r}f.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,e){if(void 0===e&&(e=1e-6),t<0)return 0;if(t>1)return 1;for(var i=t,r=0;r<8;r++){var n=this.sampleCurveX(i)-t;if(Math.abs(n)<e)return i;var o=this.sampleCurveDerivativeX(i);if(Math.abs(o)<1e-6)break;i-=n/o}var s=0,a=1;for(i=t,r=0;r<20&&(n=this.sampleCurveX(i),!(Math.abs(n-t)<e));r++)t>n?s=i:a=i,i=.5*(a-s)+s;return i},solve:function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))}};var A=d(p),m=g;function g(t,e){this.x=t,this.y=e}g.prototype={clone:function(){return new g(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,i=t.y-this.y;return e*e+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=e,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),i=Math.sin(t),r=i*this.x+e*this.y;return this.x=e*this.x-i*this.y,this.y=r,this},_rotateAround:function(t,e){var i=Math.cos(t),r=Math.sin(t),n=e.y+r*(this.x-e.x)+i*(this.y-e.y);return this.x=e.x+i*(this.x-e.x)-r*(this.y-e.y),this.y=n,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},g.convert=function(t){return t instanceof g?t:Array.isArray(t)?new g(t[0],t[1]):t};var _=d(m);const y=Math.PI/180,v=180/Math.PI;function x(t){return t*y}function b(t){return t*v}const w=[[0,0],[1,0],[1,1],[0,1]];function T(t){if(t<=0)return 0;if(t>=1)return 1;const e=t*t,i=e*t;return 4*(t<.5?i:3*(t-e)+i-.75)}function B(t,e,i,r){const n=new A(t,e,i,r);return function(t){return n.solve(t)}}const E=B(.25,.1,.25,1);function C(t,e,i){return Math.min(i,Math.max(e,t))}function S(t,e,i){return(i=C((i-t)/(e-t),0,1))*i*(3-2*i)}function I(t,e,i){const r=i-e,n=((t-e)%r+r)%r+e;return n===e?i:n}function M(t,e,i){if(!t.length)return i(null,[]);let r=t.length;const n=new Array(t.length);let o=null;t.forEach(((t,s)=>{e(t,((t,e)=>{t&&(o=t),n[s]=e,0==--r&&i(o,n)}))}))}function k(t){const e=[];for(const i in t)e.push(t[i]);return e}function P(t,...e){for(const i of e)for(const e in i)t[e]=i[e];return t}let L=1;function z(){return L++}function F(){return function t(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function D(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function R(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function U(t,e){t.forEach((t=>{e[t]&&(e[t]=e[t].bind(e))}))}function O(t,e){return-1!==t.indexOf(e,t.length-e.length)}function N(t,e,i){const r={};for(const n in t)r[n]=e.call(i||this,t[n],n,t);return r}function Q(t,e,i){const r={};for(const n in t)e.call(i||this,t[n],n,t)&&(r[n]=t[n]);return r}function V(t){return Array.isArray(t)?t.map(V):"object"==typeof t&&t?N(t,V):t}const j={};function H(t){j[t]||("undefined"!=typeof console&&console.warn(t),j[t]=!0)}function G(t,e,i){return(i.y-t.y)*(e.x-t.x)>(e.y-t.y)*(i.x-t.x)}function $(t){let e=0;for(let i,r,n=0,o=t.length,s=o-1;n<o;s=n++)i=t[n],r=t[s],e+=(r.x-i.x)*(i.y+r.y);return e}function Z(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function q(t){const e={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((t,i,r,n)=>{const o=r||n;return e[i]=!o||o.toLowerCase(),""})),e["max-age"]){const t=parseInt(e["max-age"],10);isNaN(t)?delete e["max-age"]:e["max-age"]=t}return e}let K=null;function W(t){if(null==K){const e=t.navigator?t.navigator.userAgent:null;K=!!t.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return K}function X(t){try{const i=e[t];return i.setItem("_mapbox_test_",1),i.removeItem("_mapbox_test_"),!0}catch(t){return!1}}function J(t,e){return[t[4*e],t[4*e+1],t[4*e+2],t[4*e+3]]}const Y="mapbox-tiles";let tt,et,it=500,rt=50;function nt(){try{return e.caches}catch(t){}}function ot(){nt()&&!tt&&(tt=e.caches.open(Y))}function st(t){const e=t.indexOf("?");if(e<0)return t;const i=function(t){const e=t.indexOf("?");return e>0?t.slice(e+1).split("&"):[]}(t),r=i.filter((t=>{const e=t.split("=");return"language"===e[0]||"worldview"===e[0]}));return r.length?`${t.slice(0,e)}?${r.join("&")}`:t.slice(0,e)}let at=1/0;const lt={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(lt);class ct extends Error{constructor(t,e,i){401===e&&vt(i)&&(t+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(t),this.status=e,this.url=i}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const ut=Z()?()=>self.worker&&self.worker.referrer:()=>("blob:"===e.location.protocol?e.parent:e).location.href,ht=function(t,i){if(!(/^file:/.test(r=t.url)||/^file:/.test(ut())&&!/^\w+:/.test(r))){if(e.fetch&&e.Request&&e.AbortController&&e.Request.prototype.hasOwnProperty("signal"))return function(t,i){const r=new e.AbortController,n=new e.Request(t.url,{method:t.method||"GET",body:t.body,credentials:t.credentials,headers:t.headers,referrer:ut(),referrerPolicy:t.referrerPolicy,signal:r.signal});let o=!1,s=!1;const a=(l=n.url).indexOf("sku=")>0&&vt(l);var l;"json"===t.type&&n.headers.set("Accept","application/json");const c=(r,o,l)=>{if(s)return;if(r&&"SecurityError"!==r.message&&H(r.toString()),o&&l)return u(o);const c=Date.now();e.fetch(n).then((e=>{if(e.ok){const t=a?e.clone():null;return u(e,t,c)}return i(new ct(e.statusText,e.status,t.url))})).catch((e=>{"AbortError"!==e.name&&i(new Error(`${e.message} ${t.url}`))}))},u=(r,a,l)=>{("arrayBuffer"===t.type?r.arrayBuffer():"json"===t.type?r.json():r.text()).then((t=>{s||(a&&l&&function(t,i,r){if(ot(),!tt)return;const n={status:i.status,statusText:i.statusText,headers:new e.Headers};i.headers.forEach(((t,e)=>n.headers.set(e,t)));const o=q(i.headers.get("Cache-Control")||"");if(o["no-store"])return;o["max-age"]&&n.headers.set("Expires",new Date(r+1e3*o["max-age"]).toUTCString());const s=n.headers.get("Expires");s&&(new Date(s).getTime()-r<42e4||function(t,e){if(void 0===et)try{new Response(new ReadableStream),et=!0}catch(t){et=!1}et?e(t.body):t.blob().then(e)}(i,(i=>{const r=new e.Response(i,n);ot(),tt&&tt.then((e=>e.put(st(t.url),r))).catch((t=>H(t.message)))})))}(n,a,l),o=!0,i(null,t,r.headers.get("Cache-Control"),r.headers.get("Expires")))})).catch((t=>{s||i(new Error(t.message))}))};return a?function(t,e){if(ot(),!tt)return e(null);const i=st(t.url);tt.then((t=>{t.match(i).then((r=>{const n=function(t){if(!t)return!1;const e=new Date(t.headers.get("Expires")||0),i=q(t.headers.get("Cache-Control")||"");return e>Date.now()&&!i["no-cache"]}(r);t.delete(i),n&&t.put(i,r.clone()),e(null,r,n)})).catch(e)})).catch(e)}(n,c):c(null,null),{cancel:()=>{s=!0,o||r.abort()}}}(t,i);if(Z()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,i,void 0,!0)}var r;return function(t,i){const r=new e.XMLHttpRequest;r.open(t.method||"GET",t.url,!0),"arrayBuffer"===t.type&&(r.responseType="arraybuffer");for(const e in t.headers)r.setRequestHeader(e,t.headers[e]);return"json"===t.type&&(r.responseType="text",r.setRequestHeader("Accept","application/json")),r.withCredentials="include"===t.credentials,r.onerror=()=>{i(new Error(r.statusText))},r.onload=()=>{if((r.status>=200&&r.status<300||0===r.status)&&null!==r.response){let e=r.response;if("json"===t.type)try{e=JSON.parse(r.response)}catch(t){return i(t)}i(null,e,r.getResponseHeader("Cache-Control"),r.getResponseHeader("Expires"))}else i(new ct(r.statusText,r.status,t.url))},r.send(t.body),{cancel:()=>r.abort()}}(t,i)},dt=function(t,e){return ht(P(t,{type:"arrayBuffer"}),e)};function pt(t){const i=e.document.createElement("a");return i.href=t,i.protocol===e.document.location.protocol&&i.host===e.document.location.host}const ft="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let At,mt;At=[],mt=0;const gt=function(t,i){if(o.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),mt>=n.MAX_PARALLEL_IMAGE_REQUESTS){const e={requestParameters:t,callback:i,cancelled:!1,cancel(){this.cancelled=!0}};return At.push(e),e}mt++;let r=!1;const s=()=>{if(!r)for(r=!0,mt--;At.length&&mt<n.MAX_PARALLEL_IMAGE_REQUESTS;){const t=At.shift(),{requestParameters:e,callback:i,cancelled:r}=t;r||(t.cancel=gt(e,i).cancel)}},a=dt(t,((t,r,n,o)=>{s(),t?i(t):r&&(e.createImageBitmap?function(t,i){const r=new e.Blob([new Uint8Array(t)],{type:"image/png"});e.createImageBitmap(r).then((t=>{i(null,t)})).catch((t=>{i(new Error(`Could not load image because of ${t.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))}))}(r,((t,e)=>i(t,e,n,o))):function(t,i){const r=new e.Image,n=e.URL;r.onload=()=>{i(null,r),n.revokeObjectURL(r.src),r.onload=null,e.requestAnimationFrame((()=>{r.src=ft}))},r.onerror=()=>i(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const o=new e.Blob([new Uint8Array(t)],{type:"image/png"});r.src=t.byteLength?n.createObjectURL(o):ft}(r,((t,e)=>i(t,e,n,o))))}));return{cancel:()=>{a.cancel(),s()}}},_t="NO_ACCESS_TOKEN";function yt(t){return 0===t.indexOf("mapbox:")}function vt(t){return n.API_URL_REGEX.test(t)}function xt(t){return n.API_CDN_URL_REGEX.test(t)}function bt(t){return n.API_STYLE_REGEX.test(t)&&!wt(t)}function wt(t){return n.API_SPRITE_REGEX.test(t)}const Tt=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Bt(t){const e=t.match(Tt);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function Et(t){const e=t.params.length?`?${t.params.join("&")}`:"";return`${t.protocol}://${t.authority}${t.path}${e}`}const Ct="mapbox.eventData";function St(t){if(!t)return null;const i=t.split(".");if(!i||3!==i.length)return null;try{return JSON.parse(decodeURIComponent(e.atob(i[1]).split("").map((t=>"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2))).join("")))}catch(t){return null}}class It{constructor(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(t){const i=St(n.ACCESS_TOKEN);let r="";return r=i&&i.u?e.btoa(encodeURIComponent(i.u).replace(/%([0-9A-F]{2})/g,((t,e)=>String.fromCharCode(Number("0x"+e))))):n.ACCESS_TOKEN||"",t?`${Ct}.${t}:${r}`:`${Ct}:${r}`}fetchEventData(){const t=X("localStorage"),i=this.getStorageKey(),r=this.getStorageKey("uuid");if(t)try{const t=e.localStorage.getItem(i);t&&(this.eventData=JSON.parse(t));const n=e.localStorage.getItem(r);n&&(this.anonId=n)}catch(t){H("Unable to read from LocalStorage")}}saveEventData(){const t=X("localStorage"),i=this.getStorageKey(),r=this.getStorageKey("uuid");if(t)try{e.localStorage.setItem(r,this.anonId),Object.keys(this.eventData).length>=1&&e.localStorage.setItem(i,JSON.stringify(this.eventData))}catch(t){H("Unable to write to LocalStorage")}}processRequests(t){}postEvent(t,e,i,r){if(!n.EVENTS_URL)return;const o=Bt(n.EVENTS_URL);o.params.push(`access_token=${r||n.ACCESS_TOKEN||""}`);const s={event:this.type,created:new Date(t).toISOString()},a=e?P(s,e):s,l={url:Et(o),headers:{"Content-Type":"text/plain"},body:JSON.stringify([a])};this.pendingRequest=function(t,e){return ht(P(t,{method:"POST"}),e)}(l,(t=>{this.pendingRequest=null,i(t),this.saveEventData(),this.processRequests(r)}))}queueRequest(t,e){this.queue.push(t),this.processRequests(e)}}const Mt=new class extends It{constructor(t){super("appUserTurnstile"),this._customAccessToken=t}postTurnstileEvent(t,e){n.EVENTS_URL&&n.ACCESS_TOKEN&&Array.isArray(t)&&t.some((t=>yt(t)||vt(t)))&&this.queueRequest(Date.now(),e)}processRequests(t){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const e=St(n.ACCESS_TOKEN),r=e?e.u:n.ACCESS_TOKEN;let o=r!==this.eventData.tokenU;R(this.anonId)||(this.anonId=F(),o=!0);const s=this.queue.shift();if(this.eventData.lastSuccess){const t=new Date(this.eventData.lastSuccess),e=new Date(s),i=(s-this.eventData.lastSuccess)/864e5;o=o||i>=1||i<-1||t.getDate()!==e.getDate()}else o=!0;o?this.postEvent(s,{sdkIdentifier:"mapbox-gl-js",sdkVersion:i,skuId:h,"enabled.telemetry":!1,userId:this.anonId},(t=>{t||(this.eventData.lastSuccess=s,this.eventData.tokenU=r)}),t):this.processRequests()}},kt=Mt.postTurnstileEvent.bind(Mt),Pt=new class extends It{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(t,e,i,r){this.skuToken=e,this.errorCb=r,n.EVENTS_URL&&(i||n.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},i):this.errorCb(new Error(_t)))}processRequests(t){if(this.pendingRequest||0===this.queue.length)return;const{id:e,timestamp:r}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),R(this.anonId)||(this.anonId=F()),this.postEvent(r,{sdkIdentifier:"mapbox-gl-js",sdkVersion:i,skuId:h,skuToken:this.skuToken,userId:this.anonId},(t=>{t?this.errorCb(t):e&&(this.success[e]=!0)}),t))}},Lt=Pt.postMapLoadEvent.bind(Pt),zt=new class extends It{constructor(){super("gljs.performance")}postPerformanceEvent(t,e){n.EVENTS_URL&&(t||n.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:e},t)}processRequests(t){if(this.pendingRequest||0===this.queue.length)return;const{timestamp:r,performanceData:n}=this.queue.shift(),o=function(t){const r=e.performance.getEntriesByType("resource"),n=e.performance.getEntriesByType("mark"),o=function(t){const e={};if(t)for(const i in t)if("other"!==i)for(const r of t[i]){const t=`${i}ResolveRangeMin`,n=`${i}ResolveRangeMax`,o=`${i}RequestCount`,s=`${i}RequestCachedCount`;e[t]=Math.min(e[t]||1/0,r.startTime),e[n]=Math.max(e[n]||-1/0,r.responseEnd);const a=t=>{void 0===e[t]&&(e[t]=0),++e[t]};void 0!==r.transferSize&&0===r.transferSize&&a(s),a(o)}return e}(function(t,e){const i={};if(t)for(const r of t){const t=e(r);void 0===i[t]&&(i[t]=[]),i[t].push(r)}return i}(r,Qt)),s=e.devicePixelRatio,a=e.navigator.connection||e.navigator.mozConnection||e.navigator.webkitConnection,l={counters:[],metadata:[],attributes:[]},c=(t,e,i)=>{null!=i&&t.push({name:e,value:i.toString()})};for(const t in o)c(l.counters,t,o[t]);if(t.interactionRange[0]!==1/0&&t.interactionRange[1]!==-1/0&&(c(l.counters,"interactionRangeMin",t.interactionRange[0]),c(l.counters,"interactionRangeMax",t.interactionRange[1])),n)for(const t of Object.keys(Ot)){const e=Ot[t],i=n.find((t=>t.name===e));i&&c(l.counters,e,i.startTime)}return c(l.counters,"visibilityHidden",t.visibilityHidden),c(l.attributes,"style",function(t){if(t)for(const e of t){const t=e.name.split("?")[0];if(bt(t)){const e=t.split("/").slice(-2);if(2===e.length)return`mapbox://styles/${e[0]}/${e[1]}`}}}(r)),c(l.attributes,"terrainEnabled",t.terrainEnabled?"true":"false"),c(l.attributes,"fogEnabled",t.fogEnabled?"true":"false"),c(l.attributes,"projection",t.projection),c(l.attributes,"zoom",t.zoom),c(l.metadata,"devicePixelRatio",s),c(l.metadata,"connectionEffectiveType",a?a.effectiveType:void 0),c(l.metadata,"navigatorUserAgent",e.navigator.userAgent),c(l.metadata,"screenWidth",e.screen.width),c(l.metadata,"screenHeight",e.screen.height),c(l.metadata,"windowWidth",e.innerWidth),c(l.metadata,"windowHeight",e.innerHeight),c(l.metadata,"mapWidth",t.width/s),c(l.metadata,"mapHeight",t.height/s),c(l.metadata,"webglRenderer",t.renderer),c(l.metadata,"webglVendor",t.vendor),c(l.metadata,"sdkVersion",i),c(l.metadata,"sdkIdentifier","mapbox-gl-js"),l}(n);for(const t of o.metadata);for(const t of o.counters);for(const t of o.attributes);this.postEvent(r,o,(()=>{}),t)}},Ft=zt.postPerformanceEvent.bind(zt),Dt=new class extends It{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(t,e,i,r){if(!n.API_URL||!n.SESSION_PATH)return;const o=Bt(n.API_URL+n.SESSION_PATH);o.params.push(`sku=${e||""}`),o.params.push(`access_token=${r||n.ACCESS_TOKEN||""}`);const s={url:Et(o),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(t,e){return ht(P(t,{method:"GET"}),e)}(s,(t=>{this.pendingRequest=null,i(t),this.saveEventData(),this.processRequests(r)}))}getSessionAPI(t,e,i,r){this.skuToken=e,this.errorCb=r,n.SESSION_PATH&&n.API_URL&&(i||n.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},i):this.errorCb(new Error(_t)))}processRequests(t){if(this.pendingRequest||0===this.queue.length)return;const{id:e,timestamp:i}=this.queue.shift();e&&this.success[e]||this.getSession(i,this.skuToken,(t=>{t?this.errorCb(t):e&&(this.success[e]=!0)}),t)}},Rt=Dt.getSessionAPI.bind(Dt),Ut=new Set,Ot={create:"create",load:"load",fullLoad:"fullLoad"},Nt={mark(t){e.performance.mark(t)},measure(t,i,r){e.performance.measure(t,i,r)}};function Qt(t){const e=t.name.split("?")[0];return xt(e)&&e.includes("mapbox-gl.js")?"javascript":xt(e)&&e.includes("mapbox-gl.css")?"css":function(t){return n.API_FONTS_REGEX.test(t)}(e)?"fontRange":wt(e)?"sprite":bt(e)?"style":function(t){return n.API_TILEJSON_REGEX.test(t)}(e)?"tilejson":"other"}const Vt=e.performance;function jt(t){const e=t?t.url.toString():void 0;return Vt.getEntriesByName(e)}let Ht,Gt,$t,Zt;const qt={now:()=>void 0!==$t?$t:e.performance.now(),setNow(t){$t=t},restoreNow(){$t=void 0},frame(t){const i=e.requestAnimationFrame(t);return{cancel:()=>e.cancelAnimationFrame(i)}},getImageData(t,i=0){const{width:r,height:n}=t;Zt||(Zt=e.document.createElement("canvas"));const o=Zt.getContext("2d",{willReadFrequently:!0});if(!o)throw new Error("failed to create canvas 2d context");return(r>Zt.width||n>Zt.height)&&(Zt.width=r,Zt.height=n),o.clearRect(-i,-i,r+2*i,n+2*i),o.drawImage(t,0,0,r,n),o.getImageData(-i,-i,r+2*i,n+2*i)},resolveURL:t=>(Ht||(Ht=e.document.createElement("a")),Ht.href=t,Ht.href),get devicePixelRatio(){return e.devicePixelRatio},get prefersReducedMotion(){return!!e.matchMedia&&(null==Gt&&(Gt=e.matchMedia("(prefers-reduced-motion: reduce)")),Gt.matches)}};function Kt(t,e,i){i[t]&&-1!==i[t].indexOf(e)||(i[t]=i[t]||[],i[t].push(e))}function Wt(t,e,i){if(i&&i[t]){const r=i[t].indexOf(e);-1!==r&&i[t].splice(r,1)}}class Xt{constructor(t,e={}){P(this,e),this.type=t}}class Jt extends Xt{constructor(t,e={}){super("error",P({error:t},e))}}class Yt{on(t,e){return this._listeners=this._listeners||{},Kt(t,e,this._listeners),this}off(t,e){return Wt(t,e,this._listeners),Wt(t,e,this._oneTimeListeners),this}once(t,e){return e?(this._oneTimeListeners=this._oneTimeListeners||{},Kt(t,e,this._oneTimeListeners),this):new Promise((e=>this.once(t,e)))}fire(t,e){"string"==typeof t&&(t=new Xt(t,e||{}));const i=t.type;if(this.listens(i)){t.target=this;const e=this._listeners&&this._listeners[i]?this._listeners[i].slice():[];for(const i of e)i.call(this,t);const r=this._oneTimeListeners&&this._oneTimeListeners[i]?this._oneTimeListeners[i].slice():[];for(const e of r)Wt(i,e,this._oneTimeListeners),e.call(this,t);const n=this._eventedParent;n&&(P(t,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),n.fire(t))}else t instanceof Jt&&console.error(t.error);return this}listens(t){return!!(this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t))}setEventedParent(t,e){return this._eventedParent=t,this._eventedParentData=e,this}}var te=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["fill-extrusion-edge-radius"]},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"requires":["fill-extrusion-edge-radius"],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":false,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function ee(t,...e){for(const i of e)for(const e in i)t[e]=i[e];return t}function ie(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function re(t){if(Array.isArray(t))return t.map(re);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){const e={};for(const i in t)e[i]=re(t[i]);return e}return ie(t)}class ne extends Error{constructor(t,e){super(e),this.message=e,this.key=t}}var oe=ne;class se{constructor(t,e=[]){this.parent=t,this.bindings={};for(const[t,i]of e)this.bindings[t]=i}concat(t){return new se(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}var ae=se;const le={kind:"null"},ce={kind:"number"},ue={kind:"string"},he={kind:"boolean"},de={kind:"color"},pe={kind:"object"},fe={kind:"value"},Ae={kind:"collator"},me={kind:"formatted"},ge={kind:"resolvedImage"};function _e(t,e){return{kind:"array",itemType:t,N:e}}function ye(t){if("array"===t.kind){const e=ye(t.itemType);return"number"==typeof t.N?`array<${e}, ${t.N}>`:"value"===t.itemType.kind?"array":`array<${e}>`}return t.kind}const ve=[le,ce,ue,he,de,me,pe,_e(fe),ge];function xe(t,e){if("error"===e.kind)return null;if("array"===t.kind){if("array"===e.kind&&(0===e.N&&"value"===e.itemType.kind||!xe(t.itemType,e.itemType))&&("number"!=typeof t.N||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if("value"===t.kind)for(const t of ve)if(!xe(t,e))return null}return`Expected ${ye(t)} but found ${ye(e)} instead.`}function be(t,e){return e.some((e=>e.kind===t.kind))}function we(t,e){return e.some((e=>"null"===e?null===t:"array"===e?Array.isArray(t):"object"===e?t&&!Array.isArray(t)&&"object"==typeof t:e===typeof t))}var Te,Be={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function Ee(t){return(t=Math.round(t))<0?0:t>255?255:t}function Ce(t){return Ee("%"===t[t.length-1]?parseFloat(t)/100*255:parseInt(t))}function Se(t){return(e="%"===t[t.length-1]?parseFloat(t)/100:parseFloat(t))<0?0:e>1?1:e;var e}function Ie(t,e,i){return i<0?i+=1:i>1&&(i-=1),6*i<1?t+(e-t)*i*6:2*i<1?e:3*i<2?t+(e-t)*(2/3-i)*6:t}try{Te={}.parseCSSColor=function(t){var e,i=t.replace(/ /g,"").toLowerCase();if(i in Be)return Be[i].slice();if("#"===i[0])return 4===i.length?(e=parseInt(i.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:7===i.length&&(e=parseInt(i.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var r=i.indexOf("("),n=i.indexOf(")");if(-1!==r&&n+1===i.length){var o=i.substr(0,r),s=i.substr(r+1,n-(r+1)).split(","),a=1;switch(o){case"rgba":if(4!==s.length)return null;a=Se(s.pop());case"rgb":return 3!==s.length?null:[Ce(s[0]),Ce(s[1]),Ce(s[2]),a];case"hsla":if(4!==s.length)return null;a=Se(s.pop());case"hsl":if(3!==s.length)return null;var l=(parseFloat(s[0])%360+360)%360/360,c=Se(s[1]),u=Se(s[2]),h=u<=.5?u*(c+1):u+c-u*c,d=2*u-h;return[Ee(255*Ie(d,h,l+1/3)),Ee(255*Ie(d,h,l)),Ee(255*Ie(d,h,l-1/3)),a];default:return null}}return null}}catch(t){}class Me{constructor(t,e,i,r=1){this.r=t,this.g=e,this.b=i,this.a=r}static parse(t){if(!t)return;if(t instanceof Me)return t;if("string"!=typeof t)return;const e=Te(t);return e?new Me(e[0]/255*e[3],e[1]/255*e[3],e[2]/255*e[3],e[3]):void 0}toString(){const[t,e,i,r]=this.toArray();return`rgba(${Math.round(t)},${Math.round(e)},${Math.round(i)},${r})`}toArray(){const{r:t,g:e,b:i,a:r}=this;return 0===r?[0,0,0,0]:[255*t/r,255*e/r,255*i/r,r]}toArray01(){const{r:t,g:e,b:i,a:r}=this;return 0===r?[0,0,0,0]:[t/r,e/r,i/r,r]}toArray01PremultipliedAlpha(){const{r:t,g:e,b:i,a:r}=this;return[t,e,i,r]}}Me.black=new Me(0,0,0,1),Me.white=new Me(1,1,1,1),Me.transparent=new Me(0,0,0,0),Me.red=new Me(1,0,0,1),Me.blue=new Me(0,0,1,1);var ke=Me;class Pe{constructor(t,e,i){this.sensitivity=t?e?"variant":"case":e?"accent":"base",this.locale=i,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,e){return this.collator.compare(t,e)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Le{constructor(t,e,i,r,n){this.text=t.normalize?t.normalize():t,this.image=e,this.scale=i,this.fontStack=r,this.textColor=n}}class ze{constructor(t){this.sections=t}static fromString(t){return new ze([new Le(t,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some((t=>0!==t.text.length||t.image&&0!==t.image.name.length))}static factory(t){return t instanceof ze?t:ze.fromString(t)}toString(){return 0===this.sections.length?"":this.sections.map((t=>t.text)).join("")}serialize(){const t=["format"];for(const e of this.sections){if(e.image){t.push(["image",e.image.name]);continue}t.push(e.text);const i={};e.fontStack&&(i["text-font"]=["literal",e.fontStack.split(",")]),e.scale&&(i["font-scale"]=e.scale),e.textColor&&(i["text-color"]=["rgba"].concat(e.textColor.toArray())),t.push(i)}return t}}class Fe{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new Fe({name:t,available:!1}):null}serialize(){return["image",this.name]}}function De(t,e,i,r){return"number"==typeof t&&t>=0&&t<=255&&"number"==typeof e&&e>=0&&e<=255&&"number"==typeof i&&i>=0&&i<=255?void 0===r||"number"==typeof r&&r>=0&&r<=1?null:`Invalid rgba value [${[t,e,i,r].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof r?[t,e,i,r]:[t,e,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Re(t){if(null===t)return!0;if("string"==typeof t)return!0;if("boolean"==typeof t)return!0;if("number"==typeof t)return!0;if(t instanceof ke)return!0;if(t instanceof Pe)return!0;if(t instanceof ze)return!0;if(t instanceof Fe)return!0;if(Array.isArray(t)){for(const e of t)if(!Re(e))return!1;return!0}if("object"==typeof t){for(const e in t)if(!Re(t[e]))return!1;return!0}return!1}function Ue(t){if(null===t)return le;if("string"==typeof t)return ue;if("boolean"==typeof t)return he;if("number"==typeof t)return ce;if(t instanceof ke)return de;if(t instanceof Pe)return Ae;if(t instanceof ze)return me;if(t instanceof Fe)return ge;if(Array.isArray(t)){const e=t.length;let i;for(const e of t){const t=Ue(e);if(i){if(i===t)continue;i=fe;break}i=t}return _e(i||fe,e)}return pe}function Oe(t){const e=typeof t;return null===t?"":"string"===e||"number"===e||"boolean"===e?String(t):t instanceof ke||t instanceof ze||t instanceof Fe?t.toString():JSON.stringify(t)}class Ne{constructor(t,e){this.type=t,this.value=e}static parse(t,e){if(2!==t.length)return e.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!Re(t[1]))return e.error("invalid value");const i=t[1];let r=Ue(i);const n=e.expectedType;return"array"!==r.kind||0!==r.N||!n||"array"!==n.kind||"number"==typeof n.N&&0!==n.N||(r=n),new Ne(r,i)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof ke?["rgba"].concat(this.value.toArray()):this.value instanceof ze?this.value.serialize():this.value}}var Qe=Ne,Ve=class{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}};const je={string:ue,number:ce,boolean:he,object:pe};class He{constructor(t,e){this.type=t,this.args=e}static parse(t,e){if(t.length<2)return e.error("Expected at least one argument.");let i,r=1;const n=t[0];if("array"===n){let n,o;if(t.length>2){const i=t[1];if("string"!=typeof i||!(i in je)||"object"===i)return e.error('The item type argument of "array" must be one of string, number, boolean',1);n=je[i],r++}else n=fe;if(t.length>3){if(null!==t[2]&&("number"!=typeof t[2]||t[2]<0||t[2]!==Math.floor(t[2])))return e.error('The length argument to "array" must be a positive integer literal',2);o=t[2],r++}i=_e(n,o)}else i=je[n];const o=[];for(;r<t.length;r++){const i=e.parse(t[r],r,fe);if(!i)return null;o.push(i)}return new He(i,o)}evaluate(t){for(let e=0;e<this.args.length;e++){const i=this.args[e].evaluate(t);if(!xe(this.type,Ue(i)))return i;if(e===this.args.length-1)throw new Ve(`Expected value to be of type ${ye(this.type)}, but found ${ye(Ue(i))} instead.`)}return null}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}serialize(){const t=this.type,e=[t.kind];if("array"===t.kind){const i=t.itemType;if("string"===i.kind||"number"===i.kind||"boolean"===i.kind){e.push(i.kind);const r=t.N;("number"==typeof r||this.args.length>1)&&e.push(r)}}return e.concat(this.args.map((t=>t.serialize())))}}var Ge=He;class $e{constructor(t){this.type=me,this.sections=t}static parse(t,e){if(t.length<2)return e.error("Expected at least one argument.");const i=t[1];if(!Array.isArray(i)&&"object"==typeof i)return e.error("First argument must be an image or text section.");const r=[];let n=!1;for(let i=1;i<=t.length-1;++i){const o=t[i];if(n&&"object"==typeof o&&!Array.isArray(o)){n=!1;let t=null;if(o["font-scale"]&&(t=e.parse(o["font-scale"],1,ce),!t))return null;let i=null;if(o["text-font"]&&(i=e.parse(o["text-font"],1,_e(ue)),!i))return null;let s=null;if(o["text-color"]&&(s=e.parse(o["text-color"],1,de),!s))return null;const a=r[r.length-1];a.scale=t,a.font=i,a.textColor=s}else{const o=e.parse(t[i],1,fe);if(!o)return null;const s=o.type.kind;if("string"!==s&&"value"!==s&&"null"!==s&&"resolvedImage"!==s)return e.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");n=!0,r.push({content:o,scale:null,font:null,textColor:null})}}return new $e(r)}evaluate(t){return new ze(this.sections.map((e=>{const i=e.content.evaluate(t);return Ue(i)===ge?new Le("",i,null,null,null):new Le(Oe(i),null,e.scale?e.scale.evaluate(t):null,e.font?e.font.evaluate(t).join(","):null,e.textColor?e.textColor.evaluate(t):null)})))}eachChild(t){for(const e of this.sections)t(e.content),e.scale&&t(e.scale),e.font&&t(e.font),e.textColor&&t(e.textColor)}outputDefined(){return!1}serialize(){const t=["format"];for(const e of this.sections){t.push(e.content.serialize());const i={};e.scale&&(i["font-scale"]=e.scale.serialize()),e.font&&(i["text-font"]=e.font.serialize()),e.textColor&&(i["text-color"]=e.textColor.serialize()),t.push(i)}return t}}class Ze{constructor(t){this.type=ge,this.input=t}static parse(t,e){if(2!==t.length)return e.error("Expected two arguments.");const i=e.parse(t[1],1,ue);return i?new Ze(i):e.error("No image name provided.")}evaluate(t){const e=this.input.evaluate(t),i=Fe.fromString(e);return i&&t.availableImages&&(i.available=t.availableImages.indexOf(e)>-1),i}eachChild(t){t(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const qe={"to-boolean":he,"to-color":de,"to-number":ce,"to-string":ue};class Ke{constructor(t,e){this.type=t,this.args=e}static parse(t,e){if(t.length<2)return e.error("Expected at least one argument.");const i=t[0];if(("to-boolean"===i||"to-string"===i)&&2!==t.length)return e.error("Expected one argument.");const r=qe[i],n=[];for(let i=1;i<t.length;i++){const r=e.parse(t[i],i,fe);if(!r)return null;n.push(r)}return new Ke(r,n)}evaluate(t){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(t));if("color"===this.type.kind){let e,i;for(const r of this.args){if(e=r.evaluate(t),i=null,e instanceof ke)return e;if("string"==typeof e){const i=t.parseColor(e);if(i)return i}else if(Array.isArray(e)&&(i=e.length<3||e.length>4?`Invalid rbga value ${JSON.stringify(e)}: expected an array containing either three or four numeric values.`:De(e[0],e[1],e[2],e[3]),!i))return new ke(e[0]/255,e[1]/255,e[2]/255,e[3])}throw new Ve(i||`Could not parse color from value '${"string"==typeof e?e:String(JSON.stringify(e))}'`)}if("number"===this.type.kind){let e=null;for(const i of this.args){if(e=i.evaluate(t),null===e)return 0;const r=Number(e);if(!isNaN(r))return r}throw new Ve(`Could not convert ${JSON.stringify(e)} to number.`)}return"formatted"===this.type.kind?ze.fromString(Oe(this.args[0].evaluate(t))):"resolvedImage"===this.type.kind?Fe.fromString(Oe(this.args[0].evaluate(t))):Oe(this.args[0].evaluate(t))}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}serialize(){if("formatted"===this.type.kind)return new $e([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new Ze(this.args[0]).serialize();const t=[`to-${this.type.kind}`];return this.eachChild((e=>{t.push(e.serialize())})),t}}var We=Ke;const Xe=["Unknown","Point","LineString","Polygon"];var Je=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&void 0!==this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?Xe[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const t=this.featureDistanceData.center,e=this.featureDistanceData.scale,{x:i,y:r}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(i*e-t[0])+this.featureDistanceData.bearing[1]*(r*e-t[1])}return 0}parseColor(t){let e=this._parseColorCache[t];return e||(e=this._parseColorCache[t]=ke.parse(t)),e}};class Ye{constructor(t,e,i,r){this.name=t,this.type=e,this._evaluate=i,this.args=r}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map((t=>t.serialize())))}static parse(t,e){const i=t[0],r=Ye.definitions[i];if(!r)return e.error(`Unknown expression "${i}". If you wanted a literal array, use ["literal", [...]].`,0);const n=Array.isArray(r)?r[0]:r.type,o=Array.isArray(r)?[[r[1],r[2]]]:r.overloads,s=o.filter((([e])=>!Array.isArray(e)||e.length===t.length-1));let a=null;for(const[r,o]of s){a=new Ei(e.registry,e.path,null,e.scope);const s=[];let l=!1;for(let e=1;e<t.length;e++){const i=t[e],n=Array.isArray(r)?r[e-1]:r.type,o=a.parse(i,1+s.length,n);if(!o){l=!0;break}s.push(o)}if(!l)if(Array.isArray(r)&&r.length!==s.length)a.error(`Expected ${r.length} arguments, but found ${s.length} instead.`);else{for(let t=0;t<s.length;t++){const e=Array.isArray(r)?r[t]:r.type,i=s[t];a.concat(t+1).checkSubtype(e,i.type)}if(0===a.errors.length)return new Ye(i,n,o,s)}}if(1===s.length)e.errors.push(...a.errors);else{const i=(s.length?s:o).map((([t])=>{return e=t,Array.isArray(e)?`(${e.map(ye).join(", ")})`:`(${ye(e.type)}...)`;var e})).join(" | "),r=[];for(let i=1;i<t.length;i++){const n=e.parse(t[i],1+r.length);if(!n)return null;r.push(ye(n.type))}e.error(`Expected arguments of type ${i}, but found (${r.join(", ")}) instead.`)}return null}static register(t,e){Ye.definitions=e;for(const i in e)t[i]=Ye}}var ti=Ye;class ei{constructor(t,e,i){this.type=Ae,this.locale=i,this.caseSensitive=t,this.diacriticSensitive=e}static parse(t,e){if(2!==t.length)return e.error("Expected one argument.");const i=t[1];if("object"!=typeof i||Array.isArray(i))return e.error("Collator options argument must be an object.");const r=e.parse(void 0!==i["case-sensitive"]&&i["case-sensitive"],1,he);if(!r)return null;const n=e.parse(void 0!==i["diacritic-sensitive"]&&i["diacritic-sensitive"],1,he);if(!n)return null;let o=null;return i.locale&&(o=e.parse(i.locale,1,ue),!o)?null:new ei(r,n,o)}evaluate(t){return new Pe(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}serialize(){const t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]}}const ii=8192;function ri(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function ni(t,e){return!(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function oi(t,e){const i=(180+t[0])/360,r=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,n=Math.pow(2,e.z);return[Math.round(i*n*ii),Math.round(r*n*ii)]}function si(t,e,i){const r=t[0]-e[0],n=t[1]-e[1],o=t[0]-i[0],s=t[1]-i[1];return r*s-o*n==0&&r*o<=0&&n*s<=0}function ai(t,e){let i=!1;for(let s=0,a=e.length;s<a;s++){const a=e[s];for(let e=0,s=a.length;e<s-1;e++){if(si(t,a[e],a[e+1]))return!1;(n=a[e])[1]>(r=t)[1]!=(o=a[e+1])[1]>r[1]&&r[0]<(o[0]-n[0])*(r[1]-n[1])/(o[1]-n[1])+n[0]&&(i=!i)}}var r,n,o;return i}function li(t,e){for(let i=0;i<e.length;i++)if(ai(t,e[i]))return!0;return!1}function ci(t,e,i,r){const n=r[0]-i[0],o=r[1]-i[1],s=(t[0]-i[0])*o-n*(t[1]-i[1]),a=(e[0]-i[0])*o-n*(e[1]-i[1]);return s>0&&a<0||s<0&&a>0}function ui(t,e,i){for(const c of i)for(let i=0;i<c.length-1;++i)if(0!=(a=[(s=c[i+1])[0]-(o=c[i])[0],s[1]-o[1]])[0]*(l=[(n=e)[0]-(r=t)[0],n[1]-r[1]])[1]-a[1]*l[0]&&ci(r,n,o,s)&&ci(o,s,r,n))return!0;var r,n,o,s,a,l;return!1}function hi(t,e){for(let i=0;i<t.length;++i)if(!ai(t[i],e))return!1;for(let i=0;i<t.length-1;++i)if(ui(t[i],t[i+1],e))return!1;return!0}function di(t,e){for(let i=0;i<e.length;i++)if(hi(t,e[i]))return!0;return!1}function pi(t,e,i){const r=[];for(let n=0;n<t.length;n++){const o=[];for(let r=0;r<t[n].length;r++){const s=oi(t[n][r],i);ri(e,s),o.push(s)}r.push(o)}return r}function fi(t,e,i){const r=[];for(let n=0;n<t.length;n++){const o=pi(t[n],e,i);r.push(o)}return r}function Ai(t,e,i,r){if(t[0]<i[0]||t[0]>i[2]){const e=.5*r;let n=t[0]-i[0]>e?-r:i[0]-t[0]>e?r:0;0===n&&(n=t[0]-i[2]>e?-r:i[2]-t[0]>e?r:0),t[0]+=n}ri(e,t)}function mi(t,e,i,r){const n=Math.pow(2,r.z)*ii,o=[r.x*ii,r.y*ii],s=[];if(!t)return s;for(const r of t)for(const t of r){const r=[t.x+o[0],t.y+o[1]];Ai(r,e,i,n),s.push(r)}return s}function gi(t,e,i,r){const n=Math.pow(2,r.z)*ii,o=[r.x*ii,r.y*ii],s=[];if(!t)return s;for(const i of t){const t=[];for(const r of i){const i=[r.x+o[0],r.y+o[1]];ri(e,i),t.push(i)}s.push(t)}if(e[2]-e[0]<=n/2){(a=e)[0]=a[1]=1/0,a[2]=a[3]=-1/0;for(const t of s)for(const r of t)Ai(r,e,i,n)}var a;return s}class _i{constructor(t,e){this.type=he,this.geojson=t,this.geometries=e}static parse(t,e){if(2!==t.length)return e.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(Re(t[1])){const e=t[1];if("FeatureCollection"===e.type)for(let t=0;t<e.features.length;++t){const i=e.features[t].geometry.type;if("Polygon"===i||"MultiPolygon"===i)return new _i(e,e.features[t].geometry)}else if("Feature"===e.type){const t=e.geometry.type;if("Polygon"===t||"MultiPolygon"===t)return new _i(e,e.geometry)}else if("Polygon"===e.type||"MultiPolygon"===e.type)return new _i(e,e)}return e.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(null!=t.geometry()&&null!=t.canonicalID()){if("Point"===t.geometryType())return function(t,e){const i=[1/0,1/0,-1/0,-1/0],r=[1/0,1/0,-1/0,-1/0],n=t.canonicalID();if(!n)return!1;if("Polygon"===e.type){const o=pi(e.coordinates,r,n),s=mi(t.geometry(),i,r,n);if(!ni(i,r))return!1;for(const t of s)if(!ai(t,o))return!1}if("MultiPolygon"===e.type){const o=fi(e.coordinates,r,n),s=mi(t.geometry(),i,r,n);if(!ni(i,r))return!1;for(const t of s)if(!li(t,o))return!1}return!0}(t,this.geometries);if("LineString"===t.geometryType())return function(t,e){const i=[1/0,1/0,-1/0,-1/0],r=[1/0,1/0,-1/0,-1/0],n=t.canonicalID();if(!n)return!1;if("Polygon"===e.type){const o=pi(e.coordinates,r,n),s=gi(t.geometry(),i,r,n);if(!ni(i,r))return!1;for(const t of s)if(!hi(t,o))return!1}if("MultiPolygon"===e.type){const o=fi(e.coordinates,r,n),s=gi(t.geometry(),i,r,n);if(!ni(i,r))return!1;for(const t of s)if(!di(t,o))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var yi=_i;function vi(t){if(t instanceof ti){if("get"===t.name&&1===t.args.length)return!1;if("feature-state"===t.name)return!1;if("has"===t.name&&1===t.args.length)return!1;if("properties"===t.name||"geometry-type"===t.name||"id"===t.name)return!1;if(/^filter-/.test(t.name))return!1}if(t instanceof yi)return!1;let e=!0;return t.eachChild((t=>{e&&!vi(t)&&(e=!1)})),e}function xi(t){if(t instanceof ti&&"feature-state"===t.name)return!1;let e=!0;return t.eachChild((t=>{e&&!xi(t)&&(e=!1)})),e}function bi(t,e){if(t instanceof ti&&e.indexOf(t.name)>=0)return!1;let i=!0;return t.eachChild((t=>{i&&!bi(t,e)&&(i=!1)})),i}class wi{constructor(t,e){this.type=e.type,this.name=t,this.boundExpression=e}static parse(t,e){if(2!==t.length||"string"!=typeof t[1])return e.error("'var' expression requires exactly one string literal argument.");const i=t[1];return e.scope.has(i)?new wi(i,e.scope.get(i)):e.error(`Unknown variable "${i}". Make sure "${i}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var Ti=wi;class Bi{constructor(t,e=[],i,r=new ae,n=[]){this.registry=t,this.path=e,this.key=e.map((t=>`[${t}]`)).join(""),this.scope=r,this.errors=n,this.expectedType=i}parse(t,e,i,r,n={}){return e?this.concat(e,i,r)._parse(t,n):this._parse(t,n)}_parse(t,e){function i(t,e,i){return"assert"===i?new Ge(e,[t]):"coerce"===i?new We(e,[t]):t}if(null!==t&&"string"!=typeof t&&"boolean"!=typeof t&&"number"!=typeof t||(t=["literal",t]),Array.isArray(t)){if(0===t.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const r=t[0];if("string"!=typeof r)return this.error(`Expression name must be a string, but found ${typeof r} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const n=this.registry[r];if(n){let r=n.parse(t,this);if(!r)return null;if(this.expectedType){const t=this.expectedType,n=r.type;if("string"!==t.kind&&"number"!==t.kind&&"boolean"!==t.kind&&"object"!==t.kind&&"array"!==t.kind||"value"!==n.kind)if("color"!==t.kind&&"formatted"!==t.kind&&"resolvedImage"!==t.kind||"value"!==n.kind&&"string"!==n.kind){if(this.checkSubtype(t,n))return null}else r=i(r,t,e.typeAnnotation||"coerce");else r=i(r,t,e.typeAnnotation||"assert")}if(!(r instanceof Qe)&&"resolvedImage"!==r.type.kind&&Ci(r)){const e=new Je;try{r=new Qe(r.type,r.evaluate(e))}catch(t){return this.error(t.message),null}}return r}return this.error(`Unknown expression "${r}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===t?"'undefined' value invalid. Use null instead.":"object"==typeof t?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,e,i){const r="number"==typeof t?this.path.concat(t):this.path,n=i?this.scope.concat(i):this.scope;return new Bi(this.registry,r,e||null,n,this.errors)}error(t,...e){const i=`${this.key}${e.map((t=>`[${t}]`)).join("")}`;this.errors.push(new oe(i,t))}checkSubtype(t,e){const i=xe(t,e);return i&&this.error(i),i}}var Ei=Bi;function Ci(t){if(t instanceof Ti)return Ci(t.boundExpression);if(t instanceof ti&&"error"===t.name)return!1;if(t instanceof ei)return!1;if(t instanceof yi)return!1;const e=t instanceof We||t instanceof Ge;let i=!0;return t.eachChild((t=>{i=e?i&&Ci(t):i&&t instanceof Qe})),!!i&&vi(t)&&bi(t,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function Si(t,e){const i=t.length-1;let r,n,o=0,s=i,a=0;for(;o<=s;)if(a=Math.floor((o+s)/2),r=t[a],n=t[a+1],r<=e){if(a===i||e<n)return a;o=a+1}else{if(!(r>e))throw new Ve("Input is not a number.");s=a-1}return 0}class Ii{constructor(t,e,i){this.type=t,this.input=e,this.labels=[],this.outputs=[];for(const[t,e]of i)this.labels.push(t),this.outputs.push(e)}static parse(t,e){if(t.length-1<4)return e.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return e.error("Expected an even number of arguments.");const i=e.parse(t[1],1,ce);if(!i)return null;const r=[];let n=null;e.expectedType&&"value"!==e.expectedType.kind&&(n=e.expectedType);for(let i=1;i<t.length;i+=2){const o=1===i?-1/0:t[i],s=t[i+1],a=i,l=i+1;if("number"!=typeof o)return e.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',a);if(r.length&&r[r.length-1][0]>=o)return e.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',a);const c=e.parse(s,l,n);if(!c)return null;n=n||c.type,r.push([o,c])}return new Ii(n,i,r)}evaluate(t){const e=this.labels,i=this.outputs;if(1===e.length)return i[0].evaluate(t);const r=this.input.evaluate(t);if(r<=e[0])return i[0].evaluate(t);const n=e.length;return r>=e[n-1]?i[n-1].evaluate(t):i[Si(e,r)].evaluate(t)}eachChild(t){t(this.input);for(const e of this.outputs)t(e)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))}serialize(){const t=["step",this.input.serialize()];for(let e=0;e<this.labels.length;e++)e>0&&t.push(this.labels[e]),t.push(this.outputs[e].serialize());return t}}var Mi=Ii;function ki(t,e,i){return t*(1-i)+e*i}var Pi=Object.freeze({__proto__:null,array:function(t,e,i){return t.map(((t,r)=>ki(t,e[r],i)))},color:function(t,e,i){return new ke(ki(t.r,e.r,i),ki(t.g,e.g,i),ki(t.b,e.b,i),ki(t.a,e.a,i))},number:ki});const Li=.95047,zi=1.08883,Fi=4/29,Di=6/29,Ri=3*Di*Di,Ui=Di*Di*Di,Oi=Math.PI/180,Ni=180/Math.PI;function Qi(t){return t>Ui?Math.pow(t,1/3):t/Ri+Fi}function Vi(t){return t>Di?t*t*t:Ri*(t-Fi)}function ji(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function Hi(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function Gi(t){const e=Hi(t.r),i=Hi(t.g),r=Hi(t.b),n=Qi((.4124564*e+.3575761*i+.1804375*r)/Li),o=Qi((.2126729*e+.7151522*i+.072175*r)/1);return{l:116*o-16,a:500*(n-o),b:200*(o-Qi((.0193339*e+.119192*i+.9503041*r)/zi)),alpha:t.a}}function $i(t){let e=(t.l+16)/116,i=isNaN(t.a)?e:e+t.a/500,r=isNaN(t.b)?e:e-t.b/200;return e=1*Vi(e),i=Li*Vi(i),r=zi*Vi(r),new ke(ji(3.2404542*i-1.5371385*e-.4985314*r),ji(-.969266*i+1.8760108*e+.041556*r),ji(.0556434*i-.2040259*e+1.0572252*r),t.alpha)}function Zi(t,e,i){const r=e-t;return t+i*(r>180||r<-180?r-360*Math.round(r/360):r)}const qi={forward:Gi,reverse:$i,interpolate:function(t,e,i){return{l:ki(t.l,e.l,i),a:ki(t.a,e.a,i),b:ki(t.b,e.b,i),alpha:ki(t.alpha,e.alpha,i)}}},Ki={forward:function(t){const{l:e,a:i,b:r}=Gi(t),n=Math.atan2(r,i)*Ni;return{h:n<0?n+360:n,c:Math.sqrt(i*i+r*r),l:e,alpha:t.a}},reverse:function(t){const e=t.h*Oi,i=t.c;return $i({l:t.l,a:Math.cos(e)*i,b:Math.sin(e)*i,alpha:t.alpha})},interpolate:function(t,e,i){return{h:Zi(t.h,e.h,i),c:ki(t.c,e.c,i),l:ki(t.l,e.l,i),alpha:ki(t.alpha,e.alpha,i)}}};var Wi=Object.freeze({__proto__:null,hcl:Ki,lab:qi});class Xi{constructor(t,e,i,r,n){this.type=t,this.operator=e,this.interpolation=i,this.input=r,this.labels=[],this.outputs=[];for(const[t,e]of n)this.labels.push(t),this.outputs.push(e)}static interpolationFactor(t,e,i,r){let n=0;if("exponential"===t.name)n=Ji(e,t.base,i,r);else if("linear"===t.name)n=Ji(e,1,i,r);else if("cubic-bezier"===t.name){const o=t.controlPoints;n=new A(o[0],o[1],o[2],o[3]).solve(Ji(e,1,i,r))}return n}static parse(t,e){let[i,r,n,...o]=t;if(!Array.isArray(r)||0===r.length)return e.error("Expected an interpolation type expression.",1);if("linear"===r[0])r={name:"linear"};else if("exponential"===r[0]){const t=r[1];if("number"!=typeof t)return e.error("Exponential interpolation requires a numeric base.",1,1);r={name:"exponential",base:t}}else{if("cubic-bezier"!==r[0])return e.error(`Unknown interpolation type ${String(r[0])}`,1,0);{const t=r.slice(1);if(4!==t.length||t.some((t=>"number"!=typeof t||t<0||t>1)))return e.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);r={name:"cubic-bezier",controlPoints:t}}}if(t.length-1<4)return e.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return e.error("Expected an even number of arguments.");if(n=e.parse(n,2,ce),!n)return null;const s=[];let a=null;"interpolate-hcl"===i||"interpolate-lab"===i?a=de:e.expectedType&&"value"!==e.expectedType.kind&&(a=e.expectedType);for(let t=0;t<o.length;t+=2){const i=o[t],r=o[t+1],n=t+3,l=t+4;if("number"!=typeof i)return e.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',n);if(s.length&&s[s.length-1][0]>=i)return e.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',n);const c=e.parse(r,l,a);if(!c)return null;a=a||c.type,s.push([i,c])}return"number"===a.kind||"color"===a.kind||"array"===a.kind&&"number"===a.itemType.kind&&"number"==typeof a.N?new Xi(a,i,r,n,s):e.error(`Type ${ye(a)} is not interpolatable.`)}evaluate(t){const e=this.labels,i=this.outputs;if(1===e.length)return i[0].evaluate(t);const r=this.input.evaluate(t);if(r<=e[0])return i[0].evaluate(t);const n=e.length;if(r>=e[n-1])return i[n-1].evaluate(t);const o=Si(e,r),s=Xi.interpolationFactor(this.interpolation,r,e[o],e[o+1]),a=i[o].evaluate(t),l=i[o+1].evaluate(t);return"interpolate"===this.operator?Pi[this.type.kind.toLowerCase()](a,l,s):"interpolate-hcl"===this.operator?Ki.reverse(Ki.interpolate(Ki.forward(a),Ki.forward(l),s)):qi.reverse(qi.interpolate(qi.forward(a),qi.forward(l),s))}eachChild(t){t(this.input);for(const e of this.outputs)t(e)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))}serialize(){let t;t="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const e=[this.operator,t,this.input.serialize()];for(let t=0;t<this.labels.length;t++)e.push(this.labels[t],this.outputs[t].serialize());return e}}function Ji(t,e,i,r){const n=r-i,o=t-i;return 0===n?0:1===e?o/n:(Math.pow(e,o)-1)/(Math.pow(e,n)-1)}var Yi=Xi;class tr{constructor(t,e){this.type=t,this.args=e}static parse(t,e){if(t.length<2)return e.error("Expectected at least one argument.");let i=null;const r=e.expectedType;r&&"value"!==r.kind&&(i=r);const n=[];for(const r of t.slice(1)){const t=e.parse(r,1+n.length,i,void 0,{typeAnnotation:"omit"});if(!t)return null;i=i||t.type,n.push(t)}const o=r&&n.some((t=>xe(r,t.type)));return new tr(o?fe:i,n)}evaluate(t){let e,i=null,r=0;for(const n of this.args){if(r++,i=n.evaluate(t),i&&i instanceof Fe&&!i.available&&(e||(e=i),i=null,r===this.args.length))return e;if(null!==i)break}return i}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}serialize(){const t=["coalesce"];return this.eachChild((e=>{t.push(e.serialize())})),t}}var er=tr;class ir{constructor(t,e){this.type=e.type,this.bindings=[].concat(t),this.result=e}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const e of this.bindings)t(e[1]);t(this.result)}static parse(t,e){if(t.length<4)return e.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const i=[];for(let r=1;r<t.length-1;r+=2){const n=t[r];if("string"!=typeof n)return e.error(`Expected string, but found ${typeof n} instead.`,r);if(/[^a-zA-Z0-9_]/.test(n))return e.error("Variable names must contain only alphanumeric characters or '_'.",r);const o=e.parse(t[r+1],r+1);if(!o)return null;i.push([n,o])}const r=e.parse(t[t.length-1],t.length-1,e.expectedType,i);return r?new ir(i,r):null}outputDefined(){return this.result.outputDefined()}serialize(){const t=["let"];for(const[e,i]of this.bindings)t.push(e,i.serialize());return t.push(this.result.serialize()),t}}var rr=ir;class nr{constructor(t,e,i){this.type=t,this.index=e,this.input=i}static parse(t,e){if(3!==t.length)return e.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const i=e.parse(t[1],1,ce),r=e.parse(t[2],2,_e(e.expectedType||fe));return i&&r?new nr(r.type.itemType,i,r):null}evaluate(t){const e=this.index.evaluate(t),i=this.input.evaluate(t);if(e<0)throw new Ve(`Array index out of bounds: ${e} < 0.`);if(e>=i.length)throw new Ve(`Array index out of bounds: ${e} > ${i.length-1}.`);if(e!==Math.floor(e))throw new Ve(`Array index must be an integer, but found ${e} instead.`);return i[e]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var or=nr;class sr{constructor(t,e){this.type=he,this.needle=t,this.haystack=e}static parse(t,e){if(3!==t.length)return e.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const i=e.parse(t[1],1,fe),r=e.parse(t[2],2,fe);return i&&r?be(i.type,[he,ue,ce,le,fe])?new sr(i,r):e.error(`Expected first argument to be of type boolean, string, number or null, but found ${ye(i.type)} instead`):null}evaluate(t){const e=this.needle.evaluate(t),i=this.haystack.evaluate(t);if(null==i)return!1;if(!we(e,["boolean","string","number","null"]))throw new Ve(`Expected first argument to be of type boolean, string, number or null, but found ${ye(Ue(e))} instead.`);if(!we(i,["string","array"]))throw new Ve(`Expected second argument to be of type array or string, but found ${ye(Ue(i))} instead.`);return i.indexOf(e)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var ar=sr;class lr{constructor(t,e,i){this.type=ce,this.needle=t,this.haystack=e,this.fromIndex=i}static parse(t,e){if(t.length<=2||t.length>=5)return e.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const i=e.parse(t[1],1,fe),r=e.parse(t[2],2,fe);if(!i||!r)return null;if(!be(i.type,[he,ue,ce,le,fe]))return e.error(`Expected first argument to be of type boolean, string, number or null, but found ${ye(i.type)} instead`);if(4===t.length){const n=e.parse(t[3],3,ce);return n?new lr(i,r,n):null}return new lr(i,r)}evaluate(t){const e=this.needle.evaluate(t),i=this.haystack.evaluate(t);if(!we(e,["boolean","string","number","null"]))throw new Ve(`Expected first argument to be of type boolean, string, number or null, but found ${ye(Ue(e))} instead.`);if(!we(i,["string","array"]))throw new Ve(`Expected second argument to be of type array or string, but found ${ye(Ue(i))} instead.`);if(this.fromIndex){const r=this.fromIndex.evaluate(t);return i.indexOf(e,r)}return i.indexOf(e)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const t=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),t]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var cr=lr;class ur{constructor(t,e,i,r,n,o){this.inputType=t,this.type=e,this.input=i,this.cases=r,this.outputs=n,this.otherwise=o}static parse(t,e){if(t.length<5)return e.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return e.error("Expected an even number of arguments.");let i,r;e.expectedType&&"value"!==e.expectedType.kind&&(r=e.expectedType);const n={},o=[];for(let s=2;s<t.length-1;s+=2){let a=t[s];const l=t[s+1];Array.isArray(a)||(a=[a]);const c=e.concat(s);if(0===a.length)return c.error("Expected at least one branch label.");for(const t of a){if("number"!=typeof t&&"string"!=typeof t)return c.error("Branch labels must be numbers or strings.");if("number"==typeof t&&Math.abs(t)>Number.MAX_SAFE_INTEGER)return c.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof t&&Math.floor(t)!==t)return c.error("Numeric branch labels must be integer values.");if(i){if(c.checkSubtype(i,Ue(t)))return null}else i=Ue(t);if(void 0!==n[String(t)])return c.error("Branch labels must be unique.");n[String(t)]=o.length}const u=e.parse(l,s,r);if(!u)return null;r=r||u.type,o.push(u)}const s=e.parse(t[1],1,fe);if(!s)return null;const a=e.parse(t[t.length-1],t.length-1,r);return a?"value"!==s.type.kind&&e.concat(1).checkSubtype(i,s.type)?null:new ur(i,r,s,n,o,a):null}evaluate(t){const e=this.input.evaluate(t);return(Ue(e)===this.inputType&&this.outputs[this.cases[e]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const t=["match",this.input.serialize()],e=Object.keys(this.cases).sort(),i=[],r={};for(const t of e){const e=r[this.cases[t]];void 0===e?(r[this.cases[t]]=i.length,i.push([this.cases[t],[t]])):i[e][1].push(t)}const n=t=>"number"===this.inputType.kind?Number(t):t;for(const[e,r]of i)t.push(1===r.length?n(r[0]):r.map(n)),t.push(this.outputs[e].serialize());return t.push(this.otherwise.serialize()),t}}var hr=ur;class dr{constructor(t,e,i){this.type=t,this.branches=e,this.otherwise=i}static parse(t,e){if(t.length<4)return e.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return e.error("Expected an odd number of arguments.");let i;e.expectedType&&"value"!==e.expectedType.kind&&(i=e.expectedType);const r=[];for(let n=1;n<t.length-1;n+=2){const o=e.parse(t[n],n,he);if(!o)return null;const s=e.parse(t[n+1],n+1,i);if(!s)return null;r.push([o,s]),i=i||s.type}const n=e.parse(t[t.length-1],t.length-1,i);return n?new dr(i,r,n):null}evaluate(t){for(const[e,i]of this.branches)if(e.evaluate(t))return i.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[e,i]of this.branches)t(e),t(i);t(this.otherwise)}outputDefined(){return this.branches.every((([t,e])=>e.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const t=["case"];return this.eachChild((e=>{t.push(e.serialize())})),t}}var pr=dr;class fr{constructor(t,e,i,r){this.type=t,this.input=e,this.beginIndex=i,this.endIndex=r}static parse(t,e){if(t.length<=2||t.length>=5)return e.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const i=e.parse(t[1],1,fe),r=e.parse(t[2],2,ce);if(!i||!r)return null;if(!be(i.type,[_e(fe),ue,fe]))return e.error(`Expected first argument to be of type array or string, but found ${ye(i.type)} instead`);if(4===t.length){const n=e.parse(t[3],3,ce);return n?new fr(i.type,i,r,n):null}return new fr(i.type,i,r)}evaluate(t){const e=this.input.evaluate(t),i=this.beginIndex.evaluate(t);if(!we(e,["string","array"]))throw new Ve(`Expected first argument to be of type array or string, but found ${ye(Ue(e))} instead.`);if(this.endIndex){const r=this.endIndex.evaluate(t);return e.slice(i,r)}return e.slice(i)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const t=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),t]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var Ar=fr;function mr(t,e){return"=="===t||"!="===t?"boolean"===e.kind||"string"===e.kind||"number"===e.kind||"null"===e.kind||"value"===e.kind:"string"===e.kind||"number"===e.kind||"value"===e.kind}function gr(t,e,i,r){return 0===r.compare(e,i)}function _r(t,e,i){const r="=="!==t&&"!="!==t;return class n{constructor(t,e,i){this.type=he,this.lhs=t,this.rhs=e,this.collator=i,this.hasUntypedArgument="value"===t.type.kind||"value"===e.type.kind}static parse(t,e){if(3!==t.length&&4!==t.length)return e.error("Expected two or three arguments.");const i=t[0];let o=e.parse(t[1],1,fe);if(!o)return null;if(!mr(i,o.type))return e.concat(1).error(`"${i}" comparisons are not supported for type '${ye(o.type)}'.`);let s=e.parse(t[2],2,fe);if(!s)return null;if(!mr(i,s.type))return e.concat(2).error(`"${i}" comparisons are not supported for type '${ye(s.type)}'.`);if(o.type.kind!==s.type.kind&&"value"!==o.type.kind&&"value"!==s.type.kind)return e.error(`Cannot compare types '${ye(o.type)}' and '${ye(s.type)}'.`);r&&("value"===o.type.kind&&"value"!==s.type.kind?o=new Ge(s.type,[o]):"value"!==o.type.kind&&"value"===s.type.kind&&(s=new Ge(o.type,[s])));let a=null;if(4===t.length){if("string"!==o.type.kind&&"string"!==s.type.kind&&"value"!==o.type.kind&&"value"!==s.type.kind)return e.error("Cannot use collator to compare non-string types.");if(a=e.parse(t[3],3,Ae),!a)return null}return new n(o,s,a)}evaluate(n){const o=this.lhs.evaluate(n),s=this.rhs.evaluate(n);if(r&&this.hasUntypedArgument){const e=Ue(o),i=Ue(s);if(e.kind!==i.kind||"string"!==e.kind&&"number"!==e.kind)throw new Ve(`Expected arguments for "${t}" to be (string, string) or (number, number), but found (${e.kind}, ${i.kind}) instead.`)}if(this.collator&&!r&&this.hasUntypedArgument){const t=Ue(o),i=Ue(s);if("string"!==t.kind||"string"!==i.kind)return e(n,o,s)}return this.collator?i(n,o,s,this.collator.evaluate(n)):e(n,o,s)}eachChild(t){t(this.lhs),t(this.rhs),this.collator&&t(this.collator)}outputDefined(){return!0}serialize(){const e=[t];return this.eachChild((t=>{e.push(t.serialize())})),e}}}const yr=_r("==",(function(t,e,i){return e===i}),gr),vr=_r("!=",(function(t,e,i){return e!==i}),(function(t,e,i,r){return!gr(0,e,i,r)})),xr=_r("<",(function(t,e,i){return e<i}),(function(t,e,i,r){return r.compare(e,i)<0})),br=_r(">",(function(t,e,i){return e>i}),(function(t,e,i,r){return r.compare(e,i)>0})),wr=_r("<=",(function(t,e,i){return e<=i}),(function(t,e,i,r){return r.compare(e,i)<=0})),Tr=_r(">=",(function(t,e,i){return e>=i}),(function(t,e,i,r){return r.compare(e,i)>=0}));class Br{constructor(t,e,i,r,n,o){this.type=ue,this.number=t,this.locale=e,this.currency=i,this.unit=r,this.minFractionDigits=n,this.maxFractionDigits=o}static parse(t,e){if(3!==t.length)return e.error("Expected two arguments.");const i=e.parse(t[1],1,ce);if(!i)return null;const r=t[2];if("object"!=typeof r||Array.isArray(r))return e.error("NumberFormat options argument must be an object.");let n=null;if(r.locale&&(n=e.parse(r.locale,1,ue),!n))return null;let o=null;if(r.currency&&(o=e.parse(r.currency,1,ue),!o))return null;let s=null;if(r.unit&&(s=e.parse(r.unit,1,ue),!s))return null;let a=null;if(r["min-fraction-digits"]&&(a=e.parse(r["min-fraction-digits"],1,ce),!a))return null;let l=null;return r["max-fraction-digits"]&&(l=e.parse(r["max-fraction-digits"],1,ce),!l)?null:new Br(i,n,o,s,a,l)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(t):void 0,unit:this.unit?this.unit.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.unit&&t(this.unit),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.unit&&(t.unit=this.unit.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]}}class Er{constructor(t){this.type=ce,this.input=t}static parse(t,e){if(2!==t.length)return e.error(`Expected 1 argument, but found ${t.length-1} instead.`);const i=e.parse(t[1],1);return i?"array"!==i.type.kind&&"string"!==i.type.kind&&"value"!==i.type.kind?e.error(`Expected argument of type string or array, but found ${ye(i.type)} instead.`):new Er(i):null}evaluate(t){const e=this.input.evaluate(t);if("string"==typeof e)return e.length;if(Array.isArray(e))return e.length;throw new Ve(`Expected value to be of type string or array, but found ${ye(Ue(e))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}serialize(){const t=["length"];return this.eachChild((e=>{t.push(e.serialize())})),t}}const Cr={"==":yr,"!=":vr,">":br,"<":xr,">=":Tr,"<=":wr,array:Ge,at:or,boolean:Ge,case:pr,coalesce:er,collator:ei,format:$e,image:Ze,in:ar,"index-of":cr,interpolate:Yi,"interpolate-hcl":Yi,"interpolate-lab":Yi,length:Er,let:rr,literal:Qe,match:hr,number:Ge,"number-format":Br,object:Ge,slice:Ar,step:Mi,string:Ge,"to-boolean":We,"to-color":We,"to-number":We,"to-string":We,var:Ti,within:yi};function Sr(t,[e,i,r,n]){e=e.evaluate(t),i=i.evaluate(t),r=r.evaluate(t);const o=n?n.evaluate(t):1,s=De(e,i,r,o);if(s)throw new Ve(s);return new ke(e/255*o,i/255*o,r/255*o,o)}function Ir(t,e){return t in e}function Mr(t,e){const i=e[t];return void 0===i?null:i}function kr(t){return{type:t}}ti.register(Cr,{error:[{kind:"error"},[ue],(t,[e])=>{throw new Ve(e.evaluate(t))}],typeof:[ue,[fe],(t,[e])=>ye(Ue(e.evaluate(t)))],"to-rgba":[_e(ce,4),[de],(t,[e])=>e.evaluate(t).toArray()],rgb:[de,[ce,ce,ce],Sr],rgba:[de,[ce,ce,ce,ce],Sr],has:{type:he,overloads:[[[ue],(t,[e])=>Ir(e.evaluate(t),t.properties())],[[ue,pe],(t,[e,i])=>Ir(e.evaluate(t),i.evaluate(t))]]},get:{type:fe,overloads:[[[ue],(t,[e])=>Mr(e.evaluate(t),t.properties())],[[ue,pe],(t,[e,i])=>Mr(e.evaluate(t),i.evaluate(t))]]},"feature-state":[fe,[ue],(t,[e])=>Mr(e.evaluate(t),t.featureState||{})],properties:[pe,[],t=>t.properties()],"geometry-type":[ue,[],t=>t.geometryType()],id:[fe,[],t=>t.id()],zoom:[ce,[],t=>t.globals.zoom],pitch:[ce,[],t=>t.globals.pitch||0],"distance-from-center":[ce,[],t=>t.distanceFromCenter()],"heatmap-density":[ce,[],t=>t.globals.heatmapDensity||0],"line-progress":[ce,[],t=>t.globals.lineProgress||0],"sky-radial-progress":[ce,[],t=>t.globals.skyRadialProgress||0],accumulated:[fe,[],t=>void 0===t.globals.accumulated?null:t.globals.accumulated],"+":[ce,kr(ce),(t,e)=>{let i=0;for(const r of e)i+=r.evaluate(t);return i}],"*":[ce,kr(ce),(t,e)=>{let i=1;for(const r of e)i*=r.evaluate(t);return i}],"-":{type:ce,overloads:[[[ce,ce],(t,[e,i])=>e.evaluate(t)-i.evaluate(t)],[[ce],(t,[e])=>-e.evaluate(t)]]},"/":[ce,[ce,ce],(t,[e,i])=>e.evaluate(t)/i.evaluate(t)],"%":[ce,[ce,ce],(t,[e,i])=>e.evaluate(t)%i.evaluate(t)],ln2:[ce,[],()=>Math.LN2],pi:[ce,[],()=>Math.PI],e:[ce,[],()=>Math.E],"^":[ce,[ce,ce],(t,[e,i])=>Math.pow(e.evaluate(t),i.evaluate(t))],sqrt:[ce,[ce],(t,[e])=>Math.sqrt(e.evaluate(t))],log10:[ce,[ce],(t,[e])=>Math.log(e.evaluate(t))/Math.LN10],ln:[ce,[ce],(t,[e])=>Math.log(e.evaluate(t))],log2:[ce,[ce],(t,[e])=>Math.log(e.evaluate(t))/Math.LN2],sin:[ce,[ce],(t,[e])=>Math.sin(e.evaluate(t))],cos:[ce,[ce],(t,[e])=>Math.cos(e.evaluate(t))],tan:[ce,[ce],(t,[e])=>Math.tan(e.evaluate(t))],asin:[ce,[ce],(t,[e])=>Math.asin(e.evaluate(t))],acos:[ce,[ce],(t,[e])=>Math.acos(e.evaluate(t))],atan:[ce,[ce],(t,[e])=>Math.atan(e.evaluate(t))],min:[ce,kr(ce),(t,e)=>Math.min(...e.map((e=>e.evaluate(t))))],max:[ce,kr(ce),(t,e)=>Math.max(...e.map((e=>e.evaluate(t))))],abs:[ce,[ce],(t,[e])=>Math.abs(e.evaluate(t))],round:[ce,[ce],(t,[e])=>{const i=e.evaluate(t);return i<0?-Math.round(-i):Math.round(i)}],floor:[ce,[ce],(t,[e])=>Math.floor(e.evaluate(t))],ceil:[ce,[ce],(t,[e])=>Math.ceil(e.evaluate(t))],"filter-==":[he,[ue,fe],(t,[e,i])=>t.properties()[e.value]===i.value],"filter-id-==":[he,[fe],(t,[e])=>t.id()===e.value],"filter-type-==":[he,[ue],(t,[e])=>t.geometryType()===e.value],"filter-<":[he,[ue,fe],(t,[e,i])=>{const r=t.properties()[e.value],n=i.value;return typeof r==typeof n&&r<n}],"filter-id-<":[he,[fe],(t,[e])=>{const i=t.id(),r=e.value;return typeof i==typeof r&&i<r}],"filter->":[he,[ue,fe],(t,[e,i])=>{const r=t.properties()[e.value],n=i.value;return typeof r==typeof n&&r>n}],"filter-id->":[he,[fe],(t,[e])=>{const i=t.id(),r=e.value;return typeof i==typeof r&&i>r}],"filter-<=":[he,[ue,fe],(t,[e,i])=>{const r=t.properties()[e.value],n=i.value;return typeof r==typeof n&&r<=n}],"filter-id-<=":[he,[fe],(t,[e])=>{const i=t.id(),r=e.value;return typeof i==typeof r&&i<=r}],"filter->=":[he,[ue,fe],(t,[e,i])=>{const r=t.properties()[e.value],n=i.value;return typeof r==typeof n&&r>=n}],"filter-id->=":[he,[fe],(t,[e])=>{const i=t.id(),r=e.value;return typeof i==typeof r&&i>=r}],"filter-has":[he,[fe],(t,[e])=>e.value in t.properties()],"filter-has-id":[he,[],t=>null!==t.id()&&void 0!==t.id()],"filter-type-in":[he,[_e(ue)],(t,[e])=>e.value.indexOf(t.geometryType())>=0],"filter-id-in":[he,[_e(fe)],(t,[e])=>e.value.indexOf(t.id())>=0],"filter-in-small":[he,[ue,_e(fe)],(t,[e,i])=>i.value.indexOf(t.properties()[e.value])>=0],"filter-in-large":[he,[ue,_e(fe)],(t,[e,i])=>function(t,e,i,r){for(;i<=r;){const n=i+r>>1;if(e[n]===t)return!0;e[n]>t?r=n-1:i=n+1}return!1}(t.properties()[e.value],i.value,0,i.value.length-1)],all:{type:he,overloads:[[[he,he],(t,[e,i])=>e.evaluate(t)&&i.evaluate(t)],[kr(he),(t,e)=>{for(const i of e)if(!i.evaluate(t))return!1;return!0}]]},any:{type:he,overloads:[[[he,he],(t,[e,i])=>e.evaluate(t)||i.evaluate(t)],[kr(he),(t,e)=>{for(const i of e)if(i.evaluate(t))return!0;return!1}]]},"!":[he,[he],(t,[e])=>!e.evaluate(t)],"is-supported-script":[he,[ue],(t,[e])=>{const i=t.globals&&t.globals.isSupportedScript;return!i||i(e.evaluate(t))}],upcase:[ue,[ue],(t,[e])=>e.evaluate(t).toUpperCase()],downcase:[ue,[ue],(t,[e])=>e.evaluate(t).toLowerCase()],concat:[ue,kr(fe),(t,e)=>e.map((e=>Oe(e.evaluate(t)))).join("")],"resolved-locale":[ue,[Ae],(t,[e])=>e.evaluate(t).resolvedLocale()]});var Pr=Cr;function Lr(t){return{result:"success",value:t}}function zr(t){return{result:"error",value:t}}function Fr(t){return"data-driven"===t["property-type"]}function Dr(t){return!!t.expression&&t.expression.parameters.indexOf("zoom")>-1}function Rr(t){return!!t.expression&&t.expression.interpolated}function Ur(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":null===t?"null":typeof t}function Or(t){return"object"==typeof t&&null!==t&&!Array.isArray(t)}function Nr(t){return t}function Qr(t,e){const i="color"===e.type,r=t.stops&&"object"==typeof t.stops[0][0],n=r||!(r||void 0!==t.property),o=t.type||(Rr(e)?"exponential":"interval");if(i&&((t=ee({},t)).stops&&(t.stops=t.stops.map((t=>[t[0],ke.parse(t[1])]))),t.default=ke.parse(t.default?t.default:e.default)),t.colorSpace&&"rgb"!==t.colorSpace&&!Wi[t.colorSpace])throw new Error(`Unknown color space: ${t.colorSpace}`);let s,a,l;if("exponential"===o)s=Gr;else if("interval"===o)s=Hr;else if("categorical"===o){s=jr,a=Object.create(null);for(const e of t.stops)a[e[0]]=e[1];l=typeof t.stops[0][0]}else{if("identity"!==o)throw new Error(`Unknown function type "${o}"`);s=$r}if(r){const i={},r=[];for(let e=0;e<t.stops.length;e++){const n=t.stops[e],o=n[0].zoom;void 0===i[o]&&(i[o]={zoom:o,type:t.type,property:t.property,default:t.default,stops:[]},r.push(o)),i[o].stops.push([n[0].value,n[1]])}const n=[];for(const t of r)n.push([i[t].zoom,Qr(i[t],e)]);const o={name:"linear"};return{kind:"composite",interpolationType:o,interpolationFactor:Yi.interpolationFactor.bind(void 0,o),zoomStops:n.map((t=>t[0])),evaluate:({zoom:i},r)=>Gr({stops:n,base:t.base},e,i).evaluate(i,r)}}if(n){const i="exponential"===o?{name:"exponential",base:void 0!==t.base?t.base:1}:null;return{kind:"camera",interpolationType:i,interpolationFactor:Yi.interpolationFactor.bind(void 0,i),zoomStops:t.stops.map((t=>t[0])),evaluate:({zoom:i})=>s(t,e,i,a,l)}}return{kind:"source",evaluate(i,r){const n=r&&r.properties?r.properties[t.property]:void 0;return void 0===n?Vr(t.default,e.default):s(t,e,n,a,l)}}}function Vr(t,e,i){return void 0!==t?t:void 0!==e?e:void 0!==i?i:void 0}function jr(t,e,i,r,n){return Vr(typeof i===n?r[i]:void 0,t.default,e.default)}function Hr(t,e,i){if("number"!==Ur(i))return Vr(t.default,e.default);const r=t.stops.length;if(1===r)return t.stops[0][1];if(i<=t.stops[0][0])return t.stops[0][1];if(i>=t.stops[r-1][0])return t.stops[r-1][1];const n=Si(t.stops.map((t=>t[0])),i);return t.stops[n][1]}function Gr(t,e,i){const r=void 0!==t.base?t.base:1;if("number"!==Ur(i))return Vr(t.default,e.default);const n=t.stops.length;if(1===n)return t.stops[0][1];if(i<=t.stops[0][0])return t.stops[0][1];if(i>=t.stops[n-1][0])return t.stops[n-1][1];const o=Si(t.stops.map((t=>t[0])),i),s=function(t,e,i,r){const n=r-i,o=t-i;return 0===n?0:1===e?o/n:(Math.pow(e,o)-1)/(Math.pow(e,n)-1)}(i,r,t.stops[o][0],t.stops[o+1][0]),a=t.stops[o][1],l=t.stops[o+1][1];let c=Pi[e.type]||Nr;if(t.colorSpace&&"rgb"!==t.colorSpace){const e=Wi[t.colorSpace];c=(t,i)=>e.reverse(e.interpolate(e.forward(t),e.forward(i),s))}return"function"==typeof a.evaluate?{evaluate(...t){const e=a.evaluate.apply(void 0,t),i=l.evaluate.apply(void 0,t);if(void 0!==e&&void 0!==i)return c(e,i,s)}}:c(a,l,s)}function $r(t,e,i){return"color"===e.type?i=ke.parse(i):"formatted"===e.type?i=ze.fromString(i.toString()):"resolvedImage"===e.type?i=Fe.fromString(i.toString()):Ur(i)===e.type||"enum"===e.type&&e.values[i]||(i=void 0),Vr(i,t.default,e.default)}class Zr{constructor(t,e){this.expression=t,this._warningHistory={},this._evaluator=new Je,this._defaultValue=e?function(t){return"color"===t.type&&(Or(t.default)||Array.isArray(t.default))?new ke(0,0,0,0):"color"===t.type?ke.parse(t.default)||null:void 0===t.default?null:t.default}(e):null,this._enumValues=e&&"enum"===e.type?e.values:null}evaluateWithoutErrorHandling(t,e,i,r,n,o,s,a){return this._evaluator.globals=t,this._evaluator.feature=e,this._evaluator.featureState=i,this._evaluator.canonical=r||null,this._evaluator.availableImages=n||null,this._evaluator.formattedSection=o,this._evaluator.featureTileCoord=s||null,this._evaluator.featureDistanceData=a||null,this.expression.evaluate(this._evaluator)}evaluate(t,e,i,r,n,o,s,a){this._evaluator.globals=t,this._evaluator.feature=e||null,this._evaluator.featureState=i||null,this._evaluator.canonical=r||null,this._evaluator.availableImages=n||null,this._evaluator.formattedSection=o||null,this._evaluator.featureTileCoord=s||null,this._evaluator.featureDistanceData=a||null;try{const t=this.expression.evaluate(this._evaluator);if(null==t||"number"==typeof t&&t!=t)return this._defaultValue;if(this._enumValues&&!(t in this._enumValues))throw new Ve(`Expected value to be one of ${Object.keys(this._enumValues).map((t=>JSON.stringify(t))).join(", ")}, but found ${JSON.stringify(t)} instead.`);return t}catch(t){return this._warningHistory[t.message]||(this._warningHistory[t.message]=!0,"undefined"!=typeof console&&console.warn(t.message)),this._defaultValue}}}function qr(t){return Array.isArray(t)&&t.length>0&&"string"==typeof t[0]&&t[0]in Pr}function Kr(t,e){const i=new Ei(Pr,[],e?function(t){const e={color:de,string:ue,number:ce,enum:ue,boolean:he,formatted:me,resolvedImage:ge};return"array"===t.type?_e(e[t.value]||fe,t.length):e[t.type]}(e):void 0),r=i.parse(t,void 0,void 0,void 0,e&&"string"===e.type?{typeAnnotation:"coerce"}:void 0);return r?Lr(new Zr(r,e)):zr(i.errors)}class Wr{constructor(t,e){this.kind=t,this._styleExpression=e,this.isStateDependent="constant"!==t&&!xi(e.expression)}evaluateWithoutErrorHandling(t,e,i,r,n,o){return this._styleExpression.evaluateWithoutErrorHandling(t,e,i,r,n,o)}evaluate(t,e,i,r,n,o){return this._styleExpression.evaluate(t,e,i,r,n,o)}}class Xr{constructor(t,e,i,r){this.kind=t,this.zoomStops=i,this._styleExpression=e,this.isStateDependent="camera"!==t&&!xi(e.expression),this.interpolationType=r}evaluateWithoutErrorHandling(t,e,i,r,n,o){return this._styleExpression.evaluateWithoutErrorHandling(t,e,i,r,n,o)}evaluate(t,e,i,r,n,o){return this._styleExpression.evaluate(t,e,i,r,n,o)}interpolationFactor(t,e,i){return this.interpolationType?Yi.interpolationFactor(this.interpolationType,t,e,i):0}}function Jr(t,e){if("error"===(t=Kr(t,e)).result)return t;const i=t.value.expression,r=vi(i);if(!r&&!Fr(e))return zr([new oe("","data expressions not supported")]);const n=bi(i,["zoom","pitch","distance-from-center"]);if(!n&&!Dr(e))return zr([new oe("","zoom expressions not supported")]);const o=tn(i);return o||n?o instanceof oe?zr([o]):o instanceof Yi&&!Rr(e)?zr([new oe("",'"interpolate" expressions cannot be used with this property')]):Lr(o?new Xr(r?"camera":"composite",t.value,o.labels,o instanceof Yi?o.interpolation:void 0):new Wr(r?"constant":"source",t.value)):zr([new oe("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Yr{constructor(t,e){this._parameters=t,this._specification=e,ee(this,Qr(this._parameters,this._specification))}static deserialize(t){return new Yr(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function tn(t){let e=null;if(t instanceof rr)e=tn(t.result);else if(t instanceof er){for(const i of t.args)if(e=tn(i),e)break}else(t instanceof Mi||t instanceof Yi)&&t.input instanceof ti&&"zoom"===t.input.name&&(e=t);return e instanceof oe||t.eachChild((t=>{const i=tn(t);i instanceof oe?e=i:!e&&i?e=new oe("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&i&&e!==i&&(e=new oe("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),e}class en{constructor(t,e,i,r){this.message=(t?`${t}: `:"")+i,r&&(this.identifier=r),null!=e&&e.__line__&&(this.line=e.__line__)}}function rn(t){const e=t.key,i=t.value,r=t.valueSpec||{},n=t.objectElementValidators||{},o=t.style,s=t.styleSpec;let a=[];const l=Ur(i);if("object"!==l)return[new en(e,i,`object expected, ${l} found`)];for(const t in i){const l=t.split(".")[0];let c;n[l]?c=n[l]:r[l]?c=Rn:n["*"]?c=n["*"]:r["*"]&&(c=Rn),c?a=a.concat(c({key:(e?`${e}.`:e)+t,value:i[t],valueSpec:r[l]||r["*"],style:o,styleSpec:s,object:i,objectKey:t},i)):a.push(new en(e,i[t],`unknown property "${t}"`))}for(const t in r)n[t]||r[t].required&&void 0===r[t].default&&void 0===i[t]&&a.push(new en(e,i,`missing required property "${t}"`));return a}function nn(t){const e=t.value,i=t.valueSpec,r=t.style,n=t.styleSpec,o=t.key,s=t.arrayElementValidator||Rn;if("array"!==Ur(e))return[new en(o,e,`array expected, ${Ur(e)} found`)];if(i.length&&e.length!==i.length)return[new en(o,e,`array length ${i.length} expected, length ${e.length} found`)];if(i["min-length"]&&e.length<i["min-length"])return[new en(o,e,`array length at least ${i["min-length"]} expected, length ${e.length} found`)];let a={type:i.value,values:i.values,minimum:i.minimum,maximum:i.maximum,function:void 0};n.$version<7&&(a.function=i.function),"object"===Ur(i.value)&&(a=i.value);let l=[];for(let t=0;t<e.length;t++)l=l.concat(s({array:e,arrayIndex:t,value:e[t],valueSpec:a,style:r,styleSpec:n,key:`${o}[${t}]`}));return l}function on(t){const e=t.key,i=t.value,r=t.valueSpec;let n=Ur(i);if("number"===n&&i!=i&&(n="NaN"),"number"!==n)return[new en(e,i,`number expected, ${n} found`)];if("minimum"in r){let n=r.minimum;if("array"===Ur(r.minimum)&&(n=r.minimum[t.arrayIndex]),i<n)return[new en(e,i,`${i} is less than the minimum value ${n}`)]}if("maximum"in r){let n=r.maximum;if("array"===Ur(r.maximum)&&(n=r.maximum[t.arrayIndex]),i>n)return[new en(e,i,`${i} is greater than the maximum value ${n}`)]}return[]}function sn(t){const e=t.valueSpec,i=ie(t.value.type);let r,n,o,s={};const a="categorical"!==i&&void 0===t.value.property,l=!a,c="array"===Ur(t.value.stops)&&"array"===Ur(t.value.stops[0])&&"object"===Ur(t.value.stops[0][0]),u=rn({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(t){if("identity"===i)return[new en(t.key,t.value,'identity function may not have a "stops" property')];let e=[];const r=t.value;return e=e.concat(nn({key:t.key,value:r,valueSpec:t.valueSpec,style:t.style,styleSpec:t.styleSpec,arrayElementValidator:h})),"array"===Ur(r)&&0===r.length&&e.push(new en(t.key,r,"array must have at least one stop")),e},default:function(t){return Rn({key:t.key,value:t.value,valueSpec:e,style:t.style,styleSpec:t.styleSpec})}}});return"identity"===i&&a&&u.push(new en(t.key,t.value,'missing required property "property"')),"identity"===i||t.value.stops||u.push(new en(t.key,t.value,'missing required property "stops"')),"exponential"===i&&t.valueSpec.expression&&!Rr(t.valueSpec)&&u.push(new en(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(l&&!Fr(t.valueSpec)?u.push(new en(t.key,t.value,"property functions not supported")):a&&!Dr(t.valueSpec)&&u.push(new en(t.key,t.value,"zoom functions not supported"))),"categorical"!==i&&!c||void 0!==t.value.property||u.push(new en(t.key,t.value,'"property" property is required')),u;function h(t){let i=[];const r=t.value,a=t.key;if("array"!==Ur(r))return[new en(a,r,`array expected, ${Ur(r)} found`)];if(2!==r.length)return[new en(a,r,`array length 2 expected, length ${r.length} found`)];if(c){if("object"!==Ur(r[0]))return[new en(a,r,`object expected, ${Ur(r[0])} found`)];if(void 0===r[0].zoom)return[new en(a,r,"object stop key must have zoom")];if(void 0===r[0].value)return[new en(a,r,"object stop key must have value")];const e=ie(r[0].zoom);if("number"!=typeof e)return[new en(a,r[0].zoom,"stop zoom values must be numbers")];if(o&&o>e)return[new en(a,r[0].zoom,"stop zoom values must appear in ascending order")];e!==o&&(o=e,n=void 0,s={}),i=i.concat(rn({key:`${a}[0]`,value:r[0],valueSpec:{zoom:{}},style:t.style,styleSpec:t.styleSpec,objectElementValidators:{zoom:on,value:d}}))}else i=i.concat(d({key:`${a}[0]`,value:r[0],valueSpec:{},style:t.style,styleSpec:t.styleSpec},r));return qr(re(r[1]))?i.concat([new en(`${a}[1]`,r[1],"expressions are not allowed in function stops.")]):i.concat(Rn({key:`${a}[1]`,value:r[1],valueSpec:e,style:t.style,styleSpec:t.styleSpec}))}function d(t,o){const a=Ur(t.value),l=ie(t.value),c=null!==t.value?t.value:o;if(r){if(a!==r)return[new en(t.key,c,`${a} stop domain type must match previous stop domain type ${r}`)]}else r=a;if("number"!==a&&"string"!==a&&"boolean"!==a&&"number"!=typeof l&&"string"!=typeof l&&"boolean"!=typeof l)return[new en(t.key,c,"stop domain value must be a number, string, or boolean")];if("number"!==a&&"categorical"!==i){let r=`number expected, ${a} found`;return Fr(e)&&void 0===i&&(r+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new en(t.key,c,r)]}return"categorical"!==i||"number"!==a||"number"==typeof l&&isFinite(l)&&Math.floor(l)===l?"categorical"!==i&&"number"===a&&"number"==typeof l&&"number"==typeof n&&void 0!==n&&l<n?[new en(t.key,c,"stop domain values must appear in ascending order")]:(n=l,"categorical"===i&&l in s?[new en(t.key,c,"stop domain values must be unique")]:(s[l]=!0,[])):[new en(t.key,c,`integer expected, found ${String(l)}`)]}}function an(t){const e=("property"===t.expressionContext?Jr:Kr)(re(t.value),t.valueSpec);if("error"===e.result)return e.value.map((e=>new en(`${t.key}${e.key}`,t.value,e.message)));const i=e.value.expression||e.value._styleExpression.expression;if("property"===t.expressionContext&&"text-font"===t.propertyKey&&!i.outputDefined())return[new en(t.key,t.value,`Invalid data expression for "${t.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===t.expressionContext&&"layout"===t.propertyType&&!xi(i))return[new en(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===t.expressionContext)return ln(i,t);if(t.expressionContext&&0===t.expressionContext.indexOf("cluster")){if(!bi(i,["zoom","feature-state"]))return[new en(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===t.expressionContext&&!vi(i))return[new en(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function ln(t,e){const i=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(e.valueSpec&&e.valueSpec.expression)for(const t of e.valueSpec.expression.parameters)i.delete(t);if(0===i.size)return[];const r=[];return t instanceof ti&&i.has(t.name)?[new en(e.key,e.value,`["${t.name}"] expression is not supported in a filter for a ${e.object.type} layer with id: ${e.object.id}`)]:(t.eachChild((t=>{r.push(...ln(t,e))})),r)}function cn(t){const e=t.key,i=t.value,r=t.valueSpec,n=[];return Array.isArray(r.values)?-1===r.values.indexOf(ie(i))&&n.push(new en(e,i,`expected one of [${r.values.join(", ")}], ${JSON.stringify(i)} found`)):-1===Object.keys(r.values).indexOf(ie(i))&&n.push(new en(e,i,`expected one of [${Object.keys(r.values).join(", ")}], ${JSON.stringify(i)} found`)),n}function un(t){if(!0===t||!1===t)return!0;if(!Array.isArray(t)||0===t.length)return!1;switch(t[0]){case"has":return t.length>=2&&"$id"!==t[1]&&"$type"!==t[1];case"in":return t.length>=3&&("string"!=typeof t[1]||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==t.length||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(const e of t.slice(1))if(!un(e)&&"boolean"!=typeof e)return!1;return!0;default:return!0}}function hn(t,e="fill"){if(null==t)return{filter:()=>!0,needGeometry:!1,needFeature:!1};un(t)||(t=_n(t));const i=t;let r=!0;try{r=function(t){if(!fn(t))return t;let e=re(t);return pn(e),e=dn(e),e}(i)}catch(t){console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(i,null,2)}\n        `)}const n=te[`filter_${e}`],o=Kr(r,n);let s=null;if("error"===o.result)throw new Error(o.value.map((t=>`${t.key}: ${t.message}`)).join(", "));s=(t,e,i)=>o.value.evaluate(t,e,{},i);let a=null,l=null;if(r!==i){const t=Kr(i,n);if("error"===t.result)throw new Error(t.value.map((t=>`${t.key}: ${t.message}`)).join(", "));a=(e,i,r,n,o)=>t.value.evaluate(e,i,{},r,void 0,void 0,n,o),l=!vi(t.value.expression)}return{filter:s,dynamicFilter:a||void 0,needGeometry:gn(r),needFeature:!!l}}function dn(t){if(!Array.isArray(t))return t;const e=function(t){if(An.has(t[0]))for(let e=1;e<t.length;e++)if(fn(t[e]))return!0;return t}(t);return!0===e?e:e.map((t=>dn(t)))}function pn(t){let e=!1;const i=[];if("case"===t[0]){for(let r=1;r<t.length-1;r+=2)e=e||fn(t[r]),i.push(t[r+1]);i.push(t[t.length-1])}else if("match"===t[0]){e=e||fn(t[1]);for(let e=2;e<t.length-1;e+=2)i.push(t[e+1]);i.push(t[t.length-1])}else if("step"===t[0]){e=e||fn(t[1]);for(let e=1;e<t.length-1;e+=2)i.push(t[e+1])}e&&(t.length=0,t.push("any",...i));for(let e=1;e<t.length;e++)pn(t[e])}function fn(t){if(!Array.isArray(t))return!1;if("pitch"===(e=t[0])||"distance-from-center"===e)return!0;var e;for(let e=1;e<t.length;e++)if(fn(t[e]))return!0;return!1}const An=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function mn(t,e){return t<e?-1:t>e?1:0}function gn(t){if(!Array.isArray(t))return!1;if("within"===t[0])return!0;for(let e=1;e<t.length;e++)if(gn(t[e]))return!0;return!1}function _n(t){if(!t)return!0;const e=t[0];return t.length<=1?"any"!==e:"=="===e?yn(t[1],t[2],"=="):"!="===e?bn(yn(t[1],t[2],"==")):"<"===e||">"===e||"<="===e||">="===e?yn(t[1],t[2],e):"any"===e?(i=t.slice(1),["any"].concat(i.map(_n))):"all"===e?["all"].concat(t.slice(1).map(_n)):"none"===e?["all"].concat(t.slice(1).map(_n).map(bn)):"in"===e?vn(t[1],t.slice(2)):"!in"===e?bn(vn(t[1],t.slice(2))):"has"===e?xn(t[1]):"!has"===e?bn(xn(t[1])):"within"!==e||t;var i}function yn(t,e,i){switch(t){case"$type":return[`filter-type-${i}`,e];case"$id":return[`filter-id-${i}`,e];default:return[`filter-${i}`,t,e]}}function vn(t,e){if(0===e.length)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some((t=>typeof t!=typeof e[0]))?["filter-in-large",t,["literal",e.sort(mn)]]:["filter-in-small",t,["literal",e]]}}function xn(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function bn(t){return["!",t]}function wn(t){return un(re(t.value))?an(ee({},t,{expressionContext:"filter",valueSpec:t.styleSpec[`filter_${t.layerType||"fill"}`]})):Tn(t)}function Tn(t){const e=t.value,i=t.key;if("array"!==Ur(e))return[new en(i,e,`array expected, ${Ur(e)} found`)];const r=t.styleSpec;let n,o=[];if(e.length<1)return[new en(i,e,"filter array must have at least 1 element")];switch(o=o.concat(cn({key:`${i}[0]`,value:e[0],valueSpec:r.filter_operator,style:t.style,styleSpec:t.styleSpec})),ie(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&"$type"===ie(e[1])&&o.push(new en(i,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":3!==e.length&&o.push(new en(i,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(n=Ur(e[1]),"string"!==n&&o.push(new en(`${i}[1]`,e[1],`string expected, ${n} found`)));for(let s=2;s<e.length;s++)n=Ur(e[s]),"$type"===ie(e[1])?o=o.concat(cn({key:`${i}[${s}]`,value:e[s],valueSpec:r.geometry_type,style:t.style,styleSpec:t.styleSpec})):"string"!==n&&"number"!==n&&"boolean"!==n&&o.push(new en(`${i}[${s}]`,e[s],`string, number, or boolean expected, ${n} found`));break;case"any":case"all":case"none":for(let r=1;r<e.length;r++)o=o.concat(Tn({key:`${i}[${r}]`,value:e[r],style:t.style,styleSpec:t.styleSpec}));break;case"has":case"!has":n=Ur(e[1]),2!==e.length?o.push(new en(i,e,`filter array for "${e[0]}" operator must have 2 elements`)):"string"!==n&&o.push(new en(`${i}[1]`,e[1],`string expected, ${n} found`));break;case"within":n=Ur(e[1]),2!==e.length?o.push(new en(i,e,`filter array for "${e[0]}" operator must have 2 elements`)):"object"!==n&&o.push(new en(`${i}[1]`,e[1],`object expected, ${n} found`))}return o}function Bn(t,e){const i=t.key,r=t.style,n=t.styleSpec,o=t.value,s=t.objectKey,a=n[`${e}_${t.layerType}`];if(!a)return[];const l=s.match(/^(.*)-transition$/);if("paint"===e&&l&&a[l[1]]&&a[l[1]].transition)return Rn({key:i,value:o,valueSpec:n.transition,style:r,styleSpec:n});const c=t.valueSpec||a[s];if(!c)return[new en(i,o,`unknown property "${s}"`)];let u;if("string"===Ur(o)&&Fr(c)&&!c.tokens&&(u=/^{([^}]+)}$/.exec(o))){const t=`\`{ "type": "identity", "property": ${u?JSON.stringify(u[1]):'"_"'} }\``;return[new en(i,o,`"${s}" does not support interpolation syntax\nUse an identity property function instead: ${t}.`)]}const h=[];return"symbol"===t.layerType&&("text-field"===s&&r&&!r.glyphs&&h.push(new en(i,o,'use of "text-field" requires a style "glyphs" property')),"text-font"===s&&Or(re(o))&&"identity"===ie(o.type)&&h.push(new en(i,o,'"text-font" does not support identity functions'))),h.concat(Rn({key:t.key,value:o,valueSpec:c,style:r,styleSpec:n,expressionContext:"property",propertyType:e,propertyKey:s}))}function En(t){return Bn(t,"paint")}function Cn(t){return Bn(t,"layout")}function Sn(t){let e=[];const i=t.value,r=t.key,n=t.style,o=t.styleSpec;i.type||i.ref||e.push(new en(r,i,'either "type" or "ref" is required'));let s=ie(i.type);const a=ie(i.ref);if(i.id){const o=ie(i.id);for(let s=0;s<t.arrayIndex;s++){const t=n.layers[s];ie(t.id)===o&&e.push(new en(r,i.id,`duplicate layer id "${i.id}", previously used at line ${t.id.__line__}`))}}if("ref"in i){let t;["type","source","source-layer","filter","layout"].forEach((t=>{t in i&&e.push(new en(r,i[t],`"${t}" is prohibited for ref layers`))})),n.layers.forEach((e=>{ie(e.id)===a&&(t=e)})),t?t.ref?e.push(new en(r,i.ref,"ref cannot reference another ref layer")):s=ie(t.type):"string"==typeof a&&e.push(new en(r,i.ref,`ref layer "${a}" not found`))}else if("background"!==s&&"sky"!==s)if(i.source){const t=n.sources&&n.sources[i.source],o=t&&ie(t.type);t?"vector"===o&&"raster"===s?e.push(new en(r,i.source,`layer "${i.id}" requires a raster source`)):"raster"===o&&"raster"!==s?e.push(new en(r,i.source,`layer "${i.id}" requires a vector source`)):"vector"!==o||i["source-layer"]?"raster-dem"===o&&"hillshade"!==s?e.push(new en(r,i.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==s||!i.paint||!i.paint["line-gradient"]&&!i.paint["line-trim-offset"]||"geojson"===o&&t.lineMetrics||e.push(new en(r,i,`layer "${i.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new en(r,i,`layer "${i.id}" must specify a "source-layer"`)):e.push(new en(r,i.source,`source "${i.source}" not found`))}else e.push(new en(r,i,'missing required property "source"'));return e=e.concat(rn({key:r,value:i,valueSpec:o.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Rn({key:`${r}.type`,value:i.type,valueSpec:o.layer.type,style:t.style,styleSpec:t.styleSpec,object:i,objectKey:"type"}),filter:t=>wn(ee({layerType:s},t)),layout:t=>rn({layer:i,key:t.key,value:t.value,valueSpec:{},style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":t=>Cn(ee({layerType:s},t))}}),paint:t=>rn({layer:i,key:t.key,value:t.value,valueSpec:{},style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":t=>En(ee({layerType:s},t))}})}})),e}function In(t){const e=t.value,i=t.key,r=Ur(e);return"string"!==r?[new en(i,e,`string expected, ${r} found`)]:[]}const Mn={promoteId:function({key:t,value:e}){if("string"===Ur(e))return In({key:t,value:e});{const i=[];for(const r in e)i.push(...In({key:`${t}.${r}`,value:e[r]}));return i}}};function kn(t){const e=t.value,i=t.key,r=t.styleSpec,n=t.style;if(!e.type)return[new en(i,e,'"type" is required')];const o=ie(e.type);let s;switch(o){case"vector":case"raster":case"raster-dem":return s=rn({key:i,value:e,valueSpec:r[`source_${o.replace("-","_")}`],style:t.style,styleSpec:r,objectElementValidators:Mn}),s;case"geojson":if(s=rn({key:i,value:e,valueSpec:r.source_geojson,style:n,styleSpec:r,objectElementValidators:Mn}),e.cluster)for(const t in e.clusterProperties){const[r,n]=e.clusterProperties[t],o="string"==typeof r?[r,["accumulated"],["get",t]]:r;s.push(...an({key:`${i}.${t}.map`,value:n,expressionContext:"cluster-map"})),s.push(...an({key:`${i}.${t}.reduce`,value:o,expressionContext:"cluster-reduce"}))}return s;case"video":return rn({key:i,value:e,valueSpec:r.source_video,style:n,styleSpec:r});case"image":return rn({key:i,value:e,valueSpec:r.source_image,style:n,styleSpec:r});case"canvas":return[new en(i,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return cn({key:`${i}.type`,value:e.type,valueSpec:{values:Pn(r)},style:n,styleSpec:r})}}function Pn(t){return t.source.reduce(((e,i)=>{const r=t[i];return"enum"===r.type.type&&(e=e.concat(Object.keys(r.type.values))),e}),[])}function Ln(t){const e=t.value,i=t.styleSpec,r=i.light,n=t.style;let o=[];const s=Ur(e);if(void 0===e)return o;if("object"!==s)return o=o.concat([new en("light",e,`object expected, ${s} found`)]),o;for(const t in e){const s=t.match(/^(.*)-transition$/);o=o.concat(s&&r[s[1]]&&r[s[1]].transition?Rn({key:t,value:e[t],valueSpec:i.transition,style:n,styleSpec:i}):r[t]?Rn({key:t,value:e[t],valueSpec:r[t],style:n,styleSpec:i}):[new en(t,e[t],`unknown property "${t}"`)])}return o}function zn(t){const e=t.value,i=t.key,r=t.style,n=t.styleSpec,o=n.terrain;let s=[];const a=Ur(e);if(void 0===e)return s;if("object"!==a)return s=s.concat([new en("terrain",e,`object expected, ${a} found`)]),s;for(const t in e){const i=t.match(/^(.*)-transition$/);s=s.concat(i&&o[i[1]]&&o[i[1]].transition?Rn({key:t,value:e[t],valueSpec:n.transition,style:r,styleSpec:n}):o[t]?Rn({key:t,value:e[t],valueSpec:o[t],style:r,styleSpec:n}):[new en(t,e[t],`unknown property "${t}"`)])}if(e.source){const t=r.sources&&r.sources[e.source],n=t&&ie(t.type);t?"raster-dem"!==n&&s.push(new en(i,e.source,`terrain cannot be used with a source of type ${String(n)}, it only be used with a "raster-dem" source type`)):s.push(new en(i,e.source,`source "${e.source}" not found`))}else s.push(new en(i,e,'terrain is missing required property "source"'));return s}function Fn(t){const e=t.value,i=t.style,r=t.styleSpec,n=r.fog;let o=[];const s=Ur(e);if(void 0===e)return o;if("object"!==s)return o=o.concat([new en("fog",e,`object expected, ${s} found`)]),o;for(const t in e){const s=t.match(/^(.*)-transition$/);o=o.concat(s&&n[s[1]]&&n[s[1]].transition?Rn({key:t,value:e[t],valueSpec:r.transition,style:i,styleSpec:r}):n[t]?Rn({key:t,value:e[t],valueSpec:n[t],style:i,styleSpec:r}):[new en(t,e[t],`unknown property "${t}"`)])}return o}const Dn={"*":()=>[],array:nn,boolean:function(t){const e=t.value,i=t.key,r=Ur(e);return"boolean"!==r?[new en(i,e,`boolean expected, ${r} found`)]:[]},number:on,color:function(t){const e=t.key,i=t.value,r=Ur(i);return"string"!==r?[new en(e,i,`color expected, ${r} found`)]:null===Te(i)?[new en(e,i,`color expected, "${i}" found`)]:[]},enum:cn,filter:wn,function:sn,layer:Sn,object:rn,source:kn,light:Ln,terrain:zn,fog:Fn,string:In,formatted:function(t){return 0===In(t).length?[]:an(t)},resolvedImage:function(t){return 0===In(t).length?[]:an(t)},projection:function(t){const e=t.value,i=t.styleSpec,r=i.projection,n=t.style;let o=[];const s=Ur(e);if("object"===s)for(const t in e)o=o.concat(Rn({key:t,value:e[t],valueSpec:r[t],style:n,styleSpec:i}));else"string"!==s&&(o=o.concat([new en("projection",e,`object or string expected, ${s} found`)]));return o}};function Rn(t){const e=t.value,i=t.valueSpec,r=t.styleSpec;return i.expression&&Or(ie(e))?sn(t):i.expression&&qr(re(e))?an(t):i.type&&Dn[i.type]?Dn[i.type](t):rn(ee({},t,{valueSpec:i.type?r[i.type]:i}))}function Un(t){const e=t.value,i=t.key,r=In(t);return r.length||(-1===e.indexOf("{fontstack}")&&r.push(new en(i,e,'"glyphs" url must include a "{fontstack}" token')),-1===e.indexOf("{range}")&&r.push(new en(i,e,'"glyphs" url must include a "{range}" token'))),r}function On(t,e=te){return Vn(Rn({key:"",value:t,valueSpec:e.$root,styleSpec:e,style:t,objectElementValidators:{glyphs:Un,"*":()=>[]}}))}const Nn=t=>Vn(En(t)),Qn=t=>Vn(Cn(t));function Vn(t){return t.slice().sort(((t,e)=>t.line&&e.line?t.line-e.line:0))}function jn(t,e){let i=!1;if(e&&e.length)for(const r of e)t.fire(new Jt(new Error(r.message))),i=!0;return i}var Hn=$n,Gn=3;function $n(t,e,i){var r=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var n=new Int32Array(this.arrayBuffer);t=n[0],this.d=(e=n[1])+2*(i=n[2]);for(var o=0;o<this.d*this.d;o++){var s=n[Gn+o],a=n[Gn+o+1];r.push(s===a?null:n.subarray(s,a))}var l=n[Gn+r.length+1];this.keys=n.subarray(n[Gn+r.length],l),this.bboxes=n.subarray(l),this.insert=this._insertReadonly}else{this.d=e+2*i;for(var c=0;c<this.d*this.d;c++)r.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=i,this.scale=e/t,this.uid=0;var u=i/e*t;this.min=-u,this.max=t+u}$n.prototype.insert=function(t,e,i,r,n){this._forEachCell(e,i,r,n,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(i),this.bboxes.push(r),this.bboxes.push(n)},$n.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},$n.prototype._insertCell=function(t,e,i,r,n,o){this.cells[n].push(o)},$n.prototype.query=function(t,e,i,r,n){var o=this.min,s=this.max;if(t<=o&&e<=o&&s<=i&&s<=r&&!n)return Array.prototype.slice.call(this.keys);var a=[];return this._forEachCell(t,e,i,r,this._queryCell,a,{},n),a},$n.prototype._queryCell=function(t,e,i,r,n,o,s,a){var l=this.cells[n];if(null!==l)for(var c=this.keys,u=this.bboxes,h=0;h<l.length;h++){var d=l[h];if(void 0===s[d]){var p=4*d;(a?a(u[p+0],u[p+1],u[p+2],u[p+3]):t<=u[p+2]&&e<=u[p+3]&&i>=u[p+0]&&r>=u[p+1])?(s[d]=!0,o.push(c[d])):s[d]=!1}}},$n.prototype._forEachCell=function(t,e,i,r,n,o,s,a){for(var l=this._convertToCellCoord(t),c=this._convertToCellCoord(e),u=this._convertToCellCoord(i),h=this._convertToCellCoord(r),d=l;d<=u;d++)for(var p=c;p<=h;p++){var f=this.d*p+d;if((!a||a(this._convertFromCellCoord(d),this._convertFromCellCoord(p),this._convertFromCellCoord(d+1),this._convertFromCellCoord(p+1)))&&n.call(this,t,e,i,r,f,o,s,a))return}},$n.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},$n.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},$n.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,e=Gn+this.cells.length+1+1,i=0,r=0;r<this.cells.length;r++)i+=this.cells[r].length;var n=new Int32Array(e+i+this.keys.length+this.bboxes.length);n[0]=this.extent,n[1]=this.n,n[2]=this.padding;for(var o=e,s=0;s<t.length;s++){var a=t[s];n[Gn+s]=o,n.set(a,o),o+=a.length}return n[Gn+t.length]=o,n.set(this.keys,o),n[Gn+t.length+1]=o+=this.keys.length,n.set(this.bboxes,o),o+=this.bboxes.length,n.buffer};var Zn=d(Hn);const qn={};function Kn(t,e,i={}){Object.defineProperty(t,"_classRegistryKey",{value:e,writeable:!1}),qn[e]={klass:t,omit:i.omit||[]}}Kn(Object,"Object"),Zn.serialize=function(t,e){const i=t.toArrayBuffer();return e&&e.push(i),{buffer:i}},Zn.deserialize=function(t){return new Zn(t.buffer)},Object.defineProperty(Zn,"name",{value:"Grid"}),Kn(Zn,"Grid"),Kn(ke,"Color"),Kn(Error,"Error"),Kn(ct,"AJAXError"),Kn(Fe,"ResolvedImage"),Kn(Yr,"StylePropertyFunction"),Kn(Zr,"StyleExpression",{omit:["_evaluator"]}),Kn(Xr,"ZoomDependentExpression"),Kn(Wr,"ZoomConstantExpression"),Kn(ti,"CompoundExpression",{omit:["_evaluate"]});for(const t in Pr)qn[Pr[t]._classRegistryKey]||Kn(Pr[t],`Expression${t}`);function Wn(t){return t&&"undefined"!=typeof ArrayBuffer&&(t instanceof ArrayBuffer||t.constructor&&"ArrayBuffer"===t.constructor.name)}function Xn(t){return e.ImageBitmap&&t instanceof e.ImageBitmap}function Jn(t,i){if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(Wn(t)||Xn(t))return i&&i.push(t),t;if(ArrayBuffer.isView(t)){const e=t;return i&&i.push(e.buffer),e}if(t instanceof e.ImageData)return i&&i.push(t.data.buffer),t;if(Array.isArray(t)){const e=[];for(const r of t)e.push(Jn(r,i));return e}if("object"==typeof t){const e=t.constructor,r=e._classRegistryKey;if(!r)throw new Error(`can't serialize object of unregistered class ${r}`);const n=e.serialize?e.serialize(t,i):{};if(!e.serialize){for(const e in t)t.hasOwnProperty(e)&&(qn[r].omit.indexOf(e)>=0||(n[e]=Jn(t[e],i)));t instanceof Error&&(n.message=t.message)}if(n.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==r&&(n.$name=r),n}throw new Error("can't serialize object of type "+typeof t)}function Yn(t){if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||Wn(t)||Xn(t)||ArrayBuffer.isView(t)||t instanceof e.ImageData)return t;if(Array.isArray(t))return t.map(Yn);if("object"==typeof t){const e=t.$name||"Object",{klass:i}=qn[e];if(!i)throw new Error(`can't deserialize unregistered class ${e}`);if(i.deserialize)return i.deserialize(t);const r=Object.create(i.prototype);for(const e of Object.keys(t))"$name"!==e&&(r[e]=Yn(t[e]));return r}throw new Error("can't deserialize object of type "+typeof t)}const to={"Latin-1 Supplement":t=>t>=128&&t<=255,Arabic:t=>t>=1536&&t<=1791,"Arabic Supplement":t=>t>=1872&&t<=1919,"Arabic Extended-A":t=>t>=2208&&t<=2303,"Hangul Jamo":t=>t>=4352&&t<=4607,"Unified Canadian Aboriginal Syllabics":t=>t>=5120&&t<=5759,Khmer:t=>t>=6016&&t<=6143,"Unified Canadian Aboriginal Syllabics Extended":t=>t>=6320&&t<=6399,"General Punctuation":t=>t>=8192&&t<=8303,"Letterlike Symbols":t=>t>=8448&&t<=8527,"Number Forms":t=>t>=8528&&t<=8591,"Miscellaneous Technical":t=>t>=8960&&t<=9215,"Control Pictures":t=>t>=9216&&t<=9279,"Optical Character Recognition":t=>t>=9280&&t<=9311,"Enclosed Alphanumerics":t=>t>=9312&&t<=9471,"Geometric Shapes":t=>t>=9632&&t<=9727,"Miscellaneous Symbols":t=>t>=9728&&t<=9983,"Miscellaneous Symbols and Arrows":t=>t>=11008&&t<=11263,"CJK Radicals Supplement":t=>t>=11904&&t<=12031,"Kangxi Radicals":t=>t>=12032&&t<=12255,"Ideographic Description Characters":t=>t>=12272&&t<=12287,"CJK Symbols and Punctuation":t=>t>=12288&&t<=12351,Hiragana:t=>t>=12352&&t<=12447,Katakana:t=>t>=12448&&t<=12543,Bopomofo:t=>t>=12544&&t<=12591,"Hangul Compatibility Jamo":t=>t>=12592&&t<=12687,Kanbun:t=>t>=12688&&t<=12703,"Bopomofo Extended":t=>t>=12704&&t<=12735,"CJK Strokes":t=>t>=12736&&t<=12783,"Katakana Phonetic Extensions":t=>t>=12784&&t<=12799,"Enclosed CJK Letters and Months":t=>t>=12800&&t<=13055,"CJK Compatibility":t=>t>=13056&&t<=13311,"CJK Unified Ideographs Extension A":t=>t>=13312&&t<=19903,"Yijing Hexagram Symbols":t=>t>=19904&&t<=19967,"CJK Unified Ideographs":t=>t>=19968&&t<=40959,"Yi Syllables":t=>t>=40960&&t<=42127,"Yi Radicals":t=>t>=42128&&t<=42191,"Hangul Jamo Extended-A":t=>t>=43360&&t<=43391,"Hangul Syllables":t=>t>=44032&&t<=55215,"Hangul Jamo Extended-B":t=>t>=55216&&t<=55295,"Private Use Area":t=>t>=57344&&t<=63743,"CJK Compatibility Ideographs":t=>t>=63744&&t<=64255,"Arabic Presentation Forms-A":t=>t>=64336&&t<=65023,"Vertical Forms":t=>t>=65040&&t<=65055,"CJK Compatibility Forms":t=>t>=65072&&t<=65103,"Small Form Variants":t=>t>=65104&&t<=65135,"Arabic Presentation Forms-B":t=>t>=65136&&t<=65279,"Halfwidth and Fullwidth Forms":t=>t>=65280&&t<=65519};function eo(t){for(const e of t)if(no(e.charCodeAt(0)))return!0;return!1}function io(t){for(const e of t)if(!ro(e.charCodeAt(0)))return!1;return!0}function ro(t){return!(to.Arabic(t)||to["Arabic Supplement"](t)||to["Arabic Extended-A"](t)||to["Arabic Presentation Forms-A"](t)||to["Arabic Presentation Forms-B"](t))}function no(t){return!(746!==t&&747!==t&&(t<4352||!(to["Bopomofo Extended"](t)||to.Bopomofo(t)||to["CJK Compatibility Forms"](t)&&!(t>=65097&&t<=65103)||to["CJK Compatibility Ideographs"](t)||to["CJK Compatibility"](t)||to["CJK Radicals Supplement"](t)||to["CJK Strokes"](t)||!(!to["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||12336===t)||to["CJK Unified Ideographs Extension A"](t)||to["CJK Unified Ideographs"](t)||to["Enclosed CJK Letters and Months"](t)||to["Hangul Compatibility Jamo"](t)||to["Hangul Jamo Extended-A"](t)||to["Hangul Jamo Extended-B"](t)||to["Hangul Jamo"](t)||to["Hangul Syllables"](t)||to.Hiragana(t)||to["Ideographic Description Characters"](t)||to.Kanbun(t)||to["Kangxi Radicals"](t)||to["Katakana Phonetic Extensions"](t)||to.Katakana(t)&&12540!==t||!(!to["Halfwidth and Fullwidth Forms"](t)||65288===t||65289===t||65293===t||t>=65306&&t<=65310||65339===t||65341===t||65343===t||t>=65371&&t<=65503||65507===t||t>=65512&&t<=65519)||!(!to["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||to["Unified Canadian Aboriginal Syllabics"](t)||to["Unified Canadian Aboriginal Syllabics Extended"](t)||to["Vertical Forms"](t)||to["Yijing Hexagram Symbols"](t)||to["Yi Syllables"](t)||to["Yi Radicals"](t))))}function oo(t){return!(no(t)||function(t){return!!(to["Latin-1 Supplement"](t)&&(167===t||169===t||174===t||177===t||188===t||189===t||190===t||215===t||247===t)||to["General Punctuation"](t)&&(8214===t||8224===t||8225===t||8240===t||8241===t||8251===t||8252===t||8258===t||8263===t||8264===t||8265===t||8273===t)||to["Letterlike Symbols"](t)||to["Number Forms"](t)||to["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||9003===t||t>=9085&&t<=9114||t>=9150&&t<=9165||9167===t||t>=9169&&t<=9179||t>=9186&&t<=9215)||to["Control Pictures"](t)&&9251!==t||to["Optical Character Recognition"](t)||to["Enclosed Alphanumerics"](t)||to["Geometric Shapes"](t)||to["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||to["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||to["CJK Symbols and Punctuation"](t)||to.Katakana(t)||to["Private Use Area"](t)||to["CJK Compatibility Forms"](t)||to["Small Form Variants"](t)||to["Halfwidth and Fullwidth Forms"](t)||8734===t||8756===t||8757===t||t>=9984&&t<=10087||t>=10102&&t<=10131||65532===t||65533===t)}(t))}function so(t){return t>=1424&&t<=2303||to["Arabic Presentation Forms-A"](t)||to["Arabic Presentation Forms-B"](t)}function ao(t,e){return!(!e&&so(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||to.Khmer(t))}function lo(t){for(const e of t)if(so(e.charCodeAt(0)))return!0;return!1}const co="deferred",uo="loading",ho="loaded";let po=null,fo="unavailable",Ao=null;const mo=function(t){t&&"string"==typeof t&&t.indexOf("NetworkError")>-1&&(fo="error"),po&&po(t)};function go(){_o.fire(new Xt("pluginStateChange",{pluginStatus:fo,pluginURL:Ao}))}const _o=new Yt,yo=function(){return fo},vo=function(){if(fo!==co||!Ao)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");fo=uo,go(),Ao&&dt({url:Ao},(t=>{t?mo(t):(fo=ho,go())}))},xo={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>fo===ho||null!=xo.applyArabicShaping,isLoading:()=>fo===uo,setState(t){fo=t.pluginStatus,Ao=t.pluginURL},isParsed:()=>null!=xo.applyArabicShaping&&null!=xo.processBidirectionalText&&null!=xo.processStyledBidirectionalText,getPluginURL:()=>Ao};class bo{constructor(t,e){this.zoom=t,e?(this.now=e.now,this.fadeDuration=e.fadeDuration,this.transition=e.transition,this.pitch=e.pitch):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0)}isSupportedScript(t){return function(t,e){for(const i of t)if(!ao(i.charCodeAt(0),e))return!1;return!0}(t,xo.isLoaded())}}class wo{constructor(t,e){this.property=t,this.value=e,this.expression=function(t,e){if(Or(t))return new Yr(t,e);if(qr(t)){const i=Jr(t,e);if("error"===i.result)throw new Error(i.value.map((t=>`${t.key}: ${t.message}`)).join(", "));return i.value}{let i=t;return"string"==typeof t&&"color"===e.type&&(i=ke.parse(t)),{kind:"constant",evaluate:()=>i}}}(void 0===e?t.specification.default:e,t.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(t,e,i){return this.property.possiblyEvaluate(this,t,e,i)}}class To{constructor(t){this.property=t,this.value=new wo(t,void 0)}transitioned(t,e){return new Eo(this.property,this.value,e,P({},t.transition,this.transition),t.now)}untransitioned(){return new Eo(this.property,this.value,null,{},0)}}class Bo{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return V(this._values[t].value.value)}setValue(t,e){this._values.hasOwnProperty(t)||(this._values[t]=new To(this._values[t].property)),this._values[t].value=new wo(this._values[t].property,null===e?void 0:V(e))}getTransition(t){return V(this._values[t].transition)}setTransition(t,e){this._values.hasOwnProperty(t)||(this._values[t]=new To(this._values[t].property)),this._values[t].transition=V(e)||void 0}serialize(){const t={};for(const e of Object.keys(this._values)){const i=this.getValue(e);void 0!==i&&(t[e]=i);const r=this.getTransition(e);void 0!==r&&(t[`${e}-transition`]=r)}return t}transitioned(t,e){const i=new Co(this._properties);for(const r of Object.keys(this._values))i._values[r]=this._values[r].transitioned(t,e._values[r]);return i}untransitioned(){const t=new Co(this._properties);for(const e of Object.keys(this._values))t._values[e]=this._values[e].untransitioned();return t}}class Eo{constructor(t,e,i,r,n){const o=r.delay||0,s=r.duration||0;n=n||0,this.property=t,this.value=e,this.begin=n+o,this.end=this.begin+s,t.specification.transition&&(r.delay||r.duration)&&(this.prior=i)}possiblyEvaluate(t,e,i){const r=t.now||0,n=this.value.possiblyEvaluate(t,e,i),o=this.prior;if(o){if(r>this.end)return this.prior=null,n;if(this.value.isDataDriven())return this.prior=null,n;if(r<this.begin)return o.possiblyEvaluate(t,e,i);{const s=(r-this.begin)/(this.end-this.begin);return this.property.interpolate(o.possiblyEvaluate(t,e,i),n,T(s))}}return n}}class Co{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,e,i){const r=new Mo(this._properties);for(const n of Object.keys(this._values))r._values[n]=this._values[n].possiblyEvaluate(t,e,i);return r}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class So{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}getValue(t){return V(this._values[t].value)}setValue(t,e){this._values[t]=new wo(this._values[t].property,null===e?void 0:V(e))}serialize(){const t={};for(const e of Object.keys(this._values)){const i=this.getValue(e);void 0!==i&&(t[e]=i)}return t}possiblyEvaluate(t,e,i){const r=new Mo(this._properties);for(const n of Object.keys(this._values))r._values[n]=this._values[n].possiblyEvaluate(t,e,i);return r}}class Io{constructor(t,e,i){this.property=t,this.value=e,this.parameters=i}isConstant(){return"constant"===this.value.kind}constantOr(t){return"constant"===this.value.kind?this.value.value:t}evaluate(t,e,i,r){return this.property.evaluate(this.value,this.parameters,t,e,i,r)}}class Mo{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class ko{constructor(t){this.specification=t}possiblyEvaluate(t,e){return t.expression.evaluate(e)}interpolate(t,e,i){const r=Pi[this.specification.type];return r?r(t,e,i):t}}class Po{constructor(t,e){this.specification=t,this.overrides=e}possiblyEvaluate(t,e,i,r){return new Io(this,"constant"===t.expression.kind||"camera"===t.expression.kind?{kind:"constant",value:t.expression.evaluate(e,null,{},i,r)}:t.expression,e)}interpolate(t,e,i){if("constant"!==t.value.kind||"constant"!==e.value.kind)return t;if(void 0===t.value.value||void 0===e.value.value)return new Io(this,{kind:"constant",value:void 0},t.parameters);const r=Pi[this.specification.type];return r?new Io(this,{kind:"constant",value:r(t.value.value,e.value.value,i)},t.parameters):t}evaluate(t,e,i,r,n,o){return"constant"===t.kind?t.value:t.evaluate(e,i,r,n,o)}}class Lo{constructor(t){this.specification=t}possiblyEvaluate(t,e,i,r){return!!t.expression.evaluate(e,null,{},i,r)}interpolate(){return!1}}class zo{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const e=new bo(0,{});for(const i in t){const r=t[i];r.specification.overridable&&this.overridableProperties.push(i);const n=this.defaultPropertyValues[i]=new wo(r,void 0),o=this.defaultTransitionablePropertyValues[i]=new To(r);this.defaultTransitioningPropertyValues[i]=o.untransitioned(),this.defaultPossiblyEvaluatedValues[i]=n.possiblyEvaluate(e)}}}function Fo(t,e){return 256*(t=C(Math.floor(t),0,255))+C(Math.floor(e),0,255)}Kn(Po,"DataDrivenProperty"),Kn(ko,"DataConstantProperty"),Kn(Lo,"ColorRampProperty");const Do={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Ro{constructor(t,e){this._structArray=t,this._pos1=e*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Uo{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,e){return t._trim(),e&&(t.isTransferred=!0,e.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const e=Object.create(this.prototype);return e.arrayBuffer=t.arrayBuffer,e.length=t.length,e.capacity=t.arrayBuffer.byteLength/e.bytesPerElement,e._refreshViews(),e}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const e=this.uint8;this._refreshViews(),e&&this.uint8.set(e)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Oo(t,e=1){let i=0,r=0;return{members:t.map((t=>{const n=Do[t.type].BYTES_PER_ELEMENT,o=i=No(i,Math.max(e,n)),s=t.components||1;return r=Math.max(r,n),i+=n*s,{name:t.name,type:t.type,components:s,offset:o}})),size:No(i,Math.max(r,e)),alignment:e}}function No(t,e){return Math.ceil(t/e)*e}class Qo extends Uo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e){const i=this.length;return this.resize(i+1),this.emplace(i,t,e)}emplace(t,e,i){const r=2*t;return this.int16[r+0]=e,this.int16[r+1]=i,t}}Qo.prototype.bytesPerElement=4,Kn(Qo,"StructArrayLayout2i4");class Vo extends Uo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,i){const r=this.length;return this.resize(r+1),this.emplace(r,t,e,i)}emplace(t,e,i,r){const n=3*t;return this.int16[n+0]=e,this.int16[n+1]=i,this.int16[n+2]=r,t}}Vo.prototype.bytesPerElement=6,Kn(Vo,"StructArrayLayout3i6");class jo extends Uo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,i,r){const n=this.length;return this.resize(n+1),this.emplace(n,t,e,i,r)}emplace(t,e,i,r,n){const o=4*t;return this.int16[o+0]=e,this.int16[o+1]=i,this.int16[o+2]=r,this.int16[o+3]=n,t}}jo.prototype.bytesPerElement=8,Kn(jo,"StructArrayLayout4i8");class Ho extends Uo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,i,r,n,o,s){const a=this.length;return this.resize(a+1),this.emplace(a,t,e,i,r,n,o,s)}emplace(t,e,i,r,n,o,s,a){const l=6*t,c=12*t,u=3*t;return this.int16[l+0]=e,this.int16[l+1]=i,this.uint8[c+4]=r,this.uint8[c+5]=n,this.uint8[c+6]=o,this.uint8[c+7]=s,this.float32[u+2]=a,t}}Ho.prototype.bytesPerElement=12,Kn(Ho,"StructArrayLayout2i4ub1f12");class Go extends Uo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,i,r){const n=this.length;return this.resize(n+1),this.emplace(n,t,e,i,r)}emplace(t,e,i,r,n){const o=4*t;return this.float32[o+0]=e,this.float32[o+1]=i,this.float32[o+2]=r,this.float32[o+3]=n,t}}Go.prototype.bytesPerElement=16,Kn(Go,"StructArrayLayout4f16");class $o extends Uo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,i,r,n){const o=this.length;return this.resize(o+1),this.emplace(o,t,e,i,r,n)}emplace(t,e,i,r,n,o){const s=6*t,a=3*t;return this.uint16[s+0]=e,this.uint16[s+1]=i,this.uint16[s+2]=r,this.uint16[s+3]=n,this.float32[a+2]=o,t}}$o.prototype.bytesPerElement=12,Kn($o,"StructArrayLayout4ui1f12");class Zo extends Uo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e,i,r){const n=this.length;return this.resize(n+1),this.emplace(n,t,e,i,r)}emplace(t,e,i,r,n){const o=4*t;return this.uint16[o+0]=e,this.uint16[o+1]=i,this.uint16[o+2]=r,this.uint16[o+3]=n,t}}Zo.prototype.bytesPerElement=8,Kn(Zo,"StructArrayLayout4ui8");class qo extends Uo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,i,r,n,o){const s=this.length;return this.resize(s+1),this.emplace(s,t,e,i,r,n,o)}emplace(t,e,i,r,n,o,s){const a=6*t;return this.int16[a+0]=e,this.int16[a+1]=i,this.int16[a+2]=r,this.int16[a+3]=n,this.int16[a+4]=o,this.int16[a+5]=s,t}}qo.prototype.bytesPerElement=12,Kn(qo,"StructArrayLayout6i12");class Ko extends Uo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e,i,r,n,o,s,a,l,c,u,h){const d=this.length;return this.resize(d+1),this.emplace(d,t,e,i,r,n,o,s,a,l,c,u,h)}emplace(t,e,i,r,n,o,s,a,l,c,u,h,d){const p=12*t;return this.int16[p+0]=e,this.int16[p+1]=i,this.int16[p+2]=r,this.int16[p+3]=n,this.uint16[p+4]=o,this.uint16[p+5]=s,this.uint16[p+6]=a,this.uint16[p+7]=l,this.int16[p+8]=c,this.int16[p+9]=u,this.int16[p+10]=h,this.int16[p+11]=d,t}}Ko.prototype.bytesPerElement=24,Kn(Ko,"StructArrayLayout4i4ui4i24");class Wo extends Uo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,i,r,n,o){const s=this.length;return this.resize(s+1),this.emplace(s,t,e,i,r,n,o)}emplace(t,e,i,r,n,o,s){const a=10*t,l=5*t;return this.int16[a+0]=e,this.int16[a+1]=i,this.int16[a+2]=r,this.float32[l+2]=n,this.float32[l+3]=o,this.float32[l+4]=s,t}}Wo.prototype.bytesPerElement=20,Kn(Wo,"StructArrayLayout3i3f20");class Xo extends Uo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const e=this.length;return this.resize(e+1),this.emplace(e,t)}emplace(t,e){return this.uint32[1*t+0]=e,t}}Xo.prototype.bytesPerElement=4,Kn(Xo,"StructArrayLayout1ul4");class Jo extends Uo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e,i,r,n,o,s,a,l,c,u,h,d){const p=this.length;return this.resize(p+1),this.emplace(p,t,e,i,r,n,o,s,a,l,c,u,h,d)}emplace(t,e,i,r,n,o,s,a,l,c,u,h,d,p){const f=20*t,A=10*t;return this.int16[f+0]=e,this.int16[f+1]=i,this.int16[f+2]=r,this.int16[f+3]=n,this.int16[f+4]=o,this.float32[A+3]=s,this.float32[A+4]=a,this.float32[A+5]=l,this.float32[A+6]=c,this.int16[f+14]=u,this.uint32[A+8]=h,this.uint16[f+18]=d,this.uint16[f+19]=p,t}}Jo.prototype.bytesPerElement=40,Kn(Jo,"StructArrayLayout5i4f1i1ul2ui40");class Yo extends Uo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,i,r,n,o,s){const a=this.length;return this.resize(a+1),this.emplace(a,t,e,i,r,n,o,s)}emplace(t,e,i,r,n,o,s,a){const l=8*t;return this.int16[l+0]=e,this.int16[l+1]=i,this.int16[l+2]=r,this.int16[l+4]=n,this.int16[l+5]=o,this.int16[l+6]=s,this.int16[l+7]=a,t}}Yo.prototype.bytesPerElement=16,Kn(Yo,"StructArrayLayout3i2i2i16");class ts extends Uo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,i,r,n){const o=this.length;return this.resize(o+1),this.emplace(o,t,e,i,r,n)}emplace(t,e,i,r,n,o){const s=4*t,a=8*t;return this.float32[s+0]=e,this.float32[s+1]=i,this.float32[s+2]=r,this.int16[a+6]=n,this.int16[a+7]=o,t}}ts.prototype.bytesPerElement=16,Kn(ts,"StructArrayLayout2f1f2i16");class es extends Uo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,i,r){const n=this.length;return this.resize(n+1),this.emplace(n,t,e,i,r)}emplace(t,e,i,r,n){const o=12*t,s=3*t;return this.uint8[o+0]=e,this.uint8[o+1]=i,this.float32[s+1]=r,this.float32[s+2]=n,t}}es.prototype.bytesPerElement=12,Kn(es,"StructArrayLayout2ub2f12");class is extends Uo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,i){const r=this.length;return this.resize(r+1),this.emplace(r,t,e,i)}emplace(t,e,i,r){const n=3*t;return this.float32[n+0]=e,this.float32[n+1]=i,this.float32[n+2]=r,t}}is.prototype.bytesPerElement=12,Kn(is,"StructArrayLayout3f12");class rs extends Uo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e,i){const r=this.length;return this.resize(r+1),this.emplace(r,t,e,i)}emplace(t,e,i,r){const n=3*t;return this.uint16[n+0]=e,this.uint16[n+1]=i,this.uint16[n+2]=r,t}}rs.prototype.bytesPerElement=6,Kn(rs,"StructArrayLayout3ui6");class ns extends Uo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t,e,i,r,n,o,s,a,l,c,u,h,d,p,f,A,m,g,_,y,v){const x=this.length;return this.resize(x+1),this.emplace(x,t,e,i,r,n,o,s,a,l,c,u,h,d,p,f,A,m,g,_,y,v)}emplace(t,e,i,r,n,o,s,a,l,c,u,h,d,p,f,A,m,g,_,y,v,x){const b=30*t,w=15*t,T=60*t;return this.int16[b+0]=e,this.int16[b+1]=i,this.int16[b+2]=r,this.float32[w+2]=n,this.float32[w+3]=o,this.uint16[b+8]=s,this.uint16[b+9]=a,this.uint32[w+5]=l,this.uint32[w+6]=c,this.uint32[w+7]=u,this.uint16[b+16]=h,this.uint16[b+17]=d,this.uint16[b+18]=p,this.float32[w+10]=f,this.float32[w+11]=A,this.uint8[T+48]=m,this.uint8[T+49]=g,this.uint8[T+50]=_,this.uint32[w+13]=y,this.int16[b+28]=v,this.uint8[T+58]=x,t}}ns.prototype.bytesPerElement=60,Kn(ns,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class os extends Uo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t,e,i,r,n,o,s,a,l,c,u,h,d,p,f,A,m,g,_,y,v,x,b,w,T,B,E,C,S,I){const M=this.length;return this.resize(M+1),this.emplace(M,t,e,i,r,n,o,s,a,l,c,u,h,d,p,f,A,m,g,_,y,v,x,b,w,T,B,E,C,S,I)}emplace(t,e,i,r,n,o,s,a,l,c,u,h,d,p,f,A,m,g,_,y,v,x,b,w,T,B,E,C,S,I,M){const k=38*t,P=19*t;return this.int16[k+0]=e,this.int16[k+1]=i,this.int16[k+2]=r,this.float32[P+2]=n,this.float32[P+3]=o,this.int16[k+8]=s,this.int16[k+9]=a,this.int16[k+10]=l,this.int16[k+11]=c,this.int16[k+12]=u,this.int16[k+13]=h,this.uint16[k+14]=d,this.uint16[k+15]=p,this.uint16[k+16]=f,this.uint16[k+17]=A,this.uint16[k+18]=m,this.uint16[k+19]=g,this.uint16[k+20]=_,this.uint16[k+21]=y,this.uint16[k+22]=v,this.uint16[k+23]=x,this.uint16[k+24]=b,this.uint16[k+25]=w,this.uint16[k+26]=T,this.uint16[k+27]=B,this.uint16[k+28]=E,this.uint32[P+15]=C,this.float32[P+16]=S,this.float32[P+17]=I,this.float32[P+18]=M,t}}os.prototype.bytesPerElement=76,Kn(os,"StructArrayLayout3i2f6i15ui1ul3f76");class ss extends Uo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const e=this.length;return this.resize(e+1),this.emplace(e,t)}emplace(t,e){return this.float32[1*t+0]=e,t}}ss.prototype.bytesPerElement=4,Kn(ss,"StructArrayLayout1f4");class as extends Uo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,i,r,n){const o=this.length;return this.resize(o+1),this.emplace(o,t,e,i,r,n)}emplace(t,e,i,r,n,o){const s=5*t;return this.float32[s+0]=e,this.float32[s+1]=i,this.float32[s+2]=r,this.float32[s+3]=n,this.float32[s+4]=o,t}}as.prototype.bytesPerElement=20,Kn(as,"StructArrayLayout5f20");class ls extends Uo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e,i,r){const n=this.length;return this.resize(n+1),this.emplace(n,t,e,i,r)}emplace(t,e,i,r,n){const o=6*t;return this.uint32[3*t+0]=e,this.uint16[o+2]=i,this.uint16[o+3]=r,this.uint16[o+4]=n,t}}ls.prototype.bytesPerElement=12,Kn(ls,"StructArrayLayout1ul3ui12");class cs extends Uo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e){const i=this.length;return this.resize(i+1),this.emplace(i,t,e)}emplace(t,e,i){const r=2*t;return this.uint16[r+0]=e,this.uint16[r+1]=i,t}}cs.prototype.bytesPerElement=4,Kn(cs,"StructArrayLayout2ui4");class us extends Uo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const e=this.length;return this.resize(e+1),this.emplace(e,t)}emplace(t,e){return this.uint16[1*t+0]=e,t}}us.prototype.bytesPerElement=2,Kn(us,"StructArrayLayout1ui2");class hs extends Uo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e){const i=this.length;return this.resize(i+1),this.emplace(i,t,e)}emplace(t,e,i){const r=2*t;return this.float32[r+0]=e,this.float32[r+1]=i,t}}hs.prototype.bytesPerElement=8,Kn(hs,"StructArrayLayout2f8");class ds extends Ro{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}ds.prototype.size=40;class ps extends Jo{get(t){return new ds(this,t)}}Kn(ps,"CollisionBoxArray");class fs extends Ro{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(t){this._structArray.uint8[this._pos1+49]=t}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(t){this._structArray.uint8[this._pos1+50]=t}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(t){this._structArray.uint32[this._pos4+13]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(t){this._structArray.uint8[this._pos1+58]=t}}fs.prototype.size=60;class As extends ns{get(t){return new fs(this,t)}}Kn(As,"PlacedSymbolArray");class ms extends Ro{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(t){this._structArray.uint32[this._pos4+15]=t}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}ms.prototype.size=76;class gs extends os{get(t){return new ms(this,t)}}Kn(gs,"SymbolInstanceArray");class _s extends ss{getoffsetX(t){return this.float32[1*t+0]}}Kn(_s,"GlyphOffsetArray");class ys extends Qo{getx(t){return this.int16[2*t+0]}gety(t){return this.int16[2*t+1]}}Kn(ys,"SymbolLineVertexArray");class vs extends Ro{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}vs.prototype.size=12;class xs extends ls{get(t){return new vs(this,t)}}Kn(xs,"FeatureIndexArray");class bs extends cs{geta_centroid_pos0(t){return this.uint16[2*t+0]}geta_centroid_pos1(t){return this.uint16[2*t+1]}}Kn(bs,"FillExtrusionCentroidArray");const ws=Oo([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),Ts=Oo([{name:"a_dash",components:4,type:"Uint16"}]);var Bs={exports:{}},Es={exports:{}};Es.exports=function(t,e){var i,r,n,o,s,a,l,c;for(r=t.length-(i=3&t.length),n=e,s=3432918353,a=461845907,c=0;c<r;)l=255&t.charCodeAt(c)|(255&t.charCodeAt(++c))<<8|(255&t.charCodeAt(++c))<<16|(255&t.charCodeAt(++c))<<24,++c,n=27492+(65535&(o=5*(65535&(n=(n^=l=(65535&(l=(l=(65535&l)*s+(((l>>>16)*s&65535)<<16)&4294967295)<<15|l>>>17))*a+(((l>>>16)*a&65535)<<16)&4294967295)<<13|n>>>19))+((5*(n>>>16)&65535)<<16)&4294967295))+((58964+(o>>>16)&65535)<<16);switch(l=0,i){case 3:l^=(255&t.charCodeAt(c+2))<<16;case 2:l^=(255&t.charCodeAt(c+1))<<8;case 1:n^=l=(65535&(l=(l=(65535&(l^=255&t.charCodeAt(c)))*s+(((l>>>16)*s&65535)<<16)&4294967295)<<15|l>>>17))*a+(((l>>>16)*a&65535)<<16)&4294967295}return n^=t.length,n=2246822507*(65535&(n^=n>>>16))+((2246822507*(n>>>16)&65535)<<16)&4294967295,n=3266489909*(65535&(n^=n>>>13))+((3266489909*(n>>>16)&65535)<<16)&4294967295,(n^=n>>>16)>>>0};var Cs=Es.exports,Ss={exports:{}};Ss.exports=function(t,e){for(var i,r=t.length,n=e^r,o=0;r>=4;)i=1540483477*(65535&(i=255&t.charCodeAt(o)|(255&t.charCodeAt(++o))<<8|(255&t.charCodeAt(++o))<<16|(255&t.charCodeAt(++o))<<24))+((1540483477*(i>>>16)&65535)<<16),n=1540483477*(65535&n)+((1540483477*(n>>>16)&65535)<<16)^(i=1540483477*(65535&(i^=i>>>24))+((1540483477*(i>>>16)&65535)<<16)),r-=4,++o;switch(r){case 3:n^=(255&t.charCodeAt(o+2))<<16;case 2:n^=(255&t.charCodeAt(o+1))<<8;case 1:n=1540483477*(65535&(n^=255&t.charCodeAt(o)))+((1540483477*(n>>>16)&65535)<<16)}return n=1540483477*(65535&(n^=n>>>13))+((1540483477*(n>>>16)&65535)<<16),(n^=n>>>15)>>>0};var Is=Cs,Ms=Ss.exports;Bs.exports=Is,Bs.exports.murmur3=Is,Bs.exports.murmur2=Ms;var ks=d(Bs.exports);class Ps{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,e,i,r){this.ids.push(Ls(t)),this.positions.push(e,i,r)}getPositions(t){const e=Ls(t);let i=0,r=this.ids.length-1;for(;i<r;){const t=i+r>>1;this.ids[t]>=e?r=t:i=t+1}const n=[];for(;this.ids[i]===e;)n.push({index:this.positions[3*i],start:this.positions[3*i+1],end:this.positions[3*i+2]}),i++;return n}static serialize(t,e){const i=new Float64Array(t.ids),r=new Uint32Array(t.positions);return zs(i,r,0,i.length-1),e&&e.push(i.buffer,r.buffer),{ids:i,positions:r}}static deserialize(t){const e=new Ps;return e.ids=t.ids,e.positions=t.positions,e.indexed=!0,e}}function Ls(t){const e=+t;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:ks(String(t))}function zs(t,e,i,r){for(;i<r;){const n=t[i+r>>1];let o=i-1,s=r+1;for(;;){do{o++}while(t[o]<n);do{s--}while(t[s]>n);if(o>=s)break;Fs(t,o,s),Fs(e,3*o,3*s),Fs(e,3*o+1,3*s+1),Fs(e,3*o+2,3*s+2)}s-i<r-s?(zs(t,e,i,s),i=s+1):(zs(t,e,s+1,r),r=s)}}function Fs(t,e,i){const r=t[e];t[e]=t[i],t[i]=r}Kn(Ps,"FeaturePositionMap");class Ds{constructor(t){this.gl=t.gl,this.initialized=!1}fetchUniformLocation(t,e){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(t,e),this.initialized=!0),!!this.location}}class Rs extends Ds{constructor(t){super(t),this.current=0}set(t,e,i){this.fetchUniformLocation(t,e)&&this.current!==i&&(this.current=i,this.gl.uniform1f(this.location,i))}}class Us extends Ds{constructor(t){super(t),this.current=[0,0,0,0]}set(t,e,i){this.fetchUniformLocation(t,e)&&(i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]&&i[3]===this.current[3]||(this.current=i,this.gl.uniform4f(this.location,i[0],i[1],i[2],i[3])))}}class Os extends Ds{constructor(t){super(t),this.current=ke.transparent}set(t,e,i){this.fetchUniformLocation(t,e)&&(i.r===this.current.r&&i.g===this.current.g&&i.b===this.current.b&&i.a===this.current.a||(this.current=i,this.gl.uniform4f(this.location,i.r,i.g,i.b,i.a)))}}const Ns=new Float32Array(16),Qs=new Float32Array(9),Vs=new Float32Array(4);function js(t){return[Fo(255*t.r,255*t.g),Fo(255*t.b,255*t.a)]}class Hs{constructor(t,e,i){this.value=t,this.uniformNames=e.map((t=>`u_${t}`)),this.type=i}setUniform(t,e,i,r,n){e.set(t,n,r.constantOr(this.value))}getBinding(t,e){return"color"===this.type?new Os(t):new Rs(t)}}class Gs{constructor(t,e){this.uniformNames=e.map((t=>`u_${t}`)),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(t){this.pixelRatio=t.pixelRatio||1,this.pattern=t.tl.concat(t.br)}setUniform(t,e,i,r,n){const o="u_pattern"===n||"u_dash"===n?this.pattern:"u_pixel_ratio"===n?this.pixelRatio:null;o&&e.set(t,n,o)}getBinding(t,e){return"u_pattern"===e||"u_dash"===e?new Us(t):new Rs(t)}}class $s{constructor(t,e,i,r){this.expression=t,this.type=i,this.maxValue=0,this.paintVertexAttributes=e.map((t=>({name:`a_${t}`,type:"Float32",components:"color"===i?2:1,offset:0}))),this.paintVertexArray=new r}populatePaintArray(t,e,i,r,n,o){const s=this.paintVertexArray.length,a=this.expression.evaluate(new bo(0),e,{},n,r,o);this.paintVertexArray.resize(t),this._setPaintValue(s,t,a)}updatePaintArray(t,e,i,r,n){const o=this.expression.evaluate({zoom:0},i,r,void 0,n);this._setPaintValue(t,e,o)}_setPaintValue(t,e,i){if("color"===this.type){const r=js(i);for(let i=t;i<e;i++)this.paintVertexArray.emplace(i,r[0],r[1])}else{for(let r=t;r<e;r++)this.paintVertexArray.emplace(r,i);this.maxValue=Math.max(this.maxValue,Math.abs(i))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Zs{constructor(t,e,i,r,n,o){this.expression=t,this.uniformNames=e.map((t=>`u_${t}_t`)),this.type=i,this.useIntegerZoom=r,this.zoom=n,this.maxValue=0,this.paintVertexAttributes=e.map((t=>({name:`a_${t}`,type:"Float32",components:"color"===i?4:2,offset:0}))),this.paintVertexArray=new o}populatePaintArray(t,e,i,r,n,o){const s=this.expression.evaluate(new bo(this.zoom),e,{},n,r,o),a=this.expression.evaluate(new bo(this.zoom+1),e,{},n,r,o),l=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(l,t,s,a)}updatePaintArray(t,e,i,r,n){const o=this.expression.evaluate({zoom:this.zoom},i,r,void 0,n),s=this.expression.evaluate({zoom:this.zoom+1},i,r,void 0,n);this._setPaintValue(t,e,o,s)}_setPaintValue(t,e,i,r){if("color"===this.type){const n=js(i),o=js(r);for(let i=t;i<e;i++)this.paintVertexArray.emplace(i,n[0],n[1],o[0],o[1])}else{for(let n=t;n<e;n++)this.paintVertexArray.emplace(n,i,r);this.maxValue=Math.max(this.maxValue,Math.abs(i),Math.abs(r))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,e,i,r,n){const o=this.useIntegerZoom?Math.floor(i.zoom):i.zoom,s=C(this.expression.interpolationFactor(o,this.zoom,this.zoom+1),0,1);e.set(t,n,s)}getBinding(t,e){return new Rs(t)}}class qs{constructor(t,e,i,r,n){this.expression=t,this.layerId=n,this.paintVertexAttributes=("array"===i?Ts:ws).members;for(let t=0;t<e.length;++t);this.paintVertexArray=new r}populatePaintArray(t,e,i){const r=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValues(r,t,e.patterns&&e.patterns[this.layerId],i)}updatePaintArray(t,e,i,r,n,o){this._setPaintValues(t,e,i.patterns&&i.patterns[this.layerId],o)}_setPaintValues(t,e,i,r){if(!r||!i)return;const n=r[i];if(!n)return;const{tl:o,br:s,pixelRatio:a}=n;for(let i=t;i<e;i++)this.paintVertexArray.emplace(i,o[0],o[1],s[0],s[1],a)}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Ks{constructor(t,e,i=(()=>!0)){this.binders={},this._buffers=[];const r=[];for(const n in t.paint._values){if(!i(n))continue;const o=t.paint.get(n);if(!(o instanceof Io&&Fr(o.property.specification)))continue;const s=Js(n,t.type),a=o.value,l=o.property.specification.type,c=!!o.property.useIntegerZoom,u="line-dasharray"===n||n.endsWith("pattern"),h="line-dasharray"===n&&"constant"!==t.layout.get("line-cap").value.kind;if("constant"!==a.kind||h)if("source"===a.kind||h||u){const e=ea(n,l,"source");this.binders[n]=u?new qs(a,s,l,e,t.id):new $s(a,s,l,e),r.push(`/a_${n}`)}else{const t=ea(n,l,"composite");this.binders[n]=new Zs(a,s,l,c,e,t),r.push(`/z_${n}`)}else this.binders[n]=u?new Gs(a.value,s):new Hs(a.value,s,l),r.push(`/u_${n}`)}this.cacheKey=r.sort().join("")}getMaxValue(t){const e=this.binders[t];return e instanceof $s||e instanceof Zs?e.maxValue:0}populatePaintArrays(t,e,i,r,n,o){for(const s in this.binders){const a=this.binders[s];(a instanceof $s||a instanceof Zs||a instanceof qs)&&a.populatePaintArray(t,e,i,r,n,o)}}setConstantPatternPositions(t){for(const e in this.binders){const i=this.binders[e];i instanceof Gs&&i.setConstantPatternPositions(t)}}updatePaintArrays(t,e,i,r,n,o){let s=!1;for(const a in t){const l=e.getPositions(a);for(const e of l){const l=i.feature(e.index);for(const i in this.binders){const c=this.binders[i];if((c instanceof $s||c instanceof Zs||c instanceof qs)&&!0===c.expression.isStateDependent){const u=r.paint.get(i);c.expression=u.value,c.updatePaintArray(e.start,e.end,l,t[a],n,o),s=!0}}}}return s}defines(){const t=[];for(const e in this.binders){const i=this.binders[e];(i instanceof Hs||i instanceof Gs)&&t.push(...i.uniformNames.map((t=>`#define HAS_UNIFORM_${t}`)))}return t}getBinderAttributes(){const t=[];for(const e in this.binders){const i=this.binders[e];if(i instanceof $s||i instanceof Zs||i instanceof qs)for(let e=0;e<i.paintVertexAttributes.length;e++)t.push(i.paintVertexAttributes[e].name)}return t}getBinderUniforms(){const t=[];for(const e in this.binders){const i=this.binders[e];if(i instanceof Hs||i instanceof Gs||i instanceof Zs)for(const e of i.uniformNames)t.push(e)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t){const e=[];for(const i in this.binders){const r=this.binders[i];if(r instanceof Hs||r instanceof Gs||r instanceof Zs)for(const n of r.uniformNames)e.push({name:n,property:i,binding:r.getBinding(t,n)})}return e}setUniforms(t,e,i,r,n){for(const{name:e,property:o,binding:s}of i)this.binders[o].setUniform(t,s,n,r.get(o),e)}updatePaintBuffers(){this._buffers=[];for(const t in this.binders){const e=this.binders[t];(e instanceof $s||e instanceof Zs||e instanceof qs)&&e.paintVertexBuffer&&this._buffers.push(e.paintVertexBuffer)}}upload(t){for(const e in this.binders){const i=this.binders[e];(i instanceof $s||i instanceof Zs||i instanceof qs)&&i.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const e=this.binders[t];(e instanceof $s||e instanceof Zs||e instanceof qs)&&e.destroy()}}}class Ws{constructor(t,e,i=(()=>!0)){this.programConfigurations={};for(const r of t)this.programConfigurations[r.id]=new Ks(r,e,i);this.needsUpload=!1,this._featureMap=new Ps,this._bufferOffset=0}populatePaintArrays(t,e,i,r,n,o,s){for(const i in this.programConfigurations)this.programConfigurations[i].populatePaintArrays(t,e,r,n,o,s);void 0!==e.id&&this._featureMap.add(e.id,i,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,e,i,r,n){for(const o of i)this.needsUpload=this.programConfigurations[o.id].updatePaintArrays(t,this._featureMap,e,o,r,n)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const e in this.programConfigurations)this.programConfigurations[e].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}const Xs={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function Js(t,e){return Xs[t]||[t.replace(`${e}-`,"").replace(/-/g,"_")]}const Ys={"line-pattern":{source:$o,composite:$o},"fill-pattern":{source:$o,composite:$o},"fill-extrusion-pattern":{source:$o,composite:$o},"line-dasharray":{source:Zo,composite:Zo}},ta={color:{source:hs,composite:Go},number:{source:ss,composite:hs}};function ea(t,e,i){const r=Ys[t];return r&&r[i]||ta[e][i]}Kn(Hs,"ConstantBinder"),Kn(Gs,"PatternConstantBinder"),Kn($s,"SourceExpressionBinder"),Kn(qs,"PatternCompositeBinder"),Kn(Zs,"CompositeExpressionBinder"),Kn(Ks,"ProgramConfiguration",{omit:["_buffers"]}),Kn(Ws,"ProgramConfigurationSet");const ia="-transition";class ra extends Yt{constructor(t,e){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,"custom"!==t.type&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,"background"!==t.type&&"sky"!==t.type&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),e.layout&&(this._unevaluatedLayout=new So(e.layout)),e.paint)){this._transitionablePaint=new Bo(e.paint);for(const e in t.paint)this.setPaintProperty(e,t.paint[e],{validate:!1});for(const e in t.layout)this.setLayoutProperty(e,t.layout[e],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Mo(e.paint)}}getLayoutProperty(t){return"visibility"===t?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,e,i={}){null!=e&&this._validate(Qn,`layers.${this.id}.layout.${t}`,t,e,i)||("visibility"!==t?this._unevaluatedLayout.setValue(t,e):this.visibility=e)}getPaintProperty(t){return O(t,ia)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,e,i={}){if(null!=e&&this._validate(Nn,`layers.${this.id}.paint.${t}`,t,e,i))return!1;if(O(t,ia))return this._transitionablePaint.setTransition(t.slice(0,-11),e||void 0),!1;{const i=this._transitionablePaint._values[t],r=i.value.isDataDriven(),n=i.value;this._transitionablePaint.setValue(t,e),this._handleSpecialPaintPropertyUpdate(t);const o=this._transitionablePaint._values[t].value,s=o.isDataDriven(),a=O(t,"pattern")||"line-dasharray"===t;return s||r||a||this._handleOverridablePaintPropertyUpdate(t,n,o)}}_handleSpecialPaintPropertyUpdate(t){}getProgramIds(){return null}getProgramConfiguration(t){return null}_handleOverridablePaintPropertyUpdate(t,e,i){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||"none"===this.visibility}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,e){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,e)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,e)}serialize(){const t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),Q(t,((t,e)=>!(void 0===t||"layout"===e&&!Object.keys(t).length||"paint"===e&&!Object.keys(t).length)))}_validate(t,e,i,r,n={}){return(!n||!1!==n.validate)&&jn(this,t.call(On,{key:e,layerType:this.type,objectKey:i,value:r,styleSpec:te,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){const e=this.paint.get(t);if(e instanceof Io&&Fr(e.property.specification)&&("source"===e.value.kind||"composite"===e.value.kind)&&e.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=hn(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const na=Oo([{name:"a_pos",components:2,type:"Int16"}],4),oa=Oo([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class sa{constructor(t=[]){this.segments=t}prepareSegment(t,e,i,r){let n=this.segments[this.segments.length-1];return t>sa.MAX_VERTEX_ARRAY_LENGTH&&H(`Max vertices per segment is ${sa.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!n||n.vertexLength+t>sa.MAX_VERTEX_ARRAY_LENGTH||n.sortKey!==r)&&(n={vertexOffset:e.length,primitiveOffset:i.length,vertexLength:0,primitiveLength:0},void 0!==r&&(n.sortKey=r),this.segments.push(n)),n}get(){return this.segments}destroy(){for(const t of this.segments)for(const e in t.vaos)t.vaos[e].destroy()}static simpleSegment(t,e,i,r){return new sa([{vertexOffset:t,primitiveOffset:e,vertexLength:i,primitiveLength:r,vaos:{},sortKey:0}])}}sa.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Kn(sa,"SegmentVector");var aa=8192;class la{constructor(t,e){t&&(e?this.setSouthWest(t).setNorthEast(e):4===t.length?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))}setNorthEast(t){return this._ne=t instanceof Vl?new Vl(t.lng,t.lat):Vl.convert(t),this}setSouthWest(t){return this._sw=t instanceof Vl?new Vl(t.lng,t.lat):Vl.convert(t),this}extend(t){const e=this._sw,i=this._ne;let r,n;if(t instanceof Vl)r=t,n=t;else{if(!(t instanceof la))return Array.isArray(t)?4===t.length||t.every(Array.isArray)?this.extend(la.convert(t)):this.extend(Vl.convert(t)):"object"==typeof t&&null!==t&&t.hasOwnProperty("lat")&&(t.hasOwnProperty("lon")||t.hasOwnProperty("lng"))?this.extend(Vl.convert(t)):this;if(r=t._sw,n=t._ne,!r||!n)return this}return e||i?(e.lng=Math.min(r.lng,e.lng),e.lat=Math.min(r.lat,e.lat),i.lng=Math.max(n.lng,i.lng),i.lat=Math.max(n.lat,i.lat)):(this._sw=new Vl(r.lng,r.lat),this._ne=new Vl(n.lng,n.lat)),this}getCenter(){return new Vl((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Vl(this.getWest(),this.getNorth())}getSouthEast(){return new Vl(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:e,lat:i}=Vl.convert(t);let r=this._sw.lng<=e&&e<=this._ne.lng;return this._sw.lng>this._ne.lng&&(r=this._sw.lng>=e&&e>=this._ne.lng),this._sw.lat<=i&&i<=this._ne.lat&&r}static convert(t){return!t||t instanceof la?t:new la(t)}}var ca=1e-6,ua="undefined"!=typeof Float32Array?Float32Array:Array;function ha(){var t=new ua(9);return ua!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function da(t,e,i){var r=e[0],n=e[1],o=e[2],s=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=e[8],d=i[0],p=i[1],f=i[2],A=i[3],m=i[4],g=i[5],_=i[6],y=i[7],v=i[8];return t[0]=d*r+p*s+f*c,t[1]=d*n+p*a+f*u,t[2]=d*o+p*l+f*h,t[3]=A*r+m*s+g*c,t[4]=A*n+m*a+g*u,t[5]=A*o+m*l+g*h,t[6]=_*r+y*s+v*c,t[7]=_*n+y*a+v*u,t[8]=_*o+y*l+v*h,t}function pa(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function fa(t,e){var i=e[0],r=e[1],n=e[2],o=e[3],s=e[4],a=e[5],l=e[6],c=e[7],u=e[8],h=e[9],d=e[10],p=e[11],f=e[12],A=e[13],m=e[14],g=e[15],_=i*a-r*s,y=i*l-n*s,v=i*c-o*s,x=r*l-n*a,b=r*c-o*a,w=n*c-o*l,T=u*A-h*f,B=u*m-d*f,E=u*g-p*f,C=h*m-d*A,S=h*g-p*A,I=d*g-p*m,M=_*I-y*S+v*C+x*E-b*B+w*T;return M?(t[0]=(a*I-l*S+c*C)*(M=1/M),t[1]=(n*S-r*I-o*C)*M,t[2]=(A*w-m*b+g*x)*M,t[3]=(d*b-h*w-p*x)*M,t[4]=(l*E-s*I-c*B)*M,t[5]=(i*I-n*E+o*B)*M,t[6]=(m*v-f*w-g*y)*M,t[7]=(u*w-d*v+p*y)*M,t[8]=(s*S-a*E+c*T)*M,t[9]=(r*E-i*S-o*T)*M,t[10]=(f*b-A*v+g*_)*M,t[11]=(h*v-u*b-p*_)*M,t[12]=(a*B-s*C-l*T)*M,t[13]=(i*C-r*B+n*T)*M,t[14]=(A*y-f*x-m*_)*M,t[15]=(u*x-h*y+d*_)*M,t):null}function Aa(t,e,i){var r=e[0],n=e[1],o=e[2],s=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=e[8],d=e[9],p=e[10],f=e[11],A=e[12],m=e[13],g=e[14],_=e[15],y=i[0],v=i[1],x=i[2],b=i[3];return t[0]=y*r+v*a+x*h+b*A,t[1]=y*n+v*l+x*d+b*m,t[2]=y*o+v*c+x*p+b*g,t[3]=y*s+v*u+x*f+b*_,t[4]=(y=i[4])*r+(v=i[5])*a+(x=i[6])*h+(b=i[7])*A,t[5]=y*n+v*l+x*d+b*m,t[6]=y*o+v*c+x*p+b*g,t[7]=y*s+v*u+x*f+b*_,t[8]=(y=i[8])*r+(v=i[9])*a+(x=i[10])*h+(b=i[11])*A,t[9]=y*n+v*l+x*d+b*m,t[10]=y*o+v*c+x*p+b*g,t[11]=y*s+v*u+x*f+b*_,t[12]=(y=i[12])*r+(v=i[13])*a+(x=i[14])*h+(b=i[15])*A,t[13]=y*n+v*l+x*d+b*m,t[14]=y*o+v*c+x*p+b*g,t[15]=y*s+v*u+x*f+b*_,t}function ma(t,e,i){var r,n,o,s,a,l,c,u,h,d,p,f,A=i[0],m=i[1],g=i[2];return e===t?(t[12]=e[0]*A+e[4]*m+e[8]*g+e[12],t[13]=e[1]*A+e[5]*m+e[9]*g+e[13],t[14]=e[2]*A+e[6]*m+e[10]*g+e[14],t[15]=e[3]*A+e[7]*m+e[11]*g+e[15]):(n=e[1],o=e[2],s=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=e[8],d=e[9],p=e[10],f=e[11],t[0]=r=e[0],t[1]=n,t[2]=o,t[3]=s,t[4]=a,t[5]=l,t[6]=c,t[7]=u,t[8]=h,t[9]=d,t[10]=p,t[11]=f,t[12]=r*A+a*m+h*g+e[12],t[13]=n*A+l*m+d*g+e[13],t[14]=o*A+c*m+p*g+e[14],t[15]=s*A+u*m+f*g+e[15]),t}function ga(t,e,i){var r=i[0],n=i[1],o=i[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function _a(t,e,i){var r=Math.sin(i),n=Math.cos(i),o=e[4],s=e[5],a=e[6],l=e[7],c=e[8],u=e[9],h=e[10],d=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=o*n+c*r,t[5]=s*n+u*r,t[6]=a*n+h*r,t[7]=l*n+d*r,t[8]=c*n-o*r,t[9]=u*n-s*r,t[10]=h*n-a*r,t[11]=d*n-l*r,t}function ya(t,e,i){var r=Math.sin(i),n=Math.cos(i),o=e[0],s=e[1],a=e[2],l=e[3],c=e[8],u=e[9],h=e[10],d=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*n-c*r,t[1]=s*n-u*r,t[2]=a*n-h*r,t[3]=l*n-d*r,t[8]=o*r+c*n,t[9]=s*r+u*n,t[10]=a*r+h*n,t[11]=l*r+d*n,t}function va(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function xa(t,e,i){var r,n,o,s=i[0],a=i[1],l=i[2],c=Math.hypot(s,a,l);return c<ca?null:(s*=c=1/c,a*=c,l*=c,r=Math.sin(e),n=Math.cos(e),t[0]=s*s*(o=1-n)+n,t[1]=a*s*o+l*r,t[2]=l*s*o-a*r,t[3]=0,t[4]=s*a*o-l*r,t[5]=a*a*o+n,t[6]=l*a*o+s*r,t[7]=0,t[8]=s*l*o+a*r,t[9]=a*l*o-s*r,t[10]=l*l*o+n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var ba=Aa;function wa(){var t=new ua(3);return ua!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function Ta(t){var e=new ua(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function Ba(t){return Math.hypot(t[0],t[1],t[2])}function Ea(t,e,i){var r=new ua(3);return r[0]=t,r[1]=e,r[2]=i,r}function Ca(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t}function Sa(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t}function Ia(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t}function Ma(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t[2]=Math.min(e[2],i[2]),t}function ka(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t[2]=Math.max(e[2],i[2]),t}function Pa(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t}function La(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t}function za(t,e){var i=e[0],r=e[1],n=e[2],o=i*i+r*r+n*n;return o>0&&(o=1/Math.sqrt(o)),t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o,t}function Fa(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function Da(t,e,i){var r=e[0],n=e[1],o=e[2],s=i[0],a=i[1],l=i[2];return t[0]=n*l-o*a,t[1]=o*s-r*l,t[2]=r*a-n*s,t}function Ra(t,e,i){var r=e[0],n=e[1],o=e[2],s=i[3]*r+i[7]*n+i[11]*o+i[15];return t[0]=(i[0]*r+i[4]*n+i[8]*o+i[12])/(s=s||1),t[1]=(i[1]*r+i[5]*n+i[9]*o+i[13])/s,t[2]=(i[2]*r+i[6]*n+i[10]*o+i[14])/s,t}function Ua(t,e,i){var r=i[0],n=i[1],o=i[2],s=e[0],a=e[1],l=e[2],c=n*l-o*a,u=o*s-r*l,h=r*a-n*s,d=n*h-o*u,p=o*c-r*h,f=r*u-n*c,A=2*i[3];return u*=A,h*=A,p*=2,f*=2,t[0]=s+(c*=A)+(d*=2),t[1]=a+u+p,t[2]=l+h+f,t}var Oa,Na=Sa,Qa=Ia,Va=Ba;function ja(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t}function Ha(t,e){var i=e[0],r=e[1],n=e[2],o=e[3],s=i*i+r*r+n*n+o*o;return s>0&&(s=1/Math.sqrt(s)),t[0]=i*s,t[1]=r*s,t[2]=n*s,t[3]=o*s,t}function Ga(t,e,i){var r=e[0],n=e[1],o=e[2],s=e[3];return t[0]=i[0]*r+i[4]*n+i[8]*o+i[12]*s,t[1]=i[1]*r+i[5]*n+i[9]*o+i[13]*s,t[2]=i[2]*r+i[6]*n+i[10]*o+i[14]*s,t[3]=i[3]*r+i[7]*n+i[11]*o+i[15]*s,t}function $a(){var t=new ua(4);return ua!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function Za(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function qa(t,e,i){i*=.5;var r=e[0],n=e[1],o=e[2],s=e[3],a=Math.sin(i),l=Math.cos(i);return t[0]=r*l+s*a,t[1]=n*l+o*a,t[2]=o*l-n*a,t[3]=s*l-r*a,t}function Ka(t,e,i){i*=.5;var r=e[0],n=e[1],o=e[2],s=e[3],a=Math.sin(i),l=Math.cos(i);return t[0]=r*l-o*a,t[1]=n*l+s*a,t[2]=o*l+r*a,t[3]=s*l-n*a,t}wa(),Oa=new ua(4),ua!=Float32Array&&(Oa[0]=0,Oa[1]=0,Oa[2]=0,Oa[3]=0);var Wa=Ha;wa(),Ea(1,0,0),Ea(0,1,0),$a(),$a(),ha();const Xa=Oo([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Ja}=Xa,Ya=Oo([{name:"a_pos_3",components:3,type:"Int16"}]);var tl=Oo([{name:"a_pos",type:"Int16",components:2}]);class el{constructor(t,e){this.pos=t,this.dir=e}intersectsPlane(t,e,i){const r=Fa(e,this.dir);if(Math.abs(r)<1e-6)return!1;const n=((t[0]-this.pos[0])*e[0]+(t[1]-this.pos[1])*e[1]+(t[2]-this.pos[2])*e[2])/r;return i[0]=this.pos[0]+this.dir[0]*n,i[1]=this.pos[1]+this.dir[1]*n,i[2]=this.pos[2]+this.dir[2]*n,!0}closestPointOnSphere(t,e,i){if(function(t,e){var i=t[0],r=t[1],n=t[2],o=e[0],s=e[1],a=e[2];return Math.abs(i-o)<=ca*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(r-s)<=ca*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(n-a)<=ca*Math.max(1,Math.abs(n),Math.abs(a))}(this.pos,t)||0===e)return i[0]=i[1]=i[2]=0,!1;const[r,n,o]=this.dir,s=this.pos[0]-t[0],a=this.pos[1]-t[1],l=this.pos[2]-t[2],c=r*r+n*n+o*o,u=2*(s*r+a*n+l*o),h=u*u-4*c*(s*s+a*a+l*l-e*e);if(h<0){const t=Math.max(-u/2,0),c=s+r*t,h=a+n*t,d=l+o*t,p=Math.hypot(c,h,d);return i[0]=c*e/p,i[1]=h*e/p,i[2]=d*e/p,!1}{const t=(-u-Math.sqrt(h))/(2*c);if(t<0){const t=Math.hypot(s,a,l);return i[0]=s*e/t,i[1]=a*e/t,i[2]=l*e/t,!1}return i[0]=s+r*t,i[1]=a+n*t,i[2]=l+o*t,!0}}}class il{constructor(t,e,i,r,n){this.TL=t,this.TR=e,this.BR=i,this.BL=r,this.horizon=n}static fromInvProjectionMatrix(t,e,i){const r=[-1,1,1],n=[1,1,1],o=[1,-1,1],s=[-1,-1,1],a=Ra(r,r,t),l=Ra(n,n,t),c=Ra(o,o,t),u=Ra(s,s,t);return new il(a,l,c,u,e/i)}}class rl{constructor(t,e){this.points=t,this.planes=e}static fromInvProjectionMatrix(t,e,i,r){const n=Math.pow(2,i),o=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((i=>{const o=Ga([],i,t),s=1/o[3]/e*n;return function(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t[3]=e[3]*i[3],t}(o,o,[s,s,r?1/o[3]:s,s])})),s=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map((t=>{const e=za([],Da([],Na([],o[t[0]],o[t[1]]),Na([],o[t[2]],o[t[1]]))),i=-Fa(e,o[t[1]]);return e.concat(i)}));return new rl(o,s)}}class nl{static fromPoints(t){const e=[1/0,1/0,1/0],i=[-1/0,-1/0,-1/0];for(const r of t)Ma(e,e,r),ka(i,i,r);return new nl(e,i)}static applyTransform(t,e){const i=t.getCorners();for(let t=0;t<i.length;++t)Ra(i[t],i[t],e);return nl.fromPoints(i)}constructor(t,e){this.min=t,this.max=e,this.center=Pa([],Ca([],this.min,this.max),.5)}quadrant(t){const e=[t%2==0,t<2],i=Ta(this.min),r=Ta(this.max);for(let t=0;t<e.length;t++)i[t]=e[t]?this.min[t]:this.center[t],r[t]=e[t]?this.center[t]:this.max[t];return r[2]=this.max[2],new nl(i,r)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}distanceZ(t){return Math.max(Math.min(this.max[2],t[2]),this.min[2])-t[2]}getCorners(){const t=this.min,e=this.max;return[[t[0],t[1],t[2]],[e[0],t[1],t[2]],[e[0],e[1],t[2]],[t[0],e[1],t[2]],[t[0],t[1],e[2]],[e[0],t[1],e[2]],[e[0],e[1],e[2]],[t[0],e[1],e[2]]]}intersects(t){const e=this.getCorners();let i=!0;for(let r=0;r<t.planes.length;r++){const n=t.planes[r];let o=0;for(let t=0;t<e.length;t++)o+=Fa(n,e[t])+n[3]>=0;if(0===o)return 0;o!==e.length&&(i=!1)}if(i)return 2;for(let e=0;e<3;e++){let i=Number.MAX_VALUE,r=-Number.MAX_VALUE;for(let n=0;n<t.points.length;n++){const o=t.points[n][e]-this.min[e];i=Math.min(i,o),r=Math.max(r,o)}if(r<0||i>this.max[e]-this.min[e])return 0}return 1}}const ol=5,sl=6,al=aa/Math.PI/2,ll=16383,cl=64,ul=[cl,32,16],hl=-al,dl=al,pl=[new nl([hl,hl,hl],[dl,dl,dl]),new nl([hl,hl,hl],[0,0,dl]),new nl([0,hl,hl],[dl,0,dl]),new nl([hl,0,hl],[0,dl,dl]),new nl([0,0,hl],[dl,dl,dl])];function fl(t){return t*al/Ol}function Al(t,e,i,r=!0){const n=Pa([],t._camera.position,t.worldSize),o=[e,i,1,1];Ga(o,o,t.pixelMatrixInverse),ja(o,o,1/o[3]);const s=za([],Na([],o,n)),a=t.globeMatrix,l=[a[12],a[13],a[14]],c=Na([],l,n),u=Ba(c),h=za([],c),d=t.worldSize/(2*Math.PI),p=Fa(h,s),f=Math.asin(d/u);if(f<Math.acos(p)){if(!r)return null;const t=[],e=[];Pa(t,s,u/p),za(e,Na(e,t,c)),za(s,Ca(s,c,Pa(s,e,Math.tan(f)*u)))}const A=[];new el(n,s).closestPointOnSphere(l,d,A);const m=za([],J(a,0)),g=za([],J(a,1)),_=za([],J(a,2)),y=Fa(m,A),v=Fa(g,A),x=Fa(_,A),w=b(Math.asin(-v/d));let T=b(Math.atan2(y,x));T=t.center.lng+function(t,e){const i=(e-t+180)%360-180;return i<-180?i+360:i}(t.center.lng,T);const B=Hl(T),E=C(Gl(w),0,1);return new Jl(B,E)}class ml{constructor(t,e,i){this.a=Na([],t,i),this.b=Na([],e,i),this.center=i;const r=za([],this.a),n=za([],this.b);this.angle=Math.acos(Fa(r,n))}}function gl(t,e){if(0===t.angle)return null;let i;return i=0===t.a[e]?1/t.angle*.5*Math.PI:1/t.angle*Math.atan(t.b[e]/t.a[e]/Math.sin(t.angle)-1/Math.tan(t.angle)),i<0||i>1?null:function(t,e,i,r){const n=Math.sin(i);return t*(Math.sin((1-r)*i)/n)+e*(Math.sin(r*i)/n)}(t.a[e],t.b[e],t.angle,C(i,0,1))+t.center[e]}function _l(t){if(t.z<=1)return pl[t.z+2*t.y+t.x];const e=Tl(wl(t));return nl.fromPoints(e)}function yl(t,e,i){return Pa(t,t,1-i),La(t,t,e,i)}function vl(t,e){const i=Ll(e.zoom);if(0===i)return _l(t);const r=wl(t),n=Tl(r),o=Hl(r.getWest())*e.worldSize,s=Hl(r.getEast())*e.worldSize,a=Gl(r.getNorth())*e.worldSize,l=Gl(r.getSouth())*e.worldSize,c=[o,a,0],u=[s,a,0],h=[o,l,0],d=[s,l,0],p=fa([],e.globeMatrix);return Ra(c,c,p),Ra(u,u,p),Ra(h,h,p),Ra(d,d,p),n[0]=yl(n[0],h,i),n[1]=yl(n[1],d,i),n[2]=yl(n[2],u,i),n[3]=yl(n[3],c,i),nl.fromPoints(n)}function xl(t,e,i){for(const r of t)Ra(r,r,e),Pa(r,r,i)}function bl(t,e,i){const r=e/t.worldSize,n=t.globeMatrix;if(i.z<=1){const t=_l(i).getCorners();return xl(t,n,r),nl.fromPoints(t)}const o=wl(i),s=Tl(o);xl(s,n,r);const a=Number.MAX_VALUE,l=[-a,-a,-a],c=[a,a,a];if(o.contains(t.center)){for(const t of s)Ma(c,c,t),ka(l,l,t);l[2]=0;const e=t.point,i=[e.x*r,e.y*r,0];return Ma(c,c,i),ka(l,l,i),new nl(c,l)}const u=[n[12]*r,n[13]*r,n[14]*r],h=o.getCenter(),d=C(t.center.lat,-Wl,Wl),p=C(h.lat,-Wl,Wl),f=Hl(t.center.lng),A=Gl(d);let m=f-Hl(h.lng);const g=A-Gl(p);m>.5?m-=1:m<-.5&&(m+=1);let _=0;Math.abs(m)>Math.abs(g)?_=m>=0?1:3:(_=g>=0?0:2,La(u,u,[n[4]*r,n[5]*r,n[6]*r],-Math.sin(x(g>=0?o.getSouth():o.getNorth()))*al));const y=s[_],v=s[(_+1)%4],b=new ml(y,v,u),w=[gl(b,0)||y[0],gl(b,1)||y[1],gl(b,2)||y[2]],T=Ll(t.zoom);if(T>0){const r=function({x:t,y:e,z:i},r,n,o,s){const a=1/(1<<i);let l=t*a,c=l+a,u=e*a,h=u+a,d=0;const p=(l+c)/2-o;return p>.5?d=-1:p<-.5&&(d=1),l=((l+d)*r-(o*=r))*n+o,c=((c+d)*r-o)*n+o,u=(u*r-(s*=r))*n+s,h=(h*r-s)*n+s,[[l,h,0],[c,h,0],[c,u,0],[l,u,0]]}(i,e,t._pixelsPerMercatorPixel,f,A);for(let t=0;t<s.length;t++)yl(s[t],r[t],T);const n=Ca([],r[_],r[(_+1)%4]);Pa(n,n,.5),yl(w,n,T)}for(const t of s)Ma(c,c,t),ka(l,l,t);return c[2]=Math.min(y[2],v[2]),Ma(c,c,w),ka(l,l,w),new nl(c,l)}function wl({x:t,y:e,z:i}){const r=1/(1<<i),n=new Vl(Zl(t*r),ql((e+1)*r)),o=new Vl(Zl((t+1)*r),ql(e*r));return new la(n,o)}function Tl(t){const e=x(t.getNorth()),i=x(t.getSouth()),r=Math.cos(e),n=Math.cos(i),o=Math.sin(e),s=Math.sin(i),a=t.getWest(),l=t.getEast();return[Bl(n,s,a),Bl(n,s,l),Bl(r,o,l),Bl(r,o,a)]}function Bl(t,e,i,r=al){return i=x(i),[t*Math.sin(i)*r,-e*r,t*Math.cos(i)*r]}function El(t,e,i){return Bl(Math.cos(x(t)),Math.sin(x(t)),e,i)}function Cl(t,e,i,r){const n=1<<i.z,o=(t/aa+i.x)/n;return El(ql((e/aa+i.y)/n),Zl(o),r)}function Sl({min:t,max:e}){return ll/Math.max(e[0]-t[0],e[1]-t[1],e[2]-t[2])}const Il=new Float64Array(16);function Ml(t){const e=Sl(t),i=va(Il,[e,e,e]);return ma(i,i,((r=[])[0]=-(n=t.min)[0],r[1]=-n[1],r[2]=-n[2],r));var r,n}function kl(t){const e=(r=t.min,(i=Il)[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=r[0],i[13]=r[1],i[14]=r[2],i[15]=1,i);var i,r;const n=1/Sl(t);return ga(e,e,[n,n,n])}function Pl(t,e,i,r,n){const o=function(t){const e=aa/(2*Math.PI);return t/(2*Math.PI)/e}(i),s=[t,e,-i/(2*Math.PI)],a=pa(new Float64Array(16));return ma(a,a,s),ga(a,a,[o,o,o]),_a(a,a,x(-n)),ya(a,a,x(-r)),a}function Ll(t){return S(ol,sl,t)}function zl(t,e){const i=El(e.lat,e.lng),r=function(t){const e=El(t._center.lat,t._center.lng);let i=Da([],Ea(0,1,0),e);const r=xa([],-t.angle,e);i=Ra(i,i,r),xa(r,-t._pitch,i);const n=za([],e);return Pa(n,n,fl(t.cameraToCenterDistance/t.pixelsPerMeter)),Ra(n,n,r),Ca([],e,n)}(t);return s=(n=Sa([],r,i))[0],a=n[1],l=n[2],c=(o=i)[0],u=o[1],h=o[2],p=(d=Math.sqrt(s*s+a*a+l*l)*Math.sqrt(c*c+u*u+h*h))&&Fa(n,o)/d,Math.acos(Math.min(Math.max(p,-1),1));var n,o,s,a,l,c,u,h,d,p}function Fl(t,e){return zl(t,e)>Math.PI/2*1.01}const Dl=x(85),Rl=Math.cos(Dl),Ul=Math.sin(Dl),Ol=6371008.8,Nl=2*Math.PI*Ol;class Ql{constructor(t,e){if(isNaN(t)||isNaN(e))throw new Error(`Invalid LngLat object: (${t}, ${e})`);if(this.lng=+t,this.lat=+e,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Ql(I(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const e=Math.PI/180,i=this.lat*e,r=t.lat*e,n=Math.sin(i)*Math.sin(r)+Math.cos(i)*Math.cos(r)*Math.cos((t.lng-this.lng)*e);return Ol*Math.acos(Math.min(n,1))}toBounds(t=0){const e=360*t/40075017,i=e/Math.cos(Math.PI/180*this.lat);return new la(new Ql(this.lng-i,this.lat-e),new Ql(this.lng+i,this.lat+e))}toEcef(t){const e=fl(t);return El(this.lat,this.lng,al+e)}static convert(t){if(t instanceof Ql)return t;if(Array.isArray(t)&&(2===t.length||3===t.length))return new Ql(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&"object"==typeof t&&null!==t)return new Ql(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}var Vl=Ql;function jl(t){return Nl*Math.cos(t*Math.PI/180)}function Hl(t){return(180+t)/360}function Gl(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function $l(t,e){return t/jl(e)}function Zl(t){return 360*t-180}function ql(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function Kl(t,e){return t*jl(ql(e))}const Wl=85.051129;function Xl(t){return 1/Math.cos(t*Math.PI/180)}class Jl{constructor(t,e,i=0){this.x=+t,this.y=+e,this.z=+i}static fromLngLat(t,e=0){const i=Vl.convert(t);return new Jl(Hl(i.lng),Gl(i.lat),$l(e,i.lat))}toLngLat(){return new Vl(Zl(this.x),ql(this.y))}toAltitude(){return Kl(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Nl*Xl(ql(this.y))}}function Yl(t,e,i,r,n,o,s,a,l){const c=(e+r)/2,u=(i+n)/2,h=new _(c,u);a(h),function(t,e,i,r,n,o){const s=i-n,a=r-o;return Math.abs((r-e)*s-(i-t)*a)/Math.hypot(s,a)}(h.x,h.y,o.x,o.y,s.x,s.y)>=l?(Yl(t,e,i,c,u,o,h,a,l),Yl(t,c,u,r,n,h,s,a,l)):t.push(s)}function tc(t,e,i){let r=t[0],n=r.x,o=r.y;e(r);const s=[r];for(let a=1;a<t.length;a++){const l=t[a],{x:c,y:u}=l;e(l),Yl(s,n,o,c,u,r,l,e,i),n=c,o=u,r=l}return s}function ec(t,e,i,r){if(r(e,i)){const n=e.add(i)._mult(.5);ec(t,e,n,r),ec(t,n,i,r)}else t.push(i)}function ic(t,e){let i=t[0];const r=[i];for(let n=1;n<t.length;n++){const o=t[n];ec(r,i,o,e),i=o}return r}const rc=Math.pow(2,14)-1,nc=-rc-1;function oc(t,e){const i=Math.round(t.x*e),r=Math.round(t.y*e);return t.x=C(i,nc,rc),t.y=C(r,nc,rc),(i<t.x||i>t.x+1||r<t.y||r>t.y+1)&&H("Geometry exceeds allowed extent, reduce your vector tile buffer size"),t}function sc(t,e,i){const r=t.loadGeometry(),n=t.extent,o=aa/n;if(e&&i&&i.projection.isReprojectedInTileSpace){const o=1<<e.z,{scale:s,x:a,y:l,projection:c}=i,u=t=>{const i=Zl((e.x+t.x/n)/o),r=ql((e.y+t.y/n)/o),u=c.project(i,r);t.x=(u.x*s-a)*n,t.y=(u.y*s-l)*n};for(let e=0;e<r.length;e++)if(1!==t.type)r[e]=tc(r[e],u,1);else{const t=[];for(const i of r[e])i.x<0||i.x>=n||i.y<0||i.y>=n||(u(i),t.push(i));r[e]=t}}for(const t of r)for(const e of t)oc(e,o);return r}function ac(t,e){return{type:t.type,id:t.id,properties:t.properties,geometry:e?sc(t):[]}}function lc(t,e,i,r,n){t.emplaceBack(2*e+(r+1)/2,2*i+(n+1)/2)}function cc(t,e,i){const r=16384;t.emplaceBack(e.x,e.y,e.z,i[0]*r,i[1]*r,i[2]*r)}class uc{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((t=>t.id)),this.index=t.index,this.hasPattern=!1,this.projection=t.projection,this.layoutVertexArray=new Qo,this.indexArray=new rs,this.segments=new sa,this.programConfigurations=new Ws(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter((t=>t.isStateDependent())).map((t=>t.id))}populate(t,e,i,r){const n=this.layers[0],o=[];let s=null;"circle"===n.type&&(s=n.layout.get("circle-sort-key"));for(const{feature:e,id:n,index:a,sourceLayerIndex:l}of t){const t=this.layers[0]._featureFilter.needGeometry,c=ac(e,t);if(!this.layers[0]._featureFilter.filter(new bo(this.zoom),c,i))continue;const u=s?s.evaluate(c,{},i):void 0,h={id:n,properties:e.properties,type:e.type,sourceLayerIndex:l,index:a,geometry:t?c.geometry:sc(e,i,r),patterns:{},sortKey:u};o.push(h)}s&&o.sort(((t,e)=>t.sortKey-e.sortKey));let a=null;"globe"===r.projection.name&&(this.globeExtVertexArray=new qo,a=r.projection);for(const r of o){const{geometry:n,index:o,sourceLayerIndex:s}=r,l=t[o].feature;this.addFeature(r,n,o,e.availableImages,i,a),e.featureIndex.insert(l,n,o,s,this.index)}}update(t,e,i,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,i,r)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,na.members),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=t.createVertexBuffer(this.globeExtVertexArray,oa.members))),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(t,e,i,r,n,o){for(const i of e)for(const e of i){const i=e.x,r=e.y;if(i<0||i>=aa||r<0||r>=aa)continue;if(o){const t=o.projectTilePoint(i,r,n),e=o.upVector(n,i,r),s=this.globeExtVertexArray;cc(s,t,e),cc(s,t,e),cc(s,t,e),cc(s,t,e)}const s=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),a=s.vertexLength;lc(this.layoutVertexArray,i,r,-1,-1),lc(this.layoutVertexArray,i,r,1,-1),lc(this.layoutVertexArray,i,r,1,1),lc(this.layoutVertexArray,i,r,-1,1),this.indexArray.emplaceBack(a,a+1,a+2),this.indexArray.emplaceBack(a,a+2,a+3),s.vertexLength+=4,s.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,i,{},r,n)}}function hc(t,e){for(let i=0;i<t.length;i++)if(vc(e,t[i]))return!0;for(let i=0;i<e.length;i++)if(vc(t,e[i]))return!0;return!!Ac(t,e)}function dc(t,e,i){return!!vc(t,e)||!!gc(e,t,i)}function pc(t,e){if(1===t.length)return yc(e,t[0]);for(let i=0;i<e.length;i++){const r=e[i];for(let e=0;e<r.length;e++)if(vc(t,r[e]))return!0}for(let i=0;i<t.length;i++)if(yc(e,t[i]))return!0;for(let i=0;i<e.length;i++)if(Ac(t,e[i]))return!0;return!1}function fc(t,e,i){if(t.length>1){if(Ac(t,e))return!0;for(let r=0;r<e.length;r++)if(gc(e[r],t,i))return!0}for(let r=0;r<t.length;r++)if(gc(t[r],e,i))return!0;return!1}function Ac(t,e){if(0===t.length||0===e.length)return!1;for(let i=0;i<t.length-1;i++){const r=t[i],n=t[i+1];for(let t=0;t<e.length-1;t++)if(mc(r,n,e[t],e[t+1]))return!0}return!1}function mc(t,e,i,r){return G(t,i,r)!==G(e,i,r)&&G(t,e,i)!==G(t,e,r)}function gc(t,e,i){const r=i*i;if(1===e.length)return t.distSqr(e[0])<r;for(let i=1;i<e.length;i++)if(_c(t,e[i-1],e[i])<r)return!0;return!1}function _c(t,e,i){const r=e.distSqr(i);if(0===r)return t.distSqr(e);const n=((t.x-e.x)*(i.x-e.x)+(t.y-e.y)*(i.y-e.y))/r;return t.distSqr(n<0?e:n>1?i:i.sub(e)._mult(n)._add(e))}function yc(t,e){let i,r,n,o=!1;for(let s=0;s<t.length;s++){i=t[s];for(let t=0,s=i.length-1;t<i.length;s=t++)r=i[t],n=i[s],r.y>e.y!=n.y>e.y&&e.x<(n.x-r.x)*(e.y-r.y)/(n.y-r.y)+r.x&&(o=!o)}return o}function vc(t,e){let i=!1;for(let r=0,n=t.length-1;r<t.length;n=r++){const o=t[r],s=t[n];o.y>e.y!=s.y>e.y&&e.x<(s.x-o.x)*(e.y-o.y)/(s.y-o.y)+o.x&&(i=!i)}return i}function xc(t,e,i,r,n){for(const o of t)if(e<=o.x&&i<=o.y&&r>=o.x&&n>=o.y)return!0;const o=[new _(e,i),new _(e,n),new _(r,n),new _(r,i)];if(t.length>2)for(const e of o)if(vc(t,e))return!0;for(let e=0;e<t.length-1;e++)if(bc(t[e],t[e+1],o))return!0;return!1}function bc(t,e,i){const r=i[0],n=i[2];if(t.x<r.x&&e.x<r.x||t.x>n.x&&e.x>n.x||t.y<r.y&&e.y<r.y||t.y>n.y&&e.y>n.y)return!1;const o=G(t,e,i[0]);return o!==G(t,e,i[1])||o!==G(t,e,i[2])||o!==G(t,e,i[3])}function wc(t,e,i){const r=e.paint.get(t).value;return"constant"===r.kind?r.value:i.programConfigurations.get(e.id).getMaxValue(t)}function Tc(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function Bc(t,e,i,r,n){if(!e[0]&&!e[1])return t;const o=_.convert(e)._mult(n);"viewport"===i&&o._rotate(-r);const s=[];for(let e=0;e<t.length;e++)s.push(t[e].sub(o));return s}function Ec(t,e,i,r){const n=_.convert(t)._mult(r);return"viewport"===e&&n._rotate(-i),n}Kn(uc,"CircleBucket",{omit:["layers"]});const Cc=new zo({"circle-sort-key":new Po(te.layout_circle["circle-sort-key"])});var Sc={paint:new zo({"circle-radius":new Po(te.paint_circle["circle-radius"]),"circle-color":new Po(te.paint_circle["circle-color"]),"circle-blur":new Po(te.paint_circle["circle-blur"]),"circle-opacity":new Po(te.paint_circle["circle-opacity"]),"circle-translate":new ko(te.paint_circle["circle-translate"]),"circle-translate-anchor":new ko(te.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new ko(te.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new ko(te.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Po(te.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Po(te.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Po(te.paint_circle["circle-stroke-opacity"])}),layout:Cc};function Ic(t,e,i,r,n,o,s,a,l){if(o&&t.queryGeometry.isAboveHorizon)return!1;o&&(l*=t.pixelToTileUnitsFactor);const c=t.tileID.canonical,u=i.projection.upVectorScale(c,i.center.lat,i.worldSize).metersToTile;for(const h of e)for(const e of h){const h=e.add(a),d=n&&i.elevation?i.elevation.exaggeration()*n.getElevationAt(h.x,h.y,!0):0,p=i.projection.projectTilePoint(h.x,h.y,c);if(d>0){const t=i.projection.upVector(c,h.x,h.y);p.x+=t[0]*u*d,p.y+=t[1]*u*d,p.z+=t[2]*u*d}const f=o?h:Mc(p.x,p.y,p.z,r),A=o?t.tilespaceRays.map((t=>Lc(t,d))):t.queryGeometry.screenGeometry,m=Ga([],[p.x,p.y,p.z,1],r);if(!s&&o?l*=m[3]/i.cameraToCenterDistance:s&&!o&&(l*=i.cameraToCenterDistance/m[3]),o){const t=ql((e.y/aa+c.y)/(1<<c.z));l/=i.projection.pixelsPerMeter(t,1)/$l(1,t)}if(dc(A,f,l))return!0}return!1}function Mc(t,e,i,r){const n=Ga([],[t,e,i,1],r);return new _(n[0]/n[3],n[1]/n[3])}const kc=Ea(0,0,0),Pc=Ea(0,0,1);function Lc(t,e){const i=wa();return kc[2]=e,t.intersectsPlane(kc,Pc,i),new _(i[0],i[1])}class zc extends uc{}function Fc(t,{width:e,height:i},r,n){if(n){if(n instanceof Uint8ClampedArray)n=new Uint8Array(n.buffer);else if(n.length!==e*i*r)throw new RangeError("mismatched image size")}else n=new Uint8Array(e*i*r);return t.width=e,t.height=i,t.data=n,t}function Dc(t,e,i){const{width:r,height:n}=e;r===t.width&&n===t.height||(Rc(t,e,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,r),height:Math.min(t.height,n)},i),t.width=r,t.height=n,t.data=e.data)}function Rc(t,e,i,r,n,o){if(0===n.width||0===n.height)return e;if(n.width>t.width||n.height>t.height||i.x>t.width-n.width||i.y>t.height-n.height)throw new RangeError("out of range source coordinates for image copy");if(n.width>e.width||n.height>e.height||r.x>e.width-n.width||r.y>e.height-n.height)throw new RangeError("out of range destination coordinates for image copy");const s=t.data,a=e.data;for(let l=0;l<n.height;l++){const c=((i.y+l)*t.width+i.x)*o,u=((r.y+l)*e.width+r.x)*o;for(let t=0;t<n.width*o;t++)a[u+t]=s[c+t]}return e}Kn(zc,"HeatmapBucket",{omit:["layers"]});class Uc{constructor(t,e){Fc(this,t,1,e)}resize(t){Dc(this,new Uc(t),1)}clone(){return new Uc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,e,i,r,n){Rc(t,e,i,r,n,1)}}class Oc{constructor(t,e){Fc(this,t,4,e)}resize(t){Dc(this,new Oc(t),4)}replace(t,e){e?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new Oc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,e,i,r,n){Rc(t,e,i,r,n,4)}}Kn(Uc,"AlphaImage"),Kn(Oc,"RGBAImage");var Nc={paint:new zo({"heatmap-radius":new Po(te.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Po(te.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new ko(te.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Lo(te.paint_heatmap["heatmap-color"]),"heatmap-opacity":new ko(te.paint_heatmap["heatmap-opacity"])})};function Qc(t){const e={},i=t.resolution||256,r=t.clips?t.clips.length:1,n=t.image||new Oc({width:i,height:r}),o=(i,r,o)=>{e[t.evaluationKey]=o;const s=t.expression.evaluate(e);n.data[i+r+0]=Math.floor(255*s.r/s.a),n.data[i+r+1]=Math.floor(255*s.g/s.a),n.data[i+r+2]=Math.floor(255*s.b/s.a),n.data[i+r+3]=Math.floor(255*s.a)};if(t.clips)for(let e=0,n=0;e<r;++e,n+=4*i)for(let r=0,s=0;r<i;r++,s+=4){const a=r/(i-1),{start:l,end:c}=t.clips[e];o(n,s,l*(1-a)+c*a)}else for(let t=0,e=0;t<i;t++,e+=4)o(0,e,t/(i-1));return n}var Vc={paint:new zo({"hillshade-illumination-direction":new ko(te.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new ko(te.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new ko(te.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new ko(te.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new ko(te.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new ko(te.paint_hillshade["hillshade-accent-color"])})};const jc=Oo([{name:"a_pos",components:2,type:"Int16"}],4),{members:Hc}=jc;var Gc={exports:{}};function $c(t,e,i){i=i||2;var r,n,o,s,a,l,c,u=e&&e.length,h=u?e[0]*i:t.length,d=Zc(t,0,h,i,!0),p=[];if(!d||d.next===d.prev)return p;if(u&&(d=function(t,e,i,r){var n,o,s,a=[];for(n=0,o=e.length;n<o;n++)(s=Zc(t,e[n]*r,n<o-1?e[n+1]*r:t.length,r,!1))===s.next&&(s.steiner=!0),a.push(nu(s));for(a.sort(tu),n=0;n<a.length;n++)i=eu(a[n],i);return i}(t,e,d,i)),t.length>80*i){r=o=t[0],n=s=t[1];for(var f=i;f<h;f+=i)(a=t[f])<r&&(r=a),(l=t[f+1])<n&&(n=l),a>o&&(o=a),l>s&&(s=l);c=0!==(c=Math.max(o-r,s-n))?32767/c:0}return Kc(d,p,i,r,n,c,0),p}function Zc(t,e,i,r,n){var o,s;if(n===gu(t,e,i,r)>0)for(o=e;o<i;o+=r)s=fu(o,t[o],t[o+1],s);else for(o=i-r;o>=e;o-=r)s=fu(o,t[o],t[o+1],s);return s&&lu(s,s.next)&&(Au(s),s=s.next),s}function qc(t,e){if(!t)return t;e||(e=t);var i,r=t;do{if(i=!1,r.steiner||!lu(r,r.next)&&0!==au(r.prev,r,r.next))r=r.next;else{if(Au(r),(r=e=r.prev)===r.next)break;i=!0}}while(i||r!==e);return e}function Kc(t,e,i,r,n,o,s){if(t){!s&&o&&function(t,e,i,r){var n=t;do{0===n.z&&(n.z=ru(n.x,n.y,e,i,r)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next}while(n!==t);n.prevZ.nextZ=null,n.prevZ=null,function(t){var e,i,r,n,o,s,a,l,c=1;do{for(i=t,t=null,o=null,s=0;i;){for(s++,r=i,a=0,e=0;e<c&&(a++,r=r.nextZ);e++);for(l=c;a>0||l>0&&r;)0!==a&&(0===l||!r||i.z<=r.z)?(n=i,i=i.nextZ,a--):(n=r,r=r.nextZ,l--),o?o.nextZ=n:t=n,n.prevZ=o,o=n;i=r}o.nextZ=null,c*=2}while(s>1)}(n)}(t,r,n,o);for(var a,l,c=t;t.prev!==t.next;)if(a=t.prev,l=t.next,o?Xc(t,r,n,o):Wc(t))e.push(a.i/i|0),e.push(t.i/i|0),e.push(l.i/i|0),Au(t),t=l.next,c=l.next;else if((t=l)===c){s?1===s?Kc(t=Jc(qc(t),e,i),e,i,r,n,o,2):2===s&&Yc(t,e,i,r,n,o):Kc(qc(t),e,i,r,n,o,1);break}}}function Wc(t){var e=t.prev,i=t,r=t.next;if(au(e,i,r)>=0)return!1;for(var n=e.x,o=i.x,s=r.x,a=e.y,l=i.y,c=r.y,u=n<o?n<s?n:s:o<s?o:s,h=a<l?a<c?a:c:l<c?l:c,d=n>o?n>s?n:s:o>s?o:s,p=a>l?a>c?a:c:l>c?l:c,f=r.next;f!==e;){if(f.x>=u&&f.x<=d&&f.y>=h&&f.y<=p&&ou(n,a,o,l,s,c,f.x,f.y)&&au(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}function Xc(t,e,i,r){var n=t.prev,o=t,s=t.next;if(au(n,o,s)>=0)return!1;for(var a=n.x,l=o.x,c=s.x,u=n.y,h=o.y,d=s.y,p=a<l?a<c?a:c:l<c?l:c,f=u<h?u<d?u:d:h<d?h:d,A=a>l?a>c?a:c:l>c?l:c,m=u>h?u>d?u:d:h>d?h:d,g=ru(p,f,e,i,r),_=ru(A,m,e,i,r),y=t.prevZ,v=t.nextZ;y&&y.z>=g&&v&&v.z<=_;){if(y.x>=p&&y.x<=A&&y.y>=f&&y.y<=m&&y!==n&&y!==s&&ou(a,u,l,h,c,d,y.x,y.y)&&au(y.prev,y,y.next)>=0)return!1;if(y=y.prevZ,v.x>=p&&v.x<=A&&v.y>=f&&v.y<=m&&v!==n&&v!==s&&ou(a,u,l,h,c,d,v.x,v.y)&&au(v.prev,v,v.next)>=0)return!1;v=v.nextZ}for(;y&&y.z>=g;){if(y.x>=p&&y.x<=A&&y.y>=f&&y.y<=m&&y!==n&&y!==s&&ou(a,u,l,h,c,d,y.x,y.y)&&au(y.prev,y,y.next)>=0)return!1;y=y.prevZ}for(;v&&v.z<=_;){if(v.x>=p&&v.x<=A&&v.y>=f&&v.y<=m&&v!==n&&v!==s&&ou(a,u,l,h,c,d,v.x,v.y)&&au(v.prev,v,v.next)>=0)return!1;v=v.nextZ}return!0}function Jc(t,e,i){var r=t;do{var n=r.prev,o=r.next.next;!lu(n,o)&&cu(n,r,r.next,o)&&du(n,o)&&du(o,n)&&(e.push(n.i/i|0),e.push(r.i/i|0),e.push(o.i/i|0),Au(r),Au(r.next),r=t=o),r=r.next}while(r!==t);return qc(r)}function Yc(t,e,i,r,n,o){var s=t;do{for(var a=s.next.next;a!==s.prev;){if(s.i!==a.i&&su(s,a)){var l=pu(s,a);return s=qc(s,s.next),l=qc(l,l.next),Kc(s,e,i,r,n,o,0),void Kc(l,e,i,r,n,o,0)}a=a.next}s=s.next}while(s!==t)}function tu(t,e){return t.x-e.x}function eu(t,e){var i=function(t,e){var i,r=e,n=t.x,o=t.y,s=-1/0;do{if(o<=r.y&&o>=r.next.y&&r.next.y!==r.y){var a=r.x+(o-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(a<=n&&a>s&&(s=a,i=r.x<r.next.x?r:r.next,a===n))return i}r=r.next}while(r!==e);if(!i)return null;var l,c=i,u=i.x,h=i.y,d=1/0;r=i;do{n>=r.x&&r.x>=u&&n!==r.x&&ou(o<h?n:s,o,u,h,o<h?s:n,o,r.x,r.y)&&(l=Math.abs(o-r.y)/(n-r.x),du(r,t)&&(l<d||l===d&&(r.x>i.x||r.x===i.x&&iu(i,r)))&&(i=r,d=l)),r=r.next}while(r!==c);return i}(t,e);if(!i)return e;var r=pu(i,t);return qc(r,r.next),qc(i,i.next)}function iu(t,e){return au(t.prev,t,e.prev)<0&&au(e.next,t,t.next)<0}function ru(t,e,i,r,n){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-i)*n|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-r)*n|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function nu(t){var e=t,i=t;do{(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next}while(e!==t);return i}function ou(t,e,i,r,n,o,s,a){return(n-s)*(e-a)>=(t-s)*(o-a)&&(t-s)*(r-a)>=(i-s)*(e-a)&&(i-s)*(o-a)>=(n-s)*(r-a)}function su(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&cu(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1}(t,e)&&(du(t,e)&&du(e,t)&&function(t,e){var i=t,r=!1,n=(t.x+e.x)/2,o=(t.y+e.y)/2;do{i.y>o!=i.next.y>o&&i.next.y!==i.y&&n<(i.next.x-i.x)*(o-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next}while(i!==t);return r}(t,e)&&(au(t.prev,t,e.prev)||au(t,e.prev,e))||lu(t,e)&&au(t.prev,t,t.next)>0&&au(e.prev,e,e.next)>0)}function au(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function lu(t,e){return t.x===e.x&&t.y===e.y}function cu(t,e,i,r){var n=hu(au(t,e,i)),o=hu(au(t,e,r)),s=hu(au(i,r,t)),a=hu(au(i,r,e));return n!==o&&s!==a||!(0!==n||!uu(t,i,e))||!(0!==o||!uu(t,r,e))||!(0!==s||!uu(i,t,r))||!(0!==a||!uu(i,e,r))}function uu(t,e,i){return e.x<=Math.max(t.x,i.x)&&e.x>=Math.min(t.x,i.x)&&e.y<=Math.max(t.y,i.y)&&e.y>=Math.min(t.y,i.y)}function hu(t){return t>0?1:t<0?-1:0}function du(t,e){return au(t.prev,t,t.next)<0?au(t,e,t.next)>=0&&au(t,t.prev,e)>=0:au(t,e,t.prev)<0||au(t,t.next,e)<0}function pu(t,e){var i=new mu(t.i,t.x,t.y),r=new mu(e.i,e.x,e.y),n=t.next,o=e.prev;return t.next=e,e.prev=t,i.next=n,n.prev=i,r.next=i,i.prev=r,o.next=r,r.prev=o,r}function fu(t,e,i,r){var n=new mu(t,e,i);return r?(n.next=r.next,n.prev=r,r.next.prev=n,r.next=n):(n.prev=n,n.next=n),n}function Au(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function mu(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function gu(t,e,i,r){for(var n=0,o=e,s=i-r;o<i;o+=r)n+=(t[s]-t[o])*(t[o+1]+t[s+1]),s=o;return n}Gc.exports=$c,Gc.exports.default=$c,$c.deviation=function(t,e,i,r){var n=e&&e.length,o=Math.abs(gu(t,0,n?e[0]*i:t.length,i));if(n)for(var s=0,a=e.length;s<a;s++)o-=Math.abs(gu(t,e[s]*i,s<a-1?e[s+1]*i:t.length,i));var l=0;for(s=0;s<r.length;s+=3){var c=r[s]*i,u=r[s+1]*i,h=r[s+2]*i;l+=Math.abs((t[c]-t[h])*(t[u+1]-t[c+1])-(t[c]-t[u])*(t[h+1]-t[c+1]))}return 0===o&&0===l?0:Math.abs((l-o)/o)},$c.flatten=function(t){for(var e=t[0][0].length,i={vertices:[],holes:[],dimensions:e},r=0,n=0;n<t.length;n++){for(var o=0;o<t[n].length;o++)for(var s=0;s<e;s++)i.vertices.push(t[n][o][s]);n>0&&i.holes.push(r+=t[n-1].length)}return i};var _u=d(Gc.exports);function yu(t,e,i,r,n){vu(t,e,i||0,r||t.length-1,n||bu)}function vu(t,e,i,r,n){for(;r>i;){if(r-i>600){var o=r-i+1,s=e-i+1,a=Math.log(o),l=.5*Math.exp(2*a/3),c=.5*Math.sqrt(a*l*(o-l)/o)*(s-o/2<0?-1:1);vu(t,e,Math.max(i,Math.floor(e-s*l/o+c)),Math.min(r,Math.floor(e+(o-s)*l/o+c)),n)}var u=t[e],h=i,d=r;for(xu(t,i,e),n(t[r],u)>0&&xu(t,i,r);h<d;){for(xu(t,h,d),h++,d--;n(t[h],u)<0;)h++;for(;n(t[d],u)>0;)d--}0===n(t[i],u)?xu(t,i,d):xu(t,++d,r),d<=e&&(i=d+1),e<=d&&(r=d-1)}}function xu(t,e,i){var r=t[e];t[e]=t[i],t[i]=r}function bu(t,e){return t<e?-1:t>e?1:0}function wu(t,e){const i=t.length;if(i<=1)return[t];const r=[];let n,o;for(let e=0;e<i;e++){const i=$(t[e]);0!==i&&(t[e].area=Math.abs(i),void 0===o&&(o=i<0),o===i<0?(n&&r.push(n),n=[t[e]]):n.push(t[e]))}if(n&&r.push(n),e>1)for(let t=0;t<r.length;t++)r[t].length<=e||(yu(r[t],e,1,r[t].length-1,Tu),r[t]=r[t].slice(0,e));return r}function Tu(t,e){return e.area-t.area}function Bu(t,e,i){const r=i.patternDependencies;let n=!1;for(const i of e){const e=i.paint.get(`${t}-pattern`);e.isConstant()||(n=!0);const o=e.constantOr(null);o&&(n=!0,r[o]=!0)}return n}function Eu(t,e,i,r,n){const o=n.patternDependencies;for(const s of e){const e=s.paint.get(`${t}-pattern`).value;if("constant"!==e.kind){let t=e.evaluate({zoom:r},i,{},n.availableImages);t=t&&t.name?t.name:t,o[t]=!0,i.patterns[s.id]=t}}return i}class Cu{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((t=>t.id)),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Qo,this.indexArray=new rs,this.indexArray2=new cs,this.programConfigurations=new Ws(t.layers,t.zoom),this.segments=new sa,this.segments2=new sa,this.stateDependentLayerIds=this.layers.filter((t=>t.isStateDependent())).map((t=>t.id)),this.projection=t.projection}populate(t,e,i,r){this.hasPattern=Bu("fill",this.layers,e);const n=this.layers[0].layout.get("fill-sort-key"),o=[];for(const{feature:s,id:a,index:l,sourceLayerIndex:c}of t){const t=this.layers[0]._featureFilter.needGeometry,u=ac(s,t);if(!this.layers[0]._featureFilter.filter(new bo(this.zoom),u,i))continue;const h=n?n.evaluate(u,{},i,e.availableImages):void 0,d={id:a,properties:s.properties,type:s.type,sourceLayerIndex:c,index:l,geometry:t?u.geometry:sc(s,i,r),patterns:{},sortKey:h};o.push(d)}n&&o.sort(((t,e)=>t.sortKey-e.sortKey));for(const r of o){const{geometry:n,index:o,sourceLayerIndex:s}=r;if(this.hasPattern){const t=Eu("fill",this.layers,r,this.zoom,e);this.patternFeatures.push(t)}else this.addFeature(r,n,o,i,{},e.availableImages);e.featureIndex.insert(t[o].feature,n,o,s,this.index)}}update(t,e,i,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,i,r)}addFeatures(t,e,i,r,n){for(const t of this.patternFeatures)this.addFeature(t,t.geometry,t.index,e,i,r)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Hc),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,e,i,r,n,o=[]){for(const t of wu(e,500)){let e=0;for(const i of t)e+=i.length;const i=this.segments.prepareSegment(e,this.layoutVertexArray,this.indexArray),r=i.vertexLength,n=[],o=[];for(const e of t){if(0===e.length)continue;e!==t[0]&&o.push(n.length/2);const i=this.segments2.prepareSegment(e.length,this.layoutVertexArray,this.indexArray2),r=i.vertexLength;this.layoutVertexArray.emplaceBack(e[0].x,e[0].y),this.indexArray2.emplaceBack(r+e.length-1,r),n.push(e[0].x),n.push(e[0].y);for(let t=1;t<e.length;t++)this.layoutVertexArray.emplaceBack(e[t].x,e[t].y),this.indexArray2.emplaceBack(r+t-1,r+t),n.push(e[t].x),n.push(e[t].y);i.vertexLength+=e.length,i.primitiveLength+=e.length}const s=_u(n,o);for(let t=0;t<s.length;t+=3)this.indexArray.emplaceBack(r+s[t],r+s[t+1],r+s[t+2]);i.vertexLength+=e,i.primitiveLength+=s.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,i,n,o,r)}}Kn(Cu,"FillBucket",{omit:["layers","patternFeatures"]});const Su=new zo({"fill-sort-key":new Po(te.layout_fill["fill-sort-key"])});var Iu={paint:new zo({"fill-antialias":new ko(te.paint_fill["fill-antialias"]),"fill-opacity":new Po(te.paint_fill["fill-opacity"]),"fill-color":new Po(te.paint_fill["fill-color"]),"fill-outline-color":new Po(te.paint_fill["fill-outline-color"]),"fill-translate":new ko(te.paint_fill["fill-translate"]),"fill-translate-anchor":new ko(te.paint_fill["fill-translate-anchor"]),"fill-pattern":new Po(te.paint_fill["fill-pattern"])}),layout:Su};const Mu=Oo([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),ku=Oo([{name:"a_centroid_pos",components:2,type:"Uint16"}]),Pu=Oo([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:Lu}=Mu;var zu={},Fu=m,Du=Ru;function Ru(t,e,i,r,n){this.properties={},this.extent=i,this.type=0,this._pbf=t,this._geometry=-1,this._keys=r,this._values=n,t.readFields(Uu,this,e)}function Uu(t,e,i){1==t?e.id=i.readVarint():2==t?function(t,e){for(var i=t.readVarint()+t.pos;t.pos<i;){var r=e._keys[t.readVarint()],n=e._values[t.readVarint()];e.properties[r]=n}}(i,e):3==t?e.type=i.readVarint():4==t&&(e._geometry=i.pos)}function Ou(t){for(var e,i,r=0,n=0,o=t.length,s=o-1;n<o;s=n++)r+=((i=t[s]).x-(e=t[n]).x)*(e.y+i.y);return r}Ru.types=["Unknown","Point","LineString","Polygon"],Ru.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,i=t.readVarint()+t.pos,r=1,n=0,o=0,s=0,a=[];t.pos<i;){if(n<=0){var l=t.readVarint();r=7&l,n=l>>3}if(n--,1===r||2===r)o+=t.readSVarint(),s+=t.readSVarint(),1===r&&(e&&a.push(e),e=[]),e.push(new Fu(o,s));else{if(7!==r)throw new Error("unknown command "+r);e&&e.push(e[0].clone())}}return e&&a.push(e),a},Ru.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,i=1,r=0,n=0,o=0,s=1/0,a=-1/0,l=1/0,c=-1/0;t.pos<e;){if(r<=0){var u=t.readVarint();i=7&u,r=u>>3}if(r--,1===i||2===i)(n+=t.readSVarint())<s&&(s=n),n>a&&(a=n),(o+=t.readSVarint())<l&&(l=o),o>c&&(c=o);else if(7!==i)throw new Error("unknown command "+i)}return[s,l,a,c]},Ru.prototype.toGeoJSON=function(t,e,i){var r,n,o=this.extent*Math.pow(2,i),s=this.extent*t,a=this.extent*e,l=this.loadGeometry(),c=Ru.types[this.type];function u(t){for(var e=0;e<t.length;e++){var i=t[e];t[e]=[360*(i.x+s)/o-180,360/Math.PI*Math.atan(Math.exp((180-360*(i.y+a)/o)*Math.PI/180))-90]}}switch(this.type){case 1:var h=[];for(r=0;r<l.length;r++)h[r]=l[r][0];u(l=h);break;case 2:for(r=0;r<l.length;r++)u(l[r]);break;case 3:for(l=function(t){var e=t.length;if(e<=1)return[t];for(var i,r,n=[],o=0;o<e;o++){var s=Ou(t[o]);0!==s&&(void 0===r&&(r=s<0),r===s<0?(i&&n.push(i),i=[t[o]]):i.push(t[o]))}return i&&n.push(i),n}(l),r=0;r<l.length;r++)for(n=0;n<l[r].length;n++)u(l[r][n])}1===l.length?l=l[0]:c="Multi"+c;var d={type:"Feature",geometry:{type:c,coordinates:l},properties:this.properties};return"id"in this&&(d.id=this.id),d};var Nu=Du,Qu=Vu;function Vu(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(ju,this,e),this.length=this._features.length}function ju(t,e,i){15===t?e.version=i.readVarint():1===t?e.name=i.readString():5===t?e.extent=i.readVarint():2===t?e._features.push(i.pos):3===t?e._keys.push(i.readString()):4===t&&e._values.push(function(t){for(var e=null,i=t.readVarint()+t.pos;t.pos<i;){var r=t.readVarint()>>3;e=1===r?t.readString():2===r?t.readFloat():3===r?t.readDouble():4===r?t.readVarint64():5===r?t.readVarint():6===r?t.readSVarint():7===r?t.readBoolean():null}return e}(i))}Vu.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new Nu(this._pbf,e,this.extent,this._keys,this._values)};var Hu=Qu;function Gu(t,e,i){if(3===t){var r=new Hu(i,i.readVarint()+i.pos);r.length&&(e[r.name]=r)}}var $u=zu.VectorTile=function(t,e){this.layers=t.readFields(Gu,{},e)},Zu=zu.VectorTileFeature=Du;function qu(t,e,i,r){const n=[],o=0===r?(t,e,i,r,n,o)=>{t.push(new _(o,i+(o-e)/(r-e)*(n-i)))}:(t,e,i,r,n,o)=>{t.push(new _(e+(o-i)/(n-i)*(r-e),o))};for(const s of t){const t=[];for(const n of s){if(n.length<=2)continue;const s=[];for(let t=0;t<n.length-1;t++){const a=n[t].x,l=n[t].y,c=n[t+1].x,u=n[t+1].y,h=0===r?a:l,d=0===r?c:u;h<e?d>e&&o(s,a,l,c,u,e):h>i?d<i&&o(s,a,l,c,u,i):s.push(n[t]),d<e&&h>=e&&o(s,a,l,c,u,e),d>i&&h<=i&&o(s,a,l,c,u,i)}let a=n[n.length-1];const l=0===r?a.x:a.y;l>=e&&l<=i&&s.push(a),s.length&&(a=s[s.length-1],s[0].x===a.x&&s[0].y===a.y||s.push(s[0]),t.push(s))}t.length&&n.push(t)}return n}zu.VectorTileLayer=Qu;const Ku=Zu.types,Wu=Math.pow(2,13);function Xu(t,e,i,r,n,o,s,a){t.emplaceBack((e<<1)+s,(i<<1)+o,(Math.floor(r*Wu)<<1)+n,Math.round(a))}function Ju(t,e,i){const r=16384;t.emplaceBack(e.x,e.y,e.z,i[0]*r,i[1]*r,i[2]*r)}class Yu{constructor(){this.acc=new _(0,0),this.polyCount=[]}startRing(t){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new _(t.x,t.y),this.max=new _(t.x,t.y))}append(t,e){this.currentPolyCount.edges++,this.acc._add(t);const i=this.min,r=this.max;t.x<i.x?i.x=t.x:t.x>r.x&&(r.x=t.x),t.y<i.y?i.y=t.y:t.y>r.y&&(r.y=t.y),((0===t.x||t.x===aa)&&t.x===e.x)!=((0===t.y||t.y===aa)&&t.y===e.y)&&this.processBorderOverlap(t,e),e.x<0!=t.x<0&&this.addBorderIntersection(0,ki(e.y,t.y,(0-e.x)/(t.x-e.x))),e.x>aa!=t.x>aa&&this.addBorderIntersection(1,ki(e.y,t.y,(aa-e.x)/(t.x-e.x))),e.y<0!=t.y<0&&this.addBorderIntersection(2,ki(e.x,t.x,(0-e.y)/(t.y-e.y))),e.y>aa!=t.y>aa&&this.addBorderIntersection(3,ki(e.x,t.x,(aa-e.y)/(t.y-e.y)))}addBorderIntersection(t,e){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const i=this.borders[t];e<i[0]&&(i[0]=e),e>i[1]&&(i[1]=e)}processBorderOverlap(t,e){if(t.x===e.x){if(t.y===e.y)return;const i=0===t.x?0:1;this.addBorderIntersection(i,e.y),this.addBorderIntersection(i,t.y)}else{const i=0===t.y?2:3;this.addBorderIntersection(i,e.x),this.addBorderIntersection(i,t.x)}}centroid(){const t=this.polyCount.reduce(((t,e)=>t+e.edges),0);return 0!==t?this.acc.div(t)._round():new _(0,0)}span(){return new _(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce(((t,e)=>t+ +(e[0]!==Number.MAX_VALUE)),0)}}class th{constructor(t){this.zoom=t.zoom,this.canonical=t.canonical,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((t=>t.id)),this.index=t.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=t.projection,this.layoutVertexArray=new jo,this.centroidVertexArray=new bs,this.indexArray=new rs,this.programConfigurations=new Ws(t.layers,t.zoom),this.segments=new sa,this.stateDependentLayerIds=this.layers.filter((t=>t.isStateDependent())).map((t=>t.id)),this.enableTerrain=t.enableTerrain}populate(t,e,i,r){this.features=[],this.hasPattern=Bu("fill-extrusion",this.layers,e),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(t){const e=Math.exp(Math.PI*(1-t.y/(1<<t.z)*2));return 80150034*e/(e*e+1)/aa/(1<<t.z)}(i),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:n,id:o,index:s,sourceLayerIndex:a}of t){const t=this.layers[0]._featureFilter.needGeometry,l=ac(n,t);if(!this.layers[0]._featureFilter.filter(new bo(this.zoom),l,i))continue;const c={id:o,sourceLayerIndex:a,index:s,geometry:t?l.geometry:sc(n,i,r),properties:n.properties,type:n.type,patterns:{}},u=this.layoutVertexArray.length;this.hasPattern?this.features.push(Eu("fill-extrusion",this.layers,c,this.zoom,e)):this.addFeature(c,c.geometry,s,i,{},e.availableImages,r),e.featureIndex.insert(n,c.geometry,s,a,this.index,u)}this.sortBorders()}addFeatures(t,e,i,r,n){for(const t of this.features){const{geometry:o}=t;this.addFeature(t,o,t.index,e,i,r,n)}this.sortBorders()}update(t,e,i,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,i,r)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Lu),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=t.createVertexBuffer(this.layoutVertexExtArray,Pu.members,!0))),this.programConfigurations.upload(t),this.uploaded=!0}uploadCentroid(t){0!==this.centroidVertexArray.length&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,ku.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,e,i,r,n,o,s){const a=[new _(0,0),new _(aa,aa)],l=s.projection,c="globe"===l.name,u=this.enableTerrain&&!c?new Yu:null,h="Polygon"===Ku[t.type];c&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new qo);const d=wu(e,500);for(let t=d.length-1;t>=0;t--){const e=d[t];(0===e.length||(p=e[0]).every((t=>t.x<=0))||p.every((t=>t.x>=aa))||p.every((t=>t.y<=0))||p.every((t=>t.y>=aa)))&&d.splice(t,1)}var p;let f;if(c)f=lh(d,a,r);else{f=[];for(const t of d)f.push({polygon:t,bounds:a})}const A=h?this.edgeRadius:0;for(const{polygon:t,bounds:e}of f){let i=0,n=0;for(const e of t)h&&!e[0].equals(e[e.length-1])&&e.push(e[0]),n+=h?e.length-1:e.length;const o=this.segments.prepareSegment((h?5:4)*n,this.layoutVertexArray,this.indexArray);if(h){const e=[],n=[];i=o.vertexLength;for(const i of t){let s,a;i.length&&i!==t[0]&&n.push(e.length/2),s=i[1].sub(i[0])._perp()._unit();for(let t=1;t<i.length;t++){const n=i[t],u=i[t===i.length-1?1:t+1];let{x:h,y:d}=n;if(A){a=u.sub(n)._perp()._unit();const t=s.add(a)._unit(),e=A*Math.min(4,1/(s.x*t.x+s.y*t.y));h+=e*t.x,d+=e*t.y,s=a}Xu(this.layoutVertexArray,h,d,0,0,1,1,0),o.vertexLength++,e.push(n.x,n.y),c&&Ju(this.layoutVertexExtArray,l.projectTilePoint(h,d,r),l.upVector(r,h,d))}}const s=_u(e,n);for(let t=0;t<s.length;t+=3)this.indexArray.emplaceBack(i+s[t],i+s[t+2],i+s[t+1]),o.primitiveLength++}for(const n of t){u&&n.length&&u.startRing(n[0]);let t,s,a,d=n.length>4&&oh(n[n.length-2],n[0],n[1]),p=A?ih(n[n.length-2],n[0],n[1],A):0;s=n[1].sub(n[0])._perp()._unit();let f=!0;for(let m=1,g=0;m<n.length;m++){let _=n[m-1],y=n[m];const v=n[m===n.length-1?1:m+1];if(u&&h&&u.currentPolyCount.top++,nh(y,_,e)){A&&(s=v.sub(y)._perp()._unit(),f=!f);continue}u&&u.append(y,_);const x=y.sub(_)._perp(),b=x.x/(Math.abs(x.x)+Math.abs(x.y)),w=x.y>0?1:0,T=_.dist(y);if(g+T>32768&&(g=0),A){a=v.sub(y)._perp()._unit();let t=rh(_,y,v,eh(s,a),A);isNaN(t)&&(t=0);const e=y.sub(_)._unit();_=_.add(e.mult(p))._round(),y=y.add(e.mult(-t))._round(),p=t,s=a}const B=o.vertexLength,E=n.length>4&&oh(_,y,v);let C=sh(g,d,f);if(Xu(this.layoutVertexArray,_.x,_.y,b,w,0,0,C),Xu(this.layoutVertexArray,_.x,_.y,b,w,0,1,C),g+=T,C=sh(g,E,!f),d=E,Xu(this.layoutVertexArray,y.x,y.y,b,w,0,0,C),Xu(this.layoutVertexArray,y.x,y.y,b,w,0,1,C),o.vertexLength+=4,this.indexArray.emplaceBack(B+0,B+1,B+2),this.indexArray.emplaceBack(B+1,B+3,B+2),o.primitiveLength+=2,A){const r=i+(1===m?n.length-2:m-2),s=1===m?i:r+1;if(this.indexArray.emplaceBack(B+1,r,B+3),this.indexArray.emplaceBack(r,s,B+3),o.primitiveLength+=2,void 0===t&&(t=B),!nh(v,n[m],e)){const e=m===n.length-1?t:o.vertexLength;this.indexArray.emplaceBack(B+2,B+3,e),this.indexArray.emplaceBack(B+3,e+1,e),this.indexArray.emplaceBack(B+3,s,e+1),o.primitiveLength+=3}f=!f}if(c){const t=this.layoutVertexExtArray,e=l.projectTilePoint(_.x,_.y,r),i=l.projectTilePoint(y.x,y.y,r),n=l.upVector(r,_.x,_.y),o=l.upVector(r,y.x,y.y);Ju(t,e,n),Ju(t,e,n),Ju(t,i,o),Ju(t,i,o)}}h&&(i+=n.length-1)}}if(u&&u.polyCount.length>0){if(u.borders){u.vertexArrayOffset=this.centroidVertexArray.length;const t=u.borders,e=this.featuresOnBorder.push(u)-1;for(let i=0;i<4;i++)t[i][0]!==Number.MAX_VALUE&&this.borders[i].push(e)}this.encodeCentroid(u.borders?void 0:u.centroid(),u)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,i,n,o,r)}sortBorders(){for(let t=0;t<4;t++)this.borders[t].sort(((e,i)=>this.featuresOnBorder[e].borders[t][0]-this.featuresOnBorder[i].borders[t][0]))}encodeCentroid(t,e,i=!0){let r,n;if(t)if(0!==t.y){const i=e.span()._mult(this.tileToMeter);r=(Math.max(t.x,1)<<3)+Math.min(7,Math.round(i.x/10)),n=(Math.max(t.y,1)<<3)+Math.min(7,Math.round(i.y/10))}else r=Math.ceil(7*(t.x+450)),n=0;else r=0,n=+i;let o=i?this.centroidVertexArray.length:e.vertexArrayOffset;for(const t of e.polyCount){i&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*t.edges+t.top);for(let e=0;e<t.top;e++)this.centroidVertexArray.emplace(o++,r,n);for(let e=0;e<2*t.edges;e++)this.centroidVertexArray.emplace(o++,0,n),this.centroidVertexArray.emplace(o++,r,n)}}}function eh(t,e){const i=t.add(e)._unit();return t.x*i.x+t.y*i.y}function ih(t,e,i,r){const n=e.sub(t)._perp()._unit(),o=i.sub(e)._perp()._unit();return rh(t,e,i,eh(n,o),r)}function rh(t,e,i,r,n){const o=Math.sqrt(1-r*r);return Math.min(t.dist(e)/3,e.dist(i)/3,n*o/r)}function nh(t,e,i){return t.x<i[0].x&&e.x<i[0].x||t.x>i[1].x&&e.x>i[1].x||t.y<i[0].y&&e.y<i[0].y||t.y>i[1].y&&e.y>i[1].y}function oh(t,e,i){if(t.x<0||t.x>=aa||e.x<0||e.x>=aa||i.x<0||i.x>=aa)return!1;const r=i.sub(e),n=r.perp(),o=t.sub(e);return(r.x*o.x+r.y*o.y)/Math.sqrt((r.x*r.x+r.y*r.y)*(o.x*o.x+o.y*o.y))>-.866&&n.x*o.x+n.y*o.y<0}function sh(t,e,i){const r=e?2|t:-3&t;return i?1|r:-2&r}function ah(){const t=Math.PI/32,e=Math.tan(t),i=Ol;return i*Math.sqrt(1+2*e*e)-i}function lh(t,e,i){const r=1<<i.z,n=Zl(i.x/r),o=Zl((i.x+1)/r),s=ql(i.y/r),a=ql((i.y+1)/r);return function(t,e,i,r,n=0,o){const s=[];if(!t.length||!i||!r)return s;const a=(t,e)=>{for(const i of t)s.push({polygon:i,bounds:e})},l=Math.ceil(Math.log2(i)),c=Math.ceil(Math.log2(r)),u=l-c,h=[];for(let t=0;t<Math.abs(u);t++)h.push(u>0?0:1);for(let t=0;t<Math.min(l,c);t++)h.push(0),h.push(1);let d=t;if(d=qu(d,e[0].y-n,e[1].y+n,1),d=qu(d,e[0].x-n,e[1].x+n,0),!d.length)return s;const p=[];for(h.length?p.push({polygons:d,bounds:e,depth:0}):a(d,e);p.length;){const t=p.pop(),e=t.depth,i=h[e],r=t.bounds[0],s=t.bounds[1],l=0===i?r.x:r.y,c=0===i?s.x:s.y,u=o?o(i,l,c):.5*(l+c),d=qu(t.polygons,l-n,u+n,i),f=qu(t.polygons,u-n,c+n,i);if(d.length){const t=[r,new _(0===i?u:s.x,1===i?u:s.y)];h.length>e+1?p.push({polygons:d,bounds:t,depth:e+1}):a(d,t)}if(f.length){const t=[new _(0===i?u:r.x,1===i?u:r.y),s];h.length>e+1?p.push({polygons:f,bounds:t,depth:e+1}):a(f,t)}}return s}(t,e,Math.ceil((o-n)/11.25),Math.ceil((s-a)/11.25),1,((t,e,n)=>{if(0===t)return.5*(e+n);{const t=ql((i.y+e/aa)/r);return(Gl(.5*(ql((i.y+n/aa)/r)+t))*r-i.y)*aa}}))}Kn(th,"FillExtrusionBucket",{omit:["layers","features"]}),Kn(Yu,"PartMetadata");const ch=new zo({"fill-extrusion-edge-radius":new ko(te["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var uh={paint:new zo({"fill-extrusion-opacity":new ko(te["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Po(te["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new ko(te["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new ko(te["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Po(te["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Po(te["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Po(te["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new ko(te["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new ko(te["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new ko(te["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-rounded-roof":new ko(te["paint_fill-extrusion"]["fill-extrusion-rounded-roof"])}),layout:ch};function hh(t,e,i){var r=2*Math.PI*6378137/256/Math.pow(2,i);return[t*r-2*Math.PI*6378137/2,e*r-2*Math.PI*6378137/2]}class dh{constructor(t,e,i){this.z=t,this.x=e,this.y=i,this.key=Ah(0,t,t,e,i)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,e){const i=function(t,e,i){var r=hh(256*t,256*(e=Math.pow(2,i)-e-1),i),n=hh(256*(t+1),256*(e+1),i);return r[0]+","+r[1]+","+n[0]+","+n[1]}(this.x,this.y,this.z),r=function(t,e,i){let r,n="";for(let o=t;o>0;o--)r=1<<o-1,n+=(e&r?1:0)+(i&r?2:0);return n}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===e?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",r).replace("{bbox-epsg-3857}",i)}toString(){return`${this.z}/${this.x}/${this.y}`}}class ph{constructor(t,e){this.wrap=t,this.canonical=e,this.key=Ah(t,e.z,e.z,e.x,e.y)}}class fh{constructor(t,e,i,r,n){this.overscaledZ=t,this.wrap=e,this.canonical=new dh(i,+r,+n),this.key=0===e&&t===i?this.canonical.key:Ah(e,t,i,r,n)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){const e=this.canonical.z-t;return t>this.canonical.z?new fh(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new fh(t,this.wrap,t,this.canonical.x>>e,this.canonical.y>>e)}calculateScaledKey(t,e=!0){if(this.overscaledZ===t&&e)return this.key;if(t>this.canonical.z)return Ah(this.wrap*+e,t,this.canonical.z,this.canonical.x,this.canonical.y);{const i=this.canonical.z-t;return Ah(this.wrap*+e,t,t,this.canonical.x>>i,this.canonical.y>>i)}}isChildOf(t){if(t.wrap!==this.wrap)return!1;const e=this.canonical.z-t.canonical.z;return 0===t.overscaledZ||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>e&&t.canonical.y===this.canonical.y>>e}children(t){if(this.overscaledZ>=t)return[new fh(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const e=this.canonical.z+1,i=2*this.canonical.x,r=2*this.canonical.y;return[new fh(e,this.wrap,e,i,r),new fh(e,this.wrap,e,i+1,r),new fh(e,this.wrap,e,i,r+1),new fh(e,this.wrap,e,i+1,r+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new fh(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new fh(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new ph(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Ah(t,e,i,r,n){const o=1<<Math.min(i,22);let s=o*(n%o)+r%o;return t&&i<22&&(s+=o*o*((t<0?-2*t-1:2*t)%(1<<2*(22-i)))),16*(32*s+i)+(e-i)}Kn(dh,"CanonicalTileID"),Kn(fh,"OverscaledTileID",{omit:["projMatrix"]});class mh extends _{constructor(t,e,i){super(t,e),this.z=i}}function gh(t,e){return t.x*e.x+t.y*e.y}function _h(t,e){if(1===t.length){let i=0;const r=e[i++];let n;for(;!n||r.equals(n);)if(n=e[i++],!n)return 1/0;for(;i<e.length;i++){const o=e[i],s=t[0],a=n.sub(r),l=o.sub(r),c=s.sub(r),u=gh(a,a),h=gh(a,l),d=gh(l,l),p=gh(c,a),f=gh(c,l),A=u*d-h*h,m=(d*p-h*f)/A,g=(u*f-h*p)/A,_=r.z*(1-m-g)+n.z*m+o.z*g;if(isFinite(_))return _}return 1/0}{let t=1/0;for(const i of e)t=Math.min(t,i.z);return t}}function yh(t,e,i,r,n,o,s,a){const l=s*n.getElevationAt(t,e,!0,!0),c=0!==o[0],u=c?0===o[1]?s*(o[0]/7-450):s*function(t,e,i){const r=Math.floor(e[0]/8),n=Math.floor(e[1]/8),o=10*(e[0]-8*r),s=10*(e[1]-8*n),a=t.getElevationAt(r,n,!0,!0),l=t.getMeterToDEM(i),c=Math.floor(.5*(o*l-1)),u=Math.floor(.5*(s*l-1)),h=t.tileCoordToPixel(r,n),d=2*c+1,p=2*u+1,f=function(t,e,i,r,n){return[t.getElevationAtPixel(e,i,!0),t.getElevationAtPixel(e+n,i,!0),t.getElevationAtPixel(e,i+n,!0),t.getElevationAtPixel(e+r,i+n,!0)]}(t,h.x-c,h.y-u,d,p),A=Math.abs(f[0]-f[1]),m=Math.abs(f[2]-f[3]),g=Math.abs(f[0]-f[2])+Math.abs(f[1]-f[3]),_=Math.min(.25,.5*l*(A+m)/d),y=Math.min(.25,.5*l*g/p);return a+Math.max(_*o,y*s)}(n,o,a):l;return{base:l+(0===i)?-1:i,top:c?Math.max(u+r,l+i+2):l+r}}const vh=Oo([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:xh}=vh,bh=Oo([{name:"a_packed",components:4,type:"Float32"}]),{members:wh}=bh,Th=Zu.types,Bh=Math.cos(Math.PI/180*37.5);class Eh{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((t=>t.id)),this.index=t.index,this.projection=t.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((t=>{this.gradients[t.id]={}})),this.layoutVertexArray=new Ho,this.layoutVertexArray2=new Go,this.indexArray=new rs,this.programConfigurations=new Ws(t.layers,t.zoom),this.segments=new sa,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((t=>t.isStateDependent())).map((t=>t.id))}populate(t,e,i,r){this.hasPattern=Bu("line",this.layers,e);const n=this.layers[0].layout.get("line-sort-key"),o=[];for(const{feature:e,id:s,index:a,sourceLayerIndex:l}of t){const t=this.layers[0]._featureFilter.needGeometry,c=ac(e,t);if(!this.layers[0]._featureFilter.filter(new bo(this.zoom),c,i))continue;const u=n?n.evaluate(c,{},i):void 0,h={id:s,properties:e.properties,type:e.type,sourceLayerIndex:l,index:a,geometry:t?c.geometry:sc(e,i,r),patterns:{},sortKey:u};o.push(h)}n&&o.sort(((t,e)=>t.sortKey-e.sortKey));const{lineAtlas:s,featureIndex:a}=e,l=this.addConstantDashes(s);for(const r of o){const{geometry:n,index:o,sourceLayerIndex:c}=r;if(l&&this.addFeatureDashes(r,s),this.hasPattern){const t=Eu("line",this.layers,r,this.zoom,e);this.patternFeatures.push(t)}else this.addFeature(r,n,o,i,s.positions,e.availableImages);a.insert(t[o].feature,n,o,c,this.index)}}addConstantDashes(t){let e=!1;for(const i of this.layers){const r=i.paint.get("line-dasharray").value,n=i.layout.get("line-cap").value;if("constant"!==r.kind||"constant"!==n.kind)e=!0;else{const e=n.value,i=r.value;if(!i)continue;t.addDash(i,e)}}return e}addFeatureDashes(t,e){const i=this.zoom;for(const r of this.layers){const n=r.paint.get("line-dasharray").value,o=r.layout.get("line-cap").value;if("constant"===n.kind&&"constant"===o.kind)continue;let s,a;if("constant"===n.kind){if(s=n.value,!s)continue}else s=n.evaluate({zoom:i},t);a="constant"===o.kind?o.value:o.evaluate({zoom:i},t),e.addDash(s,a),t.patterns[r.id]=e.getKey(s,a)}}update(t,e,i,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,i,r)}addFeatures(t,e,i,r,n){for(const t of this.patternFeatures)this.addFeature(t,t.geometry,t.index,e,i,r)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,wh)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,xh),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&t.properties.hasOwnProperty("mapbox_clip_start")&&t.properties.hasOwnProperty("mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,e,i,r,n,o){const s=this.layers[0].layout,a=s.get("line-join").evaluate(t,{}),l=s.get("line-cap").evaluate(t,{}),c=s.get("line-miter-limit"),u=s.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const i of e)this.addLine(i,t,a,l,c,u);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,i,n,o,r)}addLine(t,e,i,r,n,o){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let e=0;e<t.length-1;e++)this.totalDistance+=t[e].dist(t[e+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const s="Polygon"===Th[e.type];let a=t.length;for(;a>=2&&t[a-1].equals(t[a-2]);)a--;let l=0;for(;l<a-1&&t[l].equals(t[l+1]);)l++;if(a<(s?3:2))return;"bevel"===i&&(n=1.05);const c=this.overscaling<=16?15*aa/(512*this.overscaling):0,u=this.segments.prepareSegment(10*a,this.layoutVertexArray,this.indexArray);let h,d,p,f,A;this.e1=this.e2=-1,s&&(h=t[a-2],A=t[l].sub(h)._unit()._perp());for(let e=l;e<a;e++){if(p=e===a-1?s?t[l+1]:void 0:t[e+1],p&&t[e].equals(p))continue;A&&(f=A),h&&(d=h),h=t[e],A=p?p.sub(h)._unit()._perp():f,f=f||A;let m=f.add(A);0===m.x&&0===m.y||m._unit();const g=f.x*A.x+f.y*A.y,_=m.x*A.x+m.y*A.y,y=0!==_?1/_:1/0,v=2*Math.sqrt(2-2*_),x=_<Bh&&d&&p,b=f.x*A.y-f.y*A.x>0;if(x&&e>l){const t=h.dist(d);if(t>2*c){const e=h.sub(h.sub(d)._mult(c/t)._round());this.updateDistance(d,e),this.addCurrentVertex(e,f,0,0,u),d=e}}const w=d&&p;let T=w?i:s?"butt":r;if(w&&"round"===T&&(y<o?T="miter":y<=2&&(T="fakeround")),"miter"===T&&y>n&&(T="bevel"),"bevel"===T&&(y>2&&(T="flipbevel"),y<n&&(T="miter")),d&&this.updateDistance(d,h),"miter"===T)m._mult(y),this.addCurrentVertex(h,m,0,0,u);else if("flipbevel"===T){if(y>100)m=A.mult(-1);else{const t=y*f.add(A).mag()/f.sub(A).mag();m._perp()._mult(t*(b?-1:1))}this.addCurrentVertex(h,m,0,0,u),this.addCurrentVertex(h,m.mult(-1),0,0,u)}else if("bevel"===T||"fakeround"===T){const t=-Math.sqrt(y*y-1),e=b?t:0,i=b?0:t;if(d&&this.addCurrentVertex(h,f,e,i,u),"fakeround"===T){const t=Math.round(180*v/Math.PI/20);for(let e=1;e<t;e++){let i=e/t;if(.5!==i){const t=i-.5;i+=i*t*(i-1)*((1.0904+g*(g*(3.55645-1.43519*g)-3.2452))*t*t+(.848013+g*(.215638*g-1.06021)))}const r=A.sub(f)._mult(i)._add(f)._unit()._mult(b?-1:1);this.addHalfVertex(h,r.x,r.y,!1,b,0,u)}}p&&this.addCurrentVertex(h,A,-e,-i,u)}else if("butt"===T)this.addCurrentVertex(h,m,0,0,u);else if("square"===T){const t=d?1:-1;d||this.addCurrentVertex(h,m,t,t,u),this.addCurrentVertex(h,m,0,0,u),d&&this.addCurrentVertex(h,m,t,t,u)}else"round"===T&&(d&&(this.addCurrentVertex(h,f,0,0,u),this.addCurrentVertex(h,f,1,1,u,!0)),p&&(this.addCurrentVertex(h,A,-1,-1,u,!0),this.addCurrentVertex(h,A,0,0,u)));if(x&&e<a-1){const t=h.dist(p);if(t>2*c){const e=h.add(p.sub(h)._mult(c/t)._round());this.updateDistance(h,e),this.addCurrentVertex(e,A,0,0,u),h=e}}}}addCurrentVertex(t,e,i,r,n,o=!1){const s=e.y*r-e.x,a=-e.y-e.x*r;this.addHalfVertex(t,e.x+e.y*i,e.y-e.x*i,o,!1,i,n),this.addHalfVertex(t,s,a,o,!0,-r,n)}addHalfVertex({x:t,y:e},i,r,n,o,s,a){this.layoutVertexArray.emplaceBack((t<<1)+(n?1:0),(e<<1)+(o?1:0),Math.round(63*i)+128,Math.round(63*r)+128,1+(0===s?0:s<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const l=a.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,l),a.primitiveLength++),o?this.e2=l:this.e1=l}updateScaledDistance(){if(this.lineClips){const t=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=t*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(t,e){this.distance+=t.dist(e),this.updateScaledDistance()}}Kn(Eh,"LineBucket",{omit:["layers","patternFeatures"]});const Ch=new zo({"line-cap":new Po(te.layout_line["line-cap"]),"line-join":new Po(te.layout_line["line-join"]),"line-miter-limit":new ko(te.layout_line["line-miter-limit"]),"line-round-limit":new ko(te.layout_line["line-round-limit"]),"line-sort-key":new Po(te.layout_line["line-sort-key"])});var Sh={paint:new zo({"line-opacity":new Po(te.paint_line["line-opacity"]),"line-color":new Po(te.paint_line["line-color"]),"line-translate":new ko(te.paint_line["line-translate"]),"line-translate-anchor":new ko(te.paint_line["line-translate-anchor"]),"line-width":new Po(te.paint_line["line-width"]),"line-gap-width":new Po(te.paint_line["line-gap-width"]),"line-offset":new Po(te.paint_line["line-offset"]),"line-blur":new Po(te.paint_line["line-blur"]),"line-dasharray":new Po(te.paint_line["line-dasharray"]),"line-pattern":new Po(te.paint_line["line-pattern"]),"line-gradient":new Lo(te.paint_line["line-gradient"]),"line-trim-offset":new ko(te.paint_line["line-trim-offset"])}),layout:Ch};const Ih=new class extends Po{possiblyEvaluate(t,e){return e=new bo(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,transition:e.transition}),super.possiblyEvaluate(t,e)}evaluate(t,e,i,r){return e=P({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(t,e,i,r)}}(Sh.paint.properties["line-width"].specification);function Mh(t,e){return e>0?e+2*t:t}Ih.useIntegerZoom=!0;const kh=Oo([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Ph=Oo([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),Lh=Oo([{name:"a_projected_pos",components:4,type:"Float32"}],4);Oo([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const zh=Oo([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),Fh=Oo([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);Oo([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Dh=Oo([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Rh=Oo([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Oo([{name:"triangle",components:3,type:"Uint16"}]),Oo([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Oo([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Oo([{type:"Float32",name:"offsetX"}]),Oo([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var Uh=24;const Oh=128;function Nh(t,e){const{expression:i}=e;if("constant"===i.kind)return{kind:"constant",layoutSize:i.evaluate(new bo(t+1))};if("source"===i.kind)return{kind:"source"};{const{zoomStops:e,interpolationType:r}=i;let n=0;for(;n<e.length&&e[n]<=t;)n++;n=Math.max(0,n-1);let o=n;for(;o<e.length&&e[o]<t+1;)o++;o=Math.min(e.length-1,o);const s=e[n],a=e[o];return"composite"===i.kind?{kind:"composite",minZoom:s,maxZoom:a,interpolationType:r}:{kind:"camera",minZoom:s,maxZoom:a,minSize:i.evaluate(new bo(s)),maxSize:i.evaluate(new bo(a)),interpolationType:r}}}function Qh(t,{uSize:e,uSizeT:i},{lowerSize:r,upperSize:n}){return"source"===t.kind?r/Oh:"composite"===t.kind?ki(r/Oh,n/Oh,i):e}function Vh(t,e){let i=0,r=0;if("constant"===t.kind)r=t.layoutSize;else if("source"!==t.kind){const{interpolationType:n,minZoom:o,maxZoom:s}=t,a=n?C(Yi.interpolationFactor(n,e,o,s),0,1):0;"camera"===t.kind?r=ki(t.minSize,t.maxSize,a):i=a}return{uSizeT:i,uSize:r}}var jh=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:Oh,evaluateSizeForFeature:Qh,evaluateSizeForZoom:Vh,getSizeData:Nh});function Hh(t,e,i){return t.sections.forEach((t=>{t.text=function(t,e,i){const r=e.layout.get("text-transform").evaluate(i,{});return"uppercase"===r?t=t.toLocaleUpperCase():"lowercase"===r&&(t=t.toLocaleLowerCase()),xo.applyArabicShaping&&(t=xo.applyArabicShaping(t)),t}(t.text,e,i)})),t}const Gh={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function $h(t){return""===t||""===t||""===t||""===t||""===t||""===t||""===t||""===t||""===t||""===t||""===t||""===t||""===t||""===t||""===t||""===t||""===t}function Zh(t){return""===t||""===t||""===t||""===t||""===t||""===t||""===t||""===t||""===t||""===t}var qh=Xh,Kh=function(t,e,i,r,n){var o,s,a=8*n-r-1,l=(1<<a)-1,c=l>>1,u=-7,h=i?n-1:0,d=i?-1:1,p=t[e+h];for(h+=d,o=p&(1<<-u)-1,p>>=-u,u+=a;u>0;o=256*o+t[e+h],h+=d,u-=8);for(s=o&(1<<-u)-1,o>>=-u,u+=r;u>0;s=256*s+t[e+h],h+=d,u-=8);if(0===o)o=1-c;else{if(o===l)return s?NaN:1/0*(p?-1:1);s+=Math.pow(2,r),o-=c}return(p?-1:1)*s*Math.pow(2,o-r)},Wh=function(t,e,i,r,n,o){var s,a,l,c=8*o-n-1,u=(1<<c)-1,h=u>>1,d=23===n?Math.pow(2,-24)-Math.pow(2,-77):0,p=r?0:o-1,f=r?1:-1,A=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,s=u):(s=Math.floor(Math.log(e)/Math.LN2),e*(l=Math.pow(2,-s))<1&&(s--,l*=2),(e+=s+h>=1?d/l:d*Math.pow(2,1-h))*l>=2&&(s++,l/=2),s+h>=u?(a=0,s=u):s+h>=1?(a=(e*l-1)*Math.pow(2,n),s+=h):(a=e*Math.pow(2,h-1)*Math.pow(2,n),s=0));n>=8;t[i+p]=255&a,p+=f,a/=256,n-=8);for(s=s<<n|a,c+=n;c>0;t[i+p]=255&s,p+=f,s/=256,c-=8);t[i+p-f]|=128*A};
/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function Xh(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}Xh.Varint=0,Xh.Fixed64=1,Xh.Bytes=2,Xh.Fixed32=5;var Jh=4294967296,Yh=1/Jh,td="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function ed(t){return t.type===Xh.Bytes?t.readVarint()+t.pos:t.pos+1}function id(t,e,i){return i?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function rd(t,e,i){var r=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));i.realloc(r);for(var n=i.pos-1;n>=t;n--)i.buf[n+r]=i.buf[n]}function nd(t,e){for(var i=0;i<t.length;i++)e.writeVarint(t[i])}function od(t,e){for(var i=0;i<t.length;i++)e.writeSVarint(t[i])}function sd(t,e){for(var i=0;i<t.length;i++)e.writeFloat(t[i])}function ad(t,e){for(var i=0;i<t.length;i++)e.writeDouble(t[i])}function ld(t,e){for(var i=0;i<t.length;i++)e.writeBoolean(t[i])}function cd(t,e){for(var i=0;i<t.length;i++)e.writeFixed32(t[i])}function ud(t,e){for(var i=0;i<t.length;i++)e.writeSFixed32(t[i])}function hd(t,e){for(var i=0;i<t.length;i++)e.writeFixed64(t[i])}function dd(t,e){for(var i=0;i<t.length;i++)e.writeSFixed64(t[i])}function pd(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function fd(t,e,i){t[i]=e,t[i+1]=e>>>8,t[i+2]=e>>>16,t[i+3]=e>>>24}function Ad(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}Xh.prototype={destroy:function(){this.buf=null},readFields:function(t,e,i){for(i=i||this.length;this.pos<i;){var r=this.readVarint(),n=r>>3,o=this.pos;this.type=7&r,t(n,e,this),this.pos===o&&this.skip(r)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=pd(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=Ad(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=pd(this.buf,this.pos)+pd(this.buf,this.pos+4)*Jh;return this.pos+=8,t},readSFixed64:function(){var t=pd(this.buf,this.pos)+Ad(this.buf,this.pos+4)*Jh;return this.pos+=8,t},readFloat:function(){var t=Kh(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=Kh(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,i,r=this.buf;return e=127&(i=r[this.pos++]),i<128?e:(e|=(127&(i=r[this.pos++]))<<7,i<128?e:(e|=(127&(i=r[this.pos++]))<<14,i<128?e:(e|=(127&(i=r[this.pos++]))<<21,i<128?e:function(t,e,i){var r,n,o=i.buf;if(r=(112&(n=o[i.pos++]))>>4,n<128)return id(t,r,e);if(r|=(127&(n=o[i.pos++]))<<3,n<128)return id(t,r,e);if(r|=(127&(n=o[i.pos++]))<<10,n<128)return id(t,r,e);if(r|=(127&(n=o[i.pos++]))<<17,n<128)return id(t,r,e);if(r|=(127&(n=o[i.pos++]))<<24,n<128)return id(t,r,e);if(r|=(1&(n=o[i.pos++]))<<31,n<128)return id(t,r,e);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(i=r[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&td?function(t,e,i){return td.decode(t.subarray(e,i))}(this.buf,e,t):function(t,e,i){for(var r="",n=e;n<i;){var o,s,a,l=t[n],c=null,u=l>239?4:l>223?3:l>191?2:1;if(n+u>i)break;1===u?l<128&&(c=l):2===u?128==(192&(o=t[n+1]))&&(c=(31&l)<<6|63&o)<=127&&(c=null):3===u?(s=t[n+2],128==(192&(o=t[n+1]))&&128==(192&s)&&((c=(15&l)<<12|(63&o)<<6|63&s)<=2047||c>=55296&&c<=57343)&&(c=null)):4===u&&(s=t[n+2],a=t[n+3],128==(192&(o=t[n+1]))&&128==(192&s)&&128==(192&a)&&((c=(15&l)<<18|(63&o)<<12|(63&s)<<6|63&a)<=65535||c>=1114112)&&(c=null)),null===c?(c=65533,u=1):c>65535&&(c-=65536,r+=String.fromCharCode(c>>>10&1023|55296),c=56320|1023&c),r+=String.fromCharCode(c),n+=u}return r}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==Xh.Bytes)return t.push(this.readVarint(e));var i=ed(this);for(t=t||[];this.pos<i;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==Xh.Bytes)return t.push(this.readSVarint());var e=ed(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==Xh.Bytes)return t.push(this.readBoolean());var e=ed(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==Xh.Bytes)return t.push(this.readFloat());var e=ed(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==Xh.Bytes)return t.push(this.readDouble());var e=ed(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==Xh.Bytes)return t.push(this.readFixed32());var e=ed(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==Xh.Bytes)return t.push(this.readSFixed32());var e=ed(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==Xh.Bytes)return t.push(this.readFixed64());var e=ed(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==Xh.Bytes)return t.push(this.readSFixed64());var e=ed(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===Xh.Varint)for(;this.buf[this.pos++]>127;);else if(e===Xh.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Xh.Fixed32)this.pos+=4;else{if(e!==Xh.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var i=new Uint8Array(e);i.set(this.buf),this.buf=i,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),fd(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),fd(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),fd(this.buf,-1&t,this.pos),fd(this.buf,Math.floor(t*Yh),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),fd(this.buf,-1&t,this.pos),fd(this.buf,Math.floor(t*Yh),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(t,e){var i,r;if(t>=0?(i=t%4294967296|0,r=t/4294967296|0):(r=~(-t/4294967296),4294967295^(i=~(-t%4294967296))?i=i+1|0:(i=0,r=r+1|0)),t>=0x10000000000000000||t<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),function(t,e,i){i.buf[i.pos++]=127&t|128,t>>>=7,i.buf[i.pos++]=127&t|128,t>>>=7,i.buf[i.pos++]=127&t|128,t>>>=7,i.buf[i.pos++]=127&t|128,i.buf[i.pos]=127&(t>>>=7)}(i,0,e),function(t,e){var i=(7&t)<<4;e.buf[e.pos++]|=i|((t>>>=3)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t)))))}(r,e)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(t,e,i){for(var r,n,o=0;o<e.length;o++){if((r=e.charCodeAt(o))>55295&&r<57344){if(!n){r>56319||o+1===e.length?(t[i++]=239,t[i++]=191,t[i++]=189):n=r;continue}if(r<56320){t[i++]=239,t[i++]=191,t[i++]=189,n=r;continue}r=n-55296<<10|r-56320|65536,n=null}else n&&(t[i++]=239,t[i++]=191,t[i++]=189,n=null);r<128?t[i++]=r:(r<2048?t[i++]=r>>6|192:(r<65536?t[i++]=r>>12|224:(t[i++]=r>>18|240,t[i++]=r>>12&63|128),t[i++]=r>>6&63|128),t[i++]=63&r|128)}return i}(this.buf,t,this.pos);var i=this.pos-e;i>=128&&rd(e,i,this),this.pos=e-1,this.writeVarint(i),this.pos+=i},writeFloat:function(t){this.realloc(4),Wh(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),Wh(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var i=0;i<e;i++)this.buf[this.pos++]=t[i]},writeRawMessage:function(t,e){this.pos++;var i=this.pos;t(e,this);var r=this.pos-i;r>=128&&rd(i,r,this),this.pos=i-1,this.writeVarint(r),this.pos+=r},writeMessage:function(t,e,i){this.writeTag(t,Xh.Bytes),this.writeRawMessage(e,i)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,nd,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,od,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,ld,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,sd,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,ad,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,cd,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,ud,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,hd,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,dd,e)},writeBytesField:function(t,e){this.writeTag(t,Xh.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,Xh.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,Xh.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,Xh.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,Xh.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,Xh.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,Xh.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,Xh.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,Xh.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,Xh.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}};var md=d(qh);const gd=3;function _d(t,e,i){e.glyphs=[],1===t&&i.readMessage(yd,e)}function yd(t,e,i){if(3===t){const{id:t,bitmap:r,width:n,height:o,left:s,top:a,advance:l}=i.readMessage(vd,{});e.glyphs.push({id:t,bitmap:new Uc({width:n+2*gd,height:o+2*gd},r),metrics:{width:n,height:o,left:s,top:a,advance:l}})}else 4===t?e.ascender=i.readSVarint():5===t&&(e.descender=i.readSVarint())}function vd(t,e,i){1===t?e.id=i.readVarint():2===t?e.bitmap=i.readBytes():3===t?e.width=i.readVarint():4===t?e.height=i.readVarint():5===t?e.left=i.readSVarint():6===t?e.top=i.readSVarint():7===t&&(e.advance=i.readVarint())}const xd=gd;function bd(t){let e=0,i=0;for(const r of t)e+=r.w*r.h,i=Math.max(i,r.w);t.sort(((t,e)=>e.h-t.h));const r=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),i),h:1/0}];let n=0,o=0;for(const e of t)for(let t=r.length-1;t>=0;t--){const i=r[t];if(!(e.w>i.w||e.h>i.h)){if(e.x=i.x,e.y=i.y,o=Math.max(o,e.y+e.h),n=Math.max(n,e.x+e.w),e.w===i.w&&e.h===i.h){const e=r.pop();t<r.length&&(r[t]=e)}else e.h===i.h?(i.x+=e.w,i.w-=e.w):e.w===i.w?(i.y+=e.h,i.h-=e.h):(r.push({x:i.x+e.w,y:i.y,w:i.w-e.w,h:e.h}),i.y+=e.h,i.h-=e.h);break}}return{w:n,h:o,fill:e/(n*o)||0}}const wd=1;class Td{constructor(t,{pixelRatio:e,version:i,stretchX:r,stretchY:n,content:o}){this.paddedRect=t,this.pixelRatio=e,this.stretchX=r,this.stretchY=n,this.content=o,this.version=i}get tl(){return[this.paddedRect.x+wd,this.paddedRect.y+wd]}get br(){return[this.paddedRect.x+this.paddedRect.w-wd,this.paddedRect.y+this.paddedRect.h-wd]}get displaySize(){return[(this.paddedRect.w-2*wd)/this.pixelRatio,(this.paddedRect.h-2*wd)/this.pixelRatio]}}class Bd{constructor(t,e){const i={},r={};this.haveRenderCallbacks=[];const n=[];this.addImages(t,i,n),this.addImages(e,r,n);const{w:o,h:s}=bd(n),a=new Oc({width:o||1,height:s||1});for(const e in t){const r=t[e],n=i[e].paddedRect;Oc.copy(r.data,a,{x:0,y:0},{x:n.x+wd,y:n.y+wd},r.data)}for(const t in e){const i=e[t],n=r[t].paddedRect,o=n.x+wd,s=n.y+wd,l=i.data.width,c=i.data.height;Oc.copy(i.data,a,{x:0,y:0},{x:o,y:s},i.data),Oc.copy(i.data,a,{x:0,y:c-1},{x:o,y:s-1},{width:l,height:1}),Oc.copy(i.data,a,{x:0,y:0},{x:o,y:s+c},{width:l,height:1}),Oc.copy(i.data,a,{x:l-1,y:0},{x:o-1,y:s},{width:1,height:c}),Oc.copy(i.data,a,{x:0,y:0},{x:o+l,y:s},{width:1,height:c})}this.image=a,this.iconPositions=i,this.patternPositions=r}addImages(t,e,i){for(const r in t){const n=t[r],o={x:0,y:0,w:n.data.width+2*wd,h:n.data.height+2*wd};i.push(o),e[r]=new Td(o,n),n.hasRenderCallback&&this.haveRenderCallbacks.push(r)}}patchUpdatedImages(t,e){this.haveRenderCallbacks=this.haveRenderCallbacks.filter((e=>t.hasImage(e))),t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const i in t.updatedImages)this.patchUpdatedImage(this.iconPositions[i],t.getImage(i),e),this.patchUpdatedImage(this.patternPositions[i],t.getImage(i),e)}patchUpdatedImage(t,e,i){if(!t||!e)return;if(t.version===e.version)return;t.version=e.version;const[r,n]=t.tl;i.update(e.data,void 0,{x:r,y:n})}}Kn(Td,"ImagePosition"),Kn(Bd,"ImageAtlas");const Ed={horizontal:1,vertical:2,horizontalOnly:3},Cd=-17;class Sd{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(t,e){const i=new Sd;return i.scale=t||1,i.fontStack=e,i}static forImage(t){const e=new Sd;return e.imageName=t,e}}class Id{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,e){const i=new Id;for(let r=0;r<t.sections.length;r++){const n=t.sections[r];n.image?i.addImageSection(n):i.addTextSection(n,e)}return i}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSections(){return this.sections}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(t){this.text=function(t,e){let i="";for(let r=0;r<t.length;r++){const n=t.charCodeAt(r+1)||null,o=t.charCodeAt(r-1)||null;i+=!e&&(n&&oo(n)&&!Gh[t[r+1]]||o&&oo(o)&&!Gh[t[r-1]])||!Gh[t[r]]?t[r]:Gh[t[r]]}return i}(this.text,t)}trim(){let t=0;for(let e=0;e<this.text.length&&kd[this.text.charCodeAt(e)];e++)t++;let e=this.text.length;for(let i=this.text.length-1;i>=0&&i>=t&&kd[this.text.charCodeAt(i)];i--)e--;this.text=this.text.substring(t,e),this.sectionIndex=this.sectionIndex.slice(t,e)}substring(t,e){const i=new Id;return i.text=this.text.substring(t,e),i.sectionIndex=this.sectionIndex.slice(t,e),i.sections=this.sections,i}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((t,e)=>Math.max(t,this.sections[e].scale)),0)}addTextSection(t,e){this.text+=t.text,this.sections.push(Sd.forText(t.scale,t.fontStack||e));const i=this.sections.length-1;for(let e=0;e<t.text.length;++e)this.sectionIndex.push(i)}addImageSection(t){const e=t.image?t.image.name:"";if(0===e.length)return void H("Can't add FormattedSection with an empty image.");const i=this.getNextImageSectionCharCode();i?(this.text+=String.fromCharCode(i),this.sections.push(Sd.forImage(e)),this.sectionIndex.push(this.sections.length-1)):H("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Md(t,e,i,r,n,o,s,a,l,c,u,h,d,p,f){const A=Id.fromFeature(t,n);h===Ed.vertical&&A.verticalizePunctuation(d);let m=[];const g=function(t,e,i,r,n,o){if(!t)return[];const s=[],a=function(t,e,i,r,n,o){let s=0;for(let i=0;i<t.length();i++){const a=t.getSection(i);s+=Ld(t.getCharCode(i),a,r,n,e,o)}return s/Math.max(1,Math.ceil(s/i))}(t,e,i,r,n,o),l=t.text.indexOf("")>=0;let c=0;for(let i=0;i<t.length();i++){const h=t.getSection(i),d=t.getCharCode(i);if(kd[d]||(c+=Ld(d,h,r,n,e,o)),i<t.length()-1){const e=!((u=d)<11904||!(to["Bopomofo Extended"](u)||to.Bopomofo(u)||to["CJK Compatibility Forms"](u)||to["CJK Compatibility Ideographs"](u)||to["CJK Compatibility"](u)||to["CJK Radicals Supplement"](u)||to["CJK Strokes"](u)||to["CJK Symbols and Punctuation"](u)||to["CJK Unified Ideographs Extension A"](u)||to["CJK Unified Ideographs"](u)||to["Enclosed CJK Letters and Months"](u)||to["Halfwidth and Fullwidth Forms"](u)||to.Hiragana(u)||to["Ideographic Description Characters"](u)||to["Kangxi Radicals"](u)||to["Katakana Phonetic Extensions"](u)||to.Katakana(u)||to["Vertical Forms"](u)||to["Yi Radicals"](u)||to["Yi Syllables"](u)));(Pd[d]||e||h.imageName)&&s.push(Dd(i+1,c,a,s,Fd(d,t.getCharCode(i+1),e&&l),!1))}}var u;return Rd(Dd(t.length(),c,a,s,0,!0))}(A,c,o,e,r,p),{processBidirectionalText:_,processStyledBidirectionalText:y}=xo;if(_&&1===A.sections.length){const t=_(A.toString(),g);for(const e of t){const t=new Id;t.text=e,t.sections=A.sections;for(let i=0;i<e.length;i++)t.sectionIndex.push(0);m.push(t)}}else if(y){const t=y(A.text,A.sectionIndex,g);for(const e of t){const t=new Id;t.text=e[0],t.sectionIndex=e[1],t.sections=A.sections,m.push(t)}}else m=function(t,e){const i=[],r=t.text;let n=0;for(const r of e)i.push(t.substring(n,r)),n=r;return n<r.length&&i.push(t.substring(n,r.length)),i}(A,g);const v=[],x={positionedLines:v,text:A.toString(),top:u[1],bottom:u[1],left:u[0],right:u[0],writingMode:h,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(t,e,i,r,n,o,s,a,l,c,u,h){let d=0,p=0,f=0;const A="right"===a?1:"left"===a?0:.5;let m=!1;for(const t of n){const i=t.getSections();for(const t of i){if(t.imageName)continue;const i=e[t.fontStack];if(i&&(m=void 0!==i.ascender&&void 0!==i.descender,!m))break}if(!m)break}let g=0;for(const s of n){s.trim();const n=s.getMaxScale(),a=(n-1)*Uh,y={positionedGlyphs:[],lineOffset:0};t.positionedLines[g]=y;const v=y.positionedGlyphs;let x=0;if(!s.length()){p+=o,++g;continue}let b=0,w=0;for(let o=0;o<s.length();o++){const a=s.getSection(o),f=s.getSectionIndex(o),A=s.getCharCode(o);let g=a.scale,y=null,T=null,B=null,E=Uh,C=0;const S=!(l===Ed.horizontal||!u&&!no(A)||u&&(kd[A]||(_=A,to.Arabic(_)||to["Arabic Supplement"](_)||to["Arabic Extended-A"](_)||to["Arabic Presentation Forms-A"](_)||to["Arabic Presentation Forms-B"](_))));if(a.imageName){const e=r[a.imageName];if(!e)continue;B=a.imageName,t.iconsInText=t.iconsInText||!0,T=e.paddedRect;const i=e.displaySize;g=g*Uh/h,y={width:i[0],height:i[1],left:wd,top:-xd,advance:S?i[1]:i[0],localGlyph:!1},C=m?-y.height*g:Cd+n*Uh-i[1]*g,E=y.advance;const o=(S?i[0]:i[1])*g-Uh*n;o>0&&o>x&&(x=o)}else{const t=i[a.fontStack];if(!t)continue;t[A]&&(T=t[A]);const r=e[a.fontStack];if(!r)continue;const o=r.glyphs[A];if(!o)continue;if(y=o.metrics,E=8203!==A?Uh:0,m){const t=void 0!==r.ascender?Math.abs(r.ascender):0,e=void 0!==r.descender?Math.abs(r.descender):0,i=(t+e)*g;b<i&&(b=i,w=(t-e)/2*g),C=-t*g}else C=Cd+(n-g)*Uh}S?(t.verticalizable=!0,v.push({glyph:A,imageName:B,x:d,y:p+C,vertical:S,scale:g,localGlyph:y.localGlyph,fontStack:a.fontStack,sectionIndex:f,metrics:y,rect:T}),d+=E*g+c):(v.push({glyph:A,imageName:B,x:d,y:p+C,vertical:S,scale:g,localGlyph:y.localGlyph,fontStack:a.fontStack,sectionIndex:f,metrics:y,rect:T}),d+=y.advance*g+c)}0!==v.length&&(f=Math.max(d-c,f),m?Od(v,A,x,w,o*n/2):Od(v,A,x,0,o/2)),d=0;const T=o*n+x;y.lineOffset=Math.max(x,a),p+=T,++g}var _;const y=p,{horizontalAlign:v,verticalAlign:x}=Ud(s);(function(t,e,i,r,n,o){const s=(e-i)*n,a=-o*r;for(const e of t)for(const t of e.positionedGlyphs)t.x+=s,t.y+=a})(t.positionedLines,A,v,x,f,y),t.top+=-x*y,t.bottom=t.top+y,t.left+=-v*f,t.right=t.left+f,t.hasBaseline=m}(x,e,i,r,m,s,a,l,h,c,d,f),!function(t){for(const e of t)if(0!==e.positionedGlyphs.length)return!1;return!0}(v)&&x}const kd={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Pd={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Ld(t,e,i,r,n,o){if(e.imageName){const t=r[e.imageName];return t?t.displaySize[0]*e.scale*Uh/o+n:0}{const r=i[e.fontStack],o=r&&r.glyphs[t];return o?o.metrics.advance*e.scale+n:0}}function zd(t,e,i,r){const n=Math.pow(t-e,2);return r?t<e?n/2:2*n:n+Math.abs(i)*i}function Fd(t,e,i){let r=0;return 10===t&&(r-=1e4),i&&(r+=150),40!==t&&65288!==t||(r+=50),41!==e&&65289!==e||(r+=50),r}function Dd(t,e,i,r,n,o){let s=null,a=zd(e,i,n,o);for(const t of r){const r=zd(e-t.x,i,n,o)+t.badness;r<=a&&(s=t,a=r)}return{index:t,x:e,priorBreak:s,badness:a}}function Rd(t){return t?Rd(t.priorBreak).concat(t.index):[]}function Ud(t){let e=.5,i=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:e,verticalAlign:i}}function Od(t,e,i,r,n){if(!(e||i||r||n))return;const o=t.length-1,s=t[o],a=(s.x+s.metrics.advance*s.scale)*e;for(let e=0;e<=o;e++)t[e].x-=a,t[e].y+=i+r+n}function Nd(t,e,i){const{horizontalAlign:r,verticalAlign:n}=Ud(i),o=e[0]-t.displaySize[0]*r,s=e[1]-t.displaySize[1]*n;return{image:t,top:s,bottom:s+t.displaySize[1],left:o,right:o+t.displaySize[0]}}function Qd(t,e,i,r,n,o){const s=t.image;let a;if(s.content){const t=s.content,e=s.pixelRatio||1;a=[t[0]/e,t[1]/e,s.displaySize[0]-t[2]/e,s.displaySize[1]-t[3]/e]}const l=e.left*o,c=e.right*o;let u,h,d,p;"width"===i||"both"===i?(p=n[0]+l-r[3],h=n[0]+c+r[1]):(p=n[0]+(l+c-s.displaySize[0])/2,h=p+s.displaySize[0]);const f=e.top*o,A=e.bottom*o;return"height"===i||"both"===i?(u=n[1]+f-r[0],d=n[1]+A+r[2]):(u=n[1]+(f+A-s.displaySize[1])/2,d=u+s.displaySize[1]),{image:s,top:u,right:h,bottom:d,left:p,collisionPadding:a}}class Vd extends _{constructor(t,e,i,r,n){super(t,e),this.angle=r,this.z=i,void 0!==n&&(this.segment=n)}clone(){return new Vd(this.x,this.y,this.z,this.angle,this.segment)}}function jd(t,e,i,r,n){if(void 0===e.segment)return!0;let o=e,s=e.segment+1,a=0;for(;a>-i/2;){if(s--,s<0)return!1;a-=t[s].dist(o),o=t[s]}a+=t[s].dist(t[s+1]),s++;const l=[];let c=0;for(;a<i/2;){const e=t[s],i=t[s+1];if(!i)return!1;let o=t[s-1].angleTo(e)-e.angleTo(i);for(o=Math.abs((o+3*Math.PI)%(2*Math.PI)-Math.PI),l.push({distance:a,angleDelta:o}),c+=o;a-l[0].distance>r;)c-=l.shift().angleDelta;if(c>n)return!1;s++,a+=e.dist(i)}return!0}function Hd(t){let e=0;for(let i=0;i<t.length-1;i++)e+=t[i].dist(t[i+1]);return e}function Gd(t,e,i){return t?.6*e*i:0}function $d(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function Zd(t,e,i,r,n,o){const s=Gd(i,n,o),a=$d(i,r)*o;let l=0;const c=Hd(t)/2;for(let i=0;i<t.length-1;i++){const r=t[i],n=t[i+1],o=r.dist(n);if(l+o>c){const u=(c-l)/o,h=ki(r.x,n.x,u),d=ki(r.y,n.y,u),p=new Vd(h,d,0,n.angleTo(r),i);return!s||jd(t,p,a,s,e)?p:void 0}l+=o}}function qd(t,e,i,r,n,o,s,a,l){const c=Gd(r,o,s),u=$d(r,n),h=u*s,d=0===t[0].x||t[0].x===l||0===t[0].y||t[0].y===l;return e-h<e/4&&(e=h+e/4),Kd(t,d?e/2*a%e:(u/2+2*o)*s*a%e,e,c,i,h,d,!1,l)}function Kd(t,e,i,r,n,o,s,a,l){const c=o/2,u=Hd(t);let h=0,d=e-i,p=[];for(let e=0;e<t.length-1;e++){const s=t[e],a=t[e+1],f=s.dist(a),A=a.angleTo(s);for(;d+i<h+f;){d+=i;const m=(d-h)/f,g=ki(s.x,a.x,m),_=ki(s.y,a.y,m);if(g>=0&&g<l&&_>=0&&_<l&&d-c>=0&&d+c<=u){const i=new Vd(g,_,0,A,e);i._round(),r&&!jd(t,i,o,r,n)||p.push(i)}}h+=f}return a||p.length||s||(p=Kd(t,h/2,i,r,n,o,s,!0,l)),p}function Wd(t,e,i,r,n){const o=[];for(let s=0;s<t.length;s++){const a=t[s];let l;for(let t=0;t<a.length-1;t++){let s=a[t],c=a[t+1];s.x<e&&c.x<e||(s.x<e?s=new _(e,s.y+(e-s.x)/(c.x-s.x)*(c.y-s.y))._round():c.x<e&&(c=new _(e,s.y+(e-s.x)/(c.x-s.x)*(c.y-s.y))._round()),s.y<i&&c.y<i||(s.y<i?s=new _(s.x+(i-s.y)/(c.y-s.y)*(c.x-s.x),i)._round():c.y<i&&(c=new _(s.x+(i-s.y)/(c.y-s.y)*(c.x-s.x),i)._round()),s.x>=r&&c.x>=r||(s.x>=r?s=new _(r,s.y+(r-s.x)/(c.x-s.x)*(c.y-s.y))._round():c.x>=r&&(c=new _(r,s.y+(r-s.x)/(c.x-s.x)*(c.y-s.y))._round()),s.y>=n&&c.y>=n||(s.y>=n?s=new _(s.x+(n-s.y)/(c.y-s.y)*(c.x-s.x),n)._round():c.y>=n&&(c=new _(s.x+(n-s.y)/(c.y-s.y)*(c.x-s.x),n)._round()),l&&s.equals(l[l.length-1])||(l=[s],o.push(l)),l.push(c)))))}}return o}Kn(Vd,"Anchor");const Xd=1e20;function Jd(t,e,i,r,n,o,s,a,l){for(let c=e;c<e+r;c++)Yd(t,i*o+c,o,n,s,a,l);for(let c=i;c<i+n;c++)Yd(t,c*o+e,1,r,s,a,l)}function Yd(t,e,i,r,n,o,s){o[0]=0,s[0]=-Xd,s[1]=Xd,n[0]=t[e];for(let a=1,l=0,c=0;a<r;a++){n[a]=t[e+a*i];const r=a*a;do{const t=o[l];c=(n[a]-n[t]+r-t*t)/(a-t)/2}while(c<=s[l]&&--l>-1);l++,o[l]=a,s[l]=c,s[l+1]=Xd}for(let a=0,l=0;a<r;a++){for(;s[l+1]<a;)l++;const r=o[l],c=a-r;t[e+a*i]=n[r]+c*c}}const tp=2,ep={none:0,ideographs:1,all:2};class ip{constructor(t,e,i){this.requestManager=t,this.localGlyphMode=e,this.localFontFamily=i,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(t){this.url=t}getGlyphs(t,e){const i=[];for(const e in t)for(const r of t[e])i.push({stack:e,id:r});M(i,(({stack:t,id:e},i)=>{let r=this.entries[t];r||(r=this.entries[t]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let n=r.glyphs[e];if(void 0!==n)return void i(null,{stack:t,id:e,glyph:n});if(n=this._tinySDF(r,t,e),n)return r.glyphs[e]=n,void i(null,{stack:t,id:e,glyph:n});const o=Math.floor(e/256);if(256*o>65535)return void i(new Error("glyphs > 65535 not supported"));if(r.ranges[o])return void i(null,{stack:t,id:e,glyph:n});let s=r.requests[o];s||(s=r.requests[o]=[],ip.loadGlyphRange(t,o,this.url,this.requestManager,((t,e)=>{if(e){r.ascender=e.ascender,r.descender=e.descender;for(const t in e.glyphs)this._doesCharSupportLocalGlyph(+t)||(r.glyphs[+t]=e.glyphs[+t]);r.ranges[o]=!0}for(const i of s)i(t,e);delete r.requests[o]}))),s.push(((r,n)=>{r?i(r):n&&i(null,{stack:t,id:e,glyph:n.glyphs[e]||null})}))}),((t,i)=>{if(t)e(t);else if(i){const t={};for(const{stack:e,id:r,glyph:n}of i)void 0===t[e]&&(t[e]={}),void 0===t[e].glyphs&&(t[e].glyphs={}),t[e].glyphs[r]=n&&{id:n.id,bitmap:n.bitmap.clone(),metrics:n.metrics},t[e].ascender=this.entries[e].ascender,t[e].descender=this.entries[e].descender;e(null,t)}}))}_doesCharSupportLocalGlyph(t){return this.localGlyphMode!==ep.none&&(this.localGlyphMode===ep.all?!!this.localFontFamily:!!this.localFontFamily&&(to["CJK Unified Ideographs"](t)||to["Hangul Syllables"](t)||to.Hiragana(t)||to.Katakana(t)||to["CJK Symbols and Punctuation"](t)))}_tinySDF(t,e,i){const r=this.localFontFamily;if(!r||!this._doesCharSupportLocalGlyph(i))return;let n=t.tinySDF;if(!n){let i="400";/bold/i.test(e)?i="900":/medium/i.test(e)?i="500":/light/i.test(e)&&(i="200"),n=t.tinySDF=new ip.TinySDF({fontFamily:r,fontWeight:i,fontSize:24*tp,buffer:3*tp,radius:8*tp}),n.fontWeight=i}if(this.localGlyphs[n.fontWeight][i])return this.localGlyphs[n.fontWeight][i];const o=String.fromCharCode(i),{data:s,width:a,height:l,glyphWidth:c,glyphHeight:u,glyphLeft:h,glyphTop:d,glyphAdvance:p}=n.draw(o);return this.localGlyphs[n.fontWeight][i]={id:i,bitmap:new Uc({width:a,height:l},s),metrics:{width:c/tp,height:u/tp,left:h/tp,top:d/tp-27,advance:p/tp,localGlyph:!0}}}}ip.loadGlyphRange=function(t,e,i,r,n){const o=256*e,s=o+255,a=r.transformRequest(r.normalizeGlyphsURL(i).replace("{fontstack}",t).replace("{range}",`${o}-${s}`),lt.Glyphs);dt(a,((t,e)=>{if(t)n(t);else if(e){const t={},i=function(t){return new md(t).readFields(_d,{})}(e);for(const e of i.glyphs)t[e.id]=e;n(null,{glyphs:t,ascender:i.ascender,descender:i.descender})}}))},ip.TinySDF=class{constructor({fontSize:t=24,buffer:e=3,radius:i=8,cutoff:r=.25,fontFamily:n="sans-serif",fontWeight:o="normal",fontStyle:s="normal"}={}){this.buffer=e,this.cutoff=r,this.radius=i;const a=this.size=t+4*e,l=this._createCanvas(a),c=this.ctx=l.getContext("2d",{willReadFrequently:!0});c.font=`${s} ${o} ${t}px ${n}`,c.textBaseline="alphabetic",c.textAlign="left",c.fillStyle="black",this.gridOuter=new Float64Array(a*a),this.gridInner=new Float64Array(a*a),this.f=new Float64Array(a),this.z=new Float64Array(a+1),this.v=new Uint16Array(a)}_createCanvas(t){const e=document.createElement("canvas");return e.width=e.height=t,e}draw(t){const{width:e,actualBoundingBoxAscent:i,actualBoundingBoxDescent:r,actualBoundingBoxLeft:n,actualBoundingBoxRight:o}=this.ctx.measureText(t),s=Math.ceil(i),a=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(o-n))),l=Math.min(this.size-this.buffer,s+Math.ceil(r)),c=a+2*this.buffer,u=l+2*this.buffer,h=Math.max(c*u,0),d=new Uint8ClampedArray(h),p={data:d,width:c,height:u,glyphWidth:a,glyphHeight:l,glyphTop:s,glyphLeft:0,glyphAdvance:e};if(0===a||0===l)return p;const{ctx:f,buffer:A,gridInner:m,gridOuter:g}=this;f.clearRect(A,A,a,l),f.fillText(t,A,A+s);const _=f.getImageData(A,A,a,l);g.fill(Xd,0,h),m.fill(0,0,h);for(let t=0;t<l;t++)for(let e=0;e<a;e++){const i=_.data[4*(t*a+e)+3]/255;if(0===i)continue;const r=(t+A)*c+e+A;if(1===i)g[r]=0,m[r]=Xd;else{const t=.5-i;g[r]=t>0?t*t:0,m[r]=t<0?t*t:0}}Jd(g,0,0,c,u,c,this.f,this.v,this.z),Jd(m,A,A,a,l,c,this.f,this.v,this.z);for(let t=0;t<h;t++){const e=Math.sqrt(g[t])-Math.sqrt(m[t]);d[t]=Math.round(255-255*(e/this.radius+this.cutoff))}return p}};const rp=wd;function np(t,e,i,r){const n=[],o=t.image,s=o.pixelRatio,a=o.paddedRect.w-2*rp,l=o.paddedRect.h-2*rp,c=t.right-t.left,u=t.bottom-t.top,h=o.stretchX||[[0,a]],d=o.stretchY||[[0,l]],p=(t,e)=>t+e[1]-e[0],f=h.reduce(p,0),A=d.reduce(p,0),m=a-f,g=l-A;let y=0,v=f,x=0,b=A,w=0,T=m,B=0,E=g;if(o.content&&r){const t=o.content;y=op(h,0,t[0]),x=op(d,0,t[1]),v=op(h,t[0],t[2]),b=op(d,t[1],t[3]),w=t[0]-y,B=t[1]-x,T=t[2]-t[0]-v,E=t[3]-t[1]-b}const C=(r,n,a,l)=>{const h=ap(r.stretch-y,v,c,t.left),d=lp(r.fixed-w,T,r.stretch,f),p=ap(n.stretch-x,b,u,t.top),m=lp(n.fixed-B,E,n.stretch,A),g=ap(a.stretch-y,v,c,t.left),C=lp(a.fixed-w,T,a.stretch,f),S=ap(l.stretch-x,b,u,t.top),I=lp(l.fixed-B,E,l.stretch,A),M=new _(h,p),k=new _(g,p),P=new _(g,S),L=new _(h,S),z=new _(d/s,m/s),F=new _(C/s,I/s),D=e*Math.PI/180;if(D){const t=Math.sin(D),e=Math.cos(D),i=[e,-t,t,e];M._matMult(i),k._matMult(i),L._matMult(i),P._matMult(i)}const R=r.stretch+r.fixed,U=n.stretch+n.fixed;return{tl:M,tr:k,bl:L,br:P,tex:{x:o.paddedRect.x+rp+R,y:o.paddedRect.y+rp+U,w:a.stretch+a.fixed-R,h:l.stretch+l.fixed-U},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:z,pixelOffsetBR:F,minFontScaleX:T/s/c,minFontScaleY:E/s/u,isSDF:i}};if(r&&(o.stretchX||o.stretchY)){const t=sp(h,m,f),e=sp(d,g,A);for(let i=0;i<t.length-1;i++){const r=t[i],o=t[i+1];for(let t=0;t<e.length-1;t++)n.push(C(r,e[t],o,e[t+1]))}}else n.push(C({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:a+1},{fixed:0,stretch:l+1}));return n}function op(t,e,i){let r=0;for(const n of t)r+=Math.max(e,Math.min(i,n[1]))-Math.max(e,Math.min(i,n[0]));return r}function sp(t,e,i){const r=[{fixed:-rp,stretch:0}];for(const[e,i]of t){const t=r[r.length-1];r.push({fixed:e-t.stretch,stretch:t.stretch}),r.push({fixed:e-t.stretch,stretch:t.stretch+(i-e)})}return r.push({fixed:e+rp,stretch:i}),r}function ap(t,e,i,r){return t/e*i+r}function lp(t,e,i,r){return t-e*i/r}function cp(t,e,i,r){const n=e+t.positionedLines[r].lineOffset;return 0===r?i+n/2:i+(n+(e+t.positionedLines[r-1].lineOffset))/2}class up{constructor(t=[],e=hp){if(this.data=t,this.length=this.data.length,this.compare=e,this.length>0)for(let t=(this.length>>1)-1;t>=0;t--)this._down(t)}push(t){this.data.push(t),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const t=this.data[0],e=this.data.pop();return this.length--,this.length>0&&(this.data[0]=e,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:e,compare:i}=this,r=e[t];for(;t>0;){const n=t-1>>1,o=e[n];if(i(r,o)>=0)break;e[t]=o,t=n}e[t]=r}_down(t){const{data:e,compare:i}=this,r=this.length>>1,n=e[t];for(;t<r;){let r=1+(t<<1),o=e[r];const s=r+1;if(s<this.length&&i(e[s],o)<0&&(r=s,o=e[s]),i(o,n)>=0)break;e[t]=o,t=r}e[t]=n}}function hp(t,e){return t<e?-1:t>e?1:0}function dp(t,e=1,i=!1){let r=1/0,n=1/0,o=-1/0,s=-1/0;const a=t[0];for(let t=0;t<a.length;t++){const e=a[t];(!t||e.x<r)&&(r=e.x),(!t||e.y<n)&&(n=e.y),(!t||e.x>o)&&(o=e.x),(!t||e.y>s)&&(s=e.y)}const l=Math.min(o-r,s-n);let c=l/2;const u=new up([],pp);if(0===l)return new _(r,n);for(let e=r;e<o;e+=l)for(let i=n;i<s;i+=l)u.push(new fp(e+c,i+c,c,t));let h=function(t){let e=0,i=0,r=0;const n=t[0];for(let t=0,o=n.length,s=o-1;t<o;s=t++){const o=n[t],a=n[s],l=o.x*a.y-a.x*o.y;i+=(o.x+a.x)*l,r+=(o.y+a.y)*l,e+=3*l}return new fp(i/e,r/e,0,t)}(t),d=u.length;for(;u.length;){const r=u.pop();(r.d>h.d||!h.d)&&(h=r,i&&console.log("found best %d after %d probes",Math.round(1e4*r.d)/1e4,d)),r.max-h.d<=e||(c=r.h/2,u.push(new fp(r.p.x-c,r.p.y-c,c,t)),u.push(new fp(r.p.x+c,r.p.y-c,c,t)),u.push(new fp(r.p.x-c,r.p.y+c,c,t)),u.push(new fp(r.p.x+c,r.p.y+c,c,t)),d+=4)}return i&&(console.log(`num probes: ${d}`),console.log(`best distance: ${h.d}`)),h.p}function pp(t,e){return e.max-t.max}class fp{constructor(t,e,i,r){this.p=new _(t,e),this.h=i,this.d=function(t,e){let i=!1,r=1/0;for(let n=0;n<e.length;n++){const o=e[n];for(let e=0,n=o.length,s=n-1;e<n;s=e++){const n=o[e],a=o[s];n.y>t.y!=a.y>t.y&&t.x<(a.x-n.x)*(t.y-n.y)/(a.y-n.y)+n.x&&(i=!i),r=Math.min(r,_c(t,n,a))}}return(i?1:-1)*Math.sqrt(r)}(this.p,r),this.max=this.d+this.h*Math.SQRT2}}const Ap=7,mp=Number.POSITIVE_INFINITY,gp=Math.sqrt(2);function _p(t,[e,i]){let r=0,n=0;if(i===mp){e<0&&(e=0);const i=e/gp;switch(t){case"top-right":case"top-left":n=i-Ap;break;case"bottom-right":case"bottom-left":n=-i+Ap;break;case"bottom":n=-e+Ap;break;case"top":n=e-Ap}switch(t){case"top-right":case"bottom-right":r=-i;break;case"top-left":case"bottom-left":r=i;break;case"left":r=e;break;case"right":r=-e}}else{switch(e=Math.abs(e),i=Math.abs(i),t){case"top-right":case"top-left":case"top":n=i-Ap;break;case"bottom-right":case"bottom-left":case"bottom":n=-i+Ap}switch(t){case"top-right":case"bottom-right":case"right":r=-e;break;case"top-left":case"bottom-left":case"left":r=e}}return[r,n]}function yp(t,e,i,r,n,o,s,a,l,c){t.createArrays(),t.tilePixelRatio=aa/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;const u=t.layers[0].layout,h=t.layers[0]._unevaluatedLayout._values,d={};if("composite"===t.textSizeData.kind){const{minZoom:e,maxZoom:i}=t.textSizeData;d.compositeTextSizes=[h["text-size"].possiblyEvaluate(new bo(e),a),h["text-size"].possiblyEvaluate(new bo(i),a)]}if("composite"===t.iconSizeData.kind){const{minZoom:e,maxZoom:i}=t.iconSizeData;d.compositeIconSizes=[h["icon-size"].possiblyEvaluate(new bo(e),a),h["icon-size"].possiblyEvaluate(new bo(i),a)]}d.layoutTextSize=h["text-size"].possiblyEvaluate(new bo(l+1),a),d.layoutIconSize=h["icon-size"].possiblyEvaluate(new bo(l+1),a),d.textMaxSize=h["text-size"].possiblyEvaluate(new bo(18),a);const p="map"===u.get("text-rotation-alignment")&&"point"!==u.get("symbol-placement"),f=u.get("text-size");for(const o of t.features){const l=u.get("text-font").evaluate(o,{},a).join(","),h=f.evaluate(o,{},a),A=d.layoutTextSize.evaluate(o,{},a),m=(d.layoutIconSize.evaluate(o,{},a),{horizontal:{},vertical:void 0}),g=o.text;let _,y=[0,0];if(g){const r=g.toString(),s=u.get("text-letter-spacing").evaluate(o,{},a)*Uh,c=u.get("text-line-height").evaluate(o,{},a)*Uh,d=io(r)?s:0,f=u.get("text-anchor").evaluate(o,{},a),_=u.get("text-variable-anchor");if(!_){const t=u.get("text-radial-offset").evaluate(o,{},a);y=t?_p(f,[t*Uh,mp]):u.get("text-offset").evaluate(o,{},a).map((t=>t*Uh))}let v=p?"center":u.get("text-justify").evaluate(o,{},a);const x="point"===u.get("symbol-placement"),b=x?u.get("text-max-width").evaluate(o,{},a)*Uh:1/0,w=o=>{t.allowVerticalPlacement&&eo(r)&&(m.vertical=Md(g,e,i,n,l,b,c,f,o,d,y,Ed.vertical,!0,A,h))};if(!p&&_){const t="auto"===v?_.map((t=>vp(t))):[v];let r=!1;for(let o=0;o<t.length;o++){const s=t[o];if(!m.horizontal[s])if(r)m.horizontal[s]=m.horizontal[0];else{const t=Md(g,e,i,n,l,b,c,"center",s,d,y,Ed.horizontal,!1,A,h);t&&(m.horizontal[s]=t,r=1===t.positionedLines.length)}}w("left")}else{if("auto"===v&&(v=vp(f)),x||u.get("text-writing-mode").indexOf("horizontal")>=0||!eo(r)){const t=Md(g,e,i,n,l,b,c,f,v,d,y,Ed.horizontal,!1,A,h);t&&(m.horizontal[v]=t)}w(x?"left":v)}}let v=!1;if(o.icon&&o.icon.name){const e=r[o.icon.name];e&&(_=Nd(n[o.icon.name],u.get("icon-offset").evaluate(o,{},a),u.get("icon-anchor").evaluate(o,{},a)),v=e.sdf,void 0===t.sdfIcons?t.sdfIcons=e.sdf:t.sdfIcons!==e.sdf&&H("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(e.pixelRatio!==t.pixelRatio||0!==u.get("icon-rotate").constantOr(1))&&(t.iconsNeedLinear=!0))}const x=Bp(m.horizontal)||m.vertical;t.iconsInText||(t.iconsInText=!!x&&x.iconsInText),(x||_)&&xp(t,o,m,_,r,d,A,0,y,v,s,a,c)}o&&t.generateCollisionDebugBuffers(l,t.collisionBoxArray)}function vp(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function xp(t,e,i,r,n,o,s,a,l,c,u,h,d){let p=o.textMaxSize.evaluate(e,{},h);void 0===p&&(p=s);const f=t.layers[0].layout,A=f.get("icon-offset").evaluate(e,{},h),m=Bp(i.horizontal)||i.vertical,g="globe"===d.name,_=Uh,y=s/_,v=t.tilePixelRatio*p/_,b=(M=t.overscaling,t.zoom>18&&M>2&&(M>>=1),Math.max(aa/(512*M),1)*f.get("symbol-spacing")),w=f.get("text-padding")*t.tilePixelRatio,T=f.get("icon-padding")*t.tilePixelRatio,B=x(f.get("text-max-angle")),E="map"===f.get("text-rotation-alignment")&&"point"!==f.get("symbol-placement"),C="map"===f.get("icon-rotation-alignment")&&"point"!==f.get("symbol-placement"),S=f.get("symbol-placement"),I=b/2;var M;const k=f.get("icon-text-fit");let P;r&&"none"!==k&&(t.allowVerticalPlacement&&i.vertical&&(P=Qd(r,i.vertical,k,f.get("icon-text-fit-padding"),A,y)),m&&(r=Qd(r,m,k,f.get("icon-text-fit-padding"),A,y)));const L=(s,a,p)=>{if(a.x<0||a.x>=aa||a.y<0||a.y>=aa)return;let f=null;if(g){const{x:t,y:e,z:i}=d.projectTilePoint(a.x,a.y,p);f={anchor:new Vd(t,e,i,0,void 0),up:d.upVector(p,a.x,a.y)}}!function(t,e,i,r,n,o,s,a,l,c,u,h,d,p,f,A,m,g,_,y,v,x,b,w,T){const B=t.addToLineVertexArray(e,r);let E,C,S,I,M,k,P,L=0,z=0,F=0,D=0,R=-1,U=-1;const O={};let N=ks("");const Q=i?i.anchor:e;let V=0,j=0;if(void 0===l._unevaluatedLayout.getValue("text-radial-offset")?[V,j]=l.layout.get("text-offset").evaluate(v,{},T).map((t=>t*Uh)):(V=l.layout.get("text-radial-offset").evaluate(v,{},T)*Uh,j=mp),t.allowVerticalPlacement&&n.vertical){const t=n.vertical;if(f)k=Cp(t),a&&(P=Cp(a));else{const i=l.layout.get("text-rotate").evaluate(v,{},T)+90;S=Ep(c,Q,e,u,h,d,t,p,i,A),a&&(I=Ep(c,Q,e,u,h,d,a,g,i))}}if(o){const r=l.layout.get("icon-rotate").evaluate(v,{},T),n="none"!==l.layout.get("icon-text-fit"),s=np(o,r,b,n),p=a?np(a,r,b,n):void 0;C=Ep(c,Q,e,u,h,d,o,g,r),L=4*s.length;const f=t.iconSizeData;let A=null;"source"===f.kind?(A=[Oh*l.layout.get("icon-size").evaluate(v,{},T)],A[0]>wp&&H(`${t.layerIds[0]}: Value for "icon-size" is >= ${bp}. Reduce your "icon-size".`)):"composite"===f.kind&&(A=[Oh*x.compositeIconSizes[0].evaluate(v,{},T),Oh*x.compositeIconSizes[1].evaluate(v,{},T)],(A[0]>wp||A[1]>wp)&&H(`${t.layerIds[0]}: Value for "icon-size" is >= ${bp}. Reduce your "icon-size".`)),t.addSymbols(t.icon,s,A,y,_,v,!1,i,e,B.lineStartIndex,B.lineLength,-1,w,T),R=t.icon.placedSymbolArray.length-1,p&&(z=4*p.length,t.addSymbols(t.icon,p,A,y,_,v,Ed.vertical,i,e,B.lineStartIndex,B.lineLength,-1,w,T),U=t.icon.placedSymbolArray.length-1)}for(const r in n.horizontal){const o=n.horizontal[r];E||(N=ks(o.text),f?M=Cp(o):E=Ep(c,Q,e,u,h,d,o,p,l.layout.get("text-rotate").evaluate(v,{},T),A));const a=1===o.positionedLines.length;if(F+=Tp(t,i,e,o,s,l,f,v,A,B,n.vertical?Ed.horizontal:Ed.horizontalOnly,a?Object.keys(n.horizontal):[r],O,R,x,w,T),a)break}n.vertical&&(D+=Tp(t,i,e,n.vertical,s,l,f,v,A,B,Ed.vertical,["vertical"],O,U,x,w,T));let G=-1;const $=(t,e)=>t?Math.max(t,e):e;G=$(M,G),G=$(k,G),G=$(P,G);const Z=G>-1?1:0;t.glyphOffsetArray.length>=af.MAX_GLYPHS&&H("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==v.sortKey&&t.addToSortKeyRanges(t.symbolInstances.length,v.sortKey),t.symbolInstances.emplaceBack(Q.x,Q.y,Q.z,e.x,e.y,O.right>=0?O.right:-1,O.center>=0?O.center:-1,O.left>=0?O.left:-1,O.vertical>=0?O.vertical:-1,R,U,N,void 0!==E?E:t.collisionBoxArray.length,void 0!==E?E+1:t.collisionBoxArray.length,void 0!==S?S:t.collisionBoxArray.length,void 0!==S?S+1:t.collisionBoxArray.length,void 0!==C?C:t.collisionBoxArray.length,void 0!==C?C+1:t.collisionBoxArray.length,I||t.collisionBoxArray.length,I?I+1:t.collisionBoxArray.length,u,F,D,L,z,Z,0,V,j,G)}(t,a,f,s,i,r,n,P,t.layers[0],t.collisionBoxArray,e.index,e.sourceLayerIndex,t.index,w,E,l,0,T,C,A,e,o,c,u,h)};if("line"===S)for(const n of Wd(e.geometry,0,0,aa,aa)){const e=qd(n,b,B,i.vertical||m,r,_,v,t.overscaling,aa);for(const i of e)m&&Sp(t,m.text,I,i)||L(n,i,h)}else if("line-center"===S){for(const t of e.geometry)if(t.length>1){const e=Zd(t,B,i.vertical||m,r,_,v);e&&L(t,e,h)}}else if("Polygon"===e.type)for(const t of wu(e.geometry,0)){const e=dp(t,16);L(t[0],new Vd(e.x,e.y,0,0,void 0),h)}else if("LineString"===e.type)for(const t of e.geometry)L(t,new Vd(t[0].x,t[0].y,0,0,void 0),h);else if("Point"===e.type)for(const t of e.geometry)for(const e of t)L([e],new Vd(e.x,e.y,0,0,void 0),h)}const bp=255,wp=bp*Oh;function Tp(t,e,i,r,n,o,s,a,l,c,u,h,d,p,f,A,m){const g=function(t,e,i,r,n,o,s,a){const l=[];if(0===e.positionedLines.length)return l;const c=r.layout.get("text-rotate").evaluate(o,{})*Math.PI/180,u=function(t){const e=t[0],i=t[1],r=e*i;return r>0?[e,-i]:r<0?[-e,i]:0===e?[i,e]:[i,-e]}(i);let h=Math.abs(e.top-e.bottom);for(const t of e.positionedLines)h-=t.lineOffset;const d=e.positionedLines.length,p=h/d;let f=e.top-i[1];for(let t=0;t<d;++t){const r=e.positionedLines[t];f=cp(e,p,f,t);for(const t of r.positionedGlyphs){if(!t.rect)continue;const r=t.rect||{};let o=xd+1,h=!0,d=1,p=0;if(t.imageName){const e=s[t.imageName];if(!e)continue;if(e.sdf){H("SDF images are not supported in formatted text and will be ignored.");continue}h=!1,d=e.pixelRatio,o=wd/d}const A=(n||a)&&t.vertical,m=t.metrics.advance*t.scale/2,g=t.metrics,y=t.rect;if(null===y)continue;a&&e.verticalizable&&(p=t.imageName?m-t.metrics.width*t.scale/2:0);const v=n?[t.x+m,t.y]:[0,0];let x=[0,0],b=[0,0],w=!1;n||(A?(b=[t.x+m+u[0],t.y+u[1]-p],w=!0):x=[t.x+m+i[0],t.y+i[1]-p]);const T=y.w*t.scale/(d*(t.localGlyph?tp:1)),B=y.h*t.scale/(d*(t.localGlyph?tp:1));let E,C,S,I;if(A){const e=t.y-f,i=new _(-m,m-e),r=-Math.PI/2,n=new _(...b);E=new _(-m+x[0],x[1]),E._rotateAround(r,i)._add(n),E.x+=-e+m,E.y-=(g.left-o)*t.scale;const s=t.imageName?g.advance*t.scale:Uh*t.scale,a=String.fromCharCode(t.glyph);$h(a)?E.x+=(1-o)*t.scale:Zh(a)?E.x+=s-g.height*t.scale+(-o-1)*t.scale:E.x+=t.imageName||g.width+2*o===y.w&&g.height+2*o===y.h?(s-B)/2:(s-(g.height+2*o)*t.scale)/2,C=new _(E.x,E.y-T),S=new _(E.x+B,E.y),I=new _(E.x+B,E.y-T)}else{const e=(g.left-o)*t.scale-m+x[0],i=(-g.top-o)*t.scale+x[1],r=e+T,n=i+B;E=new _(e,i),C=new _(r,i),S=new _(e,n),I=new _(r,n)}if(c){let t;t=n?new _(0,0):w?new _(u[0],u[1]):new _(i[0],i[1]),E._rotateAround(c,t),C._rotateAround(c,t),S._rotateAround(c,t),I._rotateAround(c,t)}const M=new _(0,0),k=new _(0,0);l.push({tl:E,tr:C,bl:S,br:I,tex:r,writingMode:e.writingMode,glyphOffset:v,sectionIndex:t.sectionIndex,isSDF:h,pixelOffsetTL:M,pixelOffsetBR:k,minFontScaleX:0,minFontScaleY:0})}}return l}(0,r,l,o,s,a,n,t.allowVerticalPlacement),y=t.textSizeData;let v=null;"source"===y.kind?(v=[Oh*o.layout.get("text-size").evaluate(a,{},m)],v[0]>wp&&H(`${t.layerIds[0]}: Value for "text-size" is >= ${bp}. Reduce your "text-size".`)):"composite"===y.kind&&(v=[Oh*f.compositeTextSizes[0].evaluate(a,{},m),Oh*f.compositeTextSizes[1].evaluate(a,{},m)],(v[0]>wp||v[1]>wp)&&H(`${t.layerIds[0]}: Value for "text-size" is >= ${bp}. Reduce your "text-size".`)),t.addSymbols(t.text,g,v,l,s,a,u,e,i,c.lineStartIndex,c.lineLength,p,A,m);for(const e of h)d[e]=t.text.placedSymbolArray.length-1;return 4*g.length}function Bp(t){for(const e in t)return t[e];return null}function Ep(t,e,i,r,n,o,s,a,l,c){let u=s.top,h=s.bottom,d=s.left,p=s.right;const f=s.collisionPadding;if(f&&(d-=f[0],u-=f[1],p+=f[2],h+=f[3]),l){const t=new _(d,u),e=new _(p,u),i=new _(d,h),r=new _(p,h),n=x(l);let o=new _(0,0);c&&(o=new _(c[0],c[1])),t._rotateAround(n,o),e._rotateAround(n,o),i._rotateAround(n,o),r._rotateAround(n,o),d=Math.min(t.x,e.x,i.x,r.x),p=Math.max(t.x,e.x,i.x,r.x),u=Math.min(t.y,e.y,i.y,r.y),h=Math.max(t.y,e.y,i.y,r.y)}return t.emplaceBack(e.x,e.y,e.z,i.x,i.y,d,u,p,h,a,r,n,o),t.length-1}function Cp(t){t.collisionPadding&&(t.top-=t.collisionPadding[1],t.bottom+=t.collisionPadding[3]);const e=t.bottom-t.top;return e>0?Math.max(10,e):null}function Sp(t,e,i,r){const n=t.compareText;if(e in n){const t=n[e];for(let e=t.length-1;e>=0;e--)if(r.dist(t[e])<i)return!0}else n[e]=[];return n[e].push(r),!1}function Ip(t,e){const i=t.fovAboveCenter,r=t.elevation?t.elevation.getMinElevationBelowMSL()*e:0,n=(t._camera.position[2]*t.worldSize-r)/Math.cos(t._pitch),o=Math.sin(i)*n/Math.sin(Math.max(Math.PI/2-t._pitch-i,.01)),s=Math.sin(t._pitch)*o+n;return Math.min(1.01*s,n*(1/t._horizonShift))}function Mp(t,e){if(!e.isReprojectedInTileSpace)return{scale:1<<t.z,x:t.x,y:t.y,x2:t.x+1,y2:t.y+1,projection:e};const i=Math.pow(2,-t.z),r=t.x*i,n=(t.x+1)*i,o=t.y*i,s=(t.y+1)*i,a=Zl(r),l=Zl(n),c=ql(o),u=ql(s),h=e.project(a,c),d=e.project(l,c),p=e.project(l,u),f=e.project(a,u);let A=Math.min(h.x,d.x,p.x,f.x),m=Math.min(h.y,d.y,p.y,f.y),g=Math.max(h.x,d.x,p.x,f.x),_=Math.max(h.y,d.y,p.y,f.y);const y=i/16;function v(t,i,r,n,o,s){const a=(r+o)/2,l=(n+s)/2,c=e.project(Zl(a),ql(l)),u=Math.max(0,A-c.x,m-c.y,c.x-g,c.y-_);A=Math.min(A,c.x),g=Math.max(g,c.x),m=Math.min(m,c.y),_=Math.max(_,c.y),u>y&&(v(t,c,r,n,a,l),v(c,i,a,l,o,s))}v(h,d,r,o,n,o),v(d,p,n,o,n,s),v(p,f,n,s,r,s),v(f,h,r,s,r,o),A-=y,m-=y,g+=y,_+=y;const x=1/Math.max(g-A,_-m);return{scale:x,x:A*x,y:m*x,x2:g*x,y2:_*x,projection:e}}const kp=pa(new Float32Array(16));class Pp{constructor(t){this.spec=t,this.name=t.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(t,e){return{x:0,y:0,z:0}}unproject(t,e){return new Vl(0,0)}projectTilePoint(t,e,i){return{x:t,y:e,z:0}}locationPoint(t,e,i=!0){return t._coordinatePoint(t.locationCoordinate(e),i)}pixelsPerMeter(t,e){return $l(1,t)*e}pixelSpaceConversion(t,e,i){return 1}farthestPixelDistance(t){return Ip(t,t.pixelsPerMeter)}pointCoordinate(t,e,i,r){const n=t.horizonLineFromTop(!1),o=new _(e,Math.max(n,i));return t.rayIntersectionCoordinate(t.pointRayIntersection(o,r))}pointCoordinate3D(t,e,i){const r=new _(e,i);if(t.elevation)return t.elevation.pointCoordinate(r);{const e=this.pointCoordinate(t,r.x,r.y,0);return[e.x,e.y,e.z]}}isPointAboveHorizon(t,e){if(t.elevation)return!this.pointCoordinate3D(t,e.x,e.y);const i=t.horizonLineFromTop();return e.y<i}createInversionMatrix(t,e){return kp}createTileMatrix(t,e,i){let r,n,o;const s=i.canonical,a=pa(new Float64Array(16));if(this.isReprojectedInTileSpace){const l=Mp(s,this);r=1,n=l.x+i.wrap*l.scale,o=l.y,ga(a,a,[r/l.scale,r/l.scale,t.pixelsPerMeter/e])}else r=e/t.zoomScale(s.z),n=(s.x+Math.pow(2,s.z)*i.wrap)*r,o=s.y*r;return ma(a,a,[n,o,0]),ga(a,a,[r/aa,r/aa,1]),a}upVector(t,e,i){return[0,0,1]}upVectorScale(t,e,i){return{metersToTile:1}}}class Lp extends Pp{constructor(t){super(t),this.range=[4,7],this.center=t.center||[-96,37.5];const[e,i]=this.parallels=t.parallels||[29.5,45.5],r=Math.sin(x(e));this.n=(r+Math.sin(x(i)))/2,this.c=1+r*(2*this.n-r),this.r0=Math.sqrt(this.c)/this.n}project(t,e){const{n:i,c:r,r0:n}=this,o=x(t-this.center[0]),s=x(e),a=Math.sqrt(r-2*i*Math.sin(s))/i;return{x:a*Math.sin(o*i),y:a*Math.cos(o*i)-n,z:0}}unproject(t,e){const{n:i,c:r,r0:n}=this,o=n+e;let s=Math.atan2(t,Math.abs(o))*Math.sign(o);o*i<0&&(s-=Math.PI*Math.sign(t)*Math.sign(o));const a=x(this.center[0])*i;s=I(s,-Math.PI-a,Math.PI-a);const l=C(b(s/i)+this.center[0],-180,180),c=Math.asin(C((r-(t*t+o*o)*i*i)/(2*i),-1,1)),u=C(b(c),-Wl,Wl);return new Vl(l,u)}}const zp=1.340264,Fp=-.081106,Dp=893e-6,Rp=.003796,Up=Math.sqrt(3)/2;class Op extends Pp{project(t,e){e=e/180*Math.PI,t=t/180*Math.PI;const i=Math.asin(Up*Math.sin(e)),r=i*i,n=r*r*r;return{x:.5*(t*Math.cos(i)/(Up*(zp+3*Fp*r+n*(7*Dp+9*Rp*r)))/Math.PI+.5),y:1-.5*(i*(zp+Fp*r+n*(Dp+Rp*r))/Math.PI+1),z:0}}unproject(t,e){t=(2*t-.5)*Math.PI;let i=e=(2*(1-e)-1)*Math.PI,r=i*i,n=r*r*r;for(let t,o,s,a=0;a<12&&(o=i*(zp+Fp*r+n*(Dp+Rp*r))-e,s=zp+3*Fp*r+n*(7*Dp+9*Rp*r),t=o/s,i=C(i-t,-Math.PI/3,Math.PI/3),r=i*i,n=r*r*r,!(Math.abs(t)<1e-12));++a);const o=Up*t*(zp+3*Fp*r+n*(7*Dp+9*Rp*r))/Math.cos(i),s=Math.asin(Math.sin(i)/Up),a=C(180*o/Math.PI,-180,180),l=C(180*s/Math.PI,-Wl,Wl);return new Vl(a,l)}}class Np extends Pp{constructor(t){super(t),this.wrap=!0,this.supportsWorldCopies=!0}project(t,e){return{x:.5+t/360,y:.5-e/360,z:0}}unproject(t,e){const i=360*(t-.5),r=C(360*(.5-e),-Wl,Wl);return new Vl(i,r)}}const Qp=Math.PI/2;function Vp(t){return Math.tan((Qp+t)/2)}class jp extends Pp{constructor(t){super(t),this.center=t.center||[0,30];const[e,i]=this.parallels=t.parallels||[30,30];let r=x(e),n=x(i);this.southernCenter=r+n<0,this.southernCenter&&(r=-r,n=-n);const o=Math.cos(r),s=Vp(r);this.n=r===n?Math.sin(r):Math.log(o/Math.cos(n))/Math.log(Vp(n)/s),this.f=o*Math.pow(Vp(r),this.n)/this.n}project(t,e){e=x(e),this.southernCenter&&(e=-e),t=x(t-this.center[0]);const i=1e-6,{n:r,f:n}=this;n>0?e<-Qp+i&&(e=-Qp+i):e>Qp-i&&(e=Qp-i);const o=n/Math.pow(Vp(e),r);let s=o*Math.sin(r*t),a=n-o*Math.cos(r*t);return s=.5*(s/Math.PI+.5),a=.5*(a/Math.PI+.5),{x:s,y:this.southernCenter?a:1-a,z:0}}unproject(t,e){t=(2*t-.5)*Math.PI,this.southernCenter&&(e=1-e),e=(2*(1-e)-.5)*Math.PI;const{n:i,f:r}=this,n=r-e,o=Math.sign(n),s=Math.sign(i)*Math.sqrt(t*t+n*n);let a=Math.atan2(t,Math.abs(n))*o;n*i<0&&(a-=Math.PI*Math.sign(t)*o);const l=C(b(a/i)+this.center[0],-180,180),c=C(b(2*Math.atan(Math.pow(r/s,1/i))-Qp),-Wl,Wl);return new Vl(l,this.southernCenter?-c:c)}}class Hp extends Pp{constructor(t){super(t),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(t,e){return{x:Hl(t),y:Gl(e),z:0}}unproject(t,e){const i=Zl(t),r=ql(e);return new Vl(i,r)}}const Gp=x(Wl);class $p extends Pp{project(t,e){const i=(e=x(e))*e,r=i*i;return{x:.5*((t=x(t))*(.8707-.131979*i+r*(r*(.003971*i-.001529*r)-.013791))/Math.PI+.5),y:1-.5*(e*(1.007226+i*(.015085+r*(.028874*i-.044475-.005916*r)))/Math.PI+1),z:0}}unproject(t,e){t=(2*t-.5)*Math.PI;let i=e=(2*(1-e)-1)*Math.PI,r=25,n=0,o=i*i;do{o=i*i;const t=o*o;n=(i*(1.007226+o*(.015085+t*(.028874*o-.044475-.005916*t)))-e)/(1.007226+o*(.045255+t*(.259866*o-.311325-.005916*11*t))),i=C(i-n,-Gp,Gp)}while(Math.abs(n)>1e-6&&--r>0);o=i*i;const s=C(b(t/(.8707+o*(o*(o*o*o*(.003971-.001529*o)-.013791)-.131979))),-180,180),a=b(i);return new Vl(s,a)}}const Zp=x(Wl);class qp extends Pp{project(t,e){e=x(e),t=x(t);const i=Math.cos(e),r=2/Math.PI,n=Math.acos(i*Math.cos(t/2)),o=Math.sin(n)/n,s=.5*(t*r+2*i*Math.sin(t/2)/o)||0,a=.5*(e+Math.sin(e)/o)||0;return{x:.5*(s/Math.PI+.5),y:1-.5*(a/Math.PI+1),z:0}}unproject(t,e){let i=t=(2*t-.5)*Math.PI,r=e=(2*(1-e)-1)*Math.PI,n=25;const o=1e-6;let s=0,a=0;do{const n=Math.cos(r),o=Math.sin(r),l=2*o*n,c=o*o,u=n*n,h=Math.cos(i/2),d=Math.sin(i/2),p=2*h*d,f=d*d,A=1-u*h*h,m=A?1/A:0,g=A?Math.acos(n*h)*Math.sqrt(1/A):0,_=.5*(2*g*n*d+2*i/Math.PI)-t,y=.5*(g*o+r)-e,v=.5*m*(u*f+g*n*h*c)+1/Math.PI,x=m*(p*l/4-g*o*d),b=.125*m*(l*d-g*o*u*p),w=.5*m*(c*h+g*f*n)+.5,T=x*b-w*v;s=(y*x-_*w)/T,a=(_*b-y*v)/T,i=C(i-s,-Math.PI,Math.PI),r=C(r-a,-Zp,Zp)}while((Math.abs(s)>o||Math.abs(a)>o)&&--n>0);return new Vl(b(i),b(r))}}class Kp extends Pp{constructor(t){super(t),this.center=t.center||[0,0],this.parallels=t.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(x(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(t,e){const{scale:i,cosPhi:r}=this;return{x:x(t)*r*i+.5,y:-Math.sin(x(e))/r*i+.5,z:0}}unproject(t,e){const{scale:i,cosPhi:r}=this,n=-(e-.5)/i,o=C(b((t-.5)/i)/r,-180,180),s=Math.asin(C(n*r,-1,1)),a=C(b(s),-Wl,Wl);return new Vl(o,a)}}class Wp extends Hp{constructor(t){super(t),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(t,e,i){const r=Cl(t,e,i);return Ra(r,r,Ml(_l(i))),{x:r[0],y:r[1],z:r[2]}}locationPoint(t,e){const i=El(e.lat,e.lng),r=za([],i),n=t.elevation?t.elevation.getAtPointOrZero(t.locationCoordinate(e),t._centerAltitude):t._centerAltitude;La(i,i,r,$l(1,0)*aa*n);const o=pa(new Float64Array(16));return Aa(o,t.pixelMatrix,t.globeMatrix),Ra(i,i,o),new _(i[0],i[1])}pixelsPerMeter(t,e){return $l(1,0)*e}pixelSpaceConversion(t,e,i){const r=$l(1,t)*e,n=ki($l(1,45)*e,r,i);return this.pixelsPerMeter(t,e)/n}createTileMatrix(t,e,i){const r=kl(_l(i.canonical));return Aa(new Float64Array(16),t.globeMatrix,r)}createInversionMatrix(t,e){const{center:i}=t,r=Ml(_l(e));return ya(r,r,x(i.lng)),_a(r,r,x(i.lat)),ga(r,r,[t._pixelsPerMercatorPixel,t._pixelsPerMercatorPixel,1]),Float32Array.from(r)}pointCoordinate(t,e,i,r){return Al(t,e,i,!0)||new Jl(0,0)}pointCoordinate3D(t,e,i){const r=this.pointCoordinate(t,e,i,0);return[r.x,r.y,r.z]}isPointAboveHorizon(t,e){return!Al(t,e.x,e.y,!1)}farthestPixelDistance(t){const e=function(t,e){const i=t.cameraToCenterDistance,r=t._centerAltitude*e,n=t._camera,o=t._camera.forward(),s=Ca([],Pa([],o,-i),[0,0,r]),a=t.worldSize/(2*Math.PI),l=[0,0,-a],c=t.width/t.height,u=Math.tan(t.fovAboveCenter),h=Pa([],n.up(),u),d=Pa([],n.right(),u*c),p=za([],Ca([],Ca([],o,h),d)),f=[];let A;if(new el(s,p).closestPointOnSphere(l,a,f)){const e=Ca([],f,l),i=Na([],e,s);A=Math.cos(t.fovAboveCenter)*Ba(i)}else{const t=Na([],s,l),e=Na([],l,s);za(e,e);const i=Ba(t)-a;A=Math.sqrt(i*(i+2*a));const r=Math.acos(A/(a+i))-Math.acos(Fa(o,e));A*=Math.cos(r)}return 1.01*A}(t,this.pixelsPerMeter(t.center.lat,t.worldSize)),i=Ll(t.zoom);if(i>0){const r=Ip(t,$l(1,t.center.lat)*t.worldSize),n=t.worldSize/(2*Math.PI),o=Math.max(t.width,t.height)/t.worldSize*Math.PI;return ki(e,r+n*(1-Math.cos(o)),Math.pow(i,10))}return e}upVector(t,e,i){return Cl(e,i,t,1)}upVectorScale(t){return{metersToTile:fl(Sl(_l(t)))}}}function Xp(t){const e=t.parallels,i=!!e&&Math.abs(e[0]+e[1])<.01;switch(t.name){case"mercator":return new Hp(t);case"equirectangular":return new Np(t);case"naturalEarth":return new $p(t);case"equalEarth":return new Op(t);case"winkelTripel":return new qp(t);case"albers":return i?new Kp(t):new Lp(t);case"lambertConformalConic":return i?new Kp(t):new jp(t);case"globe":return new Wp(t)}throw new Error(`Invalid projection name: ${t.name}`)}const Jp=Zu.types,Yp=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function tf(t,e,i,r,n,o,s,a,l,c,u,h,d){const p=a?Math.min(wp,Math.round(a[0])):0,f=a?Math.min(wp,Math.round(a[1])):0;t.emplaceBack(e,i,Math.round(32*r),Math.round(32*n),o,s,(p<<1)+(l?1:0),f,16*c,16*u,256*h,256*d)}function ef(t,e,i,r,n,o,s){t.emplaceBack(e,i,r,n,o,s)}function rf(t,e,i,r,n){t.emplaceBack(e,i,r,n),t.emplaceBack(e,i,r,n),t.emplaceBack(e,i,r,n),t.emplaceBack(e,i,r,n)}function nf(t){for(const e of t.sections)if(lo(e.text))return!0;return!1}class of{constructor(t){this.layoutVertexArray=new Ko,this.indexArray=new rs,this.programConfigurations=t,this.segments=new sa,this.dynamicLayoutVertexArray=new Go,this.opacityVertexArray=new Xo,this.placedSymbolArray=new As,this.globeExtVertexArray=new Wo}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(t,e,i,r){this.isEmpty()||(i&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,kh.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,e),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,Lh.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,Yp,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=t.createVertexBuffer(this.globeExtVertexArray,Ph.members,!0)),this.opacityVertexBuffer.itemSize=1),(i||r)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}Kn(of,"SymbolBuffers");class sf{constructor(t,e,i){this.layoutVertexArray=new t,this.layoutAttributes=e,this.indexArray=new i,this.segments=new sa,this.collisionVertexArray=new es,this.collisionVertexArrayExt=new is}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,zh.members,!0),this.collisionVertexBufferExt=t.createVertexBuffer(this.collisionVertexArrayExt,Fh.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Kn(sf,"CollisionBuffers");class af{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((t=>t.id)),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=pa([]),this.placementViewportMatrix=pa([]);const e=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Nh(this.zoom,e["text-size"]),this.iconSizeData=Nh(this.zoom,e["icon-size"]);const i=this.layers[0].layout,r=i.get("symbol-sort-key"),n=i.get("symbol-z-order");this.canOverlap=i.get("text-allow-overlap")||i.get("icon-allow-overlap")||i.get("text-ignore-placement")||i.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==n&&void 0!==r.constantOr(1),this.sortFeaturesByY=("viewport-y"===n||"auto"===n&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=i.get("text-writing-mode").map((t=>Ed[t])),this.stateDependentLayerIds=this.layers.filter((t=>t.isStateDependent())).map((t=>t.id)),this.sourceID=t.sourceID,this.projection=t.projection}createArrays(){this.text=new of(new Ws(this.layers,this.zoom,(t=>/^text/.test(t)))),this.icon=new of(new Ws(this.layers,this.zoom,(t=>/^icon/.test(t)))),this.glyphOffsetArray=new _s,this.lineVertexArray=new ys,this.symbolInstances=new gs}calculateGlyphDependencies(t,e,i,r,n){for(let i=0;i<t.length;i++)if(e[t.charCodeAt(i)]=!0,r&&n){const r=Gh[t.charAt(i)];r&&(e[r.charCodeAt(0)]=!0)}}populate(t,e,i,r){const n=this.layers[0],o=n.layout,s="globe"===this.projection.name,a=o.get("text-font"),l=o.get("text-field"),c=o.get("icon-image"),u=("constant"!==l.value.kind||l.value.value instanceof ze&&!l.value.value.isEmpty()||l.value.value.toString().length>0)&&("constant"!==a.value.kind||a.value.value.length>0),h="constant"!==c.value.kind||!!c.value.value||Object.keys(c.parameters).length>0,d=o.get("symbol-sort-key");if(this.features=[],!u&&!h)return;const p=e.iconDependencies,f=e.glyphDependencies,A=e.availableImages,m=new bo(this.zoom);for(const{feature:e,id:l,index:c,sourceLayerIndex:g}of t){const t=n._featureFilter.needGeometry,_=ac(e,t);if(!n._featureFilter.filter(m,_,i))continue;if(t||(_.geometry=sc(e,i,r)),s&&1!==e.type&&i.z<=5){const t=_.geometry,e=.98078528056,r=(t,r)=>Fa(Cl(t.x,t.y,i,1),Cl(r.x,r.y,i,1))<e;for(let e=0;e<t.length;e++)t[e]=ic(t[e],r)}let y,v;if(u){const t=n.getValueAndResolveTokens("text-field",_,i,A),e=ze.factory(t);nf(e)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===yo()||this.hasRTLText&&xo.isParsed())&&(y=Hh(e,n,_))}if(h){const t=n.getValueAndResolveTokens("icon-image",_,i,A);v=t instanceof Fe?t:Fe.fromString(t)}if(!y&&!v)continue;const x=this.sortFeaturesByKey?d.evaluate(_,{},i):void 0;if(this.features.push({id:l,text:y,icon:v,index:c,sourceLayerIndex:g,geometry:_.geometry,properties:e.properties,type:Jp[e.type],sortKey:x}),v&&(p[v.name]=!0),y){const t=a.evaluate(_,{},i).join(","),e="map"===o.get("text-rotation-alignment")&&"point"!==o.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Ed.vertical)>=0;for(const i of y.sections)if(i.image)p[i.image.name]=!0;else{const r=eo(y.toString()),n=i.fontStack||t,o=f[n]=f[n]||{};this.calculateGlyphDependencies(i.text,o,e,this.allowVerticalPlacement,r)}}}"line"===o.get("symbol-placement")&&(this.features=function(t){const e={},i={},r=[];let n=0;function o(e){r.push(t[e]),n++}function s(t,e,n){const o=i[t];return delete i[t],i[e]=o,r[o].geometry[0].pop(),r[o].geometry[0]=r[o].geometry[0].concat(n[0]),o}function a(t,i,n){const o=e[i];return delete e[i],e[t]=o,r[o].geometry[0].shift(),r[o].geometry[0]=n[0].concat(r[o].geometry[0]),o}function l(t,e,i){const r=i?e[0][e[0].length-1]:e[0][0];return`${t}:${r.x}:${r.y}`}for(let c=0;c<t.length;c++){const u=t[c],h=u.geometry,d=u.text?u.text.toString():null;if(!d){o(c);continue}const p=l(d,h),f=l(d,h,!0);if(p in i&&f in e&&i[p]!==e[f]){const t=a(p,f,h),n=s(p,f,r[t].geometry);delete e[p],delete i[f],i[l(d,r[n].geometry,!0)]=n,r[t].geometry=null}else p in i?s(p,f,h):f in e?a(p,f,h):(o(c),e[p]=n-1,i[f]=n-1)}return r.filter((t=>t.geometry))}(this.features)),this.sortFeaturesByKey&&this.features.sort(((t,e)=>t.sortKey-e.sortKey))}update(t,e,i,r){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,e,this.layers,i,r),this.icon.programConfigurations.updatePaintArrays(t,e,this.layers,i,r))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=Xp(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,e){const i=this.lineVertexArray.length;if(void 0!==t.segment)for(const{x:t,y:i}of e)this.lineVertexArray.emplaceBack(t,i);return{lineStartIndex:i,lineLength:this.lineVertexArray.length-i}}addSymbols(t,e,i,r,n,o,s,a,l,c,u,h,d,p){const f=t.indexArray,A=t.layoutVertexArray,m=t.globeExtVertexArray,g=t.segments.prepareSegment(4*e.length,A,f,this.canOverlap?o.sortKey:void 0),_=this.glyphOffsetArray.length,y=g.vertexLength,v=this.allowVerticalPlacement&&s===Ed.vertical?Math.PI/2:0,x=o.text&&o.text.sections;for(let r=0;r<e.length;r++){const{tl:n,tr:s,bl:c,br:u,tex:h,pixelOffsetTL:_,pixelOffsetBR:y,minFontScaleX:b,minFontScaleY:w,glyphOffset:T,isSDF:B,sectionIndex:E}=e[r],C=g.vertexLength,S=T[1];if(tf(A,l.x,l.y,n.x,S+n.y,h.x,h.y,i,B,_.x,_.y,b,w),tf(A,l.x,l.y,s.x,S+s.y,h.x+h.w,h.y,i,B,y.x,_.y,b,w),tf(A,l.x,l.y,c.x,S+c.y,h.x,h.y+h.h,i,B,_.x,y.y,b,w),tf(A,l.x,l.y,u.x,S+u.y,h.x+h.w,h.y+h.h,i,B,y.x,y.y,b,w),a){const{x:e,y:i,z:r}=a.anchor,[n,o,s]=a.up;ef(m,e,i,r,n,o,s),ef(m,e,i,r,n,o,s),ef(m,e,i,r,n,o,s),ef(m,e,i,r,n,o,s),rf(t.dynamicLayoutVertexArray,e,i,r,v)}else rf(t.dynamicLayoutVertexArray,l.x,l.y,l.z,v);f.emplaceBack(C,C+1,C+2),f.emplaceBack(C+1,C+2,C+3),g.vertexLength+=4,g.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(T[0]),r!==e.length-1&&E===e[r+1].sectionIndex||t.programConfigurations.populatePaintArrays(A.length,o,o.index,{},d,p,x&&x[E])}const b=a?a.anchor:l;t.placedSymbolArray.emplaceBack(b.x,b.y,b.z,l.x,l.y,_,this.glyphOffsetArray.length-_,y,c,u,l.segment,i?i[0]:0,i?i[1]:0,r[0],r[1],s,0,!1,0,h,0)}_commitLayoutVertex(t,e,i,r,n,o,s){t.emplaceBack(e,i,r,n,o,Math.round(s.x),Math.round(s.y))}_addCollisionDebugVertices(t,e,i,r,n,o,s){const a=i.segments.prepareSegment(4,i.layoutVertexArray,i.indexArray),l=a.vertexLength,c=s.tileAnchorX,u=s.tileAnchorY;for(let t=0;t<4;t++)i.collisionVertexArray.emplaceBack(0,0,0,0);i.collisionVertexArrayExt.emplaceBack(e,-t.padding,-t.padding),i.collisionVertexArrayExt.emplaceBack(e,t.padding,-t.padding),i.collisionVertexArrayExt.emplaceBack(e,t.padding,t.padding),i.collisionVertexArrayExt.emplaceBack(e,-t.padding,t.padding),this._commitLayoutVertex(i.layoutVertexArray,r,n,o,c,u,new _(t.x1,t.y1)),this._commitLayoutVertex(i.layoutVertexArray,r,n,o,c,u,new _(t.x2,t.y1)),this._commitLayoutVertex(i.layoutVertexArray,r,n,o,c,u,new _(t.x2,t.y2)),this._commitLayoutVertex(i.layoutVertexArray,r,n,o,c,u,new _(t.x1,t.y2)),a.vertexLength+=4;const h=i.indexArray;h.emplaceBack(l,l+1),h.emplaceBack(l+1,l+2),h.emplaceBack(l+2,l+3),h.emplaceBack(l+3,l),a.primitiveLength+=4}_addTextDebugCollisionBoxes(t,e,i,r,n,o){for(let s=r;s<n;s++){const r=i.get(s),n=this.getSymbolInstanceTextSize(t,o,e,s);this._addCollisionDebugVertices(r,n,this.textCollisionBox,r.projectedAnchorX,r.projectedAnchorY,r.projectedAnchorZ,o)}}_addIconDebugCollisionBoxes(t,e,i,r,n,o){for(let s=r;s<n;s++){const r=i.get(s),n=this.getSymbolInstanceIconSize(t,e,o.placedIconSymbolIndex);this._addCollisionDebugVertices(r,n,this.iconCollisionBox,r.projectedAnchorX,r.projectedAnchorY,r.projectedAnchorZ,o)}}generateCollisionDebugBuffers(t,e){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new sf(Yo,Dh.members,cs),this.iconCollisionBox=new sf(Yo,Dh.members,cs);const i=Vh(this.iconSizeData,t),r=Vh(this.textSizeData,t);for(let n=0;n<this.symbolInstances.length;n++){const o=this.symbolInstances.get(n);this._addTextDebugCollisionBoxes(r,t,e,o.textBoxStartIndex,o.textBoxEndIndex,o),this._addTextDebugCollisionBoxes(r,t,e,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o),this._addIconDebugCollisionBoxes(i,t,e,o.iconBoxStartIndex,o.iconBoxEndIndex,o),this._addIconDebugCollisionBoxes(i,t,e,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex,o)}}getSymbolInstanceTextSize(t,e,i,r){const n=this.text.placedSymbolArray.get(e.rightJustifiedTextSymbolIndex>=0?e.rightJustifiedTextSymbolIndex:e.centerJustifiedTextSymbolIndex>=0?e.centerJustifiedTextSymbolIndex:e.leftJustifiedTextSymbolIndex>=0?e.leftJustifiedTextSymbolIndex:e.verticalPlacedTextSymbolIndex>=0?e.verticalPlacedTextSymbolIndex:r),o=Qh(this.textSizeData,t,n)/Uh;return this.tilePixelRatio*o}getSymbolInstanceIconSize(t,e,i){const r=this.icon.placedSymbolArray.get(i),n=Qh(this.iconSizeData,t,r);return this.tilePixelRatio*n}_commitDebugCollisionVertexUpdate(t,e,i){t.emplaceBack(e,-i,-i),t.emplaceBack(e,i,-i),t.emplaceBack(e,i,i),t.emplaceBack(e,-i,i)}_updateTextDebugCollisionBoxes(t,e,i,r,n,o){for(let s=r;s<n;s++){const r=i.get(s),n=this.getSymbolInstanceTextSize(t,o,e,s);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,n,r.padding)}}_updateIconDebugCollisionBoxes(t,e,i,r,n,o){for(let s=r;s<n;s++){const r=i.get(s),n=this.getSymbolInstanceIconSize(t,e,o);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,n,r.padding)}}updateCollisionDebugBuffers(t,e){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const i=Vh(this.iconSizeData,t),r=Vh(this.textSizeData,t);for(let n=0;n<this.symbolInstances.length;n++){const o=this.symbolInstances.get(n);this._updateTextDebugCollisionBoxes(r,t,e,o.textBoxStartIndex,o.textBoxEndIndex,o),this._updateTextDebugCollisionBoxes(r,t,e,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o),this._updateIconDebugCollisionBoxes(i,t,e,o.iconBoxStartIndex,o.iconBoxEndIndex,o.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(i,t,e,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex,o.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(t,e,i,r,n,o,s,a,l){const c={};if(e<i){const{x1:i,y1:r,x2:n,y2:o,padding:s,projectedAnchorX:a,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:d,featureIndex:p}=t.get(e);c.textBox={x1:i,y1:r,x2:n,y2:o,padding:s,projectedAnchorX:a,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:d},c.textFeatureIndex=p}if(r<n){const{x1:e,y1:i,x2:n,y2:o,padding:s,projectedAnchorX:a,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:d,featureIndex:p}=t.get(r);c.verticalTextBox={x1:e,y1:i,x2:n,y2:o,padding:s,projectedAnchorX:a,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:d},c.verticalTextFeatureIndex=p}if(o<s){const{x1:e,y1:i,x2:r,y2:n,padding:s,projectedAnchorX:a,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:d,featureIndex:p}=t.get(o);c.iconBox={x1:e,y1:i,x2:r,y2:n,padding:s,projectedAnchorX:a,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:d},c.iconFeatureIndex=p}if(a<l){const{x1:e,y1:i,x2:r,y2:n,padding:o,projectedAnchorX:s,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:d,featureIndex:p}=t.get(a);c.verticalIconBox={x1:e,y1:i,x2:r,y2:n,padding:o,projectedAnchorX:s,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:d},c.verticalIconFeatureIndex=p}return c}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let e=0;e<this.symbolInstances.length;e++){const i=this.symbolInstances.get(e);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,i.textBoxStartIndex,i.textBoxEndIndex,i.verticalTextBoxStartIndex,i.verticalTextBoxEndIndex,i.iconBoxStartIndex,i.iconBoxEndIndex,i.verticalIconBoxStartIndex,i.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,e){const i=t.placedSymbolArray.get(e),r=i.vertexStartIndex+4*i.numGlyphs;for(let e=i.vertexStartIndex;e<r;e+=4)t.indexArray.emplaceBack(e,e+1,e+2),t.indexArray.emplaceBack(e+1,e+2,e+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const e=Math.sin(t),i=Math.cos(t),r=[],n=[],o=[];for(let t=0;t<this.symbolInstances.length;++t){o.push(t);const s=this.symbolInstances.get(t);r.push(0|Math.round(e*s.tileAnchorX+i*s.tileAnchorY)),n.push(s.featureIndex)}return o.sort(((t,e)=>r[t]-r[e]||n[e]-n[t])),o}addToSortKeyRanges(t,e){const i=this.sortKeyRanges[this.sortKeyRanges.length-1];i&&i.sortKey===e?i.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:e,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const t of this.symbolInstanceIndexes){const e=this.symbolInstances.get(t);this.featureSortOrder.push(e.featureIndex);const{rightJustifiedTextSymbolIndex:i,centerJustifiedTextSymbolIndex:r,leftJustifiedTextSymbolIndex:n,verticalPlacedTextSymbolIndex:o,placedIconSymbolIndex:s,verticalPlacedIconSymbolIndex:a}=e;i>=0&&this.addIndicesForPlacedSymbol(this.text,i),r>=0&&r!==i&&this.addIndicesForPlacedSymbol(this.text,r),n>=0&&n!==r&&n!==i&&this.addIndicesForPlacedSymbol(this.text,n),o>=0&&this.addIndicesForPlacedSymbol(this.text,o),s>=0&&this.addIndicesForPlacedSymbol(this.icon,s),a>=0&&this.addIndicesForPlacedSymbol(this.icon,a)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Kn(af,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),af.MAX_GLYPHS=65535,af.addDynamicAttributes=rf;const lf=new zo({"symbol-placement":new ko(te.layout_symbol["symbol-placement"]),"symbol-spacing":new ko(te.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new ko(te.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Po(te.layout_symbol["symbol-sort-key"]),"symbol-z-order":new ko(te.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new ko(te.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new ko(te.layout_symbol["icon-ignore-placement"]),"icon-optional":new ko(te.layout_symbol["icon-optional"]),"icon-rotation-alignment":new ko(te.layout_symbol["icon-rotation-alignment"]),"icon-size":new Po(te.layout_symbol["icon-size"]),"icon-text-fit":new ko(te.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new ko(te.layout_symbol["icon-text-fit-padding"]),"icon-image":new Po(te.layout_symbol["icon-image"]),"icon-rotate":new Po(te.layout_symbol["icon-rotate"]),"icon-padding":new ko(te.layout_symbol["icon-padding"]),"icon-keep-upright":new ko(te.layout_symbol["icon-keep-upright"]),"icon-offset":new Po(te.layout_symbol["icon-offset"]),"icon-anchor":new Po(te.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new ko(te.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new ko(te.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new ko(te.layout_symbol["text-rotation-alignment"]),"text-field":new Po(te.layout_symbol["text-field"]),"text-font":new Po(te.layout_symbol["text-font"]),"text-size":new Po(te.layout_symbol["text-size"]),"text-max-width":new Po(te.layout_symbol["text-max-width"]),"text-line-height":new Po(te.layout_symbol["text-line-height"]),"text-letter-spacing":new Po(te.layout_symbol["text-letter-spacing"]),"text-justify":new Po(te.layout_symbol["text-justify"]),"text-radial-offset":new Po(te.layout_symbol["text-radial-offset"]),"text-variable-anchor":new ko(te.layout_symbol["text-variable-anchor"]),"text-anchor":new Po(te.layout_symbol["text-anchor"]),"text-max-angle":new ko(te.layout_symbol["text-max-angle"]),"text-writing-mode":new ko(te.layout_symbol["text-writing-mode"]),"text-rotate":new Po(te.layout_symbol["text-rotate"]),"text-padding":new ko(te.layout_symbol["text-padding"]),"text-keep-upright":new ko(te.layout_symbol["text-keep-upright"]),"text-transform":new Po(te.layout_symbol["text-transform"]),"text-offset":new Po(te.layout_symbol["text-offset"]),"text-allow-overlap":new ko(te.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new ko(te.layout_symbol["text-ignore-placement"]),"text-optional":new ko(te.layout_symbol["text-optional"])});var cf={paint:new zo({"icon-opacity":new Po(te.paint_symbol["icon-opacity"]),"icon-color":new Po(te.paint_symbol["icon-color"]),"icon-halo-color":new Po(te.paint_symbol["icon-halo-color"]),"icon-halo-width":new Po(te.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Po(te.paint_symbol["icon-halo-blur"]),"icon-translate":new ko(te.paint_symbol["icon-translate"]),"icon-translate-anchor":new ko(te.paint_symbol["icon-translate-anchor"]),"text-opacity":new Po(te.paint_symbol["text-opacity"]),"text-color":new Po(te.paint_symbol["text-color"],{runtimeType:de,getOverride:t=>t.textColor,hasOverride:t=>!!t.textColor}),"text-halo-color":new Po(te.paint_symbol["text-halo-color"]),"text-halo-width":new Po(te.paint_symbol["text-halo-width"]),"text-halo-blur":new Po(te.paint_symbol["text-halo-blur"]),"text-translate":new ko(te.paint_symbol["text-translate"]),"text-translate-anchor":new ko(te.paint_symbol["text-translate-anchor"])}),layout:lf};class uf{constructor(t){this.type=t.property.overrides?t.property.overrides.runtimeType:le,this.defaultValue=t}evaluate(t){if(t.formattedSection){const e=this.defaultValue.property.overrides;if(e&&e.hasOverride(t.formattedSection))return e.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Kn(uf,"FormatSectionOverride",{omit:["defaultValue"]});class hf extends ra{constructor(t){super(t,cf)}recalculate(t,e){super.recalculate(t,e),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const i=this.layout.get("text-writing-mode");if(i){const t=[];for(const e of i)t.indexOf(e)<0&&t.push(e);this.layout._values["text-writing-mode"]=t}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(t,e,i,r){const n=this.layout.get(t).evaluate(e,{},i,r),o=this._unevaluatedLayout._values[t];return o.isDataDriven()||qr(o.value)||!n?n:function(t,e){return e.replace(/{([^{}]+)}/g,((e,i)=>i in t?String(t[i]):""))}(e.properties,n)}createBucket(t){return new af(t)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const t of cf.paint.overridableProperties){if(!hf.hasPaintOverride(this.layout,t))continue;const e=this.paint.get(t),i=new uf(e),r=new Zr(i,e.property.specification);let n=null;n="constant"===e.value.kind||"source"===e.value.kind?new Wr("source",r):new Xr("composite",r,e.value.zoomStops,e.value._interpolationType),this.paint._values[t]=new Io(e.property,n,e.parameters)}}_handleOverridablePaintPropertyUpdate(t,e,i){return!(!this.layout||e.isDataDriven()||i.isDataDriven())&&hf.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,e){const i=t.get("text-field"),r=cf.paint.properties[e];let n=!1;const o=t=>{for(const e of t)if(r.overrides&&r.overrides.hasOverride(e))return void(n=!0)};if("constant"===i.value.kind&&i.value.value instanceof ze)o(i.value.value.sections);else if("source"===i.value.kind){const t=e=>{n||(e instanceof Qe&&Ue(e.value)===me?o(e.value.sections):e instanceof $e?o(e.sections):e.eachChild(t))},e=i.value;e._styleExpression&&t(e._styleExpression.expression)}return n}getProgramConfiguration(t){return new Ks(this,t)}}var df={paint:new zo({"background-color":new ko(te.paint_background["background-color"]),"background-pattern":new ko(te.paint_background["background-pattern"]),"background-opacity":new ko(te.paint_background["background-opacity"])})},pf={paint:new zo({"raster-opacity":new ko(te.paint_raster["raster-opacity"]),"raster-hue-rotate":new ko(te.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new ko(te.paint_raster["raster-brightness-min"]),"raster-brightness-max":new ko(te.paint_raster["raster-brightness-max"]),"raster-saturation":new ko(te.paint_raster["raster-saturation"]),"raster-contrast":new ko(te.paint_raster["raster-contrast"]),"raster-resampling":new ko(te.paint_raster["raster-resampling"]),"raster-fade-duration":new ko(te.paint_raster["raster-fade-duration"])})};class ff extends ra{constructor(t){super(t,{}),this.implementation=t}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}isLayerDraped(){return void 0!==this.implementation.renderToTile}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(t){this.implementation.onAdd&&this.implementation.onAdd(t,t.painter.context.gl)}onRemove(t){this.implementation.onRemove&&this.implementation.onRemove(t,t.painter.context.gl)}}var Af={paint:new zo({"sky-type":new ko(te.paint_sky["sky-type"]),"sky-atmosphere-sun":new ko(te.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new ko(te.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new ko(te.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new ko(te.paint_sky["sky-gradient-radius"]),"sky-gradient":new Lo(te.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new ko(te.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new ko(te.paint_sky["sky-atmosphere-color"]),"sky-opacity":new ko(te.paint_sky["sky-opacity"])})};function mf(t,e,i){const r=[0,0,1],n=Za([]);return Ka(n,n,i?-x(t)+Math.PI:x(t)),qa(n,n,-x(e)),Ua(r,r,n),za(r,r)}const gf={circle:class extends ra{constructor(t){super(t,Sc)}createBucket(t){return new uc(t)}queryRadius(t){const e=t;return wc("circle-radius",this,e)+wc("circle-stroke-width",this,e)+Tc(this.paint.get("circle-translate"))}queryIntersectsFeature(t,e,i,r,n,o,s,a){const l=Ec(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),o.angle,t.pixelToTileUnitsFactor),c=this.paint.get("circle-radius").evaluate(e,i)+this.paint.get("circle-stroke-width").evaluate(e,i);return Ic(t,r,o,s,a,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),l,c)}getProgramIds(){return["circle"]}getProgramConfiguration(t){return new Ks(this,t)}},heatmap:class extends ra{createBucket(t){return new zc(t)}constructor(t){super(t,Nc),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){"heatmap-color"===t&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Qc({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(t){return wc("heatmap-radius",this,t)}queryIntersectsFeature(t,e,i,r,n,o,s,a){const l=this.paint.get("heatmap-radius").evaluate(e,i);return Ic(t,r,o,s,a,!0,!0,new _(0,0),l)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(t){return new Ks(this,t)}},hillshade:class extends ra{constructor(t){super(t,Vc)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends ra{constructor(t){super(t,Iu)}getProgramIds(){const t=this.paint.get("fill-pattern"),e=t&&t.constantOr(1),i=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&i.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),i}getProgramConfiguration(t){return new Ks(this,t)}recalculate(t,e){super.recalculate(t,e);const i=this.paint._values["fill-outline-color"];"constant"===i.value.kind&&void 0===i.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new Cu(t)}queryRadius(){return Tc(this.paint.get("fill-translate"))}queryIntersectsFeature(t,e,i,r,n,o){return!t.queryGeometry.isAboveHorizon&&pc(Bc(t.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),o.angle,t.pixelToTileUnitsFactor),r)}isTileClipped(){return!0}},"fill-extrusion":class extends ra{constructor(t){super(t,uh)}createBucket(t){return new th(t)}queryRadius(){return Tc(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(t){return new Ks(this,t)}queryIntersectsFeature(t,e,i,r,n,o,s,a,l){const c=Ec(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),o.angle,t.pixelToTileUnitsFactor),u=this.paint.get("fill-extrusion-height").evaluate(e,i),h=this.paint.get("fill-extrusion-base").evaluate(e,i),d=[0,0],p=a&&o.elevation,f=o.elevation?o.elevation.exaggeration():1,A=t.tile.getBucket(this);if(p&&A instanceof th){const t=A.centroidVertexArray,e=l+1;e<t.length&&(d[0]=t.geta_centroid_pos0(e),d[1]=t.geta_centroid_pos1(e))}if(0===d[0]&&1===d[1])return!1;"globe"===o.projection.name&&(r=lh([r],[new _(0,0),new _(aa,aa)],t.tileID.canonical).map((t=>t.polygon)).flat());const m=p?a:null,[g,y]=function(t,e,i,r,n,o,s,a,l,c,u){return"globe"===t.projection.name?function(t,e,i,r,n,o,s,a,l,c,u){const h=[],d=[],p=t.projection.upVectorScale(u,t.center.lat,t.worldSize).metersToTile,f=[0,0,0,1],A=[0,0,0,1],m=(t,e,i,r)=>{t[0]=e,t[1]=i,t[2]=r,t[3]=1},g=ah();i>0&&(i+=g),r+=g;for(const g of e){const e=[],_=[];for(const h of g){const d=h.x+n.x,g=h.y+n.y,y=t.projection.projectTilePoint(d,g,u),v=t.projection.upVector(u,h.x,h.y);let x=i,b=r;if(s){const t=yh(d,g,i,r,s,a,l,c);x+=t.base,b+=t.top}0!==i?m(f,y.x+v[0]*p*x,y.y+v[1]*p*x,y.z+v[2]*p*x):m(f,y.x,y.y,y.z),m(A,y.x+v[0]*p*b,y.y+v[1]*p*b,y.z+v[2]*p*b),Ra(f,f,o),Ra(A,A,o),e.push(new mh(f[0],f[1],f[2])),_.push(new mh(A[0],A[1],A[2]))}h.push(e),d.push(_)}return[h,d]}(t,e,i,r,n,o,s,a,l,c,u):s?function(t,e,i,r,n,o,s,a,l){const c=[],u=[],h=[0,0,0,1];for(const d of t){const t=[],p=[];for(const c of d){const u=c.x+r.x,d=c.y+r.y,f=yh(u,d,e,i,o,s,a,l);h[0]=u,h[1]=d,h[2]=f.base,h[3]=1,Ga(h,h,n),h[3]=Math.max(h[3],1e-5);const A=new mh(h[0]/h[3],h[1]/h[3],h[2]/h[3]);h[0]=u,h[1]=d,h[2]=f.top,h[3]=1,Ga(h,h,n),h[3]=Math.max(h[3],1e-5);const m=new mh(h[0]/h[3],h[1]/h[3],h[2]/h[3]);t.push(A),p.push(m)}c.push(t),u.push(p)}return[c,u]}(e,i,r,n,o,s,a,l,c):function(t,e,i,r,n){const o=[],s=[],a=n[8]*e,l=n[9]*e,c=n[10]*e,u=n[11]*e,h=n[8]*i,d=n[9]*i,p=n[10]*i,f=n[11]*i;for(const e of t){const t=[],i=[];for(const o of e){const e=o.x+r.x,s=o.y+r.y,A=n[0]*e+n[4]*s+n[12],m=n[1]*e+n[5]*s+n[13],g=n[2]*e+n[6]*s+n[14],_=n[3]*e+n[7]*s+n[15],y=A+a,v=m+l,x=g+c,b=Math.max(_+u,1e-5),w=A+h,T=m+d,B=g+p,E=Math.max(_+f,1e-5);t.push(new mh(y/b,v/b,x/b)),i.push(new mh(w/E,T/E,B/E))}o.push(t),s.push(i)}return[o,s]}(e,i,r,n,o)}(o,r,h,u,c,s,m,d,f,o.center.lat,t.tileID.canonical),v=t.queryGeometry;return function(t,e,i){let r=1/0;pc(i,e)&&(r=_h(i,e[0]));for(let n=0;n<e.length;n++){const o=e[n],s=t[n];for(let t=0;t<o.length-1;t++){const e=o[t],n=[e,o[t+1],s[t+1],s[t],e];hc(i,n)&&(r=Math.min(r,_h(i,n)))}}return r!==1/0&&r}(g,y,v.isPointQuery()?v.screenBounds:v.screenGeometry)}},line:class extends ra{constructor(t){super(t,Sh),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(t){if("line-gradient"===t){const t=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=t._styleExpression&&t._styleExpression.expression instanceof Mi,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(t,e){super.recalculate(t,e),this.paint._values["line-floorwidth"]=Ih.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new Eh(t)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(t){return new Ks(this,t)}queryRadius(t){const e=t,i=Mh(wc("line-width",this,e),wc("line-gap-width",this,e)),r=wc("line-offset",this,e);return i/2+Math.abs(r)+Tc(this.paint.get("line-translate"))}queryIntersectsFeature(t,e,i,r,n,o){if(t.queryGeometry.isAboveHorizon)return!1;const s=Bc(t.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),o.angle,t.pixelToTileUnitsFactor),a=t.pixelToTileUnitsFactor/2*Mh(this.paint.get("line-width").evaluate(e,i),this.paint.get("line-gap-width").evaluate(e,i)),l=this.paint.get("line-offset").evaluate(e,i);return l&&(r=function(t,e){const i=[],r=new _(0,0);for(let n=0;n<t.length;n++){const o=t[n],s=[];for(let t=0;t<o.length;t++){const i=o[t],n=o[t+1],a=0===t?r:i.sub(o[t-1])._unit()._perp(),l=t===o.length-1?r:n.sub(i)._unit()._perp(),c=a._add(l)._unit();c._mult(1/(c.x*l.x+c.y*l.y)),s.push(c._mult(e)._add(i))}i.push(s)}return i}(r,l*t.pixelToTileUnitsFactor)),function(t,e,i){for(let r=0;r<e.length;r++){const n=e[r];if(t.length>=3)for(let e=0;e<n.length;e++)if(vc(t,n[e]))return!0;if(fc(t,n,i))return!0}return!1}(s,r,a)}isTileClipped(){return!0}},symbol:hf,background:class extends ra{constructor(t){super(t,df)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends ra{constructor(t){super(t,pf)}getProgramIds(){return["raster"]}},sky:class extends ra{constructor(t){super(t,Af),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){"sky-gradient"===t?this._updateColorRamp():"sky-atmosphere-sun"!==t&&"sky-atmosphere-halo-color"!==t&&"sky-atmosphere-color"!==t&&"sky-atmosphere-sun-intensity"!==t||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Qc({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(t){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=t.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(t,e){if("atmosphere"===this.paint.get("sky-type")){const i=this.paint.get("sky-atmosphere-sun"),r=!i,n=t.style.light,o=n.properties.get("position");return r&&"viewport"===n.properties.get("anchor")&&H("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),r?mf(o.azimuthal,90-o.polar,e):mf(i[0],90-i[1],e)}const i=this.paint.get("sky-gradient-center");return mf(i[0],90-i[1],e)}is3D(){return!1}isSky(){return!0}markSkyboxValid(t){this._skyboxInvalidated=!1,this._lightPosition=t.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const t=this.paint.get("sky-type");return"atmosphere"===t?["skyboxCapture","skybox"]:"gradient"===t?["skyboxGradient"]:null}}};class _f{constructor(t,e,i,r){this.context=t,this.format=i,this.texture=t.gl.createTexture(),this.update(e,r)}update(t,i,r){const{width:n,height:o}=t,{context:s}=this,{gl:a}=s,{HTMLImageElement:l,HTMLCanvasElement:c,HTMLVideoElement:u,ImageData:h,ImageBitmap:d}=e;if(a.bindTexture(a.TEXTURE_2D,this.texture),s.pixelStoreUnpackFlipY.set(!1),s.pixelStoreUnpack.set(1),s.pixelStoreUnpackPremultiplyAlpha.set(this.format===a.RGBA&&(!i||!1!==i.premultiply)),r||this.size&&this.size[0]===n&&this.size[1]===o){const{x:e,y:i}=r||{x:0,y:0};t instanceof l||t instanceof c||t instanceof u||t instanceof h||d&&t instanceof d?a.texSubImage2D(a.TEXTURE_2D,0,e,i,a.RGBA,a.UNSIGNED_BYTE,t):a.texSubImage2D(a.TEXTURE_2D,0,e,i,n,o,a.RGBA,a.UNSIGNED_BYTE,t.data)}else this.size=[n,o],t instanceof l||t instanceof c||t instanceof u||t instanceof h||d&&t instanceof d?a.texImage2D(a.TEXTURE_2D,0,this.format,this.format,a.UNSIGNED_BYTE,t):a.texImage2D(a.TEXTURE_2D,0,this.format,n,o,0,this.format,a.UNSIGNED_BYTE,t.data);this.useMipmap=Boolean(i&&i.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&a.generateMipmap(a.TEXTURE_2D)}bind(t,e){const{context:i}=this,{gl:r}=i;r.bindTexture(r.TEXTURE_2D,this.texture),t!==this.filter&&(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,t),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,this.useMipmap?t===r.NEAREST?r.NEAREST_MIPMAP_NEAREST:r.LINEAR_MIPMAP_NEAREST:t),this.filter=t),e!==this.wrap&&(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,e),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,e),this.wrap=e)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}class yf{constructor(t){this._callback=t,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._callback()}),0))}remove(){this._channel=void 0,this._callback=()=>{}}}class vf{constructor(){this.tasks={},this.taskQueue=[],U(["process"],this),this.invoker=new yf(this.process),this.nextId=0}add(t,e){const i=this.nextId++,r=function({type:t,isSymbolTile:e,zoom:i}){return i=i||0,"message"===t?0:"maybePrepare"!==t||e?"parseTile"!==t||e?"parseTile"===t&&e?300-i:"maybePrepare"===t&&e?400-i:500:200-i:100-i}(e);if(0===r){Z();try{t()}finally{}return{cancel:()=>{}}}return this.tasks[i]={fn:t,metadata:e,priority:r,id:i},this.taskQueue.push(i),this.invoker.trigger(),{cancel:()=>{delete this.tasks[i]}}}process(){Z();try{if(this.taskQueue=this.taskQueue.filter((t=>!!this.tasks[t])),!this.taskQueue.length)return;const t=this.pick();if(null===t)return;const e=this.tasks[t];if(delete this.tasks[t],this.taskQueue.length&&this.invoker.trigger(),!e)return;e.fn()}finally{}}pick(){let t=null,e=1/0;for(let i=0;i<this.taskQueue.length;i++){const r=this.tasks[this.taskQueue[i]];r.priority<e&&(e=r.priority,t=i)}if(null===t)return null;const i=this.taskQueue[t];return this.taskQueue.splice(t,1),i}remove(){this.invoker.remove()}}class xf{constructor(t){this._stringToNumber={},this._numberToString=[];for(let e=0;e<t.length;e++){const i=t[e];this._stringToNumber[i]=e,this._numberToString[e]=i}}encode(t){return this._stringToNumber[t]}decode(t){return this._numberToString[t]}}const bf=["tile","layer","source","sourceLayer","state"];class wf{constructor(t,e,i,r,n){this.type="Feature",this._vectorTileFeature=t,this._z=e,this._x=i,this._y=r,this.properties=t.properties,this.id=n}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};void 0!==this.id&&(t.id=this.id);for(const e of bf)void 0!==this[e]&&(t[e]=this[e]);return t}}const Tf=32,Bf=33,Ef=new Uint16Array(8184);for(let t=0;t<2046;t++){let e=t+2,i=0,r=0,n=0,o=0,s=0,a=0;for(1&e?n=o=s=Tf:i=r=a=Tf;(e>>=1)>1;){const t=i+n>>1,l=r+o>>1;1&e?(n=i,o=r,i=s,r=a):(i=n,r=o,n=s,o=a),s=t,a=l}const l=4*t;Ef[l+0]=i,Ef[l+1]=r,Ef[l+2]=n,Ef[l+3]=o}const Cf=new Uint16Array(2178),Sf=new Uint8Array(1089),If=new Uint16Array(1089);function Mf(t){return 0===t?-.03125:32===t?.03125:0}var kf=Oo([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const Pf={type:2,extent:aa,loadGeometry:()=>[[new _(0,0),new _(aa+1,0),new _(aa+1,aa+1),new _(0,aa+1),new _(0,0)]]};class Lf{constructor(t,e,i,r,n){this.tileID=t,this.uid=z(),this.uses=0,this.tileSize=e,this.tileZoom=i,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=n,this.expiredRequestCount=0,this.state="loading",r&&r.transform&&(this.projection=r.transform.projection)}registerFadeDuration(t){const e=t+this.timeAdded;e<qt.now()||this.fadeEndTime&&e<this.fadeEndTime||(this.fadeEndTime=e)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=Mp(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(t,e,i){if(this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(t,e){const i={};if(!e)return i;for(const r of t){const t=r.layerIds.map((t=>e.getLayer(t))).filter(Boolean);if(0!==t.length){r.layers=t,r.stateDependentLayerIds&&(r.stateDependentLayers=r.stateDependentLayerIds.map((e=>t.filter((t=>t.id===e))[0])));for(const e of t)i[e.id]=r}}return i}(t.buckets,e.style),this.hasSymbolBuckets=!1;for(const t in this.buckets){const e=this.buckets[t];if(e instanceof af){if(this.hasSymbolBuckets=!0,!i)break;e.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const t in this.buckets){const e=this.buckets[t];if(e instanceof af&&e.hasRTLText){this.hasRTLText=!0,xo.isLoading()||xo.isLoaded()||"deferred"!==yo()||vo();break}}this.queryPadding=0;for(const t in this.buckets){const i=this.buckets[t];this.queryPadding=Math.max(this.queryPadding,e.style.getLayer(t).queryRadius(i))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),t.lineAtlas&&(this.lineAtlas=t.lineAtlas)}else this.collisionBoxArray=new ps}unloadVectorData(){if(this.hasData()){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(t){return this.buckets[t.id]}upload(t){for(const e in this.buckets){const i=this.buckets[e];i.uploadPending()&&i.upload(t)}const e=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new _f(t,this.imageAtlas.image,e.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new _f(t,this.glyphAtlasImage,e.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new _f(t,this.lineAtlas.image,e.ALPHA),this.lineAtlas.uploaded=!0)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,e,i,r,n,o,s,a){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:r,pixelPosMatrix:s,transform:o,params:n,tileTransform:this.tileTransform},t,e,i):{}}querySourceFeatures(t,e){const i=this.latestFeatureIndex;if(!i||!i.rawTileData)return;const r=i.loadVTLayers(),n=e?e.sourceLayer:"",o=r._geojsonTileLayer||r[n];if(!o)return;const s=hn(e&&e.filter),{z:a,x:l,y:c}=this.tileID.canonical,u={z:a,x:l,y:c};for(let e=0;e<o.length;e++){const r=o.feature(e);if(s.needGeometry){const t=ac(r,!0);if(!s.filter(new bo(this.tileID.overscaledZ),t,this.tileID.canonical))continue}else if(!s.filter(new bo(this.tileID.overscaledZ),r))continue;const h=i.getId(r,n),d=new wf(r,a,l,c,h);d.tile=u,t.push(d)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const e=this.expirationTime;if(t.cacheControl){const e=q(t.cacheControl);e["max-age"]&&(this.expirationTime=Date.now()+1e3*e["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const t=Date.now();let i=!1;if(this.expirationTime>t)i=!1;else if(e)if(this.expirationTime<e)i=!0;else{const r=this.expirationTime-e;r?this.expirationTime=t+Math.max(r,3e4):i=!0}else i=!0;i?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(t,e){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(t).length||!e)return;const i=this.latestFeatureIndex.loadVTLayers(),r=e.style.listImages();for(const n in this.buckets){if(!e.style.hasLayer(n))continue;const o=this.buckets[n],s=o.layers[0].sourceLayer||"_geojsonTileLayer",a=i[s],l=t[s];if(!a||!l||0===Object.keys(l).length)continue;if(o.update(l,a,r,this.imageAtlas&&this.imageAtlas.patternPositions||{}),o instanceof Eh||o instanceof Cu){const t=e.style._getSourceCache(o.layers[0].source);e._terrain&&e._terrain.enabled&&t&&o.programConfigurations.needsUpload&&e._terrain._clearRenderCacheForTile(t.id,this.tileID)}const c=e&&e.style&&e.style.getLayer(n);c&&(this.queryPadding=Math.max(this.queryPadding,c.queryRadius(o)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<qt.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=qt.now()+t}setTexture(t,e){const i=e.context,r=i.gl;this.texture=this.texture||e.getTileTexture(t.width),this.texture?this.texture.update(t,{useMipmap:!0}):(this.texture=new _f(i,t,r.RGBA,{useMipmap:!0}),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE))}setDependencies(t,e){const i={};for(const t of e)i[t]=!0;this.dependencies[t]=i}hasDependency(t,e){for(const i of t){const t=this.dependencies[i];if(t)for(const i of e)if(t[i])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(t,e){if(!e||"mercator"===e.name||this._tileDebugBuffer)return;const i=sc(Pf,this.tileID.canonical,this.tileTransform)[0],r=new Qo,n=new us;for(let t=0;t<i.length;t++){const{x:e,y:o}=i[t];r.emplaceBack(e,o),n.emplaceBack(t)}n.emplaceBack(0),this._tileDebugIndexBuffer=t.createIndexBuffer(n),this._tileDebugBuffer=t.createVertexBuffer(r,tl.members),this._tileDebugSegments=sa.simpleSegment(0,0,r.length,n.length)}_makeTileBoundsBuffers(t,e){if(this._tileBoundsBuffer||!e||"mercator"===e.name)return;const i=sc(Pf,this.tileID.canonical,this.tileTransform)[0];let r,n;if(this.isRaster){const t=function(t,e){const i=Mp(t,e),r=Math.pow(2,t.z);for(let n=0;n<Bf;n++)for(let o=0;o<Bf;o++){const s=Zl((t.x+(o+Mf(o))/Tf)/r),a=ql((t.y+(n+Mf(n))/Tf)/r),l=e.project(s,a),c=n*Bf+o;Cf[2*c+0]=Math.round((l.x*i.scale-i.x)*aa),Cf[2*c+1]=Math.round((l.y*i.scale-i.y)*aa)}Sf.fill(0),If.fill(0);for(let t=2045;t>=0;t--){const e=4*t,i=Ef[e+0],r=Ef[e+1],n=Ef[e+2],o=Ef[e+3],s=i+n>>1,a=r+o>>1,l=s+a-r,c=a+i-s,u=r*Bf+i,h=o*Bf+n,d=a*Bf+s,p=Math.hypot((Cf[2*u+0]+Cf[2*h+0])/2-Cf[2*d+0],(Cf[2*u+1]+Cf[2*h+1])/2-Cf[2*d+1])>=16;Sf[d]=Sf[d]||(p?1:0),t<1022&&(Sf[d]=Sf[d]||Sf[(r+c>>1)*Bf+(i+l>>1)]||Sf[(o+c>>1)*Bf+(n+l>>1)])}const n=new jo,o=new rs;let s=0;function a(t,e){const i=e*Bf+t;return 0===If[i]&&(n.emplaceBack(Cf[2*i+0],Cf[2*i+1],t*aa/Tf,e*aa/Tf),If[i]=++s),If[i]-1}function l(t,e,i,r,n,s){const c=t+i>>1,u=e+r>>1;if(Math.abs(t-n)+Math.abs(e-s)>1&&Sf[u*Bf+c])l(n,s,t,e,c,u),l(i,r,n,s,c,u);else{const l=a(t,e),c=a(i,r),u=a(n,s);o.emplaceBack(l,c,u)}}return l(0,0,Tf,Tf,Tf,0),l(Tf,Tf,0,0,0,Tf),{vertices:n,indices:o}}(this.tileID.canonical,e);r=t.vertices,n=t.indices}else{r=new jo,n=new rs;for(const{x:t,y:e}of i)r.emplaceBack(t,e,0,0);const t=_u(r.int16,void 0,4);for(let e=0;e<t.length;e+=3)n.emplaceBack(t[e],t[e+1],t[e+2])}this._tileBoundsBuffer=t.createVertexBuffer(r,kf.members),this._tileBoundsIndexBuffer=t.createIndexBuffer(n),this._tileBoundsSegments=sa.simpleSegment(0,0,r.length,n.length)}_makeGlobeTileDebugBuffers(t,e){const i=e.projection;if(!i||"globe"!==i.name||e.freezeTileCoverage)return;const r=this.tileID.canonical,n=Ml(vl(r,e)),o=Ll(e.zoom);let s;o>0&&(s=fa(new Float64Array(16),e.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(t,r,e,n,s,o),this._makeGlobeTileDebugTextBuffer(t,r,e,n,s,o)}_globePoint(t,e,i,r,n,o,s){let a=Cl(t,e,i);if(o){const n=1<<i.z,l=Hl(r.center.lng),c=Gl(r.center.lat),u=(i.x+.5)/n-l;let h=0;u>.5?h=-1:u<-.5&&(h=1);let d=(t/aa+i.x)/n+h,p=(e/aa+i.y)/n;d=(d-l)*r._pixelsPerMercatorPixel+l,p=(p-c)*r._pixelsPerMercatorPixel+c;const f=[d*r.worldSize,p*r.worldSize,0];Ra(f,f,o),a=yl(a,f,s)}return Ra(a,a,n)}_makeGlobeTileDebugBorderBuffer(t,e,i,r,n,o){const s=new Qo,a=new us,l=new Vo,c=(t,c,u,h,d)=>{const p=(u-t)/(d-1),f=(h-c)/(d-1),A=s.length;for(let u=0;u<d;u++){const h=t+u*p,d=c+u*f;s.emplaceBack(h,d);const m=this._globePoint(h,d,e,i,r,n,o);l.emplaceBack(m[0],m[1],m[2]),a.emplaceBack(A+u)}},u=aa;c(0,0,u,0,16),c(u,0,u,u,16),c(u,u,0,u,16),c(0,u,0,0,16),this._tileDebugIndexBuffer=t.createIndexBuffer(a),this._tileDebugBuffer=t.createVertexBuffer(s,tl.members),this._globeTileDebugBorderBuffer=t.createVertexBuffer(l,Ya.members),this._tileDebugSegments=sa.simpleSegment(0,0,s.length,a.length)}_makeGlobeTileDebugTextBuffer(t,e,i,r,n,o){const s=aa/4,a=new Qo,l=new rs,c=new Vo,u=25;l.reserve(32),a.reserve(u),c.reserve(u);const h=(t,e)=>u*t+e;for(let t=0;t<u;t++){const l=t*s;for(let t=0;t<u;t++){const u=t*s;a.emplaceBack(u,l);const h=this._globePoint(u,l,e,i,r,n,o);c.emplaceBack(h[0],h[1],h[2])}}for(let t=0;t<4;t++)for(let e=0;e<4;e++){const i=h(t,e),r=h(t,e+1),n=h(t+1,e),o=h(t+1,e+1);l.emplaceBack(i,r,n),l.emplaceBack(n,r,o)}this._tileDebugTextIndexBuffer=t.createIndexBuffer(l),this._tileDebugTextBuffer=t.createVertexBuffer(a,tl.members),this._globeTileDebugTextBuffer=t.createVertexBuffer(c,Ya.members),this._tileDebugTextSegments=sa.simpleSegment(0,0,u,32)}}class zf{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,e,i){const r=String(e);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][r]=this.stateChanges[t][r]||{},P(this.stateChanges[t][r],i),null===this.deletedStates[t]){this.deletedStates[t]={};for(const e in this.state[t])e!==r&&(this.deletedStates[t][e]=null)}else if(this.deletedStates[t]&&null===this.deletedStates[t][r]){this.deletedStates[t][r]={};for(const e in this.state[t][r])i[e]||(this.deletedStates[t][r][e]=null)}else for(const e in i)this.deletedStates[t]&&this.deletedStates[t][r]&&null===this.deletedStates[t][r][e]&&delete this.deletedStates[t][r][e]}removeFeatureState(t,e,i){if(null===this.deletedStates[t])return;const r=String(e);if(this.deletedStates[t]=this.deletedStates[t]||{},i&&void 0!==e)null!==this.deletedStates[t][r]&&(this.deletedStates[t][r]=this.deletedStates[t][r]||{},this.deletedStates[t][r][i]=null);else if(void 0!==e)if(this.stateChanges[t]&&this.stateChanges[t][r])for(i in this.deletedStates[t][r]={},this.stateChanges[t][r])this.deletedStates[t][r][i]=null;else this.deletedStates[t][r]=null;else this.deletedStates[t]=null}getState(t,e){const i=String(e),r=P({},(this.state[t]||{})[i],(this.stateChanges[t]||{})[i]);if(null===this.deletedStates[t])return{};if(this.deletedStates[t]){const i=this.deletedStates[t][e];if(null===i)return{};for(const t in i)delete r[t]}return r}initializeTileState(t,e){t.setFeatureState(this.state,e)}coalesceChanges(t,e){const i={};for(const t in this.stateChanges){this.state[t]=this.state[t]||{};const e={};for(const i in this.stateChanges[t])this.state[t][i]||(this.state[t][i]={}),P(this.state[t][i],this.stateChanges[t][i]),e[i]=this.state[t][i];i[t]=e}for(const t in this.deletedStates){this.state[t]=this.state[t]||{};const e={};if(null===this.deletedStates[t])for(const i in this.state[t])e[i]={},this.state[t][i]={};else for(const i in this.deletedStates[t]){if(null===this.deletedStates[t][i])this.state[t][i]={};else if(this.state[t][i])for(const e of Object.keys(this.deletedStates[t][i]))delete this.state[t][i][e];e[i]=this.state[t][i]}i[t]=i[t]||{},P(i[t],e)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(i).length)for(const r in t)t[r].setFeatureState(i,e)}}class Ff{constructor(t){this.size=t,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(t,e){const i=this.toIdx(t,e);return{min:this.minimums[i],max:this.maximums[i]}}isLeaf(t,e){return this.leaves[this.toIdx(t,e)]}toIdx(t,e){return e*this.size+t}}function Df(t,e,i,r){let n=0,o=Number.MAX_VALUE;for(let s=0;s<3;s++)if(Math.abs(r[s])<1e-15){if(i[s]<t[s]||i[s]>e[s])return null}else{const a=1/r[s];let l=(t[s]-i[s])*a,c=(e[s]-i[s])*a;if(l>c){const t=l;l=c,c=t}if(l>n&&(n=l),c<o&&(o=c),n>o)return null}return n}function Rf(t,e,i,r,n,o,s,a,l,c,u){const h=r-t,d=n-e,p=o-i,f=s-t,A=a-e,m=l-i,g=u[1]*m-u[2]*A,_=u[2]*f-u[0]*m,y=u[0]*A-u[1]*f,v=h*g+d*_+p*y;if(Math.abs(v)<1e-15)return null;const x=1/v,b=c[0]-t,w=c[1]-e,T=c[2]-i,B=(b*g+w*_+T*y)*x;if(B<0||B>1)return null;const E=w*p-T*d,C=T*h-b*p,S=b*d-w*h,I=(u[0]*E+u[1]*C+u[2]*S)*x;return I<0||B+I>1?null:(f*E+A*C+m*S)*x}function Uf(t,e,i){return(t-e)/(i-e)}function Of(t,e,i,r,n,o,s,a,l){const c=1<<i,u=o-r,h=s-n,d=(t+1)/c*u+r,p=(e+0)/c*h+n,f=(e+1)/c*h+n;a[0]=(t+0)/c*u+r,a[1]=p,l[0]=d,l[1]=f}class Nf{constructor(t){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=t,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const e=function(t){const e=Math.ceil(Math.log2(t.dim/8)),i=[];let r=Math.ceil(Math.pow(2,e));const n=1/r,o=(t,e,i,r,n)=>{const o=r?1:0,s=(t+1)*i-o,a=e*i,l=(e+1)*i-o;n[0]=t*i,n[1]=a,n[2]=s,n[3]=l};let s=new Ff(r);const a=[];for(let e=0;e<r*r;e++){o(e%r,Math.floor(e/r),n,!1,a);const i=Vf(a[0],a[1],t),l=Vf(a[2],a[1],t),c=Vf(a[2],a[3],t),u=Vf(a[0],a[3],t);s.minimums.push(Math.min(i,l,c,u)),s.maximums.push(Math.max(i,l,c,u)),s.leaves.push(1)}for(i.push(s),r/=2;r>=1;r/=2){const t=i[i.length-1];s=new Ff(r);for(let e=0;e<r*r;e++){o(e%r,Math.floor(e/r),2,!0,a);const i=t.getElevation(a[0],a[1]),n=t.getElevation(a[2],a[1]),l=t.getElevation(a[2],a[3]),c=t.getElevation(a[0],a[3]),u=t.isLeaf(a[0],a[1]),h=t.isLeaf(a[2],a[1]),d=t.isLeaf(a[2],a[3]),p=t.isLeaf(a[0],a[3]),f=Math.min(i.min,n.min,l.min,c.min),A=Math.max(i.max,n.max,l.max,c.max),m=u&&h&&d&&p;s.maximums.push(A),s.minimums.push(f),s.leaves.push(A-f<=5&&m?1:0)}i.push(s)}return i}(this.dem),i=e.length-1,r=e[i];this._addNode(r.minimums[0],r.maximums[0],r.leaves[0]),this._construct(e,0,0,i,0)}raycastRoot(t,e,i,r,n,o,s=1){return Df([t,e,-100],[i,r,this.maximums[0]*s],n,o)}raycast(t,e,i,r,n,o,s=1){if(!this.nodeCount)return null;const a=this.raycastRoot(t,e,i,r,n,o,s);if(null==a)return null;const l=[],c=[],u=[],h=[],d=[{idx:0,t:a,nodex:0,nodey:0,depth:0}];for(;d.length>0;){const{idx:a,t:p,nodex:f,nodey:A,depth:m}=d.pop();if(this.leaves[a]){Of(f,A,m,t,e,i,r,u,h);const a=1<<m,l=(f+0)/a,c=(f+1)/a,d=(A+0)/a,g=(A+1)/a,_=Vf(l,d,this.dem)*s,y=Vf(c,d,this.dem)*s,v=Vf(c,g,this.dem)*s,x=Vf(l,g,this.dem)*s,b=Rf(u[0],u[1],_,h[0],u[1],y,h[0],h[1],v,n,o),w=Rf(h[0],h[1],v,u[0],h[1],x,u[0],u[1],_,n,o),T=Math.min(null!==b?b:Number.MAX_VALUE,null!==w?w:Number.MAX_VALUE);if(T!==Number.MAX_VALUE)return T;{const t=La([],n,o,p);if(Qf(_,y,x,v,Uf(t[0],u[0],h[0]),Uf(t[1],u[1],h[1]))>=t[2])return p}continue}let g=0;for(let d=0;d<this._siblingOffset.length;d++){Of((f<<1)+this._siblingOffset[d][0],(A<<1)+this._siblingOffset[d][1],m+1,t,e,i,r,u,h),u[2]=-100,h[2]=this.maximums[this.childOffsets[a]+d]*s;const p=Df(u,h,n,o);if(null!=p){const t=p;l[d]=t;let e=!1;for(let i=0;i<g&&!e;i++)t>=l[c[i]]&&(c.splice(i,0,d),e=!0);e||(c[g]=d),g++}}for(let t=0;t<g;t++){const e=c[t];d.push({idx:this.childOffsets[a]+e,t:l[e],nodex:(f<<1)+this._siblingOffset[e][0],nodey:(A<<1)+this._siblingOffset[e][1],depth:m+1})}}return null}_addNode(t,e,i){return this.minimums.push(t),this.maximums.push(e),this.leaves.push(i),this.childOffsets.push(0),this.nodeCount++}_construct(t,e,i,r,n){if(1===t[r].isLeaf(e,i))return;this.childOffsets[n]||(this.childOffsets[n]=this.nodeCount);const o=r-1,s=t[o];let a=0,l=0;for(let t=0;t<this._siblingOffset.length;t++){const r=2*e+this._siblingOffset[t][0],n=2*i+this._siblingOffset[t][1],o=s.getElevation(r,n),c=s.isLeaf(r,n),u=this._addNode(o.min,o.max,c);c&&(a|=1<<t),l||(l=u)}for(let r=0;r<this._siblingOffset.length;r++)a&1<<r||this._construct(t,2*e+this._siblingOffset[r][0],2*i+this._siblingOffset[r][1],o,l+r)}}function Qf(t,e,i,r,n,o){return ki(ki(t,i,o),ki(e,r,o),n)}function Vf(t,e,i){const r=i.dim,n=C(t*r-.5,0,r-1),o=C(e*r-.5,0,r-1),s=Math.floor(n),a=Math.floor(o),l=Math.min(s+1,r-1),c=Math.min(a+1,r-1);return Qf(i.get(s,a),i.get(l,a),i.get(s,c),i.get(l,c),n-s,o-a)}const jf={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function Hf(t,e,i){return(256*t*256+256*e+i)/10-1e4}function Gf(t,e,i){return 256*t+e+i/256-32768}class $f{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(t,e,i,r=!1,n=!1){if(this.uid=t,e.height!==e.width)throw new RangeError("DEM tiles must be square");if(i&&"mapbox"!==i&&"terrarium"!==i)return H(`"${i}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=e.height;const o=this.dim=e.height-2,s=new Uint32Array(e.data.buffer);if(this.pixels=new Uint8Array(e.data.buffer),this.encoding=i||"mapbox",this.borderReady=r,!r){for(let t=0;t<o;t++)s[this._idx(-1,t)]=s[this._idx(0,t)],s[this._idx(o,t)]=s[this._idx(o-1,t)],s[this._idx(t,-1)]=s[this._idx(t,0)],s[this._idx(t,o)]=s[this._idx(t,o-1)];s[this._idx(-1,-1)]=s[this._idx(0,0)],s[this._idx(o,-1)]=s[this._idx(o-1,0)],s[this._idx(-1,o)]=s[this._idx(0,o-1)],s[this._idx(o,o)]=s[this._idx(o-1,o-1)],n&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new Nf(this)}get(t,e,i=!1){i&&(t=C(t,-1,this.dim),e=C(e,-1,this.dim));const r=4*this._idx(t,e);return("terrarium"===this.encoding?Gf:Hf)(this.pixels[r],this.pixels[r+1],this.pixels[r+2])}static getUnpackVector(t){return jf[t]}get unpackVector(){return jf[this.encoding]}_idx(t,e){if(t<-1||t>=this.dim+1||e<-1||e>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(e+1)*this.stride+(t+1)}static pack(t,e){const i=[0,0,0,0],r=$f.getUnpackVector(e);let n=Math.floor((t+r[3])/r[2]);return i[2]=n%256,n=Math.floor(n/256),i[1]=n%256,n=Math.floor(n/256),i[0]=n,i}getPixels(){return new Oc({width:this.stride,height:this.stride},this.pixels)}backfillBorder(t,e,i){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let r=e*this.dim,n=e*this.dim+this.dim,o=i*this.dim,s=i*this.dim+this.dim;switch(e){case-1:r=n-1;break;case 1:n=r+1}switch(i){case-1:o=s-1;break;case 1:s=o+1}const a=-e*this.dim,l=-i*this.dim;for(let e=o;e<s;e++)for(let i=r;i<n;i++){const r=4*this._idx(i,e),n=4*this._idx(i+a,e+l);this.pixels[r+0]=t.pixels[n+0],this.pixels[r+1]=t.pixels[n+1],this.pixels[r+2]=t.pixels[n+2],this.pixels[r+3]=t.pixels[n+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}Kn($f,"DEMData"),Kn(Nf,"DemMinMaxQuadTree",{omit:["dem"]});class Zf{constructor(t,e){this.max=t,this.onRemove=e,this.reset()}reset(){for(const t in this.data)for(const e of this.data[t])e.timeout&&clearTimeout(e.timeout),this.onRemove(e.value);return this.data={},this.order=[],this}add(t,e,i){const r=t.wrapped().key;void 0===this.data[r]&&(this.data[r]=[]);const n={value:e,timeout:void 0};if(void 0!==i&&(n.timeout=setTimeout((()=>{this.remove(t,n)}),i)),this.data[r].push(n),this.order.push(r),this.order.length>this.max){const t=this._getAndRemoveByKey(this.order[0]);t&&this.onRemove(t)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const e=this.data[t].shift();return e.timeout&&clearTimeout(e.timeout),0===this.data[t].length&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),e.value}getByKey(t){const e=this.data[t];return e?e[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,e){if(!this.has(t))return this;const i=t.wrapped().key,r=void 0===e?0:this.data[i].indexOf(e),n=this.data[i][r];return this.data[i].splice(r,1),n.timeout&&clearTimeout(n.timeout),0===this.data[i].length&&delete this.data[i],this.onRemove(n.value),this.order.splice(this.order.indexOf(i),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const t=this._getAndRemoveByKey(this.order[0]);t&&this.onRemove(t)}return this}filter(t){const e=[];for(const i in this.data)for(const r of this.data[i])t(r.value)||e.push(r);for(const t of e)this.remove(t.value.tileID,t)}}class qf{constructor(t,e,i){this.func=t,this.mask=e,this.range=i}}qf.ReadOnly=!1,qf.ReadWrite=!0,qf.disabled=new qf(519,qf.ReadOnly,[0,1]);const Kf=7680;class Wf{constructor(t,e,i,r,n,o){this.test=t,this.ref=e,this.mask=i,this.fail=r,this.depthFail=n,this.pass=o}}Wf.disabled=new Wf({func:519,mask:0},0,0,Kf,Kf,Kf);class Xf{constructor(t,e,i){this.blendFunction=t,this.blendColor=e,this.mask=i}}Xf.Replace=[1,0],Xf.disabled=new Xf(Xf.Replace,ke.transparent,[!1,!1,!1,!1]),Xf.unblended=new Xf(Xf.Replace,ke.transparent,[!0,!0,!0,!0]),Xf.alphaBlended=new Xf([1,771],ke.transparent,[!0,!0,!0,!0]);const Jf=1029,Yf=2305;class tA{constructor(t,e,i){this.enable=t,this.mode=e,this.frontFace=i}}tA.disabled=new tA(!1,Jf,Yf),tA.backCCW=new tA(!0,Jf,Yf),tA.backCW=new tA(!0,Jf,2304),tA.frontCW=new tA(!0,1028,2304),tA.frontCCW=new tA(!0,1028,Yf);class eA extends Yt{constructor(t,e,i){super(),this.id=t,this._onlySymbols=i,e.on("data",(t=>{"source"===t.dataType&&"metadata"===t.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===t.dataType&&"content"===t.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))})),e.on("error",(()=>{this._sourceErrored=!0})),this._source=e,this._tiles={},this._cache=new Zf(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=e.minTileCacheSize,this._maxTileCacheSize=e.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new zf,this._isRaster="raster"===this._source.type||"raster-dem"===this._source.type||"custom"===this._source.type&&"raster"===this._source._dataType}onAdd(t){this.map=t,this._minTileCacheSize=void 0===this._minTileCacheSize&&t?t._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=void 0===this._maxTileCacheSize&&t?t._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded)return!1;if(!this._source.loaded())return!1;for(const t in this._tiles){const e=this._tiles[t];if("loaded"!==e.state&&"errored"!==e.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(t,e){return t.isSymbolTile=this._onlySymbols,this._source.loadTile(t,e)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t,(()=>{}))}_abortTile(t){if(this._source.abortTile)return this._source.abortTile(t,(()=>{}))}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const e in this._tiles){const i=this._tiles[e];i.upload(t),i.prepare(this.map.style.imageManager)}}getIds(){return k(this._tiles).map((t=>t.tileID)).sort(iA).map((t=>t.key))}getRenderableIds(t){const e=[];for(const i in this._tiles)this._isIdRenderable(+i,t)&&e.push(this._tiles[i]);return t?e.sort(((t,e)=>{const i=t.tileID,r=e.tileID,n=new _(i.canonical.x,i.canonical.y)._rotate(this.transform.angle),o=new _(r.canonical.x,r.canonical.y)._rotate(this.transform.angle);return i.overscaledZ-r.overscaledZ||o.y-n.y||o.x-n.x})).map((t=>t.tileID.key)):e.map((t=>t.tileID)).sort(iA).map((t=>t.key))}hasRenderableParent(t){const e=this.findLoadedParent(t,0);return!!e&&this._isIdRenderable(e.tileID.key)}_isIdRenderable(t,e){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(e||!this._tiles[t].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)"errored"!==this._tiles[t].state&&this._reloadTile(+t,"reloading")}}_reloadTile(t,e){const i=this._tiles[t];i&&("loading"!==i.state&&(i.state=e),this._loadTile(i,this._tileLoaded.bind(this,i,t,e)))}_tileLoaded(t,e,i,r){if(r)if(t.state="errored",404!==r.status)this._source.fire(new Jt(r,{tile:t}));else if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const t=this.map.painter.terrain;this.update(this.transform,t.getScaledDemTileSize(),!0),t.resetTileLookupCache(this.id)}else this.update(this.transform);else t.timeAdded=qt.now(),"expired"===i&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(e,t),"raster-dem"===this._source.type&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),this._source.fire(new Xt("data",{dataType:"source",tile:t,coord:t.tileID,sourceCacheId:this.id}))}_backfillDEM(t){const e=this.getRenderableIds();for(let r=0;r<e.length;r++){const n=e[r];if(t.neighboringTiles&&t.neighboringTiles[n]){const e=this.getTileByID(n);i(t,e),i(e,t)}}function i(t,e){if(!t.dem||t.dem.borderReady)return;t.needsHillshadePrepare=!0,t.needsDEMTextureUpload=!0;let i=e.tileID.canonical.x-t.tileID.canonical.x;const r=e.tileID.canonical.y-t.tileID.canonical.y,n=Math.pow(2,t.tileID.canonical.z),o=e.tileID.key;0===i&&0===r||Math.abs(r)>1||(Math.abs(i)>1&&(1===Math.abs(i+n)?i+=n:1===Math.abs(i-n)&&(i-=n)),e.dem&&t.dem&&(t.dem.backfillBorder(e.dem,i,r),t.neighboringTiles&&t.neighboringTiles[o]&&(t.neighboringTiles[o].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,e,i,r){for(const n in this._tiles){let o=this._tiles[n];if(r[n]||!o.hasData()||o.tileID.overscaledZ<=e||o.tileID.overscaledZ>i)continue;let s=o.tileID;for(;o&&o.tileID.overscaledZ>e+1;){const t=o.tileID.scaledTo(o.tileID.overscaledZ-1);o=this._tiles[t.key],o&&o.hasData()&&(s=t)}let a=s;for(;a.overscaledZ>e;)if(a=a.scaledTo(a.overscaledZ-1),t[a.key]){r[s.key]=s;break}}}findLoadedParent(t,e){if(t.key in this._loadedParentTiles){const i=this._loadedParentTiles[t.key];return i&&i.tileID.overscaledZ>=e?i:null}for(let i=t.overscaledZ-1;i>=e;i--){const e=t.scaledTo(i),r=this._getLoadedTile(e);if(r)return r}}_getLoadedTile(t){const e=this._tiles[t.key];return e&&e.hasData()?e:this._cache.getByKey(this._source.reparseOverscaled?t.wrapped().key:t.canonical.key)}updateCacheSize(t,e){e=e||this._source.tileSize;const i=Math.ceil(t.width/e)+1,r=Math.ceil(t.height/e)+1,n=Math.floor(i*r*5),o="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,n):n,s="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,o):o;this._cache.setMaxSize(s)}handleWrapJump(t){const e=Math.round((t-(void 0===this._prevLng?t:this._prevLng))/360);if(this._prevLng=t,e){const t={};for(const i in this._tiles){const r=this._tiles[i];r.tileID=r.tileID.unwrapTo(r.tileID.wrap+e),t[r.tileID.key]=r}this._tiles=t;for(const t in this._timers)clearTimeout(this._timers[t]),delete this._timers[t];for(const t in this._tiles)this._setTileReloadTimer(+t,this._tiles[t])}}update(t,e,i){if(this.transform=t,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage)return;if(this.usedForTerrain&&!i)return;let r;this.updateCacheSize(t,e),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?r=t.getVisibleUnwrappedCoordinates(this._source.tileID).map((t=>new fh(t.canonical.z,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y))):(r=t.coveringTiles({tileSize:e||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!i,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(r=r.filter((t=>this._source.hasTile(t))))):r=[];const n=this._updateRetainedTiles(r);if(rA(this._source.type)&&0!==r.length){const t={},e={},i=Object.keys(n);for(const r of i){const i=n[r],o=this._tiles[r];if(!o||o.fadeEndTime&&o.fadeEndTime<=qt.now())continue;const s=this.findLoadedParent(i,Math.max(i.overscaledZ-eA.maxOverzooming,this._source.minzoom));s&&(this._addTile(s.tileID),t[s.tileID.key]=s.tileID),e[r]=i}const o=r[r.length-1].overscaledZ;for(const t in this._tiles){const i=this._tiles[t];if(n[t]||!i.hasData())continue;let r=i.tileID;for(;r.overscaledZ>o;){r=r.scaledTo(r.overscaledZ-1);const o=this._tiles[r.key];if(o&&o.hasData()&&e[r.key]){n[t]=i.tileID;break}}}for(const e in t)n[e]||(this._coveredTiles[e]=!0,n[e]=t[e])}for(const t in n)this._tiles[t].clearFadeHold();const o=function(t,e){const i=[];for(const r in t)r in e||i.push(r);return i}(this._tiles,n);for(const t of o){const e=this._tiles[t];e.hasSymbolBuckets&&!e.holdingForFade()?e.setHoldDuration(this.map._fadeDuration):e.hasSymbolBuckets&&!e.symbolFadeFinished()||this._removeTile(+t)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(+t)}_updateRetainedTiles(t){const e={};if(0===t.length)return e;const i={},r=t.reduce(((t,e)=>Math.min(t,e.overscaledZ)),1/0),n=t[0].overscaledZ,o=Math.max(n-eA.maxOverzooming,this._source.minzoom),s=Math.max(n+eA.maxUnderzooming,this._source.minzoom),a={};for(const i of t){const t=this._addTile(i);e[i.key]=i,t.hasData()||r<this._source.maxzoom&&(a[i.key]=i)}this._retainLoadedChildren(a,r,s,e);for(const r of t){let t=this._tiles[r.key];if(t.hasData())continue;if(r.canonical.z>=this._source.maxzoom){const t=r.children(this._source.maxzoom)[0],i=this.getTile(t);if(i&&i.hasData()){e[t.key]=t;continue}}else{const t=r.children(this._source.maxzoom);if(e[t[0].key]&&e[t[1].key]&&e[t[2].key]&&e[t[3].key])continue}let n=t.wasRequested();for(let s=r.overscaledZ-1;s>=o;--s){const o=r.scaledTo(s);if(i[o.key])break;if(i[o.key]=!0,t=this.getTile(o),!t&&n&&(t=this._addTile(o)),t&&(e[o.key]=o,n=t.wasRequested(),t.hasData()))break}}return e}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const e=[];let i,r=this._tiles[t].tileID;for(;r.overscaledZ>0;){if(r.key in this._loadedParentTiles){i=this._loadedParentTiles[r.key];break}e.push(r.key);const t=r.scaledTo(r.overscaledZ-1);if(i=this._getLoadedTile(t),i)break;r=t}for(const t of e)this._loadedParentTiles[t]=i}}_addTile(t){let e=this._tiles[t.key];if(e)return e;e=this._cache.getAndRemove(t),e&&(this._setTileReloadTimer(t.key,e),e.tileID=t,this._state.initializeTileState(e,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,e)));const i=Boolean(e);if(!i){const i=this.map?this.map.painter:null;e=new Lf(t,this._source.tileSize*t.overscaleFactor(),this.transform.tileZoom,i,this._isRaster),this._loadTile(e,this._tileLoaded.bind(this,e,t.key,e.state))}return e?(e.uses++,this._tiles[t.key]=e,i||this._source.fire(new Xt("dataloading",{tile:e,coord:e.tileID,dataType:"source"})),e):null}_setTileReloadTimer(t,e){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const i=e.getExpiryTimeout();i&&(this._timers[t]=setTimeout((()=>{this._reloadTile(t,"expired"),delete this._timers[t]}),i))}_removeTile(t){const e=this._tiles[t];e&&(e.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),e.uses>0||(e.hasData()&&"reloading"!==e.state?this._cache.add(e.tileID,e,e.getExpiryTimeout()):(e.aborted=!0,this._abortTile(e),this._unloadTile(e))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(+t);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(t,e,i){const r=[],n=this.transform;if(!n)return r;const o="globe"===n.projection.name,s=Hl(n.center.lng);for(const a in this._tiles){const l=this._tiles[a];if(i&&l.clearQueryDebugViz(),l.holdingForFade())continue;let c;if(o){const t=l.tileID.canonical;if(0===t.z){const e=[Math.abs(C(s,...nA(t,-1))-s),Math.abs(C(s,...nA(t,1))-s)];c=[0,2*e.indexOf(Math.min(...e))-1]}else{const e=[Math.abs(C(s,...nA(t,-1))-s),Math.abs(C(s,...nA(t,0))-s),Math.abs(C(s,...nA(t,1))-s)];c=[e.indexOf(Math.min(...e))-1]}}else c=[0];for(const i of c){const o=t.containsTile(l,n,e,i);o&&r.push(o)}}return r}getVisibleCoordinates(t){const e=this.getRenderableIds(t).map((t=>this._tiles[t].tileID));for(const t of e)t.projMatrix=this.transform.calculateProjMatrix(t.toUnwrapped());return e}hasTransition(){if(this._source.hasTransition())return!0;if(rA(this._source.type))for(const t in this._tiles){const e=this._tiles[t];if(void 0!==e.fadeEndTime&&e.fadeEndTime>=qt.now())return!0}return!1}setFeatureState(t,e,i){this._state.updateState(t=t||"_geojsonTileLayer",e,i)}removeFeatureState(t,e,i){this._state.removeFeatureState(t=t||"_geojsonTileLayer",e,i)}getFeatureState(t,e){return this._state.getState(t=t||"_geojsonTileLayer",e)}setDependencies(t,e,i){const r=this._tiles[t];r&&r.setDependencies(e,i)}reloadTilesForDependencies(t,e){for(const i in this._tiles)this._tiles[i].hasDependency(t,e)&&this._reloadTile(+i,"reloading");this._cache.filter((i=>!i.hasDependency(t,e)))}_preloadTiles(t,e){if(!this._sourceLoaded){const i=()=>{this._sourceLoaded&&(this._source.off("data",i),this._preloadTiles(t,e))};return void this._source.on("data",i)}const i=new Map,r=Array.isArray(t)?t:[t],n=this.map.painter.terrain,o=this.usedForTerrain&&n?n.getScaledDemTileSize():this._source.tileSize;for(const t of r){const e=t.coveringTiles({tileSize:o,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const t of e)i.set(t.key,t);this.usedForTerrain&&t.updateElevation(!1)}M(Array.from(i.values()),((t,e)=>{const i=new Lf(t,this._source.tileSize*t.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(i,(t=>{"raster-dem"===this._source.type&&i.dem&&this._backfillDEM(i),e(t,i)}))}),e)}}function iA(t,e){const i=Math.abs(2*t.wrap)-+(t.wrap<0),r=Math.abs(2*e.wrap)-+(e.wrap<0);return t.overscaledZ-e.overscaledZ||r-i||e.canonical.y-t.canonical.y||e.canonical.x-t.canonical.x}function rA(t){return"raster"===t||"image"===t||"video"===t||"custom"===t}function nA(t,e){const i=1<<t.z;return[t.x/i+e,(t.x+1)/i+e]}eA.maxOverzooming=10,eA.maxUnderzooming=3;class oA{constructor(t,e,i){this._demTile=t,this._dem=this._demTile.dem,this._scale=e,this._offset=i}static create(t,e,i){const r=i||t.findDEMTileFor(e);if(!r||!r.dem)return;const n=r.dem,o=r.tileID,s=1<<e.canonical.z-o.canonical.z;return new oA(r,r.tileSize/aa/s,[(e.canonical.x/s-o.canonical.x)*n.dim,(e.canonical.y/s-o.canonical.y)*n.dim])}tileCoordToPixel(t,e){const i=e*this._scale+this._offset[1],r=Math.floor(t*this._scale+this._offset[0]),n=Math.floor(i);return new _(r,n)}getElevationAt(t,e,i,r){const n=t*this._scale+this._offset[0],o=e*this._scale+this._offset[1],s=Math.floor(n),a=Math.floor(o),l=this._dem;return r=!!r,i?ki(ki(l.get(s,a,r),l.get(s,a+1,r),o-a),ki(l.get(s+1,a,r),l.get(s+1,a+1,r),o-a),n-s):l.get(s,a,r)}getElevationAtPixel(t,e,i){return this._dem.get(t,e,!!i)}getMeterToDEM(t){return(1<<this._demTile.tileID.canonical.z)*$l(1,t)*this._dem.stride}}class sA{constructor(t,e){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new Zn(aa,16,0),this.featureIndexArray=new xs,this.promoteId=e}insert(t,e,i,r,n,o=0){const s=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(i,r,n,o);const a=this.grid;for(let t=0;t<e.length;t++){const i=e[t],r=[1/0,1/0,-1/0,-1/0];for(let t=0;t<i.length;t++){const e=i[t];r[0]=Math.min(r[0],e.x),r[1]=Math.min(r[1],e.y),r[2]=Math.max(r[2],e.x),r[3]=Math.max(r[3],e.y)}r[0]<aa&&r[1]<aa&&r[2]>=0&&r[3]>=0&&a.insert(s,r[0],r[1],r[2],r[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new $u(new md(this.rawTileData)).layers,this.sourceLayerCoder=new xf(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const t in this.vtLayers)this.vtFeatures[t]=[]}return this.vtLayers}query(t,e,i,r){this.loadVTLayers();const n=t.params||{},o=hn(n.filter),s=t.tileResult,a=t.transform,l=s.bufferedTilespaceBounds,c=this.grid.query(l.min.x,l.min.y,l.max.x,l.max.y,((t,e,i,r)=>xc(s.bufferedTilespaceGeometry,t,e,i,r)));c.sort(lA);let u=null;a.elevation&&c.length>0&&(u=oA.create(a.elevation,this.tileID));const h={};let d;for(let a=0;a<c.length;a++){const l=c[a];if(l===d)continue;d=l;const p=this.featureIndexArray.get(l);let f=null;this.loadMatchingFeature(h,p,o,n.layers,n.availableImages,e,i,r,((e,i,r,n=0)=>(f||(f=sc(e,this.tileID.canonical,t.tileTransform)),i.queryIntersectsFeature(s,e,r,f,this.z,t.transform,t.pixelPosMatrix,u,n))))}return h}loadMatchingFeature(t,e,i,r,n,o,s,a,l){const{featureIndex:c,bucketIndex:u,sourceLayerIndex:h,layoutVertexArrayOffset:d}=e,p=this.bucketLayerIDs[u];if(r&&!function(t,e){for(let i=0;i<t.length;i++)if(e.indexOf(t[i])>=0)return!0;return!1}(r,p))return;const f=this.sourceLayerCoder.decode(h),A=this.vtLayers[f].feature(c);if(i.needGeometry){const t=ac(A,!0);if(!i.filter(new bo(this.tileID.overscaledZ),t,this.tileID.canonical))return}else if(!i.filter(new bo(this.tileID.overscaledZ),A))return;const m=this.getId(A,f);for(let e=0;e<p.length;e++){const i=p[e];if(r&&r.indexOf(i)<0)continue;const u=o[i];if(!u)continue;let h={};void 0!==m&&a&&(h=a.getState(u.sourceLayer||"_geojsonTileLayer",m));const f=P({},s[i]);f.paint=aA(f.paint,u.paint,A,h,n),f.layout=aA(f.layout,u.layout,A,h,n);const g=!l||l(A,u,h,d);if(!g)continue;const _=new wf(A,this.z,this.x,this.y,m);_.layer=f;let y=t[i];void 0===y&&(y=t[i]=[]),y.push({featureIndex:c,feature:_,intersectionZ:g})}}lookupSymbolFeatures(t,e,i,r,n,o,s,a){const l={};this.loadVTLayers();const c=hn(n);for(const n of t)this.loadMatchingFeature(l,{bucketIndex:i,sourceLayerIndex:r,featureIndex:n,layoutVertexArrayOffset:0},c,o,s,a,e);return l}loadFeature(t){const{featureIndex:e,sourceLayerIndex:i}=t;this.loadVTLayers();const r=this.sourceLayerCoder.decode(i),n=this.vtFeatures[r];if(n[e])return n[e];const o=this.vtLayers[r].feature(e);return n[e]=o,o}hasLayer(t){for(const e of this.bucketLayerIDs)for(const i of e)if(t===i)return!0;return!1}getId(t,e){let i=t.id;if(this.promoteId){const r="string"==typeof this.promoteId?this.promoteId:this.promoteId[e];null!=r&&(i=t.properties[r]),"boolean"==typeof i&&(i=Number(i))}return i}}function aA(t,e,i,r,n){return N(t,((t,o)=>{const s=e instanceof Mo?e.get(o):null;return s&&s.evaluate?s.evaluate(i,r,n):s}))}function lA(t,e){return e-t}Kn(sA,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class cA{constructor(t,e){this.width=t,this.height=e,this.nextRow=0,this.image=new Uc({width:t,height:e}),this.positions={},this.uploaded=!1}getDash(t,e){const i=this.getKey(t,e);return this.positions[i]}trim(){const t=this.width,e=this.height=D(this.nextRow);this.image.resize({width:t,height:e})}getKey(t,e){return t.join(",")+e}getDashRanges(t,e,i){const r=[];let n=t.length%2==1?-t[t.length-1]*i:0,o=t[0]*i,s=!0;r.push({left:n,right:o,isDash:s,zeroLength:0===t[0]});let a=t[0];for(let e=1;e<t.length;e++){s=!s;const l=t[e];n=a*i,a+=l,o=a*i,r.push({left:n,right:o,isDash:s,zeroLength:0===l})}return r}addRoundDash(t,e,i){const r=e/2;for(let e=-i;e<=i;e++){const n=this.width*(this.nextRow+i+e);let o=0,s=t[o];for(let a=0;a<this.width;a++){a/s.right>1&&(s=t[++o]);const l=Math.abs(a-s.left),c=Math.abs(a-s.right),u=Math.min(l,c);let h;const d=e/i*(r+1);if(s.isDash){const t=r-Math.abs(d);h=Math.sqrt(u*u+t*t)}else h=r-Math.sqrt(u*u+d*d);this.image.data[n+a]=Math.max(0,Math.min(255,h+128))}}}addRegularDash(t,e){for(let e=t.length-1;e>=0;--e){const i=t[e],r=t[e+1];i.zeroLength?t.splice(e,1):r&&r.isDash===i.isDash&&(r.left=i.left,t.splice(e,1))}const i=t[0],r=t[t.length-1];i.isDash===r.isDash&&(i.left=r.left-this.width,r.right=i.right+this.width);const n=this.width*this.nextRow;let o=0,s=t[o];for(let i=0;i<this.width;i++){i/s.right>1&&(s=t[++o]);const r=Math.abs(i-s.left),a=Math.abs(i-s.right),l=Math.min(r,a);this.image.data[n+i]=Math.max(0,Math.min(255,(s.isDash?l:-l)+e+128))}}addDash(t,e){const i=this.getKey(t,e);if(this.positions[i])return this.positions[i];const r="round"===e,n=r?7:0,o=2*n+1;if(this.nextRow+o>this.height)return H("LineAtlas out of space"),null;0===t.length&&t.push(1);let s=0;for(let e=0;e<t.length;e++)t[e]<0&&(H("Negative value is found in line dasharray, replacing values with 0"),t[e]=0),s+=t[e];if(0!==s){const i=this.width/s,o=this.getDashRanges(t,this.width,i);r?this.addRoundDash(o,i,n):this.addRegularDash(o,"square"===e?.5*i:0)}const a=this.nextRow+n;this.nextRow+=o;const l={tl:[a,n],br:[s,0]};return this.positions[i]=l,l}}Kn(cA,"LineAtlas");const uA=1*tp;class hA{constructor(t){const e={},i=[];for(const r in t){const n=t[r],o=e[r]={};for(const t in n.glyphs){const e=n.glyphs[+t];if(!e||0===e.bitmap.width||0===e.bitmap.height)continue;const r=e.metrics.localGlyph?uA:1,s={x:0,y:0,w:e.bitmap.width+2*r,h:e.bitmap.height+2*r};i.push(s),o[t]=s}}const{w:r,h:n}=bd(i),o=new Uc({width:r||1,height:n||1});for(const i in t){const r=t[i];for(const t in r.glyphs){const n=r.glyphs[+t];if(!n||0===n.bitmap.width||0===n.bitmap.height)continue;const s=e[i][t],a=n.metrics.localGlyph?uA:1;Uc.copy(n.bitmap,o,{x:0,y:0},{x:s.x+a,y:s.y+a},n.bitmap)}}this.image=o,this.positions=e}}Kn(hA,"GlyphAtlas");class dA{constructor(t){this.tileID=new fh(t.tileID.overscaledZ,t.tileID.wrap,t.tileID.canonical.z,t.tileID.canonical.x,t.tileID.canonical.y),this.tileZoom=t.tileZoom,this.uid=t.uid,this.zoom=t.zoom,this.canonical=t.tileID.canonical,this.pixelRatio=t.pixelRatio,this.tileSize=t.tileSize,this.source=t.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=t.showCollisionBoxes,this.collectResourceTiming=!!t.collectResourceTiming,this.returnDependencies=!!t.returnDependencies,this.promoteId=t.promoteId,this.enableTerrain=!!t.enableTerrain,this.isSymbolTile=t.isSymbolTile,this.tileTransform=Mp(t.tileID.canonical,t.projection),this.projection=t.projection}parse(t,e,i,r,n){this.status="parsing",this.data=t,this.collisionBoxArray=new ps;const o=new xf(Object.keys(t.layers).sort()),s=new sA(this.tileID,this.promoteId);s.bucketLayerIDs=[];const a={},l=new cA(256,256),c={featureIndex:s,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:l,availableImages:i},u=e.familiesBySource[this.source];for(const e in u){const r=t.layers[e];if(!r)continue;let n=!1,l=!1;for(const t of u[e])"symbol"===t[0].type?n=!0:l=!0;if(!0===this.isSymbolTile&&!n)continue;if(!1===this.isSymbolTile&&!l)continue;1===r.version&&H(`Vector tile source "${this.source}" layer "${e}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const h=o.encode(e),d=[];for(let t=0;t<r.length;t++){const i=r.feature(t),n=s.getId(i,e);d.push({feature:i,id:n,index:t,sourceLayerIndex:h})}for(const t of u[e]){const e=t[0];void 0!==this.isSymbolTile&&"symbol"===e.type!==this.isSymbolTile||e.minzoom&&this.zoom<Math.floor(e.minzoom)||e.maxzoom&&this.zoom>=e.maxzoom||"none"!==e.visibility&&(pA(t,this.zoom,i),(a[e.id]=e.createBucket({index:s.bucketLayerIDs.length,layers:t,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:h,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:i})).populate(d,c,this.tileID.canonical,this.tileTransform),s.bucketLayerIDs.push(t.map((t=>t.id))))}}let h,d,p,f;l.trim();const A={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},m=()=>{if(h)return n(h);if(d&&p&&f){const t=new hA(d),e=new Bd(p,f);for(const r in a){const n=a[r];n instanceof af?(pA(n.layers,this.zoom,i),yp(n,d,t.positions,p,e.iconPositions,this.showCollisionBoxes,i,this.tileID.canonical,this.tileZoom,this.projection)):n.hasPattern&&(n instanceof Eh||n instanceof Cu||n instanceof th)&&(pA(n.layers,this.zoom,i),n.addFeatures(c,this.tileID.canonical,e.patternPositions,i,this.tileTransform))}this.status="done",n(null,{buckets:k(a).filter((t=>!t.isEmpty())),featureIndex:s,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:t.image,lineAtlas:l,imageAtlas:e,glyphMap:this.returnDependencies?d:null,iconMap:this.returnDependencies?p:null,glyphPositions:this.returnDependencies?t.positions:null})}},g=N(c.glyphDependencies,(t=>Object.keys(t).map(Number)));Object.keys(g).length?r.send("getGlyphs",{uid:this.uid,stacks:g},((t,e)=>{h||(h=t,d=e,m())}),void 0,!1,A):d={};const _=Object.keys(c.iconDependencies);_.length?r.send("getImages",{icons:_,source:this.source,tileID:this.tileID,type:"icons"},((t,e)=>{h||(h=t,p=e,m())}),void 0,!1,A):p={};const y=Object.keys(c.patternDependencies);y.length?r.send("getImages",{icons:y,source:this.source,tileID:this.tileID,type:"patterns"},((t,e)=>{h||(h=t,f=e,m())}),void 0,!1,A):f={},m()}}function pA(t,e,i){const r=new bo(e);for(const e of t)e.recalculate(r,i)}class fA{constructor(t){this.entries={},this.scheduler=t}request(t,e,i,r){const n=this.entries[t]=this.entries[t]||{callbacks:[]};if(n.result){const[t,i]=n.result;return this.scheduler?this.scheduler.add((()=>{r(t,i)}),e):r(t,i),()=>{}}return n.callbacks.push(r),n.cancel||(n.cancel=i(((i,r)=>{n.result=[i,r];for(const t of n.callbacks)this.scheduler?this.scheduler.add((()=>{t(i,r)}),e):t(i,r);setTimeout((()=>delete this.entries[t]),3e3)}))),()=>{n.result||(n.callbacks=n.callbacks.filter((t=>t!==r)),n.callbacks.length||(n.cancel(),delete this.entries[t]))}}}function AA(t,e,i){const r=JSON.stringify(t.request);return t.data&&(this.deduped.entries[r]={result:[null,t.data]}),this.deduped.request(r,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom},(e=>{const r=dt(t.request,((t,r,n,o)=>{t?e(t):r&&e(null,{vectorTile:i?void 0:new $u(new md(r)),rawData:r,cacheControl:n,expires:o})}));return()=>{r.cancel(),e()}}),e)}const mA=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class gA{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[e,i]=new Uint8Array(t,0,2);if(219!==e)throw new Error("Data does not appear to be in a KDBush format.");const r=i>>4;if(1!==r)throw new Error(`Got v${r} data when expected v1.`);const n=mA[15&i];if(!n)throw new Error("Unrecognized array type.");const[o]=new Uint16Array(t,2,1),[s]=new Uint32Array(t,4,1);return new gA(s,o,n,t)}constructor(t,e=64,i=Float64Array,r){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+e,2),65535),this.ArrayType=i,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const n=mA.indexOf(this.ArrayType),o=2*t*this.ArrayType.BYTES_PER_ELEMENT,s=t*this.IndexArrayType.BYTES_PER_ELEMENT,a=(8-s%8)%8;if(n<0)throw new Error(`Unexpected typed array class: ${i}.`);r&&r instanceof ArrayBuffer?(this.data=r,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+s+a,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+o+s+a),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+s+a,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+n]),new Uint16Array(this.data,2,1)[0]=e,new Uint32Array(this.data,4,1)[0]=t)}add(t,e){const i=this._pos>>1;return this.ids[i]=i,this.coords[this._pos++]=t,this.coords[this._pos++]=e,i}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return _A(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,e,i,r){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:n,coords:o,nodeSize:s}=this,a=[0,n.length-1,0],l=[];for(;a.length;){const c=a.pop()||0,u=a.pop()||0,h=a.pop()||0;if(u-h<=s){for(let s=h;s<=u;s++){const a=o[2*s],c=o[2*s+1];a>=t&&a<=i&&c>=e&&c<=r&&l.push(n[s])}continue}const d=h+u>>1,p=o[2*d],f=o[2*d+1];p>=t&&p<=i&&f>=e&&f<=r&&l.push(n[d]),(0===c?t<=p:e<=f)&&(a.push(h),a.push(d-1),a.push(1-c)),(0===c?i>=p:r>=f)&&(a.push(d+1),a.push(u),a.push(1-c))}return l}within(t,e,i){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:r,coords:n,nodeSize:o}=this,s=[0,r.length-1,0],a=[],l=i*i;for(;s.length;){const c=s.pop()||0,u=s.pop()||0,h=s.pop()||0;if(u-h<=o){for(let i=h;i<=u;i++)bA(n[2*i],n[2*i+1],t,e)<=l&&a.push(r[i]);continue}const d=h+u>>1,p=n[2*d],f=n[2*d+1];bA(p,f,t,e)<=l&&a.push(r[d]),(0===c?t-i<=p:e-i<=f)&&(s.push(h),s.push(d-1),s.push(1-c)),(0===c?t+i>=p:e+i>=f)&&(s.push(d+1),s.push(u),s.push(1-c))}return a}}function _A(t,e,i,r,n,o){if(n-r<=i)return;const s=r+n>>1;yA(t,e,s,r,n,o),_A(t,e,i,r,s-1,1-o),_A(t,e,i,s+1,n,1-o)}function yA(t,e,i,r,n,o){for(;n>r;){if(n-r>600){const s=n-r+1,a=i-r+1,l=Math.log(s),c=.5*Math.exp(2*l/3),u=.5*Math.sqrt(l*c*(s-c)/s)*(a-s/2<0?-1:1);yA(t,e,i,Math.max(r,Math.floor(i-a*c/s+u)),Math.min(n,Math.floor(i+(s-a)*c/s+u)),o)}const s=e[2*i+o];let a=r,l=n;for(vA(t,e,r,i),e[2*n+o]>s&&vA(t,e,r,n);a<l;){for(vA(t,e,a,l),a++,l--;e[2*a+o]<s;)a++;for(;e[2*l+o]>s;)l--}e[2*r+o]===s?vA(t,e,r,l):(l++,vA(t,e,l,n)),l<=i&&(r=l+1),i<=l&&(n=l-1)}}function vA(t,e,i,r){xA(t,i,r),xA(e,2*i,2*r),xA(e,2*i+1,2*r+1)}function xA(t,e,i){const r=t[e];t[e]=t[i],t[i]=r}function bA(t,e,i,r){const n=t-i,o=e-r;return n*n+o*o}t.ARRAY_TYPE=ua,t.AUTH_ERR_MSG=_t,t.Aabb=nl,t.Actor=class{constructor(t,i,r){this.target=t,this.parent=i,this.mapId=r,this.callbacks={},this.cancelCallbacks={},U(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=Z()?t:e,this.scheduler=new vf}send(t,e,i,r,n=!1,o){const s=Math.round(1e18*Math.random()).toString(36).substring(0,10);i&&(i.metadata=o,this.callbacks[s]=i);const a=W(this.globalScope)?void 0:[];return this.target.postMessage({id:s,type:t,hasCallback:!!i,targetMapId:r,mustQueue:n,sourceMapId:this.mapId,data:Jn(e,a)},a),{cancel:()=>{i&&delete this.callbacks[s],this.target.postMessage({id:s,type:"<cancel>",targetMapId:r,sourceMapId:this.mapId})}}}receive(t){const e=t.data,i=e.id;if(i&&(!e.targetMapId||this.mapId===e.targetMapId))if("<cancel>"===e.type){const t=this.cancelCallbacks[i];delete this.cancelCallbacks[i],t&&t.cancel()}else if(e.mustQueue||Z()){const t=this.callbacks[i];this.cancelCallbacks[i]=this.scheduler.add((()=>this.processTask(i,e)),t&&t.metadata||{type:"message"})}else this.processTask(i,e)}processTask(t,e){if("<response>"===e.type){const i=this.callbacks[t];delete this.callbacks[t],i&&(e.error?i(Yn(e.error)):i(null,Yn(e.data)))}else{const i=W(this.globalScope)?void 0:[],r=e.hasCallback?(e,r)=>{delete this.cancelCallbacks[t],this.target.postMessage({id:t,type:"<response>",sourceMapId:this.mapId,error:e?Jn(e):null,data:Jn(r,i)},i)}:t=>{},n=Yn(e.data);if(this.parent[e.type])this.parent[e.type](e.sourceMapId,n,r);else if(this.parent.getWorkerSource){const t=e.type.split(".");this.parent.getWorkerSource(e.sourceMapId,t[0],n.source)[t[1]](n,r)}else r(new Error(`Could not find function ${e.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},t.CanonicalTileID=dh,t.Color=ke,t.ColorMode=Xf,t.CullFaceMode=tA,t.DEMData=$f,t.DataConstantProperty=ko,t.DedupedRequest=fA,t.DepthMode=qf,t.EXTENT=aa,t.Elevation=class{isDataAvailableAtPoint(t){const e=this._source();if(this.isUsingMockSource()||!e||t.y<0||t.y>1)return!1;const i=e.getSource().maxzoom,r=1<<i,n=Math.floor(t.x),o=Math.floor((t.x-n)*r),s=Math.floor(t.y*r),a=this.findDEMTileFor(new fh(i,n,i,o,s));return!(!a||!a.dem)}getAtPointOrZero(t,e=0){return this.getAtPoint(t,e)||0}getAtPoint(t,e,i=!0){if(this.isUsingMockSource())return null;null==e&&(e=null);const r=this._source();if(!r)return e;if(t.y<0||t.y>1)return e;const n=r.getSource().maxzoom,o=1<<n,s=Math.floor(t.x),a=t.x-s,l=new fh(n,s,n,Math.floor(a*o),Math.floor(t.y*o)),c=this.findDEMTileFor(l);if(!c||!c.dem)return e;const u=c.dem,h=1<<c.tileID.canonical.z,d=(a*h-c.tileID.canonical.x)*u.dim,p=(t.y*h-c.tileID.canonical.y)*u.dim,f=Math.floor(d),A=Math.floor(p);return(i?this.exaggeration():1)*ki(ki(u.get(f,A),u.get(f,A+1),p-A),ki(u.get(f+1,A),u.get(f+1,A+1),p-A),d-f)}getAtTileOffset(t,e,i){const r=1<<t.canonical.z;return this.getAtPointOrZero(new Jl(t.wrap+(t.canonical.x+e/aa)/r,(t.canonical.y+i/aa)/r))}getAtTileOffsetFunc(t,e,i,r){return n=>{const o=this.getAtTileOffset(t,n.x,n.y),s=r.upVector(t.canonical,n.x,n.y);return Pa(s,s,o*r.upVectorScale(t.canonical,e,i).metersToTile),s}}getForTilePoints(t,e,i,r){if(this.isUsingMockSource())return!1;const n=oA.create(this,t,r);return!!n&&(e.forEach((t=>{t[2]=this.exaggeration()*n.getElevationAt(t[0],t[1],i)})),!0)}getMinMaxForTile(t){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(t);if(!e||!e.dem)return null;const i=e.dem.tree,r=e.tileID,n=1<<t.canonical.z-r.canonical.z;let o=t.canonical.x/n-r.canonical.x,s=t.canonical.y/n-r.canonical.y,a=0;for(let e=0;e<t.canonical.z-r.canonical.z&&!i.leaves[a];e++){o*=2,s*=2;const t=2*Math.floor(s)+Math.floor(o);a=i.childOffsets[a]+t,o%=1,s%=1}return{min:this.exaggeration()*i.minimums[a],max:this.exaggeration()*i.maximums[a]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(t,e,i){throw new Error("Pure virtual method called.")}pointCoordinate(t){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(t){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},t.ErrorEvent=Jt,t.EvaluationParameters=bo,t.Event=Xt,t.Evented=Yt,t.FillExtrusionBucket=th,t.Frustum=rl,t.FrustumCorners=il,t.GLOBE_RADIUS=al,t.GLOBE_SCALE_MATCH_LATITUDE=45,t.GLOBE_ZOOM_THRESHOLD_MAX=sl,t.GLOBE_ZOOM_THRESHOLD_MIN=ol,t.GlobeSharedBuffers=class{constructor(t){this._createGrid(t),this._createPoles(t)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const t of this._poleSegments)t.destroy();for(const t of this._gridSegments)t.withSkirts.destroy(),t.withoutSkirts.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const t of this._wireframeSegments)t.destroy()}}_fillGridMeshWithLods(t,e){const i=new Qo,r=new rs,n=[],o=t+1+2,s=e[0]+1,a=e[0]+1+(1+e.length),l=(t,e,i)=>{let r=t===o-1?t-2:0===t?t:t-1;return r+=i?24575:0,[r,e]};for(let t=0;t<o;++t)i.emplaceBack(...l(t,0,!0));for(let t=0;t<s;++t)for(let e=0;e<o;++e)i.emplaceBack(...l(e,t,(0===e||e===o-1)&&!0));for(let t=0;t<e.length;++t){const r=e[t];for(let t=0;t<o;++t)i.emplaceBack(...l(t,r,!0))}for(let t=0;t<e.length;++t){const s=r.length,l=e[t]+1+2,c=new rs;for(let i=0;i<l-1;i++){const n=i===l-2,s=n?o*(a-e.length+t-i):o;for(let t=0;t<o-1;t++){const e=i*o+t;0===i||n||0===t||t===o-2?(c.emplaceBack(e+1,e,e+s),c.emplaceBack(e+s,e+s+1,e+1)):(r.emplaceBack(e+1,e,e+s),r.emplaceBack(e+s,e+s+1,e+1))}}const u=sa.simpleSegment(0,s,i.length,r.length-s);for(let t=0;t<c.uint16.length;t+=3)r.emplaceBack(c.uint16[t],c.uint16[t+1],c.uint16[t+2]);const h=sa.simpleSegment(0,s,i.length,r.length-s);n.push({withoutSkirts:u,withSkirts:h})}return{vertices:i,indices:r,segments:n}}_createGrid(t){const e=this._fillGridMeshWithLods(cl,ul);this._gridSegments=e.segments,this._gridBuffer=t.createVertexBuffer(e.vertices,tl.members),this._gridIndexBuffer=t.createIndexBuffer(e.indices,!0)}_createPoles(t){const e=new rs;for(let t=0;t<=cl;t++)e.emplaceBack(0,t+1,t+2);this._poleIndexBuffer=t.createIndexBuffer(e,!0);const i=new as,r=new as;this._poleSegments=[];for(let t=0,e=0;t<ol;t++){const n=360/(1<<t);i.emplaceBack(0,-al,0,.5,0),r.emplaceBack(0,-al,0,.5,1);for(let t=0;t<=cl;t++){const e=t/cl,o=ki(0,n,e),[s,a,l]=Bl(Rl,Ul,o,al);i.emplaceBack(s,a,l,e,0),r.emplaceBack(s,a,l,e,1)}this._poleSegments.push(sa.simpleSegment(e,0,66,64)),e+=66}this._poleNorthVertexBuffer=t.createVertexBuffer(i,Ja,!1),this._poleSouthVertexBuffer=t.createVertexBuffer(r,Ja,!1)}getGridBuffers(t,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[t].withSkirts:this._gridSegments[t].withoutSkirts]}getPoleBuffers(t){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[t]]}getWirefameBuffers(t,e){if(!this._wireframeSegments){const e=new cs,i=cl,r=i+1+2,n=1;this._wireframeSegments=[];for(let t=0,o=0;t<ul.length;t++){const s=ul[t];for(let t=n;t<s+n;t++)for(let o=n;o<i+n;o++){const i=t*r+o;e.emplaceBack(i,i+1),e.emplaceBack(i,i+r),e.emplaceBack(i,i+r+1)}const a=s*i*3;this._wireframeSegments.push(sa.simpleSegment(0,o,(s+1)*r,a)),o+=a}this._wireframeIndexBuffer=t.createIndexBuffer(e)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[e]]}},t.GlyphManager=ip,t.ImagePosition=Td,t.KDBush=gA,t.LivePerformanceUtils=Nt,t.LngLat=Vl,t.LngLatBounds=la,t.LocalGlyphMode=ep,t.MAX_MERCATOR_LATITUDE=Wl,t.MercatorCoordinate=Jl,t.ONE_EM=Uh,t.OverscaledTileID=fh,t.PerformanceMarkers=Ot,t.Point=_,t.Properties=zo,t.RGBAImage=Oc,t.Ray=el,t.RequestManager=class{constructor(t,e,i){this._transformRequestFn=t,this._customAccessToken=e,this._silenceAuthErrors=!!i,this._createSkuToken()}_createSkuToken(){const t=function(){let t="";for(let e=0;e<10;e++)t+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",h,t].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,e){return this._transformRequestFn&&this._transformRequestFn(t,e)||{url:t}}normalizeStyleURL(t,e){if(!yt(t))return t;const i=Bt(t);return i.path=`/styles/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||e)}normalizeGlyphsURL(t,e){if(!yt(t))return t;const i=Bt(t);return i.path=`/fonts/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||e)}normalizeSourceURL(t,e,i,r){if(!yt(t))return t;const n=Bt(t);return n.path=`/v4/${n.authority}.json`,n.params.push("secure"),i&&n.params.push(`language=${i}`),r&&n.params.push(`worldview=${r}`),this._makeAPIURL(n,this._customAccessToken||e)}normalizeSpriteURL(t,e,i,r){const n=Bt(t);return yt(t)?(n.path=`/styles/v1${n.path}/sprite${e}${i}`,this._makeAPIURL(n,this._customAccessToken||r)):(n.path+=`${e}${i}`,Et(n))}normalizeTileURL(t,e,i){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!yt(t))return t;const r=Bt(t);r.path=r.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||i&&"raster"!==r.authority&&512===i?"@2x":""}${o.supported?".webp":"$1"}`),"raster"===r.authority?r.path=`/${n.RASTER_URL_PREFIX}${r.path}`:(r.path=r.path.replace(/^.+\/v4\//,"/"),r.path=`/${n.TILE_URL_VERSION}${r.path}`);const s=this._customAccessToken||function(t){for(const e of t){const t=e.match(/^access_token=(.*)$/);if(t)return t[1]}return null}(r.params)||n.ACCESS_TOKEN;return n.REQUIRE_ACCESS_TOKEN&&s&&this._skuToken&&r.params.push(`sku=${this._skuToken}`),this._makeAPIURL(r,s)}canonicalizeTileURL(t,e){const i=Bt(t);if(!i.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!i.path.match(/\.[\w]+$/))return t;let r="mapbox://";i.path.match(/^\/raster\/v1\//)?r+=`raster/${i.path.replace(`/${n.RASTER_URL_PREFIX}/`,"")}`:r+=`tiles/${i.path.replace(`/${n.TILE_URL_VERSION}/`,"")}`;let o=i.params;return e&&(o=o.filter((t=>!t.match(/^access_token=/)))),o.length&&(r+=`?${o.join("&")}`),r}canonicalizeTileset(t,e){const i=!!e&&yt(e),r=[];for(const e of t.tiles||[])vt(e)?r.push(this.canonicalizeTileURL(e,i)):r.push(e);return r}_makeAPIURL(t,e){const i="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",r=Bt(n.API_URL);if(t.protocol=r.protocol,t.authority=r.authority,"http"===t.protocol){const e=t.params.indexOf("secure");e>=0&&t.params.splice(e,1)}if("/"!==r.path&&(t.path=`${r.path}${t.path}`),!n.REQUIRE_ACCESS_TOKEN)return Et(t);if(e=e||n.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${i}`);if("s"===e[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${i}`)}return t.params=t.params.filter((t=>-1===t.indexOf("access_token"))),t.params.push(`access_token=${e||""}`),Et(t)}},t.ResourceType=lt,t.SegmentVector=sa,t.SourceCache=eA,t.StencilMode=Wf,t.StructArrayLayout1ui2=us,t.StructArrayLayout2f1f2i16=ts,t.StructArrayLayout2i4=Qo,t.StructArrayLayout2ui4=cs,t.StructArrayLayout3f12=is,t.StructArrayLayout3ui6=rs,t.StructArrayLayout4i8=jo,t.StructArrayLayout5f20=as,t.Texture=_f,t.Tile=Lf,t.Transitionable=Bo,t.Uniform1f=Rs,t.Uniform1i=class extends Ds{constructor(t){super(t),this.current=0}set(t,e,i){this.fetchUniformLocation(t,e)&&this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},t.Uniform2f=class extends Ds{constructor(t){super(t),this.current=[0,0]}set(t,e,i){this.fetchUniformLocation(t,e)&&(i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1])))}},t.Uniform3f=class extends Ds{constructor(t){super(t),this.current=[0,0,0]}set(t,e,i){this.fetchUniformLocation(t,e)&&(i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2])))}},t.Uniform4f=Us,t.UniformColor=Os,t.UniformMatrix2f=class extends Ds{constructor(t){super(t),this.current=Vs}set(t,e,i){if(this.fetchUniformLocation(t,e))for(let t=0;t<4;t++)if(i[t]!==this.current[t]){this.current=i,this.gl.uniformMatrix2fv(this.location,!1,i);break}}},t.UniformMatrix3f=class extends Ds{constructor(t){super(t),this.current=Qs}set(t,e,i){if(this.fetchUniformLocation(t,e))for(let t=0;t<9;t++)if(i[t]!==this.current[t]){this.current=i,this.gl.uniformMatrix3fv(this.location,!1,i);break}}},t.UniformMatrix4f=class extends Ds{constructor(t){super(t),this.current=Ns}set(t,e,i){if(this.fetchUniformLocation(t,e)){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let t=1;t<16;t++)if(i[t]!==this.current[t]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}}},t.UnwrappedTileID=ph,t.ValidationError=en,t.VectorTileFeature=Zu,t.VectorTileWorkerSource=class extends Yt{constructor(t,e,i,r,n){super(),this.actor=t,this.layerIndex=e,this.availableImages=i,this.loadVectorData=n||AA,this.loading={},this.loaded={},this.deduped=new fA(t.scheduler),this.isSpriteLoaded=r,this.scheduler=t.scheduler}loadTile(t,e){const i=t.uid,r=t&&t.request,n=r&&r.collectResourceTiming,o=this.loading[i]=new dA(t);o.abort=this.loadVectorData(t,((s,a)=>{const l=!this.loading[i];if(delete this.loading[i],l||s||!a)return o.status="done",l||(this.loaded[i]=o),e(s);const c=a.rawData,u={};a.expires&&(u.expires=a.expires),a.cacheControl&&(u.cacheControl=a.cacheControl),o.vectorTile=a.vectorTile||new $u(new md(c));const h=()=>{o.parse(o.vectorTile,this.layerIndex,this.availableImages,this.actor,((t,i)=>{if(t||!i)return e(t);const o={};if(n){const t=jt(r);t.length>0&&(o.resourceTiming=JSON.parse(JSON.stringify(t)))}e(null,P({rawTileData:c.slice(0)},i,u,o))}))};this.isSpriteLoaded?h():this.once("isSpriteLoaded",(()=>{this.scheduler?this.scheduler.add(h,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom}):h()})),this.loaded=this.loaded||{},this.loaded[i]=o}))}reloadTile(t,e){const i=this.loaded,r=t.uid,n=this;if(i&&i[r]){const o=i[r];o.showCollisionBoxes=t.showCollisionBoxes,o.enableTerrain=!!t.enableTerrain,o.projection=t.projection,o.tileTransform=Mp(t.tileID.canonical,t.projection);const s=(t,i)=>{const r=o.reloadCallback;r&&(delete o.reloadCallback,o.parse(o.vectorTile,n.layerIndex,this.availableImages,n.actor,r)),e(t,i)};"parsing"===o.status?o.reloadCallback=s:"done"===o.status&&(o.vectorTile?o.parse(o.vectorTile,this.layerIndex,this.availableImages,this.actor,s):s())}}abortTile(t,e){const i=t.uid,r=this.loading[i];r&&(r.abort&&r.abort(),delete this.loading[i]),e()}removeTile(t,e){const i=this.loaded,r=t.uid;i&&i[r]&&delete i[r],e()}},t.WritingMode=Ed,t.ZoomDependentExpression=Xr,t.add=Ca,t.addDynamicAttributes=rf,t.adjoint=function(t,e){var i=e[0],r=e[1],n=e[2],o=e[3],s=e[4],a=e[5],l=e[6],c=e[7],u=e[8];return t[0]=s*u-a*c,t[1]=n*c-r*u,t[2]=r*a-n*s,t[3]=a*l-o*u,t[4]=i*u-n*l,t[5]=n*o-i*a,t[6]=o*c-s*l,t[7]=r*l-i*c,t[8]=i*s-r*o,t},t.asyncAll=M,t.bezier=B,t.bindAll=U,t.boundsAttributes=kf,t.bufferConvexPolygon=function(t,e){const i=[];for(let r=0;r<t.length;r++){const n=I(r-1,-1,t.length-1),o=I(r+1,-1,t.length-1),s=t[r],a=t[o],l=t[n].sub(s).unit(),c=a.sub(s).unit(),u=c.angleWithSep(l.x,l.y),h=l.add(c).unit().mult(-1*e/Math.sin(u/2));i.push(s.add(h))}return i},t.cacheEntryPossiblyAdded=function(t){at++,at>rt&&(t.getActor().send("enforceCacheSizeLimit",it),at=0)},t.calculateGlobeLabelMatrix=function(t,e){const{x:i,y:r}=t.point,n=Pl(i,r,t.worldSize/t._pixelsPerMercatorPixel,0,0);return Aa(n,n,kl(_l(e)))},t.calculateGlobeMatrix=function(t){const{x:e,y:i}=t.point,{lng:r,lat:n}=t._center;return Pl(e,i,t.worldSize,r,n)},t.calculateGlobeMercatorMatrix=function(t){const e=t.pixelsPerMeter,i=e/$l(1,t.center.lat),r=pa(new Float64Array(16));return ma(r,r,[t.point.x,t.point.y,0]),ga(r,r,[i,i,e]),Float32Array.from(r)},t.circumferenceAtLatitude=jl,t.clamp=C,t.clearTileCache=function(t){if(!nt())return;const i=e.caches.delete(Y);t&&i.catch(t).then((()=>t()))},t.clipLine=Wd,t.clone=function(t){var e=new ua(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},t.clone$1=V,t.collisionCircleLayout=Rh,t.config=n,t.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},t.create=function(){var t=new ua(16);return ua!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},t.create$1=ha,t.createExpression=Kr,t.createLayout=Oo,t.createStyleLayer=function(t){return"custom"===t.type?new ff(t):new gf[t.type](t)},t.cross=Da,t.degToRad=x,t.distance=function(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2])},t.div=function(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t},t.dot=Fa,t.earthRadius=Ol,t.ease=E,t.easeCubicInOut=T,t.ecefToLatLng=function([t,e,i]){const r=Math.hypot(t,e,i),n=Math.atan2(t,i),o=.5*Math.PI-Math.acos(-e/r);return new Vl(b(n),b(o))},t.emitValidationErrors=jn,t.endsWith=O,t.enforceCacheSizeLimit=function(t){ot(),tt&&tt.then((e=>{e.keys().then((i=>{for(let r=0;r<i.length-t;r++)e.delete(i[r])}))}))},t.evaluateSizeForFeature=Qh,t.evaluateSizeForZoom=Vh,t.evaluateVariableOffset=_p,t.evented=_o,t.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},t.exactEquals$1=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},t.exported=qt,t.exported$1=o,t.extend=P,t.extend$1=ee,t.fillExtrusionHeightLift=ah,t.filterObject=Q,t.fromMat4=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},t.fromQuat=function(t,e){var i=e[0],r=e[1],n=e[2],o=e[3],s=i+i,a=r+r,l=n+n,c=i*s,u=r*s,h=r*a,d=n*s,p=n*a,f=n*l,A=o*s,m=o*a,g=o*l;return t[0]=1-h-f,t[1]=u+g,t[2]=d-m,t[3]=0,t[4]=u-g,t[5]=1-c-f,t[6]=p+A,t[7]=0,t[8]=d+m,t[9]=p-A,t[10]=1-c-h,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},t.fromRotation=function(t,e){var i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=i,t[2]=0,t[3]=-i,t[4]=r,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},t.fromScaling=va,t.furthestTileCorner=function(t){const e=Math.round((t+45+360)%360/90)%4;return w[e]},t.getAABBPointSquareDist=function(t,e,i){let r=0;for(let n=0;n<2;++n){const o=i?i[n]:0;t[n]>o&&(r+=(t[n]-o)*(t[n]-o)),e[n]<o&&(r+=(o-e[n])*(o-e[n]))}return r},t.getAnchorAlignment=Ud,t.getAnchorJustification=vp,t.getBounds=function(t){let e=1/0,i=1/0,r=-1/0,n=-1/0;for(const o of t)e=Math.min(e,o.x),i=Math.min(i,o.y),r=Math.max(r,o.x),n=Math.max(n,o.y);return{min:new _(e,i),max:new _(r,n)}},t.getColumn=J,t.getDefaultExportFromCjs=d,t.getGridMatrix=function(t,e,i,r){const n=e.getNorth(),o=e.getSouth(),s=e.getWest(),a=e.getEast(),l=1<<t.z,c=a-s,u=n-o,h=c/cl,d=-u/ul[i],p=[0,h,0,d,0,0,n,s,0];if(t.z>0){const t=180/r;da(p,p,[t/c+1,0,0,0,t/u+1,0,-.5*t/h,.5*t/d,1])}return p[2]=l,p[5]=t.x,p[8]=t.y,p},t.getImage=gt,t.getJSON=function(t,e){return ht(P(t,{type:"json"}),e)},t.getLatitudinalLod=function(t){const e=Wl-5;t=C(t,-e,e)/e*90;const i=Math.pow(Math.abs(Math.sin(x(t))),3);return Math.round(i*(ul.length-1))},t.getMapSessionAPI=Rt,t.getPerformanceMeasurement=jt,t.getProjection=Xp,t.getRTLTextPluginStatus=yo,t.getReferrer=ut,t.getTilePoint=function(t,{x:e,y:i},r=0){return new _(((e-r)*t.scale-t.x)*aa,(i*t.scale-t.y)*aa)},t.getTileVec3=function(t,e,i=0){return Ea(((e.x-i)*t.scale-t.x)*aa,(e.y*t.scale-t.y)*aa,Kl(e.z,e.y))},t.getVideo=function(t,i){const r=e.document.createElement("video");r.muted=!0,r.onloadstart=function(){i(null,r)};for(let i=0;i<t.length;i++){const n=e.document.createElement("source");pt(t[i])||(r.crossOrigin="Anonymous"),n.src=t[i],r.appendChild(n)}return{cancel:()=>{}}},t.globeCenterToScreenPoint=function(t){const e=[0,0,0],i=pa(new Float64Array(16));return Aa(i,t.pixelMatrix,t.globeMatrix),Ra(e,e,i),new _(e[0],e[1])},t.globeDenormalizeECEF=kl,t.globeECEFOrigin=function(t,e){const i=[0,0,0];return Ra(i,i,Ml(_l(e.canonical))),Ra(i,i,t),i},t.globeMetersToEcef=fl,t.globeNormalizeECEF=Ml,t.globePixelsToTileUnits=function(t,e){return aa/(512*Math.pow(2,t))*Sl(_l(e))},t.globePoleMatrixForTile=function(t,e,i){const r=pa(new Float64Array(16)),n=(e/(1<<t)-.5)*Math.PI*2;return ya(r,i.globeMatrix,n),Float32Array.from(r)},t.globeTileBounds=_l,t.globeTiltAtLngLat=zl,t.globeToMercatorTransition=Ll,t.globeUseCustomAntiAliasing=function(t,e,i){const r=Ll(i.zoom),n=t.style.map._antialias,o=!!e.extStandardDerivatives,s=e.extStandardDerivativesForceOff||t.terrain&&t.terrain.exaggeration()>0;return 0===r&&!n&&!s&&o},t.identity=pa,t.identity$1=Za,t.invert=fa,t.isFullscreen=function(){return!!e.document.fullscreenElement||!!e.document.webkitFullscreenElement},t.isLngLatBehindGlobe=Fl,t.isMapAuthenticated=function(t){return Ut.has(t)},t.isMapboxURL=yt,t.isSafariWithAntialiasingBug=function(t){const e=t.navigator?t.navigator.userAgent:null;return!!W(t)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},t.latFromMercatorY=ql,t.latLngToECEF=El,t.len=Va,t.length=Ba,t.length$1=function(t){return Math.hypot(t[0],t[1],t[2],t[3])},t.lngFromMercatorX=Zl,t.loadVectorTile=AA,t.makeRequest=ht,t.mapValue=function(t,e,i,r,n){return C((t-e)/(i-e)*(n-r)+r,r,n)},t.mercatorScale=Xl,t.mercatorXfromLng=Hl,t.mercatorYfromLat=Gl,t.mercatorZfromAltitude=$l,t.mul=ba,t.mul$1=Qa,t.multiply=Aa,t.multiply$1=da,t.multiply$2=Ia,t.nextPowerOfTwo=D,t.normalize=za,t.normalize$1=Wa,t.normalize$2=Ha,t.number=ki,t.ortho=function(t,e,i,r,n,o,s){var a=1/(e-i),l=1/(r-n),c=1/(o-s);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(e+i)*a,t[13]=(n+r)*l,t[14]=(s+o)*c,t[15]=1,t},t.pbf=qh,t.perspective=function(t,e,i,r,n){var o,s=1/Math.tan(e/2);return t[0]=s/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=n&&n!==1/0?(t[10]=(n+r)*(o=1/(r-n)),t[14]=2*n*r*o):(t[10]=-1,t[14]=-2*r),t},t.pick=function(t,e){const i={};for(let r=0;r<e.length;r++){const n=e[r];n in t&&(i[n]=t[n])}return i},t.plugin=xo,t.pointGeometry=m,t.polesInViewport=function(t){const e=pa(new Float64Array(16));Aa(e,t.pixelMatrix,t.globeMatrix);const i=[0,hl,0],r=[0,dl,0];return Ra(i,i,e),Ra(r,r,e),[i[0]>0&&i[0]<=t.width&&i[1]>0&&i[1]<=t.height&&!Fl(t,new Vl(t.center.lat,90)),r[0]>0&&r[0]<=t.width&&r[1]>0&&r[1]<=t.height&&!Fl(t,new Vl(t.center.lat,-90))]},t.polygonContainsPoint=vc,t.polygonIntersectsBox=xc,t.polygonIntersectsPolygon=hc,t.polygonizeBounds=function(t,e,i=0,r=!0){const n=new _(i,i),o=t.sub(n),s=e.add(n),a=[o,new _(s.x,o.y),s,new _(o.x,s.y)];return r&&a.push(o.clone()),a},t.posAttributes=tl,t.postMapLoadEvent=Lt,t.postPerformanceEvent=Ft,t.postTurnstileEvent=kt,t.potpack=bd,t.prevPowerOfTwo=function(t){return t<=1?1:Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},t.radToDeg=b,t.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],t.registerForPluginStateChange=function(t){return t({pluginStatus:fo,pluginURL:Ao}),_o.on("pluginStateChange",t),t},t.removeAuthState=function(t){Ut.delete(t)},t.renderColorRamp=Qc,t.resample=tc,t.rotateX=_a,t.rotateX$1=qa,t.rotateY=ya,t.rotateY$1=Ka,t.rotateZ=function(t,e,i){var r=Math.sin(i),n=Math.cos(i),o=e[0],s=e[1],a=e[2],l=e[3],c=e[4],u=e[5],h=e[6],d=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*n+c*r,t[1]=s*n+u*r,t[2]=a*n+h*r,t[3]=l*n+d*r,t[4]=c*n-o*r,t[5]=u*n-s*r,t[6]=h*n-a*r,t[7]=d*n-l*r,t},t.rotateZ$1=function(t,e,i){i*=.5;var r=e[0],n=e[1],o=e[2],s=e[3],a=Math.sin(i),l=Math.cos(i);return t[0]=r*l+n*a,t[1]=n*l-r*a,t[2]=o*l+s*a,t[3]=s*l-o*a,t},t.scale=ga,t.scale$1=ja,t.scale$2=Pa,t.scaleAndAdd=La,t.set=function(t,e,i,r){return t[0]=e,t[1]=i,t[2]=r,t},t.setCacheLimits=function(t,e){it=t,rt=e},t.setColumn=function(t,e,i){t[4*e+0]=i[0],t[4*e+1]=i[1],t[4*e+2]=i[2],t[4*e+3]=i[3]},t.setRTLTextPlugin=function(t,e,i=!1){if(fo===co||fo===uo||fo===ho)throw new Error("setRTLTextPlugin cannot be called multiple times.");Ao=qt.resolveURL(t),fo=co,po=e,go(),i||vo()},t.smoothstep=S,t.spec=te,t.squaredLength=function(t){var e=t[0],i=t[1],r=t[2];return e*e+i*i+r*r},t.storeAuthState=function(t,e){e?Ut.add(t):Ut.delete(t)},t.sub=Na,t.subtract=Sa,t.symbolSize=jh,t.tileAABB=function(t,e,i,r,n,o,s,a,l){if("globe"===l.name)return bl(t,e,new dh(i,r,n));const c=Mp({z:i,x:r,y:n},l);return new nl([(o+c.x/c.scale)*e,e*(c.y/c.scale),s],[(o+c.x2/c.scale)*e,e*(c.y2/c.scale),a])},t.tileCornersToBounds=wl,t.tileTransform=Mp,t.transformMat3=function(t,e,i){var r=e[0],n=e[1],o=e[2];return t[0]=r*i[0]+n*i[3]+o*i[6],t[1]=r*i[1]+n*i[4]+o*i[7],t[2]=r*i[2]+n*i[5]+o*i[8],t},t.transformMat4=Ra,t.transformMat4$1=Ga,t.transformQuat=Ua,t.transitionTileAABBinECEF=vl,t.translate=ma,t.transpose=function(t,e){if(t===e){var i=e[1],r=e[2],n=e[5];t[1]=e[3],t[2]=e[6],t[3]=i,t[5]=e[7],t[6]=r,t[7]=n}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},t.triggerPluginCompletionEvent=mo,t.uniqueId=z,t.updateGlobeVertexNormal=function(t,e,i,r,n){const o=5*e+2;t.float32[o+0]=i,t.float32[o+1]=r,t.float32[o+2]=n},t.validateCustomStyleLayer=function(t){const e=[],i=t.id;return void 0===i&&e.push({message:`layers.${i}: missing required property "id"`}),void 0===t.render&&e.push({message:`layers.${i}: missing required method "render"`}),t.renderingMode&&"2d"!==t.renderingMode&&"3d"!==t.renderingMode&&e.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),e},t.validateFilter=t=>Vn(wn(t)),t.validateFog=t=>Vn(Fn(t)),t.validateLayer=t=>Vn(Sn(t)),t.validateLight=t=>Vn(Ln(t)),t.validateSource=t=>Vn(kn(t)),t.validateStyle=On,t.validateTerrain=t=>Vn(zn(t)),t.values=k,t.vectorTile=zu,t.version=i,t.warnOnce=H,t.window=e,t.wrap=I})),r(["./shared"],(function(t){function e(t){if("number"==typeof t||"boolean"==typeof t||"string"==typeof t||null==t)return JSON.stringify(t);if(Array.isArray(t)){let i="[";for(const r of t)i+=`${e(r)},`;return`${i}]`}let i="{";for(const r of Object.keys(t).sort())i+=`${r}:${e(t[r])},`;return`${i}}`}function i(i){let r="";for(const n of t.refProperties)r+=`/${e(i[n])}`;return r}class r{constructor(t){this.keyCache={},t&&this.replace(t)}replace(t){this._layerConfigs={},this._layers={},this.update(t,[])}update(e,r){for(const i of e)this._layerConfigs[i.id]=i,(this._layers[i.id]=t.createStyleLayer(i)).compileFilter(),this.keyCache[i.id]&&delete this.keyCache[i.id];for(const t of r)delete this.keyCache[t],delete this._layerConfigs[t],delete this._layers[t];this.familiesBySource={};const n=function(t,e){const r={};for(let n=0;n<t.length;n++){const o=e&&e[t[n].id]||i(t[n]);e&&(e[t[n].id]=o);let s=r[o];s||(s=r[o]=[]),s.push(t[n])}const n=[];for(const t in r)n.push(r[t]);return n}(t.values(this._layerConfigs),this.keyCache);for(const t of n){const e=t.map((t=>this._layers[t.id])),i=e[0];if("none"===i.visibility)continue;const r=i.source||"";let n=this.familiesBySource[r];n||(n=this.familiesBySource[r]={});const o=i.sourceLayer||"_geojsonTileLayer";let s=n[o];s||(s=n[o]=[]),s.push(e)}}}class n{loadTile(e,i){const{uid:r,encoding:n,rawImageData:o,padding:s,buildQuadTree:a}=e,l=t.window.ImageBitmap&&o instanceof t.window.ImageBitmap?this.getImageData(o,s):o;i(null,new t.DEMData(r,l,n,s<1,a))}getImageData(t,e){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(t.width,t.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=t.width,this.offscreenCanvas.height=t.height,this.offscreenCanvasContext.drawImage(t,0,0,t.width,t.height);const i=this.offscreenCanvasContext.getImageData(-e,-e,t.width+2*e,t.height+2*e);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),i}}function o(t,e){if(0!==t.length){s(t[0],e);for(var i=1;i<t.length;i++)s(t[i],!e)}}function s(t,e){for(var i=0,r=0,n=0,o=t.length,s=o-1;n<o;s=n++){var a=(t[n][0]-t[s][0])*(t[s][1]+t[n][1]),l=i+a;r+=Math.abs(i)>=Math.abs(a)?i-l+a:a-l+i,i=l}i+r>=0!=!!e&&t.reverse()}var a=t.getDefaultExportFromCjs((function t(e,i){var r,n=e&&e.type;if("FeatureCollection"===n)for(r=0;r<e.features.length;r++)t(e.features[r],i);else if("GeometryCollection"===n)for(r=0;r<e.geometries.length;r++)t(e.geometries[r],i);else if("Feature"===n)t(e.geometry,i);else if("Polygon"===n)o(e.coordinates,i);else if("MultiPolygon"===n)for(r=0;r<e.coordinates.length;r++)o(e.coordinates[r],i);return e}));const l=t.VectorTileFeature.prototype.toGeoJSON;var c={exports:{}},u=t.pointGeometry,h=t.vectorTile.VectorTileFeature,d=p;function p(t,e){this.options=e||{},this.features=t,this.length=t.length}function f(t,e){this.id="number"==typeof t.id?t.id:void 0,this.type=t.type,this.rawGeometry=1===t.type?[t.geometry]:t.geometry,this.properties=t.tags,this.extent=e||4096}p.prototype.feature=function(t){return new f(this.features[t],this.options.extent)},f.prototype.loadGeometry=function(){var t=this.rawGeometry;this.geometry=[];for(var e=0;e<t.length;e++){for(var i=t[e],r=[],n=0;n<i.length;n++)r.push(new u(i[n][0],i[n][1]));this.geometry.push(r)}return this.geometry},f.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var t=this.geometry,e=1/0,i=-1/0,r=1/0,n=-1/0,o=0;o<t.length;o++)for(var s=t[o],a=0;a<s.length;a++){var l=s[a];e=Math.min(e,l.x),i=Math.max(i,l.x),r=Math.min(r,l.y),n=Math.max(n,l.y)}return[e,r,i,n]},f.prototype.toGeoJSON=h.prototype.toGeoJSON;var A=t.pbf,m=d;function g(t){var e=new A;return function(t,e){for(var i in t.layers)e.writeMessage(3,_,t.layers[i])}(t,e),e.finish()}function _(t,e){var i;e.writeVarintField(15,t.version||1),e.writeStringField(1,t.name||""),e.writeVarintField(5,t.extent||4096);var r={keys:[],values:[],keycache:{},valuecache:{}};for(i=0;i<t.length;i++)r.feature=t.feature(i),e.writeMessage(2,y,r);var n=r.keys;for(i=0;i<n.length;i++)e.writeStringField(3,n[i]);var o=r.values;for(i=0;i<o.length;i++)e.writeMessage(4,T,o[i])}function y(t,e){var i=t.feature;void 0!==i.id&&e.writeVarintField(1,i.id),e.writeMessage(2,v,t),e.writeVarintField(3,i.type),e.writeMessage(4,w,i)}function v(t,e){var i=t.feature,r=t.keys,n=t.values,o=t.keycache,s=t.valuecache;for(var a in i.properties){var l=i.properties[a],c=o[a];if(null!==l){void 0===c&&(r.push(a),o[a]=c=r.length-1),e.writeVarint(c);var u=typeof l;"string"!==u&&"boolean"!==u&&"number"!==u&&(l=JSON.stringify(l));var h=u+":"+l,d=s[h];void 0===d&&(n.push(l),s[h]=d=n.length-1),e.writeVarint(d)}}}function x(t,e){return(e<<3)+(7&t)}function b(t){return t<<1^t>>31}function w(t,e){for(var i=t.loadGeometry(),r=t.type,n=0,o=0,s=i.length,a=0;a<s;a++){var l=i[a],c=1;1===r&&(c=l.length),e.writeVarint(x(1,c));for(var u=3===r?l.length-1:l.length,h=0;h<u;h++){1===h&&1!==r&&e.writeVarint(x(2,u-1));var d=l[h].x-n,p=l[h].y-o;e.writeVarint(b(d)),e.writeVarint(b(p)),n+=d,o+=p}3===r&&e.writeVarint(x(7,1))}}function T(t,e){var i=typeof t;"string"===i?e.writeStringField(1,t):"boolean"===i?e.writeBooleanField(7,t):"number"===i&&(t%1!=0?e.writeDoubleField(3,t):t<0?e.writeSVarintField(6,t):e.writeVarintField(5,t))}c.exports=g,c.exports.fromVectorTileJs=g,c.exports.fromGeojsonVt=function(t,e){e=e||{};var i={};for(var r in t)i[r]=new m(t[r].features,e),i[r].name=r,i[r].version=e.version,i[r].extent=e.extent;return g({layers:i})},c.exports.GeoJSONWrapper=m;var B=t.getDefaultExportFromCjs(c.exports);const E={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:t=>t},C=Math.fround||(S=new Float32Array(1),t=>(S[0]=+t,S[0]));var S;const I=3,M=5,k=6;class P{constructor(t){this.options=Object.assign(Object.create(E),t),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(t){const{log:e,minZoom:i,maxZoom:r}=this.options;e&&console.time("total time");const n=`prepare ${t.length} points`;e&&console.time(n),this.points=t;const o=[];for(let e=0;e<t.length;e++){const i=t[e];if(!i.geometry)continue;const[r,n]=i.geometry.coordinates,s=C(F(r)),a=C(D(n));o.push(s,a,1/0,e,-1,1),this.options.reduce&&o.push(0)}let s=this.trees[r+1]=this._createTree(o);e&&console.timeEnd(n);for(let t=r;t>=i;t--){const i=+Date.now();s=this.trees[t]=this._createTree(this._cluster(s,t)),e&&console.log("z%d: %d clusters in %dms",t,s.numItems,+Date.now()-i)}return e&&console.timeEnd("total time"),this}getClusters(t,e){let i=((t[0]+180)%360+360)%360-180;const r=Math.max(-90,Math.min(90,t[1]));let n=180===t[2]?180:((t[2]+180)%360+360)%360-180;const o=Math.max(-90,Math.min(90,t[3]));if(t[2]-t[0]>=360)i=-180,n=180;else if(i>n){const t=this.getClusters([i,r,180,o],e),s=this.getClusters([-180,r,n,o],e);return t.concat(s)}const s=this.trees[this._limitZoom(e)],a=s.range(F(i),D(o),F(n),D(r)),l=s.data,c=[];for(const t of a){const e=this.stride*t;c.push(l[e+M]>1?L(l,e,this.clusterProps):this.points[l[e+I]])}return c}getChildren(t){const e=this._getOriginId(t),i=this._getOriginZoom(t),r="No cluster with the specified id.",n=this.trees[i];if(!n)throw new Error(r);const o=n.data;if(e*this.stride>=o.length)throw new Error(r);const s=this.options.radius/(this.options.extent*Math.pow(2,i-1)),a=n.within(o[e*this.stride],o[e*this.stride+1],s),l=[];for(const e of a){const i=e*this.stride;o[i+4]===t&&l.push(o[i+M]>1?L(o,i,this.clusterProps):this.points[o[i+I]])}if(0===l.length)throw new Error(r);return l}getLeaves(t,e,i){const r=[];return this._appendLeaves(r,t,e=e||10,i=i||0,0),r}getTile(t,e,i){const r=this.trees[this._limitZoom(t)],n=Math.pow(2,t),{extent:o,radius:s}=this.options,a=s/o,l=(i-a)/n,c=(i+1+a)/n,u={features:[]};return this._addTileFeatures(r.range((e-a)/n,l,(e+1+a)/n,c),r.data,e,i,n,u),0===e&&this._addTileFeatures(r.range(1-a/n,l,1,c),r.data,n,i,n,u),e===n-1&&this._addTileFeatures(r.range(0,l,a/n,c),r.data,-1,i,n,u),u.features.length?u:null}getClusterExpansionZoom(t){let e=this._getOriginZoom(t)-1;for(;e<=this.options.maxZoom;){const i=this.getChildren(t);if(e++,1!==i.length)break;t=i[0].properties.cluster_id}return e}_appendLeaves(t,e,i,r,n){const o=this.getChildren(e);for(const e of o){const o=e.properties;if(o&&o.cluster?n+o.point_count<=r?n+=o.point_count:n=this._appendLeaves(t,o.cluster_id,i,r,n):n<r?n++:t.push(e),t.length===i)break}return n}_createTree(e){const i=new t.KDBush(e.length/this.stride|0,this.options.nodeSize,Float32Array);for(let t=0;t<e.length;t+=this.stride)i.add(e[t],e[t+1]);return i.finish(),i.data=e,i}_addTileFeatures(t,e,i,r,n,o){for(const s of t){const t=s*this.stride,a=e[t+M]>1;let l,c,u;if(a)l=z(e,t,this.clusterProps),c=e[t],u=e[t+1];else{const i=this.points[e[t+I]];l=i.properties;const[r,n]=i.geometry.coordinates;c=F(r),u=D(n)}const h={type:1,geometry:[[Math.round(this.options.extent*(c*n-i)),Math.round(this.options.extent*(u*n-r))]],tags:l};let d;d=a||this.options.generateId?e[t+I]:this.points[e[t+I]].id,void 0!==d&&(h.id=d),o.features.push(h)}}_limitZoom(t){return Math.max(this.options.minZoom,Math.min(Math.floor(+t),this.options.maxZoom+1))}_cluster(t,e){const{radius:i,extent:r,reduce:n,minPoints:o}=this.options,s=i/(r*Math.pow(2,e)),a=t.data,l=[],c=this.stride;for(let i=0;i<a.length;i+=c){if(a[i+2]<=e)continue;a[i+2]=e;const r=a[i],u=a[i+1],h=t.within(a[i],a[i+1],s),d=a[i+M];let p=d;for(const t of h){const i=t*c;a[i+2]>e&&(p+=a[i+M])}if(p>d&&p>=o){let t,o=r*d,s=u*d,f=-1;const A=((i/c|0)<<5)+(e+1)+this.points.length;for(const r of h){const l=r*c;if(a[l+2]<=e)continue;a[l+2]=e;const u=a[l+M];o+=a[l]*u,s+=a[l+1]*u,a[l+4]=A,n&&(t||(t=this._map(a,i,!0),f=this.clusterProps.length,this.clusterProps.push(t)),n(t,this._map(a,l)))}a[i+4]=A,l.push(o/p,s/p,1/0,A,-1,p),n&&l.push(f)}else{for(let t=0;t<c;t++)l.push(a[i+t]);if(p>1)for(const t of h){const i=t*c;if(!(a[i+2]<=e)){a[i+2]=e;for(let t=0;t<c;t++)l.push(a[i+t])}}}}return l}_getOriginId(t){return t-this.points.length>>5}_getOriginZoom(t){return(t-this.points.length)%32}_map(t,e,i){if(t[e+M]>1){const r=this.clusterProps[t[e+k]];return i?Object.assign({},r):r}const r=this.points[t[e+I]].properties,n=this.options.map(r);return i&&n===r?Object.assign({},n):n}}function L(t,e,i){return{type:"Feature",id:t[e+I],properties:z(t,e,i),geometry:{type:"Point",coordinates:[(r=t[e],360*(r-.5)),R(t[e+1])]}};var r}function z(t,e,i){const r=t[e+M],n=r>=1e4?`${Math.round(r/1e3)}k`:r>=1e3?Math.round(r/100)/10+"k":r,o=t[e+k],s=-1===o?{}:Object.assign({},i[o]);return Object.assign(s,{cluster:!0,cluster_id:t[e+I],point_count:r,point_count_abbreviated:n})}function F(t){return t/360+.5}function D(t){const e=Math.sin(t*Math.PI/180),i=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return i<0?0:i>1?1:i}function R(t){const e=(180-360*t)*Math.PI/180;return 360*Math.atan(Math.exp(e))/Math.PI-90}function U(t,e,i,r){for(var n,o=r,s=i-e>>1,a=i-e,l=t[e],c=t[e+1],u=t[i],h=t[i+1],d=e+3;d<i;d+=3){var p=O(t[d],t[d+1],l,c,u,h);if(p>o)n=d,o=p;else if(p===o){var f=Math.abs(d-s);f<a&&(n=d,a=f)}}o>r&&(n-e>3&&U(t,e,n,r),t[n+2]=o,i-n>3&&U(t,n,i,r))}function O(t,e,i,r,n,o){var s=n-i,a=o-r;if(0!==s||0!==a){var l=((t-i)*s+(e-r)*a)/(s*s+a*a);l>1?(i=n,r=o):l>0&&(i+=s*l,r+=a*l)}return(s=t-i)*s+(a=e-r)*a}function N(t,e,i,r){var n={id:void 0===t?null:t,type:e,geometry:i,tags:r,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(t){var e=t.geometry,i=t.type;if("Point"===i||"MultiPoint"===i||"LineString"===i)Q(t,e);else if("Polygon"===i||"MultiLineString"===i)for(var r=0;r<e.length;r++)Q(t,e[r]);else if("MultiPolygon"===i)for(r=0;r<e.length;r++)for(var n=0;n<e[r].length;n++)Q(t,e[r][n])}(n),n}function Q(t,e){for(var i=0;i<e.length;i+=3)t.minX=Math.min(t.minX,e[i]),t.minY=Math.min(t.minY,e[i+1]),t.maxX=Math.max(t.maxX,e[i]),t.maxY=Math.max(t.maxY,e[i+1])}function V(t,e,i,r){if(e.geometry){var n=e.geometry.coordinates,o=e.geometry.type,s=Math.pow(i.tolerance/((1<<i.maxZoom)*i.extent),2),a=[],l=e.id;if(i.promoteId?l=e.properties[i.promoteId]:i.generateId&&(l=r||0),"Point"===o)j(n,a);else if("MultiPoint"===o)for(var c=0;c<n.length;c++)j(n[c],a);else if("LineString"===o)H(n,a,s,!1);else if("MultiLineString"===o){if(i.lineMetrics){for(c=0;c<n.length;c++)H(n[c],a=[],s,!1),t.push(N(l,"LineString",a,e.properties));return}G(n,a,s,!1)}else if("Polygon"===o)G(n,a,s,!0);else{if("MultiPolygon"!==o){if("GeometryCollection"===o){for(c=0;c<e.geometry.geometries.length;c++)V(t,{id:l,geometry:e.geometry.geometries[c],properties:e.properties},i,r);return}throw new Error("Input data is not a valid GeoJSON object.")}for(c=0;c<n.length;c++){var u=[];G(n[c],u,s,!0),a.push(u)}}t.push(N(l,o,a,e.properties))}}function j(t,e){e.push($(t[0])),e.push(Z(t[1])),e.push(0)}function H(t,e,i,r){for(var n,o,s=0,a=0;a<t.length;a++){var l=$(t[a][0]),c=Z(t[a][1]);e.push(l),e.push(c),e.push(0),a>0&&(s+=r?(n*c-l*o)/2:Math.sqrt(Math.pow(l-n,2)+Math.pow(c-o,2))),n=l,o=c}var u=e.length-3;e[2]=1,U(e,0,u,i),e[u+2]=1,e.size=Math.abs(s),e.start=0,e.end=e.size}function G(t,e,i,r){for(var n=0;n<t.length;n++){var o=[];H(t[n],o,i,r),e.push(o)}}function $(t){return t/360+.5}function Z(t){var e=Math.sin(t*Math.PI/180),i=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return i<0?0:i>1?1:i}function q(t,e,i,r,n,o,s,a){if(r/=e,o>=(i/=e)&&s<r)return t;if(s<i||o>=r)return null;for(var l=[],c=0;c<t.length;c++){var u=t[c],h=u.geometry,d=u.type,p=0===n?u.minX:u.minY,f=0===n?u.maxX:u.maxY;if(p>=i&&f<r)l.push(u);else if(!(f<i||p>=r)){var A=[];if("Point"===d||"MultiPoint"===d)K(h,A,i,r,n);else if("LineString"===d)W(h,A,i,r,n,!1,a.lineMetrics);else if("MultiLineString"===d)J(h,A,i,r,n,!1);else if("Polygon"===d)J(h,A,i,r,n,!0);else if("MultiPolygon"===d)for(var m=0;m<h.length;m++){var g=[];J(h[m],g,i,r,n,!0),g.length&&A.push(g)}if(A.length){if(a.lineMetrics&&"LineString"===d){for(m=0;m<A.length;m++)l.push(N(u.id,d,A[m],u.tags));continue}"LineString"!==d&&"MultiLineString"!==d||(1===A.length?(d="LineString",A=A[0]):d="MultiLineString"),"Point"!==d&&"MultiPoint"!==d||(d=3===A.length?"Point":"MultiPoint"),l.push(N(u.id,d,A,u.tags))}}}return l.length?l:null}function K(t,e,i,r,n){for(var o=0;o<t.length;o+=3){var s=t[o+n];s>=i&&s<=r&&(e.push(t[o]),e.push(t[o+1]),e.push(t[o+2]))}}function W(t,e,i,r,n,o,s){for(var a,l,c=X(t),u=0===n?tt:et,h=t.start,d=0;d<t.length-3;d+=3){var p=t[d],f=t[d+1],A=t[d+2],m=t[d+3],g=t[d+4],_=0===n?p:f,y=0===n?m:g,v=!1;s&&(a=Math.sqrt(Math.pow(p-m,2)+Math.pow(f-g,2))),_<i?y>i&&(l=u(c,p,f,m,g,i),s&&(c.start=h+a*l)):_>r?y<r&&(l=u(c,p,f,m,g,r),s&&(c.start=h+a*l)):Y(c,p,f,A),y<i&&_>=i&&(l=u(c,p,f,m,g,i),v=!0),y>r&&_<=r&&(l=u(c,p,f,m,g,r),v=!0),!o&&v&&(s&&(c.end=h+a*l),e.push(c),c=X(t)),s&&(h+=a)}var x=t.length-3;p=t[x],f=t[x+1],A=t[x+2],(_=0===n?p:f)>=i&&_<=r&&Y(c,p,f,A),x=c.length-3,o&&x>=3&&(c[x]!==c[0]||c[x+1]!==c[1])&&Y(c,c[0],c[1],c[2]),c.length&&e.push(c)}function X(t){var e=[];return e.size=t.size,e.start=t.start,e.end=t.end,e}function J(t,e,i,r,n,o){for(var s=0;s<t.length;s++)W(t[s],e,i,r,n,o,!1)}function Y(t,e,i,r){t.push(e),t.push(i),t.push(r)}function tt(t,e,i,r,n,o){var s=(o-e)/(r-e);return t.push(o),t.push(i+(n-i)*s),t.push(1),s}function et(t,e,i,r,n,o){var s=(o-i)/(n-i);return t.push(e+(r-e)*s),t.push(o),t.push(1),s}function it(t,e){for(var i=[],r=0;r<t.length;r++){var n,o=t[r],s=o.type;if("Point"===s||"MultiPoint"===s||"LineString"===s)n=rt(o.geometry,e);else if("MultiLineString"===s||"Polygon"===s){n=[];for(var a=0;a<o.geometry.length;a++)n.push(rt(o.geometry[a],e))}else if("MultiPolygon"===s)for(n=[],a=0;a<o.geometry.length;a++){for(var l=[],c=0;c<o.geometry[a].length;c++)l.push(rt(o.geometry[a][c],e));n.push(l)}i.push(N(o.id,s,n,o.tags))}return i}function rt(t,e){var i=[];i.size=t.size,void 0!==t.start&&(i.start=t.start,i.end=t.end);for(var r=0;r<t.length;r+=3)i.push(t[r]+e,t[r+1],t[r+2]);return i}function nt(t,e){if(t.transformed)return t;var i,r,n,o=1<<t.z,s=t.x,a=t.y;for(i=0;i<t.features.length;i++){var l=t.features[i],c=l.geometry,u=l.type;if(l.geometry=[],1===u)for(r=0;r<c.length;r+=2)l.geometry.push(ot(c[r],c[r+1],e,o,s,a));else for(r=0;r<c.length;r++){var h=[];for(n=0;n<c[r].length;n+=2)h.push(ot(c[r][n],c[r][n+1],e,o,s,a));l.geometry.push(h)}}return t.transformed=!0,t}function ot(t,e,i,r,n,o){return[Math.round(i*(t*r-n)),Math.round(i*(e*r-o))]}function st(t,e,i,r,n){for(var o=e===n.maxZoom?0:n.tolerance/((1<<e)*n.extent),s={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:i,y:r,z:e,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},a=0;a<t.length;a++){s.numFeatures++,at(s,t[a],o,n);var l=t[a].minX,c=t[a].minY,u=t[a].maxX,h=t[a].maxY;l<s.minX&&(s.minX=l),c<s.minY&&(s.minY=c),u>s.maxX&&(s.maxX=u),h>s.maxY&&(s.maxY=h)}return s}function at(t,e,i,r){var n=e.geometry,o=e.type,s=[];if("Point"===o||"MultiPoint"===o)for(var a=0;a<n.length;a+=3)s.push(n[a]),s.push(n[a+1]),t.numPoints++,t.numSimplified++;else if("LineString"===o)lt(s,n,t,i,!1,!1);else if("MultiLineString"===o||"Polygon"===o)for(a=0;a<n.length;a++)lt(s,n[a],t,i,"Polygon"===o,0===a);else if("MultiPolygon"===o)for(var l=0;l<n.length;l++){var c=n[l];for(a=0;a<c.length;a++)lt(s,c[a],t,i,!0,0===a)}if(s.length){var u=e.tags||null;if("LineString"===o&&r.lineMetrics){for(var h in u={},e.tags)u[h]=e.tags[h];u.mapbox_clip_start=n.start/n.size,u.mapbox_clip_end=n.end/n.size}var d={geometry:s,type:"Polygon"===o||"MultiPolygon"===o?3:"LineString"===o||"MultiLineString"===o?2:1,tags:u};null!==e.id&&(d.id=e.id),t.features.push(d)}}function lt(t,e,i,r,n,o){var s=r*r;if(r>0&&e.size<(n?s:r))i.numPoints+=e.length/3;else{for(var a=[],l=0;l<e.length;l+=3)(0===r||e[l+2]>s)&&(i.numSimplified++,a.push(e[l]),a.push(e[l+1])),i.numPoints++;n&&function(t,e){for(var i=0,r=0,n=t.length,o=n-2;r<n;o=r,r+=2)i+=(t[r]-t[o])*(t[r+1]+t[o+1]);if(i>0===e)for(r=0,n=t.length;r<n/2;r+=2){var s=t[r],a=t[r+1];t[r]=t[n-2-r],t[r+1]=t[n-1-r],t[n-2-r]=s,t[n-1-r]=a}}(a,o),t.push(a)}}function ct(t,e){var i=(e=this.options=function(t,e){for(var i in e)t[i]=e[i];return t}(Object.create(this.options),e)).debug;if(i&&console.time("preprocess data"),e.maxZoom<0||e.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(e.promoteId&&e.generateId)throw new Error("promoteId and generateId cannot be used together.");var r=function(t,e){var i=[];if("FeatureCollection"===t.type)for(var r=0;r<t.features.length;r++)V(i,t.features[r],e,r);else V(i,"Feature"===t.type?t:{geometry:t},e);return i}(t,e);this.tiles={},this.tileCoords=[],i&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",e.indexMaxZoom,e.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),r=function(t,e){var i=e.buffer/e.extent,r=t,n=q(t,1,-1-i,i,0,-1,2,e),o=q(t,1,1-i,2+i,0,-1,2,e);return(n||o)&&(r=q(t,1,-i,1+i,0,-1,2,e)||[],n&&(r=it(n,1).concat(r)),o&&(r=r.concat(it(o,-1)))),r}(r,e),r.length&&this.splitTile(r,0,0,0),i&&(r.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function ut(t,e,i){return 32*((1<<t)*i+e)+t}function ht(e,i){const r=e.tileID.canonical;if(!this._geoJSONIndex)return i(null,null);const n=this._geoJSONIndex.getTile(r.z,r.x,r.y);if(!n)return i(null,null);const o=new class{constructor(e){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=t.EXTENT,this.length=e.length,this._features=e}feature(e){return new class{constructor(e){this._feature=e,this.extent=t.EXTENT,this.type=e.type,this.properties=e.tags,"id"in e&&!isNaN(e.id)&&(this.id=parseInt(e.id,10))}loadGeometry(){if(1===this._feature.type){const e=[];for(const i of this._feature.geometry)e.push([new t.Point(i[0],i[1])]);return e}{const e=[];for(const i of this._feature.geometry){const r=[];for(const e of i)r.push(new t.Point(e[0],e[1]));e.push(r)}return e}}toGeoJSON(t,e,i){return l.call(this,t,e,i)}}(this._features[e])}}(n.features);let s=B(o);0===s.byteOffset&&s.byteLength===s.buffer.byteLength||(s=new Uint8Array(s)),i(null,{vectorTile:o,rawData:s.buffer})}ct.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},ct.prototype.splitTile=function(t,e,i,r,n,o,s){for(var a=[t,e,i,r],l=this.options,c=l.debug;a.length;){r=a.pop(),i=a.pop(),e=a.pop(),t=a.pop();var u=1<<e,h=ut(e,i,r),d=this.tiles[h];if(!d&&(c>1&&console.time("creation"),d=this.tiles[h]=st(t,e,i,r,l),this.tileCoords.push({z:e,x:i,y:r}),c)){c>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",e,i,r,d.numFeatures,d.numPoints,d.numSimplified),console.timeEnd("creation"));var p="z"+e;this.stats[p]=(this.stats[p]||0)+1,this.total++}if(d.source=t,n){if(e===l.maxZoom||e===n)continue;var f=1<<n-e;if(i!==Math.floor(o/f)||r!==Math.floor(s/f))continue}else if(e===l.indexMaxZoom||d.numPoints<=l.indexMaxPoints)continue;if(d.source=null,0!==t.length){c>1&&console.time("clipping");var A,m,g,_,y,v,x=.5*l.buffer/l.extent,b=.5-x,w=.5+x,T=1+x;A=m=g=_=null,y=q(t,u,i-x,i+w,0,d.minX,d.maxX,l),v=q(t,u,i+b,i+T,0,d.minX,d.maxX,l),t=null,y&&(A=q(y,u,r-x,r+w,1,d.minY,d.maxY,l),m=q(y,u,r+b,r+T,1,d.minY,d.maxY,l),y=null),v&&(g=q(v,u,r-x,r+w,1,d.minY,d.maxY,l),_=q(v,u,r+b,r+T,1,d.minY,d.maxY,l),v=null),c>1&&console.timeEnd("clipping"),a.push(A||[],e+1,2*i,2*r),a.push(m||[],e+1,2*i,2*r+1),a.push(g||[],e+1,2*i+1,2*r),a.push(_||[],e+1,2*i+1,2*r+1)}}},ct.prototype.getTile=function(t,e,i){var r=this.options,n=r.extent,o=r.debug;if(t<0||t>24)return null;var s=1<<t,a=ut(t,e=(e%s+s)%s,i);if(this.tiles[a])return nt(this.tiles[a],n);o>1&&console.log("drilling down to z%d-%d-%d",t,e,i);for(var l,c=t,u=e,h=i;!l&&c>0;)c--,u=Math.floor(u/2),h=Math.floor(h/2),l=this.tiles[ut(c,u,h)];return l&&l.source?(o>1&&console.log("found parent tile z%d-%d-%d",c,u,h),o>1&&console.time("drilling down"),this.splitTile(l.source,c,u,h,t,e,i),o>1&&console.timeEnd("drilling down"),this.tiles[a]?nt(this.tiles[a],n):null):null};class dt extends t.VectorTileWorkerSource{constructor(t,e,i,r,n){super(t,e,i,r,ht),n&&(this.loadGeoJSON=n)}loadData(e,i){const r=e&&e.request,n=r&&r.collectResourceTiming;this.loadGeoJSON(e,((o,s)=>{if(o||!s)return i(o);if("object"!=typeof s)return i(new Error(`Input data given to '${e.source}' is not a valid GeoJSON object.`));{a(s,!0);try{if(e.filter){const i=t.createExpression(e.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===i.result)throw new Error(i.value.map((t=>`${t.key}: ${t.message}`)).join(", "));const r=s.features.filter((t=>i.value.evaluate({zoom:0},t)));s={type:"FeatureCollection",features:r}}this._geoJSONIndex=e.cluster?new P(function({superclusterOptions:e,clusterProperties:i}){if(!i||!e)return e;const r={},n={},o={accumulated:null,zoom:0},s={properties:null},a=Object.keys(i);for(const e of a){const[o,s]=i[e],a=t.createExpression(s),l=t.createExpression("string"==typeof o?[o,["accumulated"],["get",e]]:o);r[e]=a.value,n[e]=l.value}return e.map=t=>{s.properties=t;const e={};for(const t of a)e[t]=r[t].evaluate(o,s);return e},e.reduce=(t,e)=>{s.properties=e;for(const e of a)o.accumulated=t[e],t[e]=n[e].evaluate(o,s)},e}(e)).load(s.features):function(t,e){return new ct(t,e)}(s,e.geojsonVtOptions)}catch(o){return i(o)}this.loaded={};const l={};if(n){const i=t.getPerformanceMeasurement(r);i&&(l.resourceTiming={},l.resourceTiming[e.source]=JSON.parse(JSON.stringify(i)))}i(null,l)}}))}reloadTile(t,e){const i=this.loaded;return i&&i[t.uid]?super.reloadTile(t,e):this.loadTile(t,e)}loadGeoJSON(e,i){if(e.request)t.getJSON(e.request,i);else{if("string"!=typeof e.data)return i(new Error(`Input data given to '${e.source}' is not a valid GeoJSON object.`));try{return i(null,JSON.parse(e.data))}catch(t){return i(new Error(`Input data given to '${e.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(t,e){try{e(null,this._geoJSONIndex.getClusterExpansionZoom(t.clusterId))}catch(t){e(t)}}getClusterChildren(t,e){try{e(null,this._geoJSONIndex.getChildren(t.clusterId))}catch(t){e(t)}}getClusterLeaves(t,e){try{e(null,this._geoJSONIndex.getLeaves(t.clusterId,t.limit,t.offset))}catch(t){e(t)}}}class pt{constructor(e){this.self=e,this.actor=new t.Actor(e,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=t.getProjection({name:"mercator"}),this.workerSourceTypes={vector:t.VectorTileWorkerSource,geojson:dt},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(t,e)=>{if(this.workerSourceTypes[t])throw new Error(`Worker source with name "${t}" already registered.`);this.workerSourceTypes[t]=e},this.self.registerRTLTextPlugin=e=>{if(t.plugin.isParsed())throw new Error("RTL text plugin already registered.");t.plugin.applyArabicShaping=e.applyArabicShaping,t.plugin.processBidirectionalText=e.processBidirectionalText,t.plugin.processStyledBidirectionalText=e.processStyledBidirectionalText}}clearCaches(t,e,i){delete this.layerIndexes[t],delete this.availableImages[t],delete this.workerSources[t],delete this.demWorkerSources[t],i()}checkIfReady(t,e,i){i()}setReferrer(t,e){this.referrer=e}spriteLoaded(e,i){this.isSpriteLoaded[e]=i;for(const r in this.workerSources[e]){const n=this.workerSources[e][r];for(const e in n)n[e]instanceof t.VectorTileWorkerSource&&(n[e].isSpriteLoaded=i,n[e].fire(new t.Event("isSpriteLoaded")))}}setImages(t,e,i){this.availableImages[t]=e;for(const i in this.workerSources[t]){const r=this.workerSources[t][i];for(const t in r)r[t].availableImages=e}i()}enableTerrain(t,e,i){this.terrain=e,i()}setProjection(e,i){this.projections[e]=t.getProjection(i)}setLayers(t,e,i){this.getLayerIndex(t).replace(e),i()}updateLayers(t,e,i){this.getLayerIndex(t).update(e.layers,e.removedIds),i()}loadTile(e,i,r){const n=this.enableTerrain?t.extend({enableTerrain:this.terrain},i):i;n.projection=this.projections[e]||this.defaultProjection,this.getWorkerSource(e,i.type,i.source).loadTile(n,r)}loadDEMTile(e,i,r){const n=this.enableTerrain?t.extend({buildQuadTree:this.terrain},i):i;this.getDEMWorkerSource(e,i.source).loadTile(n,r)}reloadTile(e,i,r){const n=this.enableTerrain?t.extend({enableTerrain:this.terrain},i):i;n.projection=this.projections[e]||this.defaultProjection,this.getWorkerSource(e,i.type,i.source).reloadTile(n,r)}abortTile(t,e,i){this.getWorkerSource(t,e.type,e.source).abortTile(e,i)}removeTile(t,e,i){this.getWorkerSource(t,e.type,e.source).removeTile(e,i)}removeSource(t,e,i){if(!this.workerSources[t]||!this.workerSources[t][e.type]||!this.workerSources[t][e.type][e.source])return;const r=this.workerSources[t][e.type][e.source];delete this.workerSources[t][e.type][e.source],void 0!==r.removeSource?r.removeSource(e,i):i()}loadWorkerSource(t,e,i){try{this.self.importScripts(e.url),i()}catch(t){i(t.toString())}}syncRTLPluginState(e,i,r){try{t.plugin.setState(i);const e=t.plugin.getPluginURL();if(t.plugin.isLoaded()&&!t.plugin.isParsed()&&null!=e){this.self.importScripts(e);const i=t.plugin.isParsed();r(i?void 0:new Error(`RTL Text Plugin failed to import scripts from ${e}`),i)}}catch(t){r(t.toString())}}getAvailableImages(t){let e=this.availableImages[t];return e||(e=[]),e}getLayerIndex(t){let e=this.layerIndexes[t];return e||(e=this.layerIndexes[t]=new r),e}getWorkerSource(t,e,i){if(this.workerSources[t]||(this.workerSources[t]={}),this.workerSources[t][e]||(this.workerSources[t][e]={}),!this.workerSources[t][e][i]){const r={send:(e,i,r,n,o,s)=>{this.actor.send(e,i,r,t,o,s)},scheduler:this.actor.scheduler};this.workerSources[t][e][i]=new this.workerSourceTypes[e](r,this.getLayerIndex(t),this.getAvailableImages(t),this.isSpriteLoaded[t])}return this.workerSources[t][e][i]}getDEMWorkerSource(t,e){return this.demWorkerSources[t]||(this.demWorkerSources[t]={}),this.demWorkerSources[t][e]||(this.demWorkerSources[t][e]=new n),this.demWorkerSources[t][e]}enforceCacheSizeLimit(e,i){t.enforceCacheSizeLimit(i)}getWorkerPerformanceMetrics(t,e,i){i(void 0,void 0)}}return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope&&(self.worker=new pt(self)),pt})),r(["./shared"],(function(t){function e(t,i){if(Array.isArray(t)){if(!Array.isArray(i)||t.length!==i.length)return!1;for(let r=0;r<t.length;r++)if(!e(t[r],i[r]))return!1;return!0}if("object"==typeof t&&null!==t&&null!==i){if("object"!=typeof i)return!1;if(Object.keys(t).length!==Object.keys(i).length)return!1;for(const r in t)if(!e(t[r],i[r]))return!1;return!0}return t===i}var i=r;function r(t){return!function(t){return"undefined"==typeof window||"undefined"==typeof document?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var t,e,i=new Blob([""],{type:"text/javascript"}),r=URL.createObjectURL(i);try{e=new Worker(r),t=!0}catch(e){t=!1}return e&&e.terminate(),URL.revokeObjectURL(r),t}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var t=document.createElement("canvas");t.width=t.height=1;var e=t.getContext("2d");if(!e)return!1;var i=e.getImageData(0,0,1,1);return i&&i.width===t.width}()?(void 0===n[e=t&&t.failIfMajorPerformanceCaveat]&&(n[e]=function(t){var e,i=function(t){var e=document.createElement("canvas"),i=Object.create(r.webGLContextAttributes);return i.failIfMajorPerformanceCaveat=t,e.getContext("webgl",i)||e.getContext("experimental-webgl",i)}(t);if(!i)return!1;try{e=i.createShader(i.VERTEX_SHADER)}catch(t){return!1}return!(!e||i.isContextLost())&&(i.shaderSource(e,"void main() {}"),i.compileShader(e),!0===i.getShaderParameter(e,i.COMPILE_STATUS))}(e)),n[e]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var e}(t)}var n={};function o(e,i,r){const n=t.window.document.createElement(e);return void 0!==i&&(n.className=i),r&&r.appendChild(n),n}function s(e,i,r){const n=t.window.document.createElementNS("http://www.w3.org/2000/svg",e);for(const t of Object.keys(i))n.setAttributeNS(null,t,i[t]);return r&&r.appendChild(n),n}r.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const a=t.window.document&&t.window.document.documentElement.style,l=a&&void 0!==a.userSelect?"userSelect":"WebkitUserSelect";let c;function u(){a&&l&&(c=a[l],a[l]="none")}function h(){a&&l&&(a[l]=c)}function d(e){e.preventDefault(),e.stopPropagation(),t.window.removeEventListener("click",d,!0)}function p(){t.window.addEventListener("click",d,!0),t.window.setTimeout((()=>{t.window.removeEventListener("click",d,!0)}),0)}function f(t,e){const i=t.getBoundingClientRect();return g(t,i,e)}function A(t,e){const i=t.getBoundingClientRect(),r=[];for(let n=0;n<e.length;n++)r.push(g(t,i,e[n]));return r}function m(e){return void 0!==t.window.InstallTrigger&&2===e.button&&e.ctrlKey&&t.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:e.button}function g(e,i,r){const n=e.offsetWidth===i.width?1:e.offsetWidth/i.width;return new t.Point((r.clientX-i.left)*n,(r.clientY-i.top)*n)}function _(t,e){var i=e[0],r=e[1],n=e[2],o=e[3],s=i*o-n*r;return s?(t[0]=o*(s=1/s),t[1]=-r*s,t[2]=-n*s,t[3]=i*s,t):null}function y(t){const{userImage:e}=t;return!!(e&&e.render&&e.render())&&(t.data.replace(new Uint8Array(e.data.buffer)),!0)}class v extends t.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new t.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:t,callback:e}of this.requestors)this._notify(t,e);this.requestors=[]}}hasImage(t){return!!this.getImage(t)}getImage(t){return this.images[t]}addImage(t,e){this._validate(t,e)&&(this.images[t]=e)}_validate(e,i){let r=!0;return this._validateStretch(i.stretchX,i.data&&i.data.width)||(this.fire(new t.ErrorEvent(new Error(`Image "${e}" has invalid "stretchX" value`))),r=!1),this._validateStretch(i.stretchY,i.data&&i.data.height)||(this.fire(new t.ErrorEvent(new Error(`Image "${e}" has invalid "stretchY" value`))),r=!1),this._validateContent(i.content,i)||(this.fire(new t.ErrorEvent(new Error(`Image "${e}" has invalid "content" value`))),r=!1),r}_validateStretch(t,e){if(!t)return!0;let i=0;for(const r of t){if(r[0]<i||r[1]<r[0]||e<r[1])return!1;i=r[1]}return!0}_validateContent(t,e){return!(t&&(4!==t.length||t[0]<0||e.data.width<t[0]||t[1]<0||e.data.height<t[1]||t[2]<0||e.data.width<t[2]||t[3]<0||e.data.height<t[3]||t[2]<t[0]||t[3]<t[1]))}updateImage(t,e){e.version=this.images[t].version+1,this.images[t]=e,this.updatedImages[t]=!0}removeImage(t){const e=this.images[t];delete this.images[t],delete this.patterns[t],e.userImage&&e.userImage.onRemove&&e.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t,e){let i=!0;if(!this.isLoaded())for(const e of t)this.images[e]||(i=!1);this.isLoaded()||i?this._notify(t,e):this.requestors.push({ids:t,callback:e})}_notify(e,i){const r={};for(const i of e){this.images[i]||this.fire(new t.Event("styleimagemissing",{id:i}));const e=this.images[i];e?r[i]={data:e.data.clone(),pixelRatio:e.pixelRatio,sdf:e.sdf,version:e.version,stretchX:e.stretchX,stretchY:e.stretchY,content:e.content,hasRenderCallback:Boolean(e.userImage&&e.userImage.render)}:t.warnOnce(`Image "${i}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}i(null,r)}getPixelSize(){const{width:t,height:e}=this.atlasImage;return{width:t,height:e}}getPattern(e){const i=this.patterns[e],r=this.getImage(e);if(!r)return null;if(i&&i.position.version===r.version)return i.position;if(i)i.position.version=r.version;else{const i={w:r.data.width+2,h:r.data.height+2,x:0,y:0},n=new t.ImagePosition(i,r);this.patterns[e]={bin:i,position:n}}return this._updatePatternAtlas(),this.patterns[e].position}bind(e){const i=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new t.Texture(e,this.atlasImage,i.RGBA),this.atlasTexture&&this.atlasTexture.bind(i.LINEAR,i.CLAMP_TO_EDGE)}_updatePatternAtlas(){const e=[];for(const t in this.patterns)e.push(this.patterns[t].bin);const{w:i,h:r}=t.potpack(e),n=this.atlasImage;n.resize({width:i||1,height:r||1});for(const e in this.patterns){const{bin:i}=this.patterns[e],r=i.x+1,o=i.y+1,s=this.images[e].data,a=s.width,l=s.height;t.RGBAImage.copy(s,n,{x:0,y:0},{x:r,y:o},{width:a,height:l}),t.RGBAImage.copy(s,n,{x:0,y:l-1},{x:r,y:o-1},{width:a,height:1}),t.RGBAImage.copy(s,n,{x:0,y:0},{x:r,y:o+l},{width:a,height:1}),t.RGBAImage.copy(s,n,{x:a-1,y:0},{x:r-1,y:o},{width:1,height:l}),t.RGBAImage.copy(s,n,{x:0,y:0},{x:r+a,y:o},{width:1,height:l})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const e of t){if(this.callbackDispatchedThisFrame[e])continue;this.callbackDispatchedThisFrame[e]=!0;const t=this.images[e];y(t)&&this.updateImage(e,t)}}}const x=new t.Properties({anchor:new t.DataConstantProperty(t.spec.light.anchor),position:new class{constructor(){this.specification=t.spec.light.position}possiblyEvaluate(e,i){return function([e,i,r]){const n=t.degToRad(i+90),o=t.degToRad(r);return{x:e*Math.cos(n)*Math.sin(o),y:e*Math.sin(n)*Math.sin(o),z:e*Math.cos(o),azimuthal:i,polar:r}}(e.expression.evaluate(i))}interpolate(e,i,r){return{x:t.number(e.x,i.x,r),y:t.number(e.y,i.y,r),z:t.number(e.z,i.z,r),azimuthal:t.number(e.azimuthal,i.azimuthal,r),polar:t.number(e.polar,i.polar,r)}}},color:new t.DataConstantProperty(t.spec.light.color),intensity:new t.DataConstantProperty(t.spec.light.intensity)});class b extends t.Evented{constructor(e){super(),this._transitionable=new t.Transitionable(x),this.setLight(e),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,i={}){if(!this._validate(t.validateLight,e,i))for(const i in e){const r=e[i];t.endsWith(i,"-transition")?this._transitionable.setTransition(i.slice(0,-11),r):this._transitionable.setValue(i,r)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(e,i,r){return(!r||!1!==r.validate)&&t.emitValidationErrors(this,e.call(t.validateStyle,t.extend({value:i,style:{glyphs:!0,sprite:!0},styleSpec:t.spec})))}}const w=new t.Properties({source:new t.DataConstantProperty(t.spec.terrain.source),exaggeration:new t.DataConstantProperty(t.spec.terrain.exaggeration)});let T=class extends t.Evented{constructor(e,i){super(),this._transitionable=new t.Transitionable(w),this.set(e),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=i}get(){return this._transitionable.serialize()}set(e){for(const i in e){const r=e[i];t.endsWith(i,"-transition")?this._transitionable.setTransition(i.slice(0,-11),r):this._transitionable.setValue(i,r)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}};function B(e,i,r,n){const o=t.smoothstep(45,65,r),[s,a]=E(e,n),l=t.length(i);let c=1-Math.min(1,Math.exp((l-s)/(a-s)*-6));return c*=c*c,c=Math.min(1,1.00747*c),c*o*e.alpha}function E(t,e){const i=.5/Math.tan(.5*e);return[t.range[0]+i,t.range[1]+i]}const C=new t.Properties({range:new t.DataConstantProperty(t.spec.fog.range),color:new t.DataConstantProperty(t.spec.fog.color),"high-color":new t.DataConstantProperty(t.spec.fog["high-color"]),"space-color":new t.DataConstantProperty(t.spec.fog["space-color"]),"horizon-blend":new t.DataConstantProperty(t.spec.fog["horizon-blend"]),"star-intensity":new t.DataConstantProperty(t.spec.fog["star-intensity"])});class S extends t.Evented{constructor(e,i){super(),this._transitionable=new t.Transitionable(C),this.set(e),this._transitioning=this._transitionable.untransitioned(),this._transform=i}get state(){const e=this._transform,i="globe"===e.projection.name,r=t.globeToMercatorTransition(e.zoom),n=this.properties.get("range"),o=[.5,3];return{range:i?[t.number(o[0],n[0],r),t.number(o[1],n[1],r)]:n,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(e,i={}){if(!this._validate(t.validateFog,e,i)){for(const i of Object.keys(t.spec.fog))e&&void 0===e[i]&&(e[i]=t.spec.fog[i].default);for(const i in e){const r=e[i];t.endsWith(i,"-transition")?this._transitionable.setTransition(i.slice(0,-11),r):this._transitionable.setValue(i,r)}}}getOpacity(e){if(!this._transform.projection.supportsFog)return 0;const i=this.properties&&this.properties.get("color")||1;return("globe"===this._transform.projection.name?1:t.smoothstep(45,65,e))*i.a}getOpacityAtLatLng(e,i){return this._transform.projection.supportsFog?function(e,i,r){const n=t.MercatorCoordinate.fromLngLat(i),o=r.elevation?r.elevation.getAtPointOrZero(n):0,s=[n.x,n.y,o];return t.transformMat4(s,s,r.mercatorFogMatrix),B(e,s,r.pitch,r._fov)}(this.state,e,i):0}getFovAdjustedRange(t){return this._transform.projection.supportsFog?E(this.state,t):[0,1]}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(e,i,r){return(!r||!1!==r.validate)&&t.emitValidationErrors(this,e.call(t.validateStyle,t.extend({value:i,style:{glyphs:!0,sprite:!0},styleSpec:t.spec})))}}class I{constructor(e,i){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=t.uniqueId();const r=this.workerPool.acquire(this.id);for(let t=0;t<r.length;t++){const e=new I.Actor(r[t],i,this.id);e.name=`Worker ${t}`,this.actors.push(e)}this.ready=!1,this.broadcast("checkIfReady",null,(()=>{this.ready=!0}))}broadcast(e,i,r){t.asyncAll(this.actors,((t,r)=>{t.send(e,i,r)}),r=r||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach((t=>{t.remove()})),this.actors=[],this.workerPool.release(this.id)}}function M(e,i,r){return i*(t.EXTENT/(e.tileSize*Math.pow(2,r-e.tileID.overscaledZ)))}I.Actor=t.Actor;class k{constructor(t,e,i,r){this.screenBounds=t,this.cameraPoint=e,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=i,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,r)}static createFromScreenPoints(e,i){let r,n;if(e instanceof t.Point||"number"==typeof e[0]){const o=t.Point.convert(e);r=[o],n=i.isPointAboveHorizon(o)}else{const o=t.Point.convert(e[0]),s=t.Point.convert(e[1]);r=[o,s],n=t.polygonizeBounds(o,s).every((t=>i.isPointAboveHorizon(t)))}return new k(r,i.getCameraPoint(),n,i)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(e){return t.polygonizeBounds(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],e)}bufferedCameraGeometry(e){const i=this.screenBounds[0],r=1===this.screenBounds.length?this.screenBounds[0].add(new t.Point(1,1)):this.screenBounds[1],n=t.polygonizeBounds(i,r,0,!1);return this.cameraPoint.y>r.y&&(this.cameraPoint.x>i.x&&this.cameraPoint.x<r.x?n.splice(3,0,this.cameraPoint):this.cameraPoint.x>=r.x?n[2]=this.cameraPoint:this.cameraPoint.x<=i.x&&(n[3]=this.cameraPoint)),t.bufferConvexPolygon(n,e)}bufferedCameraGeometryGlobe(e){const i=this.screenBounds[0],r=1===this.screenBounds.length?this.screenBounds[0].add(new t.Point(1,1)):this.screenBounds[1],n=t.polygonizeBounds(i,r,e),o=this.cameraPoint.clone();switch(3*((o.y>i.y)+(o.y>r.y))+((o.x>i.x)+(o.x>r.x))){case 0:n[0]=o,n[4]=o.clone();break;case 1:n.splice(1,0,o);break;case 2:n[1]=o;break;case 3:n.splice(4,0,o);break;case 5:n.splice(2,0,o);break;case 6:n[3]=o;break;case 7:n.splice(3,0,o);break;case 8:n[2]=o}return n}containsTile(e,i,r,n=0){const o=e.queryPadding/i._pixelsPerMercatorPixel+1,s=r?this._bufferedCameraMercator(o,i):this._bufferedScreenMercator(o,i);let a=e.tileID.wrap+(s.unwrapped?n:0);const l=s.polygon.map((i=>t.getTilePoint(e.tileTransform,i,a)));if(!t.polygonIntersectsBox(l,0,0,t.EXTENT,t.EXTENT))return;a=e.tileID.wrap+(this.screenGeometryMercator.unwrapped?n:0);const c=this.screenGeometryMercator.polygon.map((i=>t.getTileVec3(e.tileTransform,i,a))),u=c.map((e=>new t.Point(e[0],e[1]))),h=i.getFreeCameraOptions().position||new t.MercatorCoordinate(0,0,0),d=t.getTileVec3(e.tileTransform,h,a),p=c.map((e=>{const i=t.sub(e,e,d);return t.normalize(i,i),new t.Ray(d,i)})),f=M(e,1,i.zoom)*i._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:u,tilespaceRays:p,bufferedTilespaceGeometry:l,bufferedTilespaceBounds:(A=t.getBounds(l),A.min.x=t.clamp(A.min.x,0,t.EXTENT),A.min.y=t.clamp(A.min.y,0,t.EXTENT),A.max.x=t.clamp(A.max.x,0,t.EXTENT),A.max.y=t.clamp(A.max.y,0,t.EXTENT),A),tile:e,tileID:e.tileID,pixelToTileUnitsFactor:f};var A}_bufferedScreenMercator(t,e){const i=z(t);if(this._screenRaycastCache[i])return this._screenRaycastCache[i];{let r;return r="globe"===e.projection.name?this._projectAndResample(this.bufferedScreenGeometry(t),e):{polygon:this.bufferedScreenGeometry(t).map((t=>e.pointCoordinate3D(t))),unwrapped:!0},this._screenRaycastCache[i]=r,r}}_bufferedCameraMercator(t,e){const i=z(t);if(this._cameraRaycastCache[i])return this._cameraRaycastCache[i];{let r;return r="globe"===e.projection.name?this._projectAndResample(this.bufferedCameraGeometryGlobe(t),e):{polygon:this.bufferedCameraGeometry(t).map((t=>e.pointCoordinate3D(t))),unwrapped:!0},this._cameraRaycastCache[i]=r,r}}_projectAndResample(e,i){const r=function(e,i){const r=t.multiply([],i.pixelMatrix,i.globeMatrix),n=[0,-t.GLOBE_RADIUS,0,1],o=[0,t.GLOBE_RADIUS,0,1],s=[0,0,0,1];t.transformMat4$1(n,n,r),t.transformMat4$1(o,o,r),t.transformMat4$1(s,s,r);const a=new t.Point(n[0]/n[3],n[1]/n[3]),l=new t.Point(o[0]/o[3],o[1]/o[3]),c=t.polygonContainsPoint(e,a)&&n[3]<s[3],u=t.polygonContainsPoint(e,l)&&o[3]<s[3];if(!c&&!u)return null;const h=function(t,e,i){for(let r=1;r<t.length;r++){const n=L(e.pointCoordinate3D(t[r-1]).x),o=L(e.pointCoordinate3D(t[r]).x);if(i<0){if(n<o)return{idx:r,t:-n/(o-1-n)}}else if(o<n)return{idx:r,t:(1-n)/(o+1-n)}}return null}(e,i,c?-1:1);if(!h)return null;const{idx:d,t:p}=h;let f=d>1?P(e.slice(0,d),i):[],A=d<e.length?P(e.slice(d),i):[];f=f.map((e=>new t.Point(L(e.x),e.y))),A=A.map((e=>new t.Point(L(e.x),e.y)));const m=[...f];0===m.length&&m.push(A[A.length-1]);const g=t.number(m[m.length-1].y,(0===A.length?f[0]:A[0]).y,p);let _;return _=c?[new t.Point(0,g),new t.Point(0,0),new t.Point(1,0),new t.Point(1,g)]:[new t.Point(1,g),new t.Point(1,1),new t.Point(0,1),new t.Point(0,g)],m.push(..._),0===A.length?m.push(f[0]):m.push(...A),{polygon:m.map((e=>new t.MercatorCoordinate(e.x,e.y))),unwrapped:!1}}(e,i);if(r)return r;const n=function(e,i){let r=!1,n=-1/0,o=0;for(let t=0;t<e.length-1;t++)e[t].x>n&&(n=e[t].x,o=t);for(let t=0;t<e.length-1;t++){const i=(o+t)%(e.length-1),n=e[i],s=e[i+1];Math.abs(n.x-s.x)>.5&&(n.x<s.x?(n.x+=1,0===i&&(e[e.length-1].x+=1)):(s.x+=1,i+1===e.length-1&&(e[0].x+=1)),r=!0)}const s=t.mercatorXfromLng(i.center.lng);return r&&s<Math.abs(s-1)&&e.forEach((t=>{t.x-=1})),{polygon:e,unwrapped:r}}(P(e,i).map((e=>new t.Point(L(e.x),e.y))),i);return{polygon:n.polygon.map((e=>new t.MercatorCoordinate(e.x,e.y))),unwrapped:n.unwrapped}}}function P(e,i){return t.resample(e,(t=>{const e=i.pointCoordinate3D(t);t.x=e.x,t.y=e.y}),1/256)}function L(t){return t<0?1+t%1:t%1}function z(t){return 100*t|0}function F(e,i,r,n,o){const s=function(r,n){if(r)return o(r);if(n){e.url&&n.tiles&&e.tiles&&delete e.tiles;const r=t.pick(t.extend(n,e),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);n.vector_layers&&(r.vectorLayers=n.vector_layers,r.vectorLayerIds=r.vectorLayers.map((t=>t.id))),r.tiles=i.canonicalizeTileset(r,e.url),o(null,r)}};return e.url?t.getJSON(i.transformRequest(i.normalizeSourceURL(e.url,null,r,n),t.ResourceType.Source),s):t.exported.frame((()=>s(null,e)))}class D{constructor(e,i,r){this.bounds=t.LngLatBounds.convert(this.validateBounds(e)),this.minzoom=i||0,this.maxzoom=r||24}validateBounds(t){return Array.isArray(t)&&4===t.length?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(e){const i=Math.pow(2,e.z),r=Math.floor(t.mercatorXfromLng(this.bounds.getWest())*i),n=Math.floor(t.mercatorYfromLat(this.bounds.getNorth())*i),o=Math.ceil(t.mercatorXfromLng(this.bounds.getEast())*i),s=Math.ceil(t.mercatorYfromLat(this.bounds.getSouth())*i);return e.x>=r&&e.x<o&&e.y>=n&&e.y<s}}class R{constructor(t,e,i){this.context=t;const r=t.gl;this.buffer=r.createBuffer(),this.dynamicDraw=Boolean(i),this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),r.bufferData(r.ELEMENT_ARRAY_BUFFER,e.arrayBuffer,this.dynamicDraw?r.DYNAMIC_DRAW:r.STATIC_DRAW),this.dynamicDraw||e.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const e=this.context.gl;this.context.unbindVAO(),this.bind(),e.bufferSubData(e.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const U={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class O{constructor(t,e,i,r){this.length=e.length,this.attributes=i,this.itemSize=e.bytesPerElement,this.dynamicDraw=r,this.context=t;const n=t.gl;this.buffer=n.createBuffer(),t.bindVertexBuffer.set(this.buffer),n.bufferData(n.ARRAY_BUFFER,e.arrayBuffer,this.dynamicDraw?n.DYNAMIC_DRAW:n.STATIC_DRAW),this.dynamicDraw||e.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){const e=this.context.gl;this.bind(),e.bufferSubData(e.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,e){for(let i=0;i<this.attributes.length;i++){const r=e.attributes[this.attributes[i].name];void 0!==r&&t.enableVertexAttribArray(r)}}setVertexAttribPointers(t,e,i){for(let r=0;r<this.attributes.length;r++){const n=this.attributes[r],o=e.attributes[n.name];void 0!==o&&t.vertexAttribPointer(o,n.components,t[U[n.type]],!1,this.itemSize,n.offset+this.itemSize*(i||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class N{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Q extends N{getDefault(){return t.Color.transparent}set(t){const e=this.current;(t.r!==e.r||t.g!==e.g||t.b!==e.b||t.a!==e.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class V extends N{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class j extends N{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class H extends N{getDefault(){return[!0,!0,!0,!0]}set(t){const e=this.current;(t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||t[3]!==e[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class G extends N{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class $ extends N{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class Z extends N{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const e=this.current;(t.func!==e.func||t.ref!==e.ref||t.mask!==e.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class q extends N{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const e=this.current;(t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class K extends N{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;t?e.enable(e.STENCIL_TEST):e.disable(e.STENCIL_TEST),this.current=t,this.dirty=!1}}class W extends N{getDefault(){return[0,1]}set(t){const e=this.current;(t[0]!==e[0]||t[1]!==e[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class X extends N{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;t?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),this.current=t,this.dirty=!1}}class J extends N{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class Y extends N{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;t?e.enable(e.BLEND):e.disable(e.BLEND),this.current=t,this.dirty=!1}}class tt extends N{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const e=this.current;(t[0]!==e[0]||t[1]!==e[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class et extends N{getDefault(){return t.Color.transparent}set(t){const e=this.current;(t.r!==e.r||t.g!==e.g||t.b!==e.b||t.a!==e.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class it extends N{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class rt extends N{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;t?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),this.current=t,this.dirty=!1}}class nt extends N{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class ot extends N{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}let st,at=class extends N{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}};class lt extends N{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class ct extends N{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const e=this.current;(t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||t[3]!==e[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class ut extends N{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.bindFramebuffer(e.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class ht extends N{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.bindRenderbuffer(e.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class dt extends N{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.bindTexture(e.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class pt extends N{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.bindBuffer(e.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class ft extends N{getDefault(){return null}set(t){const e=this.gl;e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class At extends N{constructor(t){super(t),this.vao=t.extVertexArrayObject}getDefault(){return null}set(t){this.vao&&(t!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(t),this.current=t,this.dirty=!1)}}class mt extends N{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.pixelStorei(e.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class gt extends N{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class _t extends N{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class yt extends N{constructor(t,e){super(t),this.context=t,this.parent=e}getDefault(){return null}}class vt extends yt{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const e=this.gl;e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class xt extends yt{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const e=this.gl;e.framebufferRenderbuffer(e.FRAMEBUFFER,this.attachment(),e.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class bt extends xt{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class wt{constructor(t,e,i,r){this.context=t,this.width=e,this.height=i;const n=this.framebuffer=t.gl.createFramebuffer();this.colorAttachment=new vt(t,n),r&&(this.depthAttachment=new xt(t,n))}destroy(){const t=this.context.gl,e=this.colorAttachment.get();if(e&&t.deleteTexture(e),this.depthAttachment){const e=this.depthAttachment.get();e&&t.deleteRenderbuffer(e)}t.deleteFramebuffer(this.framebuffer)}}class Tt{constructor(t,e=!1){if(this.gl=t,this.isWebGL2=e,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),e){const e=t;this.extVertexArrayObject={createVertexArrayOES:e.createVertexArray.bind(t),deleteVertexArrayOES:e.deleteVertexArray.bind(t),bindVertexArrayOES:e.bindVertexArray.bind(t)}}this.clearColor=new Q(this),this.clearDepth=new V(this),this.clearStencil=new j(this),this.colorMask=new H(this),this.depthMask=new G(this),this.stencilMask=new $(this),this.stencilFunc=new Z(this),this.stencilOp=new q(this),this.stencilTest=new K(this),this.depthRange=new W(this),this.depthTest=new X(this),this.depthFunc=new J(this),this.blend=new Y(this),this.blendFunc=new tt(this),this.blendColor=new et(this),this.blendEquation=new it(this),this.cullFace=new rt(this),this.cullFaceSide=new nt(this),this.frontFace=new ot(this),this.program=new at(this),this.activeTexture=new lt(this),this.viewport=new ct(this),this.bindFramebuffer=new ut(this),this.bindRenderbuffer=new ht(this),this.bindTexture=new dt(this),this.bindVertexBuffer=new pt(this),this.bindElementBuffer=new ft(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new At(this),this.pixelStoreUnpack=new mt(this),this.pixelStoreUnpackPremultiplyAlpha=new gt(this),this.pixelStoreUnpackFlipY=new _t(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extDebugRendererInfo=t.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=t.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=t.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),e||(this.extTextureHalfFloat=t.getExtension("OES_texture_half_float")),(e||this.extTextureHalfFloat&&t.getExtension("OES_texture_half_float_linear"))&&(this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=e||t.getExtension("OES_standard_derivatives"),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,e){return new R(this,t,e)}createVertexBuffer(t,e,i){return new O(this,t,e,i)}createRenderbuffer(t,e,i){const r=this.gl,n=r.createRenderbuffer();return this.bindRenderbuffer.set(n),r.renderbufferStorage(r.RENDERBUFFER,t,e,i),this.bindRenderbuffer.set(null),n}createFramebuffer(t,e,i){return new wt(this,t,e,i)}clear({color:t,depth:e,stencil:i}){const r=this.gl;let n=0;t&&(n|=r.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),void 0!==e&&(n|=r.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(e),this.depthMask.set(!0)),void 0!==i&&(n|=r.STENCIL_BUFFER_BIT,this.clearStencil.set(i),this.stencilMask.set(255)),r.clear(n)}setCullFace(t){!1===t.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(i){e(i.blendFunction,t.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(i.blendFunction),this.blendColor.set(i.blendColor)),this.colorMask.set(i.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class Bt extends t.Evented{constructor(e,i,r,n){if(super(),this.id=e,this.dispatcher=r,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,t.extend(this,t.pick(i,["url","scheme","tileSize","promoteId"])),this._options=t.extend({type:"vector"},i),this._collectResourceTiming=i.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(n),this._tileWorkers={},this._deduped=new t.DedupedRequest}load(e){this._loaded=!1,this.fire(new t.Event("dataloading",{dataType:"source"}));const i=Array.isArray(this.map._language)?this.map._language.join():this.map._language,r=this.map._worldview;this._tileJSONRequest=F(this._options,this.map._requestManager,i,r,((n,o)=>{this._tileJSONRequest=null,this._loaded=!0,n?(i&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${i}`),r&&2!==r.length&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${r}`),this.fire(new t.ErrorEvent(n))):o&&(t.extend(this,o),o.bounds&&(this.tileBounds=new D(o.bounds,this.minzoom,this.maxzoom)),t.postTurnstileEvent(o.tiles,this.map._requestManager._customAccessToken),this.fire(new t.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new t.Event("data",{dataType:"source",sourceDataType:"content"}))),e&&e(n)}))}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest(),this.load((()=>this.map.style._clearSource(this.id)))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return t.extend({},this._options)}loadTile(e,i){const r=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme)),n={request:this.map._requestManager.transformRequest(r,t.ResourceType.Tile),data:void 0,uid:e.uid,tileID:e.tileID,tileZoom:e.tileZoom,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:t.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:e.isSymbolTile};if(n.request.collectResourceTiming=this._collectResourceTiming,e.actor&&"expired"!==e.state)"loading"===e.state?e.reloadCallback=i:e.request=e.actor.send("reloadTile",n,o.bind(this));else if(e.actor=this._tileWorkers[r]=this._tileWorkers[r]||this.dispatcher.getActor(),this.dispatcher.ready)e.request=e.actor.send("loadTile",n,o.bind(this),void 0,!0);else{const i=t.loadVectorTile.call({deduped:this._deduped},n,((t,i)=>{t||!i?o.call(this,t):(n.data={cacheControl:i.cacheControl,expires:i.expires,rawData:i.rawData.slice(0)},e.actor&&e.actor.send("loadTile",n,o.bind(this),void 0,!0))}),!0);e.request={cancel:i}}function o(r,n){return delete e.request,e.aborted?i(null):r&&404!==r.status?i(r):(n&&n.resourceTiming&&(e.resourceTiming=n.resourceTiming),this.map._refreshExpiredTiles&&n&&e.setExpiryData(n),e.loadVectorData(n,this.map.painter),t.cacheEntryPossiblyAdded(this.dispatcher),i(null),void(e.reloadCallback&&(this.loadTile(e,e.reloadCallback),e.reloadCallback=null)))}}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id})}unloadTile(t){t.unloadVectorData(),t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Et extends t.Evented{constructor(e,i,r,n){super(),this.id=e,this.dispatcher=r,this.setEventedParent(n),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=t.extend({type:"raster"},i),t.extend(this,t.pick(i,["url","scheme","tileSize"]))}load(e){this._loaded=!1,this.fire(new t.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=F(this._options,this.map._requestManager,null,null,((i,r)=>{this._tileJSONRequest=null,this._loaded=!0,i?this.fire(new t.ErrorEvent(i)):r&&(t.extend(this,r),r.bounds&&(this.tileBounds=new D(r.bounds,this.minzoom,this.maxzoom)),t.postTurnstileEvent(r.tiles),this.fire(new t.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new t.Event("data",{dataType:"source",sourceDataType:"content"}))),e&&e(i)}))}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest(),this.load((()=>this.map.style._clearSource(this.id)))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return t.extend({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(e,i){const r=t.exported.devicePixelRatio>=2,n=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme),r,this.tileSize);e.request=t.getImage(this.map._requestManager.transformRequest(n,t.ResourceType.Tile),((r,n,o,s)=>(delete e.request,e.aborted?(e.state="unloaded",i(null)):r?(e.state="errored",i(r)):n?(this.map._refreshExpiredTiles&&e.setExpiryData({cacheControl:o,expires:s}),e.setTexture(n,this.map.painter),e.state="loaded",t.cacheEntryPossiblyAdded(this.dispatcher),void i(null)):i(null))))}static loadTileData(t,e,i){t.setTexture(e,i)}static unloadTileData(t,e){t.texture&&e.saveTileTexture(t.texture)}abortTile(t,e){t.request&&(t.request.cancel(),delete t.request),e()}unloadTile(t,e){t.texture&&this.map.painter.saveTileTexture(t.texture),e()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function Ct(e,i,r,n,o,s,a,l){const c=[e,r,o,i,n,s,1,1,1],u=[a,l,1],h=t.adjoint([],c),[d,p,f]=t.transformMat3(u,u,t.transpose(h,h));return t.multiply$1(c,[d,0,0,0,p,0,0,0,f],c)}class St extends t.Evented{constructor(t,e,i,r){super(),this.id=t,this.dispatcher=i,this.coordinates=e.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(r),this.options=e,this._dirty=!1}load(e,i){this._loaded=i||!1,this.fire(new t.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._imageRequest=t.getImage(this.map._requestManager.transformRequest(this.url,t.ResourceType.Image),((i,r)=>{if(this._imageRequest=null,this._loaded=!0,i)this.fire(new t.ErrorEvent(i));else if(r){const{HTMLImageElement:i}=t.window;this.image=r instanceof i?t.exported.getImageData(r):r,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading()}}))}loaded(){return this._loaded}updateImage(t){return this.image&&t.url?(this._imageRequest&&t.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=t.url,this.load(t.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new t.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),this.texture&&this.texture.destroy()}setCoordinates(e){this.coordinates=e,this._boundsArray=void 0;const i=e.map(t.MercatorCoordinate.fromLngLat);return this.tileID=function(e){let i=1/0,r=1/0,n=-1/0,o=-1/0;for(const t of e)i=Math.min(i,t.x),r=Math.min(r,t.y),n=Math.max(n,t.x),o=Math.max(o,t.y);const s=Math.max(n-i,o-r),a=Math.max(0,Math.floor(-Math.log(s)/Math.LN2)),l=Math.pow(2,a);return new t.CanonicalTileID(a,Math.floor((i+n)/2*l),Math.floor((r+o)/2*l))}(i),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new t.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(e){for(const t in this.tiles){const e=this.tiles[t];"loaded"!==e.state&&(e.state="loaded",e.texture=this.texture)}if(this._boundsArray)return;const i=t.tileTransform(this.tileID,this.map.transform.projection),[r,n,o,s]=this.coordinates.map((e=>{const r=i.projection.project(e[0],e[1]);return t.getTilePoint(i,r)._round()}));this.perspectiveTransform=function(e,i,r,n,o,s,a,l,c,u){const h=Ct(0,0,e,0,0,i,e,i),d=Ct(r,n,o,s,a,l,c,u);return t.multiply$1(d,t.adjoint(h,h),d),[d[6]/d[8]*e/t.EXTENT,d[7]/d[8]*i/t.EXTENT]}(this.width,this.height,r.x,r.y,n.x,n.y,s.x,s.y,o.x,o.y);const a=this._boundsArray=new t.StructArrayLayout4i8;a.emplaceBack(r.x,r.y,0,0),a.emplaceBack(n.x,n.y,t.EXTENT,0),a.emplaceBack(s.x,s.y,0,t.EXTENT),a.emplaceBack(o.x,o.y,t.EXTENT,t.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=e.createVertexBuffer(a,t.boundsAttributes.members),this.boundsSegments=t.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const e=this.map.painter.context,i=e.gl;this._dirty&&(this.texture?this.texture.update(this.image):(this.texture=new t.Texture(e,this.image,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE)),this._dirty=!1),this._prepareData(e)}loadTile(t,e){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},e(null)):(t.state="errored",e(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const It={vector:Bt,raster:Et,"raster-dem":class extends Et{constructor(e,i,r,n){super(e,i,r,n),this.type="raster-dem",this.maxzoom=22,this._options=t.extend({type:"raster-dem"},i),this.encoding=i.encoding||"mapbox"}loadTile(e,i){const r=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function n(t,r){t&&(e.state="errored",i(t)),r&&(e.dem=r,e.dem.onDeserialize(),e.needsHillshadePrepare=!0,e.needsDEMTextureUpload=!0,e.state="loaded",i(null))}e.request=t.getImage(this.map._requestManager.transformRequest(r,t.ResourceType.Tile),function(r,o,s,a){if(delete e.request,e.aborted)e.state="unloaded",i(null);else if(r)e.state="errored",i(r);else if(o){this.map._refreshExpiredTiles&&e.setExpiryData({cacheControl:s,expires:a});const i=t.window.ImageBitmap&&o instanceof t.window.ImageBitmap&&(null==st&&(st=t.window.OffscreenCanvas&&new t.window.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof t.window.createImageBitmap),st),r=1-(o.width-t.prevPowerOfTwo(o.width))/2;r<1||e.neighboringTiles||(e.neighboringTiles=this._getNeighboringTiles(e.tileID));const l=i?o:t.exported.getImageData(o,r),c={uid:e.uid,coord:e.tileID,source:this.id,rawImageData:l,encoding:this.encoding,padding:r};e.actor&&"expired"!==e.state||(e.actor=this.dispatcher.getActor(),e.actor.send("loadDEMTile",c,n.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(e){const i=e.canonical,r=Math.pow(2,i.z),n=(i.x-1+r)%r,o=0===i.x?e.wrap-1:e.wrap,s=(i.x+1+r)%r,a=i.x+1===r?e.wrap+1:e.wrap,l={};return l[new t.OverscaledTileID(e.overscaledZ,o,i.z,n,i.y).key]={backfilled:!1},l[new t.OverscaledTileID(e.overscaledZ,a,i.z,s,i.y).key]={backfilled:!1},i.y>0&&(l[new t.OverscaledTileID(e.overscaledZ,o,i.z,n,i.y-1).key]={backfilled:!1},l[new t.OverscaledTileID(e.overscaledZ,e.wrap,i.z,i.x,i.y-1).key]={backfilled:!1},l[new t.OverscaledTileID(e.overscaledZ,a,i.z,s,i.y-1).key]={backfilled:!1}),i.y+1<r&&(l[new t.OverscaledTileID(e.overscaledZ,o,i.z,n,i.y+1).key]={backfilled:!1},l[new t.OverscaledTileID(e.overscaledZ,e.wrap,i.z,i.x,i.y+1).key]={backfilled:!1},l[new t.OverscaledTileID(e.overscaledZ,a,i.z,s,i.y+1).key]={backfilled:!1}),l}unloadTile(t){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded"}},geojson:class extends t.Evented{constructor(e,i,r,n){super(),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=r.getActor(),this.setEventedParent(n),this._data=i.data,this._options=t.extend({},i),this._collectResourceTiming=i.collectResourceTiming,void 0!==i.maxzoom&&(this.maxzoom=i.maxzoom),i.type&&(this.type=i.type),i.attribution&&(this.attribution=i.attribution),this.promoteId=i.promoteId;const o=t.EXTENT/this.tileSize;this.workerOptions=t.extend({source:this.id,cluster:i.cluster||!1,geojsonVtOptions:{buffer:(void 0!==i.buffer?i.buffer:128)*o,tolerance:(void 0!==i.tolerance?i.tolerance:.375)*o,extent:t.EXTENT,maxZoom:this.maxzoom,lineMetrics:i.lineMetrics||!1,generateId:i.generateId||!1},superclusterOptions:{maxZoom:void 0!==i.clusterMaxZoom?i.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,i.clusterMinPoints||2),extent:t.EXTENT,radius:(void 0!==i.clusterRadius?i.clusterRadius:50)*o,log:!1,generateId:i.generateId||!1},clusterProperties:i.clusterProperties,filter:i.filter},i.workerOptions)}onAdd(t){this.map=t,this.setData(this._data)}setData(t){return this._data=t,this._updateWorkerData(),this}getClusterExpansionZoom(t,e){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:t,source:this.id},e),this}getClusterChildren(t,e){return this.actor.send("geojson.getClusterChildren",{clusterId:t,source:this.id},e),this}getClusterLeaves(t,e,i,r){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:t,limit:e,offset:i},r),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new t.Event("dataloading",{dataType:"source"})),this._loaded=!1;const e=t.extend({},this.workerOptions),i=this._data;"string"==typeof i?(e.request=this.map._requestManager.transformRequest(t.exported.resolveURL(i),t.ResourceType.Source),e.request.collectResourceTiming=this._collectResourceTiming):e.data=JSON.stringify(i),this._pendingLoad=this.actor.send(`${this.type}.loadData`,e,((e,i)=>{if(this._loaded=!0,this._pendingLoad=null,e)this.fire(new t.ErrorEvent(e));else{const e={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&i&&i.resourceTiming&&i.resourceTiming[this.id]&&(e.resourceTiming=i.resourceTiming[this.id]),this.fire(new t.Event("data",e)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)}))}loaded(){return this._loaded}loadTile(e,i){const r=e.actor?"reloadTile":"loadTile";e.actor=this.actor,e.request=this.actor.send(r,{type:this.type,uid:e.uid,tileID:e.tileID,tileZoom:e.tileZoom,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:t.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},((t,n)=>(delete e.request,e.unloadVectorData(),e.aborted?i(null):t?i(t):(e.loadVectorData(n,this.map.painter,"reloadTile"===r),i(null)))),void 0,"loadTile"===r)}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.aborted=!0}unloadTile(t){t.unloadVectorData(),this.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return t.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends St{constructor(t,e,i,r){super(t,e,i,r),this.roundZoom=!0,this.type="video",this.options=e}load(){this._loaded=!1;const e=this.options;this.urls=[];for(const i of e.urls)this.urls.push(this.map._requestManager.transformRequest(i,t.ResourceType.Source).url);t.getVideo(this.urls,((e,i)=>{this._loaded=!0,e?this.fire(new t.ErrorEvent(e)):i&&(this.video=i,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading())}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){const i=this.video.seekable;e<i.start(0)||e>i.end(0)?this.fire(new t.ErrorEvent(new t.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${i.start(0)} and ${i.end(0)}-second mark.`))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const e=this.map.painter.context,i=e.gl;this.texture?this.video.paused||(this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),i.texSubImage2D(i.TEXTURE_2D,0,0,0,i.RGBA,i.UNSIGNED_BYTE,this.video)):(this.texture=new t.Texture(e,this.video,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(e)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:St,canvas:class extends St{constructor(e,i,r,n){super(e,i,r,n),i.coordinates?Array.isArray(i.coordinates)&&4===i.coordinates.length&&!i.coordinates.some((t=>!Array.isArray(t)||2!==t.length||t.some((t=>"number"!=typeof t))))||this.fire(new t.ErrorEvent(new t.ValidationError(`sources.${e}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new t.ErrorEvent(new t.ValidationError(`sources.${e}`,null,'missing required property "coordinates"'))),i.animate&&"boolean"!=typeof i.animate&&this.fire(new t.ErrorEvent(new t.ValidationError(`sources.${e}`,null,'optional "animate" property must be a boolean value'))),i.canvas?"string"==typeof i.canvas||i.canvas instanceof t.window.HTMLCanvasElement||this.fire(new t.ErrorEvent(new t.ValidationError(`sources.${e}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new t.ErrorEvent(new t.ValidationError(`sources.${e}`,null,'missing required property "canvas"'))),this.options=i,this.animate=void 0===i.animate||i.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof t.window.HTMLCanvasElement?this.options.canvas:t.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new t.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions())return;if(0===Object.keys(this.tiles).length)return;const i=this.map.painter.context;this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new t.Texture(i,this.canvas,i.gl.RGBA,{premultiply:!0}),this._prepareData(i)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const t of[this.canvas.width,this.canvas.height])if(isNaN(t)||t<=0)return!0;return!1}},custom:class extends t.Evented{constructor(e,i,r,n){super(),this.id=e,this.type="custom",this._dataType="raster",this._dispatcher=r,this._implementation=i,this.setEventedParent(n),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new t.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new t.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new D(this._implementation.bounds,this.minzoom,this.maxzoom)),i.update=this._update.bind(this),i.clearTiles=this._clearTiles.bind(this),i.coveringTiles=this._coveringTiles.bind(this),t.extend(this,t.pick(i,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return t.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new t.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new t.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(e){this._map=e,this._loaded=!1,this.fire(new t.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(e),this.load()}onRemove(t){this._implementation.onRemove&&this._implementation.onRemove(t)}hasTile(t){if(this._implementation.hasTile){const{x:e,y:i,z:r}=t.canonical;return this._implementation.hasTile({x:e,y:i,z:r})}return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(e,i){const{x:r,y:n,z:o}=e.tileID.canonical,s=new t.window.AbortController;e.request=Promise.resolve(this._implementation.loadTile({x:r,y:n,z:o},{signal:s.signal})).then(function(r){return delete e.request,e.aborted?(e.state="unloaded",i(null)):void 0===r?(e.state="errored",i(null)):null===r?(this.loadTileData(e,{width:this.tileSize,height:this.tileSize,data:null}),e.state="loaded",i(null)):function(e){return e instanceof t.window.ImageData||e instanceof t.window.HTMLCanvasElement||e instanceof t.window.ImageBitmap||e instanceof t.window.HTMLImageElement}(r)?(this.loadTileData(e,r),e.state="loaded",void i(null)):(e.state="errored",i(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}.bind(this)).catch((t=>{20!==t.code&&(e.state="errored",i(t))})),e.request.cancel=()=>s.abort()}loadTileData(t,e){Et.loadTileData(t,e,this._map.painter)}unloadTileData(t){Et.unloadTileData(t,this._map.painter)}unloadTile(t,e){if(this.unloadTileData(t),this._implementation.unloadTile){const{x:e,y:i,z:r}=t.tileID.canonical;this._implementation.unloadTile({x:e,y:i,z:r})}e()}abortTile(t,e){t.request&&t.request.cancel&&(t.request.cancel(),delete t.request),e()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map((t=>({x:t.canonical.x,y:t.canonical.y,z:t.canonical.z})))}_clearTiles(){this._map.style._clearSource(this.id)}_update(){this.fire(new t.Event("data",{dataType:"source",sourceDataType:"content"}))}}},Mt=function(e,i,r,n){const o=new It[i.type](e,i,r,n);if(o.id!==e)throw new Error(`Expected Source id to be ${e} instead of ${o.id}`);return t.bindAll(["load","abort","unload","serialize","prepare"],o),o};function kt(e,i){const r=t.identity([]);return t.scale(r,r,[.5*e.width,.5*-e.height,1]),t.translate(r,r,[1,-1,0]),t.multiply(r,r,e.calculateProjMatrix(i.toUnwrapped())),Float32Array.from(r)}function Pt(t,e,i,r,n,o,s,a=!1){const l=t.tilesIn(r,s,a);l.sort(zt);const c=[];for(const r of l)c.push({wrappedTileID:r.tile.tileID.wrapped().key,queryResults:r.tile.queryRenderedFeatures(e,i,t._state,r,n,o,kt(t.transform,r.tile.tileID),a)});const u=function(t){const e={},i={};for(const r of t){const t=r.queryResults,n=r.wrappedTileID,o=i[n]=i[n]||{};for(const i in t){const r=t[i],n=o[i]=o[i]||{},s=e[i]=e[i]||[];for(const t of r)n[t.featureIndex]||(n[t.featureIndex]=!0,s.push(t))}}return e}(c);for(const e in u)u[e].forEach((e=>{const i=e.feature,r=i.layer;r&&"background"!==r.type&&"sky"!==r.type&&(i.source=r.source,r["source-layer"]&&(i.sourceLayer=r["source-layer"]),i.state=void 0!==i.id?t.getFeatureState(r["source-layer"],i.id):{})}));return u}function Lt(t,e){const i=t.getRenderableIds().map((e=>t.getTileByID(e))),r=[],n={};for(let t=0;t<i.length;t++){const o=i[t],s=o.tileID.canonical.key;n[s]||(n[s]=!0,o.querySourceFeatures(r,e))}return r}function zt(t,e){const i=t.tileID,r=e.tileID;return i.overscaledZ-r.overscaledZ||i.canonical.y-r.canonical.y||i.wrap-r.wrap||i.canonical.x-r.canonical.x}function Ft(){return null!=po.workerClass?new po.workerClass:new t.window.Worker(po.workerUrl)}const Dt="mapboxgl_preloaded_worker_pool";class Rt{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<Rt.workerCount;)this.workers.push(new Ft);return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],0===this.numActive()&&(this.workers.forEach((t=>{t.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[Dt]}numActive(){return Object.keys(this.active).length}}let Ut;function Ot(){return Ut||(Ut=new Rt),Ut}function Nt(e,i){const r={};for(const t in e)"ref"!==t&&(r[t]=e[t]);return t.refProperties.forEach((t=>{t in i&&(r[t]=i[t])})),r}function Qt(t){t=t.slice();const e=Object.create(null);for(let i=0;i<t.length;i++)e[t[i].id]=t[i];for(let i=0;i<t.length;i++)"ref"in t[i]&&(t[i]=Nt(t[i],e[t[i].ref]));return t}Rt.workerCount=2;const Vt={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function jt(t,e,i){i.push({command:Vt.addSource,args:[t,e[t]]})}function Ht(t,e,i){e.push({command:Vt.removeSource,args:[t]}),i[t]=!0}function Gt(t,e,i,r){Ht(t,i,r),jt(t,e,i)}function $t(t,i,r){let n;for(n in t[r])if(t[r].hasOwnProperty(n)&&"data"!==n&&!e(t[r][n],i[r][n]))return!1;for(n in i[r])if(i[r].hasOwnProperty(n)&&"data"!==n&&!e(t[r][n],i[r][n]))return!1;return!0}function Zt(t,i,r,n,o,s){let a;for(a in i=i||{},t=t||{})t.hasOwnProperty(a)&&(e(t[a],i[a])||r.push({command:s,args:[n,a,i[a],o]}));for(a in i)i.hasOwnProperty(a)&&!t.hasOwnProperty(a)&&(e(t[a],i[a])||r.push({command:s,args:[n,a,i[a],o]}))}function qt(t){return t.id}function Kt(t,e){return t[e.id]=e,t}class Wt{constructor(t,e){this.reset(t,e)}reset(t,e){this.points=t||[],this._distances=[0];for(let t=1;t<this.points.length;t++)this._distances[t]=this._distances[t-1]+this.points[t].dist(this.points[t-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(e||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(1===this.points.length)return this.points[0];e=t.clamp(e,0,1);let i=1,r=this._distances[i];const n=e*this.paddedLength+this.padding;for(;r<n&&i<this._distances.length;)r=this._distances[++i];const o=i-1,s=this._distances[o],a=r-s,l=a>0?(n-s)/a:0;return this.points[o].mult(1-l).add(this.points[i].mult(l))}}class Xt{constructor(t,e,i){const r=this.boxCells=[],n=this.circleCells=[];this.xCellCount=Math.ceil(t/i),this.yCellCount=Math.ceil(e/i);for(let t=0;t<this.xCellCount*this.yCellCount;t++)r.push([]),n.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=e,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/e,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,e,i,r,n){this._forEachCell(e,i,r,n,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(e),this.bboxes.push(i),this.bboxes.push(r),this.bboxes.push(n)}insertCircle(t,e,i,r){this._forEachCell(e-r,i-r,e+r,i+r,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(e),this.circles.push(i),this.circles.push(r)}_insertBoxCell(t,e,i,r,n,o){this.boxCells[n].push(o)}_insertCircleCell(t,e,i,r,n,o){this.circleCells[n].push(o)}_query(t,e,i,r,n,o){if(i<0||t>this.width||r<0||e>this.height)return!n&&[];const s=[];if(t<=0&&e<=0&&this.width<=i&&this.height<=r){if(n)return!0;for(let t=0;t<this.boxKeys.length;t++)s.push({key:this.boxKeys[t],x1:this.bboxes[4*t],y1:this.bboxes[4*t+1],x2:this.bboxes[4*t+2],y2:this.bboxes[4*t+3]});for(let t=0;t<this.circleKeys.length;t++){const e=this.circles[3*t],i=this.circles[3*t+1],r=this.circles[3*t+2];s.push({key:this.circleKeys[t],x1:e-r,y1:i-r,x2:e+r,y2:i+r})}return o?s.filter(o):s}return this._forEachCell(t,e,i,r,this._queryCell,s,{hitTest:n,seenUids:{box:{},circle:{}}},o),n?s.length>0:s}_queryCircle(t,e,i,r,n){const o=t-i,s=t+i,a=e-i,l=e+i;if(s<0||o>this.width||l<0||a>this.height)return!r&&[];const c=[];return this._forEachCell(o,a,s,l,this._queryCellCircle,c,{hitTest:r,circle:{x:t,y:e,radius:i},seenUids:{box:{},circle:{}}},n),r?c.length>0:c}query(t,e,i,r,n){return this._query(t,e,i,r,!1,n)}hitTest(t,e,i,r,n){return this._query(t,e,i,r,!0,n)}hitTestCircle(t,e,i,r){return this._queryCircle(t,e,i,!0,r)}_queryCell(t,e,i,r,n,o,s,a){const l=s.seenUids,c=this.boxCells[n];if(null!==c){const n=this.bboxes;for(const u of c)if(!l.box[u]){l.box[u]=!0;const c=4*u;if(t<=n[c+2]&&e<=n[c+3]&&i>=n[c+0]&&r>=n[c+1]&&(!a||a(this.boxKeys[u]))){if(s.hitTest)return o.push(!0),!0;o.push({key:this.boxKeys[u],x1:n[c],y1:n[c+1],x2:n[c+2],y2:n[c+3]})}}}const u=this.circleCells[n];if(null!==u){const n=this.circles;for(const c of u)if(!l.circle[c]){l.circle[c]=!0;const u=3*c;if(this._circleAndRectCollide(n[u],n[u+1],n[u+2],t,e,i,r)&&(!a||a(this.circleKeys[c]))){if(s.hitTest)return o.push(!0),!0;{const t=n[u],e=n[u+1],i=n[u+2];o.push({key:this.circleKeys[c],x1:t-i,y1:e-i,x2:t+i,y2:e+i})}}}}}_queryCellCircle(t,e,i,r,n,o,s,a){const l=s.circle,c=s.seenUids,u=this.boxCells[n];if(null!==u){const t=this.bboxes;for(const e of u)if(!c.box[e]){c.box[e]=!0;const i=4*e;if(this._circleAndRectCollide(l.x,l.y,l.radius,t[i+0],t[i+1],t[i+2],t[i+3])&&(!a||a(this.boxKeys[e])))return o.push(!0),!0}}const h=this.circleCells[n];if(null!==h){const t=this.circles;for(const e of h)if(!c.circle[e]){c.circle[e]=!0;const i=3*e;if(this._circlesCollide(t[i],t[i+1],t[i+2],l.x,l.y,l.radius)&&(!a||a(this.circleKeys[e])))return o.push(!0),!0}}}_forEachCell(t,e,i,r,n,o,s,a){const l=this._convertToXCellCoord(t),c=this._convertToYCellCoord(e),u=this._convertToXCellCoord(i),h=this._convertToYCellCoord(r);for(let d=l;d<=u;d++)for(let l=c;l<=h;l++)if(n.call(this,t,e,i,r,this.xCellCount*l+d,o,s,a))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,e,i,r,n,o){const s=r-t,a=n-e,l=i+o;return l*l>s*s+a*a}_circleAndRectCollide(t,e,i,r,n,o,s){const a=(o-r)/2,l=Math.abs(t-(r+a));if(l>a+i)return!1;const c=(s-n)/2,u=Math.abs(e-(n+c));if(u>c+i)return!1;if(l<=a||u<=c)return!0;const h=l-a,d=u-c;return h*h+d*d<=i*i}}const Jt={unknown:0,flipRequired:1,flipNotRequired:2},Yt=Math.tan(85*Math.PI/180);function te(e,i,r,n,o,s,a){const l=t.create();if(r)if("globe"===s.name){const e=t.calculateGlobeLabelMatrix(o,i);t.multiply(l,l,e)}else{const e=_([],a);l[0]=e[0],l[1]=e[1],l[4]=e[2],l[5]=e[3],n||t.rotateZ(l,l,o.angle)}else t.multiply(l,o.labelPlaneMatrix,e);return l}function ee(t,e,i,r,n,o,s){const a=te(t,e,i,r,n,o,s);return"globe"===o.name&&i||(a[2]=a[6]=a[10]=a[14]=0),a}function ie(e,i,r,n,o,s,a){if(r){if("globe"===s.name){const l=te(e,i,r,n,o,s,a);return t.invert(l,l),t.multiply(l,e,l),l}{const i=t.clone(e),r=t.identity([]);return r[0]=a[0],r[1]=a[1],r[4]=a[2],r[5]=a[3],t.multiply(i,i,r),n||t.rotateZ(i,i,-o.angle),i}}return o.glCoordMatrix}function re(e,i,r,n){const o=[e,i,r,1];r?t.transformMat4$1(o,o,n):fe(o,o,n);const s=o[3];return o[0]/=s,o[1]/=s,o[2]/=s,o}function ne(t,e){return Math.min(.5+t/e*.5,1.5)}function oe(t,e){const i=t[0]/t[3],r=t[1]/t[3];return i>=-e[0]&&i<=e[0]&&r>=-e[1]&&r<=e[1]}function se(e,i,r,n,o,s,a,l,c,u){const h=r.transform,d=n?e.textSizeData:e.iconSizeData,p=t.evaluateSizeForZoom(d,r.transform.zoom),f="globe"===h.projection.name,A=[256/r.width*2+1,256/r.height*2+1],m=n?e.text.dynamicLayoutVertexArray:e.icon.dynamicLayoutVertexArray;m.clear();let g=null;f&&(g=n?e.text.globeExtVertexArray:e.icon.globeExtVertexArray);const _=e.lineVertexArray,y=n?e.text.placedSymbolArray:e.icon.placedSymbolArray,v=r.transform.width/r.transform.height;let x,b=!1;for(let n=0;n<y.length;n++){const f=y.get(n),{numGlyphs:w,writingMode:T}=f;if(T!==t.WritingMode.vertical||b||x===t.WritingMode.horizontal||(b=!0),x=T,(f.hidden||T===t.WritingMode.vertical)&&!b){pe(w,m);continue}b=!1;const B=new t.Point(f.tileAnchorX,f.tileAnchorY);let{x:E,y:C,z:S}=h.projection.projectTilePoint(B.x,B.y,u.canonical);if(c){const[t,e,i]=c(B);E+=t,C+=e,S+=i}const I=[E,C,S,1];if(t.transformMat4$1(I,I,i),!oe(I,A)){pe(w,m);continue}const M=ne(r.transform.cameraToCenterDistance,I[3]),k=t.evaluateSizeForFeature(d,p,f),P=a?k/M:k*M,L=re(E,C,S,o);if(L[3]<=0){pe(w,m);continue}let z={};const F=a?null:c,D=ce(f,P,!1,l,i,o,s,e.glyphOffsetArray,_,m,g,L,B,z,v,F,h.projection,u,a);b=D.useVertical,F&&D.needsFlipping&&(z={}),(D.notEnoughRoom||b||D.needsFlipping&&ce(f,P,!0,l,i,o,s,e.glyphOffsetArray,_,m,g,L,B,z,v,F,h.projection,u,a).notEnoughRoom)&&pe(w,m)}n?(e.text.dynamicLayoutVertexBuffer.updateData(m),g&&e.text.globeExtVertexBuffer.updateData(g)):(e.icon.dynamicLayoutVertexBuffer.updateData(m),g&&e.icon.globeExtVertexBuffer.updateData(g))}function ae(t,e,i,r,n,o,s,a,l,c,u,h,d,p,f,A){const{lineStartIndex:m,glyphStartIndex:g,segment:_}=a,y=g+a.numGlyphs,v=m+a.lineLength,x=e.getoffsetX(g),b=e.getoffsetX(y-1),w=de(t*x,i,r,n,o,s,_,m,v,l,c,u,h,d,!0,p,f,A);if(!w)return null;const T=de(t*b,i,r,n,o,s,_,m,v,l,c,u,h,d,!0,p,f,A);return T?{first:w,last:T}:null}function le(e,i,r,n){return e===t.WritingMode.horizontal&&Math.abs(n)>Math.abs(r)?{useVertical:!0}:e===t.WritingMode.vertical?n>0?{needsFlipping:!0}:null:i!==Jt.unknown&&function(t,e){return 0===t||Math.abs(e/t)>Yt}(r,n)?i===Jt.flipRequired?{needsFlipping:!0}:null:r<0?{needsFlipping:!0}:null}function ce(e,i,r,n,o,s,a,l,c,u,h,d,p,f,A,m,g,_,y){const v=i/24,x=e.lineOffsetX*v,b=e.lineOffsetY*v,{lineStartIndex:w,glyphStartIndex:T,numGlyphs:B,segment:E,writingMode:C,flipState:S}=e,I=w+e.lineLength,M=e=>{if(h){const[i,r,n]=e.up,o=u.length;t.updateGlobeVertexNormal(h,o+0,i,r,n),t.updateGlobeVertexNormal(h,o+1,i,r,n),t.updateGlobeVertexNormal(h,o+2,i,r,n),t.updateGlobeVertexNormal(h,o+3,i,r,n)}const[i,r,n]=e.point;t.addDynamicAttributes(u,i,r,n,e.angle)};if(B>1){const t=ae(v,l,x,b,r,d,p,e,c,s,f,m,!1,g,_,y);if(!t)return{notEnoughRoom:!0};if(n&&!r){let[i,r,n]=t.first.point,[o,s,l]=t.last.point;[i,r]=re(i,r,n,a),[o,s]=re(o,s,l,a);const c=le(C,S,(o-i)*A,s-r);if(e.flipState=c&&c.needsFlipping?Jt.flipRequired:Jt.flipNotRequired,c)return c}M(t.first);for(let t=T+1;t<T+B-1;t++){const e=de(v*l.getoffsetX(t),x,b,r,d,p,E,w,I,c,s,f,m,!1,!1,g,_,y);if(!e)return u.length-=4*(t-T),{notEnoughRoom:!0};M(e)}M(t.last)}else{if(n&&!r){const i=re(p.x,p.y,0,o),r=w+E+1,n=new t.Point(c.getx(r),c.gety(r)),s=re(n.x,n.y,0,o),a=s[3]>0?s:he(p,n,i,1,o,void 0,g,_.canonical),l=le(C,S,(a[0]-i[0])*A,a[1]-i[1]);if(e.flipState=l&&l.needsFlipping?Jt.flipRequired:Jt.flipNotRequired,l)return l}const i=de(v*l.getoffsetX(T),x,b,r,d,p,E,w,I,c,s,f,m,!1,!1,g,_,y);if(!i)return{notEnoughRoom:!0};M(i)}return{}}function ue(t,e,i,r,n){const{x:o,y:s,z:a}=r.projectTilePoint(t.x,t.y,e);if(!n)return re(o,s,a,i);const[l,c,u]=n(t);return re(o+l,s+c,a+u,i)}function he(e,i,r,n,o,s,a,l){const c=ue(e.sub(i)._unit()._add(e),l,o,a,s);return t.sub(c,r,c),t.normalize(c,c),t.scaleAndAdd(c,r,c,n)}function de(e,i,r,n,o,s,a,l,c,u,h,d,p,f,A,m,g,_){const y=n?e-i:e+i;let v=y>0?1:-1,x=0;n&&(v*=-1,x=Math.PI),v<0&&(x+=Math.PI);let b=l+a+(v>0?0:1)|0,w=o,T=o,B=0,E=0;const C=Math.abs(y),S=[],I=[];let M=s,k=M;const P=()=>he(k,M,T,C-B+1,h,p,m,g.canonical);for(;B+E<=C;){if(b+=v,b<l||b>=c)return null;if(T=w,k=M,S.push(T),f&&I.push(k),M=new t.Point(u.getx(b),u.gety(b)),w=d[b],!w){const t=ue(M,g.canonical,h,m,p);w=t[3]>0?d[b]=t:P()}B+=E,E=t.distance(T,w)}A&&p&&(d[b]&&(w=P(),E=t.distance(T,w)),d[b]=w);const L=(C-B)/E,z=M.sub(k)._mult(L)._add(k),F=t.sub([],w,T),D=t.scaleAndAdd([],T,F,L);let R=[0,0,1],U=F[0],O=F[1];if(_&&(R=m.upVector(g.canonical,z.x,z.y),0!==R[0]||0!==R[1]||1!==R[2])){const e=[R[2],0,-R[0]],i=t.cross([],R,e);t.normalize(e,e),t.normalize(i,i),U=t.dot(F,e),O=t.dot(F,i)}if(r){const e=t.cross([],R,F);t.normalize(e,e),t.scaleAndAdd(D,D,e,r*v)}const N=x+Math.atan2(O,U);return S.push(D),f&&I.push(z),{point:D,angle:N,path:S,tilePath:I,up:R}}function pe(t,e){const i=e.length,r=i+4*t;e.resize(r),e.float32.fill(-1/0,4*i,4*r)}function fe(t,e,i){const r=e[0],n=e[1];return t[0]=i[0]*r+i[4]*n+i[12],t[1]=i[1]*r+i[5]*n+i[13],t[3]=i[3]*r+i[7]*n+i[15],t}const Ae=100;class me{constructor(t,e,i=new Xt(t.width+200,t.height+200,25),r=new Xt(t.width+200,t.height+200,25)){this.transform=t,this.grid=i,this.ignoredGrid=r,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+Ae,this.screenBottomBoundary=t.height+Ae,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.fogState=e}placeCollisionBox(t,e,i,r,n,o,s,a){let l=i.projectedAnchorX,c=i.projectedAnchorY,u=i.projectedAnchorZ;const h=i.elevation,d=i.tileID,p=t.getProjection();if(h&&d){const[t,e,r]=p.upVector(d.canonical,i.tileAnchorX,i.tileAnchorY),n=p.upVectorScale(d.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;l+=t*h*n,c+=e*h*n,u+=r*h*n}const f=this.projectAndGetPerspectiveRatio(s,l,c,u,i.tileID,"globe"===p.name||!!h||this.transform.pitch>0,p),A=o*f.perspectiveRatio,m=(i.x1*e+r.x-i.padding)*A+f.point.x,g=(i.y1*e+r.y-i.padding)*A+f.point.y,_=(i.x2*e+r.x+i.padding)*A+f.point.x,y=(i.y2*e+r.y+i.padding)*A+f.point.y,v=f.perspectiveRatio<=.55||f.occluded;return!this.isInsideGrid(m,g,_,y)||!n&&this.grid.hitTest(m,g,_,y,a)||v?{box:[],offscreen:!1,occluded:f.occluded}:{box:[m,g,_,y],offscreen:this.isOffscreen(m,g,_,y),occluded:!1}}placeCollisionCircles(e,i,r,n,o,s,a,l,c,u,h,d,p,f,A){const m=[],g=this.transform.elevation,_=e.getProjection(),y=g?g.getAtTileOffsetFunc(A,this.transform.center.lat,this.transform.worldSize,_):null,v=new t.Point(r.tileAnchorX,r.tileAnchorY);let{x:x,y:b,z:w}=_.projectTilePoint(v.x,v.y,A.canonical);if(y){const[t,e,i]=y(v);x+=t,b+=e,w+=i}const T="globe"===_.name,B=this.projectAndGetPerspectiveRatio(a,x,b,w,A,T||!!g||this.transform.pitch>0,_),{perspectiveRatio:E}=B,C=(h?s/E:s*E)/t.ONE_EM,S=re(x,b,w,l),I=B.signedDistanceFromCamera>0?ae(C,o,r.lineOffsetX*C,r.lineOffsetY*C,!1,S,v,r,n,l,{},g&&!h?y:null,h&&!!g,_,A,h):null;let M=!1,k=!1,P=!0;if(I&&!B.occluded){const e=.5*p*E+f,r=new t.Point(-100,-100),n=new t.Point(this.screenRightBoundary,this.screenBottomBoundary),o=new Wt,{first:s,last:a}=I,l=s.path.length;let h=[];for(let t=l-1;t>=1;t--)h.push(s.path[t]);for(let t=1;t<a.path.length;t++)h.push(a.path[t]);const A=2.5*e;c&&(h=h.map((([t,e,i],r)=>(y&&!T&&(i=y(r<l-1?s.tilePath[l-1-r]:a.tilePath[r-l+2])[2]),re(t,e,i,c)))),h.some((t=>t[3]<=0))&&(h=[]));let g=[];if(h.length>0){let e=1/0,i=-1/0,o=1/0,s=-1/0;for(const t of h)e=Math.min(e,t[0]),o=Math.min(o,t[1]),i=Math.max(i,t[0]),s=Math.max(s,t[1]);i>=r.x&&e<=n.x&&s>=r.y&&o<=n.y&&(g=[h.map((e=>new t.Point(e[0],e[1])))],(e<r.x||i>n.x||o<r.y||s>n.y)&&(g=t.clipLine(g,r.x,r.y,n.x,n.y)))}for(const t of g){o.reset(t,.25*e);let r=0;r=o.length<=.5*e?1:Math.ceil(o.paddedLength/A)+1;for(let t=0;t<r;t++){const n=t/Math.max(r-1,1),s=o.lerp(n),a=s.x+Ae,l=s.y+Ae;m.push(a,l,e,0);const c=a-e,h=l-e,p=a+e,f=l+e;if(P=P&&this.isOffscreen(c,h,p,f),k=k||this.isInsideGrid(c,h,p,f),!i&&this.grid.hitTestCircle(a,l,e,d)&&(M=!0,!u))return{circles:[],offscreen:!1,collisionDetected:M,occluded:!1}}}}return{circles:!u&&M||!k?[]:m,offscreen:P,collisionDetected:M,occluded:B.occluded}}queryRenderedSymbols(e){if(0===e.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const i=[];let r=1/0,n=1/0,o=-1/0,s=-1/0;for(const a of e){const e=new t.Point(a.x+Ae,a.y+Ae);r=Math.min(r,e.x),n=Math.min(n,e.y),o=Math.max(o,e.x),s=Math.max(s,e.y),i.push(e)}const a=this.grid.query(r,n,o,s).concat(this.ignoredGrid.query(r,n,o,s)),l={},c={};for(const e of a){const r=e.key;if(void 0===l[r.bucketInstanceId]&&(l[r.bucketInstanceId]={}),l[r.bucketInstanceId][r.featureIndex])continue;const n=[new t.Point(e.x1,e.y1),new t.Point(e.x2,e.y1),new t.Point(e.x2,e.y2),new t.Point(e.x1,e.y2)];t.polygonIntersectsPolygon(i,n)&&(l[r.bucketInstanceId][r.featureIndex]=!0,void 0===c[r.bucketInstanceId]&&(c[r.bucketInstanceId]=[]),c[r.bucketInstanceId].push(r.featureIndex))}return c}insertCollisionBox(t,e,i,r,n){(e?this.ignoredGrid:this.grid).insert({bucketInstanceId:i,featureIndex:r,collisionGroupID:n},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,e,i,r,n){const o=e?this.ignoredGrid:this.grid,s={bucketInstanceId:i,featureIndex:r,collisionGroupID:n};for(let e=0;e<t.length;e+=4)o.insertCircle(s,t[e],t[e+1],t[e+2])}projectAndGetPerspectiveRatio(e,i,r,n,o,s,a){const l=[i,r,n,1];let c=!1;if(n||this.transform.pitch>0){if(t.transformMat4$1(l,l,e),this.fogState&&o&&"globe"!==a.name){const e=function(e,i,r,n,o,s){const a=s.calculateFogTileMatrix(o),l=[i,r,n];return t.transformMat4(l,l,a),B(e,l,s.pitch,s._fov)}(this.fogState,i,r,n,o.toUnwrapped(),this.transform);c=e>.9}}else fe(l,l,e);const u=l[3];return{point:new t.Point((l[0]/u+1)/2*this.transform.width+Ae,(-l[1]/u+1)/2*this.transform.height+Ae),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(a)/u*.5,1.5),signedDistanceFromCamera:u,occluded:s&&l[2]>u||c}}isOffscreen(t,e,i,r){return i<Ae||t>=this.screenRightBoundary||r<Ae||e>this.screenBottomBoundary}isInsideGrid(t,e,i,r){return i>=0&&t<this.gridRightBoundary&&r>=0&&e<this.gridBottomBoundary}getViewportMatrix(){const e=t.identity([]);return t.translate(e,e,[-100,-100,0]),e}}function ge(e,i,r){const n=i.createTileMatrix(e,e.worldSize,r.toUnwrapped());return t.multiply(new Float32Array(16),e.projMatrix,n)}function _e(t,e,i){if(e.projection.name===i.projection.name)return t.projMatrix;const r=i.clone();return r.setProjection(e.projection),ge(r,e.getProjection(),t)}function ye(t,e,i){return e.name===i.projection.name?t.projMatrix:ge(i,e,t)}class ve{constructor(t,e,i,r){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?e:-e))):r&&i?1:0,this.placed=i}isHidden(){return 0===this.opacity&&!this.placed}}class xe{constructor(t,e,i,r,n,o=!1){this.text=new ve(t?t.text:null,e,i,n),this.icon=new ve(t?t.icon:null,e,r,n),this.clipped=o}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class be{constructor(t,e,i,r=!1){this.text=t,this.icon=e,this.skipFade=i,this.clipped=r}}class we{constructor(){this.invProjMatrix=t.create(),this.viewportMatrix=t.create(),this.circles=[]}}class Te{constructor(t,e,i,r,n){this.bucketInstanceId=t,this.featureIndex=e,this.sourceLayerIndex=i,this.bucketIndex=r,this.tileID=n}}class Be{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const e=++this.maxGroupID;this.collisionGroups[t]={ID:e,predicate:t=>t.collisionGroupID===e}}return this.collisionGroups[t]}}function Ee(e,i,r,n,o){const{horizontalAlign:s,verticalAlign:a}=t.getAnchorAlignment(e),l=-(s-.5)*i,c=-(a-.5)*r,u=t.evaluateVariableOffset(e,n);return new t.Point(l+u[0]*o,c+u[1]*o)}function Ce(e,i,r,n,o){const s=new t.Point(e,i);return r&&s._rotate(n?o:-o),s}class Se{constructor(t,e,i,r,n){this.transform=t.clone(),this.projection=t.projection.name,this.collisionIndex=new me(this.transform,n),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=e,this.retainedQueryData={},this.collisionGroups=new Be(i),this.collisionCircleArrays={},this.prevPlacement=r,r&&(r.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(e,i,r,n){const o=r.getBucket(i),s=r.latestFeatureIndex;if(!o||!s||i.id!==o.layerIds[0])return;const a=o.layers[0].layout,l=r.collisionBoxArray,c=Math.pow(2,this.transform.zoom-r.tileID.overscaledZ),u=r.tileSize/t.EXTENT,h=r.tileID.toUnwrapped();this.transform.setProjection(o.projection);const d=(p=r.tileID,f=o.getProjection(),A=this.transform,f.name===this.projection?A.calculateProjMatrix(p.toUnwrapped()):ge(A,f,p));var p,f,A;const m="map"===a.get("text-pitch-alignment"),g="map"===a.get("text-rotation-alignment");i.compileFilter();const _=i.dynamicFilter(),y=i.dynamicFilterNeedsFeature(),v=this.transform.calculatePixelsToTileUnitsMatrix(r),x=ee(d,r.tileID.canonical,m,g,this.transform,o.getProjection(),v);let b=null;if(m){const e=ie(d,r.tileID.canonical,m,g,this.transform,o.getProjection(),v);b=t.multiply([],this.transform.labelPlaneMatrix,e)}let w=null;_&&r.latestFeatureIndex&&(w={unwrappedTileID:h,dynamicFilter:_,dynamicFilterNeedsFeature:y,featureIndex:r.latestFeatureIndex}),this.retainedQueryData[o.bucketInstanceId]=new Te(o.bucketInstanceId,s,o.sourceLayerIndex,o.index,r.tileID);const T={bucket:o,layout:a,posMatrix:d,textLabelPlaneMatrix:x,labelToScreenMatrix:b,clippingData:w,scale:c,textPixelRatio:u,holdingForFade:r.holdingForFade(),collisionBoxArray:l,partiallyEvaluatedTextSize:t.evaluateSizeForZoom(o.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:t.evaluateSizeForZoom(o.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(o.sourceID)};if(n)for(const t of o.sortKeyRanges){const{sortKey:i,symbolInstanceStart:r,symbolInstanceEnd:n}=t;e.push({sortKey:i,symbolInstanceStart:r,symbolInstanceEnd:n,parameters:T})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:o.symbolInstances.length,parameters:T})}attemptAnchorPlacement(t,e,i,r,n,o,s,a,l,c,u,h,d,p,f,A,m,g){const{textOffset0:_,textOffset1:y,crossTileID:v}=h,x=[_,y],b=Ee(t,i,r,x,n),w=this.collisionIndex.placeCollisionBox(p,n,e,Ce(b.x,b.y,o,s,this.transform.angle),u,a,l,c.predicate);if(A){const t=p.getSymbolInstanceIconSize(g,this.transform.zoom,h.placedIconSymbolIndex);if(0===this.collisionIndex.placeCollisionBox(p,t,A,Ce(b.x,b.y,o,s,this.transform.angle),u,a,l,c.predicate).box.length)return}if(w.box.length>0){let e;return this.prevPlacement&&this.prevPlacement.variableOffsets[v]&&this.prevPlacement.placements[v]&&this.prevPlacement.placements[v].text&&(e=this.prevPlacement.variableOffsets[v].anchor),this.variableOffsets[v]={textOffset:x,width:i,height:r,anchor:t,textScale:n,prevAnchor:e},this.markUsedJustification(p,t,h,f),p.allowVerticalPlacement&&(this.markUsedOrientation(p,f,h),this.placedOrientations[v]=f),{shift:b,placedGlyphBoxes:w}}}placeLayerBucketPart(e,i,r,n){const{bucket:o,layout:s,posMatrix:a,textLabelPlaneMatrix:l,labelToScreenMatrix:c,clippingData:u,textPixelRatio:h,holdingForFade:d,collisionBoxArray:p,partiallyEvaluatedTextSize:f,partiallyEvaluatedIconSize:A,collisionGroup:m}=e.parameters,g=s.get("text-optional"),_=s.get("icon-optional"),y=s.get("text-allow-overlap"),v=s.get("icon-allow-overlap"),x="map"===s.get("text-rotation-alignment"),b="map"===s.get("text-pitch-alignment"),w="none"!==s.get("icon-text-fit"),T="viewport-y"===s.get("symbol-z-order");this.transform.setProjection(o.projection);let B=y&&(v||!o.hasIconData()||_),E=v&&(y||!o.hasTextData()||g);!o.collisionArrays&&p&&o.deserializeCollisionBoxes(p),r&&n&&o.updateCollisionDebugBuffers(this.transform.zoom,p);const C=(e,n,p)=>{const{crossTileID:T,numVerticalGlyphVertices:C}=e;if(u){const r={zoom:this.transform.zoom,pitch:this.transform.pitch};let n=null;if(u.dynamicFilterNeedsFeature){const t=this.retainedQueryData[o.bucketInstanceId];n=u.featureIndex.loadFeature({featureIndex:e.featureIndex,bucketIndex:t.bucketIndex,sourceLayerIndex:t.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,u.dynamicFilter)(r,n,this.retainedQueryData[o.bucketInstanceId].tileID.canonical,new t.Point(e.tileAnchorX,e.tileAnchorY),this.transform.calculateDistanceTileData(u.unwrappedTileID)))return this.placements[T]=new be(!1,!1,!1,!0),void i.add(T)}if(i.has(T))return;if(d)return void(this.placements[T]=new be(!1,!1,!1));let S=!1,I=!1,M=!0,k=!1,P=!1,L=null,z={box:null,offscreen:null,occluded:null},F={box:null,offscreen:null,occluded:null},D=null,R=null,U=null,O=0,N=0,Q=0;p.textFeatureIndex?O=p.textFeatureIndex:e.useRuntimeCollisionCircles&&(O=e.featureIndex),p.verticalTextFeatureIndex&&(N=p.verticalTextFeatureIndex);const V=t=>{t.tileID=this.retainedQueryData[o.bucketInstanceId].tileID;const e=this.transform.elevation;(e||t.elevation)&&(t.elevation=e?e.getAtTileOffset(t.tileID,t.tileAnchorX,t.tileAnchorY):0)},j=p.textBox;if(j){V(j);const i=i=>{let r=t.WritingMode.horizontal;if(o.allowVerticalPlacement&&!i&&this.prevPlacement){const t=this.prevPlacement.placedOrientations[T];t&&(this.placedOrientations[T]=t,r=t,this.markUsedOrientation(o,r,e))}return r},r=(e,i)=>{if(o.allowVerticalPlacement&&C>0&&p.verticalTextBox){for(const r of o.writingModes)if(r===t.WritingMode.vertical?(z=i(),F=z):z=e(),z&&z.box&&z.box.length)break}else z=e()};if(s.get("text-variable-anchor")){let l=s.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[T]){const t=this.prevPlacement.variableOffsets[T];l.indexOf(t.anchor)>0&&(l=l.filter((e=>e!==t.anchor)),l.unshift(t.anchor))}const c=(t,i,r)=>{const s=o.getSymbolInstanceTextSize(f,e,this.transform.zoom,n),c=(t.x2-t.x1)*s+2*t.padding,u=(t.y2-t.y1)*s+2*t.padding,d=w&&!v?i:null;d&&V(d);let p={box:[],offscreen:!1,occluded:!1};const g=y?2*l.length:l.length;for(let i=0;i<g;++i){const g=this.attemptAnchorPlacement(l[i%l.length],t,c,u,s,x,b,h,a,m,i>=l.length,e,n,o,r,d,f,A);if(g&&(p=g.placedGlyphBoxes,p&&p.box&&p.box.length)){S=!0,L=g.shift;break}}return p};r((()=>c(j,p.iconBox,t.WritingMode.horizontal)),(()=>{const e=p.verticalTextBox;return e&&V(e),o.allowVerticalPlacement&&!(z&&z.box&&z.box.length)&&C>0&&e?c(e,p.verticalIconBox,t.WritingMode.vertical):{box:null,offscreen:null,occluded:null}})),z&&(S=z.box,M=z.offscreen,k=z.occluded);const u=i(!(!z||!z.box));if(!S&&this.prevPlacement){const t=this.prevPlacement.variableOffsets[T];t&&(this.variableOffsets[T]=t,this.markUsedJustification(o,t.anchor,e,u))}}else{const s=(i,r)=>{const s=o.getSymbolInstanceTextSize(f,e,this.transform.zoom,n),l=this.collisionIndex.placeCollisionBox(o,s,i,new t.Point(0,0),y,h,a,m.predicate);return l&&l.box&&l.box.length&&(this.markUsedOrientation(o,r,e),this.placedOrientations[T]=r),l};r((()=>s(j,t.WritingMode.horizontal)),(()=>{const e=p.verticalTextBox;return o.allowVerticalPlacement&&C>0&&e?(V(e),s(e,t.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}})),i(!!(z&&z.box&&z.box.length))}}if(D=z,S=D&&D.box&&D.box.length>0,M=D&&D.offscreen,k=D&&D.occluded,e.useRuntimeCollisionCircles){const i=o.text.placedSymbolArray.get(e.centerJustifiedTextSymbolIndex>=0?e.centerJustifiedTextSymbolIndex:e.verticalPlacedTextSymbolIndex),n=t.evaluateSizeForFeature(o.textSizeData,f,i),u=s.get("text-padding");R=this.collisionIndex.placeCollisionCircles(o,y,i,o.lineVertexArray,o.glyphOffsetArray,n,a,l,c,r,b,m.predicate,e.collisionCircleDiameter*n/t.ONE_EM,u,this.retainedQueryData[o.bucketInstanceId].tileID),S=y||R.circles.length>0&&!R.collisionDetected,M=M&&R.offscreen,k=R.occluded}if(p.iconFeatureIndex&&(Q=p.iconFeatureIndex),p.iconBox){const i=i=>{V(i);const r=w&&L?Ce(L.x,L.y,x,b,this.transform.angle):new t.Point(0,0),n=o.getSymbolInstanceIconSize(A,this.transform.zoom,e.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(o,n,i,r,v,h,a,m.predicate)};F&&F.box&&F.box.length&&p.verticalIconBox?(U=i(p.verticalIconBox),I=U.box.length>0):(U=i(p.iconBox),I=U.box.length>0),M=M&&U.offscreen,P=U.occluded}const H=g||0===e.numHorizontalGlyphVertices&&0===C,G=_||0===e.numIconVertices;if(H||G?G?H||(I=I&&S):S=I&&S:I=S=I&&S,S&&D&&D.box&&this.collisionIndex.insertCollisionBox(D.box,s.get("text-ignore-placement"),o.bucketInstanceId,F&&F.box&&N?N:O,m.ID),I&&U&&this.collisionIndex.insertCollisionBox(U.box,s.get("icon-ignore-placement"),o.bucketInstanceId,Q,m.ID),R&&(S&&this.collisionIndex.insertCollisionCircles(R.circles,s.get("text-ignore-placement"),o.bucketInstanceId,O,m.ID),r)){const t=o.bucketInstanceId;let e=this.collisionCircleArrays[t];void 0===e&&(e=this.collisionCircleArrays[t]=new we);for(let t=0;t<R.circles.length;t+=4)e.circles.push(R.circles[t+0]),e.circles.push(R.circles[t+1]),e.circles.push(R.circles[t+2]),e.circles.push(R.collisionDetected?1:0)}const $="globe"!==o.projection.name;B=B&&($||!k),E=E&&($||!P),this.placements[T]=new be(S||B,I||E,M||o.justReloaded),i.add(T)};if(T){const t=o.getSortedSymbolIndexes(this.transform.angle);for(let e=t.length-1;e>=0;--e){const i=t[e];C(o.symbolInstances.get(i),i,o.collisionArrays[i])}}else for(let t=e.symbolInstanceStart;t<e.symbolInstanceEnd;t++)C(o.symbolInstances.get(t),t,o.collisionArrays[t]);if(r&&o.bucketInstanceId in this.collisionCircleArrays){const e=this.collisionCircleArrays[o.bucketInstanceId];t.invert(e.invProjMatrix,a),e.viewportMatrix=this.collisionIndex.getViewportMatrix()}o.justReloaded=!1}markUsedJustification(e,i,r,n){const{leftJustifiedTextSymbolIndex:o,centerJustifiedTextSymbolIndex:s,rightJustifiedTextSymbolIndex:a,verticalPlacedTextSymbolIndex:l,crossTileID:c}=r,u=t.getAnchorJustification(i),h=n===t.WritingMode.vertical?l:"left"===u?o:"center"===u?s:"right"===u?a:-1;o>=0&&(e.text.placedSymbolArray.get(o).crossTileID=h>=0&&o!==h?0:c),s>=0&&(e.text.placedSymbolArray.get(s).crossTileID=h>=0&&s!==h?0:c),a>=0&&(e.text.placedSymbolArray.get(a).crossTileID=h>=0&&a!==h?0:c),l>=0&&(e.text.placedSymbolArray.get(l).crossTileID=h>=0&&l!==h?0:c)}markUsedOrientation(e,i,r){const n=i===t.WritingMode.horizontal||i===t.WritingMode.horizontalOnly?i:0,o=i===t.WritingMode.vertical?i:0,{leftJustifiedTextSymbolIndex:s,centerJustifiedTextSymbolIndex:a,rightJustifiedTextSymbolIndex:l,verticalPlacedTextSymbolIndex:c}=r,u=e.text.placedSymbolArray;s>=0&&(u.get(s).placedOrientation=n),a>=0&&(u.get(a).placedOrientation=n),l>=0&&(u.get(l).placedOrientation=n),c>=0&&(u.get(c).placedOrientation=o)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const e=this.prevPlacement;let i=!1;this.prevZoomAdjustment=e?e.zoomAdjustment(this.transform.zoom):0;const r=e?e.symbolFadeChange(t):1,n=e?e.opacities:{},o=e?e.variableOffsets:{},s=e?e.placedOrientations:{};for(const t in this.placements){const e=this.placements[t],o=n[t];o?(this.opacities[t]=new xe(o,r,e.text,e.icon,null,e.clipped),i=i||e.text!==o.text.placed||e.icon!==o.icon.placed):(this.opacities[t]=new xe(null,r,e.text,e.icon,e.skipFade,e.clipped),i=i||e.text||e.icon)}for(const t in n){const e=n[t];if(!this.opacities[t]){const n=new xe(e,r,!1,!1);n.isHidden()||(this.opacities[t]=n,i=i||e.text.placed||e.icon.placed)}}for(const t in o)this.variableOffsets[t]||!this.opacities[t]||this.opacities[t].isHidden()||(this.variableOffsets[t]=o[t]);for(const t in s)this.placedOrientations[t]||!this.opacities[t]||this.opacities[t].isHidden()||(this.placedOrientations[t]=s[t]);i?this.lastPlacementChangeTime=t:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=e?e.lastPlacementChangeTime:t)}updateLayerOpacities(t,e){const i=new Set;for(const r of e){const e=r.getBucket(t);e&&r.latestFeatureIndex&&t.id===e.layerIds[0]&&this.updateBucketOpacities(e,i,r.collisionBoxArray)}}updateBucketOpacities(e,i,r){e.hasTextData()&&e.text.opacityVertexArray.clear(),e.hasIconData()&&e.icon.opacityVertexArray.clear(),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();const n=e.layers[0].layout,o=!!e.layers[0].dynamicFilter(),s=new xe(null,0,!1,!1,!0),a=n.get("text-allow-overlap"),l=n.get("icon-allow-overlap"),c=n.get("text-variable-anchor"),u="map"===n.get("text-rotation-alignment"),h="map"===n.get("text-pitch-alignment"),d="none"!==n.get("icon-text-fit"),p=new xe(null,0,a&&(l||!e.hasIconData()||n.get("icon-optional")),l&&(a||!e.hasTextData()||n.get("text-optional")),!0);!e.collisionArrays&&r&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(r);const f=(t,e,i)=>{for(let r=0;r<e/4;r++)t.opacityVertexArray.emplaceBack(i)};let A=0;for(let r=0;r<e.symbolInstances.length;r++){const n=e.symbolInstances.get(r),{numHorizontalGlyphVertices:a,numVerticalGlyphVertices:l,crossTileID:m,numIconVertices:g}=n,_=i.has(m);let y=this.opacities[m];_?y=s:y||(y=p,this.opacities[m]=y),i.add(m);const v=a>0||l>0,x=g>0,b=this.placedOrientations[m],w=b===t.WritingMode.vertical,T=b===t.WritingMode.horizontal||b===t.WritingMode.horizontalOnly;if(!v&&!x||y.isHidden()||A++,v){const t=Re(y.text);f(e.text,a,w?Ue:t),f(e.text,l,T?Ue:t);const i=y.text.isHidden(),{leftJustifiedTextSymbolIndex:r,centerJustifiedTextSymbolIndex:o,rightJustifiedTextSymbolIndex:s,verticalPlacedTextSymbolIndex:c}=n,u=e.text.placedSymbolArray,h=i||w?1:0;r>=0&&(u.get(r).hidden=h),o>=0&&(u.get(o).hidden=h),s>=0&&(u.get(s).hidden=h),c>=0&&(u.get(c).hidden=i||T?1:0);const d=this.variableOffsets[m];d&&this.markUsedJustification(e,d.anchor,n,b);const p=this.placedOrientations[m];p&&(this.markUsedJustification(e,"left",n,p),this.markUsedOrientation(e,p,n))}if(x){const t=Re(y.icon),{placedIconSymbolIndex:i,verticalPlacedIconSymbolIndex:r}=n,o=e.icon.placedSymbolArray,s=y.icon.isHidden()?1:0;i>=0&&(f(e.icon,g,w?Ue:t),o.get(i).hidden=s),r>=0&&(f(e.icon,n.numVerticalIconVertices,T?Ue:t),o.get(r).hidden=s)}if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){const i=e.collisionArrays[r];if(i){let r=new t.Point(0,0),n=!0;if(i.textBox||i.verticalTextBox){if(c){const t=this.variableOffsets[m];t?(r=Ee(t.anchor,t.width,t.height,t.textOffset,t.textScale),u&&r._rotate(h?this.transform.angle:-this.transform.angle)):n=!1}o&&(n=!y.clipped),i.textBox&&Ie(e.textCollisionBox.collisionVertexArray,y.text.placed,!n||w,r.x,r.y),i.verticalTextBox&&Ie(e.textCollisionBox.collisionVertexArray,y.text.placed,!n||T,r.x,r.y)}const s=n&&Boolean(!T&&i.verticalIconBox);i.iconBox&&Ie(e.iconCollisionBox.collisionVertexArray,y.icon.placed,s,d?r.x:0,d?r.y:0),i.verticalIconBox&&Ie(e.iconCollisionBox.collisionVertexArray,y.icon.placed,!s,d?r.x:0,d?r.y:0)}}}if(e.fullyClipped=0===A,e.sortFeatures(this.transform.angle),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.bucketInstanceId in this.collisionCircleArrays){const t=this.collisionCircleArrays[e.bucketInstanceId];e.placementInvProjMatrix=t.invProjMatrix,e.placementViewportMatrix=t.viewportMatrix,e.collisionCircleArray=t.circles,delete this.collisionCircleArrays[e.bucketInstanceId]}}symbolFadeChange(t){return 0===this.fadeDuration?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,e){const i=this.zoomAtLastRecencyCheck===e?1-this.zoomAdjustment(e):1;return this.zoomAtLastRecencyCheck=e,this.commitTime+this.fadeDuration*i>t}setStale(){this.stale=!0}}function Ie(t,e,i,r,n){t.emplaceBack(e?1:0,i?1:0,r||0,n||0),t.emplaceBack(e?1:0,i?1:0,r||0,n||0),t.emplaceBack(e?1:0,i?1:0,r||0,n||0),t.emplaceBack(e?1:0,i?1:0,r||0,n||0)}const Me=Math.pow(2,25),ke=Math.pow(2,24),Pe=Math.pow(2,17),Le=Math.pow(2,16),ze=Math.pow(2,9),Fe=Math.pow(2,8),De=Math.pow(2,1);function Re(t){if(0===t.opacity&&!t.placed)return 0;if(1===t.opacity&&t.placed)return 4294967295;const e=t.placed?1:0,i=Math.floor(127*t.opacity);return i*Me+e*ke+i*Pe+e*Le+i*ze+e*Fe+i*De+e}const Ue=0;class Oe{constructor(t){this._sortAcrossTiles="viewport-y"!==t.layout.get("symbol-z-order")&&void 0!==t.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(t,e,i,r,n){const o=this._bucketParts;for(;this._currentTileIndex<t.length;)if(e.getBucketParts(o,r,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,n())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,o.sort(((t,e)=>t.sortKey-e.sortKey)));this._currentPartIndex<o.length;){const t=o[this._currentPartIndex];if(e.placeLayerBucketPart(t,this._seenCrossTileIDs,i,0===t.symbolInstanceStart),this._currentPartIndex++,n())return!0}return!1}}class Ne{constructor(t,e,i,r,n,o,s,a){this.placement=new Se(t,n,o,s,a),this._currentPlacementIndex=e.length-1,this._forceFullPlacement=i,this._showCollisionBoxes=r,this._done=!1}isDone(){return this._done}continuePlacement(e,i,r){const n=t.exported.now(),o=()=>{const e=t.exported.now()-n;return!this._forceFullPlacement&&e>2};for(;this._currentPlacementIndex>=0;){const t=i[e[this._currentPlacementIndex]],n=this.placement.collisionIndex.transform.zoom;if("symbol"===t.type&&(!t.minzoom||t.minzoom<=n)&&(!t.maxzoom||t.maxzoom>n)){if(this._inProgressLayer||(this._inProgressLayer=new Oe(t)),this._inProgressLayer.continuePlacement(r[t.source],this.placement,this._showCollisionBoxes,t,o))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const Qe=512/t.EXTENT/2;class Ve{constructor(e,i,r){this.tileID=e,this.bucketInstanceId=r,this.index=new t.KDBush(i.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const n=e.canonical.x*t.EXTENT,o=e.canonical.y*t.EXTENT;for(let t=0;t<i.length;t++){const{key:e,crossTileID:r,tileAnchorX:s,tileAnchorY:a}=i.get(t),l=Math.floor((n+s)*Qe),c=Math.floor((o+a)*Qe);this.index.add(l,c),this.keys.push(e),this.crossTileIDs.push(r)}this.index.finish()}findMatches(e,i,r){const n=this.tileID.canonical.z<i.canonical.z?1:Math.pow(2,this.tileID.canonical.z-i.canonical.z),o=Qe/Math.pow(2,i.canonical.z-this.tileID.canonical.z),s=i.canonical.x*t.EXTENT,a=i.canonical.y*t.EXTENT;for(let t=0;t<e.length;t++){const i=e.get(t);if(i.crossTileID)continue;const{key:l,tileAnchorX:c,tileAnchorY:u}=i,h=Math.floor((s+c)*o),d=Math.floor((a+u)*o),p=this.index.range(h-n,d-n,h+n,d+n);for(const t of p){const e=this.crossTileIDs[t];if(this.keys[t]===l&&!r.has(e)){r.add(e),i.crossTileID=e;break}}}}}class je{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class He{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const e=Math.round((t-this.lng)/360);if(0!==e)for(const t in this.indexes){const i=this.indexes[t],r={};for(const t in i){const n=i[t];n.tileID=n.tileID.unwrapTo(n.tileID.wrap+e),r[n.tileID.key]=n}this.indexes[t]=r}this.lng=t}addBucket(t,e,i){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===e.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let t=0;t<e.symbolInstances.length;t++)e.symbolInstances.get(t).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]=new Set);const r=this.usedCrossTileIDs[t.overscaledZ];for(const i in this.indexes){const n=this.indexes[i];if(Number(i)>t.overscaledZ)for(const i in n){const o=n[i];o.tileID.isChildOf(t)&&o.findMatches(e.symbolInstances,t,r)}else{const o=n[t.scaledTo(Number(i)).key];o&&o.findMatches(e.symbolInstances,t,r)}}for(let t=0;t<e.symbolInstances.length;t++){const n=e.symbolInstances.get(t);n.crossTileID||(n.crossTileID=i.generate(),r.add(n.crossTileID))}return void 0===this.indexes[t.overscaledZ]&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new Ve(t,e.symbolInstances,e.bucketInstanceId),!0}removeBucketCrossTileIDs(t,e){for(const i of e.crossTileIDs)this.usedCrossTileIDs[t].delete(i)}removeStaleBuckets(t){let e=!1;for(const i in this.indexes){const r=this.indexes[i];for(const n in r)t[r[n].bucketInstanceId]||(this.removeBucketCrossTileIDs(i,r[n]),delete r[n],e=!0)}return e}}class Ge{constructor(){this.layerIndexes={},this.crossTileIDs=new je,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,e,i,r){let n=this.layerIndexes[t.id];void 0===n&&(n=this.layerIndexes[t.id]=new He);let o=!1;const s={};"globe"!==r.name&&n.handleWrapJump(i);for(const i of e){const e=i.getBucket(t);e&&t.id===e.layerIds[0]&&(e.bucketInstanceId||(e.bucketInstanceId=++this.maxBucketInstanceId),n.addBucket(i.tileID,e,this.crossTileIDs)&&(o=!0),s[e.bucketInstanceId]=!0)}return n.removeStaleBuckets(s)&&(o=!0),o}pruneUnusedLayers(t){const e={};t.forEach((t=>{e[t]=!0}));for(const t in this.layerIndexes)e[t]||delete this.layerIndexes[t]}}const $e=(e,i)=>t.emitValidationErrors(e,i&&i.filter((t=>"source.canvas"!==t.identifier))),Ze=t.pick(Vt,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),qe=t.pick(Vt,["setCenter","setZoom","setBearing","setPitch"]),Ke={version:8,layers:[],sources:{}},We={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class Xe extends t.Evented{constructor(e,i={}){super(),this.map=e,this.dispatcher=new I(Ot(),this),this.imageManager=new v,this.imageManager.setEventedParent(this),this.glyphManager=new t.GlyphManager(e._requestManager,i.localFontFamily?t.LocalGlyphMode.all:i.localIdeographFontFamily?t.LocalGlyphMode.ideographs:t.LocalGlyphMode.none,i.localFontFamily||i.localIdeographFontFamily),this.crossTileSymbolIndex=new Ge,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",t.getReferrer());const r=this;this._rtlTextPluginCallback=Xe.registerForPluginStateChange((e=>{r.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:e.pluginStatus,pluginURL:e.pluginURL},((e,i)=>{if(t.triggerPluginCompletionEvent(e),i&&i.every((t=>t)))for(const t in r._sourceCaches){const e=r._sourceCaches[t],i=e.getSource().type;"vector"!==i&&"geojson"!==i||e.reload()}}))})),this.on("data",(t=>{if("source"!==t.dataType||"metadata"!==t.sourceDataType)return;const e=this.getSource(t.sourceId);if(e&&e.vectorLayerIds)for(const t in this._layers){const i=this._layers[t];i.source===e.id&&this._validateLayer(i)}}))}loadURL(e,i={}){this.fire(new t.Event("dataloading",{dataType:"style"}));const r="boolean"==typeof i.validate?i.validate:!t.isMapboxURL(e);e=this.map._requestManager.normalizeStyleURL(e,i.accessToken);const n=this.map._requestManager.transformRequest(e,t.ResourceType.Style);this._request=t.getJSON(n,((e,i)=>{this._request=null,e?this.fire(new t.ErrorEvent(e)):i&&this._load(i,r)}))}loadJSON(e,i={}){this.fire(new t.Event("dataloading",{dataType:"style"})),this._request=t.exported.frame((()=>{this._request=null,this._load(e,!1!==i.validate)}))}loadEmpty(){this.fire(new t.Event("dataloading",{dataType:"style"})),this._load(Ke,!1)}_updateLayerCount(t,e){const i=e?1:-1;t.is3D()&&(this._num3DLayers+=i),"circle"===t.type&&(this._numCircleLayers+=i),"symbol"===t.type&&(this._numSymbolLayers+=i)}_load(e,i){if(i&&$e(this,t.validateStyle(e)))return;this._loaded=!0,this.stylesheet=t.clone$1(e),this._updateMapProjection();for(const t in e.sources)this.addSource(t,e.sources[t],{validate:!1});this._changed=!1,e.sprite?this._loadSprite(e.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(e.glyphs);const r=Qt(this.stylesheet.layers);this._order=r.map((t=>t.id)),this._layers={},this._serializedLayers={};for(const e of r){const i=t.createStyleLayer(e);i.setEventedParent(this,{layer:{id:i.id}}),this._layers[i.id]=i,this._serializedLayers[i.id]=i.serialize(),this._updateLayerCount(i,!0)}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new b(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new t.Event("data",{dataType:"style"})),this.fire(new t.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&0===this.terrain.drapeRenderMode}setProjection(t){t?this.stylesheet.projection=t:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(e){this._spriteRequest=function(e,i,r){let n,o,s;const a=t.exported.devicePixelRatio>1?"@2x":"";let l=t.getJSON(i.transformRequest(i.normalizeSpriteURL(e,a,".json"),t.ResourceType.SpriteJSON),((t,e)=>{l=null,s||(s=t,n=e,u())})),c=t.getImage(i.transformRequest(i.normalizeSpriteURL(e,a,".png"),t.ResourceType.SpriteImage),((t,e)=>{c=null,s||(s=t,o=e,u())}));function u(){if(s)r(s);else if(n&&o){const e=t.exported.getImageData(o),i={};for(const r in n){const{width:o,height:s,x:a,y:l,sdf:c,pixelRatio:u,stretchX:h,stretchY:d,content:p}=n[r],f=new t.RGBAImage({width:o,height:s});t.RGBAImage.copy(e,f,{x:a,y:l},{x:0,y:0},{width:o,height:s}),i[r]={data:f,pixelRatio:u,sdf:c,stretchX:h,stretchY:d,content:p}}r(null,i)}}return{cancel(){l&&(l.cancel(),l=null),c&&(c.cancel(),c=null)}}}(e,this.map._requestManager,((e,i)=>{if(this._spriteRequest=null,e)this.fire(new t.ErrorEvent(e));else if(i)for(const t in i)this.imageManager.addImage(t,i[t]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new t.Event("data",{dataType:"style"}))}))}_validateLayer(e){const i=this.getSource(e.source);if(!i)return;const r=e.sourceLayer;r&&("geojson"===i.type||i.vectorLayerIds&&-1===i.vectorLayerIds.indexOf(r))&&this.fire(new t.ErrorEvent(new Error(`Source layer "${r}" does not exist on source "${i.id}" as specified by style layer "${e.id}"`)))}loaded(){if(!this._loaded)return!1;if(Object.keys(this._updatedSources).length)return!1;for(const t in this._sourceCaches)if(!this._sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(t){const e=[];for(const i of t){const t=this._layers[i];"custom"!==t.type&&e.push(t.serialize())}return e}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;if(this.fog&&this.fog.hasTransition())return!0;for(const t in this._sourceCaches)if(this._sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(t){return!!this.terrain&&("function"==typeof t.isLayerDraped?t.isLayerDraped():We[t.type])}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(e){if(!this._loaded)return;const i=this._changed;if(this._changed){const t=Object.keys(this._updatedLayers),i=Object.keys(this._removedLayers);(t.length||i.length)&&this._updateWorkerLayers(t,i);for(const t in this._updatedSources){const e=this._updatedSources[t];"reload"===e?this._reloadSource(t):"clear"===e&&this._clearSource(t)}this._updateTilesForChangedImages();for(const t in this._updatedPaintProps)this._layers[t].updateTransitions(e);this.light.updateTransitions(e),this.fog&&this.fog.updateTransitions(e),this._resetUpdates()}const r={};for(const t in this._sourceCaches){const e=this._sourceCaches[t];r[t]=e.used,e.used=!1}for(const t of this._order){const i=this._layers[t];if(i.recalculate(e,this._availableImages),!i.isHidden(e.zoom)){const t=this._getLayerSourceCache(i);t&&(t.used=!0)}const r=this.map.painter;if(r){const t=i.getProgramIds();if(!t)continue;const n=i.getProgramConfiguration(e.zoom);for(const e of t)r.useProgram(e,n)}}for(const e in r){const i=this._sourceCaches[e];r[e]!==i.used&&i.getSource().fire(new t.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:i.getSource().id}))}this.light.recalculate(e),this.terrain&&this.terrain.recalculate(e),this.fog&&this.fog.recalculate(e),this.z=e.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),i&&this.fire(new t.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const e in this._sourceCaches)this._sourceCaches[e].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateWorkerLayers(t,e){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(t),removedIds:e})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(i){if(this._checkLoaded(),$e(this,t.validateStyle(i)))return!1;(i=t.clone$1(i)).layers=Qt(i.layers);const r=function(t,i){if(!t)return[{command:Vt.setStyle,args:[i]}];let r=[];try{if(!e(t.version,i.version))return[{command:Vt.setStyle,args:[i]}];e(t.center,i.center)||r.push({command:Vt.setCenter,args:[i.center]}),e(t.zoom,i.zoom)||r.push({command:Vt.setZoom,args:[i.zoom]}),e(t.bearing,i.bearing)||r.push({command:Vt.setBearing,args:[i.bearing]}),e(t.pitch,i.pitch)||r.push({command:Vt.setPitch,args:[i.pitch]}),e(t.sprite,i.sprite)||r.push({command:Vt.setSprite,args:[i.sprite]}),e(t.glyphs,i.glyphs)||r.push({command:Vt.setGlyphs,args:[i.glyphs]}),e(t.transition,i.transition)||r.push({command:Vt.setTransition,args:[i.transition]}),e(t.light,i.light)||r.push({command:Vt.setLight,args:[i.light]}),e(t.fog,i.fog)||r.push({command:Vt.setFog,args:[i.fog]}),e(t.projection,i.projection)||r.push({command:Vt.setProjection,args:[i.projection]});const n={},o=[];!function(t,i,r,n){let o;for(o in i=i||{},t=t||{})t.hasOwnProperty(o)&&(i.hasOwnProperty(o)||Ht(o,r,n));for(o in i){if(!i.hasOwnProperty(o))continue;const s=i[o];t.hasOwnProperty(o)?e(t[o],s)||("geojson"===t[o].type&&"geojson"===s.type&&$t(t,i,o)?r.push({command:Vt.setGeoJSONSourceData,args:[o,s.data]}):Gt(o,i,r,n)):jt(o,i,r)}}(t.sources,i.sources,o,n);const s=[];t.layers&&t.layers.forEach((t=>{t.source&&n[t.source]?r.push({command:Vt.removeLayer,args:[t.id]}):s.push(t)}));let a=t.terrain;a&&n[a.source]&&(r.push({command:Vt.setTerrain,args:[void 0]}),a=void 0),r=r.concat(o),e(a,i.terrain)||r.push({command:Vt.setTerrain,args:[i.terrain]}),function(t,i,r){i=i||[];const n=(t=t||[]).map(qt),o=i.map(qt),s=t.reduce(Kt,{}),a=i.reduce(Kt,{}),l=n.slice(),c=Object.create(null);let u,h,d,p,f,A,m;for(u=0,h=0;u<n.length;u++)d=n[u],a.hasOwnProperty(d)?h++:(r.push({command:Vt.removeLayer,args:[d]}),l.splice(l.indexOf(d,h),1));for(u=0,h=0;u<o.length;u++)d=o[o.length-1-u],l[l.length-1-u]!==d&&(s.hasOwnProperty(d)?(r.push({command:Vt.removeLayer,args:[d]}),l.splice(l.lastIndexOf(d,l.length-h),1)):h++,A=l[l.length-u],r.push({command:Vt.addLayer,args:[a[d],A]}),l.splice(l.length-u,0,d),c[d]=!0);for(u=0;u<o.length;u++)if(d=o[u],p=s[d],f=a[d],!c[d]&&!e(p,f))if(e(p.source,f.source)&&e(p["source-layer"],f["source-layer"])&&e(p.type,f.type)){for(m in Zt(p.layout,f.layout,r,d,null,Vt.setLayoutProperty),Zt(p.paint,f.paint,r,d,null,Vt.setPaintProperty),e(p.filter,f.filter)||r.push({command:Vt.setFilter,args:[d,f.filter]}),e(p.minzoom,f.minzoom)&&e(p.maxzoom,f.maxzoom)||r.push({command:Vt.setLayerZoomRange,args:[d,f.minzoom,f.maxzoom]}),p)p.hasOwnProperty(m)&&"layout"!==m&&"paint"!==m&&"filter"!==m&&"metadata"!==m&&"minzoom"!==m&&"maxzoom"!==m&&(0===m.indexOf("paint.")?Zt(p[m],f[m],r,d,m.slice(6),Vt.setPaintProperty):e(p[m],f[m])||r.push({command:Vt.setLayerProperty,args:[d,m,f[m]]}));for(m in f)f.hasOwnProperty(m)&&!p.hasOwnProperty(m)&&"layout"!==m&&"paint"!==m&&"filter"!==m&&"metadata"!==m&&"minzoom"!==m&&"maxzoom"!==m&&(0===m.indexOf("paint.")?Zt(p[m],f[m],r,d,m.slice(6),Vt.setPaintProperty):e(p[m],f[m])||r.push({command:Vt.setLayerProperty,args:[d,m,f[m]]}))}else r.push({command:Vt.removeLayer,args:[d]}),A=l[l.lastIndexOf(d)+1],r.push({command:Vt.addLayer,args:[f,A]})}(s,i.layers,r)}catch(t){console.warn("Unable to compute style diff:",t),r=[{command:Vt.setStyle,args:[i]}]}return r}(this.serialize(),i).filter((t=>!(t.command in qe)));if(0===r.length)return!1;const n=r.filter((t=>!(t.command in Ze)));if(n.length>0)throw new Error(`Unimplemented: ${n.map((t=>t.command)).join(", ")}.`);return r.forEach((t=>{"setTransition"!==t.command&&"setProjection"!==t.command&&this[t.command].apply(this,t.args)})),this.stylesheet=i,this._updateMapProjection(),!0}addImage(e,i){return this.getImage(e)?this.fire(new t.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(e,i),this._afterImageUpdated(e),this)}updateImage(t,e){this.imageManager.updateImage(t,e)}getImage(t){return this.imageManager.getImage(t)}removeImage(e){return this.getImage(e)?(this.imageManager.removeImage(e),this._afterImageUpdated(e),this):this.fire(new t.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new t.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(e,i,r={}){if(this._checkLoaded(),void 0!==this.getSource(e))throw new Error("There is already a source with this ID");if(!i.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(i).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(i.type)>=0&&this._validate(t.validateSource,`sources.${e}`,i,null,r))return;this.map&&this.map._collectResourceTiming&&(i.collectResourceTiming=!0);const n=Mt(e,i,this.dispatcher,this);n.setEventedParent(this,(()=>({isSourceLoaded:this._isSourceCacheLoaded(e),source:n.serialize(),sourceId:e})));const o=i=>{const r=(i?"symbol:":"other:")+e,o=this._sourceCaches[r]=new t.SourceCache(r,n,i);(i?this._symbolSourceCaches:this._otherSourceCaches)[e]=o,o.style=this,o.onAdd(this.map)};o(!1),"vector"!==i.type&&"geojson"!==i.type||o(!0),n.onAdd&&n.onAdd(this.map),this._changed=!0}removeSource(e){this._checkLoaded();const i=this.getSource(e);if(!i)throw new Error("There is no source with this ID");for(const i in this._layers)if(this._layers[i].source===e)return this.fire(new t.ErrorEvent(new Error(`Source "${e}" cannot be removed while layer "${i}" is using it.`)));if(this.terrain&&this.terrain.get().source===e)return this.fire(new t.ErrorEvent(new Error(`Source "${e}" cannot be removed while terrain is using it.`)));const r=this._getSourceCaches(e);for(const e of r)delete this._sourceCaches[e.id],delete this._updatedSources[e.id],e.fire(new t.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:e.getSource().id})),e.setEventedParent(null),e.clearTiles();return delete this._otherSourceCaches[e],delete this._symbolSourceCaches[e],i.setEventedParent(null),i.onRemove&&i.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(t,e){this._checkLoaded(),this.getSource(t).setData(e),this._changed=!0}getSource(t){const e=this._getSourceCache(t);return e&&e.getSource()}_getSources(){const t=[];for(const e in this._otherSourceCaches){const i=this._getSourceCache(e);i&&t.push(i.getSource())}return t}addLayer(e,i,r={}){this._checkLoaded();const n=e.id;if(this.getLayer(n))return void this.fire(new t.ErrorEvent(new Error(`Layer with id "${n}" already exists on this map`)));let o;if("custom"===e.type){if($e(this,t.validateCustomStyleLayer(e)))return;o=t.createStyleLayer(e)}else{if("object"==typeof e.source&&(this.addSource(n,e.source),e=t.clone$1(e),e=t.extend(e,{source:n})),this._validate(t.validateLayer,`layers.${n}`,e,{arrayIndex:-1},r))return;o=t.createStyleLayer(e),this._validateLayer(o),o.setEventedParent(this,{layer:{id:n}}),this._serializedLayers[o.id]=o.serialize(),this._updateLayerCount(o,!0)}const s=i?this._order.indexOf(i):this._order.length;if(i&&-1===s)return void this.fire(new t.ErrorEvent(new Error(`Layer with id "${i}" does not exist on this map.`)));this._order.splice(s,0,n),this._layerOrderChanged=!0,this._layers[n]=o;const a=this._getLayerSourceCache(o);if(this._removedLayers[n]&&o.source&&a&&"custom"!==o.type){const t=this._removedLayers[n];delete this._removedLayers[n],t.type!==o.type?this._updatedSources[o.source]="clear":(this._updatedSources[o.source]="reload",a.pause())}this._updateLayer(o),o.onAdd&&o.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(e,i){if(this._checkLoaded(),this._changed=!0,!this._layers[e])return void this.fire(new t.ErrorEvent(new Error(`The layer '${e}' does not exist in the map's style and cannot be moved.`)));if(e===i)return;const r=this._order.indexOf(e);this._order.splice(r,1);const n=i?this._order.indexOf(i):this._order.length;i&&-1===n?this.fire(new t.ErrorEvent(new Error(`Layer with id "${i}" does not exist on this map.`))):(this._order.splice(n,0,e),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(e){this._checkLoaded();const i=this._layers[e];if(!i)return void this.fire(new t.ErrorEvent(new Error(`The layer '${e}' does not exist in the map's style and cannot be removed.`)));i.setEventedParent(null),this._updateLayerCount(i,!1);const r=this._order.indexOf(e);this._order.splice(r,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=i,delete this._layers[e],delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],i.onRemove&&i.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(t){return this._layers[t]}hasLayer(t){return t in this._layers}hasLayerType(t){for(const e in this._layers)if(this._layers[e].type===t)return!0;return!1}setLayerZoomRange(e,i,r){this._checkLoaded();const n=this.getLayer(e);n?n.minzoom===i&&n.maxzoom===r||(null!=i&&(n.minzoom=i),null!=r&&(n.maxzoom=r),this._updateLayer(n)):this.fire(new t.ErrorEvent(new Error(`The layer '${e}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(i,r,n={}){this._checkLoaded();const o=this.getLayer(i);if(o){if(!e(o.filter,r))return null==r?(o.filter=void 0,void this._updateLayer(o)):void(this._validate(t.validateFilter,`layers.${o.id}.filter`,r,{layerType:o.type},n)||(o.filter=t.clone$1(r),this._updateLayer(o)))}else this.fire(new t.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be filtered.`)))}getFilter(e){const i=this.getLayer(e);return i&&t.clone$1(i.filter)}setLayoutProperty(i,r,n,o={}){this._checkLoaded();const s=this.getLayer(i);s?e(s.getLayoutProperty(r),n)||(s.setLayoutProperty(r,n,o),this._updateLayer(s)):this.fire(new t.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(e,i){const r=this.getLayer(e);if(r)return r.getLayoutProperty(i);this.fire(new t.ErrorEvent(new Error(`The layer '${e}' does not exist in the map's style.`)))}setPaintProperty(i,r,n,o={}){this._checkLoaded();const s=this.getLayer(i);s?e(s.getPaintProperty(r),n)||(s.setPaintProperty(r,n,o)&&this._updateLayer(s),this._changed=!0,this._updatedPaintProps[i]=!0):this.fire(new t.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(t,e){const i=this.getLayer(t);return i&&i.getPaintProperty(e)}setFeatureState(e,i){this._checkLoaded();const r=e.source,n=e.sourceLayer,o=this.getSource(r);if(!o)return void this.fire(new t.ErrorEvent(new Error(`The source '${r}' does not exist in the map's style.`)));const s=o.type;if("geojson"===s&&n)return void this.fire(new t.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===s&&!n)return void this.fire(new t.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===e.id&&this.fire(new t.ErrorEvent(new Error("The feature id parameter must be provided.")));const a=this._getSourceCaches(r);for(const t of a)t.setFeatureState(n,e.id,i)}removeFeatureState(e,i){this._checkLoaded();const r=e.source,n=this.getSource(r);if(!n)return void this.fire(new t.ErrorEvent(new Error(`The source '${r}' does not exist in the map's style.`)));const o=n.type,s="vector"===o?e.sourceLayer:void 0;if("vector"===o&&!s)return void this.fire(new t.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(i&&"string"!=typeof e.id&&"number"!=typeof e.id)return void this.fire(new t.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const a=this._getSourceCaches(r);for(const t of a)t.removeFeatureState(s,e.id,i)}getFeatureState(e){this._checkLoaded();const i=e.source,r=e.sourceLayer,n=this.getSource(i);if(n){if("vector"!==n.type||r)return void 0===e.id&&this.fire(new t.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(i)[0].getFeatureState(r,e.id);this.fire(new t.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new t.ErrorEvent(new Error(`The source '${i}' does not exist in the map's style.`)))}getTransition(){return t.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const e={};for(const t in this._sourceCaches){const i=this._sourceCaches[t].getSource();e[i.id]||(e[i.id]=i.serialize())}return t.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.getTerrain()||void 0,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:e,layers:this._serializeLayers(this._order)},(t=>void 0!==t))}_updateLayer(t){this._updatedLayers[t.id]=!0;const e=this._getLayerSourceCache(t);t.source&&!this._updatedSources[t.source]&&e&&"raster"!==e.getSource().type&&(this._updatedSources[t.source]="reload",e.pause()),this._changed=!0,t.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(t){const e=t=>"fill-extrusion"===this._layers[t].type,i={},r=[];for(let n=this._order.length-1;n>=0;n--){const o=this._order[n];if(e(o)){i[o]=n;for(const e of t){const t=e[o];if(t)for(const e of t)r.push(e)}}}r.sort(((t,e)=>e.intersectionZ-t.intersectionZ));const n=[];for(let o=this._order.length-1;o>=0;o--){const s=this._order[o];if(e(s))for(let t=r.length-1;t>=0;t--){const e=r[t].feature;if(i[e.layer.id]<o)break;n.push(e),r.pop()}else for(const e of t){const t=e[s];if(t)for(const e of t)n.push(e.feature)}}return n}queryRenderedFeatures(e,i,r){i&&i.filter&&this._validate(t.validateFilter,"queryRenderedFeatures.filter",i.filter,null,i);const n={};if(i&&i.layers){if(!Array.isArray(i.layers))return this.fire(new t.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const e of i.layers){const i=this._layers[e];if(!i)return this.fire(new t.ErrorEvent(new Error(`The layer '${e}' does not exist in the map's style and cannot be queried for features.`))),[];n[i.source]=!0}}const o=[];i.availableImages=this._availableImages;const s=i&&i.layers?i.layers.some((t=>{const e=this.getLayer(t);return e&&e.is3D()})):this.has3DLayers(),a=k.createFromScreenPoints(e,r);for(const t in this._sourceCaches){const e=this._sourceCaches[t].getSource().id;i.layers&&!n[e]||o.push(Pt(this._sourceCaches[t],this._layers,this._serializedLayers,a,i,r,s,!!this.map._showQueryGeometry))}return this.placement&&o.push(function(t,e,i,r,n,o,s){const a={},l=o.queryRenderedSymbols(r),c=[];for(const t of Object.keys(l).map(Number))c.push(s[t]);c.sort(zt);for(const i of c){const r=i.featureIndex.lookupSymbolFeatures(l[i.bucketInstanceId],e,i.bucketIndex,i.sourceLayerIndex,n.filter,n.layers,n.availableImages,t);for(const t in r){const e=a[t]=a[t]||[],n=r[t];n.sort(((t,e)=>{const r=i.featureSortOrder;if(r){const i=r.indexOf(t.featureIndex);return r.indexOf(e.featureIndex)-i}return e.featureIndex-t.featureIndex}));for(const t of n)e.push(t)}}for(const e in a)a[e].forEach((r=>{const n=r.feature,o=i(t[e]);if(!o)return;const s=o.getFeatureState(n.layer["source-layer"],n.id);n.source=n.layer.source,n.layer["source-layer"]&&(n.sourceLayer=n.layer["source-layer"]),n.state=s}));return a}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),a.screenGeometry,i,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(o)}querySourceFeatures(e,i){i&&i.filter&&this._validate(t.validateFilter,"querySourceFeatures.filter",i.filter,null,i);const r=this._getSourceCaches(e);let n=[];for(const t of r)n=n.concat(Lt(t,i));return n}addSourceType(t,e,i){return Xe.getSourceType(t)?i(new Error(`A source type called "${t}" already exists.`)):(Xe.setSourceType(t,e),e.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:e.workerSourceURL},i):i(null,null))}getLight(){return this.light.getLight()}setLight(t,i={}){this._checkLoaded();const r=this.light.getLight();let n=!1;for(const i in t)if(!e(t[i],r[i])){n=!0;break}if(!n)return;const o=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(t,i),this.light.updateTransitions(o)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(i,r=1){if(this._checkLoaded(),!i)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let n=i;if(1===r){if("object"==typeof n.source){const e="terrain-dem-src";this.addSource(e,n.source),n=t.clone$1(n),n=t.extend(n,{source:e})}if(this._validate(t.validateTerrain,"terrain",n))return}if(!this.terrain||this.terrain&&r!==this.terrain.drapeRenderMode){if(!n)return;this._createTerrain(n,r)}else{const i=this.terrain,r=i.get();for(const e of Object.keys(t.spec.terrain))!n.hasOwnProperty(e)&&t.spec.terrain[e].default&&(n[e]=t.spec.terrain[e].default);for(const t in n)if(!e(n[t],r[t])){i.set(n),this.stylesheet.terrain=n;const t=this._setTransitionParameters({duration:0});i.updateTransitions(t);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(t){const e=this.fog=new S(t,this.map.transform);this.stylesheet.fog=t;const i=this._setTransitionParameters({duration:0});e.updateTransitions(i)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask((()=>{for(const t of this.map._markers)t._evaluateOpacity()}))}getFog(){return this.fog?this.fog.get():null}setFog(t){if(this._checkLoaded(),!t)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const i=this.fog,r=i.get();0===Object.keys(t).length&&i.set(t);for(const n in t)if(!e(t[n],r[n])){i.set(t),this.stylesheet.fog=t;const e=this._setTransitionParameters({duration:0});i.updateTransitions(e);break}}else this._createFog(t);this._markersNeedUpdate=!0}_setTransitionParameters(e){return{now:t.exported.now(),transition:t.extend(e,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const t=this._order.filter((t=>this.isLayerDraped(this._layers[t]))),e=this._order.filter((t=>!this.isLayerDraped(this._layers[t])));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...t),this._drapedFirstOrder.push(...e)}_createTerrain(t,e){const i=this.terrain=new T(t,e);this.stylesheet.terrain=t,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const r=this._setTransitionParameters({duration:0});i.updateTransitions(r)}_force3DLayerUpdate(){for(const t in this._layers){const e=this._layers[t];"fill-extrusion"===e.type&&this._updateLayer(e)}}_forceSymbolLayerUpdate(){for(const t in this._layers){const e=this._layers[t];"symbol"===e.type&&this._updateLayer(e)}}_validate(e,i,r,n,o={}){return(!o||!1!==o.validate)&&$e(this,e.call(t.validateStyle,t.extend({key:i,style:this.serialize(),value:r,styleSpec:t.spec},n)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),t.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const t in this._layers)this._layers[t].setEventedParent(null);for(const t in this._sourceCaches)this._sourceCaches[t].clearTiles(),this._sourceCaches[t].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(t){const e=this._getSourceCaches(t);for(const t of e)t.clearTiles()}_reloadSource(t){const e=this._getSourceCaches(t);for(const t of e)t.resume(),t.reload()}_reloadSources(){for(const t of this._getSources())t.reload&&t.reload()}_updateSources(t){for(const e in this._sourceCaches)this._sourceCaches[e].update(t)}_generateCollisionBoxes(){for(const t in this._sourceCaches){const e=this._sourceCaches[t];e.resume(),e.reload()}}_updatePlacement(e,i,r,n,o=!1){let s=!1,a=!1;const l={};for(const t of this._order){const i=this._layers[t];if("symbol"!==i.type)continue;if(!l[i.source]){const t=this._getLayerSourceCache(i);if(!t)continue;l[i.source]=t.getRenderableIds(!0).map((e=>t.getTileByID(e))).sort(((t,e)=>e.tileID.overscaledZ-t.tileID.overscaledZ||(t.tileID.isLessThan(e.tileID)?-1:1)))}const r=this.crossTileSymbolIndex.addLayer(i,l[i.source],e.center.lng,e.projection);s=s||r}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),o=o||this._layerOrderChanged||0===r,this._layerOrderChanged&&this.fire(new t.Event("neworder")),(o||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(t.exported.now(),e.zoom))&&(this.pauseablePlacement=new Ne(e,this._order,o,i,r,n,this.placement,this.fog&&e.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,l),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(t.exported.now()),a=!0),s&&this.pauseablePlacement.placement.setStale()),a||s)for(const t of this._order){const e=this._layers[t];"symbol"===e.type&&this.placement.updateLayerOpacities(e,l[e.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(t.exported.now())}_releaseSymbolFadeTiles(){for(const t in this._sourceCaches)this._sourceCaches[t].releaseSymbolFadeTiles()}getImages(t,e,i){this.imageManager.getImages(e.icons,i),this._updateTilesForChangedImages();const r=t=>{t&&t.setDependencies(e.tileID.key,e.type,e.icons)};r(this._otherSourceCaches[e.source]),r(this._symbolSourceCaches[e.source])}getGlyphs(t,e,i){this.glyphManager.getGlyphs(e.stacks,i)}getResource(e,i,r){return t.makeRequest(i,r)}_getSourceCache(t){return this._otherSourceCaches[t]}_getLayerSourceCache(t){return"symbol"===t.type?this._symbolSourceCaches[t.source]:this._otherSourceCaches[t.source]}_getSourceCaches(t){const e=[];return this._otherSourceCaches[t]&&e.push(this._otherSourceCaches[t]),this._symbolSourceCaches[t]&&e.push(this._symbolSourceCaches[t]),e}_isSourceCacheLoaded(e){const i=this._getSourceCaches(e);return 0===i.length?(this.fire(new t.ErrorEvent(new Error(`There is no source with ID '${e}'`))),!1):i.every((t=>t.loaded()))}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Xe.getSourceType=function(t){return It[t]},Xe.setSourceType=function(t,e){It[t]=e},Xe.registerForPluginStateChange=t.registerForPluginStateChange;var Je="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#define EXTENT 8192.0\n#define HALF_PI PI/2.0\n#define QUARTER_PI PI/4.0\n#define RAD_TO_DEG 180.0/PI\n#define DEG_TO_RAD PI/180.0\n#define GLOBE_RADIUS EXTENT/PI/2.0",Ye="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",ti="\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\nconst float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)\n{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}\n#ifdef TERRAIN\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;\n#else\nuniform sampler2D u_dem;uniform sampler2D u_dem_prev;\n#endif\nuniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));\n#ifdef TERRAIN_DEM_NEAREST_FILTER\nreturn u_exaggeration*tl;\n#endif\nfloat tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nfloat nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nreturn currentElevation(apos);}\n#endif\nhighp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nfloat tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;\n#else\nvec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);\n#endif\nreturn vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",ei="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",ii="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif";let ri={},ni={};const oi=[];ui(Je,oi),ui(ti,oi),ui(ei,oi),ui(ii,oi),ri=hi("",ti),ni=hi(ii,ei);const si=hi("\n#if __VERSION__ >=300\n#define varying in\n#define gl_FragColor glFragColor\n#define texture2D texture\n#define textureCube texture\nout vec4 glFragColor;\n#endif\nhighp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}","\n#if __VERSION__ >=300\n#define attribute in\n#define varying out\n#define texture2D texture\n#endif\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#ifndef PROJECTED_POS_ON_VIEWPORT\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered."),ai=Je,li="\n#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif";var ci={background:hi("uniform vec4 u_color;uniform float u_opacity;\n#ifdef LIGHTING_3D_MODE\nvarying vec4 v_color;\n#endif\nvoid main() {vec4 out_color;\n#ifdef LIGHTING_3D_MODE\nout_color=v_color;\n#else\nout_color=u_color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#ifdef LIGHTING_3D_MODE\nuniform vec4 u_color;varying vec4 v_color;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting(u_color);\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),backgroundPattern:hi("uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),circle:hi("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\ngl_FragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);\n#else \nsurface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nocclusion_world_center=world_center;occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}"),clippingMask:hi("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:hi("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\nif (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\npos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),heatmapTexture:hi("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:hi("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}","attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:hi("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:hi("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;\n#endif\nvarying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}"),fill:hi("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutline:hi("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutlinePattern:hi("uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;varying vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;varying vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillPattern:hi("uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillExtrusion:hi("varying vec4 v_color;\n#ifdef RENDER_SHADOWS\nvarying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef ZERO_ROOF_RADIUS\nvarying vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvarying highp vec3 v_normal;\n#endif\nvoid main() {\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvec3 normal=v_normal;\n#endif\nfloat z;vec4 color;\n#ifdef ZERO_ROOF_RADIUS\nz=float(normal.z > 0.00001);color=mix(v_color,v_roof_color,z);\n#else\ncolor=v_color;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;\n#ifdef ZERO_ROOF_RADIUS\nconcave*=(1.0-z);\n#endif\nfloat x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;\n#endif\n#ifdef RENDER_SHADOWS\n#ifdef ZERO_ROOF_RADIUS\nnormal=mix(normal,vec3(0.0,0.0,1.0),z);\n#endif\ncolor.xyz=shadowed_color_normal(color.xyz,normalize(normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec4 v_color;\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;\n#endif\n#ifdef ZERO_ROOF_RADIUS\nvarying vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvarying highp vec3 v_normal;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nv_normal=normal;\n#endif\nbase=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=0.0;float c_ele;vec3 pos;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);\n#else\nh=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);\n#ifdef RENDER_SHADOWS\nv_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_depth=gl_Position.w;\n#endif\nfloat NdotL=0.0;float colorvalue=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\ncolorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}v_color=vec4(0.0,0.0,0.0,1.0);\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting(color,NdotL);\n#else\nv_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));\n#endif\nv_color*=u_opacity;\n#ifdef ZERO_ROOF_RADIUS\nv_roof_color=vec4(0.0,0.0,0.0,1.0);\n#ifdef LIGHTING_3D_MODE\nv_roof_color=apply_lighting(color,calculate_NdotL(vec3(0.0,0.0,1.0)));\n#else\nfloat roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));\n#endif\nv_roof_color*=u_opacity;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),fillExtrusionPattern:hi("uniform vec2 u_texsize;uniform sampler2D u_image;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nvarying float v_NdotL;\n#endif\nvarying vec2 v_pos;varying vec4 v_lighting;uniform lowp float u_opacity;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color,v_NdotL)*u_opacity;\n#else\nout_color=out_color*v_lighting;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec2 v_pos;varying vec4 v_lighting;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nvarying float v_NdotL;\n#endif\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=z;vec3 p;float c_ele;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);\n#else\np=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\nNdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_NdotL=NdotL;\n#else\nv_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#endif \n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}"),hillshadePrepare:hi("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nreturn texture2D(u_image,coord).a/4.0;\n#else\nvec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;\n#endif\n}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:hi("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef LIGHTING_3D_MODE\ngl_FragColor=apply_lighting(gl_FragColor);\n#endif\n#ifdef FOG\ngl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),line:hi("uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;varying vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;\n#endif\nuniform float u_border_width;uniform vec4 u_border_color;float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nfloat linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist=texture2D(u_dash_image,v_tex).a;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\nhighp vec4 out_color;\n#ifdef RENDER_LINE_GRADIENT\nout_color=texture2D(u_gradient_image,v_uv.xy);\n#else\nout_color=color;\n#endif\nfloat trimmed=1.0;\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef RENDER_LINE_ALPHA_DISCARD\nif (alpha < u_alpha_discard_threshold) {discard;}\n#endif\n#ifdef RENDER_LINE_BORDER\nfloat edgeBlur=(u_border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);\n#ifdef RENDER_LINE_BORDER_AUTO\nfloat Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}\n#else\nout_color.rgb=mix(u_border_color.rgb*u_border_color.a*trimmed,out_color.rgb,smoothAlpha);\n#endif\n}\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define EXTRUDE_SCALE 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nattribute highp vec4 a_packed;\n#endif\n#ifdef RENDER_LINE_DASH\nattribute float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform float u_tile_units_to_pixels;varying vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];\n#ifdef RENDER_LINE_GRADIENT\nhighp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);\n#else\nv_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);\n#endif\n#endif\n#ifdef RENDER_LINE_DASH\nfloat scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),linePattern:hi("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x=mod(v_linesofar/pattern_size.x*aspect,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec4 color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\ncolor=apply_lighting(color);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),raster:hi("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply(out_color,v_fog_pos));\n#endif\ngl_FragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),symbolIcon:hi("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}"),symbolSDF:hi("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}"),symbolTextAndIcon:hi("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}"),terrainRaster:hi("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nvarying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nvoid main() {vec4 color=texture2D(u_image0,v_pos0);\n#ifdef RENDER_SHADOWS\ncolor.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#endif\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#else\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nconst float wireframeOffset=0.00015;void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;\n#ifdef TERRAIN_WIREFRAME\nelevation+=wireframeOffset;\n#endif\nv_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\nv_fog_pos=fog_position(decodedPos);\n#else\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;\n#endif\n}"),terrainDepth:hi("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_matrix;attribute vec2 a_pos;varying float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:hi("\nvarying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",Ye),skyboxGradient:hi("varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",Ye),skyboxCapture:hi("\nvarying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;\n#ifdef GL_ES\nprecision highp float;\n#endif\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}","attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:hi("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifndef FOG\nuniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;\n#endif\nvoid main() {vec4 color;\n#ifdef CUSTOM_ANTIALIASING\nvec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);color=vec4(raster.rgb*antialias,raster.a*antialias);\n#else\ncolor=texture2D(u_image0,v_pos0);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;\n#ifdef GLOBE_POLES\nattribute vec3 a_globe_pos;attribute vec2 a_uv;\n#else\nattribute vec2 a_pos;\n#endif\nvarying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;vec2 uv=a_uv;\n#else\nfloat tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);\n#endif\nv_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;\n#ifdef GLOBE_POLES\nvec3 up_vector=globe_derived_up_vector;\n#else\nvec3 up_vector=elevationVector(tile_pos);\n#endif\nfloat height=elevation(tile_pos);\n#ifdef TERRAIN_WIREFRAME\nheight+=wireframeOffset;\n#endif\nglobe_pos+=up_vector*height;\n#ifndef GLOBE_POLES\nglobe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;\n#endif\n#ifdef GLOBE_POLES\nvec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);\n#else\nvec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);\n#endif\ngl_Position=u_proj_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n}"),globeAtmosphere:hi("uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;\n#ifdef PROJECTION_GLOBE_VIEW\nglobe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}\n#endif\nhighp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?\n0.0 : max(acos(dot(dir,horizon_dir)),0.0);float horizon_angle;\n#ifdef PROJECTION_GLOBE_VIEW\nhighp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?\nPI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);\n#else\nhorizon_angle=horizon_angle_mercator;\n#endif\nhorizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:\n(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:\nuv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}","attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(\nmix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}")};function ui(t,e){const i=t.replace(/\s*\/\/[^\n]*\n/g,"\n").split("\n");for(let t of i)if(t=t.trim(),"#"===t[0]&&t.includes("if")&&!t.includes("endif")){t=t.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const i=t.split(" ");for(const t of i)e.includes(t)||e.push(t)}}function hi(t,e){const i=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,r=e.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),n={},o=[...oi];return ui(t,o),ui(e,o),{fragmentSource:t=t.replace(i,((t,e,i,r,o)=>(n[o]=!0,"define"===e?`\n#ifndef HAS_UNIFORM_u_${o}\nvarying ${i} ${r} ${o};\n#else\nuniform ${i} ${r} u_${o};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${o}\n    ${i} ${r} ${o} = u_${o};\n#endif\n`))),vertexSource:e=e.replace(i,((t,e,i,r,o)=>{const s="float"===r?"vec2":"vec4",a=o.match(/color/)?"color":s;return n[o]?"define"===e?`\n#ifndef HAS_UNIFORM_u_${o}\nuniform lowp float u_${o}_t;\nattribute ${i} ${s} a_${o};\nvarying ${i} ${r} ${o};\n#else\nuniform ${i} ${r} u_${o};\n#endif\n`:"vec4"===a?`\n#ifndef HAS_UNIFORM_u_${o}\n    ${o} = a_${o};\n#else\n    ${i} ${r} ${o} = u_${o};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${o}\n    ${o} = unpack_mix_${a}(a_${o}, u_${o}_t);\n#else\n    ${i} ${r} ${o} = u_${o};\n#endif\n`:"define"===e?`\n#ifndef HAS_UNIFORM_u_${o}\nuniform lowp float u_${o}_t;\nattribute ${i} ${s} a_${o};\n#else\nuniform ${i} ${r} u_${o};\n#endif\n`:"vec4"===a?`\n#ifndef HAS_UNIFORM_u_${o}\n    ${i} ${r} ${o} = a_${o};\n#else\n    ${i} ${r} ${o} = u_${o};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${o}\n    ${i} ${r} ${o} = unpack_mix_${a}(a_${o}, u_${o}_t);\n#else\n    ${i} ${r} ${o} = u_${o};\n#endif\n`})),staticAttributes:r,usedDefines:o}}class di{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(t,e,i,r,n,o,s){this.context=t;let a=this.boundPaintVertexBuffers.length!==r.length;for(let t=0;!a&&t<r.length;t++)this.boundPaintVertexBuffers[t]!==r[t]&&(a=!0);let l=this.boundDynamicVertexBuffers.length!==s.length;for(let t=0;!l&&t<s.length;t++)this.boundDynamicVertexBuffers[t]!==s[t]&&(l=!0);if(!t.extVertexArrayObject||!this.vao||this.boundProgram!==e||this.boundLayoutVertexBuffer!==i||a||l||this.boundIndexBuffer!==n||this.boundVertexOffset!==o)this.freshBind(e,i,r,n,o,s);else{t.bindVertexArrayOES.set(this.vao);for(const t of s)t&&t.bind();n&&n.dynamicDraw&&n.bind()}}freshBind(t,e,i,r,n,o){let s;const a=t.numAttributes,l=this.context,c=l.gl;if(l.extVertexArrayObject)this.vao&&this.destroy(),this.vao=l.extVertexArrayObject.createVertexArrayOES(),l.bindVertexArrayOES.set(this.vao),s=0,this.boundProgram=t,this.boundLayoutVertexBuffer=e,this.boundPaintVertexBuffers=i,this.boundIndexBuffer=r,this.boundVertexOffset=n,this.boundDynamicVertexBuffers=o;else{s=l.currentNumAttributes||0;for(let t=a;t<s;t++)c.disableVertexAttribArray(t)}e.enableAttributes(c,t),e.bind(),e.setVertexAttribPointers(c,t,n);for(const e of i)e.enableAttributes(c,t),e.bind(),e.setVertexAttribPointers(c,t,n);for(const e of o)e&&(e.enableAttributes(c,t),e.bind(),e.setVertexAttribPointers(c,t,n));r&&r.bind(),l.currentNumAttributes=a}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function pi(e,i){const r=Math.pow(2,i.canonical.z),n=i.canonical.y;return[new t.MercatorCoordinate(0,n/r).toLngLat().lat,new t.MercatorCoordinate(0,(n+1)/r).toLngLat().lat]}function fi(e,i,r,n,o,s,a){const l=e.context,c=l.gl,u=r.fbo;if(!u)return;e.prepareDrawTile();const h=e.useProgram("hillshade");l.activeTexture.set(c.TEXTURE0),c.bindTexture(c.TEXTURE_2D,u.colorAttachment.get());const d=((t,e,i,r)=>{const n=i.paint.get("hillshade-shadow-color"),o=i.paint.get("hillshade-highlight-color"),s=i.paint.get("hillshade-accent-color");let a=i.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===i.paint.get("hillshade-illumination-anchor")&&(a-=t.transform.angle);const l=!t.options.moving;return{u_matrix:r||t.transform.calculateProjMatrix(e.tileID.toUnwrapped(),l),u_image:0,u_latrange:pi(0,e.tileID),u_light:[i.paint.get("hillshade-exaggeration"),a],u_shadow:n,u_highlight:o,u_accent:s}})(e,r,n,e.terrain?i.projMatrix:null);e.prepareDrawProgram(l,h,i.toUnwrapped());const{tileBoundsBuffer:p,tileBoundsIndexBuffer:f,tileBoundsSegments:A}=e.getTileBoundsBuffers(r);h.draw(l,c.TRIANGLES,o,s,a,t.CullFaceMode.disabled,d,n.id,p,f,A)}function Ai(e,i,r){if(!i.needsDEMTextureUpload)return;const n=e.context,o=n.gl;n.pixelStoreUnpackPremultiplyAlpha.set(!1),i.demTexture=i.demTexture||e.getTileTexture(r.stride);const s=r.getPixels();i.demTexture?i.demTexture.update(s,{premultiply:!1}):i.demTexture=new t.Texture(n,s,o.RGBA,{premultiply:!1}),i.needsDEMTextureUpload=!1}function mi(e,i,r,n,o,s){const a=e.context,l=a.gl;if(!i.dem)return;const c=i.dem;if(a.activeTexture.set(l.TEXTURE1),Ai(e,i,c),!i.demTexture)return;i.demTexture.bind(l.NEAREST,l.CLAMP_TO_EDGE);const u=c.dim;a.activeTexture.set(l.TEXTURE0);let h=i.fbo;if(!h){const e=new t.Texture(a,{width:u,height:u,data:null},l.RGBA);e.bind(l.LINEAR,l.CLAMP_TO_EDGE),h=i.fbo=a.createFramebuffer(u,u,!0),h.colorAttachment.set(e.texture)}a.bindFramebuffer.set(h.framebuffer),a.viewport.set([0,0,u,u]);const{tileBoundsBuffer:d,tileBoundsIndexBuffer:p,tileBoundsSegments:f}=e.getMercatorTileBoundsBuffers();e.useProgram("hillshadePrepare").draw(a,l.TRIANGLES,n,o,s,t.CullFaceMode.disabled,((e,i)=>{const r=i.stride,n=t.create();return t.ortho(n,0,t.EXTENT,-t.EXTENT,0,0,1),t.translate(n,n,[0,-t.EXTENT,0]),{u_matrix:n,u_image:1,u_dimension:[r,r],u_zoom:e.overscaledZ,u_unpack:i.unpackVector}})(i.tileID,c),r.id,d,p,f),i.needsHillshadePrepare=!1}const gi=e=>({u_matrix:new t.UniformMatrix4f(e),u_image0:new t.Uniform1i(e),u_skirt_height:new t.Uniform1f(e)}),_i=(t,e)=>({u_matrix:t,u_image0:0,u_skirt_height:e}),yi=(t,e,i,r,n,o,s,a,l,c,u,h,d,p,f)=>({u_proj_matrix:Float32Array.from(t),u_globe_matrix:e,u_normalize_matrix:Float32Array.from(r),u_merc_matrix:i,u_zoom_transition:n,u_merc_center:o,u_image0:0,u_frustum_tl:s,u_frustum_tr:a,u_frustum_br:l,u_frustum_bl:c,u_globe_pos:u,u_globe_radius:h,u_viewport:d,u_grid_matrix:f?Float32Array.from(f):new Float32Array(9),u_skirt_height:p});function vi(t,e){return null!=t&&null!=e&&!(!t.hasData()||!e.hasData())&&null!=t.demTexture&&null!=e.demTexture&&t.tileID.key!==e.tileID.key}const xi=new class{constructor(){this.operations={}}newMorphing(t,e,i,r,n){if(t in this.operations){const e=this.operations[t];e.to.tileID.key!==i.tileID.key&&(e.queued=i)}else this.operations[t]={startTime:r,phase:0,duration:n,from:e,to:i,queued:null}}getMorphValuesForProxy(t){if(!(t in this.operations))return null;const e=this.operations[t];return{from:e.from,to:e.to,phase:e.phase}}update(t){for(const e in this.operations){const i=this.operations[e];for(i.phase=(t-i.startTime)/i.duration;i.phase>=1||!this._validOp(i);)if(!this._nextOp(i,t)){delete this.operations[e];break}}}_nextOp(t,e){return!!t.queued&&(t.from=t.to,t.to=t.queued,t.queued=null,t.phase=0,t.startTime=e,!0)}_validOp(t){return t.from.hasData()&&t.to.hasData()}},bi={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function wi(t){return 6*Math.pow(1.5,22-t)}function Ti(t,e){const i=1<<t.z;return!e&&(0===t.x||t.x===i-1)||0===t.y||t.y===i-1}const Bi=t=>({u_matrix:t});function Ei(e,i,r,n,o){if(o>0){const s=t.exported.now(),a=(s-e.timeAdded)/o,l=i?(s-i.timeAdded)/o:-1,c=r.getSource(),u=n.coveringZoomLevel({tileSize:c.tileSize,roundZoom:c.roundZoom}),h=!i||Math.abs(i.tileID.overscaledZ-u)>Math.abs(e.tileID.overscaledZ-u),d=h&&e.refreshedUponExpiration?1:t.clamp(h?a:1-l,0,1);return e.refreshedUponExpiration&&a>=1&&(e.refreshedUponExpiration=!1),i?{opacity:1,mix:1-d}:{opacity:d,mix:0}}return{opacity:1,mix:0}}class Ci extends t.SourceCache{constructor(t){const e={type:"raster-dem",maxzoom:t.transform.maxZoom},i=new I(Ot(),null),r=Mt("mock-dem",e,i,t.style);super("mock-dem",r,!1),r.setEventedParent(this),this._sourceLoaded=!0}_loadTile(t,e){t.state="loaded",e(null)}}class Si extends t.SourceCache{constructor(t){const e=Mt("proxy",{type:"geojson",maxzoom:t.transform.maxZoom},new I(Ot(),null),t.style);super("proxy",e,!1),e.setEventedParent(this),this.map=this.getSource().map=t,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(e,i,r){if(e.freezeTileCoverage)return;this.transform=e;const n=e.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce(((i,r)=>{if(i[r.key]="",!this._tiles[r.key]){const i=new t.Tile(r,this._source.tileSize*r.overscaleFactor(),e.tileZoom);i.state="loaded",this._tiles[r.key]=i}return i}),{});for(const t in this._tiles)t in n||(this.freeFBO(t),this._tiles[t].unloadVectorData(),delete this._tiles[t])}freeFBO(t){const e=this.proxyCachedFBO[t];if(void 0!==e){const i=Object.values(e);this.renderCachePool.push(...i),delete this.proxyCachedFBO[t]}}deallocRenderCache(){this.renderCache.forEach((t=>t.fb.destroy())),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Ii extends t.OverscaledTileID{constructor(t,e,i){super(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y),this.proxyTileKey=e,this.projMatrix=i}}class Mi extends t.Elevation{constructor(e,i){super(),this.painter=e,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[r,n,o]=function(e){const i=new t.StructArrayLayout2i4,r=new t.StructArrayLayout3ui6,n=131;i.reserve(17161),r.reserve(33800);const o=t.EXTENT/128,s=t.EXTENT+o/2,a=s+o;for(let e=-o;e<a;e+=o)for(let r=-o;r<a;r+=o){const n=r<0||r>s||e<0||e>s?24575:0,o=t.clamp(Math.round(r),0,t.EXTENT),a=t.clamp(Math.round(e),0,t.EXTENT);i.emplaceBack(o+n,a)}const l=(t,e)=>{const i=e*n+t;r.emplaceBack(i+1,i,i+n),r.emplaceBack(i+n,i+n+1,i+1)};for(let t=1;t<129;t++)for(let e=1;e<129;e++)l(e,t);return[0,129].forEach((t=>{for(let e=0;e<130;e++)l(e,t),l(t,e)})),[i,r,32768]}(),s=e.context;this.gridBuffer=s.createVertexBuffer(r,t.posAttributes.members),this.gridIndexBuffer=s.createIndexBuffer(n),this.gridSegments=t.SegmentVector.simpleSegment(0,0,r.length,n.length),this.gridNoSkirtSegments=t.SegmentVector.simpleSegment(0,0,r.length,o),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Si(i.map),this.orthoMatrix=t.create(),t.ortho(this.orthoMatrix,"globe"===this.painter.transform.projection.name?.015:0,t.EXTENT,0,t.EXTENT,0,1);const a=s.gl;this._overlapStencilMode=new t.StencilMode({func:a.GEQUAL,mask:255},0,255,a.KEEP,a.KEEP,a.REPLACE),this._previousZoom=e.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=i,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Ci(i.map)}set style(t){t.on("data",this._onStyleDataEvent.bind(this)),t.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=t,this._checkRenderCacheEfficiency(),this._style.map.on("moveend",(()=>{this._clearLineLayersFromRenderCache()}))}update(e,i,r){if(e&&e.terrain){this._style!==e&&(this.style=e),this.enabled=!0;const n=e.terrain.properties;this.sourceCache=0===e.terrain.drapeRenderMode?this._mockSourceCache:e._getSourceCache(n.get("source")),this._exaggeration=n.get("exaggeration");const o=()=>{this.sourceCache.used&&t.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const e=this.getScaledDemTileSize();this.sourceCache.update(i,e,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,o(),this._initializing=!0),o(),i.updateElevation(!0,r),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(i),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(t){this._findCoveringTileCache[t]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const e=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||100!==e.efficiency&&t.warnOnce(`Terrain render cache efficiency is not optimal (${e.efficiency}%) and performance\n                may be affected negatively, consider placing all background, fill and line layers before layer\n                with id '${e.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(t){t.coord&&"source"===t.dataType?this._clearRenderCacheForTile(t.sourceCacheId,t.coord):"style"===t.dataType&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const t in this._style._sourceCaches)this._style._sourceCaches[t].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach((t=>t.fb.destroy())),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const t=2*this.proxySourceCache.getSource().tileSize;return[t,t]}set useVertexMorphing(t){this._useVertexMorphing=t}updateTileBinding(e){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const i=this.proxySourceCache,r=this.painter.transform;this._initializing&&(this._initializing=0===r._centerAltitude&&-1===this.getAtPointOrZero(t.MercatorCoordinate.fromLngLat(r.center),-1),this._emptyDEMTextureDirty=!this._initializing);const n=this.proxyCoords=i.getIds().map((t=>{const e=i.getTileByID(t).tileID;return e.projMatrix=r.calculateProjMatrix(e.toUnwrapped()),e}));!function(e,i){const r=i.transform.pointCoordinate(i.transform.getCameraPoint()),n=new t.Point(r.x,r.y);e.sort(((e,i)=>{if(i.overscaledZ-e.overscaledZ)return i.overscaledZ-e.overscaledZ;const r=new t.Point(e.canonical.x+(1<<e.canonical.z)*e.wrap,e.canonical.y),o=new t.Point(i.canonical.x+(1<<i.canonical.z)*i.wrap,i.canonical.y),s=n.mult(1<<e.canonical.z);return s.x-=.5,s.y-=.5,s.distSqr(r)-s.distSqr(o)}))}(n,this.painter),this._previousZoom=r.zoom;const o=this.proxyToSource||{};this.proxyToSource={},n.forEach((t=>{this.proxyToSource[t.key]={}})),this.terrainTileForTile={};const s=this._style._sourceCaches;for(const t in s){const i=s[t];if(!i.used)continue;if(i!==this.sourceCache&&this.resetTileLookupCache(i.id),this._setupProxiedCoordsForOrtho(i,e[t],o),i.usedForTerrain)continue;const r=e[t];i.getSource().reparseOverscaled&&this._assignTerrainTiles(r)}this.proxiedCoords[i.id]=n.map((t=>new Ii(t,t.key,this.orthoMatrix))),this._assignTerrainTiles(n),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(o),this.renderingToTexture=!1,this._updateTimestamp=t.exported.now();const a={};this._visibleDemTiles=[];for(const t of this.proxyCoords){const e=this.terrainTileForTile[t.key];if(!e)continue;const i=e.tileID.key;i in a||(this._visibleDemTiles.push(e),a[i]=i)}}_assignTerrainTiles(t){this._initializing||t.forEach((t=>{if(this.terrainTileForTile[t.key])return;const e=this._findTileCoveringTileID(t,this.sourceCache);e&&(this.terrainTileForTile[t.key]=e)}))}_prepareDEMTextures(){const t=this.painter.context,e=t.gl;for(const i in this.terrainTileForTile){const r=this.terrainTileForTile[i],n=r.dem;!n||r.demTexture&&!r.needsDEMTextureUpload||(t.activeTexture.set(e.TEXTURE1),Ai(this.painter,r,n))}}_prepareDemTileUniforms(t,e,i,r){if(!e||null==e.demTexture)return!1;const n=t.tileID.canonical,o=Math.pow(2,e.tileID.canonical.z-n.z),s=r||"";return i[`u_dem_tl${s}`]=[n.x*o%1,n.y*o%1],i[`u_dem_scale${s}`]=o,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const e=this.painter.context,i=e.gl;if(!this._emptyDepthBufferTexture){const r=new t.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new t.Texture(e,r,i.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let t=0;const e=this._visibleDemTiles.reduce(((e,i)=>{if(!i.dem)return e;const r=i.dem.tree.minimums[0];return r>0&&t++,e+r}),0);return t?e/t:0}_updateEmptyDEMTexture(){const e=this.painter.context,i=e.gl;e.activeTexture.set(i.TEXTURE2);const r=this._getLoadedAreaMinimum(),n=new t.RGBAImage({width:1,height:1},new Uint8Array(t.DEMData.pack(r,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let o=this._emptyDEMTexture;return o?o.update(n,{premultiply:!1}):o=this._emptyDEMTexture=new t.Texture(e,n,i.RGBA,{premultiply:!1}),o}setupElevationDraw(e,i,r){const n=this.painter.context,o=n.gl,s=(a=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:t.DEMData.getUnpackVector(a),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var a;s.u_dem_size=this.sourceCache.getSource().tileSize,s.u_exaggeration=this.exaggeration();let l=null,c=null,u=1;if(r&&r.morphing&&this._useVertexMorphing){const t=r.morphing.srcDemTile,i=r.morphing.dstDemTile;u=r.morphing.phase,t&&i&&(this._prepareDemTileUniforms(e,t,s,"_prev")&&(c=t),this._prepareDemTileUniforms(e,i,s)&&(l=i))}if(c&&l?(n.activeTexture.set(o.TEXTURE2),l.demTexture.bind(o.NEAREST,o.CLAMP_TO_EDGE,o.NEAREST),n.activeTexture.set(o.TEXTURE4),c.demTexture.bind(o.NEAREST,o.CLAMP_TO_EDGE,o.NEAREST),s.u_dem_lerp=u):(l=this.terrainTileForTile[e.tileID.key],n.activeTexture.set(o.TEXTURE2),(this._prepareDemTileUniforms(e,l,s)?l.demTexture:this.emptyDEMTexture).bind(o.NEAREST,o.CLAMP_TO_EDGE)),n.activeTexture.set(o.TEXTURE3),r&&r.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(o.NEAREST,o.CLAMP_TO_EDGE),this._depthFBO&&(s.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(o.NEAREST,o.CLAMP_TO_EDGE),s.u_depth_size_inv=[1,1]),r&&r.useMeterToDem&&l){const e=(1<<l.tileID.canonical.z)*t.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;s.u_meter_to_dem=e}if(r&&r.labelPlaneMatrixInv&&(s.u_label_plane_matrix_inv=r.labelPlaneMatrixInv),i.setTerrainUniformValues(n,s),"globe"===this.painter.transform.projection.name){const t=this.globeUniformValues(this.painter.transform,e.tileID.canonical,r&&r.useDenormalizedUpVectorScale);i.setGlobeUniformValues(n,t)}}globeUniformValues(e,i,r){const n=e.projection;return{u_tile_tl_up:n.upVector(i,0,0),u_tile_tr_up:n.upVector(i,t.EXTENT,0),u_tile_br_up:n.upVector(i,t.EXTENT,t.EXTENT),u_tile_bl_up:n.upVector(i,0,t.EXTENT),u_tile_up_scale:r?t.globeMetersToEcef(1):n.upVectorScale(i,e.center.lat,e.worldSize).metersToTile}}renderToBackBuffer(e){const i=this.painter,r=this.painter.context;0!==e.length&&(r.bindFramebuffer.set(null),r.viewport.set([0,0,i.width,i.height]),i.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(e,i,r,n,o){if("globe"===e.transform.projection.name)!function(e,i,r,n,o){const s=e.context,a=s.gl;let l,c;const u=e.options.showTerrainWireframe?2:0,h=e.transform,d=t.globeUseCustomAntiAliasing(e,s,h),p=(t,i)=>{if(c===t)return;const r=[bi[t],"PROJECTION_GLOBE_VIEW"];d&&r.push("CUSTOM_ANTIALIASING"),i&&r.push(bi[u]),l=e.useProgram("globeRaster",null,r),c=t},f=e.colorModeForRenderPass(),A=new t.DepthMode(a.LEQUAL,t.DepthMode.ReadWrite,e.depthRangeFor3D);xi.update(o);const m=t.calculateGlobeMercatorMatrix(h),g=[t.mercatorXfromLng(h.center.lng),t.mercatorYfromLat(h.center.lat)],_=u?[!1,!0]:[!1],y=e.globeSharedBuffers,v=[h.width*t.exported.devicePixelRatio,h.height*t.exported.devicePixelRatio],x=Float32Array.from(h.globeMatrix),b={useDenormalizedUpVectorScale:!0};if(_.forEach((u=>{const h=e.transform,d=wi(h.zoom)*i.exaggeration();c=-1;const _=u?a.LINES:a.TRIANGLES;for(const c of n){const n=r.getTile(c),w=t.StencilMode.disabled,T=i.prevTerrainTileForTile[c.key],B=i.terrainTileForTile[c.key];vi(T,B)&&xi.newMorphing(c.key,T,B,o,250),s.activeTexture.set(a.TEXTURE0),n.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE);const E=xi.getMorphValuesForProxy(c.key),C=E?1:0;E&&t.extend$1(b,{morphing:{srcDemTile:E.from,dstDemTile:E.to,phase:t.easeCubicInOut(E.phase)}});const S=t.tileCornersToBounds(c.canonical),I=t.getLatitudinalLod(S.getCenter().lat),M=t.getGridMatrix(c.canonical,S,I,h.worldSize/h._pixelsPerMercatorPixel),k=t.globeNormalizeECEF(t.globeTileBounds(c.canonical)),P=yi(h.projMatrix,x,m,k,t.globeToMercatorTransition(h.zoom),g,h.frustumCorners.TL,h.frustumCorners.TR,h.frustumCorners.BR,h.frustumCorners.BL,h.globeCenterInViewSpace,h.globeRadius,v,d,M);if(p(C,u),i.setupElevationDraw(n,l,b),e.prepareDrawProgram(s,l,c.toUnwrapped()),y){const[i,r,n]=u?y.getWirefameBuffers(e.context,I):y.getGridBuffers(I,0!==d);l.draw(s,_,A,w,f,t.CullFaceMode.backCCW,P,"globe_raster",i,r,n)}}})),y){const o=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];d&&o.push("CUSTOM_ANTIALIASING"),l=e.useProgram("globeRaster",null,o);for(const o of n){const{x:n,y:c,z:u}=o.canonical,d=0===c,p=c===(1<<u)-1,[m,_,x,w]=y.getPoleBuffers(u);if(w&&(d||p)){const c=r.getTile(o);s.activeTexture.set(a.TEXTURE0),c.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE);let y=t.globePoleMatrixForTile(u,n,h);const T=t.globeNormalizeECEF(t.globeTileBounds(o.canonical)),B=(e,i)=>e.draw(s,a.TRIANGLES,A,t.StencilMode.disabled,f,t.CullFaceMode.disabled,yi(h.projMatrix,y,y,T,0,g,h.frustumCorners.TL,h.frustumCorners.TR,h.frustumCorners.BR,h.frustumCorners.BL,h.globeCenterInViewSpace,h.globeRadius,v,0),"globe_pole_raster",i,x,w);i.setupElevationDraw(c,l,b),e.prepareDrawProgram(s,l,o.toUnwrapped()),d&&B(l,m),p&&(y=t.scale(t.create(),y,[1,-1,1]),B(l,_))}}}}(e,i,r,n,o);else{const s=e.context,a=s.gl;let l,c;const u=e.options.showTerrainWireframe?2:0,h=(t,i)=>{if(c===t)return;const r=[bi[t]];i&&r.push(bi[u]),l=e.useProgram("terrainRaster",null,r),c=t},d=e.colorModeForRenderPass(),p=new t.DepthMode(a.LEQUAL,t.DepthMode.ReadWrite,e.depthRangeFor3D);xi.update(o);const f=e.transform,A=wi(f.zoom)*i.exaggeration();(u?[!1,!0]:[!1]).forEach((u=>{c=-1;const m=u?a.LINES:a.TRIANGLES,[g,_]=u?i.getWirefameBuffer():[i.gridIndexBuffer,i.gridSegments];for(const c of n){const n=r.getTile(c),y=t.StencilMode.disabled,v=i.prevTerrainTileForTile[c.key],x=i.terrainTileForTile[c.key];vi(v,x)&&xi.newMorphing(c.key,v,x,o,250),s.activeTexture.set(a.TEXTURE0),n.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE,a.LINEAR_MIPMAP_NEAREST);const b=xi.getMorphValuesForProxy(c.key),w=b?1:0;let T;b&&(T={morphing:{srcDemTile:b.from,dstDemTile:b.to,phase:t.easeCubicInOut(b.phase)}});const B=_i(c.projMatrix,Ti(c.canonical,f.renderWorldCopies)?A/10:A);h(w,u),i.setupElevationDraw(n,l,T),e.prepareDrawProgram(s,l,c.toUnwrapped()),l.draw(s,m,p,y,d,t.CullFaceMode.backCCW,B,"terrain_raster",i.gridBuffer,g,_)}}))}}(i,this,this.proxySourceCache,e,this._updateTimestamp),this.renderingToTexture=!0,i.gpuTimingDeferredRenderEnd(),e.splice(0,e.length))}renderBatch(e){if(0===this._drapedRenderBatches.length)return e+1;this.renderingToTexture=!0;const i=this.painter,r=this.painter.context,n=this.proxySourceCache,o=this.proxiedCoords[n.id],s=this._drapedRenderBatches.shift(),a=[],l=i.style.order;let c=0;for(const u of o){const o=n.getTileByID(u.proxyTileKey),h=n.proxyCachedFBO[u.key]?n.proxyCachedFBO[u.key][e]:void 0,d=void 0!==h?n.renderCache[h]:this.pool[c++],p=void 0!==h;if(o.texture=d.tex,p&&!d.dirty){a.push(o.tileID);continue}let f;r.bindFramebuffer.set(d.fb.framebuffer),this.renderedToTile=!1,d.dirty&&(r.clear({color:t.Color.transparent,stencil:0}),d.dirty=!1);for(let t=s.start;t<=s.end;++t){const e=i.style._layers[l[t]];if(e.isHidden(i.transform.zoom))continue;const n=i.style._getLayerSourceCache(e),o=n?this.proxyToSource[u.key][n.id]:[u];if(!o)continue;const s=o;r.viewport.set([0,0,d.fb.width,d.fb.height]),f!==(n?n.id:null)&&(this._setupStencil(d,o,e,n),f=n?n.id:null),i.renderLayer(i,n,e,s)}this.renderedToTile?(d.dirty=!0,a.push(o.tileID)):p||--c,5===c&&(c=0,this.renderToBackBuffer(a))}return this.renderToBackBuffer(a),this.renderingToTexture=!1,r.bindFramebuffer.set(null),r.viewport.set([0,0,i.width,i.height]),s.end+1}postRender(){}renderCacheEfficiency(t){const e=t.order.length;if(0===e)return{efficiency:100};let i,r=0,n=0,o=!1;for(let s=0;s<e;++s){const e=t._layers[t.order[s]];this._style.isLayerDraped(e)?(o&&++r,++n):o||(o=!0,i=e.id)}return 0===n?{efficiency:100}:{efficiency:100*(1-r/n),firstUndrapedLayer:i}}getMinElevationBelowMSL(){let t=0;return this._visibleDemTiles.filter((t=>t.dem)).forEach((e=>{t=Math.min(t,e.dem.tree.minimums[0])})),0===t?t:(t-30)*this._exaggeration}raycast(t,e,i){if(!this._visibleDemTiles)return null;const r=this._visibleDemTiles.filter((t=>t.dem)).map((r=>{const n=r.tileID,o=1<<n.overscaledZ,{x:s,y:a}=n.canonical,l=s/o,c=(s+1)/o,u=a/o,h=(a+1)/o;return{minx:l,miny:u,maxx:c,maxy:h,t:r.dem.tree.raycastRoot(l,u,c,h,t,e,i),tile:r}}));r.sort(((t,e)=>(null!==t.t?t.t:Number.MAX_VALUE)-(null!==e.t?e.t:Number.MAX_VALUE)));for(const n of r){if(null==n.t)return null;const r=n.tile.dem.tree.raycast(n.minx,n.miny,n.maxx,n.maxy,t,e,i);if(null!=r)return r}return null}_createFBO(){const e=this.painter.context,i=e.gl,r=this.drapeBufferSize;e.activeTexture.set(i.TEXTURE0);const n=new t.Texture(e,{width:r[0],height:r[1],data:null},i.RGBA);n.bind(i.LINEAR,i.CLAMP_TO_EDGE);const o=e.createFramebuffer(r[0],r[1],!1);return o.colorAttachment.set(n.texture),o.depthAttachment=new bt(e,o.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=e.createRenderbuffer(e.gl.DEPTH_STENCIL,r[0],r[1]),this._stencilRef=0,o.depthAttachment.set(this._sharedDepthStencil),e.clear({stencil:0})):o.depthAttachment.set(this._sharedDepthStencil),e.extTextureFilterAnisotropic&&!e.extTextureFilterAnisotropicForceOff&&i.texParameterf(i.TEXTURE_2D,e.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,e.extTextureFilterAnisotropicMax),{fb:o,tex:n,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const t in this._style._sourceCaches)if(this._style._sourceCaches[t].hasTransition())return!0;return this._style.order.some((t=>{const e=this._style._layers[t],i=e.isHidden(this.painter.transform.zoom);return"custom"===e.type?!i&&e.shouldRedrape():!i&&e.hasTransition()}))}_clearLineLayersFromRenderCache(){let e=!1;for(const t of this._style._getSources())if(t instanceof Bt){e=!0;break}if(!e)return;const i={};for(let e=0;e<this._style.order.length;++e){const r=this._style._layers[this._style.order[e]],n=this._style._getLayerSourceCache(r);if(n&&!i[n.id]&&!r.isHidden(this.painter.transform.zoom)&&"line"===r.type&&r.widthExpression()instanceof t.ZoomDependentExpression){i[n.id]=!0;for(const t of this.proxyCoords){const e=this.proxyToSource[t.key][n.id];if(e)for(const t of e)this._clearRenderCacheForTile(n.id,t)}}}}_clearRasterLayersFromRenderCache(){let t=!1;for(const e in this._style._sourceCaches)if(this._style._sourceCaches[e]._source instanceof Et){t=!0;break}if(!t)return;const e={};for(let t=0;t<this._style.order.length;++t){const i=this._style._layers[this._style.order[t]],r=this._style._getLayerSourceCache(i);if(!r||e[r.id])continue;if(i.isHidden(this.painter.transform.zoom)||"raster"!==i.type)continue;const n=i.paint.get("raster-fade-duration");for(const t of this.proxyCoords){const e=this.proxyToSource[t.key][r.id];if(e)for(const t of e){const e=Ei(r.getTile(t),r.findLoadedParent(t,0),r,this.painter.transform,n);(1!==e.opacity||0!==e.mix)&&this._clearRenderCacheForTile(r.id,t)}}}}_setupDrapedRenderBatches(){const t=this._style.order,e=t.length;if(0===e)return;const i=[];let r,n=0,o=this._style._layers[t[n]];for(;!this._style.isLayerDraped(o)&&o.isHidden(this.painter.transform.zoom)&&++n<e;)o=this._style._layers[t[n]];for(;n<e;++n){const e=this._style._layers[t[n]];e.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(e)?void 0===r&&(r=n):void 0!==r&&(i.push({start:r,end:n-1}),r=void 0))}void 0!==r&&i.push({start:r,end:n-1}),this._drapedRenderBatches=i}_setupRenderCache(t){const e=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,e.renderCache.length>e.renderCachePool.length){const t=Object.values(e.proxyCachedFBO);e.proxyCachedFBO={};for(let i=0;i<t.length;++i){const r=Object.values(t[i]);e.renderCachePool.push(...r)}}return}this._clearRasterLayersFromRenderCache();const i=this.proxyCoords,r=this._tilesDirty;for(let n=i.length-1;n>=0;n--){const o=i[n];if(e.getTileByID(o.key),void 0!==e.proxyCachedFBO[o.key]){const i=t[o.key],n=this.proxyToSource[o.key];let s=0;for(const t in n){const e=n[t],o=i[t];if(!o||o.length!==e.length||e.some(((e,i)=>e!==o[i]||r[t]&&r[t].hasOwnProperty(e.key)))){s=-1;break}++s}for(const t in e.proxyCachedFBO[o.key])e.renderCache[e.proxyCachedFBO[o.key][t]].dirty=s<0||s!==Object.values(i).length}}const n=[...this._drapedRenderBatches];n.sort(((t,e)=>e.end-e.start-(t.end-t.start)));for(const t of n)for(const r of i){if(e.proxyCachedFBO[r.key])continue;let i=e.renderCachePool.pop();void 0===i&&e.renderCache.length<50&&(i=e.renderCache.length,e.renderCache.push(this._createFBO())),void 0!==i&&(e.proxyCachedFBO[r.key]={},e.proxyCachedFBO[r.key][t.start]=i,e.renderCache[i].dirty=!0)}this._tilesDirty={}}_setupStencil(t,e,i,r){if(!r||!this._sourceTilesOverlap[r.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const n=this.painter.context,o=n.gl;if(e.length<=1)return void(this._overlapStencilType=!1);let s;if(i.isTileClipped())s=e.length,this._overlapStencilMode.test={func:o.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(e[0].overscaledZ>e[e.length-1].overscaledZ))return void(this._overlapStencilType=!1);s=1,this._overlapStencilMode.test={func:o.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+s>255&&(n.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=s,this._overlapStencilMode.ref=this._stencilRef,i.isTileClipped()&&this._renderTileClippingMasks(e,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(e){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[e.key]),this._overlapStencilMode):t.StencilMode.disabled}_renderTileClippingMasks(e,i){const r=this.painter,n=this.painter.context,o=n.gl;r._tileClippingMaskIDs={},n.setColorMode(t.ColorMode.disabled),n.setDepthMode(t.DepthMode.disabled);const s=r.useProgram("clippingMask");for(const a of e){const e=r._tileClippingMaskIDs[a.key]=--i;s.draw(n,o.TRIANGLES,t.DepthMode.disabled,new t.StencilMode({func:o.ALWAYS,mask:0},e,255,o.KEEP,o.KEEP,o.REPLACE),t.ColorMode.disabled,t.CullFaceMode.disabled,Bi(a.projMatrix),"$clipping",r.tileExtentBuffer,r.quadTriangleIndexBuffer,r.tileExtentSegments)}}pointCoordinate(e){const i=this.painter.transform;if(e.x<0||e.x>i.width||e.y<0||e.y>i.height)return null;const r=[e.x,e.y,1,1];t.transformMat4$1(r,r,i.pixelMatrixInverse),t.scale$1(r,r,1/r[3]),r[0]/=i.worldSize,r[1]/=i.worldSize;const n=i._camera.position,o=t.mercatorZfromAltitude(1,i.center.lat),s=[n[0],n[1],n[2]/o,0],a=t.subtract([],r.slice(0,3),s);t.normalize(a,a);const l=this.raycast(s,a,this._exaggeration);return null!==l&&l?(t.scaleAndAdd(s,s,a,l),s[3]=s[2],s[2]*=o,s):null}drawDepth(){const e=this.painter,i=e.context,r=this.proxySourceCache,n=Math.ceil(e.width),o=Math.ceil(e.height);if(!this._depthFBO||this._depthFBO.width===n&&this._depthFBO.height===o||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const e=i.gl,r=i.createFramebuffer(n,o,!0);i.activeTexture.set(e.TEXTURE0);const s=new t.Texture(i,{width:n,height:o,data:null},e.RGBA);s.bind(e.NEAREST,e.CLAMP_TO_EDGE),r.colorAttachment.set(s.texture);const a=i.createRenderbuffer(i.gl.DEPTH_COMPONENT16,n,o);r.depthAttachment.set(a),this._depthFBO=r,this._depthTexture=s}i.bindFramebuffer.set(this._depthFBO.framebuffer),i.viewport.set([0,0,n,o]),function(e,i,r,n){if("globe"===e.transform.projection.name)return;const o=e.context,s=o.gl;o.clear({depth:1});const a=e.useProgram("terrainDepth"),l=new t.DepthMode(s.LESS,t.DepthMode.ReadWrite,e.depthRangeFor3D);for(const e of n){const n=r.getTile(e),c=_i(e.projMatrix,0);i.setupElevationDraw(n,a),a.draw(o,s.TRIANGLES,l,t.StencilMode.disabled,t.ColorMode.unblended,t.CullFaceMode.backCCW,c,"terrain_depth",i.gridBuffer,i.gridIndexBuffer,i.gridNoSkirtSegments)}}(e,this,r,this.proxyCoords)}_setupProxiedCoordsForOrtho(t,e,i){if(t.getSource()instanceof St)return this._setupProxiedCoordsForImageSource(t,e,i);this._findCoveringTileCache[t.id]=this._findCoveringTileCache[t.id]||{};const r=this.proxiedCoords[t.id]=[],n=this.proxyCoords;for(let e=0;e<n.length;e++){const o=n[e],s=this._findTileCoveringTileID(o,t);if(s){const e=this._createProxiedId(o,s,i[o.key]&&i[o.key][t.id]);r.push(e),this.proxyToSource[o.key][t.id]=[e]}}let o=!1;for(let n=0;n<e.length;n++){const s=t.getTile(e[n]);if(!s||!s.hasData())continue;const a=this._findTileCoveringTileID(s.tileID,this.proxySourceCache);if(a&&a.tileID.canonical.z!==s.tileID.canonical.z){const e=this.proxyToSource[a.tileID.key][t.id],n=this._createProxiedId(a.tileID,s,i[a.tileID.key]&&i[a.tileID.key][t.id]);e?e.splice(e.length-1,0,n):this.proxyToSource[a.tileID.key][t.id]=[n],r.push(n),o=!0}}this._sourceTilesOverlap[t.id]=o}_setupProxiedCoordsForImageSource(e,i,r){if(!e.getSource().loaded())return;const n=this.proxiedCoords[e.id]=[],o=this.proxyCoords,s=e.getSource(),a=new t.Point(s.tileID.x,s.tileID.y)._div(1<<s.tileID.z),l=s.coordinates.map(t.MercatorCoordinate.fromLngLat).reduce(((t,e)=>(t.min.x=Math.min(t.min.x,e.x-a.x),t.min.y=Math.min(t.min.y,e.y-a.y),t.max.x=Math.max(t.max.x,e.x-a.x),t.max.y=Math.max(t.max.y,e.y-a.y),t)),{min:new t.Point(Number.MAX_VALUE,Number.MAX_VALUE),max:new t.Point(-Number.MAX_VALUE,-Number.MAX_VALUE)}),c=(e,i)=>{const r=e.wrap+e.canonical.x/(1<<e.canonical.z),n=e.canonical.y/(1<<e.canonical.z),o=t.EXTENT/(1<<e.canonical.z),s=i.wrap+i.canonical.x/(1<<i.canonical.z),a=i.canonical.y/(1<<i.canonical.z);return r+o<s+l.min.x||r>s+l.max.x||n+o<a+l.min.y||n>a+l.max.y};for(let t=0;t<o.length;t++){const s=o[t];for(let t=0;t<i.length;t++){const o=e.getTile(i[t]);if(!o||!o.hasData())continue;if(c(s,o.tileID))continue;const a=this._createProxiedId(s,o,r[s.key]&&r[s.key][e.id]),l=this.proxyToSource[s.key][e.id];l?l.push(a):this.proxyToSource[s.key][e.id]=[a],n.push(a)}}}_createProxiedId(e,i,r){let n=this.orthoMatrix;if(r){const t=r.find((t=>t.key===i.tileID.key));if(t)return t}if(i.tileID.key!==e.key){const r=e.canonical.z-i.tileID.canonical.z;let o,s,a;n=t.create();const l=i.tileID.wrap-e.wrap<<e.overscaledZ;r>0?(o=t.EXTENT>>r,s=o*((i.tileID.canonical.x<<r)-e.canonical.x+l),a=o*((i.tileID.canonical.y<<r)-e.canonical.y)):(o=t.EXTENT<<-r,s=t.EXTENT*(i.tileID.canonical.x-(e.canonical.x+l<<-r)),a=t.EXTENT*(i.tileID.canonical.y-(e.canonical.y<<-r))),t.ortho(n,0,o,0,o,0,1),t.translate(n,n,[s,a,0])}return new Ii(i.tileID,e.key,n)}_findTileCoveringTileID(e,i){let r=i.getTile(e);if(r&&r.hasData())return r;const n=this._findCoveringTileCache[i.id],o=n[e.key];if(r=o?i.getTileByID(o):null,r&&r.hasData()||null===o)return r;let s=r?r.tileID:e,a=s.overscaledZ;const l=i.getSource().minzoom,c=[];if(!o){const n=i.getSource().maxzoom;if(e.canonical.z>=n){const r=e.canonical.z-n;i.getSource().reparseOverscaled?(a=Math.max(e.canonical.z+2,i.transform.tileZoom),s=new t.OverscaledTileID(a,e.wrap,n,e.canonical.x>>r,e.canonical.y>>r)):0!==r&&(a=n,s=new t.OverscaledTileID(a,e.wrap,n,e.canonical.x>>r,e.canonical.y>>r))}s.key!==e.key&&(c.push(s.key),r=i.getTile(s))}const u=t=>{c.forEach((e=>{n[e]=t})),c.length=0};for(a-=1;a>=l&&(!r||!r.hasData());a--){r&&u(r.tileID.key);const t=s.calculateScaledKey(a);if(r=i.getTileByID(t),r&&r.hasData())break;const e=n[t];if(null===e)break;void 0===e?c.push(t):r=i.getTileByID(e)}return u(r?r.tileID.key:null),r&&r.hasData()?r:null}findDEMTileFor(t){return this.enabled?this._findTileCoveringTileID(t,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(t,e){let i=this._tilesDirty[t];i||(i=this._tilesDirty[t]={}),i[e.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const e=function(e){let i=0;const r=new t.StructArrayLayout2ui4,n=131;for(let t=1;t<129;t++){for(let e=1;e<129;e++)i=t*n+e,r.emplaceBack(i,i+1),r.emplaceBack(i,i+n),r.emplaceBack(i+1,i+n),128===t&&r.emplaceBack(i+n,i+n+1);r.emplaceBack(i+1,i+1+n)}return r}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(e),this.wireframeSegments=t.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,e.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class ki{static cacheKey(t,e,i,r){let n=`${e}${r?r.cacheKey:""}`;for(const e of i)t.usedDefines.includes(e)&&(n+=`/${e}`);return n}constructor(e,i,r,n,o,s){const a=e.gl;this.program=a.createProgram();const l=function(t){const e=[];for(let i=0;i<t.length;i++){if(null===t[i])continue;const r=t[i].split(" ");e.push(r.pop())}return e}(r.staticAttributes),c=n?n.getBinderAttributes():[],u=l.concat(c);let h=n?n.defines():[];h=h.concat(s.map((t=>`#define ${t}`)));const d=e.isWebGL2?"#version 300 es\n":"",p=d+h.concat(e.extStandardDerivatives&&0===d.length?"#extension GL_OES_standard_derivatives : enable\n".concat(li):li,li,ai,si.fragmentSource,ni.fragmentSource,r.fragmentSource).join("\n"),f=d+h.concat("\n#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",ai,si.vertexSource,ni.vertexSource,ri.vertexSource,r.vertexSource).join("\n"),A=a.createShader(a.FRAGMENT_SHADER);if(a.isContextLost())return void(this.failedToCreate=!0);a.shaderSource(A,p),a.compileShader(A),a.attachShader(this.program,A);const m=a.createShader(a.VERTEX_SHADER);if(a.isContextLost())this.failedToCreate=!0;else{a.shaderSource(m,f),a.compileShader(m),a.attachShader(this.program,m),this.attributes={},this.numAttributes=u.length;for(let t=0;t<this.numAttributes;t++)u[t]&&(a.bindAttribLocation(this.program,t,u[t]),this.attributes[u[t]]=t);a.linkProgram(this.program),a.deleteShader(m),a.deleteShader(A),this.fixedUniforms=o(e),this.binderUniforms=n?n.getUniforms(e):[],s.includes("TERRAIN")&&(this.terrainUniforms=(e=>({u_dem:new t.Uniform1i(e),u_dem_prev:new t.Uniform1i(e),u_dem_unpack:new t.Uniform4f(e),u_dem_tl:new t.Uniform2f(e),u_dem_scale:new t.Uniform1f(e),u_dem_tl_prev:new t.Uniform2f(e),u_dem_scale_prev:new t.Uniform1f(e),u_dem_size:new t.Uniform1f(e),u_dem_lerp:new t.Uniform1f(e),u_exaggeration:new t.Uniform1f(e),u_depth:new t.Uniform1i(e),u_depth_size_inv:new t.Uniform2f(e),u_meter_to_dem:new t.Uniform1f(e),u_label_plane_matrix_inv:new t.UniformMatrix4f(e)}))(e)),s.includes("GLOBE")&&(this.globeUniforms=(e=>({u_tile_tl_up:new t.Uniform3f(e),u_tile_tr_up:new t.Uniform3f(e),u_tile_br_up:new t.Uniform3f(e),u_tile_bl_up:new t.Uniform3f(e),u_tile_up_scale:new t.Uniform1f(e)}))(e)),s.includes("FOG")&&(this.fogUniforms=(e=>({u_fog_matrix:new t.UniformMatrix4f(e),u_fog_range:new t.Uniform2f(e),u_fog_color:new t.Uniform4f(e),u_fog_horizon_blend:new t.Uniform1f(e),u_fog_temporal_offset:new t.Uniform1f(e),u_frustum_tl:new t.Uniform3f(e),u_frustum_tr:new t.Uniform3f(e),u_frustum_br:new t.Uniform3f(e),u_frustum_bl:new t.Uniform3f(e),u_globe_pos:new t.Uniform3f(e),u_globe_radius:new t.Uniform1f(e),u_globe_transition:new t.Uniform1f(e),u_is_globe:new t.Uniform1i(e),u_viewport:new t.Uniform2f(e)}))(e))}}setTerrainUniformValues(t,e){if(!this.terrainUniforms)return;const i=this.terrainUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const t in e)i[t]&&i[t].set(this.program,t,e[t])}}setGlobeUniformValues(t,e){if(!this.globeUniforms)return;const i=this.globeUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const t in e)i[t]&&i[t].set(this.program,t,e[t])}}setFogUniformValues(t,e){if(!this.fogUniforms)return;const i=this.fogUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const t in e)i[t].set(this.program,t,e[t])}}draw(t,e,i,r,n,o,s,a,l,c,u,h,d,p,f){const A=t.gl;if(this.failedToCreate)return;t.program.set(this.program),t.setDepthMode(i),t.setStencilMode(r),t.setColorMode(n),t.setCullFace(o);for(const t of Object.keys(this.fixedUniforms))this.fixedUniforms[t].set(this.program,t,s[t]);p&&p.setUniforms(this.program,t,this.binderUniforms,h,{zoom:d});const m={[A.LINES]:2,[A.TRIANGLES]:3,[A.LINE_STRIP]:1}[e];for(const i of u.get()){const r=i.vaos||(i.vaos={});(r[a]||(r[a]=new di)).bind(t,this,l,p?p.getPaintVertexBuffers():[],c,i.vertexOffset,f||[]),A.drawElements(e,i.primitiveLength*m,A.UNSIGNED_SHORT,i.primitiveOffset*m*2)}}}function Pi(t,e){const i=Math.pow(2,e.tileID.overscaledZ),r=e.tileSize*Math.pow(2,t.transform.tileZoom)/i,n=r*(e.tileID.canonical.x+e.tileID.wrap*i),o=r*e.tileID.canonical.y;return{u_image:0,u_texsize:e.imageAtlasTexture.size,u_tile_units_to_pixels:1/M(e,1,t.transform.tileZoom),u_pixel_coord_upper:[n>>16,o>>16],u_pixel_coord_lower:[65535&n,65535&o]}}const Li=t.create(),zi=(e,i,r,n,o,s,a,l,c,u,h)=>{const d=i.style.light,p=d.properties.get("position"),f=[p.x,p.y,p.z],A=t.create$1();"viewport"===d.properties.get("anchor")&&(t.fromRotation(A,-i.transform.angle),t.transformMat3(f,f,A));const m=d.properties.get("color"),g=i.transform,_={u_matrix:e,u_lightpos:f,u_lightintensity:d.properties.get("intensity"),u_lightcolor:[m.r,m.g,m.b],u_vertical_gradient:+r,u_opacity:n,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Li,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:o,u_edge_radius:s};return"globe"===g.projection.name&&(_.u_tile_id=[a.canonical.x,a.canonical.y,1<<a.canonical.z],_.u_zoom_transition=c,_.u_inv_rot_matrix=h,_.u_merc_center=u,_.u_up_dir=g.projection.upVector(new t.CanonicalTileID(0,0,0),u[0]*t.EXTENT,u[1]*t.EXTENT),_.u_height_lift=l),_},Fi=(e,i,r,n,o,s,a,l,c,u,h,d)=>{const p=zi(e,i,r,n,o,s,a,c,u,h,d),f={u_height_factor:-Math.pow(2,a.overscaledZ)/l.tileSize/8};return t.extend(p,Pi(i,l),f)},Di=t=>({u_matrix:t}),Ri=(e,i,r)=>t.extend(Di(e),Pi(i,r)),Ui=(t,e)=>({u_matrix:t,u_world:e}),Oi=(e,i,r,n)=>t.extend(Ri(e,i,r),{u_world:n}),Ni=t.create(),Qi=(e,i,r,n,o,s)=>{const a=e.transform,l="globe"===a.projection.name;let c;if("map"===s.paint.get("circle-pitch-alignment"))if(l){const e=t.globePixelsToTileUnits(a.zoom,i.canonical)*a._pixelsPerMercatorPixel;c=Float32Array.from([e,0,0,e])}else c=a.calculatePixelsToTileUnitsMatrix(r);else c=new Float32Array([a.pixelsToGLUnits[0],0,0,a.pixelsToGLUnits[1]]);const u={u_camera_to_center_distance:a.cameraToCenterDistance,u_matrix:e.translatePosMatrix(i.projMatrix,r,s.paint.get("circle-translate"),s.paint.get("circle-translate-anchor")),u_device_pixel_ratio:t.exported.devicePixelRatio,u_extrude_scale:c,u_inv_rot_matrix:Ni,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(l){u.u_inv_rot_matrix=n,u.u_merc_center=o,u.u_tile_id=[i.canonical.x,i.canonical.y,1<<i.canonical.z],u.u_zoom_transition=t.globeToMercatorTransition(a.zoom);const e=o[0]*t.EXTENT,r=o[1]*t.EXTENT;u.u_up_dir=a.projection.upVector(new t.CanonicalTileID(0,0,0),e,r)}return u},Vi=t=>{const e=[];return"map"===t.paint.get("circle-pitch-alignment")&&e.push("PITCH_WITH_MAP"),"map"===t.paint.get("circle-pitch-scale")&&e.push("SCALE_WITH_MAP"),e},ji=(e,i,r,n)=>{const o=t.EXTENT/r.tileSize;return{u_matrix:e,u_camera_to_center_distance:i.getCameraToCenterDistance(n),u_extrude_scale:[i.pixelsToGLUnits[0]/o,i.pixelsToGLUnits[1]/o]}},Hi=(t,e,i=1)=>({u_matrix:t,u_color:e,u_overlay:0,u_overlay_scale:i}),Gi=t.create(),$i=(e,i,r,n,o,s,a)=>{const l=e.transform,c="globe"===l.projection.name,u=c?t.globePixelsToTileUnits(l.zoom,i.canonical)*l._pixelsPerMercatorPixel:M(r,1,s),h={u_matrix:i.projMatrix,u_extrude_scale:u,u_intensity:a,u_inv_rot_matrix:Gi,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(c){h.u_inv_rot_matrix=n,h.u_merc_center=o,h.u_tile_id=[i.canonical.x,i.canonical.y,1<<i.canonical.z],h.u_zoom_transition=t.globeToMercatorTransition(l.zoom);const e=o[0]*t.EXTENT,r=o[1]*t.EXTENT;h.u_up_dir=l.projection.upVector(new t.CanonicalTileID(0,0,0),e,r)}return h},Zi=(t,e,i,r,n,o,s)=>{const a=t.transform,l=a.calculatePixelsToTileUnitsMatrix(e);return{u_matrix:Wi(t,e,i,r),u_pixels_to_tile_units:l,u_device_pixel_ratio:o,u_units_to_pixels:[1/a.pixelsToGLUnits[0],1/a.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:n,u_texsize:Xi(i)?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:Ki(e,t.transform),u_alpha_discard_threshold:0,u_trim_offset:s}},qi=(t,e,i,r,n)=>{const o=t.transform;return{u_matrix:Wi(t,e,i,r),u_texsize:e.imageAtlasTexture.size,u_pixels_to_tile_units:o.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:n,u_image:0,u_tile_units_to_pixels:Ki(e,o),u_units_to_pixels:[1/o.pixelsToGLUnits[0],1/o.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function Ki(t,e){return 1/M(t,1,e.tileZoom)}function Wi(t,e,i,r){return t.translatePosMatrix(r||e.tileID.projMatrix,e,i.paint.get("line-translate"),i.paint.get("line-translate-anchor"))}function Xi(t){const e=t.paint.get("line-dasharray").value;return e.value||"constant"!==e.kind}const Ji=(t,e,i,r,n,o)=>{return{u_matrix:t,u_tl_parent:e,u_scale_parent:i,u_fade_t:r.mix,u_opacity:r.opacity*n.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:n.paint.get("raster-brightness-min"),u_brightness_high:n.paint.get("raster-brightness-max"),u_saturation_factor:(a=n.paint.get("raster-saturation"),a>0?1-1/(1.001-a):-a),u_contrast_factor:(s=n.paint.get("raster-contrast"),s>0?1/(1-s):1+s),u_spin_weights:Yi(n.paint.get("raster-hue-rotate")),u_perspective_transform:o};var s,a};function Yi(t){t*=Math.PI/180;const e=Math.sin(t),i=Math.cos(t);return[(2*i+1)/3,(-Math.sqrt(3)*e-i+1)/3,(Math.sqrt(3)*e-i+1)/3]}const tr=t.create(),er=(e,i,r,n,o,s,a,l,c,u,h,d,p,f,A,m)=>{const g=o.transform,_={u_is_size_zoom_constant:+("constant"===e||"source"===e),u_is_size_feature_constant:+("constant"===e||"camera"===e),u_size_t:i?i.uSizeT:0,u_size:i?i.uSize:0,u_camera_to_center_distance:g.cameraToCenterDistance,u_rotate_symbol:+r,u_aspect_ratio:g.width/g.height,u_fade_change:o.options.fadeDuration?o.symbolFadeChange:1,u_matrix:s,u_label_plane_matrix:a,u_coord_matrix:l,u_is_text:+c,u_pitch_with_map:+n,u_texsize:u,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:tr,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:tr,u_up_vector:[0,-1,0]};return"globe"===m.name&&(_.u_tile_id=[h.canonical.x,h.canonical.y,1<<h.canonical.z],_.u_zoom_transition=d,_.u_inv_rot_matrix=f,_.u_merc_center=p,_.u_camera_forward=g._camera.forward(),_.u_ecef_origin=t.globeECEFOrigin(g.globeMatrix,h.toUnwrapped()),_.u_tile_matrix=Float32Array.from(g.globeMatrix),_.u_up_vector=A),_},ir=(e,i,r,n,o,s,a,l,c,u,h,d,p,f,A,m,g)=>t.extend(er(e,i,r,n,o,s,a,l,c,u,d,p,f,A,m,g),{u_gamma_scale:n?o.transform.cameraToCenterDistance*Math.cos(o.terrain?0:o.transform._pitch):1,u_device_pixel_ratio:t.exported.devicePixelRatio,u_is_halo:+h}),rr=(e,i,r,n,o,s,a,l,c,u,h,d,p,f,A,m)=>t.extend(ir(e,i,r,n,o,s,a,l,!0,c,!0,h,d,p,f,A,m),{u_texsize_icon:u,u_texture_icon:1}),nr=(t,e,i)=>({u_matrix:t,u_opacity:e,u_color:i}),or=(e,i,r,n,o)=>t.extend(function(t,e,i){const r=e.imageManager.getPattern(t.toString()),{width:n,height:o}=e.imageManager.getPixelSize(),s=Math.pow(2,i.tileID.overscaledZ),a=i.tileSize*Math.pow(2,e.transform.tileZoom)/s,l=a*(i.tileID.canonical.x+i.tileID.wrap*s),c=a*i.tileID.canonical.y;return{u_image:0,u_pattern_tl:r.tl,u_pattern_br:r.br,u_texsize:[n,o],u_pattern_size:r.displaySize,u_tile_units_to_pixels:1/M(i,1,e.transform.tileZoom),u_pixel_coord_upper:[l>>16,c>>16],u_pixel_coord_lower:[65535&l,65535&c]}}(n,r,o),{u_matrix:e,u_opacity:i}),sr={fillExtrusion:e=>({u_matrix:new t.UniformMatrix4f(e),u_lightpos:new t.Uniform3f(e),u_lightintensity:new t.Uniform1f(e),u_lightcolor:new t.Uniform3f(e),u_vertical_gradient:new t.Uniform1f(e),u_opacity:new t.Uniform1f(e),u_edge_radius:new t.Uniform1f(e),u_ao:new t.Uniform2f(e),u_tile_id:new t.Uniform3f(e),u_zoom_transition:new t.Uniform1f(e),u_inv_rot_matrix:new t.UniformMatrix4f(e),u_merc_center:new t.Uniform2f(e),u_up_dir:new t.Uniform3f(e),u_height_lift:new t.Uniform1f(e)}),fillExtrusionPattern:e=>({u_matrix:new t.UniformMatrix4f(e),u_lightpos:new t.Uniform3f(e),u_lightintensity:new t.Uniform1f(e),u_lightcolor:new t.Uniform3f(e),u_vertical_gradient:new t.Uniform1f(e),u_height_factor:new t.Uniform1f(e),u_edge_radius:new t.Uniform1f(e),u_ao:new t.Uniform2f(e),u_tile_id:new t.Uniform3f(e),u_zoom_transition:new t.Uniform1f(e),u_inv_rot_matrix:new t.UniformMatrix4f(e),u_merc_center:new t.Uniform2f(e),u_up_dir:new t.Uniform3f(e),u_height_lift:new t.Uniform1f(e),u_image:new t.Uniform1i(e),u_texsize:new t.Uniform2f(e),u_pixel_coord_upper:new t.Uniform2f(e),u_pixel_coord_lower:new t.Uniform2f(e),u_tile_units_to_pixels:new t.Uniform1f(e),u_opacity:new t.Uniform1f(e)}),fill:e=>({u_matrix:new t.UniformMatrix4f(e)}),fillPattern:e=>({u_matrix:new t.UniformMatrix4f(e),u_image:new t.Uniform1i(e),u_texsize:new t.Uniform2f(e),u_pixel_coord_upper:new t.Uniform2f(e),u_pixel_coord_lower:new t.Uniform2f(e),u_tile_units_to_pixels:new t.Uniform1f(e)}),fillOutline:e=>({u_matrix:new t.UniformMatrix4f(e),u_world:new t.Uniform2f(e)}),fillOutlinePattern:e=>({u_matrix:new t.UniformMatrix4f(e),u_world:new t.Uniform2f(e),u_image:new t.Uniform1i(e),u_texsize:new t.Uniform2f(e),u_pixel_coord_upper:new t.Uniform2f(e),u_pixel_coord_lower:new t.Uniform2f(e),u_tile_units_to_pixels:new t.Uniform1f(e)}),circle:e=>({u_camera_to_center_distance:new t.Uniform1f(e),u_extrude_scale:new t.UniformMatrix2f(e),u_device_pixel_ratio:new t.Uniform1f(e),u_matrix:new t.UniformMatrix4f(e),u_inv_rot_matrix:new t.UniformMatrix4f(e),u_merc_center:new t.Uniform2f(e),u_tile_id:new t.Uniform3f(e),u_zoom_transition:new t.Uniform1f(e),u_up_dir:new t.Uniform3f(e)}),collisionBox:e=>({u_matrix:new t.UniformMatrix4f(e),u_camera_to_center_distance:new t.Uniform1f(e),u_extrude_scale:new t.Uniform2f(e)}),collisionCircle:e=>({u_matrix:new t.UniformMatrix4f(e),u_inv_matrix:new t.UniformMatrix4f(e),u_camera_to_center_distance:new t.Uniform1f(e),u_viewport_size:new t.Uniform2f(e)}),debug:e=>({u_color:new t.UniformColor(e),u_matrix:new t.UniformMatrix4f(e),u_overlay:new t.Uniform1i(e),u_overlay_scale:new t.Uniform1f(e)}),clippingMask:e=>({u_matrix:new t.UniformMatrix4f(e)}),heatmap:e=>({u_extrude_scale:new t.Uniform1f(e),u_intensity:new t.Uniform1f(e),u_matrix:new t.UniformMatrix4f(e),u_inv_rot_matrix:new t.UniformMatrix4f(e),u_merc_center:new t.Uniform2f(e),u_tile_id:new t.Uniform3f(e),u_zoom_transition:new t.Uniform1f(e),u_up_dir:new t.Uniform3f(e)}),heatmapTexture:e=>({u_image:new t.Uniform1i(e),u_color_ramp:new t.Uniform1i(e),u_opacity:new t.Uniform1f(e)}),hillshade:e=>({u_matrix:new t.UniformMatrix4f(e),u_image:new t.Uniform1i(e),u_latrange:new t.Uniform2f(e),u_light:new t.Uniform2f(e),u_shadow:new t.UniformColor(e),u_highlight:new t.UniformColor(e),u_accent:new t.UniformColor(e)}),hillshadePrepare:e=>({u_matrix:new t.UniformMatrix4f(e),u_image:new t.Uniform1i(e),u_dimension:new t.Uniform2f(e),u_zoom:new t.Uniform1f(e),u_unpack:new t.Uniform4f(e)}),line:e=>({u_matrix:new t.UniformMatrix4f(e),u_pixels_to_tile_units:new t.UniformMatrix2f(e),u_device_pixel_ratio:new t.Uniform1f(e),u_units_to_pixels:new t.Uniform2f(e),u_dash_image:new t.Uniform1i(e),u_gradient_image:new t.Uniform1i(e),u_image_height:new t.Uniform1f(e),u_texsize:new t.Uniform2f(e),u_tile_units_to_pixels:new t.Uniform1f(e),u_alpha_discard_threshold:new t.Uniform1f(e),u_trim_offset:new t.Uniform2f(e)}),linePattern:e=>({u_matrix:new t.UniformMatrix4f(e),u_texsize:new t.Uniform2f(e),u_pixels_to_tile_units:new t.UniformMatrix2f(e),u_device_pixel_ratio:new t.Uniform1f(e),u_image:new t.Uniform1i(e),u_units_to_pixels:new t.Uniform2f(e),u_tile_units_to_pixels:new t.Uniform1f(e),u_alpha_discard_threshold:new t.Uniform1f(e)}),raster:e=>({u_matrix:new t.UniformMatrix4f(e),u_tl_parent:new t.Uniform2f(e),u_scale_parent:new t.Uniform1f(e),u_fade_t:new t.Uniform1f(e),u_opacity:new t.Uniform1f(e),u_image0:new t.Uniform1i(e),u_image1:new t.Uniform1i(e),u_brightness_low:new t.Uniform1f(e),u_brightness_high:new t.Uniform1f(e),u_saturation_factor:new t.Uniform1f(e),u_contrast_factor:new t.Uniform1f(e),u_spin_weights:new t.Uniform3f(e),u_perspective_transform:new t.Uniform2f(e)}),symbolIcon:e=>({u_is_size_zoom_constant:new t.Uniform1i(e),u_is_size_feature_constant:new t.Uniform1i(e),u_size_t:new t.Uniform1f(e),u_size:new t.Uniform1f(e),u_camera_to_center_distance:new t.Uniform1f(e),u_rotate_symbol:new t.Uniform1i(e),u_aspect_ratio:new t.Uniform1f(e),u_fade_change:new t.Uniform1f(e),u_matrix:new t.UniformMatrix4f(e),u_label_plane_matrix:new t.UniformMatrix4f(e),u_coord_matrix:new t.UniformMatrix4f(e),u_is_text:new t.Uniform1i(e),u_pitch_with_map:new t.Uniform1i(e),u_texsize:new t.Uniform2f(e),u_tile_id:new t.Uniform3f(e),u_zoom_transition:new t.Uniform1f(e),u_inv_rot_matrix:new t.UniformMatrix4f(e),u_merc_center:new t.Uniform2f(e),u_camera_forward:new t.Uniform3f(e),u_tile_matrix:new t.UniformMatrix4f(e),u_up_vector:new t.Uniform3f(e),u_ecef_origin:new t.Uniform3f(e),u_texture:new t.Uniform1i(e)}),symbolSDF:e=>({u_is_size_zoom_constant:new t.Uniform1i(e),u_is_size_feature_constant:new t.Uniform1i(e),u_size_t:new t.Uniform1f(e),u_size:new t.Uniform1f(e),u_camera_to_center_distance:new t.Uniform1f(e),u_rotate_symbol:new t.Uniform1i(e),u_aspect_ratio:new t.Uniform1f(e),u_fade_change:new t.Uniform1f(e),u_matrix:new t.UniformMatrix4f(e),u_label_plane_matrix:new t.UniformMatrix4f(e),u_coord_matrix:new t.UniformMatrix4f(e),u_is_text:new t.Uniform1i(e),u_pitch_with_map:new t.Uniform1i(e),u_texsize:new t.Uniform2f(e),u_texture:new t.Uniform1i(e),u_gamma_scale:new t.Uniform1f(e),u_device_pixel_ratio:new t.Uniform1f(e),u_tile_id:new t.Uniform3f(e),u_zoom_transition:new t.Uniform1f(e),u_inv_rot_matrix:new t.UniformMatrix4f(e),u_merc_center:new t.Uniform2f(e),u_camera_forward:new t.Uniform3f(e),u_tile_matrix:new t.UniformMatrix4f(e),u_up_vector:new t.Uniform3f(e),u_ecef_origin:new t.Uniform3f(e),u_is_halo:new t.Uniform1i(e)}),symbolTextAndIcon:e=>({u_is_size_zoom_constant:new t.Uniform1i(e),u_is_size_feature_constant:new t.Uniform1i(e),u_size_t:new t.Uniform1f(e),u_size:new t.Uniform1f(e),u_camera_to_center_distance:new t.Uniform1f(e),u_rotate_symbol:new t.Uniform1i(e),u_aspect_ratio:new t.Uniform1f(e),u_fade_change:new t.Uniform1f(e),u_matrix:new t.UniformMatrix4f(e),u_label_plane_matrix:new t.UniformMatrix4f(e),u_coord_matrix:new t.UniformMatrix4f(e),u_is_text:new t.Uniform1i(e),u_pitch_with_map:new t.Uniform1i(e),u_texsize:new t.Uniform2f(e),u_texsize_icon:new t.Uniform2f(e),u_texture:new t.Uniform1i(e),u_texture_icon:new t.Uniform1i(e),u_gamma_scale:new t.Uniform1f(e),u_device_pixel_ratio:new t.Uniform1f(e),u_is_halo:new t.Uniform1i(e)}),background:e=>({u_matrix:new t.UniformMatrix4f(e),u_opacity:new t.Uniform1f(e),u_color:new t.UniformColor(e)}),backgroundPattern:e=>({u_matrix:new t.UniformMatrix4f(e),u_opacity:new t.Uniform1f(e),u_image:new t.Uniform1i(e),u_pattern_tl:new t.Uniform2f(e),u_pattern_br:new t.Uniform2f(e),u_texsize:new t.Uniform2f(e),u_pattern_size:new t.Uniform2f(e),u_pixel_coord_upper:new t.Uniform2f(e),u_pixel_coord_lower:new t.Uniform2f(e),u_tile_units_to_pixels:new t.Uniform1f(e)}),terrainRaster:gi,terrainDepth:gi,skybox:e=>({u_matrix:new t.UniformMatrix4f(e),u_sun_direction:new t.Uniform3f(e),u_cubemap:new t.Uniform1i(e),u_opacity:new t.Uniform1f(e),u_temporal_offset:new t.Uniform1f(e)}),skyboxGradient:e=>({u_matrix:new t.UniformMatrix4f(e),u_color_ramp:new t.Uniform1i(e),u_center_direction:new t.Uniform3f(e),u_radius:new t.Uniform1f(e),u_opacity:new t.Uniform1f(e),u_temporal_offset:new t.Uniform1f(e)}),skyboxCapture:e=>({u_matrix_3f:new t.UniformMatrix3f(e),u_sun_direction:new t.Uniform3f(e),u_sun_intensity:new t.Uniform1f(e),u_color_tint_r:new t.Uniform4f(e),u_color_tint_m:new t.Uniform4f(e),u_luminance:new t.Uniform1f(e)}),globeRaster:e=>({u_proj_matrix:new t.UniformMatrix4f(e),u_globe_matrix:new t.UniformMatrix4f(e),u_normalize_matrix:new t.UniformMatrix4f(e),u_merc_matrix:new t.UniformMatrix4f(e),u_zoom_transition:new t.Uniform1f(e),u_merc_center:new t.Uniform2f(e),u_image0:new t.Uniform1i(e),u_grid_matrix:new t.UniformMatrix3f(e),u_skirt_height:new t.Uniform1f(e),u_frustum_tl:new t.Uniform3f(e),u_frustum_tr:new t.Uniform3f(e),u_frustum_br:new t.Uniform3f(e),u_frustum_bl:new t.Uniform3f(e),u_globe_pos:new t.Uniform3f(e),u_globe_radius:new t.Uniform1f(e),u_viewport:new t.Uniform2f(e)}),globeAtmosphere:e=>({u_frustum_tl:new t.Uniform3f(e),u_frustum_tr:new t.Uniform3f(e),u_frustum_br:new t.Uniform3f(e),u_frustum_bl:new t.Uniform3f(e),u_horizon:new t.Uniform1f(e),u_transition:new t.Uniform1f(e),u_fadeout_range:new t.Uniform1f(e),u_color:new t.Uniform4f(e),u_high_color:new t.Uniform4f(e),u_space_color:new t.Uniform4f(e),u_star_intensity:new t.Uniform1f(e),u_star_density:new t.Uniform1f(e),u_star_size:new t.Uniform1f(e),u_temporal_offset:new t.Uniform1f(e),u_horizon_angle:new t.Uniform1f(e),u_rotation_matrix:new t.UniformMatrix4f(e)})};let ar;function lr(e,i,r,n,o,s,a){const l=e.context,c=l.gl,u=e.transform,h=e.useProgram("collisionBox"),d=[];let p=0,f=0;for(let A=0;A<n.length;A++){const m=n[A],g=i.getTile(m),_=g.getBucket(r);if(!_)continue;const y=_e(m,_,u);let v=y;0===o[0]&&0===o[1]||(v=e.translatePosMatrix(y,g,o,s));const x=a?_.textCollisionBox:_.iconCollisionBox,b=_.collisionCircleArray;if(b.length>0){const e=t.create(),i=v;t.mul(e,_.placementInvProjMatrix,u.glCoordMatrix),t.mul(e,e,_.placementViewportMatrix),d.push({circleArray:b,circleOffset:f,transform:i,invTransform:e,projection:_.getProjection()}),p+=b.length/4,f=p}x&&(e.terrain&&e.terrain.setupElevationDraw(g,h),h.draw(l,c.LINES,t.DepthMode.disabled,t.StencilMode.disabled,e.colorModeForRenderPass(),t.CullFaceMode.disabled,ji(v,u,g,_.getProjection()),r.id,x.layoutVertexBuffer,x.indexBuffer,x.segments,null,u.zoom,null,[x.collisionVertexBuffer,x.collisionVertexBufferExt]))}if(!a||!d.length)return;const A=e.useProgram("collisionCircle"),m=new t.StructArrayLayout2f1f2i16;m.resize(4*p),m._trim();let g=0;for(const t of d)for(let e=0;e<t.circleArray.length/4;e++){const i=4*e,r=t.circleArray[i+0],n=t.circleArray[i+1],o=t.circleArray[i+2],s=t.circleArray[i+3];m.emplace(g++,r,n,o,s,0),m.emplace(g++,r,n,o,s,1),m.emplace(g++,r,n,o,s,2),m.emplace(g++,r,n,o,s,3)}(!ar||ar.length<2*p)&&(ar=function(e){const i=2*e,r=new t.StructArrayLayout3ui6;r.resize(i),r._trim();for(let t=0;t<i;t++){const e=6*t;r.uint16[e+0]=4*t+0,r.uint16[e+1]=4*t+1,r.uint16[e+2]=4*t+2,r.uint16[e+3]=4*t+2,r.uint16[e+4]=4*t+3,r.uint16[e+5]=4*t+0}return r}(p));const _=l.createIndexBuffer(ar,!0),y=l.createVertexBuffer(m,t.collisionCircleLayout.members,!0);for(const i of d){const n={u_matrix:i.transform,u_inv_matrix:i.invTransform,u_camera_to_center_distance:(v=u).getCameraToCenterDistance(i.projection),u_viewport_size:[v.width,v.height]};A.draw(l,c.TRIANGLES,t.DepthMode.disabled,t.StencilMode.disabled,e.colorModeForRenderPass(),t.CullFaceMode.disabled,n,r.id,y,_,t.SegmentVector.simpleSegment(0,2*i.circleOffset,i.circleArray.length,i.circleArray.length/2),null,u.zoom)}var v;y.destroy(),_.destroy()}const cr=t.create();function ur({width:e,height:i,anchor:r,textOffset:n,textScale:o},s){const{horizontalAlign:a,verticalAlign:l}=t.getAnchorAlignment(r),c=-(a-.5)*e,u=-(l-.5)*i,h=t.evaluateVariableOffset(r,n);return new t.Point((c/o+h[0])*s,(u/o+h[1])*s)}function hr(e,i,r,n,o,s,a,l,c,u,h){const d=e.text.placedSymbolArray,p=e.text.dynamicLayoutVertexArray,f=e.icon.dynamicLayoutVertexArray,A={},m=e.getProjection(),g=ye(l,m,s),_=s.elevation,y=m.upVectorScale(l.canonical,s.center.lat,s.worldSize).metersToTile;p.clear();for(let f=0;f<d.length;f++){const v=d.get(f),{tileAnchorX:x,tileAnchorY:b,numGlyphs:w}=v,T=v.hidden||!v.crossTileID||e.allowVerticalPlacement&&!v.placedOrientation?null:n[v.crossTileID];if(T){let n=0,d=0,f=0;if(_){const t=_?_.getAtTileOffset(l,x,b):0,[e,i,r]=m.upVector(l.canonical,x,b);n=t*e*y,d=t*i*y,f=t*r*y}let[B,E,C,S]=re(v.projectedAnchorX+n,v.projectedAnchorY+d,v.projectedAnchorZ+f,r?g:a);const I=ne(s.getCameraToCenterDistance(m),S);let M=o.evaluateSizeForFeature(e.textSizeData,u,v)*I/t.ONE_EM;r&&(M*=e.tilePixelRatio/c);const k=ur(T,M);r?(({x:B,y:E,z:C}=m.projectTilePoint(x+k.x,b+k.y,l.canonical)),[B,E,C]=re(B+n,E+d,C+f,a)):(i&&k._rotate(-s.angle),B+=k.x,E+=k.y,C=0);const P=e.allowVerticalPlacement&&v.placedOrientation===t.WritingMode.vertical?Math.PI/2:0;for(let e=0;e<w;e++)t.addDynamicAttributes(p,B,E,C,P);h&&v.associatedIconIndex>=0&&(A[v.associatedIconIndex]={x:B,y:E,z:C,angle:P})}else pe(w,p)}if(h){f.clear();const i=e.icon.placedSymbolArray;for(let e=0;e<i.length;e++){const r=i.get(e),{numGlyphs:n}=r,o=A[e];if(r.hidden||!o)pe(n,f);else{const{x:e,y:i,z:r,angle:s}=o;for(let o=0;o<n;o++)t.addDynamicAttributes(f,e,i,r,s)}}e.icon.dynamicLayoutVertexBuffer.updateData(f)}e.text.dynamicLayoutVertexBuffer.updateData(p)}function dr(t,e,i){return i.iconsInText&&e?"symbolTextAndIcon":t?"symbolSDF":"symbolIcon"}function pr(e,i,r,n,o,s,a,l,c,u,h,d){const p=e.context,f=p.gl,A=e.transform,m="map"===l,g="map"===c,_=m&&"point"!==r.layout.get("symbol-placement"),y=m&&!g&&!_,v=void 0!==r.layout.get("symbol-sort-key").constantOr(1);let x=!1;const b=e.depthModeForSublayer(0,t.DepthMode.ReadOnly),w=[t.mercatorXfromLng(A.center.lng),t.mercatorYfromLat(A.center.lat)],T=r.layout.get("text-variable-anchor"),B="globe"===A.projection.name,E=[],C=[0,-1,0];let S=C;!B&&!A.mercatorFromTransition||m||(S=function(e){const i=e._camera.getWorldToCamera(e.worldSize,1),r=t.multiply([],i,e.globeMatrix);t.invert(r,r);const n=[0,0,0],o=[0,1,0,0];return t.transformMat4$1(o,o,r),n[0]=o[0],n[1]=o[1],n[2]=o[2],t.normalize(n,n),n}(A));for(const l of n){const n=i.getTile(l),c=n.getBucket(r);if(!c)continue;if("mercator"===c.projection.name&&B)continue;const h=o?c.text:c.icon;if(!h||c.fullyClipped||!h.segments.get().length)continue;const d=h.programConfigurations.get(r.id),p=o||c.sdfIcons,b=o?c.textSizeData:c.iconSizeData,I=g||0!==A.pitch,M=t.evaluateSizeForZoom(b,A.zoom);let k,P,L,z,F=[0,0],D=null;if(o)P=n.glyphAtlasTexture,L=f.LINEAR,k=n.glyphAtlasTexture.size,c.iconsInText&&(F=n.imageAtlasTexture.size,D=n.imageAtlasTexture,z=I||e.options.rotating||e.options.zooming||"composite"===b.kind||"camera"===b.kind?f.LINEAR:f.NEAREST);else{const t=1!==r.layout.get("icon-size").constantOr(0)||c.iconsNeedLinear;P=n.imageAtlasTexture,L=p||e.options.rotating||e.options.zooming||t||I?f.LINEAR:f.NEAREST,k=n.imageAtlasTexture.size}const R="globe"===c.projection.name,U=R?S:C,O=R?t.globeToMercatorTransition(A.zoom):0,N=ye(l,c.getProjection(),A),Q=A.calculatePixelsToTileUnitsMatrix(n),V=te(N,n.tileID.canonical,g,m,A,c.getProjection(),Q),j=e.terrain&&g&&_?t.invert(t.create(),V):cr,H=ie(N,n.tileID.canonical,g,m,A,c.getProjection(),Q),G=T&&c.hasTextData(),$="none"!==r.layout.get("icon-text-fit")&&G&&c.hasIconData();if(_){const t=A.elevation,i=t?t.getAtTileOffsetFunc(l,A.center.lat,A.worldSize,c.getProjection()):null,r=ee(N,n.tileID.canonical,g,m,A,c.getProjection(),Q);se(c,N,e,o,r,H,g,u,i,l)}const Z=_||o&&T||$,q=e.translatePosMatrix(N,n,s,a),K=Z?cr:V,W=e.translatePosMatrix(H,n,s,a,!0),X=c.getProjection().createInversionMatrix(A,l.canonical),J=[];e.terrainRenderModeElevated()&&g&&J.push("PITCH_WITH_MAP_TERRAIN"),R&&J.push("PROJECTION_GLOBE_VIEW"),Z&&J.push("PROJECTED_POS_ON_VIEWPORT");const Y=p&&0!==r.paint.get(o?"text-halo-width":"icon-halo-width").constantOr(1);let tt;tt=p?c.iconsInText?rr(b.kind,M,y,g,e,q,K,W,k,F,l,O,w,X,U,c.getProjection()):ir(b.kind,M,y,g,e,q,K,W,o,k,!0,l,O,w,X,U,c.getProjection()):er(b.kind,M,y,g,e,q,K,W,o,k,l,O,w,X,U,c.getProjection());const et={program:e.useProgram(dr(p,o,c),d,J),buffers:h,uniformValues:tt,atlasTexture:P,atlasTextureIcon:D,atlasInterpolation:L,atlasInterpolationIcon:z,isSDF:p,hasHalo:Y,tile:n,labelPlaneMatrixInv:j};if(v&&c.canOverlap){x=!0;const e=h.segments.get();for(const i of e)E.push({segments:new t.SegmentVector([i]),sortKey:i.sortKey,state:et})}else E.push({segments:h.segments,sortKey:0,state:et})}x&&E.sort(((t,e)=>t.sortKey-e.sortKey));for(const t of E){const i=t.state;if(e.terrain&&e.terrain.setupElevationDraw(i.tile,i.program,{useDepthForOcclusion:!B,labelPlaneMatrixInv:i.labelPlaneMatrixInv}),p.activeTexture.set(f.TEXTURE0),i.atlasTexture.bind(i.atlasInterpolation,f.CLAMP_TO_EDGE),i.atlasTextureIcon&&(p.activeTexture.set(f.TEXTURE1),i.atlasTextureIcon&&i.atlasTextureIcon.bind(i.atlasInterpolationIcon,f.CLAMP_TO_EDGE)),i.isSDF){const n=i.uniformValues;i.hasHalo&&(n.u_is_halo=1,fr(i.buffers,t.segments,r,e,i.program,b,h,d,n)),n.u_is_halo=0}fr(i.buffers,t.segments,r,e,i.program,b,h,d,i.uniformValues)}}function fr(e,i,r,n,o,s,a,l,c){const u=n.context,h=[e.dynamicLayoutVertexBuffer,e.opacityVertexBuffer,e.globeExtVertexBuffer];o.draw(u,u.gl.TRIANGLES,s,a,l,t.CullFaceMode.disabled,c,r.id,e.layoutVertexBuffer,e.indexBuffer,i,r.paint,n.transform.zoom,e.programConfigurations.get(r.id),h)}function Ar(e,i,r,n,o,s,a){const l=e.context.gl,c=r.paint.get("fill-pattern"),u=c&&c.constantOr(1);let h,d,p,f,A;a?(d=u&&!r.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",h=l.LINES):(d=u?"fillPattern":"fill",h=l.TRIANGLES);for(const m of n){const n=i.getTile(m);if(u&&!n.patternsLoaded())continue;const g=n.getBucket(r);if(!g)continue;e.prepareDrawTile();const _=g.programConfigurations.get(r.id),y=e.useProgram(d,_);u&&(e.context.activeTexture.set(l.TEXTURE0),n.imageAtlasTexture.bind(l.LINEAR,l.CLAMP_TO_EDGE),_.updatePaintBuffers());const v=c.constantOr(null);if(v&&n.imageAtlas){const t=n.imageAtlas.patternPositions[v.toString()];t&&_.setConstantPatternPositions(t)}const x=e.translatePosMatrix(m.projMatrix,n,r.paint.get("fill-translate"),r.paint.get("fill-translate-anchor"));if(a){f=g.indexBuffer2,A=g.segments2;const t=e.terrain&&e.terrain.renderingToTexture?e.terrain.drapeBufferSize:[l.drawingBufferWidth,l.drawingBufferHeight];p="fillOutlinePattern"===d&&u?Oi(x,e,n,t):Ui(x,t)}else f=g.indexBuffer,A=g.segments,p=u?Ri(x,e,n):Di(x);e.prepareDrawProgram(e.context,y,m.toUnwrapped()),y.draw(e.context,h,o,e.stencilModeForClipping(m),s,t.CullFaceMode.disabled,p,r.id,g.layoutVertexBuffer,f,A,r.paint,e.transform.zoom,_)}}function mr(e,i,r,n,o,s,a){const l=e.context,c=l.gl,u=e.transform,h=r.paint.get("fill-extrusion-pattern"),d=h.constantOr(1),p=r.paint.get("fill-extrusion-opacity"),f=[r.paint.get("fill-extrusion-ambient-occlusion-intensity"),r.paint.get("fill-extrusion-ambient-occlusion-radius")],A=r.layout.get("fill-extrusion-edge-radius"),m=A>0&&!r.paint.get("fill-extrusion-rounded-roof"),g=m?0:A,_="globe"===u.projection.name?t.fillExtrusionHeightLift():0,y="globe"===u.projection.name,v=y?t.globeToMercatorTransition(u.zoom):0,x=[t.mercatorXfromLng(u.center.lng),t.mercatorYfromLat(u.center.lat)],b=[];y&&b.push("PROJECTION_GLOBE_VIEW"),f[0]>0&&b.push("FAUX_AO"),m&&b.push("ZERO_ROOF_RADIUS");for(const A of n){const n=i.getTile(A),m=n.getBucket(r);if(!m||m.projection.name!==u.projection.name)continue;const w=m.programConfigurations.get(r.id),T=e.useProgram(d?"fillExtrusionPattern":"fillExtrusion",w,b);if(e.terrain){const t=e.terrain;if(e.style.terrainSetForDrapingOnly())t.setupElevationDraw(n,T,{useMeterToDem:!0});else{if(!m.enableTerrain)continue;if(t.setupElevationDraw(n,T,{useMeterToDem:!0}),gr(l,i,A,m,r,t),!m.centroidVertexBuffer){const t=T.attributes.a_centroid_pos;void 0!==t&&c.vertexAttrib2f(t,0,0)}}}d&&(e.context.activeTexture.set(c.TEXTURE0),n.imageAtlasTexture.bind(c.LINEAR,c.CLAMP_TO_EDGE),w.updatePaintBuffers());const B=h.constantOr(null);if(B&&n.imageAtlas){const t=n.imageAtlas.patternPositions[B.toString()];t&&w.setConstantPatternPositions(t)}const E=e.translatePosMatrix(A.projMatrix,n,r.paint.get("fill-extrusion-translate"),r.paint.get("fill-extrusion-translate-anchor")),C=u.projection.createInversionMatrix(u,A.canonical),S=r.paint.get("fill-extrusion-vertical-gradient"),I=d?Fi(E,e,S,p,f,g,A,n,_,v,x,C):zi(E,e,S,p,f,g,A,_,v,x,C);e.prepareDrawProgram(l,T,A.toUnwrapped());const M=[];e.terrain&&M.push(m.centroidVertexBuffer),y&&M.push(m.layoutVertexExtBuffer),T.draw(l,l.gl.TRIANGLES,o,s,a,t.CullFaceMode.backCCW,I,r.id,m.layoutVertexBuffer,m.indexBuffer,m.segments,r.paint,e.transform.zoom,w,M)}}function gr(e,i,r,n,o,s){const a=[e=>{let i=e.canonical.x-1,r=e.wrap;return i<0&&(i=(1<<e.canonical.z)-1,r--),new t.OverscaledTileID(e.overscaledZ,r,e.canonical.z,i,e.canonical.y)},e=>{let i=e.canonical.x+1,r=e.wrap;return i===1<<e.canonical.z&&(i=0,r++),new t.OverscaledTileID(e.overscaledZ,r,e.canonical.z,i,e.canonical.y)},e=>new t.OverscaledTileID(e.overscaledZ,e.wrap,e.canonical.z,e.canonical.x,(0===e.canonical.y?1<<e.canonical.z:e.canonical.y)-1),e=>new t.OverscaledTileID(e.overscaledZ,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y===(1<<e.canonical.z)-1?0:e.canonical.y+1)],l=t=>{const e=i.getSource().minzoom,r=t=>{const e=i.getTileByID(t);if(e&&e.hasData())return e.getBucket(o)},n=[0,-1,1];for(const i of n){if(t.overscaledZ+i<e)continue;const n=r(t.calculateScaledKey(t.overscaledZ+i));if(n)return n}},c=[0,0,0],u=(e,i)=>(c[0]=Math.min(e.min.y,i.min.y),c[1]=Math.max(e.max.y,i.max.y),c[2]=t.EXTENT-i.min.x>e.max.x?i.min.x-t.EXTENT:e.max.x,c),h=(e,i)=>(c[0]=Math.min(e.min.x,i.min.x),c[1]=Math.max(e.max.x,i.max.x),c[2]=t.EXTENT-i.min.y>e.max.y?i.min.y-t.EXTENT:e.max.y,c),d=[(t,e)=>u(t,e),(t,e)=>u(e,t),(t,e)=>h(t,e),(t,e)=>h(e,t)],p=new t.Point(0,0);let f,A,m;const g=(e,i,n,o,a)=>{const l=[[o?n:e,o?e:n,0],[o?n:i,o?i:n,0]],c=a<0?t.EXTENT+a:a,u=[o?c:(e+i)/2,o?(e+i)/2:c,0];return 0===n&&a<0||0!==n&&a>0?s.getForTilePoints(m,[u],!0,A):l.push(u),s.getForTilePoints(r,l,!0,f),Math.max(l[0][2],l[1][2],u[2])/s.exaggeration()};for(let e=0;e<4;e++){const i=(e<2?1:5)-e,o=n.borders[e];if(0===o.length)continue;const c=m=a[e](r),u=l(c);if(!(u&&u instanceof t.FillExtrusionBucket&&u.enableTerrain))continue;if(n.borderDoneWithNeighborZ[e]===u.canonical.z&&u.borderDoneWithNeighborZ[i]===n.canonical.z)continue;if(A=s.findDEMTileFor(c),!A||!A.dem)continue;if(!f){const t=s.findDEMTileFor(r);if(!t||!t.dem)return;f=t}const h=u.borders[i];let _=0;const y=u.borderDoneWithNeighborZ[i]!==n.canonical.z;if(n.canonical.z===u.canonical.z){for(let r=0;r<o.length;r++){const s=n.featuresOnBorder[o[r]],a=s.borders[e];let l;for(;_<h.length&&(l=u.featuresOnBorder[h[_]],!(l.borders[i][1]>a[0]+3));)y&&u.encodeCentroid(void 0,l,!1),_++;if(l&&_<h.length){const r=_;let o=0;for(;!(l.borders[i][0]>a[1]-3)&&(o++,++_!==h.length);)l=u.featuresOnBorder[h[_]];if(l=u.featuresOnBorder[h[r]],s.intersectsCount()>1||l.intersectsCount()>1||1!==o){1!==o&&(_=r),n.encodeCentroid(void 0,s,!1),y&&u.encodeCentroid(void 0,l,!1);continue}const c=d[e](s,l),f=e%2?t.EXTENT-1:0;p.x=g(c[0],Math.min(t.EXTENT-1,c[1]),f,e<2,c[2]),p.y=0,n.encodeCentroid(p,s,!1),y&&u.encodeCentroid(p,l,!1)}else n.encodeCentroid(void 0,s,!1)}n.borderDoneWithNeighborZ[e]=u.canonical.z,n.needsCentroidUpdate=!0,y&&(u.borderDoneWithNeighborZ[i]=n.canonical.z,u.needsCentroidUpdate=!0)}else{for(const t of o)n.encodeCentroid(void 0,n.featuresOnBorder[t],!1);if(y){for(const t of h)u.encodeCentroid(void 0,u.featuresOnBorder[t],!1);u.borderDoneWithNeighborZ[i]=n.canonical.z,u.needsCentroidUpdate=!0}n.borderDoneWithNeighborZ[e]=u.canonical.z,n.needsCentroidUpdate=!0}}(n.needsCentroidUpdate||!n.centroidVertexBuffer&&0!==n.centroidVertexArray.length)&&n.uploadCentroid(e)}const _r=new t.Color(1,0,0,1),yr=new t.Color(0,1,0,1),vr=new t.Color(0,0,1,1),xr=new t.Color(1,0,1,1),br=new t.Color(0,1,1,1);function wr(e,i,r){const n=e.context,o=e.transform,s=n.gl,a="globe"===o.projection.name,l=a?["PROJECTION_GLOBE_VIEW"]:null;let c=r.projMatrix;if(a&&t.globeToMercatorTransition(o.zoom)>0){const e=t.transitionTileAABBinECEF(r.canonical,o),i=t.globeDenormalizeECEF(e);c=t.multiply(new Float32Array(16),o.globeMatrix,i),t.multiply(c,o.projMatrix,c)}const u=e.useProgram("debug",null,l),h=i.getTileByID(r.key);e.terrain&&e.terrain.setupElevationDraw(h,u);const d=t.DepthMode.disabled,p=t.StencilMode.disabled,f=e.colorModeForRenderPass(),A="$debug";n.activeTexture.set(s.TEXTURE0),e.emptyTexture.bind(s.LINEAR,s.CLAMP_TO_EDGE),a?h._makeGlobeTileDebugBuffers(e.context,o):h._makeDebugTileBoundsBuffers(e.context,o.projection);const m=h._tileDebugBuffer||e.debugBuffer,g=h._tileDebugIndexBuffer||e.debugIndexBuffer,_=h._tileDebugSegments||e.debugSegments;u.draw(n,s.LINE_STRIP,d,p,f,t.CullFaceMode.disabled,Hi(c,t.Color.red),A,m,g,_,null,null,null,[h._globeTileDebugBorderBuffer]);const y=h.latestRawTileData,v=Math.floor((y&&y.byteLength||0)/1024),x=i.getTile(r).tileSize,b=512/Math.min(x,512)*(r.overscaledZ/o.zoom)*.5;let w=r.canonical.toString();r.overscaledZ!==r.canonical.z&&(w+=` => ${r.overscaledZ}`),w+=` ${v}kb`,function(t,e){t.initDebugOverlayCanvas();const i=t.debugOverlayCanvas,r=t.context.gl,n=t.debugOverlayCanvas.getContext("2d");n.clearRect(0,0,i.width,i.height),n.shadowColor="white",n.shadowBlur=2,n.lineWidth=1.5,n.strokeStyle="white",n.textBaseline="top",n.font="bold 36px Open Sans, sans-serif",n.fillText(e,5,5),n.strokeText(e,5,5),t.debugOverlayTexture.update(i),t.debugOverlayTexture.bind(r.LINEAR,r.CLAMP_TO_EDGE)}(e,w);const T=h._tileDebugTextBuffer||e.debugBuffer,B=h._tileDebugTextIndexBuffer||e.quadTriangleIndexBuffer,E=h._tileDebugTextSegments||e.debugSegments;u.draw(n,s.TRIANGLES,d,p,t.ColorMode.alphaBlended,t.CullFaceMode.disabled,Hi(c,t.Color.transparent,b),A,T,B,E,null,null,null,[h._globeTileDebugTextBuffer])}function Tr(t,e,i,r){Er(t,0,e+i/2,t.transform.width,i,r)}function Br(t,e,i,r){Er(t,e-i/2,0,i,t.transform.height,r)}function Er(e,i,r,n,o,s){const a=e.context,l=a.gl;l.enable(l.SCISSOR_TEST),l.scissor(i*t.exported.devicePixelRatio,r*t.exported.devicePixelRatio,n*t.exported.devicePixelRatio,o*t.exported.devicePixelRatio),a.clear({color:s}),l.disable(l.SCISSOR_TEST)}const Cr=t.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Sr}=Cr;function Ir(t,e,i,r){t.emplaceBack(e,i,r)}class Mr{constructor(e){this.vertexArray=new t.StructArrayLayout3f12,this.indices=new t.StructArrayLayout3ui6,Ir(this.vertexArray,-1,-1,1),Ir(this.vertexArray,1,-1,1),Ir(this.vertexArray,-1,1,1),Ir(this.vertexArray,1,1,1),Ir(this.vertexArray,-1,-1,-1),Ir(this.vertexArray,1,-1,-1),Ir(this.vertexArray,-1,1,-1),Ir(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=e.createVertexBuffer(this.vertexArray,Sr),this.indexBuffer=e.createIndexBuffer(this.indices),this.segment=t.SegmentVector.simpleSegment(0,0,36,12)}}function kr(e,i,r,n,o,s){const a=e.gl,l=i.paint.get("sky-atmosphere-color"),c=i.paint.get("sky-atmosphere-halo-color"),u=i.paint.get("sky-atmosphere-sun-intensity"),h=((t,e,i,r,n)=>({u_matrix_3f:t,u_sun_direction:e,u_sun_intensity:i,u_color_tint_r:[r.r,r.g,r.b,r.a],u_color_tint_m:[n.r,n.g,n.b,n.a],u_luminance:5e-5}))(t.fromMat4(t.create$1(),n),o,u,l,c);a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_CUBE_MAP_POSITIVE_X+s,i.skyboxTexture,0),r.draw(e,a.TRIANGLES,t.DepthMode.disabled,t.StencilMode.disabled,t.ColorMode.unblended,t.CullFaceMode.frontCW,h,"skyboxCapture",i.skyboxGeometry.vertexBuffer,i.skyboxGeometry.indexBuffer,i.skyboxGeometry.segment)}const Pr=t.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Lr{constructor(e){const i=new t.StructArrayLayout5f20;i.emplaceBack(-1,1,1,0,0),i.emplaceBack(1,1,1,1,0),i.emplaceBack(1,-1,1,1,1),i.emplaceBack(-1,-1,1,0,1);const r=new t.StructArrayLayout3ui6;r.emplaceBack(0,1,2),r.emplaceBack(2,3,0),this.vertexBuffer=e.createVertexBuffer(i,Pr.members),this.indexBuffer=e.createIndexBuffer(r),this.segments=t.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const zr={symbol:function(e,i,r,n,o){if("translucent"!==e.renderPass)return;const s=t.StencilMode.disabled,a=e.colorModeForRenderPass();r.layout.get("text-variable-anchor")&&function(e,i,r,n,o,s,a){const l=i.transform,c="map"===o,u="map"===s;for(const i of e){const e=n.getTile(i),o=e.getBucket(r);if(!o||!o.text||!o.text.segments.get().length)continue;const s=t.evaluateSizeForZoom(o.textSizeData,l.zoom),h=ye(i,o.getProjection(),l),d=l.calculatePixelsToTileUnitsMatrix(e),p=te(h,e.tileID.canonical,u,c,l,o.getProjection(),d),f="none"!==r.layout.get("icon-text-fit")&&o.hasIconData();if(s){const r=Math.pow(2,l.zoom-e.tileID.overscaledZ);hr(o,c,u,a,t.symbolSize,l,p,i,r,s,f)}}}(n,e,r,i,r.layout.get("text-rotation-alignment"),r.layout.get("text-pitch-alignment"),o),0!==r.paint.get("icon-opacity").constantOr(1)&&pr(e,i,r,n,!1,r.paint.get("icon-translate"),r.paint.get("icon-translate-anchor"),r.layout.get("icon-rotation-alignment"),r.layout.get("icon-pitch-alignment"),r.layout.get("icon-keep-upright"),s,a),0!==r.paint.get("text-opacity").constantOr(1)&&pr(e,i,r,n,!0,r.paint.get("text-translate"),r.paint.get("text-translate-anchor"),r.layout.get("text-rotation-alignment"),r.layout.get("text-pitch-alignment"),r.layout.get("text-keep-upright"),s,a),i.map.showCollisionBoxes&&(lr(e,i,r,n,r.paint.get("text-translate"),r.paint.get("text-translate-anchor"),!0),lr(e,i,r,n,r.paint.get("icon-translate"),r.paint.get("icon-translate-anchor"),!1))},circle:function(e,i,r,n){if("translucent"!==e.renderPass)return;const o=r.paint.get("circle-opacity"),s=r.paint.get("circle-stroke-width"),a=r.paint.get("circle-stroke-opacity"),l=void 0!==r.layout.get("circle-sort-key").constantOr(1);if(0===o.constantOr(1)&&(0===s.constantOr(1)||0===a.constantOr(1)))return;const c=e.context,u=c.gl,h=e.transform,d=e.depthModeForSublayer(0,t.DepthMode.ReadOnly),p=t.StencilMode.disabled,f=e.colorModeForRenderPass(),A="globe"===h.projection.name,m=[t.mercatorXfromLng(h.center.lng),t.mercatorYfromLat(h.center.lat)],g=[];for(let o=0;o<n.length;o++){const s=n[o],a=i.getTile(s),c=a.getBucket(r);if(!c||c.projection.name!==h.projection.name)continue;const u=c.programConfigurations.get(r.id),d=Vi(r);A&&d.push("PROJECTION_GLOBE_VIEW");const p=e.useProgram("circle",u,d),f=c.layoutVertexBuffer,_=c.globeExtVertexBuffer,y=c.indexBuffer,v=h.projection.createInversionMatrix(h,s.canonical),x={programConfiguration:u,program:p,layoutVertexBuffer:f,globeExtVertexBuffer:_,indexBuffer:y,uniformValues:Qi(e,s,a,v,m,r),tile:a};if(l){const e=c.segments.get();for(const i of e)g.push({segments:new t.SegmentVector([i]),sortKey:i.sortKey,state:x})}else g.push({segments:c.segments,sortKey:0,state:x})}l&&g.sort(((t,e)=>t.sortKey-e.sortKey));const _={useDepthForOcclusion:!A};for(const i of g){const{programConfiguration:n,program:o,layoutVertexBuffer:s,globeExtVertexBuffer:a,indexBuffer:l,uniformValues:A,tile:m}=i.state,g=i.segments;e.terrain&&e.terrain.setupElevationDraw(m,o,_),e.prepareDrawProgram(c,o,m.tileID.toUnwrapped()),o.draw(c,u.TRIANGLES,d,p,f,t.CullFaceMode.disabled,A,r.id,s,l,g,r.paint,h.zoom,n,[a])}},heatmap:function(e,i,r,n){if(0!==r.paint.get("heatmap-opacity"))if("offscreen"===e.renderPass){const o=e.context,s=o.gl,a=t.StencilMode.disabled,l=new t.ColorMode([s.ONE,s.ONE],t.Color.transparent,[!0,!0,!0,!0]);!function(t,e,i,r){const n=t.gl,o=e.width*r,s=e.height*r;t.activeTexture.set(n.TEXTURE1),t.viewport.set([0,0,o,s]);let a=i.heatmapFbo;if(!a||a&&(a.width!==o||a.height!==s)){a&&a.destroy();const e=n.createTexture();n.bindTexture(n.TEXTURE_2D,e),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR),a=i.heatmapFbo=t.createFramebuffer(o,s,!1),function(t,e,i,r,n,o){const s=t.gl;s.texImage2D(s.TEXTURE_2D,0,t.isWebGL2&&t.extRenderToTextureHalfFloat?s.RGBA16F:s.RGBA,n,o,0,s.RGBA,t.extRenderToTextureHalfFloat?t.isWebGL2?s.HALF_FLOAT:t.extTextureHalfFloat.HALF_FLOAT_OES:s.UNSIGNED_BYTE,null),r.colorAttachment.set(i)}(t,0,e,a,o,s)}else n.bindTexture(n.TEXTURE_2D,a.colorAttachment.get()),t.bindFramebuffer.set(a.framebuffer)}(o,e,r,"globe"===e.transform.projection.name?.5:.25),o.clear({color:t.Color.transparent});const c=e.transform,u="globe"===c.projection.name,h=u?["PROJECTION_GLOBE_VIEW"]:null,d=u?t.CullFaceMode.frontCCW:t.CullFaceMode.disabled,p=[t.mercatorXfromLng(c.center.lng),t.mercatorYfromLat(c.center.lat)];for(let f=0;f<n.length;f++){const A=n[f];if(i.hasRenderableParent(A))continue;const m=i.getTile(A),g=m.getBucket(r);if(!g||g.projection.name!==c.projection.name)continue;const _=g.programConfigurations.get(r.id),y=e.useProgram("heatmap",_,h),{zoom:v}=e.transform;e.terrain&&e.terrain.setupElevationDraw(m,y),e.prepareDrawProgram(o,y,A.toUnwrapped());const x=c.projection.createInversionMatrix(c,A.canonical);y.draw(o,s.TRIANGLES,t.DepthMode.disabled,a,l,d,$i(e,A,m,x,p,v,r.paint.get("heatmap-intensity")),r.id,g.layoutVertexBuffer,g.indexBuffer,g.segments,r.paint,e.transform.zoom,_,u?[g.globeExtVertexBuffer]:null)}o.viewport.set([0,0,e.width,e.height])}else"translucent"===e.renderPass&&(e.context.setColorMode(e.colorModeForRenderPass()),function(e,i){const r=e.context,n=r.gl,o=i.heatmapFbo;if(!o)return;r.activeTexture.set(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,o.colorAttachment.get()),r.activeTexture.set(n.TEXTURE1);let s=i.colorRampTexture;s||(s=i.colorRampTexture=new t.Texture(r,i.colorRamp,n.RGBA)),s.bind(n.LINEAR,n.CLAMP_TO_EDGE),e.useProgram("heatmapTexture").draw(r,n.TRIANGLES,t.DepthMode.disabled,t.StencilMode.disabled,e.colorModeForRenderPass(),t.CullFaceMode.disabled,((t,e,i,r)=>({u_image:0,u_color_ramp:1,u_opacity:e.paint.get("heatmap-opacity")}))(0,i),i.id,e.viewportBuffer,e.quadTriangleIndexBuffer,e.viewportSegments,i.paint,e.transform.zoom)}(e,r))},line:function(e,i,r,n){if("translucent"!==e.renderPass)return;const o=r.paint.get("line-opacity"),s=r.paint.get("line-width");if(0===o.constantOr(1)||0===s.constantOr(1))return;const a=e.depthModeForSublayer(0,t.DepthMode.ReadOnly),l=e.colorModeForRenderPass(),c=e.terrain&&e.terrain.renderingToTexture?1:t.exported.devicePixelRatio,u=r.paint.get("line-dasharray"),h=u.constantOr(1),d=r.layout.get("line-cap"),p=r.paint.get("line-pattern"),f=p.constantOr(1),A=r.paint.get("line-gradient"),m=f?"linePattern":"line",g=e.context,_=g.gl,y=(t=>{const e=[];Xi(t)&&e.push("RENDER_LINE_DASH"),t.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");const i=t.paint.get("line-trim-offset");0===i[0]&&0===i[1]||e.push("RENDER_LINE_TRIM_OFFSET");const r=t.paint.get("line-pattern").constantOr(1),n=1!==t.paint.get("line-opacity").constantOr(1);return!r&&n&&e.push("RENDER_LINE_ALPHA_DISCARD"),e})(r);let v=y.includes("RENDER_LINE_ALPHA_DISCARD");e.terrain&&e.terrain.clipOrMaskOverlapStencilType()&&(v=!1);for(const o of n){const n=i.getTile(o);if(f&&!n.patternsLoaded())continue;const s=n.getBucket(r);if(!s)continue;e.prepareDrawTile();const x=s.programConfigurations.get(r.id),b=e.useProgram(m,x,y),w=p.constantOr(null);if(w&&n.imageAtlas){const t=n.imageAtlas.patternPositions[w.toString()];t&&x.setConstantPatternPositions(t)}const T=u.constantOr(null),B=d.constantOr(null);if(!f&&T&&B&&n.lineAtlas){const t=n.lineAtlas.getDash(T,B);t&&x.setConstantPatternPositions(t)}let[E,C]=r.paint.get("line-trim-offset");if("round"===B||"square"===B){const t=1;E!==C&&(0===E&&(E-=t),1===C&&(C+=t))}const S=e.terrain?o.projMatrix:null,I=f?qi(e,n,r,S,c):Zi(e,n,r,S,s.lineClipsArray.length,c,[E,C]);if(A){const n=s.gradients[r.id];let a=n.texture;if(r.gradientVersion!==n.version){let l=256;if(r.stepInterpolant){const r=i.getSource().maxzoom,n=o.canonical.z===r?Math.ceil(1<<e.transform.maxZoom-o.canonical.z):1;l=t.clamp(t.nextPowerOfTwo(s.maxLineLength/t.EXTENT*1024*n),256,g.maxTextureSize)}n.gradient=t.renderColorRamp({expression:r.gradientExpression(),evaluationKey:"lineProgress",resolution:l,image:n.gradient||void 0,clips:s.lineClipsArray}),n.texture?n.texture.update(n.gradient):n.texture=new t.Texture(g,n.gradient,_.RGBA),n.version=r.gradientVersion,a=n.texture}g.activeTexture.set(_.TEXTURE1),a.bind(r.stepInterpolant?_.NEAREST:_.LINEAR,_.CLAMP_TO_EDGE)}h&&(g.activeTexture.set(_.TEXTURE0),n.lineAtlasTexture.bind(_.LINEAR,_.REPEAT),x.updatePaintBuffers()),f&&(g.activeTexture.set(_.TEXTURE0),n.imageAtlasTexture.bind(_.LINEAR,_.CLAMP_TO_EDGE),x.updatePaintBuffers()),e.prepareDrawProgram(g,b,o.toUnwrapped());const M=i=>{b.draw(g,_.TRIANGLES,a,i,l,t.CullFaceMode.disabled,I,r.id,s.layoutVertexBuffer,s.indexBuffer,s.segments,r.paint,e.transform.zoom,x,[s.layoutVertexBuffer2])};if(v){const i=e.stencilModeForClipping(o).ref;0===i&&e.terrain&&g.clear({stencil:0});const r={func:_.EQUAL,mask:255};I.u_alpha_discard_threshold=.8,M(new t.StencilMode(r,i,255,_.KEEP,_.KEEP,_.INVERT)),I.u_alpha_discard_threshold=0,M(new t.StencilMode(r,i,255,_.KEEP,_.KEEP,_.KEEP))}else M(e.stencilModeForClipping(o))}v&&(e.resetStencilClippingMasks(),e.terrain&&g.clear({stencil:0}))},fill:function(e,i,r,n){const o=r.paint.get("fill-color"),s=r.paint.get("fill-opacity");if(0===s.constantOr(1))return;const a=e.colorModeForRenderPass(),l=r.paint.get("fill-pattern"),c=e.opaquePassEnabledForLayer()&&!l.constantOr(1)&&1===o.constantOr(t.Color.transparent).a&&1===s.constantOr(0)?"opaque":"translucent";if(e.renderPass===c){const o=e.depthModeForSublayer(1,"opaque"===e.renderPass?t.DepthMode.ReadWrite:t.DepthMode.ReadOnly);Ar(e,i,r,n,o,a,!1)}if("translucent"===e.renderPass&&r.paint.get("fill-antialias")){const o=e.depthModeForSublayer(r.getPaintProperty("fill-outline-color")?2:0,t.DepthMode.ReadOnly);Ar(e,i,r,n,o,a,!0)}},"fill-extrusion":function(e,i,r,n){const o=r.paint.get("fill-extrusion-opacity");if(0!==o&&"translucent"===e.renderPass){const s=new t.DepthMode(e.context.gl.LEQUAL,t.DepthMode.ReadWrite,e.depthRangeFor3D);if(1!==o||r.paint.get("fill-extrusion-pattern").constantOr(1))mr(e,i,r,n,s,t.StencilMode.disabled,t.ColorMode.disabled),mr(e,i,r,n,s,e.stencilModeFor3D(),e.colorModeForRenderPass()),e.resetStencilClippingMasks();else{const o=e.colorModeForRenderPass();mr(e,i,r,n,s,t.StencilMode.disabled,o)}}},hillshade:function(e,i,r,n){if("offscreen"!==e.renderPass&&"translucent"!==e.renderPass)return;const o=e.context,s=e.depthModeForSublayer(0,t.DepthMode.ReadOnly),a=e.colorModeForRenderPass(),l=e.terrain&&e.terrain.renderingToTexture,[c,u]="translucent"!==e.renderPass||l?[{},n]:e.stencilConfigForOverlap(n);for(const n of u){const o=i.getTile(n);if(o.needsHillshadePrepare&&"offscreen"===e.renderPass)mi(e,o,r,s,t.StencilMode.disabled,a);else if("translucent"===e.renderPass){const t=l&&e.terrain?e.terrain.stencilModeForRTTOverlap(n):c[n.overscaledZ];fi(e,n,o,r,s,t,a)}}o.viewport.set([0,0,e.width,e.height]),e.resetStencilClippingMasks()},raster:function(e,i,r,n,o,s){if("translucent"!==e.renderPass)return;if(0===r.paint.get("raster-opacity"))return;if(!n.length)return;const a=e.context,l=a.gl,c=i.getSource(),u=e.useProgram("raster"),h=e.colorModeForRenderPass(),d=e.terrain&&e.terrain.renderingToTexture,[p,f]=c instanceof St||d?[{},n]:e.stencilConfigForOverlap(n),A=f[f.length-1].overscaledZ,m=!e.options.moving;for(const n of f){const o=d?t.DepthMode.disabled:e.depthModeForSublayer(n.overscaledZ-A,1===r.paint.get("raster-opacity")?t.DepthMode.ReadWrite:t.DepthMode.ReadOnly,l.LESS),f=n.toUnwrapped(),g=i.getTile(n);if(d&&(!g||!g.hasData()))continue;const _=d?n.projMatrix:e.transform.calculateProjMatrix(f,m),y=e.terrain&&d?e.terrain.stencilModeForRTTOverlap(n):p[n.overscaledZ],v=s?0:r.paint.get("raster-fade-duration");g.registerFadeDuration(v);const x=i.findLoadedParent(n,0),b=Ei(g,x,i,e.transform,v);let w,T;e.terrain&&e.terrain.prepareDrawTile();const B="nearest"===r.paint.get("raster-resampling")?l.NEAREST:l.LINEAR;a.activeTexture.set(l.TEXTURE0),g.texture.bind(B,l.CLAMP_TO_EDGE),a.activeTexture.set(l.TEXTURE1),x?(x.texture.bind(B,l.CLAMP_TO_EDGE),w=Math.pow(2,x.tileID.overscaledZ-g.tileID.overscaledZ),T=[g.tileID.canonical.x*w%1,g.tileID.canonical.y*w%1]):g.texture.bind(B,l.CLAMP_TO_EDGE),g.texture.useMipmap&&a.extTextureFilterAnisotropic&&e.transform.pitch>20&&l.texParameterf(l.TEXTURE_2D,a.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,a.extTextureFilterAnisotropicMax);const E=Ji(_,T||[0,0],w||1,b,r,c instanceof St?c.perspectiveTransform:[0,0]);if(e.prepareDrawProgram(a,u,f),c instanceof St)c.boundsBuffer&&c.boundsSegments&&u.draw(a,l.TRIANGLES,o,t.StencilMode.disabled,h,t.CullFaceMode.disabled,E,r.id,c.boundsBuffer,e.quadTriangleIndexBuffer,c.boundsSegments);else{const{tileBoundsBuffer:i,tileBoundsIndexBuffer:n,tileBoundsSegments:s}=e.getTileBoundsBuffers(g);u.draw(a,l.TRIANGLES,o,y,h,t.CullFaceMode.disabled,E,r.id,i,n,s)}}e.resetStencilClippingMasks()},background:function(e,i,r,n){const o=r.paint.get("background-color"),s=r.paint.get("background-opacity");if(0===s)return;const a=e.context,l=a.gl,c=e.transform,u=c.tileSize,h=r.paint.get("background-pattern");if(e.isPatternMissing(h))return;const d=!h&&1===o.a&&1===s&&e.opaquePassEnabledForLayer()?"opaque":"translucent";if(e.renderPass!==d)return;const p=t.StencilMode.disabled,f=e.depthModeForSublayer(0,"opaque"===d?t.DepthMode.ReadWrite:t.DepthMode.ReadOnly),A=e.colorModeForRenderPass(),m=e.useProgram(h?"backgroundPattern":"background");let g,_=n;_||(g=e.getBackgroundTiles(),_=Object.values(g).map((t=>t.tileID))),h&&(a.activeTexture.set(l.TEXTURE0),e.imageManager.bind(e.context));for(const d of _){const _=d.toUnwrapped(),y=n?d.projMatrix:e.transform.calculateProjMatrix(_);e.prepareDrawTile();const v=i?i.getTile(d):g?g[d.key]:new t.Tile(d,u,c.zoom,e),x=h?or(y,s,e,h,{tileID:d,tileSize:u}):nr(y,s,o);e.prepareDrawProgram(a,m,_);const{tileBoundsBuffer:b,tileBoundsIndexBuffer:w,tileBoundsSegments:T}=e.getTileBoundsBuffers(v);m.draw(a,l.TRIANGLES,f,p,A,t.CullFaceMode.disabled,x,r.id,b,w,T)}},sky:function(e,i,r){const n=e.transform,o="mercator"===n.projection.name||"globe"===n.projection.name?1:t.smoothstep(7,8,n.zoom),s=r.paint.get("sky-opacity")*o;if(0===s)return;const a=e.context,l=r.paint.get("sky-type"),c=new t.DepthMode(a.gl.LEQUAL,t.DepthMode.ReadOnly,[0,1]),u=e.frameCounter/1e3%1;"atmosphere"===l?"offscreen"===e.renderPass?r.needsSkyboxCapture(e)&&(function(e,i,r,n){const o=e.context,s=o.gl;let a=i.skyboxFbo;if(!a){a=i.skyboxFbo=o.createFramebuffer(32,32,!1),i.skyboxGeometry=new Mr(o),i.skyboxTexture=o.gl.createTexture(),s.bindTexture(s.TEXTURE_CUBE_MAP,i.skyboxTexture),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_MIN_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_MAG_FILTER,s.LINEAR);for(let t=0;t<6;++t)s.texImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,s.RGBA,32,32,0,s.RGBA,s.UNSIGNED_BYTE,null)}o.bindFramebuffer.set(a.framebuffer),o.viewport.set([0,0,32,32]);const l=i.getCenter(e,!0),c=e.useProgram("skyboxCapture"),u=new Float64Array(16);t.identity(u),t.rotateY(u,u,.5*-Math.PI),kr(o,i,c,u,l,0),t.identity(u),t.rotateY(u,u,.5*Math.PI),kr(o,i,c,u,l,1),t.identity(u),t.rotateX(u,u,.5*-Math.PI),kr(o,i,c,u,l,2),t.identity(u),t.rotateX(u,u,.5*Math.PI),kr(o,i,c,u,l,3),t.identity(u),kr(o,i,c,u,l,4),t.identity(u),t.rotateY(u,u,Math.PI),kr(o,i,c,u,l,5),o.viewport.set([0,0,e.width,e.height])}(e,r),r.markSkyboxValid(e)):"sky"===e.renderPass&&function(e,i,r,n,o){const s=e.context,a=s.gl,l=e.transform,c=e.useProgram("skybox");s.activeTexture.set(a.TEXTURE0),a.bindTexture(a.TEXTURE_CUBE_MAP,i.skyboxTexture);const u=((t,e,i,r,n)=>({u_matrix:t,u_sun_direction:e,u_cubemap:0,u_opacity:r,u_temporal_offset:n}))(l.skyboxMatrix,i.getCenter(e,!1),0,n,o);e.prepareDrawProgram(s,c),c.draw(s,a.TRIANGLES,r,t.StencilMode.disabled,e.colorModeForRenderPass(),t.CullFaceMode.backCW,u,"skybox",i.skyboxGeometry.vertexBuffer,i.skyboxGeometry.indexBuffer,i.skyboxGeometry.segment)}(e,r,c,s,u):"gradient"===l&&"sky"===e.renderPass&&function(e,i,r,n,o){const s=e.context,a=s.gl,l=e.transform,c=e.useProgram("skyboxGradient");i.skyboxGeometry||(i.skyboxGeometry=new Mr(s)),s.activeTexture.set(a.TEXTURE0);let u=i.colorRampTexture;u||(u=i.colorRampTexture=new t.Texture(s,i.colorRamp,a.RGBA)),u.bind(a.LINEAR,a.CLAMP_TO_EDGE);const h=((e,i,r,n,o)=>({u_matrix:e,u_color_ramp:0,u_center_direction:i,u_radius:t.degToRad(r),u_opacity:n,u_temporal_offset:o}))(l.skyboxMatrix,i.getCenter(e,!1),i.paint.get("sky-gradient-radius"),n,o);e.prepareDrawProgram(s,c),c.draw(s,a.TRIANGLES,r,t.StencilMode.disabled,e.colorModeForRenderPass(),t.CullFaceMode.backCW,h,"skyboxGradient",i.skyboxGeometry.vertexBuffer,i.skyboxGeometry.indexBuffer,i.skyboxGeometry.segment)}(e,r,c,s,u)},debug:function(t,e,i){for(let r=0;r<i.length;r++)wr(t,e,i[r])},custom:function(e,i,r,n){const o=e.context,s=r.implementation;if(!e.transform.projection.unsupportedLayers||!e.transform.projection.unsupportedLayers.includes("custom")||e.terrain&&(e.terrain.renderingToTexture||"offscreen"===e.renderPass)&&r.isLayerDraped()){if("offscreen"===e.renderPass){const i=s.prerender;if(i){if(e.setCustomLayerDefaults(),o.setColorMode(e.colorModeForRenderPass()),"globe"===e.transform.projection.name){const r=e.transform.pointMerc;i.call(s,o.gl,e.transform.customLayerMatrix(),e.transform.getProjection(),e.transform.globeToMercatorMatrix(),t.globeToMercatorTransition(e.transform.zoom),[r.x,r.y],e.transform.pixelsPerMeterRatio)}else i.call(s,o.gl,e.transform.customLayerMatrix());o.setDirty(),e.setBaseState()}}else if("translucent"===e.renderPass){if(e.terrain&&e.terrain.renderingToTexture){const i=s.renderToTile;if(i){const r=n[0].canonical,a=new t.MercatorCoordinate(r.x+n[0].wrap*(1<<r.z),r.y,r.z);o.setDepthMode(t.DepthMode.disabled),o.setStencilMode(t.StencilMode.disabled),o.setColorMode(e.colorModeForRenderPass()),e.setCustomLayerDefaults(),i.call(s,o.gl,a),o.setDirty(),e.setBaseState()}return}e.setCustomLayerDefaults(),o.setColorMode(e.colorModeForRenderPass()),o.setStencilMode(t.StencilMode.disabled);const i="3d"===s.renderingMode?new t.DepthMode(e.context.gl.LEQUAL,t.DepthMode.ReadWrite,e.depthRangeFor3D):e.depthModeForSublayer(0,t.DepthMode.ReadOnly);if(o.setDepthMode(i),"globe"===e.transform.projection.name){const i=e.transform.pointMerc;s.render(o.gl,e.transform.customLayerMatrix(),e.transform.getProjection(),e.transform.globeToMercatorMatrix(),t.globeToMercatorTransition(e.transform.zoom),[i.x,i.y],e.transform.pixelsPerMeterRatio)}else s.render(o.gl,e.transform.customLayerMatrix());o.setDirty(),e.setBaseState(),o.bindFramebuffer.set(null)}}else t.warnOnce("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")}};class Fr{constructor(e,i,r=!1){this.context=new Tt(e,r),this.transform=i,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=t.SourceCache.maxUnderzooming+t.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(t,e){const i=!!t&&!!t.terrain&&this.transform.projection.supportsTerrain;if(!(i||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Mi(this,t));const r=this._terrain;this.transform.elevation=i?r:null,r.update(t,this.transform,e)}_updateFog(t){const e=t.fog;if(!e||"globe"===this.transform.projection.name||e.getOpacity(this.transform.pitch)<1||e.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[i,r]=e.getFovAdjustedRange(this.transform._fov);if(i>r)return void(this.transform.fogCullDistSq=null);const n=i+.78*(r-i);this.transform.fogCullDistSq=n*n}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(e,i){if(this.width=e*t.exported.devicePixelRatio,this.height=i*t.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const t of this.style.order)this.style._layers[t].resize()}setup(){const e=this.context,i=new t.StructArrayLayout2i4;i.emplaceBack(0,0),i.emplaceBack(t.EXTENT,0),i.emplaceBack(0,t.EXTENT),i.emplaceBack(t.EXTENT,t.EXTENT),this.tileExtentBuffer=e.createVertexBuffer(i,t.posAttributes.members),this.tileExtentSegments=t.SegmentVector.simpleSegment(0,0,4,2);const r=new t.StructArrayLayout2i4;r.emplaceBack(0,0),r.emplaceBack(t.EXTENT,0),r.emplaceBack(0,t.EXTENT),r.emplaceBack(t.EXTENT,t.EXTENT),this.debugBuffer=e.createVertexBuffer(r,t.posAttributes.members),this.debugSegments=t.SegmentVector.simpleSegment(0,0,4,5);const n=new t.StructArrayLayout2i4;n.emplaceBack(-1,-1),n.emplaceBack(1,-1),n.emplaceBack(-1,1),n.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(n,t.posAttributes.members),this.viewportSegments=t.SegmentVector.simpleSegment(0,0,4,2);const o=new t.StructArrayLayout4i8;o.emplaceBack(0,0,0,0),o.emplaceBack(t.EXTENT,0,t.EXTENT,0),o.emplaceBack(0,t.EXTENT,0,t.EXTENT),o.emplaceBack(t.EXTENT,t.EXTENT,t.EXTENT,t.EXTENT),this.mercatorBoundsBuffer=e.createVertexBuffer(o,t.boundsAttributes.members),this.mercatorBoundsSegments=t.SegmentVector.simpleSegment(0,0,4,2);const s=new t.StructArrayLayout3ui6;s.emplaceBack(0,1,2),s.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(s);const a=new t.StructArrayLayout1ui2;for(const t of[0,1,3,2,0])a.emplaceBack(t);this.debugIndexBuffer=e.createIndexBuffer(a),this.emptyTexture=new t.Texture(e,new t.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),e.gl.RGBA),this.identityMat=t.create();const l=this.context.gl;this.stencilClearMode=new t.StencilMode({func:l.ALWAYS,mask:0},0,255,l.ZERO,l.ZERO,l.ZERO),this.loadTimeStamps.push(t.window.performance.now()),this.atmosphereBuffer=new Lr(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(t){return t._makeTileBoundsBuffers(this.context,this.transform.projection),t._tileBoundsBuffer?{tileBoundsBuffer:t._tileBoundsBuffer,tileBoundsIndexBuffer:t._tileBoundsIndexBuffer,tileBoundsSegments:t._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const e=this.context,i=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(e,i.TRIANGLES,t.DepthMode.disabled,this.stencilClearMode,t.ColorMode.disabled,t.CullFaceMode.disabled,Bi(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(e,i,r){if(!i||this.currentStencilSource===i.id||!e.isTileClipped()||!r||0===r.length)return;if(this._tileClippingMaskIDs&&!this.terrain){let t=!1;for(const e of r)if(void 0===this._tileClippingMaskIDs[e.key]){t=!0;break}if(!t)return}this.currentStencilSource=i.id;const n=this.context,o=n.gl;this.nextStencilID+r.length>256&&this.clearStencil(),n.setColorMode(t.ColorMode.disabled),n.setDepthMode(t.DepthMode.disabled);const s=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const e of r){const r=i.getTile(e),a=this._tileClippingMaskIDs[e.key]=this.nextStencilID++,{tileBoundsBuffer:l,tileBoundsIndexBuffer:c,tileBoundsSegments:u}=this.getTileBoundsBuffers(r);s.draw(n,o.TRIANGLES,t.DepthMode.disabled,new t.StencilMode({func:o.ALWAYS,mask:0},a,255,o.KEEP,o.KEEP,o.REPLACE),t.ColorMode.disabled,t.CullFaceMode.disabled,Bi(e.projMatrix),"$clipping",l,c,u)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const e=this.nextStencilID++,i=this.context.gl;return new t.StencilMode({func:i.NOTEQUAL,mask:255},e,255,i.KEEP,i.KEEP,i.REPLACE)}stencilModeForClipping(e){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(e);const i=this.context.gl;return new t.StencilMode({func:i.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,i.KEEP,i.KEEP,i.REPLACE)}stencilConfigForOverlap(e){const i=this.context.gl,r=e.sort(((t,e)=>e.overscaledZ-t.overscaledZ)),n=r[r.length-1].overscaledZ,o=r[0].overscaledZ-n+1;if(o>1){this.currentStencilSource=void 0,this.nextStencilID+o>256&&this.clearStencil();const e={};for(let r=0;r<o;r++)e[r+n]=new t.StencilMode({func:i.GEQUAL,mask:255},r+this.nextStencilID,255,i.KEEP,i.KEEP,i.REPLACE);return this.nextStencilID+=o,[e,r]}return[{[n]:t.StencilMode.disabled},r]}colorModeForRenderPass(){const e=this.context.gl;if(this._showOverdrawInspector){const i=1/8;return new t.ColorMode([e.CONSTANT_COLOR,e.ONE],new t.Color(i,i,i,0),[!0,!0,!0,!0])}return"opaque"===this.renderPass?t.ColorMode.unblended:t.ColorMode.alphaBlended}depthModeForSublayer(e,i,r){if(!this.opaquePassEnabledForLayer())return t.DepthMode.disabled;const n=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new t.DepthMode(r||this.context.gl.LEQUAL,i,[n,n])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(e,i){this.style=e,this.options=i,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(t.exported.now()),this.imageManager.beginFrame();const r=this.style.order,n=this.style._sourceCaches;for(const t in n){const e=n[t];e.used&&e.prepare(this.context)}const o={},s={},a={};for(const t in n){const e=n[t];o[t]=e.getVisibleCoordinates(),s[t]=o[t].slice().reverse(),a[t]=e.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let t=0;t<r.length;t++)if(this.style._layers[r[t]].is3D()){this.opaquePassCutoff=t;break}if(this.terrain&&(this.terrain.updateTileBinding(a),this.opaquePassCutoff=0),"globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new t.GlobeSharedBuffers(this.context)),!t.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const t of r){const i=this.style._layers[t],r=e._getLayerSourceCache(i);if(!i.hasOffscreenPass()||i.isHidden(this.transform.zoom))continue;const n=r?s[r.id]:void 0;("custom"===i.type||i.isSky()||n&&n.length)&&this.renderLayer(this,r,i,n)}this.depthRangeFor3D=[0,1-(e.order.length+2)*this.numSublayers*this.depthEpsilon];const l=this.terrain;if(l&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&l.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:i.showOverdrawInspector?t.Color.black:t.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=i.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=r.length-1;this.currentLayer>=0;this.currentLayer--){const t=this.style._layers[r[this.currentLayer]],i=e._getLayerSourceCache(t);if(t.isSky())continue;const n=i?s[i.id]:void 0;this._renderTileClippingMasks(t,i,n),this.renderLayer(this,i,t,n)}if(this.style.fog&&this.transform.projection.supportsFog&&function(e,i){const r=e.context,n=r.gl,o=e.transform,s=new t.DepthMode(n.LEQUAL,t.DepthMode.ReadOnly,[0,1]),a=e.useProgram("globeAtmosphere",null,"globe"===o.projection.name?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),l=t.globeToMercatorTransition(o.zoom),c=i.properties.get("color").toArray01(),u=i.properties.get("high-color").toArray01(),h=i.properties.get("space-color").toArray01PremultipliedAlpha(),d=t.identity$1([]);t.rotateY$1(d,d,-t.degToRad(o._center.lng)),t.rotateX$1(d,d,t.degToRad(o._center.lat)),t.rotateZ$1(d,d,o.angle),t.rotateX$1(d,d,-o._pitch);const p=t.fromQuat(new Float32Array(16),d),f=t.mapValue(i.properties.get("star-intensity"),0,1,0,.25),A=5e-4,m=t.mapValue(i.properties.get("horizon-blend"),0,1,A,.25),g=t.globeUseCustomAntiAliasing(e,r,o)&&m===A?o.worldSize/(2*Math.PI*1.025)-1:o.globeRadius,_=e.frameCounter/1e3%1,y=t.length(o.globeCenterInViewSpace),v=Math.sqrt(Math.pow(y,2)-Math.pow(g,2)),x=Math.acos(v/y),b=((e,i,r,n,o,s,a,l,c,u,h,d,p,f)=>({u_frustum_tl:e,u_frustum_tr:i,u_frustum_br:r,u_frustum_bl:n,u_horizon:o,u_transition:s,u_fadeout_range:a,u_color:l,u_high_color:c,u_space_color:u,u_star_intensity:h,u_star_size:5*t.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:d,u_horizon_angle:p,u_rotation_matrix:f}))(o.frustumCorners.TL,o.frustumCorners.TR,o.frustumCorners.BR,o.frustumCorners.BL,o.frustumCorners.horizon,l,m,c,u,h,f,_,x,p);e.prepareDrawProgram(r,a);const w=e.atmosphereBuffer;w&&a.draw(r,n.TRIANGLES,s,t.StencilMode.disabled,t.ColorMode.alphaBlended,t.CullFaceMode.backCW,b,"skybox",w.vertexBuffer,w.indexBuffer,w.segments)}(this,this.style.fog),this.renderPass="sky",(t.globeToMercatorTransition(this.transform.zoom)>0||"globe"!==this.transform.projection.name)&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<r.length;this.currentLayer++){const t=this.style._layers[r[this.currentLayer]],i=e._getLayerSourceCache(t);t.isSky()&&this.renderLayer(this,i,t,i?s[i.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<r.length;){const t=this.style._layers[r[this.currentLayer]],i=e._getLayerSourceCache(t);if(t.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(t)){if(t.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const n=i?("symbol"===t.type?a:s)[i.id]:void 0;this._renderTileClippingMasks(t,i,i?o[i.id]:void 0),this.renderLayer(this,i,t,n),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let i=null;t.values(this.style._layers).forEach((t=>{const r=e._getLayerSourceCache(t);r&&!t.isHidden(this.transform.zoom)&&(!i||i.getSource().maxzoom<r.getSource().maxzoom)&&(i=r)})),i&&this.options.showTileBoundaries&&zr.debug(this,i,i.getVisibleCoordinates())}this.options.showPadding&&function(t){const e=t.transform.padding;Tr(t,t.transform.height-(e.top||0),3,_r),Tr(t,e.bottom||0,3,yr),Br(t,e.left||0,3,vr),Br(t,t.transform.width-(e.right||0),3,xr);const i=t.transform.centerPoint;!function(t,e,i,r){Er(t,e-1,i-10,2,20,r),Er(t,e-10,i-1,20,2,r)}(t,i.x,t.transform.height-i.y,br)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(t.window.performance.now()),this.saveCanvasCopy())}renderLayer(t,e,i,r){i.isHidden(this.transform.zoom)||("background"===i.type||"sky"===i.type||"custom"===i.type||r&&r.length)&&(this.id=i.id,this.gpuTimingStart(i),(!t.transform.projection.unsupportedLayers||!t.transform.projection.unsupportedLayers.includes(i.type)||t.terrain&&"custom"===i.type)&&zr[i.type](t,e,i,r,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(t){if(!this.options.gpuTiming)return;const e=this.context.extTimerQuery;let i=this.gpuTimers[t.id];i||(i=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:e.createQueryEXT()}),i.calls++,e.beginQueryEXT(e.TIME_ELAPSED_EXT,i.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const t=this.context.extTimerQuery,e=t.createQueryEXT();this.deferredRenderGpuTimeQueries.push(e),t.beginQueryEXT(t.TIME_ELAPSED_EXT,e)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const t=this.context.extTimerQuery;t.endQueryEXT(t.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const t=this.context.extTimerQuery;t.endQueryEXT(t.TIME_ELAPSED_EXT)}collectGpuTimers(){const t=this.gpuTimers;return this.gpuTimers={},t}collectDeferredRenderGpuQueries(){const t=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],t}queryGpuTimers(t){const e={};for(const i in t){const r=t[i],n=this.context.extTimerQuery,o=n.getQueryObjectEXT(r.query,n.QUERY_RESULT_EXT)/1e6;n.deleteQueryEXT(r.query),e[i]=o}return e}queryGpuTimeDeferredRender(t){if(!this.options.gpuTimingDeferredRender)return 0;const e=this.context.extTimerQuery;let i=0;for(const r of t)i+=e.getQueryObjectEXT(r,e.QUERY_RESULT_EXT)/1e6,e.deleteQueryEXT(r);return i}translatePosMatrix(e,i,r,n,o){if(!r[0]&&!r[1])return e;const s=o?"map"===n?this.transform.angle:0:"viewport"===n?-this.transform.angle:0;if(s){const t=Math.sin(s),e=Math.cos(s);r=[r[0]*e-r[1]*t,r[0]*t+r[1]*e]}const a=[o?r[0]:M(i,r[0],this.transform.zoom),o?r[1]:M(i,r[1],this.transform.zoom),0],l=new Float32Array(16);return t.translate(l,e,a),l}saveTileTexture(t){const e=this._tileTextures[t.size[0]];e?e.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const e=this._tileTextures[t];return e&&e.length>0?e.pop():null}isPatternMissing(t){return null===t||void 0!==t&&!this.imageManager.getPattern(t.toString())}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}currentGlobalDefines(){const t=this.terrain&&this.terrain.renderingToTexture,e=this.terrain&&0===this.terrain.exaggeration(),i=this.style&&this.style.fog,r=[];return this.terrainRenderModeElevated()&&r.push("TERRAIN"),"globe"===this.transform.projection.name&&r.push("GLOBE"),e&&r.push("ZERO_EXAGGERATION"),i&&!t&&0!==i.getOpacity(this.transform.pitch)&&r.push("FOG"),t&&r.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&r.push("OVERDRAW_INSPECTOR"),r}useProgram(t,e,i){this.cache=this.cache||{};const r=i||[],n=this.currentGlobalDefines().concat(r),o=ki.cacheKey(ci[t],t,n,e);return this.cache[o]||(this.cache[o]=new ki(this.context,t,ci[t],e,sr[t],n)),this.cache[o]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=t.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new t.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(e,i,r){if(this.terrain&&this.terrain.renderingToTexture)return;const n=this.style.fog;if(n){const o=n.getOpacity(this.transform.pitch),s=((e,i,r,n,o,s,a,l,c,u,h)=>{const d=e.transform,p=i.properties.get("color").toArray01();p[3]=n;const f=e.frameCounter/1e3%1;return{u_fog_matrix:r?d.calculateFogTileMatrix(r):e.identityMat,u_fog_range:i.getFovAdjustedRange(d._fov),u_fog_color:p,u_fog_horizon_blend:i.properties.get("horizon-blend"),u_fog_temporal_offset:f,u_frustum_tl:o,u_frustum_tr:s,u_frustum_br:a,u_frustum_bl:l,u_globe_pos:c,u_globe_radius:u,u_viewport:h,u_globe_transition:t.globeToMercatorTransition(d.zoom),u_is_globe:+("globe"===d.projection.name)}})(this,n,r,o,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*t.exported.devicePixelRatio,this.transform.height*t.exported.devicePixelRatio]);i.setFogUniformValues(e,s)}}setTileLoadedFlag(t){this.tileLoaded=t}saveCanvasCopy(){const t=this.canvasCopy();t&&(this.frameCopies.push(t),this.tileLoaded=!1)}canvasCopy(){const t=this.context.gl,e=t.createTexture();return t.bindTexture(t.TEXTURE_2D,e),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,0,0,t.drawingBufferWidth,t.drawingBufferHeight,0),e}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const t=this.style&&this.style.fog;return!!t&&0!==t.getOpacity(this.transform.pitch)}getBackgroundTiles(){const e=this._backgroundTiles,i=this._backgroundTiles={},r=this.transform.coveringTiles({tileSize:512});for(const n of r)i[n.key]=e[n.key]||new t.Tile(n,512,this.transform.tileZoom,this);return i}clearBackgroundTiles(){this._backgroundTiles={}}}class Dr{constructor(t=0,e=0,i=0,r=0){if(isNaN(t)||t<0||isNaN(e)||e<0||isNaN(i)||i<0||isNaN(r)||r<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=e,this.left=i,this.right=r}interpolate(e,i,r){return null!=i.top&&null!=e.top&&(this.top=t.number(e.top,i.top,r)),null!=i.bottom&&null!=e.bottom&&(this.bottom=t.number(e.bottom,i.bottom,r)),null!=i.left&&null!=e.left&&(this.left=t.number(e.left,i.left,r)),null!=i.right&&null!=e.right&&(this.right=t.number(e.right,i.right,r)),this}getCenter(e,i){const r=t.clamp((this.left+e-this.right)/2,0,e),n=t.clamp((this.top+i-this.bottom)/2,0,i);return new t.Point(r,n)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new Dr(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Rr(e,i){const r=t.getColumn(e,3);t.fromQuat(e,i),t.setColumn(e,3,r)}function Ur(e,i){const r=t.identity$1([]);return t.rotateZ$1(r,r,-i),t.rotateX$1(r,r,-e),r}function Or(e,i){const r=[e[0],e[1],0],n=[i[0],i[1],0];if(t.length(r)>=1e-15){const e=t.normalize([],r);t.scale$2(n,e,t.dot(n,e)),i[0]=n[0],i[1]=n[1]}const o=t.cross([],i,e);if(t.len(o)<1e-15)return null;const s=Math.atan2(-o[1],o[0]);return Ur(Math.atan2(Math.sqrt(e[0]*e[0]+e[1]*e[1]),-e[2]),s)}class Nr{constructor(t,e){this.position=t,this.orientation=e}get position(){return this._position}set position(e){if(e){const i=e instanceof t.MercatorCoordinate?e:new t.MercatorCoordinate(e[0],e[1],e[2]);this._renderWorldCopies&&(i.x=t.wrap(i.x,0,1)),this._position=i}else this._position=null}lookAtPoint(e,i){if(this.orientation=null,!this.position)return;const r=this.position,n=this._elevation?this._elevation.getAtPointOrZero(t.MercatorCoordinate.fromLngLat(e)):0,o=t.MercatorCoordinate.fromLngLat(e,n),s=[o.x-r.x,o.y-r.y,o.z-r.z];i||(i=[0,0,1]),i[2]=Math.abs(i[2]),this.orientation=Or(s,i)}setPitchBearing(e,i){this.orientation=Ur(t.degToRad(e),t.degToRad(-i))}}class Qr{constructor(e,i){this._transform=t.identity([]),this.orientation=i,this.position=e}get mercatorPosition(){const e=this.position;return new t.MercatorCoordinate(e[0],e[1],e[2])}get position(){const e=t.getColumn(this._transform,3);return[e[0],e[1],e[2]]}set position(e){var i;e&&t.setColumn(this._transform,3,[(i=e)[0],i[1],i[2],1])}get orientation(){return this._orientation}set orientation(e){this._orientation=e||t.identity$1([]),e&&Rr(this._transform,this._orientation)}getPitchBearing(){const t=this.forward(),e=this.right();return{bearing:Math.atan2(-e[1],e[0]),pitch:Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2])}}setPitchBearing(t,e){this._orientation=Ur(t,e),Rr(this._transform,this._orientation)}forward(){const e=t.getColumn(this._transform,2);return[-e[0],-e[1],-e[2]]}up(){const e=t.getColumn(this._transform,1);return[-e[0],-e[1],-e[2]]}right(){const e=t.getColumn(this._transform,0);return[e[0],e[1],e[2]]}getCameraToWorld(e,i){const r=new Float64Array(16);return t.invert(r,this.getWorldToCamera(e,i)),r}getWorldToCameraPosition(e,i,r){const n=this.position;t.scale$2(n,n,-e);const o=new Float64Array(16);return t.fromScaling(o,[r,r,r]),t.translate(o,o,n),o[10]*=i,o}getWorldToCamera(e,i){const r=new Float64Array(16),n=new Float64Array(4),o=this.position;return t.conjugate(n,this._orientation),t.scale$2(o,o,-e),t.fromQuat(r,n),t.translate(r,r,o),r[1]*=-1,r[5]*=-1,r[9]*=-1,r[13]*=-1,r[8]*=i,r[9]*=i,r[10]*=i,r[11]*=i,r}getCameraToClipPerspective(e,i,r,n){const o=new Float64Array(16);return t.perspective(o,e,i,r,n),o}getDistanceToElevation(e,i=!1){const r=0===e?0:t.mercatorZfromAltitude(e,i?t.latFromMercatorY(this.position[1]):this.position[1]),n=this.forward();return(r-this.position[2])/n[2]}clone(){return new Qr([...this.position],[...this.orientation])}}function Vr(e,i){const r=Hr(e.projection,e.zoom,e.width,e.height),n=function(e,i,r,n,o){const s=new t.LngLat(r.lng-180*Gr,r.lat),a=new t.LngLat(r.lng+180*Gr,r.lat),l=e.project(s.lng,s.lat),c=e.project(a.lng,a.lat),u=-Math.atan2(c.y-l.y,c.x-l.x),h=t.MercatorCoordinate.fromLngLat(r);h.y=t.clamp(h.y,-1+Gr,1-Gr);const d=h.toLngLat(),p=e.project(d.lng,d.lat),f=t.MercatorCoordinate.fromLngLat(d);f.x+=Gr;const A=f.toLngLat(),m=e.project(A.lng,A.lat),g=Zr(m.x-p.x,m.y-p.y,u),_=t.MercatorCoordinate.fromLngLat(d);_.y+=Gr;const y=_.toLngLat(),v=e.project(y.lng,y.lat),x=Zr(v.x-p.x,v.y-p.y,u),b=Math.abs(g.x)/Math.abs(x.y),w=t.identity([]);t.rotateZ(w,w,-u*(1-(o?0:n)));const T=t.identity([]);return t.scale(T,T,[1,1-(1-b)*n,1]),T[4]=-x.x/x.y*n,t.rotateZ(T,T,u),t.multiply(T,w,T),T}(e.projection,0,e.center,r,i),o=jr(e);return t.scale(n,n,[o,o,1]),n}function jr(e){const i=e.projection,r=Hr(e.projection,e.zoom,e.width,e.height),n=$r(i,e.center),o=$r(i,t.LngLat.convert(i.center));return Math.pow(2,n*r+(1-r)*o)}function Hr(e,i,r,n,o=1/0){const s=e.range;if(!s)return 0;const a=Math.min(o,Math.max(r,n)),l=Math.log(a/1024)/Math.LN2;return t.smoothstep(s[0]+l,s[1]+l,i)}const Gr=1/4e4;function $r(e,i){const r=t.clamp(i.lat,-t.MAX_MERCATOR_LATITUDE,t.MAX_MERCATOR_LATITUDE),n=new t.LngLat(i.lng-180*Gr,r),o=new t.LngLat(i.lng+180*Gr,r),s=e.project(n.lng,r),a=e.project(o.lng,r),l=t.MercatorCoordinate.fromLngLat(n),c=t.MercatorCoordinate.fromLngLat(o),u=a.x-s.x,h=a.y-s.y,d=c.x-l.x,p=c.y-l.y,f=Math.sqrt((d*d+p*p)/(u*u+h*h));return Math.log(f)/Math.LN2}function Zr(t,e,i){const r=Math.cos(i),n=Math.sin(i);return{x:t*r-e*n,y:t*n+e*r}}class qr{constructor(e,i,r,n,o,s,a){this.tileSize=512,this._renderWorldCopies=void 0===o||o,this._minZoom=e||0,this._maxZoom=i||22,this._minPitch=null==r?0:r,this._maxPitch=null==n?60:n,this.setProjection(s),this.setMaxBounds(a),this.width=0,this.height=0,this._center=new t.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Dr,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new Qr,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const t=new qr(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return t._elevation=this._elevation,t._centerAltitude=this._centerAltitude,t._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,t.tileSize=this.tileSize,t.mercatorFromTransition=this.mercatorFromTransition,t.width=this.width,t.height=this.height,t.cameraElevationReference=this.cameraElevationReference,t._center=this._center,t._setZoom(this.zoom),t._seaLevelZoom=this._seaLevelZoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._nearZ=this._nearZ,t._farZ=this._farZ,t._averageElevation=this._averageElevation,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._camera=this._camera.clone(),t._calcMatrices(),t.freezeTileCoverage=this.freezeTileCoverage,t.frustumCorners=this.frustumCorners,t}get elevation(){return this._elevation}set elevation(t){this._elevation!==t&&(this._elevation=t,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(t,e=!1){const i=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(null==this._seaLevelZoom||i)&&this._updateCameraOnTerrain(),(t||i)&&this._constrainCamera(e),this._calcMatrices()}getProjection(){return t.pick(this.projection,["name","center","parallels"])}setProjection(i){this.projectionOptions=i||{name:"mercator"};const r=this.projection?this.getProjection():void 0;this.projection=t.getProjection(this.projectionOptions);const n=!e(r,this.getProjection());return n&&this._calcMatrices(),this.mercatorFromTransition=!1,n}setMercatorFromTransition(){const e=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=t.getProjection({name:"mercator"});const i=e!==this.projection.name;return i&&this._calcMatrices(),i}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(t){void 0===t?t=!0:null===t&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get cameraWorldSize(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return t.mercatorZfromAltitude(this.center.lat,this.cameraWorldSizeForFog)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new t.Point(this.width,this.height)}get bearing(){return t.wrap(this.rotation,-180,180)}set bearing(t){this.rotation=t}get rotation(){return-this.angle/Math.PI*180}set rotation(e){const i=-e*Math.PI/180;var r;this.angle!==i&&(this._unmodified=!1,this.angle=i,this._calcMatrices(),this.rotationMatrix=(r=new t.ARRAY_TYPE(4),t.ARRAY_TYPE!=Float32Array&&(r[1]=0,r[2]=0),r[0]=1,r[3]=1,r),function(t,e,i){var r=e[0],n=e[1],o=e[2],s=e[3],a=Math.sin(i),l=Math.cos(i);t[0]=r*l+o*a,t[1]=n*l+s*a,t[2]=r*-a+o*l,t[3]=n*-a+s*l}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(e){const i=t.clamp(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==i&&(this._unmodified=!1,this._pitch=i,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const t=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/t)}set fov(e){e=Math.max(.01,Math.min(60,e)),this._fov!==e&&(this._unmodified=!1,this._fov=t.degToRad(e),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(t){this._averageElevation=t,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(t){const e=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==e&&(this._unmodified=!1,this._setZoom(e),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(t){this._zoom=t,this.scale=this.zoomScale(t),this.tileZoom=Math.floor(t),this.zoomFraction=t-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const t=this._elevation;this._centerAltitude=t.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=t.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){void 0!==this._centerAltitudeValidForExaggeration&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const e=this._elevation,i=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],r=this.horizonLineFromTop();let n=0,o=0;for(let s=0;s<i.length;s++){const a=new t.Point(i[s][0]*this.width,r+i[s][1]*(this.height-r)),l=e.pointCoordinate(a);if(!l)continue;const c=1/Math.hypot(l[0]-this._camera.position[0],l[1]-this._camera.position[1]);n+=l[3]*c,o+=c}return 0===o?NaN:n/o}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._seaLevelZoom||!this._elevation)return;const t=this._seaLevelZoom,e=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),i=this.pixelsPerMeter/this.worldSize*e,r=this._mercatorZfromZoom(t),n=this._mercatorZfromZoom(this._maxZoom),o=Math.max(r-i,n);this._setZoom(this._zoomFromMercatorZ(o))}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}computeZoomRelativeTo(e){const i=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,e.toAltitude()));let r;r=e.z<this._camera.position[2]?[i.x,i.y,i.z]:[e.x,e.y,e.z];const n=t.length(t.sub([],this._camera.position,r));return t.clamp(this._zoomFromMercatorZ(n),this._minZoom,this._maxZoom)}setFreeCameraOptions(e){if(!this.height)return;if(!e.position&&!e.orientation)return;this._updateCameraState();let i=!1;if(e.orientation&&!t.exactEquals(e.orientation,this._camera.orientation)&&(i=this._setCameraOrientation(e.orientation)),e.position){const r=[e.position.x,e.position.y,e.position.z];t.exactEquals$1(r,this._camera.position)||(this._setCameraPosition(r),i=!0)}i&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const e=this._camera.position,i=new Nr;return i.position=new t.MercatorCoordinate(e[0],e[1],e[2]),i.orientation=this._camera.orientation,i._elevation=this.elevation,i._renderWorldCopies=this.renderWorldCopies,i}_setCameraOrientation(e){if(!t.length$1(e))return!1;t.normalize$1(e,e);const i=t.transformQuat([],[0,0,-1],e),r=t.transformQuat([],[0,-1,0],e);if(r[2]<0)return!1;const n=Or(i,r);return!!n&&(this._camera.orientation=n,!0)}_setCameraPosition(e){const i=this.zoomScale(this.minZoom)*this.tileSize,r=this.zoomScale(this.maxZoom)*this.tileSize,n=this.cameraToCenterDistance;e[2]=t.clamp(e[2],n/r,n/i),this._camera.position=e}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,e,i){this._unmodified=!1,this._edgeInsets.interpolate(t,e,i),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const e=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,e)}getVisibleUnwrappedCoordinates(e){const i=[new t.UnwrappedTileID(0,e)];if(this.renderWorldCopies){const r=this.pointCoordinate(new t.Point(0,0)),n=this.pointCoordinate(new t.Point(this.width,0)),o=this.pointCoordinate(new t.Point(this.width,this.height)),s=this.pointCoordinate(new t.Point(0,this.height)),a=Math.floor(Math.min(r.x,n.x,o.x,s.x)),l=Math.floor(Math.max(r.x,n.x,o.x,s.x)),c=1;for(let r=a-c;r<=l+c;r++)0!==r&&i.push(new t.UnwrappedTileID(r,e))}return i}coveringTiles(e){let i=this.coveringZoomLevel(e);const r=i,n=this.elevation&&!e.isTerrainDEM,o="mercator"===this.projection.name;if(void 0!==e.minzoom&&i<e.minzoom)return[];void 0!==e.maxzoom&&i>e.maxzoom&&(i=e.maxzoom);const s=this.locationCoordinate(this.center),a=this.center.lat,l=1<<i,c=[l*s.x,l*s.y,0],u="globe"===this.projection.name,h=!u,d=t.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,i,h),p=u?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),f=l*t.mercatorZfromAltitude(1,this.center.lat),A=this._camera.position[2]/t.mercatorZfromAltitude(1,this.center.lat),m=[l*p.x,l*p.y,A*(h?1:f)],g=this.cameraToCenterDistance/e.tileSize*(e.roundZoom?1:.502),_=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?i:0,y=e.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,v=e.isTerrainDEM?-y:this._elevation?this._elevation.getMinElevationBelowMSL():0,x=this.projection.isReprojectedInTileSpace?jr(this):1,b=e=>{const i=1/4e4,r=new t.MercatorCoordinate(e.x+i,e.y,e.z),n=new t.MercatorCoordinate(e.x,e.y+i,e.z),o=e.toLngLat(),s=r.toLngLat(),a=n.toLngLat(),l=this.locationCoordinate(o),c=this.locationCoordinate(s),u=this.locationCoordinate(a),h=Math.hypot(c.x-l.x,c.y-l.y),d=Math.hypot(u.x-l.x,u.y-l.y);return Math.sqrt(h*d)*x/i},w=e=>{const i=y,r=v;return{aabb:t.tileAABB(this,l,0,0,0,e,r,i,this.projection),zoom:0,x:0,y:0,minZ:r,maxZ:i,wrap:e,fullyVisible:!1}},T=[];let B=[];const E=i,C=e.reparseOverscaled?r:i,S=t=>t*t,I=S((A-this._centerAltitude)*f),M=t=>{if(!this._elevation||!t.tileID||!o)return;const e=this._elevation.getMinMaxForTile(t.tileID),i=t.aabb;e?(i.min[2]=e.min,i.max[2]=e.max,i.center[2]=(i.min[2]+i.max[2])/2):(t.shouldSplit=k(t),t.shouldSplit||(i.min[2]=i.max[2]=i.center[2]=this._centerAltitude))},k=e=>{if(e.zoom<_)return!0;if(e.zoom===E)return!1;if(null!=e.shouldSplit)return e.shouldSplit;const i=e.aabb.distanceX(m),o=e.aabb.distanceY(m);let s=I,l=1;if(u){s=S(e.aabb.distanceZ(m));const i=Math.pow(2,e.zoom),r=t.latFromMercatorY((e.y+1)/i),n=t.latFromMercatorY(e.y/i),o=Math.min(Math.max(a,r),n),c=t.circumferenceAtLatitude(o)/t.circumferenceAtLatitude(a);if(l=o===a?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,c/this._mercatorScaleRatio),this.zoom<=t.GLOBE_ZOOM_THRESHOLD_MIN&&e.zoom===E-1&&c>=.9)return!0}else if(n&&(s=S(e.aabb.distanceZ(m)*f)),this.projection.isReprojectedInTileSpace&&r<=5){const i=Math.pow(2,e.zoom),r=b(new t.MercatorCoordinate((e.x+.5)/i,(e.y+.5)/i));l=r>.85?1:r}const c=i*i+o*o+s,h=S((1<<E-e.zoom)*g*l*((t,e)=>{if(e*S(.707)<t)return 1;const i=Math.sqrt(e/t);return i/(1.4144271570014144+(Math.pow(1.1,i-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(s,I),c));return c<h};if(this.renderWorldCopies)for(let t=1;t<=3;t++)T.push(w(-t)),T.push(w(t));for(T.push(w(0));T.length>0;){const r=T.pop(),s=r.x,a=r.y;let h=r.fullyVisible;if(!h){const t=r.aabb.intersects(d);if(0===t)continue;h=2===t}if(r.zoom!==E&&k(r))for(let e=0;e<4;e++){const i=(s<<1)+e%2,c=(a<<1)+(e>>1),d={aabb:o?r.aabb.quadrant(e):t.tileAABB(this,l,r.zoom+1,i,c,r.wrap,r.minZ,r.maxZ,this.projection),zoom:r.zoom+1,x:i,y:c,wrap:r.wrap,fullyVisible:h,tileID:void 0,shouldSplit:void 0,minZ:r.minZ,maxZ:r.maxZ};n&&!u&&(d.tileID=new t.OverscaledTileID(r.zoom+1===E?C:r.zoom+1,r.wrap,r.zoom+1,i,c),M(d)),T.push(d)}else{const n=r.zoom===E?C:r.zoom;if(e.minzoom&&e.minzoom>n)continue;const o=c[0]-(.5+s+(r.wrap<<r.zoom))*(1<<i-r.zoom),l=c[1]-.5-a,u=r.tileID?r.tileID:new t.OverscaledTileID(n,r.wrap,r.zoom,s,a);B.push({tileID:u,distanceSq:o*o+l*l})}}if(this.fogCullDistSq){const i=this.fogCullDistSq,r=this.horizonLineFromTop();B=B.filter((n=>{const o=[0,0,0,1],s=[t.EXTENT,t.EXTENT,0,1],a=this.calculateFogTileMatrix(n.tileID.toUnwrapped());t.transformMat4$1(o,o,a),t.transformMat4$1(s,s,a);const l=t.getAABBPointSquareDist(o,s);if(0===l)return!0;let c=!1;const u=this._elevation;if(u&&l>i&&0!==r){const i=this.calculateProjMatrix(n.tileID.toUnwrapped());let o;e.isTerrainDEM||(o=u.getMinMaxForTile(n.tileID)),o||(o={min:v,max:y});const s=t.furthestTileCorner(this.rotation),a=[s[0]*t.EXTENT,s[1]*t.EXTENT,o.max];t.transformMat4(a,a,i),c=(1-a[1])*this.height*.5<r}return l<i||c}))}return B.sort(((t,e)=>t.distanceSq-e.distanceSq)).map((t=>t.tileID))}resize(t,e){this.width=t,this.height=e,this.pixelsToGLUnits=[2/t,-2/e],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(e){const i=t.clamp(e.lat,-t.MAX_MERCATOR_LATITUDE,t.MAX_MERCATOR_LATITUDE),r=this.projection.project(e.lng,i);return new t.Point(r.x*this.worldSize,r.y*this.worldSize)}unproject(t){return this.projection.unproject(t.x/this.worldSize,t.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/t.mercatorZfromAltitude(1,this.center.lat)/this.worldSize}setLocationAtPoint(e,i){let r,n;const o=this.centerPoint;if("globe"===this.projection.name){const t=this.worldSize;r=(i.x-o.x)/t,n=(i.y-o.y)/t}else{const t=this.pointCoordinate(i),e=this.pointCoordinate(o);r=t.x-e.x,n=t.y-e.y}const s=this.locationCoordinate(e);this.setLocation(new t.MercatorCoordinate(s.x-r,s.y-n))}setLocation(t){this.center=this.coordinateLocation(t),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(t){return this.projection.locationPoint(this,t)}locationPoint3D(t){return this.projection.locationPoint(this,t,!0)}pointLocation(t){return this.coordinateLocation(this.pointCoordinate(t))}pointLocation3D(t){return this.coordinateLocation(this.pointCoordinate3D(t))}locationCoordinate(e,i){const r=i?t.mercatorZfromAltitude(i,e.lat):void 0,n=this.projection.project(e.lng,e.lat);return new t.MercatorCoordinate(n.x,n.y,r)}coordinateLocation(t){return this.projection.unproject(t.x,t.y)}pointRayIntersection(e,i){const r=null!=i?i:this._centerAltitude,n=[e.x,e.y,0,1],o=[e.x,e.y,1,1];t.transformMat4$1(n,n,this.pixelMatrixInverse),t.transformMat4$1(o,o,this.pixelMatrixInverse);const s=o[3];t.scale$1(n,n,1/n[3]),t.scale$1(o,o,1/s);const a=n[2],l=o[2];return{p0:n,p1:o,t:a===l?0:(r-a)/(l-a)}}screenPointToMercatorRay(e){const i=[e.x,e.y,0,1],r=[e.x,e.y,1,1];return t.transformMat4$1(i,i,this.pixelMatrixInverse),t.transformMat4$1(r,r,this.pixelMatrixInverse),t.scale$1(i,i,1/i[3]),t.scale$1(r,r,1/r[3]),i[2]=t.mercatorZfromAltitude(i[2],this._center.lat)*this.worldSize,r[2]=t.mercatorZfromAltitude(r[2],this._center.lat)*this.worldSize,t.scale$1(i,i,1/this.worldSize),t.scale$1(r,r,1/this.worldSize),new t.Ray([i[0],i[1],i[2]],t.normalize([],t.sub([],r,i)))}rayIntersectionCoordinate(e){const{p0:i,p1:r,t:n}=e,o=t.mercatorZfromAltitude(i[2],this._center.lat),s=t.mercatorZfromAltitude(r[2],this._center.lat);return new t.MercatorCoordinate(t.number(i[0],r[0],n)/this.worldSize,t.number(i[1],r[1],n)/this.worldSize,t.number(o,s,n))}pointCoordinate(t,e=this._centerAltitude){return this.projection.pointCoordinate(this,t.x,t.y,e)}pointCoordinate3D(e){if(!this.elevation)return this.pointCoordinate(e);let i=this.projection.pointCoordinate3D(this,e.x,e.y);if(i)return new t.MercatorCoordinate(i[0],i[1],i[2]);let r=0,n=this.horizonLineFromTop();if(e.y>n)return this.pointCoordinate(e);const o=.02*n,s=e.clone();for(let e=0;e<10&&n-r>o;e++){s.y=t.number(r,n,.66);const e=this.projection.pointCoordinate3D(this,s.x,s.y);e?(n=s.y,i=e):r=s.y}return i?new t.MercatorCoordinate(i[0],i[1],i[2]):this.pointCoordinate(e)}isPointAboveHorizon(t){return this.projection.isPointAboveHorizon(this,t)}isPointOnSurface(e){if(e.y<0||e.y>this.height||e.x<0||e.x>this.width)return!1;if(this.elevation||this.zoom>=t.GLOBE_ZOOM_THRESHOLD_MAX)return!this.isPointAboveHorizon(e);const i=this.pointCoordinate(e);return i.y>=0&&i.y<=1}_coordinatePoint(e,i){const r=i&&this.elevation?this.elevation.getAtPointOrZero(e,this._centerAltitude):this._centerAltitude,n=[e.x*this.worldSize,e.y*this.worldSize,r+e.toAltitude(),1];return t.transformMat4$1(n,n,this.pixelMatrix),n[3]>0?new t.Point(n[0]/n[3],n[1]/n[3]):new t.Point(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:e,left:i}=this._edgeInsets,r=this.height-this._edgeInsets.bottom,n=this.width-this._edgeInsets.right,o=this.pointLocation3D(new t.Point(i,e)),s=this.pointLocation3D(new t.Point(n,e)),a=this.pointLocation3D(new t.Point(n,r)),l=this.pointLocation3D(new t.Point(i,r));let c=Math.min(o.lng,s.lng,a.lng,l.lng),u=Math.max(o.lng,s.lng,a.lng,l.lng),h=Math.min(o.lat,s.lat,a.lat,l.lat),d=Math.max(o.lat,s.lat,a.lat,l.lat);const p=Math.pow(2,-this.zoom)/16*270,f="globe"===this.projection.name?1:4,A=(e,i,r,n,o)=>{const s=(e+r)/2,a=(i+n)/2,l=new t.Point(s,a),{lng:m,lat:g}=this.pointLocation3D(l),_=Math.max(0,c-m,h-g,m-u,g-d);c=Math.min(c,m),u=Math.max(u,m),h=Math.min(h,g),d=Math.max(d,g),(o<f||_>p)&&(A(e,i,s,a,o+1),A(s,a,r,n,o+1))};if(A(i,e,n,e,1),A(n,e,n,r,1),A(n,r,i,r,1),A(i,r,i,e,1),"globe"===this.projection.name){const[e,i]=t.polesInViewport(this);e?(d=90,u=180,c=-180):i&&(h=-90,u=180,c=-180)}return new t.LngLatBounds(new t.LngLat(c,h),new t.LngLat(u,d))}_getBoundsRectangular(e,i){const{top:r,left:n}=this._edgeInsets,o=this.height-this._edgeInsets.bottom,s=this.width-this._edgeInsets.right,a=new t.Point(n,r),l=new t.Point(s,r),c=new t.Point(s,o),u=new t.Point(n,o);let h=this.pointCoordinate(a,e),d=this.pointCoordinate(l,e);const p=this.pointCoordinate(c,i),f=this.pointCoordinate(u,i),A=(t,e)=>(e.y-t.y)/(e.x-t.x);return h.y>1&&d.y>=0?h=new t.MercatorCoordinate((1-f.y)/A(f,h)+f.x,1):h.y<0&&d.y<=1&&(h=new t.MercatorCoordinate(-f.y/A(f,h)+f.x,0)),d.y>1&&h.y>=0?d=new t.MercatorCoordinate((1-p.y)/A(p,d)+p.x,1):d.y<0&&h.y<=1&&(d=new t.MercatorCoordinate(-p.y/A(p,d)+p.x,0)),(new t.LngLatBounds).extend(this.coordinateLocation(h)).extend(this.coordinateLocation(d)).extend(this.coordinateLocation(f)).extend(this.coordinateLocation(p))}_getBoundsRectangularTerrain(){const t=this.elevation;if(!t.visibleDemTiles.length||t.isUsingMockSource())return this._getBoundsRectangular(0,0);const e=t.visibleDemTiles.reduce(((t,e)=>{if(e.dem){const i=e.dem.tree;t.min=Math.min(t.min,i.minimums[0]),t.max=Math.max(t.max,i.maximums[0])}return t}),{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(e.min*t.exaggeration(),e.max*t.exaggeration())}getBounds(){return"mercator"===this.projection.name||"equirectangular"===this.projection.name?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(t=!0){const e=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,i=this.height/2-e*(1-this._horizonShift);return t?Math.max(0,i):i}getMaxBounds(){return this.maxBounds}setMaxBounds(e){this.maxBounds=e,this.minLat=-t.MAX_MERCATOR_LATITUDE,this.maxLat=t.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,e&&(this.minLat=e.getSouth(),this.maxLat=e.getNorth(),this.minLng=e.getWest(),this.maxLng=e.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=t.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=t.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=t.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=t.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(t,e){return this.projection.createTileMatrix(this,e,t)}calculateDistanceTileData(e){const i=e.key,r=this._distanceTileDataCache;if(r[i])return r[i];const n=e.canonical,o=1/this.height,s=this.cameraWorldSize,a=s/this.zoomScale(n.z),l=(n.x+Math.pow(2,n.z)*e.wrap)*a,c=n.y*a,u=this.point;u.x*=s/this.worldSize,u.y*=s/this.worldSize;const h=this.angle,d=Math.sin(-h),p=-Math.cos(-h);return r[i]={bearing:[d,p],center:[(u.x-l)*o,(u.y-c)*o],scale:a/t.EXTENT*o},r[i]}calculateFogTileMatrix(e){const i=e.key,r=this._fogTileMatrixCache;if(r[i])return r[i];const n=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,e);return t.multiply(n,this.worldToFogMatrix,n),r[i]=new Float32Array(n),r[i]}calculateProjMatrix(e,i=!1){const r=e.key,n=i?this._alignedProjMatrixCache:this._projMatrixCache;if(n[r])return n[r];const o=this.calculatePosMatrix(e,this.worldSize);return t.multiply(o,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:i?this.alignedProjMatrix:this.projMatrix,o),n[r]=new Float32Array(o),n[r]}calculatePixelsToTileUnitsMatrix(e){const i=e.tileID.key,r=this._pixelsToTileUnitsCache;if(r[i])return r[i];const n=function(e,i){const{scale:r}=e.tileTransform,n=r*t.EXTENT/(e.tileSize*Math.pow(2,i.zoom-e.tileID.overscaledZ+e.tileID.canonical.z));return o=new Float32Array(4),l=(s=i.inverseAdjustmentMatrix)[1],c=s[2],u=s[3],d=(a=[n,n])[1],o[0]=s[0]*(h=a[0]),o[1]=l*h,o[2]=c*d,o[3]=u*d,o;var o,s,a,l,c,u,h,d}(e,this);return r[i]=n,r[i]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if("globe"===this.projection.name){const e=1/this.worldSize,i=t.fromScaling([],[e,e,e]);return t.multiply(i,i,this.globeMatrix),i}}recenterOnTerrain(){if(!this._elevation||"globe"===this.projection.name)return;const e=this._elevation;this._updateCameraState();const i=t.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,r=this._computeCameraPosition(i),n=this._camera.forward(),o=t.mercatorZfromAltitude(1,this._center.lat);r[2]/=o,n[2]/=o,t.normalize(n,n);const s=e.raycast(r,n,e.exaggeration());if(s){const e=t.scaleAndAdd([],r,n,s),i=new t.MercatorCoordinate(e[0],e[1],t.mercatorZfromAltitude(e[2],t.latFromMercatorY(e[1]))),a=(i.z+t.length([i.x-r[0],i.y-r[1],i.z-r[2]*o]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(a),this._centerAltitude=i.toAltitude(),this._center=this.coordinateLocation(i),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(e=!1){if(!this._elevation)return;const i=this._elevation,r=t.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,n=this._computeCameraPosition(r),o=i.getAtPointOrZero(new t.MercatorCoordinate(...n)),s=this.pixelsPerMeter/this.worldSize*o,a=this._minimumHeightOverTerrain(),l=n[2]-s;if(l<=a)if(l<0||e){const e=this.locationCoordinate(this._center,this._centerAltitude),i=[n[0],n[1],e.z-n[2]],r=t.length(i);i[2]-=(a-l)/this._pixelsPerMercatorPixel;const o=t.length(i);if(0===o)return;t.scale$2(i,i,r/o*this._pixelsPerMercatorPixel),this._camera.position=[n[0],n[1],e.z*this._pixelsPerMercatorPixel-i[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const e="globe"===this.projection.name||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||e){const i=this.center;return i.lat=t.clamp(i.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!e)&&(i.lng=t.clamp(i.lng,this.minLng,this.maxLng)),this.center=i,void(this._constraining=!1)}const i=this._unmodified,{x:r,y:n}=this.point;let o=0,s=r,a=n;const l=this.width/2,c=this.height/2,u=this.worldMinY*this.scale,h=this.worldMaxY*this.scale;if(n-c<u&&(a=u+c),n+c>h&&(a=h-c),h-u<this.height&&(o=Math.max(o,this.height/(h-u)),a=(h+u)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const t=this.worldMinX*this.scale,e=this.worldMaxX*this.scale,i=this.worldSize/2-(t+e)/2;s=(r+i+this.worldSize)%this.worldSize-i,s-l<t&&(s=t+l),s+l>e&&(s=e-l),e-t<this.width&&(o=Math.max(o,this.width/(e-t)),s=(e+t)/2)}s===r&&a===n||(this.center=this.unproject(new t.Point(s,a))),o&&(this.zoom+=this.scaleZoom(o)),this._constrainCamera(),this._unmodified=i,this._constraining=!1}_minZoomForBounds(){let t=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(t=Math.max(t,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),t}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const e=this.centerOffset,i=this.pixelsPerMeter;"globe"===this.projection.name&&(this._mercatorScaleRatio=t.mercatorZfromAltitude(1,this.center.lat)/t.mercatorZfromAltitude(1,t.GLOBE_SCALE_MATCH_LATITUDE));const r=Hr(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,r),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const n="meters"===this.projection.zAxisUnit?i:1,o=this._camera.getWorldToCamera(this.worldSize,n),s=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);s[8]=2*-e.x/this.width,s[9]=2*e.y/this.height;let a=t.mul([],s,o);if(this.projection.isReprojectedInTileSpace){const e=this.locationCoordinate(this.center),i=t.identity([]);t.translate(i,i,[e.x*this.worldSize,e.y*this.worldSize,0]),t.multiply(i,i,Vr(this)),t.translate(i,i,[-e.x*this.worldSize,-e.y*this.worldSize,0]),t.multiply(a,a,i),this.inverseAdjustmentMatrix=function(t){const e=Vr(t,!0);return _([],[e[0],e[1],e[4],e[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=t.scale([],a,[this.worldSize,this.worldSize,this.worldSize/n,1]),this.projMatrix=a,this.invProjMatrix=t.invert(new Float64Array(16),this.projMatrix);const l=t.invert([],s);this.frustumCorners=t.FrustumCorners.fromInvProjectionMatrix(l,this.horizonLineFromTop(),this.height);const c=new Float32Array(16);t.identity(c),t.scale(c,c,[1,-1,1]),t.rotateX(c,c,this._pitch),t.rotateZ(c,c,this.angle);const u=t.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),h=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;u[8]=2*-e.x/this.width,u[9]=2*(e.y+h)/this.height,this.skyboxMatrix=t.multiply(c,u,c);const d=this.point,p=d.x,f=d.y,A=this.width%2/2,m=this.height%2/2,g=Math.cos(this.angle),y=Math.sin(this.angle),v=p-Math.round(p)+g*A+y*m,x=f-Math.round(f)+g*m+y*A,b=new Float64Array(a);if(t.translate(b,b,[v>.5?v-1:v,x>.5?x-1:x,0]),this.alignedProjMatrix=b,a=t.create(),t.scale(a,a,[this.width/2,-this.height/2,1]),t.translate(a,a,[1,-1,0]),this.labelPlaneMatrix=a,a=t.create(),t.scale(a,a,[1,-1,1]),t.translate(a,a,[-1,-1,0]),t.scale(a,a,[2/this.width,2/this.height,1]),this.glCoordMatrix=a,this.pixelMatrix=t.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},a=t.invert(new Float64Array(16),this.pixelMatrix),!a)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=a,"globe"===this.projection.name||this.mercatorFromTransition){this.globeMatrix=t.calculateGlobeMatrix(this);const e=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=t.transformMat4(e,e,o),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=a;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const e=this.cameraWorldSizeForFog,i=this.cameraPixelsPerMeter,r=this._camera.position,n=1/this.height/this._pixelsPerMercatorPixel,o=[e,e,i];t.scale$2(o,o,n),t.scale$2(r,r,-1),t.multiply$2(r,r,o);const s=t.create();t.translate(s,s,r),t.scale(s,s,o),this.mercatorFogMatrix=s,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(e,i,n)}_computeCameraPosition(t){const e=(t=t||this.pixelsPerMeter)/this.pixelsPerMeter,i=this._camera.forward(),r=this.point,n=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*e-t/this.worldSize*this._centerAltitude;return[r.x/this.worldSize-i[0]*n,r.y/this.worldSize-i[1]*n,t/this.worldSize*this._centerAltitude-i[2]*n]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(e){const i=this._maxCameraBoundsDistance()*Math.cos(this._pitch),r=this._camera.position[2],n=e[2];let o=1;this.projection.wrap&&(this.center=this.center.wrap()),n>0&&(o=Math.min((i-r)/n,1)),this._camera.position=t.scaleAndAdd([],this._camera.position,e,o),this._updateStateFromCamera()}_updateStateFromCamera(){const e=this._camera.position,i=this._camera.forward(),{pitch:r,bearing:n}=this._camera.getPitchBearing(),o=t.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,s=this._mercatorZfromZoom(this._maxZoom)*Math.cos(t.degToRad(this._maxPitch)),a=Math.max((e[2]-o)/Math.cos(r),s),l=this._zoomFromMercatorZ(a);t.scaleAndAdd(e,e,i,a),this._pitch=t.clamp(r,t.degToRad(this.minPitch),t.degToRad(this.maxPitch)),this.angle=t.wrap(n,-Math.PI,Math.PI),this._setZoom(t.clamp(l,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new t.MercatorCoordinate(e[0],e[1],e[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(t){return Math.pow(2,t)*this.tileSize}_mercatorZfromZoom(t){return this.cameraToCenterDistance/this._worldSizeFromZoom(t)}_minimumHeightOverTerrain(){const t=Math.min((null!=this._seaLevelZoom?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(t)}_zoomFromMercatorZ(t){return this.scaleZoom(this.cameraToCenterDistance/(t*this.tileSize))}zoomFromMercatorZAdjusted(e){let i=0,r=t.GLOBE_ZOOM_THRESHOLD_MAX,n=0,o=1/0;for(;r-i>1e-6&&r>i;){const t=i+.5*(r-i),s=this.tileSize*Math.pow(2,t),a=this.getCameraToCenterDistance(this.projection,t,s),l=this.scaleZoom(a/(e*this.tileSize)),c=Math.abs(t-l);c<o&&(o=c,n=t),t<l?i=t:r=t}return n}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(t.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(e,i){const r=Math.min(e.x,i.x),n=Math.max(e.x,i.x),o=Math.min(e.y,i.y),s=Math.max(e.y,i.y);if(o<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const a=[new t.Point(r,o),new t.Point(n,s),new t.Point(r,s),new t.Point(n,o)],l=this.renderWorldCopies?-3:0,c=this.renderWorldCopies?4:1;for(const t of a){const e=this.pointRayIntersection(t);if(e.t<0)return!0;const i=this.rayIntersectionCoordinate(e);if(i.x<l||i.y<0||i.x>c||i.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+t.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new t.Point(0,0),new t.Point(this.width,this.height))}zoomDeltaToMovement(e,i){const r=t.length(t.sub([],this._camera.position,e)),n=this._zoomFromMercatorZ(r)+i;return r-this._mercatorZfromZoom(n)}getCameraPoint(){if("globe"===this.projection.name){const e=function([e,i,r],n){const o=[e,i,r,1];t.transformMat4$1(o,o,n);const s=o[3]=Math.max(o[3],1e-6);return o[0]/=s,o[1]/=s,o[2]/=s,o}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new t.Point(e[0],e[1])}{const e=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new t.Point(0,e))}}getCameraToCenterDistance(t,e=this.zoom,i=this.worldSize){const r=Hr(t,e,this.width,this.height,1024),n=t.pixelSpaceConversion(this.center.lat,i,r);return.5/Math.tan(.5*this._fov)*this.height*n}getWorldToCameraMatrix(){const e=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?this.pixelsPerMeter:1);return"globe"===this.projection.name&&t.multiply(e,e,this.globeMatrix),e}}function Kr(t,e){let i=!1,r=null;const n=()=>{r=null,i&&(t(),r=setTimeout(n,e),i=!1)};return()=>(i=!0,r||n(),r)}class Wr{constructor(e){this._hashName=e&&encodeURIComponent(e),t.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Kr(this._updateHashUnthrottled.bind(this),300)}addTo(e){return this._map=e,t.window.addEventListener("hashchange",this._onHashChange,!1),e.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),t.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const e=this._map;if(!e)return"";const i=Xr(e);if(this._hashName){const e=this._hashName;let r=!1;const n=t.window.location.hash.slice(1).split("&").map((t=>{const n=t.split("=")[0];return n===e?(r=!0,`${n}=${i}`):t})).filter((t=>t));return r||n.push(`${e}=${i}`),`#${n.join("&")}`}return`#${i}`}_getCurrentHash(){const e=t.window.location.hash.replace("#","");if(this._hashName){let t;return e.split("&").map((t=>t.split("="))).forEach((e=>{e[0]===this._hashName&&(t=e)})),(t&&t[1]||"").split("/")}return e.split("/")}_onHashChange(){const t=this._map;if(!t)return!1;const e=this._getCurrentHash();if(e.length>=3&&!e.some((t=>isNaN(t)))){const i=t.dragRotate.isEnabled()&&t.touchZoomRotate.isEnabled()?+(e[3]||0):t.getBearing();return t.jumpTo({center:[+e[2],+e[1]],zoom:+e[0],bearing:i,pitch:+(e[4]||0)}),!0}return!1}_updateHashUnthrottled(){const e=t.window.location.href.replace(/(#.+)?$/,this.getHashString());t.window.history.replaceState(t.window.history.state,null,e)}}function Xr(t,e){const i=t.getCenter(),r=Math.round(100*t.getZoom())/100,n=Math.ceil((r*Math.LN2+Math.log(512/360/.5))/Math.LN10),o=Math.pow(10,n),s=Math.round(i.lng*o)/o,a=Math.round(i.lat*o)/o,l=t.getBearing(),c=t.getPitch();let u=e?`/${s}/${a}/${r}`:`${r}/${a}/${s}`;return(l||c)&&(u+="/"+Math.round(10*l)/10),c&&(u+=`/${Math.round(c)}`),u}const Jr={linearity:.3,easing:t.bezier(0,0,.3,1)},Yr=t.extend({deceleration:2500,maxSpeed:1400},Jr),tn=t.extend({deceleration:20,maxSpeed:1400},Jr),en=t.extend({deceleration:1e3,maxSpeed:360},Jr),rn=t.extend({deceleration:1e3,maxSpeed:90},Jr);class nn{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:t.exported.now(),settings:e})}_drainInertiaBuffer(){const e=this._inertiaBuffer,i=t.exported.now();for(;e.length>0&&i-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._map._prefersReducedMotion())return;if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const i={zoom:0,bearing:0,pitch:0,pan:new t.Point(0,0),pinchAround:void 0,around:void 0};for(const{settings:t}of this._inertiaBuffer)i.zoom+=t.zoomDelta||0,i.bearing+=t.bearingDelta||0,i.pitch+=t.pitchDelta||0,t.panDelta&&i.pan._add(t.panDelta),t.around&&(i.around=t.around),t.pinchAround&&(i.pinchAround=t.pinchAround);const r=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,n={};if(i.pan.mag()){const o=sn(i.pan.mag(),r,t.extend({},Yr,e||{}));n.offset=i.pan.mult(o.amount/i.pan.mag()),n.center=this._map.transform.center,on(n,o)}if(i.zoom){const t=sn(i.zoom,r,tn);n.zoom=this._map.transform.zoom+t.amount,on(n,t)}if(i.bearing){const e=sn(i.bearing,r,en);n.bearing=this._map.transform.bearing+t.clamp(e.amount,-179,179),on(n,e)}if(i.pitch){const t=sn(i.pitch,r,rn);n.pitch=this._map.transform.pitch+t.amount,on(n,t)}if(n.zoom||n.bearing){const t=void 0===i.pinchAround?i.around:i.pinchAround;n.around=t?this._map.unproject(t):this._map.getCenter()}return this.clear(),n.noMoveStart=!0,n}}function on(t,e){(!t.duration||t.duration<e.duration)&&(t.duration=e.duration,t.easing=e.easing)}function sn(e,i,r){const{maxSpeed:n,linearity:o,deceleration:s}=r,a=t.clamp(e*o/(i/1e3),-n,n),l=Math.abs(a)/(s*o);return{easing:r.easing,duration:1e3*l,amount:a*(l/2)}}class an extends t.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,i,r,n={}){const o=f(i.getCanvasContainer(),r),s=i.unproject(o);super(e,t.extend({point:o,lngLat:s,originalEvent:r},n)),this._defaultPrevented=!1,this.target=i}}class ln extends t.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,i,r){const n="touchend"===e?r.changedTouches:r.touches,o=A(i.getCanvasContainer(),n),s=o.map((t=>i.unproject(t))),a=o.reduce(((t,e,i,r)=>t.add(e.div(r.length))),new t.Point(0,0));super(e,{points:o,point:a,lngLats:s,lngLat:i.unproject(a),originalEvent:r}),this._defaultPrevented=!1}}class cn extends t.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,e,i){super(t,{originalEvent:i}),this._defaultPrevented=!1}}class un{constructor(t,e){this._map=t,this._clickTolerance=e.clickTolerance}reset(){this._mousedownPos=void 0}wheel(t){return this._firePreventable(new cn(t.type,this._map,t))}mousedown(t,e){return this._mousedownPos=e,this._firePreventable(new an(t.type,this._map,t))}mouseup(t){this._map.fire(new an(t.type,this._map,t))}preclick(e){const i=t.extend({},e);i.type="preclick",this._map.fire(new an(i.type,this._map,i))}click(t,e){this._mousedownPos&&this._mousedownPos.dist(e)>=this._clickTolerance||(this.preclick(t),this._map.fire(new an(t.type,this._map,t)))}dblclick(t){return this._firePreventable(new an(t.type,this._map,t))}mouseover(t){this._map.fire(new an(t.type,this._map,t))}mouseout(t){this._map.fire(new an(t.type,this._map,t))}touchstart(t){return this._firePreventable(new ln(t.type,this._map,t))}touchmove(t){this._map.fire(new ln(t.type,this._map,t))}touchend(t){this._map.fire(new ln(t.type,this._map,t))}touchcancel(t){this._map.fire(new ln(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class hn{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(t){this._map.fire(new an(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new an("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._map.fire(new an(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class dn{constructor(t,e){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=e.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,e){this.isEnabled()&&t.shiftKey&&0===t.button&&(u(),this._startPos=this._lastPos=e,this._active=!0)}mousemoveWindow(t,e){if(!this._active)return;const i=e,r=this._startPos,n=this._lastPos;if(!r||!n||n.equals(i)||!this._box&&i.dist(r)<this._clickTolerance)return;this._lastPos=i,this._box||(this._box=o("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));const s=Math.min(r.x,i.x),a=Math.max(r.x,i.x),l=Math.min(r.y,i.y),c=Math.max(r.y,i.y);this._map._requestDomTask((()=>{this._box&&(this._box.style.transform=`translate(${s}px,${l}px)`,this._box.style.width=a-s+"px",this._box.style.height=c-l+"px")}))}mouseupWindow(e,i){if(!this._active)return;const r=this._startPos,n=i;if(r&&0===e.button){if(this.reset(),p(),r.x!==n.x||r.y!==n.y)return this._map.fire(new t.Event("boxzoomend",{originalEvent:e})),{cameraAnimation:t=>t.fitScreenCoordinates(r,n,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",e)}}keydown(t){this._active&&27===t.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",t))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),h(),delete this._startPos,delete this._lastPos}_fireEvent(e,i){return this._map.fire(new t.Event(e,{originalEvent:i}))}}function pn(t,e){const i={};for(let r=0;r<t.length;r++)i[t[r].identifier]=e[r];return i}class fn{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(e,i,r){(this.centroid||r.length>this.numTouches)&&(this.aborted=!0),this.aborted||(0===this.startTime&&(this.startTime=e.timeStamp),r.length===this.numTouches&&(this.centroid=function(e){const i=new t.Point(0,0);for(const t of e)i._add(t);return i.div(e.length)}(i),this.touches=pn(r,i)))}touchmove(t,e,i){if(this.aborted||!this.centroid)return;const r=pn(i,e);for(const t in this.touches){const e=r[t];(!e||e.dist(this.touches[t])>30)&&(this.aborted=!0)}}touchend(t,e,i){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),0===i.length){const t=!this.aborted&&this.centroid;if(this.reset(),t)return t}}}class An{constructor(t){this.singleTap=new fn(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(t,e,i){this.singleTap.touchstart(t,e,i)}touchmove(t,e,i){this.singleTap.touchmove(t,e,i)}touchend(t,e,i){const r=this.singleTap.touchend(t,e,i);if(r){const e=t.timeStamp-this.lastTime<500,i=!this.lastTap||this.lastTap.dist(r)<30;if(e&&i||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=r,this.count===this.numTaps)return this.reset(),r}}}class mn{constructor(){this._zoomIn=new An({numTouches:1,numTaps:2}),this._zoomOut=new An({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,e,i){this._zoomIn.touchstart(t,e,i),this._zoomOut.touchstart(t,e,i)}touchmove(t,e,i){this._zoomIn.touchmove(t,e,i),this._zoomOut.touchmove(t,e,i)}touchend(t,e,i){const r=this._zoomIn.touchend(t,e,i),n=this._zoomOut.touchend(t,e,i);return r?(this._active=!0,t.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:e=>e.easeTo({duration:300,zoom:e.getZoom()+1,around:e.unproject(r)},{originalEvent:t})}):n?(this._active=!0,t.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:e=>e.easeTo({duration:300,zoom:e.getZoom()-1,around:e.unproject(n)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const gn={0:1,2:2};class _n{constructor(t){this.reset(),this._clickTolerance=t.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(t,e){return!1}_move(t,e){return{}}mousedown(t,e){if(this._lastPoint)return;const i=m(t);this._correctButton(t,i)&&(this._lastPoint=e,this._eventButton=i)}mousemoveWindow(t,e){const i=this._lastPoint;if(i)if(t.preventDefault(),null!=this._eventButton&&function(t,e){const i=gn[e];return void 0===t.buttons||(t.buttons&i)!==i}(t,this._eventButton))this.reset();else if(this._moved||!(e.dist(i)<this._clickTolerance))return this._moved=!0,this._lastPoint=e,this._move(i,e)}mouseupWindow(t){this._lastPoint&&m(t)===this._eventButton&&(this._moved&&p(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class yn extends _n{mousedown(t,e){super.mousedown(t,e),this._lastPoint&&(this._active=!0)}_correctButton(t,e){return 0===e&&!t.ctrlKey}_move(t,e){return{around:e,panDelta:e.sub(t)}}}class vn extends _n{_correctButton(t,e){return 0===e&&t.ctrlKey||2===e}_move(t,e){const i=.8*(e.x-t.x);if(i)return this._active=!0,{bearingDelta:i}}contextmenu(t){t.preventDefault()}}class xn extends _n{_correctButton(t,e){return 0===e&&t.ctrlKey||2===e}_move(t,e){const i=-.5*(e.y-t.y);if(i)return this._active=!0,{pitchDelta:i}}contextmenu(t){t.preventDefault()}}class bn{constructor(e,i){this._map=e,this._el=e.getCanvasContainer(),this._minTouches=1,this._clickTolerance=i.clickTolerance||1,this.reset(),t.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new t.Point(0,0)}touchstart(t,e,i){return this._calculateTransform(t,e,i)}touchmove(e,i,r){if(this._active&&!(r.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===r.length&&!t.isFullscreen())return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return e.cancelable&&e.preventDefault(),this._calculateTransform(e,i,r)}}touchend(t,e,i){this._calculateTransform(t,e,i),this._active&&i.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,i,r){r.length>0&&(this._active=!0);const n=pn(r,i),o=new t.Point(0,0),s=new t.Point(0,0);let a=0;for(const t in n){const e=n[t],i=this._touches[t];i&&(o._add(e),s._add(e.sub(i)),a++,n[t]=e)}if(this._touches=n,a<this._minTouches||!s.mag())return;const l=s.div(a);return this._sum._add(l),this._sum.mag()<this._clickTolerance?void 0:{around:o.div(a),panDelta:l}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=o("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout((()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")}),500)}}class wn{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(t){}_move(t,e,i){return{}}touchstart(t,e,i){this._firstTwoTouches||i.length<2||(this._firstTwoTouches=[i[0].identifier,i[1].identifier],this._start([e[0],e[1]]))}touchmove(t,e,i){const r=this._firstTwoTouches;if(!r)return;t.preventDefault();const[n,o]=r,s=Tn(i,e,n),a=Tn(i,e,o);if(!s||!a)return;const l=this._aroundCenter?null:s.add(a).div(2);return this._move([s,a],l,t)}touchend(t,e,i){if(!this._firstTwoTouches)return;const[r,n]=this._firstTwoTouches,o=Tn(i,e,r),s=Tn(i,e,n);o&&s||(this._active&&p(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&"center"===t.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Tn(t,e,i){for(let r=0;r<t.length;r++)if(t[r].identifier===i)return e[r]}function Bn(t,e){return Math.log(t/e)/Math.LN2}class En extends wn{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,e){const i=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(Bn(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Bn(this._distance,i),pinchAround:e}}}function Cn(t,e){return 180*t.angleWith(e)/Math.PI}class Sn extends wn{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,e){const i=this._vector;if(this._vector=t[0].sub(t[1]),i&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Cn(this._vector,i),pinchAround:e}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const e=25/(Math.PI*this._minDiameter)*360,i=this._startVector;if(!i)return!1;const r=Cn(t,i);return Math.abs(r)<e}}function In(t){return Math.abs(t.y)>Math.abs(t.x)}class Mn extends wn{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(t){this._lastPoints=t,In(t[0].sub(t[1]))&&(this._valid=!1)}_move(e,i,r){const n=this._lastPoints;if(!n)return;const o=e[0].sub(n[0]),s=e[1].sub(n[1]);return this._map._cooperativeGestures&&!t.isFullscreen()&&r.touches.length<3||(this._valid=this.gestureBeginsVertically(o,s,r.timeStamp),!this._valid)?void 0:(this._lastPoints=e,this._active=!0,{pitchDelta:(o.y+s.y)/2*-.5})}gestureBeginsVertically(t,e,i){if(void 0!==this._valid)return this._valid;const r=t.mag()>=2,n=e.mag()>=2;if(!r&&!n)return;if(!r||!n)return null==this._firstMove&&(this._firstMove=i),i-this._firstMove<100&&void 0;const o=t.y>0==e.y>0;return In(t)&&In(e)&&o}}const kn={panStep:100,bearingStep:15,pitchStep:10};class Pn{constructor(){const t=kn;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let e=0,i=0,r=0,n=0,o=0;switch(t.keyCode){case 61:case 107:case 171:case 187:e=1;break;case 189:case 109:case 173:e=-1;break;case 37:t.shiftKey?i=-1:(t.preventDefault(),n=-1);break;case 39:t.shiftKey?i=1:(t.preventDefault(),n=1);break;case 38:t.shiftKey?r=1:(t.preventDefault(),o=-1);break;case 40:t.shiftKey?r=-1:(t.preventDefault(),o=1);break;default:return}return this._rotationDisabled&&(i=0,r=0),{cameraAnimation:s=>{const a=s.getZoom();s.easeTo({duration:300,easeId:"keyboardHandler",easing:Ln,zoom:e?Math.round(a)+e*(t.shiftKey?2:1):a,bearing:s.getBearing()+i*this._bearingStep,pitch:s.getPitch()+r*this._pitchStep,offset:[-n*this._panStep,-o*this._panStep],center:s.getCenter()},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Ln(t){return t*(2-t)}const zn=4.000244140625;class Fn{constructor(e,i){this._map=e,this._el=e.getCanvasContainer(),this._handler=i,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,t.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&"center"===t.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(e){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(e.ctrlKey||e.metaKey||this.isZooming()||t.isFullscreen()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let i=e.deltaMode===t.window.WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY;const r=t.exported.now(),n=r-(this._lastWheelEventTime||0);this._lastWheelEventTime=r,0!==i&&i%zn==0?this._type="wheel":0!==i&&Math.abs(i)<4?this._type="trackpad":n>400?(this._type=null,this._lastValue=i,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(n*i)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,i+=this._lastValue)),e.shiftKey&&i&&(i/=4),this._type&&(this._lastWheelEvent=e,this._delta-=i,this._active||this._start(e)),e.preventDefault()}_onTimeout(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const e=f(this._el,t);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:e,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId)return;if(this._frameId=null,!this.isActive())return;const e=this._map.transform;"wheel"===this._type&&e.projection.wrap&&(e._center.lng>=180||e._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const i=()=>e._terrainEnabled()&&this._aroundCoord?e.computeZoomRelativeTo(this._aroundCoord):e.zoom;if(0!==this._delta){const t="wheel"===this._type&&Math.abs(this._delta)>zn?this._wheelZoomRate:this._defaultZoomRate;let r=2/(1+Math.exp(-Math.abs(this._delta*t)));this._delta<0&&0!==r&&(r=1/r);const n=i(),o=Math.pow(2,n),s="number"==typeof this._targetZoom?e.zoomScale(this._targetZoom):o;this._targetZoom=Math.min(e.maxZoom,Math.max(e.minZoom,e.scaleZoom(s*r))),"wheel"===this._type&&(this._startZoom=n,this._easing=this._smoothOutEasing(200)),this._delta=0}const r="number"==typeof this._targetZoom?this._targetZoom:i(),n=this._startZoom,o=this._easing;let s,a=!1;if("wheel"===this._type&&n&&o){const e=Math.min((t.exported.now()-this._lastWheelEventTime)/200,1),i=o(e);s=t.number(n,r,i),e<1?this._frameId||(this._frameId=!0):a=!0}else s=r,a=!0;return this._active=!0,a&&(this._active=!1,this._finishTimeout=setTimeout((()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout}),200)),{noInertia:!0,needsRenderFrame:!a,zoomDelta:s-i(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let i=t.ease;if(this._prevEase){const e=this._prevEase,r=(t.exported.now()-e.start)/e.duration,n=e.easing(r+.01)-e.easing(r),o=.27/Math.sqrt(n*n+1e-4)*.01,s=Math.sqrt(.0729-o*o);i=t.bezier(o,s,.25,1)}return this._prevEase={start:t.exported.now(),duration:e,easing:i},i}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=o("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(t.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout((()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")}),200)}}class Dn{constructor(t,e){this._clickZoom=t,this._tapZoom=e}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Rn{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(t,e){return t.preventDefault(),{cameraAnimation:i=>{i.easeTo({duration:300,zoom:i.getZoom()+(t.shiftKey?-1:1),around:i.unproject(e)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Un{constructor(){this._tap=new An({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(t,e,i){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?i.length>0&&(this._swipePoint=e[0],this._swipeTouch=i[0].identifier):this._tap.touchstart(t,e,i))}touchmove(t,e,i){if(this._tapTime){if(this._swipePoint){if(i[0].identifier!==this._swipeTouch)return;const r=e[0],n=r.y-this._swipePoint.y;return this._swipePoint=r,t.preventDefault(),this._active=!0,{zoomDelta:n/128}}}else this._tap.touchmove(t,e,i)}touchend(t,e,i){this._tapTime?this._swipePoint&&0===i.length&&this.reset():this._tap.touchend(t,e,i)&&(this._tapTime=t.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class On{constructor(t,e,i){this._el=t,this._mousePan=e,this._touchPan=i}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Nn{constructor(t,e,i){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=e,this._mousePitch=i}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Qn{constructor(t,e,i,r){this._el=t,this._touchZoom=e,this._touchRotate=i,this._tapDragZoom=r,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Vn=t=>t.zoom||t.drag||t.pitch||t.rotate;class jn extends t.Event{}class Hn{constructor(){this.constants=[1,1,.01],this.radius=0}setup(e,i){const r=t.sub([],i,e);this.radius=t.length(r[2]<0?t.div([],r,this.constants):[r[0],r[1],0])}projectRay(e){t.div(e,e,this.constants),t.normalize(e,e),t.mul$1(e,e,this.constants);const i=t.scale$2([],e,this.radius);if(i[2]>0){const e=t.scale$2([],[0,0,1],t.dot(i,[0,0,1])),r=t.scale$2([],t.normalize([],[i[0],i[1],0]),this.radius),n=t.add([],i,t.scale$2([],t.sub([],t.add([],r,e),i),2));i[0]=n[0],i[1]=n[1]}return i}}function Gn(t){return t.panDelta&&t.panDelta.mag()||t.zoomDelta||t.bearingDelta||t.pitchDelta}class $n{constructor(e,i){this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new nn(e),this._bearingSnap=i.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Hn,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(i),t.bindAll(["handleEvent","handleWindowEvent"],this);const r=this._el;this._listeners=[[r,"touchstart",{passive:!0}],[r,"touchmove",{passive:!1}],[r,"touchend",void 0],[r,"touchcancel",void 0],[r,"mousedown",void 0],[r,"mousemove",void 0],[r,"mouseup",void 0],[t.window.document,"mousemove",{capture:!0}],[t.window.document,"mouseup",void 0],[r,"mouseover",void 0],[r,"mouseout",void 0],[r,"dblclick",void 0],[r,"click",void 0],[r,"keydown",{capture:!1}],[r,"keyup",void 0],[r,"wheel",{passive:!1}],[r,"contextmenu",void 0],[t.window,"blur",void 0]];for(const[e,i,r]of this._listeners)e.addEventListener(i,e===t.window.document?this.handleWindowEvent:this.handleEvent,r)}destroy(){for(const[e,i,r]of this._listeners)e.removeEventListener(i,e===t.window.document?this.handleWindowEvent:this.handleEvent,r)}_addDefaultHandlers(t){const e=this._map,i=e.getCanvasContainer();this._add("mapEvent",new un(e,t));const r=e.boxZoom=new dn(e,t);this._add("boxZoom",r);const n=new mn,o=new Rn;e.doubleClickZoom=new Dn(o,n),this._add("tapZoom",n),this._add("clickZoom",o);const s=new Un;this._add("tapDragZoom",s);const a=e.touchPitch=new Mn(e);this._add("touchPitch",a);const l=new vn(t),c=new xn(t);e.dragRotate=new Nn(t,l,c),this._add("mouseRotate",l,["mousePitch"]),this._add("mousePitch",c,["mouseRotate"]);const u=new yn(t),h=new bn(e,t);e.dragPan=new On(i,u,h),this._add("mousePan",u),this._add("touchPan",h,["touchZoom","touchRotate"]);const d=new Sn,p=new En;e.touchZoomRotate=new Qn(i,p,d,s),this._add("touchRotate",d,["touchPan","touchZoom"]),this._add("touchZoom",p,["touchPan","touchRotate"]),this._add("blockableMapEvent",new hn(e));const f=e.scrollZoom=new Fn(e,this);this._add("scrollZoom",f,["mousePan"]);const A=e.keyboard=new Pn;this._add("keyboard",A);for(const i of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])t.interactive&&t[i]&&e[i].enable(t[i])}_add(t,e,i){this._handlers.push({handlerName:t,handler:e,allowed:i}),this._handlersById[t]=e}stop(t){if(!this._updatingCamera){for(const{handler:t}of this._handlers)t.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Vn(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(t,e,i){for(const r in t)if(r!==i&&(!e||e.indexOf(r)<0))return!0;return!1}handleWindowEvent(t){this.handleEvent(t,`${t.type}Window`)}_getMapTouches(t){const e=[];for(const i of t)this._el.contains(i.target)&&e.push(i);return e}handleEvent(t,e){this._updatingCamera=!0;const i="renderFrame"===t.type,r=i?void 0:t,n={needsRenderFrame:!1},o={},s={},a=t.touches?this._getMapTouches(t.touches):void 0,l=a?A(this._el,a):i?void 0:f(this._el,t);for(const{handlerName:i,handler:c,allowed:u}of this._handlers){if(!c.isEnabled())continue;let h;this._blockedByActive(s,u,i)?c.reset():c[e||t.type]&&(h=c[e||t.type](t,l,a),this.mergeHandlerResult(n,o,h,i,r),h&&h.needsRenderFrame&&this._triggerRenderFrame()),(h||c.isActive())&&(s[i]=c)}const c={};for(const t in this._previousActiveHandlers)s[t]||(c[t]=r);this._previousActiveHandlers=s,(Object.keys(c).length||Gn(n))&&(this._changes.push([n,o,c]),this._triggerRenderFrame()),(Object.keys(s).length||Gn(n))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:u}=n;u&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],u(this._map))}mergeHandlerResult(e,i,r,n,o){if(!r)return;t.extend(e,r);const s={handlerName:n,originalEvent:r.originalEvent||o};void 0!==r.zoomDelta&&(i.zoom=s),void 0!==r.panDelta&&(i.drag=s),void 0!==r.pitchDelta&&(i.pitch=s),void 0!==r.bearingDelta&&(i.rotate=s)}_applyChanges(){const e={},i={},r={};for(const[n,o,s]of this._changes)n.panDelta&&(e.panDelta=(e.panDelta||new t.Point(0,0))._add(n.panDelta)),n.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+n.zoomDelta),n.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+n.bearingDelta),n.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+n.pitchDelta),void 0!==n.around&&(e.around=n.around),void 0!==n.aroundCoord&&(e.aroundCoord=n.aroundCoord),void 0!==n.pinchAround&&(e.pinchAround=n.pinchAround),n.noInertia&&(e.noInertia=n.noInertia),t.extend(i,o),t.extend(r,s);this._updateMapTransform(e,i,r),this._changes=[]}_updateMapTransform(e,i,r){const n=this._map,o=n.transform,s=t=>[t.x,t.y,t.z];if((t=>{const e=this._eventsInProgress.drag;return e&&!this._handlersById[e.handlerName].isActive()})()&&!Gn(e)){const t=o.zoom;o.cameraElevationReference="sea",o.recenterOnTerrain(),o.cameraElevationReference="ground",t!==o.zoom&&this._map._update(!0)}if(o._isCameraConstrained&&n._stop(!0),!Gn(e))return void this._fireEvents(i,r,!0);let{panDelta:a,zoomDelta:l,bearingDelta:c,pitchDelta:u,around:h,aroundCoord:d,pinchAround:p}=e;o._isCameraConstrained&&(l>0&&(l=0),o._isCameraConstrained=!1),void 0!==p&&(h=p),(l||(t=>i[t]&&!this._eventsInProgress[t])("drag"))&&h&&(this._dragOrigin=s(o.pointCoordinate3D(h)),this._trackingEllipsoid.setup(o._camera.position,this._dragOrigin)),o.cameraElevationReference="sea",n._stop(!0),h=h||n.transform.centerPoint,c&&(o.bearing+=c),u&&(o.pitch+=u),o._updateCameraState();const f=[0,0,0];if(a)if("mercator"===o.projection.name){const t=this._trackingEllipsoid.projectRay(o.screenPointToMercatorRay(h).dir),e=this._trackingEllipsoid.projectRay(o.screenPointToMercatorRay(h.sub(a)).dir);f[0]=e[0]-t[0],f[1]=e[1]-t[1]}else{const e=o.pointCoordinate(h);if("globe"===o.projection.name){a=a.rotate(-o.angle);const i=o._pixelsPerMercatorPixel/o.worldSize;f[0]=-a.x*t.mercatorScale(t.latFromMercatorY(e.y))*i,f[1]=-a.y*t.mercatorScale(o.center.lat)*i}else{const t=o.pointCoordinate(h.sub(a));e&&t&&(f[0]=t.x-e.x,f[1]=t.y-e.y)}}const A=o.zoom,m=[0,0,0];if(l){const e=s(d||o.pointCoordinate3D(h)),i={dir:t.normalize([],t.sub([],e,o._camera.position))};if(i.dir[2]<0){const r=o.zoomDeltaToMovement(e,l);t.scale$2(m,i.dir,r)}}const g=t.add(f,f,m);o._translateCameraConstrained(g),l&&Math.abs(o.zoom-A)>1e-4&&o.recenterOnTerrain(),o.cameraElevationReference="ground",this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(i,r,!0)}_fireEvents(e,i,r){const n=Vn(this._eventsInProgress),o=Vn(e),s={};for(const t in e){const{originalEvent:i}=e[t];this._eventsInProgress[t]||(s[`${t}start`]=i),this._eventsInProgress[t]=e[t]}!n&&o&&this._fireEvent("movestart",o.originalEvent);for(const t in s)this._fireEvent(t,s[t]);o&&this._fireEvent("move",o.originalEvent);for(const t in e){const{originalEvent:i}=e[t];this._fireEvent(t,i)}const a={};let l;for(const t in this._eventsInProgress){const{handlerName:e,originalEvent:r}=this._eventsInProgress[t];this._handlersById[e].isActive()||(delete this._eventsInProgress[t],l=i[e]||r,a[`${t}end`]=l)}for(const t in a)this._fireEvent(t,a[t]);const c=Vn(this._eventsInProgress);if(r&&(n||o)&&!c){this._updatingCamera=!0;const e=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),i=t=>0!==t&&-this._bearingSnap<t&&t<this._bearingSnap;e?(i(e.bearing||this._map.getBearing())&&(e.bearing=0),this._map.easeTo(e,{originalEvent:l})):(this._map.fire(new t.Event("moveend",{originalEvent:l})),i(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(e,i){this._map.fire(new t.Event(e,i?{originalEvent:i}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((t=>{this._frameId=void 0,this.handleEvent(new jn("renderFrame",{timeStamp:t})),this._applyChanges()}))}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const Zn="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class qn extends t.Evented{constructor(e,i){super(),this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=i.bearingSnap,this._respectPrefersReducedMotion=!1!==i.respectPrefersReducedMotion,t.bindAll(["_renderFrameCallback"],this)}getCenter(){return new t.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(t,e){return this.jumpTo({center:t},e)}panBy(e,i,r){return e=t.Point.convert(e).mult(-1),this.panTo(this.transform.center,t.extend({offset:e},i),r)}panTo(e,i,r){return this.easeTo(t.extend({center:e},i),r)}getZoom(){return this.transform.zoom}setZoom(t,e){return this.jumpTo({zoom:t},e),this}zoomTo(e,i,r){return this.easeTo(t.extend({zoom:e},i),r)}zoomIn(t,e){return this.zoomTo(this.getZoom()+1,t,e),this}zoomOut(t,e){return this.zoomTo(this.getZoom()-1,t,e),this}getBearing(){return this.transform.bearing}setBearing(t,e){return this.jumpTo({bearing:t},e),this}getPadding(){return this.transform.padding}setPadding(t,e){return this.jumpTo({padding:t},e),this}rotateTo(e,i,r){return this.easeTo(t.extend({bearing:e},i),r)}resetNorth(e,i){return this.rotateTo(0,t.extend({duration:1e3},e),i),this}resetNorthPitch(e,i){return this.easeTo(t.extend({bearing:0,pitch:0,duration:1e3},e),i),this}snapToNorth(t,e){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,e):this}getPitch(){return this.transform.pitch}setPitch(t,e){return this.jumpTo({pitch:t},e),this}cameraForBounds(e,i){e=t.LngLatBounds.convert(e);const r=i&&i.bearing||0,n=i&&i.pitch||0,o=e.getNorthWest(),s=e.getSouthEast();return this._cameraForBounds(this.transform,o,s,r,n,i)}_extendCameraOptions(e){const i={top:0,bottom:0,right:0,left:0};if("number"==typeof(e=t.extend({padding:i,offset:[0,0],maxZoom:this.transform.maxZoom},e)).padding){const t=e.padding;e.padding={top:t,bottom:t,right:t,left:t}}return e.padding=t.extend(i,e.padding),e}_minimumAABBFrustumDistance(t,e){const i=e.max[0]-e.min[0],r=e.max[1]-e.min[1];return i/r>t.aspect?i/(2*Math.tan(.5*t.fovX)*t.aspect):r/(2*Math.tan(.5*t.fovY)*t.aspect)}_cameraForBoundsOnGlobe(e,i,r,n,o,s){const a=e.clone(),l=this._extendCameraOptions(s);a.bearing=n,a.pitch=o;const c=t.LngLat.convert(i),u=t.LngLat.convert(r),h=.5*(c.lat+u.lat),d=.5*(c.lng+u.lng),p=t.latLngToECEF(h,d),f=t.normalize([],p),A=t.normalize([],t.cross([],f,[0,1,0])),m=t.cross([],A,f),g=[A[0],A[1],A[2],0,m[0],m[1],m[2],0,f[0],f[1],f[2],0,0,0,0,1],_=[p,t.latLngToECEF(c.lat,c.lng),t.latLngToECEF(u.lat,c.lng),t.latLngToECEF(u.lat,u.lng),t.latLngToECEF(c.lat,u.lng),t.latLngToECEF(h,c.lng),t.latLngToECEF(h,u.lng),t.latLngToECEF(c.lat,d),t.latLngToECEF(u.lat,d)];let y=t.Aabb.fromPoints(_.map((e=>[t.dot(A,e),t.dot(m,e),t.dot(f,e)])));const v=t.transformMat4([],y.center,g);0===t.squaredLength(v)&&t.set(v,0,0,1),t.normalize(v,v),t.scale$2(v,v,t.GLOBE_RADIUS),a.center=t.ecefToLatLng(v);const x=a.getWorldToCameraMatrix(),b=t.invert(new Float64Array(16),x);y=t.Aabb.applyTransform(y,t.multiply([],x,g)),t.transformMat4(v,v,x);const w=.5*(y.max[2]-y.min[2]),T=this._minimumAABBFrustumDistance(a,y),B=t.scale$2([],[0,0,1],w),E=t.add(B,v,B),C=T+(0===a.pitch?0:t.distance(v,E)),S=a.globeCenterInViewSpace,I=t.sub([],v,[S[0],S[1],S[2]]);t.normalize(I,I),t.scale$2(I,I,C);const M=t.add([],v,I);t.transformMat4(M,M,b);const k=t.earthRadius/t.GLOBE_RADIUS,P=t.length(M),L=t.mercatorZfromAltitude(Math.max(P*k-t.earthRadius,Number.EPSILON),0),z=Math.min(a.zoomFromMercatorZAdjusted(L),l.maxZoom);return z>.5*(t.GLOBE_ZOOM_THRESHOLD_MIN+t.GLOBE_ZOOM_THRESHOLD_MAX)?(a.setProjection({name:"mercator"}),a.zoom=z,this._cameraForBounds(a,i,r,n,o,s)):{center:a.center,zoom:z,bearing:n,pitch:o}}queryTerrainElevation(e,i){const r=this.transform.elevation;return r?(i=t.extend({},{exaggerated:!0},i),r.getAtPoint(t.MercatorCoordinate.fromLngLat(e),null,i.exaggerated)):null}_cameraForBounds(e,i,r,n,o,s){if("globe"===e.projection.name)return this._cameraForBoundsOnGlobe(e,i,r,n,o,s);const a=e.clone(),l=this._extendCameraOptions(s),c=a.padding;a.bearing=n,a.pitch=o;const u=t.LngLat.convert(i),h=t.LngLat.convert(r),d=new t.LngLat(u.lng,h.lat),p=new t.LngLat(h.lng,u.lat),f=a.project(u),A=a.project(h),m=this.queryTerrainElevation(u),g=this.queryTerrainElevation(h),_=this.queryTerrainElevation(d),y=this.queryTerrainElevation(p),v=[[f.x,f.y,Math.min(m||0,g||0,_||0,y||0)],[A.x,A.y,Math.max(m||0,g||0,_||0,y||0)]];let x=t.Aabb.fromPoints(v);const b=a.getWorldToCameraMatrix(),w=t.invert(new Float64Array(16),b);x=t.Aabb.applyTransform(x,b);const T=t.sub([],x.max,x.min),B=c.left||0,E=c.right||0,C=c.bottom||0,S=c.top||0,{left:I,right:M,top:k,bottom:P}=l.padding,L=.5*(B+E),z=.5*(S+C),F=Math.min(a.scaleZoom(a.scale*Math.min((a.width-(B+E+I+M))/T[0],(a.height-(C+S+P+k))/T[1])),l.maxZoom),D=a.scale/a.zoomScale(F);x=new t.Aabb([x.min[0]-(I+L)*D,x.min[1]-(P+z)*D,x.min[2]],[x.max[0]+(M+L)*D,x.max[1]+(k+z)*D,x.max[2]]);const R=.5*T[2],U=this._minimumAABBFrustumDistance(a,x),O=[0,0,1,0];t.transformMat4$1(O,O,b),t.normalize$2(O,O);const N=t.scale$2([],O,U+R),Q=t.add([],x.center,N),V=("number"==typeof l.offset.x&&"number"==typeof l.offset.y?new t.Point(l.offset.x,l.offset.y):t.Point.convert(l.offset)).rotate(-t.degToRad(n));x.center[0]-=V.x*D,x.center[1]+=V.y*D,t.transformMat4(x.center,x.center,w),t.transformMat4(Q,Q,w);const j=[x.center[0],x.center[1],Q[2]*a.pixelsPerMeter];t.scale$2(j,j,1/a.worldSize);const H=t.lngFromMercatorX(j[0]),G=t.latFromMercatorY(j[1]),$=Math.min(a._zoomFromMercatorZ(j[2]),l.maxZoom),Z=new t.LngLat(H,G);return a.mercatorFromTransition&&$<.5*(t.GLOBE_ZOOM_THRESHOLD_MIN+t.GLOBE_ZOOM_THRESHOLD_MAX)?(a.setProjection({name:"globe"}),a.zoom=$,this._cameraForBounds(a,i,r,n,o,s)):{center:Z,zoom:$,bearing:n,pitch:o}}fitBounds(t,e,i){const r=this.cameraForBounds(t,e);return this._fitInternal(r,e,i)}fitScreenCoordinates(e,i,r,n,o){const s=t.Point.convert(e),a=t.Point.convert(i),l=new t.Point(Math.min(s.x,a.x),Math.min(s.y,a.y)),c=new t.Point(Math.max(s.x,a.x),Math.max(s.y,a.y));if("mercator"===this.transform.projection.name&&this.transform.anyCornerOffEdge(s,a))return this;const u=this.transform.pointLocation3D(l),h=this.transform.pointLocation3D(c),d=this.transform.pointLocation3D(new t.Point(l.x,c.y)),p=this.transform.pointLocation3D(new t.Point(c.x,l.y)),f=[Math.min(u.lng,h.lng,d.lng,p.lng),Math.min(u.lat,h.lat,d.lat,p.lat)],A=[Math.max(u.lng,h.lng,d.lng,p.lng),Math.max(u.lat,h.lat,d.lat,p.lat)],m=n&&n.pitch?n.pitch:this.getPitch(),g=this._cameraForBounds(this.transform,f,A,r,m,n);return this._fitInternal(g,n,o)}_fitInternal(e,i,r){return e?(delete(i=t.extend(e,i)).padding,i.linear?this.easeTo(i,r):this.flyTo(i,r)):this}jumpTo(e,i){this.stop();const r=e.preloadOnly?this.transform.clone():this.transform;let n=!1,o=!1,s=!1;return"zoom"in e&&r.zoom!==+e.zoom&&(n=!0,r.zoom=+e.zoom),void 0!==e.center&&(r.center=t.LngLat.convert(e.center)),"bearing"in e&&r.bearing!==+e.bearing&&(o=!0,r.bearing=+e.bearing),"pitch"in e&&r.pitch!==+e.pitch&&(s=!0,r.pitch=+e.pitch),null==e.padding||r.isPaddingEqual(e.padding)||(r.padding=e.padding),e.preloadOnly?(this._preloadTiles(r),this):(this.fire(new t.Event("movestart",i)).fire(new t.Event("move",i)),n&&this.fire(new t.Event("zoomstart",i)).fire(new t.Event("zoom",i)).fire(new t.Event("zoomend",i)),o&&this.fire(new t.Event("rotatestart",i)).fire(new t.Event("rotate",i)).fire(new t.Event("rotateend",i)),s&&this.fire(new t.Event("pitchstart",i)).fire(new t.Event("pitch",i)).fire(new t.Event("pitchend",i)),this.fire(new t.Event("moveend",i)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||t.warnOnce(Zn),this.transform.getFreeCameraOptions()}setFreeCameraOptions(e,i){const r=this.transform;if(!r.projection.supportsFreeCamera)return t.warnOnce(Zn),this;this.stop();const n=r.zoom,o=r.pitch,s=r.bearing;r.setFreeCameraOptions(e);const a=n!==r.zoom,l=o!==r.pitch,c=s!==r.bearing;return this.fire(new t.Event("movestart",i)).fire(new t.Event("move",i)),a&&this.fire(new t.Event("zoomstart",i)).fire(new t.Event("zoom",i)).fire(new t.Event("zoomend",i)),c&&this.fire(new t.Event("rotatestart",i)).fire(new t.Event("rotate",i)).fire(new t.Event("rotateend",i)),l&&this.fire(new t.Event("pitchstart",i)).fire(new t.Event("pitch",i)).fire(new t.Event("pitchend",i)),this.fire(new t.Event("moveend",i)),this}easeTo(e,i){this._stop(!1,e.easeId),(!1===(e=t.extend({offset:[0,0],duration:500,easing:t.ease},e)).animate||this._prefersReducedMotion(e))&&(e.duration=0);const r=this.transform,n=this.getZoom(),o=this.getBearing(),s=this.getPitch(),a=this.getPadding(),l="zoom"in e?+e.zoom:n,c="bearing"in e?this._normalizeBearing(e.bearing,o):o,u="pitch"in e?+e.pitch:s,h="padding"in e?e.padding:r.padding,d=t.Point.convert(e.offset);let p,f,A;if("globe"===r.projection.name){const i=t.MercatorCoordinate.fromLngLat(r.center),n=d.rotate(-r.angle);i.x+=n.x/r.worldSize,i.y+=n.y/r.worldSize;const o=i.toLngLat(),s=t.LngLat.convert(e.center||o);this._normalizeCenter(s),p=r.centerPoint.add(n),f=new t.Point(i.x,i.y).mult(r.worldSize),A=new t.Point(t.mercatorXfromLng(s.lng),t.mercatorYfromLat(s.lat)).mult(r.worldSize).sub(f)}else{p=r.centerPoint.add(d);const i=r.pointLocation(p),n=t.LngLat.convert(e.center||i);this._normalizeCenter(n),f=r.project(i),A=r.project(n).sub(f)}const m=r.zoomScale(l-n);let g,_;e.around&&(g=t.LngLat.convert(e.around),_=r.locationPoint(g));const y=this._zooming||l!==n,v=this._rotating||o!==c,x=this._pitching||u!==s,b=!r.isPaddingEqual(h),w=r=>w=>{if(y&&(r.zoom=t.number(n,l,w)),v&&(r.bearing=t.number(o,c,w)),x&&(r.pitch=t.number(s,u,w)),b&&(r.interpolatePadding(a,h,w),p=r.centerPoint.add(d)),g)r.setLocationAtPoint(g,_);else{const t=r.zoomScale(r.zoom-n),e=l>n?Math.min(2,m):Math.max(.5,m),i=Math.pow(e,1-w),o=r.unproject(f.add(A.mult(w*i)).mult(t));r.setLocationAtPoint(r.renderWorldCopies?o.wrap():o,p)}return e.preloadOnly||this._fireMoveEvents(i),r};if(e.preloadOnly){const t=this._emulate(w,e.duration,r);return this._preloadTiles(t),this}const T={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=y,this._rotating=v,this._pitching=x,this._padding=b,this._easeId=e.easeId,this._prepareEase(i,e.noMoveStart,T),this._ease(w(r),(t=>{r.recenterOnTerrain(),this._afterEase(i,t)}),e),this}_prepareEase(e,i,r={}){this._moving=!0,this.transform.cameraElevationReference="sea",i||r.moving||this.fire(new t.Event("movestart",e)),this._zooming&&!r.zooming&&this.fire(new t.Event("zoomstart",e)),this._rotating&&!r.rotating&&this.fire(new t.Event("rotatestart",e)),this._pitching&&!r.pitching&&this.fire(new t.Event("pitchstart",e))}_fireMoveEvents(e){this.fire(new t.Event("move",e)),this._zooming&&this.fire(new t.Event("zoom",e)),this._rotating&&this.fire(new t.Event("rotate",e)),this._pitching&&this.fire(new t.Event("pitch",e))}_afterEase(e,i){if(this._easeId&&i&&this._easeId===i)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const r=this._zooming,n=this._rotating,o=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,r&&this.fire(new t.Event("zoomend",e)),n&&this.fire(new t.Event("rotateend",e)),o&&this.fire(new t.Event("pitchend",e)),this.fire(new t.Event("moveend",e))}flyTo(e,i){if(this._prefersReducedMotion(e)){const r=t.pick(e,["center","zoom","bearing","pitch","around"]);return this.jumpTo(r,i)}this.stop(),e=t.extend({offset:[0,0],speed:1.2,curve:1.42,easing:t.ease},e);const r=this.transform,n=this.getZoom(),o=this.getBearing(),s=this.getPitch(),a=this.getPadding(),l="zoom"in e?t.clamp(+e.zoom,r.minZoom,r.maxZoom):n,c="bearing"in e?this._normalizeBearing(e.bearing,o):o,u="pitch"in e?+e.pitch:s,h="padding"in e?e.padding:r.padding,d=r.zoomScale(l-n),p=t.Point.convert(e.offset);let f=r.centerPoint.add(p);const A=r.pointLocation(f),m=t.LngLat.convert(e.center||A);this._normalizeCenter(m);const g=r.project(A),_=r.project(m).sub(g);let y=e.curve;const v=Math.max(r.width,r.height),x=v/d,b=_.mag();if("minZoom"in e){const i=t.clamp(Math.min(e.minZoom,n,l),r.minZoom,r.maxZoom),o=v/r.zoomScale(i-n);y=Math.sqrt(o/b*2)}const w=y*y;function T(t){const e=(x*x-v*v+(t?-1:1)*w*w*b*b)/(2*(t?x:v)*w*b);return Math.log(Math.sqrt(e*e+1)-e)}function B(t){return(Math.exp(t)-Math.exp(-t))/2}function E(t){return(Math.exp(t)+Math.exp(-t))/2}const C=T(0);let S=function(t){return E(C)/E(C+y*t)},I=function(t){return v*((E(C)*(B(e=C+y*t)/E(e))-B(C))/w)/b;var e},M=(T(1)-C)/y;if(Math.abs(b)<1e-6||!isFinite(M)){if(Math.abs(v-x)<1e-6)return this.easeTo(e,i);const t=x<v?-1:1;M=Math.abs(Math.log(x/v))/y,I=function(){return 0},S=function(e){return Math.exp(t*y*e)}}e.duration="duration"in e?+e.duration:1e3*M/("screenSpeed"in e?+e.screenSpeed/y:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0);const k=o!==c,P=u!==s,L=!r.isPaddingEqual(h),z=r=>d=>{const A=d*M,y=1/S(A);r.zoom=1===d?l:n+r.scaleZoom(y),k&&(r.bearing=t.number(o,c,d)),P&&(r.pitch=t.number(s,u,d)),L&&(r.interpolatePadding(a,h,d),f=r.centerPoint.add(p));const v=1===d?m:r.unproject(g.add(_.mult(I(A))).mult(y));return r.setLocationAtPoint(r.renderWorldCopies?v.wrap():v,f),r._updateCameraOnTerrain(),e.preloadOnly||this._fireMoveEvents(i),r};if(e.preloadOnly){const t=this._emulate(z,e.duration,r);return this._preloadTiles(t),this}return this._zooming=!0,this._rotating=k,this._pitching=P,this._padding=L,this._prepareEase(i,!1),this._ease(z(r),(()=>this._afterEase(i)),e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,e){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const t=this._onEaseEnd;this._onEaseEnd=void 0,t.call(this,e)}if(!t){const t=this.handlers;t&&t.stop(!1)}return this}_ease(e,i,r){!1===r.animate||0===r.duration?(e(1),i()):(this._easeStart=t.exported.now(),this._easeOptions=r,this._onEaseFrame=e,this._onEaseEnd=i,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const e=Math.min((t.exported.now()-this._easeStart)/this._easeOptions.duration,1),i=this._onEaseFrame;i&&i(this._easeOptions.easing(e)),e<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(e,i){e=t.wrap(e,-180,180);const r=Math.abs(e-i);return Math.abs(e-360-i)<r&&(e-=360),Math.abs(e+360-i)<r&&(e+=360),e}_normalizeCenter(t){const e=this.transform;if(!e.renderWorldCopies||e.maxBounds)return;const i=t.lng-e.center.lng;t.lng+=i>180?-360:i<-180?360:0}_prefersReducedMotion(e){return this._respectPrefersReducedMotion&&t.exported.prefersReducedMotion&&!(e&&e.essential)}_emulate(t,e,i){const r=Math.ceil(15*e/1e3),n=[],o=t(i.clone());for(let t=0;t<=r;t++){const e=o(t/r);n.push(e.clone())}return n}}class Kn{constructor(e={}){this.options=e,t.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(t){const e=this.options&&this.options.compact;return this._map=t,this._container=o("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=o("button","mapboxgl-ctrl-attrib-button",this._container),o("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=o("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),e&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===e&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(t,e){const i=this._map._getUIString(`AttributionControl.${e}`);t.setAttribute("aria-label",i),t.removeAttribute("title"),t.firstElementChild&&t.firstElementChild.setAttribute("title",i)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let e=this._editLink;e||(e=this._editLink=this._container.querySelector(".mapbox-improve-map"));const i=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||t.config.ACCESS_TOKEN}];if(e){const r=i.reduce(((t,e,r)=>(e.value&&(t+=`${e.key}=${e.value}${r<i.length-1?"&":""}`),t)),"?");e.href=`${t.config.FEEDBACK_URL}/${r}#${Xr(this._map,!0)}`,e.rel="noopener nofollow",this._setElementTitle(e,"MapFeedback")}}_updateData(t){!t||"metadata"!==t.sourceDataType&&"visibility"!==t.sourceDataType&&"style"!==t.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let t=[];if(this._map.style.stylesheet){const t=this._map.style.stylesheet;this.styleOwner=t.owner,this.styleId=t.id}const e=this._map.style._sourceCaches;for(const i in e){const r=e[i];if(r.used){const e=r.getSource();e.attribution&&t.indexOf(e.attribution)<0&&t.push(e.attribution)}}t.sort(((t,e)=>t.length-e.length)),t=t.filter(((e,i)=>{for(let r=i+1;r<t.length;r++)if(t[r].indexOf(e)>=0)return!1;return!0})),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=[...this.options.customAttribution,...t]:t.unshift(this.options.customAttribution));const i=t.join(" | ");i!==this._attribHTML&&(this._attribHTML=i,t.length?(this._innerContainer.innerHTML=i,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Wn{constructor(){t.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(t){this._map=t,this._container=o("div","mapboxgl-ctrl");const e=o("a","mapboxgl-ctrl-logo");return e.target="_blank",e.rel="noopener nofollow",e.href="https://www.mapbox.com/",e.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),e.setAttribute("rel","noopener nofollow"),this._container.appendChild(e),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(t){t&&"metadata"!==t.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const t=this._map.style._sourceCaches;if(0===Object.entries(t).length)return!0;for(const e in t){const i=t[e].getSource();if(i.hasOwnProperty("mapbox_logo")&&!i.mapbox_logo)return!1}return!0}_updateCompact(){const t=this._container.children;if(t.length){const e=t[0];this._map.getCanvasContainer().offsetWidth<250?e.classList.add("mapboxgl-compact"):e.classList.remove("mapboxgl-compact")}}}class Xn{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const e=++this._id;return this._queue.push({callback:t,id:e,cancelled:!1}),e}remove(t){const e=this._currentlyRunning,i=e?this._queue.concat(e):this._queue;for(const e of i)if(e.id===t)return void(e.cancelled=!0)}run(t=0){const e=this._currentlyRunning=this._queue;this._queue=[];for(const i of e)if(!i.cancelled&&(i.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Jn(e,i,r){if(e=new t.LngLat(e.lng,e.lat),i){const n=new t.LngLat(e.lng-360,e.lat),o=new t.LngLat(e.lng+360,e.lat),s=360*Math.ceil(Math.abs(e.lng-r.center.lng)/360),a=r.locationPoint(e).distSqr(i),l=i.x<0||i.y<0||i.x>r.width||i.y>r.height;r.locationPoint(n).distSqr(i)<a&&(l||Math.abs(n.lng-r.center.lng)<s)?e=n:r.locationPoint(o).distSqr(i)<a&&(l||Math.abs(o.lng-r.center.lng)<s)&&(e=o)}for(;Math.abs(e.lng-r.center.lng)>180;){const t=r.locationPoint(e);if(t.x>=0&&t.y>=0&&t.x<=r.width&&t.y<=r.height)break;e.lng>r.center.lng?e.lng-=360:e.lng+=360}return e}const Yn={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class to extends t.Evented{constructor(e,i){if(super(),(e instanceof t.window.HTMLElement||i)&&(e=t.extend({element:e},i)),t.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&e.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=e&&e.occludedOpacity||.2,e&&e.element)this._element=e.element,this._offset=t.Point.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=o("div");const i=41,r=27,n=s("svg",{display:"block",height:i*this._scale+"px",width:r*this._scale+"px",viewBox:`0 0 ${r} ${i}`},this._element),a=s("radialGradient",{id:"shadowGradient"},s("defs",{},n));s("stop",{offset:"10%","stop-opacity":.4},a),s("stop",{offset:"100%","stop-opacity":.05},a),s("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},n),s("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},n),s("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},n),s("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},n),this._offset=t.Point.convert(e&&e.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",(t=>{t.preventDefault()})),this._element.addEventListener("mousedown",(t=>{t.preventDefault()}));const r=this._element.classList;for(const t in Yn)r.remove(`mapboxgl-marker-anchor-${t}`);r.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(t){return t===this._map||(this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._updateMoving),t.on("moveend",this._update),t.on("remove",this._clearFadeTimer),t._addMarker(this),this.setDraggable(this._draggable),this._update(),t.on("click",this._onMapClick)),this}remove(){const t=this._map;return t&&(t.off("click",this._onMapClick),t.off("move",this._updateMoving),t.off("moveend",this._update),t.off("mousedown",this._addDragHandler),t.off("touchstart",this._addDragHandler),t.off("mouseup",this._onUp),t.off("touchend",this._onUp),t.off("mousemove",this._onMove),t.off("touchmove",this._onMove),t.off("remove",this._clearFadeTimer),t._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=t.LngLat.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const e=38.1,i=13.5,r=Math.sqrt(Math.pow(i,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-e],"bottom-left":[r,-1*(e-i+r)],"bottom-right":[-r,-1*(e-i+r)],left:[i,-1*(e-i)],right:[-i,-1*(e-i)]}:this._offset}this._popup=t,t._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(t){const e=t.code,i=t.charCode||t.keyCode;"Space"!==e&&"Enter"!==e&&32!==i&&13!==i||this.togglePopup()}_onMapClick(t){const e=t.originalEvent.target,i=this._element;this._popup&&(e===i||i.contains(e))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?(t.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(t.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const t=this._map,e=this._pos;if(!t||!e)return!1;const i=t.unproject(e),r=t.getFreeCameraOptions();if(!r.position)return!1;const n=r.position.toLngLat();return n.distanceTo(i)<.9*n.distanceTo(this._lngLat)}_evaluateOpacity(){const e=this._map;if(!e)return;const i=this._pos;if(!i||i.x<0||i.x>e.transform.width||i.y<0||i.y>e.transform.height)return void this._clearFadeTimer();const r=e.unproject(i);let n;e._showingGlobe()&&t.isLngLatBehindGlobe(e.transform,this._lngLat)?n=0:(n=1-e._queryFogOpacity(r),e.transform._terrainEnabled()&&e.getTerrain()&&this._behindTerrain()&&(n*=this._occludedOpacity)),this._element.style.opacity=`${n}`,this._element.style.pointerEvents=n>0?"auto":"none",this._popup&&this._popup._setOpacity(n),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const t=this._pos;if(!t||!this._map)return;const e=this._offset.mult(this._scale);this._element.style.transform=`\n            translate(${t.x}px,${t.y}px)\n            ${Yn[this._anchor]}\n            ${this._calculateXYTransform()} ${this._calculateZTransform()}\n            translate(${e.x}px,${e.y}px)\n        `}_calculateXYTransform(){const e=this._pos,i=this._map,r=this.getPitchAlignment();if(!i||!e||"map"!==r)return"";if(!i._showingGlobe()){const t=i.getPitch();return t?`rotateX(${t}deg)`:""}const n=t.radToDeg(t.globeTiltAtLngLat(i.transform,this._lngLat)),o=e.sub(t.globeCenterToScreenPoint(i.transform)),s=Math.abs(o.x)+Math.abs(o.y);if(0===s)return"";const a=n/s;return`rotateX(${-o.y*a}deg) rotateY(${o.x*a}deg)`}_calculateZTransform(){const e=this._pos,i=this._map;if(!i||!e)return"";let r=0;const n=this.getRotationAlignment();if("map"===n)if(i._showingGlobe()){const e=i.project(new t.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),n=i.project(new t.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(e);r=t.radToDeg(Math.atan2(n.y,n.x))-90}else r=-i.getBearing();else if("horizon"===n){const n=t.smoothstep(4,6,i.getZoom()),o=t.globeCenterToScreenPoint(i.transform);o.y+=n*i.transform.height;const s=e.sub(o),a=t.radToDeg(Math.atan2(s.y,s.x));r=(a>90?a-270:a+90)*(1-n)}return r+=this._rotation,r?`rotateZ(${r}deg)`:""}_update(e){t.window.cancelAnimationFrame(this._updateFrameId);const i=this._map;i&&(i.transform.renderWorldCopies&&(this._lngLat=Jn(this._lngLat,this._pos,i.transform)),this._pos=i.project(this._lngLat),!0===e?this._updateFrameId=t.window.requestAnimationFrame((()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())})):this._pos=this._pos.round(),i._requestDomTask((()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(i._showingGlobe()||i.getTerrain()||i.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))})))}getOffset(){return this._offset}setOffset(e){return this._offset=t.Point.convert(e),this._update(),this}_onMove(e){const i=this._map;if(!i)return;const r=this._pointerdownPos,n=this._positionDelta;if(r&&n){if(!this._isDragging){const t=this._clickTolerance||i._clickTolerance;if(e.point.dist(r)<t)return;this._isDragging=!0}this._pos=e.point.sub(n),this._lngLat=i.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new t.Event("dragstart"))),this.fire(new t.Event("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const e=this._map;e&&(e.off("mousemove",this._onMove),e.off("touchmove",this._onMove)),"active"===this._state&&this.fire(new t.Event("dragend")),this._state="inactive"}_addDragHandler(t){const e=this._map,i=this._pos;e&&i&&this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(i),this._pointerdownPos=t.point,this._state="pending",e.on("mousemove",this._onMove),e.on("touchmove",this._onMove),e.once("mouseup",this._onUp),e.once("touchend",this._onUp))}setDraggable(t){this._draggable=!!t;const e=this._map;return e&&(t?(e.on("mousedown",this._addDragHandler),e.on("touchstart",this._addDragHandler)):(e.off("mousedown",this._addDragHandler),e.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return"auto"===this._rotationAlignment||"horizon"===this._rotationAlignment&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t||"auto",this._update(),this}getPitchAlignment(){return"auto"===this._pitchAlignment?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(t){return this._occludedOpacity=t||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const eo={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},io=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function ro(e=new t.Point(0,0),i="bottom"){if("number"==typeof e){const r=Math.round(Math.sqrt(.5*Math.pow(e,2)));switch(i){case"top":return new t.Point(0,e);case"top-left":return new t.Point(r,r);case"top-right":return new t.Point(-r,r);case"bottom":return new t.Point(0,-e);case"bottom-left":return new t.Point(r,-r);case"bottom-right":return new t.Point(-r,-r);case"left":return new t.Point(e,0);case"right":return new t.Point(-e,0)}return new t.Point(0,0)}return e instanceof t.Point||Array.isArray(e)?t.Point.convert(e):t.Point.convert(e[i]||[0,0])}class no{constructor(t){this.jumpTo(t)}getValue(e){if(e<=this._startTime)return this._start;if(e>=this._endTime)return this._end;const i=t.easeCubicInOut((e-this._startTime)/(this._endTime-this._startTime));return this._start*(1-i)+this._end*i}isEasing(t){return t>=this._startTime&&t<=this._endTime}jumpTo(t){this._startTime=-1/0,this._endTime=-1/0,this._start=t,this._end=t}easeTo(t,e,i){this._start=this.getValue(e),this._end=t,this._startTime=e,this._endTime=e+i}}const oo={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},so={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0},ao={showCompass:!0,showZoom:!0,visualizePitch:!1};class lo{constructor(e,i,r=!1){this._clickTolerance=10,this.element=i,this.mouseRotate=new vn({clickTolerance:e.dragRotate._mouseRotate._clickTolerance}),this.map=e,r&&(this.mousePitch=new xn({clickTolerance:e.dragRotate._mousePitch._clickTolerance})),t.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),i.addEventListener("mousedown",this.mousedown),i.addEventListener("touchstart",this.touchstart,{passive:!1}),i.addEventListener("touchmove",this.touchmove),i.addEventListener("touchend",this.touchend),i.addEventListener("touchcancel",this.reset)}down(t,e){this.mouseRotate.mousedown(t,e),this.mousePitch&&this.mousePitch.mousedown(t,e),u()}move(t,e){const i=this.map,r=this.mouseRotate.mousemoveWindow(t,e),n=r&&r.bearingDelta;if(n&&i.setBearing(i.getBearing()+n),this.mousePitch){const r=this.mousePitch.mousemoveWindow(t,e),n=r&&r.pitchDelta;n&&i.setPitch(i.getPitch()+n)}}off(){const t=this.element;t.removeEventListener("mousedown",this.mousedown),t.removeEventListener("touchstart",this.touchstart,{passive:!1}),t.removeEventListener("touchmove",this.touchmove),t.removeEventListener("touchend",this.touchend),t.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){h(),t.window.removeEventListener("mousemove",this.mousemove),t.window.removeEventListener("mouseup",this.mouseup)}mousedown(e){this.down(t.extend({},e,{ctrlKey:!0,preventDefault:()=>e.preventDefault()}),f(this.element,e)),t.window.addEventListener("mousemove",this.mousemove),t.window.addEventListener("mouseup",this.mouseup)}mousemove(t){this.move(t,f(this.element,t))}mouseup(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()}touchstart(t){1!==t.targetTouches.length?this.reset():(this._startPos=this._lastPos=A(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>t.preventDefault()},this._startPos))}touchmove(t){1!==t.targetTouches.length?this.reset():(this._lastPos=A(this.element,t.targetTouches)[0],this.move({preventDefault:()=>t.preventDefault()},this._lastPos))}touchend(t){0===t.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const co={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},uo={maxWidth:100,unit:"metric"},ho={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},po={version:t.version,supported:i,setRTLTextPlugin:t.setRTLTextPlugin,getRTLTextPluginStatus:t.getRTLTextPluginStatus,Map:class extends qn{constructor(e){if(t.LivePerformanceUtils.mark(t.PerformanceMarkers.create),null!=(e=t.extend({},so,e)).minZoom&&null!=e.maxZoom&&e.minZoom>e.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=e.minPitch&&null!=e.maxPitch&&e.minPitch>e.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=e.minPitch&&e.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=e.maxPitch&&e.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(e.antialias&&t.isSafariWithAntialiasingBug(t.window)&&(e.antialias=!1,t.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new qr(e.minZoom,e.maxZoom,e.minPitch,e.maxPitch,e.renderWorldCopies),e),this._interactive=e.interactive,this._minTileCacheSize=e.minTileCacheSize,this._maxTileCacheSize=e.maxTileCacheSize,this._failIfMajorPerformanceCaveat=e.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=e.preserveDrawingBuffer,this._antialias=e.antialias,this._useWebGL2=e.useWebGL2,this._trackResize=e.trackResize,this._bearingSnap=e.bearingSnap,this._refreshExpiredTiles=e.refreshExpiredTiles,this._fadeDuration=e.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=e.crossSourceCollisions,this._collectResourceTiming=e.collectResourceTiming,this._optimizeForTerrain=e.optimizeForTerrain,this._language=this._parseLanguage(e.language),this._worldview=e.worldview,this._renderTaskQueue=new Xn,this._domRenderTaskQueue=new Xn,this._controls=[],this._markers=[],this._popups=[],this._mapId=t.uniqueId(),this._locale=t.extend({},oo,e.locale),this._clickTolerance=e.clickTolerance,this._cooperativeGestures=e.cooperativeGestures,this._performanceMetricsCollection=e.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new no(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new t.RequestManager(e.transformRequest,e.accessToken,e.testMode),this._silenceAuthErrors=!!e.testMode,"string"==typeof e.container){if(this._container=t.window.document.getElementById(e.container),!this._container)throw new Error(`Container '${e.container}' not found.`)}else{if(!(e.container instanceof t.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=e.container}if(this._container.childNodes.length>0&&t.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),e.maxBounds&&this.setMaxBounds(e.maxBounds),t.bindAll(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),void 0!==t.window&&(t.window.addEventListener("online",this._onWindowOnline,!1),t.window.addEventListener("resize",this._onWindowResize,!1),t.window.addEventListener("orientationchange",this._onWindowResize,!1),t.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1),t.window.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new $n(this,e),this._localFontFamily=e.localFontFamily,this._localIdeographFontFamily=e.localIdeographFontFamily,e.style&&this.setStyle(e.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),e.projection&&this.setProjection(e.projection),this._hash=e.hash&&new Wr("string"==typeof e.hash&&e.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:e.center,zoom:e.zoom,bearing:e.bearing,pitch:e.pitch}),e.bounds&&(this.resize(),this.fitBounds(e.bounds,t.extend({},e.fitBoundsOptions,{duration:0})))),this.resize(),e.attributionControl&&this.addControl(new Kn({customAttribution:e.customAttribution})),this._logoControl=new Wn,this.addControl(this._logoControl,e.logoPosition),this.on("style.load",(()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)})),this.on("data",(e=>{this._update("style"===e.dataType),this.fire(new t.Event(`${e.dataType}data`,e))})),this.on("dataloading",(e=>{this.fire(new t.Event(`${e.dataType}dataloading`,e))}))}_getMapId(){return this._mapId}addControl(e,i){if(void 0===i&&(i=e.getDefaultPosition?e.getDefaultPosition():"top-right"),!e||!e.onAdd)return this.fire(new t.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const r=e.onAdd(this);this._controls.push(e);const n=this._controlPositions[i];return-1!==i.indexOf("bottom")?n.insertBefore(r,n.firstChild):n.appendChild(r),this}removeControl(e){if(!e||!e.onRemove)return this.fire(new t.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const i=this._controls.indexOf(e);return i>-1&&this._controls.splice(i,1),e.onRemove(this),this}hasControl(t){return this._controls.indexOf(t)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(e){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const i=!this._moving;return i&&this.fire(new t.Event("movestart",e)).fire(new t.Event("move",e)),this.fire(new t.Event("resize",e)),i&&this.fire(new t.Event("moveend",e)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(e){return this.transform.setMaxBounds(t.LngLatBounds.convert(e)),this._update()}setMinZoom(e){if((e=null==e?-2:e)>=-2&&e<=this.transform.maxZoom)return this.transform.minZoom=e,this._update(),this.getZoom()<e?this.setZoom(e):this.fire(new t.Event("zoomstart")).fire(new t.Event("zoom")).fire(new t.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(e){if((e=null==e?22:e)>=this.transform.minZoom)return this.transform.maxZoom=e,this._update(),this.getZoom()>e?this.setZoom(e):this.fire(new t.Event("zoomstart")).fire(new t.Event("zoom")).fire(new t.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(e){if((e=null==e?0:e)<0)throw new Error("minPitch must be greater than or equal to 0");if(e>=0&&e<=this.transform.maxPitch)return this.transform.minPitch=e,this._update(),this.getPitch()<e?this.setPitch(e):this.fire(new t.Event("pitchstart")).fire(new t.Event("pitch")).fire(new t.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(e){if((e=null==e?85:e)>85)throw new Error("maxPitch must be less than or equal to 85");if(e>=this.transform.minPitch)return this.transform.maxPitch=e,this._update(),this.getPitch()>e?this.setPitch(e):this.fire(new t.Event("pitchstart")).fire(new t.Event("pitch")).fire(new t.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(t){return this.transform.renderWorldCopies=t,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(e){return"auto"===e?t.window.navigator.language:Array.isArray(e)?0===e.length?void 0:e.map((e=>"auto"===e?t.window.navigator.language:e)):e}setLanguage(t){const e=this._parseLanguage(t);if(!this.style||e===this._language)return this;this._language=e,this.style._reloadSources();for(const t of this._controls)t._setLanguage&&t._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(t){return this.style&&t!==this._worldview?(this._worldview=t,this.style._reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return"globe"===this.transform.projection.name}setProjection(t){return this._lazyInitEmptyStyle(),t?"string"==typeof t&&(t={name:t}):t=null,this._useExplicitProjection=!!t,this._prioritizeAndUpdateProjection(t,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if("globe"!==this.getProjection().name)return;const e=this.transform,i=e.projection.name;let r;"globe"===i&&e.zoom>=t.GLOBE_ZOOM_THRESHOLD_MAX?(e.setMercatorFromTransition(),r=!0):"mercator"===i&&e.zoom<t.GLOBE_ZOOM_THRESHOLD_MAX&&(e.setProjection({name:"globe"}),r=!0),r&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(t,e){return this._updateProjection(t||e||{name:"mercator"})}_updateProjection(e){let i;if(i="globe"===e.name&&this.transform.zoom>=t.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(e),this.style.applyProjectionUpdate(),i){this.painter.clearBackgroundTiles();for(const t in this.style._sourceCaches)this.style._sourceCaches[t].clearTiles();this._update(!0),this._forceMarkerAndPopupUpdate(!0)}return this}project(e){return this.transform.locationPoint3D(t.LngLat.convert(e))}unproject(e){return this.transform.pointLocation3D(t.Point.convert(e))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(t,e,i){if("mouseenter"===t||"mouseover"===t){let r=!1;const n=n=>{const o=e.filter((t=>this.getLayer(t))),s=o.length?this.queryRenderedFeatures(n.point,{layers:o}):[];s.length?r||(r=!0,i.call(this,new an(t,this,n.originalEvent,{features:s}))):r=!1},o=()=>{r=!1};return{layers:new Set(e),listener:i,delegates:{mousemove:n,mouseout:o}}}if("mouseleave"===t||"mouseout"===t){let r=!1;const n=n=>{const o=e.filter((t=>this.getLayer(t)));(o.length?this.queryRenderedFeatures(n.point,{layers:o}):[]).length?r=!0:r&&(r=!1,i.call(this,new an(t,this,n.originalEvent)))},o=e=>{r&&(r=!1,i.call(this,new an(t,this,e.originalEvent)))};return{layers:new Set(e),listener:i,delegates:{mousemove:n,mouseout:o}}}{const r=t=>{const r=e.filter((t=>this.getLayer(t))),n=r.length?this.queryRenderedFeatures(t.point,{layers:r}):[];n.length&&(t.features=n,i.call(this,t),delete t.features)};return{layers:new Set(e),listener:i,delegates:{[t]:r}}}}on(t,e,i){if(void 0===i)return super.on(t,e);Array.isArray(e)||(e=[e]);const r=this._createDelegatedListener(t,e,i);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[t]=this._delegatedListeners[t]||[],this._delegatedListeners[t].push(r);for(const t in r.delegates)this.on(t,r.delegates[t]);return this}once(t,e,i){if(void 0===i)return super.once(t,e);Array.isArray(e)||(e=[e]);const r=this._createDelegatedListener(t,e,i);for(const t in r.delegates)this.once(t,r.delegates[t]);return this}off(t,e,i){if(void 0===i)return super.off(t,e);e=new Set(Array.isArray(e)?e:[e]);const r=(t,e)=>{if(t.size!==e.size)return!1;for(const i of t)if(!e.has(i))return!1;return!0},n=this._delegatedListeners?this._delegatedListeners[t]:void 0;return n&&(t=>{for(let n=0;n<t.length;n++){const o=t[n];if(o.listener===i&&r(o.layers,e)){for(const t in o.delegates)this.off(t,o.delegates[t]);return t.splice(n,1),this}}})(n),this}queryRenderedFeatures(e,i){return this.style?(void 0!==i||void 0===e||e instanceof t.Point||Array.isArray(e)||(i=e,e=void 0),this.style.queryRenderedFeatures(e=e||[[0,0],[this.transform.width,this.transform.height]],i=i||{},this.transform)):[]}querySourceFeatures(t,e){return this.style.querySourceFeatures(t,e)}isPointOnSurface(e){const{name:i}=this.transform.projection;return"globe"!==i&&"mercator"!==i&&t.warnOnce(`${i} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(t.Point.convert(e))}setStyle(e,i){return!1!==(i=t.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},i)).diff&&i.localIdeographFontFamily===this._localIdeographFontFamily&&i.localFontFamily===this._localFontFamily&&this.style&&e?(this._diffStyle(e,i),this):(this._localIdeographFontFamily=i.localIdeographFontFamily,this._localFontFamily=i.localFontFamily,this._updateStyle(e,i))}_getUIString(t){const e=this._locale[t];if(null==e)throw new Error(`Missing UI string '${t}'`);return e}_updateStyle(t,e){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),t&&(this.style=new Xe(this,e||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof t?this.style.loadURL(t):this.style.loadJSON(t)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Xe(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(e,i){if("string"==typeof e){const r=this._requestManager.normalizeStyleURL(e),n=this._requestManager.transformRequest(r,t.ResourceType.Style);t.getJSON(n,((e,r)=>{e?this.fire(new t.ErrorEvent(e)):r&&this._updateDiff(r,i)}))}else"object"==typeof e&&this._updateDiff(e,i)}_updateDiff(e,i){try{this.style.setState(e)&&this._update(!0)}catch(r){t.warnOnce(`Unable to perform style diff: ${r.message||r.error||r}.  Rebuilding the style from scratch.`),this._updateStyle(e,i)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(t.warnOnce("There is no style added to the map."),!1)}addSource(t,e){return this._lazyInitEmptyStyle(),this.style.addSource(t,e),this._update(!0)}isSourceLoaded(t){return!!this.style&&this.style._isSourceCacheLoaded(t)}areTilesLoaded(){const t=this.style&&this.style._sourceCaches;for(const e in t){const i=t[e]._tiles;for(const t in i){const e=i[t];if("loaded"!==e.state&&"errored"!==e.state)return!1}}return!0}addSourceType(t,e,i){this._lazyInitEmptyStyle(),this.style.addSourceType(t,e,i)}removeSource(t){return this.style.removeSource(t),this._updateTerrain(),this._update(!0)}getSource(t){return this.style.getSource(t)}addImage(e,i,{pixelRatio:r=1,sdf:n=!1,stretchX:o,stretchY:s,content:a}={}){if(this._lazyInitEmptyStyle(),i instanceof t.window.HTMLImageElement||t.window.ImageBitmap&&i instanceof t.window.ImageBitmap){const{width:l,height:c,data:u}=t.exported.getImageData(i);this.style.addImage(e,{data:new t.RGBAImage({width:l,height:c},u),pixelRatio:r,stretchX:o,stretchY:s,content:a,sdf:n,version:0})}else if(void 0===i.width||void 0===i.height)this.fire(new t.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:l,height:c}=i,u=i;this.style.addImage(e,{data:new t.RGBAImage({width:l,height:c},new Uint8Array(u.data)),pixelRatio:r,stretchX:o,stretchY:s,content:a,sdf:n,version:0,userImage:u}),u.onAdd&&u.onAdd(this,e)}}updateImage(e,i){const r=this.style.getImage(e);if(!r)return void this.fire(new t.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const n=i instanceof t.window.HTMLImageElement||t.window.ImageBitmap&&i instanceof t.window.ImageBitmap?t.exported.getImageData(i):i,{width:o,height:s}=n;void 0!==o&&void 0!==s?o===r.data.width&&s===r.data.height?(r.data.replace(n.data,!(i instanceof t.window.HTMLImageElement||t.window.ImageBitmap&&i instanceof t.window.ImageBitmap)),this.style.updateImage(e,r)):this.fire(new t.ErrorEvent(new Error(`The width and height of the updated image (${o}, ${s})\n                must be that same as the previous version of the image\n                (${r.data.width}, ${r.data.height})`))):this.fire(new t.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(e){return e?!!this.style.getImage(e):(this.fire(new t.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(t){this.style.removeImage(t)}loadImage(e,i){t.getImage(this._requestManager.transformRequest(e,t.ResourceType.Image),((e,r)=>{i(e,r instanceof t.window.HTMLImageElement?t.exported.getImageData(r):r)}))}listImages(){return this.style.listImages()}addLayer(t,e){return this._lazyInitEmptyStyle(),this.style.addLayer(t,e),this._update(!0)}moveLayer(t,e){return this.style.moveLayer(t,e),this._update(!0)}removeLayer(t){return this.style.removeLayer(t),this._update(!0)}getLayer(t){return this.style.getLayer(t)}setLayerZoomRange(t,e,i){return this.style.setLayerZoomRange(t,e,i),this._update(!0)}setFilter(t,e,i={}){return this.style.setFilter(t,e,i),this._update(!0)}getFilter(t){return this.style.getFilter(t)}setPaintProperty(t,e,i,r={}){return this.style.setPaintProperty(t,e,i,r),this._update(!0)}getPaintProperty(t,e){return this.style.getPaintProperty(t,e)}setLayoutProperty(t,e,i,r={}){return this.style.setLayoutProperty(t,e,i,r),this._update(!0)}getLayoutProperty(t,e){return this.style.getLayoutProperty(t,e)}setLight(t,e={}){return this._lazyInitEmptyStyle(),this.style.setLight(t,e),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(t){return this._lazyInitEmptyStyle(),!t&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(t),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(t){return this._lazyInitEmptyStyle(),this.style.setFog(t),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(e){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(t.LngLat.convert(e),this.transform):0}setFeatureState(t,e){return this.style.setFeatureState(t,e),this._update()}removeFeatureState(t,e){return this.style.removeFeatureState(t,e),this._update()}getFeatureState(t){return this.style.getFeatureState(t)}_updateContainerDimensions(){if(!this._container)return;const e=this._container.getBoundingClientRect().width||400,i=this._container.getBoundingClientRect().height||300;let r,n,o,s=this._container;for(;s&&(!n||!o);){const e=t.window.getComputedStyle(s).transform;e&&"none"!==e&&(r=e.match(/matrix.*\((.+)\)/)[1].split(", "),r[0]&&"0"!==r[0]&&"1"!==r[0]&&(n=r[0]),r[3]&&"0"!==r[3]&&"1"!==r[3]&&(o=r[3])),s=s.parentElement}this._containerWidth=n?Math.abs(e/n):e,this._containerHeight=o?Math.abs(i/o):i}_detectMissingCSS(){"rgb(250, 128, 114)"!==t.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&t.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const t=this._container;t.classList.add("mapboxgl-map"),(this._missingCSSCanary=o("div","mapboxgl-canary",t)).style.visibility="hidden",this._detectMissingCSS();const e=this._canvasContainer=o("div","mapboxgl-canvas-container",t);this._interactive&&e.classList.add("mapboxgl-interactive"),this._canvas=o("canvas","mapboxgl-canvas",e),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const i=this._controlContainer=o("div","mapboxgl-control-container",t),r=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((t=>{r[t]=o("div",`mapboxgl-ctrl-${t}`,i)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(e,i){const r=t.exported.devicePixelRatio||1;this._canvas.width=r*Math.ceil(e),this._canvas.height=r*Math.ceil(i),this._canvas.style.width=`${e}px`,this._canvas.style.height=`${i}px`}_addMarker(t){this._markers.push(t)}_removeMarker(t){const e=this._markers.indexOf(t);-1!==e&&this._markers.splice(e,1)}_addPopup(t){this._popups.push(t)}_removePopup(t){const e=this._popups.indexOf(t);-1!==e&&this._popups.splice(e,1)}_setupPainter(){const e=t.extend({},i.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),r=this._useWebGL2&&this._canvas.getContext("webgl2",e),n=r||this._canvas.getContext("webgl",e)||this._canvas.getContext("experimental-webgl",e);n?(this._useWebGL2&&!r&&t.warnOnce("Failed to create WebGL 2 context. Using WebGL 1."),t.storeAuthState(n,!0),this.painter=new Fr(n,this.transform,!!r),this.on("data",(t=>{"source"===t.dataType&&this.painter.setTileLoadedFlag(!0)})),t.exported$1.testSupport(n)):this.fire(new t.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(e){e.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new t.Event("webglcontextlost",{originalEvent:e}))}_contextRestored(e){this._setupPainter(),this.resize(),this._update(),this.fire(new t.Event("webglcontextrestored",{originalEvent:e}))}_onMapScroll(t){if(t.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(t){return this.style?(this._styleDirty=this._styleDirty||t,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(t){return this._update(),this._renderTaskQueue.add(t)}_cancelRenderFrame(t){this._renderTaskQueue.remove(t)}_requestDomTask(t){!this.loaded()||this.loaded()&&!this.isMoving()?t():this._domRenderTaskQueue.add(t)}_render(e){let i;const r=this.painter.context.extTimerQuery,n=t.exported.now();if(this.listens("gpu-timing-frame")&&(i=r.createQueryEXT(),r.beginQueryEXT(r.TIME_ELAPSED_EXT,i)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],t.window.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],t.window.performance.now())),this._renderTaskQueue.run(e),this._domRenderTaskQueue.run(e),this._removed)return;this._updateProjectionTransition();const o=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const e=this.transform.zoom,i=this.transform.pitch,r=t.exported.now(),n=new t.EvaluationParameters(e,{now:r,fadeDuration:o,pitch:i,transition:this.style.getTransition()});this.style.update(n)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let s=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),s=this._updateAverageElevation(n),this.style._updateSources(this.transform),this._forceMarkerAndPopupUpdate()):s=this._updateAverageElevation(n),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,o,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:o,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new t.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new t.Event("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),i){const e=t.exported.now()-n;r.endQueryEXT(r.TIME_ELAPSED_EXT,i),setTimeout((()=>{const o=r.getQueryObjectEXT(i,r.QUERY_RESULT_EXT)/1e6;r.deleteQueryEXT(i),this.fire(new t.Event("gpu-timing-frame",{cpuTime:e,gpuTime:o})),t.window.performance.mark("frame-gpu",{startTime:n,detail:{gpuTime:o}})}),50)}if(this.listens("gpu-timing-layer")){const e=this.painter.collectGpuTimers();setTimeout((()=>{const i=this.painter.queryGpuTimers(e);this.fire(new t.Event("gpu-timing-layer",{layerTimes:i}))}),50)}if(this.listens("gpu-timing-deferred-render")){const e=this.painter.collectDeferredRenderGpuQueries();setTimeout((()=>{const i=this.painter.queryGpuTimeDeferredRender(e);this.fire(new t.Event("gpu-timing-deferred-render",{gpuTime:i}))}),50)}const a=this._sourcesDirty||this._styleDirty||this._placementDirty||s;if(a||this._repaint)this.triggerRepaint();else{const e=!this.isMoving()&&this.loaded();if(e&&(s=this._updateAverageElevation(n,!0)),s)this.triggerRepaint();else if(this._triggerFrame(!1),e&&(this.fire(new t.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const e=this._calculateSpeedIndex();this.fire(new t.Event("speedindexcompleted",{speedIndex:e})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||a||(this._fullyLoaded=!0,t.LivePerformanceUtils.mark(t.PerformanceMarkers.fullLoad),this._performanceMetricsCollection&&t.postPerformanceEvent(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(t){for(const e of this._markers)t&&!this.getRenderWorldCopies()&&(e._lngLat=e._lngLat.wrap()),e._update();for(const e of this._popups)!t||this.getRenderWorldCopies()||e._trackPointer||(e._lngLat=e._lngLat.wrap()),e._update()}_updateAverageElevation(t,e=!1){const i=t=>(this.transform.averageElevation=t,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&i(0);if((e||t-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(t)){const e=this.transform.averageElevation;let r=this.transform.sampleAverageElevation(),n=!1;this.transform.elevation&&(n=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(r)?r=0:this._averageElevationLastSampledAt=t;const o=Math.abs(e-r);if(o>1){if(this._isInitialLoad||n)return this._averageElevation.jumpTo(r),i(r);this._averageElevation.easeTo(r,t,300)}else if(o>1e-4)return this._averageElevation.jumpTo(r),i(r)}return!!this._averageElevation.isEasing(t)&&i(this._averageElevation.getValue(t))}_authenticate(){t.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,(e=>{if(e&&(e.message===t.AUTH_ERR_MSG||401===e.status)){const e=this.painter.context.gl;t.storeAuthState(e,!1),this._logoControl instanceof Wn&&this._logoControl._updateLogo(),e&&e.clear(e.DEPTH_BUFFER_BIT|e.COLOR_BUFFER_BIT|e.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new t.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}})),t.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,(()=>{}))}_updateTerrain(){const t=this._isDragging();this.painter.updateTerrain(this.style,t)}_calculateSpeedIndex(){const t=this.painter.canvasCopy(),e=this.painter.getCanvasCopiesAndTimestamps();e.timeStamps.push(performance.now());const i=this.painter.context.gl,r=i.createFramebuffer();function n(t){i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,t,0);const e=new Uint8Array(i.drawingBufferWidth*i.drawingBufferHeight*4);return i.readPixels(0,0,i.drawingBufferWidth,i.drawingBufferHeight,i.RGBA,i.UNSIGNED_BYTE,e),e}return i.bindFramebuffer(i.FRAMEBUFFER,r),this._canvasPixelComparison(n(t),e.canvasCopies.map(n),e.timeStamps)}_canvasPixelComparison(t,e,i){let r=i[1]-i[0];const n=t.length/4;for(let o=0;o<e.length;o++){const s=e[o];let a=0;for(let e=0;e<s.length;e+=4)s[e]===t[e]&&s[e+1]===t[e+1]&&s[e+2]===t[e+2]&&s[e+3]===t[e+3]&&(a+=1);r+=(i[o+2]-i[o+1])*(1-a/n)}return r}remove(){this._hash&&this._hash.remove();for(const t of this._controls)t.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),void 0!==t.window&&(t.window.removeEventListener("resize",this._onWindowResize,!1),t.window.removeEventListener("orientationchange",this._onWindowResize,!1),t.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),t.window.removeEventListener("online",this._onWindowOnline,!1),t.window.removeEventListener("visibilitychange",this._onVisibilityChange,!1));const e=this.painter.context.gl.getExtension("WEBGL_lose_context");e&&e.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),t.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new t.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(e){this._renderNextFrame=this._renderNextFrame||e,this.style&&!this._frame&&(this._frame=t.exported.frame((t=>{const e=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,e&&this._render(t)})))}_preloadTiles(e){const i=this.style?Object.values(this.style._sourceCaches):[];return t.asyncAll(i,((t,i)=>t._preloadTiles(e,i)),(()=>{this.triggerRepaint()})),this}_onWindowOnline(){this._update()}_onWindowResize(t){this._trackResize&&this.resize({originalEvent:t})._update()}_onVisibilityChange(){"hidden"===t.window.document.visibilityState&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(t){this._showTileBoundaries!==t&&(this._showTileBoundaries=t,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(t){this._showTerrainWireframe!==t&&(this._showTerrainWireframe=t,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(t){this._speedIndexTiming!==t&&(this._speedIndexTiming=t,this._update())}get showPadding(){return!!this._showPadding}set showPadding(t){this._showPadding!==t&&(this._showPadding=t,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(t){this._showCollisionBoxes!==t&&(this._showCollisionBoxes=t,t?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(t){this._showOverdrawInspector!==t&&(this._showOverdrawInspector=t,this._update())}get repaint(){return!!this._repaint}set repaint(t){this._repaint!==t&&(this._repaint=t,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(t){this._vertices=t,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(t){this._showTileAABBs!==t&&(this._showTileAABBs=t,t&&this._update())}_setCacheLimits(e,i){t.setCacheLimits(e,i)}get version(){return t.version}},NavigationControl:class{constructor(e){this.options=t.extend({},ao,e),this._container=o("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",(t=>t.preventDefault())),this.options.showZoom&&(t.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",(t=>{this._map&&this._map.zoomIn({},{originalEvent:t})})),o("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",(t=>{this._map&&this._map.zoomOut({},{originalEvent:t})})),o("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(t.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",(t=>{const e=this._map;e&&(this.options.visualizePitch?e.resetNorthPitch({},{originalEvent:t}):e.resetNorth({},{originalEvent:t}))})),this._compassIcon=o("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const t=this._map;if(!t)return;const e=t.getZoom(),i=e===t.getMaxZoom(),r=e===t.getMinZoom();this._zoomInButton.disabled=i,this._zoomOutButton.disabled=r,this._zoomInButton.setAttribute("aria-disabled",i.toString()),this._zoomOutButton.setAttribute("aria-disabled",r.toString())}_rotateCompassArrow(){const t=this._map;if(!t)return;const e=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(t.transform.pitch*(Math.PI/180)),.5)}) rotateX(${t.transform.pitch}deg) rotateZ(${t.transform.angle*(180/Math.PI)}deg)`:`rotate(${t.transform.angle*(180/Math.PI)}deg)`;t._requestDomTask((()=>{this._compassIcon&&(this._compassIcon.style.transform=e)}))}onAdd(t){return this._map=t,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),t.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&t.on("pitch",this._rotateCompassArrow),t.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new lo(t,this._compass,this.options.visualizePitch)),this._container}onRemove(){const t=this._map;t&&(this._container.remove(),this.options.showZoom&&t.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&t.off("pitch",this._rotateCompassArrow),t.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(t,e){const i=o("button",t,this._container);return i.type="button",i.addEventListener("click",e),i}_setButtonTitle(t,e){if(!this._map)return;const i=this._map._getUIString(`NavigationControl.${e}`);t.setAttribute("aria-label",i),t.firstElementChild&&t.firstElementChild.setAttribute("title",i)}},GeolocateControl:class extends t.Evented{constructor(e){super(),this.options=t.extend({geolocation:t.window.navigator.geolocation},co,e),t.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Kr(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(t){return this._map=t,this._container=o("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){void 0!==this._geolocationWatchID&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(e){const i=(t=!!this.options.geolocation)=>{this._supportsGeolocation=t,e(t)};void 0!==this._supportsGeolocation?e(this._supportsGeolocation):void 0!==t.window.navigator.permissions?t.window.navigator.permissions.query({name:"geolocation"}).then((t=>i("denied"!==t.state))).catch((()=>i())):i()}_isOutOfMapMaxBounds(t){const e=this._map.getMaxBounds(),i=t.coords;return!!e&&(i.longitude<e.getWest()||i.longitude>e.getEast()||i.latitude<e.getSouth()||i.latitude>e.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(e){if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new t.Event("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(e),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new t.Event("geolocate",e)),this._finish()}}_updateCamera(e){const i=new t.LngLat(e.coords.longitude,e.coords.latitude),r=e.coords.accuracy,n=this._map.getBearing(),o=t.extend({bearing:n},this.options.fitBoundsOptions);this._map.fitBounds(i.toBounds(r),o,{geolocateSource:!0})}_updateMarker(e){if(e){const i=new t.LngLat(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(i).addTo(this._map),this._userLocationDotMarker.setLngLat(i).addTo(this._map),this._accuracy=e.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const e=this._map.transform,i=t.mercatorZfromAltitude(1,e._center.lat)*e.worldSize,r=Math.ceil(2*this._accuracy*i);this._circleElement.style.width=`${r}px`,this._circleElement.style.height=`${r}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(e){if(this._map){if(this.options.trackUserLocation)if(1===e.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===e.code&&this._noTimeout)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new t.Event("error",e)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(e){if(void 0!==this._map){if(this._container.addEventListener("contextmenu",(t=>t.preventDefault())),this._geolocateButton=o("button","mapboxgl-ctrl-geolocate",this._container),o("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===e){t.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const e=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",e),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",e)}else{const t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=o("div","mapboxgl-user-location"),this._dotElement.appendChild(o("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(o("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new to({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=o("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new to({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(e=>{e.geolocateSource||"ACTIVE_LOCK"!==this._watchState||e.originalEvent&&"resize"===e.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new t.Event("trackuserlocationend")))}))}}_onDeviceOrientation(t){this._userLocationDotMarker&&(t.webkitCompassHeading?this._heading=t.webkitCompassHeading:!0===t.absolute&&(this._heading=-1*t.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return t.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new t.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new t.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new t.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let t;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(t={maximumAge:6e5,timeout:0},this._noTimeout=!0):(t=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,t),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const e=()=>{t.window.addEventListener("ondeviceorientationabsolute"in t.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};void 0!==t.window.DeviceMotionEvent&&"function"==typeof t.window.DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then((t=>{"granted"===t&&e()})).catch(console.error):e()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),t.window.removeEventListener("deviceorientation",this._onDeviceOrientation),t.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Kn,ScaleControl:class{constructor(e){this.options=t.extend({},uo,e),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch(t){return!1}}(),t.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const t=this.options.maxWidth||100,e=this._map,i=e._containerHeight/2,r=e._containerWidth/2-t/2,n=e.unproject([r,i]),o=e.unproject([r+t,i]),s=n.distanceTo(o);if("imperial"===this.options.unit){const e=3.2808*s;e>5280?this._setScale(t,e/5280,"mile"):this._setScale(t,e,"foot")}else"nautical"===this.options.unit?this._setScale(t,s/1852,"nautical-mile"):s>=1e3?this._setScale(t,s/1e3,"kilometer"):this._setScale(t,s,"meter")}_setScale(t,e,i){this._map._requestDomTask((()=>{const r=function(t){const e=Math.pow(10,`${Math.floor(t)}`.length-1);let i=t/e;return i=i>=10?10:i>=5?5:i>=3?3:i>=2?2:i>=1?1:function(t){const e=Math.pow(10,Math.ceil(-Math.log(t)/Math.LN10));return Math.round(t*e)/e}(i),e*i}(e),n=r/e;this._container.innerHTML=this._isNumberFormatSupported&&"nautical-mile"!==i?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:i}).format(r):`${r}&nbsp;${ho[i]}`,this._container.style.width=t*n+"px"}))}onAdd(t){return this._map=t,this._language=t.getLanguage(),this._container=o("div","mapboxgl-ctrl mapboxgl-ctrl-scale",t.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(t){this._language=t,this._update()}setUnit(t){this.options.unit=t,this._update()}},FullscreenControl:class{constructor(e){this._fullscreen=!1,e&&e.container&&(e.container instanceof t.window.HTMLElement?this._container=e.container:t.warnOnce("Full screen control 'container' must be a DOM element.")),t.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in t.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in t.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(e){return this._map=e,this._container||(this._container=this._map.getContainer()),this._controlContainer=o("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",t.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,t.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!t.window.document.fullscreenEnabled&&!t.window.document.webkitFullscreenEnabled)}_setupUI(){const e=this._fullscreenButton=o("button","mapboxgl-ctrl-fullscreen",this._controlContainer);o("span","mapboxgl-ctrl-icon",e).setAttribute("aria-hidden","true"),e.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),t.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const t=this._getTitle();this._fullscreenButton.setAttribute("aria-label",t),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",t)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(t.window.document.fullscreenElement||t.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?t.window.document.exitFullscreen?t.window.document.exitFullscreen():t.window.document.webkitCancelFullScreen&&t.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends t.Evented{constructor(e){super(),this.options=t.extend(Object.create(eo),e),t.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(e&&e.className?e.className.trim().split(/\s+/):[])}addTo(e){return this._map&&this.remove(),this._map=e,this.options.closeOnClick&&e.on("preclick",this._onClose),this.options.closeOnMove&&e.on("move",this._onClose),e.on("remove",this.remove),this._update(),e._addPopup(this),this._focusFirstElement(),this._trackPointer?(e.on("mousemove",this._onMouseEvent),e.on("mouseup",this._onMouseEvent),e._canvasContainer.classList.add("mapboxgl-track-pointer")):e.on("move",this._update),this.fire(new t.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const e=this._map;return e&&(e.off("move",this._update),e.off("move",this._onClose),e.off("preclick",this._onClose),e.off("click",this._onClose),e.off("remove",this.remove),e.off("mousemove",this._onMouseEvent),e.off("mouseup",this._onMouseEvent),e.off("drag",this._onMouseEvent),e._canvasContainer&&e._canvasContainer.classList.remove("mapboxgl-track-pointer"),e._removePopup(this),this._map=void 0),this.fire(new t.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(e){this._lngLat=t.LngLat.convert(e),this._pos=null,this._trackPointer=!1,this._update();const i=this._map;return i&&(i.on("move",this._update),i.off("mousemove",this._onMouseEvent),i._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const t=this._map;return t&&(t.off("move",this._update),t.on("mousemove",this._onMouseEvent),t.on("drag",this._onMouseEvent),t._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(e){return this.setDOMContent(t.window.document.createTextNode(e))}setHTML(e){const i=t.window.document.createDocumentFragment(),r=t.window.document.createElement("body");let n;for(r.innerHTML=e;n=r.firstChild,n;)i.appendChild(n);return this.setDOMContent(i)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(t){return this.options.maxWidth=t,this._update(),this}setDOMContent(t){let e=this._content;if(e)for(;e.hasChildNodes();)e.firstChild&&e.removeChild(e.firstChild);else e=this._content=o("div","mapboxgl-popup-content",this._container||void 0);if(e.appendChild(t),this.options.closeButton){const t=this._closeButton=o("button","mapboxgl-popup-close-button",e);t.type="button",t.setAttribute("aria-label","Close popup"),t.setAttribute("aria-hidden","true"),t.innerHTML="&#215;",t.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(t){return this._classList.add(t),this._updateClassList(),this}removeClassName(t){return this._classList.delete(t),this._updateClassList(),this}setOffset(t){return this.options.offset=t,this._update(),this}toggleClassName(t){let e;return this._classList.delete(t)?e=!1:(this._classList.add(t),e=!0),this._updateClassList(),e}_onMouseEvent(t){this._update(t.point)}_getAnchor(t){if(this.options.anchor)return this.options.anchor;const e=this._map,i=this._container,r=this._pos;if(!e||!i||!r)return"bottom";const n=i.offsetWidth,o=i.offsetHeight,s=r.x<n/2,a=r.x>e.transform.width-n/2;if(r.y+t<o)return s?"top-left":a?"top-right":"top";if(r.y>e.transform.height-o){if(s)return"bottom-left";if(a)return"bottom-right"}return s?"left":a?"right":"bottom"}_updateClassList(){const t=this._container;if(!t)return;const e=[...this._classList];e.push("mapboxgl-popup"),this._anchor&&e.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&e.push("mapboxgl-popup-track-pointer"),t.className=e.join(" ")}_update(e){const i=this._map,r=this._content;if(!i||!this._lngLat&&!this._trackPointer||!r)return;let n=this._container;if(n||(n=this._container=o("div","mapboxgl-popup",i.getContainer()),this._tip=o("div","mapboxgl-popup-tip",n),n.appendChild(r)),this.options.maxWidth&&n.style.maxWidth!==this.options.maxWidth&&(n.style.maxWidth=this.options.maxWidth),i.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Jn(this._lngLat,this._pos,i.transform)),!this._trackPointer||e){const t=this._pos=this._trackPointer&&e?e:i.project(this._lngLat),r=ro(this.options.offset),n=this._anchor=this._getAnchor(r.y),o=ro(this.options.offset,n),s=t.add(o).round();i._requestDomTask((()=>{this._container&&n&&(this._container.style.transform=`${Yn[n]} translate(${s.x}px,${s.y}px)`)}))}if(!this._marker&&i._showingGlobe()){const e=t.isLngLatBehindGlobe(i.transform,this._lngLat)?0:1;this._setOpacity(e)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const t=this._container.querySelector(io);t&&t.focus()}_onClose(){this.remove()}_setOpacity(t){this._container&&(this._container.style.opacity=`${t}`),this._content&&(this._content.style.pointerEvents=t?"auto":"none")}},Marker:to,Style:Xe,LngLat:t.LngLat,LngLatBounds:t.LngLatBounds,Point:t.Point,MercatorCoordinate:t.MercatorCoordinate,FreeCameraOptions:Nr,Evented:t.Evented,config:t.config,prewarm:function(){Ot().acquire(Dt)},clearPrewarmedResources:function(){const t=Ut;t&&(t.isPreloaded()&&1===t.numActive()?(t.release(Dt),Ut=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return t.config.ACCESS_TOKEN},set accessToken(e){t.config.ACCESS_TOKEN=e},get baseApiUrl(){return t.config.API_URL},set baseApiUrl(e){t.config.API_URL=e},get workerCount(){return Rt.workerCount},set workerCount(t){Rt.workerCount=t},get maxParallelImageRequests(){return t.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(e){t.config.MAX_PARALLEL_IMAGE_REQUESTS=e},clearStorage(e){t.clearTileCache(e)},workerUrl:"",workerClass:null,setNow:t.exported.setNow,restoreNow:t.exported.restoreNow};return po}));var n=i;return n}();var vt=gt(yt.exports),xt=t({__proto__:null,default:vt},[yt.exports]),bt={exports:{}};bt.exports=function(){var t,e,i;function r(r,n){if(t)if(e){var o="var sharedChunk = {}; ("+t+")(sharedChunk); ("+e+")(sharedChunk);",s={};t(s),i=n(s),"undefined"!=typeof window&&(i.workerUrl=window.URL.createObjectURL(new Blob([o],{type:"text/javascript"})))}else e=n;else t=n}r(["exports"],(function(t){function e(t,e,i,r){return new(i||(i=Promise))((function(n,o){function s(t){try{l(r.next(t))}catch(t){o(t)}}function a(t){try{l(r.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(s,a)}l((r=r.apply(t,e||[])).next())}))}function i(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}"function"==typeof SuppressedError&&SuppressedError;var r=n;function n(t,e){this.x=t,this.y=e}n.prototype={clone:function(){return new n(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,i=t.y-this.y;return e*e+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=e,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),i=Math.sin(t),r=i*this.x+e*this.y;return this.x=e*this.x-i*this.y,this.y=r,this},_rotateAround:function(t,e){var i=Math.cos(t),r=Math.sin(t),n=e.y+r*(this.x-e.x)+i*(this.y-e.y);return this.x=e.x+i*(this.x-e.x)-r*(this.y-e.y),this.y=n,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},n.convert=function(t){return t instanceof n?t:Array.isArray(t)?new n(t[0],t[1]):t};var o=i(r),s=a;function a(t,e,i,r){this.cx=3*t,this.bx=3*(i-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(r-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=e,this.p2x=i,this.p2y=r}a.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,e){if(void 0===e&&(e=1e-6),t<0)return 0;if(t>1)return 1;for(var i=t,r=0;r<8;r++){var n=this.sampleCurveX(i)-t;if(Math.abs(n)<e)return i;var o=this.sampleCurveDerivativeX(i);if(Math.abs(o)<1e-6)break;i-=n/o}var s=0,a=1;for(i=t,r=0;r<20&&(n=this.sampleCurveX(i),!(Math.abs(n-t)<e));r++)t>n?s=i:a=i,i=.5*(a-s)+s;return i},solve:function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))}};var l=i(s);let c,u;function h(){return null==c&&(c="undefined"!=typeof OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof createImageBitmap),c}function d(){if(null==u&&(u=!1,h())){const t=5,e=new OffscreenCanvas(t,t).getContext("2d",{willReadFrequently:!0});if(e){for(let i=0;i<t*t;i++){const r=4*i;e.fillStyle=`rgb(${r},${r+1},${r+2})`,e.fillRect(i%t,Math.floor(i/t),1,1)}const i=e.getImageData(0,0,t,t).data;for(let e=0;e<t*t*4;e++)if(e%4!=3&&i[e]!==e){u=!0;break}}}return u||!1}function p(t,e,i,r){const n=new l(t,e,i,r);return function(t){return n.solve(t)}}const f=p(.25,.1,.25,1);function A(t,e,i){return Math.min(i,Math.max(e,t))}function m(t,e,i){const r=i-e,n=((t-e)%r+r)%r+e;return n===e?i:n}function g(t,...e){for(const i of e)for(const e in i)t[e]=i[e];return t}let _=1;function y(t,e,i){const r={};for(const n in t)r[n]=e.call(i||this,t[n],n,t);return r}function v(t,e,i){const r={};for(const n in t)e.call(i||this,t[n],n,t)&&(r[n]=t[n]);return r}function x(t){return Array.isArray(t)?t.map(x):"object"==typeof t&&t?y(t,x):t}const b={};function w(t){b[t]||("undefined"!=typeof console&&console.warn(t),b[t]=!0)}function T(t,e,i){return(i.y-t.y)*(e.x-t.x)>(e.y-t.y)*(i.x-t.x)}function B(t){let e=0;for(let i,r,n=0,o=t.length,s=o-1;n<o;s=n++)i=t[n],r=t[s],e+=(r.x-i.x)*(i.y+r.y);return e}function E(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}let C=null;function S(t){return"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap}const I="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function M(t,i,r,n,o){return e(this,void 0,void 0,(function*(){if("undefined"==typeof VideoFrame)throw new Error("VideoFrame not supported");const e=new VideoFrame(t,{timestamp:0});try{const s=null==e?void 0:e.format;if(!s||!s.startsWith("BGR")&&!s.startsWith("RGB"))throw new Error(`Unrecognized format ${s}`);const a=s.startsWith("BGR"),l=new Uint8ClampedArray(n*o*4);if(yield e.copyTo(l,function(t,e,i,r,n){const o=4*Math.max(-e,0),s=(Math.max(0,i)-i)*r*4+o,a=4*r,l=Math.max(0,e),c=Math.max(0,i);return{rect:{x:l,y:c,width:Math.min(t.width,e+r)-l,height:Math.min(t.height,i+n)-c},layout:[{offset:s,stride:a}]}}(t,i,r,n,o)),a)for(let t=0;t<l.length;t+=4){const e=l[t];l[t]=l[t+2],l[t+2]=e}return l}finally{e.close()}}))}let k,P,L,z;const F={now:"undefined"!=typeof performance&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(t){const e=requestAnimationFrame(t);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(t,e=0){return this.getImageCanvasContext(t).getImageData(-e,-e,t.width+2*e,t.height+2*e)},getImageCanvasContext(t){const e=window.document.createElement("canvas"),i=e.getContext("2d",{willReadFrequently:!0});if(!i)throw new Error("failed to create canvas 2d context");return e.width=t.width,e.height=t.height,i.drawImage(t,0,0,t.width,t.height),i},resolveURL:t=>(L||(L=document.createElement("a")),L.href=t,L.href),hardwareConcurrency:"undefined"!=typeof navigator&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(null==z&&(z=matchMedia("(prefers-reduced-motion: reduce)")),z.matches)}},D={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};class R extends Error{constructor(t,e,i,r){super(`AJAXError: ${e} (${t}): ${i}`),this.status=t,this.statusText=e,this.url=i,this.body=r}}const U=E()?()=>self.worker&&self.worker.referrer:()=>("blob:"===window.location.protocol?window.parent:window).location.href,O=t=>D.REGISTERED_PROTOCOLS[t.substring(0,t.indexOf("://"))];function N(t,e){const i=new AbortController,r=new Request(t.url,{method:t.method||"GET",body:t.body,credentials:t.credentials,headers:t.headers,cache:t.cache,referrer:U(),signal:i.signal});let n=!1,o=!1;return"json"===t.type&&r.headers.set("Accept","application/json"),o||fetch(r).then((i=>i.ok?(i=>{("arrayBuffer"===t.type||"image"===t.type?i.arrayBuffer():"json"===t.type?i.json():i.text()).then((t=>{o||(n=!0,e(null,t,i.headers.get("Cache-Control"),i.headers.get("Expires")))})).catch((t=>{o||e(new Error(t.message))}))})(i):i.blob().then((r=>e(new R(i.status,i.statusText,t.url,r)))))).catch((t=>{20!==t.code&&e(new Error(t.message))})),{cancel:()=>{o=!0,n||i.abort()}}}const Q=function(t,e){if(/:\/\//.test(t.url)&&!/^https?:|^file:/.test(t.url)){if(E()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,e);if(!E())return(O(t.url)||N)(t,e)}if(!(/^file:/.test(i=t.url)||/^file:/.test(U())&&!/^\w+:/.test(i))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return N(t,e);if(E()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,e,void 0,!0)}var i;return function(t,e){const i=new XMLHttpRequest;i.open(t.method||"GET",t.url,!0),"arrayBuffer"!==t.type&&"image"!==t.type||(i.responseType="arraybuffer");for(const e in t.headers)i.setRequestHeader(e,t.headers[e]);return"json"===t.type&&(i.responseType="text",i.setRequestHeader("Accept","application/json")),i.withCredentials="include"===t.credentials,i.onerror=()=>{e(new Error(i.statusText))},i.onload=()=>{if((i.status>=200&&i.status<300||0===i.status)&&null!==i.response){let r=i.response;if("json"===t.type)try{r=JSON.parse(i.response)}catch(t){return e(t)}e(null,r,i.getResponseHeader("Cache-Control"),i.getResponseHeader("Expires"))}else{const r=new Blob([i.response],{type:i.getResponseHeader("Content-Type")});e(new R(i.status,i.statusText,t.url,r))}},i.send(t.body),{cancel:()=>i.abort()}}(t,e)},V=function(t,e){return Q(g(t,{type:"arrayBuffer"}),e)};function j(t){if(!t||t.indexOf("://")<=0||0===t.indexOf("data:image/")||0===t.indexOf("blob:"))return!0;const e=new URL(t),i=window.location;return e.protocol===i.protocol&&e.host===i.host}function H(t,e,i){i[t]&&-1!==i[t].indexOf(e)||(i[t]=i[t]||[],i[t].push(e))}function G(t,e,i){if(i&&i[t]){const r=i[t].indexOf(e);-1!==r&&i[t].splice(r,1)}}class ${constructor(t,e={}){g(this,e),this.type=t}}class Z extends ${constructor(t,e={}){super("error",g({error:t},e))}}class q{on(t,e){return this._listeners=this._listeners||{},H(t,e,this._listeners),this}off(t,e){return G(t,e,this._listeners),G(t,e,this._oneTimeListeners),this}once(t,e){return e?(this._oneTimeListeners=this._oneTimeListeners||{},H(t,e,this._oneTimeListeners),this):new Promise((e=>this.once(t,e)))}fire(t,e){"string"==typeof t&&(t=new $(t,e||{}));const i=t.type;if(this.listens(i)){t.target=this;const e=this._listeners&&this._listeners[i]?this._listeners[i].slice():[];for(const i of e)i.call(this,t);const r=this._oneTimeListeners&&this._oneTimeListeners[i]?this._oneTimeListeners[i].slice():[];for(const e of r)G(i,e,this._oneTimeListeners),e.call(this,t);const n=this._eventedParent;n&&(g(t,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),n.fire(t))}else t instanceof Z&&console.error(t.error);return this}listens(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)}setEventedParent(t,e){return this._eventedParent=t,this._eventedParentData=e,this}}var K={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const W=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function X(t,e){const i={};for(const e in t)"ref"!==e&&(i[e]=t[e]);return W.forEach((t=>{t in e&&(i[t]=e[t])})),i}function J(t,e){if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let i=0;i<t.length;i++)if(!J(t[i],e[i]))return!1;return!0}if("object"==typeof t&&null!==t&&null!==e){if("object"!=typeof e)return!1;if(Object.keys(t).length!==Object.keys(e).length)return!1;for(const i in t)if(!J(t[i],e[i]))return!1;return!0}return t===e}const Y={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function tt(t,e,i){i.push({command:Y.addSource,args:[t,e[t]]})}function et(t,e,i){e.push({command:Y.removeSource,args:[t]}),i[t]=!0}function it(t,e,i,r){et(t,i,r),tt(t,e,i)}function rt(t,e,i){let r;for(r in t[i])if(Object.prototype.hasOwnProperty.call(t[i],r)&&"data"!==r&&!J(t[i][r],e[i][r]))return!1;for(r in e[i])if(Object.prototype.hasOwnProperty.call(e[i],r)&&"data"!==r&&!J(t[i][r],e[i][r]))return!1;return!0}function nt(t,e,i,r,n,o){let s;for(s in e=e||{},t=t||{})Object.prototype.hasOwnProperty.call(t,s)&&(J(t[s],e[s])||i.push({command:o,args:[r,s,e[s],n]}));for(s in e)Object.prototype.hasOwnProperty.call(e,s)&&!Object.prototype.hasOwnProperty.call(t,s)&&(J(t[s],e[s])||i.push({command:o,args:[r,s,e[s],n]}))}function ot(t){return t.id}function st(t,e){return t[e.id]=e,t}class at{constructor(t,e,i,r){this.message=(t?`${t}: `:"")+i,r&&(this.identifier=r),null!=e&&e.__line__&&(this.line=e.__line__)}}function lt(t,...e){for(const i of e)for(const e in i)t[e]=i[e];return t}class ct extends Error{constructor(t,e){super(e),this.message=e,this.key=t}}class ut{constructor(t,e=[]){this.parent=t,this.bindings={};for(const[t,i]of e)this.bindings[t]=i}concat(t){return new ut(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const ht={kind:"null"},dt={kind:"number"},pt={kind:"string"},ft={kind:"boolean"},At={kind:"color"},mt={kind:"object"},gt={kind:"value"},_t={kind:"collator"},yt={kind:"formatted"},vt={kind:"padding"},xt={kind:"resolvedImage"},bt={kind:"variableAnchorOffsetCollection"};function wt(t,e){return{kind:"array",itemType:t,N:e}}function Tt(t){if("array"===t.kind){const e=Tt(t.itemType);return"number"==typeof t.N?`array<${e}, ${t.N}>`:"value"===t.itemType.kind?"array":`array<${e}>`}return t.kind}const Bt=[ht,dt,pt,ft,At,yt,mt,wt(gt),vt,xt,bt];function Et(t,e){if("error"===e.kind)return null;if("array"===t.kind){if("array"===e.kind&&(0===e.N&&"value"===e.itemType.kind||!Et(t.itemType,e.itemType))&&("number"!=typeof t.N||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if("value"===t.kind)for(const t of Bt)if(!Et(t,e))return null}return`Expected ${Tt(t)} but found ${Tt(e)} instead.`}function Ct(t,e){return e.some((e=>e.kind===t.kind))}function St(t,e){return e.some((e=>"null"===e?null===t:"array"===e?Array.isArray(t):"object"===e?t&&!Array.isArray(t)&&"object"==typeof t:e===typeof t))}function It(t,e){return"array"===t.kind&&"array"===e.kind?t.itemType.kind===e.itemType.kind&&"number"==typeof t.N:t.kind===e.kind}const Mt=.96422,kt=.82521,Pt=4/29,Lt=6/29,zt=3*Lt*Lt,Ft=Lt*Lt*Lt,Dt=Math.PI/180,Rt=180/Math.PI;function Ut(t){return(t%=360)<0&&(t+=360),t}function Ot([t,e,i,r]){let n,o;const s=Qt((.2225045*(t=Nt(t))+.7168786*(e=Nt(e))+.0606169*(i=Nt(i)))/1);t===e&&e===i?n=o=s:(n=Qt((.4360747*t+.3850649*e+.1430804*i)/Mt),o=Qt((.0139322*t+.0971045*e+.7141733*i)/kt));const a=116*s-16;return[a<0?0:a,500*(n-s),200*(s-o),r]}function Nt(t){return t<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function Qt(t){return t>Ft?Math.pow(t,1/3):t/zt+Pt}function Vt([t,e,i,r]){let n=(t+16)/116,o=isNaN(e)?n:n+e/500,s=isNaN(i)?n:n-i/200;return n=1*Ht(n),o=Mt*Ht(o),s=kt*Ht(s),[jt(3.1338561*o-1.6168667*n-.4906146*s),jt(-.9787684*o+1.9161415*n+.033454*s),jt(.0719453*o-.2289914*n+1.4052427*s),r]}function jt(t){return(t=t<=.00304?12.92*t:1.055*Math.pow(t,1/2.4)-.055)<0?0:t>1?1:t}function Ht(t){return t>Lt?t*t*t:zt*(t-Pt)}function Gt(t){return parseInt(t.padEnd(2,t),16)/255}function $t(t,e){return Zt(e?t/100:t,0,1)}function Zt(t,e,i){return Math.min(Math.max(e,t),i)}function qt(t){return!t.some(Number.isNaN)}const Kt={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class Wt{constructor(t,e,i,r=1,n=!0){this.r=t,this.g=e,this.b=i,this.a=r,n||(this.r*=r,this.g*=r,this.b*=r,r||this.overwriteGetter("rgb",[t,e,i,r]))}static parse(t){if(t instanceof Wt)return t;if("string"!=typeof t)return;const e=function(t){if("transparent"===(t=t.toLowerCase().trim()))return[0,0,0,0];const e=Kt[t];if(e){const[t,i,r]=e;return[t/255,i/255,r/255,1]}if(t.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(t)){const e=t.length<6?1:2;let i=1;return[Gt(t.slice(i,i+=e)),Gt(t.slice(i,i+=e)),Gt(t.slice(i,i+=e)),Gt(t.slice(i,i+e)||"ff")]}if(t.startsWith("rgb")){const e=t.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(e){const[t,i,r,n,o,s,a,l,c,u,h,d]=e,p=[n||" ",a||" ",u].join("");if("  "===p||"  /"===p||",,"===p||",,,"===p){const t=[r,s,c].join(""),e="%%%"===t?100:""===t?255:0;if(e){const t=[Zt(+i/e,0,1),Zt(+o/e,0,1),Zt(+l/e,0,1),h?$t(+h,d):1];if(qt(t))return t}}return}}const i=t.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(i){const[t,e,r,n,o,s,a,l,c]=i,u=[r||" ",o||" ",a].join("");if("  "===u||"  /"===u||",,"===u||",,,"===u){const t=[+e,Zt(+n,0,100),Zt(+s,0,100),l?$t(+l,c):1];if(qt(t))return function([t,e,i,r]){function n(r){const n=(r+t/30)%12,o=e*Math.min(i,1-i);return i-o*Math.max(-1,Math.min(n-3,9-n,1))}return t=Ut(t),e/=100,i/=100,[n(0),n(8),n(4),r]}(t)}}}(t);return e?new Wt(...e,!1):void 0}get rgb(){const{r:t,g:e,b:i,a:r}=this,n=r||1/0;return this.overwriteGetter("rgb",[t/n,e/n,i/n,r])}get hcl(){return this.overwriteGetter("hcl",function(t){const[e,i,r,n]=Ot(t),o=Math.sqrt(i*i+r*r);return[Math.round(1e4*o)?Ut(Math.atan2(r,i)*Rt):NaN,o,e,n]}(this.rgb))}get lab(){return this.overwriteGetter("lab",Ot(this.rgb))}overwriteGetter(t,e){return Object.defineProperty(this,t,{value:e}),e}toString(){const[t,e,i,r]=this.rgb;return`rgba(${[t,e,i].map((t=>Math.round(255*t))).join(",")},${r})`}}Wt.black=new Wt(0,0,0,1),Wt.white=new Wt(1,1,1,1),Wt.transparent=new Wt(0,0,0,0),Wt.red=new Wt(1,0,0,1);class Xt{constructor(t,e,i){this.sensitivity=t?e?"variant":"case":e?"accent":"base",this.locale=i,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,e){return this.collator.compare(t,e)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Jt{constructor(t,e,i,r,n){this.text=t,this.image=e,this.scale=i,this.fontStack=r,this.textColor=n}}class Yt{constructor(t){this.sections=t}static fromString(t){return new Yt([new Jt(t,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some((t=>0!==t.text.length||t.image&&0!==t.image.name.length))}static factory(t){return t instanceof Yt?t:Yt.fromString(t)}toString(){return 0===this.sections.length?"":this.sections.map((t=>t.text)).join("")}}class te{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof te)return t;if("number"==typeof t)return new te([t,t,t,t]);if(Array.isArray(t)&&!(t.length<1||t.length>4)){for(const e of t)if("number"!=typeof e)return;switch(t.length){case 1:t=[t[0],t[0],t[0],t[0]];break;case 2:t=[t[0],t[1],t[0],t[1]];break;case 3:t=[t[0],t[1],t[2],t[1]]}return new te(t)}}toString(){return JSON.stringify(this.values)}}const ee=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class ie{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof ie)return t;if(Array.isArray(t)&&!(t.length<1)&&t.length%2==0){for(let e=0;e<t.length;e+=2){const i=t[e],r=t[e+1];if("string"!=typeof i||!ee.has(i))return;if(!Array.isArray(r)||2!==r.length||"number"!=typeof r[0]||"number"!=typeof r[1])return}return new ie(t)}}toString(){return JSON.stringify(this.values)}}class re{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new re({name:t,available:!1}):null}}function ne(t,e,i,r){return"number"==typeof t&&t>=0&&t<=255&&"number"==typeof e&&e>=0&&e<=255&&"number"==typeof i&&i>=0&&i<=255?void 0===r||"number"==typeof r&&r>=0&&r<=1?null:`Invalid rgba value [${[t,e,i,r].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof r?[t,e,i,r]:[t,e,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function oe(t){if(null===t||"string"==typeof t||"boolean"==typeof t||"number"==typeof t||t instanceof Wt||t instanceof Xt||t instanceof Yt||t instanceof te||t instanceof ie||t instanceof re)return!0;if(Array.isArray(t)){for(const e of t)if(!oe(e))return!1;return!0}if("object"==typeof t){for(const e in t)if(!oe(t[e]))return!1;return!0}return!1}function se(t){if(null===t)return ht;if("string"==typeof t)return pt;if("boolean"==typeof t)return ft;if("number"==typeof t)return dt;if(t instanceof Wt)return At;if(t instanceof Xt)return _t;if(t instanceof Yt)return yt;if(t instanceof te)return vt;if(t instanceof ie)return bt;if(t instanceof re)return xt;if(Array.isArray(t)){const e=t.length;let i;for(const e of t){const t=se(e);if(i){if(i===t)continue;i=gt;break}i=t}return wt(i||gt,e)}return mt}function ae(t){const e=typeof t;return null===t?"":"string"===e||"number"===e||"boolean"===e?String(t):t instanceof Wt||t instanceof Yt||t instanceof te||t instanceof ie||t instanceof re?t.toString():JSON.stringify(t)}class le{constructor(t,e){this.type=t,this.value=e}static parse(t,e){if(2!==t.length)return e.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!oe(t[1]))return e.error("invalid value");const i=t[1];let r=se(i);const n=e.expectedType;return"array"!==r.kind||0!==r.N||!n||"array"!==n.kind||"number"==typeof n.N&&0!==n.N||(r=n),new le(r,i)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class ce{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}}const ue={string:pt,number:dt,boolean:ft,object:mt};class he{constructor(t,e){this.type=t,this.args=e}static parse(t,e){if(t.length<2)return e.error("Expected at least one argument.");let i,r=1;const n=t[0];if("array"===n){let n,o;if(t.length>2){const i=t[1];if("string"!=typeof i||!(i in ue)||"object"===i)return e.error('The item type argument of "array" must be one of string, number, boolean',1);n=ue[i],r++}else n=gt;if(t.length>3){if(null!==t[2]&&("number"!=typeof t[2]||t[2]<0||t[2]!==Math.floor(t[2])))return e.error('The length argument to "array" must be a positive integer literal',2);o=t[2],r++}i=wt(n,o)}else{if(!ue[n])throw new Error(`Types doesn't contain name = ${n}`);i=ue[n]}const o=[];for(;r<t.length;r++){const i=e.parse(t[r],r,gt);if(!i)return null;o.push(i)}return new he(i,o)}evaluate(t){for(let e=0;e<this.args.length;e++){const i=this.args[e].evaluate(t);if(!Et(this.type,se(i)))return i;if(e===this.args.length-1)throw new ce(`Expected value to be of type ${Tt(this.type)}, but found ${Tt(se(i))} instead.`)}throw new Error}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}}const de={"to-boolean":ft,"to-color":At,"to-number":dt,"to-string":pt};class pe{constructor(t,e){this.type=t,this.args=e}static parse(t,e){if(t.length<2)return e.error("Expected at least one argument.");const i=t[0];if(!de[i])throw new Error(`Can't parse ${i} as it is not part of the known types`);if(("to-boolean"===i||"to-string"===i)&&2!==t.length)return e.error("Expected one argument.");const r=de[i],n=[];for(let i=1;i<t.length;i++){const r=e.parse(t[i],i,gt);if(!r)return null;n.push(r)}return new pe(r,n)}evaluate(t){switch(this.type.kind){case"boolean":return Boolean(this.args[0].evaluate(t));case"color":{let e,i;for(const r of this.args){if(e=r.evaluate(t),i=null,e instanceof Wt)return e;if("string"==typeof e){const i=t.parseColor(e);if(i)return i}else if(Array.isArray(e)&&(i=e.length<3||e.length>4?`Invalid rbga value ${JSON.stringify(e)}: expected an array containing either three or four numeric values.`:ne(e[0],e[1],e[2],e[3]),!i))return new Wt(e[0]/255,e[1]/255,e[2]/255,e[3])}throw new ce(i||`Could not parse color from value '${"string"==typeof e?e:JSON.stringify(e)}'`)}case"padding":{let e;for(const i of this.args){e=i.evaluate(t);const r=te.parse(e);if(r)return r}throw new ce(`Could not parse padding from value '${"string"==typeof e?e:JSON.stringify(e)}'`)}case"variableAnchorOffsetCollection":{let e;for(const i of this.args){e=i.evaluate(t);const r=ie.parse(e);if(r)return r}throw new ce(`Could not parse variableAnchorOffsetCollection from value '${"string"==typeof e?e:JSON.stringify(e)}'`)}case"number":{let e=null;for(const i of this.args){if(e=i.evaluate(t),null===e)return 0;const r=Number(e);if(!isNaN(r))return r}throw new ce(`Could not convert ${JSON.stringify(e)} to number.`)}case"formatted":return Yt.fromString(ae(this.args[0].evaluate(t)));case"resolvedImage":return re.fromString(ae(this.args[0].evaluate(t)));default:return ae(this.args[0].evaluate(t))}}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}}const fe=["Unknown","Point","LineString","Polygon"];class Ae{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?fe[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(t){let e=this._parseColorCache[t];return e||(e=this._parseColorCache[t]=Wt.parse(t)),e}}class me{constructor(t,e,i=[],r,n=new ut,o=[]){this.registry=t,this.path=i,this.key=i.map((t=>`[${t}]`)).join(""),this.scope=n,this.errors=o,this.expectedType=r,this._isConstant=e}parse(t,e,i,r,n={}){return e?this.concat(e,i,r)._parse(t,n):this._parse(t,n)}_parse(t,e){function i(t,e,i){return"assert"===i?new he(e,[t]):"coerce"===i?new pe(e,[t]):t}if(null!==t&&"string"!=typeof t&&"boolean"!=typeof t&&"number"!=typeof t||(t=["literal",t]),Array.isArray(t)){if(0===t.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const r=t[0];if("string"!=typeof r)return this.error(`Expression name must be a string, but found ${typeof r} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const n=this.registry[r];if(n){let r=n.parse(t,this);if(!r)return null;if(this.expectedType){const t=this.expectedType,n=r.type;if("string"!==t.kind&&"number"!==t.kind&&"boolean"!==t.kind&&"object"!==t.kind&&"array"!==t.kind||"value"!==n.kind)if("color"!==t.kind&&"formatted"!==t.kind&&"resolvedImage"!==t.kind||"value"!==n.kind&&"string"!==n.kind)if("padding"!==t.kind||"value"!==n.kind&&"number"!==n.kind&&"array"!==n.kind)if("variableAnchorOffsetCollection"!==t.kind||"value"!==n.kind&&"array"!==n.kind){if(this.checkSubtype(t,n))return null}else r=i(r,t,e.typeAnnotation||"coerce");else r=i(r,t,e.typeAnnotation||"coerce");else r=i(r,t,e.typeAnnotation||"coerce");else r=i(r,t,e.typeAnnotation||"assert")}if(!(r instanceof le)&&"resolvedImage"!==r.type.kind&&this._isConstant(r)){const e=new Ae;try{r=new le(r.type,r.evaluate(e))}catch(t){return this.error(t.message),null}}return r}return this.error(`Unknown expression "${r}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===t?"'undefined' value invalid. Use null instead.":"object"==typeof t?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,e,i){const r="number"==typeof t?this.path.concat(t):this.path,n=i?this.scope.concat(i):this.scope;return new me(this.registry,this._isConstant,r,e||null,n,this.errors)}error(t,...e){const i=`${this.key}${e.map((t=>`[${t}]`)).join("")}`;this.errors.push(new ct(i,t))}checkSubtype(t,e){const i=Et(t,e);return i&&this.error(i),i}}class ge{constructor(t,e,i){this.type=_t,this.locale=i,this.caseSensitive=t,this.diacriticSensitive=e}static parse(t,e){if(2!==t.length)return e.error("Expected one argument.");const i=t[1];if("object"!=typeof i||Array.isArray(i))return e.error("Collator options argument must be an object.");const r=e.parse(void 0!==i["case-sensitive"]&&i["case-sensitive"],1,ft);if(!r)return null;const n=e.parse(void 0!==i["diacritic-sensitive"]&&i["diacritic-sensitive"],1,ft);if(!n)return null;let o=null;return i.locale&&(o=e.parse(i.locale,1,pt),!o)?null:new ge(r,n,o)}evaluate(t){return new Xt(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}}const _e=8192;function ye(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function ve(t,e){return!(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function xe(t,e){const i=(180+t[0])/360,r=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,n=Math.pow(2,e.z);return[Math.round(i*n*_e),Math.round(r*n*_e)]}function be(t,e,i){const r=t[0]-e[0],n=t[1]-e[1],o=t[0]-i[0],s=t[1]-i[1];return r*s-o*n==0&&r*o<=0&&n*s<=0}function we(t,e){let i=!1;for(let s=0,a=e.length;s<a;s++){const a=e[s];for(let e=0,s=a.length;e<s-1;e++){if(be(t,a[e],a[e+1]))return!1;(n=a[e])[1]>(r=t)[1]!=(o=a[e+1])[1]>r[1]&&r[0]<(o[0]-n[0])*(r[1]-n[1])/(o[1]-n[1])+n[0]&&(i=!i)}}var r,n,o;return i}function Te(t,e){for(let i=0;i<e.length;i++)if(we(t,e[i]))return!0;return!1}function Be(t,e,i,r){const n=r[0]-i[0],o=r[1]-i[1],s=(t[0]-i[0])*o-n*(t[1]-i[1]),a=(e[0]-i[0])*o-n*(e[1]-i[1]);return s>0&&a<0||s<0&&a>0}function Ee(t,e,i){for(const c of i)for(let i=0;i<c.length-1;++i)if(0!=(a=[(s=c[i+1])[0]-(o=c[i])[0],s[1]-o[1]])[0]*(l=[(n=e)[0]-(r=t)[0],n[1]-r[1]])[1]-a[1]*l[0]&&Be(r,n,o,s)&&Be(o,s,r,n))return!0;var r,n,o,s,a,l;return!1}function Ce(t,e){for(let i=0;i<t.length;++i)if(!we(t[i],e))return!1;for(let i=0;i<t.length-1;++i)if(Ee(t[i],t[i+1],e))return!1;return!0}function Se(t,e){for(let i=0;i<e.length;i++)if(Ce(t,e[i]))return!0;return!1}function Ie(t,e,i){const r=[];for(let n=0;n<t.length;n++){const o=[];for(let r=0;r<t[n].length;r++){const s=xe(t[n][r],i);ye(e,s),o.push(s)}r.push(o)}return r}function Me(t,e,i){const r=[];for(let n=0;n<t.length;n++){const o=Ie(t[n],e,i);r.push(o)}return r}function ke(t,e,i,r){if(t[0]<i[0]||t[0]>i[2]){const e=.5*r;let n=t[0]-i[0]>e?-r:i[0]-t[0]>e?r:0;0===n&&(n=t[0]-i[2]>e?-r:i[2]-t[0]>e?r:0),t[0]+=n}ye(e,t)}function Pe(t,e,i,r){const n=Math.pow(2,r.z)*_e,o=[r.x*_e,r.y*_e],s=[];for(const r of t)for(const t of r){const r=[t.x+o[0],t.y+o[1]];ke(r,e,i,n),s.push(r)}return s}function Le(t,e,i,r){const n=Math.pow(2,r.z)*_e,o=[r.x*_e,r.y*_e],s=[];for(const i of t){const t=[];for(const r of i){const i=[r.x+o[0],r.y+o[1]];ye(e,i),t.push(i)}s.push(t)}if(e[2]-e[0]<=n/2){(a=e)[0]=a[1]=1/0,a[2]=a[3]=-1/0;for(const t of s)for(const r of t)ke(r,e,i,n)}var a;return s}class ze{constructor(t,e){this.type=ft,this.geojson=t,this.geometries=e}static parse(t,e){if(2!==t.length)return e.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(oe(t[1])){const e=t[1];if("FeatureCollection"===e.type)for(let t=0;t<e.features.length;++t){const i=e.features[t].geometry.type;if("Polygon"===i||"MultiPolygon"===i)return new ze(e,e.features[t].geometry)}else if("Feature"===e.type){const t=e.geometry.type;if("Polygon"===t||"MultiPolygon"===t)return new ze(e,e.geometry)}else if("Polygon"===e.type||"MultiPolygon"===e.type)return new ze(e,e)}return e.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(null!=t.geometry()&&null!=t.canonicalID()){if("Point"===t.geometryType())return function(t,e){const i=[1/0,1/0,-1/0,-1/0],r=[1/0,1/0,-1/0,-1/0],n=t.canonicalID();if("Polygon"===e.type){const o=Ie(e.coordinates,r,n),s=Pe(t.geometry(),i,r,n);if(!ve(i,r))return!1;for(const t of s)if(!we(t,o))return!1}if("MultiPolygon"===e.type){const o=Me(e.coordinates,r,n),s=Pe(t.geometry(),i,r,n);if(!ve(i,r))return!1;for(const t of s)if(!Te(t,o))return!1}return!0}(t,this.geometries);if("LineString"===t.geometryType())return function(t,e){const i=[1/0,1/0,-1/0,-1/0],r=[1/0,1/0,-1/0,-1/0],n=t.canonicalID();if("Polygon"===e.type){const o=Ie(e.coordinates,r,n),s=Le(t.geometry(),i,r,n);if(!ve(i,r))return!1;for(const t of s)if(!Ce(t,o))return!1}if("MultiPolygon"===e.type){const o=Me(e.coordinates,r,n),s=Le(t.geometry(),i,r,n);if(!ve(i,r))return!1;for(const t of s)if(!Se(t,o))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class Fe{constructor(t,e){this.type=e.type,this.name=t,this.boundExpression=e}static parse(t,e){if(2!==t.length||"string"!=typeof t[1])return e.error("'var' expression requires exactly one string literal argument.");const i=t[1];return e.scope.has(i)?new Fe(i,e.scope.get(i)):e.error(`Unknown variable "${i}". Make sure "${i}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}}class De{constructor(t,e,i,r){this.name=t,this.type=e,this._evaluate=i,this.args=r}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}static parse(t,e){const i=t[0],r=De.definitions[i];if(!r)return e.error(`Unknown expression "${i}". If you wanted a literal array, use ["literal", [...]].`,0);const n=Array.isArray(r)?r[0]:r.type,o=Array.isArray(r)?[[r[1],r[2]]]:r.overloads,s=o.filter((([e])=>!Array.isArray(e)||e.length===t.length-1));let a=null;for(const[r,o]of s){a=new me(e.registry,Re,e.path,null,e.scope);const s=[];let l=!1;for(let e=1;e<t.length;e++){const i=t[e],n=Array.isArray(r)?r[e-1]:r.type,o=a.parse(i,1+s.length,n);if(!o){l=!0;break}s.push(o)}if(!l)if(Array.isArray(r)&&r.length!==s.length)a.error(`Expected ${r.length} arguments, but found ${s.length} instead.`);else{for(let t=0;t<s.length;t++){const e=Array.isArray(r)?r[t]:r.type,i=s[t];a.concat(t+1).checkSubtype(e,i.type)}if(0===a.errors.length)return new De(i,n,o,s)}}if(1===s.length)e.errors.push(...a.errors);else{const i=(s.length?s:o).map((([t])=>{return e=t,Array.isArray(e)?`(${e.map(Tt).join(", ")})`:`(${Tt(e.type)}...)`;var e})).join(" | "),r=[];for(let i=1;i<t.length;i++){const n=e.parse(t[i],1+r.length);if(!n)return null;r.push(Tt(n.type))}e.error(`Expected arguments of type ${i}, but found (${r.join(", ")}) instead.`)}return null}static register(t,e){De.definitions=e;for(const i in e)t[i]=De}}function Re(t){if(t instanceof Fe)return Re(t.boundExpression);if(t instanceof De&&"error"===t.name)return!1;if(t instanceof ge)return!1;if(t instanceof ze)return!1;const e=t instanceof pe||t instanceof he;let i=!0;return t.eachChild((t=>{i=e?i&&Re(t):i&&t instanceof le})),!!i&&Ue(t)&&Ne(t,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Ue(t){if(t instanceof De){if("get"===t.name&&1===t.args.length)return!1;if("feature-state"===t.name)return!1;if("has"===t.name&&1===t.args.length)return!1;if("properties"===t.name||"geometry-type"===t.name||"id"===t.name)return!1;if(/^filter-/.test(t.name))return!1}if(t instanceof ze)return!1;let e=!0;return t.eachChild((t=>{e&&!Ue(t)&&(e=!1)})),e}function Oe(t){if(t instanceof De&&"feature-state"===t.name)return!1;let e=!0;return t.eachChild((t=>{e&&!Oe(t)&&(e=!1)})),e}function Ne(t,e){if(t instanceof De&&e.indexOf(t.name)>=0)return!1;let i=!0;return t.eachChild((t=>{i&&!Ne(t,e)&&(i=!1)})),i}function Qe(t,e){const i=t.length-1;let r,n,o=0,s=i,a=0;for(;o<=s;)if(a=Math.floor((o+s)/2),r=t[a],n=t[a+1],r<=e){if(a===i||e<n)return a;o=a+1}else{if(!(r>e))throw new ce("Input is not a number.");s=a-1}return 0}class Ve{constructor(t,e,i){this.type=t,this.input=e,this.labels=[],this.outputs=[];for(const[t,e]of i)this.labels.push(t),this.outputs.push(e)}static parse(t,e){if(t.length-1<4)return e.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return e.error("Expected an even number of arguments.");const i=e.parse(t[1],1,dt);if(!i)return null;const r=[];let n=null;e.expectedType&&"value"!==e.expectedType.kind&&(n=e.expectedType);for(let i=1;i<t.length;i+=2){const o=1===i?-1/0:t[i],s=t[i+1],a=i,l=i+1;if("number"!=typeof o)return e.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',a);if(r.length&&r[r.length-1][0]>=o)return e.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',a);const c=e.parse(s,l,n);if(!c)return null;n=n||c.type,r.push([o,c])}return new Ve(n,i,r)}evaluate(t){const e=this.labels,i=this.outputs;if(1===e.length)return i[0].evaluate(t);const r=this.input.evaluate(t);if(r<=e[0])return i[0].evaluate(t);const n=e.length;return r>=e[n-1]?i[n-1].evaluate(t):i[Qe(e,r)].evaluate(t)}eachChild(t){t(this.input);for(const e of this.outputs)t(e)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))}}function je(t,e,i){return t+i*(e-t)}function He(t,e,i){return t.map(((t,r)=>je(t,e[r],i)))}const Ge={number:je,color:function(t,e,i,r="rgb"){switch(r){case"rgb":{const[r,n,o,s]=He(t.rgb,e.rgb,i);return new Wt(r,n,o,s,!1)}case"hcl":{const[r,n,o,s]=t.hcl,[a,l,c,u]=e.hcl;let h,d;if(isNaN(r)||isNaN(a))isNaN(r)?isNaN(a)?h=NaN:(h=a,1!==o&&0!==o||(d=l)):(h=r,1!==c&&0!==c||(d=n));else{let t=a-r;a>r&&t>180?t-=360:a<r&&r-a>180&&(t+=360),h=r+i*t}const[p,f,A,m]=function([t,e,i,r]){return t=isNaN(t)?0:t*Dt,Vt([i,Math.cos(t)*e,Math.sin(t)*e,r])}([h,null!=d?d:je(n,l,i),je(o,c,i),je(s,u,i)]);return new Wt(p,f,A,m,!1)}case"lab":{const[r,n,o,s]=Vt(He(t.lab,e.lab,i));return new Wt(r,n,o,s,!1)}}},array:He,padding:function(t,e,i){return new te(He(t.values,e.values,i))},variableAnchorOffsetCollection:function(t,e,i){const r=t.values,n=e.values;if(r.length!==n.length)throw new ce(`Cannot interpolate values of different length. from: ${t.toString()}, to: ${e.toString()}`);const o=[];for(let t=0;t<r.length;t+=2){if(r[t]!==n[t])throw new ce(`Cannot interpolate values containing mismatched anchors. from[${t}]: ${r[t]}, to[${t}]: ${n[t]}`);o.push(r[t]);const[e,s]=r[t+1],[a,l]=n[t+1];o.push([je(e,a,i),je(s,l,i)])}return new ie(o)}};class $e{constructor(t,e,i,r,n){this.type=t,this.operator=e,this.interpolation=i,this.input=r,this.labels=[],this.outputs=[];for(const[t,e]of n)this.labels.push(t),this.outputs.push(e)}static interpolationFactor(t,e,i,r){let n=0;if("exponential"===t.name)n=Ze(e,t.base,i,r);else if("linear"===t.name)n=Ze(e,1,i,r);else if("cubic-bezier"===t.name){const o=t.controlPoints;n=new l(o[0],o[1],o[2],o[3]).solve(Ze(e,1,i,r))}return n}static parse(t,e){let[i,r,n,...o]=t;if(!Array.isArray(r)||0===r.length)return e.error("Expected an interpolation type expression.",1);if("linear"===r[0])r={name:"linear"};else if("exponential"===r[0]){const t=r[1];if("number"!=typeof t)return e.error("Exponential interpolation requires a numeric base.",1,1);r={name:"exponential",base:t}}else{if("cubic-bezier"!==r[0])return e.error(`Unknown interpolation type ${String(r[0])}`,1,0);{const t=r.slice(1);if(4!==t.length||t.some((t=>"number"!=typeof t||t<0||t>1)))return e.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);r={name:"cubic-bezier",controlPoints:t}}}if(t.length-1<4)return e.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return e.error("Expected an even number of arguments.");if(n=e.parse(n,2,dt),!n)return null;const s=[];let a=null;"interpolate-hcl"===i||"interpolate-lab"===i?a=At:e.expectedType&&"value"!==e.expectedType.kind&&(a=e.expectedType);for(let t=0;t<o.length;t+=2){const i=o[t],r=o[t+1],n=t+3,l=t+4;if("number"!=typeof i)return e.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',n);if(s.length&&s[s.length-1][0]>=i)return e.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',n);const c=e.parse(r,l,a);if(!c)return null;a=a||c.type,s.push([i,c])}return It(a,dt)||It(a,At)||It(a,vt)||It(a,bt)||It(a,wt(dt))?new $e(a,i,r,n,s):e.error(`Type ${Tt(a)} is not interpolatable.`)}evaluate(t){const e=this.labels,i=this.outputs;if(1===e.length)return i[0].evaluate(t);const r=this.input.evaluate(t);if(r<=e[0])return i[0].evaluate(t);const n=e.length;if(r>=e[n-1])return i[n-1].evaluate(t);const o=Qe(e,r),s=$e.interpolationFactor(this.interpolation,r,e[o],e[o+1]),a=i[o].evaluate(t),l=i[o+1].evaluate(t);switch(this.operator){case"interpolate":return Ge[this.type.kind](a,l,s);case"interpolate-hcl":return Ge.color(a,l,s,"hcl");case"interpolate-lab":return Ge.color(a,l,s,"lab")}}eachChild(t){t(this.input);for(const e of this.outputs)t(e)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))}}function Ze(t,e,i,r){const n=r-i,o=t-i;return 0===n?0:1===e?o/n:(Math.pow(e,o)-1)/(Math.pow(e,n)-1)}class qe{constructor(t,e){this.type=t,this.args=e}static parse(t,e){if(t.length<2)return e.error("Expectected at least one argument.");let i=null;const r=e.expectedType;r&&"value"!==r.kind&&(i=r);const n=[];for(const r of t.slice(1)){const t=e.parse(r,1+n.length,i,void 0,{typeAnnotation:"omit"});if(!t)return null;i=i||t.type,n.push(t)}if(!i)throw new Error("No output type");const o=r&&n.some((t=>Et(r,t.type)));return new qe(o?gt:i,n)}evaluate(t){let e,i=null,r=0;for(const n of this.args)if(r++,i=n.evaluate(t),i&&i instanceof re&&!i.available&&(e||(e=i.name),i=null,r===this.args.length&&(i=e)),null!==i)break;return i}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}}class Ke{constructor(t,e){this.type=e.type,this.bindings=[].concat(t),this.result=e}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const e of this.bindings)t(e[1]);t(this.result)}static parse(t,e){if(t.length<4)return e.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const i=[];for(let r=1;r<t.length-1;r+=2){const n=t[r];if("string"!=typeof n)return e.error(`Expected string, but found ${typeof n} instead.`,r);if(/[^a-zA-Z0-9_]/.test(n))return e.error("Variable names must contain only alphanumeric characters or '_'.",r);const o=e.parse(t[r+1],r+1);if(!o)return null;i.push([n,o])}const r=e.parse(t[t.length-1],t.length-1,e.expectedType,i);return r?new Ke(i,r):null}outputDefined(){return this.result.outputDefined()}}class We{constructor(t,e,i){this.type=t,this.index=e,this.input=i}static parse(t,e){if(3!==t.length)return e.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const i=e.parse(t[1],1,dt),r=e.parse(t[2],2,wt(e.expectedType||gt));return i&&r?new We(r.type.itemType,i,r):null}evaluate(t){const e=this.index.evaluate(t),i=this.input.evaluate(t);if(e<0)throw new ce(`Array index out of bounds: ${e} < 0.`);if(e>=i.length)throw new ce(`Array index out of bounds: ${e} > ${i.length-1}.`);if(e!==Math.floor(e))throw new ce(`Array index must be an integer, but found ${e} instead.`);return i[e]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}}class Xe{constructor(t,e){this.type=ft,this.needle=t,this.haystack=e}static parse(t,e){if(3!==t.length)return e.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const i=e.parse(t[1],1,gt),r=e.parse(t[2],2,gt);return i&&r?Ct(i.type,[ft,pt,dt,ht,gt])?new Xe(i,r):e.error(`Expected first argument to be of type boolean, string, number or null, but found ${Tt(i.type)} instead`):null}evaluate(t){const e=this.needle.evaluate(t),i=this.haystack.evaluate(t);if(!i)return!1;if(!St(e,["boolean","string","number","null"]))throw new ce(`Expected first argument to be of type boolean, string, number or null, but found ${Tt(se(e))} instead.`);if(!St(i,["string","array"]))throw new ce(`Expected second argument to be of type array or string, but found ${Tt(se(i))} instead.`);return i.indexOf(e)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}}class Je{constructor(t,e,i){this.type=dt,this.needle=t,this.haystack=e,this.fromIndex=i}static parse(t,e){if(t.length<=2||t.length>=5)return e.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const i=e.parse(t[1],1,gt),r=e.parse(t[2],2,gt);if(!i||!r)return null;if(!Ct(i.type,[ft,pt,dt,ht,gt]))return e.error(`Expected first argument to be of type boolean, string, number or null, but found ${Tt(i.type)} instead`);if(4===t.length){const n=e.parse(t[3],3,dt);return n?new Je(i,r,n):null}return new Je(i,r)}evaluate(t){const e=this.needle.evaluate(t),i=this.haystack.evaluate(t);if(!St(e,["boolean","string","number","null"]))throw new ce(`Expected first argument to be of type boolean, string, number or null, but found ${Tt(se(e))} instead.`);if(!St(i,["string","array"]))throw new ce(`Expected second argument to be of type array or string, but found ${Tt(se(i))} instead.`);if(this.fromIndex){const r=this.fromIndex.evaluate(t);return i.indexOf(e,r)}return i.indexOf(e)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}}class Ye{constructor(t,e,i,r,n,o){this.inputType=t,this.type=e,this.input=i,this.cases=r,this.outputs=n,this.otherwise=o}static parse(t,e){if(t.length<5)return e.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return e.error("Expected an even number of arguments.");let i,r;e.expectedType&&"value"!==e.expectedType.kind&&(r=e.expectedType);const n={},o=[];for(let s=2;s<t.length-1;s+=2){let a=t[s];const l=t[s+1];Array.isArray(a)||(a=[a]);const c=e.concat(s);if(0===a.length)return c.error("Expected at least one branch label.");for(const t of a){if("number"!=typeof t&&"string"!=typeof t)return c.error("Branch labels must be numbers or strings.");if("number"==typeof t&&Math.abs(t)>Number.MAX_SAFE_INTEGER)return c.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof t&&Math.floor(t)!==t)return c.error("Numeric branch labels must be integer values.");if(i){if(c.checkSubtype(i,se(t)))return null}else i=se(t);if(void 0!==n[String(t)])return c.error("Branch labels must be unique.");n[String(t)]=o.length}const u=e.parse(l,s,r);if(!u)return null;r=r||u.type,o.push(u)}const s=e.parse(t[1],1,gt);if(!s)return null;const a=e.parse(t[t.length-1],t.length-1,r);return a?"value"!==s.type.kind&&e.concat(1).checkSubtype(i,s.type)?null:new Ye(i,r,s,n,o,a):null}evaluate(t){const e=this.input.evaluate(t);return(se(e)===this.inputType&&this.outputs[this.cases[e]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))&&this.otherwise.outputDefined()}}class ti{constructor(t,e,i){this.type=t,this.branches=e,this.otherwise=i}static parse(t,e){if(t.length<4)return e.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return e.error("Expected an odd number of arguments.");let i;e.expectedType&&"value"!==e.expectedType.kind&&(i=e.expectedType);const r=[];for(let n=1;n<t.length-1;n+=2){const o=e.parse(t[n],n,ft);if(!o)return null;const s=e.parse(t[n+1],n+1,i);if(!s)return null;r.push([o,s]),i=i||s.type}const n=e.parse(t[t.length-1],t.length-1,i);if(!n)return null;if(!i)throw new Error("Can't infer output type");return new ti(i,r,n)}evaluate(t){for(const[e,i]of this.branches)if(e.evaluate(t))return i.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[e,i]of this.branches)t(e),t(i);t(this.otherwise)}outputDefined(){return this.branches.every((([t,e])=>e.outputDefined()))&&this.otherwise.outputDefined()}}class ei{constructor(t,e,i,r){this.type=t,this.input=e,this.beginIndex=i,this.endIndex=r}static parse(t,e){if(t.length<=2||t.length>=5)return e.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const i=e.parse(t[1],1,gt),r=e.parse(t[2],2,dt);if(!i||!r)return null;if(!Ct(i.type,[wt(gt),pt,gt]))return e.error(`Expected first argument to be of type array or string, but found ${Tt(i.type)} instead`);if(4===t.length){const n=e.parse(t[3],3,dt);return n?new ei(i.type,i,r,n):null}return new ei(i.type,i,r)}evaluate(t){const e=this.input.evaluate(t),i=this.beginIndex.evaluate(t);if(!St(e,["string","array"]))throw new ce(`Expected first argument to be of type array or string, but found ${Tt(se(e))} instead.`);if(this.endIndex){const r=this.endIndex.evaluate(t);return e.slice(i,r)}return e.slice(i)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}}function ii(t,e){return"=="===t||"!="===t?"boolean"===e.kind||"string"===e.kind||"number"===e.kind||"null"===e.kind||"value"===e.kind:"string"===e.kind||"number"===e.kind||"value"===e.kind}function ri(t,e,i,r){return 0===r.compare(e,i)}function ni(t,e,i){const r="=="!==t&&"!="!==t;return class n{constructor(t,e,i){this.type=ft,this.lhs=t,this.rhs=e,this.collator=i,this.hasUntypedArgument="value"===t.type.kind||"value"===e.type.kind}static parse(t,e){if(3!==t.length&&4!==t.length)return e.error("Expected two or three arguments.");const i=t[0];let o=e.parse(t[1],1,gt);if(!o)return null;if(!ii(i,o.type))return e.concat(1).error(`"${i}" comparisons are not supported for type '${Tt(o.type)}'.`);let s=e.parse(t[2],2,gt);if(!s)return null;if(!ii(i,s.type))return e.concat(2).error(`"${i}" comparisons are not supported for type '${Tt(s.type)}'.`);if(o.type.kind!==s.type.kind&&"value"!==o.type.kind&&"value"!==s.type.kind)return e.error(`Cannot compare types '${Tt(o.type)}' and '${Tt(s.type)}'.`);r&&("value"===o.type.kind&&"value"!==s.type.kind?o=new he(s.type,[o]):"value"!==o.type.kind&&"value"===s.type.kind&&(s=new he(o.type,[s])));let a=null;if(4===t.length){if("string"!==o.type.kind&&"string"!==s.type.kind&&"value"!==o.type.kind&&"value"!==s.type.kind)return e.error("Cannot use collator to compare non-string types.");if(a=e.parse(t[3],3,_t),!a)return null}return new n(o,s,a)}evaluate(n){const o=this.lhs.evaluate(n),s=this.rhs.evaluate(n);if(r&&this.hasUntypedArgument){const e=se(o),i=se(s);if(e.kind!==i.kind||"string"!==e.kind&&"number"!==e.kind)throw new ce(`Expected arguments for "${t}" to be (string, string) or (number, number), but found (${e.kind}, ${i.kind}) instead.`)}if(this.collator&&!r&&this.hasUntypedArgument){const t=se(o),i=se(s);if("string"!==t.kind||"string"!==i.kind)return e(n,o,s)}return this.collator?i(n,o,s,this.collator.evaluate(n)):e(n,o,s)}eachChild(t){t(this.lhs),t(this.rhs),this.collator&&t(this.collator)}outputDefined(){return!0}}}const oi=ni("==",(function(t,e,i){return e===i}),ri),si=ni("!=",(function(t,e,i){return e!==i}),(function(t,e,i,r){return!ri(0,e,i,r)})),ai=ni("<",(function(t,e,i){return e<i}),(function(t,e,i,r){return r.compare(e,i)<0})),li=ni(">",(function(t,e,i){return e>i}),(function(t,e,i,r){return r.compare(e,i)>0})),ci=ni("<=",(function(t,e,i){return e<=i}),(function(t,e,i,r){return r.compare(e,i)<=0})),ui=ni(">=",(function(t,e,i){return e>=i}),(function(t,e,i,r){return r.compare(e,i)>=0}));class hi{constructor(t,e,i,r,n){this.type=pt,this.number=t,this.locale=e,this.currency=i,this.minFractionDigits=r,this.maxFractionDigits=n}static parse(t,e){if(3!==t.length)return e.error("Expected two arguments.");const i=e.parse(t[1],1,dt);if(!i)return null;const r=t[2];if("object"!=typeof r||Array.isArray(r))return e.error("NumberFormat options argument must be an object.");let n=null;if(r.locale&&(n=e.parse(r.locale,1,pt),!n))return null;let o=null;if(r.currency&&(o=e.parse(r.currency,1,pt),!o))return null;let s=null;if(r["min-fraction-digits"]&&(s=e.parse(r["min-fraction-digits"],1,dt),!s))return null;let a=null;return r["max-fraction-digits"]&&(a=e.parse(r["max-fraction-digits"],1,dt),!a)?null:new hi(i,n,o,s,a)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}}class di{constructor(t){this.type=yt,this.sections=t}static parse(t,e){if(t.length<2)return e.error("Expected at least one argument.");const i=t[1];if(!Array.isArray(i)&&"object"==typeof i)return e.error("First argument must be an image or text section.");const r=[];let n=!1;for(let i=1;i<=t.length-1;++i){const o=t[i];if(n&&"object"==typeof o&&!Array.isArray(o)){n=!1;let t=null;if(o["font-scale"]&&(t=e.parse(o["font-scale"],1,dt),!t))return null;let i=null;if(o["text-font"]&&(i=e.parse(o["text-font"],1,wt(pt)),!i))return null;let s=null;if(o["text-color"]&&(s=e.parse(o["text-color"],1,At),!s))return null;const a=r[r.length-1];a.scale=t,a.font=i,a.textColor=s}else{const o=e.parse(t[i],1,gt);if(!o)return null;const s=o.type.kind;if("string"!==s&&"value"!==s&&"null"!==s&&"resolvedImage"!==s)return e.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");n=!0,r.push({content:o,scale:null,font:null,textColor:null})}}return new di(r)}evaluate(t){return new Yt(this.sections.map((e=>{const i=e.content.evaluate(t);return se(i)===xt?new Jt("",i,null,null,null):new Jt(ae(i),null,e.scale?e.scale.evaluate(t):null,e.font?e.font.evaluate(t).join(","):null,e.textColor?e.textColor.evaluate(t):null)})))}eachChild(t){for(const e of this.sections)t(e.content),e.scale&&t(e.scale),e.font&&t(e.font),e.textColor&&t(e.textColor)}outputDefined(){return!1}}class pi{constructor(t){this.type=xt,this.input=t}static parse(t,e){if(2!==t.length)return e.error("Expected two arguments.");const i=e.parse(t[1],1,pt);return i?new pi(i):e.error("No image name provided.")}evaluate(t){const e=this.input.evaluate(t),i=re.fromString(e);return i&&t.availableImages&&(i.available=t.availableImages.indexOf(e)>-1),i}eachChild(t){t(this.input)}outputDefined(){return!1}}class fi{constructor(t){this.type=dt,this.input=t}static parse(t,e){if(2!==t.length)return e.error(`Expected 1 argument, but found ${t.length-1} instead.`);const i=e.parse(t[1],1);return i?"array"!==i.type.kind&&"string"!==i.type.kind&&"value"!==i.type.kind?e.error(`Expected argument of type string or array, but found ${Tt(i.type)} instead.`):new fi(i):null}evaluate(t){const e=this.input.evaluate(t);if("string"==typeof e)return e.length;if(Array.isArray(e))return e.length;throw new ce(`Expected value to be of type string or array, but found ${Tt(se(e))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}}const Ai={"==":oi,"!=":si,">":li,"<":ai,">=":ui,"<=":ci,array:he,at:We,boolean:he,case:ti,coalesce:qe,collator:ge,format:di,image:pi,in:Xe,"index-of":Je,interpolate:$e,"interpolate-hcl":$e,"interpolate-lab":$e,length:fi,let:Ke,literal:le,match:Ye,number:he,"number-format":hi,object:he,slice:ei,step:Ve,string:he,"to-boolean":pe,"to-color":pe,"to-number":pe,"to-string":pe,var:Fe,within:ze};function mi(t,[e,i,r,n]){e=e.evaluate(t),i=i.evaluate(t),r=r.evaluate(t);const o=n?n.evaluate(t):1,s=ne(e,i,r,o);if(s)throw new ce(s);return new Wt(e/255,i/255,r/255,o,!1)}function gi(t,e){return t in e}function _i(t,e){const i=e[t];return void 0===i?null:i}function yi(t){return{type:t}}function vi(t){return{result:"success",value:t}}function xi(t){return{result:"error",value:t}}function bi(t){return"data-driven"===t["property-type"]||"cross-faded-data-driven"===t["property-type"]}function wi(t){return!!t.expression&&t.expression.parameters.indexOf("zoom")>-1}function Ti(t){return!!t.expression&&t.expression.interpolated}function Bi(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":null===t?"null":typeof t}function Ei(t){return"object"==typeof t&&null!==t&&!Array.isArray(t)}function Ci(t){return t}function Si(t,e){const i="color"===e.type,r=t.stops&&"object"==typeof t.stops[0][0],n=r||!(r||void 0!==t.property),o=t.type||(Ti(e)?"exponential":"interval");if(i||"padding"===e.type){const r=i?Wt.parse:te.parse;(t=lt({},t)).stops&&(t.stops=t.stops.map((t=>[t[0],r(t[1])]))),t.default=r(t.default?t.default:e.default)}if(t.colorSpace&&"rgb"!==(s=t.colorSpace)&&"hcl"!==s&&"lab"!==s)throw new Error(`Unknown color space: "${t.colorSpace}"`);var s;let a,l,c;if("exponential"===o)a=Pi;else if("interval"===o)a=ki;else if("categorical"===o){a=Mi,l=Object.create(null);for(const e of t.stops)l[e[0]]=e[1];c=typeof t.stops[0][0]}else{if("identity"!==o)throw new Error(`Unknown function type "${o}"`);a=Li}if(r){const i={},r=[];for(let e=0;e<t.stops.length;e++){const n=t.stops[e],o=n[0].zoom;void 0===i[o]&&(i[o]={zoom:o,type:t.type,property:t.property,default:t.default,stops:[]},r.push(o)),i[o].stops.push([n[0].value,n[1]])}const n=[];for(const t of r)n.push([i[t].zoom,Si(i[t],e)]);const o={name:"linear"};return{kind:"composite",interpolationType:o,interpolationFactor:$e.interpolationFactor.bind(void 0,o),zoomStops:n.map((t=>t[0])),evaluate:({zoom:i},r)=>Pi({stops:n,base:t.base},e,i).evaluate(i,r)}}if(n){const i="exponential"===o?{name:"exponential",base:void 0!==t.base?t.base:1}:null;return{kind:"camera",interpolationType:i,interpolationFactor:$e.interpolationFactor.bind(void 0,i),zoomStops:t.stops.map((t=>t[0])),evaluate:({zoom:i})=>a(t,e,i,l,c)}}return{kind:"source",evaluate(i,r){const n=r&&r.properties?r.properties[t.property]:void 0;return void 0===n?Ii(t.default,e.default):a(t,e,n,l,c)}}}function Ii(t,e,i){return void 0!==t?t:void 0!==e?e:void 0!==i?i:void 0}function Mi(t,e,i,r,n){return Ii(typeof i===n?r[i]:void 0,t.default,e.default)}function ki(t,e,i){if("number"!==Bi(i))return Ii(t.default,e.default);const r=t.stops.length;if(1===r)return t.stops[0][1];if(i<=t.stops[0][0])return t.stops[0][1];if(i>=t.stops[r-1][0])return t.stops[r-1][1];const n=Qe(t.stops.map((t=>t[0])),i);return t.stops[n][1]}function Pi(t,e,i){const r=void 0!==t.base?t.base:1;if("number"!==Bi(i))return Ii(t.default,e.default);const n=t.stops.length;if(1===n)return t.stops[0][1];if(i<=t.stops[0][0])return t.stops[0][1];if(i>=t.stops[n-1][0])return t.stops[n-1][1];const o=Qe(t.stops.map((t=>t[0])),i),s=function(t,e,i,r){const n=r-i,o=t-i;return 0===n?0:1===e?o/n:(Math.pow(e,o)-1)/(Math.pow(e,n)-1)}(i,r,t.stops[o][0],t.stops[o+1][0]),a=t.stops[o][1],l=t.stops[o+1][1],c=Ge[e.type]||Ci;return"function"==typeof a.evaluate?{evaluate(...e){const i=a.evaluate.apply(void 0,e),r=l.evaluate.apply(void 0,e);if(void 0!==i&&void 0!==r)return c(i,r,s,t.colorSpace)}}:c(a,l,s,t.colorSpace)}function Li(t,e,i){switch(e.type){case"color":i=Wt.parse(i);break;case"formatted":i=Yt.fromString(i.toString());break;case"resolvedImage":i=re.fromString(i.toString());break;case"padding":i=te.parse(i);break;default:Bi(i)===e.type||"enum"===e.type&&e.values[i]||(i=void 0)}return Ii(i,t.default,e.default)}De.register(Ai,{error:[{kind:"error"},[pt],(t,[e])=>{throw new ce(e.evaluate(t))}],typeof:[pt,[gt],(t,[e])=>Tt(se(e.evaluate(t)))],"to-rgba":[wt(dt,4),[At],(t,[e])=>{const[i,r,n,o]=e.evaluate(t).rgb;return[255*i,255*r,255*n,o]}],rgb:[At,[dt,dt,dt],mi],rgba:[At,[dt,dt,dt,dt],mi],has:{type:ft,overloads:[[[pt],(t,[e])=>gi(e.evaluate(t),t.properties())],[[pt,mt],(t,[e,i])=>gi(e.evaluate(t),i.evaluate(t))]]},get:{type:gt,overloads:[[[pt],(t,[e])=>_i(e.evaluate(t),t.properties())],[[pt,mt],(t,[e,i])=>_i(e.evaluate(t),i.evaluate(t))]]},"feature-state":[gt,[pt],(t,[e])=>_i(e.evaluate(t),t.featureState||{})],properties:[mt,[],t=>t.properties()],"geometry-type":[pt,[],t=>t.geometryType()],id:[gt,[],t=>t.id()],zoom:[dt,[],t=>t.globals.zoom],"heatmap-density":[dt,[],t=>t.globals.heatmapDensity||0],"line-progress":[dt,[],t=>t.globals.lineProgress||0],accumulated:[gt,[],t=>void 0===t.globals.accumulated?null:t.globals.accumulated],"+":[dt,yi(dt),(t,e)=>{let i=0;for(const r of e)i+=r.evaluate(t);return i}],"*":[dt,yi(dt),(t,e)=>{let i=1;for(const r of e)i*=r.evaluate(t);return i}],"-":{type:dt,overloads:[[[dt,dt],(t,[e,i])=>e.evaluate(t)-i.evaluate(t)],[[dt],(t,[e])=>-e.evaluate(t)]]},"/":[dt,[dt,dt],(t,[e,i])=>e.evaluate(t)/i.evaluate(t)],"%":[dt,[dt,dt],(t,[e,i])=>e.evaluate(t)%i.evaluate(t)],ln2:[dt,[],()=>Math.LN2],pi:[dt,[],()=>Math.PI],e:[dt,[],()=>Math.E],"^":[dt,[dt,dt],(t,[e,i])=>Math.pow(e.evaluate(t),i.evaluate(t))],sqrt:[dt,[dt],(t,[e])=>Math.sqrt(e.evaluate(t))],log10:[dt,[dt],(t,[e])=>Math.log(e.evaluate(t))/Math.LN10],ln:[dt,[dt],(t,[e])=>Math.log(e.evaluate(t))],log2:[dt,[dt],(t,[e])=>Math.log(e.evaluate(t))/Math.LN2],sin:[dt,[dt],(t,[e])=>Math.sin(e.evaluate(t))],cos:[dt,[dt],(t,[e])=>Math.cos(e.evaluate(t))],tan:[dt,[dt],(t,[e])=>Math.tan(e.evaluate(t))],asin:[dt,[dt],(t,[e])=>Math.asin(e.evaluate(t))],acos:[dt,[dt],(t,[e])=>Math.acos(e.evaluate(t))],atan:[dt,[dt],(t,[e])=>Math.atan(e.evaluate(t))],min:[dt,yi(dt),(t,e)=>Math.min(...e.map((e=>e.evaluate(t))))],max:[dt,yi(dt),(t,e)=>Math.max(...e.map((e=>e.evaluate(t))))],abs:[dt,[dt],(t,[e])=>Math.abs(e.evaluate(t))],round:[dt,[dt],(t,[e])=>{const i=e.evaluate(t);return i<0?-Math.round(-i):Math.round(i)}],floor:[dt,[dt],(t,[e])=>Math.floor(e.evaluate(t))],ceil:[dt,[dt],(t,[e])=>Math.ceil(e.evaluate(t))],"filter-==":[ft,[pt,gt],(t,[e,i])=>t.properties()[e.value]===i.value],"filter-id-==":[ft,[gt],(t,[e])=>t.id()===e.value],"filter-type-==":[ft,[pt],(t,[e])=>t.geometryType()===e.value],"filter-<":[ft,[pt,gt],(t,[e,i])=>{const r=t.properties()[e.value],n=i.value;return typeof r==typeof n&&r<n}],"filter-id-<":[ft,[gt],(t,[e])=>{const i=t.id(),r=e.value;return typeof i==typeof r&&i<r}],"filter->":[ft,[pt,gt],(t,[e,i])=>{const r=t.properties()[e.value],n=i.value;return typeof r==typeof n&&r>n}],"filter-id->":[ft,[gt],(t,[e])=>{const i=t.id(),r=e.value;return typeof i==typeof r&&i>r}],"filter-<=":[ft,[pt,gt],(t,[e,i])=>{const r=t.properties()[e.value],n=i.value;return typeof r==typeof n&&r<=n}],"filter-id-<=":[ft,[gt],(t,[e])=>{const i=t.id(),r=e.value;return typeof i==typeof r&&i<=r}],"filter->=":[ft,[pt,gt],(t,[e,i])=>{const r=t.properties()[e.value],n=i.value;return typeof r==typeof n&&r>=n}],"filter-id->=":[ft,[gt],(t,[e])=>{const i=t.id(),r=e.value;return typeof i==typeof r&&i>=r}],"filter-has":[ft,[gt],(t,[e])=>e.value in t.properties()],"filter-has-id":[ft,[],t=>null!==t.id()&&void 0!==t.id()],"filter-type-in":[ft,[wt(pt)],(t,[e])=>e.value.indexOf(t.geometryType())>=0],"filter-id-in":[ft,[wt(gt)],(t,[e])=>e.value.indexOf(t.id())>=0],"filter-in-small":[ft,[pt,wt(gt)],(t,[e,i])=>i.value.indexOf(t.properties()[e.value])>=0],"filter-in-large":[ft,[pt,wt(gt)],(t,[e,i])=>function(t,e,i,r){for(;i<=r;){const n=i+r>>1;if(e[n]===t)return!0;e[n]>t?r=n-1:i=n+1}return!1}(t.properties()[e.value],i.value,0,i.value.length-1)],all:{type:ft,overloads:[[[ft,ft],(t,[e,i])=>e.evaluate(t)&&i.evaluate(t)],[yi(ft),(t,e)=>{for(const i of e)if(!i.evaluate(t))return!1;return!0}]]},any:{type:ft,overloads:[[[ft,ft],(t,[e,i])=>e.evaluate(t)||i.evaluate(t)],[yi(ft),(t,e)=>{for(const i of e)if(i.evaluate(t))return!0;return!1}]]},"!":[ft,[ft],(t,[e])=>!e.evaluate(t)],"is-supported-script":[ft,[pt],(t,[e])=>{const i=t.globals&&t.globals.isSupportedScript;return!i||i(e.evaluate(t))}],upcase:[pt,[pt],(t,[e])=>e.evaluate(t).toUpperCase()],downcase:[pt,[pt],(t,[e])=>e.evaluate(t).toLowerCase()],concat:[pt,yi(gt),(t,e)=>e.map((e=>ae(e.evaluate(t)))).join("")],"resolved-locale":[pt,[_t],(t,[e])=>e.evaluate(t).resolvedLocale()]});class zi{constructor(t,e){var i;this.expression=t,this._warningHistory={},this._evaluator=new Ae,this._defaultValue=e?"color"===(i=e).type&&Ei(i.default)?new Wt(0,0,0,0):"color"===i.type?Wt.parse(i.default)||null:"padding"===i.type?te.parse(i.default)||null:"variableAnchorOffsetCollection"===i.type?ie.parse(i.default)||null:void 0===i.default?null:i.default:null,this._enumValues=e&&"enum"===e.type?e.values:null}evaluateWithoutErrorHandling(t,e,i,r,n,o){return this._evaluator.globals=t,this._evaluator.feature=e,this._evaluator.featureState=i,this._evaluator.canonical=r,this._evaluator.availableImages=n||null,this._evaluator.formattedSection=o,this.expression.evaluate(this._evaluator)}evaluate(t,e,i,r,n,o){this._evaluator.globals=t,this._evaluator.feature=e||null,this._evaluator.featureState=i||null,this._evaluator.canonical=r,this._evaluator.availableImages=n||null,this._evaluator.formattedSection=o||null;try{const t=this.expression.evaluate(this._evaluator);if(null==t||"number"==typeof t&&t!=t)return this._defaultValue;if(this._enumValues&&!(t in this._enumValues))throw new ce(`Expected value to be one of ${Object.keys(this._enumValues).map((t=>JSON.stringify(t))).join(", ")}, but found ${JSON.stringify(t)} instead.`);return t}catch(t){return this._warningHistory[t.message]||(this._warningHistory[t.message]=!0,"undefined"!=typeof console&&console.warn(t.message)),this._defaultValue}}}function Fi(t){return Array.isArray(t)&&t.length>0&&"string"==typeof t[0]&&t[0]in Ai}function Di(t,e){const i=new me(Ai,Re,[],e?function(t){const e={color:At,string:pt,number:dt,enum:pt,boolean:ft,formatted:yt,padding:vt,resolvedImage:xt,variableAnchorOffsetCollection:bt};return"array"===t.type?wt(e[t.value]||gt,t.length):e[t.type]}(e):void 0),r=i.parse(t,void 0,void 0,void 0,e&&"string"===e.type?{typeAnnotation:"coerce"}:void 0);return r?vi(new zi(r,e)):xi(i.errors)}class Ri{constructor(t,e){this.kind=t,this._styleExpression=e,this.isStateDependent="constant"!==t&&!Oe(e.expression)}evaluateWithoutErrorHandling(t,e,i,r,n,o){return this._styleExpression.evaluateWithoutErrorHandling(t,e,i,r,n,o)}evaluate(t,e,i,r,n,o){return this._styleExpression.evaluate(t,e,i,r,n,o)}}class Ui{constructor(t,e,i,r){this.kind=t,this.zoomStops=i,this._styleExpression=e,this.isStateDependent="camera"!==t&&!Oe(e.expression),this.interpolationType=r}evaluateWithoutErrorHandling(t,e,i,r,n,o){return this._styleExpression.evaluateWithoutErrorHandling(t,e,i,r,n,o)}evaluate(t,e,i,r,n,o){return this._styleExpression.evaluate(t,e,i,r,n,o)}interpolationFactor(t,e,i){return this.interpolationType?$e.interpolationFactor(this.interpolationType,t,e,i):0}}function Oi(t,e){const i=Di(t,e);if("error"===i.result)return i;const r=i.value.expression,n=Ue(r);if(!n&&!bi(e))return xi([new ct("","data expressions not supported")]);const o=Ne(r,["zoom"]);if(!o&&!wi(e))return xi([new ct("","zoom expressions not supported")]);const s=Qi(r);return s||o?s instanceof ct?xi([s]):s instanceof $e&&!Ti(e)?xi([new ct("",'"interpolate" expressions cannot be used with this property')]):vi(s?new Ui(n?"camera":"composite",i.value,s.labels,s instanceof $e?s.interpolation:void 0):new Ri(n?"constant":"source",i.value)):xi([new ct("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Ni{constructor(t,e){this._parameters=t,this._specification=e,lt(this,Si(this._parameters,this._specification))}static deserialize(t){return new Ni(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function Qi(t){let e=null;if(t instanceof Ke)e=Qi(t.result);else if(t instanceof qe){for(const i of t.args)if(e=Qi(i),e)break}else(t instanceof Ve||t instanceof $e)&&t.input instanceof De&&"zoom"===t.input.name&&(e=t);return e instanceof ct||t.eachChild((t=>{const i=Qi(t);i instanceof ct?e=i:!e&&i?e=new ct("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&i&&e!==i&&(e=new ct("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),e}function Vi(t){if(!0===t||!1===t)return!0;if(!Array.isArray(t)||0===t.length)return!1;switch(t[0]){case"has":return t.length>=2&&"$id"!==t[1]&&"$type"!==t[1];case"in":return t.length>=3&&("string"!=typeof t[1]||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==t.length||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(const e of t.slice(1))if(!Vi(e)&&"boolean"!=typeof e)return!1;return!0;default:return!0}}const ji={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Hi(t){if(null==t)return{filter:()=>!0,needGeometry:!1};Vi(t)||(t=Zi(t));const e=Di(t,ji);if("error"===e.result)throw new Error(e.value.map((t=>`${t.key}: ${t.message}`)).join(", "));return{filter:(t,i,r)=>e.value.evaluate(t,i,{},r),needGeometry:$i(t)}}function Gi(t,e){return t<e?-1:t>e?1:0}function $i(t){if(!Array.isArray(t))return!1;if("within"===t[0])return!0;for(let e=1;e<t.length;e++)if($i(t[e]))return!0;return!1}function Zi(t){if(!t)return!0;const e=t[0];return t.length<=1?"any"!==e:"=="===e?qi(t[1],t[2],"=="):"!="===e?Xi(qi(t[1],t[2],"==")):"<"===e||">"===e||"<="===e||">="===e?qi(t[1],t[2],e):"any"===e?(i=t.slice(1),["any"].concat(i.map(Zi))):"all"===e?["all"].concat(t.slice(1).map(Zi)):"none"===e?["all"].concat(t.slice(1).map(Zi).map(Xi)):"in"===e?Ki(t[1],t.slice(2)):"!in"===e?Xi(Ki(t[1],t.slice(2))):"has"===e?Wi(t[1]):"!has"===e?Xi(Wi(t[1])):"within"!==e||t;var i}function qi(t,e,i){switch(t){case"$type":return[`filter-type-${i}`,e];case"$id":return[`filter-id-${i}`,e];default:return[`filter-${i}`,t,e]}}function Ki(t,e){if(0===e.length)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some((t=>typeof t!=typeof e[0]))?["filter-in-large",t,["literal",e.sort(Gi)]]:["filter-in-small",t,["literal",e]]}}function Wi(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function Xi(t){return["!",t]}function Ji(t){const e=typeof t;if("number"===e||"boolean"===e||"string"===e||null==t)return JSON.stringify(t);if(Array.isArray(t)){let e="[";for(const i of t)e+=`${Ji(i)},`;return`${e}]`}const i=Object.keys(t).sort();let r="{";for(let e=0;e<i.length;e++)r+=`${JSON.stringify(i[e])}:${Ji(t[i[e]])},`;return`${r}}`}function Yi(t){let e="";for(const i of W)e+=`/${Ji(t[i])}`;return e}function tr(t){const e=t.value;return e?[new at(t.key,e,"constants have been deprecated as of v8")]:[]}function er(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function ir(t){if(Array.isArray(t))return t.map(ir);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){const e={};for(const i in t)e[i]=ir(t[i]);return e}return er(t)}function rr(t){const e=t.key,i=t.value,r=t.valueSpec||{},n=t.objectElementValidators||{},o=t.style,s=t.styleSpec,a=t.validateSpec;let l=[];const c=Bi(i);if("object"!==c)return[new at(e,i,`object expected, ${c} found`)];for(const t in i){const c=t.split(".")[0],u=r[c]||r["*"];let h;if(n[c])h=n[c];else if(r[c])h=a;else if(n["*"])h=n["*"];else{if(!r["*"]){l.push(new at(e,i[t],`unknown property "${t}"`));continue}h=a}l=l.concat(h({key:(e?`${e}.`:e)+t,value:i[t],valueSpec:u,style:o,styleSpec:s,object:i,objectKey:t,validateSpec:a},i))}for(const t in r)n[t]||r[t].required&&void 0===r[t].default&&void 0===i[t]&&l.push(new at(e,i,`missing required property "${t}"`));return l}function nr(t){const e=t.value,i=t.valueSpec,r=t.style,n=t.styleSpec,o=t.key,s=t.arrayElementValidator||t.validateSpec;if("array"!==Bi(e))return[new at(o,e,`array expected, ${Bi(e)} found`)];if(i.length&&e.length!==i.length)return[new at(o,e,`array length ${i.length} expected, length ${e.length} found`)];if(i["min-length"]&&e.length<i["min-length"])return[new at(o,e,`array length at least ${i["min-length"]} expected, length ${e.length} found`)];let a={type:i.value,values:i.values};n.$version<7&&(a.function=i.function),"object"===Bi(i.value)&&(a=i.value);let l=[];for(let i=0;i<e.length;i++)l=l.concat(s({array:e,arrayIndex:i,value:e[i],valueSpec:a,validateSpec:t.validateSpec,style:r,styleSpec:n,key:`${o}[${i}]`}));return l}function or(t){const e=t.key,i=t.value,r=t.valueSpec;let n=Bi(i);return"number"===n&&i!=i&&(n="NaN"),"number"!==n?[new at(e,i,`number expected, ${n} found`)]:"minimum"in r&&i<r.minimum?[new at(e,i,`${i} is less than the minimum value ${r.minimum}`)]:"maximum"in r&&i>r.maximum?[new at(e,i,`${i} is greater than the maximum value ${r.maximum}`)]:[]}function sr(t){const e=t.valueSpec,i=er(t.value.type);let r,n,o,s={};const a="categorical"!==i&&void 0===t.value.property,l=!a,c="array"===Bi(t.value.stops)&&"array"===Bi(t.value.stops[0])&&"object"===Bi(t.value.stops[0][0]),u=rr({key:t.key,value:t.value,valueSpec:t.styleSpec.function,validateSpec:t.validateSpec,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(t){if("identity"===i)return[new at(t.key,t.value,'identity function may not have a "stops" property')];let e=[];const r=t.value;return e=e.concat(nr({key:t.key,value:r,valueSpec:t.valueSpec,validateSpec:t.validateSpec,style:t.style,styleSpec:t.styleSpec,arrayElementValidator:h})),"array"===Bi(r)&&0===r.length&&e.push(new at(t.key,r,"array must have at least one stop")),e},default:function(t){return t.validateSpec({key:t.key,value:t.value,valueSpec:e,validateSpec:t.validateSpec,style:t.style,styleSpec:t.styleSpec})}}});return"identity"===i&&a&&u.push(new at(t.key,t.value,'missing required property "property"')),"identity"===i||t.value.stops||u.push(new at(t.key,t.value,'missing required property "stops"')),"exponential"===i&&t.valueSpec.expression&&!Ti(t.valueSpec)&&u.push(new at(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(l&&!bi(t.valueSpec)?u.push(new at(t.key,t.value,"property functions not supported")):a&&!wi(t.valueSpec)&&u.push(new at(t.key,t.value,"zoom functions not supported"))),"categorical"!==i&&!c||void 0!==t.value.property||u.push(new at(t.key,t.value,'"property" property is required')),u;function h(t){let i=[];const r=t.value,a=t.key;if("array"!==Bi(r))return[new at(a,r,`array expected, ${Bi(r)} found`)];if(2!==r.length)return[new at(a,r,`array length 2 expected, length ${r.length} found`)];if(c){if("object"!==Bi(r[0]))return[new at(a,r,`object expected, ${Bi(r[0])} found`)];if(void 0===r[0].zoom)return[new at(a,r,"object stop key must have zoom")];if(void 0===r[0].value)return[new at(a,r,"object stop key must have value")];if(o&&o>er(r[0].zoom))return[new at(a,r[0].zoom,"stop zoom values must appear in ascending order")];er(r[0].zoom)!==o&&(o=er(r[0].zoom),n=void 0,s={}),i=i.concat(rr({key:`${a}[0]`,value:r[0],valueSpec:{zoom:{}},validateSpec:t.validateSpec,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{zoom:or,value:d}}))}else i=i.concat(d({key:`${a}[0]`,value:r[0],valueSpec:{},validateSpec:t.validateSpec,style:t.style,styleSpec:t.styleSpec},r));return Fi(ir(r[1]))?i.concat([new at(`${a}[1]`,r[1],"expressions are not allowed in function stops.")]):i.concat(t.validateSpec({key:`${a}[1]`,value:r[1],valueSpec:e,validateSpec:t.validateSpec,style:t.style,styleSpec:t.styleSpec}))}function d(t,o){const a=Bi(t.value),l=er(t.value),c=null!==t.value?t.value:o;if(r){if(a!==r)return[new at(t.key,c,`${a} stop domain type must match previous stop domain type ${r}`)]}else r=a;if("number"!==a&&"string"!==a&&"boolean"!==a)return[new at(t.key,c,"stop domain value must be a number, string, or boolean")];if("number"!==a&&"categorical"!==i){let r=`number expected, ${a} found`;return bi(e)&&void 0===i&&(r+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new at(t.key,c,r)]}return"categorical"!==i||"number"!==a||isFinite(l)&&Math.floor(l)===l?"categorical"!==i&&"number"===a&&void 0!==n&&l<n?[new at(t.key,c,"stop domain values must appear in ascending order")]:(n=l,"categorical"===i&&l in s?[new at(t.key,c,"stop domain values must be unique")]:(s[l]=!0,[])):[new at(t.key,c,`integer expected, found ${l}`)]}}function ar(t){const e=("property"===t.expressionContext?Oi:Di)(ir(t.value),t.valueSpec);if("error"===e.result)return e.value.map((e=>new at(`${t.key}${e.key}`,t.value,e.message)));const i=e.value.expression||e.value._styleExpression.expression;if("property"===t.expressionContext&&"text-font"===t.propertyKey&&!i.outputDefined())return[new at(t.key,t.value,`Invalid data expression for "${t.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===t.expressionContext&&"layout"===t.propertyType&&!Oe(i))return[new at(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===t.expressionContext&&!Oe(i))return[new at(t.key,t.value,'"feature-state" data expressions are not supported with filters.')];if(t.expressionContext&&0===t.expressionContext.indexOf("cluster")){if(!Ne(i,["zoom","feature-state"]))return[new at(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===t.expressionContext&&!Ue(i))return[new at(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function lr(t){const e=t.key,i=t.value,r=t.valueSpec,n=[];return Array.isArray(r.values)?-1===r.values.indexOf(er(i))&&n.push(new at(e,i,`expected one of [${r.values.join(", ")}], ${JSON.stringify(i)} found`)):-1===Object.keys(r.values).indexOf(er(i))&&n.push(new at(e,i,`expected one of [${Object.keys(r.values).join(", ")}], ${JSON.stringify(i)} found`)),n}function cr(t){return Vi(ir(t.value))?ar(lt({},t,{expressionContext:"filter",valueSpec:{value:"boolean"}})):ur(t)}function ur(t){const e=t.value,i=t.key;if("array"!==Bi(e))return[new at(i,e,`array expected, ${Bi(e)} found`)];const r=t.styleSpec;let n,o=[];if(e.length<1)return[new at(i,e,"filter array must have at least 1 element")];switch(o=o.concat(lr({key:`${i}[0]`,value:e[0],valueSpec:r.filter_operator,style:t.style,styleSpec:t.styleSpec})),er(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&"$type"===er(e[1])&&o.push(new at(i,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":3!==e.length&&o.push(new at(i,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(n=Bi(e[1]),"string"!==n&&o.push(new at(`${i}[1]`,e[1],`string expected, ${n} found`)));for(let s=2;s<e.length;s++)n=Bi(e[s]),"$type"===er(e[1])?o=o.concat(lr({key:`${i}[${s}]`,value:e[s],valueSpec:r.geometry_type,style:t.style,styleSpec:t.styleSpec})):"string"!==n&&"number"!==n&&"boolean"!==n&&o.push(new at(`${i}[${s}]`,e[s],`string, number, or boolean expected, ${n} found`));break;case"any":case"all":case"none":for(let r=1;r<e.length;r++)o=o.concat(ur({key:`${i}[${r}]`,value:e[r],style:t.style,styleSpec:t.styleSpec}));break;case"has":case"!has":n=Bi(e[1]),2!==e.length?o.push(new at(i,e,`filter array for "${e[0]}" operator must have 2 elements`)):"string"!==n&&o.push(new at(`${i}[1]`,e[1],`string expected, ${n} found`));break;case"within":n=Bi(e[1]),2!==e.length?o.push(new at(i,e,`filter array for "${e[0]}" operator must have 2 elements`)):"object"!==n&&o.push(new at(`${i}[1]`,e[1],`object expected, ${n} found`))}return o}function hr(t,e){const i=t.key,r=t.validateSpec,n=t.style,o=t.styleSpec,s=t.value,a=t.objectKey,l=o[`${e}_${t.layerType}`];if(!l)return[];const c=a.match(/^(.*)-transition$/);if("paint"===e&&c&&l[c[1]]&&l[c[1]].transition)return r({key:i,value:s,valueSpec:o.transition,style:n,styleSpec:o});const u=t.valueSpec||l[a];if(!u)return[new at(i,s,`unknown property "${a}"`)];let h;if("string"===Bi(s)&&bi(u)&&!u.tokens&&(h=/^{([^}]+)}$/.exec(s)))return[new at(i,s,`"${a}" does not support interpolation syntax\nUse an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(h[1])} }\`.`)];const d=[];return"symbol"===t.layerType&&("text-field"===a&&n&&!n.glyphs&&d.push(new at(i,s,'use of "text-field" requires a style "glyphs" property')),"text-font"===a&&Ei(ir(s))&&"identity"===er(s.type)&&d.push(new at(i,s,'"text-font" does not support identity functions'))),d.concat(r({key:t.key,value:s,valueSpec:u,style:n,styleSpec:o,expressionContext:"property",propertyType:e,propertyKey:a}))}function dr(t){return hr(t,"paint")}function pr(t){return hr(t,"layout")}function fr(t){let e=[];const i=t.value,r=t.key,n=t.style,o=t.styleSpec;i.type||i.ref||e.push(new at(r,i,'either "type" or "ref" is required'));let s=er(i.type);const a=er(i.ref);if(i.id){const o=er(i.id);for(let s=0;s<t.arrayIndex;s++){const t=n.layers[s];er(t.id)===o&&e.push(new at(r,i.id,`duplicate layer id "${i.id}", previously used at line ${t.id.__line__}`))}}if("ref"in i){let t;["type","source","source-layer","filter","layout"].forEach((t=>{t in i&&e.push(new at(r,i[t],`"${t}" is prohibited for ref layers`))})),n.layers.forEach((e=>{er(e.id)===a&&(t=e)})),t?t.ref?e.push(new at(r,i.ref,"ref cannot reference another ref layer")):s=er(t.type):e.push(new at(r,i.ref,`ref layer "${a}" not found`))}else if("background"!==s)if(i.source){const t=n.sources&&n.sources[i.source],o=t&&er(t.type);t?"vector"===o&&"raster"===s?e.push(new at(r,i.source,`layer "${i.id}" requires a raster source`)):"raster-dem"!==o&&"hillshade"===s?e.push(new at(r,i.source,`layer "${i.id}" requires a raster-dem source`)):"raster"===o&&"raster"!==s?e.push(new at(r,i.source,`layer "${i.id}" requires a vector source`)):"vector"!==o||i["source-layer"]?"raster-dem"===o&&"hillshade"!==s?e.push(new at(r,i.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==s||!i.paint||!i.paint["line-gradient"]||"geojson"===o&&t.lineMetrics||e.push(new at(r,i,`layer "${i.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new at(r,i,`layer "${i.id}" must specify a "source-layer"`)):e.push(new at(r,i.source,`source "${i.source}" not found`))}else e.push(new at(r,i,'missing required property "source"'));return e=e.concat(rr({key:r,value:i,valueSpec:o.layer,style:t.style,styleSpec:t.styleSpec,validateSpec:t.validateSpec,objectElementValidators:{"*":()=>[],type:()=>t.validateSpec({key:`${r}.type`,value:i.type,valueSpec:o.layer.type,style:t.style,styleSpec:t.styleSpec,validateSpec:t.validateSpec,object:i,objectKey:"type"}),filter:cr,layout:t=>rr({layer:i,key:t.key,value:t.value,style:t.style,styleSpec:t.styleSpec,validateSpec:t.validateSpec,objectElementValidators:{"*":t=>pr(lt({layerType:s},t))}}),paint:t=>rr({layer:i,key:t.key,value:t.value,style:t.style,styleSpec:t.styleSpec,validateSpec:t.validateSpec,objectElementValidators:{"*":t=>dr(lt({layerType:s},t))}})}})),e}function Ar(t){const e=t.value,i=t.key,r=Bi(e);return"string"!==r?[new at(i,e,`string expected, ${r} found`)]:[]}const mr={promoteId:function({key:t,value:e}){if("string"===Bi(e))return Ar({key:t,value:e});{const i=[];for(const r in e)i.push(...Ar({key:`${t}.${r}`,value:e[r]}));return i}}};function gr(t){const e=t.value,i=t.key,r=t.styleSpec,n=t.style,o=t.validateSpec;if(!e.type)return[new at(i,e,'"type" is required')];const s=er(e.type);let a;switch(s){case"vector":case"raster":return a=rr({key:i,value:e,valueSpec:r[`source_${s.replace("-","_")}`],style:t.style,styleSpec:r,objectElementValidators:mr,validateSpec:o}),a;case"raster-dem":return a=function(t){var e;const i=null!==(e=t.sourceName)&&void 0!==e?e:"",r=t.value,n=t.styleSpec,o=n.source_raster_dem,s=t.style;let a=[];const l=Bi(r);if(void 0===r)return a;if("object"!==l)return a.push(new at("source_raster_dem",r,`object expected, ${l} found`)),a;const c="custom"===er(r.encoding),u=["redFactor","greenFactor","blueFactor","baseShift"],h=t.value.encoding?`"${t.value.encoding}"`:"Default";for(const e in r)!c&&u.includes(e)?a.push(new at(e,r[e],`In "${i}": "${e}" is only valid when "encoding" is set to "custom". ${h} encoding found`)):o[e]?a=a.concat(t.validateSpec({key:e,value:r[e],valueSpec:o[e],validateSpec:t.validateSpec,style:s,styleSpec:n})):a.push(new at(e,r[e],`unknown property "${e}"`));return a}({sourceName:i,value:e,style:t.style,styleSpec:r,validateSpec:o}),a;case"geojson":if(a=rr({key:i,value:e,valueSpec:r.source_geojson,style:n,styleSpec:r,validateSpec:o,objectElementValidators:mr}),e.cluster)for(const t in e.clusterProperties){const[r,n]=e.clusterProperties[t],s="string"==typeof r?[r,["accumulated"],["get",t]]:r;a.push(...ar({key:`${i}.${t}.map`,value:n,validateSpec:o,expressionContext:"cluster-map"})),a.push(...ar({key:`${i}.${t}.reduce`,value:s,validateSpec:o,expressionContext:"cluster-reduce"}))}return a;case"video":return rr({key:i,value:e,valueSpec:r.source_video,style:n,validateSpec:o,styleSpec:r});case"image":return rr({key:i,value:e,valueSpec:r.source_image,style:n,validateSpec:o,styleSpec:r});case"canvas":return[new at(i,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return lr({key:`${i}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:n,validateSpec:o,styleSpec:r})}}function _r(t){const e=t.value,i=t.styleSpec,r=i.light,n=t.style;let o=[];const s=Bi(e);if(void 0===e)return o;if("object"!==s)return o=o.concat([new at("light",e,`object expected, ${s} found`)]),o;for(const s in e){const a=s.match(/^(.*)-transition$/);o=o.concat(a&&r[a[1]]&&r[a[1]].transition?t.validateSpec({key:s,value:e[s],valueSpec:i.transition,validateSpec:t.validateSpec,style:n,styleSpec:i}):r[s]?t.validateSpec({key:s,value:e[s],valueSpec:r[s],validateSpec:t.validateSpec,style:n,styleSpec:i}):[new at(s,e[s],`unknown property "${s}"`)])}return o}function yr(t){const e=t.value,i=t.styleSpec,r=i.terrain,n=t.style;let o=[];const s=Bi(e);if(void 0===e)return o;if("object"!==s)return o=o.concat([new at("terrain",e,`object expected, ${s} found`)]),o;for(const s in e)o=o.concat(r[s]?t.validateSpec({key:s,value:e[s],valueSpec:r[s],validateSpec:t.validateSpec,style:n,styleSpec:i}):[new at(s,e[s],`unknown property "${s}"`)]);return o}function vr(t){let e=[];const i=t.value,r=t.key;if(Array.isArray(i)){const n=[],o=[];for(const s in i)i[s].id&&n.includes(i[s].id)&&e.push(new at(r,i,`all the sprites' ids must be unique, but ${i[s].id} is duplicated`)),n.push(i[s].id),i[s].url&&o.includes(i[s].url)&&e.push(new at(r,i,`all the sprites' URLs must be unique, but ${i[s].url} is duplicated`)),o.push(i[s].url),e=e.concat(rr({key:`${r}[${s}]`,value:i[s],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:t.validateSpec}));return e}return Ar({key:r,value:i})}const xr={"*":()=>[],array:nr,boolean:function(t){const e=t.value,i=t.key,r=Bi(e);return"boolean"!==r?[new at(i,e,`boolean expected, ${r} found`)]:[]},number:or,color:function(t){const e=t.key,i=t.value,r=Bi(i);return"string"!==r?[new at(e,i,`color expected, ${r} found`)]:Wt.parse(String(i))?[]:[new at(e,i,`color expected, "${i}" found`)]},constants:tr,enum:lr,filter:cr,function:sr,layer:fr,object:rr,source:gr,light:_r,terrain:yr,string:Ar,formatted:function(t){return 0===Ar(t).length?[]:ar(t)},resolvedImage:function(t){return 0===Ar(t).length?[]:ar(t)},padding:function(t){const e=t.key,i=t.value;if("array"===Bi(i)){if(i.length<1||i.length>4)return[new at(e,i,`padding requires 1 to 4 values; ${i.length} values found`)];const r={type:"number"};let n=[];for(let o=0;o<i.length;o++)n=n.concat(t.validateSpec({key:`${e}[${o}]`,value:i[o],validateSpec:t.validateSpec,valueSpec:r}));return n}return or({key:e,value:i,valueSpec:{}})},variableAnchorOffsetCollection:function(t){const e=t.key,i=t.value,r=Bi(i),n=t.styleSpec;if("array"!==r||i.length<1||i.length%2!=0)return[new at(e,i,"variableAnchorOffsetCollection requires a non-empty array of even length")];let o=[];for(let r=0;r<i.length;r+=2)o=o.concat(lr({key:`${e}[${r}]`,value:i[r],valueSpec:n.layout_symbol["text-anchor"]})),o=o.concat(nr({key:`${e}[${r+1}]`,value:i[r+1],valueSpec:{length:2,value:"number"},validateSpec:t.validateSpec,style:t.style,styleSpec:n}));return o},sprite:vr};function br(t){const e=t.value,i=t.valueSpec,r=t.styleSpec;return t.validateSpec=br,i.expression&&Ei(er(e))?sr(t):i.expression&&Fi(ir(e))?ar(t):i.type&&xr[i.type]?xr[i.type](t):rr(lt({},t,{valueSpec:i.type?r[i.type]:i}))}function wr(t){const e=t.value,i=t.key,r=Ar(t);return r.length||(-1===e.indexOf("{fontstack}")&&r.push(new at(i,e,'"glyphs" url must include a "{fontstack}" token')),-1===e.indexOf("{range}")&&r.push(new at(i,e,'"glyphs" url must include a "{range}" token'))),r}function Tr(t,e=K){let i=[];return i=i.concat(br({key:"",value:t,valueSpec:e.$root,styleSpec:e,style:t,validateSpec:br,objectElementValidators:{glyphs:wr,"*":()=>[]}})),t.constants&&(i=i.concat(tr({key:"constants",value:t.constants,style:t,styleSpec:e,validateSpec:br}))),Er(i)}function Br(t){return function(e){return t({...e,validateSpec:br})}}function Er(t){return[].concat(t).sort(((t,e)=>t.line-e.line))}function Cr(t){return function(...e){return Er(t.apply(this,e))}}Tr.source=Cr(Br(gr)),Tr.sprite=Cr(Br(vr)),Tr.glyphs=Cr(Br(wr)),Tr.light=Cr(Br(_r)),Tr.terrain=Cr(Br(yr)),Tr.layer=Cr(Br(fr)),Tr.filter=Cr(Br(cr)),Tr.paintProperty=Cr(Br(dr)),Tr.layoutProperty=Cr(Br(pr));const Sr=Tr,Ir=Sr.light,Mr=Sr.paintProperty,kr=Sr.layoutProperty;function Pr(t,e){let i=!1;if(e&&e.length)for(const r of e)t.fire(new Z(new Error(r.message))),i=!0;return i}class Lr{constructor(t,e,i){const r=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;const n=new Int32Array(this.arrayBuffer);t=n[0],this.d=(e=n[1])+2*(i=n[2]);for(let t=0;t<this.d*this.d;t++){const e=n[3+t],i=n[3+t+1];r.push(e===i?null:n.subarray(e,i))}const o=n[3+r.length+1];this.keys=n.subarray(n[3+r.length],o),this.bboxes=n.subarray(o),this.insert=this._insertReadonly}else{this.d=e+2*i;for(let t=0;t<this.d*this.d;t++)r.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=i,this.scale=e/t,this.uid=0;const n=i/e*t;this.min=-n,this.max=t+n}insert(t,e,i,r,n){this._forEachCell(e,i,r,n,this._insertCell,this.uid++,void 0,void 0),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(i),this.bboxes.push(r),this.bboxes.push(n)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(t,e,i,r,n,o){this.cells[n].push(o)}query(t,e,i,r,n){const o=this.min,s=this.max;if(t<=o&&e<=o&&s<=i&&s<=r&&!n)return Array.prototype.slice.call(this.keys);{const o=[];return this._forEachCell(t,e,i,r,this._queryCell,o,{},n),o}}_queryCell(t,e,i,r,n,o,s,a){const l=this.cells[n];if(null!==l){const n=this.keys,c=this.bboxes;for(let u=0;u<l.length;u++){const h=l[u];if(void 0===s[h]){const l=4*h;(a?a(c[l+0],c[l+1],c[l+2],c[l+3]):t<=c[l+2]&&e<=c[l+3]&&i>=c[l+0]&&r>=c[l+1])?(s[h]=!0,o.push(n[h])):s[h]=!1}}}}_forEachCell(t,e,i,r,n,o,s,a){const l=this._convertToCellCoord(t),c=this._convertToCellCoord(e),u=this._convertToCellCoord(i),h=this._convertToCellCoord(r);for(let d=l;d<=u;d++)for(let l=c;l<=h;l++){const c=this.d*l+d;if((!a||a(this._convertFromCellCoord(d),this._convertFromCellCoord(l),this._convertFromCellCoord(d+1),this._convertFromCellCoord(l+1)))&&n.call(this,t,e,i,r,c,o,s,a))return}}_convertFromCellCoord(t){return(t-this.padding)/this.scale}_convertToCellCoord(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const t=this.cells,e=3+this.cells.length+1+1;let i=0;for(let t=0;t<this.cells.length;t++)i+=this.cells[t].length;const r=new Int32Array(e+i+this.keys.length+this.bboxes.length);r[0]=this.extent,r[1]=this.n,r[2]=this.padding;let n=e;for(let e=0;e<t.length;e++){const i=t[e];r[3+e]=n,r.set(i,n),n+=i.length}return r[3+t.length]=n,r.set(this.keys,n),n+=this.keys.length,r[3+t.length+1]=n,r.set(this.bboxes,n),n+=this.bboxes.length,r.buffer}static serialize(t,e){const i=t.toArrayBuffer();return e&&e.push(i),{buffer:i}}static deserialize(t){return new Lr(t.buffer)}}const zr={};function Fr(t,e,i={}){if(zr[t])throw new Error(`${t} is already registered.`);Object.defineProperty(e,"_classRegistryKey",{value:t,writeable:!1}),zr[t]={klass:e,omit:i.omit||[],shallow:i.shallow||[]}}Fr("Object",Object),Fr("TransferableGridIndex",Lr),Fr("Color",Wt),Fr("Error",Error),Fr("AJAXError",R),Fr("ResolvedImage",re),Fr("StylePropertyFunction",Ni),Fr("StyleExpression",zi,{omit:["_evaluator"]}),Fr("ZoomDependentExpression",Ui),Fr("ZoomConstantExpression",Ri),Fr("CompoundExpression",De,{omit:["_evaluate"]});for(const t in Ai)Ai[t]._classRegistryKey||Fr(`Expression_${t}`,Ai[t]);function Dr(t){return t&&"undefined"!=typeof ArrayBuffer&&(t instanceof ArrayBuffer||t.constructor&&"ArrayBuffer"===t.constructor.name)}function Rr(t,e){if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||t instanceof Blob)return t;if(Dr(t))return e&&e.push(t),t;if(S(t))return e&&e.push(t),t;if(ArrayBuffer.isView(t)){const i=t;return e&&e.push(i.buffer),i}if(t instanceof ImageData)return e&&e.push(t.data.buffer),t;if(Array.isArray(t)){const i=[];for(const r of t)i.push(Rr(r,e));return i}if("object"==typeof t){const i=t.constructor,r=i._classRegistryKey;if(!r)throw new Error("can't serialize object of unregistered class");if(!zr[r])throw new Error(`${r} is not registered.`);const n=i.serialize?i.serialize(t,e):{};if(i.serialize){if(e&&n===e[e.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const i in t){if(!t.hasOwnProperty(i))continue;if(zr[r].omit.indexOf(i)>=0)continue;const o=t[i];n[i]=zr[r].shallow.indexOf(i)>=0?o:Rr(o,e)}t instanceof Error&&(n.message=t.message)}if(n.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==r&&(n.$name=r),n}throw new Error("can't serialize object of type "+typeof t)}function Ur(t){if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||t instanceof Blob||Dr(t)||S(t)||ArrayBuffer.isView(t)||t instanceof ImageData)return t;if(Array.isArray(t))return t.map(Ur);if("object"==typeof t){const e=t.$name||"Object";if(!zr[e])throw new Error(`can't deserialize unregistered class ${e}`);const{klass:i}=zr[e];if(!i)throw new Error(`can't deserialize unregistered class ${e}`);if(i.deserialize)return i.deserialize(t);const r=Object.create(i.prototype);for(const i of Object.keys(t)){if("$name"===i)continue;const n=t[i];r[i]=zr[e].shallow.indexOf(i)>=0?n:Ur(n)}return r}throw new Error("can't deserialize object of type "+typeof t)}class Or{constructor(){this.first=!0}update(t,e){const i=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=i,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=i,!0):(this.lastFloorZoom>i?(this.lastIntegerZoom=i+1,this.lastIntegerZoomTime=e):this.lastFloorZoom<i&&(this.lastIntegerZoom=i,this.lastIntegerZoomTime=e),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=i,!0))}}const Nr={"Latin-1 Supplement":t=>t>=128&&t<=255,Arabic:t=>t>=1536&&t<=1791,"Arabic Supplement":t=>t>=1872&&t<=1919,"Arabic Extended-A":t=>t>=2208&&t<=2303,"Hangul Jamo":t=>t>=4352&&t<=4607,"Unified Canadian Aboriginal Syllabics":t=>t>=5120&&t<=5759,Khmer:t=>t>=6016&&t<=6143,"Unified Canadian Aboriginal Syllabics Extended":t=>t>=6320&&t<=6399,"General Punctuation":t=>t>=8192&&t<=8303,"Letterlike Symbols":t=>t>=8448&&t<=8527,"Number Forms":t=>t>=8528&&t<=8591,"Miscellaneous Technical":t=>t>=8960&&t<=9215,"Control Pictures":t=>t>=9216&&t<=9279,"Optical Character Recognition":t=>t>=9280&&t<=9311,"Enclosed Alphanumerics":t=>t>=9312&&t<=9471,"Geometric Shapes":t=>t>=9632&&t<=9727,"Miscellaneous Symbols":t=>t>=9728&&t<=9983,"Miscellaneous Symbols and Arrows":t=>t>=11008&&t<=11263,"CJK Radicals Supplement":t=>t>=11904&&t<=12031,"Kangxi Radicals":t=>t>=12032&&t<=12255,"Ideographic Description Characters":t=>t>=12272&&t<=12287,"CJK Symbols and Punctuation":t=>t>=12288&&t<=12351,Hiragana:t=>t>=12352&&t<=12447,Katakana:t=>t>=12448&&t<=12543,Bopomofo:t=>t>=12544&&t<=12591,"Hangul Compatibility Jamo":t=>t>=12592&&t<=12687,Kanbun:t=>t>=12688&&t<=12703,"Bopomofo Extended":t=>t>=12704&&t<=12735,"CJK Strokes":t=>t>=12736&&t<=12783,"Katakana Phonetic Extensions":t=>t>=12784&&t<=12799,"Enclosed CJK Letters and Months":t=>t>=12800&&t<=13055,"CJK Compatibility":t=>t>=13056&&t<=13311,"CJK Unified Ideographs Extension A":t=>t>=13312&&t<=19903,"Yijing Hexagram Symbols":t=>t>=19904&&t<=19967,"CJK Unified Ideographs":t=>t>=19968&&t<=40959,"Yi Syllables":t=>t>=40960&&t<=42127,"Yi Radicals":t=>t>=42128&&t<=42191,"Hangul Jamo Extended-A":t=>t>=43360&&t<=43391,"Hangul Syllables":t=>t>=44032&&t<=55215,"Hangul Jamo Extended-B":t=>t>=55216&&t<=55295,"Private Use Area":t=>t>=57344&&t<=63743,"CJK Compatibility Ideographs":t=>t>=63744&&t<=64255,"Arabic Presentation Forms-A":t=>t>=64336&&t<=65023,"Vertical Forms":t=>t>=65040&&t<=65055,"CJK Compatibility Forms":t=>t>=65072&&t<=65103,"Small Form Variants":t=>t>=65104&&t<=65135,"Arabic Presentation Forms-B":t=>t>=65136&&t<=65279,"Halfwidth and Fullwidth Forms":t=>t>=65280&&t<=65519};function Qr(t){for(const e of t)if(Hr(e.charCodeAt(0)))return!0;return!1}function Vr(t){for(const e of t)if(!jr(e.charCodeAt(0)))return!1;return!0}function jr(t){return!(Nr.Arabic(t)||Nr["Arabic Supplement"](t)||Nr["Arabic Extended-A"](t)||Nr["Arabic Presentation Forms-A"](t)||Nr["Arabic Presentation Forms-B"](t))}function Hr(t){return!(746!==t&&747!==t&&(t<4352||!(Nr["Bopomofo Extended"](t)||Nr.Bopomofo(t)||Nr["CJK Compatibility Forms"](t)&&!(t>=65097&&t<=65103)||Nr["CJK Compatibility Ideographs"](t)||Nr["CJK Compatibility"](t)||Nr["CJK Radicals Supplement"](t)||Nr["CJK Strokes"](t)||!(!Nr["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||12336===t)||Nr["CJK Unified Ideographs Extension A"](t)||Nr["CJK Unified Ideographs"](t)||Nr["Enclosed CJK Letters and Months"](t)||Nr["Hangul Compatibility Jamo"](t)||Nr["Hangul Jamo Extended-A"](t)||Nr["Hangul Jamo Extended-B"](t)||Nr["Hangul Jamo"](t)||Nr["Hangul Syllables"](t)||Nr.Hiragana(t)||Nr["Ideographic Description Characters"](t)||Nr.Kanbun(t)||Nr["Kangxi Radicals"](t)||Nr["Katakana Phonetic Extensions"](t)||Nr.Katakana(t)&&12540!==t||!(!Nr["Halfwidth and Fullwidth Forms"](t)||65288===t||65289===t||65293===t||t>=65306&&t<=65310||65339===t||65341===t||65343===t||t>=65371&&t<=65503||65507===t||t>=65512&&t<=65519)||!(!Nr["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||Nr["Unified Canadian Aboriginal Syllabics"](t)||Nr["Unified Canadian Aboriginal Syllabics Extended"](t)||Nr["Vertical Forms"](t)||Nr["Yijing Hexagram Symbols"](t)||Nr["Yi Syllables"](t)||Nr["Yi Radicals"](t))))}function Gr(t){return!(Hr(t)||function(t){return!!(Nr["Latin-1 Supplement"](t)&&(167===t||169===t||174===t||177===t||188===t||189===t||190===t||215===t||247===t)||Nr["General Punctuation"](t)&&(8214===t||8224===t||8225===t||8240===t||8241===t||8251===t||8252===t||8258===t||8263===t||8264===t||8265===t||8273===t)||Nr["Letterlike Symbols"](t)||Nr["Number Forms"](t)||Nr["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||9003===t||t>=9085&&t<=9114||t>=9150&&t<=9165||9167===t||t>=9169&&t<=9179||t>=9186&&t<=9215)||Nr["Control Pictures"](t)&&9251!==t||Nr["Optical Character Recognition"](t)||Nr["Enclosed Alphanumerics"](t)||Nr["Geometric Shapes"](t)||Nr["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||Nr["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||Nr["CJK Symbols and Punctuation"](t)||Nr.Katakana(t)||Nr["Private Use Area"](t)||Nr["CJK Compatibility Forms"](t)||Nr["Small Form Variants"](t)||Nr["Halfwidth and Fullwidth Forms"](t)||8734===t||8756===t||8757===t||t>=9984&&t<=10087||t>=10102&&t<=10131||65532===t||65533===t)}(t))}function $r(t){return t>=1424&&t<=2303||Nr["Arabic Presentation Forms-A"](t)||Nr["Arabic Presentation Forms-B"](t)}function Zr(t,e){return!(!e&&$r(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||Nr.Khmer(t))}function qr(t){for(const e of t)if($r(e.charCodeAt(0)))return!0;return!1}const Kr="deferred",Wr="loading",Xr="loaded";let Jr=null,Yr="unavailable",tn=null;const en=function(t){t&&"string"==typeof t&&t.indexOf("NetworkError")>-1&&(Yr="error"),Jr&&Jr(t)};function rn(){nn.fire(new $("pluginStateChange",{pluginStatus:Yr,pluginURL:tn}))}const nn=new q,on=function(){return Yr},sn=function(){if(Yr!==Kr||!tn)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Yr=Wr,rn(),tn&&V({url:tn},(t=>{t?en(t):(Yr=Xr,rn())}))},an={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Yr===Xr||null!=an.applyArabicShaping,isLoading:()=>Yr===Wr,setState(t){if(!E())throw new Error("Cannot set the state of the rtl-text-plugin when not in the web-worker context");Yr=t.pluginStatus,tn=t.pluginURL},isParsed(){if(!E())throw new Error("rtl-text-plugin is only parsed on the worker-threads");return null!=an.applyArabicShaping&&null!=an.processBidirectionalText&&null!=an.processStyledBidirectionalText},getPluginURL(){if(!E())throw new Error("rtl-text-plugin url can only be queried from the worker threads");return tn}};class ln{constructor(t,e){this.zoom=t,e?(this.now=e.now,this.fadeDuration=e.fadeDuration,this.zoomHistory=e.zoomHistory,this.transition=e.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Or,this.transition={})}isSupportedScript(t){return function(t,e){for(const i of t)if(!Zr(i.charCodeAt(0),e))return!1;return!0}(t,an.isLoaded())}crossFadingFactor(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const t=this.zoom,e=t-Math.floor(t),i=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:e+(1-e)*i}:{fromScale:.5,toScale:1,t:1-(1-i)*e}}}class cn{constructor(t,e){this.property=t,this.value=e,this.expression=function(t,e){if(Ei(t))return new Ni(t,e);if(Fi(t)){const i=Oi(t,e);if("error"===i.result)throw new Error(i.value.map((t=>`${t.key}: ${t.message}`)).join(", "));return i.value}{let i=t;return"color"===e.type&&"string"==typeof t?i=Wt.parse(t):"padding"!==e.type||"number"!=typeof t&&!Array.isArray(t)?"variableAnchorOffsetCollection"===e.type&&Array.isArray(t)&&(i=ie.parse(t)):i=te.parse(t),{kind:"constant",evaluate:()=>i}}}(void 0===e?t.specification.default:e,t.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(t,e,i){return this.property.possiblyEvaluate(this,t,e,i)}}class un{constructor(t){this.property=t,this.value=new cn(t,void 0)}transitioned(t,e){return new dn(this.property,this.value,e,g({},t.transition,this.transition),t.now)}untransitioned(){return new dn(this.property,this.value,null,{},0)}}class hn{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return x(this._values[t].value.value)}setValue(t,e){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new un(this._values[t].property)),this._values[t].value=new cn(this._values[t].property,null===e?void 0:x(e))}getTransition(t){return x(this._values[t].transition)}setTransition(t,e){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new un(this._values[t].property)),this._values[t].transition=x(e)||void 0}serialize(){const t={};for(const e of Object.keys(this._values)){const i=this.getValue(e);void 0!==i&&(t[e]=i);const r=this.getTransition(e);void 0!==r&&(t[`${e}-transition`]=r)}return t}transitioned(t,e){const i=new pn(this._properties);for(const r of Object.keys(this._values))i._values[r]=this._values[r].transitioned(t,e._values[r]);return i}untransitioned(){const t=new pn(this._properties);for(const e of Object.keys(this._values))t._values[e]=this._values[e].untransitioned();return t}}class dn{constructor(t,e,i,r,n){this.property=t,this.value=e,this.begin=n+r.delay||0,this.end=this.begin+r.duration||0,t.specification.transition&&(r.delay||r.duration)&&(this.prior=i)}possiblyEvaluate(t,e,i){const r=t.now||0,n=this.value.possiblyEvaluate(t,e,i),o=this.prior;if(o){if(r>this.end)return this.prior=null,n;if(this.value.isDataDriven())return this.prior=null,n;if(r<this.begin)return o.possiblyEvaluate(t,e,i);{const s=(r-this.begin)/(this.end-this.begin);return this.property.interpolate(o.possiblyEvaluate(t,e,i),n,function(t){if(t<=0)return 0;if(t>=1)return 1;const e=t*t,i=e*t;return 4*(t<.5?i:3*(t-e)+i-.75)}(s))}}return n}}class pn{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,e,i){const r=new mn(this._properties);for(const n of Object.keys(this._values))r._values[n]=this._values[n].possiblyEvaluate(t,e,i);return r}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class fn{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}hasValue(t){return void 0!==this._values[t].value}getValue(t){return x(this._values[t].value)}setValue(t,e){this._values[t]=new cn(this._values[t].property,null===e?void 0:x(e))}serialize(){const t={};for(const e of Object.keys(this._values)){const i=this.getValue(e);void 0!==i&&(t[e]=i)}return t}possiblyEvaluate(t,e,i){const r=new mn(this._properties);for(const n of Object.keys(this._values))r._values[n]=this._values[n].possiblyEvaluate(t,e,i);return r}}class An{constructor(t,e,i){this.property=t,this.value=e,this.parameters=i}isConstant(){return"constant"===this.value.kind}constantOr(t){return"constant"===this.value.kind?this.value.value:t}evaluate(t,e,i,r){return this.property.evaluate(this.value,this.parameters,t,e,i,r)}}class mn{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class gn{constructor(t){this.specification=t}possiblyEvaluate(t,e){if(t.isDataDriven())throw new Error("Value should not be data driven");return t.expression.evaluate(e)}interpolate(t,e,i){const r=Ge[this.specification.type];return r?r(t,e,i):t}}class _n{constructor(t,e){this.specification=t,this.overrides=e}possiblyEvaluate(t,e,i,r){return new An(this,"constant"===t.expression.kind||"camera"===t.expression.kind?{kind:"constant",value:t.expression.evaluate(e,null,{},i,r)}:t.expression,e)}interpolate(t,e,i){if("constant"!==t.value.kind||"constant"!==e.value.kind)return t;if(void 0===t.value.value||void 0===e.value.value)return new An(this,{kind:"constant",value:void 0},t.parameters);const r=Ge[this.specification.type];if(r){const n=r(t.value.value,e.value.value,i);return new An(this,{kind:"constant",value:n},t.parameters)}return t}evaluate(t,e,i,r,n,o){return"constant"===t.kind?t.value:t.evaluate(e,i,r,n,o)}}class yn extends _n{possiblyEvaluate(t,e,i,r){if(void 0===t.value)return new An(this,{kind:"constant",value:void 0},e);if("constant"===t.expression.kind){const n=t.expression.evaluate(e,null,{},i,r),o="resolvedImage"===t.property.specification.type&&"string"!=typeof n?n.name:n,s=this._calculate(o,o,o,e);return new An(this,{kind:"constant",value:s},e)}if("camera"===t.expression.kind){const i=this._calculate(t.expression.evaluate({zoom:e.zoom-1}),t.expression.evaluate({zoom:e.zoom}),t.expression.evaluate({zoom:e.zoom+1}),e);return new An(this,{kind:"constant",value:i},e)}return new An(this,t.expression,e)}evaluate(t,e,i,r,n,o){if("source"===t.kind){const s=t.evaluate(e,i,r,n,o);return this._calculate(s,s,s,e)}return"composite"===t.kind?this._calculate(t.evaluate({zoom:Math.floor(e.zoom)-1},i,r),t.evaluate({zoom:Math.floor(e.zoom)},i,r),t.evaluate({zoom:Math.floor(e.zoom)+1},i,r),e):t.value}_calculate(t,e,i,r){return r.zoom>r.zoomHistory.lastIntegerZoom?{from:t,to:e}:{from:i,to:e}}interpolate(t){return t}}class vn{constructor(t){this.specification=t}possiblyEvaluate(t,e,i,r){if(void 0!==t.value){if("constant"===t.expression.kind){const n=t.expression.evaluate(e,null,{},i,r);return this._calculate(n,n,n,e)}return this._calculate(t.expression.evaluate(new ln(Math.floor(e.zoom-1),e)),t.expression.evaluate(new ln(Math.floor(e.zoom),e)),t.expression.evaluate(new ln(Math.floor(e.zoom+1),e)),e)}}_calculate(t,e,i,r){return r.zoom>r.zoomHistory.lastIntegerZoom?{from:t,to:e}:{from:i,to:e}}interpolate(t){return t}}class xn{constructor(t){this.specification=t}possiblyEvaluate(t,e,i,r){return!!t.expression.evaluate(e,null,{},i,r)}interpolate(){return!1}}class bn{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const e in t){const i=t[e];i.specification.overridable&&this.overridableProperties.push(e);const r=this.defaultPropertyValues[e]=new cn(i,void 0),n=this.defaultTransitionablePropertyValues[e]=new un(i);this.defaultTransitioningPropertyValues[e]=n.untransitioned(),this.defaultPossiblyEvaluatedValues[e]=r.possiblyEvaluate({})}}}Fr("DataDrivenProperty",_n),Fr("DataConstantProperty",gn),Fr("CrossFadedDataDrivenProperty",yn),Fr("CrossFadedProperty",vn),Fr("ColorRampProperty",xn);const wn="-transition";class Tn extends q{constructor(t,e){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1},"custom"!==t.type&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,"background"!==t.type&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),e.layout&&(this._unevaluatedLayout=new fn(e.layout)),e.paint)){this._transitionablePaint=new hn(e.paint);for(const e in t.paint)this.setPaintProperty(e,t.paint[e],{validate:!1});for(const e in t.layout)this.setLayoutProperty(e,t.layout[e],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new mn(e.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return"visibility"===t?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,e,i={}){null!=e&&this._validate(kr,`layers.${this.id}.layout.${t}`,t,e,i)||("visibility"!==t?this._unevaluatedLayout.setValue(t,e):this.visibility=e)}getPaintProperty(t){return t.endsWith(wn)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,e,i={}){if(null!=e&&this._validate(Mr,`layers.${this.id}.paint.${t}`,t,e,i))return!1;if(t.endsWith(wn))return this._transitionablePaint.setTransition(t.slice(0,-11),e||void 0),!1;{const i=this._transitionablePaint._values[t],r="cross-faded-data-driven"===i.property.specification["property-type"],n=i.value.isDataDriven(),o=i.value;this._transitionablePaint.setValue(t,e),this._handleSpecialPaintPropertyUpdate(t);const s=this._transitionablePaint._values[t].value;return s.isDataDriven()||n||r||this._handleOverridablePaintPropertyUpdate(t,o,s)}}_handleSpecialPaintPropertyUpdate(t){}_handleOverridablePaintPropertyUpdate(t,e,i){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||"none"===this.visibility}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,e){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,e)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,e)}serialize(){const t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),v(t,((t,e)=>!(void 0===t||"layout"===e&&!Object.keys(t).length||"paint"===e&&!Object.keys(t).length)))}_validate(t,e,i,r,n={}){return(!n||!1!==n.validate)&&Pr(this,t.call(Sr,{key:e,layerType:this.type,objectKey:i,value:r,styleSpec:K,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){const e=this.paint.get(t);if(e instanceof An&&bi(e.property.specification)&&("source"===e.value.kind||"composite"===e.value.kind)&&e.value.isStateDependent)return!0}return!1}}const Bn={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class En{constructor(t,e){this._structArray=t,this._pos1=e*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Cn{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,e){return t._trim(),e&&(t.isTransferred=!0,e.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const e=Object.create(this.prototype);return e.arrayBuffer=t.arrayBuffer,e.length=t.length,e.capacity=t.arrayBuffer.byteLength/e.bytesPerElement,e._refreshViews(),e}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const e=this.uint8;this._refreshViews(),e&&this.uint8.set(e)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Sn(t,e=1){let i=0,r=0;return{members:t.map((t=>{const n=Bn[t.type].BYTES_PER_ELEMENT,o=i=In(i,Math.max(e,n)),s=t.components||1;return r=Math.max(r,n),i+=n*s,{name:t.name,type:t.type,components:s,offset:o}})),size:In(i,Math.max(r,e)),alignment:e}}function In(t,e){return Math.ceil(t/e)*e}class Mn extends Cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e){const i=this.length;return this.resize(i+1),this.emplace(i,t,e)}emplace(t,e,i){const r=2*t;return this.int16[r+0]=e,this.int16[r+1]=i,t}}Mn.prototype.bytesPerElement=4,Fr("StructArrayLayout2i4",Mn);class kn extends Cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,i){const r=this.length;return this.resize(r+1),this.emplace(r,t,e,i)}emplace(t,e,i,r){const n=3*t;return this.int16[n+0]=e,this.int16[n+1]=i,this.int16[n+2]=r,t}}kn.prototype.bytesPerElement=6,Fr("StructArrayLayout3i6",kn);class Pn extends Cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,i,r){const n=this.length;return this.resize(n+1),this.emplace(n,t,e,i,r)}emplace(t,e,i,r,n){const o=4*t;return this.int16[o+0]=e,this.int16[o+1]=i,this.int16[o+2]=r,this.int16[o+3]=n,t}}Pn.prototype.bytesPerElement=8,Fr("StructArrayLayout4i8",Pn);class Ln extends Cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,i,r,n,o){const s=this.length;return this.resize(s+1),this.emplace(s,t,e,i,r,n,o)}emplace(t,e,i,r,n,o,s){const a=6*t;return this.int16[a+0]=e,this.int16[a+1]=i,this.int16[a+2]=r,this.int16[a+3]=n,this.int16[a+4]=o,this.int16[a+5]=s,t}}Ln.prototype.bytesPerElement=12,Fr("StructArrayLayout2i4i12",Ln);class zn extends Cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,i,r,n,o){const s=this.length;return this.resize(s+1),this.emplace(s,t,e,i,r,n,o)}emplace(t,e,i,r,n,o,s){const a=4*t,l=8*t;return this.int16[a+0]=e,this.int16[a+1]=i,this.uint8[l+4]=r,this.uint8[l+5]=n,this.uint8[l+6]=o,this.uint8[l+7]=s,t}}zn.prototype.bytesPerElement=8,Fr("StructArrayLayout2i4ub8",zn);class Fn extends Cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e){const i=this.length;return this.resize(i+1),this.emplace(i,t,e)}emplace(t,e,i){const r=2*t;return this.float32[r+0]=e,this.float32[r+1]=i,t}}Fn.prototype.bytesPerElement=8,Fr("StructArrayLayout2f8",Fn);class Dn extends Cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e,i,r,n,o,s,a,l,c){const u=this.length;return this.resize(u+1),this.emplace(u,t,e,i,r,n,o,s,a,l,c)}emplace(t,e,i,r,n,o,s,a,l,c,u){const h=10*t;return this.uint16[h+0]=e,this.uint16[h+1]=i,this.uint16[h+2]=r,this.uint16[h+3]=n,this.uint16[h+4]=o,this.uint16[h+5]=s,this.uint16[h+6]=a,this.uint16[h+7]=l,this.uint16[h+8]=c,this.uint16[h+9]=u,t}}Dn.prototype.bytesPerElement=20,Fr("StructArrayLayout10ui20",Dn);class Rn extends Cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e,i,r,n,o,s,a,l,c,u,h){const d=this.length;return this.resize(d+1),this.emplace(d,t,e,i,r,n,o,s,a,l,c,u,h)}emplace(t,e,i,r,n,o,s,a,l,c,u,h,d){const p=12*t;return this.int16[p+0]=e,this.int16[p+1]=i,this.int16[p+2]=r,this.int16[p+3]=n,this.uint16[p+4]=o,this.uint16[p+5]=s,this.uint16[p+6]=a,this.uint16[p+7]=l,this.int16[p+8]=c,this.int16[p+9]=u,this.int16[p+10]=h,this.int16[p+11]=d,t}}Rn.prototype.bytesPerElement=24,Fr("StructArrayLayout4i4ui4i24",Rn);class Un extends Cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,i){const r=this.length;return this.resize(r+1),this.emplace(r,t,e,i)}emplace(t,e,i,r){const n=3*t;return this.float32[n+0]=e,this.float32[n+1]=i,this.float32[n+2]=r,t}}Un.prototype.bytesPerElement=12,Fr("StructArrayLayout3f12",Un);class On extends Cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const e=this.length;return this.resize(e+1),this.emplace(e,t)}emplace(t,e){return this.uint32[1*t+0]=e,t}}On.prototype.bytesPerElement=4,Fr("StructArrayLayout1ul4",On);class Nn extends Cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e,i,r,n,o,s,a,l){const c=this.length;return this.resize(c+1),this.emplace(c,t,e,i,r,n,o,s,a,l)}emplace(t,e,i,r,n,o,s,a,l,c){const u=10*t,h=5*t;return this.int16[u+0]=e,this.int16[u+1]=i,this.int16[u+2]=r,this.int16[u+3]=n,this.int16[u+4]=o,this.int16[u+5]=s,this.uint32[h+3]=a,this.uint16[u+8]=l,this.uint16[u+9]=c,t}}Nn.prototype.bytesPerElement=20,Fr("StructArrayLayout6i1ul2ui20",Nn);class Qn extends Cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,i,r,n,o){const s=this.length;return this.resize(s+1),this.emplace(s,t,e,i,r,n,o)}emplace(t,e,i,r,n,o,s){const a=6*t;return this.int16[a+0]=e,this.int16[a+1]=i,this.int16[a+2]=r,this.int16[a+3]=n,this.int16[a+4]=o,this.int16[a+5]=s,t}}Qn.prototype.bytesPerElement=12,Fr("StructArrayLayout2i2i2i12",Qn);class Vn extends Cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,i,r,n){const o=this.length;return this.resize(o+1),this.emplace(o,t,e,i,r,n)}emplace(t,e,i,r,n,o){const s=4*t,a=8*t;return this.float32[s+0]=e,this.float32[s+1]=i,this.float32[s+2]=r,this.int16[a+6]=n,this.int16[a+7]=o,t}}Vn.prototype.bytesPerElement=16,Fr("StructArrayLayout2f1f2i16",Vn);class jn extends Cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,i,r){const n=this.length;return this.resize(n+1),this.emplace(n,t,e,i,r)}emplace(t,e,i,r,n){const o=12*t,s=3*t;return this.uint8[o+0]=e,this.uint8[o+1]=i,this.float32[s+1]=r,this.float32[s+2]=n,t}}jn.prototype.bytesPerElement=12,Fr("StructArrayLayout2ub2f12",jn);class Hn extends Cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e,i){const r=this.length;return this.resize(r+1),this.emplace(r,t,e,i)}emplace(t,e,i,r){const n=3*t;return this.uint16[n+0]=e,this.uint16[n+1]=i,this.uint16[n+2]=r,t}}Hn.prototype.bytesPerElement=6,Fr("StructArrayLayout3ui6",Hn);class Gn extends Cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,i,r,n,o,s,a,l,c,u,h,d,p,f,A,m){const g=this.length;return this.resize(g+1),this.emplace(g,t,e,i,r,n,o,s,a,l,c,u,h,d,p,f,A,m)}emplace(t,e,i,r,n,o,s,a,l,c,u,h,d,p,f,A,m,g){const _=24*t,y=12*t,v=48*t;return this.int16[_+0]=e,this.int16[_+1]=i,this.uint16[_+2]=r,this.uint16[_+3]=n,this.uint32[y+2]=o,this.uint32[y+3]=s,this.uint32[y+4]=a,this.uint16[_+10]=l,this.uint16[_+11]=c,this.uint16[_+12]=u,this.float32[y+7]=h,this.float32[y+8]=d,this.uint8[v+36]=p,this.uint8[v+37]=f,this.uint8[v+38]=A,this.uint32[y+10]=m,this.int16[_+22]=g,t}}Gn.prototype.bytesPerElement=48,Fr("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Gn);class $n extends Cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,i,r,n,o,s,a,l,c,u,h,d,p,f,A,m,g,_,y,v,x,b,w,T,B,E,C){const S=this.length;return this.resize(S+1),this.emplace(S,t,e,i,r,n,o,s,a,l,c,u,h,d,p,f,A,m,g,_,y,v,x,b,w,T,B,E,C)}emplace(t,e,i,r,n,o,s,a,l,c,u,h,d,p,f,A,m,g,_,y,v,x,b,w,T,B,E,C,S){const I=32*t,M=16*t;return this.int16[I+0]=e,this.int16[I+1]=i,this.int16[I+2]=r,this.int16[I+3]=n,this.int16[I+4]=o,this.int16[I+5]=s,this.int16[I+6]=a,this.int16[I+7]=l,this.uint16[I+8]=c,this.uint16[I+9]=u,this.uint16[I+10]=h,this.uint16[I+11]=d,this.uint16[I+12]=p,this.uint16[I+13]=f,this.uint16[I+14]=A,this.uint16[I+15]=m,this.uint16[I+16]=g,this.uint16[I+17]=_,this.uint16[I+18]=y,this.uint16[I+19]=v,this.uint16[I+20]=x,this.uint16[I+21]=b,this.uint16[I+22]=w,this.uint32[M+12]=T,this.float32[M+13]=B,this.float32[M+14]=E,this.uint16[I+30]=C,this.uint16[I+31]=S,t}}$n.prototype.bytesPerElement=64,Fr("StructArrayLayout8i15ui1ul2f2ui64",$n);class Zn extends Cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const e=this.length;return this.resize(e+1),this.emplace(e,t)}emplace(t,e){return this.float32[1*t+0]=e,t}}Zn.prototype.bytesPerElement=4,Fr("StructArrayLayout1f4",Zn);class qn extends Cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,i){const r=this.length;return this.resize(r+1),this.emplace(r,t,e,i)}emplace(t,e,i,r){const n=3*t;return this.uint16[6*t+0]=e,this.float32[n+1]=i,this.float32[n+2]=r,t}}qn.prototype.bytesPerElement=12,Fr("StructArrayLayout1ui2f12",qn);class Kn extends Cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e,i){const r=this.length;return this.resize(r+1),this.emplace(r,t,e,i)}emplace(t,e,i,r){const n=4*t;return this.uint32[2*t+0]=e,this.uint16[n+2]=i,this.uint16[n+3]=r,t}}Kn.prototype.bytesPerElement=8,Fr("StructArrayLayout1ul2ui8",Kn);class Wn extends Cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e){const i=this.length;return this.resize(i+1),this.emplace(i,t,e)}emplace(t,e,i){const r=2*t;return this.uint16[r+0]=e,this.uint16[r+1]=i,t}}Wn.prototype.bytesPerElement=4,Fr("StructArrayLayout2ui4",Wn);class Xn extends Cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const e=this.length;return this.resize(e+1),this.emplace(e,t)}emplace(t,e){return this.uint16[1*t+0]=e,t}}Xn.prototype.bytesPerElement=2,Fr("StructArrayLayout1ui2",Xn);class Jn extends Cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,i,r){const n=this.length;return this.resize(n+1),this.emplace(n,t,e,i,r)}emplace(t,e,i,r,n){const o=4*t;return this.float32[o+0]=e,this.float32[o+1]=i,this.float32[o+2]=r,this.float32[o+3]=n,t}}Jn.prototype.bytesPerElement=16,Fr("StructArrayLayout4f16",Jn);class Yn extends En{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new o(this.anchorPointX,this.anchorPointY)}}Yn.prototype.size=20;class to extends Nn{get(t){return new Yn(this,t)}}Fr("CollisionBoxArray",to);class eo extends En{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(t){this._structArray.uint8[this._pos1+37]=t}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(t){this._structArray.uint8[this._pos1+38]=t}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(t){this._structArray.uint32[this._pos4+10]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}eo.prototype.size=48;class io extends Gn{get(t){return new eo(this,t)}}Fr("PlacedSymbolArray",io);class ro extends En{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(t){this._structArray.uint32[this._pos4+12]=t}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}ro.prototype.size=64;class no extends $n{get(t){return new ro(this,t)}}Fr("SymbolInstanceArray",no);class oo extends Zn{getoffsetX(t){return this.float32[1*t+0]}}Fr("GlyphOffsetArray",oo);class so extends kn{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}Fr("SymbolLineVertexArray",so);class ao extends En{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}ao.prototype.size=12;class lo extends qn{get(t){return new ao(this,t)}}Fr("TextAnchorOffsetArray",lo);class co extends En{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}co.prototype.size=8;class uo extends Kn{get(t){return new co(this,t)}}Fr("FeatureIndexArray",uo);class ho extends Mn{}class po extends Mn{}class fo extends Mn{}class Ao extends Ln{}class mo extends zn{}class go extends Fn{}class _o extends Dn{}class yo extends Rn{}class vo extends Un{}class xo extends On{}class bo extends Qn{}class wo extends jn{}class To extends Hn{}class Bo extends Wn{}const Eo=Sn([{name:"a_pos",components:2,type:"Int16"}],4),{members:Co}=Eo;class So{constructor(t=[]){this.segments=t}prepareSegment(t,e,i,r){let n=this.segments[this.segments.length-1];return t>So.MAX_VERTEX_ARRAY_LENGTH&&w(`Max vertices per segment is ${So.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!n||n.vertexLength+t>So.MAX_VERTEX_ARRAY_LENGTH||n.sortKey!==r)&&(n={vertexOffset:e.length,primitiveOffset:i.length,vertexLength:0,primitiveLength:0},void 0!==r&&(n.sortKey=r),this.segments.push(n)),n}get(){return this.segments}destroy(){for(const t of this.segments)for(const e in t.vaos)t.vaos[e].destroy()}static simpleSegment(t,e,i,r){return new So([{vertexOffset:t,primitiveOffset:e,vertexLength:i,primitiveLength:r,vaos:{},sortKey:0}])}}function Io(t,e){return 256*(t=A(Math.floor(t),0,255))+A(Math.floor(e),0,255)}So.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Fr("SegmentVector",So);const Mo=Sn([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var ko={exports:{}},Po={exports:{}};Po.exports=function(t,e){var i,r,n,o,s,a,l,c;for(r=t.length-(i=3&t.length),n=e,s=3432918353,a=461845907,c=0;c<r;)l=255&t.charCodeAt(c)|(255&t.charCodeAt(++c))<<8|(255&t.charCodeAt(++c))<<16|(255&t.charCodeAt(++c))<<24,++c,n=27492+(65535&(o=5*(65535&(n=(n^=l=(65535&(l=(l=(65535&l)*s+(((l>>>16)*s&65535)<<16)&4294967295)<<15|l>>>17))*a+(((l>>>16)*a&65535)<<16)&4294967295)<<13|n>>>19))+((5*(n>>>16)&65535)<<16)&4294967295))+((58964+(o>>>16)&65535)<<16);switch(l=0,i){case 3:l^=(255&t.charCodeAt(c+2))<<16;case 2:l^=(255&t.charCodeAt(c+1))<<8;case 1:n^=l=(65535&(l=(l=(65535&(l^=255&t.charCodeAt(c)))*s+(((l>>>16)*s&65535)<<16)&4294967295)<<15|l>>>17))*a+(((l>>>16)*a&65535)<<16)&4294967295}return n^=t.length,n=2246822507*(65535&(n^=n>>>16))+((2246822507*(n>>>16)&65535)<<16)&4294967295,n=3266489909*(65535&(n^=n>>>13))+((3266489909*(n>>>16)&65535)<<16)&4294967295,(n^=n>>>16)>>>0};var Lo=Po.exports,zo={exports:{}};zo.exports=function(t,e){for(var i,r=t.length,n=e^r,o=0;r>=4;)i=1540483477*(65535&(i=255&t.charCodeAt(o)|(255&t.charCodeAt(++o))<<8|(255&t.charCodeAt(++o))<<16|(255&t.charCodeAt(++o))<<24))+((1540483477*(i>>>16)&65535)<<16),n=1540483477*(65535&n)+((1540483477*(n>>>16)&65535)<<16)^(i=1540483477*(65535&(i^=i>>>24))+((1540483477*(i>>>16)&65535)<<16)),r-=4,++o;switch(r){case 3:n^=(255&t.charCodeAt(o+2))<<16;case 2:n^=(255&t.charCodeAt(o+1))<<8;case 1:n=1540483477*(65535&(n^=255&t.charCodeAt(o)))+((1540483477*(n>>>16)&65535)<<16)}return n=1540483477*(65535&(n^=n>>>13))+((1540483477*(n>>>16)&65535)<<16),(n^=n>>>15)>>>0};var Fo=Lo,Do=zo.exports;ko.exports=Fo,ko.exports.murmur3=Fo,ko.exports.murmur2=Do;var Ro=i(ko.exports);class Uo{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,e,i,r){this.ids.push(Oo(t)),this.positions.push(e,i,r)}getPositions(t){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const e=Oo(t);let i=0,r=this.ids.length-1;for(;i<r;){const t=i+r>>1;this.ids[t]>=e?r=t:i=t+1}const n=[];for(;this.ids[i]===e;)n.push({index:this.positions[3*i],start:this.positions[3*i+1],end:this.positions[3*i+2]}),i++;return n}static serialize(t,e){const i=new Float64Array(t.ids),r=new Uint32Array(t.positions);return No(i,r,0,i.length-1),e&&e.push(i.buffer,r.buffer),{ids:i,positions:r}}static deserialize(t){const e=new Uo;return e.ids=t.ids,e.positions=t.positions,e.indexed=!0,e}}function Oo(t){const e=+t;return!isNaN(e)&&e<=Number.MAX_SAFE_INTEGER?e:Ro(String(t))}function No(t,e,i,r){for(;i<r;){const n=t[i+r>>1];let o=i-1,s=r+1;for(;;){do{o++}while(t[o]<n);do{s--}while(t[s]>n);if(o>=s)break;Qo(t,o,s),Qo(e,3*o,3*s),Qo(e,3*o+1,3*s+1),Qo(e,3*o+2,3*s+2)}s-i<r-s?(No(t,e,i,s),i=s+1):(No(t,e,s+1,r),r=s)}}function Qo(t,e,i){const r=t[e];t[e]=t[i],t[i]=r}Fr("FeaturePositionMap",Uo);class Vo{constructor(t,e){this.gl=t.gl,this.location=e}}class jo extends Vo{constructor(t,e){super(t,e),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))}}class Ho extends Vo{constructor(t,e){super(t,e),this.current=[0,0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))}}class Go extends Vo{constructor(t,e){super(t,e),this.current=Wt.transparent}set(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))}}const $o=new Float32Array(16);function Zo(t){return[Io(255*t.r,255*t.g),Io(255*t.b,255*t.a)]}class qo{constructor(t,e,i){this.value=t,this.uniformNames=e.map((t=>`u_${t}`)),this.type=i}setUniform(t,e,i){t.set(i.constantOr(this.value))}getBinding(t,e,i){return"color"===this.type?new Go(t,e):new jo(t,e)}}class Ko{constructor(t,e){this.uniformNames=e.map((t=>`u_${t}`)),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,e){this.pixelRatioFrom=e.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=e.tlbr,this.patternTo=t.tlbr}setUniform(t,e,i,r){const n="u_pattern_to"===r?this.patternTo:"u_pattern_from"===r?this.patternFrom:"u_pixel_ratio_to"===r?this.pixelRatioTo:"u_pixel_ratio_from"===r?this.pixelRatioFrom:null;n&&t.set(n)}getBinding(t,e,i){return"u_pattern"===i.substr(0,9)?new Ho(t,e):new jo(t,e)}}class Wo{constructor(t,e,i,r){this.expression=t,this.type=i,this.maxValue=0,this.paintVertexAttributes=e.map((t=>({name:`a_${t}`,type:"Float32",components:"color"===i?2:1,offset:0}))),this.paintVertexArray=new r}populatePaintArray(t,e,i,r,n){const o=this.paintVertexArray.length,s=this.expression.evaluate(new ln(0),e,{},r,[],n);this.paintVertexArray.resize(t),this._setPaintValue(o,t,s)}updatePaintArray(t,e,i,r){const n=this.expression.evaluate({zoom:0},i,r);this._setPaintValue(t,e,n)}_setPaintValue(t,e,i){if("color"===this.type){const r=Zo(i);for(let i=t;i<e;i++)this.paintVertexArray.emplace(i,r[0],r[1])}else{for(let r=t;r<e;r++)this.paintVertexArray.emplace(r,i);this.maxValue=Math.max(this.maxValue,Math.abs(i))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Xo{constructor(t,e,i,r,n,o){this.expression=t,this.uniformNames=e.map((t=>`u_${t}_t`)),this.type=i,this.useIntegerZoom=r,this.zoom=n,this.maxValue=0,this.paintVertexAttributes=e.map((t=>({name:`a_${t}`,type:"Float32",components:"color"===i?4:2,offset:0}))),this.paintVertexArray=new o}populatePaintArray(t,e,i,r,n){const o=this.expression.evaluate(new ln(this.zoom),e,{},r,[],n),s=this.expression.evaluate(new ln(this.zoom+1),e,{},r,[],n),a=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(a,t,o,s)}updatePaintArray(t,e,i,r){const n=this.expression.evaluate({zoom:this.zoom},i,r),o=this.expression.evaluate({zoom:this.zoom+1},i,r);this._setPaintValue(t,e,n,o)}_setPaintValue(t,e,i,r){if("color"===this.type){const n=Zo(i),o=Zo(r);for(let i=t;i<e;i++)this.paintVertexArray.emplace(i,n[0],n[1],o[0],o[1])}else{for(let n=t;n<e;n++)this.paintVertexArray.emplace(n,i,r);this.maxValue=Math.max(this.maxValue,Math.abs(i),Math.abs(r))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,e){const i=this.useIntegerZoom?Math.floor(e.zoom):e.zoom,r=A(this.expression.interpolationFactor(i,this.zoom,this.zoom+1),0,1);t.set(r)}getBinding(t,e,i){return new jo(t,e)}}class Jo{constructor(t,e,i,r,n,o){this.expression=t,this.type=e,this.useIntegerZoom=i,this.zoom=r,this.layerId=o,this.zoomInPaintVertexArray=new n,this.zoomOutPaintVertexArray=new n}populatePaintArray(t,e,i){const r=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(r,t,e.patterns&&e.patterns[this.layerId],i)}updatePaintArray(t,e,i,r,n){this._setPaintValues(t,e,i.patterns&&i.patterns[this.layerId],n)}_setPaintValues(t,e,i,r){if(!r||!i)return;const{min:n,mid:o,max:s}=i,a=r[n],l=r[o],c=r[s];if(a&&l&&c)for(let i=t;i<e;i++)this.zoomInPaintVertexArray.emplace(i,l.tl[0],l.tl[1],l.br[0],l.br[1],a.tl[0],a.tl[1],a.br[0],a.br[1],l.pixelRatio,a.pixelRatio),this.zoomOutPaintVertexArray.emplace(i,l.tl[0],l.tl[1],l.br[0],l.br[1],c.tl[0],c.tl[1],c.br[0],c.br[1],l.pixelRatio,c.pixelRatio)}upload(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,Mo.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,Mo.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Yo{constructor(t,e,i){this.binders={},this._buffers=[];const r=[];for(const n in t.paint._values){if(!i(n))continue;const o=t.paint.get(n);if(!(o instanceof An&&bi(o.property.specification)))continue;const s=es(n,t.type),a=o.value,l=o.property.specification.type,c=o.property.useIntegerZoom,u=o.property.specification["property-type"],h="cross-faded"===u||"cross-faded-data-driven"===u;if("constant"===a.kind)this.binders[n]=h?new Ko(a.value,s):new qo(a.value,s,l),r.push(`/u_${n}`);else if("source"===a.kind||h){const i=is(n,l,"source");this.binders[n]=h?new Jo(a,l,c,e,i,t.id):new Wo(a,s,l,i),r.push(`/a_${n}`)}else{const t=is(n,l,"composite");this.binders[n]=new Xo(a,s,l,c,e,t),r.push(`/z_${n}`)}}this.cacheKey=r.sort().join("")}getMaxValue(t){const e=this.binders[t];return e instanceof Wo||e instanceof Xo?e.maxValue:0}populatePaintArrays(t,e,i,r,n){for(const o in this.binders){const s=this.binders[o];(s instanceof Wo||s instanceof Xo||s instanceof Jo)&&s.populatePaintArray(t,e,i,r,n)}}setConstantPatternPositions(t,e){for(const i in this.binders){const r=this.binders[i];r instanceof Ko&&r.setConstantPatternPositions(t,e)}}updatePaintArrays(t,e,i,r,n){let o=!1;for(const s in t){const a=e.getPositions(s);for(const e of a){const a=i.feature(e.index);for(const i in this.binders){const l=this.binders[i];if((l instanceof Wo||l instanceof Xo||l instanceof Jo)&&!0===l.expression.isStateDependent){const c=r.paint.get(i);l.expression=c.value,l.updatePaintArray(e.start,e.end,a,t[s],n),o=!0}}}}return o}defines(){const t=[];for(const e in this.binders){const i=this.binders[e];(i instanceof qo||i instanceof Ko)&&t.push(...i.uniformNames.map((t=>`#define HAS_UNIFORM_${t}`)))}return t}getBinderAttributes(){const t=[];for(const e in this.binders){const i=this.binders[e];if(i instanceof Wo||i instanceof Xo)for(let e=0;e<i.paintVertexAttributes.length;e++)t.push(i.paintVertexAttributes[e].name);else if(i instanceof Jo)for(let e=0;e<Mo.members.length;e++)t.push(Mo.members[e].name)}return t}getBinderUniforms(){const t=[];for(const e in this.binders){const i=this.binders[e];if(i instanceof qo||i instanceof Ko||i instanceof Xo)for(const e of i.uniformNames)t.push(e)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t,e){const i=[];for(const r in this.binders){const n=this.binders[r];if(n instanceof qo||n instanceof Ko||n instanceof Xo)for(const o of n.uniformNames)if(e[o]){const s=n.getBinding(t,e[o],o);i.push({name:o,property:r,binding:s})}}return i}setUniforms(t,e,i,r){for(const{name:t,property:n,binding:o}of e)this.binders[n].setUniform(o,r,i.get(n),t)}updatePaintBuffers(t){this._buffers=[];for(const e in this.binders){const i=this.binders[e];if(t&&i instanceof Jo){const e=2===t.fromScale?i.zoomInPaintVertexBuffer:i.zoomOutPaintVertexBuffer;e&&this._buffers.push(e)}else(i instanceof Wo||i instanceof Xo)&&i.paintVertexBuffer&&this._buffers.push(i.paintVertexBuffer)}}upload(t){for(const e in this.binders){const i=this.binders[e];(i instanceof Wo||i instanceof Xo||i instanceof Jo)&&i.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const e=this.binders[t];(e instanceof Wo||e instanceof Xo||e instanceof Jo)&&e.destroy()}}}class ts{constructor(t,e,i=(()=>!0)){this.programConfigurations={};for(const r of t)this.programConfigurations[r.id]=new Yo(r,e,i);this.needsUpload=!1,this._featureMap=new Uo,this._bufferOffset=0}populatePaintArrays(t,e,i,r,n,o){for(const i in this.programConfigurations)this.programConfigurations[i].populatePaintArrays(t,e,r,n,o);void 0!==e.id&&this._featureMap.add(e.id,i,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,e,i,r){for(const n of i)this.needsUpload=this.programConfigurations[n.id].updatePaintArrays(t,this._featureMap,e,n,r)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const e in this.programConfigurations)this.programConfigurations[e].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}function es(t,e){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[t]||[t.replace(`${e}-`,"").replace(/-/g,"_")]}function is(t,e,i){const r={color:{source:Fn,composite:Jn},number:{source:Zn,composite:Fn}},n=function(t){return{"line-pattern":{source:_o,composite:_o},"fill-pattern":{source:_o,composite:_o},"fill-extrusion-pattern":{source:_o,composite:_o}}[t]}(t);return n&&n[i]||r[e][i]}Fr("ConstantBinder",qo),Fr("CrossFadedConstantBinder",Ko),Fr("SourceExpressionBinder",Wo),Fr("CrossFadedCompositeBinder",Jo),Fr("CompositeExpressionBinder",Xo),Fr("ProgramConfiguration",Yo,{omit:["_buffers"]}),Fr("ProgramConfigurationSet",ts);const rs=8192,ns=Math.pow(2,14)-1,os=-ns-1;function ss(t){const e=rs/t.extent,i=t.loadGeometry();for(let t=0;t<i.length;t++){const r=i[t];for(let t=0;t<r.length;t++){const i=r[t],n=Math.round(i.x*e),o=Math.round(i.y*e);i.x=A(n,os,ns),i.y=A(o,os,ns),(n<i.x||n>i.x+1||o<i.y||o>i.y+1)&&w("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return i}function as(t,e){return{type:t.type,id:t.id,properties:t.properties,geometry:e?ss(t):[]}}function ls(t,e,i,r,n){t.emplaceBack(2*e+(r+1)/2,2*i+(n+1)/2)}class cs{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((t=>t.id)),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new po,this.indexArray=new To,this.segments=new So,this.programConfigurations=new ts(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter((t=>t.isStateDependent())).map((t=>t.id))}populate(t,e,i){const r=this.layers[0],n=[];let o=null,s=!1;"circle"===r.type&&(o=r.layout.get("circle-sort-key"),s=!o.isConstant());for(const{feature:e,id:r,index:a,sourceLayerIndex:l}of t){const t=this.layers[0]._featureFilter.needGeometry,c=as(e,t);if(!this.layers[0]._featureFilter.filter(new ln(this.zoom),c,i))continue;const u=s?o.evaluate(c,{},i):void 0,h={id:r,properties:e.properties,type:e.type,sourceLayerIndex:l,index:a,geometry:t?c.geometry:ss(e),patterns:{},sortKey:u};n.push(h)}s&&n.sort(((t,e)=>t.sortKey-e.sortKey));for(const r of n){const{geometry:n,index:o,sourceLayerIndex:s}=r,a=t[o].feature;this.addFeature(r,n,o,i),e.featureIndex.insert(a,n,o,s,this.index)}}update(t,e,i){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,i)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Co),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,e,i,r){for(const i of e)for(const e of i){const i=e.x,r=e.y;if(i<0||i>=rs||r<0||r>=rs)continue;const n=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),o=n.vertexLength;ls(this.layoutVertexArray,i,r,-1,-1),ls(this.layoutVertexArray,i,r,1,-1),ls(this.layoutVertexArray,i,r,1,1),ls(this.layoutVertexArray,i,r,-1,1),this.indexArray.emplaceBack(o,o+1,o+2),this.indexArray.emplaceBack(o,o+3,o+2),n.vertexLength+=4,n.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,i,{},r)}}function us(t,e){for(let i=0;i<t.length;i++)if(ys(e,t[i]))return!0;for(let i=0;i<e.length;i++)if(ys(t,e[i]))return!0;return!!fs(t,e)}function hs(t,e,i){return!!ys(t,e)||!!ms(e,t,i)}function ds(t,e){if(1===t.length)return _s(e,t[0]);for(let i=0;i<e.length;i++){const r=e[i];for(let e=0;e<r.length;e++)if(ys(t,r[e]))return!0}for(let i=0;i<t.length;i++)if(_s(e,t[i]))return!0;for(let i=0;i<e.length;i++)if(fs(t,e[i]))return!0;return!1}function ps(t,e,i){if(t.length>1){if(fs(t,e))return!0;for(let r=0;r<e.length;r++)if(ms(e[r],t,i))return!0}for(let r=0;r<t.length;r++)if(ms(t[r],e,i))return!0;return!1}function fs(t,e){if(0===t.length||0===e.length)return!1;for(let i=0;i<t.length-1;i++){const r=t[i],n=t[i+1];for(let t=0;t<e.length-1;t++)if(As(r,n,e[t],e[t+1]))return!0}return!1}function As(t,e,i,r){return T(t,i,r)!==T(e,i,r)&&T(t,e,i)!==T(t,e,r)}function ms(t,e,i){const r=i*i;if(1===e.length)return t.distSqr(e[0])<r;for(let i=1;i<e.length;i++)if(gs(t,e[i-1],e[i])<r)return!0;return!1}function gs(t,e,i){const r=e.distSqr(i);if(0===r)return t.distSqr(e);const n=((t.x-e.x)*(i.x-e.x)+(t.y-e.y)*(i.y-e.y))/r;return t.distSqr(n<0?e:n>1?i:i.sub(e)._mult(n)._add(e))}function _s(t,e){let i,r,n,o=!1;for(let s=0;s<t.length;s++){i=t[s];for(let t=0,s=i.length-1;t<i.length;s=t++)r=i[t],n=i[s],r.y>e.y!=n.y>e.y&&e.x<(n.x-r.x)*(e.y-r.y)/(n.y-r.y)+r.x&&(o=!o)}return o}function ys(t,e){let i=!1;for(let r=0,n=t.length-1;r<t.length;n=r++){const o=t[r],s=t[n];o.y>e.y!=s.y>e.y&&e.x<(s.x-o.x)*(e.y-o.y)/(s.y-o.y)+o.x&&(i=!i)}return i}function vs(t,e,i){const r=i[0],n=i[2];if(t.x<r.x&&e.x<r.x||t.x>n.x&&e.x>n.x||t.y<r.y&&e.y<r.y||t.y>n.y&&e.y>n.y)return!1;const o=T(t,e,i[0]);return o!==T(t,e,i[1])||o!==T(t,e,i[2])||o!==T(t,e,i[3])}function xs(t,e,i){const r=e.paint.get(t).value;return"constant"===r.kind?r.value:i.programConfigurations.get(e.id).getMaxValue(t)}function bs(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function ws(t,e,i,r,n){if(!e[0]&&!e[1])return t;const s=o.convert(e)._mult(n);"viewport"===i&&s._rotate(-r);const a=[];for(let e=0;e<t.length;e++)a.push(t[e].sub(s));return a}let Ts,Bs;Fr("CircleBucket",cs,{omit:["layers"]});var Es={get paint(){return Bs=Bs||new bn({"circle-radius":new _n(K.paint_circle["circle-radius"]),"circle-color":new _n(K.paint_circle["circle-color"]),"circle-blur":new _n(K.paint_circle["circle-blur"]),"circle-opacity":new _n(K.paint_circle["circle-opacity"]),"circle-translate":new gn(K.paint_circle["circle-translate"]),"circle-translate-anchor":new gn(K.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new gn(K.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new gn(K.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new _n(K.paint_circle["circle-stroke-width"]),"circle-stroke-color":new _n(K.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new _n(K.paint_circle["circle-stroke-opacity"])})},get layout(){return Ts=Ts||new bn({"circle-sort-key":new _n(K.layout_circle["circle-sort-key"])})}},Cs=1e-6,Ss="undefined"!=typeof Float32Array?Float32Array:Array;function Is(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Ms(t,e,i){var r=e[0],n=e[1],o=e[2],s=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=e[8],d=e[9],p=e[10],f=e[11],A=e[12],m=e[13],g=e[14],_=e[15],y=i[0],v=i[1],x=i[2],b=i[3];return t[0]=y*r+v*a+x*h+b*A,t[1]=y*n+v*l+x*d+b*m,t[2]=y*o+v*c+x*p+b*g,t[3]=y*s+v*u+x*f+b*_,t[4]=(y=i[4])*r+(v=i[5])*a+(x=i[6])*h+(b=i[7])*A,t[5]=y*n+v*l+x*d+b*m,t[6]=y*o+v*c+x*p+b*g,t[7]=y*s+v*u+x*f+b*_,t[8]=(y=i[8])*r+(v=i[9])*a+(x=i[10])*h+(b=i[11])*A,t[9]=y*n+v*l+x*d+b*m,t[10]=y*o+v*c+x*p+b*g,t[11]=y*s+v*u+x*f+b*_,t[12]=(y=i[12])*r+(v=i[13])*a+(x=i[14])*h+(b=i[15])*A,t[13]=y*n+v*l+x*d+b*m,t[14]=y*o+v*c+x*p+b*g,t[15]=y*s+v*u+x*f+b*_,t}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var ks,Ps=Ms;function Ls(t,e,i){var r=e[0],n=e[1],o=e[2],s=e[3];return t[0]=i[0]*r+i[4]*n+i[8]*o+i[12]*s,t[1]=i[1]*r+i[5]*n+i[9]*o+i[13]*s,t[2]=i[2]*r+i[6]*n+i[10]*o+i[14]*s,t[3]=i[3]*r+i[7]*n+i[11]*o+i[15]*s,t}ks=new Ss(4),Ss!=Float32Array&&(ks[0]=0,ks[1]=0,ks[2]=0,ks[3]=0);class zs extends Tn{constructor(t){super(t,Es)}createBucket(t){return new cs(t)}queryRadius(t){const e=t;return xs("circle-radius",this,e)+xs("circle-stroke-width",this,e)+bs(this.paint.get("circle-translate"))}queryIntersectsFeature(t,e,i,r,n,o,s,a){const l=ws(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),o.angle,s),c=this.paint.get("circle-radius").evaluate(e,i)+this.paint.get("circle-stroke-width").evaluate(e,i),u="map"===this.paint.get("circle-pitch-alignment"),h=u?l:function(t,e){return t.map((t=>Fs(t,e)))}(l,a),d=u?c*s:c;for(const t of r)for(const e of t){const t=u?e:Fs(e,a);let i=d;const r=Ls([],[e.x,e.y,0,1],a);if("viewport"===this.paint.get("circle-pitch-scale")&&"map"===this.paint.get("circle-pitch-alignment")?i*=r[3]/o.cameraToCenterDistance:"map"===this.paint.get("circle-pitch-scale")&&"viewport"===this.paint.get("circle-pitch-alignment")&&(i*=o.cameraToCenterDistance/r[3]),hs(h,t,i))return!0}return!1}}function Fs(t,e){const i=Ls([],[t.x,t.y,0,1],e);return new o(i[0]/i[3],i[1]/i[3])}class Ds extends cs{}let Rs;Fr("HeatmapBucket",Ds,{omit:["layers"]});var Us={get paint(){return Rs=Rs||new bn({"heatmap-radius":new _n(K.paint_heatmap["heatmap-radius"]),"heatmap-weight":new _n(K.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new gn(K.paint_heatmap["heatmap-intensity"]),"heatmap-color":new xn(K.paint_heatmap["heatmap-color"]),"heatmap-opacity":new gn(K.paint_heatmap["heatmap-opacity"])})}};function Os(t,{width:e,height:i},r,n){if(n){if(n instanceof Uint8ClampedArray)n=new Uint8Array(n.buffer);else if(n.length!==e*i*r)throw new RangeError(`mismatched image size. expected: ${n.length} but got: ${e*i*r}`)}else n=new Uint8Array(e*i*r);return t.width=e,t.height=i,t.data=n,t}function Ns(t,{width:e,height:i},r){if(e===t.width&&i===t.height)return;const n=Os({},{width:e,height:i},r);Qs(t,n,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,e),height:Math.min(t.height,i)},r),t.width=e,t.height=i,t.data=n.data}function Qs(t,e,i,r,n,o){if(0===n.width||0===n.height)return e;if(n.width>t.width||n.height>t.height||i.x>t.width-n.width||i.y>t.height-n.height)throw new RangeError("out of range source coordinates for image copy");if(n.width>e.width||n.height>e.height||r.x>e.width-n.width||r.y>e.height-n.height)throw new RangeError("out of range destination coordinates for image copy");const s=t.data,a=e.data;if(s===a)throw new Error("srcData equals dstData, so image is already copied");for(let l=0;l<n.height;l++){const c=((i.y+l)*t.width+i.x)*o,u=((r.y+l)*e.width+r.x)*o;for(let t=0;t<n.width*o;t++)a[u+t]=s[c+t]}return e}class Vs{constructor(t,e){Os(this,t,1,e)}resize(t){Ns(this,t,1)}clone(){return new Vs({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,e,i,r,n){Qs(t,e,i,r,n,1)}}class js{constructor(t,e){Os(this,t,4,e)}resize(t){Ns(this,t,4)}replace(t,e){e?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new js({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,e,i,r,n){Qs(t,e,i,r,n,4)}}function Hs(t){const e={},i=t.resolution||256,r=t.clips?t.clips.length:1,n=t.image||new js({width:i,height:r});if(Math.log(i)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${i}`);const o=(i,r,o)=>{e[t.evaluationKey]=o;const s=t.expression.evaluate(e);n.data[i+r+0]=Math.floor(255*s.r/s.a),n.data[i+r+1]=Math.floor(255*s.g/s.a),n.data[i+r+2]=Math.floor(255*s.b/s.a),n.data[i+r+3]=Math.floor(255*s.a)};if(t.clips)for(let e=0,n=0;e<r;++e,n+=4*i)for(let r=0,s=0;r<i;r++,s+=4){const a=r/(i-1),{start:l,end:c}=t.clips[e];o(n,s,l*(1-a)+c*a)}else for(let t=0,e=0;t<i;t++,e+=4)o(0,e,t/(i-1));return n}Fr("AlphaImage",Vs),Fr("RGBAImage",js);class Gs extends Tn{createBucket(t){return new Ds(t)}constructor(t){super(t,Us),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){"heatmap-color"===t&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Hs({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}}let $s;var Zs={get paint(){return $s=$s||new bn({"hillshade-illumination-direction":new gn(K.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new gn(K.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new gn(K.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new gn(K.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new gn(K.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new gn(K.paint_hillshade["hillshade-accent-color"])})}};class qs extends Tn{constructor(t){super(t,Zs)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}}const Ks=Sn([{name:"a_pos",components:2,type:"Int16"}],4),{members:Ws}=Ks;var Xs={exports:{}};function Js(t,e,i){i=i||2;var r,n,o,s,a,l,c,u=e&&e.length,h=u?e[0]*i:t.length,d=Ys(t,0,h,i,!0),p=[];if(!d||d.next===d.prev)return p;if(u&&(d=function(t,e,i,r){var n,o,s,a=[];for(n=0,o=e.length;n<o;n++)(s=Ys(t,e[n]*r,n<o-1?e[n+1]*r:t.length,r,!1))===s.next&&(s.steiner=!0),a.push(ua(s));for(a.sort(sa),n=0;n<a.length;n++)i=aa(a[n],i);return i}(t,e,d,i)),t.length>80*i){r=o=t[0],n=s=t[1];for(var f=i;f<h;f+=i)(a=t[f])<r&&(r=a),(l=t[f+1])<n&&(n=l),a>o&&(o=a),l>s&&(s=l);c=0!==(c=Math.max(o-r,s-n))?32767/c:0}return ea(d,p,i,r,n,c,0),p}function Ys(t,e,i,r,n){var o,s;if(n===wa(t,e,i,r)>0)for(o=e;o<i;o+=r)s=va(o,t[o],t[o+1],s);else for(o=i-r;o>=e;o-=r)s=va(o,t[o],t[o+1],s);return s&&fa(s,s.next)&&(xa(s),s=s.next),s}function ta(t,e){if(!t)return t;e||(e=t);var i,r=t;do{if(i=!1,r.steiner||!fa(r,r.next)&&0!==pa(r.prev,r,r.next))r=r.next;else{if(xa(r),(r=e=r.prev)===r.next)break;i=!0}}while(i||r!==e);return e}function ea(t,e,i,r,n,o,s){if(t){!s&&o&&function(t,e,i,r){var n=t;do{0===n.z&&(n.z=ca(n.x,n.y,e,i,r)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next}while(n!==t);n.prevZ.nextZ=null,n.prevZ=null,function(t){var e,i,r,n,o,s,a,l,c=1;do{for(i=t,t=null,o=null,s=0;i;){for(s++,r=i,a=0,e=0;e<c&&(a++,r=r.nextZ);e++);for(l=c;a>0||l>0&&r;)0!==a&&(0===l||!r||i.z<=r.z)?(n=i,i=i.nextZ,a--):(n=r,r=r.nextZ,l--),o?o.nextZ=n:t=n,n.prevZ=o,o=n;i=r}o.nextZ=null,c*=2}while(s>1)}(n)}(t,r,n,o);for(var a,l,c=t;t.prev!==t.next;)if(a=t.prev,l=t.next,o?ra(t,r,n,o):ia(t))e.push(a.i/i|0),e.push(t.i/i|0),e.push(l.i/i|0),xa(t),t=l.next,c=l.next;else if((t=l)===c){s?1===s?ea(t=na(ta(t),e,i),e,i,r,n,o,2):2===s&&oa(t,e,i,r,n,o):ea(ta(t),e,i,r,n,o,1);break}}}function ia(t){var e=t.prev,i=t,r=t.next;if(pa(e,i,r)>=0)return!1;for(var n=e.x,o=i.x,s=r.x,a=e.y,l=i.y,c=r.y,u=n<o?n<s?n:s:o<s?o:s,h=a<l?a<c?a:c:l<c?l:c,d=n>o?n>s?n:s:o>s?o:s,p=a>l?a>c?a:c:l>c?l:c,f=r.next;f!==e;){if(f.x>=u&&f.x<=d&&f.y>=h&&f.y<=p&&ha(n,a,o,l,s,c,f.x,f.y)&&pa(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}function ra(t,e,i,r){var n=t.prev,o=t,s=t.next;if(pa(n,o,s)>=0)return!1;for(var a=n.x,l=o.x,c=s.x,u=n.y,h=o.y,d=s.y,p=a<l?a<c?a:c:l<c?l:c,f=u<h?u<d?u:d:h<d?h:d,A=a>l?a>c?a:c:l>c?l:c,m=u>h?u>d?u:d:h>d?h:d,g=ca(p,f,e,i,r),_=ca(A,m,e,i,r),y=t.prevZ,v=t.nextZ;y&&y.z>=g&&v&&v.z<=_;){if(y.x>=p&&y.x<=A&&y.y>=f&&y.y<=m&&y!==n&&y!==s&&ha(a,u,l,h,c,d,y.x,y.y)&&pa(y.prev,y,y.next)>=0)return!1;if(y=y.prevZ,v.x>=p&&v.x<=A&&v.y>=f&&v.y<=m&&v!==n&&v!==s&&ha(a,u,l,h,c,d,v.x,v.y)&&pa(v.prev,v,v.next)>=0)return!1;v=v.nextZ}for(;y&&y.z>=g;){if(y.x>=p&&y.x<=A&&y.y>=f&&y.y<=m&&y!==n&&y!==s&&ha(a,u,l,h,c,d,y.x,y.y)&&pa(y.prev,y,y.next)>=0)return!1;y=y.prevZ}for(;v&&v.z<=_;){if(v.x>=p&&v.x<=A&&v.y>=f&&v.y<=m&&v!==n&&v!==s&&ha(a,u,l,h,c,d,v.x,v.y)&&pa(v.prev,v,v.next)>=0)return!1;v=v.nextZ}return!0}function na(t,e,i){var r=t;do{var n=r.prev,o=r.next.next;!fa(n,o)&&Aa(n,r,r.next,o)&&_a(n,o)&&_a(o,n)&&(e.push(n.i/i|0),e.push(r.i/i|0),e.push(o.i/i|0),xa(r),xa(r.next),r=t=o),r=r.next}while(r!==t);return ta(r)}function oa(t,e,i,r,n,o){var s=t;do{for(var a=s.next.next;a!==s.prev;){if(s.i!==a.i&&da(s,a)){var l=ya(s,a);return s=ta(s,s.next),l=ta(l,l.next),ea(s,e,i,r,n,o,0),void ea(l,e,i,r,n,o,0)}a=a.next}s=s.next}while(s!==t)}function sa(t,e){return t.x-e.x}function aa(t,e){var i=function(t,e){var i,r=e,n=t.x,o=t.y,s=-1/0;do{if(o<=r.y&&o>=r.next.y&&r.next.y!==r.y){var a=r.x+(o-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(a<=n&&a>s&&(s=a,i=r.x<r.next.x?r:r.next,a===n))return i}r=r.next}while(r!==e);if(!i)return null;var l,c=i,u=i.x,h=i.y,d=1/0;r=i;do{n>=r.x&&r.x>=u&&n!==r.x&&ha(o<h?n:s,o,u,h,o<h?s:n,o,r.x,r.y)&&(l=Math.abs(o-r.y)/(n-r.x),_a(r,t)&&(l<d||l===d&&(r.x>i.x||r.x===i.x&&la(i,r)))&&(i=r,d=l)),r=r.next}while(r!==c);return i}(t,e);if(!i)return e;var r=ya(i,t);return ta(r,r.next),ta(i,i.next)}function la(t,e){return pa(t.prev,t,e.prev)<0&&pa(e.next,t,t.next)<0}function ca(t,e,i,r,n){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-i)*n|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-r)*n|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function ua(t){var e=t,i=t;do{(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next}while(e!==t);return i}function ha(t,e,i,r,n,o,s,a){return(n-s)*(e-a)>=(t-s)*(o-a)&&(t-s)*(r-a)>=(i-s)*(e-a)&&(i-s)*(o-a)>=(n-s)*(r-a)}function da(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&Aa(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1}(t,e)&&(_a(t,e)&&_a(e,t)&&function(t,e){var i=t,r=!1,n=(t.x+e.x)/2,o=(t.y+e.y)/2;do{i.y>o!=i.next.y>o&&i.next.y!==i.y&&n<(i.next.x-i.x)*(o-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next}while(i!==t);return r}(t,e)&&(pa(t.prev,t,e.prev)||pa(t,e.prev,e))||fa(t,e)&&pa(t.prev,t,t.next)>0&&pa(e.prev,e,e.next)>0)}function pa(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function fa(t,e){return t.x===e.x&&t.y===e.y}function Aa(t,e,i,r){var n=ga(pa(t,e,i)),o=ga(pa(t,e,r)),s=ga(pa(i,r,t)),a=ga(pa(i,r,e));return n!==o&&s!==a||!(0!==n||!ma(t,i,e))||!(0!==o||!ma(t,r,e))||!(0!==s||!ma(i,t,r))||!(0!==a||!ma(i,e,r))}function ma(t,e,i){return e.x<=Math.max(t.x,i.x)&&e.x>=Math.min(t.x,i.x)&&e.y<=Math.max(t.y,i.y)&&e.y>=Math.min(t.y,i.y)}function ga(t){return t>0?1:t<0?-1:0}function _a(t,e){return pa(t.prev,t,t.next)<0?pa(t,e,t.next)>=0&&pa(t,t.prev,e)>=0:pa(t,e,t.prev)<0||pa(t,t.next,e)<0}function ya(t,e){var i=new ba(t.i,t.x,t.y),r=new ba(e.i,e.x,e.y),n=t.next,o=e.prev;return t.next=e,e.prev=t,i.next=n,n.prev=i,r.next=i,i.prev=r,o.next=r,r.prev=o,r}function va(t,e,i,r){var n=new ba(t,e,i);return r?(n.next=r.next,n.prev=r,r.next.prev=n,r.next=n):(n.prev=n,n.next=n),n}function xa(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function ba(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function wa(t,e,i,r){for(var n=0,o=e,s=i-r;o<i;o+=r)n+=(t[s]-t[o])*(t[o+1]+t[s+1]),s=o;return n}Xs.exports=Js,Xs.exports.default=Js,Js.deviation=function(t,e,i,r){var n=e&&e.length,o=Math.abs(wa(t,0,n?e[0]*i:t.length,i));if(n)for(var s=0,a=e.length;s<a;s++)o-=Math.abs(wa(t,e[s]*i,s<a-1?e[s+1]*i:t.length,i));var l=0;for(s=0;s<r.length;s+=3){var c=r[s]*i,u=r[s+1]*i,h=r[s+2]*i;l+=Math.abs((t[c]-t[h])*(t[u+1]-t[c+1])-(t[c]-t[u])*(t[h+1]-t[c+1]))}return 0===o&&0===l?0:Math.abs((l-o)/o)},Js.flatten=function(t){for(var e=t[0][0].length,i={vertices:[],holes:[],dimensions:e},r=0,n=0;n<t.length;n++){for(var o=0;o<t[n].length;o++)for(var s=0;s<e;s++)i.vertices.push(t[n][o][s]);n>0&&i.holes.push(r+=t[n-1].length)}return i};var Ta=i(Xs.exports);function Ba(t,e,i,r,n){Ea(t,e,i||0,r||t.length-1,n||Sa)}function Ea(t,e,i,r,n){for(;r>i;){if(r-i>600){var o=r-i+1,s=e-i+1,a=Math.log(o),l=.5*Math.exp(2*a/3),c=.5*Math.sqrt(a*l*(o-l)/o)*(s-o/2<0?-1:1);Ea(t,e,Math.max(i,Math.floor(e-s*l/o+c)),Math.min(r,Math.floor(e+(o-s)*l/o+c)),n)}var u=t[e],h=i,d=r;for(Ca(t,i,e),n(t[r],u)>0&&Ca(t,i,r);h<d;){for(Ca(t,h,d),h++,d--;n(t[h],u)<0;)h++;for(;n(t[d],u)>0;)d--}0===n(t[i],u)?Ca(t,i,d):Ca(t,++d,r),d<=e&&(i=d+1),e<=d&&(r=d-1)}}function Ca(t,e,i){var r=t[e];t[e]=t[i],t[i]=r}function Sa(t,e){return t<e?-1:t>e?1:0}function Ia(t,e){const i=t.length;if(i<=1)return[t];const r=[];let n,o;for(let e=0;e<i;e++){const i=B(t[e]);0!==i&&(t[e].area=Math.abs(i),void 0===o&&(o=i<0),o===i<0?(n&&r.push(n),n=[t[e]]):n.push(t[e]))}if(n&&r.push(n),e>1)for(let t=0;t<r.length;t++)r[t].length<=e||(Ba(r[t],e,1,r[t].length-1,Ma),r[t]=r[t].slice(0,e));return r}function Ma(t,e){return e.area-t.area}function ka(t,e,i){const r=i.patternDependencies;let n=!1;for(const i of e){const e=i.paint.get(`${t}-pattern`);e.isConstant()||(n=!0);const o=e.constantOr(null);o&&(n=!0,r[o.to]=!0,r[o.from]=!0)}return n}function Pa(t,e,i,r,n){const o=n.patternDependencies;for(const s of e){const e=s.paint.get(`${t}-pattern`).value;if("constant"!==e.kind){let t=e.evaluate({zoom:r-1},i,{},n.availableImages),a=e.evaluate({zoom:r},i,{},n.availableImages),l=e.evaluate({zoom:r+1},i,{},n.availableImages);t=t&&t.name?t.name:t,a=a&&a.name?a.name:a,l=l&&l.name?l.name:l,o[t]=!0,o[a]=!0,o[l]=!0,i.patterns[s.id]={min:t,mid:a,max:l}}}return i}class La{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((t=>t.id)),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new fo,this.indexArray=new To,this.indexArray2=new Bo,this.programConfigurations=new ts(t.layers,t.zoom),this.segments=new So,this.segments2=new So,this.stateDependentLayerIds=this.layers.filter((t=>t.isStateDependent())).map((t=>t.id))}populate(t,e,i){this.hasPattern=ka("fill",this.layers,e);const r=this.layers[0].layout.get("fill-sort-key"),n=!r.isConstant(),o=[];for(const{feature:s,id:a,index:l,sourceLayerIndex:c}of t){const t=this.layers[0]._featureFilter.needGeometry,u=as(s,t);if(!this.layers[0]._featureFilter.filter(new ln(this.zoom),u,i))continue;const h=n?r.evaluate(u,{},i,e.availableImages):void 0,d={id:a,properties:s.properties,type:s.type,sourceLayerIndex:c,index:l,geometry:t?u.geometry:ss(s),patterns:{},sortKey:h};o.push(d)}n&&o.sort(((t,e)=>t.sortKey-e.sortKey));for(const r of o){const{geometry:n,index:o,sourceLayerIndex:s}=r;if(this.hasPattern){const t=Pa("fill",this.layers,r,this.zoom,e);this.patternFeatures.push(t)}else this.addFeature(r,n,o,i,{});e.featureIndex.insert(t[o].feature,n,o,s,this.index)}}update(t,e,i){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,i)}addFeatures(t,e,i){for(const t of this.patternFeatures)this.addFeature(t,t.geometry,t.index,e,i)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Ws),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,e,i,r,n){for(const t of Ia(e,500)){let e=0;for(const i of t)e+=i.length;const i=this.segments.prepareSegment(e,this.layoutVertexArray,this.indexArray),r=i.vertexLength,n=[],o=[];for(const e of t){if(0===e.length)continue;e!==t[0]&&o.push(n.length/2);const i=this.segments2.prepareSegment(e.length,this.layoutVertexArray,this.indexArray2),r=i.vertexLength;this.layoutVertexArray.emplaceBack(e[0].x,e[0].y),this.indexArray2.emplaceBack(r+e.length-1,r),n.push(e[0].x),n.push(e[0].y);for(let t=1;t<e.length;t++)this.layoutVertexArray.emplaceBack(e[t].x,e[t].y),this.indexArray2.emplaceBack(r+t-1,r+t),n.push(e[t].x),n.push(e[t].y);i.vertexLength+=e.length,i.primitiveLength+=e.length}const s=Ta(n,o);for(let t=0;t<s.length;t+=3)this.indexArray.emplaceBack(r+s[t],r+s[t+1],r+s[t+2]);i.vertexLength+=e,i.primitiveLength+=s.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,i,n,r)}}let za,Fa;Fr("FillBucket",La,{omit:["layers","patternFeatures"]});var Da={get paint(){return Fa=Fa||new bn({"fill-antialias":new gn(K.paint_fill["fill-antialias"]),"fill-opacity":new _n(K.paint_fill["fill-opacity"]),"fill-color":new _n(K.paint_fill["fill-color"]),"fill-outline-color":new _n(K.paint_fill["fill-outline-color"]),"fill-translate":new gn(K.paint_fill["fill-translate"]),"fill-translate-anchor":new gn(K.paint_fill["fill-translate-anchor"]),"fill-pattern":new yn(K.paint_fill["fill-pattern"])})},get layout(){return za=za||new bn({"fill-sort-key":new _n(K.layout_fill["fill-sort-key"])})}};class Ra extends Tn{constructor(t){super(t,Da)}recalculate(t,e){super.recalculate(t,e);const i=this.paint._values["fill-outline-color"];"constant"===i.value.kind&&void 0===i.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new La(t)}queryRadius(){return bs(this.paint.get("fill-translate"))}queryIntersectsFeature(t,e,i,r,n,o,s){return ds(ws(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),o.angle,s),r)}isTileClipped(){return!0}}const Ua=Sn([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),Oa=Sn([{name:"a_centroid",components:2,type:"Int16"}],4),{members:Na}=Ua;var Qa={},Va=r,ja=Ha;function Ha(t,e,i,r,n){this.properties={},this.extent=i,this.type=0,this._pbf=t,this._geometry=-1,this._keys=r,this._values=n,t.readFields(Ga,this,e)}function Ga(t,e,i){1==t?e.id=i.readVarint():2==t?function(t,e){for(var i=t.readVarint()+t.pos;t.pos<i;){var r=e._keys[t.readVarint()],n=e._values[t.readVarint()];e.properties[r]=n}}(i,e):3==t?e.type=i.readVarint():4==t&&(e._geometry=i.pos)}function $a(t){for(var e,i,r=0,n=0,o=t.length,s=o-1;n<o;s=n++)r+=((i=t[s]).x-(e=t[n]).x)*(e.y+i.y);return r}Ha.types=["Unknown","Point","LineString","Polygon"],Ha.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,i=t.readVarint()+t.pos,r=1,n=0,o=0,s=0,a=[];t.pos<i;){if(n<=0){var l=t.readVarint();r=7&l,n=l>>3}if(n--,1===r||2===r)o+=t.readSVarint(),s+=t.readSVarint(),1===r&&(e&&a.push(e),e=[]),e.push(new Va(o,s));else{if(7!==r)throw new Error("unknown command "+r);e&&e.push(e[0].clone())}}return e&&a.push(e),a},Ha.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,i=1,r=0,n=0,o=0,s=1/0,a=-1/0,l=1/0,c=-1/0;t.pos<e;){if(r<=0){var u=t.readVarint();i=7&u,r=u>>3}if(r--,1===i||2===i)(n+=t.readSVarint())<s&&(s=n),n>a&&(a=n),(o+=t.readSVarint())<l&&(l=o),o>c&&(c=o);else if(7!==i)throw new Error("unknown command "+i)}return[s,l,a,c]},Ha.prototype.toGeoJSON=function(t,e,i){var r,n,o=this.extent*Math.pow(2,i),s=this.extent*t,a=this.extent*e,l=this.loadGeometry(),c=Ha.types[this.type];function u(t){for(var e=0;e<t.length;e++){var i=t[e];t[e]=[360*(i.x+s)/o-180,360/Math.PI*Math.atan(Math.exp((180-360*(i.y+a)/o)*Math.PI/180))-90]}}switch(this.type){case 1:var h=[];for(r=0;r<l.length;r++)h[r]=l[r][0];u(l=h);break;case 2:for(r=0;r<l.length;r++)u(l[r]);break;case 3:for(l=function(t){var e=t.length;if(e<=1)return[t];for(var i,r,n=[],o=0;o<e;o++){var s=$a(t[o]);0!==s&&(void 0===r&&(r=s<0),r===s<0?(i&&n.push(i),i=[t[o]]):i.push(t[o]))}return i&&n.push(i),n}(l),r=0;r<l.length;r++)for(n=0;n<l[r].length;n++)u(l[r][n])}1===l.length?l=l[0]:c="Multi"+c;var d={type:"Feature",geometry:{type:c,coordinates:l},properties:this.properties};return"id"in this&&(d.id=this.id),d};var Za=ja,qa=Ka;function Ka(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(Wa,this,e),this.length=this._features.length}function Wa(t,e,i){15===t?e.version=i.readVarint():1===t?e.name=i.readString():5===t?e.extent=i.readVarint():2===t?e._features.push(i.pos):3===t?e._keys.push(i.readString()):4===t&&e._values.push(function(t){for(var e=null,i=t.readVarint()+t.pos;t.pos<i;){var r=t.readVarint()>>3;e=1===r?t.readString():2===r?t.readFloat():3===r?t.readDouble():4===r?t.readVarint64():5===r?t.readVarint():6===r?t.readSVarint():7===r?t.readBoolean():null}return e}(i))}Ka.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new Za(this._pbf,e,this.extent,this._keys,this._values)};var Xa=qa;function Ja(t,e,i){if(3===t){var r=new Xa(i,i.readVarint()+i.pos);r.length&&(e[r.name]=r)}}Qa.VectorTile=function(t,e){this.layers=t.readFields(Ja,{},e)},Qa.VectorTileFeature=ja,Qa.VectorTileLayer=qa;const Ya=Qa.VectorTileFeature.types,tl=Math.pow(2,13);function el(t,e,i,r,n,o,s,a){t.emplaceBack(e,i,2*Math.floor(r*tl)+s,n*tl*2,o*tl*2,Math.round(a))}class il{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((t=>t.id)),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Ao,this.centroidVertexArray=new ho,this.indexArray=new To,this.programConfigurations=new ts(t.layers,t.zoom),this.segments=new So,this.stateDependentLayerIds=this.layers.filter((t=>t.isStateDependent())).map((t=>t.id))}populate(t,e,i){this.features=[],this.hasPattern=ka("fill-extrusion",this.layers,e);for(const{feature:r,id:n,index:o,sourceLayerIndex:s}of t){const t=this.layers[0]._featureFilter.needGeometry,a=as(r,t);if(!this.layers[0]._featureFilter.filter(new ln(this.zoom),a,i))continue;const l={id:n,sourceLayerIndex:s,index:o,geometry:t?a.geometry:ss(r),properties:r.properties,type:r.type,patterns:{}};this.hasPattern?this.features.push(Pa("fill-extrusion",this.layers,l,this.zoom,e)):this.addFeature(l,l.geometry,o,i,{}),e.featureIndex.insert(r,l.geometry,o,s,this.index,!0)}}addFeatures(t,e,i){for(const t of this.features){const{geometry:r}=t;this.addFeature(t,r,t.index,e,i)}}update(t,e,i){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,i)}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.centroidVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Na),this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,Oa.members,!0),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(t,e,i,r,n){const o={x:0,y:0,vertexCount:0};for(const i of Ia(e,500)){let e=0;for(const t of i)e+=t.length;let r=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const t of i){if(0===t.length)continue;if(nl(t))continue;let e=0;for(let i=0;i<t.length;i++){const n=t[i];if(i>=1){const s=t[i-1];if(!rl(n,s)){r.vertexLength+4>So.MAX_VERTEX_ARRAY_LENGTH&&(r=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const t=n.sub(s)._perp()._unit(),i=s.dist(n);e+i>32768&&(e=0),el(this.layoutVertexArray,n.x,n.y,t.x,t.y,0,0,e),el(this.layoutVertexArray,n.x,n.y,t.x,t.y,0,1,e),o.x+=2*n.x,o.y+=2*n.y,o.vertexCount+=2,e+=i,el(this.layoutVertexArray,s.x,s.y,t.x,t.y,0,0,e),el(this.layoutVertexArray,s.x,s.y,t.x,t.y,0,1,e),o.x+=2*s.x,o.y+=2*s.y,o.vertexCount+=2;const a=r.vertexLength;this.indexArray.emplaceBack(a,a+2,a+1),this.indexArray.emplaceBack(a+1,a+2,a+3),r.vertexLength+=4,r.primitiveLength+=2}}}}if(r.vertexLength+e>So.MAX_VERTEX_ARRAY_LENGTH&&(r=this.segments.prepareSegment(e,this.layoutVertexArray,this.indexArray)),"Polygon"!==Ya[t.type])continue;const n=[],s=[],a=r.vertexLength;for(const t of i)if(0!==t.length){t!==i[0]&&s.push(n.length/2);for(let e=0;e<t.length;e++){const i=t[e];el(this.layoutVertexArray,i.x,i.y,0,0,1,1,0),o.x+=i.x,o.y+=i.y,o.vertexCount+=1,n.push(i.x),n.push(i.y)}}const l=Ta(n,s);for(let t=0;t<l.length;t+=3)this.indexArray.emplaceBack(a+l[t],a+l[t+2],a+l[t+1]);r.primitiveLength+=l.length/3,r.vertexLength+=e}for(let t=0;t<o.vertexCount;t++)this.centroidVertexArray.emplaceBack(Math.floor(o.x/o.vertexCount),Math.floor(o.y/o.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,i,n,r)}}function rl(t,e){return t.x===e.x&&(t.x<0||t.x>rs)||t.y===e.y&&(t.y<0||t.y>rs)}function nl(t){return t.every((t=>t.x<0))||t.every((t=>t.x>rs))||t.every((t=>t.y<0))||t.every((t=>t.y>rs))}let ol;Fr("FillExtrusionBucket",il,{omit:["layers","features"]});var sl={get paint(){return ol=ol||new bn({"fill-extrusion-opacity":new gn(K["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new _n(K["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new gn(K["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new gn(K["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new yn(K["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new _n(K["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new _n(K["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new gn(K["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class al extends Tn{constructor(t){super(t,sl)}createBucket(t){return new il(t)}queryRadius(){return bs(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(t,e,i,r,n,s,a,l){const c=ws(t,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),s.angle,a),u=this.paint.get("fill-extrusion-height").evaluate(e,i),h=this.paint.get("fill-extrusion-base").evaluate(e,i),d=function(t,e,i,r){const n=[];for(const i of t){const t=[i.x,i.y,0,1];Ls(t,t,e),n.push(new o(t[0]/t[3],t[1]/t[3]))}return n}(c,l),p=function(t,e,i,r){const n=[],s=[],a=r[8]*e,l=r[9]*e,c=r[10]*e,u=r[11]*e,h=r[8]*i,d=r[9]*i,p=r[10]*i,f=r[11]*i;for(const e of t){const t=[],i=[];for(const n of e){const e=n.x,s=n.y,A=r[0]*e+r[4]*s+r[12],m=r[1]*e+r[5]*s+r[13],g=r[2]*e+r[6]*s+r[14],_=r[3]*e+r[7]*s+r[15],y=g+c,v=_+u,x=A+h,b=m+d,w=g+p,T=_+f,B=new o((A+a)/v,(m+l)/v);B.z=y/v,t.push(B);const E=new o(x/T,b/T);E.z=w/T,i.push(E)}n.push(t),s.push(i)}return[n,s]}(r,h,u,l);return function(t,e,i){let r=1/0;ds(i,e)&&(r=cl(i,e[0]));for(let n=0;n<e.length;n++){const o=e[n],s=t[n];for(let t=0;t<o.length-1;t++){const e=o[t],n=[e,o[t+1],s[t+1],s[t],e];us(i,n)&&(r=Math.min(r,cl(i,n)))}}return r!==1/0&&r}(p[0],p[1],d)}}function ll(t,e){return t.x*e.x+t.y*e.y}function cl(t,e){if(1===t.length){let i=0;const r=e[i++];let n;for(;!n||r.equals(n);)if(n=e[i++],!n)return 1/0;for(;i<e.length;i++){const o=e[i],s=t[0],a=n.sub(r),l=o.sub(r),c=s.sub(r),u=ll(a,a),h=ll(a,l),d=ll(l,l),p=ll(c,a),f=ll(c,l),A=u*d-h*h,m=(d*p-h*f)/A,g=(u*f-h*p)/A,_=r.z*(1-m-g)+n.z*m+o.z*g;if(isFinite(_))return _}return 1/0}{let t=1/0;for(const i of e)t=Math.min(t,i.z);return t}}const ul=Sn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:hl}=ul,dl=Sn([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:pl}=dl,fl=Qa.VectorTileFeature.types,Al=Math.cos(Math.PI/180*37.5),ml=Math.pow(2,14)/.5;class gl{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((t=>t.id)),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((t=>{this.gradients[t.id]={}})),this.layoutVertexArray=new mo,this.layoutVertexArray2=new go,this.indexArray=new To,this.programConfigurations=new ts(t.layers,t.zoom),this.segments=new So,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((t=>t.isStateDependent())).map((t=>t.id))}populate(t,e,i){this.hasPattern=ka("line",this.layers,e);const r=this.layers[0].layout.get("line-sort-key"),n=!r.isConstant(),o=[];for(const{feature:e,id:s,index:a,sourceLayerIndex:l}of t){const t=this.layers[0]._featureFilter.needGeometry,c=as(e,t);if(!this.layers[0]._featureFilter.filter(new ln(this.zoom),c,i))continue;const u=n?r.evaluate(c,{},i):void 0,h={id:s,properties:e.properties,type:e.type,sourceLayerIndex:l,index:a,geometry:t?c.geometry:ss(e),patterns:{},sortKey:u};o.push(h)}n&&o.sort(((t,e)=>t.sortKey-e.sortKey));for(const r of o){const{geometry:n,index:o,sourceLayerIndex:s}=r;if(this.hasPattern){const t=Pa("line",this.layers,r,this.zoom,e);this.patternFeatures.push(t)}else this.addFeature(r,n,o,i,{});e.featureIndex.insert(t[o].feature,n,o,s,this.index)}}update(t,e,i){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,i)}addFeatures(t,e,i){for(const t of this.patternFeatures)this.addFeature(t,t.geometry,t.index,e,i)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,pl)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,hl),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,e,i,r,n){const o=this.layers[0].layout,s=o.get("line-join").evaluate(t,{}),a=o.get("line-cap"),l=o.get("line-miter-limit"),c=o.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const i of e)this.addLine(i,t,s,a,l,c);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,i,n,r)}addLine(t,e,i,r,n,o){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let e=0;e<t.length-1;e++)this.totalDistance+=t[e].dist(t[e+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const s="Polygon"===fl[e.type];let a=t.length;for(;a>=2&&t[a-1].equals(t[a-2]);)a--;let l=0;for(;l<a-1&&t[l].equals(t[l+1]);)l++;if(a<(s?3:2))return;"bevel"===i&&(n=1.05);const c=this.overscaling<=16?15*rs/(512*this.overscaling):0,u=this.segments.prepareSegment(10*a,this.layoutVertexArray,this.indexArray);let h,d,p,f,A;this.e1=this.e2=-1,s&&(h=t[a-2],A=t[l].sub(h)._unit()._perp());for(let e=l;e<a;e++){if(p=e===a-1?s?t[l+1]:void 0:t[e+1],p&&t[e].equals(p))continue;A&&(f=A),h&&(d=h),h=t[e],A=p?p.sub(h)._unit()._perp():f,f=f||A;let m=f.add(A);0===m.x&&0===m.y||m._unit();const g=f.x*A.x+f.y*A.y,_=m.x*A.x+m.y*A.y,y=0!==_?1/_:1/0,v=2*Math.sqrt(2-2*_),x=_<Al&&d&&p,b=f.x*A.y-f.y*A.x>0;if(x&&e>l){const t=h.dist(d);if(t>2*c){const e=h.sub(h.sub(d)._mult(c/t)._round());this.updateDistance(d,e),this.addCurrentVertex(e,f,0,0,u),d=e}}const w=d&&p;let T=w?i:s?"butt":r;if(w&&"round"===T&&(y<o?T="miter":y<=2&&(T="fakeround")),"miter"===T&&y>n&&(T="bevel"),"bevel"===T&&(y>2&&(T="flipbevel"),y<n&&(T="miter")),d&&this.updateDistance(d,h),"miter"===T)m._mult(y),this.addCurrentVertex(h,m,0,0,u);else if("flipbevel"===T){if(y>100)m=A.mult(-1);else{const t=y*f.add(A).mag()/f.sub(A).mag();m._perp()._mult(t*(b?-1:1))}this.addCurrentVertex(h,m,0,0,u),this.addCurrentVertex(h,m.mult(-1),0,0,u)}else if("bevel"===T||"fakeround"===T){const t=-Math.sqrt(y*y-1),e=b?t:0,i=b?0:t;if(d&&this.addCurrentVertex(h,f,e,i,u),"fakeround"===T){const t=Math.round(180*v/Math.PI/20);for(let e=1;e<t;e++){let i=e/t;if(.5!==i){const t=i-.5;i+=i*t*(i-1)*((1.0904+g*(g*(3.55645-1.43519*g)-3.2452))*t*t+(.848013+g*(.215638*g-1.06021)))}const r=A.sub(f)._mult(i)._add(f)._unit()._mult(b?-1:1);this.addHalfVertex(h,r.x,r.y,!1,b,0,u)}}p&&this.addCurrentVertex(h,A,-e,-i,u)}else if("butt"===T)this.addCurrentVertex(h,m,0,0,u);else if("square"===T){const t=d?1:-1;this.addCurrentVertex(h,m,t,t,u)}else"round"===T&&(d&&(this.addCurrentVertex(h,f,0,0,u),this.addCurrentVertex(h,f,1,1,u,!0)),p&&(this.addCurrentVertex(h,A,-1,-1,u,!0),this.addCurrentVertex(h,A,0,0,u)));if(x&&e<a-1){const t=h.dist(p);if(t>2*c){const e=h.add(p.sub(h)._mult(c/t)._round());this.updateDistance(h,e),this.addCurrentVertex(e,A,0,0,u),h=e}}}}addCurrentVertex(t,e,i,r,n,o=!1){const s=e.y*r-e.x,a=-e.y-e.x*r;this.addHalfVertex(t,e.x+e.y*i,e.y-e.x*i,o,!1,i,n),this.addHalfVertex(t,s,a,o,!0,-r,n),this.distance>ml/2&&0===this.totalDistance&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(t,e,i,r,n,o))}addHalfVertex({x:t,y:e},i,r,n,o,s,a){const l=.5*(this.lineClips?this.scaledDistance*(ml-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t<<1)+(n?1:0),(e<<1)+(o?1:0),Math.round(63*i)+128,Math.round(63*r)+128,1+(0===s?0:s<0?-1:1)|(63&l)<<2,l>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const c=a.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,c),a.primitiveLength++),o?this.e2=c:this.e1=c}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(t,e){this.distance+=t.dist(e),this.updateScaledDistance()}}let _l,yl;Fr("LineBucket",gl,{omit:["layers","patternFeatures"]});var vl={get paint(){return yl=yl||new bn({"line-opacity":new _n(K.paint_line["line-opacity"]),"line-color":new _n(K.paint_line["line-color"]),"line-translate":new gn(K.paint_line["line-translate"]),"line-translate-anchor":new gn(K.paint_line["line-translate-anchor"]),"line-width":new _n(K.paint_line["line-width"]),"line-gap-width":new _n(K.paint_line["line-gap-width"]),"line-offset":new _n(K.paint_line["line-offset"]),"line-blur":new _n(K.paint_line["line-blur"]),"line-dasharray":new vn(K.paint_line["line-dasharray"]),"line-pattern":new yn(K.paint_line["line-pattern"]),"line-gradient":new xn(K.paint_line["line-gradient"])})},get layout(){return _l=_l||new bn({"line-cap":new gn(K.layout_line["line-cap"]),"line-join":new _n(K.layout_line["line-join"]),"line-miter-limit":new gn(K.layout_line["line-miter-limit"]),"line-round-limit":new gn(K.layout_line["line-round-limit"]),"line-sort-key":new _n(K.layout_line["line-sort-key"])})}};class xl extends _n{possiblyEvaluate(t,e){return e=new ln(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,zoomHistory:e.zoomHistory,transition:e.transition}),super.possiblyEvaluate(t,e)}evaluate(t,e,i,r){return e=g({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(t,e,i,r)}}let bl;class wl extends Tn{constructor(t){super(t,vl),this.gradientVersion=0,bl||(bl=new xl(vl.paint.properties["line-width"].specification),bl.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(t){if("line-gradient"===t){const t=this.gradientExpression();this.stepInterpolant=!!function(t){return void 0!==t._styleExpression}(t)&&t._styleExpression.expression instanceof Ve,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,e){super.recalculate(t,e),this.paint._values["line-floorwidth"]=bl.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new gl(t)}queryRadius(t){const e=t,i=Tl(xs("line-width",this,e),xs("line-gap-width",this,e)),r=xs("line-offset",this,e);return i/2+Math.abs(r)+bs(this.paint.get("line-translate"))}queryIntersectsFeature(t,e,i,r,n,s,a){const l=ws(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),s.angle,a),c=a/2*Tl(this.paint.get("line-width").evaluate(e,i),this.paint.get("line-gap-width").evaluate(e,i)),u=this.paint.get("line-offset").evaluate(e,i);return u&&(r=function(t,e){const i=[];for(let r=0;r<t.length;r++){const n=t[r],s=[];for(let t=0;t<n.length;t++){const i=n[t-1],r=n[t],a=n[t+1],l=0===t?new o(0,0):r.sub(i)._unit()._perp(),c=t===n.length-1?new o(0,0):a.sub(r)._unit()._perp(),u=l._add(c)._unit(),h=u.x*c.x+u.y*c.y;0!==h&&u._mult(1/h),s.push(u._mult(e)._add(r))}i.push(s)}return i}(r,u*a)),function(t,e,i){for(let r=0;r<e.length;r++){const n=e[r];if(t.length>=3)for(let e=0;e<n.length;e++)if(ys(t,n[e]))return!0;if(ps(t,n,i))return!0}return!1}(l,r,c)}isTileClipped(){return!0}}function Tl(t,e){return e>0?e+2*t:t}const Bl=Sn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),El=Sn([{name:"a_projected_pos",components:3,type:"Float32"}],4);Sn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Cl=Sn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);Sn([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Sl=Sn([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Il=Sn([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Ml(t,e,i){return t.sections.forEach((t=>{t.text=function(t,e,i){const r=e.layout.get("text-transform").evaluate(i,{});return"uppercase"===r?t=t.toLocaleUpperCase():"lowercase"===r&&(t=t.toLocaleLowerCase()),an.applyArabicShaping&&(t=an.applyArabicShaping(t)),t}(t.text,e,i)})),t}Sn([{name:"triangle",components:3,type:"Uint16"}]),Sn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Sn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),Sn([{type:"Float32",name:"offsetX"}]),Sn([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),Sn([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const kl={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var Pl=24,Ll=Dl,zl=function(t,e,i,r,n){var o,s,a=8*n-r-1,l=(1<<a)-1,c=l>>1,u=-7,h=i?n-1:0,d=i?-1:1,p=t[e+h];for(h+=d,o=p&(1<<-u)-1,p>>=-u,u+=a;u>0;o=256*o+t[e+h],h+=d,u-=8);for(s=o&(1<<-u)-1,o>>=-u,u+=r;u>0;s=256*s+t[e+h],h+=d,u-=8);if(0===o)o=1-c;else{if(o===l)return s?NaN:1/0*(p?-1:1);s+=Math.pow(2,r),o-=c}return(p?-1:1)*s*Math.pow(2,o-r)},Fl=function(t,e,i,r,n,o){var s,a,l,c=8*o-n-1,u=(1<<c)-1,h=u>>1,d=23===n?Math.pow(2,-24)-Math.pow(2,-77):0,p=r?0:o-1,f=r?1:-1,A=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,s=u):(s=Math.floor(Math.log(e)/Math.LN2),e*(l=Math.pow(2,-s))<1&&(s--,l*=2),(e+=s+h>=1?d/l:d*Math.pow(2,1-h))*l>=2&&(s++,l/=2),s+h>=u?(a=0,s=u):s+h>=1?(a=(e*l-1)*Math.pow(2,n),s+=h):(a=e*Math.pow(2,h-1)*Math.pow(2,n),s=0));n>=8;t[i+p]=255&a,p+=f,a/=256,n-=8);for(s=s<<n|a,c+=n;c>0;t[i+p]=255&s,p+=f,s/=256,c-=8);t[i+p-f]|=128*A};function Dl(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}Dl.Varint=0,Dl.Fixed64=1,Dl.Bytes=2,Dl.Fixed32=5;var Rl=4294967296,Ul=1/Rl,Ol="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function Nl(t){return t.type===Dl.Bytes?t.readVarint()+t.pos:t.pos+1}function Ql(t,e,i){return i?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function Vl(t,e,i){var r=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));i.realloc(r);for(var n=i.pos-1;n>=t;n--)i.buf[n+r]=i.buf[n]}function jl(t,e){for(var i=0;i<t.length;i++)e.writeVarint(t[i])}function Hl(t,e){for(var i=0;i<t.length;i++)e.writeSVarint(t[i])}function Gl(t,e){for(var i=0;i<t.length;i++)e.writeFloat(t[i])}function $l(t,e){for(var i=0;i<t.length;i++)e.writeDouble(t[i])}function Zl(t,e){for(var i=0;i<t.length;i++)e.writeBoolean(t[i])}function ql(t,e){for(var i=0;i<t.length;i++)e.writeFixed32(t[i])}function Kl(t,e){for(var i=0;i<t.length;i++)e.writeSFixed32(t[i])}function Wl(t,e){for(var i=0;i<t.length;i++)e.writeFixed64(t[i])}function Xl(t,e){for(var i=0;i<t.length;i++)e.writeSFixed64(t[i])}function Jl(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function Yl(t,e,i){t[i]=e,t[i+1]=e>>>8,t[i+2]=e>>>16,t[i+3]=e>>>24}function tc(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}Dl.prototype={destroy:function(){this.buf=null},readFields:function(t,e,i){for(i=i||this.length;this.pos<i;){var r=this.readVarint(),n=r>>3,o=this.pos;this.type=7&r,t(n,e,this),this.pos===o&&this.skip(r)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=Jl(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=tc(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=Jl(this.buf,this.pos)+Jl(this.buf,this.pos+4)*Rl;return this.pos+=8,t},readSFixed64:function(){var t=Jl(this.buf,this.pos)+tc(this.buf,this.pos+4)*Rl;return this.pos+=8,t},readFloat:function(){var t=zl(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=zl(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,i,r=this.buf;return e=127&(i=r[this.pos++]),i<128?e:(e|=(127&(i=r[this.pos++]))<<7,i<128?e:(e|=(127&(i=r[this.pos++]))<<14,i<128?e:(e|=(127&(i=r[this.pos++]))<<21,i<128?e:function(t,e,i){var r,n,o=i.buf;if(r=(112&(n=o[i.pos++]))>>4,n<128)return Ql(t,r,e);if(r|=(127&(n=o[i.pos++]))<<3,n<128)return Ql(t,r,e);if(r|=(127&(n=o[i.pos++]))<<10,n<128)return Ql(t,r,e);if(r|=(127&(n=o[i.pos++]))<<17,n<128)return Ql(t,r,e);if(r|=(127&(n=o[i.pos++]))<<24,n<128)return Ql(t,r,e);if(r|=(1&(n=o[i.pos++]))<<31,n<128)return Ql(t,r,e);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(i=r[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&Ol?function(t,e,i){return Ol.decode(t.subarray(e,i))}(this.buf,e,t):function(t,e,i){for(var r="",n=e;n<i;){var o,s,a,l=t[n],c=null,u=l>239?4:l>223?3:l>191?2:1;if(n+u>i)break;1===u?l<128&&(c=l):2===u?128==(192&(o=t[n+1]))&&(c=(31&l)<<6|63&o)<=127&&(c=null):3===u?(s=t[n+2],128==(192&(o=t[n+1]))&&128==(192&s)&&((c=(15&l)<<12|(63&o)<<6|63&s)<=2047||c>=55296&&c<=57343)&&(c=null)):4===u&&(s=t[n+2],a=t[n+3],128==(192&(o=t[n+1]))&&128==(192&s)&&128==(192&a)&&((c=(15&l)<<18|(63&o)<<12|(63&s)<<6|63&a)<=65535||c>=1114112)&&(c=null)),null===c?(c=65533,u=1):c>65535&&(c-=65536,r+=String.fromCharCode(c>>>10&1023|55296),c=56320|1023&c),r+=String.fromCharCode(c),n+=u}return r}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==Dl.Bytes)return t.push(this.readVarint(e));var i=Nl(this);for(t=t||[];this.pos<i;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==Dl.Bytes)return t.push(this.readSVarint());var e=Nl(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==Dl.Bytes)return t.push(this.readBoolean());var e=Nl(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==Dl.Bytes)return t.push(this.readFloat());var e=Nl(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==Dl.Bytes)return t.push(this.readDouble());var e=Nl(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==Dl.Bytes)return t.push(this.readFixed32());var e=Nl(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==Dl.Bytes)return t.push(this.readSFixed32());var e=Nl(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==Dl.Bytes)return t.push(this.readFixed64());var e=Nl(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==Dl.Bytes)return t.push(this.readSFixed64());var e=Nl(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===Dl.Varint)for(;this.buf[this.pos++]>127;);else if(e===Dl.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Dl.Fixed32)this.pos+=4;else{if(e!==Dl.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var i=new Uint8Array(e);i.set(this.buf),this.buf=i,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),Yl(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),Yl(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),Yl(this.buf,-1&t,this.pos),Yl(this.buf,Math.floor(t*Ul),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),Yl(this.buf,-1&t,this.pos),Yl(this.buf,Math.floor(t*Ul),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(t,e){var i,r;if(t>=0?(i=t%4294967296|0,r=t/4294967296|0):(r=~(-t/4294967296),4294967295^(i=~(-t%4294967296))?i=i+1|0:(i=0,r=r+1|0)),t>=0x10000000000000000||t<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),function(t,e,i){i.buf[i.pos++]=127&t|128,t>>>=7,i.buf[i.pos++]=127&t|128,t>>>=7,i.buf[i.pos++]=127&t|128,t>>>=7,i.buf[i.pos++]=127&t|128,i.buf[i.pos]=127&(t>>>=7)}(i,0,e),function(t,e){var i=(7&t)<<4;e.buf[e.pos++]|=i|((t>>>=3)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t)))))}(r,e)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(t,e,i){for(var r,n,o=0;o<e.length;o++){if((r=e.charCodeAt(o))>55295&&r<57344){if(!n){r>56319||o+1===e.length?(t[i++]=239,t[i++]=191,t[i++]=189):n=r;continue}if(r<56320){t[i++]=239,t[i++]=191,t[i++]=189,n=r;continue}r=n-55296<<10|r-56320|65536,n=null}else n&&(t[i++]=239,t[i++]=191,t[i++]=189,n=null);r<128?t[i++]=r:(r<2048?t[i++]=r>>6|192:(r<65536?t[i++]=r>>12|224:(t[i++]=r>>18|240,t[i++]=r>>12&63|128),t[i++]=r>>6&63|128),t[i++]=63&r|128)}return i}(this.buf,t,this.pos);var i=this.pos-e;i>=128&&Vl(e,i,this),this.pos=e-1,this.writeVarint(i),this.pos+=i},writeFloat:function(t){this.realloc(4),Fl(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),Fl(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var i=0;i<e;i++)this.buf[this.pos++]=t[i]},writeRawMessage:function(t,e){this.pos++;var i=this.pos;t(e,this);var r=this.pos-i;r>=128&&Vl(i,r,this),this.pos=i-1,this.writeVarint(r),this.pos+=r},writeMessage:function(t,e,i){this.writeTag(t,Dl.Bytes),this.writeRawMessage(e,i)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,jl,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,Hl,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,Zl,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,Gl,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,$l,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,ql,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,Kl,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,Wl,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,Xl,e)},writeBytesField:function(t,e){this.writeTag(t,Dl.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,Dl.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,Dl.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,Dl.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,Dl.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,Dl.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,Dl.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,Dl.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,Dl.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,Dl.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}};var ec=i(Ll);const ic=3;function rc(t,e,i){1===t&&i.readMessage(nc,e)}function nc(t,e,i){if(3===t){const{id:t,bitmap:r,width:n,height:o,left:s,top:a,advance:l}=i.readMessage(oc,{});e.push({id:t,bitmap:new Vs({width:n+2*ic,height:o+2*ic},r),metrics:{width:n,height:o,left:s,top:a,advance:l}})}}function oc(t,e,i){1===t?e.id=i.readVarint():2===t?e.bitmap=i.readBytes():3===t?e.width=i.readVarint():4===t?e.height=i.readVarint():5===t?e.left=i.readSVarint():6===t?e.top=i.readSVarint():7===t&&(e.advance=i.readVarint())}const sc=ic;function ac(t){let e=0,i=0;for(const r of t)e+=r.w*r.h,i=Math.max(i,r.w);t.sort(((t,e)=>e.h-t.h));const r=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),i),h:1/0}];let n=0,o=0;for(const e of t)for(let t=r.length-1;t>=0;t--){const i=r[t];if(!(e.w>i.w||e.h>i.h)){if(e.x=i.x,e.y=i.y,o=Math.max(o,e.y+e.h),n=Math.max(n,e.x+e.w),e.w===i.w&&e.h===i.h){const e=r.pop();t<r.length&&(r[t]=e)}else e.h===i.h?(i.x+=e.w,i.w-=e.w):e.w===i.w?(i.y+=e.h,i.h-=e.h):(r.push({x:i.x+e.w,y:i.y,w:i.w-e.w,h:e.h}),i.y+=e.h,i.h-=e.h);break}}return{w:n,h:o,fill:e/(n*o)||0}}const lc=1;class cc{constructor(t,{pixelRatio:e,version:i,stretchX:r,stretchY:n,content:o}){this.paddedRect=t,this.pixelRatio=e,this.stretchX=r,this.stretchY=n,this.content=o,this.version=i}get tl(){return[this.paddedRect.x+lc,this.paddedRect.y+lc]}get br(){return[this.paddedRect.x+this.paddedRect.w-lc,this.paddedRect.y+this.paddedRect.h-lc]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*lc)/this.pixelRatio,(this.paddedRect.h-2*lc)/this.pixelRatio]}}class uc{constructor(t,e){const i={},r={};this.haveRenderCallbacks=[];const n=[];this.addImages(t,i,n),this.addImages(e,r,n);const{w:o,h:s}=ac(n),a=new js({width:o||1,height:s||1});for(const e in t){const r=t[e],n=i[e].paddedRect;js.copy(r.data,a,{x:0,y:0},{x:n.x+lc,y:n.y+lc},r.data)}for(const t in e){const i=e[t],n=r[t].paddedRect,o=n.x+lc,s=n.y+lc,l=i.data.width,c=i.data.height;js.copy(i.data,a,{x:0,y:0},{x:o,y:s},i.data),js.copy(i.data,a,{x:0,y:c-1},{x:o,y:s-1},{width:l,height:1}),js.copy(i.data,a,{x:0,y:0},{x:o,y:s+c},{width:l,height:1}),js.copy(i.data,a,{x:l-1,y:0},{x:o-1,y:s},{width:1,height:c}),js.copy(i.data,a,{x:0,y:0},{x:o+l,y:s},{width:1,height:c})}this.image=a,this.iconPositions=i,this.patternPositions=r}addImages(t,e,i){for(const r in t){const n=t[r],o={x:0,y:0,w:n.data.width+2*lc,h:n.data.height+2*lc};i.push(o),e[r]=new cc(o,n),n.hasRenderCallback&&this.haveRenderCallbacks.push(r)}}patchUpdatedImages(t,e){t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const i in t.updatedImages)this.patchUpdatedImage(this.iconPositions[i],t.getImage(i),e),this.patchUpdatedImage(this.patternPositions[i],t.getImage(i),e)}patchUpdatedImage(t,e,i){if(!t||!e)return;if(t.version===e.version)return;t.version=e.version;const[r,n]=t.tl;i.update(e.data,void 0,{x:r,y:n})}}var hc;Fr("ImagePosition",cc),Fr("ImageAtlas",uc),t.ai=void 0,(hc=t.ai||(t.ai={}))[hc.none=0]="none",hc[hc.horizontal=1]="horizontal",hc[hc.vertical=2]="vertical",hc[hc.horizontalOnly=3]="horizontalOnly";const dc=-17;class pc{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(t,e){const i=new pc;return i.scale=t||1,i.fontStack=e,i}static forImage(t){const e=new pc;return e.imageName=t,e}}class fc{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,e){const i=new fc;for(let r=0;r<t.sections.length;r++){const n=t.sections[r];n.image?i.addImageSection(n):i.addTextSection(n,e)}return i}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(){this.text=function(t){let e="";for(let i=0;i<t.length;i++){const r=t.charCodeAt(i+1)||null,n=t.charCodeAt(i-1)||null;e+=r&&Gr(r)&&!kl[t[i+1]]||n&&Gr(n)&&!kl[t[i-1]]||!kl[t[i]]?t[i]:kl[t[i]]}return e}(this.text)}trim(){let t=0;for(let e=0;e<this.text.length&&mc[this.text.charCodeAt(e)];e++)t++;let e=this.text.length;for(let i=this.text.length-1;i>=0&&i>=t&&mc[this.text.charCodeAt(i)];i--)e--;this.text=this.text.substring(t,e),this.sectionIndex=this.sectionIndex.slice(t,e)}substring(t,e){const i=new fc;return i.text=this.text.substring(t,e),i.sectionIndex=this.sectionIndex.slice(t,e),i.sections=this.sections,i}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((t,e)=>Math.max(t,this.sections[e].scale)),0)}addTextSection(t,e){this.text+=t.text,this.sections.push(pc.forText(t.scale,t.fontStack||e));const i=this.sections.length-1;for(let e=0;e<t.text.length;++e)this.sectionIndex.push(i)}addImageSection(t){const e=t.image?t.image.name:"";if(0===e.length)return void w("Can't add FormattedSection with an empty image.");const i=this.getNextImageSectionCharCode();i?(this.text+=String.fromCharCode(i),this.sections.push(pc.forImage(e)),this.sectionIndex.push(this.sections.length-1)):w("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Ac(e,i,r,n,o,s,a,l,c,u,h,d,p,f,A,m){const g=fc.fromFeature(e,o);let _;d===t.ai.vertical&&g.verticalizePunctuation();const{processBidirectionalText:y,processStyledBidirectionalText:v}=an;if(y&&1===g.sections.length){_=[];const t=y(g.toString(),wc(g,u,s,i,n,f,A));for(const e of t){const t=new fc;t.text=e,t.sections=g.sections;for(let i=0;i<e.length;i++)t.sectionIndex.push(0);_.push(t)}}else if(v){_=[];const t=v(g.text,g.sectionIndex,wc(g,u,s,i,n,f,A));for(const e of t){const t=new fc;t.text=e[0],t.sectionIndex=e[1],t.sections=g.sections,_.push(t)}}else _=function(t,e){const i=[],r=t.text;let n=0;for(const r of e)i.push(t.substring(n,r)),n=r;return n<r.length&&i.push(t.substring(n,r.length)),i}(g,wc(g,u,s,i,n,f,A));const x=[],b={positionedLines:x,text:g.toString(),top:h[1],bottom:h[1],left:h[0],right:h[0],writingMode:d,iconsInText:!1,verticalizable:!1};return function(e,i,r,n,o,s,a,l,c,u,h,d){let p=0,f=dc,A=0,m=0;const g="right"===l?1:"left"===l?0:.5;let _=0;for(const a of o){a.trim();const o=a.getMaxScale(),l=(o-1)*Pl,v={positionedGlyphs:[],lineOffset:0};e.positionedLines[_]=v;const x=v.positionedGlyphs;let b=0;if(!a.length()){f+=s,++_;continue}for(let s=0;s<a.length();s++){const A=a.getSection(s),m=a.getSectionIndex(s),g=a.getCharCode(s);let _=0,v=null,w=null,T=null,B=Pl;const E=!(c===t.ai.horizontal||!h&&!Hr(g)||h&&(mc[g]||(y=g,Nr.Arabic(y)||Nr["Arabic Supplement"](y)||Nr["Arabic Extended-A"](y)||Nr["Arabic Presentation Forms-A"](y)||Nr["Arabic Presentation Forms-B"](y))));if(A.imageName){const t=n[A.imageName];if(!t)continue;T=A.imageName,e.iconsInText=e.iconsInText||!0,w=t.paddedRect;const i=t.displaySize;A.scale=A.scale*Pl/d,v={width:i[0],height:i[1],left:lc,top:-sc,advance:E?i[1]:i[0]},_=l+(Pl-i[1]*A.scale),B=v.advance;const r=E?i[0]*A.scale-Pl*o:i[1]*A.scale-Pl*o;r>0&&r>b&&(b=r)}else{const t=r[A.fontStack],e=t&&t[g];if(e&&e.rect)w=e.rect,v=e.metrics;else{const t=i[A.fontStack],e=t&&t[g];if(!e)continue;v=e.metrics}_=(o-A.scale)*Pl}E?(e.verticalizable=!0,x.push({glyph:g,imageName:T,x:p,y:f+_,vertical:E,scale:A.scale,fontStack:A.fontStack,sectionIndex:m,metrics:v,rect:w}),p+=B*A.scale+u):(x.push({glyph:g,imageName:T,x:p,y:f+_,vertical:E,scale:A.scale,fontStack:A.fontStack,sectionIndex:m,metrics:v,rect:w}),p+=v.advance*A.scale+u)}0!==x.length&&(A=Math.max(p-u,A),Bc(x,0,x.length-1,g,b)),p=0;const w=s*o+b;v.lineOffset=Math.max(b,l),f+=w,m=Math.max(w,m),++_}var y;const v=f-dc,{horizontalAlign:x,verticalAlign:b}=Tc(a);(function(t,e,i,r,n,o,s,a,l){const c=(e-i)*n;let u=0;u=o!==s?-a*r-dc:(-r*l+.5)*s;for(const e of t)for(const t of e.positionedGlyphs)t.x+=c,t.y+=u})(e.positionedLines,g,x,b,A,m,s,v,o.length),e.top+=-b*v,e.bottom=e.top+v,e.left+=-x*A,e.right=e.left+A}(b,i,r,n,_,a,l,c,d,u,p,m),!function(t){for(const e of t)if(0!==e.positionedGlyphs.length)return!1;return!0}(x)&&b}const mc={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},gc={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function _c(t,e,i,r,n,o){if(e.imageName){const t=r[e.imageName];return t?t.displaySize[0]*e.scale*Pl/o+n:0}{const r=i[e.fontStack],o=r&&r[t];return o?o.metrics.advance*e.scale+n:0}}function yc(t,e,i,r){const n=Math.pow(t-e,2);return r?t<e?n/2:2*n:n+Math.abs(i)*i}function vc(t,e,i){let r=0;return 10===t&&(r-=1e4),i&&(r+=150),40!==t&&65288!==t||(r+=50),41!==e&&65289!==e||(r+=50),r}function xc(t,e,i,r,n,o){let s=null,a=yc(e,i,n,o);for(const t of r){const r=yc(e-t.x,i,n,o)+t.badness;r<=a&&(s=t,a=r)}return{index:t,x:e,priorBreak:s,badness:a}}function bc(t){return t?bc(t.priorBreak).concat(t.index):[]}function wc(t,e,i,r,n,o,s){if("point"!==o)return[];if(!t)return[];const a=[],l=function(t,e,i,r,n,o){let s=0;for(let i=0;i<t.length();i++){const a=t.getSection(i);s+=_c(t.getCharCode(i),a,r,n,e,o)}return s/Math.max(1,Math.ceil(s/i))}(t,e,i,r,n,s),c=t.text.indexOf("")>=0;let u=0;for(let i=0;i<t.length();i++){const o=t.getSection(i),d=t.getCharCode(i);if(mc[d]||(u+=_c(d,o,r,n,e,s)),i<t.length()-1){const e=!((h=d)<11904||!(Nr["Bopomofo Extended"](h)||Nr.Bopomofo(h)||Nr["CJK Compatibility Forms"](h)||Nr["CJK Compatibility Ideographs"](h)||Nr["CJK Compatibility"](h)||Nr["CJK Radicals Supplement"](h)||Nr["CJK Strokes"](h)||Nr["CJK Symbols and Punctuation"](h)||Nr["CJK Unified Ideographs Extension A"](h)||Nr["CJK Unified Ideographs"](h)||Nr["Enclosed CJK Letters and Months"](h)||Nr["Halfwidth and Fullwidth Forms"](h)||Nr.Hiragana(h)||Nr["Ideographic Description Characters"](h)||Nr["Kangxi Radicals"](h)||Nr["Katakana Phonetic Extensions"](h)||Nr.Katakana(h)||Nr["Vertical Forms"](h)||Nr["Yi Radicals"](h)||Nr["Yi Syllables"](h)));(gc[d]||e||o.imageName)&&a.push(xc(i+1,u,l,a,vc(d,t.getCharCode(i+1),e&&c),!1))}}var h;return bc(xc(t.length(),u,l,a,0,!0))}function Tc(t){let e=.5,i=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:e,verticalAlign:i}}function Bc(t,e,i,r,n){if(!r&&!n)return;const o=t[i],s=(t[i].x+o.metrics.advance*o.scale)*r;for(let r=e;r<=i;r++)t[r].x-=s,t[r].y+=n}function Ec(t,e,i){const{horizontalAlign:r,verticalAlign:n}=Tc(i),o=e[0]-t.displaySize[0]*r,s=e[1]-t.displaySize[1]*n;return{image:t,top:s,bottom:s+t.displaySize[1],left:o,right:o+t.displaySize[0]}}function Cc(t,e,i,r,n,o){const s=t.image;let a;if(s.content){const t=s.content,e=s.pixelRatio||1;a=[t[0]/e,t[1]/e,s.displaySize[0]-t[2]/e,s.displaySize[1]-t[3]/e]}const l=e.left*o,c=e.right*o;let u,h,d,p;"width"===i||"both"===i?(p=n[0]+l-r[3],h=n[0]+c+r[1]):(p=n[0]+(l+c-s.displaySize[0])/2,h=p+s.displaySize[0]);const f=e.top*o,A=e.bottom*o;return"height"===i||"both"===i?(u=n[1]+f-r[0],d=n[1]+A+r[2]):(u=n[1]+(f+A-s.displaySize[1])/2,d=u+s.displaySize[1]),{image:s,top:u,right:h,bottom:d,left:p,collisionPadding:a}}const Sc=255,Ic=128,Mc=Sc*Ic;function kc(t,e){const{expression:i}=e;if("constant"===i.kind)return{kind:"constant",layoutSize:i.evaluate(new ln(t+1))};if("source"===i.kind)return{kind:"source"};{const{zoomStops:e,interpolationType:r}=i;let n=0;for(;n<e.length&&e[n]<=t;)n++;n=Math.max(0,n-1);let o=n;for(;o<e.length&&e[o]<t+1;)o++;o=Math.min(e.length-1,o);const s=e[n],a=e[o];return"composite"===i.kind?{kind:"composite",minZoom:s,maxZoom:a,interpolationType:r}:{kind:"camera",minZoom:s,maxZoom:a,minSize:i.evaluate(new ln(s)),maxSize:i.evaluate(new ln(a)),interpolationType:r}}}function Pc(t,e,i){let r="never";const n=t.get(e);return n?r=n:t.get(i)&&(r="always"),r}const Lc=Qa.VectorTileFeature.types,zc=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Fc(t,e,i,r,n,o,s,a,l,c,u,h,d){const p=a?Math.min(Mc,Math.round(a[0])):0,f=a?Math.min(Mc,Math.round(a[1])):0;t.emplaceBack(e,i,Math.round(32*r),Math.round(32*n),o,s,(p<<1)+(l?1:0),f,16*c,16*u,256*h,256*d)}function Dc(t,e,i){t.emplaceBack(e.x,e.y,i),t.emplaceBack(e.x,e.y,i),t.emplaceBack(e.x,e.y,i),t.emplaceBack(e.x,e.y,i)}function Rc(t){for(const e of t.sections)if(qr(e.text))return!0;return!1}class Uc{constructor(t){this.layoutVertexArray=new yo,this.indexArray=new To,this.programConfigurations=t,this.segments=new So,this.dynamicLayoutVertexArray=new vo,this.opacityVertexArray=new xo,this.hasVisibleVertices=!1,this.placedSymbolArray=new io}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(t,e,i,r){this.isEmpty()||(i&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Bl.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,e),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,El.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,zc,!0),this.opacityVertexBuffer.itemSize=1),(i||r)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Fr("SymbolBuffers",Uc);class Oc{constructor(t,e,i){this.layoutVertexArray=new t,this.layoutAttributes=e,this.indexArray=new i,this.segments=new So,this.collisionVertexArray=new wo}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,Cl.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Fr("CollisionBuffers",Oc);class Nc{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((t=>t.id)),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Is([]),this.placementViewportMatrix=Is([]);const i=this.layers[0]._unevaluatedLayout._values;this.textSizeData=kc(this.zoom,i["text-size"]),this.iconSizeData=kc(this.zoom,i["icon-size"]);const r=this.layers[0].layout,n=r.get("symbol-sort-key"),o=r.get("symbol-z-order");this.canOverlap="never"!==Pc(r,"text-overlap","text-allow-overlap")||"never"!==Pc(r,"icon-overlap","icon-allow-overlap")||r.get("text-ignore-placement")||r.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==o&&!n.isConstant(),this.sortFeaturesByY=("viewport-y"===o||"auto"===o&&!this.sortFeaturesByKey)&&this.canOverlap,"point"===r.get("symbol-placement")&&(this.writingModes=r.get("text-writing-mode").map((e=>t.ai[e]))),this.stateDependentLayerIds=this.layers.filter((t=>t.isStateDependent())).map((t=>t.id)),this.sourceID=e.sourceID}createArrays(){this.text=new Uc(new ts(this.layers,this.zoom,(t=>/^text/.test(t)))),this.icon=new Uc(new ts(this.layers,this.zoom,(t=>/^icon/.test(t)))),this.glyphOffsetArray=new oo,this.lineVertexArray=new so,this.symbolInstances=new no,this.textAnchorOffsets=new lo}calculateGlyphDependencies(t,e,i,r,n){for(let o=0;o<t.length;o++)if(e[t.charCodeAt(o)]=!0,(i||r)&&n){const i=kl[t.charAt(o)];i&&(e[i.charCodeAt(0)]=!0)}}populate(e,i,r){const n=this.layers[0],o=n.layout,s=o.get("text-font"),a=o.get("text-field"),l=o.get("icon-image"),c=("constant"!==a.value.kind||a.value.value instanceof Yt&&!a.value.value.isEmpty()||a.value.value.toString().length>0)&&("constant"!==s.value.kind||s.value.value.length>0),u="constant"!==l.value.kind||!!l.value.value||Object.keys(l.parameters).length>0,h=o.get("symbol-sort-key");if(this.features=[],!c&&!u)return;const d=i.iconDependencies,p=i.glyphDependencies,f=i.availableImages,A=new ln(this.zoom);for(const{feature:i,id:a,index:l,sourceLayerIndex:m}of e){const e=n._featureFilter.needGeometry,g=as(i,e);if(!n._featureFilter.filter(A,g,r))continue;let _,y;if(e||(g.geometry=ss(i)),c){const t=n.getValueAndResolveTokens("text-field",g,r,f),e=Yt.factory(t);Rc(e)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===on()||this.hasRTLText&&an.isParsed())&&(_=Ml(e,n,g))}if(u){const t=n.getValueAndResolveTokens("icon-image",g,r,f);y=t instanceof re?t:re.fromString(t)}if(!_&&!y)continue;const v=this.sortFeaturesByKey?h.evaluate(g,{},r):void 0;if(this.features.push({id:a,text:_,icon:y,index:l,sourceLayerIndex:m,geometry:g.geometry,properties:i.properties,type:Lc[i.type],sortKey:v}),y&&(d[y.name]=!0),_){const e=s.evaluate(g,{},r).join(","),i="viewport"!==o.get("text-rotation-alignment")&&"point"!==o.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(t.ai.vertical)>=0;for(const t of _.sections)if(t.image)d[t.image.name]=!0;else{const r=Qr(_.toString()),n=t.fontStack||e,o=p[n]=p[n]||{};this.calculateGlyphDependencies(t.text,o,i,this.allowVerticalPlacement,r)}}}"line"===o.get("symbol-placement")&&(this.features=function(t){const e={},i={},r=[];let n=0;function o(e){r.push(t[e]),n++}function s(t,e,n){const o=i[t];return delete i[t],i[e]=o,r[o].geometry[0].pop(),r[o].geometry[0]=r[o].geometry[0].concat(n[0]),o}function a(t,i,n){const o=e[i];return delete e[i],e[t]=o,r[o].geometry[0].shift(),r[o].geometry[0]=n[0].concat(r[o].geometry[0]),o}function l(t,e,i){const r=i?e[0][e[0].length-1]:e[0][0];return`${t}:${r.x}:${r.y}`}for(let c=0;c<t.length;c++){const u=t[c],h=u.geometry,d=u.text?u.text.toString():null;if(!d){o(c);continue}const p=l(d,h),f=l(d,h,!0);if(p in i&&f in e&&i[p]!==e[f]){const t=a(p,f,h),n=s(p,f,r[t].geometry);delete e[p],delete i[f],i[l(d,r[n].geometry,!0)]=n,r[t].geometry=null}else p in i?s(p,f,h):f in e?a(p,f,h):(o(c),e[p]=n-1,i[f]=n-1)}return r.filter((t=>t.geometry))}(this.features)),this.sortFeaturesByKey&&this.features.sort(((t,e)=>t.sortKey-e.sortKey))}update(t,e,i){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,e,this.layers,i),this.icon.programConfigurations.updatePaintArrays(t,e,this.layers,i))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,e){const i=this.lineVertexArray.length;if(void 0!==t.segment){let i=t.dist(e[t.segment+1]),r=t.dist(e[t.segment]);const n={};for(let r=t.segment+1;r<e.length;r++)n[r]={x:e[r].x,y:e[r].y,tileUnitDistanceFromAnchor:i},r<e.length-1&&(i+=e[r+1].dist(e[r]));for(let i=t.segment||0;i>=0;i--)n[i]={x:e[i].x,y:e[i].y,tileUnitDistanceFromAnchor:r},i>0&&(r+=e[i-1].dist(e[i]));for(let t=0;t<e.length;t++){const e=n[t];this.lineVertexArray.emplaceBack(e.x,e.y,e.tileUnitDistanceFromAnchor)}}return{lineStartIndex:i,lineLength:this.lineVertexArray.length-i}}addSymbols(e,i,r,n,o,s,a,l,c,u,h,d){const p=e.indexArray,f=e.layoutVertexArray,A=e.segments.prepareSegment(4*i.length,f,p,this.canOverlap?s.sortKey:void 0),m=this.glyphOffsetArray.length,g=A.vertexLength,_=this.allowVerticalPlacement&&a===t.ai.vertical?Math.PI/2:0,y=s.text&&s.text.sections;for(let t=0;t<i.length;t++){const{tl:n,tr:o,bl:a,br:c,tex:u,pixelOffsetTL:h,pixelOffsetBR:m,minFontScaleX:g,minFontScaleY:v,glyphOffset:x,isSDF:b,sectionIndex:w}=i[t],T=A.vertexLength,B=x[1];Fc(f,l.x,l.y,n.x,B+n.y,u.x,u.y,r,b,h.x,h.y,g,v),Fc(f,l.x,l.y,o.x,B+o.y,u.x+u.w,u.y,r,b,m.x,h.y,g,v),Fc(f,l.x,l.y,a.x,B+a.y,u.x,u.y+u.h,r,b,h.x,m.y,g,v),Fc(f,l.x,l.y,c.x,B+c.y,u.x+u.w,u.y+u.h,r,b,m.x,m.y,g,v),Dc(e.dynamicLayoutVertexArray,l,_),p.emplaceBack(T,T+1,T+2),p.emplaceBack(T+1,T+2,T+3),A.vertexLength+=4,A.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(x[0]),t!==i.length-1&&w===i[t+1].sectionIndex||e.programConfigurations.populatePaintArrays(f.length,s,s.index,{},d,y&&y[w])}e.placedSymbolArray.emplaceBack(l.x,l.y,m,this.glyphOffsetArray.length-m,g,c,u,l.segment,r?r[0]:0,r?r[1]:0,n[0],n[1],a,0,!1,0,h)}_addCollisionDebugVertex(t,e,i,r,n,o){return e.emplaceBack(0,0),t.emplaceBack(i.x,i.y,r,n,Math.round(o.x),Math.round(o.y))}addCollisionDebugVertices(t,e,i,r,n,s,a){const l=n.segments.prepareSegment(4,n.layoutVertexArray,n.indexArray),c=l.vertexLength,u=n.layoutVertexArray,h=n.collisionVertexArray,d=a.anchorX,p=a.anchorY;this._addCollisionDebugVertex(u,h,s,d,p,new o(t,e)),this._addCollisionDebugVertex(u,h,s,d,p,new o(i,e)),this._addCollisionDebugVertex(u,h,s,d,p,new o(i,r)),this._addCollisionDebugVertex(u,h,s,d,p,new o(t,r)),l.vertexLength+=4;const f=n.indexArray;f.emplaceBack(c,c+1),f.emplaceBack(c+1,c+2),f.emplaceBack(c+2,c+3),f.emplaceBack(c+3,c),l.primitiveLength+=4}addDebugCollisionBoxes(t,e,i,r){for(let n=t;n<e;n++){const t=this.collisionBoxArray.get(n);this.addCollisionDebugVertices(t.x1,t.y1,t.x2,t.y2,r?this.textCollisionBox:this.iconCollisionBox,t.anchorPoint,i)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Oc(bo,Sl.members,Bo),this.iconCollisionBox=new Oc(bo,Sl.members,Bo);for(let t=0;t<this.symbolInstances.length;t++){const e=this.symbolInstances.get(t);this.addDebugCollisionBoxes(e.textBoxStartIndex,e.textBoxEndIndex,e,!0),this.addDebugCollisionBoxes(e.verticalTextBoxStartIndex,e.verticalTextBoxEndIndex,e,!0),this.addDebugCollisionBoxes(e.iconBoxStartIndex,e.iconBoxEndIndex,e,!1),this.addDebugCollisionBoxes(e.verticalIconBoxStartIndex,e.verticalIconBoxEndIndex,e,!1)}}_deserializeCollisionBoxesForSymbol(t,e,i,r,n,o,s,a,l){const c={};for(let r=e;r<i;r++){const e=t.get(r);c.textBox={x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2,anchorPointX:e.anchorPointX,anchorPointY:e.anchorPointY},c.textFeatureIndex=e.featureIndex;break}for(let e=r;e<n;e++){const i=t.get(e);c.verticalTextBox={x1:i.x1,y1:i.y1,x2:i.x2,y2:i.y2,anchorPointX:i.anchorPointX,anchorPointY:i.anchorPointY},c.verticalTextFeatureIndex=i.featureIndex;break}for(let e=o;e<s;e++){const i=t.get(e);c.iconBox={x1:i.x1,y1:i.y1,x2:i.x2,y2:i.y2,anchorPointX:i.anchorPointX,anchorPointY:i.anchorPointY},c.iconFeatureIndex=i.featureIndex;break}for(let e=a;e<l;e++){const i=t.get(e);c.verticalIconBox={x1:i.x1,y1:i.y1,x2:i.x2,y2:i.y2,anchorPointX:i.anchorPointX,anchorPointY:i.anchorPointY},c.verticalIconFeatureIndex=i.featureIndex;break}return c}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let e=0;e<this.symbolInstances.length;e++){const i=this.symbolInstances.get(e);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,i.textBoxStartIndex,i.textBoxEndIndex,i.verticalTextBoxStartIndex,i.verticalTextBoxEndIndex,i.iconBoxStartIndex,i.iconBoxEndIndex,i.verticalIconBoxStartIndex,i.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,e){const i=t.placedSymbolArray.get(e),r=i.vertexStartIndex+4*i.numGlyphs;for(let e=i.vertexStartIndex;e<r;e+=4)t.indexArray.emplaceBack(e,e+1,e+2),t.indexArray.emplaceBack(e+1,e+2,e+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const e=Math.sin(t),i=Math.cos(t),r=[],n=[],o=[];for(let t=0;t<this.symbolInstances.length;++t){o.push(t);const s=this.symbolInstances.get(t);r.push(0|Math.round(e*s.anchorX+i*s.anchorY)),n.push(s.featureIndex)}return o.sort(((t,e)=>r[t]-r[e]||n[e]-n[t])),o}addToSortKeyRanges(t,e){const i=this.sortKeyRanges[this.sortKeyRanges.length-1];i&&i.sortKey===e?i.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:e,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const t of this.symbolInstanceIndexes){const e=this.symbolInstances.get(t);this.featureSortOrder.push(e.featureIndex),[e.rightJustifiedTextSymbolIndex,e.centerJustifiedTextSymbolIndex,e.leftJustifiedTextSymbolIndex].forEach(((t,e,i)=>{t>=0&&i.indexOf(t)===e&&this.addIndicesForPlacedSymbol(this.text,t)})),e.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,e.verticalPlacedTextSymbolIndex),e.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,e.placedIconSymbolIndex),e.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,e.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let Qc,Vc;Fr("SymbolBucket",Nc,{omit:["layers","collisionBoxArray","features","compareText"]}),Nc.MAX_GLYPHS=65535,Nc.addDynamicAttributes=Dc;var jc={get paint(){return Vc=Vc||new bn({"icon-opacity":new _n(K.paint_symbol["icon-opacity"]),"icon-color":new _n(K.paint_symbol["icon-color"]),"icon-halo-color":new _n(K.paint_symbol["icon-halo-color"]),"icon-halo-width":new _n(K.paint_symbol["icon-halo-width"]),"icon-halo-blur":new _n(K.paint_symbol["icon-halo-blur"]),"icon-translate":new gn(K.paint_symbol["icon-translate"]),"icon-translate-anchor":new gn(K.paint_symbol["icon-translate-anchor"]),"text-opacity":new _n(K.paint_symbol["text-opacity"]),"text-color":new _n(K.paint_symbol["text-color"],{runtimeType:At,getOverride:t=>t.textColor,hasOverride:t=>!!t.textColor}),"text-halo-color":new _n(K.paint_symbol["text-halo-color"]),"text-halo-width":new _n(K.paint_symbol["text-halo-width"]),"text-halo-blur":new _n(K.paint_symbol["text-halo-blur"]),"text-translate":new gn(K.paint_symbol["text-translate"]),"text-translate-anchor":new gn(K.paint_symbol["text-translate-anchor"])})},get layout(){return Qc=Qc||new bn({"symbol-placement":new gn(K.layout_symbol["symbol-placement"]),"symbol-spacing":new gn(K.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new gn(K.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new _n(K.layout_symbol["symbol-sort-key"]),"symbol-z-order":new gn(K.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new gn(K.layout_symbol["icon-allow-overlap"]),"icon-overlap":new gn(K.layout_symbol["icon-overlap"]),"icon-ignore-placement":new gn(K.layout_symbol["icon-ignore-placement"]),"icon-optional":new gn(K.layout_symbol["icon-optional"]),"icon-rotation-alignment":new gn(K.layout_symbol["icon-rotation-alignment"]),"icon-size":new _n(K.layout_symbol["icon-size"]),"icon-text-fit":new gn(K.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new gn(K.layout_symbol["icon-text-fit-padding"]),"icon-image":new _n(K.layout_symbol["icon-image"]),"icon-rotate":new _n(K.layout_symbol["icon-rotate"]),"icon-padding":new _n(K.layout_symbol["icon-padding"]),"icon-keep-upright":new gn(K.layout_symbol["icon-keep-upright"]),"icon-offset":new _n(K.layout_symbol["icon-offset"]),"icon-anchor":new _n(K.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new gn(K.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new gn(K.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new gn(K.layout_symbol["text-rotation-alignment"]),"text-field":new _n(K.layout_symbol["text-field"]),"text-font":new _n(K.layout_symbol["text-font"]),"text-size":new _n(K.layout_symbol["text-size"]),"text-max-width":new _n(K.layout_symbol["text-max-width"]),"text-line-height":new gn(K.layout_symbol["text-line-height"]),"text-letter-spacing":new _n(K.layout_symbol["text-letter-spacing"]),"text-justify":new _n(K.layout_symbol["text-justify"]),"text-radial-offset":new _n(K.layout_symbol["text-radial-offset"]),"text-variable-anchor":new gn(K.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new _n(K.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new _n(K.layout_symbol["text-anchor"]),"text-max-angle":new gn(K.layout_symbol["text-max-angle"]),"text-writing-mode":new gn(K.layout_symbol["text-writing-mode"]),"text-rotate":new _n(K.layout_symbol["text-rotate"]),"text-padding":new gn(K.layout_symbol["text-padding"]),"text-keep-upright":new gn(K.layout_symbol["text-keep-upright"]),"text-transform":new _n(K.layout_symbol["text-transform"]),"text-offset":new _n(K.layout_symbol["text-offset"]),"text-allow-overlap":new gn(K.layout_symbol["text-allow-overlap"]),"text-overlap":new gn(K.layout_symbol["text-overlap"]),"text-ignore-placement":new gn(K.layout_symbol["text-ignore-placement"]),"text-optional":new gn(K.layout_symbol["text-optional"])})}};class Hc{constructor(t){if(void 0===t.property.overrides)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=t.property.overrides?t.property.overrides.runtimeType:ht,this.defaultValue=t}evaluate(t){if(t.formattedSection){const e=this.defaultValue.property.overrides;if(e&&e.hasOverride(t.formattedSection))return e.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Fr("FormatSectionOverride",Hc,{omit:["defaultValue"]});class Gc extends Tn{constructor(t){super(t,jc)}recalculate(t,e){if(super.recalculate(t,e),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]="map"===this.layout.get("text-rotation-alignment")?"map":"viewport"),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),"point"===this.layout.get("symbol-placement")){const t=this.layout.get("text-writing-mode");if(t){const e=[];for(const i of t)e.indexOf(i)<0&&e.push(i);this.layout._values["text-writing-mode"]=e}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(t,e,i,r){const n=this.layout.get(t).evaluate(e,{},i,r),o=this._unevaluatedLayout._values[t];return o.isDataDriven()||Fi(o.value)||!n?n:function(t,e){return e.replace(/{([^{}]+)}/g,((e,i)=>t&&i in t?String(t[i]):""))}(e.properties,n)}createBucket(t){return new Nc(t)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const t of jc.paint.overridableProperties){if(!Gc.hasPaintOverride(this.layout,t))continue;const e=this.paint.get(t),i=new Hc(e),r=new zi(i,e.property.specification);let n=null;n="constant"===e.value.kind||"source"===e.value.kind?new Ri("source",r):new Ui("composite",r,e.value.zoomStops),this.paint._values[t]=new An(e.property,n,e.parameters)}}_handleOverridablePaintPropertyUpdate(t,e,i){return!(!this.layout||e.isDataDriven()||i.isDataDriven())&&Gc.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,e){const i=t.get("text-field"),r=jc.paint.properties[e];let n=!1;const o=t=>{for(const e of t)if(r.overrides&&r.overrides.hasOverride(e))return void(n=!0)};if("constant"===i.value.kind&&i.value.value instanceof Yt)o(i.value.value.sections);else if("source"===i.value.kind){const t=e=>{n||(e instanceof le&&se(e.value)===yt?o(e.value.sections):e instanceof di?o(e.sections):e.eachChild(t))},e=i.value;e._styleExpression&&t(e._styleExpression.expression)}return n}}let $c;var Zc={get paint(){return $c=$c||new bn({"background-color":new gn(K.paint_background["background-color"]),"background-pattern":new vn(K.paint_background["background-pattern"]),"background-opacity":new gn(K.paint_background["background-opacity"])})}};class qc extends Tn{constructor(t){super(t,Zc)}}let Kc;var Wc={get paint(){return Kc=Kc||new bn({"raster-opacity":new gn(K.paint_raster["raster-opacity"]),"raster-hue-rotate":new gn(K.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new gn(K.paint_raster["raster-brightness-min"]),"raster-brightness-max":new gn(K.paint_raster["raster-brightness-max"]),"raster-saturation":new gn(K.paint_raster["raster-saturation"]),"raster-contrast":new gn(K.paint_raster["raster-contrast"]),"raster-resampling":new gn(K.paint_raster["raster-resampling"]),"raster-fade-duration":new gn(K.paint_raster["raster-fade-duration"])})}};class Xc extends Tn{constructor(t){super(t,Wc)}}class Jc extends Tn{constructor(t){super(t,{}),this.onAdd=t=>{this.implementation.onAdd&&this.implementation.onAdd(t,t.painter.context.gl)},this.onRemove=t=>{this.implementation.onRemove&&this.implementation.onRemove(t,t.painter.context.gl)},this.implementation=t}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class Yc{constructor(t){this._callback=t,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._callback()}),0))}remove(){delete this._channel,this._callback=()=>{}}}const tu=6371008.8;class eu{constructor(t,e){if(isNaN(t)||isNaN(e))throw new Error(`Invalid LngLat object: (${t}, ${e})`);if(this.lng=+t,this.lat=+e,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new eu(m(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const e=Math.PI/180,i=this.lat*e,r=t.lat*e,n=Math.sin(i)*Math.sin(r)+Math.cos(i)*Math.cos(r)*Math.cos((t.lng-this.lng)*e);return tu*Math.acos(Math.min(n,1))}static convert(t){if(t instanceof eu)return t;if(Array.isArray(t)&&(2===t.length||3===t.length))return new eu(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&"object"==typeof t&&null!==t)return new eu(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const iu=2*Math.PI*tu;function ru(t){return iu*Math.cos(t*Math.PI/180)}function nu(t){return(180+t)/360}function ou(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function su(t,e){return t/ru(e)}function au(t){return 360*t-180}function lu(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}class cu{constructor(t,e,i=0){this.x=+t,this.y=+e,this.z=+i}static fromLngLat(t,e=0){const i=eu.convert(t);return new cu(nu(i.lng),ou(i.lat),su(e,i.lat))}toLngLat(){return new eu(au(this.x),lu(this.y))}toAltitude(){return this.z*ru(lu(this.y))}meterInMercatorCoordinateUnits(){return 1/iu*(t=lu(this.y),1/Math.cos(t*Math.PI/180));var t}}function uu(t,e,i){var r=2*Math.PI*6378137/256/Math.pow(2,i);return[t*r-2*Math.PI*6378137/2,e*r-2*Math.PI*6378137/2]}class hu{constructor(t,e,i){if(t<0||t>25||i<0||i>=Math.pow(2,t)||e<0||e>=Math.pow(2,t))throw new Error(`x=${e}, y=${i}, z=${t} outside of bounds. 0<=x<${Math.pow(2,t)}, 0<=y<${Math.pow(2,t)} 0<=z<=25 `);this.z=t,this.x=e,this.y=i,this.key=fu(0,t,t,e,i)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,e,i){const r=(o=this.y,s=this.z,a=uu(256*(n=this.x),256*(o=Math.pow(2,s)-o-1),s),l=uu(256*(n+1),256*(o+1),s),a[0]+","+a[1]+","+l[0]+","+l[1]);var n,o,s,a,l;const c=function(t,e,i){let r,n="";for(let o=t;o>0;o--)r=1<<o-1,n+=(e&r?1:0)+(i&r?2:0);return n}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===i?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,e>1?"@2x":"").replace(/{quadkey}/g,c).replace(/{bbox-epsg-3857}/g,r)}isChildOf(t){const e=this.z-t.z;return e>0&&t.x===this.x>>e&&t.y===this.y>>e}getTilePoint(t){const e=Math.pow(2,this.z);return new o((t.x*e-this.x)*rs,(t.y*e-this.y)*rs)}toString(){return`${this.z}/${this.x}/${this.y}`}}class du{constructor(t,e){this.wrap=t,this.canonical=e,this.key=fu(t,e.z,e.z,e.x,e.y)}}class pu{constructor(t,e,i,r,n){if(t<i)throw new Error(`overscaledZ should be >= z; overscaledZ = ${t}; z = ${i}`);this.overscaledZ=t,this.wrap=e,this.canonical=new hu(i,+r,+n),this.key=fu(e,t,i,r,n)}clone(){return new pu(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const e=this.canonical.z-t;return t>this.canonical.z?new pu(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new pu(t,this.wrap,t,this.canonical.x>>e,this.canonical.y>>e)}calculateScaledKey(t,e){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const i=this.canonical.z-t;return t>this.canonical.z?fu(this.wrap*+e,t,this.canonical.z,this.canonical.x,this.canonical.y):fu(this.wrap*+e,t,t,this.canonical.x>>i,this.canonical.y>>i)}isChildOf(t){if(t.wrap!==this.wrap)return!1;const e=this.canonical.z-t.canonical.z;return 0===t.overscaledZ||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>e&&t.canonical.y===this.canonical.y>>e}children(t){if(this.overscaledZ>=t)return[new pu(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const e=this.canonical.z+1,i=2*this.canonical.x,r=2*this.canonical.y;return[new pu(e,this.wrap,e,i,r),new pu(e,this.wrap,e,i+1,r),new pu(e,this.wrap,e,i,r+1),new pu(e,this.wrap,e,i+1,r+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new pu(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new pu(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new du(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(t){return this.canonical.getTilePoint(new cu(t.x-this.wrap,t.y))}}function fu(t,e,i,r,n){(t*=2)<0&&(t=-1*t-1);const o=1<<i;return(o*o*t+o*n+r).toString(36)+i.toString(36)+e.toString(36)}Fr("CanonicalTileID",hu),Fr("OverscaledTileID",pu,{omit:["posMatrix"]});class Au{constructor(t,e,i,r=1,n=1,o=1,s=0){if(this.uid=t,e.height!==e.width)throw new RangeError("DEM tiles must be square");if(i&&!["mapbox","terrarium","custom"].includes(i))return void w(`"${i}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=e.height;const a=this.dim=e.height-2;switch(this.data=new Uint32Array(e.data.buffer),i){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=r,this.greenFactor=n,this.blueFactor=o,this.baseShift=s;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let t=0;t<a;t++)this.data[this._idx(-1,t)]=this.data[this._idx(0,t)],this.data[this._idx(a,t)]=this.data[this._idx(a-1,t)],this.data[this._idx(t,-1)]=this.data[this._idx(t,0)],this.data[this._idx(t,a)]=this.data[this._idx(t,a-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(a,-1)]=this.data[this._idx(a-1,0)],this.data[this._idx(-1,a)]=this.data[this._idx(0,a-1)],this.data[this._idx(a,a)]=this.data[this._idx(a-1,a-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let t=0;t<a;t++)for(let e=0;e<a;e++){const i=this.get(t,e);i>this.max&&(this.max=i),i<this.min&&(this.min=i)}}get(t,e){const i=new Uint8Array(this.data.buffer),r=4*this._idx(t,e);return this.unpack(i[r],i[r+1],i[r+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(t,e){if(t<-1||t>=this.dim+1||e<-1||e>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(e+1)*this.stride+(t+1)}unpack(t,e,i){return t*this.redFactor+e*this.greenFactor+i*this.blueFactor-this.baseShift}getPixels(){return new js({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(t,e,i){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let r=e*this.dim,n=e*this.dim+this.dim,o=i*this.dim,s=i*this.dim+this.dim;switch(e){case-1:r=n-1;break;case 1:n=r+1}switch(i){case-1:o=s-1;break;case 1:s=o+1}const a=-e*this.dim,l=-i*this.dim;for(let e=o;e<s;e++)for(let i=r;i<n;i++)this.data[this._idx(i,e)]=t.data[this._idx(i+a,e+l)]}}Fr("DEMData",Au);class mu{constructor(t){this._stringToNumber={},this._numberToString=[];for(let e=0;e<t.length;e++){const i=t[e];this._stringToNumber[i]=e,this._numberToString[e]=i}}encode(t){return this._stringToNumber[t]}decode(t){if(t>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${t} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[t]}}class gu{constructor(t,e,i,r,n){this.type="Feature",this._vectorTileFeature=t,t._z=e,t._x=i,t._y=r,this.properties=t.properties,this.id=n}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={geometry:this.geometry};for(const e in this)"_geometry"!==e&&"_vectorTileFeature"!==e&&(t[e]=this[e]);return t}}class _u{constructor(t,e){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new Lr(rs,16,0),this.grid3D=new Lr(rs,16,0),this.featureIndexArray=new uo,this.promoteId=e}insert(t,e,i,r,n,o){const s=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(i,r,n);const a=o?this.grid3D:this.grid;for(let t=0;t<e.length;t++){const i=e[t],r=[1/0,1/0,-1/0,-1/0];for(let t=0;t<i.length;t++){const e=i[t];r[0]=Math.min(r[0],e.x),r[1]=Math.min(r[1],e.y),r[2]=Math.max(r[2],e.x),r[3]=Math.max(r[3],e.y)}r[0]<rs&&r[1]<rs&&r[2]>=0&&r[3]>=0&&a.insert(s,r[0],r[1],r[2],r[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Qa.VectorTile(new ec(this.rawTileData)).layers,this.sourceLayerCoder=new mu(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(t,e,i,r){this.loadVTLayers();const n=t.params||{},s=rs/t.tileSize/t.scale,a=Hi(n.filter),l=t.queryGeometry,c=t.queryPadding*s,u=vu(l),h=this.grid.query(u.minX-c,u.minY-c,u.maxX+c,u.maxY+c),d=vu(t.cameraQueryGeometry),p=this.grid3D.query(d.minX-c,d.minY-c,d.maxX+c,d.maxY+c,((e,i,r,n)=>function(t,e,i,r,n){for(const o of t)if(e<=o.x&&i<=o.y&&r>=o.x&&n>=o.y)return!0;const s=[new o(e,i),new o(e,n),new o(r,n),new o(r,i)];if(t.length>2)for(const e of s)if(ys(t,e))return!0;for(let e=0;e<t.length-1;e++)if(vs(t[e],t[e+1],s))return!0;return!1}(t.cameraQueryGeometry,e-c,i-c,r+c,n+c)));for(const t of p)h.push(t);h.sort(xu);const f={};let A;for(let o=0;o<h.length;o++){const c=h[o];if(c===A)continue;A=c;const u=this.featureIndexArray.get(c);let d=null;this.loadMatchingFeature(f,u.bucketIndex,u.sourceLayerIndex,u.featureIndex,a,n.layers,n.availableImages,e,i,r,((e,i,r)=>(d||(d=ss(e)),i.queryIntersectsFeature(l,e,r,d,this.z,t.transform,s,t.pixelPosMatrix))))}return f}loadMatchingFeature(t,e,i,r,n,o,s,a,l,c,u){const h=this.bucketLayerIDs[e];if(o&&!function(t,e){for(let i=0;i<t.length;i++)if(e.indexOf(t[i])>=0)return!0;return!1}(o,h))return;const d=this.sourceLayerCoder.decode(i),p=this.vtLayers[d].feature(r);if(n.needGeometry){const t=as(p,!0);if(!n.filter(new ln(this.tileID.overscaledZ),t,this.tileID.canonical))return}else if(!n.filter(new ln(this.tileID.overscaledZ),p))return;const f=this.getId(p,d);for(let e=0;e<h.length;e++){const i=h[e];if(o&&o.indexOf(i)<0)continue;const n=a[i];if(!n)continue;let d={};f&&c&&(d=c.getState(n.sourceLayer||"_geojsonTileLayer",f));const A=g({},l[i]);A.paint=yu(A.paint,n.paint,p,d,s),A.layout=yu(A.layout,n.layout,p,d,s);const m=!u||u(p,n,d);if(!m)continue;const _=new gu(p,this.z,this.x,this.y,f);_.layer=A;let y=t[i];void 0===y&&(y=t[i]=[]),y.push({featureIndex:r,feature:_,intersectionZ:m})}}lookupSymbolFeatures(t,e,i,r,n,o,s,a){const l={};this.loadVTLayers();const c=Hi(n);for(const n of t)this.loadMatchingFeature(l,i,r,n,c,o,s,a,e);return l}hasLayer(t){for(const e of this.bucketLayerIDs)for(const i of e)if(t===i)return!0;return!1}getId(t,e){let i=t.id;return this.promoteId&&(i=t.properties["string"==typeof this.promoteId?this.promoteId:this.promoteId[e]],"boolean"==typeof i&&(i=Number(i))),i}}function yu(t,e,i,r,n){return y(t,((t,o)=>{const s=e instanceof mn?e.get(o):null;return s&&s.evaluate?s.evaluate(i,r,n):s}))}function vu(t){let e=1/0,i=1/0,r=-1/0,n=-1/0;for(const o of t)e=Math.min(e,o.x),i=Math.min(i,o.y),r=Math.max(r,o.x),n=Math.max(n,o.y);return{minX:e,minY:i,maxX:r,maxY:n}}function xu(t,e){return e-t}function bu(t,e,i,r,n){const s=[];for(let a=0;a<t.length;a++){const l=t[a];let c;for(let t=0;t<l.length-1;t++){let a=l[t],u=l[t+1];a.x<e&&u.x<e||(a.x<e?a=new o(e,a.y+(e-a.x)/(u.x-a.x)*(u.y-a.y))._round():u.x<e&&(u=new o(e,a.y+(e-a.x)/(u.x-a.x)*(u.y-a.y))._round()),a.y<i&&u.y<i||(a.y<i?a=new o(a.x+(i-a.y)/(u.y-a.y)*(u.x-a.x),i)._round():u.y<i&&(u=new o(a.x+(i-a.y)/(u.y-a.y)*(u.x-a.x),i)._round()),a.x>=r&&u.x>=r||(a.x>=r?a=new o(r,a.y+(r-a.x)/(u.x-a.x)*(u.y-a.y))._round():u.x>=r&&(u=new o(r,a.y+(r-a.x)/(u.x-a.x)*(u.y-a.y))._round()),a.y>=n&&u.y>=n||(a.y>=n?a=new o(a.x+(n-a.y)/(u.y-a.y)*(u.x-a.x),n)._round():u.y>=n&&(u=new o(a.x+(n-a.y)/(u.y-a.y)*(u.x-a.x),n)._round()),c&&a.equals(c[c.length-1])||(c=[a],s.push(c)),c.push(u)))))}}return s}Fr("FeatureIndex",_u,{omit:["rawTileData","sourceLayerCoder"]});class wu extends o{constructor(t,e,i,r){super(t,e),this.angle=i,void 0!==r&&(this.segment=r)}clone(){return new wu(this.x,this.y,this.angle,this.segment)}}function Tu(t,e,i,r,n){if(void 0===e.segment||0===i)return!0;let o=e,s=e.segment+1,a=0;for(;a>-i/2;){if(s--,s<0)return!1;a-=t[s].dist(o),o=t[s]}a+=t[s].dist(t[s+1]),s++;const l=[];let c=0;for(;a<i/2;){const e=t[s],i=t[s+1];if(!i)return!1;let o=t[s-1].angleTo(e)-e.angleTo(i);for(o=Math.abs((o+3*Math.PI)%(2*Math.PI)-Math.PI),l.push({distance:a,angleDelta:o}),c+=o;a-l[0].distance>r;)c-=l.shift().angleDelta;if(c>n)return!1;s++,a+=e.dist(i)}return!0}function Bu(t){let e=0;for(let i=0;i<t.length-1;i++)e+=t[i].dist(t[i+1]);return e}function Eu(t,e,i){return t?.6*e*i:0}function Cu(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function Su(t,e,i,r,n,o){const s=Eu(i,n,o),a=Cu(i,r)*o;let l=0;const c=Bu(t)/2;for(let i=0;i<t.length-1;i++){const r=t[i],n=t[i+1],o=r.dist(n);if(l+o>c){const u=(c-l)/o,h=Ge.number(r.x,n.x,u),d=Ge.number(r.y,n.y,u),p=new wu(h,d,n.angleTo(r),i);return p._round(),!s||Tu(t,p,a,s,e)?p:void 0}l+=o}}function Iu(t,e,i,r,n,o,s,a,l){const c=Eu(r,o,s),u=Cu(r,n),h=u*s,d=0===t[0].x||t[0].x===l||0===t[0].y||t[0].y===l;return e-h<e/4&&(e=h+e/4),Mu(t,d?e/2*a%e:(u/2+2*o)*s*a%e,e,c,i,h,d,!1,l)}function Mu(t,e,i,r,n,o,s,a,l){const c=o/2,u=Bu(t);let h=0,d=e-i,p=[];for(let e=0;e<t.length-1;e++){const s=t[e],a=t[e+1],f=s.dist(a),A=a.angleTo(s);for(;d+i<h+f;){d+=i;const m=(d-h)/f,g=Ge.number(s.x,a.x,m),_=Ge.number(s.y,a.y,m);if(g>=0&&g<l&&_>=0&&_<l&&d-c>=0&&d+c<=u){const i=new wu(g,_,A,e);i._round(),r&&!Tu(t,i,o,r,n)||p.push(i)}}h+=f}return a||p.length||s||(p=Mu(t,h/2,i,r,n,o,s,!0,l)),p}Fr("Anchor",wu);const ku=lc;function Pu(t,e,i,r){const n=[],s=t.image,a=s.pixelRatio,l=s.paddedRect.w-2*ku,c=s.paddedRect.h-2*ku,u=t.right-t.left,h=t.bottom-t.top,d=s.stretchX||[[0,l]],p=s.stretchY||[[0,c]],f=(t,e)=>t+e[1]-e[0],A=d.reduce(f,0),m=p.reduce(f,0),g=l-A,_=c-m;let y=0,v=A,x=0,b=m,w=0,T=g,B=0,E=_;if(s.content&&r){const t=s.content;y=Lu(d,0,t[0]),x=Lu(p,0,t[1]),v=Lu(d,t[0],t[2]),b=Lu(p,t[1],t[3]),w=t[0]-y,B=t[1]-x,T=t[2]-t[0]-v,E=t[3]-t[1]-b}const C=(r,n,l,c)=>{const d=Fu(r.stretch-y,v,u,t.left),p=Du(r.fixed-w,T,r.stretch,A),f=Fu(n.stretch-x,b,h,t.top),g=Du(n.fixed-B,E,n.stretch,m),_=Fu(l.stretch-y,v,u,t.left),C=Du(l.fixed-w,T,l.stretch,A),S=Fu(c.stretch-x,b,h,t.top),I=Du(c.fixed-B,E,c.stretch,m),M=new o(d,f),k=new o(_,f),P=new o(_,S),L=new o(d,S),z=new o(p/a,g/a),F=new o(C/a,I/a),D=e*Math.PI/180;if(D){const t=Math.sin(D),e=Math.cos(D),i=[e,-t,t,e];M._matMult(i),k._matMult(i),L._matMult(i),P._matMult(i)}const R=r.stretch+r.fixed,U=n.stretch+n.fixed;return{tl:M,tr:k,bl:L,br:P,tex:{x:s.paddedRect.x+ku+R,y:s.paddedRect.y+ku+U,w:l.stretch+l.fixed-R,h:c.stretch+c.fixed-U},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:z,pixelOffsetBR:F,minFontScaleX:T/a/u,minFontScaleY:E/a/h,isSDF:i}};if(r&&(s.stretchX||s.stretchY)){const t=zu(d,g,A),e=zu(p,_,m);for(let i=0;i<t.length-1;i++){const r=t[i],o=t[i+1];for(let t=0;t<e.length-1;t++)n.push(C(r,e[t],o,e[t+1]))}}else n.push(C({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:l+1},{fixed:0,stretch:c+1}));return n}function Lu(t,e,i){let r=0;for(const n of t)r+=Math.max(e,Math.min(i,n[1]))-Math.max(e,Math.min(i,n[0]));return r}function zu(t,e,i){const r=[{fixed:-ku,stretch:0}];for(const[e,i]of t){const t=r[r.length-1];r.push({fixed:e-t.stretch,stretch:t.stretch}),r.push({fixed:e-t.stretch,stretch:t.stretch+(i-e)})}return r.push({fixed:e+ku,stretch:i}),r}function Fu(t,e,i,r){return t/e*i+r}function Du(t,e,i,r){return t-e*i/r}class Ru{constructor(t,e,i,r,n,s,a,l,c,u){if(this.boxStartIndex=t.length,c){let t=s.top,e=s.bottom;const i=s.collisionPadding;i&&(t-=i[1],e+=i[3]);let r=e-t;r>0&&(r=Math.max(10,r),this.circleDiameter=r)}else{let c=s.top*a-l[0],h=s.bottom*a+l[2],d=s.left*a-l[3],p=s.right*a+l[1];const f=s.collisionPadding;if(f&&(d-=f[0]*a,c-=f[1]*a,p+=f[2]*a,h+=f[3]*a),u){const t=new o(d,c),e=new o(p,c),i=new o(d,h),r=new o(p,h),n=u*Math.PI/180;t._rotate(n),e._rotate(n),i._rotate(n),r._rotate(n),d=Math.min(t.x,e.x,i.x,r.x),p=Math.max(t.x,e.x,i.x,r.x),c=Math.min(t.y,e.y,i.y,r.y),h=Math.max(t.y,e.y,i.y,r.y)}t.emplaceBack(e.x,e.y,d,c,p,h,i,r,n)}this.boxEndIndex=t.length}}class Uu{constructor(t=[],e=Ou){if(this.data=t,this.length=this.data.length,this.compare=e,this.length>0)for(let t=(this.length>>1)-1;t>=0;t--)this._down(t)}push(t){this.data.push(t),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const t=this.data[0],e=this.data.pop();return this.length--,this.length>0&&(this.data[0]=e,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:e,compare:i}=this,r=e[t];for(;t>0;){const n=t-1>>1,o=e[n];if(i(r,o)>=0)break;e[t]=o,t=n}e[t]=r}_down(t){const{data:e,compare:i}=this,r=this.length>>1,n=e[t];for(;t<r;){let r=1+(t<<1),o=e[r];const s=r+1;if(s<this.length&&i(e[s],o)<0&&(r=s,o=e[s]),i(o,n)>=0)break;e[t]=o,t=r}e[t]=n}}function Ou(t,e){return t<e?-1:t>e?1:0}function Nu(t,e=1,i=!1){let r=1/0,n=1/0,s=-1/0,a=-1/0;const l=t[0];for(let t=0;t<l.length;t++){const e=l[t];(!t||e.x<r)&&(r=e.x),(!t||e.y<n)&&(n=e.y),(!t||e.x>s)&&(s=e.x),(!t||e.y>a)&&(a=e.y)}const c=Math.min(s-r,a-n);let u=c/2;const h=new Uu([],Qu);if(0===c)return new o(r,n);for(let e=r;e<s;e+=c)for(let i=n;i<a;i+=c)h.push(new Vu(e+u,i+u,u,t));let d=function(t){let e=0,i=0,r=0;const n=t[0];for(let t=0,o=n.length,s=o-1;t<o;s=t++){const o=n[t],a=n[s],l=o.x*a.y-a.x*o.y;i+=(o.x+a.x)*l,r+=(o.y+a.y)*l,e+=3*l}return new Vu(i/e,r/e,0,t)}(t),p=h.length;for(;h.length;){const r=h.pop();(r.d>d.d||!d.d)&&(d=r,i&&console.log("found best %d after %d probes",Math.round(1e4*r.d)/1e4,p)),r.max-d.d<=e||(u=r.h/2,h.push(new Vu(r.p.x-u,r.p.y-u,u,t)),h.push(new Vu(r.p.x+u,r.p.y-u,u,t)),h.push(new Vu(r.p.x-u,r.p.y+u,u,t)),h.push(new Vu(r.p.x+u,r.p.y+u,u,t)),p+=4)}return i&&(console.log(`num probes: ${p}`),console.log(`best distance: ${d.d}`)),d.p}function Qu(t,e){return e.max-t.max}function Vu(t,e,i,r){this.p=new o(t,e),this.h=i,this.d=function(t,e){let i=!1,r=1/0;for(let n=0;n<e.length;n++){const o=e[n];for(let e=0,n=o.length,s=n-1;e<n;s=e++){const n=o[e],a=o[s];n.y>t.y!=a.y>t.y&&t.x<(a.x-n.x)*(t.y-n.y)/(a.y-n.y)+n.x&&(i=!i),r=Math.min(r,gs(t,n,a))}}return(i?1:-1)*Math.sqrt(r)}(this.p,r),this.max=this.d+this.h*Math.SQRT2}var ju;t.aq=void 0,(ju=t.aq||(t.aq={}))[ju.center=1]="center",ju[ju.left=2]="left",ju[ju.right=3]="right",ju[ju.top=4]="top",ju[ju.bottom=5]="bottom",ju[ju["top-left"]=6]="top-left",ju[ju["top-right"]=7]="top-right",ju[ju["bottom-left"]=8]="bottom-left",ju[ju["bottom-right"]=9]="bottom-right";const Hu=7,Gu=Number.POSITIVE_INFINITY;function $u(t,e){return e[1]!==Gu?function(t,e,i){let r=0,n=0;switch(e=Math.abs(e),i=Math.abs(i),t){case"top-right":case"top-left":case"top":n=i-Hu;break;case"bottom-right":case"bottom-left":case"bottom":n=-i+Hu}switch(t){case"top-right":case"bottom-right":case"right":r=-e;break;case"top-left":case"bottom-left":case"left":r=e}return[r,n]}(t,e[0],e[1]):function(t,e){let i=0,r=0;e<0&&(e=0);const n=e/Math.SQRT2;switch(t){case"top-right":case"top-left":r=n-Hu;break;case"bottom-right":case"bottom-left":r=-n+Hu;break;case"bottom":r=-e+Hu;break;case"top":r=e-Hu}switch(t){case"top-right":case"bottom-right":i=-n;break;case"top-left":case"bottom-left":i=n;break;case"left":i=e;break;case"right":i=-e}return[i,r]}(t,e[0])}function Zu(t,e,i){var r;const n=t.layout,o=null===(r=n.get("text-variable-anchor-offset"))||void 0===r?void 0:r.evaluate(e,{},i);if(o){const t=o.values,e=[];for(let i=0;i<t.length;i+=2){const r=e[i]=t[i],n=t[i+1].map((t=>t*Pl));r.startsWith("top")?n[1]-=Hu:r.startsWith("bottom")&&(n[1]+=Hu),e[i+1]=n}return new ie(e)}const s=n.get("text-variable-anchor");if(s){let r;r=void 0!==t._unevaluatedLayout.getValue("text-radial-offset")?[n.get("text-radial-offset").evaluate(e,{},i)*Pl,Gu]:n.get("text-offset").evaluate(e,{},i).map((t=>t*Pl));const o=[];for(const t of s)o.push(t,$u(t,r));return new ie(o)}return null}function qu(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Ku(e,i,r,n,o,s,a,l,c,u,h){let d=s.textMaxSize.evaluate(i,{});void 0===d&&(d=a);const p=e.layers[0].layout,f=p.get("icon-offset").evaluate(i,{},h),A=Xu(r.horizontal),m=a/24,g=e.tilePixelRatio*m,_=e.tilePixelRatio*d/24,y=e.tilePixelRatio*l,v=e.tilePixelRatio*p.get("symbol-spacing"),x=p.get("text-padding")*e.tilePixelRatio,b=function(t,e,i,r=1){const n=t.get("icon-padding").evaluate(e,{},i),o=n&&n.values;return[o[0]*r,o[1]*r,o[2]*r,o[3]*r]}(p,i,h,e.tilePixelRatio),T=p.get("text-max-angle")/180*Math.PI,B="viewport"!==p.get("text-rotation-alignment")&&"point"!==p.get("symbol-placement"),E="map"===p.get("icon-rotation-alignment")&&"point"!==p.get("symbol-placement"),C=p.get("symbol-placement"),S=v/2,I=p.get("icon-text-fit");let M;n&&"none"!==I&&(e.allowVerticalPlacement&&r.vertical&&(M=Cc(n,r.vertical,I,p.get("icon-text-fit-padding"),f,m)),A&&(n=Cc(n,A,I,p.get("icon-text-fit-padding"),f,m)));const k=(l,d)=>{d.x<0||d.x>=rs||d.y<0||d.y>=rs||function(e,i,r,n,o,s,a,l,c,u,h,d,p,f,A,m,g,_,y,v,x,b,T,B,E){const C=e.addToLineVertexArray(i,r);let S,I,M,k,P=0,L=0,z=0,F=0,D=-1,R=-1;const U={};let O=Ro("");if(e.allowVerticalPlacement&&n.vertical){const t=l.layout.get("text-rotate").evaluate(x,{},B)+90;M=new Ru(c,i,u,h,d,n.vertical,p,f,A,t),a&&(k=new Ru(c,i,u,h,d,a,g,_,A,t))}if(o){const r=l.layout.get("icon-rotate").evaluate(x,{}),n="none"!==l.layout.get("icon-text-fit"),s=Pu(o,r,T,n),p=a?Pu(a,r,T,n):void 0;I=new Ru(c,i,u,h,d,o,g,_,!1,r),P=4*s.length;const f=e.iconSizeData;let A=null;"source"===f.kind?(A=[Ic*l.layout.get("icon-size").evaluate(x,{})],A[0]>Mc&&w(`${e.layerIds[0]}: Value for "icon-size" is >= ${Sc}. Reduce your "icon-size".`)):"composite"===f.kind&&(A=[Ic*b.compositeIconSizes[0].evaluate(x,{},B),Ic*b.compositeIconSizes[1].evaluate(x,{},B)],(A[0]>Mc||A[1]>Mc)&&w(`${e.layerIds[0]}: Value for "icon-size" is >= ${Sc}. Reduce your "icon-size".`)),e.addSymbols(e.icon,s,A,v,y,x,t.ai.none,i,C.lineStartIndex,C.lineLength,-1,B),D=e.icon.placedSymbolArray.length-1,p&&(L=4*p.length,e.addSymbols(e.icon,p,A,v,y,x,t.ai.vertical,i,C.lineStartIndex,C.lineLength,-1,B),R=e.icon.placedSymbolArray.length-1)}const N=Object.keys(n.horizontal);for(const r of N){const o=n.horizontal[r];if(!S){O=Ro(o.text);const t=l.layout.get("text-rotate").evaluate(x,{},B);S=new Ru(c,i,u,h,d,o,p,f,A,t)}const a=1===o.positionedLines.length;if(z+=Wu(e,i,o,s,l,A,x,m,C,n.vertical?t.ai.horizontal:t.ai.horizontalOnly,a?N:[r],U,D,b,B),a)break}n.vertical&&(F+=Wu(e,i,n.vertical,s,l,A,x,m,C,t.ai.vertical,["vertical"],U,R,b,B));const Q=S?S.boxStartIndex:e.collisionBoxArray.length,V=S?S.boxEndIndex:e.collisionBoxArray.length,j=M?M.boxStartIndex:e.collisionBoxArray.length,H=M?M.boxEndIndex:e.collisionBoxArray.length,G=I?I.boxStartIndex:e.collisionBoxArray.length,$=I?I.boxEndIndex:e.collisionBoxArray.length,Z=k?k.boxStartIndex:e.collisionBoxArray.length,q=k?k.boxEndIndex:e.collisionBoxArray.length;let K=-1;const W=(t,e)=>t&&t.circleDiameter?Math.max(t.circleDiameter,e):e;K=W(S,K),K=W(M,K),K=W(I,K),K=W(k,K);const X=K>-1?1:0;X&&(K*=E/Pl),e.glyphOffsetArray.length>=Nc.MAX_GLYPHS&&w("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==x.sortKey&&e.addToSortKeyRanges(e.symbolInstances.length,x.sortKey);const J=Zu(l,x,B),[Y,tt]=function(e,i){const r=e.length,n=null==i?void 0:i.values;if((null==n?void 0:n.length)>0)for(let i=0;i<n.length;i+=2){const r=n[i+1];e.emplaceBack(t.aq[n[i]],r[0],r[1])}return[r,e.length]}(e.textAnchorOffsets,J);e.symbolInstances.emplaceBack(i.x,i.y,U.right>=0?U.right:-1,U.center>=0?U.center:-1,U.left>=0?U.left:-1,U.vertical||-1,D,R,O,Q,V,j,H,G,$,Z,q,u,z,F,P,L,X,0,p,K,Y,tt)}(e,d,l,r,n,o,M,e.layers[0],e.collisionBoxArray,i.index,i.sourceLayerIndex,e.index,g,[x,x,x,x],B,c,y,b,E,f,i,s,u,h,a)};if("line"===C)for(const t of bu(i.geometry,0,0,rs,rs)){const i=Iu(t,v,T,r.vertical||A,n,24,_,e.overscaling,rs);for(const r of i)A&&Ju(e,A.text,S,r)||k(t,r)}else if("line-center"===C){for(const t of i.geometry)if(t.length>1){const e=Su(t,T,r.vertical||A,n,24,_);e&&k(t,e)}}else if("Polygon"===i.type)for(const t of Ia(i.geometry,0)){const e=Nu(t,16);k(t[0],new wu(e.x,e.y,0))}else if("LineString"===i.type)for(const t of i.geometry)k(t,new wu(t[0].x,t[0].y,0));else if("Point"===i.type)for(const t of i.geometry)for(const e of t)k([e],new wu(e.x,e.y,0))}function Wu(t,e,i,r,n,s,a,l,c,u,h,d,p,f,A){const m=function(t,e,i,r,n,s,a,l){const c=r.layout.get("text-rotate").evaluate(s,{})*Math.PI/180,u=[];for(const t of e.positionedLines)for(const r of t.positionedGlyphs){if(!r.rect)continue;const s=r.rect||{};let h=sc+1,d=!0,p=1,f=0;const A=(n||l)&&r.vertical,m=r.metrics.advance*r.scale/2;if(l&&e.verticalizable&&(f=t.lineOffset/2-(r.imageName?-(Pl-r.metrics.width*r.scale)/2:(r.scale-1)*Pl)),r.imageName){const t=a[r.imageName];d=t.sdf,p=t.pixelRatio,h=lc/p}const g=n?[r.x+m,r.y]:[0,0];let _=n?[0,0]:[r.x+m+i[0],r.y+i[1]-f],y=[0,0];A&&(y=_,_=[0,0]);const v=r.metrics.isDoubleResolution?2:1,x=(r.metrics.left-h)*r.scale-m+_[0],b=(-r.metrics.top-h)*r.scale+_[1],w=x+s.w/v*r.scale/p,T=b+s.h/v*r.scale/p,B=new o(x,b),E=new o(w,b),C=new o(x,T),S=new o(w,T);if(A){const t=new o(-m,m-dc),e=-Math.PI/2,i=Pl/2-m,n=new o(5-dc-i,-(r.imageName?i:0)),s=new o(...y);B._rotateAround(e,t)._add(n)._add(s),E._rotateAround(e,t)._add(n)._add(s),C._rotateAround(e,t)._add(n)._add(s),S._rotateAround(e,t)._add(n)._add(s)}if(c){const t=Math.sin(c),e=Math.cos(c),i=[e,-t,t,e];B._matMult(i),E._matMult(i),C._matMult(i),S._matMult(i)}const I=new o(0,0),M=new o(0,0);u.push({tl:B,tr:E,bl:C,br:S,tex:s,writingMode:e.writingMode,glyphOffset:g,sectionIndex:r.sectionIndex,isSDF:d,pixelOffsetTL:I,pixelOffsetBR:M,minFontScaleX:0,minFontScaleY:0})}return u}(0,i,l,n,s,a,r,t.allowVerticalPlacement),g=t.textSizeData;let _=null;"source"===g.kind?(_=[Ic*n.layout.get("text-size").evaluate(a,{})],_[0]>Mc&&w(`${t.layerIds[0]}: Value for "text-size" is >= ${Sc}. Reduce your "text-size".`)):"composite"===g.kind&&(_=[Ic*f.compositeTextSizes[0].evaluate(a,{},A),Ic*f.compositeTextSizes[1].evaluate(a,{},A)],(_[0]>Mc||_[1]>Mc)&&w(`${t.layerIds[0]}: Value for "text-size" is >= ${Sc}. Reduce your "text-size".`)),t.addSymbols(t.text,m,_,l,s,a,u,e,c.lineStartIndex,c.lineLength,p,A);for(const e of h)d[e]=t.text.placedSymbolArray.length-1;return 4*m.length}function Xu(t){for(const e in t)return t[e];return null}function Ju(t,e,i,r){const n=t.compareText;if(e in n){const t=n[e];for(let e=t.length-1;e>=0;e--)if(r.dist(t[e])<i)return!0}else n[e]=[];return n[e].push(r),!1}const Yu=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class th{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[e,i]=new Uint8Array(t,0,2);if(219!==e)throw new Error("Data does not appear to be in a KDBush format.");const r=i>>4;if(1!==r)throw new Error(`Got v${r} data when expected v1.`);const n=Yu[15&i];if(!n)throw new Error("Unrecognized array type.");const[o]=new Uint16Array(t,2,1),[s]=new Uint32Array(t,4,1);return new th(s,o,n,t)}constructor(t,e=64,i=Float64Array,r){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+e,2),65535),this.ArrayType=i,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const n=Yu.indexOf(this.ArrayType),o=2*t*this.ArrayType.BYTES_PER_ELEMENT,s=t*this.IndexArrayType.BYTES_PER_ELEMENT,a=(8-s%8)%8;if(n<0)throw new Error(`Unexpected typed array class: ${i}.`);r&&r instanceof ArrayBuffer?(this.data=r,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+s+a,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+o+s+a),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+s+a,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+n]),new Uint16Array(this.data,2,1)[0]=e,new Uint32Array(this.data,4,1)[0]=t)}add(t,e){const i=this._pos>>1;return this.ids[i]=i,this.coords[this._pos++]=t,this.coords[this._pos++]=e,i}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return eh(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,e,i,r){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:n,coords:o,nodeSize:s}=this,a=[0,n.length-1,0],l=[];for(;a.length;){const c=a.pop()||0,u=a.pop()||0,h=a.pop()||0;if(u-h<=s){for(let s=h;s<=u;s++){const a=o[2*s],c=o[2*s+1];a>=t&&a<=i&&c>=e&&c<=r&&l.push(n[s])}continue}const d=h+u>>1,p=o[2*d],f=o[2*d+1];p>=t&&p<=i&&f>=e&&f<=r&&l.push(n[d]),(0===c?t<=p:e<=f)&&(a.push(h),a.push(d-1),a.push(1-c)),(0===c?i>=p:r>=f)&&(a.push(d+1),a.push(u),a.push(1-c))}return l}within(t,e,i){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:r,coords:n,nodeSize:o}=this,s=[0,r.length-1,0],a=[],l=i*i;for(;s.length;){const c=s.pop()||0,u=s.pop()||0,h=s.pop()||0;if(u-h<=o){for(let i=h;i<=u;i++)oh(n[2*i],n[2*i+1],t,e)<=l&&a.push(r[i]);continue}const d=h+u>>1,p=n[2*d],f=n[2*d+1];oh(p,f,t,e)<=l&&a.push(r[d]),(0===c?t-i<=p:e-i<=f)&&(s.push(h),s.push(d-1),s.push(1-c)),(0===c?t+i>=p:e+i>=f)&&(s.push(d+1),s.push(u),s.push(1-c))}return a}}function eh(t,e,i,r,n,o){if(n-r<=i)return;const s=r+n>>1;ih(t,e,s,r,n,o),eh(t,e,i,r,s-1,1-o),eh(t,e,i,s+1,n,1-o)}function ih(t,e,i,r,n,o){for(;n>r;){if(n-r>600){const s=n-r+1,a=i-r+1,l=Math.log(s),c=.5*Math.exp(2*l/3),u=.5*Math.sqrt(l*c*(s-c)/s)*(a-s/2<0?-1:1);ih(t,e,i,Math.max(r,Math.floor(i-a*c/s+u)),Math.min(n,Math.floor(i+(s-a)*c/s+u)),o)}const s=e[2*i+o];let a=r,l=n;for(rh(t,e,r,i),e[2*n+o]>s&&rh(t,e,r,n);a<l;){for(rh(t,e,a,l),a++,l--;e[2*a+o]<s;)a++;for(;e[2*l+o]>s;)l--}e[2*r+o]===s?rh(t,e,r,l):(l++,rh(t,e,l,n)),l<=i&&(r=l+1),i<=l&&(n=l-1)}}function rh(t,e,i,r){nh(t,i,r),nh(e,2*i,2*r),nh(e,2*i+1,2*r+1)}function nh(t,e,i){const r=t[e];t[e]=t[i],t[i]=r}function oh(t,e,i,r){const n=t-i,o=e-r;return n*n+o*o}var sh;t.bh=void 0,(sh=t.bh||(t.bh={})).create="create",sh.load="load",sh.fullLoad="fullLoad";let ah=null,lh=[];const ch=1e3/60,uh="loadTime",hh="fullLoadTime",dh={mark(t){performance.mark(t)},frame(t){const e=t;null!=ah&&lh.push(e-ah),ah=e},clearMetrics(){ah=null,lh=[],performance.clearMeasures(uh),performance.clearMeasures(hh);for(const e in t.bh)performance.clearMarks(t.bh[e])},getPerformanceMetrics(){performance.measure(uh,t.bh.create,t.bh.load),performance.measure(hh,t.bh.create,t.bh.fullLoad);const e=performance.getEntriesByName(uh)[0].duration,i=performance.getEntriesByName(hh)[0].duration,r=lh.length,n=1/(lh.reduce(((t,e)=>t+e),0)/r/1e3),o=lh.filter((t=>t>ch)).reduce(((t,e)=>t+(e-ch)/ch),0);return{loadTime:e,fullLoadTime:i,fps:n,percentDroppedFrames:o/(r+o)*100,totalFrames:r}}};t.$=function(t,e,i){var r,n,o,s,a,l,c,u,h,d,p,f,A=i[0],m=i[1],g=i[2];return e===t?(t[12]=e[0]*A+e[4]*m+e[8]*g+e[12],t[13]=e[1]*A+e[5]*m+e[9]*g+e[13],t[14]=e[2]*A+e[6]*m+e[10]*g+e[14],t[15]=e[3]*A+e[7]*m+e[11]*g+e[15]):(n=e[1],o=e[2],s=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=e[8],d=e[9],p=e[10],f=e[11],t[0]=r=e[0],t[1]=n,t[2]=o,t[3]=s,t[4]=a,t[5]=l,t[6]=c,t[7]=u,t[8]=h,t[9]=d,t[10]=p,t[11]=f,t[12]=r*A+a*m+h*g+e[12],t[13]=n*A+l*m+d*g+e[13],t[14]=o*A+c*m+p*g+e[14],t[15]=s*A+u*m+f*g+e[15]),t},t.A=Ss,t.B=Ge,t.C=class{constructor(t,e,i){this.receive=t=>{const e=t.data,i=e.id;if(i&&(!e.targetMapId||this.mapId===e.targetMapId))if("<cancel>"===e.type){delete this.tasks[i];const t=this.cancelCallbacks[i];delete this.cancelCallbacks[i],t&&t()}else E()||e.mustQueue?(this.tasks[i]=e,this.taskQueue.push(i),this.invoker.trigger()):this.processTask(i,e)},this.process=()=>{if(!this.taskQueue.length)return;const t=this.taskQueue.shift(),e=this.tasks[t];delete this.tasks[t],this.taskQueue.length&&this.invoker.trigger(),e&&this.processTask(t,e)},this.target=t,this.parent=e,this.mapId=i,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},this.invoker=new Yc(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=E()?t:window}send(t,e,i,r,n=!1){const o=Math.round(1e18*Math.random()).toString(36).substring(0,10);i&&(this.callbacks[o]=i);const s=[],a={id:o,type:t,hasCallback:!!i,targetMapId:r,mustQueue:n,sourceMapId:this.mapId,data:Rr(e,s)};return this.target.postMessage(a,{transfer:s}),{cancel:()=>{i&&delete this.callbacks[o],this.target.postMessage({id:o,type:"<cancel>",targetMapId:r,sourceMapId:this.mapId})}}}processTask(t,e){if("<response>"===e.type){const i=this.callbacks[t];delete this.callbacks[t],i&&(e.error?i(Ur(e.error)):i(null,Ur(e.data)))}else{let i=!1;const r=[],n=e.hasCallback?(e,n)=>{i=!0,delete this.cancelCallbacks[t];const o={id:t,type:"<response>",sourceMapId:this.mapId,error:e?Rr(e):null,data:Rr(n,r)};this.target.postMessage(o,{transfer:r})}:t=>{i=!0};let o=null;const s=Ur(e.data);if(this.parent[e.type])o=this.parent[e.type](e.sourceMapId,s,n);else if("getWorkerSource"in this.parent){const t=e.type.split(".");o=this.parent.getWorkerSource(e.sourceMapId,t[0],s.source)[t[1]](s,n)}else n(new Error(`Could not find function ${e.type}`));!i&&o&&o.cancel&&(this.cancelCallbacks[t]=o.cancel)}}remove(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)}},t.D=gn,t.E=q,t.F=function(t,e){const i={};for(let r=0;r<e.length;r++){const n=e[r];n in t&&(i[n]=t[n])}return i},t.G=nu,t.H=ou,t.I=cc,t.J=h,t.K=d,t.L=eu,t.M=M,t.N=rs,t.O=pu,t.P=o,t.Q=Sn,t.R=js,t.S=So,t.T=hn,t.U=cu,t.V=class extends Pn{},t.W=hu,t.X=function(t,e){const i=window.document.createElement("video");i.muted=!0,i.onloadstart=function(){e(null,i)};for(let e=0;e<t.length;e++){const r=window.document.createElement("source");j(t[e])||(i.crossOrigin="Anonymous"),r.src=t[e],i.appendChild(r)}return{cancel:()=>{}}},t.Y=at,t.Z=function(){var t=new Ss(16);return Ss!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},t._=e,t.a=S,t.a$=class extends Xn{},t.a0=function(t,e,i){var r=i[0],n=i[1],o=i[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},t.a1=Ms,t.a2=function(){return _++},t.a3=to,t.a4=Nc,t.a5=function(){an.isLoading()||an.isLoaded()||"deferred"!==on()||sn()},t.a6=Hi,t.a7=as,t.a8=ln,t.a9=gu,t.aA=en,t.aB=function(t){t=t.slice();const e=Object.create(null);for(let i=0;i<t.length;i++)e[t[i].id]=t[i];for(let i=0;i<t.length;i++)"ref"in t[i]&&(t[i]=X(t[i],e[t[i].ref]));return t},t.aC=function(t){if("custom"===t.type)return new Jc(t);switch(t.type){case"background":return new qc(t);case"circle":return new zs(t);case"fill":return new Ra(t);case"fill-extrusion":return new al(t);case"heatmap":return new Gs(t);case"hillshade":return new qs(t);case"line":return new wl(t);case"raster":return new Xc(t);case"symbol":return new Gc(t)}},t.aD=x,t.aE=function(t,e){if(!t)return[{command:Y.setStyle,args:[e]}];let i=[];try{if(!J(t.version,e.version))return[{command:Y.setStyle,args:[e]}];J(t.center,e.center)||i.push({command:Y.setCenter,args:[e.center]}),J(t.zoom,e.zoom)||i.push({command:Y.setZoom,args:[e.zoom]}),J(t.bearing,e.bearing)||i.push({command:Y.setBearing,args:[e.bearing]}),J(t.pitch,e.pitch)||i.push({command:Y.setPitch,args:[e.pitch]}),J(t.sprite,e.sprite)||i.push({command:Y.setSprite,args:[e.sprite]}),J(t.glyphs,e.glyphs)||i.push({command:Y.setGlyphs,args:[e.glyphs]}),J(t.transition,e.transition)||i.push({command:Y.setTransition,args:[e.transition]}),J(t.light,e.light)||i.push({command:Y.setLight,args:[e.light]});const r={},n=[];!function(t,e,i,r){let n;for(n in e=e||{},t=t||{})Object.prototype.hasOwnProperty.call(t,n)&&(Object.prototype.hasOwnProperty.call(e,n)||et(n,i,r));for(n in e)Object.prototype.hasOwnProperty.call(e,n)&&(Object.prototype.hasOwnProperty.call(t,n)?J(t[n],e[n])||("geojson"===t[n].type&&"geojson"===e[n].type&&rt(t,e,n)?i.push({command:Y.setGeoJSONSourceData,args:[n,e[n].data]}):it(n,e,i,r)):tt(n,e,i))}(t.sources,e.sources,n,r);const o=[];t.layers&&t.layers.forEach((t=>{r[t.source]?i.push({command:Y.removeLayer,args:[t.id]}):o.push(t)})),i=i.concat(n),function(t,e,i){e=e||[];const r=(t=t||[]).map(ot),n=e.map(ot),o=t.reduce(st,{}),s=e.reduce(st,{}),a=r.slice(),l=Object.create(null);let c,u,h,d,p,f,A;for(c=0,u=0;c<r.length;c++)h=r[c],Object.prototype.hasOwnProperty.call(s,h)?u++:(i.push({command:Y.removeLayer,args:[h]}),a.splice(a.indexOf(h,u),1));for(c=0,u=0;c<n.length;c++)h=n[n.length-1-c],a[a.length-1-c]!==h&&(Object.prototype.hasOwnProperty.call(o,h)?(i.push({command:Y.removeLayer,args:[h]}),a.splice(a.lastIndexOf(h,a.length-u),1)):u++,f=a[a.length-c],i.push({command:Y.addLayer,args:[s[h],f]}),a.splice(a.length-c,0,h),l[h]=!0);for(c=0;c<n.length;c++)if(h=n[c],d=o[h],p=s[h],!l[h]&&!J(d,p))if(J(d.source,p.source)&&J(d["source-layer"],p["source-layer"])&&J(d.type,p.type)){for(A in nt(d.layout,p.layout,i,h,null,Y.setLayoutProperty),nt(d.paint,p.paint,i,h,null,Y.setPaintProperty),J(d.filter,p.filter)||i.push({command:Y.setFilter,args:[h,p.filter]}),J(d.minzoom,p.minzoom)&&J(d.maxzoom,p.maxzoom)||i.push({command:Y.setLayerZoomRange,args:[h,p.minzoom,p.maxzoom]}),d)Object.prototype.hasOwnProperty.call(d,A)&&"layout"!==A&&"paint"!==A&&"filter"!==A&&"metadata"!==A&&"minzoom"!==A&&"maxzoom"!==A&&(0===A.indexOf("paint.")?nt(d[A],p[A],i,h,A.slice(6),Y.setPaintProperty):J(d[A],p[A])||i.push({command:Y.setLayerProperty,args:[h,A,p[A]]}));for(A in p)Object.prototype.hasOwnProperty.call(p,A)&&!Object.prototype.hasOwnProperty.call(d,A)&&"layout"!==A&&"paint"!==A&&"filter"!==A&&"metadata"!==A&&"minzoom"!==A&&"maxzoom"!==A&&(0===A.indexOf("paint.")?nt(d[A],p[A],i,h,A.slice(6),Y.setPaintProperty):J(d[A],p[A])||i.push({command:Y.setLayerProperty,args:[h,A,p[A]]}))}else i.push({command:Y.removeLayer,args:[h]}),f=a[a.lastIndexOf(h)+1],i.push({command:Y.addLayer,args:[p,f]})}(o,e.layers,i)}catch(t){console.warn("Unable to compute style diff:",t),i=[{command:Y.setStyle,args:[e]}]}return i},t.aF=function(t){const e=[],i=t.id;return void 0===i&&e.push({message:`layers.${i}: missing required property "id"`}),void 0===t.render&&e.push({message:`layers.${i}: missing required method "render"`}),t.renderingMode&&"2d"!==t.renderingMode&&"3d"!==t.renderingMode&&e.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),e},t.aG=function t(e,i){if(Array.isArray(e)){if(!Array.isArray(i)||e.length!==i.length)return!1;for(let r=0;r<e.length;r++)if(!t(e[r],i[r]))return!1;return!0}if("object"==typeof e&&null!==e&&null!==i){if("object"!=typeof i)return!1;if(Object.keys(e).length!==Object.keys(i).length)return!1;for(const r in e)if(!t(e[r],i[r]))return!1;return!0}return e===i},t.aH=y,t.aI=v,t.aJ=nn,t.aK=function(t){return t({pluginStatus:Yr,pluginURL:tn}),nn.on("pluginStateChange",t),t},t.aL=class extends Vo{constructor(t,e){super(t,e),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1i(this.location,t))}},t.aM=jo,t.aN=class extends Vo{constructor(t,e){super(t,e),this.current=$o}set(t){if(t[12]!==this.current[12]||t[0]!==this.current[0])return this.current=t,void this.gl.uniformMatrix4fv(this.location,!1,t);for(let e=1;e<16;e++)if(t[e]!==this.current[e]){this.current=t,this.gl.uniformMatrix4fv(this.location,!1,t);break}}},t.aO=Ho,t.aP=class extends Vo{constructor(t,e){super(t,e),this.current=[0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]||(this.current=t,this.gl.uniform3f(this.location,t[0],t[1],t[2]))}},t.aQ=class extends Vo{constructor(t,e){super(t,e),this.current=[0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]||(this.current=t,this.gl.uniform2f(this.location,t[0],t[1]))}},t.aR=Go,t.aS=function(t,e,i,r,n,o,s){var a=1/(e-i),l=1/(r-n),c=1/(o-s);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(e+i)*a,t[13]=(n+r)*l,t[14]=(s+o)*c,t[15]=1,t},t.aT=Wt,t.aU=Ps,t.aV=class extends Vn{},t.aW=Il,t.aX=class extends Hn{},t.aY=function(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},t.aZ=Hs,t.a_=ho,t.aa=function(t){const e={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((t,i,r,n)=>{const o=r||n;return e[i]=!o||o.toLowerCase(),""})),e["max-age"]){const t=parseInt(e["max-age"],10);isNaN(t)?delete e["max-age"]:e["max-age"]=t}return e},t.ab=function(t,e){const i=[];for(const r in t)r in e||i.push(r);return i},t.ac=function(t){if(null==C){const e=t.navigator?t.navigator.userAgent:null;C=!!t.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return C},t.ad=A,t.ae=function(t,e,i){var r=Math.sin(i),n=Math.cos(i),o=e[0],s=e[1],a=e[2],l=e[3],c=e[4],u=e[5],h=e[6],d=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*n+c*r,t[1]=s*n+u*r,t[2]=a*n+h*r,t[3]=l*n+d*r,t[4]=c*n-o*r,t[5]=u*n-s*r,t[6]=h*n-a*r,t[7]=d*n-l*r,t},t.af=function(t){var e=new Ss(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},t.ag=Ls,t.ah=function(t,e){let i=0,r=0;if("constant"===t.kind)r=t.layoutSize;else if("source"!==t.kind){const{interpolationType:n,minZoom:o,maxZoom:s}=t,a=n?A($e.interpolationFactor(n,e,o,s),0,1):0;"camera"===t.kind?r=Ge.number(t.minSize,t.maxSize,a):i=a}return{uSizeT:i,uSize:r}},t.aj=function(t,{uSize:e,uSizeT:i},{lowerSize:r,upperSize:n}){return"source"===t.kind?r/Ic:"composite"===t.kind?Ge.number(r/Ic,n/Ic,i):e},t.ak=Dc,t.al=function(t,e,i,r){const n=e.y-t.y,s=e.x-t.x,a=r.y-i.y,l=r.x-i.x,c=a*s-l*n;if(0===c)return null;const u=(l*(t.y-i.y)-a*(t.x-i.x))/c;return new o(t.x+u*s,t.y+u*n)},t.am=bu,t.an=us,t.ao=Is,t.ap=Pl,t.ar=Pc,t.as=function(t,e){var i=e[0],r=e[1],n=e[2],o=e[3],s=e[4],a=e[5],l=e[6],c=e[7],u=e[8],h=e[9],d=e[10],p=e[11],f=e[12],A=e[13],m=e[14],g=e[15],_=i*a-r*s,y=i*l-n*s,v=i*c-o*s,x=r*l-n*a,b=r*c-o*a,w=n*c-o*l,T=u*A-h*f,B=u*m-d*f,E=u*g-p*f,C=h*m-d*A,S=h*g-p*A,I=d*g-p*m,M=_*I-y*S+v*C+x*E-b*B+w*T;return M?(t[0]=(a*I-l*S+c*C)*(M=1/M),t[1]=(n*S-r*I-o*C)*M,t[2]=(A*w-m*b+g*x)*M,t[3]=(d*b-h*w-p*x)*M,t[4]=(l*E-s*I-c*B)*M,t[5]=(i*I-n*E+o*B)*M,t[6]=(m*v-f*w-g*y)*M,t[7]=(u*w-d*v+p*y)*M,t[8]=(s*S-a*E+c*T)*M,t[9]=(r*E-i*S-o*T)*M,t[10]=(f*b-A*v+g*_)*M,t[11]=(h*v-u*b-p*_)*M,t[12]=(a*B-s*C-l*T)*M,t[13]=(i*C-r*B+n*T)*M,t[14]=(A*y-f*x-m*_)*M,t[15]=(u*x-h*y+d*_)*M,t):null},t.at=qu,t.au=Tc,t.av=th,t.aw=function(){const t={},e=K.$version;for(const i in K.$root){const r=K.$root[i];if(r.required){let n=null;n="version"===i?e:"array"===r.type?[]:{},null!=n&&(t[i]=n)}}return t},t.ax=Y,t.ay=Or,t.az=U,t.b=function(t,e){const i=new Blob([new Uint8Array(t)],{type:"image/png"});createImageBitmap(i).then((t=>{e(null,t)})).catch((t=>{e(new Error(`Could not load image because of ${t.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))}))},t.b0=To,t.b1=function(t,e){var i=t[0],r=t[1],n=t[2],o=t[3],s=t[4],a=t[5],l=t[6],c=t[7],u=t[8],h=t[9],d=t[10],p=t[11],f=t[12],A=t[13],m=t[14],g=t[15],_=e[0],y=e[1],v=e[2],x=e[3],b=e[4],w=e[5],T=e[6],B=e[7],E=e[8],C=e[9],S=e[10],I=e[11],M=e[12],k=e[13],P=e[14],L=e[15];return Math.abs(i-_)<=Cs*Math.max(1,Math.abs(i),Math.abs(_))&&Math.abs(r-y)<=Cs*Math.max(1,Math.abs(r),Math.abs(y))&&Math.abs(n-v)<=Cs*Math.max(1,Math.abs(n),Math.abs(v))&&Math.abs(o-x)<=Cs*Math.max(1,Math.abs(o),Math.abs(x))&&Math.abs(s-b)<=Cs*Math.max(1,Math.abs(s),Math.abs(b))&&Math.abs(a-w)<=Cs*Math.max(1,Math.abs(a),Math.abs(w))&&Math.abs(l-T)<=Cs*Math.max(1,Math.abs(l),Math.abs(T))&&Math.abs(c-B)<=Cs*Math.max(1,Math.abs(c),Math.abs(B))&&Math.abs(u-E)<=Cs*Math.max(1,Math.abs(u),Math.abs(E))&&Math.abs(h-C)<=Cs*Math.max(1,Math.abs(h),Math.abs(C))&&Math.abs(d-S)<=Cs*Math.max(1,Math.abs(d),Math.abs(S))&&Math.abs(p-I)<=Cs*Math.max(1,Math.abs(p),Math.abs(I))&&Math.abs(f-M)<=Cs*Math.max(1,Math.abs(f),Math.abs(M))&&Math.abs(A-k)<=Cs*Math.max(1,Math.abs(A),Math.abs(k))&&Math.abs(m-P)<=Cs*Math.max(1,Math.abs(m),Math.abs(P))&&Math.abs(g-L)<=Cs*Math.max(1,Math.abs(g),Math.abs(L))},t.b2=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},t.b3=function(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t[3]=e[3]*i[3],t},t.b4=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},t.b5=m,t.b6=du,t.b7=su,t.b8=function(t,e,i,r,n){var o,s=1/Math.tan(e/2);return t[0]=s/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=n&&n!==1/0?(t[10]=(n+r)*(o=1/(r-n)),t[14]=2*n*r*o):(t[10]=-1,t[14]=-2*r),t},t.b9=function(t,e,i){var r=Math.sin(i),n=Math.cos(i),o=e[4],s=e[5],a=e[6],l=e[7],c=e[8],u=e[9],h=e[10],d=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=o*n+c*r,t[5]=s*n+u*r,t[6]=a*n+h*r,t[7]=l*n+d*r,t[8]=c*n-o*r,t[9]=u*n-s*r,t[10]=h*n-a*r,t[11]=d*n-l*r,t},t.bA=r,t.bB=Ll,t.bC=Di,t.bD=an,t.ba=p,t.bb=f,t.bc=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},t.bd=class extends kn{},t.be=tu,t.bf=au,t.bg=dh,t.bi=R,t.bj=function(t,e,i=!1){if(Yr===Kr||Yr===Wr||Yr===Xr)throw new Error("setRTLTextPlugin cannot be called multiple times.");tn=F.resolveURL(t),Yr=Kr,Jr=e,rn(),i||sn()},t.bk=on,t.bl=function(t,e){const i={};for(let r=0;r<t.length;r++){const n=e&&e[t[r].id]||Yi(t[r]);e&&(e[t[r].id]=n);let o=i[n];o||(o=i[n]=[]),o.push(t[r])}const r=[];for(const t in i)r.push(i[t]);return r},t.bm=Fr,t.bn=mu,t.bo=_u,t.bp=uc,t.bq=function(e){e.bucket.createArrays(),e.bucket.tilePixelRatio=rs/(512*e.bucket.overscaling),e.bucket.compareText={},e.bucket.iconsNeedLinear=!1;const i=e.bucket.layers[0],r=i.layout,n=i._unevaluatedLayout._values,o={layoutIconSize:n["icon-size"].possiblyEvaluate(new ln(e.bucket.zoom+1),e.canonical),layoutTextSize:n["text-size"].possiblyEvaluate(new ln(e.bucket.zoom+1),e.canonical),textMaxSize:n["text-size"].possiblyEvaluate(new ln(18))};if("composite"===e.bucket.textSizeData.kind){const{minZoom:t,maxZoom:i}=e.bucket.textSizeData;o.compositeTextSizes=[n["text-size"].possiblyEvaluate(new ln(t),e.canonical),n["text-size"].possiblyEvaluate(new ln(i),e.canonical)]}if("composite"===e.bucket.iconSizeData.kind){const{minZoom:t,maxZoom:i}=e.bucket.iconSizeData;o.compositeIconSizes=[n["icon-size"].possiblyEvaluate(new ln(t),e.canonical),n["icon-size"].possiblyEvaluate(new ln(i),e.canonical)]}const s=r.get("text-line-height")*Pl,a="viewport"!==r.get("text-rotation-alignment")&&"point"!==r.get("symbol-placement"),l=r.get("text-keep-upright"),c=r.get("text-size");for(const n of e.bucket.features){const u=r.get("text-font").evaluate(n,{},e.canonical).join(","),h=c.evaluate(n,{},e.canonical),d=o.layoutTextSize.evaluate(n,{},e.canonical),p=o.layoutIconSize.evaluate(n,{},e.canonical),f={horizontal:{},vertical:void 0},A=n.text;let m,g=[0,0];if(A){const o=A.toString(),c=r.get("text-letter-spacing").evaluate(n,{},e.canonical)*Pl,p=Vr(o)?c:0,m=r.get("text-anchor").evaluate(n,{},e.canonical),_=Zu(i,n,e.canonical);if(!_){const t=r.get("text-radial-offset").evaluate(n,{},e.canonical);g=t?$u(m,[t*Pl,Gu]):r.get("text-offset").evaluate(n,{},e.canonical).map((t=>t*Pl))}let y=a?"center":r.get("text-justify").evaluate(n,{},e.canonical);const v=r.get("symbol-placement"),x="point"===v?r.get("text-max-width").evaluate(n,{},e.canonical)*Pl:0,b=()=>{e.bucket.allowVerticalPlacement&&Qr(o)&&(f.vertical=Ac(A,e.glyphMap,e.glyphPositions,e.imagePositions,u,x,s,m,"left",p,g,t.ai.vertical,!0,v,d,h))};if(!a&&_){const i=new Set;if("auto"===y)for(let t=0;t<_.values.length;t+=2)i.add(qu(_.values[t]));else i.add(y);let r=!1;for(const n of i)if(!f.horizontal[n])if(r)f.horizontal[n]=f.horizontal[0];else{const i=Ac(A,e.glyphMap,e.glyphPositions,e.imagePositions,u,x,s,"center",n,p,g,t.ai.horizontal,!1,v,d,h);i&&(f.horizontal[n]=i,r=1===i.positionedLines.length)}b()}else{"auto"===y&&(y=qu(m));const i=Ac(A,e.glyphMap,e.glyphPositions,e.imagePositions,u,x,s,m,y,p,g,t.ai.horizontal,!1,v,d,h);i&&(f.horizontal[y]=i),b(),Qr(o)&&a&&l&&(f.vertical=Ac(A,e.glyphMap,e.glyphPositions,e.imagePositions,u,x,s,m,y,p,g,t.ai.vertical,!1,v,d,h))}}let _=!1;if(n.icon&&n.icon.name){const t=e.imageMap[n.icon.name];t&&(m=Ec(e.imagePositions[n.icon.name],r.get("icon-offset").evaluate(n,{},e.canonical),r.get("icon-anchor").evaluate(n,{},e.canonical)),_=!!t.sdf,void 0===e.bucket.sdfIcons?e.bucket.sdfIcons=_:e.bucket.sdfIcons!==_&&w("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(t.pixelRatio!==e.bucket.pixelRatio||0!==r.get("icon-rotate").constantOr(1))&&(e.bucket.iconsNeedLinear=!0))}const y=Xu(f.horizontal)||f.vertical;e.bucket.iconsInText=!!y&&y.iconsInText,(y||m)&&Ku(e.bucket,n,f,m,e.imageMap,o,d,p,g,_,e.canonical)}e.showCollisionBoxes&&e.bucket.generateCollisionDebugBuffers()},t.br=gl,t.bs=La,t.bt=il,t.bu=class{constructor(t){this._marks={start:[t.url,"start"].join("#"),end:[t.url,"end"].join("#"),measure:t.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let t=performance.getEntriesByName(this._marks.measure);return 0===t.length&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),t=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),t}},t.bv=ec,t.bw=Qa,t.bx=function(t,i,r,n,o){return e(this,void 0,void 0,(function*(){if(d())try{return yield M(t,i,r,n,o)}catch(t){}return function(t,e,i,r,n){const o=t.width,s=t.height;k&&P||(k=new OffscreenCanvas(o,s),P=k.getContext("2d",{willReadFrequently:!0})),k.width=o,k.height=s,P.drawImage(t,0,0,o,s);const a=P.getImageData(e,i,r,n);return P.clearRect(0,0,o,s),a.data}(t,i,r,n,o)}))},t.by=Au,t.bz=i,t.c=D,t.d=function(t,e){const i=new Image;i.onload=()=>{e(null,i),URL.revokeObjectURL(i.src),i.onload=null,window.requestAnimationFrame((()=>{i.src=I}))},i.onerror=()=>e(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const r=new Blob([new Uint8Array(t)],{type:"image/png"});i.src=t.byteLength?URL.createObjectURL(r):I},t.e=g,t.f=function(t,e){return Q(g(t,{type:"json"}),e)},t.g=O,t.h=F,t.i=E,t.j=Z,t.k=$,t.l=V,t.m=Q,t.n=function(t){return new ec(t).readFields(rc,[])},t.o=function(t,e,i){if(!t.length)return i(null,[]);let r=t.length;const n=new Array(t.length);let o=null;t.forEach(((t,s)=>{e(t,((t,e)=>{t&&(o=t),n[s]=e,0==--r&&i(o,n)}))}))},t.p=ac,t.q=Vs,t.r=bn,t.s=j,t.t=Ir,t.u=Nr,t.v=K,t.w=w,t.x=Pr,t.y=Sr,t.z=function([t,e,i]){return e+=90,e*=Math.PI/180,i*=Math.PI/180,{x:t*Math.cos(e)*Math.sin(i),y:t*Math.sin(e)*Math.sin(i),z:t*Math.cos(i)}}})),r(["./shared"],(function(t){class e{constructor(t){this.keyCache={},t&&this.replace(t)}replace(t){this._layerConfigs={},this._layers={},this.update(t,[])}update(e,i){for(const i of e){this._layerConfigs[i.id]=i;const e=this._layers[i.id]=t.aC(i);e._featureFilter=t.a6(e.filter),this.keyCache[i.id]&&delete this.keyCache[i.id]}for(const t of i)delete this.keyCache[t],delete this._layerConfigs[t],delete this._layers[t];this.familiesBySource={};const r=t.bl(Object.values(this._layerConfigs),this.keyCache);for(const t of r){const e=t.map((t=>this._layers[t.id])),i=e[0];if("none"===i.visibility)continue;const r=i.source||"";let n=this.familiesBySource[r];n||(n=this.familiesBySource[r]={});const o=i.sourceLayer||"_geojsonTileLayer";let s=n[o];s||(s=n[o]=[]),s.push(e)}}}class i{constructor(e){const i={},r=[];for(const t in e){const n=e[t],o=i[t]={};for(const t in n){const e=n[+t];if(!e||0===e.bitmap.width||0===e.bitmap.height)continue;const i={x:0,y:0,w:e.bitmap.width+2,h:e.bitmap.height+2};r.push(i),o[t]={rect:i,metrics:e.metrics}}}const{w:n,h:o}=t.p(r),s=new t.q({width:n||1,height:o||1});for(const r in e){const n=e[r];for(const e in n){const o=n[+e];if(!o||0===o.bitmap.width||0===o.bitmap.height)continue;const a=i[r][e].rect;t.q.copy(o.bitmap,s,{x:0,y:0},{x:a.x+1,y:a.y+1},o.bitmap)}}this.image=s,this.positions=i}}t.bm("GlyphAtlas",i);class r{constructor(e){this.tileID=new t.O(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.uid=e.uid,this.zoom=e.zoom,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId,this.inFlightDependencies=[],this.dependencySentinel=-1}parse(e,r,o,s,a){this.status="parsing",this.data=e,this.collisionBoxArray=new t.a3;const l=new t.bn(Object.keys(e.layers).sort()),c=new t.bo(this.tileID,this.promoteId);c.bucketLayerIDs=[];const u={},h={featureIndex:c,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:o},d=r.familiesBySource[this.source];for(const i in d){const r=e.layers[i];if(!r)continue;1===r.version&&t.w(`Vector tile source "${this.source}" layer "${i}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const s=l.encode(i),a=[];for(let t=0;t<r.length;t++){const e=r.feature(t),n=c.getId(e,i);a.push({feature:e,id:n,index:t,sourceLayerIndex:s})}for(const e of d[i]){const i=e[0];i.source!==this.source&&t.w(`layer.source = ${i.source} does not equal this.source = ${this.source}`),i.minzoom&&this.zoom<Math.floor(i.minzoom)||i.maxzoom&&this.zoom>=i.maxzoom||"none"!==i.visibility&&(n(e,this.zoom,o),(u[i.id]=i.createBucket({index:c.bucketLayerIDs.length,layers:e,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:s,sourceID:this.source})).populate(a,h,this.tileID.canonical),c.bucketLayerIDs.push(e.map((t=>t.id))))}}let p,f,A,m;const g=t.aH(h.glyphDependencies,(t=>Object.keys(t).map(Number)));this.inFlightDependencies.forEach((t=>null==t?void 0:t.cancel())),this.inFlightDependencies=[];const _=++this.dependencySentinel;Object.keys(g).length?this.inFlightDependencies.push(s.send("getGlyphs",{uid:this.uid,stacks:g,source:this.source,tileID:this.tileID,type:"glyphs"},((t,e)=>{_===this.dependencySentinel&&(p||(p=t,f=e,x.call(this)))}))):f={};const y=Object.keys(h.iconDependencies);y.length?this.inFlightDependencies.push(s.send("getImages",{icons:y,source:this.source,tileID:this.tileID,type:"icons"},((t,e)=>{_===this.dependencySentinel&&(p||(p=t,A=e,x.call(this)))}))):A={};const v=Object.keys(h.patternDependencies);function x(){if(p)return a(p);if(f&&A&&m){const e=new i(f),r=new t.bp(A,m);for(const i in u){const s=u[i];s instanceof t.a4?(n(s.layers,this.zoom,o),t.bq({bucket:s,glyphMap:f,glyphPositions:e.positions,imageMap:A,imagePositions:r.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):s.hasPattern&&(s instanceof t.br||s instanceof t.bs||s instanceof t.bt)&&(n(s.layers,this.zoom,o),s.addFeatures(h,this.tileID.canonical,r.patternPositions))}this.status="done",a(null,{buckets:Object.values(u).filter((t=>!t.isEmpty())),featureIndex:c,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:e.image,imageAtlas:r,glyphMap:this.returnDependencies?f:null,iconMap:this.returnDependencies?A:null,glyphPositions:this.returnDependencies?e.positions:null})}}v.length?this.inFlightDependencies.push(s.send("getImages",{icons:v,source:this.source,tileID:this.tileID,type:"patterns"},((t,e)=>{_===this.dependencySentinel&&(p||(p=t,m=e,x.call(this)))}))):m={},x.call(this)}}function n(e,i,r){const n=new t.a8(i);for(const t of e)t.recalculate(n,r)}function o(e,i){const r=t.l(e.request,((r,n,o,s)=>{if(r)i(r);else if(n)try{const e=new t.bw.VectorTile(new t.bv(n));i(null,{vectorTile:e,rawData:n,cacheControl:o,expires:s})}catch(t){const r=new Uint8Array(n);let o=`Unable to parse the tile at ${e.request.url}, `;o+=31===r[0]&&139===r[1]?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${t.messge}`,i(new Error(o))}}));return()=>{r.cancel(),i()}}class s{constructor(t,e,i,r){this.actor=t,this.layerIndex=e,this.availableImages=i,this.loadVectorData=r||o,this.fetching={},this.loading={},this.loaded={}}loadTile(e,i){const n=e.uid;this.loading||(this.loading={});const o=!!(e&&e.request&&e.request.collectResourceTiming)&&new t.bu(e.request),s=this.loading[n]=new r(e);s.abort=this.loadVectorData(e,((e,r)=>{if(delete this.loading[n],e||!r)return s.status="done",this.loaded[n]=s,i(e);const a=r.rawData,l={};r.expires&&(l.expires=r.expires),r.cacheControl&&(l.cacheControl=r.cacheControl);const c={};if(o){const t=o.finish();t&&(c.resourceTiming=JSON.parse(JSON.stringify(t)))}s.vectorTile=r.vectorTile,s.parse(r.vectorTile,this.layerIndex,this.availableImages,this.actor,((e,r)=>{if(delete this.fetching[n],e||!r)return i(e);i(null,t.e({rawTileData:a.slice(0)},r,l,c))})),this.loaded=this.loaded||{},this.loaded[n]=s,this.fetching[n]={rawTileData:a,cacheControl:l,resourceTiming:c}}))}reloadTile(e,i){const r=this.loaded,n=e.uid;if(r&&r[n]){const o=r[n];o.showCollisionBoxes=e.showCollisionBoxes,"parsing"===o.status?o.parse(o.vectorTile,this.layerIndex,this.availableImages,this.actor,((e,r)=>{if(e||!r)return i(e,r);let o;if(this.fetching[n]){const{rawTileData:e,cacheControl:i,resourceTiming:s}=this.fetching[n];delete this.fetching[n],o=t.e({rawTileData:e.slice(0)},r,i,s)}else o=r;i(null,o)})):"done"===o.status&&(o.vectorTile?o.parse(o.vectorTile,this.layerIndex,this.availableImages,this.actor,i):i())}}abortTile(t,e){const i=this.loading,r=t.uid;i&&i[r]&&i[r].abort&&(i[r].abort(),delete i[r]),e()}removeTile(t,e){const i=this.loaded,r=t.uid;i&&i[r]&&delete i[r],e()}}class a{constructor(){this.loaded={}}loadTile(e,i){return t._(this,void 0,void 0,(function*(){const{uid:r,encoding:n,rawImageData:o,redFactor:s,greenFactor:a,blueFactor:l,baseShift:c}=e,u=o.width+2,h=o.height+2,d=t.a(o)?new t.R({width:u,height:h},yield t.bx(o,-1,-1,u,h)):o,p=new t.by(r,d,n,s,a,l,c);this.loaded=this.loaded||{},this.loaded[r]=p,i(null,p)}))}removeTile(t){const e=this.loaded,i=t.uid;e&&e[i]&&delete e[i]}}function l(t,e){if(0!==t.length){c(t[0],e);for(var i=1;i<t.length;i++)c(t[i],!e)}}function c(t,e){for(var i=0,r=0,n=0,o=t.length,s=o-1;n<o;s=n++){var a=(t[n][0]-t[s][0])*(t[s][1]+t[n][1]),l=i+a;r+=Math.abs(i)>=Math.abs(a)?i-l+a:a-l+i,i=l}i+r>=0!=!!e&&t.reverse()}var u=t.bz((function t(e,i){var r,n=e&&e.type;if("FeatureCollection"===n)for(r=0;r<e.features.length;r++)t(e.features[r],i);else if("GeometryCollection"===n)for(r=0;r<e.geometries.length;r++)t(e.geometries[r],i);else if("Feature"===n)t(e.geometry,i);else if("Polygon"===n)l(e.coordinates,i);else if("MultiPolygon"===n)for(r=0;r<e.coordinates.length;r++)l(e.coordinates[r],i);return e}));const h=t.bw.VectorTileFeature.prototype.toGeoJSON;var d={exports:{}},p=t.bA,f=t.bw.VectorTileFeature,A=m;function m(t,e){this.options=e||{},this.features=t,this.length=t.length}function g(t,e){this.id="number"==typeof t.id?t.id:void 0,this.type=t.type,this.rawGeometry=1===t.type?[t.geometry]:t.geometry,this.properties=t.tags,this.extent=e||4096}m.prototype.feature=function(t){return new g(this.features[t],this.options.extent)},g.prototype.loadGeometry=function(){var t=this.rawGeometry;this.geometry=[];for(var e=0;e<t.length;e++){for(var i=t[e],r=[],n=0;n<i.length;n++)r.push(new p(i[n][0],i[n][1]));this.geometry.push(r)}return this.geometry},g.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var t=this.geometry,e=1/0,i=-1/0,r=1/0,n=-1/0,o=0;o<t.length;o++)for(var s=t[o],a=0;a<s.length;a++){var l=s[a];e=Math.min(e,l.x),i=Math.max(i,l.x),r=Math.min(r,l.y),n=Math.max(n,l.y)}return[e,r,i,n]},g.prototype.toGeoJSON=f.prototype.toGeoJSON;var _=t.bB,y=A;function v(t){var e=new _;return function(t,e){for(var i in t.layers)e.writeMessage(3,x,t.layers[i])}(t,e),e.finish()}function x(t,e){var i;e.writeVarintField(15,t.version||1),e.writeStringField(1,t.name||""),e.writeVarintField(5,t.extent||4096);var r={keys:[],values:[],keycache:{},valuecache:{}};for(i=0;i<t.length;i++)r.feature=t.feature(i),e.writeMessage(2,b,r);var n=r.keys;for(i=0;i<n.length;i++)e.writeStringField(3,n[i]);var o=r.values;for(i=0;i<o.length;i++)e.writeMessage(4,C,o[i])}function b(t,e){var i=t.feature;void 0!==i.id&&e.writeVarintField(1,i.id),e.writeMessage(2,w,t),e.writeVarintField(3,i.type),e.writeMessage(4,E,i)}function w(t,e){var i=t.feature,r=t.keys,n=t.values,o=t.keycache,s=t.valuecache;for(var a in i.properties){var l=i.properties[a],c=o[a];if(null!==l){void 0===c&&(r.push(a),o[a]=c=r.length-1),e.writeVarint(c);var u=typeof l;"string"!==u&&"boolean"!==u&&"number"!==u&&(l=JSON.stringify(l));var h=u+":"+l,d=s[h];void 0===d&&(n.push(l),s[h]=d=n.length-1),e.writeVarint(d)}}}function T(t,e){return(e<<3)+(7&t)}function B(t){return t<<1^t>>31}function E(t,e){for(var i=t.loadGeometry(),r=t.type,n=0,o=0,s=i.length,a=0;a<s;a++){var l=i[a],c=1;1===r&&(c=l.length),e.writeVarint(T(1,c));for(var u=3===r?l.length-1:l.length,h=0;h<u;h++){1===h&&1!==r&&e.writeVarint(T(2,u-1));var d=l[h].x-n,p=l[h].y-o;e.writeVarint(B(d)),e.writeVarint(B(p)),n+=d,o+=p}3===r&&e.writeVarint(T(7,1))}}function C(t,e){var i=typeof t;"string"===i?e.writeStringField(1,t):"boolean"===i?e.writeBooleanField(7,t):"number"===i&&(t%1!=0?e.writeDoubleField(3,t):t<0?e.writeSVarintField(6,t):e.writeVarintField(5,t))}d.exports=v,d.exports.fromVectorTileJs=v,d.exports.fromGeojsonVt=function(t,e){e=e||{};var i={};for(var r in t)i[r]=new y(t[r].features,e),i[r].name=r,i[r].version=e.version,i[r].extent=e.extent;return v({layers:i})},d.exports.GeoJSONWrapper=y;var S=t.bz(d.exports);const I={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:t=>t},M=Math.fround||(k=new Float32Array(1),t=>(k[0]=+t,k[0]));var k;const P=3,L=5,z=6;class F{constructor(t){this.options=Object.assign(Object.create(I),t),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(t){const{log:e,minZoom:i,maxZoom:r}=this.options;e&&console.time("total time");const n=`prepare ${t.length} points`;e&&console.time(n),this.points=t;const o=[];for(let e=0;e<t.length;e++){const i=t[e];if(!i.geometry)continue;const[r,n]=i.geometry.coordinates,s=M(U(r)),a=M(O(n));o.push(s,a,1/0,e,-1,1),this.options.reduce&&o.push(0)}let s=this.trees[r+1]=this._createTree(o);e&&console.timeEnd(n);for(let t=r;t>=i;t--){const i=+Date.now();s=this.trees[t]=this._createTree(this._cluster(s,t)),e&&console.log("z%d: %d clusters in %dms",t,s.numItems,+Date.now()-i)}return e&&console.timeEnd("total time"),this}getClusters(t,e){let i=((t[0]+180)%360+360)%360-180;const r=Math.max(-90,Math.min(90,t[1]));let n=180===t[2]?180:((t[2]+180)%360+360)%360-180;const o=Math.max(-90,Math.min(90,t[3]));if(t[2]-t[0]>=360)i=-180,n=180;else if(i>n){const t=this.getClusters([i,r,180,o],e),s=this.getClusters([-180,r,n,o],e);return t.concat(s)}const s=this.trees[this._limitZoom(e)],a=s.range(U(i),O(o),U(n),O(r)),l=s.data,c=[];for(const t of a){const e=this.stride*t;c.push(l[e+L]>1?D(l,e,this.clusterProps):this.points[l[e+P]])}return c}getChildren(t){const e=this._getOriginId(t),i=this._getOriginZoom(t),r="No cluster with the specified id.",n=this.trees[i];if(!n)throw new Error(r);const o=n.data;if(e*this.stride>=o.length)throw new Error(r);const s=this.options.radius/(this.options.extent*Math.pow(2,i-1)),a=n.within(o[e*this.stride],o[e*this.stride+1],s),l=[];for(const e of a){const i=e*this.stride;o[i+4]===t&&l.push(o[i+L]>1?D(o,i,this.clusterProps):this.points[o[i+P]])}if(0===l.length)throw new Error(r);return l}getLeaves(t,e,i){const r=[];return this._appendLeaves(r,t,e=e||10,i=i||0,0),r}getTile(t,e,i){const r=this.trees[this._limitZoom(t)],n=Math.pow(2,t),{extent:o,radius:s}=this.options,a=s/o,l=(i-a)/n,c=(i+1+a)/n,u={features:[]};return this._addTileFeatures(r.range((e-a)/n,l,(e+1+a)/n,c),r.data,e,i,n,u),0===e&&this._addTileFeatures(r.range(1-a/n,l,1,c),r.data,n,i,n,u),e===n-1&&this._addTileFeatures(r.range(0,l,a/n,c),r.data,-1,i,n,u),u.features.length?u:null}getClusterExpansionZoom(t){let e=this._getOriginZoom(t)-1;for(;e<=this.options.maxZoom;){const i=this.getChildren(t);if(e++,1!==i.length)break;t=i[0].properties.cluster_id}return e}_appendLeaves(t,e,i,r,n){const o=this.getChildren(e);for(const e of o){const o=e.properties;if(o&&o.cluster?n+o.point_count<=r?n+=o.point_count:n=this._appendLeaves(t,o.cluster_id,i,r,n):n<r?n++:t.push(e),t.length===i)break}return n}_createTree(e){const i=new t.av(e.length/this.stride|0,this.options.nodeSize,Float32Array);for(let t=0;t<e.length;t+=this.stride)i.add(e[t],e[t+1]);return i.finish(),i.data=e,i}_addTileFeatures(t,e,i,r,n,o){for(const s of t){const t=s*this.stride,a=e[t+L]>1;let l,c,u;if(a)l=R(e,t,this.clusterProps),c=e[t],u=e[t+1];else{const i=this.points[e[t+P]];l=i.properties;const[r,n]=i.geometry.coordinates;c=U(r),u=O(n)}const h={type:1,geometry:[[Math.round(this.options.extent*(c*n-i)),Math.round(this.options.extent*(u*n-r))]],tags:l};let d;d=a||this.options.generateId?e[t+P]:this.points[e[t+P]].id,void 0!==d&&(h.id=d),o.features.push(h)}}_limitZoom(t){return Math.max(this.options.minZoom,Math.min(Math.floor(+t),this.options.maxZoom+1))}_cluster(t,e){const{radius:i,extent:r,reduce:n,minPoints:o}=this.options,s=i/(r*Math.pow(2,e)),a=t.data,l=[],c=this.stride;for(let i=0;i<a.length;i+=c){if(a[i+2]<=e)continue;a[i+2]=e;const r=a[i],u=a[i+1],h=t.within(a[i],a[i+1],s),d=a[i+L];let p=d;for(const t of h){const i=t*c;a[i+2]>e&&(p+=a[i+L])}if(p>d&&p>=o){let t,o=r*d,s=u*d,f=-1;const A=((i/c|0)<<5)+(e+1)+this.points.length;for(const r of h){const l=r*c;if(a[l+2]<=e)continue;a[l+2]=e;const u=a[l+L];o+=a[l]*u,s+=a[l+1]*u,a[l+4]=A,n&&(t||(t=this._map(a,i,!0),f=this.clusterProps.length,this.clusterProps.push(t)),n(t,this._map(a,l)))}a[i+4]=A,l.push(o/p,s/p,1/0,A,-1,p),n&&l.push(f)}else{for(let t=0;t<c;t++)l.push(a[i+t]);if(p>1)for(const t of h){const i=t*c;if(!(a[i+2]<=e)){a[i+2]=e;for(let t=0;t<c;t++)l.push(a[i+t])}}}}return l}_getOriginId(t){return t-this.points.length>>5}_getOriginZoom(t){return(t-this.points.length)%32}_map(t,e,i){if(t[e+L]>1){const r=this.clusterProps[t[e+z]];return i?Object.assign({},r):r}const r=this.points[t[e+P]].properties,n=this.options.map(r);return i&&n===r?Object.assign({},n):n}}function D(t,e,i){return{type:"Feature",id:t[e+P],properties:R(t,e,i),geometry:{type:"Point",coordinates:[(r=t[e],360*(r-.5)),N(t[e+1])]}};var r}function R(t,e,i){const r=t[e+L],n=r>=1e4?`${Math.round(r/1e3)}k`:r>=1e3?Math.round(r/100)/10+"k":r,o=t[e+z],s=-1===o?{}:Object.assign({},i[o]);return Object.assign(s,{cluster:!0,cluster_id:t[e+P],point_count:r,point_count_abbreviated:n})}function U(t){return t/360+.5}function O(t){const e=Math.sin(t*Math.PI/180),i=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return i<0?0:i>1?1:i}function N(t){const e=(180-360*t)*Math.PI/180;return 360*Math.atan(Math.exp(e))/Math.PI-90}function Q(t,e,i,r){for(var n,o=r,s=i-e>>1,a=i-e,l=t[e],c=t[e+1],u=t[i],h=t[i+1],d=e+3;d<i;d+=3){var p=V(t[d],t[d+1],l,c,u,h);if(p>o)n=d,o=p;else if(p===o){var f=Math.abs(d-s);f<a&&(n=d,a=f)}}o>r&&(n-e>3&&Q(t,e,n,r),t[n+2]=o,i-n>3&&Q(t,n,i,r))}function V(t,e,i,r,n,o){var s=n-i,a=o-r;if(0!==s||0!==a){var l=((t-i)*s+(e-r)*a)/(s*s+a*a);l>1?(i=n,r=o):l>0&&(i+=s*l,r+=a*l)}return(s=t-i)*s+(a=e-r)*a}function j(t,e,i,r){var n={id:void 0===t?null:t,type:e,geometry:i,tags:r,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(t){var e=t.geometry,i=t.type;if("Point"===i||"MultiPoint"===i||"LineString"===i)H(t,e);else if("Polygon"===i||"MultiLineString"===i)for(var r=0;r<e.length;r++)H(t,e[r]);else if("MultiPolygon"===i)for(r=0;r<e.length;r++)for(var n=0;n<e[r].length;n++)H(t,e[r][n])}(n),n}function H(t,e){for(var i=0;i<e.length;i+=3)t.minX=Math.min(t.minX,e[i]),t.minY=Math.min(t.minY,e[i+1]),t.maxX=Math.max(t.maxX,e[i]),t.maxY=Math.max(t.maxY,e[i+1])}function G(t,e,i,r){if(e.geometry){var n=e.geometry.coordinates,o=e.geometry.type,s=Math.pow(i.tolerance/((1<<i.maxZoom)*i.extent),2),a=[],l=e.id;if(i.promoteId?l=e.properties[i.promoteId]:i.generateId&&(l=r||0),"Point"===o)$(n,a);else if("MultiPoint"===o)for(var c=0;c<n.length;c++)$(n[c],a);else if("LineString"===o)Z(n,a,s,!1);else if("MultiLineString"===o){if(i.lineMetrics){for(c=0;c<n.length;c++)Z(n[c],a=[],s,!1),t.push(j(l,"LineString",a,e.properties));return}q(n,a,s,!1)}else if("Polygon"===o)q(n,a,s,!0);else{if("MultiPolygon"!==o){if("GeometryCollection"===o){for(c=0;c<e.geometry.geometries.length;c++)G(t,{id:l,geometry:e.geometry.geometries[c],properties:e.properties},i,r);return}throw new Error("Input data is not a valid GeoJSON object.")}for(c=0;c<n.length;c++){var u=[];q(n[c],u,s,!0),a.push(u)}}t.push(j(l,o,a,e.properties))}}function $(t,e){e.push(K(t[0])),e.push(W(t[1])),e.push(0)}function Z(t,e,i,r){for(var n,o,s=0,a=0;a<t.length;a++){var l=K(t[a][0]),c=W(t[a][1]);e.push(l),e.push(c),e.push(0),a>0&&(s+=r?(n*c-l*o)/2:Math.sqrt(Math.pow(l-n,2)+Math.pow(c-o,2))),n=l,o=c}var u=e.length-3;e[2]=1,Q(e,0,u,i),e[u+2]=1,e.size=Math.abs(s),e.start=0,e.end=e.size}function q(t,e,i,r){for(var n=0;n<t.length;n++){var o=[];Z(t[n],o,i,r),e.push(o)}}function K(t){return t/360+.5}function W(t){var e=Math.sin(t*Math.PI/180),i=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return i<0?0:i>1?1:i}function X(t,e,i,r,n,o,s,a){if(r/=e,o>=(i/=e)&&s<r)return t;if(s<i||o>=r)return null;for(var l=[],c=0;c<t.length;c++){var u=t[c],h=u.geometry,d=u.type,p=0===n?u.minX:u.minY,f=0===n?u.maxX:u.maxY;if(p>=i&&f<r)l.push(u);else if(!(f<i||p>=r)){var A=[];if("Point"===d||"MultiPoint"===d)J(h,A,i,r,n);else if("LineString"===d)Y(h,A,i,r,n,!1,a.lineMetrics);else if("MultiLineString"===d)et(h,A,i,r,n,!1);else if("Polygon"===d)et(h,A,i,r,n,!0);else if("MultiPolygon"===d)for(var m=0;m<h.length;m++){var g=[];et(h[m],g,i,r,n,!0),g.length&&A.push(g)}if(A.length){if(a.lineMetrics&&"LineString"===d){for(m=0;m<A.length;m++)l.push(j(u.id,d,A[m],u.tags));continue}"LineString"!==d&&"MultiLineString"!==d||(1===A.length?(d="LineString",A=A[0]):d="MultiLineString"),"Point"!==d&&"MultiPoint"!==d||(d=3===A.length?"Point":"MultiPoint"),l.push(j(u.id,d,A,u.tags))}}}return l.length?l:null}function J(t,e,i,r,n){for(var o=0;o<t.length;o+=3){var s=t[o+n];s>=i&&s<=r&&(e.push(t[o]),e.push(t[o+1]),e.push(t[o+2]))}}function Y(t,e,i,r,n,o,s){for(var a,l,c=tt(t),u=0===n?rt:nt,h=t.start,d=0;d<t.length-3;d+=3){var p=t[d],f=t[d+1],A=t[d+2],m=t[d+3],g=t[d+4],_=0===n?p:f,y=0===n?m:g,v=!1;s&&(a=Math.sqrt(Math.pow(p-m,2)+Math.pow(f-g,2))),_<i?y>i&&(l=u(c,p,f,m,g,i),s&&(c.start=h+a*l)):_>r?y<r&&(l=u(c,p,f,m,g,r),s&&(c.start=h+a*l)):it(c,p,f,A),y<i&&_>=i&&(l=u(c,p,f,m,g,i),v=!0),y>r&&_<=r&&(l=u(c,p,f,m,g,r),v=!0),!o&&v&&(s&&(c.end=h+a*l),e.push(c),c=tt(t)),s&&(h+=a)}var x=t.length-3;p=t[x],f=t[x+1],A=t[x+2],(_=0===n?p:f)>=i&&_<=r&&it(c,p,f,A),x=c.length-3,o&&x>=3&&(c[x]!==c[0]||c[x+1]!==c[1])&&it(c,c[0],c[1],c[2]),c.length&&e.push(c)}function tt(t){var e=[];return e.size=t.size,e.start=t.start,e.end=t.end,e}function et(t,e,i,r,n,o){for(var s=0;s<t.length;s++)Y(t[s],e,i,r,n,o,!1)}function it(t,e,i,r){t.push(e),t.push(i),t.push(r)}function rt(t,e,i,r,n,o){var s=(o-e)/(r-e);return t.push(o),t.push(i+(n-i)*s),t.push(1),s}function nt(t,e,i,r,n,o){var s=(o-i)/(n-i);return t.push(e+(r-e)*s),t.push(o),t.push(1),s}function ot(t,e){for(var i=[],r=0;r<t.length;r++){var n,o=t[r],s=o.type;if("Point"===s||"MultiPoint"===s||"LineString"===s)n=st(o.geometry,e);else if("MultiLineString"===s||"Polygon"===s){n=[];for(var a=0;a<o.geometry.length;a++)n.push(st(o.geometry[a],e))}else if("MultiPolygon"===s)for(n=[],a=0;a<o.geometry.length;a++){for(var l=[],c=0;c<o.geometry[a].length;c++)l.push(st(o.geometry[a][c],e));n.push(l)}i.push(j(o.id,s,n,o.tags))}return i}function st(t,e){var i=[];i.size=t.size,void 0!==t.start&&(i.start=t.start,i.end=t.end);for(var r=0;r<t.length;r+=3)i.push(t[r]+e,t[r+1],t[r+2]);return i}function at(t,e){if(t.transformed)return t;var i,r,n,o=1<<t.z,s=t.x,a=t.y;for(i=0;i<t.features.length;i++){var l=t.features[i],c=l.geometry,u=l.type;if(l.geometry=[],1===u)for(r=0;r<c.length;r+=2)l.geometry.push(lt(c[r],c[r+1],e,o,s,a));else for(r=0;r<c.length;r++){var h=[];for(n=0;n<c[r].length;n+=2)h.push(lt(c[r][n],c[r][n+1],e,o,s,a));l.geometry.push(h)}}return t.transformed=!0,t}function lt(t,e,i,r,n,o){return[Math.round(i*(t*r-n)),Math.round(i*(e*r-o))]}function ct(t,e,i,r,n){for(var o=e===n.maxZoom?0:n.tolerance/((1<<e)*n.extent),s={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:i,y:r,z:e,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},a=0;a<t.length;a++){s.numFeatures++,ut(s,t[a],o,n);var l=t[a].minX,c=t[a].minY,u=t[a].maxX,h=t[a].maxY;l<s.minX&&(s.minX=l),c<s.minY&&(s.minY=c),u>s.maxX&&(s.maxX=u),h>s.maxY&&(s.maxY=h)}return s}function ut(t,e,i,r){var n=e.geometry,o=e.type,s=[];if("Point"===o||"MultiPoint"===o)for(var a=0;a<n.length;a+=3)s.push(n[a]),s.push(n[a+1]),t.numPoints++,t.numSimplified++;else if("LineString"===o)ht(s,n,t,i,!1,!1);else if("MultiLineString"===o||"Polygon"===o)for(a=0;a<n.length;a++)ht(s,n[a],t,i,"Polygon"===o,0===a);else if("MultiPolygon"===o)for(var l=0;l<n.length;l++){var c=n[l];for(a=0;a<c.length;a++)ht(s,c[a],t,i,!0,0===a)}if(s.length){var u=e.tags||null;if("LineString"===o&&r.lineMetrics){for(var h in u={},e.tags)u[h]=e.tags[h];u.mapbox_clip_start=n.start/n.size,u.mapbox_clip_end=n.end/n.size}var d={geometry:s,type:"Polygon"===o||"MultiPolygon"===o?3:"LineString"===o||"MultiLineString"===o?2:1,tags:u};null!==e.id&&(d.id=e.id),t.features.push(d)}}function ht(t,e,i,r,n,o){var s=r*r;if(r>0&&e.size<(n?s:r))i.numPoints+=e.length/3;else{for(var a=[],l=0;l<e.length;l+=3)(0===r||e[l+2]>s)&&(i.numSimplified++,a.push(e[l]),a.push(e[l+1])),i.numPoints++;n&&function(t,e){for(var i=0,r=0,n=t.length,o=n-2;r<n;o=r,r+=2)i+=(t[r]-t[o])*(t[r+1]+t[o+1]);if(i>0===e)for(r=0,n=t.length;r<n/2;r+=2){var s=t[r],a=t[r+1];t[r]=t[n-2-r],t[r+1]=t[n-1-r],t[n-2-r]=s,t[n-1-r]=a}}(a,o),t.push(a)}}function dt(t,e){var i=(e=this.options=function(t,e){for(var i in e)t[i]=e[i];return t}(Object.create(this.options),e)).debug;if(i&&console.time("preprocess data"),e.maxZoom<0||e.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(e.promoteId&&e.generateId)throw new Error("promoteId and generateId cannot be used together.");var r=function(t,e){var i=[];if("FeatureCollection"===t.type)for(var r=0;r<t.features.length;r++)G(i,t.features[r],e,r);else G(i,"Feature"===t.type?t:{geometry:t},e);return i}(t,e);this.tiles={},this.tileCoords=[],i&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",e.indexMaxZoom,e.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),r=function(t,e){var i=e.buffer/e.extent,r=t,n=X(t,1,-1-i,i,0,-1,2,e),o=X(t,1,1-i,2+i,0,-1,2,e);return(n||o)&&(r=X(t,1,-i,1+i,0,-1,2,e)||[],n&&(r=ot(n,1).concat(r)),o&&(r=r.concat(ot(o,-1)))),r}(r,e),r.length&&this.splitTile(r,0,0,0),i&&(r.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function pt(t,e,i){return 32*((1<<t)*i+e)+t}function ft(t,e){return e?t.properties[e]:t.id}function At(t,e){if(null==t)return!0;if("Feature"===t.type)return null!=ft(t,e);if("FeatureCollection"===t.type){const i=new Set;for(const r of t.features){const t=ft(r,e);if(null==t)return!1;if(i.has(t))return!1;i.add(t)}return!0}return!1}function mt(t,e){const i=new Map;if(null==t);else if("Feature"===t.type)i.set(ft(t,e),t);else for(const r of t.features)i.set(ft(r,e),r);return i}dt.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},dt.prototype.splitTile=function(t,e,i,r,n,o,s){for(var a=[t,e,i,r],l=this.options,c=l.debug;a.length;){r=a.pop(),i=a.pop(),e=a.pop(),t=a.pop();var u=1<<e,h=pt(e,i,r),d=this.tiles[h];if(!d&&(c>1&&console.time("creation"),d=this.tiles[h]=ct(t,e,i,r,l),this.tileCoords.push({z:e,x:i,y:r}),c)){c>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",e,i,r,d.numFeatures,d.numPoints,d.numSimplified),console.timeEnd("creation"));var p="z"+e;this.stats[p]=(this.stats[p]||0)+1,this.total++}if(d.source=t,n){if(e===l.maxZoom||e===n)continue;var f=1<<n-e;if(i!==Math.floor(o/f)||r!==Math.floor(s/f))continue}else if(e===l.indexMaxZoom||d.numPoints<=l.indexMaxPoints)continue;if(d.source=null,0!==t.length){c>1&&console.time("clipping");var A,m,g,_,y,v,x=.5*l.buffer/l.extent,b=.5-x,w=.5+x,T=1+x;A=m=g=_=null,y=X(t,u,i-x,i+w,0,d.minX,d.maxX,l),v=X(t,u,i+b,i+T,0,d.minX,d.maxX,l),t=null,y&&(A=X(y,u,r-x,r+w,1,d.minY,d.maxY,l),m=X(y,u,r+b,r+T,1,d.minY,d.maxY,l),y=null),v&&(g=X(v,u,r-x,r+w,1,d.minY,d.maxY,l),_=X(v,u,r+b,r+T,1,d.minY,d.maxY,l),v=null),c>1&&console.timeEnd("clipping"),a.push(A||[],e+1,2*i,2*r),a.push(m||[],e+1,2*i,2*r+1),a.push(g||[],e+1,2*i+1,2*r),a.push(_||[],e+1,2*i+1,2*r+1)}}},dt.prototype.getTile=function(t,e,i){var r=this.options,n=r.extent,o=r.debug;if(t<0||t>24)return null;var s=1<<t,a=pt(t,e=(e%s+s)%s,i);if(this.tiles[a])return at(this.tiles[a],n);o>1&&console.log("drilling down to z%d-%d-%d",t,e,i);for(var l,c=t,u=e,h=i;!l&&c>0;)c--,u=Math.floor(u/2),h=Math.floor(h/2),l=this.tiles[pt(c,u,h)];return l&&l.source?(o>1&&console.log("found parent tile z%d-%d-%d",c,u,h),o>1&&console.time("drilling down"),this.splitTile(l.source,c,u,h,t,e,i),o>1&&console.timeEnd("drilling down"),this.tiles[a]?at(this.tiles[a],n):null):null};class gt extends s{constructor(e,i,r,n){super(e,i,r),this._dataUpdateable=new Map,this.loadGeoJSON=(e,i)=>{const{promoteId:r}=e;if(e.request)return t.f(e.request,((t,e,n,o)=>{this._dataUpdateable=At(e,r)?mt(e,r):void 0,i(t,e,n,o)}));if("string"==typeof e.data)try{const t=JSON.parse(e.data);this._dataUpdateable=At(t,r)?mt(t,r):void 0,i(null,t)}catch(t){i(new Error(`Input data given to '${e.source}' is not a valid GeoJSON object.`))}else e.dataDiff?this._dataUpdateable?(function(t,e,i){var r,n,o,s;if(e.removeAll&&t.clear(),e.remove)for(const i of e.remove)t.delete(i);if(e.add)for(const r of e.add){const e=ft(r,i);null!=e&&t.set(e,r)}if(e.update)for(const i of e.update){let e=t.get(i.id);if(null==e)continue;const a=!i.removeAllProperties&&((null===(r=i.removeProperties)||void 0===r?void 0:r.length)>0||(null===(n=i.addOrUpdateProperties)||void 0===n?void 0:n.length)>0);if((i.newGeometry||i.removeAllProperties||a)&&(e=Object.assign({},e),t.set(i.id,e),a&&(e.properties=Object.assign({},e.properties))),i.newGeometry&&(e.geometry=i.newGeometry),i.removeAllProperties)e.properties={};else if((null===(o=i.removeProperties)||void 0===o?void 0:o.length)>0)for(const t of i.removeProperties)Object.prototype.hasOwnProperty.call(e.properties,t)&&delete e.properties[t];if((null===(s=i.addOrUpdateProperties)||void 0===s?void 0:s.length)>0)for(const{key:t,value:r}of i.addOrUpdateProperties)e.properties[t]=r}}(this._dataUpdateable,e.dataDiff,r),i(null,{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())})):i(new Error(`Cannot update existing geojson data in ${e.source}`)):i(new Error(`Input data given to '${e.source}' is not a valid GeoJSON object.`));return{cancel:()=>{}}},this.loadVectorData=this.loadGeoJSONTile,n&&(this.loadGeoJSON=n)}loadGeoJSONTile(e,i){const r=e.tileID.canonical;if(!this._geoJSONIndex)return i(null,null);const n=this._geoJSONIndex.getTile(r.z,r.x,r.y);if(!n)return i(null,null);const o=new class{constructor(e){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=t.N,this.length=e.length,this._features=e}feature(e){return new class{constructor(e){this._feature=e,this.extent=t.N,this.type=e.type,this.properties=e.tags,"id"in e&&!isNaN(e.id)&&(this.id=parseInt(e.id,10))}loadGeometry(){if(1===this._feature.type){const e=[];for(const i of this._feature.geometry)e.push([new t.P(i[0],i[1])]);return e}{const e=[];for(const i of this._feature.geometry){const r=[];for(const e of i)r.push(new t.P(e[0],e[1]));e.push(r)}return e}}toGeoJSON(t,e,i){return h.call(this,t,e,i)}}(this._features[e])}}(n.features);let s=S(o);0===s.byteOffset&&s.byteLength===s.buffer.byteLength||(s=new Uint8Array(s)),i(null,{vectorTile:o,rawData:s.buffer})}loadData(e,i){var r;null===(r=this._pendingRequest)||void 0===r||r.cancel(),this._pendingCallback&&this._pendingCallback(null,{abandoned:!0});const n=!!(e&&e.request&&e.request.collectResourceTiming)&&new t.bu(e.request);this._pendingCallback=i,this._pendingRequest=this.loadGeoJSON(e,((r,o)=>{if(delete this._pendingCallback,delete this._pendingRequest,r||!o)return i(r);if("object"!=typeof o)return i(new Error(`Input data given to '${e.source}' is not a valid GeoJSON object.`));{u(o,!0);try{if(e.filter){const i=t.bC(e.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===i.result)throw new Error(i.value.map((t=>`${t.key}: ${t.message}`)).join(", "));const r=o.features.filter((t=>i.value.evaluate({zoom:0},t)));o={type:"FeatureCollection",features:r}}this._geoJSONIndex=e.cluster?new F(function({superclusterOptions:e,clusterProperties:i}){if(!i||!e)return e;const r={},n={},o={accumulated:null,zoom:0},s={properties:null},a=Object.keys(i);for(const e of a){const[o,s]=i[e],a=t.bC(s),l=t.bC("string"==typeof o?[o,["accumulated"],["get",e]]:o);r[e]=a.value,n[e]=l.value}return e.map=t=>{s.properties=t;const e={};for(const t of a)e[t]=r[t].evaluate(o,s);return e},e.reduce=(t,e)=>{s.properties=e;for(const e of a)o.accumulated=t[e],t[e]=n[e].evaluate(o,s)},e}(e)).load(o.features):function(t,e){return new dt(t,e)}(o,e.geojsonVtOptions)}catch(r){return i(r)}this.loaded={};const s={};if(n){const t=n.finish();t&&(s.resourceTiming={},s.resourceTiming[e.source]=JSON.parse(JSON.stringify(t)))}i(null,s)}}))}reloadTile(t,e){const i=this.loaded;return i&&i[t.uid]?super.reloadTile(t,e):this.loadTile(t,e)}removeSource(t,e){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),e()}getClusterExpansionZoom(t,e){try{e(null,this._geoJSONIndex.getClusterExpansionZoom(t.clusterId))}catch(t){e(t)}}getClusterChildren(t,e){try{e(null,this._geoJSONIndex.getChildren(t.clusterId))}catch(t){e(t)}}getClusterLeaves(t,e){try{e(null,this._geoJSONIndex.getLeaves(t.clusterId,t.limit,t.offset))}catch(t){e(t)}}}class _t{constructor(e){this.self=e,this.actor=new t.C(e,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:s,geojson:gt},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(t,e)=>{if(this.workerSourceTypes[t])throw new Error(`Worker source with name "${t}" already registered.`);this.workerSourceTypes[t]=e},this.self.registerRTLTextPlugin=e=>{if(t.bD.isParsed())throw new Error("RTL text plugin already registered.");t.bD.applyArabicShaping=e.applyArabicShaping,t.bD.processBidirectionalText=e.processBidirectionalText,t.bD.processStyledBidirectionalText=e.processStyledBidirectionalText}}setReferrer(t,e){this.referrer=e}setImages(t,e,i){this.availableImages[t]=e;for(const i in this.workerSources[t]){const r=this.workerSources[t][i];for(const t in r)r[t].availableImages=e}i()}setLayers(t,e,i){this.getLayerIndex(t).replace(e),i()}updateLayers(t,e,i){this.getLayerIndex(t).update(e.layers,e.removedIds),i()}loadTile(t,e,i){this.getWorkerSource(t,e.type,e.source).loadTile(e,i)}loadDEMTile(t,e,i){this.getDEMWorkerSource(t,e.source).loadTile(e,i)}reloadTile(t,e,i){this.getWorkerSource(t,e.type,e.source).reloadTile(e,i)}abortTile(t,e,i){this.getWorkerSource(t,e.type,e.source).abortTile(e,i)}removeTile(t,e,i){this.getWorkerSource(t,e.type,e.source).removeTile(e,i)}removeDEMTile(t,e){this.getDEMWorkerSource(t,e.source).removeTile(e)}removeSource(t,e,i){if(!this.workerSources[t]||!this.workerSources[t][e.type]||!this.workerSources[t][e.type][e.source])return;const r=this.workerSources[t][e.type][e.source];delete this.workerSources[t][e.type][e.source],void 0!==r.removeSource?r.removeSource(e,i):i()}loadWorkerSource(t,e,i){try{this.self.importScripts(e.url),i()}catch(t){i(t.toString())}}syncRTLPluginState(e,i,r){try{t.bD.setState(i);const e=t.bD.getPluginURL();if(t.bD.isLoaded()&&!t.bD.isParsed()&&null!=e){this.self.importScripts(e);const i=t.bD.isParsed();r(i?void 0:new Error(`RTL Text Plugin failed to import scripts from ${e}`),i)}}catch(t){r(t.toString())}}getAvailableImages(t){let e=this.availableImages[t];return e||(e=[]),e}getLayerIndex(t){let i=this.layerIndexes[t];return i||(i=this.layerIndexes[t]=new e),i}getWorkerSource(t,e,i){return this.workerSources[t]||(this.workerSources[t]={}),this.workerSources[t][e]||(this.workerSources[t][e]={}),this.workerSources[t][e][i]||(this.workerSources[t][e][i]=new this.workerSourceTypes[e]({send:(e,i,r)=>{this.actor.send(e,i,r,t)}},this.getLayerIndex(t),this.getAvailableImages(t))),this.workerSources[t][e][i]}getDEMWorkerSource(t,e){return this.demWorkerSources[t]||(this.demWorkerSources[t]={}),this.demWorkerSources[t][e]||(this.demWorkerSources[t][e]=new a),this.demWorkerSources[t][e]}}return t.i()&&(self.worker=new _t(self)),_t})),r(["./shared"],(function(t){var e="3.6.2";class i{static testProp(t){if(!i.docStyle)return t[0];for(let e=0;e<t.length;e++)if(t[e]in i.docStyle)return t[e];return t[0]}static create(t,e,i){const r=window.document.createElement(t);return void 0!==e&&(r.className=e),i&&i.appendChild(r),r}static createNS(t,e){return window.document.createElementNS(t,e)}static disableDrag(){i.docStyle&&i.selectProp&&(i.userSelect=i.docStyle[i.selectProp],i.docStyle[i.selectProp]="none")}static enableDrag(){i.docStyle&&i.selectProp&&(i.docStyle[i.selectProp]=i.userSelect)}static setTransform(t,e){t.style[i.transformProp]=e}static addEventListener(t,e,i,r={}){t.addEventListener(e,i,"passive"in r?r:r.capture)}static removeEventListener(t,e,i,r={}){t.removeEventListener(e,i,"passive"in r?r:r.capture)}static suppressClickInternal(t){t.preventDefault(),t.stopPropagation(),window.removeEventListener("click",i.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",i.suppressClickInternal,!0),window.setTimeout((()=>{window.removeEventListener("click",i.suppressClickInternal,!0)}),0)}static mousePos(e,i){const r=e.getBoundingClientRect();return new t.P(i.clientX-r.left-e.clientLeft,i.clientY-r.top-e.clientTop)}static touchPos(e,i){const r=e.getBoundingClientRect(),n=[];for(let o=0;o<i.length;o++)n.push(new t.P(i[o].clientX-r.left-e.clientLeft,i[o].clientY-r.top-e.clientTop));return n}static mouseButton(t){return t.button}static remove(t){t.parentNode&&t.parentNode.removeChild(t)}}i.docStyle="undefined"!=typeof window&&window.document&&window.document.documentElement.style,i.selectProp=i.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),i.transformProp=i.testProp(["transform","WebkitTransform"]);const r={supported:!1,testSupport:function(t){!s&&o&&(a?l(t):n=t)}};let n,o,s=!1,a=!1;function l(t){const e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,o),t.isContextLost())return;r.supported=!0}catch(t){}t.deleteTexture(e),s=!0}var c,u;"undefined"!=typeof document&&(o=document.createElement("img"),o.onload=function(){n&&l(n),n=null,a=!0},o.onerror=function(){s=!0,n=null},o.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(e){let i,n,o,s;e.resetRequestQueue=()=>{i=[],n=0,o=0,s={}},e.addThrottleControl=t=>{const e=o++;return s[e]=t,e},e.removeThrottleControl=t=>{delete s[t],c()},e.getImage=(t,e,o=!0)=>{r.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*");const s={requestParameters:t,supportImageRefresh:o,callback:e,cancelled:!1,completed:!1,cancel:()=>{s.completed||s.cancelled||(s.cancelled=!0,s.innerRequest&&(s.innerRequest.cancel(),n--),c())}};return i.push(s),c(),s};const a=e=>{const{requestParameters:i,supportImageRefresh:r,callback:n}=e;return t.e(i,{type:"image"}),(!1!==r||t.i()||t.g(i.url)||i.headers&&!Object.keys(i.headers).reduce(((t,e)=>t&&"accept"===e),!0)?t.m:u)(i,((t,i,r,o)=>{l(e,n,t,i,r,o)}))},l=(e,i,r,o,s,a)=>{r?i(r):o instanceof HTMLImageElement||t.a(o)?i(null,o):o&&((e,i)=>{"function"==typeof createImageBitmap?t.b(e,i):t.d(e,i)})(o,((t,e)=>{null!=t?i(t):null!=e&&i(null,e,{cacheControl:s,expires:a})})),e.cancelled||(e.completed=!0,n--,c())},c=()=>{const e=(()=>{const t=Object.keys(s);let e=!1;if(t.length>0)for(const i of t)if(e=s[i](),e)break;return e})()?t.c.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:t.c.MAX_PARALLEL_IMAGE_REQUESTS;for(let t=n;t<e&&i.length>0;t++){const e=i.shift();if(e.cancelled){t--;continue}const r=a(e);n++,e.innerRequest=r}},u=(e,i)=>{const r=new Image,n=e.url;let o=!1;const s=e.credentials;return s&&"include"===s?r.crossOrigin="use-credentials":(s&&"same-origin"===s||!t.s(n))&&(r.crossOrigin="anonymous"),r.fetchPriority="high",r.onload=()=>{i(null,r),r.onerror=r.onload=null},r.onerror=()=>{o||i(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.")),r.onerror=r.onload=null},r.src=n,{cancel:()=>{o=!0,r.src=""}}}}(c||(c={})),c.resetRequestQueue(),function(t){t.Glyphs="Glyphs",t.Image="Image",t.Source="Source",t.SpriteImage="SpriteImage",t.SpriteJSON="SpriteJSON",t.Style="Style",t.Tile="Tile",t.Unknown="Unknown"}(u||(u={}));class h{constructor(t){this._transformRequestFn=t}transformRequest(t,e){return this._transformRequestFn&&this._transformRequestFn(t,e)||{url:t}}normalizeSpriteURL(t,e,i){const r=function(t){const e=t.match(d);if(!e)throw new Error(`Unable to parse URL "${t}"`);return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}(t);return r.path+=`${e}${i}`,function(t){const e=t.params.length?`?${t.params.join("&")}`:"";return`${t.protocol}://${t.authority}${t.path}${e}`}(r)}setTransformRequest(t){this._transformRequestFn=t}}const d=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function p(e){var i=new t.A(3);return i[0]=e[0],i[1]=e[1],i[2]=e[2],i}var f,A=function(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t};f=new t.A(3),t.A!=Float32Array&&(f[0]=0,f[1]=0,f[2]=0);var m=function(t){var e=t[0],i=t[1];return e*e+i*i};function g(t){const e=[];if("string"==typeof t)e.push({id:"default",url:t});else if(t&&t.length>0){const i=[];for(const{id:r,url:n}of t){const t=`${r}${n}`;-1===i.indexOf(t)&&(i.push(t),e.push({id:r,url:n}))}}return e}function _(e,i,r,n,o){if(n)return void e(n);if(o!==Object.values(i).length||o!==Object.values(r).length)return;const s={};for(const e in i){s[e]={};const n=t.h.getImageCanvasContext(r[e]),o=i[e];for(const t in o){const{width:i,height:r,x:a,y:l,sdf:c,pixelRatio:u,stretchX:h,stretchY:d,content:p}=o[t];s[e][t]={data:null,pixelRatio:u,sdf:c,stretchX:h,stretchY:d,content:p,spriteData:{width:i,height:r,x:a,y:l,context:n}}}}e(null,s)}!function(){var e=new t.A(2);t.A!=Float32Array&&(e[0]=0,e[1]=0)}();class y{constructor(t,e,i,r){this.context=t,this.format=i,this.texture=t.gl.createTexture(),this.update(e,r)}update(e,i,r){const{width:n,height:o}=e,s=!(this.size&&this.size[0]===n&&this.size[1]===o||r),{context:a}=this,{gl:l}=a;if(this.useMipmap=Boolean(i&&i.useMipmap),l.bindTexture(l.TEXTURE_2D,this.texture),a.pixelStoreUnpackFlipY.set(!1),a.pixelStoreUnpack.set(1),a.pixelStoreUnpackPremultiplyAlpha.set(this.format===l.RGBA&&(!i||!1!==i.premultiply)),s)this.size=[n,o],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||t.a(e)?l.texImage2D(l.TEXTURE_2D,0,this.format,this.format,l.UNSIGNED_BYTE,e):l.texImage2D(l.TEXTURE_2D,0,this.format,n,o,0,this.format,l.UNSIGNED_BYTE,e.data);else{const{x:i,y:s}=r||{x:0,y:0};e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||t.a(e)?l.texSubImage2D(l.TEXTURE_2D,0,i,s,l.RGBA,l.UNSIGNED_BYTE,e):l.texSubImage2D(l.TEXTURE_2D,0,i,s,n,o,l.RGBA,l.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&l.generateMipmap(l.TEXTURE_2D)}bind(t,e,i){const{context:r}=this,{gl:n}=r;n.bindTexture(n.TEXTURE_2D,this.texture),i!==n.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(i=n.LINEAR),t!==this.filter&&(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,t),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,i||t),this.filter=t),e!==this.wrap&&(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,e),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,e),this.wrap=e)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}function v(t){const{userImage:e}=t;return!!(e&&e.render&&e.render())&&(t.data.replace(new Uint8Array(e.data.buffer)),!0)}class x extends t.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new t.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:t,callback:e}of this.requestors)this._notify(t,e);this.requestors=[]}}getImage(e){const i=this.images[e];if(i&&!i.data&&i.spriteData){const e=i.spriteData;i.data=new t.R({width:e.width,height:e.height},e.context.getImageData(e.x,e.y,e.width,e.height).data),i.spriteData=null}return i}addImage(t,e){if(this.images[t])throw new Error(`Image id ${t} already exist, use updateImage instead`);this._validate(t,e)&&(this.images[t]=e)}_validate(e,i){let r=!0;const n=i.data||i.spriteData;return this._validateStretch(i.stretchX,n&&n.width)||(this.fire(new t.j(new Error(`Image "${e}" has invalid "stretchX" value`))),r=!1),this._validateStretch(i.stretchY,n&&n.height)||(this.fire(new t.j(new Error(`Image "${e}" has invalid "stretchY" value`))),r=!1),this._validateContent(i.content,i)||(this.fire(new t.j(new Error(`Image "${e}" has invalid "content" value`))),r=!1),r}_validateStretch(t,e){if(!t)return!0;let i=0;for(const r of t){if(r[0]<i||r[1]<r[0]||e<r[1])return!1;i=r[1]}return!0}_validateContent(t,e){if(!t)return!0;if(4!==t.length)return!1;const i=e.spriteData,r=i&&i.width||e.data.width,n=i&&i.height||e.data.height;return!(t[0]<0||r<t[0]||t[1]<0||n<t[1]||t[2]<0||r<t[2]||t[3]<0||n<t[3]||t[2]<t[0]||t[3]<t[1])}updateImage(t,e,i=!0){const r=this.getImage(t);if(i&&(r.data.width!==e.data.width||r.data.height!==e.data.height))throw new Error(`size mismatch between old image (${r.data.width}x${r.data.height}) and new image (${e.data.width}x${e.data.height}).`);e.version=r.version+1,this.images[t]=e,this.updatedImages[t]=!0}removeImage(t){const e=this.images[t];delete this.images[t],delete this.patterns[t],e.userImage&&e.userImage.onRemove&&e.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t,e){let i=!0;if(!this.isLoaded())for(const e of t)this.images[e]||(i=!1);this.isLoaded()||i?this._notify(t,e):this.requestors.push({ids:t,callback:e})}_notify(e,i){const r={};for(const i of e){let e=this.getImage(i);e||(this.fire(new t.k("styleimagemissing",{id:i})),e=this.getImage(i)),e?r[i]={data:e.data.clone(),pixelRatio:e.pixelRatio,sdf:e.sdf,version:e.version,stretchX:e.stretchX,stretchY:e.stretchY,content:e.content,hasRenderCallback:Boolean(e.userImage&&e.userImage.render)}:t.w(`Image "${i}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}i(null,r)}getPixelSize(){const{width:t,height:e}=this.atlasImage;return{width:t,height:e}}getPattern(e){const i=this.patterns[e],r=this.getImage(e);if(!r)return null;if(i&&i.position.version===r.version)return i.position;if(i)i.position.version=r.version;else{const i={w:r.data.width+2,h:r.data.height+2,x:0,y:0},n=new t.I(i,r);this.patterns[e]={bin:i,position:n}}return this._updatePatternAtlas(),this.patterns[e].position}bind(t){const e=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new y(t,this.atlasImage,e.RGBA),this.atlasTexture.bind(e.LINEAR,e.CLAMP_TO_EDGE)}_updatePatternAtlas(){const e=[];for(const t in this.patterns)e.push(this.patterns[t].bin);const{w:i,h:r}=t.p(e),n=this.atlasImage;n.resize({width:i||1,height:r||1});for(const e in this.patterns){const{bin:i}=this.patterns[e],r=i.x+1,o=i.y+1,s=this.getImage(e).data,a=s.width,l=s.height;t.R.copy(s,n,{x:0,y:0},{x:r,y:o},{width:a,height:l}),t.R.copy(s,n,{x:0,y:l-1},{x:r,y:o-1},{width:a,height:1}),t.R.copy(s,n,{x:0,y:0},{x:r,y:o+l},{width:a,height:1}),t.R.copy(s,n,{x:a-1,y:0},{x:r-1,y:o},{width:1,height:l}),t.R.copy(s,n,{x:0,y:0},{x:r+a,y:o},{width:1,height:l})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(e){for(const i of e){if(this.callbackDispatchedThisFrame[i])continue;this.callbackDispatchedThisFrame[i]=!0;const e=this.getImage(i);e||t.w(`Image with ID: "${i}" was not found`),v(e)&&this.updateImage(i,e)}}}const b=1e20;function w(t,e,i,r,n,o,s,a,l){for(let c=e;c<e+r;c++)T(t,i*o+c,o,n,s,a,l);for(let c=i;c<i+n;c++)T(t,c*o+e,1,r,s,a,l)}function T(t,e,i,r,n,o,s){o[0]=0,s[0]=-b,s[1]=b,n[0]=t[e];for(let a=1,l=0,c=0;a<r;a++){n[a]=t[e+a*i];const r=a*a;do{const t=o[l];c=(n[a]-n[t]+r-t*t)/(a-t)/2}while(c<=s[l]&&--l>-1);l++,o[l]=a,s[l]=c,s[l+1]=b}for(let a=0,l=0;a<r;a++){for(;s[l+1]<a;)l++;const r=o[l],c=a-r;t[e+a*i]=n[r]+c*c}}class B{constructor(t,e){this.requestManager=t,this.localIdeographFontFamily=e,this.entries={}}setURL(t){this.url=t}getGlyphs(e,i){const r=[];for(const t in e)for(const i of e[t])r.push({stack:t,id:i});t.o(r,(({stack:t,id:e},i)=>{let r=this.entries[t];r||(r=this.entries[t]={glyphs:{},requests:{},ranges:{}});let n=r.glyphs[e];if(void 0!==n)return void i(null,{stack:t,id:e,glyph:n});if(n=this._tinySDF(r,t,e),n)return r.glyphs[e]=n,void i(null,{stack:t,id:e,glyph:n});const o=Math.floor(e/256);if(256*o>65535)return void i(new Error("glyphs > 65535 not supported"));if(r.ranges[o])return void i(null,{stack:t,id:e,glyph:n});if(!this.url)return void i(new Error("glyphsUrl is not set"));let s=r.requests[o];s||(s=r.requests[o]=[],B.loadGlyphRange(t,o,this.url,this.requestManager,((t,e)=>{if(e){for(const t in e)this._doesCharSupportLocalGlyph(+t)||(r.glyphs[+t]=e[+t]);r.ranges[o]=!0}for(const i of s)i(t,e);delete r.requests[o]}))),s.push(((r,n)=>{r?i(r):n&&i(null,{stack:t,id:e,glyph:n[e]||null})}))}),((t,e)=>{if(t)i(t);else if(e){const t={};for(const{stack:i,id:r,glyph:n}of e)(t[i]||(t[i]={}))[r]=n&&{id:n.id,bitmap:n.bitmap.clone(),metrics:n.metrics};i(null,t)}}))}_doesCharSupportLocalGlyph(e){return!!this.localIdeographFontFamily&&(t.u["CJK Unified Ideographs"](e)||t.u["Hangul Syllables"](e)||t.u.Hiragana(e)||t.u.Katakana(e))}_tinySDF(e,i,r){const n=this.localIdeographFontFamily;if(!n)return;if(!this._doesCharSupportLocalGlyph(r))return;let o=e.tinySDF;if(!o){let t="400";/bold/i.test(i)?t="900":/medium/i.test(i)?t="500":/light/i.test(i)&&(t="200"),o=e.tinySDF=new B.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:n,fontWeight:t})}const s=o.draw(String.fromCharCode(r));return{id:r,bitmap:new t.q({width:s.width||60,height:s.height||60},s.data),metrics:{width:s.glyphWidth/2||24,height:s.glyphHeight/2||24,left:s.glyphLeft/2+.5||0,top:s.glyphTop/2-27.5||-8,advance:s.glyphAdvance/2||24,isDoubleResolution:!0}}}}B.loadGlyphRange=function(e,i,r,n,o){const s=256*i,a=s+255,l=n.transformRequest(r.replace("{fontstack}",e).replace("{range}",`${s}-${a}`),u.Glyphs);t.l(l,((e,i)=>{if(e)o(e);else if(i){const e={};for(const r of t.n(i))e[r.id]=r;o(null,e)}}))},B.TinySDF=class{constructor({fontSize:t=24,buffer:e=3,radius:i=8,cutoff:r=.25,fontFamily:n="sans-serif",fontWeight:o="normal",fontStyle:s="normal"}={}){this.buffer=e,this.cutoff=r,this.radius=i;const a=this.size=t+4*e,l=this._createCanvas(a),c=this.ctx=l.getContext("2d",{willReadFrequently:!0});c.font=`${s} ${o} ${t}px ${n}`,c.textBaseline="alphabetic",c.textAlign="left",c.fillStyle="black",this.gridOuter=new Float64Array(a*a),this.gridInner=new Float64Array(a*a),this.f=new Float64Array(a),this.z=new Float64Array(a+1),this.v=new Uint16Array(a)}_createCanvas(t){const e=document.createElement("canvas");return e.width=e.height=t,e}draw(t){const{width:e,actualBoundingBoxAscent:i,actualBoundingBoxDescent:r,actualBoundingBoxLeft:n,actualBoundingBoxRight:o}=this.ctx.measureText(t),s=Math.ceil(i),a=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(o-n))),l=Math.min(this.size-this.buffer,s+Math.ceil(r)),c=a+2*this.buffer,u=l+2*this.buffer,h=Math.max(c*u,0),d=new Uint8ClampedArray(h),p={data:d,width:c,height:u,glyphWidth:a,glyphHeight:l,glyphTop:s,glyphLeft:0,glyphAdvance:e};if(0===a||0===l)return p;const{ctx:f,buffer:A,gridInner:m,gridOuter:g}=this;f.clearRect(A,A,a,l),f.fillText(t,A,A+s);const _=f.getImageData(A,A,a,l);g.fill(b,0,h),m.fill(0,0,h);for(let t=0;t<l;t++)for(let e=0;e<a;e++){const i=_.data[4*(t*a+e)+3]/255;if(0===i)continue;const r=(t+A)*c+e+A;if(1===i)g[r]=0,m[r]=b;else{const t=.5-i;g[r]=t>0?t*t:0,m[r]=t<0?t*t:0}}w(g,0,0,c,u,c,this.f,this.v,this.z),w(m,A,A,a,l,c,this.f,this.v,this.z);for(let t=0;t<h;t++){const e=Math.sqrt(g[t])-Math.sqrt(m[t]);d[t]=Math.round(255-255*(e/this.radius+this.cutoff))}return p}};class E{constructor(){this.specification=t.v.light.position}possiblyEvaluate(e,i){return t.z(e.expression.evaluate(i))}interpolate(e,i,r){return{x:t.B.number(e.x,i.x,r),y:t.B.number(e.y,i.y,r),z:t.B.number(e.z,i.z,r)}}}let C;class S extends t.E{constructor(e){super(),C=C||new t.r({anchor:new t.D(t.v.light.anchor),position:new E,color:new t.D(t.v.light.color),intensity:new t.D(t.v.light.intensity)}),this._transitionable=new t.T(C),this.setLight(e),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,i={}){if(!this._validate(t.t,e,i))for(const t in e){const i=e[t];t.endsWith("-transition")?this._transitionable.setTransition(t.slice(0,-11),i):this._transitionable.setValue(t,i)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(e,i,r){return(!r||!1!==r.validate)&&t.x(this,e.call(t.y,t.e({value:i,style:{glyphs:!0,sprite:!0},styleSpec:t.v})))}}class I{constructor(t,e){this.width=t,this.height=e,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(t,e){const i=t.join(",")+String(e);return this.dashEntry[i]||(this.dashEntry[i]=this.addDash(t,e)),this.dashEntry[i]}getDashRanges(t,e,i){const r=[];let n=t.length%2==1?-t[t.length-1]*i:0,o=t[0]*i,s=!0;r.push({left:n,right:o,isDash:s,zeroLength:0===t[0]});let a=t[0];for(let e=1;e<t.length;e++){s=!s;const l=t[e];n=a*i,a+=l,o=a*i,r.push({left:n,right:o,isDash:s,zeroLength:0===l})}return r}addRoundDash(t,e,i){const r=e/2;for(let e=-i;e<=i;e++){const n=this.width*(this.nextRow+i+e);let o=0,s=t[o];for(let a=0;a<this.width;a++){a/s.right>1&&(s=t[++o]);const l=Math.abs(a-s.left),c=Math.abs(a-s.right),u=Math.min(l,c);let h;const d=e/i*(r+1);if(s.isDash){const t=r-Math.abs(d);h=Math.sqrt(u*u+t*t)}else h=r-Math.sqrt(u*u+d*d);this.data[n+a]=Math.max(0,Math.min(255,h+128))}}}addRegularDash(t){for(let e=t.length-1;e>=0;--e){const i=t[e],r=t[e+1];i.zeroLength?t.splice(e,1):r&&r.isDash===i.isDash&&(r.left=i.left,t.splice(e,1))}const e=t[0],i=t[t.length-1];e.isDash===i.isDash&&(e.left=i.left-this.width,i.right=e.right+this.width);const r=this.width*this.nextRow;let n=0,o=t[n];for(let e=0;e<this.width;e++){e/o.right>1&&(o=t[++n]);const i=Math.abs(e-o.left),s=Math.abs(e-o.right),a=Math.min(i,s);this.data[r+e]=Math.max(0,Math.min(255,(o.isDash?a:-a)+128))}}addDash(e,i){const r=i?7:0,n=2*r+1;if(this.nextRow+n>this.height)return t.w("LineAtlas out of space"),null;let o=0;for(let t=0;t<e.length;t++)o+=e[t];if(0!==o){const t=this.width/o,n=this.getDashRanges(e,this.width,t);i?this.addRoundDash(n,t,r):this.addRegularDash(n)}const s={y:(this.nextRow+r+.5)/this.height,height:2*r/this.height,width:o};return this.nextRow+=n,this.dirty=!0,s}bind(t){const e=t.gl;this.texture?(e.bindTexture(e.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,e.texSubImage2D(e.TEXTURE_2D,0,0,0,this.width,this.height,e.ALPHA,e.UNSIGNED_BYTE,this.data))):(this.texture=e.createTexture(),e.bindTexture(e.TEXTURE_2D,this.texture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texImage2D(e.TEXTURE_2D,0,e.ALPHA,this.width,this.height,0,e.ALPHA,e.UNSIGNED_BYTE,this.data))}}class M{constructor(e,i,r){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=r;const n=this.workerPool.acquire(r);for(let e=0;e<n.length;e++){const o=new t.C(n[e],i,r);o.name=`Worker ${e}`,this.actors.push(o)}if(!this.actors.length)throw new Error("No actors found")}broadcast(e,i,r){t.o(this.actors,((t,r)=>{t.send(e,i,r)}),r=r||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(t=!0){this.actors.forEach((t=>{t.remove()})),this.actors=[],t&&this.workerPool.release(this.id)}}function k(e,i,r){const n=function(i,n){if(i)return r(i);if(n){const i=t.F(t.e(n,e),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);n.vector_layers&&(i.vectorLayers=n.vector_layers,i.vectorLayerIds=i.vectorLayers.map((t=>t.id))),r(null,i)}};return e.url?t.f(i.transformRequest(e.url,u.Source),n):t.h.frame((()=>n(null,e)))}class P{constructor(t,e){t&&(e?this.setSouthWest(t).setNorthEast(e):Array.isArray(t)&&(4===t.length?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1])))}setNorthEast(e){return this._ne=e instanceof t.L?new t.L(e.lng,e.lat):t.L.convert(e),this}setSouthWest(e){return this._sw=e instanceof t.L?new t.L(e.lng,e.lat):t.L.convert(e),this}extend(e){const i=this._sw,r=this._ne;let n,o;if(e instanceof t.L)n=e,o=e;else{if(!(e instanceof P))return Array.isArray(e)?4===e.length||e.every(Array.isArray)?this.extend(P.convert(e)):this.extend(t.L.convert(e)):e&&("lng"in e||"lon"in e)&&"lat"in e?this.extend(t.L.convert(e)):this;if(n=e._sw,o=e._ne,!n||!o)return this}return i||r?(i.lng=Math.min(n.lng,i.lng),i.lat=Math.min(n.lat,i.lat),r.lng=Math.max(o.lng,r.lng),r.lat=Math.max(o.lat,r.lat)):(this._sw=new t.L(n.lng,n.lat),this._ne=new t.L(o.lng,o.lat)),this}getCenter(){return new t.L((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new t.L(this.getWest(),this.getNorth())}getSouthEast(){return new t.L(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:i,lat:r}=t.L.convert(e);let n=this._sw.lng<=i&&i<=this._ne.lng;return this._sw.lng>this._ne.lng&&(n=this._sw.lng>=i&&i>=this._ne.lng),this._sw.lat<=r&&r<=this._ne.lat&&n}static convert(t){return t instanceof P?t:t?new P(t):t}static fromLngLat(e,i=0){const r=360*i/40075017,n=r/Math.cos(Math.PI/180*e.lat);return new P(new t.L(e.lng-n,e.lat-r),new t.L(e.lng+n,e.lat+r))}}class L{constructor(t,e,i){this.bounds=P.convert(this.validateBounds(t)),this.minzoom=e||0,this.maxzoom=i||24}validateBounds(t){return Array.isArray(t)&&4===t.length?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(e){const i=Math.pow(2,e.z),r=Math.floor(t.G(this.bounds.getWest())*i),n=Math.floor(t.H(this.bounds.getNorth())*i),o=Math.ceil(t.G(this.bounds.getEast())*i),s=Math.ceil(t.H(this.bounds.getSouth())*i);return e.x>=r&&e.x<o&&e.y>=n&&e.y<s}}class z extends t.E{constructor(e,i,r,n){if(super(),this.load=()=>{this._loaded=!1,this.fire(new t.k("dataloading",{dataType:"source"})),this._tileJSONRequest=k(this._options,this.map._requestManager,((e,i)=>{this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),e?this.fire(new t.j(e)):i&&(t.e(this,i),i.bounds&&(this.tileBounds=new L(i.bounds,this.minzoom,this.maxzoom)),this.fire(new t.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new t.k("data",{dataType:"source",sourceDataType:"content"})))}))},this.serialize=()=>t.e({},this._options),this.id=e,this.dispatcher=r,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,t.e(this,t.F(i,["url","scheme","tileSize","promoteId"])),this._options=t.e({type:"vector"},i),this._collectResourceTiming=i.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(n)}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.cancel(),t(),this.load()}setTiles(t){return this.setSourceProperty((()=>{this._options.tiles=t})),this}setUrl(t){return this.setSourceProperty((()=>{this.url=t,this._options.url=t})),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}loadTile(t,e){const i=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),r={request:this.map._requestManager.transformRequest(i,u.Tile),uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function n(i,r){return delete t.request,t.aborted?e(null):i&&404!==i.status?e(i):(r&&r.resourceTiming&&(t.resourceTiming=r.resourceTiming),this.map._refreshExpiredTiles&&r&&t.setExpiryData(r),t.loadVectorData(r,this.map.painter),e(null),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}r.request.collectResourceTiming=this._collectResourceTiming,t.actor&&"expired"!==t.state?"loading"===t.state?t.reloadCallback=e:t.request=t.actor.send("reloadTile",r,n.bind(this)):(t.actor=this.dispatcher.getActor(),t.request=t.actor.send("loadTile",r,n.bind(this)))}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id},void 0)}unloadTile(t){t.unloadVectorData(),t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id},void 0)}hasTransition(){return!1}}class F extends t.E{constructor(e,i,r,n){super(),this.id=e,this.dispatcher=r,this.setEventedParent(n),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=t.e({type:"raster"},i),t.e(this,t.F(i,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new t.k("dataloading",{dataType:"source"})),this._tileJSONRequest=k(this._options,this.map._requestManager,((e,i)=>{this._tileJSONRequest=null,this._loaded=!0,e?this.fire(new t.j(e)):i&&(t.e(this,i),i.bounds&&(this.tileBounds=new L(i.bounds,this.minzoom,this.maxzoom)),this.fire(new t.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new t.k("data",{dataType:"source",sourceDataType:"content"})))}))}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.cancel(),t(),this.load()}setTiles(t){return this.setSourceProperty((()=>{this._options.tiles=t})),this}serialize(){return t.e({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,e){const i=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);t.request=c.getImage(this.map._requestManager.transformRequest(i,u.Tile),((i,r,n)=>{if(delete t.request,t.aborted)t.state="unloaded",e(null);else if(i)t.state="errored",e(i);else if(r){this.map._refreshExpiredTiles&&n&&t.setExpiryData(n);const i=this.map.painter.context,o=i.gl;t.texture=this.map.painter.getTileTexture(r.width),t.texture?t.texture.update(r,{useMipmap:!0}):(t.texture=new y(i,r,o.RGBA,{useMipmap:!0}),t.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE,o.LINEAR_MIPMAP_NEAREST),i.extTextureFilterAnisotropic&&o.texParameterf(o.TEXTURE_2D,i.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,i.extTextureFilterAnisotropicMax)),t.state="loaded",e(null)}}),this.map._refreshExpiredTiles)}abortTile(t,e){t.request&&(t.request.cancel(),delete t.request),e()}unloadTile(t,e){t.texture&&this.map.painter.saveTileTexture(t.texture),e()}hasTransition(){return!1}}class D extends F{constructor(e,i,r,n){super(e,i,r,n),this.type="raster-dem",this.maxzoom=22,this._options=t.e({type:"raster-dem"},i),this.encoding=i.encoding||"mapbox",this.redFactor=i.redFactor,this.greenFactor=i.greenFactor,this.blueFactor=i.blueFactor,this.baseShift=i.baseShift}loadTile(e,i){const r=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),n=this.map._requestManager.transformRequest(r,u.Tile);function o(t,r){t&&(e.state="errored",i(t)),r&&(e.dem=r,e.needsHillshadePrepare=!0,e.needsTerrainPrepare=!0,e.state="loaded",i(null))}e.neighboringTiles=this._getNeighboringTiles(e.tileID),e.request=c.getImage(n,((r,n,s)=>t._(this,void 0,void 0,(function*(){if(delete e.request,e.aborted)e.state="unloaded",i(null);else if(r)e.state="errored",i(r);else if(n){this.map._refreshExpiredTiles&&e.setExpiryData(s);const i=t.a(n)&&t.J()?n:yield function(e){return t._(this,void 0,void 0,(function*(){if("undefined"!=typeof VideoFrame&&t.K()){const i=e.width+2,r=e.height+2;try{return new t.R({width:i,height:r},yield t.M(e,-1,-1,i,r))}catch(t){}}return t.h.getImageData(e,1)}))}(n),r={uid:e.uid,coord:e.tileID,source:this.id,rawImageData:i,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};e.actor&&"expired"!==e.state||(e.actor=this.dispatcher.getActor(),e.actor.send("loadDEMTile",r,o))}}))),this.map._refreshExpiredTiles)}_getNeighboringTiles(e){const i=e.canonical,r=Math.pow(2,i.z),n=(i.x-1+r)%r,o=0===i.x?e.wrap-1:e.wrap,s=(i.x+1+r)%r,a=i.x+1===r?e.wrap+1:e.wrap,l={};return l[new t.O(e.overscaledZ,o,i.z,n,i.y).key]={backfilled:!1},l[new t.O(e.overscaledZ,a,i.z,s,i.y).key]={backfilled:!1},i.y>0&&(l[new t.O(e.overscaledZ,o,i.z,n,i.y-1).key]={backfilled:!1},l[new t.O(e.overscaledZ,e.wrap,i.z,i.x,i.y-1).key]={backfilled:!1},l[new t.O(e.overscaledZ,a,i.z,s,i.y-1).key]={backfilled:!1}),i.y+1<r&&(l[new t.O(e.overscaledZ,o,i.z,n,i.y+1).key]={backfilled:!1},l[new t.O(e.overscaledZ,e.wrap,i.z,i.x,i.y+1).key]={backfilled:!1},l[new t.O(e.overscaledZ,a,i.z,s,i.y+1).key]={backfilled:!1}),l}unloadTile(t){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",t.actor&&t.actor.send("removeDEMTile",{uid:t.uid,source:this.id})}}class R extends t.E{constructor(e,i,r,n){super(),this.load=()=>{this._updateWorkerData()},this.serialize=()=>t.e({},this._options,{type:this.type,data:this._data}),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=r.getActor(),this.setEventedParent(n),this._data=i.data,this._options=t.e({},i),this._collectResourceTiming=i.collectResourceTiming,void 0!==i.maxzoom&&(this.maxzoom=i.maxzoom),i.type&&(this.type=i.type),i.attribution&&(this.attribution=i.attribution),this.promoteId=i.promoteId;const o=t.N/this.tileSize;this.workerOptions=t.e({source:this.id,cluster:i.cluster||!1,geojsonVtOptions:{buffer:(void 0!==i.buffer?i.buffer:128)*o,tolerance:(void 0!==i.tolerance?i.tolerance:.375)*o,extent:t.N,maxZoom:this.maxzoom,lineMetrics:i.lineMetrics||!1,generateId:i.generateId||!1},superclusterOptions:{maxZoom:void 0!==i.clusterMaxZoom?i.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,i.clusterMinPoints||2),extent:t.N,radius:(i.clusterRadius||50)*o,log:!1,generateId:i.generateId||!1},clusterProperties:i.clusterProperties,filter:i.filter},i.workerOptions),"string"==typeof this.promoteId&&(this.workerOptions.promoteId=this.promoteId)}onAdd(t){this.map=t,this.load()}setData(t){return this._data=t,this._updateWorkerData(),this}updateData(t){return this._updateWorkerData(t),this}setClusterOptions(t){return this.workerOptions.cluster=t.cluster,t&&(void 0!==t.clusterRadius&&(this.workerOptions.superclusterOptions.radius=t.clusterRadius),void 0!==t.clusterMaxZoom&&(this.workerOptions.superclusterOptions.maxZoom=t.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(t,e){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:t,source:this.id},e),this}getClusterChildren(t,e){return this.actor.send("geojson.getClusterChildren",{clusterId:t,source:this.id},e),this}getClusterLeaves(t,e,i,r){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:t,limit:e,offset:i},r),this}_updateWorkerData(e){const i=t.e({},this.workerOptions);e?i.dataDiff=e:"string"==typeof this._data?(i.request=this.map._requestManager.transformRequest(t.h.resolveURL(this._data),u.Source),i.request.collectResourceTiming=this._collectResourceTiming):i.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new t.k("dataloading",{dataType:"source"})),this.actor.send(`${this.type}.loadData`,i,((e,i)=>{if(this._pendingLoads--,this._removed||i&&i.abandoned)return void this.fire(new t.k("dataabort",{dataType:"source"}));let r=null;if(i&&i.resourceTiming&&i.resourceTiming[this.id]&&(r=i.resourceTiming[this.id].slice(0)),e)return void this.fire(new t.j(e));const n={dataType:"source"};this._collectResourceTiming&&r&&r.length>0&&t.e(n,{resourceTiming:r}),this.fire(new t.k("data",Object.assign(Object.assign({},n),{sourceDataType:"metadata"}))),this.fire(new t.k("data",Object.assign(Object.assign({},n),{sourceDataType:"content"})))}))}loaded(){return 0===this._pendingLoads}loadTile(t,e){const i=t.actor?"reloadTile":"loadTile";t.actor=this.actor;const r={type:this.type,uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};t.request=this.actor.send(i,r,((r,n)=>(delete t.request,t.unloadVectorData(),t.aborted?e(null):r?e(r):(t.loadVectorData(n,this.map.painter,"reloadTile"===i),e(null)))))}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.aborted=!0}unloadTile(t){t.unloadVectorData(),this.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id})}onRemove(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})}hasTransition(){return!1}}var U=t.Q([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class O extends t.E{constructor(e,i,r,n){super(),this.load=(e,i)=>{this._loaded=!1,this.fire(new t.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=c.getImage(this.map._requestManager.transformRequest(this.url,u.Image),((r,n)=>{this._request=null,this._loaded=!0,r?this.fire(new t.j(r)):n&&(this.image=n,e&&(this.coordinates=e),i&&i(),this._finishLoading())}))},this.prepare=()=>{if(0===Object.keys(this.tiles).length||!this.image)return;const e=this.map.painter.context,i=e.gl;this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,U.members)),this.boundsSegments||(this.boundsSegments=t.S.simpleSegment(0,0,4,2)),this.texture||(this.texture=new y(e,this.image,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE));let r=!1;for(const t in this.tiles){const e=this.tiles[t];"loaded"!==e.state&&(e.state="loaded",e.texture=this.texture,r=!0)}r&&this.fire(new t.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"image",url:this.options.url,coordinates:this.coordinates}),this.id=e,this.dispatcher=r,this.coordinates=i.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(n),this.options=i}loaded(){return this._loaded}updateImage(t){return t.url?(this._request&&(this._request.cancel(),this._request=null),this.options.url=t.url,this.load(t.coordinates,(()=>{this.texture=null})),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new t.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(){this._request&&(this._request.cancel(),this._request=null)}setCoordinates(e){this.coordinates=e;const i=e.map(t.U.fromLngLat);this.tileID=function(e){let i=1/0,r=1/0,n=-1/0,o=-1/0;for(const t of e)i=Math.min(i,t.x),r=Math.min(r,t.y),n=Math.max(n,t.x),o=Math.max(o,t.y);const s=Math.max(n-i,o-r),a=Math.max(0,Math.floor(-Math.log(s)/Math.LN2)),l=Math.pow(2,a);return new t.W(a,Math.floor((i+n)/2*l),Math.floor((r+o)/2*l))}(i),this.minzoom=this.maxzoom=this.tileID.z;const r=i.map((t=>this.tileID.getTilePoint(t)._round()));return this._boundsArray=new t.V,this._boundsArray.emplaceBack(r[0].x,r[0].y,0,0),this._boundsArray.emplaceBack(r[1].x,r[1].y,t.N,0),this._boundsArray.emplaceBack(r[3].x,r[3].y,0,t.N),this._boundsArray.emplaceBack(r[2].x,r[2].y,t.N,t.N),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new t.k("data",{dataType:"source",sourceDataType:"content"})),this}loadTile(t,e){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},e(null)):(t.state="errored",e(null))}hasTransition(){return!1}}class N extends O{constructor(e,i,r,n){super(e,i,r,n),this.load=()=>{this._loaded=!1;const e=this.options;this.urls=[];for(const t of e.urls)this.urls.push(this.map._requestManager.transformRequest(t,u.Source).url);t.X(this.urls,((e,i)=>{this._loaded=!0,e?this.fire(new t.j(e)):i&&(this.video=i,this.video.loop=!0,this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading())}))},this.prepare=()=>{if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const e=this.map.painter.context,i=e.gl;this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,U.members)),this.boundsSegments||(this.boundsSegments=t.S.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),i.texSubImage2D(i.TEXTURE_2D,0,0,0,i.RGBA,i.UNSIGNED_BYTE,this.video)):(this.texture=new y(e,this.video,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE));let r=!1;for(const t in this.tiles){const e=this.tiles[t];"loaded"!==e.state&&(e.state="loaded",e.texture=this.texture,r=!0)}r&&this.fire(new t.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"video",urls:this.urls,coordinates:this.coordinates}),this.roundZoom=!0,this.type="video",this.options=i}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){const i=this.video.seekable;e<i.start(0)||e>i.end(0)?this.fire(new t.j(new t.Y(`sources.${this.id}`,null,`Playback for this video can be set only between the ${i.start(0)} and ${i.end(0)}-second mark.`))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}hasTransition(){return this.video&&!this.video.paused}}class Q extends O{constructor(e,i,r,n){super(e,i,r,n),this.load=()=>{this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new t.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},this.prepare=()=>{let e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions())return;if(0===Object.keys(this.tiles).length)return;const i=this.map.painter.context,r=i.gl;this.boundsBuffer||(this.boundsBuffer=i.createVertexBuffer(this._boundsArray,U.members)),this.boundsSegments||(this.boundsSegments=t.S.simpleSegment(0,0,4,2)),this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new y(i,this.canvas,r.RGBA,{premultiply:!0});let n=!1;for(const t in this.tiles){const e=this.tiles[t];"loaded"!==e.state&&(e.state="loaded",e.texture=this.texture,n=!0)}n&&this.fire(new t.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"canvas",coordinates:this.coordinates}),i.coordinates?Array.isArray(i.coordinates)&&4===i.coordinates.length&&!i.coordinates.some((t=>!Array.isArray(t)||2!==t.length||t.some((t=>"number"!=typeof t))))||this.fire(new t.j(new t.Y(`sources.${e}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new t.j(new t.Y(`sources.${e}`,null,'missing required property "coordinates"'))),i.animate&&"boolean"!=typeof i.animate&&this.fire(new t.j(new t.Y(`sources.${e}`,null,'optional "animate" property must be a boolean value'))),i.canvas?"string"==typeof i.canvas||i.canvas instanceof HTMLCanvasElement||this.fire(new t.j(new t.Y(`sources.${e}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new t.j(new t.Y(`sources.${e}`,null,'missing required property "canvas"'))),this.options=i,this.animate=void 0===i.animate||i.animate}getCanvas(){return this.canvas}onAdd(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const t of[this.canvas.width,this.canvas.height])if(isNaN(t)||t<=0)return!0;return!1}}const V={},j=t=>{switch(t){case"geojson":return R;case"image":return O;case"raster":return F;case"raster-dem":return D;case"vector":return z;case"video":return N;case"canvas":return Q}return V[t]};function H(e,i){const r=t.Z();return t.$(r,r,[1,1,0]),t.a0(r,r,[.5*e.width,.5*e.height,1]),t.a1(r,r,e.calculatePosMatrix(i.toUnwrapped()))}function G(t,e,i,r,n,o){const s=function(t,e,i){if(t)for(const r of t){const t=e[r];if(t&&t.source===i&&"fill-extrusion"===t.type)return!0}else for(const t in e){const r=e[t];if(r.source===i&&"fill-extrusion"===r.type)return!0}return!1}(n&&n.layers,e,t.id),a=o.maxPitchScaleFactor(),l=t.tilesIn(r,a,s);l.sort($);const c=[];for(const r of l)c.push({wrappedTileID:r.tileID.wrapped().key,queryResults:r.tile.queryRenderedFeatures(e,i,t._state,r.queryGeometry,r.cameraQueryGeometry,r.scale,n,o,a,H(t.transform,r.tileID))});const u=function(t){const e={},i={};for(const r of t){const t=r.queryResults,n=r.wrappedTileID,o=i[n]=i[n]||{};for(const i in t){const r=t[i],n=o[i]=o[i]||{},s=e[i]=e[i]||[];for(const t of r)n[t.featureIndex]||(n[t.featureIndex]=!0,s.push(t))}}return e}(c);for(const e in u)u[e].forEach((e=>{const i=e.feature,r=t.getFeatureState(i.layer["source-layer"],i.id);i.source=i.layer.source,i.layer["source-layer"]&&(i.sourceLayer=i.layer["source-layer"]),i.state=r}));return u}function $(t,e){const i=t.tileID,r=e.tileID;return i.overscaledZ-r.overscaledZ||i.canonical.y-r.canonical.y||i.wrap-r.wrap||i.canonical.x-r.canonical.x}class Z{constructor(e,i){this.timeAdded=0,this.fadeEndTime=0,this.tileID=e,this.uid=t.a2(),this.uses=0,this.tileSize=i,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(t){const e=t+this.timeAdded;e<this.fadeEndTime||(this.fadeEndTime=e)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}clearTextures(t){this.demTexture&&t.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(e,i,r){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(t,e){const i={};if(!e)return i;for(const r of t){const t=r.layerIds.map((t=>e.getLayer(t))).filter(Boolean);if(0!==t.length){r.layers=t,r.stateDependentLayerIds&&(r.stateDependentLayers=r.stateDependentLayerIds.map((e=>t.filter((t=>t.id===e))[0])));for(const e of t)i[e.id]=r}}return i}(e.buckets,i.style),this.hasSymbolBuckets=!1;for(const e in this.buckets){const i=this.buckets[e];if(i instanceof t.a4){if(this.hasSymbolBuckets=!0,!r)break;i.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const e in this.buckets){const i=this.buckets[e];if(i instanceof t.a4&&i.hasRTLText){this.hasRTLText=!0,t.a5();break}}this.queryPadding=0;for(const t in this.buckets){const e=this.buckets[t];this.queryPadding=Math.max(this.queryPadding,i.style.getLayer(t).queryRadius(e))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage)}else this.collisionBoxArray=new t.a3}unloadVectorData(){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(t){return this.buckets[t.id]}upload(t){for(const e in this.buckets){const i=this.buckets[e];i.uploadPending()&&i.upload(t)}const e=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new y(t,this.imageAtlas.image,e.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new y(t,this.glyphAtlasImage,e.ALPHA),this.glyphAtlasImage=null)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,e,i,r,n,o,s,a,l,c){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:r,cameraQueryGeometry:n,scale:o,tileSize:this.tileSize,pixelPosMatrix:c,transform:a,params:s,queryPadding:this.queryPadding*l},t,e,i):{}}querySourceFeatures(e,i){const r=this.latestFeatureIndex;if(!r||!r.rawTileData)return;const n=r.loadVTLayers(),o=i&&i.sourceLayer?i.sourceLayer:"",s=n._geojsonTileLayer||n[o];if(!s)return;const a=t.a6(i&&i.filter),{z:l,x:c,y:u}=this.tileID.canonical,h={z:l,x:c,y:u};for(let i=0;i<s.length;i++){const n=s.feature(i);if(a.needGeometry){const e=t.a7(n,!0);if(!a.filter(new t.a8(this.tileID.overscaledZ),e,this.tileID.canonical))continue}else if(!a.filter(new t.a8(this.tileID.overscaledZ),n))continue;const d=r.getId(n,o),p=new t.a9(n,l,c,u,d);p.tile=h,e.push(p)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const i=this.expirationTime;if(e.cacheControl){const i=t.aa(e.cacheControl);i["max-age"]&&(this.expirationTime=Date.now()+1e3*i["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const t=Date.now();let e=!1;if(this.expirationTime>t)e=!1;else if(i)if(this.expirationTime<i)e=!0;else{const r=this.expirationTime-i;r?this.expirationTime=t+Math.max(r,3e4):e=!0}else e=!0;e?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(t,e){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(t).length)return;const i=this.latestFeatureIndex.loadVTLayers();for(const r in this.buckets){if(!e.style.hasLayer(r))continue;const n=this.buckets[r],o=n.layers[0].sourceLayer||"_geojsonTileLayer",s=i[o],a=t[o];if(!s||!a||0===Object.keys(a).length)continue;n.update(a,s,this.imageAtlas&&this.imageAtlas.patternPositions||{});const l=e&&e.style&&e.style.getLayer(r);l&&(this.queryPadding=Math.max(this.queryPadding,l.queryRadius(n)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<t.h.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=t.h.now()+e}setDependencies(t,e){const i={};for(const t of e)i[t]=!0;this.dependencies[t]=i}hasDependency(t,e){for(const i of t){const t=this.dependencies[i];if(t)for(const i of e)if(t[i])return!0}return!1}}class q{constructor(t,e){this.max=t,this.onRemove=e,this.reset()}reset(){for(const t in this.data)for(const e of this.data[t])e.timeout&&clearTimeout(e.timeout),this.onRemove(e.value);return this.data={},this.order=[],this}add(t,e,i){const r=t.wrapped().key;void 0===this.data[r]&&(this.data[r]=[]);const n={value:e,timeout:void 0};if(void 0!==i&&(n.timeout=setTimeout((()=>{this.remove(t,n)}),i)),this.data[r].push(n),this.order.push(r),this.order.length>this.max){const t=this._getAndRemoveByKey(this.order[0]);t&&this.onRemove(t)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const e=this.data[t].shift();return e.timeout&&clearTimeout(e.timeout),0===this.data[t].length&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),e.value}getByKey(t){const e=this.data[t];return e?e[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,e){if(!this.has(t))return this;const i=t.wrapped().key,r=void 0===e?0:this.data[i].indexOf(e),n=this.data[i][r];return this.data[i].splice(r,1),n.timeout&&clearTimeout(n.timeout),0===this.data[i].length&&delete this.data[i],this.onRemove(n.value),this.order.splice(this.order.indexOf(i),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const t=this._getAndRemoveByKey(this.order[0]);t&&this.onRemove(t)}return this}filter(t){const e=[];for(const i in this.data)for(const r of this.data[i])t(r.value)||e.push(r);for(const t of e)this.remove(t.value.tileID,t)}}class K{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,i,r){const n=String(i);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][n]=this.stateChanges[e][n]||{},t.e(this.stateChanges[e][n],r),null===this.deletedStates[e]){this.deletedStates[e]={};for(const t in this.state[e])t!==n&&(this.deletedStates[e][t]=null)}else if(this.deletedStates[e]&&null===this.deletedStates[e][n]){this.deletedStates[e][n]={};for(const t in this.state[e][n])r[t]||(this.deletedStates[e][n][t]=null)}else for(const t in r)this.deletedStates[e]&&this.deletedStates[e][n]&&null===this.deletedStates[e][n][t]&&delete this.deletedStates[e][n][t]}removeFeatureState(t,e,i){if(null===this.deletedStates[t])return;const r=String(e);if(this.deletedStates[t]=this.deletedStates[t]||{},i&&void 0!==e)null!==this.deletedStates[t][r]&&(this.deletedStates[t][r]=this.deletedStates[t][r]||{},this.deletedStates[t][r][i]=null);else if(void 0!==e)if(this.stateChanges[t]&&this.stateChanges[t][r])for(i in this.deletedStates[t][r]={},this.stateChanges[t][r])this.deletedStates[t][r][i]=null;else this.deletedStates[t][r]=null;else this.deletedStates[t]=null}getState(e,i){const r=String(i),n=t.e({},(this.state[e]||{})[r],(this.stateChanges[e]||{})[r]);if(null===this.deletedStates[e])return{};if(this.deletedStates[e]){const t=this.deletedStates[e][i];if(null===t)return{};for(const e in t)delete n[e]}return n}initializeTileState(t,e){t.setFeatureState(this.state,e)}coalesceChanges(e,i){const r={};for(const e in this.stateChanges){this.state[e]=this.state[e]||{};const i={};for(const r in this.stateChanges[e])this.state[e][r]||(this.state[e][r]={}),t.e(this.state[e][r],this.stateChanges[e][r]),i[r]=this.state[e][r];r[e]=i}for(const e in this.deletedStates){this.state[e]=this.state[e]||{};const i={};if(null===this.deletedStates[e])for(const t in this.state[e])i[t]={},this.state[e][t]={};else for(const t in this.deletedStates[e]){if(null===this.deletedStates[e][t])this.state[e][t]={};else for(const i of Object.keys(this.deletedStates[e][t]))delete this.state[e][t][i];i[t]=this.state[e][t]}r[e]=r[e]||{},t.e(r[e],i)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(r).length)for(const t in e)e[t].setFeatureState(r,i)}}class W extends t.E{constructor(t,e,i){super(),this.id=t,this.dispatcher=i,this.on("data",(t=>{"source"===t.dataType&&"metadata"===t.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===t.dataType&&"content"===t.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)})),this.on("dataloading",(()=>{this._sourceErrored=!1})),this.on("error",(()=>{this._sourceErrored=this._source.loaded()})),this._source=((t,e,i,r)=>{const n=new(j(e.type))(t,e,i,r);if(n.id!==t)throw new Error(`Expected Source id to be ${t} instead of ${n.id}`);return n})(t,e,i,this),this._tiles={},this._cache=new q(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new K,this._didEmitContent=!1,this._updated=!1}onAdd(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._maxTileCacheZoomLevels=t?t._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(t)}onRemove(t){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(t)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded)return!1;if(!this._source.loaded())return!1;if(!(void 0===this.used&&void 0===this.usedForTerrain||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const t in this._tiles){const e=this._tiles[t];if("loaded"!==e.state&&"errored"!==e.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(t,e){return this._source.loadTile(t,e)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t,(()=>{}))}_abortTile(e){this._source.abortTile&&this._source.abortTile(e,(()=>{})),this._source.fire(new t.k("dataabort",{tile:e,coord:e.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const e in this._tiles){const i=this._tiles[e];i.upload(t),i.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map((t=>t.tileID)).sort(X).map((t=>t.key))}getRenderableIds(e){const i=[];for(const t in this._tiles)this._isIdRenderable(t,e)&&i.push(this._tiles[t]);return e?i.sort(((e,i)=>{const r=e.tileID,n=i.tileID,o=new t.P(r.canonical.x,r.canonical.y)._rotate(this.transform.angle),s=new t.P(n.canonical.x,n.canonical.y)._rotate(this.transform.angle);return r.overscaledZ-n.overscaledZ||s.y-o.y||s.x-o.x})).map((t=>t.tileID.key)):i.map((t=>t.tileID)).sort(X).map((t=>t.key))}hasRenderableParent(t){const e=this.findLoadedParent(t,0);return!!e&&this._isIdRenderable(e.tileID.key)}_isIdRenderable(t,e){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(e||!this._tiles[t].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)"errored"!==this._tiles[t].state&&this._reloadTile(t,"reloading")}}_reloadTile(t,e){const i=this._tiles[t];i&&("loading"!==i.state&&(i.state=e),this._loadTile(i,this._tileLoaded.bind(this,i,t,e)))}_tileLoaded(e,i,r,n){if(n)return e.state="errored",void(404!==n.status?this._source.fire(new t.j(n,{tile:e})):this.update(this.transform,this.terrain));e.timeAdded=t.h.now(),"expired"===r&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(i,e),"raster-dem"===this.getSource().type&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),e.aborted||this._source.fire(new t.k("data",{dataType:"source",tile:e,coord:e.tileID}))}_backfillDEM(t){const e=this.getRenderableIds();for(let r=0;r<e.length;r++){const n=e[r];if(t.neighboringTiles&&t.neighboringTiles[n]){const e=this.getTileByID(n);i(t,e),i(e,t)}}function i(t,e){t.needsHillshadePrepare=!0,t.needsTerrainPrepare=!0;let i=e.tileID.canonical.x-t.tileID.canonical.x;const r=e.tileID.canonical.y-t.tileID.canonical.y,n=Math.pow(2,t.tileID.canonical.z),o=e.tileID.key;0===i&&0===r||Math.abs(r)>1||(Math.abs(i)>1&&(1===Math.abs(i+n)?i+=n:1===Math.abs(i-n)&&(i-=n)),e.dem&&t.dem&&(t.dem.backfillBorder(e.dem,i,r),t.neighboringTiles&&t.neighboringTiles[o]&&(t.neighboringTiles[o].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,e,i,r){for(const n in this._tiles){let o=this._tiles[n];if(r[n]||!o.hasData()||o.tileID.overscaledZ<=e||o.tileID.overscaledZ>i)continue;let s=o.tileID;for(;o&&o.tileID.overscaledZ>e+1;){const t=o.tileID.scaledTo(o.tileID.overscaledZ-1);o=this._tiles[t.key],o&&o.hasData()&&(s=t)}let a=s;for(;a.overscaledZ>e;)if(a=a.scaledTo(a.overscaledZ-1),t[a.key]){r[s.key]=s;break}}}findLoadedParent(t,e){if(t.key in this._loadedParentTiles){const i=this._loadedParentTiles[t.key];return i&&i.tileID.overscaledZ>=e?i:null}for(let i=t.overscaledZ-1;i>=e;i--){const e=t.scaledTo(i),r=this._getLoadedTile(e);if(r)return r}}_getLoadedTile(t){const e=this._tiles[t.key];return e&&e.hasData()?e:this._cache.getByKey(t.wrapped().key)}updateCacheSize(e){const i=Math.ceil(e.width/this._source.tileSize)+1,r=Math.ceil(e.height/this._source.tileSize)+1,n=Math.floor(i*r*(null===this._maxTileCacheZoomLevels?t.c.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),o="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,n):n;this._cache.setMaxSize(o)}handleWrapJump(t){const e=Math.round((t-(void 0===this._prevLng?t:this._prevLng))/360);if(this._prevLng=t,e){const t={};for(const i in this._tiles){const r=this._tiles[i];r.tileID=r.tileID.unwrapTo(r.tileID.wrap+e),t[r.tileID.key]=r}this._tiles=t;for(const t in this._timers)clearTimeout(this._timers[t]),delete this._timers[t];for(const t in this._tiles)this._setTileReloadTimer(t,this._tiles[t])}}update(e,i){if(this.transform=e,this.terrain=i,!this._sourceLoaded||this._paused)return;let r;this.updateCacheSize(e),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?r=e.getVisibleUnwrappedCoordinates(this._source.tileID).map((e=>new t.O(e.canonical.z,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y))):(r=e.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:i}),this._source.hasTile&&(r=r.filter((t=>this._source.hasTile(t))))):r=[];const n=e.coveringZoomLevel(this._source),o=Math.max(n-W.maxOverzooming,this._source.minzoom),s=Math.max(n+W.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const t={};for(const e of r)if(e.canonical.z>this._source.minzoom){const i=e.scaledTo(e.canonical.z-1);t[i.key]=i;const r=e.scaledTo(Math.max(this._source.minzoom,Math.min(e.canonical.z,5)));t[r.key]=r}r=r.concat(Object.values(t))}const a=0===r.length&&!this._updated&&this._didEmitContent;this._updated=!0,a&&this.fire(new t.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const l=this._updateRetainedTiles(r,n);if(J(this._source.type)){const e={},a={},c=Object.keys(l),u=t.h.now();for(const t of c){const i=l[t],r=this._tiles[t];if(!r||0!==r.fadeEndTime&&r.fadeEndTime<=u)continue;const n=this.findLoadedParent(i,o);n&&(this._addTile(n.tileID),e[n.tileID.key]=n.tileID),a[t]=i}this._retainLoadedChildren(a,n,s,l);for(const t in e)l[t]||(this._coveredTiles[t]=!0,l[t]=e[t]);if(i){const t={},e={};for(const i of r)this._tiles[i.key].hasData()?t[i.key]=i:e[i.key]=i;for(const i in e){const r=e[i].children(this._source.maxzoom);this._tiles[r[0].key]&&this._tiles[r[1].key]&&this._tiles[r[2].key]&&this._tiles[r[3].key]&&(t[r[0].key]=l[r[0].key]=r[0],t[r[1].key]=l[r[1].key]=r[1],t[r[2].key]=l[r[2].key]=r[2],t[r[3].key]=l[r[3].key]=r[3],delete e[i])}for(const i in e){const r=this.findLoadedParent(e[i],this._source.minzoom);if(r){t[r.tileID.key]=l[r.tileID.key]=r.tileID;for(const e in t)t[e].isChildOf(r.tileID)&&delete t[e]}}for(const e in this._tiles)t[e]||(this._coveredTiles[e]=!0)}}for(const t in l)this._tiles[t].clearFadeHold();const c=t.ab(this._tiles,l);for(const t of c){const e=this._tiles[t];e.hasSymbolBuckets&&!e.holdingForFade()?e.setHoldDuration(this.map._fadeDuration):e.hasSymbolBuckets&&!e.symbolFadeFinished()||this._removeTile(t)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(t)}_updateRetainedTiles(t,e){const i={},r={},n=Math.max(e-W.maxOverzooming,this._source.minzoom),o=Math.max(e+W.maxUnderzooming,this._source.minzoom),s={};for(const r of t){const t=this._addTile(r);i[r.key]=r,t.hasData()||e<this._source.maxzoom&&(s[r.key]=r)}this._retainLoadedChildren(s,e,o,i);for(const o of t){let t=this._tiles[o.key];if(t.hasData())continue;if(e+1>this._source.maxzoom){const t=o.children(this._source.maxzoom)[0],e=this.getTile(t);if(e&&e.hasData()){i[t.key]=t;continue}}else{const t=o.children(this._source.maxzoom);if(i[t[0].key]&&i[t[1].key]&&i[t[2].key]&&i[t[3].key])continue}let s=t.wasRequested();for(let e=o.overscaledZ-1;e>=n;--e){const n=o.scaledTo(e);if(r[n.key])break;if(r[n.key]=!0,t=this.getTile(n),!t&&s&&(t=this._addTile(n)),t){const e=t.hasData();if((s||e)&&(i[n.key]=n),s=t.wasRequested(),e)break}}}return i}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const e=[];let i,r=this._tiles[t].tileID;for(;r.overscaledZ>0;){if(r.key in this._loadedParentTiles){i=this._loadedParentTiles[r.key];break}e.push(r.key);const t=r.scaledTo(r.overscaledZ-1);if(i=this._getLoadedTile(t),i)break;r=t}for(const t of e)this._loadedParentTiles[t]=i}}_addTile(e){let i=this._tiles[e.key];if(i)return i;i=this._cache.getAndRemove(e),i&&(this._setTileReloadTimer(e.key,i),i.tileID=e,this._state.initializeTileState(i,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,i)));const r=i;return i||(i=new Z(e,this._source.tileSize*e.overscaleFactor()),this._loadTile(i,this._tileLoaded.bind(this,i,e.key,i.state))),i.uses++,this._tiles[e.key]=i,r||this._source.fire(new t.k("dataloading",{tile:i,coord:i.tileID,dataType:"source"})),i}_setTileReloadTimer(t,e){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const i=e.getExpiryTimeout();i&&(this._timers[t]=setTimeout((()=>{this._reloadTile(t,"expired"),delete this._timers[t]}),i))}_removeTile(t){const e=this._tiles[t];e&&(e.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),e.uses>0||(e.hasData()&&"reloading"!==e.state?this._cache.add(e.tileID,e,e.getExpiryTimeout()):(e.aborted=!0,this._abortTile(e),this._unloadTile(e))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(t);this._cache.reset()}tilesIn(e,i,r){const n=[],o=this.transform;if(!o)return n;const s=r?o.getCameraQueryGeometry(e):e,a=e.map((t=>o.pointCoordinate(t,this.terrain))),l=s.map((t=>o.pointCoordinate(t,this.terrain))),c=this.getIds();let u=1/0,h=1/0,d=-1/0,p=-1/0;for(const t of l)u=Math.min(u,t.x),h=Math.min(h,t.y),d=Math.max(d,t.x),p=Math.max(p,t.y);for(let e=0;e<c.length;e++){const r=this._tiles[c[e]];if(r.holdingForFade())continue;const s=r.tileID,f=Math.pow(2,o.zoom-r.tileID.overscaledZ),A=i*r.queryPadding*t.N/r.tileSize/f,m=[s.getTilePoint(new t.U(u,h)),s.getTilePoint(new t.U(d,p))];if(m[0].x-A<t.N&&m[0].y-A<t.N&&m[1].x+A>=0&&m[1].y+A>=0){const t=a.map((t=>s.getTilePoint(t))),e=l.map((t=>s.getTilePoint(t)));n.push({tile:r,tileID:s,queryGeometry:t,cameraQueryGeometry:e,scale:f})}}return n}getVisibleCoordinates(t){const e=this.getRenderableIds(t).map((t=>this._tiles[t].tileID));for(const t of e)t.posMatrix=this.transform.calculatePosMatrix(t.toUnwrapped());return e}hasTransition(){if(this._source.hasTransition())return!0;if(J(this._source.type)){const e=t.h.now();for(const t in this._tiles)if(this._tiles[t].fadeEndTime>=e)return!0}return!1}setFeatureState(t,e,i){this._state.updateState(t=t||"_geojsonTileLayer",e,i)}removeFeatureState(t,e,i){this._state.removeFeatureState(t=t||"_geojsonTileLayer",e,i)}getFeatureState(t,e){return this._state.getState(t=t||"_geojsonTileLayer",e)}setDependencies(t,e,i){const r=this._tiles[t];r&&r.setDependencies(e,i)}reloadTilesForDependencies(t,e){for(const i in this._tiles)this._tiles[i].hasDependency(t,e)&&this._reloadTile(i,"reloading");this._cache.filter((i=>!i.hasDependency(t,e)))}}function X(t,e){const i=Math.abs(2*t.wrap)-+(t.wrap<0),r=Math.abs(2*e.wrap)-+(e.wrap<0);return t.overscaledZ-e.overscaledZ||r-i||e.canonical.y-t.canonical.y||e.canonical.x-t.canonical.x}function J(t){return"raster"===t||"image"===t||"video"===t}W.maxOverzooming=10,W.maxUnderzooming=3;const Y="mapboxgl_preloaded_worker_pool";class tt{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<tt.workerCount;)this.workers.push(new Worker(t.c.WORKER_URL));return this.active[e]=!0,this.workers.slice()}release(t){delete this.active[t],0===this.numActive()&&(this.workers.forEach((t=>{t.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[Y]}numActive(){return Object.keys(this.active).length}}const et=Math.floor(t.h.hardwareConcurrency/2);let it;function rt(){return it||(it=new tt),it}tt.workerCount=t.ac(globalThis)?Math.max(Math.min(et,3),1):1;class nt{constructor(t,e){this.reset(t,e)}reset(t,e){this.points=t||[],this._distances=[0];for(let t=1;t<this.points.length;t++)this._distances[t]=this._distances[t-1]+this.points[t].dist(this.points[t-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(e||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(1===this.points.length)return this.points[0];e=t.ad(e,0,1);let i=1,r=this._distances[i];const n=e*this.paddedLength+this.padding;for(;r<n&&i<this._distances.length;)r=this._distances[++i];const o=i-1,s=this._distances[o],a=r-s,l=a>0?(n-s)/a:0;return this.points[o].mult(1-l).add(this.points[i].mult(l))}}function ot(t,e){let i=!0;return"always"===t||"never"!==t&&"never"!==e||(i=!1),i}class st{constructor(t,e,i){const r=this.boxCells=[],n=this.circleCells=[];this.xCellCount=Math.ceil(t/i),this.yCellCount=Math.ceil(e/i);for(let t=0;t<this.xCellCount*this.yCellCount;t++)r.push([]),n.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=e,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/e,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,e,i,r,n){this._forEachCell(e,i,r,n,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(e),this.bboxes.push(i),this.bboxes.push(r),this.bboxes.push(n)}insertCircle(t,e,i,r){this._forEachCell(e-r,i-r,e+r,i+r,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(e),this.circles.push(i),this.circles.push(r)}_insertBoxCell(t,e,i,r,n,o){this.boxCells[n].push(o)}_insertCircleCell(t,e,i,r,n,o){this.circleCells[n].push(o)}_query(t,e,i,r,n,o,s){if(i<0||t>this.width||r<0||e>this.height)return[];const a=[];if(t<=0&&e<=0&&this.width<=i&&this.height<=r){if(n)return[{key:null,x1:t,y1:e,x2:i,y2:r}];for(let t=0;t<this.boxKeys.length;t++)a.push({key:this.boxKeys[t],x1:this.bboxes[4*t],y1:this.bboxes[4*t+1],x2:this.bboxes[4*t+2],y2:this.bboxes[4*t+3]});for(let t=0;t<this.circleKeys.length;t++){const e=this.circles[3*t],i=this.circles[3*t+1],r=this.circles[3*t+2];a.push({key:this.circleKeys[t],x1:e-r,y1:i-r,x2:e+r,y2:i+r})}}else this._forEachCell(t,e,i,r,this._queryCell,a,{hitTest:n,overlapMode:o,seenUids:{box:{},circle:{}}},s);return a}query(t,e,i,r){return this._query(t,e,i,r,!1,null)}hitTest(t,e,i,r,n,o){return this._query(t,e,i,r,!0,n,o).length>0}hitTestCircle(t,e,i,r,n){const o=t-i,s=t+i,a=e-i,l=e+i;if(s<0||o>this.width||l<0||a>this.height)return!1;const c=[];return this._forEachCell(o,a,s,l,this._queryCellCircle,c,{hitTest:!0,overlapMode:r,circle:{x:t,y:e,radius:i},seenUids:{box:{},circle:{}}},n),c.length>0}_queryCell(t,e,i,r,n,o,s,a){const{seenUids:l,hitTest:c,overlapMode:u}=s,h=this.boxCells[n];if(null!==h){const n=this.bboxes;for(const s of h)if(!l.box[s]){l.box[s]=!0;const h=4*s,d=this.boxKeys[s];if(t<=n[h+2]&&e<=n[h+3]&&i>=n[h+0]&&r>=n[h+1]&&(!a||a(d))&&(!c||!ot(u,d.overlapMode))&&(o.push({key:d,x1:n[h],y1:n[h+1],x2:n[h+2],y2:n[h+3]}),c))return!0}}const d=this.circleCells[n];if(null!==d){const n=this.circles;for(const s of d)if(!l.circle[s]){l.circle[s]=!0;const h=3*s,d=this.circleKeys[s];if(this._circleAndRectCollide(n[h],n[h+1],n[h+2],t,e,i,r)&&(!a||a(d))&&(!c||!ot(u,d.overlapMode))){const t=n[h],e=n[h+1],i=n[h+2];if(o.push({key:d,x1:t-i,y1:e-i,x2:t+i,y2:e+i}),c)return!0}}}return!1}_queryCellCircle(t,e,i,r,n,o,s,a){const{circle:l,seenUids:c,overlapMode:u}=s,h=this.boxCells[n];if(null!==h){const t=this.bboxes;for(const e of h)if(!c.box[e]){c.box[e]=!0;const i=4*e,r=this.boxKeys[e];if(this._circleAndRectCollide(l.x,l.y,l.radius,t[i+0],t[i+1],t[i+2],t[i+3])&&(!a||a(r))&&!ot(u,r.overlapMode))return o.push(!0),!0}}const d=this.circleCells[n];if(null!==d){const t=this.circles;for(const e of d)if(!c.circle[e]){c.circle[e]=!0;const i=3*e,r=this.circleKeys[e];if(this._circlesCollide(t[i],t[i+1],t[i+2],l.x,l.y,l.radius)&&(!a||a(r))&&!ot(u,r.overlapMode))return o.push(!0),!0}}}_forEachCell(t,e,i,r,n,o,s,a){const l=this._convertToXCellCoord(t),c=this._convertToYCellCoord(e),u=this._convertToXCellCoord(i),h=this._convertToYCellCoord(r);for(let d=l;d<=u;d++)for(let l=c;l<=h;l++)if(n.call(this,t,e,i,r,this.xCellCount*l+d,o,s,a))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,e,i,r,n,o){const s=r-t,a=n-e,l=i+o;return l*l>s*s+a*a}_circleAndRectCollide(t,e,i,r,n,o,s){const a=(o-r)/2,l=Math.abs(t-(r+a));if(l>a+i)return!1;const c=(s-n)/2,u=Math.abs(e-(n+c));if(u>c+i)return!1;if(l<=a||u<=c)return!0;const h=l-a,d=u-c;return h*h+d*d<=i*i}}function at(e,i,r,n,o){const s=t.Z();return i?(t.a0(s,s,[1/o,1/o,1]),r||t.ae(s,s,n.angle)):t.a1(s,n.labelPlaneMatrix,e),s}function lt(e,i,r,n,o){if(i){const i=t.af(e);return t.a0(i,i,[o,o,1]),r||t.ae(i,i,-n.angle),i}return n.glCoordMatrix}function ct(e,i,r){let n;r?(n=[e.x,e.y,r(e.x,e.y),1],t.ag(n,n,i)):(n=[e.x,e.y,0,1],wt(n,n,i));const o=n[3];return{point:new t.P(n[0]/o,n[1]/o),signedDistanceFromCamera:o}}function ut(t,e){return.5+t/e*.5}function ht(t,e){const i=t[0]/t[3],r=t[1]/t[3];return i>=-e[0]&&i<=e[0]&&r>=-e[1]&&r<=e[1]}function dt(e,i,r,n,o,s,a,l,c,u){const h=n?e.textSizeData:e.iconSizeData,d=t.ah(h,r.transform.zoom),p=[256/r.width*2+1,256/r.height*2+1],f=n?e.text.dynamicLayoutVertexArray:e.icon.dynamicLayoutVertexArray;f.clear();const A=e.lineVertexArray,m=n?e.text.placedSymbolArray:e.icon.placedSymbolArray,g=r.transform.width/r.transform.height;let _=!1;for(let n=0;n<m.length;n++){const y=m.get(n);if(y.hidden||y.writingMode===t.ai.vertical&&!_){bt(y.numGlyphs,f);continue}let v;if(_=!1,u?(v=[y.anchorX,y.anchorY,u(y.anchorX,y.anchorY),1],t.ag(v,v,i)):(v=[y.anchorX,y.anchorY,0,1],wt(v,v,i)),!ht(v,p)){bt(y.numGlyphs,f);continue}const x=ut(r.transform.cameraToCenterDistance,v[3]),b=t.aj(h,d,y),w=a?b/x:b*x,T=new t.P(y.anchorX,y.anchorY),B=ct(T,o,u).point,E={projections:{},offsets:{}},C=At(y,w,!1,l,i,o,s,e.glyphOffsetArray,A,f,B,T,E,g,c,u);_=C.useVertical,(C.notEnoughRoom||_||C.needsFlipping&&At(y,w,!0,l,i,o,s,e.glyphOffsetArray,A,f,B,T,E,g,c,u).notEnoughRoom)&&bt(y.numGlyphs,f)}n?e.text.dynamicLayoutVertexBuffer.updateData(f):e.icon.dynamicLayoutVertexBuffer.updateData(f)}function pt(t,e,i,r,n,o,s,a,l,c,u,h,d){const p=a.glyphStartIndex+a.numGlyphs,f=a.lineStartIndex,A=a.lineStartIndex+a.lineLength,m=e.getoffsetX(a.glyphStartIndex),g=e.getoffsetX(p-1),_=vt(t*m,i,r,n,o,s,a.segment,f,A,l,c,u,h,d);if(!_)return null;const y=vt(t*g,i,r,n,o,s,a.segment,f,A,l,c,u,h,d);return y?{first:_,last:y}:null}function ft(e,i,r,n){return e===t.ai.horizontal&&Math.abs(r.y-i.y)>Math.abs(r.x-i.x)*n?{useVertical:!0}:(e===t.ai.vertical?i.y<r.y:i.x>r.x)?{needsFlipping:!0}:null}function At(e,i,r,n,o,s,a,l,c,u,h,d,p,f,A,m){const g=i/24,_=e.lineOffsetX*g,y=e.lineOffsetY*g;let v;if(e.numGlyphs>1){const t=e.glyphStartIndex+e.numGlyphs,i=e.lineStartIndex,o=e.lineStartIndex+e.lineLength,u=pt(g,l,_,y,r,h,d,e,c,s,p,A,m);if(!u)return{notEnoughRoom:!0};const x=ct(u.first.point,a,m).point,b=ct(u.last.point,a,m).point;if(n&&!r){const t=ft(e.writingMode,x,b,f);if(t)return t}v=[u.first];for(let n=e.glyphStartIndex+1;n<t-1;n++)v.push(vt(g*l.getoffsetX(n),_,y,r,h,d,e.segment,i,o,c,s,p,A,m));v.push(u.last)}else{if(n&&!r){const i=ct(d,o,m).point,r=e.lineStartIndex+e.segment+1,n=new t.P(c.getx(r),c.gety(r)),s=ct(n,o,m),a=s.signedDistanceFromCamera>0?s.point:mt(d,n,i,1,o,m),l=ft(e.writingMode,i,a,f);if(l)return l}const i=vt(g*l.getoffsetX(e.glyphStartIndex),_,y,r,h,d,e.segment,e.lineStartIndex,e.lineStartIndex+e.lineLength,c,s,p,A,m);if(!i)return{notEnoughRoom:!0};v=[i]}for(const e of v)t.ak(u,e.point,e.angle);return{}}function mt(t,e,i,r,n,o){const s=ct(t.add(t.sub(e)._unit()),n,o).point,a=i.sub(s);return i.add(a._mult(r/a.mag()))}function gt(e,i){const{projectionCache:r,lineVertexArray:n,labelPlaneMatrix:o,tileAnchorPoint:s,distanceFromAnchor:a,getElevation:l,previousVertex:c,direction:u,absOffsetX:h}=i;if(r.projections[e])return r.projections[e];const d=new t.P(n.getx(e),n.gety(e)),p=ct(d,o,l);if(p.signedDistanceFromCamera>0)return r.projections[e]=p.point,p.point;const f=e-u;return mt(0===a?s:new t.P(n.getx(f),n.gety(f)),d,c,h-a+1,o,l)}function _t(t,e,i){return t._unit()._perp()._mult(e*i)}function yt(e,i,r,n,o,s,a,l){const{projectionCache:c,direction:u}=l;if(c.offsets[e])return c.offsets[e];const h=r.add(i);if(e+u<n||e+u>=o)return c.offsets[e]=h,h;const d=gt(e+u,l),p=_t(d.sub(r),a,u),f=r.add(p),A=d.add(p);return c.offsets[e]=t.al(s,h,f,A)||h,c.offsets[e]}function vt(t,e,i,r,n,o,s,a,l,c,u,h,d,p){const f=r?t-e:t+e;let A=f>0?1:-1,m=0;r&&(A*=-1,m=Math.PI),A<0&&(m+=Math.PI);let g,_,y=A>0?a+s:a+s+1,v=n,x=n,b=0,w=0;const T=Math.abs(f),B=[];let E;for(;b+w<=T;){if(y+=A,y<a||y>=l)return null;b+=w,x=v,_=g;const t={projectionCache:h,lineVertexArray:c,labelPlaneMatrix:u,tileAnchorPoint:o,distanceFromAnchor:b,getElevation:p,previousVertex:x,direction:A,absOffsetX:T};if(v=gt(y,t),0===i)B.push(x),E=v.sub(x);else{let e;const r=v.sub(x);e=0===r.mag()?_t(gt(y+A,t).sub(v),i,A):_t(r,i,A),_||(_=x.add(e)),g=yt(y,e,v,a,l,_,i,t),B.push(_),E=g.sub(_)}w=E.mag()}const C=E._mult((T-b)/w)._add(_||x),S=m+Math.atan2(v.y-x.y,v.x-x.x);return B.push(C),{point:C,angle:d?S:0,path:B}}const xt=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function bt(t,e){for(let i=0;i<t;i++){const t=e.length;e.resize(t+4),e.float32.set(xt,3*t)}}function wt(t,e,i){const r=e[0],n=e[1];return t[0]=i[0]*r+i[4]*n+i[12],t[1]=i[1]*r+i[5]*n+i[13],t[3]=i[3]*r+i[7]*n+i[15],t}const Tt=100;class Bt{constructor(t,e=new st(t.width+200,t.height+200,25),i=new st(t.width+200,t.height+200,25)){this.transform=t,this.grid=e,this.ignoredGrid=i,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+Tt,this.screenBottomBoundary=t.height+Tt,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(t,e,i,r,n,o){const s=this.projectAndGetPerspectiveRatio(r,t.anchorPointX,t.anchorPointY,o),a=i*s.perspectiveRatio,l=t.x1*a+s.point.x,c=t.y1*a+s.point.y,u=t.x2*a+s.point.x,h=t.y2*a+s.point.y;return!this.isInsideGrid(l,c,u,h)||"always"!==e&&this.grid.hitTest(l,c,u,h,e,n)||s.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[l,c,u,h],offscreen:this.isOffscreen(l,c,u,h)}}placeCollisionCircles(e,i,r,n,o,s,a,l,c,u,h,d,p,f){const A=[],m=new t.P(i.anchorX,i.anchorY),g=ct(m,s,f),_=ut(this.transform.cameraToCenterDistance,g.signedDistanceFromCamera),y=(u?o/_:o*_)/t.ap,v=ct(m,a,f).point,x=pt(y,n,i.lineOffsetX*y,i.lineOffsetY*y,!1,v,m,i,r,a,{projections:{},offsets:{}},!1,f);let b=!1,w=!1,T=!0;if(x){const i=.5*d*_+p,r=new t.P(-100,-100),n=new t.P(this.screenRightBoundary,this.screenBottomBoundary),o=new nt,s=x.first,a=x.last;let u=[];for(let t=s.path.length-1;t>=1;t--)u.push(s.path[t]);for(let t=1;t<a.path.length;t++)u.push(a.path[t]);const m=2.5*i;if(l){const t=u.map((t=>ct(t,l,f)));u=t.some((t=>t.signedDistanceFromCamera<=0))?[]:t.map((t=>t.point))}let g=[];if(u.length>0){const e=u[0].clone(),i=u[0].clone();for(let t=1;t<u.length;t++)e.x=Math.min(e.x,u[t].x),e.y=Math.min(e.y,u[t].y),i.x=Math.max(i.x,u[t].x),i.y=Math.max(i.y,u[t].y);g=e.x>=r.x&&i.x<=n.x&&e.y>=r.y&&i.y<=n.y?[u]:i.x<r.x||e.x>n.x||i.y<r.y||e.y>n.y?[]:t.am([u],r.x,r.y,n.x,n.y)}for(const t of g){o.reset(t,.25*i);let r=0;r=o.length<=.5*i?1:Math.ceil(o.paddedLength/m)+1;for(let t=0;t<r;t++){const n=t/Math.max(r-1,1),s=o.lerp(n),a=s.x+Tt,l=s.y+Tt;A.push(a,l,i,0);const u=a-i,d=l-i,p=a+i,f=l+i;if(T=T&&this.isOffscreen(u,d,p,f),w=w||this.isInsideGrid(u,d,p,f),"always"!==e&&this.grid.hitTestCircle(a,l,i,e,h)&&(b=!0,!c))return{circles:[],offscreen:!1,collisionDetected:b}}}}return{circles:!c&&b||!w||_<this.perspectiveRatioCutoff?[]:A,offscreen:T,collisionDetected:b}}queryRenderedSymbols(e){if(0===e.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const i=[];let r=1/0,n=1/0,o=-1/0,s=-1/0;for(const a of e){const e=new t.P(a.x+Tt,a.y+Tt);r=Math.min(r,e.x),n=Math.min(n,e.y),o=Math.max(o,e.x),s=Math.max(s,e.y),i.push(e)}const a=this.grid.query(r,n,o,s).concat(this.ignoredGrid.query(r,n,o,s)),l={},c={};for(const e of a){const r=e.key;if(void 0===l[r.bucketInstanceId]&&(l[r.bucketInstanceId]={}),l[r.bucketInstanceId][r.featureIndex])continue;const n=[new t.P(e.x1,e.y1),new t.P(e.x2,e.y1),new t.P(e.x2,e.y2),new t.P(e.x1,e.y2)];t.an(i,n)&&(l[r.bucketInstanceId][r.featureIndex]=!0,void 0===c[r.bucketInstanceId]&&(c[r.bucketInstanceId]=[]),c[r.bucketInstanceId].push(r.featureIndex))}return c}insertCollisionBox(t,e,i,r,n,o){(i?this.ignoredGrid:this.grid).insert({bucketInstanceId:r,featureIndex:n,collisionGroupID:o,overlapMode:e},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,e,i,r,n,o){const s=i?this.ignoredGrid:this.grid,a={bucketInstanceId:r,featureIndex:n,collisionGroupID:o,overlapMode:e};for(let e=0;e<t.length;e+=4)s.insertCircle(a,t[e],t[e+1],t[e+2])}projectAndGetPerspectiveRatio(e,i,r,n){let o;return n?(o=[i,r,n(i,r),1],t.ag(o,o,e)):(o=[i,r,0,1],wt(o,o,e)),{point:new t.P((o[0]/o[3]+1)/2*this.transform.width+Tt,(-o[1]/o[3]+1)/2*this.transform.height+Tt),perspectiveRatio:.5+this.transform.cameraToCenterDistance/o[3]*.5}}isOffscreen(t,e,i,r){return i<Tt||t>=this.screenRightBoundary||r<Tt||e>this.screenBottomBoundary}isInsideGrid(t,e,i,r){return i>=0&&t<this.gridRightBoundary&&r>=0&&e<this.gridBottomBoundary}getViewportMatrix(){const e=t.ao([]);return t.$(e,e,[-100,-100,0]),e}}function Et(e,i,r){return i*(t.N/(e.tileSize*Math.pow(2,r-e.tileID.overscaledZ)))}class Ct{constructor(t,e,i,r){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?e:-e))):r&&i?1:0,this.placed=i}isHidden(){return 0===this.opacity&&!this.placed}}class St{constructor(t,e,i,r,n){this.text=new Ct(t?t.text:null,e,i,n),this.icon=new Ct(t?t.icon:null,e,r,n)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class It{constructor(t,e,i){this.text=t,this.icon=e,this.skipFade=i}}class Mt{constructor(){this.invProjMatrix=t.Z(),this.viewportMatrix=t.Z(),this.circles=[]}}class kt{constructor(t,e,i,r,n){this.bucketInstanceId=t,this.featureIndex=e,this.sourceLayerIndex=i,this.bucketIndex=r,this.tileID=n}}class Pt{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const e=++this.maxGroupID;this.collisionGroups[t]={ID:e,predicate:t=>t.collisionGroupID===e}}return this.collisionGroups[t]}}function Lt(e,i,r,n,o){const{horizontalAlign:s,verticalAlign:a}=t.au(e);return new t.P(-(s-.5)*i+n[0]*o,-(a-.5)*r+n[1]*o)}function zt(e,i,r,n,o,s){const{x1:a,x2:l,y1:c,y2:u,anchorPointX:h,anchorPointY:d}=e,p=new t.P(i,r);return n&&p._rotate(o?s:-s),{x1:a+p.x,y1:c+p.y,x2:l+p.x,y2:u+p.y,anchorPointX:h,anchorPointY:d}}class Ft{constructor(t,e,i,r,n){this.transform=t.clone(),this.terrain=e,this.collisionIndex=new Bt(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=i,this.retainedQueryData={},this.collisionGroups=new Pt(r),this.collisionCircleArrays={},this.prevPlacement=n,n&&(n.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(e,i,r,n){const o=r.getBucket(i),s=r.latestFeatureIndex;if(!o||!s||i.id!==o.layerIds[0])return;const a=r.collisionBoxArray,l=o.layers[0].layout,c=Math.pow(2,this.transform.zoom-r.tileID.overscaledZ),u=r.tileSize/t.N,h=this.transform.calculatePosMatrix(r.tileID.toUnwrapped()),d="map"===l.get("text-pitch-alignment"),p="map"===l.get("text-rotation-alignment"),f=Et(r,1,this.transform.zoom),A=at(h,d,p,this.transform,f);let m=null;if(d){const e=lt(h,d,p,this.transform,f);m=t.a1([],this.transform.labelPlaneMatrix,e)}this.retainedQueryData[o.bucketInstanceId]=new kt(o.bucketInstanceId,s,o.sourceLayerIndex,o.index,r.tileID);const g={bucket:o,layout:l,posMatrix:h,textLabelPlaneMatrix:A,labelToScreenMatrix:m,scale:c,textPixelRatio:u,holdingForFade:r.holdingForFade(),collisionBoxArray:a,partiallyEvaluatedTextSize:t.ah(o.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(o.sourceID)};if(n)for(const t of o.sortKeyRanges){const{sortKey:i,symbolInstanceStart:r,symbolInstanceEnd:n}=t;e.push({sortKey:i,symbolInstanceStart:r,symbolInstanceEnd:n,parameters:g})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:o.symbolInstances.length,parameters:g})}attemptAnchorPlacement(e,i,r,n,o,s,a,l,c,u,h,d,p,f,A,m){const g=t.aq[e.textAnchor],_=[e.textOffset0,e.textOffset1],y=Lt(g,r,n,_,o),v=this.collisionIndex.placeCollisionBox(zt(i,y.x,y.y,s,a,this.transform.angle),h,l,c,u.predicate,m);if((!A||0!==this.collisionIndex.placeCollisionBox(zt(A,y.x,y.y,s,a,this.transform.angle),h,l,c,u.predicate,m).box.length)&&v.box.length>0){let t;if(this.prevPlacement&&this.prevPlacement.variableOffsets[d.crossTileID]&&this.prevPlacement.placements[d.crossTileID]&&this.prevPlacement.placements[d.crossTileID].text&&(t=this.prevPlacement.variableOffsets[d.crossTileID].anchor),0===d.crossTileID)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[d.crossTileID]={textOffset:_,width:r,height:n,anchor:g,textBoxScale:o,prevAnchor:t},this.markUsedJustification(p,g,d,f),p.allowVerticalPlacement&&(this.markUsedOrientation(p,f,d),this.placedOrientations[d.crossTileID]=f),{shift:y,placedGlyphBoxes:v}}}placeLayerBucketPart(e,i,r){const{bucket:n,layout:o,posMatrix:s,textLabelPlaneMatrix:a,labelToScreenMatrix:l,textPixelRatio:c,holdingForFade:u,collisionBoxArray:h,partiallyEvaluatedTextSize:d,collisionGroup:p}=e.parameters,f=o.get("text-optional"),A=o.get("icon-optional"),m=t.ar(o,"text-overlap","text-allow-overlap"),g="always"===m,_=t.ar(o,"icon-overlap","icon-allow-overlap"),y="always"===_,v="map"===o.get("text-rotation-alignment"),x="map"===o.get("text-pitch-alignment"),b="none"!==o.get("icon-text-fit"),w="viewport-y"===o.get("symbol-z-order"),T=g&&(y||!n.hasIconData()||A),B=y&&(g||!n.hasTextData()||f);!n.collisionArrays&&h&&n.deserializeCollisionBoxes(h);const E=this.retainedQueryData[n.bucketInstanceId].tileID,C=this.terrain?(t,e)=>this.terrain.getElevation(E,t,e):null,S=(e,h)=>{var y,w;if(i[e.crossTileID])return;if(u)return void(this.placements[e.crossTileID]=new It(!1,!1,!1));let E=!1,S=!1,I=!0,M=null,k={box:null,offscreen:null},P={box:null,offscreen:null},L=null,z=null,F=null,D=0,R=0,U=0;h.textFeatureIndex?D=h.textFeatureIndex:e.useRuntimeCollisionCircles&&(D=e.featureIndex),h.verticalTextFeatureIndex&&(R=h.verticalTextFeatureIndex);const O=h.textBox;if(O){const i=i=>{let r=t.ai.horizontal;if(n.allowVerticalPlacement&&!i&&this.prevPlacement){const t=this.prevPlacement.placedOrientations[e.crossTileID];t&&(this.placedOrientations[e.crossTileID]=t,r=t,this.markUsedOrientation(n,r,e))}return r},r=(i,r)=>{if(n.allowVerticalPlacement&&e.numVerticalGlyphVertices>0&&h.verticalTextBox){for(const e of n.writingModes)if(e===t.ai.vertical?(k=r(),P=k):k=i(),k&&k.box&&k.box.length)break}else k=i()},o=e.textAnchorOffsetStartIndex,a=e.textAnchorOffsetEndIndex;if(a===o){const o=(t,i)=>{const r=this.collisionIndex.placeCollisionBox(t,m,c,s,p.predicate,C);return r&&r.box&&r.box.length&&(this.markUsedOrientation(n,i,e),this.placedOrientations[e.crossTileID]=i),r};r((()=>o(O,t.ai.horizontal)),(()=>{const i=h.verticalTextBox;return n.allowVerticalPlacement&&e.numVerticalGlyphVertices>0&&i?o(i,t.ai.vertical):{box:null,offscreen:null}})),i(k&&k.box&&k.box.length)}else{let l=t.aq[null===(w=null===(y=this.prevPlacement)||void 0===y?void 0:y.variableOffsets[e.crossTileID])||void 0===w?void 0:w.anchor];const u=(t,i,r)=>{const u=t.x2-t.x1,h=t.y2-t.y1,d=e.textBoxScale,f=b&&"never"===_?i:null;let A={box:[],offscreen:!1},g="never"===m?1:2,y="never";l&&g++;for(let i=0;i<g;i++){for(let i=o;i<a;i++){const o=n.textAnchorOffsets.get(i);if(l&&o.textAnchor!==l)continue;const a=this.attemptAnchorPlacement(o,t,u,h,d,v,x,c,s,p,y,e,n,r,f,C);if(a&&(A=a.placedGlyphBoxes,A&&A.box&&A.box.length))return E=!0,M=a.shift,A}l?l=null:y=m}return A};r((()=>u(O,h.iconBox,t.ai.horizontal)),(()=>{const i=h.verticalTextBox;return n.allowVerticalPlacement&&!(k&&k.box&&k.box.length)&&e.numVerticalGlyphVertices>0&&i?u(i,h.verticalIconBox,t.ai.vertical):{box:null,offscreen:null}})),k&&(E=k.box,I=k.offscreen);const d=i(k&&k.box);if(!E&&this.prevPlacement){const t=this.prevPlacement.variableOffsets[e.crossTileID];t&&(this.variableOffsets[e.crossTileID]=t,this.markUsedJustification(n,t.anchor,e,d))}}}if(L=k,E=L&&L.box&&L.box.length>0,I=L&&L.offscreen,e.useRuntimeCollisionCircles){const i=n.text.placedSymbolArray.get(e.centerJustifiedTextSymbolIndex),c=t.aj(n.textSizeData,d,i),u=o.get("text-padding");z=this.collisionIndex.placeCollisionCircles(m,i,n.lineVertexArray,n.glyphOffsetArray,c,s,a,l,r,x,p.predicate,e.collisionCircleDiameter,u,C),z.circles.length&&z.collisionDetected&&!r&&t.w("Collisions detected, but collision boxes are not shown"),E=g||z.circles.length>0&&!z.collisionDetected,I=I&&z.offscreen}if(h.iconFeatureIndex&&(U=h.iconFeatureIndex),h.iconBox){const t=t=>{const e=b&&M?zt(t,M.x,M.y,v,x,this.transform.angle):t;return this.collisionIndex.placeCollisionBox(e,_,c,s,p.predicate,C)};P&&P.box&&P.box.length&&h.verticalIconBox?(F=t(h.verticalIconBox),S=F.box.length>0):(F=t(h.iconBox),S=F.box.length>0),I=I&&F.offscreen}const N=f||0===e.numHorizontalGlyphVertices&&0===e.numVerticalGlyphVertices,Q=A||0===e.numIconVertices;if(N||Q?Q?N||(S=S&&E):E=S&&E:S=E=S&&E,E&&L&&L.box&&this.collisionIndex.insertCollisionBox(L.box,m,o.get("text-ignore-placement"),n.bucketInstanceId,P&&P.box&&R?R:D,p.ID),S&&F&&this.collisionIndex.insertCollisionBox(F.box,_,o.get("icon-ignore-placement"),n.bucketInstanceId,U,p.ID),z&&(E&&this.collisionIndex.insertCollisionCircles(z.circles,m,o.get("text-ignore-placement"),n.bucketInstanceId,D,p.ID),r)){const t=n.bucketInstanceId;let e=this.collisionCircleArrays[t];void 0===e&&(e=this.collisionCircleArrays[t]=new Mt);for(let t=0;t<z.circles.length;t+=4)e.circles.push(z.circles[t+0]),e.circles.push(z.circles[t+1]),e.circles.push(z.circles[t+2]),e.circles.push(z.collisionDetected?1:0)}if(0===e.crossTileID)throw new Error("symbolInstance.crossTileID can't be 0");if(0===n.bucketInstanceId)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[e.crossTileID]=new It(E||T,S||B,I||n.justReloaded),i[e.crossTileID]=!0};if(w){if(0!==e.symbolInstanceStart)throw new Error("bucket.bucketInstanceId should be 0");const t=n.getSortedSymbolIndexes(this.transform.angle);for(let e=t.length-1;e>=0;--e){const i=t[e];S(n.symbolInstances.get(i),n.collisionArrays[i])}}else for(let t=e.symbolInstanceStart;t<e.symbolInstanceEnd;t++)S(n.symbolInstances.get(t),n.collisionArrays[t]);if(r&&n.bucketInstanceId in this.collisionCircleArrays){const e=this.collisionCircleArrays[n.bucketInstanceId];t.as(e.invProjMatrix,s),e.viewportMatrix=this.collisionIndex.getViewportMatrix()}n.justReloaded=!1}markUsedJustification(e,i,r,n){let o;o=n===t.ai.vertical?r.verticalPlacedTextSymbolIndex:{left:r.leftJustifiedTextSymbolIndex,center:r.centerJustifiedTextSymbolIndex,right:r.rightJustifiedTextSymbolIndex}[t.at(i)];const s=[r.leftJustifiedTextSymbolIndex,r.centerJustifiedTextSymbolIndex,r.rightJustifiedTextSymbolIndex,r.verticalPlacedTextSymbolIndex];for(const t of s)t>=0&&(e.text.placedSymbolArray.get(t).crossTileID=o>=0&&t!==o?0:r.crossTileID)}markUsedOrientation(e,i,r){const n=i===t.ai.horizontal||i===t.ai.horizontalOnly?i:0,o=i===t.ai.vertical?i:0,s=[r.leftJustifiedTextSymbolIndex,r.centerJustifiedTextSymbolIndex,r.rightJustifiedTextSymbolIndex];for(const t of s)e.text.placedSymbolArray.get(t).placedOrientation=n;r.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(r.verticalPlacedTextSymbolIndex).placedOrientation=o)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const e=this.prevPlacement;let i=!1;this.prevZoomAdjustment=e?e.zoomAdjustment(this.transform.zoom):0;const r=e?e.symbolFadeChange(t):1,n=e?e.opacities:{},o=e?e.variableOffsets:{},s=e?e.placedOrientations:{};for(const t in this.placements){const e=this.placements[t],o=n[t];o?(this.opacities[t]=new St(o,r,e.text,e.icon),i=i||e.text!==o.text.placed||e.icon!==o.icon.placed):(this.opacities[t]=new St(null,r,e.text,e.icon,e.skipFade),i=i||e.text||e.icon)}for(const t in n){const e=n[t];if(!this.opacities[t]){const n=new St(e,r,!1,!1);n.isHidden()||(this.opacities[t]=n,i=i||e.text.placed||e.icon.placed)}}for(const t in o)this.variableOffsets[t]||!this.opacities[t]||this.opacities[t].isHidden()||(this.variableOffsets[t]=o[t]);for(const t in s)this.placedOrientations[t]||!this.opacities[t]||this.opacities[t].isHidden()||(this.placedOrientations[t]=s[t]);if(e&&void 0===e.lastPlacementChangeTime)throw new Error("Last placement time for previous placement is not defined");i?this.lastPlacementChangeTime=t:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=e?e.lastPlacementChangeTime:t)}updateLayerOpacities(t,e){const i={};for(const r of e){const e=r.getBucket(t);e&&r.latestFeatureIndex&&t.id===e.layerIds[0]&&this.updateBucketOpacities(e,i,r.collisionBoxArray)}}updateBucketOpacities(e,i,r){e.hasTextData()&&(e.text.opacityVertexArray.clear(),e.text.hasVisibleVertices=!1),e.hasIconData()&&(e.icon.opacityVertexArray.clear(),e.icon.hasVisibleVertices=!1),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();const n=e.layers[0],o=n.layout,s=new St(null,0,!1,!1,!0),a=o.get("text-allow-overlap"),l=o.get("icon-allow-overlap"),c=n._unevaluatedLayout.hasValue("text-variable-anchor")||n._unevaluatedLayout.hasValue("text-variable-anchor-offset"),u="map"===o.get("text-rotation-alignment"),h="map"===o.get("text-pitch-alignment"),d="none"!==o.get("icon-text-fit"),p=new St(null,0,a&&(l||!e.hasIconData()||o.get("icon-optional")),l&&(a||!e.hasTextData()||o.get("text-optional")),!0);!e.collisionArrays&&r&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(r);const f=(t,e,i)=>{for(let r=0;r<e/4;r++)t.opacityVertexArray.emplaceBack(i);t.hasVisibleVertices=t.hasVisibleVertices||i!==Gt};for(let r=0;r<e.symbolInstances.length;r++){const n=e.symbolInstances.get(r),{numHorizontalGlyphVertices:o,numVerticalGlyphVertices:a,crossTileID:l}=n;let A=this.opacities[l];i[l]?A=s:A||(A=p,this.opacities[l]=A),i[l]=!0;const m=n.numIconVertices>0,g=this.placedOrientations[n.crossTileID],_=g===t.ai.vertical,y=g===t.ai.horizontal||g===t.ai.horizontalOnly;if(o>0||a>0){const t=Ht(A.text);f(e.text,o,_?Gt:t),f(e.text,a,y?Gt:t);const i=A.text.isHidden();[n.rightJustifiedTextSymbolIndex,n.centerJustifiedTextSymbolIndex,n.leftJustifiedTextSymbolIndex].forEach((t=>{t>=0&&(e.text.placedSymbolArray.get(t).hidden=i||_?1:0)})),n.verticalPlacedTextSymbolIndex>=0&&(e.text.placedSymbolArray.get(n.verticalPlacedTextSymbolIndex).hidden=i||y?1:0);const r=this.variableOffsets[n.crossTileID];r&&this.markUsedJustification(e,r.anchor,n,g);const s=this.placedOrientations[n.crossTileID];s&&(this.markUsedJustification(e,"left",n,s),this.markUsedOrientation(e,s,n))}if(m){const t=Ht(A.icon),i=!(d&&n.verticalPlacedIconSymbolIndex&&_);n.placedIconSymbolIndex>=0&&(f(e.icon,n.numIconVertices,i?t:Gt),e.icon.placedSymbolArray.get(n.placedIconSymbolIndex).hidden=A.icon.isHidden()),n.verticalPlacedIconSymbolIndex>=0&&(f(e.icon,n.numVerticalIconVertices,i?Gt:t),e.icon.placedSymbolArray.get(n.verticalPlacedIconSymbolIndex).hidden=A.icon.isHidden())}if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){const i=e.collisionArrays[r];if(i){let r=new t.P(0,0);if(i.textBox||i.verticalTextBox){let t=!0;if(c){const e=this.variableOffsets[l];e?(r=Lt(e.anchor,e.width,e.height,e.textOffset,e.textBoxScale),u&&r._rotate(h?this.transform.angle:-this.transform.angle)):t=!1}i.textBox&&Dt(e.textCollisionBox.collisionVertexArray,A.text.placed,!t||_,r.x,r.y),i.verticalTextBox&&Dt(e.textCollisionBox.collisionVertexArray,A.text.placed,!t||y,r.x,r.y)}const n=Boolean(!y&&i.verticalIconBox);i.iconBox&&Dt(e.iconCollisionBox.collisionVertexArray,A.icon.placed,n,d?r.x:0,d?r.y:0),i.verticalIconBox&&Dt(e.iconCollisionBox.collisionVertexArray,A.icon.placed,!n,d?r.x:0,d?r.y:0)}}}if(e.sortFeatures(this.transform.angle),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.text.opacityVertexArray.length!==e.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${e.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${e.text.layoutVertexArray.length}) / 4`);if(e.icon.opacityVertexArray.length!==e.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${e.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${e.icon.layoutVertexArray.length}) / 4`);if(e.bucketInstanceId in this.collisionCircleArrays){const t=this.collisionCircleArrays[e.bucketInstanceId];e.placementInvProjMatrix=t.invProjMatrix,e.placementViewportMatrix=t.viewportMatrix,e.collisionCircleArray=t.circles,delete this.collisionCircleArrays[e.bucketInstanceId]}}symbolFadeChange(t){return 0===this.fadeDuration?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,e){const i=this.zoomAtLastRecencyCheck===e?1-this.zoomAdjustment(e):1;return this.zoomAtLastRecencyCheck=e,this.commitTime+this.fadeDuration*i>t}setStale(){this.stale=!0}}function Dt(t,e,i,r,n){t.emplaceBack(e?1:0,i?1:0,r||0,n||0),t.emplaceBack(e?1:0,i?1:0,r||0,n||0),t.emplaceBack(e?1:0,i?1:0,r||0,n||0),t.emplaceBack(e?1:0,i?1:0,r||0,n||0)}const Rt=Math.pow(2,25),Ut=Math.pow(2,24),Ot=Math.pow(2,17),Nt=Math.pow(2,16),Qt=Math.pow(2,9),Vt=Math.pow(2,8),jt=Math.pow(2,1);function Ht(t){if(0===t.opacity&&!t.placed)return 0;if(1===t.opacity&&t.placed)return 4294967295;const e=t.placed?1:0,i=Math.floor(127*t.opacity);return i*Rt+e*Ut+i*Ot+e*Nt+i*Qt+e*Vt+i*jt+e}const Gt=0;class $t{constructor(t){this._sortAcrossTiles="viewport-y"!==t.layout.get("symbol-z-order")&&!t.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,e,i,r,n){const o=this._bucketParts;for(;this._currentTileIndex<t.length;)if(e.getBucketParts(o,r,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,n())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,o.sort(((t,e)=>t.sortKey-e.sortKey)));this._currentPartIndex<o.length;)if(e.placeLayerBucketPart(o[this._currentPartIndex],this._seenCrossTileIDs,i),this._currentPartIndex++,n())return!0;return!1}}class Zt{constructor(t,e,i,r,n,o,s,a){this.placement=new Ft(t,e,o,s,a),this._currentPlacementIndex=i.length-1,this._forceFullPlacement=r,this._showCollisionBoxes=n,this._done=!1}isDone(){return this._done}continuePlacement(e,i,r){const n=t.h.now(),o=()=>!this._forceFullPlacement&&t.h.now()-n>2;for(;this._currentPlacementIndex>=0;){const t=i[e[this._currentPlacementIndex]],n=this.placement.collisionIndex.transform.zoom;if("symbol"===t.type&&(!t.minzoom||t.minzoom<=n)&&(!t.maxzoom||t.maxzoom>n)){if(this._inProgressLayer||(this._inProgressLayer=new $t(t)),this._inProgressLayer.continuePlacement(r[t.source],this.placement,this._showCollisionBoxes,t,o))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const qt=512/t.N/2;class Kt{constructor(e,i,r){this.tileID=e,this.bucketInstanceId=r,this._symbolsByKey={};const n=new Map;for(let t=0;t<i.length;t++){const e=i.get(t),r=e.key,o=n.get(r);o?o.push(e):n.set(r,[e])}for(const[e,i]of n){const r={positions:i.map((t=>({x:Math.floor(t.anchorX*qt),y:Math.floor(t.anchorY*qt)}))),crossTileIDs:i.map((t=>t.crossTileID))};if(r.positions.length>128){const e=new t.av(r.positions.length,16,Uint16Array);for(const{x:t,y:i}of r.positions)e.add(t,i);e.finish(),delete r.positions,r.index=e}this._symbolsByKey[e]=r}}getScaledCoordinates(e,i){const{x:r,y:n,z:o}=this.tileID.canonical,{x:s,y:a,z:l}=i.canonical,c=qt/Math.pow(2,l-o),u=(a*t.N+e.anchorY)*c,h=n*t.N*qt;return{x:Math.floor((s*t.N+e.anchorX)*c-r*t.N*qt),y:Math.floor(u-h)}}findMatches(t,e,i){const r=this.tileID.canonical.z<e.canonical.z?1:Math.pow(2,this.tileID.canonical.z-e.canonical.z);for(let n=0;n<t.length;n++){const o=t.get(n);if(o.crossTileID)continue;const s=this._symbolsByKey[o.key];if(!s)continue;const a=this.getScaledCoordinates(o,e);if(s.index){const t=s.index.range(a.x-r,a.y-r,a.x+r,a.y+r).sort();for(const e of t){const t=s.crossTileIDs[e];if(!i[t]){i[t]=!0,o.crossTileID=t;break}}}else if(s.positions)for(let t=0;t<s.positions.length;t++){const e=s.positions[t],n=s.crossTileIDs[t];if(Math.abs(e.x-a.x)<=r&&Math.abs(e.y-a.y)<=r&&!i[n]){i[n]=!0,o.crossTileID=n;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map((({crossTileIDs:t})=>t))}}class Wt{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Xt{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const e=Math.round((t-this.lng)/360);if(0!==e)for(const t in this.indexes){const i=this.indexes[t],r={};for(const t in i){const n=i[t];n.tileID=n.tileID.unwrapTo(n.tileID.wrap+e),r[n.tileID.key]=n}this.indexes[t]=r}this.lng=t}addBucket(t,e,i){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===e.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let t=0;t<e.symbolInstances.length;t++)e.symbolInstances.get(t).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const r=this.usedCrossTileIDs[t.overscaledZ];for(const i in this.indexes){const n=this.indexes[i];if(Number(i)>t.overscaledZ)for(const i in n){const o=n[i];o.tileID.isChildOf(t)&&o.findMatches(e.symbolInstances,t,r)}else{const o=n[t.scaledTo(Number(i)).key];o&&o.findMatches(e.symbolInstances,t,r)}}for(let t=0;t<e.symbolInstances.length;t++){const n=e.symbolInstances.get(t);n.crossTileID||(n.crossTileID=i.generate(),r[n.crossTileID]=!0)}return void 0===this.indexes[t.overscaledZ]&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new Kt(t,e.symbolInstances,e.bucketInstanceId),!0}removeBucketCrossTileIDs(t,e){for(const i of e.getCrossTileIDsLists())for(const e of i)delete this.usedCrossTileIDs[t][e]}removeStaleBuckets(t){let e=!1;for(const i in this.indexes){const r=this.indexes[i];for(const n in r)t[r[n].bucketInstanceId]||(this.removeBucketCrossTileIDs(i,r[n]),delete r[n],e=!0)}return e}}class Jt{constructor(){this.layerIndexes={},this.crossTileIDs=new Wt,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,e,i){let r=this.layerIndexes[t.id];void 0===r&&(r=this.layerIndexes[t.id]=new Xt);let n=!1;const o={};r.handleWrapJump(i);for(const i of e){const e=i.getBucket(t);e&&t.id===e.layerIds[0]&&(e.bucketInstanceId||(e.bucketInstanceId=++this.maxBucketInstanceId),r.addBucket(i.tileID,e,this.crossTileIDs)&&(n=!0),o[e.bucketInstanceId]=!0)}return r.removeStaleBuckets(o)&&(n=!0),n}pruneUnusedLayers(t){const e={};t.forEach((t=>{e[t]=!0}));for(const t in this.layerIndexes)e[t]||delete this.layerIndexes[t]}}const Yt=(e,i)=>t.x(e,i&&i.filter((t=>"source.canvas"!==t.identifier))),te=t.F(t.ax,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setGlyphs","setSprite"]),ee=t.F(t.ax,["setCenter","setZoom","setBearing","setPitch"]),ie=t.aw();class re extends t.E{constructor(e,i={}){super(),this.map=e,this.dispatcher=new M(rt(),this,e._getMapId()),this.imageManager=new x,this.imageManager.setEventedParent(this),this.glyphManager=new B(e._requestManager,i.localIdeographFontFamily),this.lineAtlas=new I(256,512),this.crossTileSymbolIndex=new Jt,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new t.ay,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",t.az());const r=this;this._rtlTextPluginCallback=re.registerForPluginStateChange((e=>{r.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:e.pluginStatus,pluginURL:e.pluginURL},((e,i)=>{if(t.aA(e),i&&i.every((t=>t)))for(const t in r.sourceCaches){const e=r.sourceCaches[t].getSource().type;"vector"!==e&&"geojson"!==e||r.sourceCaches[t].reload()}}))})),this.on("data",(t=>{if("source"!==t.dataType||"metadata"!==t.sourceDataType)return;const e=this.sourceCaches[t.sourceId];if(!e)return;const i=e.getSource();if(i&&i.vectorLayerIds)for(const t in this._layers){const e=this._layers[t];e.source===i.id&&this._validateLayer(e)}}))}loadURL(e,i={},r){this.fire(new t.k("dataloading",{dataType:"style"})),i.validate="boolean"!=typeof i.validate||i.validate;const n=this.map._requestManager.transformRequest(e,u.Style);this._request=t.f(n,((e,n)=>{this._request=null,e?this.fire(new t.j(e)):n&&this._load(n,i,r)}))}loadJSON(e,i={},r){this.fire(new t.k("dataloading",{dataType:"style"})),this._request=t.h.frame((()=>{this._request=null,i.validate=!1!==i.validate,this._load(e,i,r)}))}loadEmpty(){this.fire(new t.k("dataloading",{dataType:"style"})),this._load(ie,{validate:!1})}_load(e,i,r){var n;const o=i.transformStyle?i.transformStyle(r,e):e;if(!i.validate||!Yt(this,t.y(o))){this._loaded=!0,this.stylesheet=o;for(const t in o.sources)this.addSource(t,o.sources[t],{validate:!1});o.sprite?this._loadSprite(o.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(o.glyphs),this._createLayers(),this.light=new S(this.stylesheet.light),this.map.setTerrain(null!==(n=this.stylesheet.terrain)&&void 0!==n?n:null),this.fire(new t.k("data",{dataType:"style"})),this.fire(new t.k("style.load"))}}_createLayers(){const e=t.aB(this.stylesheet.layers);this.dispatcher.broadcast("setLayers",e),this._order=e.map((t=>t.id)),this._layers={},this._serializedLayers=null;for(const i of e){const e=t.aC(i);e.setEventedParent(this,{layer:{id:i.id}}),this._layers[i.id]=e}}_loadSprite(e,i=!1,r=void 0){this.imageManager.setLoaded(!1),this._spriteRequest=function(e,i,r,n){const o=g(e),s=o.length,a=r>1?"@2x":"",l={},h={},d={};for(const{id:e,url:r}of o){const o=i.transformRequest(i.normalizeSpriteURL(r,a,".json"),u.SpriteJSON),p=`${e}_${o.url}`;l[p]=t.f(o,((t,i)=>{delete l[p],h[e]=i,_(n,h,d,t,s)}));const f=i.transformRequest(i.normalizeSpriteURL(r,a,".png"),u.SpriteImage),A=`${e}_${f.url}`;l[A]=c.getImage(f,((t,i)=>{delete l[A],d[e]=i,_(n,h,d,t,s)}))}return{cancel(){for(const t of Object.values(l))t.cancel()}}}(e,this.map._requestManager,this.map.getPixelRatio(),((e,n)=>{if(this._spriteRequest=null,e)this.fire(new t.j(e));else if(n)for(const t in n){this._spritesImagesIds[t]=[];const e=this._spritesImagesIds[t]?this._spritesImagesIds[t].filter((t=>!(t in n))):[];for(const t of e)this.imageManager.removeImage(t),this._changedImages[t]=!0;for(const e in n[t]){const r="default"===t?e:`${t}:${e}`;this._spritesImagesIds[t].push(r),r in this.imageManager.images?this.imageManager.updateImage(r,n[t][e],!1):this.imageManager.addImage(r,n[t][e]),i&&(this._changedImages[r]=!0)}}this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),i&&(this._changed=!0),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new t.k("data",{dataType:"style"})),r&&r(e)}))}_unloadSprite(){for(const t of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(t),this._changedImages[t]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new t.k("data",{dataType:"style"}))}_validateLayer(e){const i=this.sourceCaches[e.source];if(!i)return;const r=e.sourceLayer;if(!r)return;const n=i.getSource();("geojson"===n.type||n.vectorLayerIds&&-1===n.vectorLayerIds.indexOf(r))&&this.fire(new t.j(new Error(`Source layer "${r}" does not exist on source "${n.id}" as specified by style layer "${e.id}".`)))}loaded(){if(!this._loaded)return!1;if(Object.keys(this._updatedSources).length)return!1;for(const t in this.sourceCaches)if(!this.sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(t){const e=this._serializedAllLayers();if(!t||0===t.length)return Object.values(e);const i=[];for(const r of t)e[r]&&i.push(e[r]);return i}_serializedAllLayers(){let t=this._serializedLayers;if(t)return t;t=this._serializedLayers={};const e=Object.keys(this._layers);for(const i of e){const e=this._layers[i];"custom"!==e.type&&(t[i]=e.serialize())}return t}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const t in this.sourceCaches)if(this.sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(e){if(!this._loaded)return;const i=this._changed;if(this._changed){const t=Object.keys(this._updatedLayers),i=Object.keys(this._removedLayers);(t.length||i.length)&&this._updateWorkerLayers(t,i);for(const t in this._updatedSources){const e=this._updatedSources[t];if("reload"===e)this._reloadSource(t);else{if("clear"!==e)throw new Error(`Invalid action ${e}`);this._clearSource(t)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const t in this._updatedPaintProps)this._layers[t].updateTransitions(e);this.light.updateTransitions(e),this._resetUpdates()}const r={};for(const t in this.sourceCaches){const e=this.sourceCaches[t];r[t]=e.used,e.used=!1}for(const t of this._order){const i=this._layers[t];i.recalculate(e,this._availableImages),!i.isHidden(e.zoom)&&i.source&&(this.sourceCaches[i.source].used=!0)}for(const e in r){const i=this.sourceCaches[e];r[e]!==i.used&&i.fire(new t.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:e}))}this.light.recalculate(e),this.z=e.zoom,i&&this.fire(new t.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const e in this.sourceCaches)this.sourceCaches[e].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const t in this.sourceCaches)this.sourceCaches[t].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(t,e){this.dispatcher.broadcast("updateLayers",{layers:this._serializeByIds(t),removedIds:e})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(e,i={}){this._checkLoaded();const r=this.serialize();if(e=i.transformStyle?i.transformStyle(r,e):e,Yt(this,t.y(e)))return!1;(e=t.aD(e)).layers=t.aB(e.layers);const n=t.aE(r,e).filter((t=>!(t.command in ee)));if(0===n.length)return!1;const o=n.filter((t=>!(t.command in te)));if(o.length>0)throw new Error(`Unimplemented: ${o.map((t=>t.command)).join(", ")}.`);for(const t of n)"setTransition"!==t.command&&this[t.command].apply(this,t.args);return this.stylesheet=e,this._serializedLayers=null,!0}addImage(e,i){if(this.getImage(e))return this.fire(new t.j(new Error(`An image named "${e}" already exists.`)));this.imageManager.addImage(e,i),this._afterImageUpdated(e)}updateImage(t,e){this.imageManager.updateImage(t,e)}getImage(t){return this.imageManager.getImage(t)}removeImage(e){if(!this.getImage(e))return this.fire(new t.j(new Error(`An image named "${e}" does not exist.`)));this.imageManager.removeImage(e),this._afterImageUpdated(e)}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new t.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(e,i,r={}){if(this._checkLoaded(),void 0!==this.sourceCaches[e])throw new Error(`Source "${e}" already exists.`);if(!i.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(i).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(i.type)>=0&&this._validate(t.y.source,`sources.${e}`,i,null,r))return;this.map&&this.map._collectResourceTiming&&(i.collectResourceTiming=!0);const n=this.sourceCaches[e]=new W(e,i,this.dispatcher);n.style=this,n.setEventedParent(this,(()=>({isSourceLoaded:n.loaded(),source:n.serialize(),sourceId:e}))),n.onAdd(this.map),this._changed=!0}removeSource(e){if(this._checkLoaded(),void 0===this.sourceCaches[e])throw new Error("There is no source with this ID");for(const i in this._layers)if(this._layers[i].source===e)return this.fire(new t.j(new Error(`Source "${e}" cannot be removed while layer "${i}" is using it.`)));const i=this.sourceCaches[e];delete this.sourceCaches[e],delete this._updatedSources[e],i.fire(new t.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:e})),i.setEventedParent(null),i.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(t,e){if(this._checkLoaded(),void 0===this.sourceCaches[t])throw new Error(`There is no source with this ID=${t}`);const i=this.sourceCaches[t].getSource();if("geojson"!==i.type)throw new Error(`geojsonSource.type is ${i.type}, which is !== 'geojson`);i.setData(e),this._changed=!0}getSource(t){return this.sourceCaches[t]&&this.sourceCaches[t].getSource()}addLayer(e,i,r={}){this._checkLoaded();const n=e.id;if(this.getLayer(n))return void this.fire(new t.j(new Error(`Layer "${n}" already exists on this map.`)));let o;if("custom"===e.type){if(Yt(this,t.aF(e)))return;o=t.aC(e)}else{if("source"in e&&"object"==typeof e.source&&(this.addSource(n,e.source),e=t.aD(e),e=t.e(e,{source:n})),this._validate(t.y.layer,`layers.${n}`,e,{arrayIndex:-1},r))return;o=t.aC(e),this._validateLayer(o),o.setEventedParent(this,{layer:{id:n}})}const s=i?this._order.indexOf(i):this._order.length;if(i&&-1===s)this.fire(new t.j(new Error(`Cannot add layer "${n}" before non-existing layer "${i}".`)));else{if(this._order.splice(s,0,n),this._layerOrderChanged=!0,this._layers[n]=o,this._removedLayers[n]&&o.source&&"custom"!==o.type){const t=this._removedLayers[n];delete this._removedLayers[n],t.type!==o.type?this._updatedSources[o.source]="clear":(this._updatedSources[o.source]="reload",this.sourceCaches[o.source].pause())}this._updateLayer(o),o.onAdd&&o.onAdd(this.map)}}moveLayer(e,i){if(this._checkLoaded(),this._changed=!0,!this._layers[e])return void this.fire(new t.j(new Error(`The layer '${e}' does not exist in the map's style and cannot be moved.`)));if(e===i)return;const r=this._order.indexOf(e);this._order.splice(r,1);const n=i?this._order.indexOf(i):this._order.length;i&&-1===n?this.fire(new t.j(new Error(`Cannot move layer "${e}" before non-existing layer "${i}".`))):(this._order.splice(n,0,e),this._layerOrderChanged=!0)}removeLayer(e){this._checkLoaded();const i=this._layers[e];if(!i)return void this.fire(new t.j(new Error(`Cannot remove non-existing layer "${e}".`)));i.setEventedParent(null);const r=this._order.indexOf(e);this._order.splice(r,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=i,delete this._layers[e],this._serializedLayers&&delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],i.onRemove&&i.onRemove(this.map)}getLayer(t){return this._layers[t]}getLayersOrder(){return[...this._order]}hasLayer(t){return t in this._layers}setLayerZoomRange(e,i,r){this._checkLoaded();const n=this.getLayer(e);n?n.minzoom===i&&n.maxzoom===r||(null!=i&&(n.minzoom=i),null!=r&&(n.maxzoom=r),this._updateLayer(n)):this.fire(new t.j(new Error(`Cannot set the zoom range of non-existing layer "${e}".`)))}setFilter(e,i,r={}){this._checkLoaded();const n=this.getLayer(e);if(n){if(!t.aG(n.filter,i))return null==i?(n.filter=void 0,void this._updateLayer(n)):void(this._validate(t.y.filter,`layers.${n.id}.filter`,i,null,r)||(n.filter=t.aD(i),this._updateLayer(n)))}else this.fire(new t.j(new Error(`Cannot filter non-existing layer "${e}".`)))}getFilter(e){return t.aD(this.getLayer(e).filter)}setLayoutProperty(e,i,r,n={}){this._checkLoaded();const o=this.getLayer(e);o?t.aG(o.getLayoutProperty(i),r)||(o.setLayoutProperty(i,r,n),this._updateLayer(o)):this.fire(new t.j(new Error(`Cannot style non-existing layer "${e}".`)))}getLayoutProperty(e,i){const r=this.getLayer(e);if(r)return r.getLayoutProperty(i);this.fire(new t.j(new Error(`Cannot get style of non-existing layer "${e}".`)))}setPaintProperty(e,i,r,n={}){this._checkLoaded();const o=this.getLayer(e);o?t.aG(o.getPaintProperty(i),r)||(o.setPaintProperty(i,r,n)&&this._updateLayer(o),this._changed=!0,this._updatedPaintProps[e]=!0):this.fire(new t.j(new Error(`Cannot style non-existing layer "${e}".`)))}getPaintProperty(t,e){return this.getLayer(t).getPaintProperty(e)}setFeatureState(e,i){this._checkLoaded();const r=e.source,n=e.sourceLayer,o=this.sourceCaches[r];if(void 0===o)return void this.fire(new t.j(new Error(`The source '${r}' does not exist in the map's style.`)));const s=o.getSource().type;"geojson"===s&&n?this.fire(new t.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):"vector"!==s||n?(void 0===e.id&&this.fire(new t.j(new Error("The feature id parameter must be provided."))),o.setFeatureState(n,e.id,i)):this.fire(new t.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(e,i){this._checkLoaded();const r=e.source,n=this.sourceCaches[r];if(void 0===n)return void this.fire(new t.j(new Error(`The source '${r}' does not exist in the map's style.`)));const o=n.getSource().type,s="vector"===o?e.sourceLayer:void 0;"vector"!==o||s?i&&"string"!=typeof e.id&&"number"!=typeof e.id?this.fire(new t.j(new Error("A feature id is required to remove its specific state property."))):n.removeFeatureState(s,e.id,i):this.fire(new t.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(e){this._checkLoaded();const i=e.source,r=e.sourceLayer,n=this.sourceCaches[i];if(void 0!==n)return"vector"!==n.getSource().type||r?(void 0===e.id&&this.fire(new t.j(new Error("The feature id parameter must be provided."))),n.getFeatureState(r,e.id)):void this.fire(new t.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new t.j(new Error(`The source '${i}' does not exist in the map's style.`)))}getTransition(){return t.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const e=t.aH(this.sourceCaches,(t=>t.serialize())),i=this._serializeByIds(this._order),r=this.map.getTerrain()||void 0,n=this.stylesheet;return t.aI({version:n.version,name:n.name,metadata:n.metadata,light:n.light,center:n.center,zoom:n.zoom,bearing:n.bearing,pitch:n.pitch,sprite:n.sprite,glyphs:n.glyphs,transition:n.transition,sources:e,layers:i,terrain:r},(t=>void 0!==t))}_updateLayer(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&"raster"!==this.sourceCaches[t.source].getSource().type&&(this._updatedSources[t.source]="reload",this.sourceCaches[t.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(t){const e=t=>"fill-extrusion"===this._layers[t].type,i={},r=[];for(let n=this._order.length-1;n>=0;n--){const o=this._order[n];if(e(o)){i[o]=n;for(const e of t){const t=e[o];if(t)for(const e of t)r.push(e)}}}r.sort(((t,e)=>e.intersectionZ-t.intersectionZ));const n=[];for(let o=this._order.length-1;o>=0;o--){const s=this._order[o];if(e(s))for(let t=r.length-1;t>=0;t--){const e=r[t].feature;if(i[e.layer.id]<o)break;n.push(e),r.pop()}else for(const e of t){const t=e[s];if(t)for(const e of t)n.push(e.feature)}}return n}queryRenderedFeatures(e,i,r){i&&i.filter&&this._validate(t.y.filter,"queryRenderedFeatures.filter",i.filter,null,i);const n={};if(i&&i.layers){if(!Array.isArray(i.layers))return this.fire(new t.j(new Error("parameters.layers must be an Array."))),[];for(const e of i.layers){const i=this._layers[e];if(!i)return this.fire(new t.j(new Error(`The layer '${e}' does not exist in the map's style and cannot be queried for features.`))),[];n[i.source]=!0}}const o=[];i.availableImages=this._availableImages;const s=this._serializedAllLayers();for(const t in this.sourceCaches)i.layers&&!n[t]||o.push(G(this.sourceCaches[t],this._layers,s,e,i,r));return this.placement&&o.push(function(t,e,i,r,n,o,s){const a={},l=o.queryRenderedSymbols(r),c=[];for(const t of Object.keys(l).map(Number))c.push(s[t]);c.sort($);for(const i of c){const r=i.featureIndex.lookupSymbolFeatures(l[i.bucketInstanceId],e,i.bucketIndex,i.sourceLayerIndex,n.filter,n.layers,n.availableImages,t);for(const t in r){const e=a[t]=a[t]||[],n=r[t];n.sort(((t,e)=>{const r=i.featureSortOrder;if(r){const i=r.indexOf(t.featureIndex);return r.indexOf(e.featureIndex)-i}return e.featureIndex-t.featureIndex}));for(const t of n)e.push(t)}}for(const e in a)a[e].forEach((r=>{const n=r.feature,o=i[t[e].source].getFeatureState(n.layer["source-layer"],n.id);n.source=n.layer.source,n.layer["source-layer"]&&(n.sourceLayer=n.layer["source-layer"]),n.state=o}));return a}(this._layers,s,this.sourceCaches,e,i,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(o)}querySourceFeatures(e,i){i&&i.filter&&this._validate(t.y.filter,"querySourceFeatures.filter",i.filter,null,i);const r=this.sourceCaches[e];return r?function(t,e){const i=t.getRenderableIds().map((e=>t.getTileByID(e))),r=[],n={};for(let t=0;t<i.length;t++){const o=i[t],s=o.tileID.canonical.key;n[s]||(n[s]=!0,o.querySourceFeatures(r,e))}return r}(r,i):[]}addSourceType(t,e,i){return j(t)?i(new Error(`A source type called "${t}" already exists.`)):(((t,e)=>{V[t]=e})(t,e),e.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:e.workerSourceURL},i):i(null,null))}getLight(){return this.light.getLight()}setLight(e,i={}){this._checkLoaded();const r=this.light.getLight();let n=!1;for(const i in e)if(!t.aG(e[i],r[i])){n=!0;break}if(!n)return;const o={now:t.h.now(),transition:t.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,i),this.light.updateTransitions(o)}_validate(e,i,r,n,o={}){return(!o||!1!==o.validate)&&Yt(this,e.call(t.y,t.e({key:i,style:this.serialize(),value:r,styleSpec:t.v},n)))}_remove(e=!0){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),t.aJ.off("pluginStateChange",this._rtlTextPluginCallback);for(const t in this._layers)this._layers[t].setEventedParent(null);for(const t in this.sourceCaches){const e=this.sourceCaches[t];e.setEventedParent(null),e.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove(e)}_clearSource(t){this.sourceCaches[t].clearTiles()}_reloadSource(t){this.sourceCaches[t].resume(),this.sourceCaches[t].reload()}_updateSources(t){for(const e in this.sourceCaches)this.sourceCaches[e].update(t,this.map.terrain)}_generateCollisionBoxes(){for(const t in this.sourceCaches)this._reloadSource(t)}_updatePlacement(e,i,r,n,o=!1){let s=!1,a=!1;const l={};for(const t of this._order){const i=this._layers[t];if("symbol"!==i.type)continue;if(!l[i.source]){const t=this.sourceCaches[i.source];l[i.source]=t.getRenderableIds(!0).map((e=>t.getTileByID(e))).sort(((t,e)=>e.tileID.overscaledZ-t.tileID.overscaledZ||(t.tileID.isLessThan(e.tileID)?-1:1)))}const r=this.crossTileSymbolIndex.addLayer(i,l[i.source],e.center.lng);s=s||r}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((o=o||this._layerOrderChanged||0===r)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(t.h.now(),e.zoom))&&(this.pauseablePlacement=new Zt(e,this.map.terrain,this._order,o,i,r,n,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,l),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(t.h.now()),a=!0),s&&this.pauseablePlacement.placement.setStale()),a||s)for(const t of this._order){const e=this._layers[t];"symbol"===e.type&&this.placement.updateLayerOpacities(e,l[e.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(t.h.now())}_releaseSymbolFadeTiles(){for(const t in this.sourceCaches)this.sourceCaches[t].releaseSymbolFadeTiles()}getImages(t,e,i){this.imageManager.getImages(e.icons,i),this._updateTilesForChangedImages();const r=this.sourceCaches[e.source];r&&r.setDependencies(e.tileID.key,e.type,e.icons)}getGlyphs(t,e,i){this.glyphManager.getGlyphs(e.stacks,i);const r=this.sourceCaches[e.source];r&&r.setDependencies(e.tileID.key,e.type,[""])}getResource(e,i,r){return t.m(i,r)}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(e,i={}){this._checkLoaded(),e&&this._validate(t.y.glyphs,"glyphs",e,null,i)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=e,this.glyphManager.entries={},this.glyphManager.setURL(e))}addSprite(e,i,r={},n){this._checkLoaded();const o=[{id:e,url:i}],s=[...g(this.stylesheet.sprite),...o];this._validate(t.y.sprite,"sprite",s,null,r)||(this.stylesheet.sprite=s,this._loadSprite(o,!0,n))}removeSprite(e){this._checkLoaded();const i=g(this.stylesheet.sprite);if(i.find((t=>t.id===e))){if(this._spritesImagesIds[e])for(const t of this._spritesImagesIds[e])this.imageManager.removeImage(t),this._changedImages[t]=!0;i.splice(i.findIndex((t=>t.id===e)),1),this.stylesheet.sprite=i.length>0?i:void 0,delete this._spritesImagesIds[e],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new t.k("data",{dataType:"style"}))}else this.fire(new t.j(new Error(`Sprite "${e}" doesn't exists on this map.`)))}getSprite(){return g(this.stylesheet.sprite)}setSprite(e,i={},r){this._checkLoaded(),e&&this._validate(t.y.sprite,"sprite",e,null,i)||(this.stylesheet.sprite=e,e?this._loadSprite(e,!0,r):(this._unloadSprite(),r&&r(null)))}}re.registerForPluginStateChange=t.aK;var ne=t.Q([{name:"a_pos",type:"Int16",components:2}]),oe="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";const se={prelude:ae("#ifdef GL_ES\nprecision mediump float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif\n","#ifdef GL_ES\nprecision highp float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}\n#ifdef TERRAIN3D\nuniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;\n#endif\nconst highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {\n#ifdef TERRAIN3D\nhighp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));\n#else\nreturn 1.0;\n#endif\n}float calculate_visibility(vec4 pos) {\n#ifdef TERRAIN3D\nvec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;\n#else\nreturn 1.0;\n#endif\n}float ele(vec2 pos) {\n#ifdef TERRAIN3D\nvec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;\n#else\nreturn 0.0;\n#endif\n}float get_elevation(vec2 pos) {\n#ifdef TERRAIN3D\nvec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;\n#else\nreturn 0.0;\n#endif\n}"),background:ae("uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:ae("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:ae("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}"),clippingMask:ae("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:ae("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}"),heatmapTexture:ae("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:ae("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:ae("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:ae("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:ae("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_FragColor=color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);}"),fillOutline:ae("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}"),fillOutlinePattern:ae("uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}"),fillPattern:ae("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}"),fillExtrusion:ae("varying vec4 v_color;void main() {gl_FragColor=v_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;\n#ifdef TERRAIN3D\nattribute vec2 a_centroid;\n#endif\nvarying vec4 v_color;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec3 normal=a_normal_ed.xyz;\n#ifdef TERRAIN3D\nfloat height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);\n#else\nfloat height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;\n#endif\nbase=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}"),fillExtrusionPattern:ae("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;\n#ifdef TERRAIN3D\nattribute vec2 a_centroid;\n#endif\nvarying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;\n#ifdef TERRAIN3D\nfloat height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);\n#else\nfloat height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;\n#endif\nbase=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0\n? a_pos\n: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}"),hillshadePrepare:ae("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:ae("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;\n#define PI 3.141592653589793\nvoid main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:ae("uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;\n#ifdef TERRAIN3D\nv_gamma_scale=1.0;\n#else\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#endif\nv_width2=vec2(outset,inset);}"),lineGradient:ae("uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;\n#ifdef TERRAIN3D\nv_gamma_scale=1.0;\n#else\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#endif\nv_width2=vec2(outset,inset);}"),linePattern:ae("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\n#define LINE_DISTANCE_SCALE 2.0\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;\n#ifdef TERRAIN3D\nv_gamma_scale=1.0;\n#else\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}"),lineSDF:ae("uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\n#define LINE_DISTANCE_SCALE 2.0\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;\n#ifdef TERRAIN3D\nv_gamma_scale=1.0;\n#else\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#endif\nv_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}"),raster:ae("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:ae("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}"),symbolSDF:ae("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}"),symbolTextAndIcon:ae("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}"),terrain:ae("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",oe),terrainDepth:ae("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",oe),terrainCoords:ae("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",oe)};function ae(t,e){const i=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,r=e.match(/attribute ([\w]+) ([\w]+)/g),n=t.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),o=e.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),s=o?o.concat(n):n,a={};return{fragmentSource:t=t.replace(i,((t,e,i,r,n)=>(a[n]=!0,"define"===e?`\n#ifndef HAS_UNIFORM_u_${n}\nvarying ${i} ${r} ${n};\n#else\nuniform ${i} ${r} u_${n};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${n}\n    ${i} ${r} ${n} = u_${n};\n#endif\n`))),vertexSource:e=e.replace(i,((t,e,i,r,n)=>{const o="float"===r?"vec2":"vec4",s=n.match(/color/)?"color":o;return a[n]?"define"===e?`\n#ifndef HAS_UNIFORM_u_${n}\nuniform lowp float u_${n}_t;\nattribute ${i} ${o} a_${n};\nvarying ${i} ${r} ${n};\n#else\nuniform ${i} ${r} u_${n};\n#endif\n`:"vec4"===s?`\n#ifndef HAS_UNIFORM_u_${n}\n    ${n} = a_${n};\n#else\n    ${i} ${r} ${n} = u_${n};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${n}\n    ${n} = unpack_mix_${s}(a_${n}, u_${n}_t);\n#else\n    ${i} ${r} ${n} = u_${n};\n#endif\n`:"define"===e?`\n#ifndef HAS_UNIFORM_u_${n}\nuniform lowp float u_${n}_t;\nattribute ${i} ${o} a_${n};\n#else\nuniform ${i} ${r} u_${n};\n#endif\n`:"vec4"===s?`\n#ifndef HAS_UNIFORM_u_${n}\n    ${i} ${r} ${n} = a_${n};\n#else\n    ${i} ${r} ${n} = u_${n};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${n}\n    ${i} ${r} ${n} = unpack_mix_${s}(a_${n}, u_${n}_t);\n#else\n    ${i} ${r} ${n} = u_${n};\n#endif\n`})),staticAttributes:r,staticUniforms:s}}class le{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,e,i,r,n,o,s,a,l){this.context=t;let c=this.boundPaintVertexBuffers.length!==r.length;for(let t=0;!c&&t<r.length;t++)this.boundPaintVertexBuffers[t]!==r[t]&&(c=!0);!this.vao||this.boundProgram!==e||this.boundLayoutVertexBuffer!==i||c||this.boundIndexBuffer!==n||this.boundVertexOffset!==o||this.boundDynamicVertexBuffer!==s||this.boundDynamicVertexBuffer2!==a||this.boundDynamicVertexBuffer3!==l?this.freshBind(e,i,r,n,o,s,a,l):(t.bindVertexArray.set(this.vao),s&&s.bind(),n&&n.dynamicDraw&&n.bind(),a&&a.bind(),l&&l.bind())}freshBind(t,e,i,r,n,o,s,a){const l=t.numAttributes,c=this.context,u=c.gl;this.vao&&this.destroy(),this.vao=c.createVertexArray(),c.bindVertexArray.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=e,this.boundPaintVertexBuffers=i,this.boundIndexBuffer=r,this.boundVertexOffset=n,this.boundDynamicVertexBuffer=o,this.boundDynamicVertexBuffer2=s,this.boundDynamicVertexBuffer3=a,e.enableAttributes(u,t);for(const e of i)e.enableAttributes(u,t);o&&o.enableAttributes(u,t),s&&s.enableAttributes(u,t),a&&a.enableAttributes(u,t),e.bind(),e.setVertexAttribPointers(u,t,n);for(const e of i)e.bind(),e.setVertexAttribPointers(u,t,n);o&&(o.bind(),o.setVertexAttribPointers(u,t,n)),r&&r.bind(),s&&(s.bind(),s.setVertexAttribPointers(u,t,n)),a&&(a.bind(),a.setVertexAttribPointers(u,t,n)),c.currentNumAttributes=l}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}function ce(t){const e=[];for(let i=0;i<t.length;i++){if(null===t[i])continue;const r=t[i].split(" ");e.push(r.pop())}return e}class ue{constructor(e,i,r,n,o,s){const a=e.gl;this.program=a.createProgram();const l=ce(i.staticAttributes),c=r?r.getBinderAttributes():[],u=l.concat(c),h=se.prelude.staticUniforms?ce(se.prelude.staticUniforms):[],d=i.staticUniforms?ce(i.staticUniforms):[],p=r?r.getBinderUniforms():[],f=h.concat(d).concat(p),A=[];for(const t of f)A.indexOf(t)<0&&A.push(t);const m=r?r.defines():[];o&&m.push("#define OVERDRAW_INSPECTOR;"),s&&m.push("#define TERRAIN3D;");const g=m.concat(se.prelude.fragmentSource,i.fragmentSource).join("\n"),_=m.concat(se.prelude.vertexSource,i.vertexSource).join("\n"),y=a.createShader(a.FRAGMENT_SHADER);if(a.isContextLost())return void(this.failedToCreate=!0);if(a.shaderSource(y,g),a.compileShader(y),!a.getShaderParameter(y,a.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${a.getShaderInfoLog(y)}`);a.attachShader(this.program,y);const v=a.createShader(a.VERTEX_SHADER);if(a.isContextLost())return void(this.failedToCreate=!0);if(a.shaderSource(v,_),a.compileShader(v),!a.getShaderParameter(v,a.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${a.getShaderInfoLog(v)}`);a.attachShader(this.program,v),this.attributes={};const x={};this.numAttributes=u.length;for(let t=0;t<this.numAttributes;t++)u[t]&&(a.bindAttribLocation(this.program,t,u[t]),this.attributes[u[t]]=t);if(a.linkProgram(this.program),!a.getProgramParameter(this.program,a.LINK_STATUS))throw new Error(`Program failed to link: ${a.getProgramInfoLog(this.program)}`);a.deleteShader(v),a.deleteShader(y);for(let t=0;t<A.length;t++){const e=A[t];if(e&&!x[e]){const t=a.getUniformLocation(this.program,e);t&&(x[e]=t)}}this.fixedUniforms=n(e,x),this.terrainUniforms=((e,i)=>({u_depth:new t.aL(e,i.u_depth),u_terrain:new t.aL(e,i.u_terrain),u_terrain_dim:new t.aM(e,i.u_terrain_dim),u_terrain_matrix:new t.aN(e,i.u_terrain_matrix),u_terrain_unpack:new t.aO(e,i.u_terrain_unpack),u_terrain_exaggeration:new t.aM(e,i.u_terrain_exaggeration)}))(e,x),this.binderUniforms=r?r.getUniforms(e,x):[]}draw(t,e,i,r,n,o,s,a,l,c,u,h,d,p,f,A,m,g){const _=t.gl;if(this.failedToCreate)return;if(t.program.set(this.program),t.setDepthMode(i),t.setStencilMode(r),t.setColorMode(n),t.setCullFace(o),a){t.activeTexture.set(_.TEXTURE2),_.bindTexture(_.TEXTURE_2D,a.depthTexture),t.activeTexture.set(_.TEXTURE3),_.bindTexture(_.TEXTURE_2D,a.texture);for(const t in this.terrainUniforms)this.terrainUniforms[t].set(a[t])}for(const t in this.fixedUniforms)this.fixedUniforms[t].set(s[t]);f&&f.setUniforms(t,this.binderUniforms,d,{zoom:p});let y=0;switch(e){case _.LINES:y=2;break;case _.TRIANGLES:y=3;break;case _.LINE_STRIP:y=1}for(const i of h.get()){const r=i.vaos||(i.vaos={});(r[l]||(r[l]=new le)).bind(t,this,c,f?f.getPaintVertexBuffers():[],u,i.vertexOffset,A,m,g),_.drawElements(e,i.primitiveLength*y,_.UNSIGNED_SHORT,i.primitiveOffset*y*2)}}}function he(t,e,i){const r=1/Et(i,1,e.transform.tileZoom),n=Math.pow(2,i.tileID.overscaledZ),o=i.tileSize*Math.pow(2,e.transform.tileZoom)/n,s=o*(i.tileID.canonical.x+i.tileID.wrap*n),a=o*i.tileID.canonical.y;return{u_image:0,u_texsize:i.imageAtlasTexture.size,u_scale:[r,t.fromScale,t.toScale],u_fade:t.t,u_pixel_coord_upper:[s>>16,a>>16],u_pixel_coord_lower:[65535&s,65535&a]}}const de=(e,i,r,n)=>{const o=i.style.light,s=o.properties.get("position"),a=[s.x,s.y,s.z],l=function(){var e=new t.A(9);return t.A!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}();"viewport"===o.properties.get("anchor")&&function(t,e){var i=Math.sin(e),r=Math.cos(e);t[0]=r,t[1]=i,t[2]=0,t[3]=-i,t[4]=r,t[5]=0,t[6]=0,t[7]=0,t[8]=1}(l,-i.transform.angle),function(t,e,i){var r=e[0],n=e[1],o=e[2];t[0]=r*i[0]+n*i[3]+o*i[6],t[1]=r*i[1]+n*i[4]+o*i[7],t[2]=r*i[2]+n*i[5]+o*i[8]}(a,a,l);const c=o.properties.get("color");return{u_matrix:e,u_lightpos:a,u_lightintensity:o.properties.get("intensity"),u_lightcolor:[c.r,c.g,c.b],u_vertical_gradient:+r,u_opacity:n}},pe=(e,i,r,n,o,s,a)=>t.e(de(e,i,r,n),he(s,i,a),{u_height_factor:-Math.pow(2,o.overscaledZ)/a.tileSize/8}),fe=t=>({u_matrix:t}),Ae=(e,i,r,n)=>t.e(fe(e),he(r,i,n)),me=(t,e)=>({u_matrix:t,u_world:e}),ge=(e,i,r,n,o)=>t.e(Ae(e,i,r,n),{u_world:o}),_e=(t,e,i,r)=>{const n=t.transform;let o,s;if("map"===r.paint.get("circle-pitch-alignment")){const t=Et(i,1,n.zoom);o=!0,s=[t,t]}else o=!1,s=n.pixelsToGLUnits;return{u_camera_to_center_distance:n.cameraToCenterDistance,u_scale_with_map:+("map"===r.paint.get("circle-pitch-scale")),u_matrix:t.translatePosMatrix(e.posMatrix,i,r.paint.get("circle-translate"),r.paint.get("circle-translate-anchor")),u_pitch_with_map:+o,u_device_pixel_ratio:t.pixelRatio,u_extrude_scale:s}},ye=(t,e,i)=>{const r=Et(i,1,e.zoom),n=Math.pow(2,e.zoom-i.tileID.overscaledZ),o=i.tileID.overscaleFactor();return{u_matrix:t,u_camera_to_center_distance:e.cameraToCenterDistance,u_pixels_to_tile_units:r,u_extrude_scale:[e.pixelsToGLUnits[0]/(r*n),e.pixelsToGLUnits[1]/(r*n)],u_overscale_factor:o}},ve=(t,e,i=1)=>({u_matrix:t,u_color:e,u_overlay:0,u_overlay_scale:i}),xe=t=>({u_matrix:t}),be=(t,e,i,r)=>({u_matrix:t,u_extrude_scale:Et(e,1,i),u_intensity:r});function we(e,i){const r=Math.pow(2,i.canonical.z),n=i.canonical.y;return[new t.U(0,n/r).toLngLat().lat,new t.U(0,(n+1)/r).toLngLat().lat]}const Te=(t,e,i,r)=>{const n=t.transform;return{u_matrix:Ie(t,e,i,r),u_ratio:1/Et(e,1,n.zoom),u_device_pixel_ratio:t.pixelRatio,u_units_to_pixels:[1/n.pixelsToGLUnits[0],1/n.pixelsToGLUnits[1]]}},Be=(e,i,r,n,o)=>t.e(Te(e,i,r,o),{u_image:0,u_image_height:n}),Ee=(t,e,i,r,n)=>{const o=t.transform,s=Se(e,o);return{u_matrix:Ie(t,e,i,n),u_texsize:e.imageAtlasTexture.size,u_ratio:1/Et(e,1,o.zoom),u_device_pixel_ratio:t.pixelRatio,u_image:0,u_scale:[s,r.fromScale,r.toScale],u_fade:r.t,u_units_to_pixels:[1/o.pixelsToGLUnits[0],1/o.pixelsToGLUnits[1]]}},Ce=(e,i,r,n,o,s)=>{const a=e.lineAtlas,l=Se(i,e.transform),c="round"===r.layout.get("line-cap"),u=a.getDash(n.from,c),h=a.getDash(n.to,c),d=u.width*o.fromScale,p=h.width*o.toScale;return t.e(Te(e,i,r,s),{u_patternscale_a:[l/d,-u.height/2],u_patternscale_b:[l/p,-h.height/2],u_sdfgamma:a.width/(256*Math.min(d,p)*e.pixelRatio)/2,u_image:0,u_tex_y_a:u.y,u_tex_y_b:h.y,u_mix:o.t})};function Se(t,e){return 1/Et(t,1,e.tileZoom)}function Ie(t,e,i,r){return t.translatePosMatrix(r?r.posMatrix:e.tileID.posMatrix,e,i.paint.get("line-translate"),i.paint.get("line-translate-anchor"))}const Me=(t,e,i,r,n)=>{return{u_matrix:t,u_tl_parent:e,u_scale_parent:i,u_buffer_scale:1,u_fade_t:r.mix,u_opacity:r.opacity*n.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:n.paint.get("raster-brightness-min"),u_brightness_high:n.paint.get("raster-brightness-max"),u_saturation_factor:(s=n.paint.get("raster-saturation"),s>0?1-1/(1.001-s):-s),u_contrast_factor:(o=n.paint.get("raster-contrast"),o>0?1/(1-o):1+o),u_spin_weights:ke(n.paint.get("raster-hue-rotate"))};var o,s};function ke(t){t*=Math.PI/180;const e=Math.sin(t),i=Math.cos(t);return[(2*i+1)/3,(-Math.sqrt(3)*e-i+1)/3,(Math.sqrt(3)*e-i+1)/3]}const Pe=(t,e,i,r,n,o,s,a,l,c)=>{const u=n.transform;return{u_is_size_zoom_constant:+("constant"===t||"source"===t),u_is_size_feature_constant:+("constant"===t||"camera"===t),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:u.cameraToCenterDistance,u_pitch:u.pitch/360*2*Math.PI,u_rotate_symbol:+i,u_aspect_ratio:u.width/u.height,u_fade_change:n.options.fadeDuration?n.symbolFadeChange:1,u_matrix:o,u_label_plane_matrix:s,u_coord_matrix:a,u_is_text:+l,u_pitch_with_map:+r,u_texsize:c,u_texture:0}},Le=(e,i,r,n,o,s,a,l,c,u,h)=>{const d=o.transform;return t.e(Pe(e,i,r,n,o,s,a,l,c,u),{u_gamma_scale:n?Math.cos(d._pitch)*d.cameraToCenterDistance:1,u_device_pixel_ratio:o.pixelRatio,u_is_halo:+h})},ze=(e,i,r,n,o,s,a,l,c,u)=>t.e(Le(e,i,r,n,o,s,a,l,!0,c,!0),{u_texsize_icon:u,u_texture_icon:1}),Fe=(t,e,i)=>({u_matrix:t,u_opacity:e,u_color:i}),De=(e,i,r,n,o,s)=>t.e(function(t,e,i,r){const n=i.imageManager.getPattern(t.from.toString()),o=i.imageManager.getPattern(t.to.toString()),{width:s,height:a}=i.imageManager.getPixelSize(),l=Math.pow(2,r.tileID.overscaledZ),c=r.tileSize*Math.pow(2,i.transform.tileZoom)/l,u=c*(r.tileID.canonical.x+r.tileID.wrap*l),h=c*r.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:n.tl,u_pattern_br_a:n.br,u_pattern_tl_b:o.tl,u_pattern_br_b:o.br,u_texsize:[s,a],u_mix:e.t,u_pattern_size_a:n.displaySize,u_pattern_size_b:o.displaySize,u_scale_a:e.fromScale,u_scale_b:e.toScale,u_tile_units_to_pixels:1/Et(r,1,i.transform.tileZoom),u_pixel_coord_upper:[u>>16,h>>16],u_pixel_coord_lower:[65535&u,65535&h]}}(n,s,r,o),{u_matrix:e,u_opacity:i}),Re={fillExtrusion:(e,i)=>({u_matrix:new t.aN(e,i.u_matrix),u_lightpos:new t.aP(e,i.u_lightpos),u_lightintensity:new t.aM(e,i.u_lightintensity),u_lightcolor:new t.aP(e,i.u_lightcolor),u_vertical_gradient:new t.aM(e,i.u_vertical_gradient),u_opacity:new t.aM(e,i.u_opacity)}),fillExtrusionPattern:(e,i)=>({u_matrix:new t.aN(e,i.u_matrix),u_lightpos:new t.aP(e,i.u_lightpos),u_lightintensity:new t.aM(e,i.u_lightintensity),u_lightcolor:new t.aP(e,i.u_lightcolor),u_vertical_gradient:new t.aM(e,i.u_vertical_gradient),u_height_factor:new t.aM(e,i.u_height_factor),u_image:new t.aL(e,i.u_image),u_texsize:new t.aQ(e,i.u_texsize),u_pixel_coord_upper:new t.aQ(e,i.u_pixel_coord_upper),u_pixel_coord_lower:new t.aQ(e,i.u_pixel_coord_lower),u_scale:new t.aP(e,i.u_scale),u_fade:new t.aM(e,i.u_fade),u_opacity:new t.aM(e,i.u_opacity)}),fill:(e,i)=>({u_matrix:new t.aN(e,i.u_matrix)}),fillPattern:(e,i)=>({u_matrix:new t.aN(e,i.u_matrix),u_image:new t.aL(e,i.u_image),u_texsize:new t.aQ(e,i.u_texsize),u_pixel_coord_upper:new t.aQ(e,i.u_pixel_coord_upper),u_pixel_coord_lower:new t.aQ(e,i.u_pixel_coord_lower),u_scale:new t.aP(e,i.u_scale),u_fade:new t.aM(e,i.u_fade)}),fillOutline:(e,i)=>({u_matrix:new t.aN(e,i.u_matrix),u_world:new t.aQ(e,i.u_world)}),fillOutlinePattern:(e,i)=>({u_matrix:new t.aN(e,i.u_matrix),u_world:new t.aQ(e,i.u_world),u_image:new t.aL(e,i.u_image),u_texsize:new t.aQ(e,i.u_texsize),u_pixel_coord_upper:new t.aQ(e,i.u_pixel_coord_upper),u_pixel_coord_lower:new t.aQ(e,i.u_pixel_coord_lower),u_scale:new t.aP(e,i.u_scale),u_fade:new t.aM(e,i.u_fade)}),circle:(e,i)=>({u_camera_to_center_distance:new t.aM(e,i.u_camera_to_center_distance),u_scale_with_map:new t.aL(e,i.u_scale_with_map),u_pitch_with_map:new t.aL(e,i.u_pitch_with_map),u_extrude_scale:new t.aQ(e,i.u_extrude_scale),u_device_pixel_ratio:new t.aM(e,i.u_device_pixel_ratio),u_matrix:new t.aN(e,i.u_matrix)}),collisionBox:(e,i)=>({u_matrix:new t.aN(e,i.u_matrix),u_camera_to_center_distance:new t.aM(e,i.u_camera_to_center_distance),u_pixels_to_tile_units:new t.aM(e,i.u_pixels_to_tile_units),u_extrude_scale:new t.aQ(e,i.u_extrude_scale),u_overscale_factor:new t.aM(e,i.u_overscale_factor)}),collisionCircle:(e,i)=>({u_matrix:new t.aN(e,i.u_matrix),u_inv_matrix:new t.aN(e,i.u_inv_matrix),u_camera_to_center_distance:new t.aM(e,i.u_camera_to_center_distance),u_viewport_size:new t.aQ(e,i.u_viewport_size)}),debug:(e,i)=>({u_color:new t.aR(e,i.u_color),u_matrix:new t.aN(e,i.u_matrix),u_overlay:new t.aL(e,i.u_overlay),u_overlay_scale:new t.aM(e,i.u_overlay_scale)}),clippingMask:(e,i)=>({u_matrix:new t.aN(e,i.u_matrix)}),heatmap:(e,i)=>({u_extrude_scale:new t.aM(e,i.u_extrude_scale),u_intensity:new t.aM(e,i.u_intensity),u_matrix:new t.aN(e,i.u_matrix)}),heatmapTexture:(e,i)=>({u_matrix:new t.aN(e,i.u_matrix),u_world:new t.aQ(e,i.u_world),u_image:new t.aL(e,i.u_image),u_color_ramp:new t.aL(e,i.u_color_ramp),u_opacity:new t.aM(e,i.u_opacity)}),hillshade:(e,i)=>({u_matrix:new t.aN(e,i.u_matrix),u_image:new t.aL(e,i.u_image),u_latrange:new t.aQ(e,i.u_latrange),u_light:new t.aQ(e,i.u_light),u_shadow:new t.aR(e,i.u_shadow),u_highlight:new t.aR(e,i.u_highlight),u_accent:new t.aR(e,i.u_accent)}),hillshadePrepare:(e,i)=>({u_matrix:new t.aN(e,i.u_matrix),u_image:new t.aL(e,i.u_image),u_dimension:new t.aQ(e,i.u_dimension),u_zoom:new t.aM(e,i.u_zoom),u_unpack:new t.aO(e,i.u_unpack)}),line:(e,i)=>({u_matrix:new t.aN(e,i.u_matrix),u_ratio:new t.aM(e,i.u_ratio),u_device_pixel_ratio:new t.aM(e,i.u_device_pixel_ratio),u_units_to_pixels:new t.aQ(e,i.u_units_to_pixels)}),lineGradient:(e,i)=>({u_matrix:new t.aN(e,i.u_matrix),u_ratio:new t.aM(e,i.u_ratio),u_device_pixel_ratio:new t.aM(e,i.u_device_pixel_ratio),u_units_to_pixels:new t.aQ(e,i.u_units_to_pixels),u_image:new t.aL(e,i.u_image),u_image_height:new t.aM(e,i.u_image_height)}),linePattern:(e,i)=>({u_matrix:new t.aN(e,i.u_matrix),u_texsize:new t.aQ(e,i.u_texsize),u_ratio:new t.aM(e,i.u_ratio),u_device_pixel_ratio:new t.aM(e,i.u_device_pixel_ratio),u_image:new t.aL(e,i.u_image),u_units_to_pixels:new t.aQ(e,i.u_units_to_pixels),u_scale:new t.aP(e,i.u_scale),u_fade:new t.aM(e,i.u_fade)}),lineSDF:(e,i)=>({u_matrix:new t.aN(e,i.u_matrix),u_ratio:new t.aM(e,i.u_ratio),u_device_pixel_ratio:new t.aM(e,i.u_device_pixel_ratio),u_units_to_pixels:new t.aQ(e,i.u_units_to_pixels),u_patternscale_a:new t.aQ(e,i.u_patternscale_a),u_patternscale_b:new t.aQ(e,i.u_patternscale_b),u_sdfgamma:new t.aM(e,i.u_sdfgamma),u_image:new t.aL(e,i.u_image),u_tex_y_a:new t.aM(e,i.u_tex_y_a),u_tex_y_b:new t.aM(e,i.u_tex_y_b),u_mix:new t.aM(e,i.u_mix)}),raster:(e,i)=>({u_matrix:new t.aN(e,i.u_matrix),u_tl_parent:new t.aQ(e,i.u_tl_parent),u_scale_parent:new t.aM(e,i.u_scale_parent),u_buffer_scale:new t.aM(e,i.u_buffer_scale),u_fade_t:new t.aM(e,i.u_fade_t),u_opacity:new t.aM(e,i.u_opacity),u_image0:new t.aL(e,i.u_image0),u_image1:new t.aL(e,i.u_image1),u_brightness_low:new t.aM(e,i.u_brightness_low),u_brightness_high:new t.aM(e,i.u_brightness_high),u_saturation_factor:new t.aM(e,i.u_saturation_factor),u_contrast_factor:new t.aM(e,i.u_contrast_factor),u_spin_weights:new t.aP(e,i.u_spin_weights)}),symbolIcon:(e,i)=>({u_is_size_zoom_constant:new t.aL(e,i.u_is_size_zoom_constant),u_is_size_feature_constant:new t.aL(e,i.u_is_size_feature_constant),u_size_t:new t.aM(e,i.u_size_t),u_size:new t.aM(e,i.u_size),u_camera_to_center_distance:new t.aM(e,i.u_camera_to_center_distance),u_pitch:new t.aM(e,i.u_pitch),u_rotate_symbol:new t.aL(e,i.u_rotate_symbol),u_aspect_ratio:new t.aM(e,i.u_aspect_ratio),u_fade_change:new t.aM(e,i.u_fade_change),u_matrix:new t.aN(e,i.u_matrix),u_label_plane_matrix:new t.aN(e,i.u_label_plane_matrix),u_coord_matrix:new t.aN(e,i.u_coord_matrix),u_is_text:new t.aL(e,i.u_is_text),u_pitch_with_map:new t.aL(e,i.u_pitch_with_map),u_texsize:new t.aQ(e,i.u_texsize),u_texture:new t.aL(e,i.u_texture)}),symbolSDF:(e,i)=>({u_is_size_zoom_constant:new t.aL(e,i.u_is_size_zoom_constant),u_is_size_feature_constant:new t.aL(e,i.u_is_size_feature_constant),u_size_t:new t.aM(e,i.u_size_t),u_size:new t.aM(e,i.u_size),u_camera_to_center_distance:new t.aM(e,i.u_camera_to_center_distance),u_pitch:new t.aM(e,i.u_pitch),u_rotate_symbol:new t.aL(e,i.u_rotate_symbol),u_aspect_ratio:new t.aM(e,i.u_aspect_ratio),u_fade_change:new t.aM(e,i.u_fade_change),u_matrix:new t.aN(e,i.u_matrix),u_label_plane_matrix:new t.aN(e,i.u_label_plane_matrix),u_coord_matrix:new t.aN(e,i.u_coord_matrix),u_is_text:new t.aL(e,i.u_is_text),u_pitch_with_map:new t.aL(e,i.u_pitch_with_map),u_texsize:new t.aQ(e,i.u_texsize),u_texture:new t.aL(e,i.u_texture),u_gamma_scale:new t.aM(e,i.u_gamma_scale),u_device_pixel_ratio:new t.aM(e,i.u_device_pixel_ratio),u_is_halo:new t.aL(e,i.u_is_halo)}),symbolTextAndIcon:(e,i)=>({u_is_size_zoom_constant:new t.aL(e,i.u_is_size_zoom_constant),u_is_size_feature_constant:new t.aL(e,i.u_is_size_feature_constant),u_size_t:new t.aM(e,i.u_size_t),u_size:new t.aM(e,i.u_size),u_camera_to_center_distance:new t.aM(e,i.u_camera_to_center_distance),u_pitch:new t.aM(e,i.u_pitch),u_rotate_symbol:new t.aL(e,i.u_rotate_symbol),u_aspect_ratio:new t.aM(e,i.u_aspect_ratio),u_fade_change:new t.aM(e,i.u_fade_change),u_matrix:new t.aN(e,i.u_matrix),u_label_plane_matrix:new t.aN(e,i.u_label_plane_matrix),u_coord_matrix:new t.aN(e,i.u_coord_matrix),u_is_text:new t.aL(e,i.u_is_text),u_pitch_with_map:new t.aL(e,i.u_pitch_with_map),u_texsize:new t.aQ(e,i.u_texsize),u_texsize_icon:new t.aQ(e,i.u_texsize_icon),u_texture:new t.aL(e,i.u_texture),u_texture_icon:new t.aL(e,i.u_texture_icon),u_gamma_scale:new t.aM(e,i.u_gamma_scale),u_device_pixel_ratio:new t.aM(e,i.u_device_pixel_ratio),u_is_halo:new t.aL(e,i.u_is_halo)}),background:(e,i)=>({u_matrix:new t.aN(e,i.u_matrix),u_opacity:new t.aM(e,i.u_opacity),u_color:new t.aR(e,i.u_color)}),backgroundPattern:(e,i)=>({u_matrix:new t.aN(e,i.u_matrix),u_opacity:new t.aM(e,i.u_opacity),u_image:new t.aL(e,i.u_image),u_pattern_tl_a:new t.aQ(e,i.u_pattern_tl_a),u_pattern_br_a:new t.aQ(e,i.u_pattern_br_a),u_pattern_tl_b:new t.aQ(e,i.u_pattern_tl_b),u_pattern_br_b:new t.aQ(e,i.u_pattern_br_b),u_texsize:new t.aQ(e,i.u_texsize),u_mix:new t.aM(e,i.u_mix),u_pattern_size_a:new t.aQ(e,i.u_pattern_size_a),u_pattern_size_b:new t.aQ(e,i.u_pattern_size_b),u_scale_a:new t.aM(e,i.u_scale_a),u_scale_b:new t.aM(e,i.u_scale_b),u_pixel_coord_upper:new t.aQ(e,i.u_pixel_coord_upper),u_pixel_coord_lower:new t.aQ(e,i.u_pixel_coord_lower),u_tile_units_to_pixels:new t.aM(e,i.u_tile_units_to_pixels)}),terrain:(e,i)=>({u_matrix:new t.aN(e,i.u_matrix),u_texture:new t.aL(e,i.u_texture),u_ele_delta:new t.aM(e,i.u_ele_delta)}),terrainDepth:(e,i)=>({u_matrix:new t.aN(e,i.u_matrix),u_ele_delta:new t.aM(e,i.u_ele_delta)}),terrainCoords:(e,i)=>({u_matrix:new t.aN(e,i.u_matrix),u_texture:new t.aL(e,i.u_texture),u_terrain_coords_id:new t.aM(e,i.u_terrain_coords_id),u_ele_delta:new t.aM(e,i.u_ele_delta)})};class Ue{constructor(t,e,i){this.context=t;const r=t.gl;this.buffer=r.createBuffer(),this.dynamicDraw=Boolean(i),this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),r.bufferData(r.ELEMENT_ARRAY_BUFFER,e.arrayBuffer,this.dynamicDraw?r.DYNAMIC_DRAW:r.STATIC_DRAW),this.dynamicDraw||delete e.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const e=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),e.bufferSubData(e.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Oe={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Ne{constructor(t,e,i,r){this.length=e.length,this.attributes=i,this.itemSize=e.bytesPerElement,this.dynamicDraw=r,this.context=t;const n=t.gl;this.buffer=n.createBuffer(),t.bindVertexBuffer.set(this.buffer),n.bufferData(n.ARRAY_BUFFER,e.arrayBuffer,this.dynamicDraw?n.DYNAMIC_DRAW:n.STATIC_DRAW),this.dynamicDraw||delete e.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){if(t.length!==this.length)throw new Error(`Length of new data is ${t.length}, which doesn't match current length of ${this.length}`);const e=this.context.gl;this.bind(),e.bufferSubData(e.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,e){for(let i=0;i<this.attributes.length;i++){const r=e.attributes[this.attributes[i].name];void 0!==r&&t.enableVertexAttribArray(r)}}setVertexAttribPointers(t,e,i){for(let r=0;r<this.attributes.length;r++){const n=this.attributes[r],o=e.attributes[n.name];void 0!==o&&t.vertexAttribPointer(o,n.components,t[Oe[n.type]],!1,this.itemSize,n.offset+this.itemSize*(i||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Qe=new WeakMap;function Ve(t){var e;if(Qe.has(t))return Qe.get(t);{const i=null===(e=t.getParameter(t.VERSION))||void 0===e?void 0:e.startsWith("WebGL 2.0");return Qe.set(t,i),i}}class je{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class He extends je{getDefault(){return t.aT.transparent}set(t){const e=this.current;(t.r!==e.r||t.g!==e.g||t.b!==e.b||t.a!==e.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Ge extends je{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class $e extends je{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class Ze extends je{getDefault(){return[!0,!0,!0,!0]}set(t){const e=this.current;(t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||t[3]!==e[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class qe extends je{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class Ke extends je{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class We extends je{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const e=this.current;(t.func!==e.func||t.ref!==e.ref||t.mask!==e.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class Xe extends je{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const e=this.current;(t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class Je extends je{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;t?e.enable(e.STENCIL_TEST):e.disable(e.STENCIL_TEST),this.current=t,this.dirty=!1}}class Ye extends je{getDefault(){return[0,1]}set(t){const e=this.current;(t[0]!==e[0]||t[1]!==e[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class ti extends je{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;t?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),this.current=t,this.dirty=!1}}class ei extends je{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class ii extends je{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;t?e.enable(e.BLEND):e.disable(e.BLEND),this.current=t,this.dirty=!1}}class ri extends je{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const e=this.current;(t[0]!==e[0]||t[1]!==e[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class ni extends je{getDefault(){return t.aT.transparent}set(t){const e=this.current;(t.r!==e.r||t.g!==e.g||t.b!==e.b||t.a!==e.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class oi extends je{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class si extends je{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;t?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),this.current=t,this.dirty=!1}}class ai extends je{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class li extends je{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class ci extends je{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class ui extends je{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class hi extends je{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const e=this.current;(t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||t[3]!==e[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class di extends je{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.bindFramebuffer(e.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class pi extends je{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.bindRenderbuffer(e.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class fi extends je{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.bindTexture(e.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class Ai extends je{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.bindBuffer(e.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class mi extends je{getDefault(){return null}set(t){const e=this.gl;e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class gi extends je{getDefault(){return null}set(t){var e;if(t===this.current&&!this.dirty)return;const i=this.gl;Ve(i)?i.bindVertexArray(t):null===(e=i.getExtension("OES_vertex_array_object"))||void 0===e||e.bindVertexArrayOES(t),this.current=t,this.dirty=!1}}class _i extends je{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.pixelStorei(e.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class yi extends je{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class vi extends je{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class xi extends je{constructor(t,e){super(t),this.context=t,this.parent=e}getDefault(){return null}}class bi extends xi{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const e=this.gl;e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class wi extends xi{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const e=this.gl;e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Ti extends xi{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const e=this.gl;e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Bi{constructor(t,e,i,r,n){this.context=t,this.width=e,this.height=i;const o=t.gl,s=this.framebuffer=o.createFramebuffer();if(this.colorAttachment=new bi(t,s),r)this.depthAttachment=n?new Ti(t,s):new wi(t,s);else if(n)throw new Error("Stencil cannot be setted without depth");if(o.checkFramebufferStatus(o.FRAMEBUFFER)!==o.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const t=this.context.gl,e=this.colorAttachment.get();if(e&&t.deleteTexture(e),this.depthAttachment){const e=this.depthAttachment.get();e&&t.deleteRenderbuffer(e)}t.deleteFramebuffer(this.framebuffer)}}class Ei{constructor(t,e,i){this.blendFunction=t,this.blendColor=e,this.mask=i}}Ei.Replace=[1,0],Ei.disabled=new Ei(Ei.Replace,t.aT.transparent,[!1,!1,!1,!1]),Ei.unblended=new Ei(Ei.Replace,t.aT.transparent,[!0,!0,!0,!0]),Ei.alphaBlended=new Ei([1,771],t.aT.transparent,[!0,!0,!0,!0]);class Ci{constructor(t){var e,i;if(this.gl=t,this.clearColor=new He(this),this.clearDepth=new Ge(this),this.clearStencil=new $e(this),this.colorMask=new Ze(this),this.depthMask=new qe(this),this.stencilMask=new Ke(this),this.stencilFunc=new We(this),this.stencilOp=new Xe(this),this.stencilTest=new Je(this),this.depthRange=new Ye(this),this.depthTest=new ti(this),this.depthFunc=new ei(this),this.blend=new ii(this),this.blendFunc=new ri(this),this.blendColor=new ni(this),this.blendEquation=new oi(this),this.cullFace=new si(this),this.cullFaceSide=new ai(this),this.frontFace=new li(this),this.program=new ci(this),this.activeTexture=new ui(this),this.viewport=new hi(this),this.bindFramebuffer=new di(this),this.bindRenderbuffer=new pi(this),this.bindTexture=new fi(this),this.bindVertexBuffer=new Ai(this),this.bindElementBuffer=new mi(this),this.bindVertexArray=new gi(this),this.pixelStoreUnpack=new _i(this),this.pixelStoreUnpackPremultiplyAlpha=new yi(this),this.pixelStoreUnpackFlipY=new vi(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),Ve(t)){this.HALF_FLOAT=t.HALF_FLOAT;const r=t.getExtension("EXT_color_buffer_half_float");this.RGBA16F=null!==(e=t.RGBA16F)&&void 0!==e?e:null==r?void 0:r.RGBA16F_EXT,this.RGB16F=null!==(i=t.RGB16F)&&void 0!==i?i:null==r?void 0:r.RGB16F_EXT,t.getExtension("EXT_color_buffer_float")}else{t.getExtension("EXT_color_buffer_half_float"),t.getExtension("OES_texture_half_float_linear");const e=t.getExtension("OES_texture_half_float");this.HALF_FLOAT=null==e?void 0:e.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,e){return new Ue(this,t,e)}createVertexBuffer(t,e,i){return new Ne(this,t,e,i)}createRenderbuffer(t,e,i){const r=this.gl,n=r.createRenderbuffer();return this.bindRenderbuffer.set(n),r.renderbufferStorage(r.RENDERBUFFER,t,e,i),this.bindRenderbuffer.set(null),n}createFramebuffer(t,e,i,r){return new Bi(this,t,e,i,r)}clear({color:t,depth:e,stencil:i}){const r=this.gl;let n=0;t&&(n|=r.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),void 0!==e&&(n|=r.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(e),this.depthMask.set(!0)),void 0!==i&&(n|=r.STENCIL_BUFFER_BIT,this.clearStencil.set(i),this.stencilMask.set(255)),r.clear(n)}setCullFace(t){!1===t.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(e){t.aG(e.blendFunction,Ei.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)}createVertexArray(){var t;return Ve(this.gl)?this.gl.createVertexArray():null===(t=this.gl.getExtension("OES_vertex_array_object"))||void 0===t?void 0:t.createVertexArrayOES()}deleteVertexArray(t){var e;return Ve(this.gl)?this.gl.deleteVertexArray(t):null===(e=this.gl.getExtension("OES_vertex_array_object"))||void 0===e?void 0:e.deleteVertexArrayOES(t)}unbindVAO(){this.bindVertexArray.set(null)}}class Si{constructor(t,e,i){this.func=t,this.mask=e,this.range=i}}Si.ReadOnly=!1,Si.ReadWrite=!0,Si.disabled=new Si(519,Si.ReadOnly,[0,1]);const Ii=7680;class Mi{constructor(t,e,i,r,n,o){this.test=t,this.ref=e,this.mask=i,this.fail=r,this.depthFail=n,this.pass=o}}Mi.disabled=new Mi({func:519,mask:0},0,0,Ii,Ii,Ii);class ki{constructor(t,e,i){this.enable=t,this.mode=e,this.frontFace=i}}let Pi;function Li(e,i,r,n,o,s,a){const l=e.context,c=l.gl,u=e.useProgram("collisionBox"),h=[];let d=0,p=0;for(let f=0;f<n.length;f++){const A=n[f],m=i.getTile(A),g=m.getBucket(r);if(!g)continue;let _=A.posMatrix;0===o[0]&&0===o[1]||(_=e.translatePosMatrix(A.posMatrix,m,o,s));const y=a?g.textCollisionBox:g.iconCollisionBox,v=g.collisionCircleArray;if(v.length>0){const i=t.Z(),r=_;t.aU(i,g.placementInvProjMatrix,e.transform.glCoordMatrix),t.aU(i,i,g.placementViewportMatrix),h.push({circleArray:v,circleOffset:p,transform:r,invTransform:i,coord:A}),d+=v.length/4,p=d}y&&u.draw(l,c.LINES,Si.disabled,Mi.disabled,e.colorModeForRenderPass(),ki.disabled,ye(_,e.transform,m),e.style.map.terrain&&e.style.map.terrain.getTerrainData(A),r.id,y.layoutVertexBuffer,y.indexBuffer,y.segments,null,e.transform.zoom,null,null,y.collisionVertexBuffer)}if(!a||!h.length)return;const f=e.useProgram("collisionCircle"),A=new t.aV;A.resize(4*d),A._trim();let m=0;for(const t of h)for(let e=0;e<t.circleArray.length/4;e++){const i=4*e,r=t.circleArray[i+0],n=t.circleArray[i+1],o=t.circleArray[i+2],s=t.circleArray[i+3];A.emplace(m++,r,n,o,s,0),A.emplace(m++,r,n,o,s,1),A.emplace(m++,r,n,o,s,2),A.emplace(m++,r,n,o,s,3)}(!Pi||Pi.length<2*d)&&(Pi=function(e){const i=2*e,r=new t.aX;r.resize(i),r._trim();for(let t=0;t<i;t++){const e=6*t;r.uint16[e+0]=4*t+0,r.uint16[e+1]=4*t+1,r.uint16[e+2]=4*t+2,r.uint16[e+3]=4*t+2,r.uint16[e+4]=4*t+3,r.uint16[e+5]=4*t+0}return r}(d));const g=l.createIndexBuffer(Pi,!0),_=l.createVertexBuffer(A,t.aW.members,!0);for(const i of h){const n={u_matrix:i.transform,u_inv_matrix:i.invTransform,u_camera_to_center_distance:(y=e.transform).cameraToCenterDistance,u_viewport_size:[y.width,y.height]};f.draw(l,c.TRIANGLES,Si.disabled,Mi.disabled,e.colorModeForRenderPass(),ki.disabled,n,e.style.map.terrain&&e.style.map.terrain.getTerrainData(i.coord),r.id,_,g,t.S.simpleSegment(0,2*i.circleOffset,i.circleArray.length,i.circleArray.length/2),null,e.transform.zoom,null,null,null)}var y;_.destroy(),g.destroy()}ki.disabled=new ki(!1,1029,2305),ki.backCCW=new ki(!0,1029,2305);const zi=t.ao(new Float32Array(16));function Fi(e,i,r,n,o,s){const{horizontalAlign:a,verticalAlign:l}=t.au(e);return new t.P((-(a-.5)*i/o+n[0])*s,(-(l-.5)*r/o+n[1])*s)}function Di(e,i,r,n,o,s,a,l,c,u,h){const d=e.text.placedSymbolArray,p=e.text.dynamicLayoutVertexArray,f=e.icon.dynamicLayoutVertexArray,A={};p.clear();for(let f=0;f<d.length;f++){const m=d.get(f),g=m.hidden||!m.crossTileID||e.allowVerticalPlacement&&!m.placedOrientation?null:n[m.crossTileID];if(g){const n=new t.P(m.anchorX,m.anchorY),d=ct(n,r?a:s,h),f=ut(o.cameraToCenterDistance,d.signedDistanceFromCamera);let _=t.aj(e.textSizeData,c,m)*f/t.ap;r&&(_*=e.tilePixelRatio/l);const{width:y,height:v,anchor:x,textOffset:b,textBoxScale:w}=g,T=Fi(x,y,v,b,w,_),B=r?ct(n.add(T),s,h).point:d.point.add(i?T.rotate(-o.angle):T),E=e.allowVerticalPlacement&&m.placedOrientation===t.ai.vertical?Math.PI/2:0;for(let e=0;e<m.numGlyphs;e++)t.ak(p,B,E);u&&m.associatedIconIndex>=0&&(A[m.associatedIconIndex]={shiftedAnchor:B,angle:E})}else bt(m.numGlyphs,p)}if(u){f.clear();const i=e.icon.placedSymbolArray;for(let e=0;e<i.length;e++){const r=i.get(e);if(r.hidden)bt(r.numGlyphs,f);else{const i=A[e];if(i)for(let e=0;e<r.numGlyphs;e++)t.ak(f,i.shiftedAnchor,i.angle);else bt(r.numGlyphs,f)}}e.icon.dynamicLayoutVertexBuffer.updateData(f)}e.text.dynamicLayoutVertexBuffer.updateData(p)}function Ri(t,e,i){return i.iconsInText&&e?"symbolTextAndIcon":t?"symbolSDF":"symbolIcon"}function Ui(e,i,r,n,o,s,a,l,c,u,h,d){const p=e.context,f=p.gl,A=e.transform,m="map"===l,g="map"===c,_="viewport"!==l&&"point"!==r.layout.get("symbol-placement"),y=m&&!g&&!_,v=!r.layout.get("symbol-sort-key").isConstant();let x=!1;const b=e.depthModeForSublayer(0,Si.ReadOnly),w=r._unevaluatedLayout.hasValue("text-variable-anchor")||r._unevaluatedLayout.hasValue("text-variable-anchor-offset"),T=[];for(const l of n){const n=i.getTile(l),c=n.getBucket(r);if(!c)continue;const h=o?c.text:c.icon;if(!h||!h.segments.get().length||!h.hasVisibleVertices)continue;const d=h.programConfigurations.get(r.id),p=o||c.sdfIcons,b=o?c.textSizeData:c.iconSizeData,B=g||0!==A.pitch,E=e.useProgram(Ri(p,o,c),d),C=t.ah(b,A.zoom),S=e.style.map.terrain&&e.style.map.terrain.getTerrainData(l);let I,M,k,P,L=[0,0],z=null;if(o)M=n.glyphAtlasTexture,k=f.LINEAR,I=n.glyphAtlasTexture.size,c.iconsInText&&(L=n.imageAtlasTexture.size,z=n.imageAtlasTexture,P=B||e.options.rotating||e.options.zooming||"composite"===b.kind||"camera"===b.kind?f.LINEAR:f.NEAREST);else{const t=1!==r.layout.get("icon-size").constantOr(0)||c.iconsNeedLinear;M=n.imageAtlasTexture,k=p||e.options.rotating||e.options.zooming||t||B?f.LINEAR:f.NEAREST,I=n.imageAtlasTexture.size}const F=Et(n,1,e.transform.zoom),D=at(l.posMatrix,g,m,e.transform,F),R=lt(l.posMatrix,g,m,e.transform,F),U=w&&c.hasTextData(),O="none"!==r.layout.get("icon-text-fit")&&U&&c.hasIconData();if(_){const t=e.style.map.terrain?(t,i)=>e.style.map.terrain.getElevation(l,t,i):null,i="map"===r.layout.get("text-rotation-alignment");dt(c,l.posMatrix,e,o,D,R,g,u,i,t)}const N=e.translatePosMatrix(l.posMatrix,n,s,a),Q=_||o&&w||O?zi:D,V=e.translatePosMatrix(R,n,s,a,!0),j=p&&0!==r.paint.get(o?"text-halo-width":"icon-halo-width").constantOr(1);let H;H=p?c.iconsInText?ze(b.kind,C,y,g,e,N,Q,V,I,L):Le(b.kind,C,y,g,e,N,Q,V,o,I,!0):Pe(b.kind,C,y,g,e,N,Q,V,o,I);const G={program:E,buffers:h,uniformValues:H,atlasTexture:M,atlasTextureIcon:z,atlasInterpolation:k,atlasInterpolationIcon:P,isSDF:p,hasHalo:j};if(v&&c.canOverlap){x=!0;const e=h.segments.get();for(const i of e)T.push({segments:new t.S([i]),sortKey:i.sortKey,state:G,terrainData:S})}else T.push({segments:h.segments,sortKey:0,state:G,terrainData:S})}x&&T.sort(((t,e)=>t.sortKey-e.sortKey));for(const t of T){const i=t.state;if(p.activeTexture.set(f.TEXTURE0),i.atlasTexture.bind(i.atlasInterpolation,f.CLAMP_TO_EDGE),i.atlasTextureIcon&&(p.activeTexture.set(f.TEXTURE1),i.atlasTextureIcon&&i.atlasTextureIcon.bind(i.atlasInterpolationIcon,f.CLAMP_TO_EDGE)),i.isSDF){const n=i.uniformValues;i.hasHalo&&(n.u_is_halo=1,Oi(i.buffers,t.segments,r,e,i.program,b,h,d,n,t.terrainData)),n.u_is_halo=0}Oi(i.buffers,t.segments,r,e,i.program,b,h,d,i.uniformValues,t.terrainData)}}function Oi(t,e,i,r,n,o,s,a,l,c){const u=r.context;n.draw(u,u.gl.TRIANGLES,o,s,a,ki.disabled,l,c,i.id,t.layoutVertexBuffer,t.indexBuffer,e,i.paint,r.transform.zoom,t.programConfigurations.get(i.id),t.dynamicLayoutVertexBuffer,t.opacityVertexBuffer)}function Ni(t,e,i,r,n){if(!i||!r||!r.imageAtlas)return;const o=r.imageAtlas.patternPositions;let s=o[i.to.toString()],a=o[i.from.toString()];if(!s&&a&&(s=a),!a&&s&&(a=s),!s||!a){const t=n.getPaintProperty(e);s=o[t],a=o[t]}s&&a&&t.setConstantPatternPositions(s,a)}function Qi(t,e,i,r,n,o,s){const a=t.context.gl,l="fill-pattern",c=i.paint.get(l),u=c&&c.constantOr(1),h=i.getCrossfadeParameters();let d,p,f,A,m;s?(p=u&&!i.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",d=a.LINES):(p=u?"fillPattern":"fill",d=a.TRIANGLES);const g=c.constantOr(null);for(const c of r){const r=e.getTile(c);if(u&&!r.patternsLoaded())continue;const _=r.getBucket(i);if(!_)continue;const y=_.programConfigurations.get(i.id),v=t.useProgram(p,y),x=t.style.map.terrain&&t.style.map.terrain.getTerrainData(c);u&&(t.context.activeTexture.set(a.TEXTURE0),r.imageAtlasTexture.bind(a.LINEAR,a.CLAMP_TO_EDGE),y.updatePaintBuffers(h)),Ni(y,l,g,r,i);const b=x?c:null,w=t.translatePosMatrix(b?b.posMatrix:c.posMatrix,r,i.paint.get("fill-translate"),i.paint.get("fill-translate-anchor"));if(s){A=_.indexBuffer2,m=_.segments2;const e=[a.drawingBufferWidth,a.drawingBufferHeight];f="fillOutlinePattern"===p&&u?ge(w,t,h,r,e):me(w,e)}else A=_.indexBuffer,m=_.segments,f=u?Ae(w,t,h,r):fe(w);v.draw(t.context,d,n,t.stencilModeForClipping(c),o,ki.disabled,f,x,i.id,_.layoutVertexBuffer,A,m,i.paint,t.transform.zoom,y)}}function Vi(t,e,i,r,n,o,s){const a=t.context,l=a.gl,c="fill-extrusion-pattern",u=i.paint.get(c),h=u.constantOr(1),d=i.getCrossfadeParameters(),p=i.paint.get("fill-extrusion-opacity"),f=u.constantOr(null);for(const u of r){const r=e.getTile(u),A=r.getBucket(i);if(!A)continue;const m=t.style.map.terrain&&t.style.map.terrain.getTerrainData(u),g=A.programConfigurations.get(i.id),_=t.useProgram(h?"fillExtrusionPattern":"fillExtrusion",g);h&&(t.context.activeTexture.set(l.TEXTURE0),r.imageAtlasTexture.bind(l.LINEAR,l.CLAMP_TO_EDGE),g.updatePaintBuffers(d)),Ni(g,c,f,r,i);const y=t.translatePosMatrix(u.posMatrix,r,i.paint.get("fill-extrusion-translate"),i.paint.get("fill-extrusion-translate-anchor")),v=i.paint.get("fill-extrusion-vertical-gradient"),x=h?pe(y,t,v,p,u,d,r):de(y,t,v,p);_.draw(a,a.gl.TRIANGLES,n,o,s,ki.backCCW,x,m,i.id,A.layoutVertexBuffer,A.indexBuffer,A.segments,i.paint,t.transform.zoom,g,t.style.map.terrain&&A.centroidVertexBuffer)}}function ji(t,e,i,r,n,o,s){const a=t.context,l=a.gl,c=i.fbo;if(!c)return;const u=t.useProgram("hillshade"),h=t.style.map.terrain&&t.style.map.terrain.getTerrainData(e);a.activeTexture.set(l.TEXTURE0),l.bindTexture(l.TEXTURE_2D,c.colorAttachment.get()),u.draw(a,l.TRIANGLES,n,o,s,ki.disabled,((t,e,i,r)=>{const n=i.paint.get("hillshade-shadow-color"),o=i.paint.get("hillshade-highlight-color"),s=i.paint.get("hillshade-accent-color");let a=i.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===i.paint.get("hillshade-illumination-anchor")&&(a-=t.transform.angle);const l=!t.options.moving;return{u_matrix:r?r.posMatrix:t.transform.calculatePosMatrix(e.tileID.toUnwrapped(),l),u_image:0,u_latrange:we(0,e.tileID),u_light:[i.paint.get("hillshade-exaggeration"),a],u_shadow:n,u_highlight:o,u_accent:s}})(t,i,r,h?e:null),h,r.id,t.rasterBoundsBuffer,t.quadTriangleIndexBuffer,t.rasterBoundsSegments)}function Hi(e,i,r,n,o,s){const a=e.context,l=a.gl,c=i.dem;if(c&&c.data){const u=c.dim,h=c.stride,d=c.getPixels();if(a.activeTexture.set(l.TEXTURE1),a.pixelStoreUnpackPremultiplyAlpha.set(!1),i.demTexture=i.demTexture||e.getTileTexture(h),i.demTexture){const t=i.demTexture;t.update(d,{premultiply:!1}),t.bind(l.NEAREST,l.CLAMP_TO_EDGE)}else i.demTexture=new y(a,d,l.RGBA,{premultiply:!1}),i.demTexture.bind(l.NEAREST,l.CLAMP_TO_EDGE);a.activeTexture.set(l.TEXTURE0);let p=i.fbo;if(!p){const t=new y(a,{width:u,height:u,data:null},l.RGBA);t.bind(l.LINEAR,l.CLAMP_TO_EDGE),p=i.fbo=a.createFramebuffer(u,u,!0,!1),p.colorAttachment.set(t.texture)}a.bindFramebuffer.set(p.framebuffer),a.viewport.set([0,0,u,u]),e.useProgram("hillshadePrepare").draw(a,l.TRIANGLES,n,o,s,ki.disabled,((e,i)=>{const r=i.stride,n=t.Z();return t.aS(n,0,t.N,-t.N,0,0,1),t.$(n,n,[0,-t.N,0]),{u_matrix:n,u_image:1,u_dimension:[r,r],u_zoom:e.overscaledZ,u_unpack:i.getUnpackVector()}})(i.tileID,c),null,r.id,e.rasterBoundsBuffer,e.quadTriangleIndexBuffer,e.rasterBoundsSegments),i.needsHillshadePrepare=!1}}function Gi(e,i,r,n,o,s){const a=n.paint.get("raster-fade-duration");if(!s&&a>0){const n=t.h.now(),s=(n-e.timeAdded)/a,l=i?(n-i.timeAdded)/a:-1,c=r.getSource(),u=o.coveringZoomLevel({tileSize:c.tileSize,roundZoom:c.roundZoom}),h=!i||Math.abs(i.tileID.overscaledZ-u)>Math.abs(e.tileID.overscaledZ-u),d=h&&e.refreshedUponExpiration?1:t.ad(h?s:1-l,0,1);return e.refreshedUponExpiration&&s>=1&&(e.refreshedUponExpiration=!1),i?{opacity:1,mix:1-d}:{opacity:d,mix:0}}return{opacity:1,mix:0}}const $i=new t.aT(1,0,0,1),Zi=new t.aT(0,1,0,1),qi=new t.aT(0,0,1,1),Ki=new t.aT(1,0,1,1),Wi=new t.aT(0,1,1,1);function Xi(t,e,i,r){Yi(t,0,e+i/2,t.transform.width,i,r)}function Ji(t,e,i,r){Yi(t,e-i/2,0,i,t.transform.height,r)}function Yi(t,e,i,r,n,o){const s=t.context,a=s.gl;a.enable(a.SCISSOR_TEST),a.scissor(e*t.pixelRatio,i*t.pixelRatio,r*t.pixelRatio,n*t.pixelRatio),s.clear({color:o}),a.disable(a.SCISSOR_TEST)}function tr(e,i,r){const n=e.context,o=n.gl,s=r.posMatrix,a=e.useProgram("debug"),l=Si.disabled,c=Mi.disabled,u=e.colorModeForRenderPass(),h="$debug",d=e.style.map.terrain&&e.style.map.terrain.getTerrainData(r);n.activeTexture.set(o.TEXTURE0);const p=i.getTileByID(r.key).latestRawTileData,f=Math.floor((p&&p.byteLength||0)/1024),A=i.getTile(r).tileSize,m=512/Math.min(A,512)*(r.overscaledZ/e.transform.zoom)*.5;let g=r.canonical.toString();r.overscaledZ!==r.canonical.z&&(g+=` => ${r.overscaledZ}`),function(t,e){t.initDebugOverlayCanvas();const i=t.debugOverlayCanvas,r=t.context.gl,n=t.debugOverlayCanvas.getContext("2d");n.clearRect(0,0,i.width,i.height),n.shadowColor="white",n.shadowBlur=2,n.lineWidth=1.5,n.strokeStyle="white",n.textBaseline="top",n.font="bold 36px Open Sans, sans-serif",n.fillText(e,5,5),n.strokeText(e,5,5),t.debugOverlayTexture.update(i),t.debugOverlayTexture.bind(r.LINEAR,r.CLAMP_TO_EDGE)}(e,`${g} ${f}kB`),a.draw(n,o.TRIANGLES,l,c,Ei.alphaBlended,ki.disabled,ve(s,t.aT.transparent,m),null,h,e.debugBuffer,e.quadTriangleIndexBuffer,e.debugSegments),a.draw(n,o.LINE_STRIP,l,c,u,ki.disabled,ve(s,t.aT.red),d,h,e.debugBuffer,e.tileBorderIndexBuffer,e.debugSegments)}function er(t,e,i){const r=t.context,n=r.gl,o=t.colorModeForRenderPass(),s=new Si(n.LEQUAL,Si.ReadWrite,t.depthRangeFor3D),a=t.useProgram("terrain"),l=e.getTerrainMesh();r.bindFramebuffer.set(null),r.viewport.set([0,0,t.width,t.height]);for(const c of i){const i=t.renderToTexture.getTexture(c),u=e.getTerrainData(c.tileID);r.activeTexture.set(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,i.texture);const h={u_matrix:t.transform.calculatePosMatrix(c.tileID.toUnwrapped()),u_texture:0,u_ele_delta:e.getMeshFrameDelta(t.transform.zoom)};a.draw(r,n.TRIANGLES,s,Mi.disabled,o,ki.backCCW,h,u,"terrain",l.vertexBuffer,l.indexBuffer,l.segments)}}class ir{constructor(e,i){this.context=new Ci(e),this.transform=i,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:t.Z(),renderTime:0},this.setup(),this.numSublayers=W.maxUnderzooming+W.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Jt}resize(t,e,i){if(this.width=Math.floor(t*i),this.height=Math.floor(e*i),this.pixelRatio=i,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const t of this.style._order)this.style._layers[t].resize()}setup(){const e=this.context,i=new t.a_;i.emplaceBack(0,0),i.emplaceBack(t.N,0),i.emplaceBack(0,t.N),i.emplaceBack(t.N,t.N),this.tileExtentBuffer=e.createVertexBuffer(i,ne.members),this.tileExtentSegments=t.S.simpleSegment(0,0,4,2);const r=new t.a_;r.emplaceBack(0,0),r.emplaceBack(t.N,0),r.emplaceBack(0,t.N),r.emplaceBack(t.N,t.N),this.debugBuffer=e.createVertexBuffer(r,ne.members),this.debugSegments=t.S.simpleSegment(0,0,4,5);const n=new t.V;n.emplaceBack(0,0,0,0),n.emplaceBack(t.N,0,t.N,0),n.emplaceBack(0,t.N,0,t.N),n.emplaceBack(t.N,t.N,t.N,t.N),this.rasterBoundsBuffer=e.createVertexBuffer(n,U.members),this.rasterBoundsSegments=t.S.simpleSegment(0,0,4,2);const o=new t.a_;o.emplaceBack(0,0),o.emplaceBack(1,0),o.emplaceBack(0,1),o.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(o,ne.members),this.viewportSegments=t.S.simpleSegment(0,0,4,2);const s=new t.a$;s.emplaceBack(0),s.emplaceBack(1),s.emplaceBack(3),s.emplaceBack(2),s.emplaceBack(0),this.tileBorderIndexBuffer=e.createIndexBuffer(s);const a=new t.b0;a.emplaceBack(0,1,2),a.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(a);const l=this.context.gl;this.stencilClearMode=new Mi({func:l.ALWAYS,mask:0},0,255,l.ZERO,l.ZERO,l.ZERO)}clearStencil(){const e=this.context,i=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const r=t.Z();t.aS(r,0,this.width,this.height,0,0,1),t.a0(r,r,[i.drawingBufferWidth,i.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(e,i.TRIANGLES,Si.disabled,this.stencilClearMode,Ei.disabled,ki.disabled,xe(r),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(t,e){if(this.currentStencilSource===t.source||!t.isTileClipped()||!e||!e.length)return;this.currentStencilSource=t.source;const i=this.context,r=i.gl;this.nextStencilID+e.length>256&&this.clearStencil(),i.setColorMode(Ei.disabled),i.setDepthMode(Si.disabled);const n=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const t of e){const e=this._tileClippingMaskIDs[t.key]=this.nextStencilID++,o=this.style.map.terrain&&this.style.map.terrain.getTerrainData(t);n.draw(i,r.TRIANGLES,Si.disabled,new Mi({func:r.ALWAYS,mask:0},e,255,r.KEEP,r.KEEP,r.REPLACE),Ei.disabled,ki.disabled,xe(t.posMatrix),o,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,e=this.context.gl;return new Mi({func:e.NOTEQUAL,mask:255},t,255,e.KEEP,e.KEEP,e.REPLACE)}stencilModeForClipping(t){const e=this.context.gl;return new Mi({func:e.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,e.KEEP,e.KEEP,e.REPLACE)}stencilConfigForOverlap(t){const e=this.context.gl,i=t.sort(((t,e)=>e.overscaledZ-t.overscaledZ)),r=i[i.length-1].overscaledZ,n=i[0].overscaledZ-r+1;if(n>1){this.currentStencilSource=void 0,this.nextStencilID+n>256&&this.clearStencil();const t={};for(let i=0;i<n;i++)t[i+r]=new Mi({func:e.GEQUAL,mask:255},i+this.nextStencilID,255,e.KEEP,e.KEEP,e.REPLACE);return this.nextStencilID+=n,[t,i]}return[{[r]:Mi.disabled},i]}colorModeForRenderPass(){const e=this.context.gl;if(this._showOverdrawInspector){const i=1/8;return new Ei([e.CONSTANT_COLOR,e.ONE],new t.aT(i,i,i,0),[!0,!0,!0,!0])}return"opaque"===this.renderPass?Ei.unblended:Ei.alphaBlended}depthModeForSublayer(t,e,i){if(!this.opaquePassEnabledForLayer())return Si.disabled;const r=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new Si(i||this.context.gl.LEQUAL,e,[r,r])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(e,i){this.style=e,this.options=i,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(t.h.now()),this.imageManager.beginFrame();const r=this.style._order,n=this.style.sourceCaches,o={},s={},a={};for(const t in n){const e=n[t];e.used&&e.prepare(this.context),o[t]=e.getVisibleCoordinates(),s[t]=o[t].slice().reverse(),a[t]=e.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let t=0;t<r.length;t++)if(this.style._layers[r[t]].is3D()){this.opaquePassCutoff=t;break}if(this.renderToTexture){this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0;const e=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime);(this.terrainFacilitator.dirty||!t.b1(this.terrainFacilitator.matrix,this.transform.projMatrix)||e.length)&&(t.b2(this.terrainFacilitator.matrix,this.transform.projMatrix),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(e,i){const r=e.context,n=r.gl,o=Ei.unblended,s=new Si(n.LEQUAL,Si.ReadWrite,[0,1]),a=i.getTerrainMesh(),l=i.sourceCache.getRenderableTiles(),c=e.useProgram("terrainDepth");r.bindFramebuffer.set(i.getFramebuffer("depth").framebuffer),r.viewport.set([0,0,e.width/devicePixelRatio,e.height/devicePixelRatio]),r.clear({color:t.aT.transparent,depth:1});for(const t of l){const l=i.getTerrainData(t.tileID),u={u_matrix:e.transform.calculatePosMatrix(t.tileID.toUnwrapped()),u_ele_delta:i.getMeshFrameDelta(e.transform.zoom)};c.draw(r,n.TRIANGLES,s,Mi.disabled,o,ki.backCCW,u,l,"terrain",a.vertexBuffer,a.indexBuffer,a.segments)}r.bindFramebuffer.set(null),r.viewport.set([0,0,e.width,e.height])}(this,this.style.map.terrain),function(e,i){const r=e.context,n=r.gl,o=Ei.unblended,s=new Si(n.LEQUAL,Si.ReadWrite,[0,1]),a=i.getTerrainMesh(),l=i.getCoordsTexture(),c=i.sourceCache.getRenderableTiles(),u=e.useProgram("terrainCoords");r.bindFramebuffer.set(i.getFramebuffer("coords").framebuffer),r.viewport.set([0,0,e.width/devicePixelRatio,e.height/devicePixelRatio]),r.clear({color:t.aT.transparent,depth:1}),i.coordsIndex=[];for(const t of c){const c=i.getTerrainData(t.tileID);r.activeTexture.set(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,l.texture);const h={u_matrix:e.transform.calculatePosMatrix(t.tileID.toUnwrapped()),u_terrain_coords_id:(255-i.coordsIndex.length)/255,u_texture:0,u_ele_delta:i.getMeshFrameDelta(e.transform.zoom)};u.draw(r,n.TRIANGLES,s,Mi.disabled,o,ki.backCCW,h,c,"terrain",a.vertexBuffer,a.indexBuffer,a.segments),i.coordsIndex.push(t.tileID.key)}r.bindFramebuffer.set(null),r.viewport.set([0,0,e.width,e.height])}(this,this.style.map.terrain))}this.renderPass="offscreen";for(const t of r){const e=this.style._layers[t];if(!e.hasOffscreenPass()||e.isHidden(this.transform.zoom))continue;const i=s[e.source];("custom"===e.type||i.length)&&this.renderLayer(this,n[e.source],e,i)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:i.showOverdrawInspector?t.aT.black:t.aT.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=i.showOverdrawInspector,this.depthRangeFor3D=[0,1-(e._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=r.length-1;this.currentLayer>=0;this.currentLayer--){const t=this.style._layers[r[this.currentLayer]],e=n[t.source],i=o[t.source];this._renderTileClippingMasks(t,i),this.renderLayer(this,e,t,i)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<r.length;this.currentLayer++){const t=this.style._layers[r[this.currentLayer]],e=n[t.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(t))continue;const i=("symbol"===t.type?a:s)[t.source];this._renderTileClippingMasks(t,o[t.source]),this.renderLayer(this,e,t,i)}if(this.options.showTileBoundaries){const t=function(t,e){let i=null;const r=Object.values(t._layers).flatMap((i=>i.source&&!i.isHidden(e)?[t.sourceCaches[i.source]]:[])),n=r.filter((t=>"vector"===t.getSource().type)),o=r.filter((t=>"vector"!==t.getSource().type)),s=t=>{(!i||i.getSource().maxzoom<t.getSource().maxzoom)&&(i=t)};return n.forEach((t=>s(t))),i||o.forEach((t=>s(t))),i}(this.style,this.transform.zoom);t&&function(t,e,i){for(let r=0;r<i.length;r++)tr(t,e,i[r])}(this,t,t.getVisibleCoordinates())}this.options.showPadding&&function(t){const e=t.transform.padding;Xi(t,t.transform.height-(e.top||0),3,$i),Xi(t,e.bottom||0,3,Zi),Ji(t,e.left||0,3,qi),Ji(t,t.transform.width-(e.right||0),3,Ki);const i=t.transform.centerPoint;!function(t,e,i,r){Yi(t,e-1,i-10,2,20,r),Yi(t,e-10,i-1,20,2,r)}(t,i.x,t.transform.height-i.y,Wi)}(this),this.context.setDefault()}renderLayer(e,i,r,n){if(!r.isHidden(this.transform.zoom)&&("background"===r.type||"custom"===r.type||(n||[]).length))switch(this.id=r.id,r.type){case"symbol":!function(e,i,r,n,o){if("translucent"!==e.renderPass)return;const s=Mi.disabled,a=e.colorModeForRenderPass();(r._unevaluatedLayout.hasValue("text-variable-anchor")||r._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(e,i,r,n,o,s,a){const l=i.transform,c="map"===o,u="map"===s;for(const o of e){const e=n.getTile(o),s=e.getBucket(r);if(!s||!s.text||!s.text.segments.get().length)continue;const h=t.ah(s.textSizeData,l.zoom),d=Et(e,1,i.transform.zoom),p=at(o.posMatrix,u,c,i.transform,d),f="none"!==r.layout.get("icon-text-fit")&&s.hasIconData();if(h){const t=Math.pow(2,l.zoom-e.tileID.overscaledZ);Di(s,c,u,a,l,p,o.posMatrix,t,h,f,i.style.map.terrain?(t,e)=>i.style.map.terrain.getElevation(o,t,e):null)}}}(n,e,r,i,r.layout.get("text-rotation-alignment"),r.layout.get("text-pitch-alignment"),o),0!==r.paint.get("icon-opacity").constantOr(1)&&Ui(e,i,r,n,!1,r.paint.get("icon-translate"),r.paint.get("icon-translate-anchor"),r.layout.get("icon-rotation-alignment"),r.layout.get("icon-pitch-alignment"),r.layout.get("icon-keep-upright"),s,a),0!==r.paint.get("text-opacity").constantOr(1)&&Ui(e,i,r,n,!0,r.paint.get("text-translate"),r.paint.get("text-translate-anchor"),r.layout.get("text-rotation-alignment"),r.layout.get("text-pitch-alignment"),r.layout.get("text-keep-upright"),s,a),i.map.showCollisionBoxes&&(Li(e,i,r,n,r.paint.get("text-translate"),r.paint.get("text-translate-anchor"),!0),Li(e,i,r,n,r.paint.get("icon-translate"),r.paint.get("icon-translate-anchor"),!1))}(e,i,r,n,this.style.placement.variableOffsets);break;case"circle":!function(e,i,r,n){if("translucent"!==e.renderPass)return;const o=r.paint.get("circle-opacity"),s=r.paint.get("circle-stroke-width"),a=r.paint.get("circle-stroke-opacity"),l=!r.layout.get("circle-sort-key").isConstant();if(0===o.constantOr(1)&&(0===s.constantOr(1)||0===a.constantOr(1)))return;const c=e.context,u=c.gl,h=e.depthModeForSublayer(0,Si.ReadOnly),d=Mi.disabled,p=e.colorModeForRenderPass(),f=[];for(let o=0;o<n.length;o++){const s=n[o],a=i.getTile(s),c=a.getBucket(r);if(!c)continue;const u=c.programConfigurations.get(r.id),h=e.useProgram("circle",u),d=c.layoutVertexBuffer,p=c.indexBuffer,A=e.style.map.terrain&&e.style.map.terrain.getTerrainData(s),m={programConfiguration:u,program:h,layoutVertexBuffer:d,indexBuffer:p,uniformValues:_e(e,s,a,r),terrainData:A};if(l){const e=c.segments.get();for(const i of e)f.push({segments:new t.S([i]),sortKey:i.sortKey,state:m})}else f.push({segments:c.segments,sortKey:0,state:m})}l&&f.sort(((t,e)=>t.sortKey-e.sortKey));for(const t of f){const{programConfiguration:i,program:n,layoutVertexBuffer:o,indexBuffer:s,uniformValues:a,terrainData:l}=t.state;n.draw(c,u.TRIANGLES,h,d,p,ki.disabled,a,l,r.id,o,s,t.segments,r.paint,e.transform.zoom,i)}}(e,i,r,n);break;case"heatmap":!function(e,i,r,n){if(0!==r.paint.get("heatmap-opacity"))if("offscreen"===e.renderPass){const o=e.context,s=o.gl,a=Mi.disabled,l=new Ei([s.ONE,s.ONE],t.aT.transparent,[!0,!0,!0,!0]);!function(t,e,i){const r=t.gl;t.activeTexture.set(r.TEXTURE1),t.viewport.set([0,0,e.width/4,e.height/4]);let n=i.heatmapFbo;if(n)r.bindTexture(r.TEXTURE_2D,n.colorAttachment.get()),t.bindFramebuffer.set(n.framebuffer);else{const o=r.createTexture();r.bindTexture(r.TEXTURE_2D,o),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),n=i.heatmapFbo=t.createFramebuffer(e.width/4,e.height/4,!1,!1),function(t,e,i,r){var n,o;const s=t.gl,a=null!==(n=t.HALF_FLOAT)&&void 0!==n?n:s.UNSIGNED_BYTE,l=null!==(o=t.RGBA16F)&&void 0!==o?o:s.RGBA;s.texImage2D(s.TEXTURE_2D,0,l,e.width/4,e.height/4,0,s.RGBA,a,null),r.colorAttachment.set(i)}(t,e,o,n)}}(o,e,r),o.clear({color:t.aT.transparent});for(let t=0;t<n.length;t++){const c=n[t];if(i.hasRenderableParent(c))continue;const u=i.getTile(c),h=u.getBucket(r);if(!h)continue;const d=h.programConfigurations.get(r.id),p=e.useProgram("heatmap",d),{zoom:f}=e.transform;p.draw(o,s.TRIANGLES,Si.disabled,a,l,ki.disabled,be(c.posMatrix,u,f,r.paint.get("heatmap-intensity")),null,r.id,h.layoutVertexBuffer,h.indexBuffer,h.segments,r.paint,e.transform.zoom,d)}o.viewport.set([0,0,e.width,e.height])}else"translucent"===e.renderPass&&(e.context.setColorMode(e.colorModeForRenderPass()),function(e,i){const r=e.context,n=r.gl,o=i.heatmapFbo;if(!o)return;r.activeTexture.set(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,o.colorAttachment.get()),r.activeTexture.set(n.TEXTURE1);let s=i.colorRampTexture;s||(s=i.colorRampTexture=new y(r,i.colorRamp,n.RGBA)),s.bind(n.LINEAR,n.CLAMP_TO_EDGE),e.useProgram("heatmapTexture").draw(r,n.TRIANGLES,Si.disabled,Mi.disabled,e.colorModeForRenderPass(),ki.disabled,((e,i,r,n)=>{const o=t.Z();t.aS(o,0,e.width,e.height,0,0,1);const s=e.context.gl;return{u_matrix:o,u_world:[s.drawingBufferWidth,s.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:i.paint.get("heatmap-opacity")}})(e,i),null,i.id,e.viewportBuffer,e.quadTriangleIndexBuffer,e.viewportSegments,i.paint,e.transform.zoom)}(e,r))}(e,i,r,n);break;case"line":!function(e,i,r,n){if("translucent"!==e.renderPass)return;const o=r.paint.get("line-opacity"),s=r.paint.get("line-width");if(0===o.constantOr(1)||0===s.constantOr(1))return;const a=e.depthModeForSublayer(0,Si.ReadOnly),l=e.colorModeForRenderPass(),c=r.paint.get("line-dasharray"),u=r.paint.get("line-pattern"),h=u.constantOr(1),d=r.paint.get("line-gradient"),p=r.getCrossfadeParameters(),f=h?"linePattern":c?"lineSDF":d?"lineGradient":"line",A=e.context,m=A.gl;let g=!0;for(const o of n){const n=i.getTile(o);if(h&&!n.patternsLoaded())continue;const s=n.getBucket(r);if(!s)continue;const _=s.programConfigurations.get(r.id),v=e.context.program.get(),x=e.useProgram(f,_),b=g||x.program!==v,w=e.style.map.terrain&&e.style.map.terrain.getTerrainData(o),T=u.constantOr(null);if(T&&n.imageAtlas){const t=n.imageAtlas,e=t.patternPositions[T.to.toString()],i=t.patternPositions[T.from.toString()];e&&i&&_.setConstantPatternPositions(e,i)}const B=w?o:null,E=h?Ee(e,n,r,p,B):c?Ce(e,n,r,c,p,B):d?Be(e,n,r,s.lineClipsArray.length,B):Te(e,n,r,B);if(h)A.activeTexture.set(m.TEXTURE0),n.imageAtlasTexture.bind(m.LINEAR,m.CLAMP_TO_EDGE),_.updatePaintBuffers(p);else if(c&&(b||e.lineAtlas.dirty))A.activeTexture.set(m.TEXTURE0),e.lineAtlas.bind(A);else if(d){const n=s.gradients[r.id];let a=n.texture;if(r.gradientVersion!==n.version){let l=256;if(r.stepInterpolant){const r=i.getSource().maxzoom,n=o.canonical.z===r?Math.ceil(1<<e.transform.maxZoom-o.canonical.z):1;l=t.ad(t.aY(s.maxLineLength/t.N*1024*n),256,A.maxTextureSize)}n.gradient=t.aZ({expression:r.gradientExpression(),evaluationKey:"lineProgress",resolution:l,image:n.gradient||void 0,clips:s.lineClipsArray}),n.texture?n.texture.update(n.gradient):n.texture=new y(A,n.gradient,m.RGBA),n.version=r.gradientVersion,a=n.texture}A.activeTexture.set(m.TEXTURE0),a.bind(r.stepInterpolant?m.NEAREST:m.LINEAR,m.CLAMP_TO_EDGE)}x.draw(A,m.TRIANGLES,a,e.stencilModeForClipping(o),l,ki.disabled,E,w,r.id,s.layoutVertexBuffer,s.indexBuffer,s.segments,r.paint,e.transform.zoom,_,s.layoutVertexBuffer2),g=!1}}(e,i,r,n);break;case"fill":!function(e,i,r,n){const o=r.paint.get("fill-color"),s=r.paint.get("fill-opacity");if(0===s.constantOr(1))return;const a=e.colorModeForRenderPass(),l=r.paint.get("fill-pattern"),c=e.opaquePassEnabledForLayer()&&!l.constantOr(1)&&1===o.constantOr(t.aT.transparent).a&&1===s.constantOr(0)?"opaque":"translucent";if(e.renderPass===c){const t=e.depthModeForSublayer(1,"opaque"===e.renderPass?Si.ReadWrite:Si.ReadOnly);Qi(e,i,r,n,t,a,!1)}if("translucent"===e.renderPass&&r.paint.get("fill-antialias")){const t=e.depthModeForSublayer(r.getPaintProperty("fill-outline-color")?2:0,Si.ReadOnly);Qi(e,i,r,n,t,a,!0)}}(e,i,r,n);break;case"fill-extrusion":!function(t,e,i,r){const n=i.paint.get("fill-extrusion-opacity");if(0!==n&&"translucent"===t.renderPass){const o=new Si(t.context.gl.LEQUAL,Si.ReadWrite,t.depthRangeFor3D);if(1!==n||i.paint.get("fill-extrusion-pattern").constantOr(1))Vi(t,e,i,r,o,Mi.disabled,Ei.disabled),Vi(t,e,i,r,o,t.stencilModeFor3D(),t.colorModeForRenderPass());else{const n=t.colorModeForRenderPass();Vi(t,e,i,r,o,Mi.disabled,n)}}}(e,i,r,n);break;case"hillshade":!function(t,e,i,r){if("offscreen"!==t.renderPass&&"translucent"!==t.renderPass)return;const n=t.context,o=t.depthModeForSublayer(0,Si.ReadOnly),s=t.colorModeForRenderPass(),[a,l]="translucent"===t.renderPass?t.stencilConfigForOverlap(r):[{},r];for(const r of l){const n=e.getTile(r);void 0!==n.needsHillshadePrepare&&n.needsHillshadePrepare&&"offscreen"===t.renderPass?Hi(t,n,i,o,Mi.disabled,s):"translucent"===t.renderPass&&ji(t,r,n,i,o,a[r.overscaledZ],s)}n.viewport.set([0,0,t.width,t.height])}(e,i,r,n);break;case"raster":!function(t,e,i,r){if("translucent"!==t.renderPass)return;if(0===i.paint.get("raster-opacity"))return;if(!r.length)return;const n=t.context,o=n.gl,s=e.getSource(),a=t.useProgram("raster"),l=t.colorModeForRenderPass(),[c,u]=s instanceof O?[{},r]:t.stencilConfigForOverlap(r),h=u[u.length-1].overscaledZ,d=!t.options.moving;for(const r of u){const u=t.depthModeForSublayer(r.overscaledZ-h,1===i.paint.get("raster-opacity")?Si.ReadWrite:Si.ReadOnly,o.LESS),p=e.getTile(r);p.registerFadeDuration(i.paint.get("raster-fade-duration"));const f=e.findLoadedParent(r,0),A=Gi(p,f,e,i,t.transform,t.style.map.terrain);let m,g;const _="nearest"===i.paint.get("raster-resampling")?o.NEAREST:o.LINEAR;n.activeTexture.set(o.TEXTURE0),p.texture.bind(_,o.CLAMP_TO_EDGE,o.LINEAR_MIPMAP_NEAREST),n.activeTexture.set(o.TEXTURE1),f?(f.texture.bind(_,o.CLAMP_TO_EDGE,o.LINEAR_MIPMAP_NEAREST),m=Math.pow(2,f.tileID.overscaledZ-p.tileID.overscaledZ),g=[p.tileID.canonical.x*m%1,p.tileID.canonical.y*m%1]):p.texture.bind(_,o.CLAMP_TO_EDGE,o.LINEAR_MIPMAP_NEAREST);const y=t.style.map.terrain&&t.style.map.terrain.getTerrainData(r),v=y?r:null,x=v?v.posMatrix:t.transform.calculatePosMatrix(r.toUnwrapped(),d),b=Me(x,g||[0,0],m||1,A,i);s instanceof O?a.draw(n,o.TRIANGLES,u,Mi.disabled,l,ki.disabled,b,y,i.id,s.boundsBuffer,t.quadTriangleIndexBuffer,s.boundsSegments):a.draw(n,o.TRIANGLES,u,c[r.overscaledZ],l,ki.disabled,b,y,i.id,t.rasterBoundsBuffer,t.quadTriangleIndexBuffer,t.rasterBoundsSegments)}}(e,i,r,n);break;case"background":!function(t,e,i,r){const n=i.paint.get("background-color"),o=i.paint.get("background-opacity");if(0===o)return;const s=t.context,a=s.gl,l=t.transform,c=l.tileSize,u=i.paint.get("background-pattern");if(t.isPatternMissing(u))return;const h=!u&&1===n.a&&1===o&&t.opaquePassEnabledForLayer()?"opaque":"translucent";if(t.renderPass!==h)return;const d=Mi.disabled,p=t.depthModeForSublayer(0,"opaque"===h?Si.ReadWrite:Si.ReadOnly),f=t.colorModeForRenderPass(),A=t.useProgram(u?"backgroundPattern":"background"),m=r||l.coveringTiles({tileSize:c,terrain:t.style.map.terrain});u&&(s.activeTexture.set(a.TEXTURE0),t.imageManager.bind(t.context));const g=i.getCrossfadeParameters();for(const e of m){const l=r?e.posMatrix:t.transform.calculatePosMatrix(e.toUnwrapped()),h=u?De(l,o,t,u,{tileID:e,tileSize:c},g):Fe(l,o,n),m=t.style.map.terrain&&t.style.map.terrain.getTerrainData(e);A.draw(s,a.TRIANGLES,p,d,f,ki.disabled,h,m,i.id,t.tileExtentBuffer,t.quadTriangleIndexBuffer,t.tileExtentSegments)}}(e,0,r,n);break;case"custom":!function(t,e,i){const r=t.context,n=i.implementation;if("offscreen"===t.renderPass){const e=n.prerender;e&&(t.setCustomLayerDefaults(),r.setColorMode(t.colorModeForRenderPass()),e.call(n,r.gl,t.transform.customLayerMatrix()),r.setDirty(),t.setBaseState())}else if("translucent"===t.renderPass){t.setCustomLayerDefaults(),r.setColorMode(t.colorModeForRenderPass()),r.setStencilMode(Mi.disabled);const e="3d"===n.renderingMode?new Si(t.context.gl.LEQUAL,Si.ReadWrite,t.depthRangeFor3D):t.depthModeForSublayer(0,Si.ReadOnly);r.setDepthMode(e),n.render(r.gl,t.transform.customLayerMatrix()),r.setDirty(),t.setBaseState(),r.bindFramebuffer.set(null)}}(e,0,r)}}translatePosMatrix(e,i,r,n,o){if(!r[0]&&!r[1])return e;const s=o?"map"===n?this.transform.angle:0:"viewport"===n?-this.transform.angle:0;if(s){const t=Math.sin(s),e=Math.cos(s);r=[r[0]*e-r[1]*t,r[0]*t+r[1]*e]}const a=[o?r[0]:Et(i,r[0],this.transform.zoom),o?r[1]:Et(i,r[1],this.transform.zoom),0],l=new Float32Array(16);return t.$(l,e,a),l}saveTileTexture(t){const e=this._tileTextures[t.size[0]];e?e.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const e=this._tileTextures[t];return e&&e.length>0?e.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;const e=this.imageManager.getPattern(t.from.toString()),i=this.imageManager.getPattern(t.to.toString());return!e||!i}useProgram(t,e){this.cache=this.cache||{};const i=t+(e?e.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[i]||(this.cache[i]=new ue(this.context,se[t],e,Re[t],this._showOverdrawInspector,this.style.map.terrain)),this.cache[i]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new y(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:t,drawingBufferHeight:e}=this.context.gl;return this.width!==t||this.height!==e}}class rr{constructor(t,e){this.points=t,this.planes=e}static fromInvProjectionMatrix(e,i,r){const n=Math.pow(2,r),o=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((r=>{const o=1/(r=t.ag([],r,e))[3]/i*n;return t.b3(r,r,[o,o,1/r[3],o])})),s=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map((t=>{const e=function(t,e){var i=e[0],r=e[1],n=e[2],o=i*i+r*r+n*n;return o>0&&(o=1/Math.sqrt(o)),t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o,t}([],function(t,e,i){var r=e[0],n=e[1],o=e[2],s=i[0],a=i[1],l=i[2];return t[0]=n*l-o*a,t[1]=o*s-r*l,t[2]=r*a-n*s,t}([],A([],o[t[0]],o[t[1]]),A([],o[t[2]],o[t[1]]))),i=-((r=e)[0]*(n=o[t[1]])[0]+r[1]*n[1]+r[2]*n[2]);var r,n;return e.concat(i)}));return new rr(o,s)}}class nr{constructor(t,e){this.min=t,this.max=e,this.center=function(t,e,i){return t[0]=.5*e[0],t[1]=.5*e[1],t[2]=.5*e[2],t}([],function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t}([],this.min,this.max))}quadrant(t){const e=[t%2==0,t<2],i=p(this.min),r=p(this.max);for(let t=0;t<e.length;t++)i[t]=e[t]?this.min[t]:this.center[t],r[t]=e[t]?this.center[t]:this.max[t];return r[2]=this.max[2],new nr(i,r)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}intersects(e){const i=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let r=!0;for(let n=0;n<e.planes.length;n++){const o=e.planes[n];let s=0;for(let e=0;e<i.length;e++)t.b4(o,i[e])>=0&&s++;if(0===s)return 0;s!==i.length&&(r=!1)}if(r)return 2;for(let t=0;t<3;t++){let i=Number.MAX_VALUE,r=-Number.MAX_VALUE;for(let n=0;n<e.points.length;n++){const o=e.points[n][t]-this.min[t];i=Math.min(i,o),r=Math.max(r,o)}if(r<0||i>this.max[t]-this.min[t])return 0}return 1}}class or{constructor(t=0,e=0,i=0,r=0){if(isNaN(t)||t<0||isNaN(e)||e<0||isNaN(i)||i<0||isNaN(r)||r<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=e,this.left=i,this.right=r}interpolate(e,i,r){return null!=i.top&&null!=e.top&&(this.top=t.B.number(e.top,i.top,r)),null!=i.bottom&&null!=e.bottom&&(this.bottom=t.B.number(e.bottom,i.bottom,r)),null!=i.left&&null!=e.left&&(this.left=t.B.number(e.left,i.left,r)),null!=i.right&&null!=e.right&&(this.right=t.B.number(e.right,i.right,r)),this}getCenter(e,i){const r=t.ad((this.left+e-this.right)/2,0,e),n=t.ad((this.top+i-this.bottom)/2,0,i);return new t.P(r,n)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new or(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class sr{constructor(e,i,r,n,o){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=void 0===o||!!o,this._minZoom=e||0,this._maxZoom=i||22,this._minPitch=null==r?0:r,this._maxPitch=null==n?60:n,this.setMaxBounds(),this.width=0,this.height=0,this._center=new t.L(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new or,this._posMatrixCache={},this._alignedPosMatrixCache={},this._minEleveationForCurrentTile=0}clone(){const t=new sr(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return t.apply(this),t}apply(t){this.tileSize=t.tileSize,this.latRange=t.latRange,this.width=t.width,this.height=t.height,this._center=t._center,this._elevation=t._elevation,this._minEleveationForCurrentTile=t._minEleveationForCurrentTile,this.zoom=t.zoom,this.angle=t.angle,this._fov=t._fov,this._pitch=t._pitch,this._unmodified=t._unmodified,this._edgeInsets=t._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(t){void 0===t?t=!0:null===t&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new t.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(e){const i=-t.b5(e,-180,180)*Math.PI/180;this.angle!==i&&(this._unmodified=!1,this.angle=i,this._calcMatrices(),this.rotationMatrix=function(){var e=new t.A(4);return t.A!=Float32Array&&(e[1]=0,e[2]=0),e[0]=1,e[3]=1,e}(),function(t,e,i){var r=e[0],n=e[1],o=e[2],s=e[3],a=Math.sin(i),l=Math.cos(i);t[0]=r*l+o*a,t[1]=n*l+s*a,t[2]=r*-a+o*l,t[3]=n*-a+s*l}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(e){const i=t.ad(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==i&&(this._unmodified=!1,this._pitch=i,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=t/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(t){const e=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==e&&(this._unmodified=!1,this._zoom=e,this.tileZoom=Math.max(0,Math.floor(e)),this.scale=this.zoomScale(e),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(t){t!==this._elevation&&(this._elevation=t,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,e,i){this._unmodified=!1,this._edgeInsets.interpolate(t,e,i),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const e=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,e)}getVisibleUnwrappedCoordinates(e){const i=[new t.b6(0,e)];if(this._renderWorldCopies){const r=this.pointCoordinate(new t.P(0,0)),n=this.pointCoordinate(new t.P(this.width,0)),o=this.pointCoordinate(new t.P(this.width,this.height)),s=this.pointCoordinate(new t.P(0,this.height)),a=Math.floor(Math.min(r.x,n.x,o.x,s.x)),l=Math.floor(Math.max(r.x,n.x,o.x,s.x)),c=1;for(let r=a-c;r<=l+c;r++)0!==r&&i.push(new t.b6(r,e))}return i}coveringTiles(e){var i,r;let n=this.coveringZoomLevel(e);const o=n;if(void 0!==e.minzoom&&n<e.minzoom)return[];void 0!==e.maxzoom&&n>e.maxzoom&&(n=e.maxzoom);const s=this.pointCoordinate(this.getCameraPoint()),a=t.U.fromLngLat(this.center),l=Math.pow(2,n),c=[l*s.x,l*s.y,0],u=[l*a.x,l*a.y,0],h=rr.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,n);let d=e.minzoom||0;!e.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(d=n);const p=e.terrain?2/Math.min(this.tileSize,e.tileSize)*this.tileSize:3,f=t=>({aabb:new nr([t*l,0,0],[(t+1)*l,l,0]),zoom:0,x:0,y:0,wrap:t,fullyVisible:!1}),A=[],g=[],_=n,y=e.reparseOverscaled?o:n;if(this._renderWorldCopies)for(let t=1;t<=3;t++)A.push(f(-t)),A.push(f(t));for(A.push(f(0));A.length>0;){const n=A.pop(),o=n.x,s=n.y;let a=n.fullyVisible;if(!a){const t=n.aabb.intersects(h);if(0===t)continue;a=2===t}const l=e.terrain?c:u,f=n.aabb.distanceX(l),v=n.aabb.distanceY(l),x=Math.max(Math.abs(f),Math.abs(v));if(n.zoom===_||x>p+(1<<_-n.zoom)-2&&n.zoom>=d){const e=_-n.zoom,i=c[0]-.5-(o<<e),r=c[1]-.5-(s<<e);g.push({tileID:new t.O(n.zoom===_?y:n.zoom,n.wrap,n.zoom,o,s),distanceSq:m([u[0]-.5-o,u[1]-.5-s]),tileDistanceToCamera:Math.sqrt(i*i+r*r)})}else for(let l=0;l<4;l++){const c=(o<<1)+l%2,u=(s<<1)+(l>>1),h=n.zoom+1;let d=n.aabb.quadrant(l);if(e.terrain){const o=new t.O(h,n.wrap,h,c,u),s=e.terrain.getMinMaxElevation(o),a=null!==(i=s.minElevation)&&void 0!==i?i:this.elevation,l=null!==(r=s.maxElevation)&&void 0!==r?r:this.elevation;d=new nr([d.min[0],d.min[1],a],[d.max[0],d.max[1],l])}A.push({aabb:d,zoom:h,x:c,y:u,wrap:n.wrap,fullyVisible:a})}}return g.sort(((t,e)=>t.distanceSq-e.distanceSq)).map((t=>t.tileID))}resize(t,e){this.width=t,this.height=e,this.pixelsToGLUnits=[2/t,-2/e],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(e){const i=t.ad(e.lat,-this.maxValidLatitude,this.maxValidLatitude);return new t.P(t.G(e.lng)*this.worldSize,t.H(i)*this.worldSize)}unproject(e){return new t.U(e.x/this.worldSize,e.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(e){const i=this.pointLocation(this.centerPoint,e),r=e.getElevationForLngLatZoom(i,this.tileZoom);if(!(this.elevation-r))return;const n=this.getCameraPosition(),o=t.U.fromLngLat(n.lngLat,n.altitude),s=t.U.fromLngLat(i,r),a=o.x-s.x,l=o.y-s.y,c=o.z-s.z,u=Math.sqrt(a*a+l*l+c*c),h=this.scaleZoom(this.cameraToCenterDistance/u/this.tileSize);this._elevation=r,this._center=i,this.zoom=h}setLocationAtPoint(e,i){const r=this.pointCoordinate(i),n=this.pointCoordinate(this.centerPoint),o=this.locationCoordinate(e),s=new t.U(o.x-(r.x-n.x),o.y-(r.y-n.y));this.center=this.coordinateLocation(s),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(t,e){return e?this.coordinatePoint(this.locationCoordinate(t),e.getElevationForLngLatZoom(t,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(t))}pointLocation(t,e){return this.coordinateLocation(this.pointCoordinate(t,e))}locationCoordinate(e){return t.U.fromLngLat(e)}coordinateLocation(t){return t&&t.toLngLat()}pointCoordinate(e,i){if(i){const t=i.pointCoordinate(e);if(null!=t)return t}const r=[e.x,e.y,0,1],n=[e.x,e.y,1,1];t.ag(r,r,this.pixelMatrixInverse),t.ag(n,n,this.pixelMatrixInverse);const o=r[3],s=n[3],a=r[1]/o,l=n[1]/s,c=r[2]/o,u=n[2]/s,h=c===u?0:(0-c)/(u-c);return new t.U(t.B.number(r[0]/o,n[0]/s,h)/this.worldSize,t.B.number(a,l,h)/this.worldSize)}coordinatePoint(e,i=0,r=this.pixelMatrix){const n=[e.x*this.worldSize,e.y*this.worldSize,i,1];return t.ag(n,n,r),new t.P(n[0]/n[3],n[1]/n[3])}getBounds(){const e=Math.max(0,this.height/2-this.getHorizon());return(new P).extend(this.pointLocation(new t.P(0,e))).extend(this.pointLocation(new t.P(this.width,e))).extend(this.pointLocation(new t.P(this.width,this.height))).extend(this.pointLocation(new t.P(0,this.height)))}getMaxBounds(){return this.latRange&&2===this.latRange.length&&this.lngRange&&2===this.lngRange.length?new P([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(t){t?(this.lngRange=[t.getWest(),t.getEast()],this.latRange=[t.getSouth(),t.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(e,i=!1){const r=e.key,n=i?this._alignedPosMatrixCache:this._posMatrixCache;if(n[r])return n[r];const o=e.canonical,s=this.worldSize/this.zoomScale(o.z),a=o.x+Math.pow(2,o.z)*e.wrap,l=t.ao(new Float64Array(16));return t.$(l,l,[a*s,o.y*s,0]),t.a0(l,l,[s/t.N,s/t.N,1]),t.a1(l,i?this.alignedProjMatrix:this.projMatrix,l),n[r]=new Float32Array(l),n[r]}customLayerMatrix(){return this.mercatorMatrix.slice()}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let e,i,r,n,o=-90,s=90,a=-180,l=180;const c=this.size,u=this._unmodified;if(this.latRange){const i=this.latRange;o=t.H(i[1])*this.worldSize,s=t.H(i[0])*this.worldSize,e=s-o<c.y?c.y/(s-o):0}if(this.lngRange){const e=this.lngRange;a=t.b5(t.G(e[0])*this.worldSize,0,this.worldSize),l=t.b5(t.G(e[1])*this.worldSize,0,this.worldSize),l<a&&(l+=this.worldSize),i=l-a<c.x?c.x/(l-a):0}const h=this.point,d=Math.max(i||0,e||0);if(d)return this.center=this.unproject(new t.P(i?(l+a)/2:h.x,e?(s+o)/2:h.y)),this.zoom+=this.scaleZoom(d),this._unmodified=u,void(this._constraining=!1);if(this.latRange){const t=h.y,e=c.y/2;t-e<o&&(n=o+e),t+e>s&&(n=s-e)}if(this.lngRange){const e=(a+l)/2,i=t.b5(h.x,e-this.worldSize/2,e+this.worldSize/2),n=c.x/2;i-n<a&&(r=a+n),i+n>l&&(r=l-n)}void 0===r&&void 0===n||(this.center=this.unproject(new t.P(void 0!==r?r:h.x,void 0!==n?n:h.y)).wrap()),this._unmodified=u,this._constraining=!1}_calcMatrices(){if(!this.height)return;const e=this.centerOffset,i=this.point.x,r=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=t.b7(1,this.center.lat)*this.worldSize;let n=t.ao(new Float64Array(16));t.a0(n,n,[this.width/2,-this.height/2,1]),t.$(n,n,[1,-1,0]),this.labelPlaneMatrix=n,n=t.ao(new Float64Array(16)),t.a0(n,n,[1,-1,1]),t.$(n,n,[-1,-1,0]),t.a0(n,n,[2/this.width,2/this.height,1]),this.glCoordMatrix=n;const o=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),s=Math.min(this.elevation,this._minEleveationForCurrentTile),a=o-s*this._pixelPerMeter/Math.cos(this._pitch),l=s<0?a:o,c=Math.PI/2+this._pitch,u=this._fov*(.5+e.y/this.height),h=Math.sin(u)*l/Math.sin(t.ad(Math.PI-c-u,.01,Math.PI-.01)),d=this.getHorizon(),p=2*Math.atan(d/this.cameraToCenterDistance)*(.5+e.y/(2*d)),f=Math.sin(p)*l/Math.sin(t.ad(Math.PI-c-p,.01,Math.PI-.01)),A=Math.min(h,f),m=1.01*(Math.cos(Math.PI/2-this._pitch)*A+l),g=this.height/50;n=new Float64Array(16),t.b8(n,this._fov,this.width/this.height,g,m),n[8]=2*-e.x/this.width,n[9]=2*e.y/this.height,t.a0(n,n,[1,-1,1]),t.$(n,n,[0,0,-this.cameraToCenterDistance]),t.b9(n,n,this._pitch),t.ae(n,n,this.angle),t.$(n,n,[-i,-r,0]),this.mercatorMatrix=t.a0([],n,[this.worldSize,this.worldSize,this.worldSize]),t.a0(n,n,[1,1,this._pixelPerMeter]),this.pixelMatrix=t.a1(new Float64Array(16),this.labelPlaneMatrix,n),t.$(n,n,[0,0,-this.elevation]),this.projMatrix=n,this.invProjMatrix=t.as([],n),this.pixelMatrix3D=t.a1(new Float64Array(16),this.labelPlaneMatrix,n);const _=this.width%2/2,y=this.height%2/2,v=Math.cos(this.angle),x=Math.sin(this.angle),b=i-Math.round(i)+v*_+x*y,w=r-Math.round(r)+v*y+x*_,T=new Float64Array(n);if(t.$(T,T,[b>.5?b-1:b,w>.5?w-1:w,0]),this.alignedProjMatrix=T,n=t.as(new Float64Array(16),this.pixelMatrix),!n)throw new Error("failed to invert matrix");this.pixelMatrixInverse=n,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const e=this.pointCoordinate(new t.P(0,0)),i=[e.x*this.worldSize,e.y*this.worldSize,0,1];return t.ag(i,i,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const e=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new t.P(0,e))}getCameraQueryGeometry(e){const i=this.getCameraPoint();if(1===e.length)return[e[0],i];{let r=i.x,n=i.y,o=i.x,s=i.y;for(const t of e)r=Math.min(r,t.x),n=Math.min(n,t.y),o=Math.max(o,t.x),s=Math.max(s,t.y);return[new t.P(r,n),new t.P(o,n),new t.P(o,s),new t.P(r,s),new t.P(r,n)]}}}function ar(t,e){let i,r=!1,n=null,o=null;const s=()=>{n=null,r&&(t.apply(o,i),n=setTimeout(s,e),r=!1)};return(...t)=>(r=!0,o=this,i=t,n||s(),n)}class lr{constructor(t){this._getCurrentHash=()=>{const t=window.location.hash.replace("#","");if(this._hashName){let e;return t.split("&").map((t=>t.split("="))).forEach((t=>{t[0]===this._hashName&&(e=t)})),(e&&e[1]||"").split("/")}return t.split("/")},this._onHashChange=()=>{const t=this._getCurrentHash();if(t.length>=3&&!t.some((t=>isNaN(t)))){const e=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(t[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+t[2],+t[1]],zoom:+t[0],bearing:e,pitch:+(t[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const t=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,t)}catch(t){}},this._updateHash=ar(this._updateHashUnthrottled,300),this._hashName=t&&encodeURIComponent(t)}addTo(t){return this._map=t,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(t){const e=this._map.getCenter(),i=Math.round(100*this._map.getZoom())/100,r=Math.ceil((i*Math.LN2+Math.log(512/360/.5))/Math.LN10),n=Math.pow(10,r),o=Math.round(e.lng*n)/n,s=Math.round(e.lat*n)/n,a=this._map.getBearing(),l=this._map.getPitch();let c="";if(c+=t?`/${o}/${s}/${i}`:`${i}/${s}/${o}`,(a||l)&&(c+="/"+Math.round(10*a)/10),l&&(c+=`/${Math.round(l)}`),this._hashName){const t=this._hashName;let e=!1;const i=window.location.hash.slice(1).split("&").map((i=>{const r=i.split("=")[0];return r===t?(e=!0,`${r}=${c}`):i})).filter((t=>t));return e||i.push(`${t}=${c}`),`#${i.join("&")}`}return`#${c}`}}const cr={linearity:.3,easing:t.ba(0,0,.3,1)},ur=t.e({deceleration:2500,maxSpeed:1400},cr),hr=t.e({deceleration:20,maxSpeed:1400},cr),dr=t.e({deceleration:1e3,maxSpeed:360},cr),pr=t.e({deceleration:1e3,maxSpeed:90},cr);class fr{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:t.h.now(),settings:e})}_drainInertiaBuffer(){const e=this._inertiaBuffer,i=t.h.now();for(;e.length>0&&i-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const i={zoom:0,bearing:0,pitch:0,pan:new t.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:t}of this._inertiaBuffer)i.zoom+=t.zoomDelta||0,i.bearing+=t.bearingDelta||0,i.pitch+=t.pitchDelta||0,t.panDelta&&i.pan._add(t.panDelta),t.around&&(i.around=t.around),t.pinchAround&&(i.pinchAround=t.pinchAround);const r=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,n={};if(i.pan.mag()){const o=mr(i.pan.mag(),r,t.e({},ur,e||{}));n.offset=i.pan.mult(o.amount/i.pan.mag()),n.center=this._map.transform.center,Ar(n,o)}if(i.zoom){const t=mr(i.zoom,r,hr);n.zoom=this._map.transform.zoom+t.amount,Ar(n,t)}if(i.bearing){const e=mr(i.bearing,r,dr);n.bearing=this._map.transform.bearing+t.ad(e.amount,-179,179),Ar(n,e)}if(i.pitch){const t=mr(i.pitch,r,pr);n.pitch=this._map.transform.pitch+t.amount,Ar(n,t)}if(n.zoom||n.bearing){const t=void 0===i.pinchAround?i.around:i.pinchAround;n.around=t?this._map.unproject(t):this._map.getCenter()}return this.clear(),t.e(n,{noMoveStart:!0})}}function Ar(t,e){(!t.duration||t.duration<e.duration)&&(t.duration=e.duration,t.easing=e.easing)}function mr(e,i,r){const{maxSpeed:n,linearity:o,deceleration:s}=r,a=t.ad(e*o/(i/1e3),-n,n),l=Math.abs(a)/(s*o);return{easing:r.easing,duration:1e3*l,amount:a*(l/2)}}class gr extends t.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,r,n,o={}){const s=i.mousePos(r.getCanvasContainer(),n),a=r.unproject(s);super(e,t.e({point:s,lngLat:a,originalEvent:n},o)),this._defaultPrevented=!1,this.target=r}}class _r extends t.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,r,n){const o="touchend"===e?n.changedTouches:n.touches,s=i.touchPos(r.getCanvasContainer(),o),a=s.map((t=>r.unproject(t))),l=s.reduce(((t,e,i,r)=>t.add(e.div(r.length))),new t.P(0,0));super(e,{points:s,point:l,lngLats:a,lngLat:r.unproject(l),originalEvent:n}),this._defaultPrevented=!1}}class yr extends t.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,e,i){super(t,{originalEvent:i}),this._defaultPrevented=!1}}class vr{constructor(t,e){this._map=t,this._clickTolerance=e.clickTolerance}reset(){delete this._mousedownPos}wheel(t){return this._firePreventable(new yr(t.type,this._map,t))}mousedown(t,e){return this._mousedownPos=e,this._firePreventable(new gr(t.type,this._map,t))}mouseup(t){this._map.fire(new gr(t.type,this._map,t))}click(t,e){this._mousedownPos&&this._mousedownPos.dist(e)>=this._clickTolerance||this._map.fire(new gr(t.type,this._map,t))}dblclick(t){return this._firePreventable(new gr(t.type,this._map,t))}mouseover(t){this._map.fire(new gr(t.type,this._map,t))}mouseout(t){this._map.fire(new gr(t.type,this._map,t))}touchstart(t){return this._firePreventable(new _r(t.type,this._map,t))}touchmove(t){this._map.fire(new _r(t.type,this._map,t))}touchend(t){this._map.fire(new _r(t.type,this._map,t))}touchcancel(t){this._map.fire(new _r(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class xr{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(t){this._map.fire(new gr(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new gr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._ignoreContextMenu||this._map.fire(new gr(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class br{constructor(t){this._map=t}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(e){return this.transform.pointLocation(t.P.convert(e),this._map.terrain)}}class wr{constructor(t,e){this._map=t,this._tr=new br(t),this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=e.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,e){this.isEnabled()&&t.shiftKey&&0===t.button&&(i.disableDrag(),this._startPos=this._lastPos=e,this._active=!0)}mousemoveWindow(t,e){if(!this._active)return;const r=e;if(this._lastPos.equals(r)||!this._box&&r.dist(this._startPos)<this._clickTolerance)return;const n=this._startPos;this._lastPos=r,this._box||(this._box=i.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",t));const o=Math.min(n.x,r.x),s=Math.max(n.x,r.x),a=Math.min(n.y,r.y),l=Math.max(n.y,r.y);i.setTransform(this._box,`translate(${o}px,${a}px)`),this._box.style.width=s-o+"px",this._box.style.height=l-a+"px"}mouseupWindow(e,r){if(!this._active)return;if(0!==e.button)return;const n=this._startPos,o=r;if(this.reset(),i.suppressClick(),n.x!==o.x||n.y!==o.y)return this._map.fire(new t.k("boxzoomend",{originalEvent:e})),{cameraAnimation:t=>t.fitScreenCoordinates(n,o,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",e)}keydown(t){this._active&&27===t.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",t))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(i.remove(this._box),this._box=null),i.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(e,i){return this._map.fire(new t.k(e,{originalEvent:i}))}}function Tr(t,e){if(t.length!==e.length)throw new Error(`The number of touches and points are not equal - touches ${t.length}, points ${e.length}`);const i={};for(let r=0;r<t.length;r++)i[t[r].identifier]=e[r];return i}class Br{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(e,i,r){(this.centroid||r.length>this.numTouches)&&(this.aborted=!0),this.aborted||(void 0===this.startTime&&(this.startTime=e.timeStamp),r.length===this.numTouches&&(this.centroid=function(e){const i=new t.P(0,0);for(const t of e)i._add(t);return i.div(e.length)}(i),this.touches=Tr(r,i)))}touchmove(t,e,i){if(this.aborted||!this.centroid)return;const r=Tr(i,e);for(const t in this.touches){const e=r[t];(!e||e.dist(this.touches[t])>30)&&(this.aborted=!0)}}touchend(t,e,i){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),0===i.length){const t=!this.aborted&&this.centroid;if(this.reset(),t)return t}}}class Er{constructor(t){this.singleTap=new Br(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(t,e,i){this.singleTap.touchstart(t,e,i)}touchmove(t,e,i){this.singleTap.touchmove(t,e,i)}touchend(t,e,i){const r=this.singleTap.touchend(t,e,i);if(r){const e=t.timeStamp-this.lastTime<500,i=!this.lastTap||this.lastTap.dist(r)<30;if(e&&i||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=r,this.count===this.numTaps)return this.reset(),r}}}class Cr{constructor(t){this._tr=new br(t),this._zoomIn=new Er({numTouches:1,numTaps:2}),this._zoomOut=new Er({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,e,i){this._zoomIn.touchstart(t,e,i),this._zoomOut.touchstart(t,e,i)}touchmove(t,e,i){this._zoomIn.touchmove(t,e,i),this._zoomOut.touchmove(t,e,i)}touchend(t,e,i){const r=this._zoomIn.touchend(t,e,i),n=this._zoomOut.touchend(t,e,i),o=this._tr;return r?(this._active=!0,t.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:e=>e.easeTo({duration:300,zoom:o.zoom+1,around:o.unproject(r)},{originalEvent:t})}):n?(this._active=!0,t.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:e=>e.easeTo({duration:300,zoom:o.zoom-1,around:o.unproject(n)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Sr{constructor(t){this._enabled=!!t.enable,this._moveStateManager=t.moveStateManager,this._clickTolerance=t.clickTolerance||1,this._moveFunction=t.move,this._activateOnStart=!!t.activateOnStart,t.assignEvents(this),this.reset()}reset(t){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(t)}_move(...t){const e=this._moveFunction(...t);if(e.bearingDelta||e.pitchDelta||e.around||e.panDelta)return this._active=!0,e}dragStart(t,e){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(t)&&(this._moveStateManager.startMove(t),this._lastPoint=e.length?e[0]:e,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(t,e){if(!this.isEnabled())return;const i=this._lastPoint;if(!i)return;if(t.preventDefault(),!this._moveStateManager.isValidMoveEvent(t))return void this.reset(t);const r=e.length?e[0]:e;return!this._moved&&r.dist(i)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=r,this._move(i,r))}dragEnd(t){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(t)&&(this._moved&&i.suppressClick(),this.reset(t))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Ir={0:1,2:2};class Mr{constructor(t){this._correctEvent=t.checkCorrectEvent}startMove(t){const e=i.mouseButton(t);this._eventButton=e}endMove(t){delete this._eventButton}isValidStartEvent(t){return this._correctEvent(t)}isValidMoveEvent(t){return!function(t,e){const i=Ir[e];return void 0===t.buttons||(t.buttons&i)!==i}(t,this._eventButton)}isValidEndEvent(t){return i.mouseButton(t)===this._eventButton}}class kr{constructor(){this._firstTouch=void 0}_isOneFingerTouch(t){return 1===t.targetTouches.length}_isSameTouchEvent(t){return t.targetTouches[0].identifier===this._firstTouch}startMove(t){this._firstTouch=t.targetTouches[0].identifier}endMove(t){delete this._firstTouch}isValidStartEvent(t){return this._isOneFingerTouch(t)}isValidMoveEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}isValidEndEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}}const Pr=t=>{t.mousedown=t.dragStart,t.mousemoveWindow=t.dragMove,t.mouseup=t.dragEnd,t.contextmenu=function(t){t.preventDefault()}},Lr=({enable:t,clickTolerance:e,bearingDegreesPerPixelMoved:r=.8})=>{const n=new Mr({checkCorrectEvent:t=>0===i.mouseButton(t)&&t.ctrlKey||2===i.mouseButton(t)});return new Sr({clickTolerance:e,move:(t,e)=>({bearingDelta:(e.x-t.x)*r}),moveStateManager:n,enable:t,assignEvents:Pr})},zr=({enable:t,clickTolerance:e,pitchDegreesPerPixelMoved:r=-.5})=>{const n=new Mr({checkCorrectEvent:t=>0===i.mouseButton(t)&&t.ctrlKey||2===i.mouseButton(t)});return new Sr({clickTolerance:e,move:(t,e)=>({pitchDelta:(e.y-t.y)*r}),moveStateManager:n,enable:t,assignEvents:Pr})};class Fr{constructor(t,e){this._minTouches=t.cooperativeGestures?2:1,this._clickTolerance=t.clickTolerance||1,this._map=e,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new t.P(0,0),setTimeout((()=>{this._cancelCooperativeMessage=!1}),200)}touchstart(t,e,i){return this._calculateTransform(t,e,i)}touchmove(t,e,i){if(this._map._cooperativeGestures&&(2===this._minTouches&&i.length<2&&!this._cancelCooperativeMessage?this._map._onCooperativeGesture(t,!1,i.length):this._cancelCooperativeMessage||(this._cancelCooperativeMessage=!0)),this._active&&!(i.length<this._minTouches))return t.preventDefault(),this._calculateTransform(t,e,i)}touchend(t,e,i){this._calculateTransform(t,e,i),this._active&&i.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,i,r){r.length>0&&(this._active=!0);const n=Tr(r,i),o=new t.P(0,0),s=new t.P(0,0);let a=0;for(const t in n){const e=n[t],i=this._touches[t];i&&(o._add(e),s._add(e.sub(i)),a++,n[t]=e)}if(this._touches=n,a<this._minTouches||!s.mag())return;const l=s.div(a);return this._sum._add(l),this._sum.mag()<this._clickTolerance?void 0:{around:o.div(a),panDelta:l}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Dr{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(t,e,i){this._firstTwoTouches||i.length<2||(this._firstTwoTouches=[i[0].identifier,i[1].identifier],this._start([e[0],e[1]]))}touchmove(t,e,i){if(!this._firstTwoTouches)return;t.preventDefault();const[r,n]=this._firstTwoTouches,o=Rr(i,e,r),s=Rr(i,e,n);if(!o||!s)return;const a=this._aroundCenter?null:o.add(s).div(2);return this._move([o,s],a,t)}touchend(t,e,r){if(!this._firstTwoTouches)return;const[n,o]=this._firstTwoTouches,s=Rr(r,e,n),a=Rr(r,e,o);s&&a||(this._active&&i.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&"center"===t.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Rr(t,e,i){for(let r=0;r<t.length;r++)if(t[r].identifier===i)return e[r]}function Ur(t,e){return Math.log(t/e)/Math.LN2}class Or extends Dr{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,e){const i=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(Ur(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Ur(this._distance,i),pinchAround:e}}}function Nr(t,e){return 180*t.angleWith(e)/Math.PI}class Qr extends Dr{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,e){const i=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Nr(this._vector,i),pinchAround:e}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const e=25/(Math.PI*this._minDiameter)*360,i=Nr(t,this._startVector);return Math.abs(i)<e}}function Vr(t){return Math.abs(t.y)>Math.abs(t.x)}class jr extends Dr{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(t,e,i){super.touchstart(t,e,i),this._currentTouchCount=i.length}_start(t){this._lastPoints=t,Vr(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,e,i){if(this._map._cooperativeGestures&&this._currentTouchCount<3)return;const r=t[0].sub(this._lastPoints[0]),n=t[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(r,n,i.timeStamp),this._valid?(this._lastPoints=t,this._active=!0,{pitchDelta:(r.y+n.y)/2*-.5}):void 0}gestureBeginsVertically(t,e,i){if(void 0!==this._valid)return this._valid;const r=t.mag()>=2,n=e.mag()>=2;if(!r&&!n)return;if(!r||!n)return void 0===this._firstMove&&(this._firstMove=i),i-this._firstMove<100&&void 0;const o=t.y>0==e.y>0;return Vr(t)&&Vr(e)&&o}}const Hr={panStep:100,bearingStep:15,pitchStep:10};class Gr{constructor(t){this._tr=new br(t);const e=Hr;this._panStep=e.panStep,this._bearingStep=e.bearingStep,this._pitchStep=e.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let e=0,i=0,r=0,n=0,o=0;switch(t.keyCode){case 61:case 107:case 171:case 187:e=1;break;case 189:case 109:case 173:e=-1;break;case 37:t.shiftKey?i=-1:(t.preventDefault(),n=-1);break;case 39:t.shiftKey?i=1:(t.preventDefault(),n=1);break;case 38:t.shiftKey?r=1:(t.preventDefault(),o=-1);break;case 40:t.shiftKey?r=-1:(t.preventDefault(),o=1);break;default:return}return this._rotationDisabled&&(i=0,r=0),{cameraAnimation:s=>{const a=this._tr;s.easeTo({duration:300,easeId:"keyboardHandler",easing:$r,zoom:e?Math.round(a.zoom)+e*(t.shiftKey?2:1):a.zoom,bearing:a.bearing+i*this._bearingStep,pitch:a.pitch+r*this._pitchStep,offset:[-n*this._panStep,-o*this._panStep],center:a.center},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function $r(t){return t*(2-t)}const Zr=4.000244140625;class qr{constructor(t,e){this._onTimeout=t=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)},this._map=t,this._tr=new br(t),this._el=t.getCanvasContainer(),this._triggerRenderFrame=e,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&"center"===t.around)}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(e){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!e[this._map._metaKey])return;e.preventDefault()}let i=e.deltaMode===WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY;const r=t.h.now(),n=r-(this._lastWheelEventTime||0);this._lastWheelEventTime=r,0!==i&&i%Zr==0?this._type="wheel":0!==i&&Math.abs(i)<4?this._type="trackpad":n>400?(this._type=null,this._lastValue=i,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(n*i)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,i+=this._lastValue)),e.shiftKey&&i&&(i/=4),this._type&&(this._lastWheelEvent=e,this._delta-=i,this._active||this._start(e)),e.preventDefault()}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const r=i.mousePos(this._el,e),n=this._tr;this._around=t.L.convert(this._aroundCenter?n.center:n.unproject(r)),this._aroundPoint=n.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId)return;if(this._frameId=null,!this.isActive())return;const e=this._tr.transform;if(0!==this._delta){const t="wheel"===this._type&&Math.abs(this._delta)>Zr?this._wheelZoomRate:this._defaultZoomRate;let i=2/(1+Math.exp(-Math.abs(this._delta*t)));this._delta<0&&0!==i&&(i=1/i);const r="number"==typeof this._targetZoom?e.zoomScale(this._targetZoom):e.scale;this._targetZoom=Math.min(e.maxZoom,Math.max(e.minZoom,e.scaleZoom(r*i))),"wheel"===this._type&&(this._startZoom=e.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const i="number"==typeof this._targetZoom?this._targetZoom:e.zoom,r=this._startZoom,n=this._easing;let o,s=!1;if("wheel"===this._type&&r&&n){const e=Math.min((t.h.now()-this._lastWheelEventTime)/200,1),a=n(e);o=t.B.number(r,i,a),e<1?this._frameId||(this._frameId=!0):s=!0}else o=i,s=!0;return this._active=!0,s&&(this._active=!1,this._finishTimeout=setTimeout((()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout}),200)),{noInertia:!0,needsRenderFrame:!s,zoomDelta:o-e.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let i=t.bb;if(this._prevEase){const e=this._prevEase,r=(t.h.now()-e.start)/e.duration,n=e.easing(r+.01)-e.easing(r),o=.27/Math.sqrt(n*n+1e-4)*.01,s=Math.sqrt(.0729-o*o);i=t.ba(o,s,.25,1)}return this._prevEase={start:t.h.now(),duration:e,easing:i},i}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Kr{constructor(t,e){this._clickZoom=t,this._tapZoom=e}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Wr{constructor(t){this._tr=new br(t),this.reset()}reset(){this._active=!1}dblclick(t,e){return t.preventDefault(),{cameraAnimation:i=>{i.easeTo({duration:300,zoom:this._tr.zoom+(t.shiftKey?-1:1),around:this._tr.unproject(e)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Xr{constructor(){this._tap=new Er({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(t,e,i){if(!this._swipePoint)if(this._tapTime){const r=e[0],n=t.timeStamp-this._tapTime<500,o=this._tapPoint.dist(r)<30;n&&o?i.length>0&&(this._swipePoint=r,this._swipeTouch=i[0].identifier):this.reset()}else this._tap.touchstart(t,e,i)}touchmove(t,e,i){if(this._tapTime){if(this._swipePoint){if(i[0].identifier!==this._swipeTouch)return;const r=e[0],n=r.y-this._swipePoint.y;return this._swipePoint=r,t.preventDefault(),this._active=!0,{zoomDelta:n/128}}}else this._tap.touchmove(t,e,i)}touchend(t,e,i){if(this._tapTime)this._swipePoint&&0===i.length&&this.reset();else{const r=this._tap.touchend(t,e,i);r&&(this._tapTime=t.timeStamp,this._tapPoint=r)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Jr{constructor(t,e,i){this._el=t,this._mousePan=e,this._touchPan=i}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Yr{constructor(t,e,i){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=e,this._mousePitch=i}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class tn{constructor(t,e,i,r){this._el=t,this._touchZoom=e,this._touchRotate=i,this._tapDragZoom=r,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const en=t=>t.zoom||t.drag||t.pitch||t.rotate;class rn extends t.k{}function nn(t){return t.panDelta&&t.panDelta.mag()||t.zoomDelta||t.bearingDelta||t.pitchDelta}class on{constructor(t,e){this.handleWindowEvent=t=>{this.handleEvent(t,`${t.type}Window`)},this.handleEvent=(t,e)=>{if("blur"===t.type)return void this.stop(!0);this._updatingCamera=!0;const r="renderFrame"===t.type?void 0:t,n={needsRenderFrame:!1},o={},s={},a=t.touches,l=a?this._getMapTouches(a):void 0,c=l?i.touchPos(this._el,l):i.mousePos(this._el,t);for(const{handlerName:i,handler:a,allowed:u}of this._handlers){if(!a.isEnabled())continue;let h;this._blockedByActive(s,u,i)?a.reset():a[e||t.type]&&(h=a[e||t.type](t,c,l),this.mergeHandlerResult(n,o,h,i,r),h&&h.needsRenderFrame&&this._triggerRenderFrame()),(h||a.isActive())&&(s[i]=a)}const u={};for(const t in this._previousActiveHandlers)s[t]||(u[t]=r);this._previousActiveHandlers=s,(Object.keys(u).length||nn(n))&&(this._changes.push([n,o,u]),this._triggerRenderFrame()),(Object.keys(s).length||nn(n))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:h}=n;h&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],h(this._map))},this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new fr(t),this._bearingSnap=e.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(e);const r=this._el;this._listeners=[[r,"touchstart",{passive:!0}],[r,"touchmove",{passive:!1}],[r,"touchend",void 0],[r,"touchcancel",void 0],[r,"mousedown",void 0],[r,"mousemove",void 0],[r,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[r,"mouseover",void 0],[r,"mouseout",void 0],[r,"dblclick",void 0],[r,"click",void 0],[r,"keydown",{capture:!1}],[r,"keyup",void 0],[r,"wheel",{passive:!1}],[r,"contextmenu",void 0],[window,"blur",void 0]];for(const[t,e,r]of this._listeners)i.addEventListener(t,e,t===document?this.handleWindowEvent:this.handleEvent,r)}destroy(){for(const[t,e,r]of this._listeners)i.removeEventListener(t,e,t===document?this.handleWindowEvent:this.handleEvent,r)}_addDefaultHandlers(t){const e=this._map,r=e.getCanvasContainer();this._add("mapEvent",new vr(e,t));const n=e.boxZoom=new wr(e,t);this._add("boxZoom",n),t.interactive&&t.boxZoom&&n.enable();const o=new Cr(e),s=new Wr(e);e.doubleClickZoom=new Kr(s,o),this._add("tapZoom",o),this._add("clickZoom",s),t.interactive&&t.doubleClickZoom&&e.doubleClickZoom.enable();const a=new Xr;this._add("tapDragZoom",a);const l=e.touchPitch=new jr(e);this._add("touchPitch",l),t.interactive&&t.touchPitch&&e.touchPitch.enable(t.touchPitch);const c=Lr(t),u=zr(t);e.dragRotate=new Yr(t,c,u),this._add("mouseRotate",c,["mousePitch"]),this._add("mousePitch",u,["mouseRotate"]),t.interactive&&t.dragRotate&&e.dragRotate.enable();const h=(({enable:t,clickTolerance:e})=>{const r=new Mr({checkCorrectEvent:t=>0===i.mouseButton(t)&&!t.ctrlKey});return new Sr({clickTolerance:e,move:(t,e)=>({around:e,panDelta:e.sub(t)}),activateOnStart:!0,moveStateManager:r,enable:t,assignEvents:Pr})})(t),d=new Fr(t,e);e.dragPan=new Jr(r,h,d),this._add("mousePan",h),this._add("touchPan",d,["touchZoom","touchRotate"]),t.interactive&&t.dragPan&&e.dragPan.enable(t.dragPan);const p=new Qr,f=new Or;e.touchZoomRotate=new tn(r,f,p,a),this._add("touchRotate",p,["touchPan","touchZoom"]),this._add("touchZoom",f,["touchPan","touchRotate"]),t.interactive&&t.touchZoomRotate&&e.touchZoomRotate.enable(t.touchZoomRotate);const A=e.scrollZoom=new qr(e,(()=>this._triggerRenderFrame()));this._add("scrollZoom",A,["mousePan"]),t.interactive&&t.scrollZoom&&e.scrollZoom.enable(t.scrollZoom);const m=e.keyboard=new Gr(e);this._add("keyboard",m),t.interactive&&t.keyboard&&e.keyboard.enable(),this._add("blockableMapEvent",new xr(e))}_add(t,e,i){this._handlers.push({handlerName:t,handler:e,allowed:i}),this._handlersById[t]=e}stop(t){if(!this._updatingCamera){for(const{handler:t}of this._handlers)t.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return Boolean(en(this._eventsInProgress))||this.isZooming()}_blockedByActive(t,e,i){for(const r in t)if(r!==i&&(!e||e.indexOf(r)<0))return!0;return!1}_getMapTouches(t){const e=[];for(const i of t)this._el.contains(i.target)&&e.push(i);return e}mergeHandlerResult(e,i,r,n,o){if(!r)return;t.e(e,r);const s={handlerName:n,originalEvent:r.originalEvent||o};void 0!==r.zoomDelta&&(i.zoom=s),void 0!==r.panDelta&&(i.drag=s),void 0!==r.pitchDelta&&(i.pitch=s),void 0!==r.bearingDelta&&(i.rotate=s)}_applyChanges(){const e={},i={},r={};for(const[n,o,s]of this._changes)n.panDelta&&(e.panDelta=(e.panDelta||new t.P(0,0))._add(n.panDelta)),n.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+n.zoomDelta),n.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+n.bearingDelta),n.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+n.pitchDelta),void 0!==n.around&&(e.around=n.around),void 0!==n.pinchAround&&(e.pinchAround=n.pinchAround),n.noInertia&&(e.noInertia=n.noInertia),t.e(i,o),t.e(r,s);this._updateMapTransform(e,i,r),this._changes=[]}_updateMapTransform(t,e,i){const r=this._map,n=r._getTransformForUpdate(),o=r.terrain;if(!(nn(t)||o&&this._terrainMovement))return this._fireEvents(e,i,!0);let{panDelta:s,zoomDelta:a,bearingDelta:l,pitchDelta:c,around:u,pinchAround:h}=t;void 0!==h&&(u=h),r._stop(!0),u=u||r.transform.centerPoint;const d=n.pointLocation(s?u.sub(s):u);l&&(n.bearing+=l),c&&(n.pitch+=c),a&&(n.zoom+=a),o?this._terrainMovement||!e.drag&&!e.zoom?e.drag&&this._terrainMovement?n.center=n.pointLocation(n.centerPoint.sub(s)):n.setLocationAtPoint(d,u):(this._terrainMovement=!0,this._map._elevationFreeze=!0,n.setLocationAtPoint(d,u),this._map.once("moveend",(()=>{this._map._elevationFreeze=!1,this._terrainMovement=!1,n.recalculateZoom(r.terrain)}))):n.setLocationAtPoint(d,u),r._applyUpdatedTransform(n),this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(e,i,!0)}_fireEvents(e,i,r){const n=en(this._eventsInProgress),o=en(e),s={};for(const t in e){const{originalEvent:i}=e[t];this._eventsInProgress[t]||(s[`${t}start`]=i),this._eventsInProgress[t]=e[t]}!n&&o&&this._fireEvent("movestart",o.originalEvent);for(const t in s)this._fireEvent(t,s[t]);o&&this._fireEvent("move",o.originalEvent);for(const t in e){const{originalEvent:i}=e[t];this._fireEvent(t,i)}const a={};let l;for(const t in this._eventsInProgress){const{handlerName:e,originalEvent:r}=this._eventsInProgress[t];this._handlersById[e].isActive()||(delete this._eventsInProgress[t],l=i[e]||r,a[`${t}end`]=l)}for(const t in a)this._fireEvent(t,a[t]);const c=en(this._eventsInProgress);if(r&&(n||o)&&!c){this._updatingCamera=!0;const e=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),i=t=>0!==t&&-this._bearingSnap<t&&t<this._bearingSnap;!e||!e.essential&&t.h.prefersReducedMotion?(this._map.fire(new t.k("moveend",{originalEvent:l})),i(this._map.getBearing())&&this._map.resetNorth()):(i(e.bearing||this._map.getBearing())&&(e.bearing=0),e.freezeElevation=!0,this._map.easeTo(e,{originalEvent:l})),this._updatingCamera=!1}}_fireEvent(e,i){this._map.fire(new t.k(e,i?{originalEvent:i}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((t=>{delete this._frameId,this.handleEvent(new rn("renderFrame",{timeStamp:t})),this._applyChanges()}))}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}class sn extends t.E{constructor(e,i){super(),this._renderFrameCallback=()=>{const e=Math.min((t.h.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(e)),e<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=i.bearingSnap,this.on("moveend",(()=>{delete this._requestedCameraState}))}getCenter(){return new t.L(this.transform.center.lng,this.transform.center.lat)}setCenter(t,e){return this.jumpTo({center:t},e)}panBy(e,i,r){return e=t.P.convert(e).mult(-1),this.panTo(this.transform.center,t.e({offset:e},i),r)}panTo(e,i,r){return this.easeTo(t.e({center:e},i),r)}getZoom(){return this.transform.zoom}setZoom(t,e){return this.jumpTo({zoom:t},e),this}zoomTo(e,i,r){return this.easeTo(t.e({zoom:e},i),r)}zoomIn(t,e){return this.zoomTo(this.getZoom()+1,t,e),this}zoomOut(t,e){return this.zoomTo(this.getZoom()-1,t,e),this}getBearing(){return this.transform.bearing}setBearing(t,e){return this.jumpTo({bearing:t},e),this}getPadding(){return this.transform.padding}setPadding(t,e){return this.jumpTo({padding:t},e),this}rotateTo(e,i,r){return this.easeTo(t.e({bearing:e},i),r)}resetNorth(e,i){return this.rotateTo(0,t.e({duration:1e3},e),i),this}resetNorthPitch(e,i){return this.easeTo(t.e({bearing:0,pitch:0,duration:1e3},e),i),this}snapToNorth(t,e){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,e):this}getPitch(){return this.transform.pitch}setPitch(t,e){return this.jumpTo({pitch:t},e),this}cameraForBounds(t,e){t=P.convert(t);const i=e&&e.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),i,e)}_cameraForBoxAndBearing(e,i,r,n){const o={top:0,bottom:0,right:0,left:0};if("number"==typeof(n=t.e({padding:o,offset:[0,0],maxZoom:this.transform.maxZoom},n)).padding){const t=n.padding;n.padding={top:t,bottom:t,right:t,left:t}}n.padding=t.e(o,n.padding);const s=this.transform,a=s.padding,l=s.project(t.L.convert(e)),c=s.project(t.L.convert(i)),u=l.rotate(-r*Math.PI/180),h=c.rotate(-r*Math.PI/180),d=new t.P(Math.max(u.x,h.x),Math.max(u.y,h.y)),p=new t.P(Math.min(u.x,h.x),Math.min(u.y,h.y)),f=d.sub(p),A=(s.width-(a.left+a.right+n.padding.left+n.padding.right))/f.x,m=(s.height-(a.top+a.bottom+n.padding.top+n.padding.bottom))/f.y;if(m<0||A<0)return void t.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const g=Math.min(s.scaleZoom(s.scale*Math.min(A,m)),n.maxZoom),_=t.P.convert(n.offset),y=new t.P((n.padding.left-n.padding.right)/2,(n.padding.top-n.padding.bottom)/2).rotate(r*Math.PI/180),v=_.add(y).mult(s.scale/s.zoomScale(g));return{center:s.unproject(l.add(c).div(2).sub(v)),zoom:g,bearing:r}}fitBounds(t,e,i){return this._fitInternal(this.cameraForBounds(t,e),e,i)}fitScreenCoordinates(e,i,r,n,o){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(t.P.convert(e)),this.transform.pointLocation(t.P.convert(i)),r,n),n,o)}_fitInternal(e,i,r){return e?(delete(i=t.e(e,i)).padding,i.linear?this.easeTo(i,r):this.flyTo(i,r)):this}jumpTo(e,i){this.stop();const r=this._getTransformForUpdate();let n=!1,o=!1,s=!1;return"zoom"in e&&r.zoom!==+e.zoom&&(n=!0,r.zoom=+e.zoom),void 0!==e.center&&(r.center=t.L.convert(e.center)),"bearing"in e&&r.bearing!==+e.bearing&&(o=!0,r.bearing=+e.bearing),"pitch"in e&&r.pitch!==+e.pitch&&(s=!0,r.pitch=+e.pitch),null==e.padding||r.isPaddingEqual(e.padding)||(r.padding=e.padding),this._applyUpdatedTransform(r),this.fire(new t.k("movestart",i)).fire(new t.k("move",i)),n&&this.fire(new t.k("zoomstart",i)).fire(new t.k("zoom",i)).fire(new t.k("zoomend",i)),o&&this.fire(new t.k("rotatestart",i)).fire(new t.k("rotate",i)).fire(new t.k("rotateend",i)),s&&this.fire(new t.k("pitchstart",i)).fire(new t.k("pitch",i)).fire(new t.k("pitchend",i)),this.fire(new t.k("moveend",i))}calculateCameraOptionsFromTo(e,i,r,n=0){const o=t.U.fromLngLat(e,i),s=t.U.fromLngLat(r,n),a=s.x-o.x,l=s.y-o.y,c=s.z-o.z,u=Math.hypot(a,l,c);if(0===u)throw new Error("Can't calculate camera options with same From and To");const h=Math.hypot(a,l),d=this.transform.scaleZoom(this.transform.cameraToCenterDistance/u/this.transform.tileSize),p=180*Math.atan2(a,-l)/Math.PI;let f=180*Math.acos(h/u)/Math.PI;return f=c<0?90-f:90+f,{center:s.toLngLat(),zoom:d,pitch:f,bearing:p}}easeTo(e,i){this._stop(!1,e.easeId),(!1===(e=t.e({offset:[0,0],duration:500,easing:t.bb},e)).animate||!e.essential&&t.h.prefersReducedMotion)&&(e.duration=0);const r=this._getTransformForUpdate(),n=this.getZoom(),o=this.getBearing(),s=this.getPitch(),a=this.getPadding(),l="zoom"in e?+e.zoom:n,c="bearing"in e?this._normalizeBearing(e.bearing,o):o,u="pitch"in e?+e.pitch:s,h="padding"in e?e.padding:r.padding,d=t.P.convert(e.offset);let p=r.centerPoint.add(d);const f=r.pointLocation(p),A=t.L.convert(e.center||f);this._normalizeCenter(A);const m=r.project(f),g=r.project(A).sub(m),_=r.zoomScale(l-n);let y,v;e.around&&(y=t.L.convert(e.around),v=r.locationPoint(y));const x={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||l!==n,this._rotating=this._rotating||o!==c,this._pitching=this._pitching||u!==s,this._padding=!r.isPaddingEqual(h),this._easeId=e.easeId,this._prepareEase(i,e.noMoveStart,x),this.terrain&&this._prepareElevation(A),this._ease((f=>{if(this._zooming&&(r.zoom=t.B.number(n,l,f)),this._rotating&&(r.bearing=t.B.number(o,c,f)),this._pitching&&(r.pitch=t.B.number(s,u,f)),this._padding&&(r.interpolatePadding(a,h,f),p=r.centerPoint.add(d)),this.terrain&&!e.freezeElevation&&this._updateElevation(f),y)r.setLocationAtPoint(y,v);else{const t=r.zoomScale(r.zoom-n),e=l>n?Math.min(2,_):Math.max(.5,_),i=Math.pow(e,1-f),o=r.unproject(m.add(g.mult(f*i)).mult(t));r.setLocationAtPoint(r.renderWorldCopies?o.wrap():o,p)}this._applyUpdatedTransform(r),this._fireMoveEvents(i)}),(t=>{this.terrain&&this._finalizeElevation(),this._afterEase(i,t)}),e),this}_prepareEase(e,i,r={}){this._moving=!0,i||r.moving||this.fire(new t.k("movestart",e)),this._zooming&&!r.zooming&&this.fire(new t.k("zoomstart",e)),this._rotating&&!r.rotating&&this.fire(new t.k("rotatestart",e)),this._pitching&&!r.pitching&&this.fire(new t.k("pitchstart",e))}_prepareElevation(t){this._elevationCenter=t,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(t,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(e){this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const i=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(e<1&&i!==this._elevationTarget){const t=this._elevationTarget-this._elevationStart;this._elevationStart+=e*(t-(i-(t*e+this._elevationStart))/(1-e)),this._elevationTarget=i}this.transform.elevation=t.B.number(this._elevationStart,this._elevationTarget,e)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(t){if(!this.transformCameraUpdate)return;const e=t.clone(),{center:i,zoom:r,pitch:n,bearing:o,elevation:s}=this.transformCameraUpdate(e);i&&(e.center=i),void 0!==r&&(e.zoom=r),void 0!==n&&(e.pitch=n),void 0!==o&&(e.bearing=o),void 0!==s&&(e.elevation=s),this.transform.apply(e)}_fireMoveEvents(e){this.fire(new t.k("move",e)),this._zooming&&this.fire(new t.k("zoom",e)),this._rotating&&this.fire(new t.k("rotate",e)),this._pitching&&this.fire(new t.k("pitch",e))}_afterEase(e,i){if(this._easeId&&i&&this._easeId===i)return;delete this._easeId;const r=this._zooming,n=this._rotating,o=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,r&&this.fire(new t.k("zoomend",e)),n&&this.fire(new t.k("rotateend",e)),o&&this.fire(new t.k("pitchend",e)),this.fire(new t.k("moveend",e))}flyTo(e,i){if(!e.essential&&t.h.prefersReducedMotion){const r=t.F(e,["center","zoom","bearing","pitch","around"]);return this.jumpTo(r,i)}this.stop(),e=t.e({offset:[0,0],speed:1.2,curve:1.42,easing:t.bb},e);const r=this._getTransformForUpdate(),n=this.getZoom(),o=this.getBearing(),s=this.getPitch(),a=this.getPadding(),l="zoom"in e?t.ad(+e.zoom,r.minZoom,r.maxZoom):n,c="bearing"in e?this._normalizeBearing(e.bearing,o):o,u="pitch"in e?+e.pitch:s,h="padding"in e?e.padding:r.padding,d=r.zoomScale(l-n),p=t.P.convert(e.offset);let f=r.centerPoint.add(p);const A=r.pointLocation(f),m=t.L.convert(e.center||A);this._normalizeCenter(m);const g=r.project(A),_=r.project(m).sub(g);let y=e.curve;const v=Math.max(r.width,r.height),x=v/d,b=_.mag();if("minZoom"in e){const i=t.ad(Math.min(e.minZoom,n,l),r.minZoom,r.maxZoom),o=v/r.zoomScale(i-n);y=Math.sqrt(o/b*2)}const w=y*y;function T(t){const e=(x*x-v*v+(t?-1:1)*w*w*b*b)/(2*(t?x:v)*w*b);return Math.log(Math.sqrt(e*e+1)-e)}function B(t){return(Math.exp(t)-Math.exp(-t))/2}function E(t){return(Math.exp(t)+Math.exp(-t))/2}const C=T(!1);let S=function(t){return E(C)/E(C+y*t)},I=function(t){return v*((E(C)*(B(e=C+y*t)/E(e))-B(C))/w)/b;var e},M=(T(!0)-C)/y;if(Math.abs(b)<1e-6||!isFinite(M)){if(Math.abs(v-x)<1e-6)return this.easeTo(e,i);const t=x<v?-1:1;M=Math.abs(Math.log(x/v))/y,I=function(){return 0},S=function(e){return Math.exp(t*y*e)}}return e.duration="duration"in e?+e.duration:1e3*M/("screenSpeed"in e?+e.screenSpeed/y:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=o!==c,this._pitching=u!==s,this._padding=!r.isPaddingEqual(h),this._prepareEase(i,!1),this.terrain&&this._prepareElevation(m),this._ease((d=>{const A=d*M,y=1/S(A);r.zoom=1===d?l:n+r.scaleZoom(y),this._rotating&&(r.bearing=t.B.number(o,c,d)),this._pitching&&(r.pitch=t.B.number(s,u,d)),this._padding&&(r.interpolatePadding(a,h,d),f=r.centerPoint.add(p)),this.terrain&&!e.freezeElevation&&this._updateElevation(d);const v=1===d?m:r.unproject(g.add(_.mult(I(A))).mult(y));r.setLocationAtPoint(r.renderWorldCopies?v.wrap():v,f),this._applyUpdatedTransform(r),this._fireMoveEvents(i)}),(()=>{this.terrain&&this._finalizeElevation(),this._afterEase(i)}),e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,e){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const t=this._onEaseEnd;delete this._onEaseEnd,t.call(this,e)}if(!t){const t=this.handlers;t&&t.stop(!1)}return this}_ease(e,i,r){!1===r.animate||0===r.duration?(e(1),i()):(this._easeStart=t.h.now(),this._easeOptions=r,this._onEaseFrame=e,this._onEaseEnd=i,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(e,i){e=t.b5(e,-180,180);const r=Math.abs(e-i);return Math.abs(e-360-i)<r&&(e-=360),Math.abs(e+360-i)<r&&(e+=360),e}_normalizeCenter(t){const e=this.transform;if(!e.renderWorldCopies||e.lngRange)return;const i=t.lng-e.center.lng;t.lng+=i>180?-360:i<-180?360:0}queryTerrainElevation(e){return this.terrain?this.terrain.getElevationForLngLatZoom(t.L.convert(e),this.transform.tileZoom)-this.transform.elevation:null}}class an{constructor(t={}){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=t=>{!t||"metadata"!==t.sourceDataType&&"visibility"!==t.sourceDataType&&"style"!==t.dataType&&"terrain"!==t.type||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?!1===this._compact?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=t}getDefaultPosition(){return"bottom-right"}onAdd(t){return this._map=t,this._compact=this.options&&this.options.compact,this._container=i.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=i.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=i.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){i.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(t,e){const i=this._map._getUIString(`AttributionControl.${e}`);t.title=i,t.setAttribute("aria-label",i)}_updateAttributions(){if(!this._map.style)return;let t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map((t=>"string"!=typeof t?"":t))):"string"==typeof this.options.customAttribution&&t.push(this.options.customAttribution)),this._map.style.stylesheet){const t=this._map.style.stylesheet;this.styleOwner=t.owner,this.styleId=t.id}const e=this._map.style.sourceCaches;for(const i in e){const r=e[i];if(r.used||r.usedForTerrain){const e=r.getSource();e.attribution&&t.indexOf(e.attribution)<0&&t.push(e.attribution)}}t=t.filter((t=>String(t).trim())),t.sort(((t,e)=>t.length-e.length)),t=t.filter(((e,i)=>{for(let r=i+1;r<t.length;r++)if(t[r].indexOf(e)>=0)return!1;return!0}));const i=t.join(" | ");i!==this._attribHTML&&(this._attribHTML=i,t.length?(this._innerContainer.innerHTML=i,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class ln{constructor(t={}){this._updateCompact=()=>{const t=this._container.children;if(t.length){const e=t[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?!1!==this._compact&&e.classList.add("maplibregl-compact"):e.classList.remove("maplibregl-compact")}},this.options=t}getDefaultPosition(){return"bottom-left"}onAdd(t){this._map=t,this._compact=this.options&&this.options.compact,this._container=i.create("div","maplibregl-ctrl");const e=i.create("a","maplibregl-ctrl-logo");return e.target="_blank",e.rel="noopener nofollow",e.href="https://maplibre.org/",e.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),e.setAttribute("rel","noopener nofollow"),this._container.appendChild(e),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){i.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class cn{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const e=++this._id;return this._queue.push({callback:t,id:e,cancelled:!1}),e}remove(t){const e=this._currentlyRunning,i=e?this._queue.concat(e):this._queue;for(const e of i)if(e.id===t)return void(e.cancelled=!0)}run(t=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const e=this._currentlyRunning=this._queue;this._queue=[];for(const i of e)if(!i.cancelled&&(i.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}const un={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.enableTerrain":"Enable terrain","TerrainControl.disableTerrain":"Disable terrain"};var hn=t.Q([{name:"a_pos3d",type:"Int16",components:3}]);class dn extends t.E{constructor(t){super(),this.sourceCache=t,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,t.usedForTerrain=!0,t.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(e,i){this.sourceCache.update(e,i),this._renderableTilesKeys=[];const r={};for(const n of e.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:i}))r[n.key]=!0,this._renderableTilesKeys.push(n.key),this._tiles[n.key]||(n.posMatrix=new Float64Array(16),t.aS(n.posMatrix,0,t.N,0,t.N,0,1),this._tiles[n.key]=new Z(n,this.tileSize));for(const t in this._tiles)r[t]||delete this._tiles[t]}freeRtt(t){for(const e in this._tiles){const i=this._tiles[e];(!t||i.tileID.equals(t)||i.tileID.isChildOf(t)||t.isChildOf(i.tileID))&&(i.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map((t=>this.getTileByID(t)))}getTileByID(t){return this._tiles[t]}getTerrainCoords(e){const i={};for(const r of this._renderableTilesKeys){const n=this._tiles[r].tileID;if(n.canonical.equals(e.canonical)){const n=e.clone();n.posMatrix=new Float64Array(16),t.aS(n.posMatrix,0,t.N,0,t.N,0,1),i[r]=n}else if(n.canonical.isChildOf(e.canonical)){const o=e.clone();o.posMatrix=new Float64Array(16);const s=n.canonical.z-e.canonical.z,a=n.canonical.x-(n.canonical.x>>s<<s),l=n.canonical.y-(n.canonical.y>>s<<s),c=t.N>>s;t.aS(o.posMatrix,0,c,0,c,0,1),t.$(o.posMatrix,o.posMatrix,[-a*c,-l*c,0]),i[r]=o}else if(e.canonical.isChildOf(n.canonical)){const o=e.clone();o.posMatrix=new Float64Array(16);const s=e.canonical.z-n.canonical.z,a=e.canonical.x-(e.canonical.x>>s<<s),l=e.canonical.y-(e.canonical.y>>s<<s),c=t.N>>s;t.aS(o.posMatrix,0,t.N,0,t.N,0,1),t.$(o.posMatrix,o.posMatrix,[a*c,l*c,0]),t.a0(o.posMatrix,o.posMatrix,[1/2**s,1/2**s,0]),i[r]=o}}return i}getSourceTile(t,e){const i=this.sourceCache._source;let r=t.overscaledZ-this.deltaZoom;if(r>i.maxzoom&&(r=i.maxzoom),r<i.minzoom)return null;this._sourceTileCache[t.key]||(this._sourceTileCache[t.key]=t.scaledTo(r).key);let n=this.sourceCache.getTileByID(this._sourceTileCache[t.key]);if((!n||!n.dem)&&e)for(;r>=i.minzoom&&(!n||!n.dem);)n=this.sourceCache.getTileByID(t.scaledTo(r--).key);return n}tilesAfterTime(t=Date.now()){return Object.values(this._tiles).filter((e=>e.timeAdded>=t))}}class pn{constructor(t,e,i){this.painter=t,this.sourceCache=new dn(e),this.options=i,this.exaggeration="number"==typeof i.exaggeration?i.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(e,i,r,n=t.N){var o;if(!(i>=0&&i<n&&r>=0&&r<n))return 0;const s=this.getTerrainData(e),a=null===(o=s.tile)||void 0===o?void 0:o.dem;if(!a)return 0;const l=function(t,e,i){var r=e[0],n=e[1];return t[0]=i[0]*r+i[4]*n+i[12],t[1]=i[1]*r+i[5]*n+i[13],t}([],[i/n*t.N,r/n*t.N],s.u_terrain_matrix),c=[l[0]*a.dim,l[1]*a.dim],u=Math.floor(c[0]),h=Math.floor(c[1]),d=c[0]-u,p=c[1]-h;return a.get(u,h)*(1-d)*(1-p)+a.get(u+1,h)*d*(1-p)+a.get(u,h+1)*(1-d)*p+a.get(u+1,h+1)*d*p}getElevationForLngLatZoom(e,i){const{tileID:r,mercatorX:n,mercatorY:o}=this._getOverscaledTileIDFromLngLatZoom(e,i);return this.getElevation(r,n%t.N,o%t.N,t.N)}getElevation(e,i,r,n=t.N){return this.getDEMElevation(e,i,r,n)*this.exaggeration}getTerrainData(e){if(!this._emptyDemTexture){const e=this.painter.context,i=new t.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new y(e,i,e.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new y(e,new t.R({width:1,height:1}),e.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(e.gl.NEAREST,e.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=t.ao([])}const i=this.sourceCache.getSourceTile(e,!0);if(i&&i.dem&&(!i.demTexture||i.needsTerrainPrepare)){const t=this.painter.context;i.demTexture=this.painter.getTileTexture(i.dem.stride),i.demTexture?i.demTexture.update(i.dem.getPixels(),{premultiply:!1}):i.demTexture=new y(t,i.dem.getPixels(),t.gl.RGBA,{premultiply:!1}),i.demTexture.bind(t.gl.NEAREST,t.gl.CLAMP_TO_EDGE),i.needsTerrainPrepare=!1}const r=i&&i+i.tileID.key+e.key;if(r&&!this._demMatrixCache[r]){const r=this.sourceCache.sourceCache._source.maxzoom;let n=e.canonical.z-i.tileID.canonical.z;e.overscaledZ>e.canonical.z&&(e.canonical.z>=r?n=e.canonical.z-r:t.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const o=e.canonical.x-(e.canonical.x>>n<<n),s=e.canonical.y-(e.canonical.y>>n<<n),a=t.bc(new Float64Array(16),[1/(t.N<<n),1/(t.N<<n),0]);t.$(a,a,[o*t.N,s*t.N,0]),this._demMatrixCache[e.key]={matrix:a,coord:e}}return{u_depth:2,u_terrain:3,u_terrain_dim:i&&i.dem&&i.dem.dim||1,u_terrain_matrix:r?this._demMatrixCache[e.key].matrix:this._emptyDemMatrix,u_terrain_unpack:i&&i.dem&&i.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(i&&i.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:i}}getFramebuffer(t){const e=this.painter,i=e.width/devicePixelRatio,r=e.height/devicePixelRatio;return!this._fbo||this._fbo.width===i&&this._fbo.height===r||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new y(e.context,{width:i,height:r,data:null},e.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(e.context.gl.NEAREST,e.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new y(e.context,{width:i,height:r,data:null},e.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(e.context.gl.NEAREST,e.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=e.context.createFramebuffer(i,r,!0,!1),this._fbo.depthAttachment.set(e.context.createRenderbuffer(e.context.gl.DEPTH_COMPONENT16,i,r))),this._fbo.colorAttachment.set("coords"===t?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const e=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const i=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let t=0,e=0;t<this._coordsTextureSize;t++)for(let r=0;r<this._coordsTextureSize;r++,e+=4)i[e+0]=255&r,i[e+1]=255&t,i[e+2]=r>>8<<4|t>>8,i[e+3]=0;const r=new t.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(i.buffer)),n=new y(e,r,e.gl.RGBA,{premultiply:!1});return n.bind(e.gl.NEAREST,e.gl.CLAMP_TO_EDGE),this._coordsTexture=n,n}pointCoordinate(e){const i=new Uint8Array(4),r=this.painter.context,n=r.gl;r.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),n.readPixels(e.x,this.painter.height/devicePixelRatio-e.y-1,1,1,n.RGBA,n.UNSIGNED_BYTE,i),r.bindFramebuffer.set(null);const o=i[0]+(i[2]>>4<<8),s=i[1]+((15&i[2])<<8),a=this.coordsIndex[255-i[3]],l=a&&this.sourceCache.getTileByID(a);if(!l)return null;const c=this._coordsTextureSize,u=(1<<l.tileID.canonical.z)*c;return new t.U(this._allowMercatorOverflow(e,(l.tileID.canonical.x*c+o)/u),(l.tileID.canonical.y*c+s)/u,this.getElevation(l.tileID,o,s,c))}getTerrainMesh(){if(this._mesh)return this._mesh;const e=this.painter.context,i=new t.bd,r=new t.b0,n=this.meshSize,o=t.N/n,s=n*n;for(let t=0;t<=n;t++)for(let e=0;e<=n;e++)i.emplaceBack(e*o,t*o,0);for(let t=0;t<s;t+=n+1)for(let e=0;e<n;e++)r.emplaceBack(e+t,n+e+t+1,n+e+t+2),r.emplaceBack(e+t,n+e+t+2,e+t+1);const a=i.length,l=a+2*(n+1);for(const e of[0,1])for(let r=0;r<=n;r++)for(const n of[0,1])i.emplaceBack(r*o,e*t.N,n);for(let t=0;t<2*n;t+=2)r.emplaceBack(l+t,l+t+1,l+t+3),r.emplaceBack(l+t,l+t+3,l+t+2),r.emplaceBack(a+t,a+t+3,a+t+1),r.emplaceBack(a+t,a+t+2,a+t+3);const c=i.length,u=c+2*(n+1);for(const e of[0,1])for(let r=0;r<=n;r++)for(const n of[0,1])i.emplaceBack(e*t.N,r*o,n);for(let t=0;t<2*n;t+=2)r.emplaceBack(c+t,c+t+1,c+t+3),r.emplaceBack(c+t,c+t+3,c+t+2),r.emplaceBack(u+t,u+t+3,u+t+1),r.emplaceBack(u+t,u+t+2,u+t+3);return this._mesh={indexBuffer:e.createIndexBuffer(r),vertexBuffer:e.createVertexBuffer(i,hn.members),segments:t.S.simpleSegment(0,0,i.length,r.length)},this._mesh}getMeshFrameDelta(e){return 2*Math.PI*t.be/Math.pow(2,e)/5}getMinTileElevationForLngLatZoom(t,e){var i;const{tileID:r}=this._getOverscaledTileIDFromLngLatZoom(t,e);return null!==(i=this.getMinMaxElevation(r).minElevation)&&void 0!==i?i:0}getMinMaxElevation(t){const e=this.getTerrainData(t).tile,i={minElevation:null,maxElevation:null};return e&&e.dem&&(i.minElevation=e.dem.min*this.exaggeration,i.maxElevation=e.dem.max*this.exaggeration),i}_getOverscaledTileIDFromLngLatZoom(e,i){const r=t.U.fromLngLat(e.wrap()),n=(1<<i)*t.N,o=r.x*n,s=r.y*n,a=Math.floor(o/t.N),l=Math.floor(s/t.N);return{tileID:new t.O(i,0,i,a,l),mercatorX:o,mercatorY:s}}_allowMercatorOverflow(e,i){const r=e.x<this.painter.width/2;let n=t.bf(i);const o=this.painter.transform.center.lng;return r&&Math.sign(n)>0&&Math.sign(o)<0||!r&&Math.sign(n)<0&&Math.sign(o)>0?(n=360*Math.sign(o)+n,t.G(n)):i}}class fn{constructor(t,e,i){this._context=t,this._size=e,this._tileSize=i,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const t of this._objects)t.texture.destroy(),t.fbo.destroy()}_createObject(t){const e=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),i=new y(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return i.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),e.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),e.colorAttachment.set(i.texture),{id:t,fbo:e,texture:i,stamp:-1,inUse:!1}}getObjectForId(t){return this._objects[t]}useObject(t){t.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter((e=>t.id!==e)),this._recentlyUsed.push(t.id)}stampObject(t){t.stamp=++this._stamp}getOrCreateFreeObject(){for(const t of this._recentlyUsed)if(!this._objects[t].inUse)return this._objects[t];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const t=this._createObject(this._objects.length);return this._objects.push(t),t}freeObject(t){t.inUse=!1}freeAllObjects(){for(const t of this._objects)this.freeObject(t)}isFull(){return!(this._objects.length<this._size)&&!1===this._objects.some((t=>!t.inUse))}}const An={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class mn{constructor(t,e){this.painter=t,this.terrain=e,this.pool=new fn(t.context,30,e.sourceCache.tileSize*e.qualityFactor)}destruct(){this.pool.destruct()}getTexture(t){return this.pool.getObjectForId(t.rtt[this._stacks.length-1].id).texture}prepareForRender(t,e){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=t._order.filter((i=>!t._layers[i].isHidden(e))),this._coordsDescendingInv={};for(const e in t.sourceCaches){this._coordsDescendingInv[e]={};const i=t.sourceCaches[e].getVisibleCoordinates();for(const t of i){const i=this.terrain.sourceCache.getTerrainCoords(t);for(const t in i)this._coordsDescendingInv[e][t]||(this._coordsDescendingInv[e][t]=[]),this._coordsDescendingInv[e][t].push(i[t])}}this._coordsDescendingInvStr={};for(const e of t._order){const i=t._layers[e],r=i.source;if(An[i.type]&&!this._coordsDescendingInvStr[r]){this._coordsDescendingInvStr[r]={};for(const t in this._coordsDescendingInv[r])this._coordsDescendingInvStr[r][t]=this._coordsDescendingInv[r][t].map((t=>t.key)).sort().join()}}for(const t of this._renderableTiles)for(const e in this._coordsDescendingInvStr){const i=this._coordsDescendingInvStr[e][t.tileID.key];i&&i!==t.rttCoords[e]&&(t.rtt=[])}}renderLayer(e){if(e.isHidden(this.painter.transform.zoom))return!1;const i=e.type,r=this.painter,n=this._renderableLayerIds[this._renderableLayerIds.length-1]===e.id;if(An[i]&&(this._prevType&&An[this._prevType]||this._stacks.push([]),this._prevType=i,this._stacks[this._stacks.length-1].push(e.id),!n))return!0;if(An[this._prevType]||An[i]&&n){this._prevType=i;const e=this._stacks.length-1,n=this._stacks[e]||[];for(const i of this._renderableTiles){if(this.pool.isFull()&&(er(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(i),i.rtt[e]){const t=this.pool.getObjectForId(i.rtt[e].id);if(t.stamp===i.rtt[e].stamp){this.pool.useObject(t);continue}}const o=this.pool.getOrCreateFreeObject();this.pool.useObject(o),this.pool.stampObject(o),i.rtt[e]={id:o.id,stamp:o.stamp},r.context.bindFramebuffer.set(o.fbo.framebuffer),r.context.clear({color:t.aT.transparent,stencil:0}),r.currentStencilSource=void 0;for(let t=0;t<n.length;t++){const e=r.style._layers[n[t]],s=e.source?this._coordsDescendingInv[e.source][i.tileID.key]:[i.tileID];r.context.viewport.set([0,0,o.fbo.width,o.fbo.height]),r._renderTileClippingMasks(e,s),r.renderLayer(r,r.style.sourceCaches[e.source],e,s),e.source&&(i.rttCoords[e.source]=this._coordsDescendingInvStr[e.source][i.tileID.key])}}return er(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),An[i]}return!1}}const gn=e,_n={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:void 0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:t.c.MAX_TILE_CACHE_ZOOM_LEVELS,localIdeographFontFamily:"sans-serif",transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,validateStyle:!0,maxCanvasSize:[4096,4096]},yn=t=>{t.touchstart=t.dragStart,t.touchmoveWindow=t.dragMove,t.touchend=t.dragEnd},vn={showCompass:!0,showZoom:!0,visualizePitch:!1};class xn{constructor(e,r,n=!1){this.mousedown=e=>{this.startMouse(t.e({},e,{ctrlKey:!0,preventDefault:()=>e.preventDefault()}),i.mousePos(this.element,e)),i.addEventListener(window,"mousemove",this.mousemove),i.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=t=>{this.moveMouse(t,i.mousePos(this.element,t))},this.mouseup=t=>{this.mouseRotate.dragEnd(t),this.mousePitch&&this.mousePitch.dragEnd(t),this.offTemp()},this.touchstart=t=>{1!==t.targetTouches.length?this.reset():(this._startPos=this._lastPos=i.touchPos(this.element,t.targetTouches)[0],this.startTouch(t,this._startPos),i.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),i.addEventListener(window,"touchend",this.touchend))},this.touchmove=t=>{1!==t.targetTouches.length?this.reset():(this._lastPos=i.touchPos(this.element,t.targetTouches)[0],this.moveTouch(t,this._lastPos))},this.touchend=t=>{0===t.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const o=e.dragRotate._mouseRotate.getClickTolerance(),s=e.dragRotate._mousePitch.getClickTolerance();this.element=r,this.mouseRotate=Lr({clickTolerance:o,enable:!0}),this.touchRotate=(({enable:t,clickTolerance:e,bearingDegreesPerPixelMoved:i=.8})=>{const r=new kr;return new Sr({clickTolerance:e,move:(t,e)=>({bearingDelta:(e.x-t.x)*i}),moveStateManager:r,enable:t,assignEvents:yn})})({clickTolerance:o,enable:!0}),this.map=e,n&&(this.mousePitch=zr({clickTolerance:s,enable:!0}),this.touchPitch=(({enable:t,clickTolerance:e,pitchDegreesPerPixelMoved:i=-.5})=>{const r=new kr;return new Sr({clickTolerance:e,move:(t,e)=>({pitchDelta:(e.y-t.y)*i}),moveStateManager:r,enable:t,assignEvents:yn})})({clickTolerance:s,enable:!0})),i.addEventListener(r,"mousedown",this.mousedown),i.addEventListener(r,"touchstart",this.touchstart,{passive:!1}),i.addEventListener(r,"touchcancel",this.reset)}startMouse(t,e){this.mouseRotate.dragStart(t,e),this.mousePitch&&this.mousePitch.dragStart(t,e),i.disableDrag()}startTouch(t,e){this.touchRotate.dragStart(t,e),this.touchPitch&&this.touchPitch.dragStart(t,e),i.disableDrag()}moveMouse(t,e){const i=this.map,{bearingDelta:r}=this.mouseRotate.dragMove(t,e)||{};if(r&&i.setBearing(i.getBearing()+r),this.mousePitch){const{pitchDelta:r}=this.mousePitch.dragMove(t,e)||{};r&&i.setPitch(i.getPitch()+r)}}moveTouch(t,e){const i=this.map,{bearingDelta:r}=this.touchRotate.dragMove(t,e)||{};if(r&&i.setBearing(i.getBearing()+r),this.touchPitch){const{pitchDelta:r}=this.touchPitch.dragMove(t,e)||{};r&&i.setPitch(i.getPitch()+r)}}off(){const t=this.element;i.removeEventListener(t,"mousedown",this.mousedown),i.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),i.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),i.removeEventListener(window,"touchend",this.touchend),i.removeEventListener(t,"touchcancel",this.reset),this.offTemp()}offTemp(){i.enableDrag(),i.removeEventListener(window,"mousemove",this.mousemove),i.removeEventListener(window,"mouseup",this.mouseup),i.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),i.removeEventListener(window,"touchend",this.touchend)}}let bn;function wn(e,i,r){if(e=new t.L(e.lng,e.lat),i){const n=new t.L(e.lng-360,e.lat),o=new t.L(e.lng+360,e.lat),s=r.locationPoint(e).distSqr(i);r.locationPoint(n).distSqr(i)<s?e=n:r.locationPoint(o).distSqr(i)<s&&(e=o)}for(;Math.abs(e.lng-r.center.lng)>180;){const t=r.locationPoint(e);if(t.x>=0&&t.y>=0&&t.x<=r.width&&t.y<=r.height)break;e.lng>r.center.lng?e.lng-=360:e.lng+=360}return e}const Tn={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Bn(t,e,i){const r=t.classList;for(const t in Tn)r.remove(`maplibregl-${i}-anchor-${t}`);r.add(`maplibregl-${i}-anchor-${e}`)}class En extends t.E{constructor(e){if(super(),this._onKeyPress=t=>{const e=t.code,i=t.charCode||t.keyCode;"Space"!==e&&"Enter"!==e&&32!==i&&13!==i||this.togglePopup()},this._onMapClick=t=>{const e=t.originalEvent.target,i=this._element;this._popup&&(e===i||i.contains(e))&&this.togglePopup()},this._update=t=>{if(!this._map)return;const e=this._map.loaded()&&!this._map.isMoving();("terrain"===(null==t?void 0:t.type)||"render"===(null==t?void 0:t.type)&&!e)&&this._map.once("render",this._update),this._map.transform.renderWorldCopies&&(this._lngLat=wn(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);let r="";"viewport"===this._rotationAlignment||"auto"===this._rotationAlignment?r=`rotateZ(${this._rotation}deg)`:"map"===this._rotationAlignment&&(r=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let n="";"viewport"===this._pitchAlignment||"auto"===this._pitchAlignment?n="rotateX(0deg)":"map"===this._pitchAlignment&&(n=`rotateX(${this._map.getPitch()}deg)`),t&&"moveend"!==t.type||(this._pos=this._pos.round()),i.setTransform(this._element,`${Tn[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${n} ${r}`),this._map.terrain&&!this._opacityTimeout&&(this._opacityTimeout=setTimeout((()=>{const t=this._map.unproject(this._pos),e=40075016.686*Math.abs(Math.cos(this._lngLat.lat*Math.PI/180))/Math.pow(2,this._map.transform.tileZoom+8);this._element.style.opacity=t.distanceTo(this._lngLat)>20*e?"0.2":"1.0",this._opacityTimeout=null}),100))},this._onMove=e=>{if(!this._isDragging){const t=this._clickTolerance||this._map._clickTolerance;this._isDragging=e.point.dist(this._pointerdownPos)>=t}this._isDragging&&(this._pos=e.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new t.k("dragstart"))),this.fire(new t.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),"active"===this._state&&this.fire(new t.k("dragend")),this._state="inactive"},this._addDragHandler=t=>{this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(this._pos).add(this._offset),this._pointerdownPos=t.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&"auto"!==e.pitchAlignment?e.pitchAlignment:this._rotationAlignment,e&&e.element)this._element=e.element,this._offset=t.P.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=i.create("div"),this._element.setAttribute("aria-label","Map marker");const r=i.createNS("http://www.w3.org/2000/svg","svg"),n=41,o=27;r.setAttributeNS(null,"display","block"),r.setAttributeNS(null,"height",`${n}px`),r.setAttributeNS(null,"width",`${o}px`),r.setAttributeNS(null,"viewBox",`0 0 ${o} ${n}`);const s=i.createNS("http://www.w3.org/2000/svg","g");s.setAttributeNS(null,"stroke","none"),s.setAttributeNS(null,"stroke-width","1"),s.setAttributeNS(null,"fill","none"),s.setAttributeNS(null,"fill-rule","evenodd");const a=i.createNS("http://www.w3.org/2000/svg","g");a.setAttributeNS(null,"fill-rule","nonzero");const l=i.createNS("http://www.w3.org/2000/svg","g");l.setAttributeNS(null,"transform","translate(3.0, 29.0)"),l.setAttributeNS(null,"fill","#000000");const c=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const t of c){const e=i.createNS("http://www.w3.org/2000/svg","ellipse");e.setAttributeNS(null,"opacity","0.04"),e.setAttributeNS(null,"cx","10.5"),e.setAttributeNS(null,"cy","5.80029008"),e.setAttributeNS(null,"rx",t.rx),e.setAttributeNS(null,"ry",t.ry),l.appendChild(e)}const u=i.createNS("http://www.w3.org/2000/svg","g");u.setAttributeNS(null,"fill",this._color);const h=i.createNS("http://www.w3.org/2000/svg","path");h.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),u.appendChild(h);const d=i.createNS("http://www.w3.org/2000/svg","g");d.setAttributeNS(null,"opacity","0.25"),d.setAttributeNS(null,"fill","#000000");const p=i.createNS("http://www.w3.org/2000/svg","path");p.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),d.appendChild(p);const f=i.createNS("http://www.w3.org/2000/svg","g");f.setAttributeNS(null,"transform","translate(6.0, 7.0)"),f.setAttributeNS(null,"fill","#FFFFFF");const A=i.createNS("http://www.w3.org/2000/svg","g");A.setAttributeNS(null,"transform","translate(8.0, 8.0)");const m=i.createNS("http://www.w3.org/2000/svg","circle");m.setAttributeNS(null,"fill","#000000"),m.setAttributeNS(null,"opacity","0.25"),m.setAttributeNS(null,"cx","5.5"),m.setAttributeNS(null,"cy","5.5"),m.setAttributeNS(null,"r","5.4999962");const g=i.createNS("http://www.w3.org/2000/svg","circle");g.setAttributeNS(null,"fill","#FFFFFF"),g.setAttributeNS(null,"cx","5.5"),g.setAttributeNS(null,"cy","5.5"),g.setAttributeNS(null,"r","5.4999962"),A.appendChild(m),A.appendChild(g),a.appendChild(l),a.appendChild(u),a.appendChild(d),a.appendChild(f),a.appendChild(A),r.appendChild(a),r.setAttributeNS(null,"height",n*this._scale+"px"),r.setAttributeNS(null,"width",o*this._scale+"px"),this._element.appendChild(r),this._offset=t.P.convert(e&&e.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",(t=>{t.preventDefault()})),this._element.addEventListener("mousedown",(t=>{t.preventDefault()})),Bn(this._element,this._anchor,"marker"),e&&e.className)for(const t of e.className.split(" "))this._element.classList.add(t);this._popup=null}addTo(t){return this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),t.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),i.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=t.L.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const e=38.1,i=13.5,r=Math.abs(i)/Math.SQRT2;t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-e],"bottom-left":[r,-1*(e-i+r)],"bottom-right":[-r,-1*(e-i+r)],left:[i,-1*(e-i)],right:[-i,-1*(e-i)]}:this._offset}this._popup=t,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?t.remove():t.addTo(this._map),this):this}getOffset(){return this._offset}setOffset(e){return this._offset=t.P.convert(e),this._update(),this}addClassName(t){this._element.classList.add(t)}removeClassName(t){this._element.classList.remove(t)}toggleClassName(t){return this._element.classList.toggle(t)}setDraggable(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t&&"auto"!==t?t:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}const Cn={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Sn=0,In=!1;const Mn={maxWidth:100,unit:"metric"};function kn(t,e,i){const r=i&&i.maxWidth||100,n=t._container.clientHeight/2,o=t.unproject([0,n]),s=t.unproject([r,n]),a=o.distanceTo(s);if(i&&"imperial"===i.unit){const i=3.2808*a;i>5280?Pn(e,r,i/5280,t._getUIString("ScaleControl.Miles")):Pn(e,r,i,t._getUIString("ScaleControl.Feet"))}else i&&"nautical"===i.unit?Pn(e,r,a/1852,t._getUIString("ScaleControl.NauticalMiles")):a>=1e3?Pn(e,r,a/1e3,t._getUIString("ScaleControl.Kilometers")):Pn(e,r,a,t._getUIString("ScaleControl.Meters"))}function Pn(t,e,i,r){const n=function(t){const e=Math.pow(10,`${Math.floor(t)}`.length-1);let i=t/e;return i=i>=10?10:i>=5?5:i>=3?3:i>=2?2:i>=1?1:function(t){const e=Math.pow(10,Math.ceil(-Math.log(t)/Math.LN10));return Math.round(t*e)/e}(i),e*i}(i);t.style.width=e*(n/i)+"px",t.innerHTML=`${n}&nbsp;${r}`}const Ln={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},zn=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Fn(e){if(e){if("number"==typeof e){const i=Math.round(Math.abs(e)/Math.SQRT2);return{center:new t.P(0,0),top:new t.P(0,e),"top-left":new t.P(i,i),"top-right":new t.P(-i,i),bottom:new t.P(0,-e),"bottom-left":new t.P(i,-i),"bottom-right":new t.P(-i,-i),left:new t.P(e,0),right:new t.P(-e,0)}}if(e instanceof t.P||Array.isArray(e)){const i=t.P.convert(e);return{center:i,top:i,"top-left":i,"top-right":i,bottom:i,"bottom-left":i,"bottom-right":i,left:i,right:i}}return{center:t.P.convert(e.center||[0,0]),top:t.P.convert(e.top||[0,0]),"top-left":t.P.convert(e["top-left"]||[0,0]),"top-right":t.P.convert(e["top-right"]||[0,0]),bottom:t.P.convert(e.bottom||[0,0]),"bottom-left":t.P.convert(e["bottom-left"]||[0,0]),"bottom-right":t.P.convert(e["bottom-right"]||[0,0]),left:t.P.convert(e.left||[0,0]),right:t.P.convert(e.right||[0,0])}}return Fn(new t.P(0,0))}const Dn={extend:(e,...i)=>t.e(e,...i),run(t){t()},logToElement(t,e=!1,i="log"){const r=window.document.getElementById(i);r&&(e&&(r.innerHTML=""),r.innerHTML+=`<br>${t}`)}},Rn=e;class Un{static get version(){return Rn}static get workerCount(){return tt.workerCount}static set workerCount(t){tt.workerCount=t}static get maxParallelImageRequests(){return t.c.MAX_PARALLEL_IMAGE_REQUESTS}static set maxParallelImageRequests(e){t.c.MAX_PARALLEL_IMAGE_REQUESTS=e}static get workerUrl(){return t.c.WORKER_URL}static set workerUrl(e){t.c.WORKER_URL=e}static addProtocol(e,i){t.c.REGISTERED_PROTOCOLS[e]=i}static removeProtocol(e){delete t.c.REGISTERED_PROTOCOLS[e]}}return Un.Map=class extends sn{constructor(e){if(t.bg.mark(t.bh.create),null!=(e=t.e({},_n,e)).minZoom&&null!=e.maxZoom&&e.minZoom>e.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=e.minPitch&&null!=e.maxPitch&&e.minPitch>e.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=e.minPitch&&e.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=e.maxPitch&&e.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new sr(e.minZoom,e.maxZoom,e.minPitch,e.maxPitch,e.renderWorldCopies),{bearingSnap:e.bearingSnap}),this._cooperativeGesturesOnWheel=t=>{this._onCooperativeGesture(t,t[this._metaKey],1)},this._contextLost=e=>{e.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new t.k("webglcontextlost",{originalEvent:e}))},this._contextRestored=e=>{this._setupPainter(),this.resize(),this._update(),this.fire(new t.k("webglcontextrestored",{originalEvent:e}))},this._onMapScroll=t=>{if(t.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=e.interactive,this._cooperativeGestures=e.cooperativeGestures,this._metaKey=0===navigator.platform.indexOf("Mac")?"metaKey":"ctrlKey",this._maxTileCacheSize=e.maxTileCacheSize,this._maxTileCacheZoomLevels=e.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=e.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=e.preserveDrawingBuffer,this._antialias=e.antialias,this._trackResize=e.trackResize,this._bearingSnap=e.bearingSnap,this._refreshExpiredTiles=e.refreshExpiredTiles,this._fadeDuration=e.fadeDuration,this._crossSourceCollisions=e.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=e.collectResourceTiming,this._renderTaskQueue=new cn,this._controls=[],this._mapId=t.a2(),this._locale=t.e({},un,e.locale),this._clickTolerance=e.clickTolerance,this._overridePixelRatio=e.pixelRatio,this._maxCanvasSize=e.maxCanvasSize,this.transformCameraUpdate=e.transformCameraUpdate,this._imageQueueHandle=c.addThrottleControl((()=>this.isMoving())),this._requestManager=new h(e.transformRequest),"string"==typeof e.container){if(this._container=document.getElementById(e.container),!this._container)throw new Error(`Container '${e.container}' not found.`)}else{if(!(e.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=e.container}if(e.maxBounds&&this.setMaxBounds(e.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),this.on("terrain",(()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)})),this.once("idle",(()=>{this._idleTriggered=!0})),"undefined"!=typeof window){addEventListener("online",this._onWindowOnline,!1);let t=!1;const e=ar((t=>{this._trackResize&&!this._removed&&this.resize(t)._update()}),50);this._resizeObserver=new ResizeObserver((i=>{t?e(i):t=!0})),this._resizeObserver.observe(this._container)}this.handlers=new on(this,e),this._cooperativeGestures&&this._setupCooperativeGestures(),this._hash=e.hash&&new lr("string"==typeof e.hash&&e.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:e.center,zoom:e.zoom,bearing:e.bearing,pitch:e.pitch}),e.bounds&&(this.resize(),this.fitBounds(e.bounds,t.e({},e.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=e.localIdeographFontFamily,this._validateStyle=e.validateStyle,e.style&&this.setStyle(e.style,{localIdeographFontFamily:e.localIdeographFontFamily}),e.attributionControl&&this.addControl(new an({customAttribution:e.customAttribution})),e.maplibreLogo&&this.addControl(new ln,e.logoPosition),this.on("style.load",(()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)})),this.on("data",(e=>{this._update("style"===e.dataType),this.fire(new t.k(`${e.dataType}data`,e))})),this.on("dataloading",(e=>{this.fire(new t.k(`${e.dataType}dataloading`,e))})),this.on("dataabort",(e=>{this.fire(new t.k("sourcedataabort",e))}))}_getMapId(){return this._mapId}addControl(e,i){if(void 0===i&&(i=e.getDefaultPosition?e.getDefaultPosition():"top-right"),!e||!e.onAdd)return this.fire(new t.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const r=e.onAdd(this);this._controls.push(e);const n=this._controlPositions[i];return-1!==i.indexOf("bottom")?n.insertBefore(r,n.firstChild):n.appendChild(r),this}removeControl(e){if(!e||!e.onRemove)return this.fire(new t.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const i=this._controls.indexOf(e);return i>-1&&this._controls.splice(i,1),e.onRemove(this),this}hasControl(t){return this._controls.indexOf(t)>-1}calculateCameraOptionsFromTo(t,e,i,r){return null==r&&this.terrain&&(r=this.terrain.getElevationForLngLatZoom(i,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(t,e,i,r)}resize(e){var i;const r=this._containerDimensions(),n=r[0],o=r[1],s=this._getClampedPixelRatio(n,o);if(this._resizeCanvas(n,o,s),this.painter.resize(n,o,s),this.painter.overLimit()){const t=this.painter.context.gl;this._maxCanvasSize=[t.drawingBufferWidth,t.drawingBufferHeight];const e=this._getClampedPixelRatio(n,o);this._resizeCanvas(n,o,e),this.painter.resize(n,o,e)}this.transform.resize(n,o),null===(i=this._requestedCameraState)||void 0===i||i.resize(n,o);const a=!this._moving;return a&&(this.stop(),this.fire(new t.k("movestart",e)).fire(new t.k("move",e))),this.fire(new t.k("resize",e)),a&&this.fire(new t.k("moveend",e)),this}_getClampedPixelRatio(t,e){const{0:i,1:r}=this._maxCanvasSize,n=this.getPixelRatio(),o=t*n,s=e*n;return Math.min(o>i?i/o:1,s>r?r/s:1)*n}getPixelRatio(){var t;return null!==(t=this._overridePixelRatio)&&void 0!==t?t:devicePixelRatio}setPixelRatio(t){this._overridePixelRatio=t,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(t){return this.transform.setMaxBounds(P.convert(t)),this._update()}setMinZoom(t){if((t=null==t?-2:t)>=-2&&t<=this.transform.maxZoom)return this.transform.minZoom=t,this._update(),this.getZoom()<t&&this.setZoom(t),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(t){if((t=null==t?22:t)>=this.transform.minZoom)return this.transform.maxZoom=t,this._update(),this.getZoom()>t&&this.setZoom(t),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(t){if((t=null==t?0:t)<0)throw new Error("minPitch must be greater than or equal to 0");if(t>=0&&t<=this.transform.maxPitch)return this.transform.minPitch=t,this._update(),this.getPitch()<t&&this.setPitch(t),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(t){if((t=null==t?60:t)>85)throw new Error("maxPitch must be less than or equal to 85");if(t>=this.transform.minPitch)return this.transform.maxPitch=t,this._update(),this.getPitch()>t&&this.setPitch(t),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(t){return this.transform.renderWorldCopies=t,this._update()}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(t){return this._cooperativeGestures=t,this._cooperativeGestures?this._setupCooperativeGestures():this._destroyCooperativeGestures(),this}project(e){return this.transform.locationPoint(t.L.convert(e),this.style&&this.terrain)}unproject(e){return this.transform.pointLocation(t.P.convert(e),this.terrain)}isMoving(){var t;return this._moving||(null===(t=this.handlers)||void 0===t?void 0:t.isMoving())}isZooming(){var t;return this._zooming||(null===(t=this.handlers)||void 0===t?void 0:t.isZooming())}isRotating(){var t;return this._rotating||(null===(t=this.handlers)||void 0===t?void 0:t.isRotating())}_createDelegatedListener(t,e,i){if("mouseenter"===t||"mouseover"===t){let r=!1;const n=n=>{const o=this.getLayer(e)?this.queryRenderedFeatures(n.point,{layers:[e]}):[];o.length?r||(r=!0,i.call(this,new gr(t,this,n.originalEvent,{features:o}))):r=!1};return{layer:e,listener:i,delegates:{mousemove:n,mouseout:()=>{r=!1}}}}if("mouseleave"===t||"mouseout"===t){let r=!1;const n=n=>{(this.getLayer(e)?this.queryRenderedFeatures(n.point,{layers:[e]}):[]).length?r=!0:r&&(r=!1,i.call(this,new gr(t,this,n.originalEvent)))},o=e=>{r&&(r=!1,i.call(this,new gr(t,this,e.originalEvent)))};return{layer:e,listener:i,delegates:{mousemove:n,mouseout:o}}}{const r=t=>{const r=this.getLayer(e)?this.queryRenderedFeatures(t.point,{layers:[e]}):[];r.length&&(t.features=r,i.call(this,t),delete t.features)};return{layer:e,listener:i,delegates:{[t]:r}}}}on(t,e,i){if(void 0===i)return super.on(t,e);const r=this._createDelegatedListener(t,e,i);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[t]=this._delegatedListeners[t]||[],this._delegatedListeners[t].push(r);for(const t in r.delegates)this.on(t,r.delegates[t]);return this}once(t,e,i){if(void 0===i)return super.once(t,e);const r=this._createDelegatedListener(t,e,i);for(const t in r.delegates)this.once(t,r.delegates[t]);return this}off(t,e,i){return void 0===i?super.off(t,e):(this._delegatedListeners&&this._delegatedListeners[t]&&(r=>{const n=this._delegatedListeners[t];for(let t=0;t<n.length;t++){const r=n[t];if(r.layer===e&&r.listener===i){for(const t in r.delegates)this.off(t,r.delegates[t]);return n.splice(t,1),this}}})(),this)}queryRenderedFeatures(e,i){if(!this.style)return[];let r;const n=e instanceof t.P||Array.isArray(e),o=n?e:[[0,0],[this.transform.width,this.transform.height]];if(i=i||(n?{}:e)||{},o instanceof t.P||"number"==typeof o[0])r=[t.P.convert(o)];else{const e=t.P.convert(o[0]),i=t.P.convert(o[1]);r=[e,new t.P(i.x,e.y),i,new t.P(e.x,i.y),e]}return this.style.queryRenderedFeatures(r,i,this.transform)}querySourceFeatures(t,e){return this.style.querySourceFeatures(t,e)}setStyle(e,i){return!1!==(i=t.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},i)).diff&&i.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&e?(this._diffStyle(e,i),this):(this._localIdeographFontFamily=i.localIdeographFontFamily,this._updateStyle(e,i))}setTransformRequest(t){return this._requestManager.setTransformRequest(t),this}_getUIString(t){const e=this._locale[t];if(null==e)throw new Error(`Missing UI string '${t}'`);return e}_updateStyle(t,e){if(e.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",(()=>this._updateStyle(t,e)));const i=this.style&&e.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!t)),t?(this.style=new re(this,e||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof t?this.style.loadURL(t,e,i):this.style.loadJSON(t,e,i),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new re(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(e,i){if("string"==typeof e){const r=this._requestManager.transformRequest(e,u.Style);t.f(r,((e,r)=>{e?this.fire(new t.j(e)):r&&this._updateDiff(r,i)}))}else"object"==typeof e&&this._updateDiff(e,i)}_updateDiff(e,i){try{this.style.setState(e,i)&&this._update(!0)}catch(r){t.w(`Unable to perform style diff: ${r.message||r.error||r}.  Rebuilding the style from scratch.`),this._updateStyle(e,i)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():t.w("There is no style added to the map.")}addSource(t,e){return this._lazyInitEmptyStyle(),this.style.addSource(t,e),this._update(!0)}isSourceLoaded(e){const i=this.style&&this.style.sourceCaches[e];if(void 0!==i)return i.loaded();this.fire(new t.j(new Error(`There is no source with ID '${e}'`)))}setTerrain(e){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),e){const i=this.style.sourceCaches[e.source];if(!i)throw new Error(`cannot load terrain, because there exists no source with ID: ${e.source}`);for(const i in this.style._layers){const r=this.style._layers[i];"hillshade"===r.type&&r.source===e.source&&t.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new pn(this.painter,i,e),this.painter.renderToTexture=new mn(this.painter,this.terrain),this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=t=>{"style"===t.dataType?this.terrain.sourceCache.freeRtt():"source"===t.dataType&&t.tile&&(t.sourceId!==e.source||this._elevationFreeze||(this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(t.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform._minEleveationForCurrentTile=0,this.transform.elevation=0;return this.fire(new t.k("terrain",{terrain:e})),this}getTerrain(){var t,e;return null!==(e=null===(t=this.terrain)||void 0===t?void 0:t.options)&&void 0!==e?e:null}areTilesLoaded(){const t=this.style&&this.style.sourceCaches;for(const e in t){const i=t[e]._tiles;for(const t in i){const e=i[t];if("loaded"!==e.state&&"errored"!==e.state)return!1}}return!0}addSourceType(t,e,i){return this._lazyInitEmptyStyle(),this.style.addSourceType(t,e,i)}removeSource(t){return this.style.removeSource(t),this._update(!0)}getSource(t){return this.style.getSource(t)}addImage(e,i,r={}){const{pixelRatio:n=1,sdf:o=!1,stretchX:s,stretchY:a,content:l}=r;if(this._lazyInitEmptyStyle(),!(i instanceof HTMLImageElement||t.a(i))){if(void 0===i.width||void 0===i.height)return this.fire(new t.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:r,height:c,data:u}=i,h=i;return this.style.addImage(e,{data:new t.R({width:r,height:c},new Uint8Array(u)),pixelRatio:n,stretchX:s,stretchY:a,content:l,sdf:o,version:0,userImage:h}),h.onAdd&&h.onAdd(this,e),this}}{const{width:r,height:c,data:u}=t.h.getImageData(i);this.style.addImage(e,{data:new t.R({width:r,height:c},u),pixelRatio:n,stretchX:s,stretchY:a,content:l,sdf:o,version:0})}}updateImage(e,i){const r=this.style.getImage(e);if(!r)return this.fire(new t.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const n=i instanceof HTMLImageElement||t.a(i)?t.h.getImageData(i):i,{width:o,height:s,data:a}=n;if(void 0===o||void 0===s)return this.fire(new t.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(o!==r.data.width||s!==r.data.height)return this.fire(new t.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const l=!(i instanceof HTMLImageElement||t.a(i));return r.data.replace(a,l),this.style.updateImage(e,r),this}getImage(t){return this.style.getImage(t)}hasImage(e){return e?!!this.style.getImage(e):(this.fire(new t.j(new Error("Missing required image id"))),!1)}removeImage(t){this.style.removeImage(t)}loadImage(t,e){c.getImage(this._requestManager.transformRequest(t,u.Image),e)}listImages(){return this.style.listImages()}addLayer(t,e){return this._lazyInitEmptyStyle(),this.style.addLayer(t,e),this._update(!0)}moveLayer(t,e){return this.style.moveLayer(t,e),this._update(!0)}removeLayer(t){return this.style.removeLayer(t),this._update(!0)}getLayer(t){return this.style.getLayer(t)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(t,e,i){return this.style.setLayerZoomRange(t,e,i),this._update(!0)}setFilter(t,e,i={}){return this.style.setFilter(t,e,i),this._update(!0)}getFilter(t){return this.style.getFilter(t)}setPaintProperty(t,e,i,r={}){return this.style.setPaintProperty(t,e,i,r),this._update(!0)}getPaintProperty(t,e){return this.style.getPaintProperty(t,e)}setLayoutProperty(t,e,i,r={}){return this.style.setLayoutProperty(t,e,i,r),this._update(!0)}getLayoutProperty(t,e){return this.style.getLayoutProperty(t,e)}setGlyphs(t,e={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(t,e),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(t,e,i={}){return this._lazyInitEmptyStyle(),this.style.addSprite(t,e,i,(t=>{t||this._update(!0)})),this}removeSprite(t){return this._lazyInitEmptyStyle(),this.style.removeSprite(t),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(t,e={}){return this._lazyInitEmptyStyle(),this.style.setSprite(t,e,(t=>{t||this._update(!0)})),this}setLight(t,e={}){return this._lazyInitEmptyStyle(),this.style.setLight(t,e),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(t,e){return this.style.setFeatureState(t,e),this._update()}removeFeatureState(t,e){return this.style.removeFeatureState(t,e),this._update()}getFeatureState(t){return this.style.getFeatureState(t)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let t=0,e=0;return this._container&&(t=this._container.clientWidth||400,e=this._container.clientHeight||300),[t,e]}_setupContainer(){const t=this._container;t.classList.add("maplibregl-map");const e=this._canvasContainer=i.create("div","maplibregl-canvas-container",t);this._interactive&&e.classList.add("maplibregl-interactive"),this._canvas=i.create("canvas","maplibregl-canvas",e),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const r=this._containerDimensions(),n=this._getClampedPixelRatio(r[0],r[1]);this._resizeCanvas(r[0],r[1],n);const o=this._controlContainer=i.create("div","maplibregl-control-container",t),s=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((t=>{s[t]=i.create("div",`maplibregl-ctrl-${t} `,o)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_setupCooperativeGestures(){this._cooperativeGesturesScreen=i.create("div","maplibregl-cooperative-gesture-screen",this._container);let t="boolean"!=typeof this._cooperativeGestures&&this._cooperativeGestures.windowsHelpText?this._cooperativeGestures.windowsHelpText:"Use Ctrl + scroll to zoom the map";0===navigator.platform.indexOf("Mac")&&(t="boolean"!=typeof this._cooperativeGestures&&this._cooperativeGestures.macHelpText?this._cooperativeGestures.macHelpText:"Use  + scroll to zoom the map"),this._cooperativeGesturesScreen.innerHTML=`\n            <div class="maplibregl-desktop-message">${t}</div>\n            <div class="maplibregl-mobile-message">${"boolean"!=typeof this._cooperativeGestures&&this._cooperativeGestures.mobileHelpText?this._cooperativeGestures.mobileHelpText:"Use two fingers to move the map"}</div>\n        `,this._cooperativeGesturesScreen.setAttribute("aria-hidden","true"),this._canvasContainer.addEventListener("wheel",this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.add("maplibregl-cooperative-gestures")}_destroyCooperativeGestures(){i.remove(this._cooperativeGesturesScreen),this._canvasContainer.removeEventListener("wheel",this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.remove("maplibregl-cooperative-gestures")}_resizeCanvas(t,e,i){this._canvas.width=Math.floor(i*t),this._canvas.height=Math.floor(i*e),this._canvas.style.width=`${t}px`,this._canvas.style.height=`${e}px`}_setupPainter(){const t={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let e=null;this._canvas.addEventListener("webglcontextcreationerror",(i=>{e={requestedAttributes:t},i&&(e.statusMessage=i.statusMessage,e.type=i.type)}),{once:!0});const i=this._canvas.getContext("webgl2",t)||this._canvas.getContext("webgl",t);if(!i){const t="Failed to initialize WebGL";throw e?(e.message=t,new Error(JSON.stringify(e))):new Error(t)}this.painter=new ir(i,this.transform),r.testSupport(i)}_onCooperativeGesture(t,e,i){return!e&&i<2&&(this._cooperativeGesturesScreen.classList.add("maplibregl-show"),setTimeout((()=>{this._cooperativeGesturesScreen.classList.remove("maplibregl-show")}),100)),!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(t){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||t,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(t){return this._update(),this._renderTaskQueue.add(t)}_cancelRenderFrame(t){this._renderTaskQueue.remove(t)}_render(e){const i=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(e),this._removed)return;let r=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const e=this.transform.zoom,n=t.h.now();this.style.zoomHistory.update(e,n);const o=new t.a8(e,{now:n,fadeDuration:i,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),s=o.crossFadingFactor();1===s&&s===this._crossFadingFactor||(r=!0,this._crossFadingFactor=s),this.style.update(o)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform._minEleveationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,i,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:i,showPadding:this.showPadding}),this.fire(new t.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,t.bg.mark(t.bh.load),this.fire(new t.k("load"))),this.style&&(this.style.hasTransitions()||r)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const n=this._sourcesDirty||this._styleDirty||this._placementDirty;return n||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new t.k("idle")),!this._loaded||this._fullyLoaded||n||(this._fullyLoaded=!0,t.bg.mark(t.bh.fullLoad)),this}redraw(){return this.style&&(this._frame&&(this._frame.cancel(),this._frame=null),this._render(0)),this}remove(){var e;this._hash&&this._hash.remove();for(const t of this._controls)t.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),"undefined"!=typeof window&&removeEventListener("online",this._onWindowOnline,!1),c.removeThrottleControl(this._imageQueueHandle),null===(e=this._resizeObserver)||void 0===e||e.disconnect();const r=this.painter.context.gl.getExtension("WEBGL_lose_context");r&&r.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),i.remove(this._canvasContainer),i.remove(this._controlContainer),this._cooperativeGestures&&this._destroyCooperativeGestures(),this._container.classList.remove("maplibregl-map"),t.bg.clearMetrics(),this._removed=!0,this.fire(new t.k("remove"))}triggerRepaint(){this.style&&!this._frame&&(this._frame=t.h.frame((e=>{t.bg.frame(e),this._frame=null,this._render(e)})))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(t){this._showTileBoundaries!==t&&(this._showTileBoundaries=t,this._update())}get showPadding(){return!!this._showPadding}set showPadding(t){this._showPadding!==t&&(this._showPadding=t,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(t){this._showCollisionBoxes!==t&&(this._showCollisionBoxes=t,t?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(t){this._showOverdrawInspector!==t&&(this._showOverdrawInspector=t,this._update())}get repaint(){return!!this._repaint}set repaint(t){this._repaint!==t&&(this._repaint=t,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(t){this._vertices=t,this._update()}get version(){return gn}getCameraTargetElevation(){return this.transform.elevation}},Un.NavigationControl=class{constructor(e){this._updateZoomButtons=()=>{const t=this._map.getZoom(),e=t===this._map.getMaxZoom(),i=t===this._map.getMinZoom();this._zoomInButton.disabled=e,this._zoomOutButton.disabled=i,this._zoomInButton.setAttribute("aria-disabled",e.toString()),this._zoomOutButton.setAttribute("aria-disabled",i.toString())},this._rotateCompassArrow=()=>{const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=t},this._setButtonTitle=(t,e)=>{const i=this._map._getUIString(`NavigationControl.${e}`);t.title=i,t.setAttribute("aria-label",i)},this.options=t.e({},vn,e),this._container=i.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",(t=>t.preventDefault())),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",(t=>this._map.zoomIn({},{originalEvent:t}))),i.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",(t=>this._map.zoomOut({},{originalEvent:t}))),i.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",(t=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:t}):this._map.resetNorth({},{originalEvent:t})})),this._compassIcon=i.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(t){return this._map=t,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new xn(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){i.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(t,e){const r=i.create("button",t,this._container);return r.type="button",r.addEventListener("click",e),r}},Un.GeolocateControl=class extends t.E{constructor(e){super(),this._onSuccess=e=>{if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new t.k("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(e),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new t.k("geolocate",e)),this._finish()}},this._updateCamera=e=>{const i=new t.L(e.coords.longitude,e.coords.latitude),r=e.coords.accuracy,n=this._map.getBearing(),o=t.e({bearing:n},this.options.fitBoundsOptions),s=P.fromLngLat(i,r);this._map.fitBounds(s,o,{geolocateSource:!0})},this._updateMarker=e=>{if(e){const i=new t.L(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(i).addTo(this._map),this._userLocationDotMarker.setLngLat(i).addTo(this._map),this._accuracy=e.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=e=>{if(this._map){if(this.options.trackUserLocation)if(1===e.code){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=t,this._geolocateButton.setAttribute("aria-label",t),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===e.code&&In)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new t.k("error",e)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=e=>{if(this._map){if(this._container.addEventListener("contextmenu",(t=>t.preventDefault())),this._geolocateButton=i.create("button","maplibregl-ctrl-geolocate",this._container),i.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===e){t.w("Geolocation support is not available so the GeolocateControl will be disabled.");const e=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=e,this._geolocateButton.setAttribute("aria-label",e)}else{const t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=t,this._geolocateButton.setAttribute("aria-label",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=i.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new En({element:this._dotElement}),this._circleElement=i.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new En({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(e=>{e.geolocateSource||"ACTIVE_LOCK"!==this._watchState||e.originalEvent&&"resize"===e.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new t.k("trackuserlocationend")))}))}},this.options=t.e({},Cn,e)}onAdd(t){return this._map=t,this._container=i.create("div","maplibregl-ctrl maplibregl-ctrl-group"),function(t,e=!1){void 0===bn||e?void 0!==window.navigator.permissions?window.navigator.permissions.query({name:"geolocation"}).then((e=>{bn="denied"!==e.state,t(bn)})).catch((()=>{bn=!!window.navigator.geolocation,t(bn)})):(bn=!!window.navigator.geolocation,t(bn)):t(bn)}(this._setupUI),this._container}onRemove(){void 0!==this._geolocationWatchID&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),i.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Sn=0,In=!1}_isOutOfMapMaxBounds(t){const e=this._map.getMaxBounds(),i=t.coords;return e&&(i.longitude<e.getWest()||i.longitude>e.getEast()||i.latitude<e.getSouth()||i.latitude>e.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const t=this._map.getBounds(),e=t.getSouthEast(),i=t.getNorthEast(),r=e.distanceTo(i),n=Math.ceil(this._accuracy/(r/this._map._container.clientHeight)*2);this._circleElement.style.width=`${n}px`,this._circleElement.style.height=`${n}px`}trigger(){if(!this._setup)return t.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new t.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Sn--,In=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new t.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new t.k("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let t;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Sn++,Sn>1?(t={maximumAge:6e5,timeout:0},In=!0):(t=this.options.positionOptions,In=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,t)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},Un.AttributionControl=an,Un.LogoControl=ln,Un.ScaleControl=class{constructor(e){this._onMove=()=>{kn(this._map,this._container,this.options)},this.setUnit=t=>{this.options.unit=t,kn(this._map,this._container,this.options)},this.options=t.e({},Mn,e)}getDefaultPosition(){return"bottom-left"}onAdd(t){return this._map=t,this._container=i.create("div","maplibregl-ctrl maplibregl-ctrl-scale",t.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){i.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},Un.FullscreenControl=class extends t.E{constructor(e={}){super(),this._onFullscreenChange=()=>{(window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement)===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,e&&e.container&&(e.container instanceof HTMLElement?this._container=e.container:t.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(t){return this._map=t,this._container||(this._container=this._map.getContainer()),this._controlContainer=i.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){i.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const t=this._fullscreenButton=i.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);i.create("span","maplibregl-ctrl-icon",t).setAttribute("aria-hidden","true"),t.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const t=this._getTitle();this._fullscreenButton.setAttribute("aria-label",t),this._fullscreenButton.title=t}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new t.k("fullscreenstart")),this._map._cooperativeGestures&&(this._prevCooperativeGestures=this._map._cooperativeGestures,this._map.setCooperativeGestures())):(this.fire(new t.k("fullscreenend")),this._prevCooperativeGestures&&(this._map.setCooperativeGestures(this._prevCooperativeGestures),delete this._prevCooperativeGestures))}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},Un.TerrainControl=class{constructor(t){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.disableTerrain")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.enableTerrain"))},this.options=t}onAdd(t){return this._map=t,this._container=i.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=i.create("button","maplibregl-ctrl-terrain",this._container),i.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){i.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},Un.Popup=class extends t.E{constructor(e){super(),this.remove=()=>(this._content&&i.remove(this._content),this._container&&(i.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new t.k("close")),this),this._onMouseUp=t=>{this._update(t.point)},this._onMouseMove=t=>{this._update(t.point)},this._onDrag=t=>{this._update(t.point)},this._update=t=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=i.create("div","maplibregl-popup",this._map.getContainer()),this._tip=i.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const t of this.options.className.split(" "))this._container.classList.add(t);this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=wn(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!t)return;const e=this._pos=this._trackPointer&&t?t:this._map.project(this._lngLat);let r=this.options.anchor;const n=Fn(this.options.offset);if(!r){const t=this._container.offsetWidth,i=this._container.offsetHeight;let o;o=e.y+n.bottom.y<i?["top"]:e.y>this._map.transform.height-i?["bottom"]:[],e.x<t/2?o.push("left"):e.x>this._map.transform.width-t/2&&o.push("right"),r=0===o.length?"bottom":o.join("-")}const o=e.add(n[r]).round();i.setTransform(this._container,`${Tn[r]} translate(${o.x}px,${o.y}px)`),Bn(this._container,r,"popup")},this._onClose=()=>{this.remove()},this.options=t.e(Object.create(Ln),e)}addTo(e){return this._map&&this.remove(),this._map=e,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new t.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=t.L.convert(e),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(t){return this.setDOMContent(document.createTextNode(t))}setHTML(t){const e=document.createDocumentFragment(),i=document.createElement("body");let r;for(i.innerHTML=t;r=i.firstChild,r;)e.appendChild(r);return this.setDOMContent(e)}getMaxWidth(){var t;return null===(t=this._container)||void 0===t?void 0:t.style.maxWidth}setMaxWidth(t){return this.options.maxWidth=t,this._update(),this}setDOMContent(t){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=i.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(t),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(t){this._container&&this._container.classList.add(t)}removeClassName(t){this._container&&this._container.classList.remove(t)}setOffset(t){return this.options.offset=t,this._update(),this}toggleClassName(t){if(this._container)return this._container.classList.toggle(t)}_createCloseButton(){this.options.closeButton&&(this._closeButton=i.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const t=this._container.querySelector(zn);t&&t.focus()}},Un.Marker=En,Un.Style=re,Un.LngLat=t.L,Un.LngLatBounds=P,Un.Point=t.P,Un.MercatorCoordinate=t.U,Un.Evented=t.E,Un.AJAXError=t.bi,Un.config=t.c,Un.CanvasSource=Q,Un.GeoJSONSource=R,Un.ImageSource=O,Un.RasterDEMTileSource=D,Un.RasterTileSource=F,Un.VectorTileSource=z,Un.VideoSource=N,Un.setRTLTextPlugin=t.bj,Un.getRTLTextPluginStatus=t.bk,Un.prewarm=function(){rt().acquire(Y)},Un.clearPrewarmedResources=function(){const t=it;t&&(t.isPreloaded()&&1===t.numActive()?(t.release(Y),it=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},Dn.extend(Un,{isSafari:t.ac,getPerformanceMetrics:t.bg.getPerformanceMetrics}),Un}));var n=i;return n}();var wt=gt(bt.exports),Tt=t({__proto__:null,default:wt},[bt.exports]);const Bt=[];function Et(t,i=e){let r;const n=new Set;function o(e){if(a(t,e)&&(t=e,r)){const e=!Bt.length;for(const e of n)e[1](),Bt.push(e,t);if(e){for(let t=0;t<Bt.length;t+=2)Bt[t][0](Bt[t+1]);Bt.length=0}}}return{set:o,update:function(e){o(e(t))},subscribe:function(s,a=e){const l=[s,a];return n.add(l),1===n.size&&(r=i(o)||e),s(t),()=>{n.delete(l),0===n.size&&r&&(r(),r=null)}}}}const Ct=Et([]),St=Et([]),It=Et([]),Mt=Et(!0),kt=Et(!0),Pt=Et([]),Lt=t=>{if(!Array.isArray(t))return!1;const e=["id","name","type"];return!(t.filter((t=>{const i=Object.keys(t);return e.filter((t=>!i.includes(t))).length>0})).length>0)},zt=(t,e)=>Math.round(t*10**e)/10**e;var Ft="Expected a function",Dt=NaN,Rt="[object Symbol]",Ut=/^\s+|\s+$/g,Ot=/^[-+]0x[0-9a-f]+$/i,Nt=/^0b[01]+$/i,Qt=/^0o[0-7]+$/i,Vt=parseInt,jt="object"==typeof mt&&mt&&mt.Object===Object&&mt,Ht="object"==typeof self&&self&&self.Object===Object&&self,Gt=jt||Ht||Function("return this")(),$t=Object.prototype.toString,Zt=Math.max,qt=Math.min,Kt=function(){return Gt.Date.now()};function Wt(t,e,i){var r,n,o,s,a,l,c=0,u=!1,h=!1,d=!0;if("function"!=typeof t)throw new TypeError(Ft);function p(e){var i=r,o=n;return r=n=void 0,c=e,s=t.apply(o,i)}function f(t){var i=t-l;return void 0===l||i>=e||i<0||h&&t-c>=o}function A(){var t=Kt();if(f(t))return m(t);a=setTimeout(A,function(t){var i=e-(t-l);return h?qt(i,o-(t-c)):i}(t))}function m(t){return a=void 0,d&&r?p(t):(r=n=void 0,s)}function g(){var t=Kt(),i=f(t);if(r=arguments,n=this,l=t,i){if(void 0===a)return function(t){return c=t,a=setTimeout(A,e),u?p(t):s}(l);if(h)return a=setTimeout(A,e),p(l)}return void 0===a&&(a=setTimeout(A,e)),s}return e=Jt(e)||0,Xt(i)&&(u=!!i.leading,o=(h="maxWait"in i)?Zt(Jt(i.maxWait)||0,e):o,d="trailing"in i?!!i.trailing:d),g.cancel=function(){void 0!==a&&clearTimeout(a),c=0,r=l=n=a=void 0},g.flush=function(){return void 0===a?s:m(Kt())},g}function Xt(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function Jt(t){if("number"==typeof t)return t;if(function(t){return"symbol"==typeof t||function(t){return!!t&&"object"==typeof t}(t)&&$t.call(t)==Rt}(t))return Dt;if(Xt(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=Xt(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(Ut,"");var i=Nt.test(t);return i||Qt.test(t)?Vt(t.slice(2),i?2:8):Ot.test(t)?Dt:+t}var Yt,te=function(t,e,i){var r=!0,n=!0;if("function"!=typeof t)throw new TypeError(Ft);return Xt(i)&&(r="leading"in i?!!i.leading:r,n="trailing"in i?!!i.trailing:n),Wt(t,e,{leading:r,maxWait:e,trailing:n})},ee=Object.prototype.toString,ie=function(t){var e=ee.call(t),i="[object Arguments]"===e;return i||(i="[object Array]"!==e&&null!==t&&"object"==typeof t&&"number"==typeof t.length&&t.length>=0&&"[object Function]"===ee.call(t.callee)),i};if(!Object.keys){var re=Object.prototype.hasOwnProperty,ne=Object.prototype.toString,oe=ie,se=Object.prototype.propertyIsEnumerable,ae=!se.call({toString:null},"toString"),le=se.call((function(){}),"prototype"),ce=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],ue=function(t){var e=t.constructor;return e&&e.prototype===t},he={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},de=function(){if("undefined"==typeof window)return!1;for(var t in window)try{if(!he["$"+t]&&re.call(window,t)&&null!==window[t]&&"object"==typeof window[t])try{ue(window[t])}catch(t){return!0}}catch(t){return!0}return!1}();Yt=function(t){var e=null!==t&&"object"==typeof t,i="[object Function]"===ne.call(t),r=oe(t),n=e&&"[object String]"===ne.call(t),o=[];if(!e&&!i&&!r)throw new TypeError("Object.keys called on a non-object");var s=le&&i;if(n&&t.length>0&&!re.call(t,0))for(var a=0;a<t.length;++a)o.push(String(a));if(r&&t.length>0)for(var l=0;l<t.length;++l)o.push(String(l));else for(var c in t)s&&"prototype"===c||!re.call(t,c)||o.push(String(c));if(ae)for(var u=function(t){if("undefined"==typeof window||!de)return ue(t);try{return ue(t)}catch(t){return!1}}(t),h=0;h<ce.length;++h)u&&"constructor"===ce[h]||!re.call(t,ce[h])||o.push(ce[h]);return o}}var pe=Yt,fe=Array.prototype.slice,Ae=ie,me=Object.keys,ge=me?function(t){return me(t)}:pe,_e=Object.keys;ge.shim=function(){if(Object.keys){var t=function(){var t=Object.keys(arguments);return t&&t.length===arguments.length}(1,2);t||(Object.keys=function(t){return Ae(t)?_e(fe.call(t)):_e(t)})}else Object.keys=ge;return Object.keys||ge};var ye,ve=ge,xe=function(){if("function"!=typeof Symbol||"function"!=typeof Object.getOwnPropertySymbols)return!1;if("symbol"==typeof Symbol.iterator)return!0;var t={},e=Symbol("test"),i=Object(e);if("string"==typeof e)return!1;if("[object Symbol]"!==Object.prototype.toString.call(e))return!1;if("[object Symbol]"!==Object.prototype.toString.call(i))return!1;for(e in t[e]=42,t)return!1;if("function"==typeof Object.keys&&0!==Object.keys(t).length)return!1;if("function"==typeof Object.getOwnPropertyNames&&0!==Object.getOwnPropertyNames(t).length)return!1;var r=Object.getOwnPropertySymbols(t);if(1!==r.length||r[0]!==e)return!1;if(!Object.prototype.propertyIsEnumerable.call(t,e))return!1;if("function"==typeof Object.getOwnPropertyDescriptor){var n=Object.getOwnPropertyDescriptor(t,e);if(42!==n.value||!0!==n.enumerable)return!1}return!0},be="undefined"!=typeof Symbol&&Symbol,we=xe,Te=function(){return"function"==typeof be&&("function"==typeof Symbol&&("symbol"==typeof be("foo")&&("symbol"==typeof Symbol("bar")&&we())))},Be={foo:{}},Ee=Object,Ce=Array.prototype.slice,Se=Object.prototype.toString,Ie=function(t){var e=this;if("function"!=typeof e||"[object Function]"!==Se.call(e))throw new TypeError("Function.prototype.bind called on incompatible "+e);for(var i,r=Ce.call(arguments,1),n=Math.max(0,e.length-r.length),o=[],s=0;s<n;s++)o.push("$"+s);if(i=Function("binder","return function ("+o.join(",")+"){ return binder.apply(this,arguments); }")((function(){if(this instanceof i){var n=e.apply(this,r.concat(Ce.call(arguments)));return Object(n)===n?n:this}return e.apply(t,r.concat(Ce.call(arguments)))})),e.prototype){var a=function(){};a.prototype=e.prototype,i.prototype=new a,a.prototype=null}return i},Me=Function.prototype.bind||Ie,ke=Me.call(Function.call,Object.prototype.hasOwnProperty),Pe=SyntaxError,Le=Function,ze=TypeError,Fe=function(t){try{return Le('"use strict"; return ('+t+").constructor;")()}catch(t){}},De=Object.getOwnPropertyDescriptor;if(De)try{De({},"")}catch(t){De=null}var Re=function(){throw new ze},Ue=De?function(){try{return Re}catch(t){try{return De(arguments,"callee").get}catch(t){return Re}}}():Re,Oe=Te(),Ne={__proto__:Be}.foo===Be.foo&&!({__proto__:null}instanceof Ee),Qe=Object.getPrototypeOf||(Ne?function(t){return t.__proto__}:null),Ve={},je="undefined"!=typeof Uint8Array&&Qe?Qe(Uint8Array):ye,He={"%AggregateError%":"undefined"==typeof AggregateError?ye:AggregateError,"%Array%":Array,"%ArrayBuffer%":"undefined"==typeof ArrayBuffer?ye:ArrayBuffer,"%ArrayIteratorPrototype%":Oe&&Qe?Qe([][Symbol.iterator]()):ye,"%AsyncFromSyncIteratorPrototype%":ye,"%AsyncFunction%":Ve,"%AsyncGenerator%":Ve,"%AsyncGeneratorFunction%":Ve,"%AsyncIteratorPrototype%":Ve,"%Atomics%":"undefined"==typeof Atomics?ye:Atomics,"%BigInt%":"undefined"==typeof BigInt?ye:BigInt,"%BigInt64Array%":"undefined"==typeof BigInt64Array?ye:BigInt64Array,"%BigUint64Array%":"undefined"==typeof BigUint64Array?ye:BigUint64Array,"%Boolean%":Boolean,"%DataView%":"undefined"==typeof DataView?ye:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Error,"%eval%":eval,"%EvalError%":EvalError,"%Float32Array%":"undefined"==typeof Float32Array?ye:Float32Array,"%Float64Array%":"undefined"==typeof Float64Array?ye:Float64Array,"%FinalizationRegistry%":"undefined"==typeof FinalizationRegistry?ye:FinalizationRegistry,"%Function%":Le,"%GeneratorFunction%":Ve,"%Int8Array%":"undefined"==typeof Int8Array?ye:Int8Array,"%Int16Array%":"undefined"==typeof Int16Array?ye:Int16Array,"%Int32Array%":"undefined"==typeof Int32Array?ye:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":Oe&&Qe?Qe(Qe([][Symbol.iterator]())):ye,"%JSON%":"object"==typeof JSON?JSON:ye,"%Map%":"undefined"==typeof Map?ye:Map,"%MapIteratorPrototype%":"undefined"!=typeof Map&&Oe&&Qe?Qe((new Map)[Symbol.iterator]()):ye,"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":"undefined"==typeof Promise?ye:Promise,"%Proxy%":"undefined"==typeof Proxy?ye:Proxy,"%RangeError%":RangeError,"%ReferenceError%":ReferenceError,"%Reflect%":"undefined"==typeof Reflect?ye:Reflect,"%RegExp%":RegExp,"%Set%":"undefined"==typeof Set?ye:Set,"%SetIteratorPrototype%":"undefined"!=typeof Set&&Oe&&Qe?Qe((new Set)[Symbol.iterator]()):ye,"%SharedArrayBuffer%":"undefined"==typeof SharedArrayBuffer?ye:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":Oe&&Qe?Qe(""[Symbol.iterator]()):ye,"%Symbol%":Oe?Symbol:ye,"%SyntaxError%":Pe,"%ThrowTypeError%":Ue,"%TypedArray%":je,"%TypeError%":ze,"%Uint8Array%":"undefined"==typeof Uint8Array?ye:Uint8Array,"%Uint8ClampedArray%":"undefined"==typeof Uint8ClampedArray?ye:Uint8ClampedArray,"%Uint16Array%":"undefined"==typeof Uint16Array?ye:Uint16Array,"%Uint32Array%":"undefined"==typeof Uint32Array?ye:Uint32Array,"%URIError%":URIError,"%WeakMap%":"undefined"==typeof WeakMap?ye:WeakMap,"%WeakRef%":"undefined"==typeof WeakRef?ye:WeakRef,"%WeakSet%":"undefined"==typeof WeakSet?ye:WeakSet};if(Qe)try{null.error}catch(t){var Ge=Qe(Qe(t));He["%Error.prototype%"]=Ge}var $e=function t(e){var i;if("%AsyncFunction%"===e)i=Fe("async function () {}");else if("%GeneratorFunction%"===e)i=Fe("function* () {}");else if("%AsyncGeneratorFunction%"===e)i=Fe("async function* () {}");else if("%AsyncGenerator%"===e){var r=t("%AsyncGeneratorFunction%");r&&(i=r.prototype)}else if("%AsyncIteratorPrototype%"===e){var n=t("%AsyncGenerator%");n&&Qe&&(i=Qe(n.prototype))}return He[e]=i,i},Ze={"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},qe=Me,Ke=ke,We=qe.call(Function.call,Array.prototype.concat),Xe=qe.call(Function.apply,Array.prototype.splice),Je=qe.call(Function.call,String.prototype.replace),Ye=qe.call(Function.call,String.prototype.slice),ti=qe.call(Function.call,RegExp.prototype.exec),ei=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,ii=/\\(\\)?/g,ri=function(t,e){var i,r=t;if(Ke(Ze,r)&&(r="%"+(i=Ze[r])[0]+"%"),Ke(He,r)){var n=He[r];if(n===Ve&&(n=$e(r)),void 0===n&&!e)throw new ze("intrinsic "+t+" exists, but is not available. Please file an issue!");return{alias:i,name:r,value:n}}throw new Pe("intrinsic "+t+" does not exist!")},ni=function(t,e){if("string"!=typeof t||0===t.length)throw new ze("intrinsic name must be a non-empty string");if(arguments.length>1&&"boolean"!=typeof e)throw new ze('"allowMissing" argument must be a boolean');if(null===ti(/^%?[^%]*%?$/,t))throw new Pe("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var i=function(t){var e=Ye(t,0,1),i=Ye(t,-1);if("%"===e&&"%"!==i)throw new Pe("invalid intrinsic syntax, expected closing `%`");if("%"===i&&"%"!==e)throw new Pe("invalid intrinsic syntax, expected opening `%`");var r=[];return Je(t,ei,(function(t,e,i,n){r[r.length]=i?Je(n,ii,"$1"):e||t})),r}(t),r=i.length>0?i[0]:"",n=ri("%"+r+"%",e),o=n.name,s=n.value,a=!1,l=n.alias;l&&(r=l[0],Xe(i,We([0,1],l)));for(var c=1,u=!0;c<i.length;c+=1){var h=i[c],d=Ye(h,0,1),p=Ye(h,-1);if(('"'===d||"'"===d||"`"===d||'"'===p||"'"===p||"`"===p)&&d!==p)throw new Pe("property names with quotes must have matching quotes");if("constructor"!==h&&u||(a=!0),Ke(He,o="%"+(r+="."+h)+"%"))s=He[o];else if(null!=s){if(!(h in s)){if(!e)throw new ze("base intrinsic for "+t+" exists, but the property is not available.");return}if(De&&c+1>=i.length){var f=De(s,h);s=(u=!!f)&&"get"in f&&!("originalValue"in f.get)?f.get:s[h]}else u=Ke(s,h),s=s[h];u&&!a&&(He[o]=s)}}return s},oi=ni("%Object.defineProperty%",!0),si=function(){if(oi)try{return oi({},"a",{value:1}),!0}catch(t){return!1}return!1};si.hasArrayLengthDefineBug=function(){if(!si())return null;try{return 1!==oi([],"length",{value:1}).length}catch(t){return!0}};var ai=si,li=ve,ci="function"==typeof Symbol&&"symbol"==typeof Symbol("foo"),ui=Object.prototype.toString,hi=Array.prototype.concat,di=Object.defineProperty,pi=ai(),fi=di&&pi,Ai=function(t,e,i,r){if(e in t)if(!0===r){if(t[e]===i)return}else if("function"!=typeof(n=r)||"[object Function]"!==ui.call(n)||!r())return;var n;fi?di(t,e,{configurable:!0,enumerable:!1,value:i,writable:!0}):t[e]=i},mi=function(t,e){var i=arguments.length>2?arguments[2]:{},r=li(e);ci&&(r=hi.call(r,Object.getOwnPropertySymbols(e)));for(var n=0;n<r.length;n+=1)Ai(t,r[n],e[r[n]],i[r[n]])};mi.supportsDescriptors=!!fi;var gi=mi,_i={exports:{}};!function(t){var e=Me,i=ni,r=i("%Function.prototype.apply%"),n=i("%Function.prototype.call%"),o=i("%Reflect.apply%",!0)||e.call(n,r),s=i("%Object.getOwnPropertyDescriptor%",!0),a=i("%Object.defineProperty%",!0),l=i("%Math.max%");if(a)try{a({},"a",{value:1})}catch(t){a=null}t.exports=function(t){var i=o(e,n,arguments);s&&a&&(s(i,"length").configurable&&a(i,"length",{value:1+l(0,t.length-(arguments.length-1))}));return i};var c=function(){return o(e,r,arguments)};a?a(t.exports,"apply",{value:c}):t.exports.apply=c}(_i);var yi=ni,vi=_i.exports,xi=vi(yi("String.prototype.indexOf")),bi=function(t,e){var i=yi(t,!!e);return"function"==typeof i&&xi(t,".prototype.")>-1?vi(i):i},wi=ve,Ti=xe(),Bi=bi,Ei=Object,Ci=Bi("Array.prototype.push"),Si=Bi("Object.prototype.propertyIsEnumerable"),Ii=Ti?Object.getOwnPropertySymbols:null,Mi=function(t,e){if(null==t)throw new TypeError("target must be an object");var i=Ei(t);if(1===arguments.length)return i;for(var r=1;r<arguments.length;++r){var n=Ei(arguments[r]),o=wi(n),s=Ti&&(Object.getOwnPropertySymbols||Ii);if(s)for(var a=s(n),l=0;l<a.length;++l){var c=a[l];Si(n,c)&&Ci(o,c)}for(var u=0;u<o.length;++u){var h=o[u];if(Si(n,h)){var d=n[h];i[h]=d}}}return i},ki=Mi,Pi=function(){return Object.assign?function(){if(!Object.assign)return!1;for(var t="abcdefghijklmnopqrst",e=t.split(""),i={},r=0;r<e.length;++r)i[e[r]]=e[r];var n=Object.assign({},i),o="";for(var s in n)o+=s;return t!==o}()||function(){if(!Object.assign||!Object.preventExtensions)return!1;var t=Object.preventExtensions({1:2});try{Object.assign(t,"xy")}catch(e){return"y"===t[1]}return!1}()?ki:Object.assign:ki},Li=gi,zi=Pi,Fi=gi,Di=Mi,Ri=Pi,Ui=function(){var t=zi();return Li(Object,{assign:t},{assign:function(){return Object.assign!==t}}),t},Oi=_i.exports.apply(Ri()),Ni=function(t,e){return Oi(Object,arguments)};Fi(Ni,{getPolyfill:Ri,implementation:Di,shim:Ui});var Qi=Ni,Vi={exports:{}},ji=function(){return"string"==typeof function(){}.name},Hi=Object.getOwnPropertyDescriptor;if(Hi)try{Hi([],"length")}catch(t){Hi=null}ji.functionsHaveConfigurableNames=function(){if(!ji()||!Hi)return!1;var t=Hi((function(){}),"name");return!!t&&!!t.configurable};var Gi=Function.prototype.bind;ji.boundFunctionsHaveNames=function(){return ji()&&"function"==typeof Gi&&""!==function(){}.bind().name};var $i=ji;!function(t){var e=$i.functionsHaveConfigurableNames(),i=Object,r=TypeError;t.exports=function(){if(null!=this&&this!==i(this))throw new r("RegExp.prototype.flags getter called on non-object");var t="";return this.hasIndices&&(t+="d"),this.global&&(t+="g"),this.ignoreCase&&(t+="i"),this.multiline&&(t+="m"),this.dotAll&&(t+="s"),this.unicode&&(t+="u"),this.unicodeSets&&(t+="v"),this.sticky&&(t+="y"),t},e&&Object.defineProperty&&Object.defineProperty(t.exports,"name",{value:"get flags"})}(Vi);var Zi=Vi.exports,qi=gi.supportsDescriptors,Ki=Object.getOwnPropertyDescriptor,Wi=function(){if(qi&&"gim"===/a/gim.flags){var t=Ki(RegExp.prototype,"flags");if(t&&"function"==typeof t.get&&"boolean"==typeof RegExp.prototype.dotAll&&"boolean"==typeof RegExp.prototype.hasIndices){var e="",i={};if(Object.defineProperty(i,"hasIndices",{get:function(){e+="d"}}),Object.defineProperty(i,"sticky",{get:function(){e+="y"}}),"dy"===e)return t.get}}return Zi},Xi=gi.supportsDescriptors,Ji=Wi,Yi=Object.getOwnPropertyDescriptor,tr=Object.defineProperty,er=TypeError,ir=Object.getPrototypeOf,rr=/a/,nr=gi,or=Vi.exports,sr=Wi,ar=function(){if(!Xi||!ir)throw new er("RegExp.prototype.flags requires a true ES5 environment that supports property descriptors");var t=Ji(),e=ir(rr),i=Yi(e,"flags");return i&&i.get===t||tr(e,"flags",{configurable:!0,enumerable:!1,get:t}),t},lr=(0,_i.exports)(sr());nr(lr,{getPolyfill:sr,implementation:or,shim:ar});var cr=lr,ur=Symbol.iterator,hr=_t(Object.freeze({__proto__:null,default:{}})),dr="function"==typeof Map&&Map.prototype,pr=Object.getOwnPropertyDescriptor&&dr?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,fr=dr&&pr&&"function"==typeof pr.get?pr.get:null,Ar=dr&&Map.prototype.forEach,mr="function"==typeof Set&&Set.prototype,gr=Object.getOwnPropertyDescriptor&&mr?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,_r=mr&&gr&&"function"==typeof gr.get?gr.get:null,yr=mr&&Set.prototype.forEach,vr="function"==typeof WeakMap&&WeakMap.prototype?WeakMap.prototype.has:null,xr="function"==typeof WeakSet&&WeakSet.prototype?WeakSet.prototype.has:null,br="function"==typeof WeakRef&&WeakRef.prototype?WeakRef.prototype.deref:null,wr=Boolean.prototype.valueOf,Tr=Object.prototype.toString,Br=Function.prototype.toString,Er=String.prototype.match,Cr=String.prototype.slice,Sr=String.prototype.replace,Ir=String.prototype.toUpperCase,Mr=String.prototype.toLowerCase,kr=RegExp.prototype.test,Pr=Array.prototype.concat,Lr=Array.prototype.join,zr=Array.prototype.slice,Fr=Math.floor,Dr="function"==typeof BigInt?BigInt.prototype.valueOf:null,Rr=Object.getOwnPropertySymbols,Ur="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?Symbol.prototype.toString:null,Or="function"==typeof Symbol&&"object"==typeof Symbol.iterator,Nr="function"==typeof Symbol&&Symbol.toStringTag&&(typeof Symbol.toStringTag===Or||"symbol")?Symbol.toStringTag:null,Qr=Object.prototype.propertyIsEnumerable,Vr=("function"==typeof Reflect?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(t){return t.__proto__}:null);function jr(t,e){if(t===1/0||t===-1/0||t!=t||t&&t>-1e3&&t<1e3||kr.call(/e/,e))return e;var i=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if("number"==typeof t){var r=t<0?-Fr(-t):Fr(t);if(r!==t){var n=String(r),o=Cr.call(e,n.length+1);return Sr.call(n,i,"$&_")+"."+Sr.call(Sr.call(o,/([0-9]{3})/g,"$&_"),/_$/,"")}}return Sr.call(e,i,"$&_")}var Hr=hr,Gr=Hr.custom,$r=Xr(Gr)?Gr:null;function Zr(t,e,i){var r="double"===(i.quoteStyle||e)?'"':"'";return r+t+r}function qr(t){return Sr.call(String(t),/"/g,"&quot;")}function Kr(t){return!("[object Array]"!==tn(t)||Nr&&"object"==typeof t&&Nr in t)}function Wr(t){return!("[object RegExp]"!==tn(t)||Nr&&"object"==typeof t&&Nr in t)}function Xr(t){if(Or)return t&&"object"==typeof t&&t instanceof Symbol;if("symbol"==typeof t)return!0;if(!t||"object"!=typeof t||!Ur)return!1;try{return Ur.call(t),!0}catch(t){}return!1}var Jr=Object.prototype.hasOwnProperty||function(t){return t in this};function Yr(t,e){return Jr.call(t,e)}function tn(t){return Tr.call(t)}function en(t,e){if(t.indexOf)return t.indexOf(e);for(var i=0,r=t.length;i<r;i++)if(t[i]===e)return i;return-1}function rn(t,e){if(t.length>e.maxStringLength){var i=t.length-e.maxStringLength,r="... "+i+" more character"+(i>1?"s":"");return rn(Cr.call(t,0,e.maxStringLength),e)+r}return Zr(Sr.call(Sr.call(t,/(['\\])/g,"\\$1"),/[\x00-\x1f]/g,nn),"single",e)}function nn(t){var e=t.charCodeAt(0),i={8:"b",9:"t",10:"n",12:"f",13:"r"}[e];return i?"\\"+i:"\\x"+(e<16?"0":"")+Ir.call(e.toString(16))}function on(t){return"Object("+t+")"}function sn(t){return t+" { ? }"}function an(t,e,i,r){return t+" ("+e+") {"+(r?ln(i,r):Lr.call(i,", "))+"}"}function ln(t,e){if(0===t.length)return"";var i="\n"+e.prev+e.base;return i+Lr.call(t,","+i)+"\n"+e.prev}function cn(t,e){var i=Kr(t),r=[];if(i){r.length=t.length;for(var n=0;n<t.length;n++)r[n]=Yr(t,n)?e(t[n],t):""}var o,s="function"==typeof Rr?Rr(t):[];if(Or){o={};for(var a=0;a<s.length;a++)o["$"+s[a]]=s[a]}for(var l in t)Yr(t,l)&&(i&&String(Number(l))===l&&l<t.length||Or&&o["$"+l]instanceof Symbol||(kr.call(/[^\w$]/,l)?r.push(e(l,t)+": "+e(t[l],t)):r.push(l+": "+e(t[l],t))));if("function"==typeof Rr)for(var c=0;c<s.length;c++)Qr.call(t,s[c])&&r.push("["+e(s[c])+"]: "+e(t[s[c]],t));return r}var un=ni,hn=bi,dn=function t(e,i,r,n){var o=i||{};if(Yr(o,"quoteStyle")&&"single"!==o.quoteStyle&&"double"!==o.quoteStyle)throw new TypeError('option "quoteStyle" must be "single" or "double"');if(Yr(o,"maxStringLength")&&("number"==typeof o.maxStringLength?o.maxStringLength<0&&o.maxStringLength!==1/0:null!==o.maxStringLength))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var s=!Yr(o,"customInspect")||o.customInspect;if("boolean"!=typeof s&&"symbol"!==s)throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(Yr(o,"indent")&&null!==o.indent&&"\t"!==o.indent&&!(parseInt(o.indent,10)===o.indent&&o.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(Yr(o,"numericSeparator")&&"boolean"!=typeof o.numericSeparator)throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var a=o.numericSeparator;if(void 0===e)return"undefined";if(null===e)return"null";if("boolean"==typeof e)return e?"true":"false";if("string"==typeof e)return rn(e,o);if("number"==typeof e){if(0===e)return 1/0/e>0?"0":"-0";var l=String(e);return a?jr(e,l):l}if("bigint"==typeof e){var c=String(e)+"n";return a?jr(e,c):c}var u=void 0===o.depth?5:o.depth;if(void 0===r&&(r=0),r>=u&&u>0&&"object"==typeof e)return Kr(e)?"[Array]":"[Object]";var h=function(t,e){var i;if("\t"===t.indent)i="\t";else{if(!("number"==typeof t.indent&&t.indent>0))return null;i=Lr.call(Array(t.indent+1)," ")}return{base:i,prev:Lr.call(Array(e+1),i)}}(o,r);if(void 0===n)n=[];else if(en(n,e)>=0)return"[Circular]";function d(e,i,s){if(i&&(n=zr.call(n)).push(i),s){var a={depth:o.depth};return Yr(o,"quoteStyle")&&(a.quoteStyle=o.quoteStyle),t(e,a,r+1,n)}return t(e,o,r+1,n)}if("function"==typeof e&&!Wr(e)){var p=function(t){if(t.name)return t.name;var e=Er.call(Br.call(t),/^function\s*([\w$]+)/);if(e)return e[1];return null}(e),f=cn(e,d);return"[Function"+(p?": "+p:" (anonymous)")+"]"+(f.length>0?" { "+Lr.call(f,", ")+" }":"")}if(Xr(e)){var A=Or?Sr.call(String(e),/^(Symbol\(.*\))_[^)]*$/,"$1"):Ur.call(e);return"object"!=typeof e||Or?A:on(A)}if(function(t){if(!t||"object"!=typeof t)return!1;if("undefined"!=typeof HTMLElement&&t instanceof HTMLElement)return!0;return"string"==typeof t.nodeName&&"function"==typeof t.getAttribute}(e)){for(var m="<"+Mr.call(String(e.nodeName)),g=e.attributes||[],_=0;_<g.length;_++)m+=" "+g[_].name+"="+Zr(qr(g[_].value),"double",o);return m+=">",e.childNodes&&e.childNodes.length&&(m+="..."),m+="</"+Mr.call(String(e.nodeName))+">"}if(Kr(e)){if(0===e.length)return"[]";var y=cn(e,d);return h&&!function(t){for(var e=0;e<t.length;e++)if(en(t[e],"\n")>=0)return!1;return!0}(y)?"["+ln(y,h)+"]":"[ "+Lr.call(y,", ")+" ]"}if(function(t){return!("[object Error]"!==tn(t)||Nr&&"object"==typeof t&&Nr in t)}(e)){var v=cn(e,d);return"cause"in Error.prototype||!("cause"in e)||Qr.call(e,"cause")?0===v.length?"["+String(e)+"]":"{ ["+String(e)+"] "+Lr.call(v,", ")+" }":"{ ["+String(e)+"] "+Lr.call(Pr.call("[cause]: "+d(e.cause),v),", ")+" }"}if("object"==typeof e&&s){if($r&&"function"==typeof e[$r]&&Hr)return Hr(e,{depth:u-r});if("symbol"!==s&&"function"==typeof e.inspect)return e.inspect()}if(function(t){if(!fr||!t||"object"!=typeof t)return!1;try{fr.call(t);try{_r.call(t)}catch(t){return!0}return t instanceof Map}catch(t){}return!1}(e)){var x=[];return Ar&&Ar.call(e,(function(t,i){x.push(d(i,e,!0)+" => "+d(t,e))})),an("Map",fr.call(e),x,h)}if(function(t){if(!_r||!t||"object"!=typeof t)return!1;try{_r.call(t);try{fr.call(t)}catch(t){return!0}return t instanceof Set}catch(t){}return!1}(e)){var b=[];return yr&&yr.call(e,(function(t){b.push(d(t,e))})),an("Set",_r.call(e),b,h)}if(function(t){if(!vr||!t||"object"!=typeof t)return!1;try{vr.call(t,vr);try{xr.call(t,xr)}catch(t){return!0}return t instanceof WeakMap}catch(t){}return!1}(e))return sn("WeakMap");if(function(t){if(!xr||!t||"object"!=typeof t)return!1;try{xr.call(t,xr);try{vr.call(t,vr)}catch(t){return!0}return t instanceof WeakSet}catch(t){}return!1}(e))return sn("WeakSet");if(function(t){if(!br||!t||"object"!=typeof t)return!1;try{return br.call(t),!0}catch(t){}return!1}(e))return sn("WeakRef");if(function(t){return!("[object Number]"!==tn(t)||Nr&&"object"==typeof t&&Nr in t)}(e))return on(d(Number(e)));if(function(t){if(!t||"object"!=typeof t||!Dr)return!1;try{return Dr.call(t),!0}catch(t){}return!1}(e))return on(d(Dr.call(e)));if(function(t){return!("[object Boolean]"!==tn(t)||Nr&&"object"==typeof t&&Nr in t)}(e))return on(wr.call(e));if(function(t){return!("[object String]"!==tn(t)||Nr&&"object"==typeof t&&Nr in t)}(e))return on(d(String(e)));if(!function(t){return!("[object Date]"!==tn(t)||Nr&&"object"==typeof t&&Nr in t)}(e)&&!Wr(e)){var w=cn(e,d),T=Vr?Vr(e)===Object.prototype:e instanceof Object||e.constructor===Object,B=e instanceof Object?"":"null prototype",E=!T&&Nr&&Object(e)===e&&Nr in e?Cr.call(tn(e),8,-1):B?"Object":"",C=(T||"function"!=typeof e.constructor?"":e.constructor.name?e.constructor.name+" ":"")+(E||B?"["+Lr.call(Pr.call([],E||[],B||[]),": ")+"] ":"");return 0===w.length?C+"{}":h?C+"{"+ln(w,h)+"}":C+"{ "+Lr.call(w,", ")+" }"}return String(e)},pn=un("%TypeError%"),fn=un("%WeakMap%",!0),An=un("%Map%",!0),mn=hn("WeakMap.prototype.get",!0),gn=hn("WeakMap.prototype.set",!0),_n=hn("WeakMap.prototype.has",!0),yn=hn("Map.prototype.get",!0),vn=hn("Map.prototype.set",!0),xn=hn("Map.prototype.has",!0),bn=function(t,e){for(var i,r=t;null!==(i=r.next);r=i)if(i.key===e)return r.next=i.next,i.next=t.next,t.next=i,i},wn=function(t){return t!=t},Tn=function(t,e){return 0===t&&0===e?1/t==1/e:t===e||!(!wn(t)||!wn(e))},Bn=Tn,En=function(){return"function"==typeof Object.is?Object.is:Bn},Cn=En,Sn=gi,In=gi,Mn=Tn,kn=En,Pn=function(){var t=Cn();return Sn(Object,{is:t},{is:function(){return Object.is!==t}}),t},Ln=(0,_i.exports)(kn(),Object);In(Ln,{getPolyfill:kn,implementation:Mn,shim:Pn});var zn=Ln,Fn=xe,Dn=function(){return Fn()&&!!Symbol.toStringTag},Rn=Dn(),Un=bi("Object.prototype.toString"),On=function(t){return!(Rn&&t&&"object"==typeof t&&Symbol.toStringTag in t)&&"[object Arguments]"===Un(t)},Nn=function(t){return!!On(t)||null!==t&&"object"==typeof t&&"number"==typeof t.length&&t.length>=0&&"[object Array]"!==Un(t)&&"[object Function]"===Un(t.callee)},Qn=function(){return On(arguments)}();On.isLegacyArguments=Nn;var Vn,jn,Hn=Qn?On:Nn,Gn={}.toString,$n=Array.isArray||function(t){return"[object Array]"==Gn.call(t)},Zn=Function.prototype.toString,qn="object"==typeof Reflect&&null!==Reflect&&Reflect.apply;if("function"==typeof qn&&"function"==typeof Object.defineProperty)try{Vn=Object.defineProperty({},"length",{get:function(){throw jn}}),jn={},qn((function(){throw 42}),null,Vn)}catch(t){t!==jn&&(qn=null)}else qn=null;var Kn=/^\s*class\b/,Wn=function(t){try{var e=Zn.call(t);return Kn.test(e)}catch(t){return!1}},Xn=function(t){try{return!Wn(t)&&(Zn.call(t),!0)}catch(t){return!1}},Jn=Object.prototype.toString,Yn="function"==typeof Symbol&&!!Symbol.toStringTag,to=!(0 in[,]),eo=function(){return!1};if("object"==typeof document){var io=document.all;Jn.call(io)===Jn.call(document.all)&&(eo=function(t){if((to||!t)&&(void 0===t||"object"==typeof t))try{var e=Jn.call(t);return("[object HTMLAllCollection]"===e||"[object HTML document.all class]"===e||"[object HTMLCollection]"===e||"[object Object]"===e)&&null==t("")}catch(t){}return!1})}var ro=qn?function(t){if(eo(t))return!0;if(!t)return!1;if("function"!=typeof t&&"object"!=typeof t)return!1;try{qn(t,null,Vn)}catch(t){if(t!==jn)return!1}return!Wn(t)&&Xn(t)}:function(t){if(eo(t))return!0;if(!t)return!1;if("function"!=typeof t&&"object"!=typeof t)return!1;if(Yn)return Xn(t);if(Wn(t))return!1;var e=Jn.call(t);return!("[object Function]"!==e&&"[object GeneratorFunction]"!==e&&!/^\[object HTML/.test(e))&&Xn(t)},no=ro,oo=Object.prototype.toString,so=Object.prototype.hasOwnProperty,ao=function(t,e,i){if(!no(e))throw new TypeError("iterator must be a function");var r;arguments.length>=3&&(r=i),"[object Array]"===oo.call(t)?function(t,e,i){for(var r=0,n=t.length;r<n;r++)so.call(t,r)&&(null==i?e(t[r],r,t):e.call(i,t[r],r,t))}(t,e,r):"string"==typeof t?function(t,e,i){for(var r=0,n=t.length;r<n;r++)null==i?e(t.charAt(r),r,t):e.call(i,t.charAt(r),r,t)}(t,e,r):function(t,e,i){for(var r in t)so.call(t,r)&&(null==i?e(t[r],r,t):e.call(i,t[r],r,t))}(t,e,r)},lo=["BigInt64Array","BigUint64Array","Float32Array","Float64Array","Int16Array","Int32Array","Int8Array","Uint16Array","Uint32Array","Uint8Array","Uint8ClampedArray"],co="undefined"==typeof globalThis?mt:globalThis,uo=function(){for(var t=[],e=0;e<lo.length;e++)"function"==typeof co[lo[e]]&&(t[t.length]=lo[e]);return t},ho=ni("%Object.getOwnPropertyDescriptor%",!0);if(ho)try{ho([],"length")}catch(t){ho=null}var po=ho,fo=ao,Ao=uo,mo=bi,go=mo("Object.prototype.toString"),_o=Dn(),yo=po,vo="undefined"==typeof globalThis?mt:globalThis,xo=Ao(),bo=mo("Array.prototype.indexOf",!0)||function(t,e){for(var i=0;i<t.length;i+=1)if(t[i]===e)return i;return-1},wo=mo("String.prototype.slice"),To={},Bo=Object.getPrototypeOf;_o&&yo&&Bo&&fo(xo,(function(t){var e=new vo[t];if(Symbol.toStringTag in e){var i=Bo(e),r=yo(i,Symbol.toStringTag);if(!r){var n=Bo(i);r=yo(n,Symbol.toStringTag)}To[t]=r.get}}));var Eo,Co,So,Io,Mo=function(t){if(!t||"object"!=typeof t)return!1;if(!_o||!(Symbol.toStringTag in t)){var e=wo(go(t),8,-1);return bo(xo,e)>-1}return!!yo&&function(t){var e=!1;return fo(To,(function(i,r){if(!e)try{e=i.call(t)===r}catch(t){}})),e}(t)},ko=_i.exports,Po=bi,Lo=ni,zo=Mo,Fo=Lo("ArrayBuffer",!0),Do=Lo("Float32Array",!0),Ro=Po("ArrayBuffer.prototype.byteLength",!0),Uo=Fo&&!Ro&&(new Fo).slice,Oo=Uo&&ko(Uo),No=Ro||Oo?function(t){if(!t||"object"!=typeof t)return!1;try{return Ro?Ro(t):Oo(t,0),!0}catch(t){return!1}}:Do?function(t){try{return new Do(t).buffer===t&&!zo(t)}catch(e){return"object"==typeof t&&"RangeError"===e.name}}:function(t){return!1},Qo=Date.prototype.getDay,Vo=Object.prototype.toString,jo=Dn(),Ho=bi,Go=Dn();if(Go){Eo=Ho("Object.prototype.hasOwnProperty"),Co=Ho("RegExp.prototype.exec"),So={};var $o=function(){throw So};Io={toString:$o,valueOf:$o},"symbol"==typeof Symbol.toPrimitive&&(Io[Symbol.toPrimitive]=$o)}var Zo=Ho("Object.prototype.toString"),qo=Object.getOwnPropertyDescriptor,Ko=Go?function(t){if(!t||"object"!=typeof t)return!1;var e=qo(t,"lastIndex");if(!(e&&Eo(e,"value")))return!1;try{Co(t,Io)}catch(t){return t===So}}:function(t){return!(!t||"object"!=typeof t&&"function"!=typeof t)&&"[object RegExp]"===Zo(t)},Wo=bi("SharedArrayBuffer.prototype.byteLength",!0),Xo=Wo?function(t){if(!t||"object"!=typeof t)return!1;try{return Wo(t),!0}catch(t){return!1}}:function(t){return!1},Jo=String.prototype.valueOf,Yo=Object.prototype.toString,ts=Dn(),es=Number.prototype.toString,is=Object.prototype.toString,rs=Dn(),ns=bi,os=ns("Boolean.prototype.toString"),ss=ns("Object.prototype.toString"),as=Dn(),ls={exports:{}},cs=Object.prototype.toString;if(Te()){var us=Symbol.prototype.toString,hs=/^Symbol\(.*\)$/;ls.exports=function(t){if("symbol"==typeof t)return!0;if("[object Symbol]"!==cs.call(t))return!1;try{return function(t){return"symbol"==typeof t.valueOf()&&hs.test(us.call(t))}(t)}catch(t){return!1}}}else ls.exports=function(t){return!1};var ds={exports:{}},ps="undefined"!=typeof BigInt&&BigInt;if("function"==typeof ps&&"function"==typeof BigInt&&"bigint"==typeof ps(42)&&"bigint"==typeof BigInt(42)){var fs=BigInt.prototype.valueOf;ds.exports=function(t){return null!=t&&"boolean"!=typeof t&&"string"!=typeof t&&"number"!=typeof t&&"symbol"!=typeof t&&"function"!=typeof t&&("bigint"==typeof t||function(t){try{return fs.call(t),!0}catch(t){}return!1}(t))}}else ds.exports=function(t){return!1};var As,ms=function(t){return"string"==typeof t||"object"==typeof t&&(ts?function(t){try{return Jo.call(t),!0}catch(t){return!1}}(t):"[object String]"===Yo.call(t))},gs=function(t){return"number"==typeof t||"object"==typeof t&&(rs?function(t){try{return es.call(t),!0}catch(t){return!1}}(t):"[object Number]"===is.call(t))},_s=function(t){return"boolean"==typeof t||null!==t&&"object"==typeof t&&(as&&Symbol.toStringTag in t?function(t){try{return os(t),!0}catch(t){return!1}}(t):"[object Boolean]"===ss(t))},ys=ls.exports,vs=ds.exports,xs="function"==typeof Map&&Map.prototype?Map:null,bs="function"==typeof Set&&Set.prototype?Set:null;xs||(As=function(t){return!1});var ws=xs?Map.prototype.has:null,Ts=bs?Set.prototype.has:null;As||ws||(As=function(t){return!1});var Bs,Es=As||function(t){if(!t||"object"!=typeof t)return!1;try{if(ws.call(t),Ts)try{Ts.call(t)}catch(t){return!0}return t instanceof xs}catch(t){}return!1},Cs="function"==typeof Map&&Map.prototype?Map:null,Ss="function"==typeof Set&&Set.prototype?Set:null;Ss||(Bs=function(t){return!1});var Is=Cs?Map.prototype.has:null,Ms=Ss?Set.prototype.has:null;Bs||Ms||(Bs=function(t){return!1});var ks,Ps=Bs||function(t){if(!t||"object"!=typeof t)return!1;try{if(Ms.call(t),Is)try{Is.call(t)}catch(t){return!0}return t instanceof Ss}catch(t){}return!1},Ls="function"==typeof WeakMap&&WeakMap.prototype?WeakMap:null,zs="function"==typeof WeakSet&&WeakSet.prototype?WeakSet:null;Ls||(ks=function(t){return!1});var Fs=Ls?Ls.prototype.has:null,Ds=zs?zs.prototype.has:null;ks||Fs||(ks=function(t){return!1});var Rs=ks||function(t){if(!t||"object"!=typeof t)return!1;try{if(Fs.call(t,Fs),Ds)try{Ds.call(t,Ds)}catch(t){return!0}return t instanceof Ls}catch(t){}return!1},Us={exports:{}},Os=bi,Ns=ni("%WeakSet%",!0),Qs=Os("WeakSet.prototype.has",!0);if(Qs){var Vs=Os("WeakMap.prototype.has",!0);Us.exports=function(t){if(!t||"object"!=typeof t)return!1;try{if(Qs(t,Qs),Vs)try{Vs(t,Vs)}catch(t){return!0}return t instanceof Ns}catch(t){}return!1}}else Us.exports=function(t){return!1};var js=Es,Hs=Ps,Gs=Rs,$s=Us.exports,Zs=ao,qs=uo,Ks=bi,Ws=po,Xs=Ks("Object.prototype.toString"),Js=Dn(),Ys="undefined"==typeof globalThis?mt:globalThis,ta=qs(),ea=Ks("String.prototype.slice"),ia={},ra=Object.getPrototypeOf;Js&&Ws&&ra&&Zs(ta,(function(t){if("function"==typeof Ys[t]){var e=new Ys[t];if(Symbol.toStringTag in e){var i=ra(e),r=Ws(i,Symbol.toStringTag);if(!r){var n=ra(i);r=Ws(n,Symbol.toStringTag)}ia[t]=r.get}}}));var na=Mo,oa=bi("ArrayBuffer.prototype.byteLength",!0),sa=No,aa=Qi,la=bi,ca=cr,ua=ni,ha=function(t){if(null!=t&&void 0!==t[ur])return t[ur]()},da=function(){var t,e,i,r={assert:function(t){if(!r.has(t))throw new pn("Side channel does not contain "+dn(t))},get:function(r){if(fn&&r&&("object"==typeof r||"function"==typeof r)){if(t)return mn(t,r)}else if(An){if(e)return yn(e,r)}else if(i)return function(t,e){var i=bn(t,e);return i&&i.value}(i,r)},has:function(r){if(fn&&r&&("object"==typeof r||"function"==typeof r)){if(t)return _n(t,r)}else if(An){if(e)return xn(e,r)}else if(i)return function(t,e){return!!bn(t,e)}(i,r);return!1},set:function(r,n){fn&&r&&("object"==typeof r||"function"==typeof r)?(t||(t=new fn),gn(t,r,n)):An?(e||(e=new An),vn(e,r,n)):(i||(i={key:{},next:null}),function(t,e,i){var r=bn(t,e);r?r.value=i:t.next={key:e,next:t.next,value:i}}(i,r,n))}};return r},pa=zn,fa=Hn,Aa=$n,ma=No,ga=function(t){return"object"==typeof t&&null!==t&&(jo?function(t){try{return Qo.call(t),!0}catch(t){return!1}}(t):"[object Date]"===Vo.call(t))},_a=Ko,ya=Xo,va=ve,xa=function(t){return null==t||"object"!=typeof t&&"function"!=typeof t?null:ms(t)?"String":gs(t)?"Number":_s(t)?"Boolean":ys(t)?"Symbol":vs(t)?"BigInt":void 0},ba=function(t){if(t&&"object"==typeof t){if(js(t))return"Map";if(Hs(t))return"Set";if(Gs(t))return"WeakMap";if($s(t))return"WeakSet"}return!1},wa=function(t){return!!na(t)&&(Js&&Symbol.toStringTag in t?function(t){var e=!1;return Zs(ia,(function(i,r){if(!e)try{var n=i.call(t);n===r&&(e=n)}catch(t){}})),e}(t):ea(Xs(t),8,-1))},Ta=function(t){return sa(t)?oa?oa(t):t.byteLength:NaN},Ba=la("SharedArrayBuffer.prototype.byteLength",!0),Ea=la("Date.prototype.getTime"),Ca=Object.getPrototypeOf,Sa=la("Object.prototype.toString"),Ia=ua("%Set%",!0),Ma=la("Map.prototype.has",!0),ka=la("Map.prototype.get",!0),Pa=la("Map.prototype.size",!0),La=la("Set.prototype.add",!0),za=la("Set.prototype.delete",!0),Fa=la("Set.prototype.has",!0),Da=la("Set.prototype.size",!0);function Ra(t,e,i,r){for(var n,o=ha(t);(n=o.next())&&!n.done;)if(Va(e,n.value,i,r))return za(t,n.value),!0;return!1}function Ua(t){return void 0===t?null:"object"!=typeof t?"symbol"!=typeof t&&("string"!=typeof t&&"number"!=typeof t||+t==+t):void 0}function Oa(t,e,i,r,n,o){var s=Ua(i);if(null!=s)return s;var a=ka(e,s),l=aa({},n,{strict:!1});return!(void 0===a&&!Ma(e,s)||!Va(r,a,l,o))&&(!Ma(t,s)&&Va(r,a,l,o))}function Na(t,e,i){var r=Ua(i);return null!=r?r:Fa(e,r)&&!Fa(t,r)}function Qa(t,e,i,r,n,o){for(var s,a,l=ha(t);(s=l.next())&&!s.done;)if(Va(i,a=s.value,n,o)&&Va(r,ka(e,a),n,o))return za(t,a),!0;return!1}function Va(t,e,i,r){var n=i||{};if(n.strict?pa(t,e):t===e)return!0;if(xa(t)!==xa(e))return!1;if(!t||!e||"object"!=typeof t&&"object"!=typeof e)return n.strict?pa(t,e):t==e;var o,s=r.has(t),a=r.has(e);if(s&&a){if(r.get(t)===r.get(e))return!0}else o={};return s||r.set(t,o),a||r.set(e,o),function(t,e,i,r){var n,o;if(typeof t!=typeof e)return!1;if(null==t||null==e)return!1;if(Sa(t)!==Sa(e))return!1;if(fa(t)!==fa(e))return!1;var s=Aa(t),a=Aa(e);if(s!==a)return!1;var l=t instanceof Error,c=e instanceof Error;if(l!==c)return!1;if((l||c)&&(t.name!==e.name||t.message!==e.message))return!1;var u=_a(t),h=_a(e);if(u!==h)return!1;if((u||h)&&(t.source!==e.source||ca(t)!==ca(e)))return!1;var d=ga(t),p=ga(e);if(d!==p)return!1;if((d||p)&&Ea(t)!==Ea(e))return!1;if(i.strict&&Ca&&Ca(t)!==Ca(e))return!1;var f=wa(t),A=wa(e);if((f||A)&&f!==A)return!1;var m=ja(t),g=ja(e);if(m!==g)return!1;if(m||g){if(t.length!==e.length)return!1;for(n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}var _=ma(t),y=ma(e);if(_!==y)return!1;if(_||y)return Ta(t)===Ta(e)&&("function"==typeof Uint8Array&&Va(new Uint8Array(t),new Uint8Array(e),i,r));var v=ya(t),x=ya(e);if(v!==x)return!1;if(v||x)return Ba(t)===Ba(e)&&("function"==typeof Uint8Array&&Va(new Uint8Array(t),new Uint8Array(e),i,r));if(typeof t!=typeof e)return!1;var b=va(t),w=va(e);if(b.length!==w.length)return!1;for(b.sort(),w.sort(),n=b.length-1;n>=0;n--)if(b[n]!=w[n])return!1;for(n=b.length-1;n>=0;n--)if(!Va(t[o=b[n]],e[o],i,r))return!1;var T=ba(t),B=ba(e);if(T!==B)return!1;if("Set"===T||"Set"===B)return function(t,e,i,r){if(Da(t)!==Da(e))return!1;var n,o,s,a=ha(t),l=ha(e);for(;(n=a.next())&&!n.done;)if(n.value&&"object"==typeof n.value)s||(s=new Ia),La(s,n.value);else if(!Fa(e,n.value)){if(i.strict)return!1;if(!Na(t,e,n.value))return!1;s||(s=new Ia),La(s,n.value)}if(s){for(;(o=l.next())&&!o.done;)if(o.value&&"object"==typeof o.value){if(!Ra(s,o.value,i.strict,r))return!1}else if(!i.strict&&!Fa(t,o.value)&&!Ra(s,o.value,i.strict,r))return!1;return 0===Da(s)}return!0}(t,e,i,r);if("Map"===T)return function(t,e,i,r){if(Pa(t)!==Pa(e))return!1;var n,o,s,a,l,c,u=ha(t),h=ha(e);for(;(n=u.next())&&!n.done;)if(a=n.value[0],l=n.value[1],a&&"object"==typeof a)s||(s=new Ia),La(s,a);else if(void 0===(c=ka(e,a))&&!Ma(e,a)||!Va(l,c,i,r)){if(i.strict)return!1;if(!Oa(t,e,a,l,i,r))return!1;s||(s=new Ia),La(s,a)}if(s){for(;(o=h.next())&&!o.done;)if(a=o.value[0],c=o.value[1],a&&"object"==typeof a){if(!Qa(s,t,a,c,i,r))return!1}else if(!(i.strict||t.has(a)&&Va(ka(t,a),c,i,r)||Qa(s,t,a,c,aa({},i,{strict:!1}),r)))return!1;return 0===Da(s)}return!0}(t,e,i,r);return!0}(t,e,n,r)}function ja(t){return!(!t||"object"!=typeof t||"number"!=typeof t.length)&&("function"==typeof t.copy&&"function"==typeof t.slice&&(!(t.length>0&&"number"!=typeof t[0])&&!!(t.constructor&&t.constructor.isBuffer&&t.constructor.isBuffer(t))))}var Ha=function(t,e,i){return Va(t,e,i,da())},Ga=function t(e,i){if(e===i)return!0;if(e&&i&&"object"==typeof e&&"object"==typeof i){if(e.constructor!==i.constructor)return!1;var r,n,o;if(Array.isArray(e)){if((r=e.length)!=i.length)return!1;for(n=r;0!=n--;)if(!t(e[n],i[n]))return!1;return!0}if(e.constructor===RegExp)return e.source===i.source&&e.flags===i.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===i.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===i.toString();if((r=(o=Object.keys(e)).length)!==Object.keys(i).length)return!1;for(n=r;0!=n--;)if(!Object.prototype.hasOwnProperty.call(i,o[n]))return!1;for(n=r;0!=n--;){var s=o[n];if(!t(e[s],i[s]))return!1}return!0}return e!=e&&i!=i};const $a="__googleMapsScriptId";var Za;!function(t){t[t.INITIALIZED=0]="INITIALIZED",t[t.LOADING=1]="LOADING",t[t.SUCCESS=2]="SUCCESS",t[t.FAILURE=3]="FAILURE"}(Za||(Za={}));class qa{constructor({apiKey:t,authReferrerPolicy:e,channel:i,client:r,id:n=$a,language:o,libraries:s=[],mapIds:a,nonce:l,region:c,retries:u=3,url:h="https://maps.googleapis.com/maps/api/js",version:d}){if(this.CALLBACK="__googleMapsCallback",this.callbacks=[],this.done=!1,this.loading=!1,this.errors=[],this.apiKey=t,this.authReferrerPolicy=e,this.channel=i,this.client=r,this.id=n||$a,this.language=o,this.libraries=s,this.mapIds=a,this.nonce=l,this.region=c,this.retries=u,this.url=h,this.version=d,qa.instance){if(!Ga(this.options,qa.instance.options))throw new Error(`Loader must not be called again with different options. ${JSON.stringify(this.options)} !== ${JSON.stringify(qa.instance.options)}`);return qa.instance}qa.instance=this}get options(){return{version:this.version,apiKey:this.apiKey,channel:this.channel,client:this.client,id:this.id,libraries:this.libraries,language:this.language,region:this.region,mapIds:this.mapIds,nonce:this.nonce,url:this.url,authReferrerPolicy:this.authReferrerPolicy}}get status(){return this.errors.length?Za.FAILURE:this.done?Za.SUCCESS:this.loading?Za.LOADING:Za.INITIALIZED}get failed(){return this.done&&!this.loading&&this.errors.length>=this.retries+1}createUrl(){let t=this.url;return t+=`?callback=${this.CALLBACK}`,this.apiKey&&(t+=`&key=${this.apiKey}`),this.channel&&(t+=`&channel=${this.channel}`),this.client&&(t+=`&client=${this.client}`),this.libraries.length>0&&(t+=`&libraries=${this.libraries.join(",")}`),this.language&&(t+=`&language=${this.language}`),this.region&&(t+=`&region=${this.region}`),this.version&&(t+=`&v=${this.version}`),this.mapIds&&(t+=`&map_ids=${this.mapIds.join(",")}`),this.authReferrerPolicy&&(t+=`&auth_referrer_policy=${this.authReferrerPolicy}`),t}deleteScript(){const t=document.getElementById(this.id);t&&t.remove()}load(){return this.loadPromise()}loadPromise(){return new Promise(((t,e)=>{this.loadCallback((i=>{i?e(i.error):t(window.google)}))}))}loadCallback(t){this.callbacks.push(t),this.execute()}setScript(){if(document.getElementById(this.id))return void this.callback();const t=this.createUrl(),e=document.createElement("script");e.id=this.id,e.type="text/javascript",e.src=t,e.onerror=this.loadErrorCallback.bind(this),e.defer=!0,e.async=!0,this.nonce&&(e.nonce=this.nonce),document.head.appendChild(e)}reset(){this.deleteScript(),this.done=!1,this.loading=!1,this.errors=[],this.onerrorEvent=null}resetIfRetryingFailed(){this.failed&&this.reset()}loadErrorCallback(t){if(this.errors.push(t),this.errors.length<=this.retries){const t=this.errors.length*Math.pow(2,this.errors.length);console.log(`Failed to load Google Maps script, retrying in ${t} ms.`),setTimeout((()=>{this.deleteScript(),this.setScript()}),t)}else this.onerrorEvent=t,this.callback()}setCallback(){window.__googleMapsCallback=this.callback.bind(this)}callback(){this.done=!0,this.loading=!1,this.callbacks.forEach((t=>{t(this.onerrorEvent)})),this.callbacks=[]}execute(){if(this.resetIfRetryingFailed(),this.done)this.callback();else{if(window.google&&window.google.maps&&window.google.maps.version)return console.warn("Google Maps already loaded outside @googlemaps/js-api-loader.This may result in undesirable behavior as options and script parameters may not match."),void this.callback();this.loading||(this.loading=!0,this.setCallback(),this.setScript())}}}function Ka(t){let i;return{c(){i=b("div"),S(i,"id",t[0]),S(i,"class","map svelte-16c2pp7")},m(t,e){y(t,i,e)},p(t,[e]){1&e&&S(i,"id",t[0])},i:e,o:e,d(t){t&&v(i)}}}function Wa(t,e,i){let r,n,{id:o}=e,{bearing:s}=e,{center:a}=e,{pitch:l}=e,{zoom:c}=e,{mapStyle:u}=e,{numberOfMaps:h}=e;It.subscribe((t=>({googleMapsAPIKey:n}=t)));const d=j();let p,f={};const A=new qa({apiKey:n,version:"beta"}),m=()=>({bearing:p.getHeading(),center:{lng:p.getCenter().lng(),lat:p.getCenter().lat()},pitch:p.getTilt(),zoom:p.getZoom()-1}),g=()=>{const t=_(m()),e=_(f);return!Ha(t,e)},_=t=>({bearing:zt(t.bearing,1),pitch:zt(t.pitch,1),center:{lat:zt(t.center.lat,6),lng:zt(t.center.lng,6)},zoom:zt(t.zoom,2)});return Q((()=>{A.load().then((()=>{var e;HTMLCanvasElement.prototype.getContext=(e=HTMLCanvasElement.prototype.getContext,function(t,i){return(i=i||{}).preserveDrawingBuffer=!0,e.call(this,t,i)}),i(7,p=new google.maps.Map(document.getElementById(o),{center:f.center,zoom:f.zoom,mapId:r,disableDefaultUI:!0,isFractionalZoomEnabled:!0,fullscreenControl:!1,zoomControl:!1}));const n=te((()=>{document.getElementById(o).querySelector('div[tabindex="0"]').focus()}),250);document.getElementById(o).addEventListener("wheel",n,{passive:!0}),p.addListener("center_changed",t),p.addListener("heading_changed",t),p.addListener("tilt_changed",t),p.addListener("zoom_changed",t)}));const t=()=>{document.getElementById(o).contains(document.activeElement)&&g()&&d("mapMove",{options:m()})}})),t.$$set=t=>{"id"in t&&i(0,o=t.id),"bearing"in t&&i(1,s=t.bearing),"center"in t&&i(2,a=t.center),"pitch"in t&&i(3,l=t.pitch),"zoom"in t&&i(4,c=t.zoom),"mapStyle"in t&&i(5,u=t.mapStyle),"numberOfMaps"in t&&i(6,h=t.numberOfMaps)},t.$$.update=()=>{if(32&t.$$.dirty&&(r=u?.mapId),30&t.$$.dirty&&i(8,f={bearing:s,center:a,pitch:l,zoom:c}),384&t.$$.dirty&&((t,e)=>{t&&g()&&t.moveCamera({center:{lat:a.lat,lng:a.lng},zoom:c+1,heading:s,tilt:l})})(p),193&t.$$.dirty&&p&&h){const t=document.getElementById(o);if(t){new ResizeObserver((()=>{google.maps.event.trigger(p,"resize")})).observe(t)}}},[o,s,a,l,c,u,h,p,f]}class Xa extends At{constructor(t){super(),ft(this,t,Wa,Ka,a,{id:0,bearing:1,center:2,pitch:3,zoom:4,mapStyle:5,numberOfMaps:6})}}const Ja=(t,e)=>{let i=new URL(t);return e&&"api.maptiler.com"===i.host&&!i.searchParams.has("key")&&i.searchParams.append("key",e),i.toString()};function Ya(t){let i;return{c(){i=b("div"),S(i,"id",t[0]),S(i,"class","map svelte-369bnt")},m(t,e){y(t,i,e)},p(t,[e]){1&e&&S(i,"id",t[0])},i:e,o:e,d(t){t&&v(i)}}}function tl(t,e,i){let r,n;l(t,It,(t=>i(15,n=t)));let o,{id:s}=e,{bearing:a}=e,{center:c}=e,{pitch:u}=e,{showCollisions:h}=e,{showBoundaries:d}=e,{zoom:p}=e,{mapStyle:f}=e,{numberOfMaps:A}=e,{mapRenderer:m}=e;const g=j();let _,y,v={},x=null,b=!1,w={};const T=()=>({bearing:y.getBearing(),center:y.getCenter(),pitch:y.getPitch(),zoom:y.getZoom()}),B=(t,e)=>{t&&!Ha(T(),w)&&t.jumpTo(e)};return Q((async()=>{await(async()=>{"maplibre-gl"===m?(await Promise.resolve().then((function(){return dh})),o=await Promise.resolve().then((function(){return Tt}))):"maptiler-sdk"===m?(await Promise.resolve().then((function(){return ph})),o=await Promise.resolve().then((function(){return wm})),o.config.apiKey=n.maptilerApiKey):(await Promise.resolve().then((function(){return Tm})),o=await Promise.resolve().then((function(){return xt})),o.accessToken=n.mapboxGlAccessToken,n.mapboxBaseApiUrl&&(o.baseApiUrl=n.mapboxBaseApiUrl))})();const t=o;i(12,y=new t.Map({container:s,style:_,preserveDrawingBuffer:!0,...w}));const e=te((()=>{document.getElementById(s).querySelector('canvas[tabindex="0"]').focus()}),250);document.getElementById(s).addEventListener("wheel",e,{passive:!0});y.on("move",(t=>{t?.resize||(({origin:t})=>{document.getElementById(s)?.contains(document.activeElement)&&g("mapMove",{options:T()})})(t)})),y.on("click",(e=>{let i=y.queryRenderedFeatures(e.point);i.length&&(b?(x.remove(),x=null):(x=(new t.Popup).setLngLat(e.lngLat).setHTML((t=>{const e=t.reduce(((t,e)=>{const{source:i,sourceLayer:r,properties:n}=e,o=t.some((t=>{const e=t.source===i&&t.sourceLayer===r,o=Object.keys(n).every((e=>n[e]===t.properties[e]));return e&&o}));return o||t.push(e),t}),[]);let i='<div class="popup">';for(const t of e){i+='<div class="popup-feature">';const{properties:e,layer:r}=t;i+='<div class="popup-label-heading">layer id</div>',i+=`<div class="popup-layer-id">${r.id}</div>`,i+='<div class="popup-label-heading">source: source-layer</div>',i+=`<div class="popup-source-layer"><span class="popup-source">${t.source}:</span> ${t.sourceLayer}</div>`,e&&Object.keys(e).length?(i+='<div class="popup-label-heading">properties</div>',Object.keys(e).sort().forEach((t=>{const r=e[t];i+=`<p class="popup-property"><span class="popup-property-id">${t}:</span> <span class="popup-property-value">${r}</span></p>`}))):i+='<p class="popup-no-properties">No properties</p>',i+="</div>"}return i+="</div>",i})(i)).setMaxWidth(360).addTo(y),b=!0,x.on("close",(()=>{b=!1}))))}))})),V((()=>{y&&y.remove()})),t.$$set=t=>{"id"in t&&i(0,s=t.id),"bearing"in t&&i(1,a=t.bearing),"center"in t&&i(2,c=t.center),"pitch"in t&&i(3,u=t.pitch),"showCollisions"in t&&i(4,h=t.showCollisions),"showBoundaries"in t&&i(5,d=t.showBoundaries),"zoom"in t&&i(6,p=t.zoom),"mapStyle"in t&&i(7,f=t.mapStyle),"numberOfMaps"in t&&i(8,A=t.numberOfMaps),"mapRenderer"in t&&i(9,m=t.mapRenderer)},t.$$.update=()=>{128&t.$$.dirty&&i(10,({style:v,url:r}=f),v,(i(14,r),i(7,f))),49152&t.$$.dirty&&i(11,_=Ja(r,n.maptilerApiKey)),78&t.$$.dirty&&i(13,w={bearing:a,center:c,pitch:u,zoom:p}),4112&t.$$.dirty&&y&&i(12,y.showCollisionBoxes=h,y),4128&t.$$.dirty&&y&&i(12,y.showTileBoundaries=d,y),12288&t.$$.dirty&&B(y,w),7168&t.$$.dirty&&((t,e,i)=>{t&&t.setStyle(e||i)})(y,_,v),4865&t.$$.dirty&&y&&A&&"maplibre-gl"!==m&&"maptiler-sdk"!==m&&y.once("render",(()=>{const t=document.getElementById(s);if(t){new ResizeObserver((()=>{y.resize({resize:!0})})).observe(t)}}))},[s,a,c,u,h,d,p,f,A,m,v,_,y,w,r,n]}class el extends At{constructor(t){super(),ft(this,t,tl,Ya,a,{id:0,bearing:1,center:2,pitch:3,showCollisions:4,showBoundaries:5,zoom:6,mapStyle:7,numberOfMaps:8,mapRenderer:9})}}var il={exports:{}};
/* @preserve
 * Leaflet 1.9.4, a JS library for interactive maps. https://leafletjs.com
 * (c) 2010-2023 Vladimir Agafonkin, (c) 2010-2011 CloudMade
 */function rl(t){let i;return{c(){i=b("div"),S(i,"id",t[0]),S(i,"class","map svelte-84o01x")},m(t,e){y(t,i,e)},p(t,[e]){1&e&&S(i,"id",t[0])},i:e,o:e,d(t){t&&v(i)}}}function nl(t,e,i){let{id:r}=e,{center:n}=e,{zoom:o}=e,{mapStyle:s}=e,{numberOfMaps:a}=e,{overrideLayer:l}=e;const c=j();let u,h,d,p={};const f=()=>({center:h.getCenter(),zoom:h.getZoom()-1}),A=(t,e)=>{t&&!Ha(f(),p)&&t.setView(e.center,e.zoom+1,{animate:!1})};return Q((async()=>{i(7,h=il.exports.map(r,{zoomControl:!1,zoomDelta:.25,zoomSnap:0}).setView(p.center,p.zoom+1)),h.attributionControl.setPrefix("");const t=te((()=>{document.getElementById(r).focus()}),250);document.getElementById(r).addEventListener("wheel",t,{passive:!0});h.on("move",(t=>{t?.resize||(({origin:t})=>{document.getElementById(r)===document.activeElement&&c("mapMove",{options:f()})})(t)}))})),V((()=>{h&&h.remove()})),t.$$set=t=>{"id"in t&&i(0,r=t.id),"center"in t&&i(1,n=t.center),"zoom"in t&&i(2,o=t.zoom),"mapStyle"in t&&i(3,s=t.mapStyle),"numberOfMaps"in t&&i(4,a=t.numberOfMaps),"overrideLayer"in t&&i(5,l=t.overrideLayer)},t.$$.update=()=>{8&t.$$.dirty&&i(6,({url:u}=s),u),6&t.$$.dirty&&i(8,p={center:n,zoom:o}),384&t.$$.dirty&&A(h,p),224&t.$$.dirty&&((t,e,i)=>{t&&(d&&d.remove(),d=i||il.exports.tileLayer(e,{detectRetina:!0}),d.addTo(t))})(h,u,l),145&t.$$.dirty&&h&&a&&h.once("render",(()=>{const t=document.getElementById(r);if(t){new ResizeObserver((()=>{h.resize({resize:!0})})).observe(t)}}))},[r,n,o,s,a,l,u,h,p]}!function(t){var e="1.9.4";function i(t){var e,i,r,n;for(i=1,r=arguments.length;i<r;i++)for(e in n=arguments[i])t[e]=n[e];return t}var r=Object.create||function(){function t(){}return function(e){return t.prototype=e,new t}}();function n(t,e){var i=Array.prototype.slice;if(t.bind)return t.bind.apply(t,i.call(arguments,1));var r=i.call(arguments,2);return function(){return t.apply(e,r.length?r.concat(i.call(arguments)):arguments)}}var o=0;function s(t){return"_leaflet_id"in t||(t._leaflet_id=++o),t._leaflet_id}function a(t,e,i){var r,n,o,s;return s=function(){r=!1,n&&(o.apply(i,n),n=!1)},o=function(){r?n=arguments:(t.apply(i,arguments),setTimeout(s,e),r=!0)},o}function l(t,e,i){var r=e[1],n=e[0],o=r-n;return t===r&&i?t:((t-n)%o+o)%o+n}function c(){return!1}function u(t,e){if(!1===e)return t;var i=Math.pow(10,void 0===e?6:e);return Math.round(t*i)/i}function h(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}function d(t){return h(t).split(/\s+/)}function p(t,e){for(var i in Object.prototype.hasOwnProperty.call(t,"options")||(t.options=t.options?r(t.options):{}),e)t.options[i]=e[i];return t.options}function f(t,e,i){var r=[];for(var n in t)r.push(encodeURIComponent(i?n.toUpperCase():n)+"="+encodeURIComponent(t[n]));return(e&&-1!==e.indexOf("?")?"&":"?")+r.join("&")}var A=/\{ *([\w_ -]+) *\}/g;function m(t,e){return t.replace(A,(function(t,i){var r=e[i];if(void 0===r)throw new Error("No value provided for variable "+t);return"function"==typeof r&&(r=r(e)),r}))}var g=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)};function _(t,e){for(var i=0;i<t.length;i++)if(t[i]===e)return i;return-1}var y="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=";function v(t){return window["webkit"+t]||window["moz"+t]||window["ms"+t]}var x=0;function b(t){var e=+new Date,i=Math.max(0,16-(e-x));return x=e+i,window.setTimeout(t,i)}var w=window.requestAnimationFrame||v("RequestAnimationFrame")||b,T=window.cancelAnimationFrame||v("CancelAnimationFrame")||v("CancelRequestAnimationFrame")||function(t){window.clearTimeout(t)};function B(t,e,i){if(!i||w!==b)return w.call(window,n(t,e));t.call(e)}function E(t){t&&T.call(window,t)}var C={__proto__:null,extend:i,create:r,bind:n,get lastId(){return o},stamp:s,throttle:a,wrapNum:l,falseFn:c,formatNum:u,trim:h,splitWords:d,setOptions:p,getParamString:f,template:m,isArray:g,indexOf:_,emptyImageUrl:y,requestFn:w,cancelFn:T,requestAnimFrame:B,cancelAnimFrame:E};function S(){}function I(t){if("undefined"!=typeof L&&L&&L.Mixin){t=g(t)?t:[t];for(var e=0;e<t.length;e++)t[e]===L.Mixin.Events&&console.warn("Deprecated include of L.Mixin.Events: this property will be removed in future releases, please inherit from L.Evented instead.",(new Error).stack)}}S.extend=function(t){var e=function(){p(this),this.initialize&&this.initialize.apply(this,arguments),this.callInitHooks()},n=e.__super__=this.prototype,o=r(n);for(var s in o.constructor=e,e.prototype=o,this)Object.prototype.hasOwnProperty.call(this,s)&&"prototype"!==s&&"__super__"!==s&&(e[s]=this[s]);return t.statics&&i(e,t.statics),t.includes&&(I(t.includes),i.apply(null,[o].concat(t.includes))),i(o,t),delete o.statics,delete o.includes,o.options&&(o.options=n.options?r(n.options):{},i(o.options,t.options)),o._initHooks=[],o.callInitHooks=function(){if(!this._initHooksCalled){n.callInitHooks&&n.callInitHooks.call(this),this._initHooksCalled=!0;for(var t=0,e=o._initHooks.length;t<e;t++)o._initHooks[t].call(this)}},e},S.include=function(t){var e=this.prototype.options;return i(this.prototype,t),t.options&&(this.prototype.options=e,this.mergeOptions(t.options)),this},S.mergeOptions=function(t){return i(this.prototype.options,t),this},S.addInitHook=function(t){var e=Array.prototype.slice.call(arguments,1),i="function"==typeof t?t:function(){this[t].apply(this,e)};return this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(i),this};var M={on:function(t,e,i){if("object"==typeof t)for(var r in t)this._on(r,t[r],e);else for(var n=0,o=(t=d(t)).length;n<o;n++)this._on(t[n],e,i);return this},off:function(t,e,i){if(arguments.length)if("object"==typeof t)for(var r in t)this._off(r,t[r],e);else{t=d(t);for(var n=1===arguments.length,o=0,s=t.length;o<s;o++)n?this._off(t[o]):this._off(t[o],e,i)}else delete this._events;return this},_on:function(t,e,i,r){if("function"==typeof e){if(!1===this._listens(t,e,i)){i===this&&(i=void 0);var n={fn:e,ctx:i};r&&(n.once=!0),this._events=this._events||{},this._events[t]=this._events[t]||[],this._events[t].push(n)}}else console.warn("wrong listener type: "+typeof e)},_off:function(t,e,i){var r,n,o;if(this._events&&(r=this._events[t]))if(1!==arguments.length)if("function"==typeof e){var s=this._listens(t,e,i);if(!1!==s){var a=r[s];this._firingCount&&(a.fn=c,this._events[t]=r=r.slice()),r.splice(s,1)}}else console.warn("wrong listener type: "+typeof e);else{if(this._firingCount)for(n=0,o=r.length;n<o;n++)r[n].fn=c;delete this._events[t]}},fire:function(t,e,r){if(!this.listens(t,r))return this;var n=i({},e,{type:t,target:this,sourceTarget:e&&e.sourceTarget||this});if(this._events){var o=this._events[t];if(o){this._firingCount=this._firingCount+1||1;for(var s=0,a=o.length;s<a;s++){var l=o[s],c=l.fn;l.once&&this.off(t,c,l.ctx),c.call(l.ctx||this,n)}this._firingCount--}}return r&&this._propagateEvent(n),this},listens:function(t,e,i,r){"string"!=typeof t&&console.warn('"string" type argument expected');var n=e;"function"!=typeof e&&(r=!!e,n=void 0,i=void 0);var o=this._events&&this._events[t];if(o&&o.length&&!1!==this._listens(t,n,i))return!0;if(r)for(var s in this._eventParents)if(this._eventParents[s].listens(t,e,i,r))return!0;return!1},_listens:function(t,e,i){if(!this._events)return!1;var r=this._events[t]||[];if(!e)return!!r.length;i===this&&(i=void 0);for(var n=0,o=r.length;n<o;n++)if(r[n].fn===e&&r[n].ctx===i)return n;return!1},once:function(t,e,i){if("object"==typeof t)for(var r in t)this._on(r,t[r],e,!0);else for(var n=0,o=(t=d(t)).length;n<o;n++)this._on(t[n],e,i,!0);return this},addEventParent:function(t){return this._eventParents=this._eventParents||{},this._eventParents[s(t)]=t,this},removeEventParent:function(t){return this._eventParents&&delete this._eventParents[s(t)],this},_propagateEvent:function(t){for(var e in this._eventParents)this._eventParents[e].fire(t.type,i({layer:t.target,propagatedFrom:t.target},t),!0)}};M.addEventListener=M.on,M.removeEventListener=M.clearAllEventListeners=M.off,M.addOneTimeEventListener=M.once,M.fireEvent=M.fire,M.hasEventListeners=M.listens;var k=S.extend(M);function P(t,e,i){this.x=i?Math.round(t):t,this.y=i?Math.round(e):e}var z=Math.trunc||function(t){return t>0?Math.floor(t):Math.ceil(t)};function F(t,e,i){return t instanceof P?t:g(t)?new P(t[0],t[1]):null==t?t:"object"==typeof t&&"x"in t&&"y"in t?new P(t.x,t.y):new P(t,e,i)}function D(t,e){if(t)for(var i=e?[t,e]:t,r=0,n=i.length;r<n;r++)this.extend(i[r])}function R(t,e){return!t||t instanceof D?t:new D(t,e)}function U(t,e){if(t)for(var i=e?[t,e]:t,r=0,n=i.length;r<n;r++)this.extend(i[r])}function O(t,e){return t instanceof U?t:new U(t,e)}function N(t,e,i){if(isNaN(t)||isNaN(e))throw new Error("Invalid LatLng object: ("+t+", "+e+")");this.lat=+t,this.lng=+e,void 0!==i&&(this.alt=+i)}function Q(t,e,i){return t instanceof N?t:g(t)&&"object"!=typeof t[0]?3===t.length?new N(t[0],t[1],t[2]):2===t.length?new N(t[0],t[1]):null:null==t?t:"object"==typeof t&&"lat"in t?new N(t.lat,"lng"in t?t.lng:t.lon,t.alt):void 0===e?null:new N(t,e,i)}P.prototype={clone:function(){return new P(this.x,this.y)},add:function(t){return this.clone()._add(F(t))},_add:function(t){return this.x+=t.x,this.y+=t.y,this},subtract:function(t){return this.clone()._subtract(F(t))},_subtract:function(t){return this.x-=t.x,this.y-=t.y,this},divideBy:function(t){return this.clone()._divideBy(t)},_divideBy:function(t){return this.x/=t,this.y/=t,this},multiplyBy:function(t){return this.clone()._multiplyBy(t)},_multiplyBy:function(t){return this.x*=t,this.y*=t,this},scaleBy:function(t){return new P(this.x*t.x,this.y*t.y)},unscaleBy:function(t){return new P(this.x/t.x,this.y/t.y)},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.clone()._ceil()},_ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},trunc:function(){return this.clone()._trunc()},_trunc:function(){return this.x=z(this.x),this.y=z(this.y),this},distanceTo:function(t){var e=(t=F(t)).x-this.x,i=t.y-this.y;return Math.sqrt(e*e+i*i)},equals:function(t){return(t=F(t)).x===this.x&&t.y===this.y},contains:function(t){return t=F(t),Math.abs(t.x)<=Math.abs(this.x)&&Math.abs(t.y)<=Math.abs(this.y)},toString:function(){return"Point("+u(this.x)+", "+u(this.y)+")"}},D.prototype={extend:function(t){var e,i;if(!t)return this;if(t instanceof P||"number"==typeof t[0]||"x"in t)e=i=F(t);else if(e=(t=R(t)).min,i=t.max,!e||!i)return this;return this.min||this.max?(this.min.x=Math.min(e.x,this.min.x),this.max.x=Math.max(i.x,this.max.x),this.min.y=Math.min(e.y,this.min.y),this.max.y=Math.max(i.y,this.max.y)):(this.min=e.clone(),this.max=i.clone()),this},getCenter:function(t){return F((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,t)},getBottomLeft:function(){return F(this.min.x,this.max.y)},getTopRight:function(){return F(this.max.x,this.min.y)},getTopLeft:function(){return this.min},getBottomRight:function(){return this.max},getSize:function(){return this.max.subtract(this.min)},contains:function(t){var e,i;return(t="number"==typeof t[0]||t instanceof P?F(t):R(t))instanceof D?(e=t.min,i=t.max):e=i=t,e.x>=this.min.x&&i.x<=this.max.x&&e.y>=this.min.y&&i.y<=this.max.y},intersects:function(t){t=R(t);var e=this.min,i=this.max,r=t.min,n=t.max,o=n.x>=e.x&&r.x<=i.x,s=n.y>=e.y&&r.y<=i.y;return o&&s},overlaps:function(t){t=R(t);var e=this.min,i=this.max,r=t.min,n=t.max,o=n.x>e.x&&r.x<i.x,s=n.y>e.y&&r.y<i.y;return o&&s},isValid:function(){return!(!this.min||!this.max)},pad:function(t){var e=this.min,i=this.max,r=Math.abs(e.x-i.x)*t,n=Math.abs(e.y-i.y)*t;return R(F(e.x-r,e.y-n),F(i.x+r,i.y+n))},equals:function(t){return!!t&&(t=R(t),this.min.equals(t.getTopLeft())&&this.max.equals(t.getBottomRight()))}},U.prototype={extend:function(t){var e,i,r=this._southWest,n=this._northEast;if(t instanceof N)e=t,i=t;else{if(!(t instanceof U))return t?this.extend(Q(t)||O(t)):this;if(e=t._southWest,i=t._northEast,!e||!i)return this}return r||n?(r.lat=Math.min(e.lat,r.lat),r.lng=Math.min(e.lng,r.lng),n.lat=Math.max(i.lat,n.lat),n.lng=Math.max(i.lng,n.lng)):(this._southWest=new N(e.lat,e.lng),this._northEast=new N(i.lat,i.lng)),this},pad:function(t){var e=this._southWest,i=this._northEast,r=Math.abs(e.lat-i.lat)*t,n=Math.abs(e.lng-i.lng)*t;return new U(new N(e.lat-r,e.lng-n),new N(i.lat+r,i.lng+n))},getCenter:function(){return new N((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new N(this.getNorth(),this.getWest())},getSouthEast:function(){return new N(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(t){t="number"==typeof t[0]||t instanceof N||"lat"in t?Q(t):O(t);var e,i,r=this._southWest,n=this._northEast;return t instanceof U?(e=t.getSouthWest(),i=t.getNorthEast()):e=i=t,e.lat>=r.lat&&i.lat<=n.lat&&e.lng>=r.lng&&i.lng<=n.lng},intersects:function(t){t=O(t);var e=this._southWest,i=this._northEast,r=t.getSouthWest(),n=t.getNorthEast(),o=n.lat>=e.lat&&r.lat<=i.lat,s=n.lng>=e.lng&&r.lng<=i.lng;return o&&s},overlaps:function(t){t=O(t);var e=this._southWest,i=this._northEast,r=t.getSouthWest(),n=t.getNorthEast(),o=n.lat>e.lat&&r.lat<i.lat,s=n.lng>e.lng&&r.lng<i.lng;return o&&s},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(t,e){return!!t&&(t=O(t),this._southWest.equals(t.getSouthWest(),e)&&this._northEast.equals(t.getNorthEast(),e))},isValid:function(){return!(!this._southWest||!this._northEast)}},N.prototype={equals:function(t,e){return!!t&&(t=Q(t),Math.max(Math.abs(this.lat-t.lat),Math.abs(this.lng-t.lng))<=(void 0===e?1e-9:e))},toString:function(t){return"LatLng("+u(this.lat,t)+", "+u(this.lng,t)+")"},distanceTo:function(t){return H.distance(this,Q(t))},wrap:function(){return H.wrapLatLng(this)},toBounds:function(t){var e=180*t/40075017,i=e/Math.cos(Math.PI/180*this.lat);return O([this.lat-e,this.lng-i],[this.lat+e,this.lng+i])},clone:function(){return new N(this.lat,this.lng,this.alt)}};var V,j={latLngToPoint:function(t,e){var i=this.projection.project(t),r=this.scale(e);return this.transformation._transform(i,r)},pointToLatLng:function(t,e){var i=this.scale(e),r=this.transformation.untransform(t,i);return this.projection.unproject(r)},project:function(t){return this.projection.project(t)},unproject:function(t){return this.projection.unproject(t)},scale:function(t){return 256*Math.pow(2,t)},zoom:function(t){return Math.log(t/256)/Math.LN2},getProjectedBounds:function(t){if(this.infinite)return null;var e=this.projection.bounds,i=this.scale(t);return new D(this.transformation.transform(e.min,i),this.transformation.transform(e.max,i))},infinite:!1,wrapLatLng:function(t){var e=this.wrapLng?l(t.lng,this.wrapLng,!0):t.lng;return new N(this.wrapLat?l(t.lat,this.wrapLat,!0):t.lat,e,t.alt)},wrapLatLngBounds:function(t){var e=t.getCenter(),i=this.wrapLatLng(e),r=e.lat-i.lat,n=e.lng-i.lng;if(0===r&&0===n)return t;var o=t.getSouthWest(),s=t.getNorthEast();return new U(new N(o.lat-r,o.lng-n),new N(s.lat-r,s.lng-n))}},H=i({},j,{wrapLng:[-180,180],R:6371e3,distance:function(t,e){var i=Math.PI/180,r=t.lat*i,n=e.lat*i,o=Math.sin((e.lat-t.lat)*i/2),s=Math.sin((e.lng-t.lng)*i/2),a=o*o+Math.cos(r)*Math.cos(n)*s*s,l=2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a));return this.R*l}}),G=6378137,$={R:G,MAX_LATITUDE:85.0511287798,project:function(t){var e=Math.PI/180,i=this.MAX_LATITUDE,r=Math.max(Math.min(i,t.lat),-i),n=Math.sin(r*e);return new P(this.R*t.lng*e,this.R*Math.log((1+n)/(1-n))/2)},unproject:function(t){var e=180/Math.PI;return new N((2*Math.atan(Math.exp(t.y/this.R))-Math.PI/2)*e,t.x*e/this.R)},bounds:(V=G*Math.PI,new D([-V,-V],[V,V]))};function Z(t,e,i,r){if(g(t))return this._a=t[0],this._b=t[1],this._c=t[2],void(this._d=t[3]);this._a=t,this._b=e,this._c=i,this._d=r}function q(t,e,i,r){return new Z(t,e,i,r)}Z.prototype={transform:function(t,e){return this._transform(t.clone(),e)},_transform:function(t,e){return e=e||1,t.x=e*(this._a*t.x+this._b),t.y=e*(this._c*t.y+this._d),t},untransform:function(t,e){return e=e||1,new P((t.x/e-this._b)/this._a,(t.y/e-this._d)/this._c)}};var K=i({},H,{code:"EPSG:3857",projection:$,transformation:function(){var t=.5/(Math.PI*$.R);return q(t,.5,-t,.5)}()}),W=i({},K,{code:"EPSG:900913"});function X(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function J(t,e){var i,r,n,o,s,a,l="";for(i=0,n=t.length;i<n;i++){for(r=0,o=(s=t[i]).length;r<o;r++)l+=(r?"L":"M")+(a=s[r]).x+" "+a.y;l+=e?Ut.svg?"z":"x":""}return l||"M0 0"}var Y,tt=document.documentElement.style,et="ActiveXObject"in window,it=et&&!document.addEventListener,rt="msLaunchUri"in navigator&&!("documentMode"in document),nt=Rt("webkit"),ot=Rt("android"),st=Rt("android 2")||Rt("android 3"),at=parseInt(/WebKit\/([0-9]+)|$/.exec(navigator.userAgent)[1],10),lt=ot&&Rt("Google")&&at<537&&!("AudioNode"in window),ct=!!window.opera,ut=!rt&&Rt("chrome"),ht=Rt("gecko")&&!nt&&!ct&&!et,dt=!ut&&Rt("safari"),pt=Rt("phantom"),ft="OTransition"in tt,At=0===navigator.platform.indexOf("Win"),mt=et&&"transition"in tt,gt="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!st,_t="MozPerspective"in tt,yt=!window.L_DISABLE_3D&&(mt||gt||_t)&&!ft&&!pt,vt="undefined"!=typeof orientation||Rt("mobile"),xt=vt&&nt,bt=vt&&gt,wt=!window.PointerEvent&&window.MSPointerEvent,Tt=!(!window.PointerEvent&&!wt),Bt="ontouchstart"in window||!!window.TouchEvent,Et=!window.L_NO_TOUCH&&(Bt||Tt),Ct=vt&&ct,St=vt&&ht,It=(window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI)>1,Mt=function(){var t=!1;try{var e=Object.defineProperty({},"passive",{get:function(){t=!0}});window.addEventListener("testPassiveEventSupport",c,e),window.removeEventListener("testPassiveEventSupport",c,e)}catch(t){}return t}(),kt=!!document.createElement("canvas").getContext,Pt=!(!document.createElementNS||!X("svg").createSVGRect),Lt=!!Pt&&((Y=document.createElement("div")).innerHTML="<svg/>","http://www.w3.org/2000/svg"===(Y.firstChild&&Y.firstChild.namespaceURI)),zt=!Pt&&function(){try{var t=document.createElement("div");t.innerHTML='<v:shape adj="1"/>';var e=t.firstChild;return e.style.behavior="url(#default#VML)",e&&"object"==typeof e.adj}catch(t){return!1}}(),Ft=0===navigator.platform.indexOf("Mac"),Dt=0===navigator.platform.indexOf("Linux");function Rt(t){return navigator.userAgent.toLowerCase().indexOf(t)>=0}var Ut={ie:et,ielt9:it,edge:rt,webkit:nt,android:ot,android23:st,androidStock:lt,opera:ct,chrome:ut,gecko:ht,safari:dt,phantom:pt,opera12:ft,win:At,ie3d:mt,webkit3d:gt,gecko3d:_t,any3d:yt,mobile:vt,mobileWebkit:xt,mobileWebkit3d:bt,msPointer:wt,pointer:Tt,touch:Et,touchNative:Bt,mobileOpera:Ct,mobileGecko:St,retina:It,passiveEvents:Mt,canvas:kt,svg:Pt,vml:zt,inlineSvg:Lt,mac:Ft,linux:Dt},Ot=Ut.msPointer?"MSPointerDown":"pointerdown",Nt=Ut.msPointer?"MSPointerMove":"pointermove",Qt=Ut.msPointer?"MSPointerUp":"pointerup",Vt=Ut.msPointer?"MSPointerCancel":"pointercancel",jt={touchstart:Ot,touchmove:Nt,touchend:Qt,touchcancel:Vt},Ht={touchstart:te,touchmove:Yt,touchend:Yt,touchcancel:Yt},Gt={},$t=!1;function Zt(t,e,i){return"touchstart"===e&&Jt(),Ht[e]?(i=Ht[e].bind(this,i),t.addEventListener(jt[e],i,!1),i):(console.warn("wrong event specified:",e),c)}function qt(t,e,i){jt[e]?t.removeEventListener(jt[e],i,!1):console.warn("wrong event specified:",e)}function Kt(t){Gt[t.pointerId]=t}function Wt(t){Gt[t.pointerId]&&(Gt[t.pointerId]=t)}function Xt(t){delete Gt[t.pointerId]}function Jt(){$t||(document.addEventListener(Ot,Kt,!0),document.addEventListener(Nt,Wt,!0),document.addEventListener(Qt,Xt,!0),document.addEventListener(Vt,Xt,!0),$t=!0)}function Yt(t,e){if(e.pointerType!==(e.MSPOINTER_TYPE_MOUSE||"mouse")){for(var i in e.touches=[],Gt)e.touches.push(Gt[i]);e.changedTouches=[e],t(e)}}function te(t,e){e.MSPOINTER_TYPE_TOUCH&&e.pointerType===e.MSPOINTER_TYPE_TOUCH&&Ke(e),Yt(t,e)}function ee(t){var e,i,r={};for(i in t)e=t[i],r[i]=e&&e.bind?e.bind(t):e;return t=r,r.type="dblclick",r.detail=2,r.isTrusted=!1,r._simulated=!0,r}var ie=200;function re(t,e){t.addEventListener("dblclick",e);var i,r=0;function n(t){if(1===t.detail){if("mouse"!==t.pointerType&&(!t.sourceCapabilities||t.sourceCapabilities.firesTouchEvents)){var n=Xe(t);if(!n.some((function(t){return t instanceof HTMLLabelElement&&t.attributes.for}))||n.some((function(t){return t instanceof HTMLInputElement||t instanceof HTMLSelectElement}))){var o=Date.now();o-r<=ie?2==++i&&e(ee(t)):i=1,r=o}}}else i=t.detail}return t.addEventListener("click",n),{dblclick:e,simDblclick:n}}function ne(t,e){t.removeEventListener("dblclick",e.dblclick),t.removeEventListener("click",e.simDblclick)}var oe,se,ae,le,ce,ue=Ce(["transform","webkitTransform","OTransform","MozTransform","msTransform"]),he=Ce(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),de="webkitTransition"===he||"OTransition"===he?he+"End":"transitionend";function pe(t){return"string"==typeof t?document.getElementById(t):t}function fe(t,e){var i=t.style[e]||t.currentStyle&&t.currentStyle[e];if((!i||"auto"===i)&&document.defaultView){var r=document.defaultView.getComputedStyle(t,null);i=r?r[e]:null}return"auto"===i?null:i}function Ae(t,e,i){var r=document.createElement(t);return r.className=e||"",i&&i.appendChild(r),r}function me(t){var e=t.parentNode;e&&e.removeChild(t)}function ge(t){for(;t.firstChild;)t.removeChild(t.firstChild)}function _e(t){var e=t.parentNode;e&&e.lastChild!==t&&e.appendChild(t)}function ye(t){var e=t.parentNode;e&&e.firstChild!==t&&e.insertBefore(t,e.firstChild)}function ve(t,e){if(void 0!==t.classList)return t.classList.contains(e);var i=Te(t);return i.length>0&&new RegExp("(^|\\s)"+e+"(\\s|$)").test(i)}function xe(t,e){if(void 0!==t.classList)for(var i=d(e),r=0,n=i.length;r<n;r++)t.classList.add(i[r]);else if(!ve(t,e)){var o=Te(t);we(t,(o?o+" ":"")+e)}}function be(t,e){void 0!==t.classList?t.classList.remove(e):we(t,h((" "+Te(t)+" ").replace(" "+e+" "," ")))}function we(t,e){void 0===t.className.baseVal?t.className=e:t.className.baseVal=e}function Te(t){return t.correspondingElement&&(t=t.correspondingElement),void 0===t.className.baseVal?t.className:t.className.baseVal}function Be(t,e){"opacity"in t.style?t.style.opacity=e:"filter"in t.style&&Ee(t,e)}function Ee(t,e){var i=!1,r="DXImageTransform.Microsoft.Alpha";try{i=t.filters.item(r)}catch(t){if(1===e)return}e=Math.round(100*e),i?(i.Enabled=100!==e,i.Opacity=e):t.style.filter+=" progid:"+r+"(opacity="+e+")"}function Ce(t){for(var e=document.documentElement.style,i=0;i<t.length;i++)if(t[i]in e)return t[i];return!1}function Se(t,e,i){var r=e||new P(0,0);t.style[ue]=(Ut.ie3d?"translate("+r.x+"px,"+r.y+"px)":"translate3d("+r.x+"px,"+r.y+"px,0)")+(i?" scale("+i+")":"")}function Ie(t,e){t._leaflet_pos=e,Ut.any3d?Se(t,e):(t.style.left=e.x+"px",t.style.top=e.y+"px")}function Me(t){return t._leaflet_pos||new P(0,0)}if("onselectstart"in document)oe=function(){Oe(window,"selectstart",Ke)},se=function(){Qe(window,"selectstart",Ke)};else{var ke=Ce(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);oe=function(){if(ke){var t=document.documentElement.style;ae=t[ke],t[ke]="none"}},se=function(){ke&&(document.documentElement.style[ke]=ae,ae=void 0)}}function Pe(){Oe(window,"dragstart",Ke)}function Le(){Qe(window,"dragstart",Ke)}function ze(t){for(;-1===t.tabIndex;)t=t.parentNode;t.style&&(Fe(),le=t,ce=t.style.outlineStyle,t.style.outlineStyle="none",Oe(window,"keydown",Fe))}function Fe(){le&&(le.style.outlineStyle=ce,le=void 0,ce=void 0,Qe(window,"keydown",Fe))}function De(t){do{t=t.parentNode}while(!(t.offsetWidth&&t.offsetHeight||t===document.body));return t}function Re(t){var e=t.getBoundingClientRect();return{x:e.width/t.offsetWidth||1,y:e.height/t.offsetHeight||1,boundingClientRect:e}}var Ue={__proto__:null,TRANSFORM:ue,TRANSITION:he,TRANSITION_END:de,get:pe,getStyle:fe,create:Ae,remove:me,empty:ge,toFront:_e,toBack:ye,hasClass:ve,addClass:xe,removeClass:be,setClass:we,getClass:Te,setOpacity:Be,testProp:Ce,setTransform:Se,setPosition:Ie,getPosition:Me,get disableTextSelection(){return oe},get enableTextSelection(){return se},disableImageDrag:Pe,enableImageDrag:Le,preventOutline:ze,restoreOutline:Fe,getSizedParentNode:De,getScale:Re};function Oe(t,e,i,r){if(e&&"object"==typeof e)for(var n in e)He(t,n,e[n],i);else for(var o=0,s=(e=d(e)).length;o<s;o++)He(t,e[o],i,r);return this}var Ne="_leaflet_events";function Qe(t,e,i,r){if(1===arguments.length)Ve(t),delete t[Ne];else if(e&&"object"==typeof e)for(var n in e)Ge(t,n,e[n],i);else if(e=d(e),2===arguments.length)Ve(t,(function(t){return-1!==_(e,t)}));else for(var o=0,s=e.length;o<s;o++)Ge(t,e[o],i,r);return this}function Ve(t,e){for(var i in t[Ne]){var r=i.split(/\d/)[0];e&&!e(r)||Ge(t,r,null,null,i)}}var je={mouseenter:"mouseover",mouseleave:"mouseout",wheel:!("onwheel"in window)&&"mousewheel"};function He(t,e,i,r){var n=e+s(i)+(r?"_"+s(r):"");if(t[Ne]&&t[Ne][n])return this;var o=function(e){return i.call(r||t,e||window.event)},a=o;!Ut.touchNative&&Ut.pointer&&0===e.indexOf("touch")?o=Zt(t,e,o):Ut.touch&&"dblclick"===e?o=re(t,o):"addEventListener"in t?"touchstart"===e||"touchmove"===e||"wheel"===e||"mousewheel"===e?t.addEventListener(je[e]||e,o,!!Ut.passiveEvents&&{passive:!1}):"mouseenter"===e||"mouseleave"===e?(o=function(e){e=e||window.event,ei(t,e)&&a(e)},t.addEventListener(je[e],o,!1)):t.addEventListener(e,a,!1):t.attachEvent("on"+e,o),t[Ne]=t[Ne]||{},t[Ne][n]=o}function Ge(t,e,i,r,n){n=n||e+s(i)+(r?"_"+s(r):"");var o=t[Ne]&&t[Ne][n];if(!o)return this;!Ut.touchNative&&Ut.pointer&&0===e.indexOf("touch")?qt(t,e,o):Ut.touch&&"dblclick"===e?ne(t,o):"removeEventListener"in t?t.removeEventListener(je[e]||e,o,!1):t.detachEvent("on"+e,o),t[Ne][n]=null}function $e(t){return t.stopPropagation?t.stopPropagation():t.originalEvent?t.originalEvent._stopped=!0:t.cancelBubble=!0,this}function Ze(t){return He(t,"wheel",$e),this}function qe(t){return Oe(t,"mousedown touchstart dblclick contextmenu",$e),t._leaflet_disable_click=!0,this}function Ke(t){return t.preventDefault?t.preventDefault():t.returnValue=!1,this}function We(t){return Ke(t),$e(t),this}function Xe(t){if(t.composedPath)return t.composedPath();for(var e=[],i=t.target;i;)e.push(i),i=i.parentNode;return e}function Je(t,e){if(!e)return new P(t.clientX,t.clientY);var i=Re(e),r=i.boundingClientRect;return new P((t.clientX-r.left)/i.x-e.clientLeft,(t.clientY-r.top)/i.y-e.clientTop)}var Ye=Ut.linux&&Ut.chrome?window.devicePixelRatio:Ut.mac?3*window.devicePixelRatio:window.devicePixelRatio>0?2*window.devicePixelRatio:1;function ti(t){return Ut.edge?t.wheelDeltaY/2:t.deltaY&&0===t.deltaMode?-t.deltaY/Ye:t.deltaY&&1===t.deltaMode?20*-t.deltaY:t.deltaY&&2===t.deltaMode?60*-t.deltaY:t.deltaX||t.deltaZ?0:t.wheelDelta?(t.wheelDeltaY||t.wheelDelta)/2:t.detail&&Math.abs(t.detail)<32765?20*-t.detail:t.detail?t.detail/-32765*60:0}function ei(t,e){var i=e.relatedTarget;if(!i)return!0;try{for(;i&&i!==t;)i=i.parentNode}catch(t){return!1}return i!==t}var ii={__proto__:null,on:Oe,off:Qe,stopPropagation:$e,disableScrollPropagation:Ze,disableClickPropagation:qe,preventDefault:Ke,stop:We,getPropagationPath:Xe,getMousePosition:Je,getWheelDelta:ti,isExternalTarget:ei,addListener:Oe,removeListener:Qe},ri=k.extend({run:function(t,e,i,r){this.stop(),this._el=t,this._inProgress=!0,this._duration=i||.25,this._easeOutPower=1/Math.max(r||.5,.2),this._startPos=Me(t),this._offset=e.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(!0),this._complete())},_animate:function(){this._animId=B(this._animate,this),this._step()},_step:function(t){var e=+new Date-this._startTime,i=1e3*this._duration;e<i?this._runFrame(this._easeOut(e/i),t):(this._runFrame(1),this._complete())},_runFrame:function(t,e){var i=this._startPos.add(this._offset.multiplyBy(t));e&&i._round(),Ie(this._el,i),this.fire("step")},_complete:function(){E(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(t){return 1-Math.pow(1-t,this._easeOutPower)}}),ni=k.extend({options:{crs:K,center:void 0,zoom:void 0,minZoom:void 0,maxZoom:void 0,layers:[],maxBounds:void 0,renderer:void 0,zoomAnimation:!0,zoomAnimationThreshold:4,fadeAnimation:!0,markerZoomAnimation:!0,transform3DLimit:8388608,zoomSnap:1,zoomDelta:1,trackResize:!0},initialize:function(t,e){e=p(this,e),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._sizeChanged=!0,this._initContainer(t),this._initLayout(),this._onResize=n(this._onResize,this),this._initEvents(),e.maxBounds&&this.setMaxBounds(e.maxBounds),void 0!==e.zoom&&(this._zoom=this._limitZoom(e.zoom)),e.center&&void 0!==e.zoom&&this.setView(Q(e.center),e.zoom,{reset:!0}),this.callInitHooks(),this._zoomAnimated=he&&Ut.any3d&&!Ut.mobileOpera&&this.options.zoomAnimation,this._zoomAnimated&&(this._createAnimProxy(),Oe(this._proxy,de,this._catchTransitionEnd,this)),this._addLayers(this.options.layers)},setView:function(t,e,r){return e=void 0===e?this._zoom:this._limitZoom(e),t=this._limitCenter(Q(t),e,this.options.maxBounds),r=r||{},this._stop(),this._loaded&&!r.reset&&!0!==r&&(void 0!==r.animate&&(r.zoom=i({animate:r.animate},r.zoom),r.pan=i({animate:r.animate,duration:r.duration},r.pan)),this._zoom!==e?this._tryAnimatedZoom&&this._tryAnimatedZoom(t,e,r.zoom):this._tryAnimatedPan(t,r.pan))?(clearTimeout(this._sizeTimer),this):(this._resetView(t,e,r.pan&&r.pan.noMoveStart),this)},setZoom:function(t,e){return this._loaded?this.setView(this.getCenter(),t,{zoom:e}):(this._zoom=t,this)},zoomIn:function(t,e){return t=t||(Ut.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom+t,e)},zoomOut:function(t,e){return t=t||(Ut.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom-t,e)},setZoomAround:function(t,e,i){var r=this.getZoomScale(e),n=this.getSize().divideBy(2),o=(t instanceof P?t:this.latLngToContainerPoint(t)).subtract(n).multiplyBy(1-1/r),s=this.containerPointToLatLng(n.add(o));return this.setView(s,e,{zoom:i})},_getBoundsCenterZoom:function(t,e){e=e||{},t=t.getBounds?t.getBounds():O(t);var i=F(e.paddingTopLeft||e.padding||[0,0]),r=F(e.paddingBottomRight||e.padding||[0,0]),n=this.getBoundsZoom(t,!1,i.add(r));if((n="number"==typeof e.maxZoom?Math.min(e.maxZoom,n):n)===1/0)return{center:t.getCenter(),zoom:n};var o=r.subtract(i).divideBy(2),s=this.project(t.getSouthWest(),n),a=this.project(t.getNorthEast(),n);return{center:this.unproject(s.add(a).divideBy(2).add(o),n),zoom:n}},fitBounds:function(t,e){if(!(t=O(t)).isValid())throw new Error("Bounds are not valid.");var i=this._getBoundsCenterZoom(t,e);return this.setView(i.center,i.zoom,e)},fitWorld:function(t){return this.fitBounds([[-90,-180],[90,180]],t)},panTo:function(t,e){return this.setView(t,this._zoom,{pan:e})},panBy:function(t,e){if(e=e||{},!(t=F(t).round()).x&&!t.y)return this.fire("moveend");if(!0!==e.animate&&!this.getSize().contains(t))return this._resetView(this.unproject(this.project(this.getCenter()).add(t)),this.getZoom()),this;if(this._panAnim||(this._panAnim=new ri,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),e.noMoveStart||this.fire("movestart"),!1!==e.animate){xe(this._mapPane,"leaflet-pan-anim");var i=this._getMapPanePos().subtract(t).round();this._panAnim.run(this._mapPane,i,e.duration||.25,e.easeLinearity)}else this._rawPanBy(t),this.fire("move").fire("moveend");return this},flyTo:function(t,e,i){if(!1===(i=i||{}).animate||!Ut.any3d)return this.setView(t,e,i);this._stop();var r=this.project(this.getCenter()),n=this.project(t),o=this.getSize(),s=this._zoom;t=Q(t),e=void 0===e?s:e;var a=Math.max(o.x,o.y),l=a*this.getZoomScale(s,e),c=n.distanceTo(r)||1,u=1.42,h=u*u;function d(t){var e=(l*l-a*a+(t?-1:1)*h*h*c*c)/(2*(t?l:a)*h*c),i=Math.sqrt(e*e+1)-e;return i<1e-9?-18:Math.log(i)}function p(t){return(Math.exp(t)-Math.exp(-t))/2}function f(t){return(Math.exp(t)+Math.exp(-t))/2}function A(t){return p(t)/f(t)}var m=d(0);function g(t){return a*(f(m)/f(m+u*t))}function _(t){return a*(f(m)*A(m+u*t)-p(m))/h}function y(t){return 1-Math.pow(1-t,1.5)}var v=Date.now(),x=(d(1)-m)/u,b=i.duration?1e3*i.duration:1e3*x*.8;function w(){var i=(Date.now()-v)/b,o=y(i)*x;i<=1?(this._flyToFrame=B(w,this),this._move(this.unproject(r.add(n.subtract(r).multiplyBy(_(o)/c)),s),this.getScaleZoom(a/g(o),s),{flyTo:!0})):this._move(t,e)._moveEnd(!0)}return this._moveStart(!0,i.noMoveStart),w.call(this),this},flyToBounds:function(t,e){var i=this._getBoundsCenterZoom(t,e);return this.flyTo(i.center,i.zoom,e)},setMaxBounds:function(t){return t=O(t),this.listens("moveend",this._panInsideMaxBounds)&&this.off("moveend",this._panInsideMaxBounds),t.isValid()?(this.options.maxBounds=t,this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds)):(this.options.maxBounds=null,this)},setMinZoom:function(t){var e=this.options.minZoom;return this.options.minZoom=t,this._loaded&&e!==t&&(this.fire("zoomlevelschange"),this.getZoom()<this.options.minZoom)?this.setZoom(t):this},setMaxZoom:function(t){var e=this.options.maxZoom;return this.options.maxZoom=t,this._loaded&&e!==t&&(this.fire("zoomlevelschange"),this.getZoom()>this.options.maxZoom)?this.setZoom(t):this},panInsideBounds:function(t,e){this._enforcingBounds=!0;var i=this.getCenter(),r=this._limitCenter(i,this._zoom,O(t));return i.equals(r)||this.panTo(r,e),this._enforcingBounds=!1,this},panInside:function(t,e){var i=F((e=e||{}).paddingTopLeft||e.padding||[0,0]),r=F(e.paddingBottomRight||e.padding||[0,0]),n=this.project(this.getCenter()),o=this.project(t),s=this.getPixelBounds(),a=R([s.min.add(i),s.max.subtract(r)]),l=a.getSize();if(!a.contains(o)){this._enforcingBounds=!0;var c=o.subtract(a.getCenter()),u=a.extend(o).getSize().subtract(l);n.x+=c.x<0?-u.x:u.x,n.y+=c.y<0?-u.y:u.y,this.panTo(this.unproject(n),e),this._enforcingBounds=!1}return this},invalidateSize:function(t){if(!this._loaded)return this;t=i({animate:!1,pan:!0},!0===t?{animate:!0}:t);var e=this.getSize();this._sizeChanged=!0,this._lastCenter=null;var r=this.getSize(),o=e.divideBy(2).round(),s=r.divideBy(2).round(),a=o.subtract(s);return a.x||a.y?(t.animate&&t.pan?this.panBy(a):(t.pan&&this._rawPanBy(a),this.fire("move"),t.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(n(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:e,newSize:r})):this},stop:function(){return this.setZoom(this._limitZoom(this._zoom)),this.options.zoomSnap||this.fire("viewreset"),this._stop()},locate:function(t){if(t=this._locateOptions=i({timeout:1e4,watch:!1},t),!("geolocation"in navigator))return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var e=n(this._handleGeolocationResponse,this),r=n(this._handleGeolocationError,this);return t.watch?this._locationWatchId=navigator.geolocation.watchPosition(e,r,t):navigator.geolocation.getCurrentPosition(e,r,t),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(t){if(this._container._leaflet_id){var e=t.code,i=t.message||(1===e?"permission denied":2===e?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:e,message:"Geolocation error: "+i+"."})}},_handleGeolocationResponse:function(t){if(this._container._leaflet_id){var e=new N(t.coords.latitude,t.coords.longitude),i=e.toBounds(2*t.coords.accuracy),r=this._locateOptions;if(r.setView){var n=this.getBoundsZoom(i);this.setView(e,r.maxZoom?Math.min(n,r.maxZoom):n)}var o={latlng:e,bounds:i,timestamp:t.timestamp};for(var s in t.coords)"number"==typeof t.coords[s]&&(o[s]=t.coords[s]);this.fire("locationfound",o)}},addHandler:function(t,e){if(!e)return this;var i=this[t]=new e(this);return this._handlers.push(i),this.options[t]&&i.enable(),this},remove:function(){if(this._initEvents(!0),this.options.maxBounds&&this.off("moveend",this._panInsideMaxBounds),this._containerId!==this._container._leaflet_id)throw new Error("Map container is being reused by another instance");try{delete this._container._leaflet_id,delete this._containerId}catch(t){this._container._leaflet_id=void 0,this._containerId=void 0}var t;for(t in void 0!==this._locationWatchId&&this.stopLocate(),this._stop(),me(this._mapPane),this._clearControlPos&&this._clearControlPos(),this._resizeRequest&&(E(this._resizeRequest),this._resizeRequest=null),this._clearHandlers(),this._loaded&&this.fire("unload"),this._layers)this._layers[t].remove();for(t in this._panes)me(this._panes[t]);return this._layers=[],this._panes=[],delete this._mapPane,delete this._renderer,this},createPane:function(t,e){var i=Ae("div","leaflet-pane"+(t?" leaflet-"+t.replace("Pane","")+"-pane":""),e||this._mapPane);return t&&(this._panes[t]=i),i},getCenter:function(){return this._checkIfLoaded(),this._lastCenter&&!this._moved()?this._lastCenter.clone():this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var t=this.getPixelBounds();return new U(this.unproject(t.getBottomLeft()),this.unproject(t.getTopRight()))},getMinZoom:function(){return void 0===this.options.minZoom?this._layersMinZoom||0:this.options.minZoom},getMaxZoom:function(){return void 0===this.options.maxZoom?void 0===this._layersMaxZoom?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(t,e,i){t=O(t),i=F(i||[0,0]);var r=this.getZoom()||0,n=this.getMinZoom(),o=this.getMaxZoom(),s=t.getNorthWest(),a=t.getSouthEast(),l=this.getSize().subtract(i),c=R(this.project(a,r),this.project(s,r)).getSize(),u=Ut.any3d?this.options.zoomSnap:1,h=l.x/c.x,d=l.y/c.y,p=e?Math.max(h,d):Math.min(h,d);return r=this.getScaleZoom(p,r),u&&(r=Math.round(r/(u/100))*(u/100),r=e?Math.ceil(r/u)*u:Math.floor(r/u)*u),Math.max(n,Math.min(o,r))},getSize:function(){return this._size&&!this._sizeChanged||(this._size=new P(this._container.clientWidth||0,this._container.clientHeight||0),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(t,e){var i=this._getTopLeftPoint(t,e);return new D(i,i.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._pixelOrigin},getPixelWorldBounds:function(t){return this.options.crs.getProjectedBounds(void 0===t?this.getZoom():t)},getPane:function(t){return"string"==typeof t?this._panes[t]:t},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(t,e){var i=this.options.crs;return e=void 0===e?this._zoom:e,i.scale(t)/i.scale(e)},getScaleZoom:function(t,e){var i=this.options.crs;e=void 0===e?this._zoom:e;var r=i.zoom(t*i.scale(e));return isNaN(r)?1/0:r},project:function(t,e){return e=void 0===e?this._zoom:e,this.options.crs.latLngToPoint(Q(t),e)},unproject:function(t,e){return e=void 0===e?this._zoom:e,this.options.crs.pointToLatLng(F(t),e)},layerPointToLatLng:function(t){var e=F(t).add(this.getPixelOrigin());return this.unproject(e)},latLngToLayerPoint:function(t){return this.project(Q(t))._round()._subtract(this.getPixelOrigin())},wrapLatLng:function(t){return this.options.crs.wrapLatLng(Q(t))},wrapLatLngBounds:function(t){return this.options.crs.wrapLatLngBounds(O(t))},distance:function(t,e){return this.options.crs.distance(Q(t),Q(e))},containerPointToLayerPoint:function(t){return F(t).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(t){return F(t).add(this._getMapPanePos())},containerPointToLatLng:function(t){var e=this.containerPointToLayerPoint(F(t));return this.layerPointToLatLng(e)},latLngToContainerPoint:function(t){return this.layerPointToContainerPoint(this.latLngToLayerPoint(Q(t)))},mouseEventToContainerPoint:function(t){return Je(t,this._container)},mouseEventToLayerPoint:function(t){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(t))},mouseEventToLatLng:function(t){return this.layerPointToLatLng(this.mouseEventToLayerPoint(t))},_initContainer:function(t){var e=this._container=pe(t);if(!e)throw new Error("Map container not found.");if(e._leaflet_id)throw new Error("Map container is already initialized.");Oe(e,"scroll",this._onScroll,this),this._containerId=s(e)},_initLayout:function(){var t=this._container;this._fadeAnimated=this.options.fadeAnimation&&Ut.any3d,xe(t,"leaflet-container"+(Ut.touch?" leaflet-touch":"")+(Ut.retina?" leaflet-retina":"")+(Ut.ielt9?" leaflet-oldie":"")+(Ut.safari?" leaflet-safari":"")+(this._fadeAnimated?" leaflet-fade-anim":""));var e=fe(t,"position");"absolute"!==e&&"relative"!==e&&"fixed"!==e&&"sticky"!==e&&(t.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var t=this._panes={};this._paneRenderers={},this._mapPane=this.createPane("mapPane",this._container),Ie(this._mapPane,new P(0,0)),this.createPane("tilePane"),this.createPane("overlayPane"),this.createPane("shadowPane"),this.createPane("markerPane"),this.createPane("tooltipPane"),this.createPane("popupPane"),this.options.markerZoomAnimation||(xe(t.markerPane,"leaflet-zoom-hide"),xe(t.shadowPane,"leaflet-zoom-hide"))},_resetView:function(t,e,i){Ie(this._mapPane,new P(0,0));var r=!this._loaded;this._loaded=!0,e=this._limitZoom(e),this.fire("viewprereset");var n=this._zoom!==e;this._moveStart(n,i)._move(t,e)._moveEnd(n),this.fire("viewreset"),r&&this.fire("load")},_moveStart:function(t,e){return t&&this.fire("zoomstart"),e||this.fire("movestart"),this},_move:function(t,e,i,r){void 0===e&&(e=this._zoom);var n=this._zoom!==e;return this._zoom=e,this._lastCenter=t,this._pixelOrigin=this._getNewPixelOrigin(t),r?i&&i.pinch&&this.fire("zoom",i):((n||i&&i.pinch)&&this.fire("zoom",i),this.fire("move",i)),this},_moveEnd:function(t){return t&&this.fire("zoomend"),this.fire("moveend")},_stop:function(){return E(this._flyToFrame),this._panAnim&&this._panAnim.stop(),this},_rawPanBy:function(t){Ie(this._mapPane,this._getMapPanePos().subtract(t))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_panInsideMaxBounds:function(){this._enforcingBounds||this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(t){this._targets={},this._targets[s(this._container)]=this;var e=t?Qe:Oe;e(this._container,"click dblclick mousedown mouseup mouseover mouseout mousemove contextmenu keypress keydown keyup",this._handleDOMEvent,this),this.options.trackResize&&e(window,"resize",this._onResize,this),Ut.any3d&&this.options.transform3DLimit&&(t?this.off:this.on).call(this,"moveend",this._onMoveEnd)},_onResize:function(){E(this._resizeRequest),this._resizeRequest=B((function(){this.invalidateSize({debounceMoveend:!0})}),this)},_onScroll:function(){this._container.scrollTop=0,this._container.scrollLeft=0},_onMoveEnd:function(){var t=this._getMapPanePos();Math.max(Math.abs(t.x),Math.abs(t.y))>=this.options.transform3DLimit&&this._resetView(this.getCenter(),this.getZoom())},_findEventTargets:function(t,e){for(var i,r=[],n="mouseout"===e||"mouseover"===e,o=t.target||t.srcElement,a=!1;o;){if((i=this._targets[s(o)])&&("click"===e||"preclick"===e)&&this._draggableMoved(i)){a=!0;break}if(i&&i.listens(e,!0)){if(n&&!ei(o,t))break;if(r.push(i),n)break}if(o===this._container)break;o=o.parentNode}return r.length||a||n||!this.listens(e,!0)||(r=[this]),r},_isClickDisabled:function(t){for(;t&&t!==this._container;){if(t._leaflet_disable_click)return!0;t=t.parentNode}},_handleDOMEvent:function(t){var e=t.target||t.srcElement;if(!(!this._loaded||e._leaflet_disable_events||"click"===t.type&&this._isClickDisabled(e))){var i=t.type;"mousedown"===i&&ze(e),this._fireDOMEvent(t,i)}},_mouseEvents:["click","dblclick","mouseover","mouseout","contextmenu"],_fireDOMEvent:function(t,e,r){if("click"===t.type){var n=i({},t);n.type="preclick",this._fireDOMEvent(n,n.type,r)}var o=this._findEventTargets(t,e);if(r){for(var s=[],a=0;a<r.length;a++)r[a].listens(e,!0)&&s.push(r[a]);o=s.concat(o)}if(o.length){"contextmenu"===e&&Ke(t);var l=o[0],c={originalEvent:t};if("keypress"!==t.type&&"keydown"!==t.type&&"keyup"!==t.type){var u=l.getLatLng&&(!l._radius||l._radius<=10);c.containerPoint=u?this.latLngToContainerPoint(l.getLatLng()):this.mouseEventToContainerPoint(t),c.layerPoint=this.containerPointToLayerPoint(c.containerPoint),c.latlng=u?l.getLatLng():this.layerPointToLatLng(c.layerPoint)}for(a=0;a<o.length;a++)if(o[a].fire(e,c,!0),c.originalEvent._stopped||!1===o[a].options.bubblingMouseEvents&&-1!==_(this._mouseEvents,e))return}},_draggableMoved:function(t){return(t=t.dragging&&t.dragging.enabled()?t:this).dragging&&t.dragging.moved()||this.boxZoom&&this.boxZoom.moved()},_clearHandlers:function(){for(var t=0,e=this._handlers.length;t<e;t++)this._handlers[t].disable()},whenReady:function(t,e){return this._loaded?t.call(e||this,{target:this}):this.on("load",t,e),this},_getMapPanePos:function(){return Me(this._mapPane)||new P(0,0)},_moved:function(){var t=this._getMapPanePos();return t&&!t.equals([0,0])},_getTopLeftPoint:function(t,e){return(t&&void 0!==e?this._getNewPixelOrigin(t,e):this.getPixelOrigin()).subtract(this._getMapPanePos())},_getNewPixelOrigin:function(t,e){var i=this.getSize()._divideBy(2);return this.project(t,e)._subtract(i)._add(this._getMapPanePos())._round()},_latLngToNewLayerPoint:function(t,e,i){var r=this._getNewPixelOrigin(i,e);return this.project(t,e)._subtract(r)},_latLngBoundsToNewLayerBounds:function(t,e,i){var r=this._getNewPixelOrigin(i,e);return R([this.project(t.getSouthWest(),e)._subtract(r),this.project(t.getNorthWest(),e)._subtract(r),this.project(t.getSouthEast(),e)._subtract(r),this.project(t.getNorthEast(),e)._subtract(r)])},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(t){return this.latLngToLayerPoint(t).subtract(this._getCenterLayerPoint())},_limitCenter:function(t,e,i){if(!i)return t;var r=this.project(t,e),n=this.getSize().divideBy(2),o=new D(r.subtract(n),r.add(n)),s=this._getBoundsOffset(o,i,e);return Math.abs(s.x)<=1&&Math.abs(s.y)<=1?t:this.unproject(r.add(s),e)},_limitOffset:function(t,e){if(!e)return t;var i=this.getPixelBounds(),r=new D(i.min.add(t),i.max.add(t));return t.add(this._getBoundsOffset(r,e))},_getBoundsOffset:function(t,e,i){var r=R(this.project(e.getNorthEast(),i),this.project(e.getSouthWest(),i)),n=r.min.subtract(t.min),o=r.max.subtract(t.max);return new P(this._rebound(n.x,-o.x),this._rebound(n.y,-o.y))},_rebound:function(t,e){return t+e>0?Math.round(t-e)/2:Math.max(0,Math.ceil(t))-Math.max(0,Math.floor(e))},_limitZoom:function(t){var e=this.getMinZoom(),i=this.getMaxZoom(),r=Ut.any3d?this.options.zoomSnap:1;return r&&(t=Math.round(t/r)*r),Math.max(e,Math.min(i,t))},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){be(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(t,e){var i=this._getCenterOffset(t)._trunc();return!(!0!==(e&&e.animate)&&!this.getSize().contains(i)||(this.panBy(i,e),0))},_createAnimProxy:function(){var t=this._proxy=Ae("div","leaflet-proxy leaflet-zoom-animated");this._panes.mapPane.appendChild(t),this.on("zoomanim",(function(t){var e=ue,i=this._proxy.style[e];Se(this._proxy,this.project(t.center,t.zoom),this.getZoomScale(t.zoom,1)),i===this._proxy.style[e]&&this._animatingZoom&&this._onZoomTransitionEnd()}),this),this.on("load moveend",this._animMoveEnd,this),this._on("unload",this._destroyAnimProxy,this)},_destroyAnimProxy:function(){me(this._proxy),this.off("load moveend",this._animMoveEnd,this),delete this._proxy},_animMoveEnd:function(){var t=this.getCenter(),e=this.getZoom();Se(this._proxy,this.project(t,e),this.getZoomScale(e,1))},_catchTransitionEnd:function(t){this._animatingZoom&&t.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(t,e,i){if(this._animatingZoom)return!0;if(i=i||{},!this._zoomAnimated||!1===i.animate||this._nothingToAnimate()||Math.abs(e-this._zoom)>this.options.zoomAnimationThreshold)return!1;var r=this.getZoomScale(e),n=this._getCenterOffset(t)._divideBy(1-1/r);return!(!0!==i.animate&&!this.getSize().contains(n)||(B((function(){this._moveStart(!0,i.noMoveStart||!1)._animateZoom(t,e,!0)}),this),0))},_animateZoom:function(t,e,i,r){this._mapPane&&(i&&(this._animatingZoom=!0,this._animateToCenter=t,this._animateToZoom=e,xe(this._mapPane,"leaflet-zoom-anim")),this.fire("zoomanim",{center:t,zoom:e,noUpdate:r}),this._tempFireZoomEvent||(this._tempFireZoomEvent=this._zoom!==this._animateToZoom),this._move(this._animateToCenter,this._animateToZoom,void 0,!0),setTimeout(n(this._onZoomTransitionEnd,this),250))},_onZoomTransitionEnd:function(){this._animatingZoom&&(this._mapPane&&be(this._mapPane,"leaflet-zoom-anim"),this._animatingZoom=!1,this._move(this._animateToCenter,this._animateToZoom,void 0,!0),this._tempFireZoomEvent&&this.fire("zoom"),delete this._tempFireZoomEvent,this.fire("move"),this._moveEnd(!0))}});function oi(t,e){return new ni(t,e)}var si=S.extend({options:{position:"topright"},initialize:function(t){p(this,t)},getPosition:function(){return this.options.position},setPosition:function(t){var e=this._map;return e&&e.removeControl(this),this.options.position=t,e&&e.addControl(this),this},getContainer:function(){return this._container},addTo:function(t){this.remove(),this._map=t;var e=this._container=this.onAdd(t),i=this.getPosition(),r=t._controlCorners[i];return xe(e,"leaflet-control"),-1!==i.indexOf("bottom")?r.insertBefore(e,r.firstChild):r.appendChild(e),this._map.on("unload",this.remove,this),this},remove:function(){return this._map?(me(this._container),this.onRemove&&this.onRemove(this._map),this._map.off("unload",this.remove,this),this._map=null,this):this},_refocusOnMap:function(t){this._map&&t&&t.screenX>0&&t.screenY>0&&this._map.getContainer().focus()}}),ai=function(t){return new si(t)};ni.include({addControl:function(t){return t.addTo(this),this},removeControl:function(t){return t.remove(),this},_initControlPos:function(){var t=this._controlCorners={},e="leaflet-",i=this._controlContainer=Ae("div",e+"control-container",this._container);function r(r,n){var o=e+r+" "+e+n;t[r+n]=Ae("div",o,i)}r("top","left"),r("top","right"),r("bottom","left"),r("bottom","right")},_clearControlPos:function(){for(var t in this._controlCorners)me(this._controlCorners[t]);me(this._controlContainer),delete this._controlCorners,delete this._controlContainer}});var li=si.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,sortFunction:function(t,e,i,r){return i<r?-1:r<i?1:0}},initialize:function(t,e,i){for(var r in p(this,i),this._layerControlInputs=[],this._layers=[],this._lastZIndex=0,this._handlingClick=!1,this._preventClick=!1,t)this._addLayer(t[r],r);for(r in e)this._addLayer(e[r],r,!0)},onAdd:function(t){this._initLayout(),this._update(),this._map=t,t.on("zoomend",this._checkDisabledLayers,this);for(var e=0;e<this._layers.length;e++)this._layers[e].layer.on("add remove",this._onLayerChange,this);return this._container},addTo:function(t){return si.prototype.addTo.call(this,t),this._expandIfNotCollapsed()},onRemove:function(){this._map.off("zoomend",this._checkDisabledLayers,this);for(var t=0;t<this._layers.length;t++)this._layers[t].layer.off("add remove",this._onLayerChange,this)},addBaseLayer:function(t,e){return this._addLayer(t,e),this._map?this._update():this},addOverlay:function(t,e){return this._addLayer(t,e,!0),this._map?this._update():this},removeLayer:function(t){t.off("add remove",this._onLayerChange,this);var e=this._getLayer(s(t));return e&&this._layers.splice(this._layers.indexOf(e),1),this._map?this._update():this},expand:function(){xe(this._container,"leaflet-control-layers-expanded"),this._section.style.height=null;var t=this._map.getSize().y-(this._container.offsetTop+50);return t<this._section.clientHeight?(xe(this._section,"leaflet-control-layers-scrollbar"),this._section.style.height=t+"px"):be(this._section,"leaflet-control-layers-scrollbar"),this._checkDisabledLayers(),this},collapse:function(){return be(this._container,"leaflet-control-layers-expanded"),this},_initLayout:function(){var t="leaflet-control-layers",e=this._container=Ae("div",t),i=this.options.collapsed;e.setAttribute("aria-haspopup",!0),qe(e),Ze(e);var r=this._section=Ae("section",t+"-list");i&&(this._map.on("click",this.collapse,this),Oe(e,{mouseenter:this._expandSafely,mouseleave:this.collapse},this));var n=this._layersLink=Ae("a",t+"-toggle",e);n.href="#",n.title="Layers",n.setAttribute("role","button"),Oe(n,{keydown:function(t){13===t.keyCode&&this._expandSafely()},click:function(t){Ke(t),this._expandSafely()}},this),i||this.expand(),this._baseLayersList=Ae("div",t+"-base",r),this._separator=Ae("div",t+"-separator",r),this._overlaysList=Ae("div",t+"-overlays",r),e.appendChild(r)},_getLayer:function(t){for(var e=0;e<this._layers.length;e++)if(this._layers[e]&&s(this._layers[e].layer)===t)return this._layers[e]},_addLayer:function(t,e,i){this._map&&t.on("add remove",this._onLayerChange,this),this._layers.push({layer:t,name:e,overlay:i}),this.options.sortLayers&&this._layers.sort(n((function(t,e){return this.options.sortFunction(t.layer,e.layer,t.name,e.name)}),this)),this.options.autoZIndex&&t.setZIndex&&(this._lastZIndex++,t.setZIndex(this._lastZIndex)),this._expandIfNotCollapsed()},_update:function(){if(!this._container)return this;ge(this._baseLayersList),ge(this._overlaysList),this._layerControlInputs=[];var t,e,i,r,n=0;for(i=0;i<this._layers.length;i++)r=this._layers[i],this._addItem(r),e=e||r.overlay,t=t||!r.overlay,n+=r.overlay?0:1;return this.options.hideSingleBase&&(t=t&&n>1,this._baseLayersList.style.display=t?"":"none"),this._separator.style.display=e&&t?"":"none",this},_onLayerChange:function(t){this._handlingClick||this._update();var e=this._getLayer(s(t.target)),i=e.overlay?"add"===t.type?"overlayadd":"overlayremove":"add"===t.type?"baselayerchange":null;i&&this._map.fire(i,e)},_createRadioElement:function(t,e){var i='<input type="radio" class="leaflet-control-layers-selector" name="'+t+'"'+(e?' checked="checked"':"")+"/>",r=document.createElement("div");return r.innerHTML=i,r.firstChild},_addItem:function(t){var e,i=document.createElement("label"),r=this._map.hasLayer(t.layer);t.overlay?((e=document.createElement("input")).type="checkbox",e.className="leaflet-control-layers-selector",e.defaultChecked=r):e=this._createRadioElement("leaflet-base-layers_"+s(this),r),this._layerControlInputs.push(e),e.layerId=s(t.layer),Oe(e,"click",this._onInputClick,this);var n=document.createElement("span");n.innerHTML=" "+t.name;var o=document.createElement("span");return i.appendChild(o),o.appendChild(e),o.appendChild(n),(t.overlay?this._overlaysList:this._baseLayersList).appendChild(i),this._checkDisabledLayers(),i},_onInputClick:function(){if(!this._preventClick){var t,e,i=this._layerControlInputs,r=[],n=[];this._handlingClick=!0;for(var o=i.length-1;o>=0;o--)t=i[o],e=this._getLayer(t.layerId).layer,t.checked?r.push(e):t.checked||n.push(e);for(o=0;o<n.length;o++)this._map.hasLayer(n[o])&&this._map.removeLayer(n[o]);for(o=0;o<r.length;o++)this._map.hasLayer(r[o])||this._map.addLayer(r[o]);this._handlingClick=!1,this._refocusOnMap()}},_checkDisabledLayers:function(){for(var t,e,i=this._layerControlInputs,r=this._map.getZoom(),n=i.length-1;n>=0;n--)t=i[n],e=this._getLayer(t.layerId).layer,t.disabled=void 0!==e.options.minZoom&&r<e.options.minZoom||void 0!==e.options.maxZoom&&r>e.options.maxZoom},_expandIfNotCollapsed:function(){return this._map&&!this.options.collapsed&&this.expand(),this},_expandSafely:function(){var t=this._section;this._preventClick=!0,Oe(t,"click",Ke),this.expand();var e=this;setTimeout((function(){Qe(t,"click",Ke),e._preventClick=!1}))}}),ci=function(t,e,i){return new li(t,e,i)},ui=si.extend({options:{position:"topleft",zoomInText:'<span aria-hidden="true">+</span>',zoomInTitle:"Zoom in",zoomOutText:'<span aria-hidden="true">&#x2212;</span>',zoomOutTitle:"Zoom out"},onAdd:function(t){var e="leaflet-control-zoom",i=Ae("div",e+" leaflet-bar"),r=this.options;return this._zoomInButton=this._createButton(r.zoomInText,r.zoomInTitle,e+"-in",i,this._zoomIn),this._zoomOutButton=this._createButton(r.zoomOutText,r.zoomOutTitle,e+"-out",i,this._zoomOut),this._updateDisabled(),t.on("zoomend zoomlevelschange",this._updateDisabled,this),i},onRemove:function(t){t.off("zoomend zoomlevelschange",this._updateDisabled,this)},disable:function(){return this._disabled=!0,this._updateDisabled(),this},enable:function(){return this._disabled=!1,this._updateDisabled(),this},_zoomIn:function(t){!this._disabled&&this._map._zoom<this._map.getMaxZoom()&&this._map.zoomIn(this._map.options.zoomDelta*(t.shiftKey?3:1))},_zoomOut:function(t){!this._disabled&&this._map._zoom>this._map.getMinZoom()&&this._map.zoomOut(this._map.options.zoomDelta*(t.shiftKey?3:1))},_createButton:function(t,e,i,r,n){var o=Ae("a",i,r);return o.innerHTML=t,o.href="#",o.title=e,o.setAttribute("role","button"),o.setAttribute("aria-label",e),qe(o),Oe(o,"click",We),Oe(o,"click",n,this),Oe(o,"click",this._refocusOnMap,this),o},_updateDisabled:function(){var t=this._map,e="leaflet-disabled";be(this._zoomInButton,e),be(this._zoomOutButton,e),this._zoomInButton.setAttribute("aria-disabled","false"),this._zoomOutButton.setAttribute("aria-disabled","false"),(this._disabled||t._zoom===t.getMinZoom())&&(xe(this._zoomOutButton,e),this._zoomOutButton.setAttribute("aria-disabled","true")),(this._disabled||t._zoom===t.getMaxZoom())&&(xe(this._zoomInButton,e),this._zoomInButton.setAttribute("aria-disabled","true"))}});ni.mergeOptions({zoomControl:!0}),ni.addInitHook((function(){this.options.zoomControl&&(this.zoomControl=new ui,this.addControl(this.zoomControl))}));var hi=function(t){return new ui(t)},di=si.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0},onAdd:function(t){var e="leaflet-control-scale",i=Ae("div",e),r=this.options;return this._addScales(r,e+"-line",i),t.on(r.updateWhenIdle?"moveend":"move",this._update,this),t.whenReady(this._update,this),i},onRemove:function(t){t.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(t,e,i){t.metric&&(this._mScale=Ae("div",e,i)),t.imperial&&(this._iScale=Ae("div",e,i))},_update:function(){var t=this._map,e=t.getSize().y/2,i=t.distance(t.containerPointToLatLng([0,e]),t.containerPointToLatLng([this.options.maxWidth,e]));this._updateScales(i)},_updateScales:function(t){this.options.metric&&t&&this._updateMetric(t),this.options.imperial&&t&&this._updateImperial(t)},_updateMetric:function(t){var e=this._getRoundNum(t),i=e<1e3?e+" m":e/1e3+" km";this._updateScale(this._mScale,i,e/t)},_updateImperial:function(t){var e,i,r,n=3.2808399*t;n>5280?(e=n/5280,i=this._getRoundNum(e),this._updateScale(this._iScale,i+" mi",i/e)):(r=this._getRoundNum(n),this._updateScale(this._iScale,r+" ft",r/n))},_updateScale:function(t,e,i){t.style.width=Math.round(this.options.maxWidth*i)+"px",t.innerHTML=e},_getRoundNum:function(t){var e=Math.pow(10,(Math.floor(t)+"").length-1),i=t/e;return e*(i=i>=10?10:i>=5?5:i>=3?3:i>=2?2:1)}}),pi=function(t){return new di(t)},fi='<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="12" height="8" viewBox="0 0 12 8" class="leaflet-attribution-flag"><path fill="#4C7BE1" d="M0 0h12v4H0z"/><path fill="#FFD500" d="M0 4h12v3H0z"/><path fill="#E0BC00" d="M0 7h12v1H0z"/></svg>',Ai=si.extend({options:{position:"bottomright",prefix:'<a href="https://leafletjs.com" title="A JavaScript library for interactive maps">'+(Ut.inlineSvg?fi+" ":"")+"Leaflet</a>"},initialize:function(t){p(this,t),this._attributions={}},onAdd:function(t){for(var e in t.attributionControl=this,this._container=Ae("div","leaflet-control-attribution"),qe(this._container),t._layers)t._layers[e].getAttribution&&this.addAttribution(t._layers[e].getAttribution());return this._update(),t.on("layeradd",this._addAttribution,this),this._container},onRemove:function(t){t.off("layeradd",this._addAttribution,this)},_addAttribution:function(t){t.layer.getAttribution&&(this.addAttribution(t.layer.getAttribution()),t.layer.once("remove",(function(){this.removeAttribution(t.layer.getAttribution())}),this))},setPrefix:function(t){return this.options.prefix=t,this._update(),this},addAttribution:function(t){return t?(this._attributions[t]||(this._attributions[t]=0),this._attributions[t]++,this._update(),this):this},removeAttribution:function(t){return t?(this._attributions[t]&&(this._attributions[t]--,this._update()),this):this},_update:function(){if(this._map){var t=[];for(var e in this._attributions)this._attributions[e]&&t.push(e);var i=[];this.options.prefix&&i.push(this.options.prefix),t.length&&i.push(t.join(", ")),this._container.innerHTML=i.join(' <span aria-hidden="true">|</span> ')}}});ni.mergeOptions({attributionControl:!0}),ni.addInitHook((function(){this.options.attributionControl&&(new Ai).addTo(this)}));var mi=function(t){return new Ai(t)};si.Layers=li,si.Zoom=ui,si.Scale=di,si.Attribution=Ai,ai.layers=ci,ai.zoom=hi,ai.scale=pi,ai.attribution=mi;var gi=S.extend({initialize:function(t){this._map=t},enable:function(){return this._enabled||(this._enabled=!0,this.addHooks()),this},disable:function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},enabled:function(){return!!this._enabled}});gi.addTo=function(t,e){return t.addHandler(e,this),this};var _i={Events:M},yi=Ut.touch?"touchstart mousedown":"mousedown",vi=k.extend({options:{clickTolerance:3},initialize:function(t,e,i,r){p(this,r),this._element=t,this._dragStartTarget=e||t,this._preventOutline=i},enable:function(){this._enabled||(Oe(this._dragStartTarget,yi,this._onDown,this),this._enabled=!0)},disable:function(){this._enabled&&(vi._dragging===this&&this.finishDrag(!0),Qe(this._dragStartTarget,yi,this._onDown,this),this._enabled=!1,this._moved=!1)},_onDown:function(t){if(this._enabled&&(this._moved=!1,!ve(this._element,"leaflet-zoom-anim")))if(t.touches&&1!==t.touches.length)vi._dragging===this&&this.finishDrag();else if(!(vi._dragging||t.shiftKey||1!==t.which&&1!==t.button&&!t.touches||(vi._dragging=this,this._preventOutline&&ze(this._element),Pe(),oe(),this._moving))){this.fire("down");var e=t.touches?t.touches[0]:t,i=De(this._element);this._startPoint=new P(e.clientX,e.clientY),this._startPos=Me(this._element),this._parentScale=Re(i);var r="mousedown"===t.type;Oe(document,r?"mousemove":"touchmove",this._onMove,this),Oe(document,r?"mouseup":"touchend touchcancel",this._onUp,this)}},_onMove:function(t){if(this._enabled)if(t.touches&&t.touches.length>1)this._moved=!0;else{var e=t.touches&&1===t.touches.length?t.touches[0]:t,i=new P(e.clientX,e.clientY)._subtract(this._startPoint);(i.x||i.y)&&(Math.abs(i.x)+Math.abs(i.y)<this.options.clickTolerance||(i.x/=this._parentScale.x,i.y/=this._parentScale.y,Ke(t),this._moved||(this.fire("dragstart"),this._moved=!0,xe(document.body,"leaflet-dragging"),this._lastTarget=t.target||t.srcElement,window.SVGElementInstance&&this._lastTarget instanceof window.SVGElementInstance&&(this._lastTarget=this._lastTarget.correspondingUseElement),xe(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(i),this._moving=!0,this._lastEvent=t,this._updatePosition()))}},_updatePosition:function(){var t={originalEvent:this._lastEvent};this.fire("predrag",t),Ie(this._element,this._newPos),this.fire("drag",t)},_onUp:function(){this._enabled&&this.finishDrag()},finishDrag:function(t){be(document.body,"leaflet-dragging"),this._lastTarget&&(be(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null),Qe(document,"mousemove touchmove",this._onMove,this),Qe(document,"mouseup touchend touchcancel",this._onUp,this),Le(),se();var e=this._moved&&this._moving;this._moving=!1,vi._dragging=!1,e&&this.fire("dragend",{noInertia:t,distance:this._newPos.distanceTo(this._startPos)})}});function xi(t,e,i){var r,n,o,s,a,l,c,u,h,d=[1,4,2,8];for(n=0,c=t.length;n<c;n++)t[n]._code=zi(t[n],e);for(s=0;s<4;s++){for(u=d[s],r=[],n=0,o=(c=t.length)-1;n<c;o=n++)a=t[n],l=t[o],a._code&u?l._code&u||((h=Li(l,a,u,e,i))._code=zi(h,e),r.push(h)):(l._code&u&&((h=Li(l,a,u,e,i))._code=zi(h,e),r.push(h)),r.push(a));t=r}return t}function bi(t,e){var i,r,n,o,s,a,l,c,u;if(!t||0===t.length)throw new Error("latlngs not passed");Ri(t)||(console.warn("latlngs are not flat! Only the first ring will be used"),t=t[0]);var h=Q([0,0]),d=O(t);d.getNorthWest().distanceTo(d.getSouthWest())*d.getNorthEast().distanceTo(d.getNorthWest())<1700&&(h=wi(t));var p=t.length,f=[];for(i=0;i<p;i++){var A=Q(t[i]);f.push(e.project(Q([A.lat-h.lat,A.lng-h.lng])))}for(a=l=c=0,i=0,r=p-1;i<p;r=i++)n=f[i],o=f[r],s=n.y*o.x-o.y*n.x,l+=(n.x+o.x)*s,c+=(n.y+o.y)*s,a+=3*s;u=0===a?f[0]:[l/a,c/a];var m=e.unproject(F(u));return Q([m.lat+h.lat,m.lng+h.lng])}function wi(t){for(var e=0,i=0,r=0,n=0;n<t.length;n++){var o=Q(t[n]);e+=o.lat,i+=o.lng,r++}return Q([e/r,i/r])}var Ti,Bi={__proto__:null,clipPolygon:xi,polygonCenter:bi,centroid:wi};function Ei(t,e){if(!e||!t.length)return t.slice();var i=e*e;return t=Ii(t=ki(t,i),i)}function Ci(t,e,i){return Math.sqrt(Di(t,e,i,!0))}function Si(t,e,i){return Di(t,e,i)}function Ii(t,e){var i=t.length,r=new(typeof Uint8Array!=void 0+""?Uint8Array:Array)(i);r[0]=r[i-1]=1,Mi(t,r,e,0,i-1);var n,o=[];for(n=0;n<i;n++)r[n]&&o.push(t[n]);return o}function Mi(t,e,i,r,n){var o,s,a,l=0;for(s=r+1;s<=n-1;s++)(a=Di(t[s],t[r],t[n],!0))>l&&(o=s,l=a);l>i&&(e[o]=1,Mi(t,e,i,r,o),Mi(t,e,i,o,n))}function ki(t,e){for(var i=[t[0]],r=1,n=0,o=t.length;r<o;r++)Fi(t[r],t[n])>e&&(i.push(t[r]),n=r);return n<o-1&&i.push(t[o-1]),i}function Pi(t,e,i,r,n){var o,s,a,l=r?Ti:zi(t,i),c=zi(e,i);for(Ti=c;;){if(!(l|c))return[t,e];if(l&c)return!1;a=zi(s=Li(t,e,o=l||c,i,n),i),o===l?(t=s,l=a):(e=s,c=a)}}function Li(t,e,i,r,n){var o,s,a=e.x-t.x,l=e.y-t.y,c=r.min,u=r.max;return 8&i?(o=t.x+a*(u.y-t.y)/l,s=u.y):4&i?(o=t.x+a*(c.y-t.y)/l,s=c.y):2&i?(o=u.x,s=t.y+l*(u.x-t.x)/a):1&i&&(o=c.x,s=t.y+l*(c.x-t.x)/a),new P(o,s,n)}function zi(t,e){var i=0;return t.x<e.min.x?i|=1:t.x>e.max.x&&(i|=2),t.y<e.min.y?i|=4:t.y>e.max.y&&(i|=8),i}function Fi(t,e){var i=e.x-t.x,r=e.y-t.y;return i*i+r*r}function Di(t,e,i,r){var n,o=e.x,s=e.y,a=i.x-o,l=i.y-s,c=a*a+l*l;return c>0&&((n=((t.x-o)*a+(t.y-s)*l)/c)>1?(o=i.x,s=i.y):n>0&&(o+=a*n,s+=l*n)),a=t.x-o,l=t.y-s,r?a*a+l*l:new P(o,s)}function Ri(t){return!g(t[0])||"object"!=typeof t[0][0]&&void 0!==t[0][0]}function Ui(t){return console.warn("Deprecated use of _flat, please use L.LineUtil.isFlat instead."),Ri(t)}function Oi(t,e){var i,r,n,o,s,a,l,c;if(!t||0===t.length)throw new Error("latlngs not passed");Ri(t)||(console.warn("latlngs are not flat! Only the first ring will be used"),t=t[0]);var u=Q([0,0]),h=O(t);h.getNorthWest().distanceTo(h.getSouthWest())*h.getNorthEast().distanceTo(h.getNorthWest())<1700&&(u=wi(t));var d=t.length,p=[];for(i=0;i<d;i++){var f=Q(t[i]);p.push(e.project(Q([f.lat-u.lat,f.lng-u.lng])))}for(i=0,r=0;i<d-1;i++)r+=p[i].distanceTo(p[i+1])/2;if(0===r)c=p[0];else for(i=0,o=0;i<d-1;i++)if(s=p[i],a=p[i+1],(o+=n=s.distanceTo(a))>r){l=(o-r)/n,c=[a.x-l*(a.x-s.x),a.y-l*(a.y-s.y)];break}var A=e.unproject(F(c));return Q([A.lat+u.lat,A.lng+u.lng])}var Ni={__proto__:null,simplify:Ei,pointToSegmentDistance:Ci,closestPointOnSegment:Si,clipSegment:Pi,_getEdgeIntersection:Li,_getBitCode:zi,_sqClosestPointOnSegment:Di,isFlat:Ri,_flat:Ui,polylineCenter:Oi},Qi={project:function(t){return new P(t.lng,t.lat)},unproject:function(t){return new N(t.y,t.x)},bounds:new D([-180,-90],[180,90])},Vi={R:6378137,R_MINOR:6356752.314245179,bounds:new D([-20037508.34279,-15496570.73972],[20037508.34279,18764656.23138]),project:function(t){var e=Math.PI/180,i=this.R,r=t.lat*e,n=this.R_MINOR/i,o=Math.sqrt(1-n*n),s=o*Math.sin(r),a=Math.tan(Math.PI/4-r/2)/Math.pow((1-s)/(1+s),o/2);return r=-i*Math.log(Math.max(a,1e-10)),new P(t.lng*e*i,r)},unproject:function(t){for(var e,i=180/Math.PI,r=this.R,n=this.R_MINOR/r,o=Math.sqrt(1-n*n),s=Math.exp(-t.y/r),a=Math.PI/2-2*Math.atan(s),l=0,c=.1;l<15&&Math.abs(c)>1e-7;l++)e=o*Math.sin(a),e=Math.pow((1-e)/(1+e),o/2),a+=c=Math.PI/2-2*Math.atan(s*e)-a;return new N(a*i,t.x*i/r)}},ji={__proto__:null,LonLat:Qi,Mercator:Vi,SphericalMercator:$},Hi=i({},H,{code:"EPSG:3395",projection:Vi,transformation:function(){var t=.5/(Math.PI*Vi.R);return q(t,.5,-t,.5)}()}),Gi=i({},H,{code:"EPSG:4326",projection:Qi,transformation:q(1/180,1,-1/180,.5)}),$i=i({},j,{projection:Qi,transformation:q(1,0,-1,0),scale:function(t){return Math.pow(2,t)},zoom:function(t){return Math.log(t)/Math.LN2},distance:function(t,e){var i=e.lng-t.lng,r=e.lat-t.lat;return Math.sqrt(i*i+r*r)},infinite:!0});j.Earth=H,j.EPSG3395=Hi,j.EPSG3857=K,j.EPSG900913=W,j.EPSG4326=Gi,j.Simple=$i;var Zi=k.extend({options:{pane:"overlayPane",attribution:null,bubblingMouseEvents:!0},addTo:function(t){return t.addLayer(this),this},remove:function(){return this.removeFrom(this._map||this._mapToAdd)},removeFrom:function(t){return t&&t.removeLayer(this),this},getPane:function(t){return this._map.getPane(t?this.options[t]||t:this.options.pane)},addInteractiveTarget:function(t){return this._map._targets[s(t)]=this,this},removeInteractiveTarget:function(t){return delete this._map._targets[s(t)],this},getAttribution:function(){return this.options.attribution},_layerAdd:function(t){var e=t.target;if(e.hasLayer(this)){if(this._map=e,this._zoomAnimated=e._zoomAnimated,this.getEvents){var i=this.getEvents();e.on(i,this),this.once("remove",(function(){e.off(i,this)}),this)}this.onAdd(e),this.fire("add"),e.fire("layeradd",{layer:this})}}});ni.include({addLayer:function(t){if(!t._layerAdd)throw new Error("The provided object is not a Layer.");var e=s(t);return this._layers[e]||(this._layers[e]=t,t._mapToAdd=this,t.beforeAdd&&t.beforeAdd(this),this.whenReady(t._layerAdd,t)),this},removeLayer:function(t){var e=s(t);return this._layers[e]?(this._loaded&&t.onRemove(this),delete this._layers[e],this._loaded&&(this.fire("layerremove",{layer:t}),t.fire("remove")),t._map=t._mapToAdd=null,this):this},hasLayer:function(t){return s(t)in this._layers},eachLayer:function(t,e){for(var i in this._layers)t.call(e,this._layers[i]);return this},_addLayers:function(t){for(var e=0,i=(t=t?g(t)?t:[t]:[]).length;e<i;e++)this.addLayer(t[e])},_addZoomLimit:function(t){isNaN(t.options.maxZoom)&&isNaN(t.options.minZoom)||(this._zoomBoundLayers[s(t)]=t,this._updateZoomLevels())},_removeZoomLimit:function(t){var e=s(t);this._zoomBoundLayers[e]&&(delete this._zoomBoundLayers[e],this._updateZoomLevels())},_updateZoomLevels:function(){var t=1/0,e=-1/0,i=this._getZoomSpan();for(var r in this._zoomBoundLayers){var n=this._zoomBoundLayers[r].options;t=void 0===n.minZoom?t:Math.min(t,n.minZoom),e=void 0===n.maxZoom?e:Math.max(e,n.maxZoom)}this._layersMaxZoom=e===-1/0?void 0:e,this._layersMinZoom=t===1/0?void 0:t,i!==this._getZoomSpan()&&this.fire("zoomlevelschange"),void 0===this.options.maxZoom&&this._layersMaxZoom&&this.getZoom()>this._layersMaxZoom&&this.setZoom(this._layersMaxZoom),void 0===this.options.minZoom&&this._layersMinZoom&&this.getZoom()<this._layersMinZoom&&this.setZoom(this._layersMinZoom)}});var qi=Zi.extend({initialize:function(t,e){var i,r;if(p(this,e),this._layers={},t)for(i=0,r=t.length;i<r;i++)this.addLayer(t[i])},addLayer:function(t){var e=this.getLayerId(t);return this._layers[e]=t,this._map&&this._map.addLayer(t),this},removeLayer:function(t){var e=t in this._layers?t:this.getLayerId(t);return this._map&&this._layers[e]&&this._map.removeLayer(this._layers[e]),delete this._layers[e],this},hasLayer:function(t){return("number"==typeof t?t:this.getLayerId(t))in this._layers},clearLayers:function(){return this.eachLayer(this.removeLayer,this)},invoke:function(t){var e,i,r=Array.prototype.slice.call(arguments,1);for(e in this._layers)(i=this._layers[e])[t]&&i[t].apply(i,r);return this},onAdd:function(t){this.eachLayer(t.addLayer,t)},onRemove:function(t){this.eachLayer(t.removeLayer,t)},eachLayer:function(t,e){for(var i in this._layers)t.call(e,this._layers[i]);return this},getLayer:function(t){return this._layers[t]},getLayers:function(){var t=[];return this.eachLayer(t.push,t),t},setZIndex:function(t){return this.invoke("setZIndex",t)},getLayerId:function(t){return s(t)}}),Ki=function(t,e){return new qi(t,e)},Wi=qi.extend({addLayer:function(t){return this.hasLayer(t)?this:(t.addEventParent(this),qi.prototype.addLayer.call(this,t),this.fire("layeradd",{layer:t}))},removeLayer:function(t){return this.hasLayer(t)?(t in this._layers&&(t=this._layers[t]),t.removeEventParent(this),qi.prototype.removeLayer.call(this,t),this.fire("layerremove",{layer:t})):this},setStyle:function(t){return this.invoke("setStyle",t)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var t=new U;for(var e in this._layers){var i=this._layers[e];t.extend(i.getBounds?i.getBounds():i.getLatLng())}return t}}),Xi=function(t,e){return new Wi(t,e)},Ji=S.extend({options:{popupAnchor:[0,0],tooltipAnchor:[0,0],crossOrigin:!1},initialize:function(t){p(this,t)},createIcon:function(t){return this._createIcon("icon",t)},createShadow:function(t){return this._createIcon("shadow",t)},_createIcon:function(t,e){var i=this._getIconUrl(t);if(!i){if("icon"===t)throw new Error("iconUrl not set in Icon options (see the docs).");return null}var r=this._createImg(i,e&&"IMG"===e.tagName?e:null);return this._setIconStyles(r,t),(this.options.crossOrigin||""===this.options.crossOrigin)&&(r.crossOrigin=!0===this.options.crossOrigin?"":this.options.crossOrigin),r},_setIconStyles:function(t,e){var i=this.options,r=i[e+"Size"];"number"==typeof r&&(r=[r,r]);var n=F(r),o=F("shadow"===e&&i.shadowAnchor||i.iconAnchor||n&&n.divideBy(2,!0));t.className="leaflet-marker-"+e+" "+(i.className||""),o&&(t.style.marginLeft=-o.x+"px",t.style.marginTop=-o.y+"px"),n&&(t.style.width=n.x+"px",t.style.height=n.y+"px")},_createImg:function(t,e){return(e=e||document.createElement("img")).src=t,e},_getIconUrl:function(t){return Ut.retina&&this.options[t+"RetinaUrl"]||this.options[t+"Url"]}});function Yi(t){return new Ji(t)}var tr=Ji.extend({options:{iconUrl:"marker-icon.png",iconRetinaUrl:"marker-icon-2x.png",shadowUrl:"marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]},_getIconUrl:function(t){return"string"!=typeof tr.imagePath&&(tr.imagePath=this._detectIconPath()),(this.options.imagePath||tr.imagePath)+Ji.prototype._getIconUrl.call(this,t)},_stripUrl:function(t){var e=function(t,e,i){var r=e.exec(t);return r&&r[i]};return(t=e(t,/^url\((['"])?(.+)\1\)$/,2))&&e(t,/^(.*)marker-icon\.png$/,1)},_detectIconPath:function(){var t=Ae("div","leaflet-default-icon-path",document.body),e=fe(t,"background-image")||fe(t,"backgroundImage");if(document.body.removeChild(t),e=this._stripUrl(e))return e;var i=document.querySelector('link[href$="leaflet.css"]');return i?i.href.substring(0,i.href.length-11-1):""}}),er=gi.extend({initialize:function(t){this._marker=t},addHooks:function(){var t=this._marker._icon;this._draggable||(this._draggable=new vi(t,t,!0)),this._draggable.on({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).enable(),xe(t,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).disable(),this._marker._icon&&be(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_adjustPan:function(t){var e=this._marker,i=e._map,r=this._marker.options.autoPanSpeed,n=this._marker.options.autoPanPadding,o=Me(e._icon),s=i.getPixelBounds(),a=i.getPixelOrigin(),l=R(s.min._subtract(a).add(n),s.max._subtract(a).subtract(n));if(!l.contains(o)){var c=F((Math.max(l.max.x,o.x)-l.max.x)/(s.max.x-l.max.x)-(Math.min(l.min.x,o.x)-l.min.x)/(s.min.x-l.min.x),(Math.max(l.max.y,o.y)-l.max.y)/(s.max.y-l.max.y)-(Math.min(l.min.y,o.y)-l.min.y)/(s.min.y-l.min.y)).multiplyBy(r);i.panBy(c,{animate:!1}),this._draggable._newPos._add(c),this._draggable._startPos._add(c),Ie(e._icon,this._draggable._newPos),this._onDrag(t),this._panRequest=B(this._adjustPan.bind(this,t))}},_onDragStart:function(){this._oldLatLng=this._marker.getLatLng(),this._marker.closePopup&&this._marker.closePopup(),this._marker.fire("movestart").fire("dragstart")},_onPreDrag:function(t){this._marker.options.autoPan&&(E(this._panRequest),this._panRequest=B(this._adjustPan.bind(this,t)))},_onDrag:function(t){var e=this._marker,i=e._shadow,r=Me(e._icon),n=e._map.layerPointToLatLng(r);i&&Ie(i,r),e._latlng=n,t.latlng=n,t.oldLatLng=this._oldLatLng,e.fire("move",t).fire("drag",t)},_onDragEnd:function(t){E(this._panRequest),delete this._oldLatLng,this._marker.fire("moveend").fire("dragend",t)}}),ir=Zi.extend({options:{icon:new tr,interactive:!0,keyboard:!0,title:"",alt:"Marker",zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250,pane:"markerPane",shadowPane:"shadowPane",bubblingMouseEvents:!1,autoPanOnFocus:!0,draggable:!1,autoPan:!1,autoPanPadding:[50,50],autoPanSpeed:10},initialize:function(t,e){p(this,e),this._latlng=Q(t)},onAdd:function(t){this._zoomAnimated=this._zoomAnimated&&t.options.markerZoomAnimation,this._zoomAnimated&&t.on("zoomanim",this._animateZoom,this),this._initIcon(),this.update()},onRemove:function(t){this.dragging&&this.dragging.enabled()&&(this.options.draggable=!0,this.dragging.removeHooks()),delete this.dragging,this._zoomAnimated&&t.off("zoomanim",this._animateZoom,this),this._removeIcon(),this._removeShadow()},getEvents:function(){return{zoom:this.update,viewreset:this.update}},getLatLng:function(){return this._latlng},setLatLng:function(t){var e=this._latlng;return this._latlng=Q(t),this.update(),this.fire("move",{oldLatLng:e,latlng:this._latlng})},setZIndexOffset:function(t){return this.options.zIndexOffset=t,this.update()},getIcon:function(){return this.options.icon},setIcon:function(t){return this.options.icon=t,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup,this._popup.options),this},getElement:function(){return this._icon},update:function(){if(this._icon&&this._map){var t=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(t)}return this},_initIcon:function(){var t=this.options,e="leaflet-zoom-"+(this._zoomAnimated?"animated":"hide"),i=t.icon.createIcon(this._icon),r=!1;i!==this._icon&&(this._icon&&this._removeIcon(),r=!0,t.title&&(i.title=t.title),"IMG"===i.tagName&&(i.alt=t.alt||"")),xe(i,e),t.keyboard&&(i.tabIndex="0",i.setAttribute("role","button")),this._icon=i,t.riseOnHover&&this.on({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&Oe(i,"focus",this._panOnFocus,this);var n=t.icon.createShadow(this._shadow),o=!1;n!==this._shadow&&(this._removeShadow(),o=!0),n&&(xe(n,e),n.alt=""),this._shadow=n,t.opacity<1&&this._updateOpacity(),r&&this.getPane().appendChild(this._icon),this._initInteraction(),n&&o&&this.getPane(t.shadowPane).appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&this.off({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&Qe(this._icon,"focus",this._panOnFocus,this),me(this._icon),this.removeInteractiveTarget(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&me(this._shadow),this._shadow=null},_setPos:function(t){this._icon&&Ie(this._icon,t),this._shadow&&Ie(this._shadow,t),this._zIndex=t.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(t){this._icon&&(this._icon.style.zIndex=this._zIndex+t)},_animateZoom:function(t){var e=this._map._latLngToNewLayerPoint(this._latlng,t.zoom,t.center).round();this._setPos(e)},_initInteraction:function(){if(this.options.interactive&&(xe(this._icon,"leaflet-interactive"),this.addInteractiveTarget(this._icon),er)){var t=this.options.draggable;this.dragging&&(t=this.dragging.enabled(),this.dragging.disable()),this.dragging=new er(this),t&&this.dragging.enable()}},setOpacity:function(t){return this.options.opacity=t,this._map&&this._updateOpacity(),this},_updateOpacity:function(){var t=this.options.opacity;this._icon&&Be(this._icon,t),this._shadow&&Be(this._shadow,t)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)},_panOnFocus:function(){var t=this._map;if(t){var e=this.options.icon.options,i=e.iconSize?F(e.iconSize):F(0,0),r=e.iconAnchor?F(e.iconAnchor):F(0,0);t.panInside(this._latlng,{paddingTopLeft:r,paddingBottomRight:i.subtract(r)})}},_getPopupAnchor:function(){return this.options.icon.options.popupAnchor},_getTooltipAnchor:function(){return this.options.icon.options.tooltipAnchor}});function rr(t,e){return new ir(t,e)}var nr=Zi.extend({options:{stroke:!0,color:"#3388ff",weight:3,opacity:1,lineCap:"round",lineJoin:"round",dashArray:null,dashOffset:null,fill:!1,fillColor:null,fillOpacity:.2,fillRule:"evenodd",interactive:!0,bubblingMouseEvents:!0},beforeAdd:function(t){this._renderer=t.getRenderer(this)},onAdd:function(){this._renderer._initPath(this),this._reset(),this._renderer._addPath(this)},onRemove:function(){this._renderer._removePath(this)},redraw:function(){return this._map&&this._renderer._updatePath(this),this},setStyle:function(t){return p(this,t),this._renderer&&(this._renderer._updateStyle(this),this.options.stroke&&t&&Object.prototype.hasOwnProperty.call(t,"weight")&&this._updateBounds()),this},bringToFront:function(){return this._renderer&&this._renderer._bringToFront(this),this},bringToBack:function(){return this._renderer&&this._renderer._bringToBack(this),this},getElement:function(){return this._path},_reset:function(){this._project(),this._update()},_clickTolerance:function(){return(this.options.stroke?this.options.weight/2:0)+(this._renderer.options.tolerance||0)}}),or=nr.extend({options:{fill:!0,radius:10},initialize:function(t,e){p(this,e),this._latlng=Q(t),this._radius=this.options.radius},setLatLng:function(t){var e=this._latlng;return this._latlng=Q(t),this.redraw(),this.fire("move",{oldLatLng:e,latlng:this._latlng})},getLatLng:function(){return this._latlng},setRadius:function(t){return this.options.radius=this._radius=t,this.redraw()},getRadius:function(){return this._radius},setStyle:function(t){var e=t&&t.radius||this._radius;return nr.prototype.setStyle.call(this,t),this.setRadius(e),this},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._updateBounds()},_updateBounds:function(){var t=this._radius,e=this._radiusY||t,i=this._clickTolerance(),r=[t+i,e+i];this._pxBounds=new D(this._point.subtract(r),this._point.add(r))},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updateCircle(this)},_empty:function(){return this._radius&&!this._renderer._bounds.intersects(this._pxBounds)},_containsPoint:function(t){return t.distanceTo(this._point)<=this._radius+this._clickTolerance()}});function sr(t,e){return new or(t,e)}var ar=or.extend({initialize:function(t,e,r){if("number"==typeof e&&(e=i({},r,{radius:e})),p(this,e),this._latlng=Q(t),isNaN(this.options.radius))throw new Error("Circle radius cannot be NaN");this._mRadius=this.options.radius},setRadius:function(t){return this._mRadius=t,this.redraw()},getRadius:function(){return this._mRadius},getBounds:function(){var t=[this._radius,this._radiusY||this._radius];return new U(this._map.layerPointToLatLng(this._point.subtract(t)),this._map.layerPointToLatLng(this._point.add(t)))},setStyle:nr.prototype.setStyle,_project:function(){var t=this._latlng.lng,e=this._latlng.lat,i=this._map,r=i.options.crs;if(r.distance===H.distance){var n=Math.PI/180,o=this._mRadius/H.R/n,s=i.project([e+o,t]),a=i.project([e-o,t]),l=s.add(a).divideBy(2),c=i.unproject(l).lat,u=Math.acos((Math.cos(o*n)-Math.sin(e*n)*Math.sin(c*n))/(Math.cos(e*n)*Math.cos(c*n)))/n;(isNaN(u)||0===u)&&(u=o/Math.cos(Math.PI/180*e)),this._point=l.subtract(i.getPixelOrigin()),this._radius=isNaN(u)?0:l.x-i.project([c,t-u]).x,this._radiusY=l.y-s.y}else{var h=r.unproject(r.project(this._latlng).subtract([this._mRadius,0]));this._point=i.latLngToLayerPoint(this._latlng),this._radius=this._point.x-i.latLngToLayerPoint(h).x}this._updateBounds()}});function lr(t,e,i){return new ar(t,e,i)}var cr=nr.extend({options:{smoothFactor:1,noClip:!1},initialize:function(t,e){p(this,e),this._setLatLngs(t)},getLatLngs:function(){return this._latlngs},setLatLngs:function(t){return this._setLatLngs(t),this.redraw()},isEmpty:function(){return!this._latlngs.length},closestLayerPoint:function(t){for(var e,i,r=1/0,n=null,o=Di,s=0,a=this._parts.length;s<a;s++)for(var l=this._parts[s],c=1,u=l.length;c<u;c++){var h=o(t,e=l[c-1],i=l[c],!0);h<r&&(r=h,n=o(t,e,i))}return n&&(n.distance=Math.sqrt(r)),n},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return Oi(this._defaultShape(),this._map.options.crs)},getBounds:function(){return this._bounds},addLatLng:function(t,e){return e=e||this._defaultShape(),t=Q(t),e.push(t),this._bounds.extend(t),this.redraw()},_setLatLngs:function(t){this._bounds=new U,this._latlngs=this._convertLatLngs(t)},_defaultShape:function(){return Ri(this._latlngs)?this._latlngs:this._latlngs[0]},_convertLatLngs:function(t){for(var e=[],i=Ri(t),r=0,n=t.length;r<n;r++)i?(e[r]=Q(t[r]),this._bounds.extend(e[r])):e[r]=this._convertLatLngs(t[r]);return e},_project:function(){var t=new D;this._rings=[],this._projectLatlngs(this._latlngs,this._rings,t),this._bounds.isValid()&&t.isValid()&&(this._rawPxBounds=t,this._updateBounds())},_updateBounds:function(){var t=this._clickTolerance(),e=new P(t,t);this._rawPxBounds&&(this._pxBounds=new D([this._rawPxBounds.min.subtract(e),this._rawPxBounds.max.add(e)]))},_projectLatlngs:function(t,e,i){var r,n,o=t[0]instanceof N,s=t.length;if(o){for(n=[],r=0;r<s;r++)n[r]=this._map.latLngToLayerPoint(t[r]),i.extend(n[r]);e.push(n)}else for(r=0;r<s;r++)this._projectLatlngs(t[r],e,i)},_clipPoints:function(){var t=this._renderer._bounds;if(this._parts=[],this._pxBounds&&this._pxBounds.intersects(t))if(this.options.noClip)this._parts=this._rings;else{var e,i,r,n,o,s,a,l=this._parts;for(e=0,r=0,n=this._rings.length;e<n;e++)for(i=0,o=(a=this._rings[e]).length;i<o-1;i++)(s=Pi(a[i],a[i+1],t,i,!0))&&(l[r]=l[r]||[],l[r].push(s[0]),s[1]===a[i+1]&&i!==o-2||(l[r].push(s[1]),r++))}},_simplifyPoints:function(){for(var t=this._parts,e=this.options.smoothFactor,i=0,r=t.length;i<r;i++)t[i]=Ei(t[i],e)},_update:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),this._updatePath())},_updatePath:function(){this._renderer._updatePoly(this)},_containsPoint:function(t,e){var i,r,n,o,s,a,l=this._clickTolerance();if(!this._pxBounds||!this._pxBounds.contains(t))return!1;for(i=0,o=this._parts.length;i<o;i++)for(r=0,n=(s=(a=this._parts[i]).length)-1;r<s;n=r++)if((e||0!==r)&&Ci(t,a[n],a[r])<=l)return!0;return!1}});function ur(t,e){return new cr(t,e)}cr._flat=Ui;var hr=cr.extend({options:{fill:!0},isEmpty:function(){return!this._latlngs.length||!this._latlngs[0].length},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return bi(this._defaultShape(),this._map.options.crs)},_convertLatLngs:function(t){var e=cr.prototype._convertLatLngs.call(this,t),i=e.length;return i>=2&&e[0]instanceof N&&e[0].equals(e[i-1])&&e.pop(),e},_setLatLngs:function(t){cr.prototype._setLatLngs.call(this,t),Ri(this._latlngs)&&(this._latlngs=[this._latlngs])},_defaultShape:function(){return Ri(this._latlngs[0])?this._latlngs[0]:this._latlngs[0][0]},_clipPoints:function(){var t=this._renderer._bounds,e=this.options.weight,i=new P(e,e);if(t=new D(t.min.subtract(i),t.max.add(i)),this._parts=[],this._pxBounds&&this._pxBounds.intersects(t))if(this.options.noClip)this._parts=this._rings;else for(var r,n=0,o=this._rings.length;n<o;n++)(r=xi(this._rings[n],t,!0)).length&&this._parts.push(r)},_updatePath:function(){this._renderer._updatePoly(this,!0)},_containsPoint:function(t){var e,i,r,n,o,s,a,l,c=!1;if(!this._pxBounds||!this._pxBounds.contains(t))return!1;for(n=0,a=this._parts.length;n<a;n++)for(o=0,s=(l=(e=this._parts[n]).length)-1;o<l;s=o++)i=e[o],r=e[s],i.y>t.y!=r.y>t.y&&t.x<(r.x-i.x)*(t.y-i.y)/(r.y-i.y)+i.x&&(c=!c);return c||cr.prototype._containsPoint.call(this,t,!0)}});function dr(t,e){return new hr(t,e)}var pr=Wi.extend({initialize:function(t,e){p(this,e),this._layers={},t&&this.addData(t)},addData:function(t){var e,i,r,n=g(t)?t:t.features;if(n){for(e=0,i=n.length;e<i;e++)((r=n[e]).geometries||r.geometry||r.features||r.coordinates)&&this.addData(r);return this}var o=this.options;if(o.filter&&!o.filter(t))return this;var s=fr(t,o);return s?(s.feature=xr(t),s.defaultOptions=s.options,this.resetStyle(s),o.onEachFeature&&o.onEachFeature(t,s),this.addLayer(s)):this},resetStyle:function(t){return void 0===t?this.eachLayer(this.resetStyle,this):(t.options=i({},t.defaultOptions),this._setLayerStyle(t,this.options.style),this)},setStyle:function(t){return this.eachLayer((function(e){this._setLayerStyle(e,t)}),this)},_setLayerStyle:function(t,e){t.setStyle&&("function"==typeof e&&(e=e(t.feature)),t.setStyle(e))}});function fr(t,e){var i,r,n,o,s="Feature"===t.type?t.geometry:t,a=s?s.coordinates:null,l=[],c=e&&e.pointToLayer,u=e&&e.coordsToLatLng||mr;if(!a&&!s)return null;switch(s.type){case"Point":return Ar(c,t,i=u(a),e);case"MultiPoint":for(n=0,o=a.length;n<o;n++)i=u(a[n]),l.push(Ar(c,t,i,e));return new Wi(l);case"LineString":case"MultiLineString":return r=gr(a,"LineString"===s.type?0:1,u),new cr(r,e);case"Polygon":case"MultiPolygon":return r=gr(a,"Polygon"===s.type?1:2,u),new hr(r,e);case"GeometryCollection":for(n=0,o=s.geometries.length;n<o;n++){var h=fr({geometry:s.geometries[n],type:"Feature",properties:t.properties},e);h&&l.push(h)}return new Wi(l);case"FeatureCollection":for(n=0,o=s.features.length;n<o;n++){var d=fr(s.features[n],e);d&&l.push(d)}return new Wi(l);default:throw new Error("Invalid GeoJSON object.")}}function Ar(t,e,i,r){return t?t(e,i):new ir(i,r&&r.markersInheritOptions&&r)}function mr(t){return new N(t[1],t[0],t[2])}function gr(t,e,i){for(var r,n=[],o=0,s=t.length;o<s;o++)r=e?gr(t[o],e-1,i):(i||mr)(t[o]),n.push(r);return n}function _r(t,e){return void 0!==(t=Q(t)).alt?[u(t.lng,e),u(t.lat,e),u(t.alt,e)]:[u(t.lng,e),u(t.lat,e)]}function yr(t,e,i,r){for(var n=[],o=0,s=t.length;o<s;o++)n.push(e?yr(t[o],Ri(t[o])?0:e-1,i,r):_r(t[o],r));return!e&&i&&n.length>0&&n.push(n[0].slice()),n}function vr(t,e){return t.feature?i({},t.feature,{geometry:e}):xr(e)}function xr(t){return"Feature"===t.type||"FeatureCollection"===t.type?t:{type:"Feature",properties:{},geometry:t}}var br={toGeoJSON:function(t){return vr(this,{type:"Point",coordinates:_r(this.getLatLng(),t)})}};function wr(t,e){return new pr(t,e)}ir.include(br),ar.include(br),or.include(br),cr.include({toGeoJSON:function(t){var e=!Ri(this._latlngs);return vr(this,{type:(e?"Multi":"")+"LineString",coordinates:yr(this._latlngs,e?1:0,!1,t)})}}),hr.include({toGeoJSON:function(t){var e=!Ri(this._latlngs),i=e&&!Ri(this._latlngs[0]),r=yr(this._latlngs,i?2:e?1:0,!0,t);return e||(r=[r]),vr(this,{type:(i?"Multi":"")+"Polygon",coordinates:r})}}),qi.include({toMultiPoint:function(t){var e=[];return this.eachLayer((function(i){e.push(i.toGeoJSON(t).geometry.coordinates)})),vr(this,{type:"MultiPoint",coordinates:e})},toGeoJSON:function(t){var e=this.feature&&this.feature.geometry&&this.feature.geometry.type;if("MultiPoint"===e)return this.toMultiPoint(t);var i="GeometryCollection"===e,r=[];return this.eachLayer((function(e){if(e.toGeoJSON){var n=e.toGeoJSON(t);if(i)r.push(n.geometry);else{var o=xr(n);"FeatureCollection"===o.type?r.push.apply(r,o.features):r.push(o)}}})),i?vr(this,{geometries:r,type:"GeometryCollection"}):{type:"FeatureCollection",features:r}}});var Tr=wr,Br=Zi.extend({options:{opacity:1,alt:"",interactive:!1,crossOrigin:!1,errorOverlayUrl:"",zIndex:1,className:""},initialize:function(t,e,i){this._url=t,this._bounds=O(e),p(this,i)},onAdd:function(){this._image||(this._initImage(),this.options.opacity<1&&this._updateOpacity()),this.options.interactive&&(xe(this._image,"leaflet-interactive"),this.addInteractiveTarget(this._image)),this.getPane().appendChild(this._image),this._reset()},onRemove:function(){me(this._image),this.options.interactive&&this.removeInteractiveTarget(this._image)},setOpacity:function(t){return this.options.opacity=t,this._image&&this._updateOpacity(),this},setStyle:function(t){return t.opacity&&this.setOpacity(t.opacity),this},bringToFront:function(){return this._map&&_e(this._image),this},bringToBack:function(){return this._map&&ye(this._image),this},setUrl:function(t){return this._url=t,this._image&&(this._image.src=t),this},setBounds:function(t){return this._bounds=O(t),this._map&&this._reset(),this},getEvents:function(){var t={zoom:this._reset,viewreset:this._reset};return this._zoomAnimated&&(t.zoomanim=this._animateZoom),t},setZIndex:function(t){return this.options.zIndex=t,this._updateZIndex(),this},getBounds:function(){return this._bounds},getElement:function(){return this._image},_initImage:function(){var t="IMG"===this._url.tagName,e=this._image=t?this._url:Ae("img");xe(e,"leaflet-image-layer"),this._zoomAnimated&&xe(e,"leaflet-zoom-animated"),this.options.className&&xe(e,this.options.className),e.onselectstart=c,e.onmousemove=c,e.onload=n(this.fire,this,"load"),e.onerror=n(this._overlayOnError,this,"error"),(this.options.crossOrigin||""===this.options.crossOrigin)&&(e.crossOrigin=!0===this.options.crossOrigin?"":this.options.crossOrigin),this.options.zIndex&&this._updateZIndex(),t?this._url=e.src:(e.src=this._url,e.alt=this.options.alt)},_animateZoom:function(t){var e=this._map.getZoomScale(t.zoom),i=this._map._latLngBoundsToNewLayerBounds(this._bounds,t.zoom,t.center).min;Se(this._image,i,e)},_reset:function(){var t=this._image,e=new D(this._map.latLngToLayerPoint(this._bounds.getNorthWest()),this._map.latLngToLayerPoint(this._bounds.getSouthEast())),i=e.getSize();Ie(t,e.min),t.style.width=i.x+"px",t.style.height=i.y+"px"},_updateOpacity:function(){Be(this._image,this.options.opacity)},_updateZIndex:function(){this._image&&void 0!==this.options.zIndex&&null!==this.options.zIndex&&(this._image.style.zIndex=this.options.zIndex)},_overlayOnError:function(){this.fire("error");var t=this.options.errorOverlayUrl;t&&this._url!==t&&(this._url=t,this._image.src=t)},getCenter:function(){return this._bounds.getCenter()}}),Er=function(t,e,i){return new Br(t,e,i)},Cr=Br.extend({options:{autoplay:!0,loop:!0,keepAspectRatio:!0,muted:!1,playsInline:!0},_initImage:function(){var t="VIDEO"===this._url.tagName,e=this._image=t?this._url:Ae("video");if(xe(e,"leaflet-image-layer"),this._zoomAnimated&&xe(e,"leaflet-zoom-animated"),this.options.className&&xe(e,this.options.className),e.onselectstart=c,e.onmousemove=c,e.onloadeddata=n(this.fire,this,"load"),t){for(var i=e.getElementsByTagName("source"),r=[],o=0;o<i.length;o++)r.push(i[o].src);this._url=i.length>0?r:[e.src]}else{g(this._url)||(this._url=[this._url]),!this.options.keepAspectRatio&&Object.prototype.hasOwnProperty.call(e.style,"objectFit")&&(e.style.objectFit="fill"),e.autoplay=!!this.options.autoplay,e.loop=!!this.options.loop,e.muted=!!this.options.muted,e.playsInline=!!this.options.playsInline;for(var s=0;s<this._url.length;s++){var a=Ae("source");a.src=this._url[s],e.appendChild(a)}}}});function Sr(t,e,i){return new Cr(t,e,i)}var Ir=Br.extend({_initImage:function(){var t=this._image=this._url;xe(t,"leaflet-image-layer"),this._zoomAnimated&&xe(t,"leaflet-zoom-animated"),this.options.className&&xe(t,this.options.className),t.onselectstart=c,t.onmousemove=c}});function Mr(t,e,i){return new Ir(t,e,i)}var kr=Zi.extend({options:{interactive:!1,offset:[0,0],className:"",pane:void 0,content:""},initialize:function(t,e){t&&(t instanceof N||g(t))?(this._latlng=Q(t),p(this,e)):(p(this,t),this._source=e),this.options.content&&(this._content=this.options.content)},openOn:function(t){return(t=arguments.length?t:this._source._map).hasLayer(this)||t.addLayer(this),this},close:function(){return this._map&&this._map.removeLayer(this),this},toggle:function(t){return this._map?this.close():(arguments.length?this._source=t:t=this._source,this._prepareOpen(),this.openOn(t._map)),this},onAdd:function(t){this._zoomAnimated=t._zoomAnimated,this._container||this._initLayout(),t._fadeAnimated&&Be(this._container,0),clearTimeout(this._removeTimeout),this.getPane().appendChild(this._container),this.update(),t._fadeAnimated&&Be(this._container,1),this.bringToFront(),this.options.interactive&&(xe(this._container,"leaflet-interactive"),this.addInteractiveTarget(this._container))},onRemove:function(t){t._fadeAnimated?(Be(this._container,0),this._removeTimeout=setTimeout(n(me,void 0,this._container),200)):me(this._container),this.options.interactive&&(be(this._container,"leaflet-interactive"),this.removeInteractiveTarget(this._container))},getLatLng:function(){return this._latlng},setLatLng:function(t){return this._latlng=Q(t),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(t){return this._content=t,this.update(),this},getElement:function(){return this._container},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},getEvents:function(){var t={zoom:this._updatePosition,viewreset:this._updatePosition};return this._zoomAnimated&&(t.zoomanim=this._animateZoom),t},isOpen:function(){return!!this._map&&this._map.hasLayer(this)},bringToFront:function(){return this._map&&_e(this._container),this},bringToBack:function(){return this._map&&ye(this._container),this},_prepareOpen:function(t){var e=this._source;if(!e._map)return!1;if(e instanceof Wi){e=null;var i=this._source._layers;for(var r in i)if(i[r]._map){e=i[r];break}if(!e)return!1;this._source=e}if(!t)if(e.getCenter)t=e.getCenter();else if(e.getLatLng)t=e.getLatLng();else{if(!e.getBounds)throw new Error("Unable to get source layer LatLng.");t=e.getBounds().getCenter()}return this.setLatLng(t),this._map&&this.update(),!0},_updateContent:function(){if(this._content){var t=this._contentNode,e="function"==typeof this._content?this._content(this._source||this):this._content;if("string"==typeof e)t.innerHTML=e;else{for(;t.hasChildNodes();)t.removeChild(t.firstChild);t.appendChild(e)}this.fire("contentupdate")}},_updatePosition:function(){if(this._map){var t=this._map.latLngToLayerPoint(this._latlng),e=F(this.options.offset),i=this._getAnchor();this._zoomAnimated?Ie(this._container,t.add(i)):e=e.add(t).add(i);var r=this._containerBottom=-e.y,n=this._containerLeft=-Math.round(this._containerWidth/2)+e.x;this._container.style.bottom=r+"px",this._container.style.left=n+"px"}},_getAnchor:function(){return[0,0]}});ni.include({_initOverlay:function(t,e,i,r){var n=e;return n instanceof t||(n=new t(r).setContent(e)),i&&n.setLatLng(i),n}}),Zi.include({_initOverlay:function(t,e,i,r){var n=i;return n instanceof t?(p(n,r),n._source=this):(n=e&&!r?e:new t(r,this)).setContent(i),n}});var Pr=kr.extend({options:{pane:"popupPane",offset:[0,7],maxWidth:300,minWidth:50,maxHeight:null,autoPan:!0,autoPanPaddingTopLeft:null,autoPanPaddingBottomRight:null,autoPanPadding:[5,5],keepInView:!1,closeButton:!0,autoClose:!0,closeOnEscapeKey:!0,className:""},openOn:function(t){return!(t=arguments.length?t:this._source._map).hasLayer(this)&&t._popup&&t._popup.options.autoClose&&t.removeLayer(t._popup),t._popup=this,kr.prototype.openOn.call(this,t)},onAdd:function(t){kr.prototype.onAdd.call(this,t),t.fire("popupopen",{popup:this}),this._source&&(this._source.fire("popupopen",{popup:this},!0),this._source instanceof nr||this._source.on("preclick",$e))},onRemove:function(t){kr.prototype.onRemove.call(this,t),t.fire("popupclose",{popup:this}),this._source&&(this._source.fire("popupclose",{popup:this},!0),this._source instanceof nr||this._source.off("preclick",$e))},getEvents:function(){var t=kr.prototype.getEvents.call(this);return(void 0!==this.options.closeOnClick?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(t.preclick=this.close),this.options.keepInView&&(t.moveend=this._adjustPan),t},_initLayout:function(){var t="leaflet-popup",e=this._container=Ae("div",t+" "+(this.options.className||"")+" leaflet-zoom-animated"),i=this._wrapper=Ae("div",t+"-content-wrapper",e);if(this._contentNode=Ae("div",t+"-content",i),qe(e),Ze(this._contentNode),Oe(e,"contextmenu",$e),this._tipContainer=Ae("div",t+"-tip-container",e),this._tip=Ae("div",t+"-tip",this._tipContainer),this.options.closeButton){var r=this._closeButton=Ae("a",t+"-close-button",e);r.setAttribute("role","button"),r.setAttribute("aria-label","Close popup"),r.href="#close",r.innerHTML='<span aria-hidden="true">&#215;</span>',Oe(r,"click",(function(t){Ke(t),this.close()}),this)}},_updateLayout:function(){var t=this._contentNode,e=t.style;e.width="",e.whiteSpace="nowrap";var i=t.offsetWidth;i=Math.min(i,this.options.maxWidth),i=Math.max(i,this.options.minWidth),e.width=i+1+"px",e.whiteSpace="",e.height="";var r=t.offsetHeight,n=this.options.maxHeight,o="leaflet-popup-scrolled";n&&r>n?(e.height=n+"px",xe(t,o)):be(t,o),this._containerWidth=this._container.offsetWidth},_animateZoom:function(t){var e=this._map._latLngToNewLayerPoint(this._latlng,t.zoom,t.center),i=this._getAnchor();Ie(this._container,e.add(i))},_adjustPan:function(){if(this.options.autoPan)if(this._map._panAnim&&this._map._panAnim.stop(),this._autopanning)this._autopanning=!1;else{var t=this._map,e=parseInt(fe(this._container,"marginBottom"),10)||0,i=this._container.offsetHeight+e,r=this._containerWidth,n=new P(this._containerLeft,-i-this._containerBottom);n._add(Me(this._container));var o=t.layerPointToContainerPoint(n),s=F(this.options.autoPanPadding),a=F(this.options.autoPanPaddingTopLeft||s),l=F(this.options.autoPanPaddingBottomRight||s),c=t.getSize(),u=0,h=0;o.x+r+l.x>c.x&&(u=o.x+r-c.x+l.x),o.x-u-a.x<0&&(u=o.x-a.x),o.y+i+l.y>c.y&&(h=o.y+i-c.y+l.y),o.y-h-a.y<0&&(h=o.y-a.y),(u||h)&&(this.options.keepInView&&(this._autopanning=!0),t.fire("autopanstart").panBy([u,h]))}},_getAnchor:function(){return F(this._source&&this._source._getPopupAnchor?this._source._getPopupAnchor():[0,0])}}),Lr=function(t,e){return new Pr(t,e)};ni.mergeOptions({closePopupOnClick:!0}),ni.include({openPopup:function(t,e,i){return this._initOverlay(Pr,t,e,i).openOn(this),this},closePopup:function(t){return(t=arguments.length?t:this._popup)&&t.close(),this}}),Zi.include({bindPopup:function(t,e){return this._popup=this._initOverlay(Pr,this._popup,t,e),this._popupHandlersAdded||(this.on({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this.off({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!1,this._popup=null),this},openPopup:function(t){return this._popup&&(this instanceof Wi||(this._popup._source=this),this._popup._prepareOpen(t||this._latlng)&&this._popup.openOn(this._map)),this},closePopup:function(){return this._popup&&this._popup.close(),this},togglePopup:function(){return this._popup&&this._popup.toggle(this),this},isPopupOpen:function(){return!!this._popup&&this._popup.isOpen()},setPopupContent:function(t){return this._popup&&this._popup.setContent(t),this},getPopup:function(){return this._popup},_openPopup:function(t){if(this._popup&&this._map){We(t);var e=t.layer||t.target;this._popup._source!==e||e instanceof nr?(this._popup._source=e,this.openPopup(t.latlng)):this._map.hasLayer(this._popup)?this.closePopup():this.openPopup(t.latlng)}},_movePopup:function(t){this._popup.setLatLng(t.latlng)},_onKeyPress:function(t){13===t.originalEvent.keyCode&&this._openPopup(t)}});var zr=kr.extend({options:{pane:"tooltipPane",offset:[0,0],direction:"auto",permanent:!1,sticky:!1,opacity:.9},onAdd:function(t){kr.prototype.onAdd.call(this,t),this.setOpacity(this.options.opacity),t.fire("tooltipopen",{tooltip:this}),this._source&&(this.addEventParent(this._source),this._source.fire("tooltipopen",{tooltip:this},!0))},onRemove:function(t){kr.prototype.onRemove.call(this,t),t.fire("tooltipclose",{tooltip:this}),this._source&&(this.removeEventParent(this._source),this._source.fire("tooltipclose",{tooltip:this},!0))},getEvents:function(){var t=kr.prototype.getEvents.call(this);return this.options.permanent||(t.preclick=this.close),t},_initLayout:function(){var t="leaflet-tooltip "+(this.options.className||"")+" leaflet-zoom-"+(this._zoomAnimated?"animated":"hide");this._contentNode=this._container=Ae("div",t),this._container.setAttribute("role","tooltip"),this._container.setAttribute("id","leaflet-tooltip-"+s(this))},_updateLayout:function(){},_adjustPan:function(){},_setPosition:function(t){var e,i,r=this._map,n=this._container,o=r.latLngToContainerPoint(r.getCenter()),s=r.layerPointToContainerPoint(t),a=this.options.direction,l=n.offsetWidth,c=n.offsetHeight,u=F(this.options.offset),h=this._getAnchor();"top"===a?(e=l/2,i=c):"bottom"===a?(e=l/2,i=0):"center"===a?(e=l/2,i=c/2):"right"===a?(e=0,i=c/2):"left"===a?(e=l,i=c/2):s.x<o.x?(a="right",e=0,i=c/2):(a="left",e=l+2*(u.x+h.x),i=c/2),t=t.subtract(F(e,i,!0)).add(u).add(h),be(n,"leaflet-tooltip-right"),be(n,"leaflet-tooltip-left"),be(n,"leaflet-tooltip-top"),be(n,"leaflet-tooltip-bottom"),xe(n,"leaflet-tooltip-"+a),Ie(n,t)},_updatePosition:function(){var t=this._map.latLngToLayerPoint(this._latlng);this._setPosition(t)},setOpacity:function(t){this.options.opacity=t,this._container&&Be(this._container,t)},_animateZoom:function(t){var e=this._map._latLngToNewLayerPoint(this._latlng,t.zoom,t.center);this._setPosition(e)},_getAnchor:function(){return F(this._source&&this._source._getTooltipAnchor&&!this.options.sticky?this._source._getTooltipAnchor():[0,0])}}),Fr=function(t,e){return new zr(t,e)};ni.include({openTooltip:function(t,e,i){return this._initOverlay(zr,t,e,i).openOn(this),this},closeTooltip:function(t){return t.close(),this}}),Zi.include({bindTooltip:function(t,e){return this._tooltip&&this.isTooltipOpen()&&this.unbindTooltip(),this._tooltip=this._initOverlay(zr,this._tooltip,t,e),this._initTooltipInteractions(),this._tooltip.options.permanent&&this._map&&this._map.hasLayer(this)&&this.openTooltip(),this},unbindTooltip:function(){return this._tooltip&&(this._initTooltipInteractions(!0),this.closeTooltip(),this._tooltip=null),this},_initTooltipInteractions:function(t){if(t||!this._tooltipHandlersAdded){var e=t?"off":"on",i={remove:this.closeTooltip,move:this._moveTooltip};this._tooltip.options.permanent?i.add=this._openTooltip:(i.mouseover=this._openTooltip,i.mouseout=this.closeTooltip,i.click=this._openTooltip,this._map?this._addFocusListeners():i.add=this._addFocusListeners),this._tooltip.options.sticky&&(i.mousemove=this._moveTooltip),this[e](i),this._tooltipHandlersAdded=!t}},openTooltip:function(t){return this._tooltip&&(this instanceof Wi||(this._tooltip._source=this),this._tooltip._prepareOpen(t)&&(this._tooltip.openOn(this._map),this.getElement?this._setAriaDescribedByOnLayer(this):this.eachLayer&&this.eachLayer(this._setAriaDescribedByOnLayer,this))),this},closeTooltip:function(){if(this._tooltip)return this._tooltip.close()},toggleTooltip:function(){return this._tooltip&&this._tooltip.toggle(this),this},isTooltipOpen:function(){return this._tooltip.isOpen()},setTooltipContent:function(t){return this._tooltip&&this._tooltip.setContent(t),this},getTooltip:function(){return this._tooltip},_addFocusListeners:function(){this.getElement?this._addFocusListenersOnLayer(this):this.eachLayer&&this.eachLayer(this._addFocusListenersOnLayer,this)},_addFocusListenersOnLayer:function(t){var e="function"==typeof t.getElement&&t.getElement();e&&(Oe(e,"focus",(function(){this._tooltip._source=t,this.openTooltip()}),this),Oe(e,"blur",this.closeTooltip,this))},_setAriaDescribedByOnLayer:function(t){var e="function"==typeof t.getElement&&t.getElement();e&&e.setAttribute("aria-describedby",this._tooltip._container.id)},_openTooltip:function(t){if(this._tooltip&&this._map)if(this._map.dragging&&this._map.dragging.moving()&&!this._openOnceFlag){this._openOnceFlag=!0;var e=this;this._map.once("moveend",(function(){e._openOnceFlag=!1,e._openTooltip(t)}))}else this._tooltip._source=t.layer||t.target,this.openTooltip(this._tooltip.options.sticky?t.latlng:void 0)},_moveTooltip:function(t){var e,i,r=t.latlng;this._tooltip.options.sticky&&t.originalEvent&&(e=this._map.mouseEventToContainerPoint(t.originalEvent),i=this._map.containerPointToLayerPoint(e),r=this._map.layerPointToLatLng(i)),this._tooltip.setLatLng(r)}});var Dr=Ji.extend({options:{iconSize:[12,12],html:!1,bgPos:null,className:"leaflet-div-icon"},createIcon:function(t){var e=t&&"DIV"===t.tagName?t:document.createElement("div"),i=this.options;if(i.html instanceof Element?(ge(e),e.appendChild(i.html)):e.innerHTML=!1!==i.html?i.html:"",i.bgPos){var r=F(i.bgPos);e.style.backgroundPosition=-r.x+"px "+-r.y+"px"}return this._setIconStyles(e,"icon"),e},createShadow:function(){return null}});function Rr(t){return new Dr(t)}Ji.Default=tr;var Ur=Zi.extend({options:{tileSize:256,opacity:1,updateWhenIdle:Ut.mobile,updateWhenZooming:!0,updateInterval:200,zIndex:1,bounds:null,minZoom:0,maxZoom:void 0,maxNativeZoom:void 0,minNativeZoom:void 0,noWrap:!1,pane:"tilePane",className:"",keepBuffer:2},initialize:function(t){p(this,t)},onAdd:function(){this._initContainer(),this._levels={},this._tiles={},this._resetView()},beforeAdd:function(t){t._addZoomLimit(this)},onRemove:function(t){this._removeAllTiles(),me(this._container),t._removeZoomLimit(this),this._container=null,this._tileZoom=void 0},bringToFront:function(){return this._map&&(_e(this._container),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this._map&&(ye(this._container),this._setAutoZIndex(Math.min)),this},getContainer:function(){return this._container},setOpacity:function(t){return this.options.opacity=t,this._updateOpacity(),this},setZIndex:function(t){return this.options.zIndex=t,this._updateZIndex(),this},isLoading:function(){return this._loading},redraw:function(){if(this._map){this._removeAllTiles();var t=this._clampZoom(this._map.getZoom());t!==this._tileZoom&&(this._tileZoom=t,this._updateLevels()),this._update()}return this},getEvents:function(){var t={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=a(this._onMoveEnd,this.options.updateInterval,this)),t.move=this._onMove),this._zoomAnimated&&(t.zoomanim=this._animateZoom),t},createTile:function(){return document.createElement("div")},getTileSize:function(){var t=this.options.tileSize;return t instanceof P?t:new P(t,t)},_updateZIndex:function(){this._container&&void 0!==this.options.zIndex&&null!==this.options.zIndex&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(t){for(var e,i=this.getPane().children,r=-t(-1/0,1/0),n=0,o=i.length;n<o;n++)e=i[n].style.zIndex,i[n]!==this._container&&e&&(r=t(r,+e));isFinite(r)&&(this.options.zIndex=r+t(-1,1),this._updateZIndex())},_updateOpacity:function(){if(this._map&&!Ut.ielt9){Be(this._container,this.options.opacity);var t=+new Date,e=!1,i=!1;for(var r in this._tiles){var n=this._tiles[r];if(n.current&&n.loaded){var o=Math.min(1,(t-n.loaded)/200);Be(n.el,o),o<1?e=!0:(n.active?i=!0:this._onOpaqueTile(n),n.active=!0)}}i&&!this._noPrune&&this._pruneTiles(),e&&(E(this._fadeFrame),this._fadeFrame=B(this._updateOpacity,this))}},_onOpaqueTile:c,_initContainer:function(){this._container||(this._container=Ae("div","leaflet-layer "+(this.options.className||"")),this._updateZIndex(),this.options.opacity<1&&this._updateOpacity(),this.getPane().appendChild(this._container))},_updateLevels:function(){var t=this._tileZoom,e=this.options.maxZoom;if(void 0!==t){for(var i in this._levels)i=Number(i),this._levels[i].el.children.length||i===t?(this._levels[i].el.style.zIndex=e-Math.abs(t-i),this._onUpdateLevel(i)):(me(this._levels[i].el),this._removeTilesAtZoom(i),this._onRemoveLevel(i),delete this._levels[i]);var r=this._levels[t],n=this._map;return r||((r=this._levels[t]={}).el=Ae("div","leaflet-tile-container leaflet-zoom-animated",this._container),r.el.style.zIndex=e,r.origin=n.project(n.unproject(n.getPixelOrigin()),t).round(),r.zoom=t,this._setZoomTransform(r,n.getCenter(),n.getZoom()),c(r.el.offsetWidth),this._onCreateLevel(r)),this._level=r,r}},_onUpdateLevel:c,_onRemoveLevel:c,_onCreateLevel:c,_pruneTiles:function(){if(this._map){var t,e,i=this._map.getZoom();if(i>this.options.maxZoom||i<this.options.minZoom)this._removeAllTiles();else{for(t in this._tiles)(e=this._tiles[t]).retain=e.current;for(t in this._tiles)if((e=this._tiles[t]).current&&!e.active){var r=e.coords;this._retainParent(r.x,r.y,r.z,r.z-5)||this._retainChildren(r.x,r.y,r.z,r.z+2)}for(t in this._tiles)this._tiles[t].retain||this._removeTile(t)}}},_removeTilesAtZoom:function(t){for(var e in this._tiles)this._tiles[e].coords.z===t&&this._removeTile(e)},_removeAllTiles:function(){for(var t in this._tiles)this._removeTile(t)},_invalidateAll:function(){for(var t in this._levels)me(this._levels[t].el),this._onRemoveLevel(Number(t)),delete this._levels[t];this._removeAllTiles(),this._tileZoom=void 0},_retainParent:function(t,e,i,r){var n=Math.floor(t/2),o=Math.floor(e/2),s=i-1,a=new P(+n,+o);a.z=+s;var l=this._tileCoordsToKey(a),c=this._tiles[l];return c&&c.active?(c.retain=!0,!0):(c&&c.loaded&&(c.retain=!0),s>r&&this._retainParent(n,o,s,r))},_retainChildren:function(t,e,i,r){for(var n=2*t;n<2*t+2;n++)for(var o=2*e;o<2*e+2;o++){var s=new P(n,o);s.z=i+1;var a=this._tileCoordsToKey(s),l=this._tiles[a];l&&l.active?l.retain=!0:(l&&l.loaded&&(l.retain=!0),i+1<r&&this._retainChildren(n,o,i+1,r))}},_resetView:function(t){var e=t&&(t.pinch||t.flyTo);this._setView(this._map.getCenter(),this._map.getZoom(),e,e)},_animateZoom:function(t){this._setView(t.center,t.zoom,!0,t.noUpdate)},_clampZoom:function(t){var e=this.options;return void 0!==e.minNativeZoom&&t<e.minNativeZoom?e.minNativeZoom:void 0!==e.maxNativeZoom&&e.maxNativeZoom<t?e.maxNativeZoom:t},_setView:function(t,e,i,r){var n=Math.round(e);n=void 0!==this.options.maxZoom&&n>this.options.maxZoom||void 0!==this.options.minZoom&&n<this.options.minZoom?void 0:this._clampZoom(n);var o=this.options.updateWhenZooming&&n!==this._tileZoom;r&&!o||(this._tileZoom=n,this._abortLoading&&this._abortLoading(),this._updateLevels(),this._resetGrid(),void 0!==n&&this._update(t),i||this._pruneTiles(),this._noPrune=!!i),this._setZoomTransforms(t,e)},_setZoomTransforms:function(t,e){for(var i in this._levels)this._setZoomTransform(this._levels[i],t,e)},_setZoomTransform:function(t,e,i){var r=this._map.getZoomScale(i,t.zoom),n=t.origin.multiplyBy(r).subtract(this._map._getNewPixelOrigin(e,i)).round();Ut.any3d?Se(t.el,n,r):Ie(t.el,n)},_resetGrid:function(){var t=this._map,e=t.options.crs,i=this._tileSize=this.getTileSize(),r=this._tileZoom,n=this._map.getPixelWorldBounds(this._tileZoom);n&&(this._globalTileRange=this._pxBoundsToTileRange(n)),this._wrapX=e.wrapLng&&!this.options.noWrap&&[Math.floor(t.project([0,e.wrapLng[0]],r).x/i.x),Math.ceil(t.project([0,e.wrapLng[1]],r).x/i.y)],this._wrapY=e.wrapLat&&!this.options.noWrap&&[Math.floor(t.project([e.wrapLat[0],0],r).y/i.x),Math.ceil(t.project([e.wrapLat[1],0],r).y/i.y)]},_onMoveEnd:function(){this._map&&!this._map._animatingZoom&&this._update()},_getTiledPixelBounds:function(t){var e=this._map,i=e._animatingZoom?Math.max(e._animateToZoom,e.getZoom()):e.getZoom(),r=e.getZoomScale(i,this._tileZoom),n=e.project(t,this._tileZoom).floor(),o=e.getSize().divideBy(2*r);return new D(n.subtract(o),n.add(o))},_update:function(t){var e=this._map;if(e){var i=this._clampZoom(e.getZoom());if(void 0===t&&(t=e.getCenter()),void 0!==this._tileZoom){var r=this._getTiledPixelBounds(t),n=this._pxBoundsToTileRange(r),o=n.getCenter(),s=[],a=this.options.keepBuffer,l=new D(n.getBottomLeft().subtract([a,-a]),n.getTopRight().add([a,-a]));if(!(isFinite(n.min.x)&&isFinite(n.min.y)&&isFinite(n.max.x)&&isFinite(n.max.y)))throw new Error("Attempted to load an infinite number of tiles");for(var c in this._tiles){var u=this._tiles[c].coords;u.z===this._tileZoom&&l.contains(new P(u.x,u.y))||(this._tiles[c].current=!1)}if(Math.abs(i-this._tileZoom)>1)this._setView(t,i);else{for(var h=n.min.y;h<=n.max.y;h++)for(var d=n.min.x;d<=n.max.x;d++){var p=new P(d,h);if(p.z=this._tileZoom,this._isValidTile(p)){var f=this._tiles[this._tileCoordsToKey(p)];f?f.current=!0:s.push(p)}}if(s.sort((function(t,e){return t.distanceTo(o)-e.distanceTo(o)})),0!==s.length){this._loading||(this._loading=!0,this.fire("loading"));var A=document.createDocumentFragment();for(d=0;d<s.length;d++)this._addTile(s[d],A);this._level.el.appendChild(A)}}}}},_isValidTile:function(t){var e=this._map.options.crs;if(!e.infinite){var i=this._globalTileRange;if(!e.wrapLng&&(t.x<i.min.x||t.x>i.max.x)||!e.wrapLat&&(t.y<i.min.y||t.y>i.max.y))return!1}if(!this.options.bounds)return!0;var r=this._tileCoordsToBounds(t);return O(this.options.bounds).overlaps(r)},_keyToBounds:function(t){return this._tileCoordsToBounds(this._keyToTileCoords(t))},_tileCoordsToNwSe:function(t){var e=this._map,i=this.getTileSize(),r=t.scaleBy(i),n=r.add(i);return[e.unproject(r,t.z),e.unproject(n,t.z)]},_tileCoordsToBounds:function(t){var e=this._tileCoordsToNwSe(t),i=new U(e[0],e[1]);return this.options.noWrap||(i=this._map.wrapLatLngBounds(i)),i},_tileCoordsToKey:function(t){return t.x+":"+t.y+":"+t.z},_keyToTileCoords:function(t){var e=t.split(":"),i=new P(+e[0],+e[1]);return i.z=+e[2],i},_removeTile:function(t){var e=this._tiles[t];e&&(me(e.el),delete this._tiles[t],this.fire("tileunload",{tile:e.el,coords:this._keyToTileCoords(t)}))},_initTile:function(t){xe(t,"leaflet-tile");var e=this.getTileSize();t.style.width=e.x+"px",t.style.height=e.y+"px",t.onselectstart=c,t.onmousemove=c,Ut.ielt9&&this.options.opacity<1&&Be(t,this.options.opacity)},_addTile:function(t,e){var i=this._getTilePos(t),r=this._tileCoordsToKey(t),o=this.createTile(this._wrapCoords(t),n(this._tileReady,this,t));this._initTile(o),this.createTile.length<2&&B(n(this._tileReady,this,t,null,o)),Ie(o,i),this._tiles[r]={el:o,coords:t,current:!0},e.appendChild(o),this.fire("tileloadstart",{tile:o,coords:t})},_tileReady:function(t,e,i){e&&this.fire("tileerror",{error:e,tile:i,coords:t});var r=this._tileCoordsToKey(t);(i=this._tiles[r])&&(i.loaded=+new Date,this._map._fadeAnimated?(Be(i.el,0),E(this._fadeFrame),this._fadeFrame=B(this._updateOpacity,this)):(i.active=!0,this._pruneTiles()),e||(xe(i.el,"leaflet-tile-loaded"),this.fire("tileload",{tile:i.el,coords:t})),this._noTilesToLoad()&&(this._loading=!1,this.fire("load"),Ut.ielt9||!this._map._fadeAnimated?B(this._pruneTiles,this):setTimeout(n(this._pruneTiles,this),250)))},_getTilePos:function(t){return t.scaleBy(this.getTileSize()).subtract(this._level.origin)},_wrapCoords:function(t){var e=new P(this._wrapX?l(t.x,this._wrapX):t.x,this._wrapY?l(t.y,this._wrapY):t.y);return e.z=t.z,e},_pxBoundsToTileRange:function(t){var e=this.getTileSize();return new D(t.min.unscaleBy(e).floor(),t.max.unscaleBy(e).ceil().subtract([1,1]))},_noTilesToLoad:function(){for(var t in this._tiles)if(!this._tiles[t].loaded)return!1;return!0}});function Or(t){return new Ur(t)}var Nr=Ur.extend({options:{minZoom:0,maxZoom:18,subdomains:"abc",errorTileUrl:"",zoomOffset:0,tms:!1,zoomReverse:!1,detectRetina:!1,crossOrigin:!1,referrerPolicy:!1},initialize:function(t,e){this._url=t,(e=p(this,e)).detectRetina&&Ut.retina&&e.maxZoom>0?(e.tileSize=Math.floor(e.tileSize/2),e.zoomReverse?(e.zoomOffset--,e.minZoom=Math.min(e.maxZoom,e.minZoom+1)):(e.zoomOffset++,e.maxZoom=Math.max(e.minZoom,e.maxZoom-1)),e.minZoom=Math.max(0,e.minZoom)):e.zoomReverse?e.minZoom=Math.min(e.maxZoom,e.minZoom):e.maxZoom=Math.max(e.minZoom,e.maxZoom),"string"==typeof e.subdomains&&(e.subdomains=e.subdomains.split("")),this.on("tileunload",this._onTileRemove)},setUrl:function(t,e){return this._url===t&&void 0===e&&(e=!0),this._url=t,e||this.redraw(),this},createTile:function(t,e){var i=document.createElement("img");return Oe(i,"load",n(this._tileOnLoad,this,e,i)),Oe(i,"error",n(this._tileOnError,this,e,i)),(this.options.crossOrigin||""===this.options.crossOrigin)&&(i.crossOrigin=!0===this.options.crossOrigin?"":this.options.crossOrigin),"string"==typeof this.options.referrerPolicy&&(i.referrerPolicy=this.options.referrerPolicy),i.alt="",i.src=this.getTileUrl(t),i},getTileUrl:function(t){var e={r:Ut.retina?"@2x":"",s:this._getSubdomain(t),x:t.x,y:t.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var r=this._globalTileRange.max.y-t.y;this.options.tms&&(e.y=r),e["-y"]=r}return m(this._url,i(e,this.options))},_tileOnLoad:function(t,e){Ut.ielt9?setTimeout(n(t,this,null,e),0):t(null,e)},_tileOnError:function(t,e,i){var r=this.options.errorTileUrl;r&&e.getAttribute("src")!==r&&(e.src=r),t(i,e)},_onTileRemove:function(t){t.tile.onload=null},_getZoomForUrl:function(){var t=this._tileZoom,e=this.options.maxZoom;return this.options.zoomReverse&&(t=e-t),t+this.options.zoomOffset},_getSubdomain:function(t){var e=Math.abs(t.x+t.y)%this.options.subdomains.length;return this.options.subdomains[e]},_abortLoading:function(){var t,e;for(t in this._tiles)if(this._tiles[t].coords.z!==this._tileZoom&&((e=this._tiles[t].el).onload=c,e.onerror=c,!e.complete)){e.src=y;var i=this._tiles[t].coords;me(e),delete this._tiles[t],this.fire("tileabort",{tile:e,coords:i})}},_removeTile:function(t){var e=this._tiles[t];if(e)return e.el.setAttribute("src",y),Ur.prototype._removeTile.call(this,t)},_tileReady:function(t,e,i){if(this._map&&(!i||i.getAttribute("src")!==y))return Ur.prototype._tileReady.call(this,t,e,i)}});function Qr(t,e){return new Nr(t,e)}var Vr=Nr.extend({defaultWmsParams:{service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},options:{crs:null,uppercase:!1},initialize:function(t,e){this._url=t;var r=i({},this.defaultWmsParams);for(var n in e)n in this.options||(r[n]=e[n]);var o=(e=p(this,e)).detectRetina&&Ut.retina?2:1,s=this.getTileSize();r.width=s.x*o,r.height=s.y*o,this.wmsParams=r},onAdd:function(t){this._crs=this.options.crs||t.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var e=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[e]=this._crs.code,Nr.prototype.onAdd.call(this,t)},getTileUrl:function(t){var e=this._tileCoordsToNwSe(t),i=this._crs,r=R(i.project(e[0]),i.project(e[1])),n=r.min,o=r.max,s=(this._wmsVersion>=1.3&&this._crs===Gi?[n.y,n.x,o.y,o.x]:[n.x,n.y,o.x,o.y]).join(","),a=Nr.prototype.getTileUrl.call(this,t);return a+f(this.wmsParams,a,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+s},setParams:function(t,e){return i(this.wmsParams,t),e||this.redraw(),this}});function jr(t,e){return new Vr(t,e)}Nr.WMS=Vr,Qr.wms=jr;var Hr=Zi.extend({options:{padding:.1},initialize:function(t){p(this,t),s(this),this._layers=this._layers||{}},onAdd:function(){this._container||(this._initContainer(),xe(this._container,"leaflet-zoom-animated")),this.getPane().appendChild(this._container),this._update(),this.on("update",this._updatePaths,this)},onRemove:function(){this.off("update",this._updatePaths,this),this._destroyContainer()},getEvents:function(){var t={viewreset:this._reset,zoom:this._onZoom,moveend:this._update,zoomend:this._onZoomEnd};return this._zoomAnimated&&(t.zoomanim=this._onAnimZoom),t},_onAnimZoom:function(t){this._updateTransform(t.center,t.zoom)},_onZoom:function(){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_updateTransform:function(t,e){var i=this._map.getZoomScale(e,this._zoom),r=this._map.getSize().multiplyBy(.5+this.options.padding),n=this._map.project(this._center,e),o=r.multiplyBy(-i).add(n).subtract(this._map._getNewPixelOrigin(t,e));Ut.any3d?Se(this._container,o,i):Ie(this._container,o)},_reset:function(){for(var t in this._update(),this._updateTransform(this._center,this._zoom),this._layers)this._layers[t]._reset()},_onZoomEnd:function(){for(var t in this._layers)this._layers[t]._project()},_updatePaths:function(){for(var t in this._layers)this._layers[t]._update()},_update:function(){var t=this.options.padding,e=this._map.getSize(),i=this._map.containerPointToLayerPoint(e.multiplyBy(-t)).round();this._bounds=new D(i,i.add(e.multiplyBy(1+2*t)).round()),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()}}),Gr=Hr.extend({options:{tolerance:0},getEvents:function(){var t=Hr.prototype.getEvents.call(this);return t.viewprereset=this._onViewPreReset,t},_onViewPreReset:function(){this._postponeUpdatePaths=!0},onAdd:function(){Hr.prototype.onAdd.call(this),this._draw()},_initContainer:function(){var t=this._container=document.createElement("canvas");Oe(t,"mousemove",this._onMouseMove,this),Oe(t,"click dblclick mousedown mouseup contextmenu",this._onClick,this),Oe(t,"mouseout",this._handleMouseOut,this),t._leaflet_disable_events=!0,this._ctx=t.getContext("2d")},_destroyContainer:function(){E(this._redrawRequest),delete this._ctx,me(this._container),Qe(this._container),delete this._container},_updatePaths:function(){if(!this._postponeUpdatePaths){for(var t in this._redrawBounds=null,this._layers)this._layers[t]._update();this._redraw()}},_update:function(){if(!this._map._animatingZoom||!this._bounds){Hr.prototype._update.call(this);var t=this._bounds,e=this._container,i=t.getSize(),r=Ut.retina?2:1;Ie(e,t.min),e.width=r*i.x,e.height=r*i.y,e.style.width=i.x+"px",e.style.height=i.y+"px",Ut.retina&&this._ctx.scale(2,2),this._ctx.translate(-t.min.x,-t.min.y),this.fire("update")}},_reset:function(){Hr.prototype._reset.call(this),this._postponeUpdatePaths&&(this._postponeUpdatePaths=!1,this._updatePaths())},_initPath:function(t){this._updateDashArray(t),this._layers[s(t)]=t;var e=t._order={layer:t,prev:this._drawLast,next:null};this._drawLast&&(this._drawLast.next=e),this._drawLast=e,this._drawFirst=this._drawFirst||this._drawLast},_addPath:function(t){this._requestRedraw(t)},_removePath:function(t){var e=t._order,i=e.next,r=e.prev;i?i.prev=r:this._drawLast=r,r?r.next=i:this._drawFirst=i,delete t._order,delete this._layers[s(t)],this._requestRedraw(t)},_updatePath:function(t){this._extendRedrawBounds(t),t._project(),t._update(),this._requestRedraw(t)},_updateStyle:function(t){this._updateDashArray(t),this._requestRedraw(t)},_updateDashArray:function(t){if("string"==typeof t.options.dashArray){var e,i,r=t.options.dashArray.split(/[, ]+/),n=[];for(i=0;i<r.length;i++){if(e=Number(r[i]),isNaN(e))return;n.push(e)}t.options._dashArray=n}else t.options._dashArray=t.options.dashArray},_requestRedraw:function(t){this._map&&(this._extendRedrawBounds(t),this._redrawRequest=this._redrawRequest||B(this._redraw,this))},_extendRedrawBounds:function(t){if(t._pxBounds){var e=(t.options.weight||0)+1;this._redrawBounds=this._redrawBounds||new D,this._redrawBounds.extend(t._pxBounds.min.subtract([e,e])),this._redrawBounds.extend(t._pxBounds.max.add([e,e]))}},_redraw:function(){this._redrawRequest=null,this._redrawBounds&&(this._redrawBounds.min._floor(),this._redrawBounds.max._ceil()),this._clear(),this._draw(),this._redrawBounds=null},_clear:function(){var t=this._redrawBounds;if(t){var e=t.getSize();this._ctx.clearRect(t.min.x,t.min.y,e.x,e.y)}else this._ctx.save(),this._ctx.setTransform(1,0,0,1,0,0),this._ctx.clearRect(0,0,this._container.width,this._container.height),this._ctx.restore()},_draw:function(){var t,e=this._redrawBounds;if(this._ctx.save(),e){var i=e.getSize();this._ctx.beginPath(),this._ctx.rect(e.min.x,e.min.y,i.x,i.y),this._ctx.clip()}this._drawing=!0;for(var r=this._drawFirst;r;r=r.next)t=r.layer,(!e||t._pxBounds&&t._pxBounds.intersects(e))&&t._updatePath();this._drawing=!1,this._ctx.restore()},_updatePoly:function(t,e){if(this._drawing){var i,r,n,o,s=t._parts,a=s.length,l=this._ctx;if(a){for(l.beginPath(),i=0;i<a;i++){for(r=0,n=s[i].length;r<n;r++)o=s[i][r],l[r?"lineTo":"moveTo"](o.x,o.y);e&&l.closePath()}this._fillStroke(l,t)}}},_updateCircle:function(t){if(this._drawing&&!t._empty()){var e=t._point,i=this._ctx,r=Math.max(Math.round(t._radius),1),n=(Math.max(Math.round(t._radiusY),1)||r)/r;1!==n&&(i.save(),i.scale(1,n)),i.beginPath(),i.arc(e.x,e.y/n,r,0,2*Math.PI,!1),1!==n&&i.restore(),this._fillStroke(i,t)}},_fillStroke:function(t,e){var i=e.options;i.fill&&(t.globalAlpha=i.fillOpacity,t.fillStyle=i.fillColor||i.color,t.fill(i.fillRule||"evenodd")),i.stroke&&0!==i.weight&&(t.setLineDash&&t.setLineDash(e.options&&e.options._dashArray||[]),t.globalAlpha=i.opacity,t.lineWidth=i.weight,t.strokeStyle=i.color,t.lineCap=i.lineCap,t.lineJoin=i.lineJoin,t.stroke())},_onClick:function(t){for(var e,i,r=this._map.mouseEventToLayerPoint(t),n=this._drawFirst;n;n=n.next)(e=n.layer).options.interactive&&e._containsPoint(r)&&("click"!==t.type&&"preclick"!==t.type||!this._map._draggableMoved(e))&&(i=e);this._fireEvent(!!i&&[i],t)},_onMouseMove:function(t){if(this._map&&!this._map.dragging.moving()&&!this._map._animatingZoom){var e=this._map.mouseEventToLayerPoint(t);this._handleMouseHover(t,e)}},_handleMouseOut:function(t){var e=this._hoveredLayer;e&&(be(this._container,"leaflet-interactive"),this._fireEvent([e],t,"mouseout"),this._hoveredLayer=null,this._mouseHoverThrottled=!1)},_handleMouseHover:function(t,e){if(!this._mouseHoverThrottled){for(var i,r,o=this._drawFirst;o;o=o.next)(i=o.layer).options.interactive&&i._containsPoint(e)&&(r=i);r!==this._hoveredLayer&&(this._handleMouseOut(t),r&&(xe(this._container,"leaflet-interactive"),this._fireEvent([r],t,"mouseover"),this._hoveredLayer=r)),this._fireEvent(!!this._hoveredLayer&&[this._hoveredLayer],t),this._mouseHoverThrottled=!0,setTimeout(n((function(){this._mouseHoverThrottled=!1}),this),32)}},_fireEvent:function(t,e,i){this._map._fireDOMEvent(e,i||e.type,t)},_bringToFront:function(t){var e=t._order;if(e){var i=e.next,r=e.prev;i&&(i.prev=r,r?r.next=i:i&&(this._drawFirst=i),e.prev=this._drawLast,this._drawLast.next=e,e.next=null,this._drawLast=e,this._requestRedraw(t))}},_bringToBack:function(t){var e=t._order;if(e){var i=e.next,r=e.prev;r&&(r.next=i,i?i.prev=r:r&&(this._drawLast=r),e.prev=null,e.next=this._drawFirst,this._drawFirst.prev=e,this._drawFirst=e,this._requestRedraw(t))}}});function $r(t){return Ut.canvas?new Gr(t):null}var Zr=function(){try{return document.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(t){return document.createElement("<lvml:"+t+' class="lvml">')}}catch(t){}return function(t){return document.createElement("<"+t+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}}(),qr={_initContainer:function(){this._container=Ae("div","leaflet-vml-container")},_update:function(){this._map._animatingZoom||(Hr.prototype._update.call(this),this.fire("update"))},_initPath:function(t){var e=t._container=Zr("shape");xe(e,"leaflet-vml-shape "+(this.options.className||"")),e.coordsize="1 1",t._path=Zr("path"),e.appendChild(t._path),this._updateStyle(t),this._layers[s(t)]=t},_addPath:function(t){var e=t._container;this._container.appendChild(e),t.options.interactive&&t.addInteractiveTarget(e)},_removePath:function(t){var e=t._container;me(e),t.removeInteractiveTarget(e),delete this._layers[s(t)]},_updateStyle:function(t){var e=t._stroke,i=t._fill,r=t.options,n=t._container;n.stroked=!!r.stroke,n.filled=!!r.fill,r.stroke?(e||(e=t._stroke=Zr("stroke")),n.appendChild(e),e.weight=r.weight+"px",e.color=r.color,e.opacity=r.opacity,r.dashArray?e.dashStyle=g(r.dashArray)?r.dashArray.join(" "):r.dashArray.replace(/( *, *)/g," "):e.dashStyle="",e.endcap=r.lineCap.replace("butt","flat"),e.joinstyle=r.lineJoin):e&&(n.removeChild(e),t._stroke=null),r.fill?(i||(i=t._fill=Zr("fill")),n.appendChild(i),i.color=r.fillColor||r.color,i.opacity=r.fillOpacity):i&&(n.removeChild(i),t._fill=null)},_updateCircle:function(t){var e=t._point.round(),i=Math.round(t._radius),r=Math.round(t._radiusY||i);this._setPath(t,t._empty()?"M0 0":"AL "+e.x+","+e.y+" "+i+","+r+" 0,23592600")},_setPath:function(t,e){t._path.v=e},_bringToFront:function(t){_e(t._container)},_bringToBack:function(t){ye(t._container)}},Kr=Ut.vml?Zr:X,Wr=Hr.extend({_initContainer:function(){this._container=Kr("svg"),this._container.setAttribute("pointer-events","none"),this._rootGroup=Kr("g"),this._container.appendChild(this._rootGroup)},_destroyContainer:function(){me(this._container),Qe(this._container),delete this._container,delete this._rootGroup,delete this._svgSize},_update:function(){if(!this._map._animatingZoom||!this._bounds){Hr.prototype._update.call(this);var t=this._bounds,e=t.getSize(),i=this._container;this._svgSize&&this._svgSize.equals(e)||(this._svgSize=e,i.setAttribute("width",e.x),i.setAttribute("height",e.y)),Ie(i,t.min),i.setAttribute("viewBox",[t.min.x,t.min.y,e.x,e.y].join(" ")),this.fire("update")}},_initPath:function(t){var e=t._path=Kr("path");t.options.className&&xe(e,t.options.className),t.options.interactive&&xe(e,"leaflet-interactive"),this._updateStyle(t),this._layers[s(t)]=t},_addPath:function(t){this._rootGroup||this._initContainer(),this._rootGroup.appendChild(t._path),t.addInteractiveTarget(t._path)},_removePath:function(t){me(t._path),t.removeInteractiveTarget(t._path),delete this._layers[s(t)]},_updatePath:function(t){t._project(),t._update()},_updateStyle:function(t){var e=t._path,i=t.options;e&&(i.stroke?(e.setAttribute("stroke",i.color),e.setAttribute("stroke-opacity",i.opacity),e.setAttribute("stroke-width",i.weight),e.setAttribute("stroke-linecap",i.lineCap),e.setAttribute("stroke-linejoin",i.lineJoin),i.dashArray?e.setAttribute("stroke-dasharray",i.dashArray):e.removeAttribute("stroke-dasharray"),i.dashOffset?e.setAttribute("stroke-dashoffset",i.dashOffset):e.removeAttribute("stroke-dashoffset")):e.setAttribute("stroke","none"),i.fill?(e.setAttribute("fill",i.fillColor||i.color),e.setAttribute("fill-opacity",i.fillOpacity),e.setAttribute("fill-rule",i.fillRule||"evenodd")):e.setAttribute("fill","none"))},_updatePoly:function(t,e){this._setPath(t,J(t._parts,e))},_updateCircle:function(t){var e=t._point,i=Math.max(Math.round(t._radius),1),r="a"+i+","+(Math.max(Math.round(t._radiusY),1)||i)+" 0 1,0 ",n=t._empty()?"M0 0":"M"+(e.x-i)+","+e.y+r+2*i+",0 "+r+2*-i+",0 ";this._setPath(t,n)},_setPath:function(t,e){t._path.setAttribute("d",e)},_bringToFront:function(t){_e(t._path)},_bringToBack:function(t){ye(t._path)}});function Xr(t){return Ut.svg||Ut.vml?new Wr(t):null}Ut.vml&&Wr.include(qr),ni.include({getRenderer:function(t){var e=t.options.renderer||this._getPaneRenderer(t.options.pane)||this.options.renderer||this._renderer;return e||(e=this._renderer=this._createRenderer()),this.hasLayer(e)||this.addLayer(e),e},_getPaneRenderer:function(t){if("overlayPane"===t||void 0===t)return!1;var e=this._paneRenderers[t];return void 0===e&&(e=this._createRenderer({pane:t}),this._paneRenderers[t]=e),e},_createRenderer:function(t){return this.options.preferCanvas&&$r(t)||Xr(t)}});var Jr=hr.extend({initialize:function(t,e){hr.prototype.initialize.call(this,this._boundsToLatLngs(t),e)},setBounds:function(t){return this.setLatLngs(this._boundsToLatLngs(t))},_boundsToLatLngs:function(t){return[(t=O(t)).getSouthWest(),t.getNorthWest(),t.getNorthEast(),t.getSouthEast()]}});function Yr(t,e){return new Jr(t,e)}Wr.create=Kr,Wr.pointsToPath=J,pr.geometryToLayer=fr,pr.coordsToLatLng=mr,pr.coordsToLatLngs=gr,pr.latLngToCoords=_r,pr.latLngsToCoords=yr,pr.getFeature=vr,pr.asFeature=xr,ni.mergeOptions({boxZoom:!0});var tn=gi.extend({initialize:function(t){this._map=t,this._container=t._container,this._pane=t._panes.overlayPane,this._resetStateTimeout=0,t.on("unload",this._destroy,this)},addHooks:function(){Oe(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){Qe(this._container,"mousedown",this._onMouseDown,this)},moved:function(){return this._moved},_destroy:function(){me(this._pane),delete this._pane},_resetState:function(){this._resetStateTimeout=0,this._moved=!1},_clearDeferredResetState:function(){0!==this._resetStateTimeout&&(clearTimeout(this._resetStateTimeout),this._resetStateTimeout=0)},_onMouseDown:function(t){if(!t.shiftKey||1!==t.which&&1!==t.button)return!1;this._clearDeferredResetState(),this._resetState(),oe(),Pe(),this._startPoint=this._map.mouseEventToContainerPoint(t),Oe(document,{contextmenu:We,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseMove:function(t){this._moved||(this._moved=!0,this._box=Ae("div","leaflet-zoom-box",this._container),xe(this._container,"leaflet-crosshair"),this._map.fire("boxzoomstart")),this._point=this._map.mouseEventToContainerPoint(t);var e=new D(this._point,this._startPoint),i=e.getSize();Ie(this._box,e.min),this._box.style.width=i.x+"px",this._box.style.height=i.y+"px"},_finish:function(){this._moved&&(me(this._box),be(this._container,"leaflet-crosshair")),se(),Le(),Qe(document,{contextmenu:We,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseUp:function(t){if((1===t.which||1===t.button)&&(this._finish(),this._moved)){this._clearDeferredResetState(),this._resetStateTimeout=setTimeout(n(this._resetState,this),0);var e=new U(this._map.containerPointToLatLng(this._startPoint),this._map.containerPointToLatLng(this._point));this._map.fitBounds(e).fire("boxzoomend",{boxZoomBounds:e})}},_onKeyDown:function(t){27===t.keyCode&&(this._finish(),this._clearDeferredResetState(),this._resetState())}});ni.addInitHook("addHandler","boxZoom",tn),ni.mergeOptions({doubleClickZoom:!0});var en=gi.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(t){var e=this._map,i=e.getZoom(),r=e.options.zoomDelta,n=t.originalEvent.shiftKey?i-r:i+r;"center"===e.options.doubleClickZoom?e.setZoom(n):e.setZoomAround(t.containerPoint,n)}});ni.addInitHook("addHandler","doubleClickZoom",en),ni.mergeOptions({dragging:!0,inertia:!0,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,easeLinearity:.2,worldCopyJump:!1,maxBoundsViscosity:0});var rn=gi.extend({addHooks:function(){if(!this._draggable){var t=this._map;this._draggable=new vi(t._mapPane,t._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),this._draggable.on("predrag",this._onPreDragLimit,this),t.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDragWrap,this),t.on("zoomend",this._onZoomEnd,this),t.whenReady(this._onZoomEnd,this))}xe(this._map._container,"leaflet-grab leaflet-touch-drag"),this._draggable.enable(),this._positions=[],this._times=[]},removeHooks:function(){be(this._map._container,"leaflet-grab"),be(this._map._container,"leaflet-touch-drag"),this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},moving:function(){return this._draggable&&this._draggable._moving},_onDragStart:function(){var t=this._map;if(t._stop(),this._map.options.maxBounds&&this._map.options.maxBoundsViscosity){var e=O(this._map.options.maxBounds);this._offsetLimit=R(this._map.latLngToContainerPoint(e.getNorthWest()).multiplyBy(-1),this._map.latLngToContainerPoint(e.getSouthEast()).multiplyBy(-1).add(this._map.getSize())),this._viscosity=Math.min(1,Math.max(0,this._map.options.maxBoundsViscosity))}else this._offsetLimit=null;t.fire("movestart").fire("dragstart"),t.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(t){if(this._map.options.inertia){var e=this._lastTime=+new Date,i=this._lastPos=this._draggable._absPos||this._draggable._newPos;this._positions.push(i),this._times.push(e),this._prunePositions(e)}this._map.fire("move",t).fire("drag",t)},_prunePositions:function(t){for(;this._positions.length>1&&t-this._times[0]>50;)this._positions.shift(),this._times.shift()},_onZoomEnd:function(){var t=this._map.getSize().divideBy(2),e=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=e.subtract(t).x,this._worldWidth=this._map.getPixelWorldBounds().getSize().x},_viscousLimit:function(t,e){return t-(t-e)*this._viscosity},_onPreDragLimit:function(){if(this._viscosity&&this._offsetLimit){var t=this._draggable._newPos.subtract(this._draggable._startPos),e=this._offsetLimit;t.x<e.min.x&&(t.x=this._viscousLimit(t.x,e.min.x)),t.y<e.min.y&&(t.y=this._viscousLimit(t.y,e.min.y)),t.x>e.max.x&&(t.x=this._viscousLimit(t.x,e.max.x)),t.y>e.max.y&&(t.y=this._viscousLimit(t.y,e.max.y)),this._draggable._newPos=this._draggable._startPos.add(t)}},_onPreDragWrap:function(){var t=this._worldWidth,e=Math.round(t/2),i=this._initialWorldOffset,r=this._draggable._newPos.x,n=(r-e+i)%t+e-i,o=(r+e+i)%t-e-i,s=Math.abs(n+i)<Math.abs(o+i)?n:o;this._draggable._absPos=this._draggable._newPos.clone(),this._draggable._newPos.x=s},_onDragEnd:function(t){var e=this._map,i=e.options,r=!i.inertia||t.noInertia||this._times.length<2;if(e.fire("dragend",t),r)e.fire("moveend");else{this._prunePositions(+new Date);var n=this._lastPos.subtract(this._positions[0]),o=(this._lastTime-this._times[0])/1e3,s=i.easeLinearity,a=n.multiplyBy(s/o),l=a.distanceTo([0,0]),c=Math.min(i.inertiaMaxSpeed,l),u=a.multiplyBy(c/l),h=c/(i.inertiaDeceleration*s),d=u.multiplyBy(-h/2).round();d.x||d.y?(d=e._limitOffset(d,e.options.maxBounds),B((function(){e.panBy(d,{duration:h,easeLinearity:s,noMoveStart:!0,animate:!0})}))):e.fire("moveend")}}});ni.addInitHook("addHandler","dragging",rn),ni.mergeOptions({keyboard:!0,keyboardPanDelta:80});var nn=gi.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,54,173]},initialize:function(t){this._map=t,this._setPanDelta(t.options.keyboardPanDelta),this._setZoomDelta(t.options.zoomDelta)},addHooks:function(){var t=this._map._container;t.tabIndex<=0&&(t.tabIndex="0"),Oe(t,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.on({focus:this._addHooks,blur:this._removeHooks},this)},removeHooks:function(){this._removeHooks(),Qe(this._map._container,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.off({focus:this._addHooks,blur:this._removeHooks},this)},_onMouseDown:function(){if(!this._focused){var t=document.body,e=document.documentElement,i=t.scrollTop||e.scrollTop,r=t.scrollLeft||e.scrollLeft;this._map._container.focus(),window.scrollTo(r,i)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanDelta:function(t){var e,i,r=this._panKeys={},n=this.keyCodes;for(e=0,i=n.left.length;e<i;e++)r[n.left[e]]=[-1*t,0];for(e=0,i=n.right.length;e<i;e++)r[n.right[e]]=[t,0];for(e=0,i=n.down.length;e<i;e++)r[n.down[e]]=[0,t];for(e=0,i=n.up.length;e<i;e++)r[n.up[e]]=[0,-1*t]},_setZoomDelta:function(t){var e,i,r=this._zoomKeys={},n=this.keyCodes;for(e=0,i=n.zoomIn.length;e<i;e++)r[n.zoomIn[e]]=t;for(e=0,i=n.zoomOut.length;e<i;e++)r[n.zoomOut[e]]=-t},_addHooks:function(){Oe(document,"keydown",this._onKeyDown,this)},_removeHooks:function(){Qe(document,"keydown",this._onKeyDown,this)},_onKeyDown:function(t){if(!(t.altKey||t.ctrlKey||t.metaKey)){var e,i=t.keyCode,r=this._map;if(i in this._panKeys){if(!r._panAnim||!r._panAnim._inProgress)if(e=this._panKeys[i],t.shiftKey&&(e=F(e).multiplyBy(3)),r.options.maxBounds&&(e=r._limitOffset(F(e),r.options.maxBounds)),r.options.worldCopyJump){var n=r.wrapLatLng(r.unproject(r.project(r.getCenter()).add(e)));r.panTo(n)}else r.panBy(e)}else if(i in this._zoomKeys)r.setZoom(r.getZoom()+(t.shiftKey?3:1)*this._zoomKeys[i]);else{if(27!==i||!r._popup||!r._popup.options.closeOnEscapeKey)return;r.closePopup()}We(t)}}});ni.addInitHook("addHandler","keyboard",nn),ni.mergeOptions({scrollWheelZoom:!0,wheelDebounceTime:40,wheelPxPerZoomLevel:60});var on=gi.extend({addHooks:function(){Oe(this._map._container,"wheel",this._onWheelScroll,this),this._delta=0},removeHooks:function(){Qe(this._map._container,"wheel",this._onWheelScroll,this)},_onWheelScroll:function(t){var e=ti(t),i=this._map.options.wheelDebounceTime;this._delta+=e,this._lastMousePos=this._map.mouseEventToContainerPoint(t),this._startTime||(this._startTime=+new Date);var r=Math.max(i-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(n(this._performZoom,this),r),We(t)},_performZoom:function(){var t=this._map,e=t.getZoom(),i=this._map.options.zoomSnap||0;t._stop();var r=this._delta/(4*this._map.options.wheelPxPerZoomLevel),n=4*Math.log(2/(1+Math.exp(-Math.abs(r))))/Math.LN2,o=i?Math.ceil(n/i)*i:n,s=t._limitZoom(e+(this._delta>0?o:-o))-e;this._delta=0,this._startTime=null,s&&("center"===t.options.scrollWheelZoom?t.setZoom(e+s):t.setZoomAround(this._lastMousePos,e+s))}});ni.addInitHook("addHandler","scrollWheelZoom",on);var sn=600;ni.mergeOptions({tapHold:Ut.touchNative&&Ut.safari&&Ut.mobile,tapTolerance:15});var an=gi.extend({addHooks:function(){Oe(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){Qe(this._map._container,"touchstart",this._onDown,this)},_onDown:function(t){if(clearTimeout(this._holdTimeout),1===t.touches.length){var e=t.touches[0];this._startPos=this._newPos=new P(e.clientX,e.clientY),this._holdTimeout=setTimeout(n((function(){this._cancel(),this._isTapValid()&&(Oe(document,"touchend",Ke),Oe(document,"touchend touchcancel",this._cancelClickPrevent),this._simulateEvent("contextmenu",e))}),this),sn),Oe(document,"touchend touchcancel contextmenu",this._cancel,this),Oe(document,"touchmove",this._onMove,this)}},_cancelClickPrevent:function t(){Qe(document,"touchend",Ke),Qe(document,"touchend touchcancel",t)},_cancel:function(){clearTimeout(this._holdTimeout),Qe(document,"touchend touchcancel contextmenu",this._cancel,this),Qe(document,"touchmove",this._onMove,this)},_onMove:function(t){var e=t.touches[0];this._newPos=new P(e.clientX,e.clientY)},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_simulateEvent:function(t,e){var i=new MouseEvent(t,{bubbles:!0,cancelable:!0,view:window,screenX:e.screenX,screenY:e.screenY,clientX:e.clientX,clientY:e.clientY});i._simulated=!0,e.target.dispatchEvent(i)}});ni.addInitHook("addHandler","tapHold",an),ni.mergeOptions({touchZoom:Ut.touch,bounceAtZoomLimits:!0});var ln=gi.extend({addHooks:function(){xe(this._map._container,"leaflet-touch-zoom"),Oe(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){be(this._map._container,"leaflet-touch-zoom"),Qe(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(t){var e=this._map;if(t.touches&&2===t.touches.length&&!e._animatingZoom&&!this._zooming){var i=e.mouseEventToContainerPoint(t.touches[0]),r=e.mouseEventToContainerPoint(t.touches[1]);this._centerPoint=e.getSize()._divideBy(2),this._startLatLng=e.containerPointToLatLng(this._centerPoint),"center"!==e.options.touchZoom&&(this._pinchStartLatLng=e.containerPointToLatLng(i.add(r)._divideBy(2))),this._startDist=i.distanceTo(r),this._startZoom=e.getZoom(),this._moved=!1,this._zooming=!0,e._stop(),Oe(document,"touchmove",this._onTouchMove,this),Oe(document,"touchend touchcancel",this._onTouchEnd,this),Ke(t)}},_onTouchMove:function(t){if(t.touches&&2===t.touches.length&&this._zooming){var e=this._map,i=e.mouseEventToContainerPoint(t.touches[0]),r=e.mouseEventToContainerPoint(t.touches[1]),o=i.distanceTo(r)/this._startDist;if(this._zoom=e.getScaleZoom(o,this._startZoom),!e.options.bounceAtZoomLimits&&(this._zoom<e.getMinZoom()&&o<1||this._zoom>e.getMaxZoom()&&o>1)&&(this._zoom=e._limitZoom(this._zoom)),"center"===e.options.touchZoom){if(this._center=this._startLatLng,1===o)return}else{var s=i._add(r)._divideBy(2)._subtract(this._centerPoint);if(1===o&&0===s.x&&0===s.y)return;this._center=e.unproject(e.project(this._pinchStartLatLng,this._zoom).subtract(s),this._zoom)}this._moved||(e._moveStart(!0,!1),this._moved=!0),E(this._animRequest);var a=n(e._move,e,this._center,this._zoom,{pinch:!0,round:!1},void 0);this._animRequest=B(a,this,!0),Ke(t)}},_onTouchEnd:function(){this._moved&&this._zooming?(this._zooming=!1,E(this._animRequest),Qe(document,"touchmove",this._onTouchMove,this),Qe(document,"touchend touchcancel",this._onTouchEnd,this),this._map.options.zoomAnimation?this._map._animateZoom(this._center,this._map._limitZoom(this._zoom),!0,this._map.options.zoomSnap):this._map._resetView(this._center,this._map._limitZoom(this._zoom))):this._zooming=!1}});ni.addInitHook("addHandler","touchZoom",ln),ni.BoxZoom=tn,ni.DoubleClickZoom=en,ni.Drag=rn,ni.Keyboard=nn,ni.ScrollWheelZoom=on,ni.TapHold=an,ni.TouchZoom=ln,t.Bounds=D,t.Browser=Ut,t.CRS=j,t.Canvas=Gr,t.Circle=ar,t.CircleMarker=or,t.Class=S,t.Control=si,t.DivIcon=Dr,t.DivOverlay=kr,t.DomEvent=ii,t.DomUtil=Ue,t.Draggable=vi,t.Evented=k,t.FeatureGroup=Wi,t.GeoJSON=pr,t.GridLayer=Ur,t.Handler=gi,t.Icon=Ji,t.ImageOverlay=Br,t.LatLng=N,t.LatLngBounds=U,t.Layer=Zi,t.LayerGroup=qi,t.LineUtil=Ni,t.Map=ni,t.Marker=ir,t.Mixin=_i,t.Path=nr,t.Point=P,t.PolyUtil=Bi,t.Polygon=hr,t.Polyline=cr,t.Popup=Pr,t.PosAnimation=ri,t.Projection=ji,t.Rectangle=Jr,t.Renderer=Hr,t.SVG=Wr,t.SVGOverlay=Ir,t.TileLayer=Nr,t.Tooltip=zr,t.Transformation=Z,t.Util=C,t.VideoOverlay=Cr,t.bind=n,t.bounds=R,t.canvas=$r,t.circle=lr,t.circleMarker=sr,t.control=ai,t.divIcon=Rr,t.extend=i,t.featureGroup=Xi,t.geoJSON=wr,t.geoJson=Tr,t.gridLayer=Or,t.icon=Yi,t.imageOverlay=Er,t.latLng=Q,t.latLngBounds=O,t.layerGroup=Ki,t.map=oi,t.marker=rr,t.point=F,t.polygon=dr,t.polyline=ur,t.popup=Lr,t.rectangle=Yr,t.setOptions=p,t.stamp=s,t.svg=Xr,t.svgOverlay=Mr,t.tileLayer=Qr,t.tooltip=Fr,t.transformation=q,t.version=e,t.videoOverlay=Sr;var cn=window.L;t.noConflict=function(){return window.L=cn,this},window.L=t}(il.exports);class ol extends At{constructor(t){super(),ft(this,t,nl,rl,a,{id:0,center:1,zoom:2,mapStyle:3,numberOfMaps:4,overrideLayer:5})}}var sl={exports:{}};function al(t){let e,r;const n=[{mapStyle:t[0]},{overrideLayer:t[1]},t[2]];let o={};for(let t=0;t<n.length;t+=1)o=i(o,n[t]);return e=new ol({props:o}),e.$on("mapMove",t[4]),{c(){ht(e.$$.fragment)},m(t,i){dt(e,t,i),r=!0},p(t,[i]){const r=7&i?ct(n,[1&i&&{mapStyle:t[0]},2&i&&{overrideLayer:t[1]},4&i&&ut(t[2])]):{};e.$set(r)},i(t){r||(at(e.$$.fragment,t),r=!0)},o(t){lt(e.$$.fragment,t),r=!1},d(t){pt(e,t)}}}function ll(t,e,r){const n=["mapStyle"];let o,s,a=A(e,n),{mapStyle:l}=e;return t.$$set=t=>{e=i(i({},e),f(t)),r(2,a=A(e,n)),"mapStyle"in t&&r(0,l=t.mapStyle)},t.$$.update=()=>{1&t.$$.dirty&&r(3,({url:s}=l),s),8&t.$$.dirty&&r(1,o=(t=>null!=o&&o.options.scene===t?o:sl.exports.leafletLayer({scene:t,webGLContextOptions:{preserveDrawingBuffer:!0}}))(s))},[l,o,a,s,function(e){H.call(this,t,e)}]}sl.exports=function(){var t,e,i={};function r(r,n){if(t)if(e){var o="var shared_chunk = {}; ("+t+")(shared_chunk); ("+e+")(shared_chunk);",s={};t(s),(i=n(s)).workerURL=window.URL.createObjectURL(new Blob([o],{type:"text/javascript"}))}else e=n;else t=n}r(["exports"],(function(t){function e(t,e){return t(e={exports:{}},e.exports),e.exports}var i=e((function(t){var e=t.exports={version:"2.6.3"};"number"==typeof __e&&(__e=e)})),r=(i.version,e((function(t){var e=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=e)}))),n=e((function(t){var e=r["__core-js_shared__"]||(r["__core-js_shared__"]={});(t.exports=function(t,i){return e[t]||(e[t]=void 0!==i?i:{})})("versions",[]).push({version:i.version,mode:"global",copyright:" 2019 Denis Pushkarev (zloirock.ru)"})})),o=0,s=Math.random(),a=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++o+s).toString(36))},l=e((function(t){var e=n("wks"),i=r.Symbol,o="function"==typeof i;(t.exports=function(t){return e[t]||(e[t]=o&&i[t]||(o?i:a)("Symbol."+t))}).store=e})),c=function(t){return"object"==typeof t?null!==t:"function"==typeof t},u=function(t){if(!c(t))throw TypeError(t+" is not an object!");return t},h=function(t){try{return!!t()}catch(t){return!0}},d=!h((function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})),p=r.document,f=c(p)&&c(p.createElement),A=function(t){return f?p.createElement(t):{}},m=!d&&!h((function(){return 7!=Object.defineProperty(A("div"),"a",{get:function(){return 7}}).a})),g=function(t,e){if(!c(t))return t;var i,r;if(e&&"function"==typeof(i=t.toString)&&!c(r=i.call(t)))return r;if("function"==typeof(i=t.valueOf)&&!c(r=i.call(t)))return r;if(!e&&"function"==typeof(i=t.toString)&&!c(r=i.call(t)))return r;throw TypeError("Can't convert object to primitive value")},_=Object.defineProperty,y={f:d?Object.defineProperty:function(t,e,i){if(u(t),e=g(e,!0),u(i),m)try{return _(t,e,i)}catch(t){}if("get"in i||"set"in i)throw TypeError("Accessors not supported!");return"value"in i&&(t[e]=i.value),t}},v=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}},x=d?function(t,e,i){return y.f(t,e,v(1,i))}:function(t,e,i){return t[e]=i,t},b=l("unscopables"),w=Array.prototype;null==w[b]&&x(w,b,{});var T=function(t){w[b][t]=!0},B=function(t,e){return{value:e,done:!!t}},E={},C={}.toString,S=function(t){return C.call(t).slice(8,-1)},I=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==S(t)?t.split(""):Object(t)},M=function(t){if(null==t)throw TypeError("Can't call method on  "+t);return t},k=function(t){return I(M(t))},P={}.hasOwnProperty,L=function(t,e){return P.call(t,e)},z=e((function(t){var e=a("src"),n=Function.toString,o=(""+n).split("toString");i.inspectSource=function(t){return n.call(t)},(t.exports=function(t,i,n,s){var a="function"==typeof n;a&&(L(n,"name")||x(n,"name",i)),t[i]!==n&&(a&&(L(n,e)||x(n,e,t[i]?""+t[i]:o.join(String(i)))),t===r?t[i]=n:s?t[i]?t[i]=n:x(t,i,n):(delete t[i],x(t,i,n)))})(Function.prototype,"toString",(function(){return"function"==typeof this&&this[e]||n.call(this)}))})),F=function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!");return t},D=function(t,e,i){if(F(t),void 0===e)return t;switch(i){case 1:return function(i){return t.call(e,i)};case 2:return function(i,r){return t.call(e,i,r)};case 3:return function(i,r,n){return t.call(e,i,r,n)}}return function(){return t.apply(e,arguments)}},R=function(t,e,n){var o,s,a,l,c=t&R.F,u=t&R.G,h=t&R.S,d=t&R.P,p=t&R.B,f=u?r:h?r[e]||(r[e]={}):(r[e]||{}).prototype,A=u?i:i[e]||(i[e]={}),m=A.prototype||(A.prototype={});for(o in u&&(n=e),n)a=((s=!c&&f&&void 0!==f[o])?f:n)[o],l=p&&s?D(a,r):d&&"function"==typeof a?D(Function.call,a):a,f&&z(f,o,a,t&R.U),A[o]!=a&&x(A,o,l),d&&m[o]!=a&&(m[o]=a)};r.core=i,R.F=1,R.G=2,R.S=4,R.P=8,R.B=16,R.W=32,R.U=64,R.R=128;var U=R,O=Math.ceil,N=Math.floor,Q=function(t){return isNaN(t=+t)?0:(t>0?N:O)(t)},V=Math.min,j=function(t){return t>0?V(Q(t),9007199254740991):0},H=Math.max,G=Math.min,$=function(t,e){return(t=Q(t))<0?H(t+e,0):G(t,e)},Z=function(t){return function(e,i,r){var n,o=k(e),s=j(o.length),a=$(r,s);if(t&&i!=i){for(;s>a;)if((n=o[a++])!=n)return!0}else for(;s>a;a++)if((t||a in o)&&o[a]===i)return t||a||0;return!t&&-1}},q=n("keys"),K=function(t){return q[t]||(q[t]=a(t))},W=Z(!1),X=K("IE_PROTO"),J=function(t,e){var i,r=k(t),n=0,o=[];for(i in r)i!=X&&L(r,i)&&o.push(i);for(;e.length>n;)L(r,i=e[n++])&&(~W(o,i)||o.push(i));return o},Y="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(","),tt=Object.keys||function(t){return J(t,Y)},et=d?Object.defineProperties:function(t,e){u(t);for(var i,r=tt(e),n=r.length,o=0;n>o;)y.f(t,i=r[o++],e[i]);return t},it=r.document,rt=it&&it.documentElement,nt=K("IE_PROTO"),ot=function(){},st=function(){var t,e=A("iframe"),i=Y.length;for(e.style.display="none",rt.appendChild(e),e.src="javascript:",(t=e.contentWindow.document).open(),t.write("<script>document.F=Object<\/script>"),t.close(),st=t.F;i--;)delete st.prototype[Y[i]];return st()},at=Object.create||function(t,e){var i;return null!==t?(ot.prototype=u(t),i=new ot,ot.prototype=null,i[nt]=t):i=st(),void 0===e?i:et(i,e)},lt=y.f,ct=l("toStringTag"),ut=function(t,e,i){t&&!L(t=i?t:t.prototype,ct)&&lt(t,ct,{configurable:!0,value:e})},ht={};x(ht,l("iterator"),(function(){return this}));var dt=function(t,e,i){t.prototype=at(ht,{next:v(1,i)}),ut(t,e+" Iterator")},pt=function(t){return Object(M(t))},ft=K("IE_PROTO"),At=Object.prototype,mt=Object.getPrototypeOf||function(t){return t=pt(t),L(t,ft)?t[ft]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?At:null},gt=l("iterator"),_t=!([].keys&&"next"in[].keys()),yt=function(){return this},vt=function(t,e,i,r,n,o,s){dt(i,e,r);var a,l,c,u=function(t){if(!_t&&t in f)return f[t];switch(t){case"keys":case"values":return function(){return new i(this,t)}}return function(){return new i(this,t)}},h=e+" Iterator",d="values"==n,p=!1,f=t.prototype,A=f[gt]||f["@@iterator"]||n&&f[n],m=A||u(n),g=n?d?u("entries"):m:void 0,_="Array"==e&&f.entries||A;if(_&&(c=mt(_.call(new t)))!==Object.prototype&&c.next&&(ut(c,h,!0),"function"!=typeof c[gt]&&x(c,gt,yt)),d&&A&&"values"!==A.name&&(p=!0,m=function(){return A.call(this)}),(_t||p||!f[gt])&&x(f,gt,m),E[e]=m,E[h]=yt,n)if(a={values:d?m:u("values"),keys:o?m:u("keys"),entries:g},s)for(l in a)l in f||z(f,l,a[l]);else U(U.P+U.F*(_t||p),e,a);return a},xt=vt(Array,"Array",(function(t,e){this._t=k(t),this._i=0,this._k=e}),(function(){var t=this._t,e=this._k,i=this._i++;return!t||i>=t.length?(this._t=void 0,B(1)):B(0,"keys"==e?i:"values"==e?t[i]:[i,t[i]])}),"values");E.Arguments=E.Array,T("keys"),T("values"),T("entries");for(var bt=l("iterator"),wt=l("toStringTag"),Tt=E.Array,Bt={CSSRuleList:!0,CSSStyleDeclaration:!1,CSSValueList:!1,ClientRectList:!1,DOMRectList:!1,DOMStringList:!1,DOMTokenList:!0,DataTransferItemList:!1,FileList:!1,HTMLAllCollection:!1,HTMLCollection:!1,HTMLFormElement:!1,HTMLSelectElement:!1,MediaList:!0,MimeTypeArray:!1,NamedNodeMap:!1,NodeList:!0,PaintRequestList:!1,Plugin:!1,PluginArray:!1,SVGLengthList:!1,SVGNumberList:!1,SVGPathSegList:!1,SVGPointList:!1,SVGStringList:!1,SVGTransformList:!1,SourceBufferList:!1,StyleSheetList:!0,TextTrackCueList:!1,TextTrackList:!1,TouchList:!1},Et=tt(Bt),Ct=0;Ct<Et.length;Ct++){var St,It=Et[Ct],Mt=Bt[It],kt=r[It],Pt=kt&&kt.prototype;if(Pt&&(Pt[bt]||x(Pt,bt,Tt),Pt[wt]||x(Pt,wt,It),E[It]=Tt,Mt))for(St in xt)Pt[St]||z(Pt,St,xt[St],!0)}var Lt=l("toStringTag"),zt="Arguments"==S(function(){return arguments}()),Ft=function(t){var e,i,r;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(i=function(t,e){try{return t[e]}catch(t){}}(e=Object(t),Lt))?i:zt?S(e):"Object"==(r=S(e))&&"function"==typeof e.callee?"Arguments":r},Dt={};Dt[l("toStringTag")]="z",Dt+""!="[object z]"&&z(Object.prototype,"toString",(function(){return"[object "+Ft(this)+"]"}),!0);var Rt={f:{}.propertyIsEnumerable},Ut=Rt.f,Ot=function(t){return function(e){for(var i,r=k(e),n=tt(r),o=n.length,s=0,a=[];o>s;)Ut.call(r,i=n[s++])&&a.push(t?[i,r[i]]:r[i]);return a}},Nt=Ot(!0);U(U.S,"Object",{entries:function(t){return Nt(t)}});var Qt={f:Object.getOwnPropertySymbols},Vt=Object.assign,jt=!Vt||h((function(){var t={},e={},i=Symbol(),r="abcdefghijklmnopqrst";return t[i]=7,r.split("").forEach((function(t){e[t]=t})),7!=Vt({},t)[i]||Object.keys(Vt({},e)).join("")!=r}))?function(t,e){for(var i=pt(t),r=arguments.length,n=1,o=Qt.f,s=Rt.f;r>n;)for(var a,l=I(arguments[n++]),c=o?tt(l).concat(o(l)):tt(l),u=c.length,h=0;u>h;)s.call(l,a=c[h++])&&(i[a]=l[a]);return i}:Vt;U(U.S+U.F,"Object",{assign:jt});var Ht={};try{window instanceof Window&&window.document instanceof HTMLDocument&&(Ht.is_worker=!1,Ht.is_main=!0)}catch(t){Ht.is_worker=!0,Ht.is_main=!1,self.window={document:{}},self.document=self.window.document}var Gt=function(t){return function(e,i){var r,n,o=String(M(e)),s=Q(i),a=o.length;return s<0||s>=a?t?"":void 0:(r=o.charCodeAt(s))<55296||r>56319||s+1===a||(n=o.charCodeAt(s+1))<56320||n>57343?t?o.charAt(s):r:t?o.slice(s,s+2):n-56320+(r-55296<<10)+65536}},$t=Gt(!0),Zt=function(t,e,i){return e+(i?$t(t,e).length:1)},qt=RegExp.prototype.exec,Kt=function(t,e){var i=t.exec;if("function"==typeof i){var r=i.call(t,e);if("object"!=typeof r)throw new TypeError("RegExp exec method returned something other than an Object or null");return r}if("RegExp"!==Ft(t))throw new TypeError("RegExp#exec called on incompatible receiver");return qt.call(t,e)},Wt=function(){var t=u(this),e="";return t.global&&(e+="g"),t.ignoreCase&&(e+="i"),t.multiline&&(e+="m"),t.unicode&&(e+="u"),t.sticky&&(e+="y"),e},Xt=RegExp.prototype.exec,Jt=String.prototype.replace,Yt=Xt,te=function(){var t=/a/,e=/b*/g;return Xt.call(t,"a"),Xt.call(e,"a"),0!==t.lastIndex||0!==e.lastIndex}(),ee=void 0!==/()??/.exec("")[1];(te||ee)&&(Yt=function(t){var e,i,r,n,o=this;return ee&&(i=new RegExp("^"+o.source+"$(?!\\s)",Wt.call(o))),te&&(e=o.lastIndex),r=Xt.call(o,t),te&&r&&(o.lastIndex=o.global?r.index+r[0].length:e),ee&&r&&r.length>1&&Jt.call(r[0],i,(function(){for(n=1;n<arguments.length-2;n++)void 0===arguments[n]&&(r[n]=void 0)})),r});var ie=Yt;U({target:"RegExp",proto:!0,forced:ie!==/./.exec},{exec:ie});var re=l("species"),ne=!h((function(){var t=/./;return t.exec=function(){var t=[];return t.groups={a:"7"},t},"7"!=="".replace(t,"$<a>")})),oe=function(){var t=/(?:)/,e=t.exec;t.exec=function(){return e.apply(this,arguments)};var i="ab".split(t);return 2===i.length&&"a"===i[0]&&"b"===i[1]}(),se=function(t,e,i){var r=l(t),n=!h((function(){var e={};return e[r]=function(){return 7},7!=""[t](e)})),o=n?!h((function(){var e=!1,i=/a/;return i.exec=function(){return e=!0,null},"split"===t&&(i.constructor={},i.constructor[re]=function(){return i}),i[r](""),!e})):void 0;if(!n||!o||"replace"===t&&!ne||"split"===t&&!oe){var s=/./[r],a=i(M,r,""[t],(function(t,e,i,r,o){return e.exec===ie?n&&!o?{done:!0,value:s.call(e,i,r)}:{done:!0,value:t.call(i,e,r)}:{done:!1}})),c=a[0],u=a[1];z(String.prototype,t,c),x(RegExp.prototype,r,2==e?function(t,e){return u.call(t,this,e)}:function(t){return u.call(t,this)})}},ae=Math.max,le=Math.min,ce=Math.floor,ue=/\$([$&`']|\d\d?|<[^>]*>)/g,he=/\$([$&`']|\d\d?)/g;function de(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function pe(t,e,i){return e&&de(t.prototype,e),i&&de(t,i),t}function fe(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.__proto__=e}function Ae(t){return(Ae=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function me(t,e){return(me=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function ge(t,e,i){return(ge=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}()?Reflect.construct:function(t,e,i){var r=[null];r.push.apply(r,e);var n=new(Function.bind.apply(t,r));return i&&me(n,i.prototype),n}).apply(null,arguments)}function _e(t){var e="function"==typeof Map?new Map:void 0;return(_e=function(t){if(null===t||(i=t,-1===Function.toString.call(i).indexOf("[native code]")))return t;var i;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,r)}function r(){return ge(t,arguments,Ae(this).constructor)}return r.prototype=Object.create(t.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),me(r,t)})(t)}function ye(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,r=new Array(e);i<e;i++)r[i]=t[i];return r}function ve(t,e){var i;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(i=function(t,e){if(t){if("string"==typeof t)return ye(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?ye(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var r=0;return function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(i=t[Symbol.iterator]()).next.bind(i)}se("replace",2,(function(t,e,i,r){return[function(r,n){var o=t(this),s=null==r?void 0:r[e];return void 0!==s?s.call(r,o,n):i.call(String(o),r,n)},function(t,e){var o=r(i,t,this,e);if(o.done)return o.value;var s=u(t),a=String(this),l="function"==typeof e;l||(e=String(e));var c=s.global;if(c){var h=s.unicode;s.lastIndex=0}for(var d=[];;){var p=Kt(s,a);if(null===p)break;if(d.push(p),!c)break;""===String(p[0])&&(s.lastIndex=Zt(a,j(s.lastIndex),h))}for(var f,A="",m=0,g=0;g<d.length;g++){p=d[g];for(var _=String(p[0]),y=ae(le(Q(p.index),a.length),0),v=[],x=1;x<p.length;x++)v.push(void 0===(f=p[x])?f:String(f));var b=p.groups;if(l){var w=[_].concat(v,y,a);void 0!==b&&w.push(b);var T=String(e.apply(void 0,w))}else T=n(_,a,y,v,b,e);y>=m&&(A+=a.slice(m,y)+T,m=y+_.length)}return A+a.slice(m)}];function n(t,e,r,n,o,s){var a=r+t.length,l=n.length,c=he;return void 0!==o&&(o=pt(o),c=ue),i.call(s,c,(function(i,s){var c;switch(s.charAt(0)){case"$":return"$";case"&":return t;case"`":return e.slice(0,r);case"'":return e.slice(a);case"<":c=o[s.slice(1,-1)];break;default:var u=+s;if(0===u)return i;if(u>l){var h=ce(u/10);return 0===h?i:h<=l?void 0===n[h-1]?s.charAt(1):n[h-1]+s.charAt(1):i}c=n[u-1]}return void 0===c?"":c}))}}));var xe=Gt(!0);vt(String,"String",(function(t){this._t=String(t),this._i=0}),(function(){var t,e=this._t,i=this._i;return i>=e.length?{value:void 0,done:!0}:(t=xe(e,i),this._i+=t.length,{value:t,done:!1})}));var be,we,Te,Be=function(t,e,i,r){if(!(t instanceof e)||void 0!==r&&r in t)throw TypeError(i+": incorrect invocation!");return t},Ee=function(t,e,i,r){try{return r?e(u(i)[0],i[1]):e(i)}catch(e){var n=t.return;throw void 0!==n&&u(n.call(t)),e}},Ce=l("iterator"),Se=Array.prototype,Ie=function(t){return void 0!==t&&(E.Array===t||Se[Ce]===t)},Me=l("iterator"),ke=i.getIteratorMethod=function(t){if(null!=t)return t[Me]||t["@@iterator"]||E[Ft(t)]},Pe=e((function(t){var e={},i={},r=t.exports=function(t,r,n,o,s){var a,l,c,h,d=s?function(){return t}:ke(t),p=D(n,o,r?2:1),f=0;if("function"!=typeof d)throw TypeError(t+" is not iterable!");if(Ie(d)){for(a=j(t.length);a>f;f++)if((h=r?p(u(l=t[f])[0],l[1]):p(t[f]))===e||h===i)return h}else for(c=d.call(t);!(l=c.next()).done;)if((h=Ee(c,p,l.value,r))===e||h===i)return h};r.BREAK=e,r.RETURN=i})),Le=l("species"),ze=function(t,e){var i,r=u(t).constructor;return void 0===r||null==(i=u(r)[Le])?e:F(i)},Fe=r.process,De=r.setImmediate,Re=r.clearImmediate,Ue=r.MessageChannel,Oe=r.Dispatch,Ne=0,Qe={},Ve=function(){var t=+this;if(Qe.hasOwnProperty(t)){var e=Qe[t];delete Qe[t],e()}},je=function(t){Ve.call(t.data)};De&&Re||(De=function(t){for(var e=[],i=1;arguments.length>i;)e.push(arguments[i++]);return Qe[++Ne]=function(){!function(t,e,i){var r=void 0===i;switch(e.length){case 0:return r?t():t.call(i);case 1:return r?t(e[0]):t.call(i,e[0]);case 2:return r?t(e[0],e[1]):t.call(i,e[0],e[1]);case 3:return r?t(e[0],e[1],e[2]):t.call(i,e[0],e[1],e[2]);case 4:return r?t(e[0],e[1],e[2],e[3]):t.call(i,e[0],e[1],e[2],e[3])}t.apply(i,e)}("function"==typeof t?t:Function(t),e)},be(Ne),Ne},Re=function(t){delete Qe[t]},"process"==S(Fe)?be=function(t){Fe.nextTick(D(Ve,t,1))}:Oe&&Oe.now?be=function(t){Oe.now(D(Ve,t,1))}:Ue?(Te=(we=new Ue).port2,we.port1.onmessage=je,be=D(Te.postMessage,Te,1)):r.addEventListener&&"function"==typeof postMessage&&!r.importScripts?(be=function(t){r.postMessage(t+"","*")},r.addEventListener("message",je,!1)):be="onreadystatechange"in A("script")?function(t){rt.appendChild(A("script")).onreadystatechange=function(){rt.removeChild(this),Ve.call(t)}}:function(t){setTimeout(D(Ve,t,1),0)});var He={set:De,clear:Re},Ge=He.set,$e=r.MutationObserver||r.WebKitMutationObserver,Ze=r.process,qe=r.Promise,Ke="process"==S(Ze);function We(t){var e,i;this.promise=new t((function(t,r){if(void 0!==e||void 0!==i)throw TypeError("Bad Promise constructor");e=t,i=r})),this.resolve=F(e),this.reject=F(i)}var Xe={f:function(t){return new We(t)}},Je=function(t){try{return{e:!1,v:t()}}catch(t){return{e:!0,v:t}}},Ye=r.navigator,ti=Ye&&Ye.userAgent||"",ei=function(t,e,i){for(var r in e)z(t,r,e[r],i);return t},ii=l("species"),ri=function(t){var e=r[t];d&&e&&!e[ii]&&y.f(e,ii,{configurable:!0,get:function(){return this}})},ni=l("iterator"),oi=!1;try{var si=[7][ni]();si.return=function(){oi=!0},Array.from(si,(function(){throw 2}))}catch(t){}var ai,li,ci,ui,hi=function(t,e){if(!e&&!oi)return!1;var i=!1;try{var r=[7],n=r[ni]();n.next=function(){return{done:i=!0}},r[ni]=function(){return n},t(r)}catch(t){}return i},di=He.set,pi=function(){var t,e,i,n=function(){var r,n;for(Ke&&(r=Ze.domain)&&r.exit();t;){n=t.fn,t=t.next;try{n()}catch(r){throw t?i():e=void 0,r}}e=void 0,r&&r.enter()};if(Ke)i=function(){Ze.nextTick(n)};else if(!$e||r.navigator&&r.navigator.standalone)if(qe&&qe.resolve){var o=qe.resolve(void 0);i=function(){o.then(n)}}else i=function(){Ge.call(r,n)};else{var s=!0,a=document.createTextNode("");new $e(n).observe(a,{characterData:!0}),i=function(){a.data=s=!s}}return function(r){var n={fn:r,next:void 0};e&&(e.next=n),t||(t=n,i()),e=n}}(),fi=r.TypeError,Ai=r.process,mi=Ai&&Ai.versions,gi=mi&&mi.v8||"",_i=r.Promise,yi="process"==Ft(Ai),vi=function(){},xi=li=Xe.f,bi=!!function(){try{var t=_i.resolve(1),e=(t.constructor={})[l("species")]=function(t){t(vi,vi)};return(yi||"function"==typeof PromiseRejectionEvent)&&t.then(vi)instanceof e&&0!==gi.indexOf("6.6")&&-1===ti.indexOf("Chrome/66")}catch(t){}}(),wi=function(t){var e;return!(!c(t)||"function"!=typeof(e=t.then))&&e},Ti=function(t,e){if(!t._n){t._n=!0;var i=t._c;pi((function(){for(var r=t._v,n=1==t._s,o=0,s=function(e){var i,o,s,a=n?e.ok:e.fail,l=e.resolve,c=e.reject,u=e.domain;try{a?(n||(2==t._h&&Ci(t),t._h=1),!0===a?i=r:(u&&u.enter(),i=a(r),u&&(u.exit(),s=!0)),i===e.promise?c(fi("Promise-chain cycle")):(o=wi(i))?o.call(i,l,c):l(i)):c(r)}catch(t){u&&!s&&u.exit(),c(t)}};i.length>o;)s(i[o++]);t._c=[],t._n=!1,e&&!t._h&&Bi(t)}))}},Bi=function(t){di.call(r,(function(){var e,i,n,o=t._v,s=Ei(t);if(s&&(e=Je((function(){yi?Ai.emit("unhandledRejection",o,t):(i=r.onunhandledrejection)?i({promise:t,reason:o}):(n=r.console)&&n.error&&n.error("Unhandled promise rejection",o)})),t._h=yi||Ei(t)?2:1),t._a=void 0,s&&e.e)throw e.v}))},Ei=function(t){return 1!==t._h&&0===(t._a||t._c).length},Ci=function(t){di.call(r,(function(){var e;yi?Ai.emit("rejectionHandled",t):(e=r.onrejectionhandled)&&e({promise:t,reason:t._v})}))},Si=function(t){var e=this;e._d||(e._d=!0,(e=e._w||e)._v=t,e._s=2,e._a||(e._a=e._c.slice()),Ti(e,!0))},Ii=function(t){var e,i=this;if(!i._d){i._d=!0,i=i._w||i;try{if(i===t)throw fi("Promise can't be resolved itself");(e=wi(t))?pi((function(){var r={_w:i,_d:!1};try{e.call(t,D(Ii,r,1),D(Si,r,1))}catch(t){Si.call(r,t)}})):(i._v=t,i._s=1,Ti(i,!1))}catch(t){Si.call({_w:i,_d:!1},t)}}};bi||(_i=function(t){Be(this,_i,"Promise","_h"),F(t),ai.call(this);try{t(D(Ii,this,1),D(Si,this,1))}catch(t){Si.call(this,t)}},(ai=function(t){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1}).prototype=ei(_i.prototype,{then:function(t,e){var i=xi(ze(this,_i));return i.ok="function"!=typeof t||t,i.fail="function"==typeof e&&e,i.domain=yi?Ai.domain:void 0,this._c.push(i),this._a&&this._a.push(i),this._s&&Ti(this,!1),i.promise},catch:function(t){return this.then(void 0,t)}}),ci=function(){var t=new ai;this.promise=t,this.resolve=D(Ii,t,1),this.reject=D(Si,t,1)},Xe.f=xi=function(t){return t===_i||t===ui?new ci(t):li(t)}),U(U.G+U.W+U.F*!bi,{Promise:_i}),ut(_i,"Promise"),ri("Promise"),ui=i.Promise,U(U.S+U.F*!bi,"Promise",{reject:function(t){var e=xi(this);return(0,e.reject)(t),e.promise}}),U(U.S+U.F*!bi,"Promise",{resolve:function(t){return function(t,e){if(u(t),c(e)&&e.constructor===t)return e;var i=Xe.f(t);return(0,i.resolve)(e),i.promise}(this,t)}}),U(U.S+U.F*!(bi&&hi((function(t){_i.all(t).catch(vi)}))),"Promise",{all:function(t){var e=this,i=xi(e),r=i.resolve,n=i.reject,o=Je((function(){var i=[],o=0,s=1;Pe(t,!1,(function(t){var a=o++,l=!1;i.push(void 0),s++,e.resolve(t).then((function(t){l||(l=!0,i[a]=t,--s||r(i))}),n)})),--s||r(i)}));return o.e&&n(o.v),i.promise},race:function(t){var e=this,i=xi(e),r=i.reject,n=Je((function(){Pe(t,!1,(function(t){e.resolve(t).then(i.resolve,r)}))}));return n.e&&r(n.v),i.promise}});var Mi=y.f,ki=Function.prototype,Pi=/^\s*function ([^ (]*)/;"name"in ki||d&&Mi(ki,"name",{configurable:!0,get:function(){try{return(""+this).match(Pi)[1]}catch(t){return""}}});var Li=function(t,e){var r=(i.Object||{})[t]||Object[t],n={};n[t]=e(r),U(U.S+U.F*h((function(){r(1)})),"Object",n)};Li("keys",(function(){return function(t){return tt(pt(t))}}));var zi,Fi="v0.21.1",Di=l("match"),Ri=function(t){var e;return c(t)&&(void 0!==(e=t[Di])?!!e:"RegExp"==S(t))},Ui=Math.min,Oi=[].push,Ni=!h((function(){RegExp(4294967295,"y")}));se("split",2,(function(t,e,i,r){var n;return n="c"=="abbc".split(/(b)*/)[1]||4!="test".split(/(?:)/,-1).length||2!="ab".split(/(?:ab)*/).length||4!=".".split(/(.?)(.?)/).length||".".split(/()()/).length>1||"".split(/.?/).length?function(t,e){var r=String(this);if(void 0===t&&0===e)return[];if(!Ri(t))return i.call(r,t,e);for(var n,o,s,a=[],l=(t.ignoreCase?"i":"")+(t.multiline?"m":"")+(t.unicode?"u":"")+(t.sticky?"y":""),c=0,u=void 0===e?4294967295:e>>>0,h=new RegExp(t.source,l+"g");(n=ie.call(h,r))&&!((o=h.lastIndex)>c&&(a.push(r.slice(c,n.index)),n.length>1&&n.index<r.length&&Oi.apply(a,n.slice(1)),s=n[0].length,c=o,a.length>=u));)h.lastIndex===n.index&&h.lastIndex++;return c===r.length?!s&&h.test("")||a.push(""):a.push(r.slice(c)),a.length>u?a.slice(0,u):a}:"0".split(void 0,0).length?function(t,e){return void 0===t&&0===e?[]:i.call(this,t,e)}:i,[function(i,r){var o=t(this),s=null==i?void 0:i[e];return void 0!==s?s.call(i,o,r):n.call(String(o),i,r)},function(t,e){var o=r(n,t,this,e,n!==i);if(o.done)return o.value;var s=u(t),a=String(this),l=ze(s,RegExp),c=s.unicode,h=(s.ignoreCase?"i":"")+(s.multiline?"m":"")+(s.unicode?"u":"")+(Ni?"y":"g"),d=new l(Ni?s:"^(?:"+s.source+")",h),p=void 0===e?4294967295:e>>>0;if(0===p)return[];if(0===a.length)return null===Kt(d,a)?[a]:[];for(var f=0,A=0,m=[];A<a.length;){d.lastIndex=Ni?A:0;var g,_=Kt(d,Ni?a:a.slice(A));if(null===_||(g=Ui(j(d.lastIndex+(Ni?0:A)),a.length))===f)A=Zt(a,A,c);else{if(m.push(a.slice(f,A)),m.length===p)return m;for(var y=1;y<=_.length-1;y++)if(m.push(_[y]),m.length===p)return m;A=f=g}}return m.push(a.slice(f)),m}]}));var Qi=zi={},Vi=0,ji={};function Hi(t){var e=[];"string"==typeof t&&(e=t.split("."),t=e.pop());for(var i=zi.targets,r=0;r<e.length;r++){if(!i[e[r]])return[];i=i[e[r]]}return[t,i]}function Gi(t){Array.isArray(t)&&t.filter((function(t){return t.parent&&t.property})).forEach((function(t){return delete t.parent[t.property]}))}zi.targets={},zi.addTarget=function(t,e){zi.targets[t]=e},zi.removeTarget=function(t){t&&delete zi.targets[t]},zi.withTransferables=function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];if(!(this instanceof zi.withTransferables))return ge(zi.withTransferables,e);this.value=e,this.transferables=function t(e,i,r,n){if(void 0===i&&(i=null),void 0===r&&(r=null),void 0===n&&(n=[]),!e)return n;if(Array.isArray(e))e.forEach((function(i,r){return t(i,e,r,n)}));else if("object"==typeof e)if(e instanceof ArrayBuffer)n.push({object:e,parent:i,property:r});else if(e.buffer instanceof ArrayBuffer)n.push({object:e.buffer,parent:i,property:r});else for(var o in e)t(e[o],e,o,n);return n}(this.value)},Ht.is_main&&(zi.postMessage=function(t,e){for(var i=arguments.length,r=new Array(i>2?i-2:0),n=2;n<i;n++)r[n-2]=arguments[n];if(Array.isArray(t))return Promise.all(t.map((function(t){var i;return(i=zi).postMessage.apply(i,[t,e].concat(r))})));var o={};"object"==typeof e&&(o=e,e=e.method);var s,a=new Promise((function(t,i){ji[Vi]={method:e,message:r,resolve:t,reject:i}})),l=[];return r&&1===r.length&&r[0]instanceof zi.withTransferables&&(l=r[0].transferables,r=r[0].value),s={type:"main_send",message_id:Vi,method:e,message:r},o.stringify&&(s=JSON.stringify(s)),t.postMessage(s,l.map((function(t){return t.object}))),Gi(l),l.length>0&&Ki("trace","'"+e+"' transferred "+l.length+" objects to worker thread"),Vi++,a},zi.addWorker=function(t){if(!(t instanceof Worker))throw Error("Worker broker could not add non-Worker object",t);t.addEventListener("message",(function(e){var i="string"==typeof e.data?JSON.parse(e.data):e.data,r=i.message_id;if("worker_reply"===i.type)ji[r]&&(i.error?ji[r].reject(i.error):ji[r].resolve(i.message),delete ji[r]);else if("worker_send"===i.type&&null!=r){var n,o,s,a,l;try{var c=Hi(i.method);if(a=c[0],!(s=c[1]))throw Error("Worker broker could not dispatch message type "+i.method+" on target "+i.target+" because no object with that name is registered on main thread");if(!(l="function"==typeof s[a]&&s[a]))throw Error("Worker broker could not dispatch message type "+i.method+" on target "+i.target+" because object has no method with that name");n=l.apply(s,i.message)}catch(t){o=t}var u,h=[];n instanceof Promise?n.then((function(e){e instanceof zi.withTransferables&&(h=e.transferables,e=e.value[0]),u={type:"main_reply",message_id:r,message:e},t.postMessage(u,h.map((function(t){return t.object}))),Gi(h),h.length>0&&Ki("trace","'"+a+"' transferred "+h.length+" objects to worker thread")}),(function(e){t.postMessage({type:"main_reply",message_id:r,error:e instanceof Error?e.message+": "+e.stack:e})})):(n instanceof zi.withTransferables&&(h=n.transferables,n=n.value[0]),u={type:"main_reply",message_id:r,message:n,error:o instanceof Error?o.message+": "+o.stack:o},t.postMessage(u,h.map((function(t){return t.object}))),Gi(h),h.length>0&&Ki("trace","'"+a+"' transferred "+h.length+" objects to worker thread"))}}))},zi.getMessages=function(){return ji},zi.getMessageId=function(){return Vi}),Ht.is_worker&&(zi.postMessage=function(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),r=1;r<e;r++)i[r-1]=arguments[r];var n={};"object"==typeof t&&(n=t,t=t.method);var o,s=new Promise((function(e,r){ji[Vi]={method:t,message:i,resolve:e,reject:r}})),a=[];return i&&1===i.length&&i[0]instanceof zi.withTransferables&&(a=i[0].transferables,i=i[0].value),o={type:"worker_send",message_id:Vi,method:t,message:i},n.stringify&&(o=JSON.stringify(o)),self.postMessage(o,a.map((function(t){return t.object}))),Gi(a),a.length>0&&Ki("trace","'"+t+"' transferred "+a.length+" objects to main thread"),Vi++,s},self.addEventListener("message",(function(t){var e="string"==typeof t.data?JSON.parse(t.data):t.data,i=e.message_id;if("main_reply"===e.type)ji[i]&&(e.error?ji[i].reject(e.error):ji[i].resolve(e.message),delete ji[i]);else if("main_send"===e.type&&null!=i){var r,n,o,s,a;try{var l=Hi(e.method);if(s=l[0],!(o=l[1]))throw Error("Worker broker could not dispatch message type "+e.method+" on target "+e.target+" because no object with that name is registered on main thread");if(!(a="function"==typeof o[s]&&o[s]))throw Error("Worker broker could not dispatch message type "+e.method+" because worker has no method with that name");r=a.apply(o,e.message)}catch(t){n=t}var c,u=[];r instanceof Promise?r.then((function(t){t instanceof zi.withTransferables&&(u=t.transferables,t=t.value[0]),c={type:"worker_reply",message_id:i,message:t},self.postMessage(c,u.map((function(t){return t.object}))),Gi(u),u.length>0&&Ki("trace","'"+s+"' transferred "+u.length+" objects to main thread")}),(function(t){self.postMessage({type:"worker_reply",message_id:i,error:t instanceof Error?t.message+": "+t.stack:t})})):(r instanceof zi.withTransferables&&(u=r.transferables,r=r.value[0]),c={type:"worker_reply",message_id:i,message:r,error:n instanceof Error?n.message+": "+n.stack:n},self.postMessage(c,u.map((function(t){return t.object}))),Gi(u),u.length>0&&Ki("trace","'"+s+"' transferred "+u.length+" objects to main thread"))}})));var $i={silent:-1,error:0,warn:1,info:2,debug:3,trace:4},Zi={},qi={};function Ki(t){var e="object"==typeof t?t.level:t;if($i[e]<=$i[Ki.level]){for(var i=arguments.length,r=new Array(i>1?i-1:0),n=1;n<i;n++)r[n-1]=arguments[n];if(Ht.is_worker)return Qi.postMessage.apply(Qi,[{method:"_logProxy",stringify:!0},t].concat(r));if("object"==typeof t&&!0===t.once){if(qi[JSON.stringify(r)])return Promise.resolve(!1);qi[JSON.stringify(r)]=!0}var o=function(t){if(Ht.is_main)return Zi[t]=Zi[t]||(console[t]?console[t]:console.log).bind(console),Zi[t]}(e);return r.length>1?o.apply(void 0,["Tangram "+Fi+" ["+e+"]: "+r[0]].concat(r.slice(1))):o("Tangram "+Fi+" ["+e+"]: "+r[0]),Promise.resolve(!0)}return Promise.resolve(!1)}Ki.level="info",Ki.workers=null,Ki.setLevel=function(t){Ki.level=t,Ht.is_main&&Array.isArray(Ki.workers)&&Qi.postMessage(Ki.workers,"_logSetLevelProxy",t)},Ht.is_main&&(Ki.setWorkers=function(t){Ki.workers=t},Ki.reset=function(){qi={}}),Qi.addTarget("_logProxy",Ki),Qi.addTarget("_logSetLevelProxy",Ki.setLevel),d&&"g"!=/./g.flags&&y.f(RegExp.prototype,"flags",{configurable:!0,get:Wt});var Wi=/./.toString,Xi=function(t){z(RegExp.prototype,"toString",t,!0)};h((function(){return"/a/b"!=Wi.call({source:"a",flags:"b"})}))?Xi((function(){var t=u(this);return"/".concat(t.source,"/","flags"in t?t.flags:!d&&t instanceof RegExp?Wt.call(t):void 0)})):"toString"!=Wi.name&&Xi((function(){return Wi.call(this)}));var Ji,Yi={};Qi.addTarget("Utils",Yi),Yi.isSafari=function(){return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)},Yi.isMicrosoft=function(){return/(Trident\/7.0|Edge[ \/](\d+[.\d]+))/i.test(navigator.userAgent)},Yi._requests={},Yi._proxy_requests={},Yi.io=function(t,e,i,r,n,o,s){if(void 0===e&&(e=6e4),void 0===i&&(i="text"),void 0===r&&(r="GET"),void 0===n&&(n={}),void 0===o&&(o=null),void 0===s&&(s=!1),Ht.is_worker&&Yi.isMicrosoft())return Ki("debug","Proxying request for URL to worker",t),o&&(Yi._proxy_requests[o]=!0),Qi.postMessage("Utils.io",t,e,i,r,n,o,!0);var a=new XMLHttpRequest,l=new Promise((function(o,s){if(a.open(r,t,!0),a.timeout=e,a.responseType=i,n&&"object"==typeof n)for(var l in n)a.setRequestHeader(l,n[l]);a.onload=function(){200===a.status?["text","json"].indexOf(a.responseType)>-1?o({body:a.responseText,status:a.status}):o({body:a.response,status:a.status}):204===a.status?o({body:null,status:a.status}):s(Error("Request error with a status of "+a.statusText))},a.onerror=function(t){s(Error("There was a network error"+t.toString()))},a.ontimeout=function(t){s(Error("timeout "+t.toString()))},a.send()}));return l=l.then((function(t){return o&&delete Yi._requests[o],s?Qi.withTransferables(t):t})),o&&(Yi._requests[o]=a),l},Yi.cancelRequest=function(t){if(Ht.is_worker&&Yi._proxy_requests[t])return Qi.postMessage("Utils.cancelRequest",t);Yi._requests[t]?(Ki("trace","Cancelling network request key '"+t+"'"),Yi._requests[t].abort(),delete Yi._requests[t]):Ki("trace","Could not find network request key '"+t+"'")},Yi.serializeWithFunctions=function(t){return"function"==typeof t?t.toString():JSON.stringify(t,(function(t,e){return"function"==typeof e?e.toString():e}))},Yi.use_high_density_display=!0,Yi.updateDevicePixelRatio=function(){var t=Yi.device_pixel_ratio;return Yi.device_pixel_ratio=Yi.use_high_density_display&&window.devicePixelRatio||1,Yi.device_pixel_ratio!==t},Ht.is_main&&Yi.updateDevicePixelRatio(),Yi.isPowerOf2=function(t){return 0==(t&t-1)},Yi.interpolate=function(t,e,i){if(!Array.isArray(e)||!Array.isArray(e[0]))return e;if(e.length<1)return e;var r,n,o,s,a;if(t<=e[0][0])s=e[0][1],"function"==typeof i&&(s=i(s));else if(t>=e[e.length-1][0])s=e[e.length-1][1],"function"==typeof i&&(s=i(s));else for(var l=0;l<e.length-1;l++)if(t>=e[l][0]&&t<e[l+1][0]){if(r=e[l][0],n=e[l+1][0],Array.isArray(e[l][1])){s=[];for(var c=0;c<e[l][1].length;c++)"function"==typeof i?(a=i(e[l][1][c]),o=i(e[l+1][1][c])-a,s[c]=o*(t-r)/(n-r)+a):(o=e[l+1][1][c]-e[l][1][c],s[c]=o*(t-r)/(n-r)+e[l][1][c])}else"function"==typeof i?(a=i(e[l][1]),s=(o=i(e[l+1][1])-a)*(t-r)/(n-r)+a):s=(o=e[l+1][1]-e[l][1])*(t-r)/(n-r)+e[l][1];break}return s},Yi.toCSSColor=function(t){if(null!=t)return 1===t[3]?"rgb("+t.slice(0,3).map((function(t){return Math.round(255*t)})).join(", ")+")":"rgba("+t.map((function(t,e){return e<3&&Math.round(255*t)||t})).join(", ")+")"};var tr=Ji={draw_label_collision_boxes:!1,draw_label_texture_boxes:!1,suppress_label_fade_in:!1,suppress_label_snap_animation:!1,show_hidden_labels:!1,layer_stats:!1,wireframe:!1},er=Object.getOwnPropertyDescriptor,ir={f:d?er:function(t,e){if(t=k(t),e=g(e,!0),m)try{return er(t,e)}catch(t){}if(L(t,e))return v(!Rt.f.call(t,e),t[e])}},rr=function(t,e){if(u(t),!c(e)&&null!==e)throw TypeError(e+": can't set as prototype!")},nr=Object.setPrototypeOf||("__proto__"in{}?function(t,e,i){try{(i=D(Function.call,ir.f(Object.prototype,"__proto__").set,2))(t,[]),e=!(t instanceof Array)}catch(t){e=!0}return function(t,r){return rr(t,r),e?t.__proto__=r:i(t,r),t}}({},!1):void 0),or=function(t,e,i){var r,n=e.constructor;return n!==i&&"function"==typeof n&&(r=n.prototype)!==i.prototype&&c(r)&&nr&&nr(t,r),t},sr=Y.concat("length","prototype"),ar={f:Object.getOwnPropertyNames||function(t){return J(t,sr)}},lr=y.f,cr=ar.f,ur=r.RegExp,hr=ur,dr=ur.prototype,pr=/a/g,fr=/a/g,Ar=new ur(pr)!==pr;if(d&&(!Ar||h((function(){return fr[l("match")]=!1,ur(pr)!=pr||ur(fr)==fr||"/a/i"!=ur(pr,"i")})))){ur=function(t,e){var i=this instanceof ur,r=Ri(t),n=void 0===e;return!i&&r&&t.constructor===ur&&n?t:or(Ar?new hr(r&&!n?t.source:t,e):hr((r=t instanceof ur)?t.source:t,r&&n?Wt.call(t):e),i?this:dr,ur)};for(var mr=function(t){t in ur||lr(ur,t,{configurable:!0,get:function(){return hr[t]},set:function(e){hr[t]=e}})},gr=cr(hr),_r=0;gr.length>_r;)mr(gr[_r++]);dr.constructor=ur,ur.prototype=dr,z(r,"RegExp",ur)}ri("RegExp");var yr,vr=Object.is||function(t,e){return t===e?0!==t||1/t==1/e:t!=t&&e!=e};function xr(t){if("string"==typeof t&&-1===t.search(/^(data|blob):/)){var e=t.indexOf("?");e>-1&&(t=t.substr(0,e));var i=t.indexOf("#");return i>-1&&(t=t.substr(0,i)),t.substr(0,t.lastIndexOf("/")+1)||""}return""}function br(t){if("string"==typeof t)return!(t.search(/^(http|https|data|blob):/)>-1||"//"===t.substr(0,2))}function wr(t,e){t=t.replace(/[[]/,"\\[").replace(/[\]]/,"\\]");var i=new RegExp("[\\?&]"+t+"=([^&#]*)").exec(e);return null===i?"":decodeURIComponent(i[1].replace(/\+/g," "))}se("search",1,(function(t,e,i,r){return[function(i){var r=t(this),n=null==i?void 0:i[e];return void 0!==n?n.call(i,r):new RegExp(i)[e](String(r))},function(t){var e=r(i,t,this);if(e.done)return e.value;var n=u(t),o=String(this),s=n.lastIndex;vr(s,0)||(n.lastIndex=0);var a=Kt(n,o);return vr(n.lastIndex,s)||(n.lastIndex=s),null===a?-1:a.index}]}));var Tr={id:0,queue:[],max_time:20,start_time:null,state:{},add:function(t){t.id=Tr.id++,t.max_time=t.max_time||Tr.max_time,t.pause_factor=t.pause_factor||1;var e=new Promise((function(e,i){t.resolve=e,t.reject=i}));return t.promise=e,t.elapsed=0,t.total_elapsed=0,t.stats={calls:0},this.queue.push(t),this.start_time=this.start_time||performance.now(),this.elapsed=performance.now()-this.start_time,(this.elapsed<Tr.max_time||t.immediate)&&this.process(t),t.promise},remove:function(t){var e=this.queue.indexOf(t);e>-1&&this.queue.splice(e,1)},process:function(t){if(!this.state.user_moving_view||!1!==t.user_moving_view)return t.pause?(t.pause--,!0):(t.stats.calls++,t.start_time=performance.now(),t.run(t))},processAll:function(){this.start_time=this.start_time||performance.now();for(var t=0;t<this.queue.length;t++){var e=this.queue[t];if(!0!==this.process(e)&&(e.pause||(e.pause=e.elapsed>e.max_time?e.pause_factor:0),e.total_elapsed+=e.elapsed),this.elapsed=performance.now()-this.start_time,this.elapsed>=Tr.max_time){this.start_time=null;break}}},finish:function(t,e){return t.elapsed=performance.now()-t.start_time,t.total_elapsed+=t.elapsed,this.remove(t),t.resolve(e),t.promise},cancel:function(t){var e;t.cancel instanceof Function&&(e=t.cancel(t)),t.resolve(e)},shouldContinue:function(t){return t.elapsed=performance.now()-t.start_time,this.elapsed=performance.now()-this.start_time,t.elapsed<t.max_time&&this.elapsed<Tr.max_time},removeForTile:function(t){for(var e=this.queue.length-1;e>=0;e--)this.queue[e].tile_id===t&&(this.cancel(this.queue[e]),this.queue.splice(e,1))},setState:function(t){this.state=t}};function Br(t){var e=[];return Object.assign(t,{subscribe:function(t){-1===e.indexOf(t)&&e.push(t)},unsubscribe:function(t){var i=e.indexOf(t);i>-1&&e.splice(i,1)},unsubscribeAll:function(){e=[]},trigger:function(t){for(var i=arguments.length,r=new Array(i>1?i-1:0),n=1;n<i;n++)r[n-1]=arguments[n];e.forEach((function(e){if("function"==typeof e[t])try{e[t].apply(e,r)}catch(e){Ki("warn","Caught exception in listener for event '"+t+"':",e)}}))},hasSubscribersFor:function(t){var i=!1;return e.forEach((function(e){"function"==typeof e[t]&&(i=!0)})),i}})}function Er(t,e){var i={};return e.forEach((function(e){return i[e]=t[e]})),i}U(U.P,"String",{repeat:function(t){var e=String(M(this)),i="",r=Q(t);if(r<0||r==1/0)throw RangeError("Count can't be negative");for(;r>0;(r>>>=1)&&(e+=e))1&r&&(i+=e);return i}});for(var Cr,Sr=a("typed_array"),Ir=a("view"),Mr=!(!r.ArrayBuffer||!r.DataView),kr=Mr,Pr=0,Lr="Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array".split(",");Pr<9;)(Cr=r[Lr[Pr++]])?(x(Cr.prototype,Sr,!0),x(Cr.prototype,Ir,!0)):kr=!1;var zr={ABV:Mr,CONSTR:kr,TYPED:Sr,VIEW:Ir},Fr=function(t){if(void 0===t)return 0;var e=Q(t),i=j(e);if(e!==i)throw RangeError("Wrong length!");return i},Dr=function(t){for(var e=pt(this),i=j(e.length),r=arguments.length,n=$(r>1?arguments[1]:void 0,i),o=r>2?arguments[2]:void 0,s=void 0===o?i:$(o,i);s>n;)e[n++]=t;return e},Rr=e((function(t,e){var i=ar.f,n=y.f,o="prototype",s="Wrong index!",a=r.ArrayBuffer,l=r.DataView,c=r.Math,u=r.RangeError,p=r.Infinity,f=a,A=c.abs,m=c.pow,g=c.floor,_=c.log,v=c.LN2,b=d?"_b":"buffer",w=d?"_l":"byteLength",T=d?"_o":"byteOffset";function B(t,e,i){var r,n,o,s=new Array(i),a=8*i-e-1,l=(1<<a)-1,c=l>>1,u=23===e?m(2,-24)-m(2,-77):0,h=0,d=t<0||0===t&&1/t<0?1:0;for((t=A(t))!=t||t===p?(n=t!=t?1:0,r=l):(r=g(_(t)/v),t*(o=m(2,-r))<1&&(r--,o*=2),(t+=r+c>=1?u/o:u*m(2,1-c))*o>=2&&(r++,o/=2),r+c>=l?(n=0,r=l):r+c>=1?(n=(t*o-1)*m(2,e),r+=c):(n=t*m(2,c-1)*m(2,e),r=0));e>=8;s[h++]=255&n,n/=256,e-=8);for(r=r<<e|n,a+=e;a>0;s[h++]=255&r,r/=256,a-=8);return s[--h]|=128*d,s}function E(t,e,i){var r,n=8*i-e-1,o=(1<<n)-1,s=o>>1,a=n-7,l=i-1,c=t[l--],u=127&c;for(c>>=7;a>0;u=256*u+t[l],l--,a-=8);for(r=u&(1<<-a)-1,u>>=-a,a+=e;a>0;r=256*r+t[l],l--,a-=8);if(0===u)u=1-s;else{if(u===o)return r?NaN:c?-p:p;r+=m(2,e),u-=s}return(c?-1:1)*r*m(2,u-e)}function C(t){return t[3]<<24|t[2]<<16|t[1]<<8|t[0]}function S(t){return[255&t]}function I(t){return[255&t,t>>8&255]}function M(t){return[255&t,t>>8&255,t>>16&255,t>>24&255]}function k(t){return B(t,52,8)}function P(t){return B(t,23,4)}function L(t,e,i){n(t[o],e,{get:function(){return this[i]}})}function z(t,e,i,r){var n=Fr(+i);if(n+e>t[w])throw u(s);var o=t[b]._b,a=n+t[T],l=o.slice(a,a+e);return r?l:l.reverse()}function F(t,e,i,r,n,o){var a=Fr(+i);if(a+e>t[w])throw u(s);for(var l=t[b]._b,c=a+t[T],h=r(+n),d=0;d<e;d++)l[c+d]=h[o?d:e-d-1]}if(zr.ABV){if(!h((function(){a(1)}))||!h((function(){new a(-1)}))||h((function(){return new a,new a(1.5),new a(NaN),"ArrayBuffer"!=a.name}))){for(var D,R=(a=function(t){return Be(this,a),new f(Fr(t))})[o]=f[o],U=i(f),O=0;U.length>O;)(D=U[O++])in a||x(a,D,f[D]);R.constructor=a}var N=new l(new a(2)),V=l[o].setInt8;N.setInt8(0,2147483648),N.setInt8(1,2147483649),!N.getInt8(0)&&N.getInt8(1)||ei(l[o],{setInt8:function(t,e){V.call(this,t,e<<24>>24)},setUint8:function(t,e){V.call(this,t,e<<24>>24)}},!0)}else a=function(t){Be(this,a,"ArrayBuffer");var e=Fr(t);this._b=Dr.call(new Array(e),0),this[w]=e},l=function(t,e,i){Be(this,l,"DataView"),Be(t,a,"DataView");var r=t[w],n=Q(e);if(n<0||n>r)throw u("Wrong offset!");if(n+(i=void 0===i?r-n:j(i))>r)throw u("Wrong length!");this[b]=t,this[T]=n,this[w]=i},d&&(L(a,"byteLength","_l"),L(l,"buffer","_b"),L(l,"byteLength","_l"),L(l,"byteOffset","_o")),ei(l[o],{getInt8:function(t){return z(this,1,t)[0]<<24>>24},getUint8:function(t){return z(this,1,t)[0]},getInt16:function(t){var e=z(this,2,t,arguments[1]);return(e[1]<<8|e[0])<<16>>16},getUint16:function(t){var e=z(this,2,t,arguments[1]);return e[1]<<8|e[0]},getInt32:function(t){return C(z(this,4,t,arguments[1]))},getUint32:function(t){return C(z(this,4,t,arguments[1]))>>>0},getFloat32:function(t){return E(z(this,4,t,arguments[1]),23,4)},getFloat64:function(t){return E(z(this,8,t,arguments[1]),52,8)},setInt8:function(t,e){F(this,1,t,S,e)},setUint8:function(t,e){F(this,1,t,S,e)},setInt16:function(t,e){F(this,2,t,I,e,arguments[2])},setUint16:function(t,e){F(this,2,t,I,e,arguments[2])},setInt32:function(t,e){F(this,4,t,M,e,arguments[2])},setUint32:function(t,e){F(this,4,t,M,e,arguments[2])},setFloat32:function(t,e){F(this,4,t,P,e,arguments[2])},setFloat64:function(t,e){F(this,8,t,k,e,arguments[2])}});ut(a,"ArrayBuffer"),ut(l,"DataView"),x(l[o],zr.VIEW,!0),e.ArrayBuffer=a,e.DataView=l})),Ur=Array.isArray||function(t){return"Array"==S(t)},Or=l("species"),Nr=function(t,e){return new(function(t){var e;return Ur(t)&&("function"!=typeof(e=t.constructor)||e!==Array&&!Ur(e.prototype)||(e=void 0),c(e)&&null===(e=e[Or])&&(e=void 0)),void 0===e?Array:e}(t))(e)},Qr=function(t,e){var i=1==t,r=2==t,n=3==t,o=4==t,s=6==t,a=5==t||s,l=e||Nr;return function(e,c,u){for(var h,d,p=pt(e),f=I(p),A=D(c,u,3),m=j(f.length),g=0,_=i?l(e,m):r?l(e,0):void 0;m>g;g++)if((a||g in f)&&(d=A(h=f[g],g,p),t))if(i)_[g]=d;else if(d)switch(t){case 3:return!0;case 5:return h;case 6:return g;case 2:_.push(h)}else if(o)return!1;return s?-1:n||o?o:_}},Vr=[].copyWithin||function(t,e){var i=pt(this),r=j(i.length),n=$(t,r),o=$(e,r),s=arguments.length>2?arguments[2]:void 0,a=Math.min((void 0===s?r:$(s,r))-o,r-n),l=1;for(o<n&&n<o+a&&(l=-1,o+=a-1,n+=a-1);a-- >0;)o in i?i[n]=i[o]:delete i[n],n+=l,o+=l;return i},jr=e((function(t){if(d){var e=r,i=h,n=U,o=zr,s=Rr,u=D,p=Be,f=v,A=x,m=ei,_=Q,b=j,w=Fr,T=$,B=g,C=L,S=Ft,I=c,M=pt,k=Ie,P=at,z=mt,F=ar.f,R=ke,O=a,N=l,V=Qr,H=Z,G=ze,q=xt,K=E,W=hi,X=ri,J=Dr,Y=Vr,tt=y,et=ir,it=tt.f,rt=et.f,nt=e.RangeError,ot=e.TypeError,st=e.Uint8Array,lt=Array.prototype,ct=s.ArrayBuffer,ut=s.DataView,ht=V(0),dt=V(2),ft=V(3),At=V(4),gt=V(5),_t=V(6),yt=H(!0),vt=H(!1),bt=q.values,wt=q.keys,Tt=q.entries,Bt=lt.lastIndexOf,Et=lt.reduce,Ct=lt.reduceRight,St=lt.join,It=lt.sort,Mt=lt.slice,kt=lt.toString,Pt=lt.toLocaleString,Lt=N("iterator"),zt=N("toStringTag"),Dt=O("typed_constructor"),Rt=O("def_constructor"),Ut=o.CONSTR,Ot=o.TYPED,Nt=o.VIEW,Qt=V(1,(function(t,e){return $t(G(t,t[Rt]),e)})),Vt=i((function(){return 1===new st(new Uint16Array([1]).buffer)[0]})),jt=!!st&&!!st.prototype.set&&i((function(){new st(1).set({})})),Ht=function(t,e){var i=_(t);if(i<0||i%e)throw nt("Wrong offset!");return i},Gt=function(t){if(I(t)&&Ot in t)return t;throw ot(t+" is not a typed array!")},$t=function(t,e){if(!I(t)||!(Dt in t))throw ot("It is not a typed array constructor!");return new t(e)},Zt=function(t,e){return qt(G(t,t[Rt]),e)},qt=function(t,e){for(var i=0,r=e.length,n=$t(t,r);r>i;)n[i]=e[i++];return n},Kt=function(t,e,i){it(t,e,{get:function(){return this._d[i]}})},Wt=function(t){var e,i,r,n,o,s,a=M(t),l=arguments.length,c=l>1?arguments[1]:void 0,h=void 0!==c,d=R(a);if(null!=d&&!k(d)){for(s=d.call(a),r=[],e=0;!(o=s.next()).done;e++)r.push(o.value);a=r}for(h&&l>2&&(c=u(c,arguments[2],2)),e=0,i=b(a.length),n=$t(this,i);i>e;e++)n[e]=h?c(a[e],e):a[e];return n},Xt=function(){for(var t=0,e=arguments.length,i=$t(this,e);e>t;)i[t]=arguments[t++];return i},Jt=!!st&&i((function(){Pt.call(new st(1))})),Yt=function(){return Pt.apply(Jt?Mt.call(Gt(this)):Gt(this),arguments)},te={copyWithin:function(t,e){return Y.call(Gt(this),t,e,arguments.length>2?arguments[2]:void 0)},every:function(t){return At(Gt(this),t,arguments.length>1?arguments[1]:void 0)},fill:function(t){return J.apply(Gt(this),arguments)},filter:function(t){return Zt(this,dt(Gt(this),t,arguments.length>1?arguments[1]:void 0))},find:function(t){return gt(Gt(this),t,arguments.length>1?arguments[1]:void 0)},findIndex:function(t){return _t(Gt(this),t,arguments.length>1?arguments[1]:void 0)},forEach:function(t){ht(Gt(this),t,arguments.length>1?arguments[1]:void 0)},indexOf:function(t){return vt(Gt(this),t,arguments.length>1?arguments[1]:void 0)},includes:function(t){return yt(Gt(this),t,arguments.length>1?arguments[1]:void 0)},join:function(t){return St.apply(Gt(this),arguments)},lastIndexOf:function(t){return Bt.apply(Gt(this),arguments)},map:function(t){return Qt(Gt(this),t,arguments.length>1?arguments[1]:void 0)},reduce:function(t){return Et.apply(Gt(this),arguments)},reduceRight:function(t){return Ct.apply(Gt(this),arguments)},reverse:function(){for(var t,e=Gt(this).length,i=Math.floor(e/2),r=0;r<i;)t=this[r],this[r++]=this[--e],this[e]=t;return this},some:function(t){return ft(Gt(this),t,arguments.length>1?arguments[1]:void 0)},sort:function(t){return It.call(Gt(this),t)},subarray:function(t,e){var i=Gt(this),r=i.length,n=T(t,r);return new(G(i,i[Rt]))(i.buffer,i.byteOffset+n*i.BYTES_PER_ELEMENT,b((void 0===e?r:T(e,r))-n))}},ee=function(t,e){return Zt(this,Mt.call(Gt(this),t,e))},ie=function(t){Gt(this);var e=Ht(arguments[1],1),i=this.length,r=M(t),n=b(r.length),o=0;if(n+e>i)throw nt("Wrong length!");for(;o<n;)this[e+o]=r[o++]},re={entries:function(){return Tt.call(Gt(this))},keys:function(){return wt.call(Gt(this))},values:function(){return bt.call(Gt(this))}},ne=function(t,e){return I(t)&&t[Ot]&&"symbol"!=typeof e&&e in t&&String(+e)==String(e)},oe=function(t,e){return ne(t,e=B(e,!0))?f(2,t[e]):rt(t,e)},se=function(t,e,i){return!(ne(t,e=B(e,!0))&&I(i)&&C(i,"value"))||C(i,"get")||C(i,"set")||i.configurable||C(i,"writable")&&!i.writable||C(i,"enumerable")&&!i.enumerable?it(t,e,i):(t[e]=i.value,t)};Ut||(et.f=oe,tt.f=se),n(n.S+n.F*!Ut,"Object",{getOwnPropertyDescriptor:oe,defineProperty:se}),i((function(){kt.call({})}))&&(kt=Pt=function(){return St.call(this)});var ae=m({},te);m(ae,re),A(ae,Lt,re.values),m(ae,{slice:ee,set:ie,constructor:function(){},toString:kt,toLocaleString:Yt}),Kt(ae,"buffer","b"),Kt(ae,"byteOffset","o"),Kt(ae,"byteLength","l"),Kt(ae,"length","e"),it(ae,zt,{get:function(){return this[Ot]}}),t.exports=function(t,r,s,a){var l=t+((a=!!a)?"Clamped":"")+"Array",c="get"+t,u="set"+t,h=e[l],d=h||{},f=h&&z(h),m=!h||!o.ABV,g={},_=h&&h.prototype,y=function(t,e){it(t,e,{get:function(){return function(t,e){var i=t._d;return i.v[c](e*r+i.o,Vt)}(this,e)},set:function(t){return function(t,e,i){var n=t._d;a&&(i=(i=Math.round(i))<0?0:i>255?255:255&i),n.v[u](e*r+n.o,i,Vt)}(this,e,t)},enumerable:!0})};m?(h=s((function(t,e,i,n){p(t,h,l,"_d");var o,s,a,c,u=0,d=0;if(I(e)){if(!(e instanceof ct||"ArrayBuffer"==(c=S(e))||"SharedArrayBuffer"==c))return Ot in e?qt(h,e):Wt.call(h,e);o=e,d=Ht(i,r);var f=e.byteLength;if(void 0===n){if(f%r)throw nt("Wrong length!");if((s=f-d)<0)throw nt("Wrong length!")}else if((s=b(n)*r)+d>f)throw nt("Wrong length!");a=s/r}else a=w(e),o=new ct(s=a*r);for(A(t,"_d",{b:o,o:d,l:s,e:a,v:new ut(o)});u<a;)y(t,u++)})),_=h.prototype=P(ae),A(_,"constructor",h)):i((function(){h(1)}))&&i((function(){new h(-1)}))&&W((function(t){new h,new h(null),new h(1.5),new h(t)}),!0)||(h=s((function(t,e,i,n){var o;return p(t,h,l),I(e)?e instanceof ct||"ArrayBuffer"==(o=S(e))||"SharedArrayBuffer"==o?void 0!==n?new d(e,Ht(i,r),n):void 0!==i?new d(e,Ht(i,r)):new d(e):Ot in e?qt(h,e):Wt.call(h,e):new d(w(e))})),ht(f!==Function.prototype?F(d).concat(F(f)):F(d),(function(t){t in h||A(h,t,d[t])})),h.prototype=_,_.constructor=h);var v=_[Lt],x=!!v&&("values"==v.name||null==v.name),T=re.values;A(h,Dt,!0),A(_,Ot,l),A(_,Nt,!0),A(_,Rt,h),(a?new h(1)[zt]==l:zt in _)||it(_,zt,{get:function(){return l}}),g[l]=h,n(n.G+n.W+n.F*(h!=d),g),n(n.S,l,{BYTES_PER_ELEMENT:r}),n(n.S+n.F*i((function(){d.of.call(h,1)})),l,{from:Wt,of:Xt}),"BYTES_PER_ELEMENT"in _||A(_,"BYTES_PER_ELEMENT",r),n(n.P,l,te),X(l),n(n.P+n.F*jt,l,{set:ie}),n(n.P+n.F*!x,l,re),_.toString!=kt&&(_.toString=kt),n(n.P+n.F*i((function(){new h(1).slice()})),l,{slice:ee}),n(n.P+n.F*(i((function(){return[1,2].toLocaleString()!=new h([1,2]).toLocaleString()}))||!i((function(){_.toLocaleString.call([1,2])}))),l,{toLocaleString:Yt}),K[l]=x?v:T,x||A(_,Lt,T)}}else t.exports=function(){}}));jr("Uint8",1,(function(t){return function(e,i,r){return t(this,e,i,r)}}));var Hr=function(){function t(e,i,r){void 0===r&&(r={}),r=t.sliceOptions(r),this.gl=e,this.texture=e.createTexture(),this.texture&&(this.valid=!0),this.bind(),this.name=i,this.retain_count=0,this.config_type=null,this.loading=null,this.loaded=!1,this.filtering=r.filtering,this.density=r.density||1,this.sprites=r.sprites,this.texcoords={},this.sizes={},this.css_sizes={},this.aspects={},this.setData(1,1,new Uint8Array([0,0,0,0]),{filtering:"nearest"}),this.loaded=!1,t.textures[this.name]&&(this.retain_count=t.textures[this.name].retain_count,t.textures[this.name].retain_count=0,t.textures[this.name].destroy()),t.textures[this.name]=this,t.texture_configs[this.name]=JSON.stringify(Object.assign({name:i},r)),this.load(r),Ki("trace","creating Texture "+this.name)}var e=t.prototype;return e.destroy=function(e){var i=(void 0===e?{}:e).force;this.retain_count>0&&!i?Ki("error","Texture '"+this.name+"': destroying texture with retain count of '"+this.retain_count+"'"):this.valid&&(this.gl.deleteTexture(this.texture),this.texture=null,t.textures[this.name]===this&&(delete t.textures[this.name],delete t.texture_configs[this.name]),this.valid=!1,Ki("trace","destroying Texture "+this.name))},e.retain=function(){this.retain_count++},e.release=function(){this.retain_count<=0&&Ki("error","Texture '"+this.name+"': releasing texture with retain count of '"+this.retain_count+"'"),this.retain_count--,this.retain_count<=0&&this.destroy()},e.bind=function(e){void 0===e&&(e=0),this.valid&&(t.activeUnit!==e&&(this.gl.activeTexture(this.gl.TEXTURE0+e),t.activeUnit=e,t.boundTexture=null),t.boundTexture!==this.texture&&(this.gl.bindTexture(this.gl.TEXTURE_2D,this.texture),t.boundTexture=this.texture))},e.load=function(t){var e=this;return t?(this.loading=null,"string"==typeof t.url?(this.config_type="url",this.setUrl(t.url,t)):t.element?(this.config_type="element",this.setElement(t.element,t)):t.data&&t.width&&t.height&&(this.config_type="data",this.setData(t.width,t.height,t.data,t)),this.loading=this.loading&&this.loading.then((function(){return e.calculateSprites(),e}))||Promise.resolve(this),this.loading):this.loading||Promise.resolve(this)},e.setUrl=function(e,i){var r=this;if(void 0===i&&(i={}),this.valid)return this.url=e,this.loading=new Promise((function(e){var n=new Image;n.onload=function(){try{if("data:"===r.url.slice(0,5)){var o=document.createElement("canvas"),s=o.getContext("2d");o.width=n.width,o.height=n.height,s.drawImage(n,0,0),r.setElement(o,i)}else r.setElement(n,i)}catch(e){r.loaded=!1,Ki("warn","Texture '"+r.name+"': failed to load url: '"+r.url+"'",e,i),t.trigger("warning",{message:"Failed to load texture from "+r.url,error:e,texture:i})}r.loaded=!0,e(r)},n.onerror=function(n){r.loaded=!1,Ki("warn","Texture '"+r.name+"': failed to load url: '"+r.url+"'",n,i),t.trigger("warning",{message:"Failed to load texture from "+r.url,error:n,texture:i}),e(r)},Yi.isSafari()&&"data:"===r.url.slice(0,5)||(n.crossOrigin="anonymous"),n.src=r.url})),this.loading},e.setData=function(t,e,i,r){return void 0===r&&(r={}),this.width=t,this.height=e,Array.isArray(i)&&(i=new Uint8Array(i)),this.update(i,r),this.setFiltering(r),this.loaded=!0,this.loading=Promise.resolve(this),this.loading},e.setElement=function(e,i){var r=e;if("string"==typeof e&&(e=document.querySelector(e)),e instanceof HTMLCanvasElement||e instanceof HTMLImageElement||e instanceof HTMLVideoElement)this.update(e,i),this.setFiltering(i);else{this.loaded=!1;var n="the 'element' parameter (`element: "+JSON.stringify(r)+"`) must be a CSS ";n+="selector string, or a <canvas>, <image> or <video> object",Ki("warn","Texture '"+this.name+"': "+n,i),t.trigger("warning",{message:"Failed to load texture because "+n,texture:i})}return this.loaded=!0,this.loading=Promise.resolve(this),this.loading},e.update=function(e,i){void 0===i&&(i={}),this.valid&&(this.bind(),e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof HTMLImageElement&&e.complete?(this.width=e.width,this.height=e.height,this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1!==i.UNPACK_FLIP_Y_WEBGL),this.gl.pixelStorei(this.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i.UNPACK_PREMULTIPLY_ALPHA_WEBGL||!1),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,e)):(this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,null),this.gl.pixelStorei(this.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,null),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.width,this.height,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,e)),t.trigger("update",this))},e.setFiltering=function(e){if(void 0===e&&(e={}),this.valid){e.filtering=e.filtering||"linear";var i=this.gl;this.bind(),Yi.isPowerOf2(this.width)&&Yi.isPowerOf2(this.height)?(this.power_of_2=!0,i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,e.TEXTURE_WRAP_S||e.repeat&&i.REPEAT||i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,e.TEXTURE_WRAP_T||e.repeat&&i.REPEAT||i.CLAMP_TO_EDGE),"mipmap"===e.filtering?(this.filtering="mipmap",i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR_MIPMAP_LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR),i.generateMipmap(i.TEXTURE_2D)):"linear"===e.filtering?(this.filtering="linear",i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR)):"nearest"===e.filtering&&(this.filtering="nearest",i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.NEAREST))):(this.power_of_2=!1,i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),"nearest"===e.filtering?(this.filtering="nearest",i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.NEAREST)):(this.filtering="linear",i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR))),t.trigger("update",this)}},e.calculateSprites=function(){if(this.sprites)for(var e in this.sprites){var i=this.sprites[e];this.texcoords[e]=t.getTexcoordsForSprite([i[0],i[1]],[i[2],i[3]],[this.width,this.height]),this.sizes[e]=[i[2],i[3]],this.css_sizes[e]=[i[2]/this.density,i[3]/this.density],this.aspects[e]=i[2]/i[3]}},e.byteSize=function(){return Math.round(this.width*this.height*4*("mipmap"==this.filtering?1.33:1))},t}();Hr.create=function(t,e,i){return new Hr(t,e,i)},Hr.retain=function(t){Hr.textures[t]&&Hr.textures[t].retain()},Hr.release=function(t){Hr.textures[t]&&Hr.textures[t].release()},Hr.destroy=function(t){Object.keys(Hr.textures).forEach((function(e){var i=Hr.textures[e];i.gl===t&&i.destroy({force:!0})}))},Hr.getSpriteInfo=function(t,e){var i=Hr.textures[t];return i&&{size:i.sizes[e],css_size:i.css_sizes[e],aspect:i.aspects[e],texcoords:i.texcoords[e]}},Hr.getTexcoordsForSprite=function(t,e,i){var r=i[1]-t[1]-e[1];return[t[0]/i[0],r/i[1],(e[0]+t[0])/i[0],(e[1]+r)/i[1]]},Hr.createFromObject=function(t,e){var i=[];if(e)for(var r in e){var n=e[r];if(!n.skip_create&&Hr.changed(r,n)){var o=Hr.create(t,r,n);i.push(o.loading)}}return Promise.all(i)},Hr.default="__default",Hr.createDefault=function(t){return Hr.create(t,Hr.default)},Hr.sliceOptions=function(t){return{filtering:t.filtering,sprites:t.sprites,url:t.url,element:t.element,data:t.data,width:t.width,height:t.height,density:t.density,repeat:t.repeat,TEXTURE_WRAP_S:t.TEXTURE_WRAP_S,TEXTURE_WRAP_T:t.TEXTURE_WRAP_T,UNPACK_FLIP_Y_WEBGL:t.UNPACK_FLIP_Y_WEBGL,UNPACK_PREMULTIPLY_ALPHA_WEBGL:t.UNPACK_PREMULTIPLY_ALPHA_WEBGL}},Hr.changed=function(t,e){var i=Hr.textures[t];if(i){if("element"===i.config_type||null!=e.element)return!0;if(e=Hr.sliceOptions(e),Hr.texture_configs[t]===JSON.stringify(Object.assign({name:t},e)))return!1}return!0},Hr.getInfo=function(t){if(t||(t=Object.keys(Hr.textures)),Array.isArray(t))return Promise.all(t.map((function(t){return Hr.getInfo(t)})));var e=Hr.textures[t];return e?(e.loading||Promise.resolve(e)).then((function(){return{name:e.name,width:e.width,height:e.height,density:e.density,css_size:[e.width/e.density,e.height/e.density],aspect:e.width/e.height,sprites:e.sprites,texcoords:e.texcoords,sizes:e.sizes,css_sizes:e.css_sizes,aspects:e.aspects,filtering:e.filtering,power_of_2:e.power_of_2,valid:e.valid}})):Promise.resolve(null)},Hr.syncTexturesToWorker=function(t){return Qi.postMessage("Texture.getInfo",t).then((function(t){return t&&t.filter((function(t){return t})).forEach((function(t){return Hr.textures[t.name]=t})),Hr.textures}))},Hr.getMaxTextureSize=function(t){return t.getParameter(t.MAX_TEXTURE_SIZE)},Hr.textures={},Hr.texture_configs={},Hr.boundTexture=null,Hr.activeUnit=null,Qi.addTarget("Texture",Hr),Br(Hr),se("match",1,(function(t,e,i,r){return[function(i){var r=t(this),n=null==i?void 0:i[e];return void 0!==n?n.call(i,r):new RegExp(i)[e](String(r))},function(t){var e=r(i,t,this);if(e.done)return e.value;var n=u(t),o=String(this);if(!n.global)return Kt(n,o);var s=n.unicode;n.lastIndex=0;for(var a,l=[],c=0;null!==(a=Kt(n,o));){var h=String(a[0]);l[c]=h,""===h&&(n.lastIndex=Zt(o,j(n.lastIndex),s)),c++}return 0===c?null:l}]}));var Gr={parseUniforms:function(t){var e=[];for(var i in t){var r,n=i,o=t[i];if("number"==typeof o)e.push({type:"float",method:"1f",name:i,value:o,key:n,uniforms:t});else if(Array.isArray(o)){if("number"==typeof o[0])o.length>=2&&o.length<=4?e.push({type:"vec"+o.length,method:o.length+"fv",name:i,value:o,key:n,uniforms:t}):o.length>4&&e.push({type:"float[]",method:"1fv",name:i+"[0]",value:o,key:n,uniforms:t});else if("string"==typeof o[0])for(r=0;r<o.length;r++)e.push({type:"sampler2D",method:"1i",name:i+"["+r+"]",value:o[r],key:r,uniforms:o});else if(Array.isArray(o[0])&&"number"==typeof o[0][0]&&o[0].length>=2&&o[0].length<=4)for(r=0;r<o.length;r++)e.push({type:"vec"+o[0].length,method:o[0].length+"fv",name:i+"["+r+"]",value:o[r],key:r,uniforms:o})}else"boolean"==typeof o?e.push({type:"bool",method:"1i",name:i,value:o,key:n,uniforms:t}):"string"==typeof o&&e.push({type:"sampler2D",method:"1i",name:i,value:o,key:n,uniforms:t})}return e},defineVariable:function(t,e){var i,r;if("number"==typeof e)i="float";else if(Array.isArray(e))"number"==typeof e[0]?e.length>=2&&e.length<=4?i="vec"+e.length:(i="float",r=e.length):"string"==typeof e[0]?(i="sampler2D",r=e.length):Array.isArray(e[0])&&"number"==typeof e[0][0]&&e[0].length>=2&&e[0].length<=4&&(i="vec"+e[0].length,r=e.length);else if("boolean"==typeof e)i="bool";else{if("string"!=typeof e)return;i="sampler2D"}var n="";return n+=i+" "+t,r&&(n+="["+r+"]"),n+";\n"},defineUniform:function(t,e){var i=Gr.defineVariable(t,e);if(i)return"uniform "+i},expandVec3:function(t,e){var i;if(void 0===e&&(e=1),Array.isArray(t)){if(2!==t.length)return t;i=[].concat(t,[e]).map(parseFloat)}else i=[t,t,t].map(parseFloat);if(i&&i.every((function(t){return"number"==typeof t&&!isNaN(t)})))return i},expandVec4:function(t,e){var i;if(void 0===e&&(e=1),Array.isArray(t)){if(3!==t.length)return t;i=[].concat(t,[e]).map(parseFloat)}else i=[t,t,t,e].map(parseFloat);if(i&&i.every((function(t){return"number"==typeof t&&!isNaN(t)})))return i}},$r=[];function Zr(t,e){var i=$r.filter((function(e){return e[0]===t}))[0];return(i=i&&i[1])||($r.push([t,{}]),i=$r[$r.length-1][1]),i[e]||(i[e]=t.getExtension(e)),i[e]}function qr(t){var e,i,r=0;if(0===t.length)return r;for(e=0,i=t.length;e<i;e++)r=(r<<5)-r+t.charCodeAt(e),r|=0;return r}var Kr=function(t){t=String(t);for(var e,i=[];e=t.match(/ERROR\:([^\n]+)/);){t=t.slice(e.index+1);var r=(s=e[1].trim()).split(":"),n=r.slice(2).join(":").trim(),o=parseInt(r[0],10),s=parseInt(r[1],10);i.push({message:n,file:o,line:s})}return i},Wr=/^\s*#pragma.*$/gm,Xr=/\\\s*\n/gm,Jr=function(){function t(e,i,r,n){n=n||{},this.gl=e,this.program=null,this.compiled=!1,this.compiling=!1,this.error=null,this.defines=Object.assign({},n.defines||{}),this.blocks=Object.assign({},n.blocks||{}),this.block_scopes=Object.assign({},n.block_scopes||{}),this.extensions=n.extensions||[],this.dependent_uniforms=n.uniforms,this.uniforms={},this.attribs={},this.vertex_source=i,this.fragment_source=r,this.id=t.id++,this.name=n.name}var e=t.prototype;return e.destroy=function(){this.gl.useProgram(null),this.gl.deleteProgram(this.program),this.program=null,this.uniforms={},this.attribs={},this.compiled=!1},e.use=function(){this.compiled&&(t.current!==this&&this.gl.useProgram(this.program),t.current=this)},e.compile=function(){var e=this;if(this.compiling)throw new Error("ShaderProgram.compile(): skipping for "+this.id+" ("+this.name+") because already compiling");this.compiling=!0,this.compiled=!1,this.error=null,this.computed_vertex_source=this.vertex_source,this.computed_fragment_source=this.fragment_source;var i,r=this.checkExtensions(),n=this.buildDefineList(),o=this.buildShaderBlockList();for(var s in o){var a=o[s];if(a&&(!Array.isArray(a)||0!==a.length)){i=new RegExp("^\\s*#pragma\\s+tangram:\\s+"+s+"\\s*$","m");var l=this.computed_vertex_source.match(i),c=this.computed_fragment_source.match(i);if(null!=l||null!=c){var u="";a.forEach((function(t){var e=t.scope+", "+t.key+", "+t.num;u+="\n// tangram-block-start: "+e+"\n",u+=t.source,u+="\n// tangram-block-end: "+e+"\n"})),null!=l&&(this.computed_vertex_source=this.computed_vertex_source.replace(i,u)),null!=c&&(this.computed_fragment_source=this.computed_fragment_source.replace(i,u)),n["TANGRAM_BLOCK_"+s.replace(/[\s-]+/g,"_").toUpperCase()]=!0}}}this.computed_vertex_source=this.computed_vertex_source.replace(Wr,""),this.computed_fragment_source=this.computed_fragment_source.replace(Wr,""),this.ensureUniforms(this.dependent_uniforms);var h="",d=this.gl.getShaderPrecisionFormat(this.gl.FRAGMENT_SHADER,this.gl.HIGH_FLOAT);h=d&&d.precision>0?"precision highp float;\n":"precision mediump float;\n",n.TANGRAM_VERTEX_SHADER=!0,n.TANGRAM_FRAGMENT_SHADER=!1,this.computed_vertex_source=h+t.buildDefineString(n)+this.computed_vertex_source,n.TANGRAM_VERTEX_SHADER=!1,n.TANGRAM_FRAGMENT_SHADER=!0,this.computed_fragment_source=t.buildExtensionString(r)+h+t.buildDefineString(n)+this.computed_fragment_source,this.computed_vertex_source=this.computed_vertex_source.replace(Xr,""),this.computed_fragment_source=this.computed_fragment_source.replace(Xr,"");try{this.program=t.updateProgram(this.gl,this.program,this.computed_vertex_source,this.computed_fragment_source),this.compiled=!0,this.compiling=!1}catch(t){throw this.program=null,this.compiled=!1,this.compiling=!1,this.error=t,this.error.vertex_shader_source=this.computed_vertex_source,this.error.fragment_shader_source=this.computed_fragment_source,"vertex"!==t.type&&"fragment"!==t.type||(this.shader_errors=t.errors,this.shader_errors.forEach((function(i){i.type=t.type,i.block=e.block(t.type,i.line),i.line=e.block(t.type,i.line)})),this.error.shader_errors=this.shader_errors),t}this.computed_vertex_source=null,this.computed_fragment_source=null,this.use(),this.refreshUniforms(),this.refreshAttributes()},e.buildDefineList=function(){var e,i={};for(e in t.defines)i[e]=t.defines[e];for(e in this.defines)i[e]=this.defines[e];return i},e.buildShaderBlockList=function(){var e,i={};for(e in t.blocks){var r;i[e]=[],Array.isArray(t.blocks[e])?(r=i[e]).push.apply(r,t.blocks[e].map((function(t,i){return{key:e,source:t,num:i,scope:"ShaderProgram"}}))):i[e]=[{key:e,source:t.blocks[e],num:0,scope:"ShaderProgram"}]}for(e in this.blocks)if(i[e]=i[e]||[],Array.isArray(this.blocks[e]))for(var n=this.block_scopes&&this.block_scopes[e]||[],o=null,s=0,a=0;a<this.blocks[e].length;a++)n[a]!==o&&(o=n[a],s=0),i[e].push({key:e,source:this.blocks[e][a],num:s,scope:o||this.name}),s++;else i[e].push({key:e,source:this.blocks[e],num:0,scope:this.name});return i},e.ensureUniforms=function(t){if(t){var e=Object.entries(t).map((function(t){var e=t[0],i=t[1];return Gr.defineUniform(e,i)})).filter((function(t){return t}));this.computed_vertex_source=e.join("\n")+this.computed_vertex_source,this.computed_fragment_source=e.join("\n")+this.computed_fragment_source}},e.setUniforms=function(t,e){if(void 0===e&&(e=!0),this.compiled){e&&(this.texture_unit=0);for(var i=Gr.parseUniforms(t),r=0;r<i.length;r++){var n=i[r];"sampler2D"===n.type?this.setTextureUniform(n.name,n.value):this.uniform(n.method,n.name,n.value)}}},e.saveUniforms=function(t){var e=t||this.uniforms;for(var i in e){var r=this.uniforms[i];r&&(r.saved_value=r.value)}this.saved_texture_unit=this.texture_unit||0},e.restoreUniforms=function(t){var e=t||this.uniforms;for(var i in e){var r=this.uniforms[i];r&&r.saved_value&&(r.value=r.saved_value,this.updateUniform(r))}this.texture_unit=this.saved_texture_unit||0},e.setTextureUniform=function(t,e){var i=Hr.textures[e];null!=i?(i.bind(this.texture_unit),this.uniform("1i",t,this.texture_unit),this.texture_unit++):Ki("warn","Cannot find texture '"+e+"'")},e.uniform=function(t,e,i){if(this.compiled){this.uniforms[e]=this.uniforms[e]||{};var r=this.uniforms[e];r.name=e,void 0===r.location&&(r.location=this.gl.getUniformLocation(this.program,e)),r.method=t,r.value=i,this.updateUniform(r)}},e.updateUniform=function(t){this.compiled&&t&&null!=t.location&&(this.use(),this.commitUniform(t))},e.commitUniform=function(t){var e=t.location,i=t.value;switch(t.method){case"1i":this.gl.uniform1i(e,i);break;case"1f":this.gl.uniform1f(e,i);break;case"2f":this.gl.uniform2f(e,i[0],i[1]);break;case"3f":this.gl.uniform3f(e,i[0],i[1],i[2]);break;case"4f":this.gl.uniform4f(e,i[0],i[1],i[2],i[3]);break;case"1iv":this.gl.uniform1iv(e,i);break;case"3iv":this.gl.uniform3iv(e,i);break;case"1fv":this.gl.uniform1fv(e,i);break;case"2fv":this.gl.uniform2fv(e,i);break;case"3fv":this.gl.uniform3fv(e,i);break;case"4fv":this.gl.uniform4fv(e,i);break;case"Matrix3fv":this.gl.uniformMatrix3fv(e,!1,i);break;case"Matrix4fv":this.gl.uniformMatrix4fv(e,!1,i)}},e.refreshUniforms=function(){if(this.compiled)for(var t in this.uniforms){var e=this.uniforms[t];e.location=this.gl.getUniformLocation(this.program,t),this.updateUniform(e)}},e.refreshAttributes=function(){this.attribs={}},e.attribute=function(t){if(this.compiled){var e=this.attribs[t]=this.attribs[t]||{};return null!=e.location||(e.name=t,e.location=this.gl.getAttribLocation(this.program,t)),e}},e.source=function(t){return"vertex"===t?this.computed_vertex_source:"fragment"===t?this.computed_fragment_source:void 0},e.lines=function(t){var e=this.source(t);return e?e.split("\n"):[]},e.line=function(t,e){var i=this.lines(t);if(i)return i[e]},e.block=function(t,e){for(var i,r=this.lines(t),n=0;n<e&&n<r.length;n++){var o=r[n],s=o.match(/\/\/ tangram-block-start: ([A-Za-z0-9_-]+), ([A-Za-z0-9_-]+), (\d+)/);s&&s.length>1?i={scope:s[1],name:s[2],num:s[3]}:(s=o.match(/\/\/ tangram-block-end: ([A-Za-z0-9_-]+), ([A-Za-z0-9_-]+), (\d+)/))&&s.length>1&&(i=null),i&&(i.line=null==i.line?-1:i.line+1,i.source=o)}return i},e.checkExtensions=function(){var t=this,e=[];return this.extensions.forEach((function(i){var r=Zr(t.gl,i),n="TANGRAM_EXTENSION_"+i;t.defines[n]=null!=r,r?e.push(i):Ki("debug","Could not enable extension '"+i+"'")})),e},t}();Jr.id=0,Jr.current=null,Jr.defines={},Jr.blocks={},Jr.reset=function(){Jr.programs_by_source={},Jr.shaders_by_source={}},Jr.reset(),Jr.buildDefineString=function(t){var e="";for(var i in t)null!=t[i]&&!1!==t[i]&&("boolean"==typeof t[i]&&!0===t[i]?e+="#define "+i+"\n":"number"==typeof t[i]&&Math.floor(t[i])===t[i]?e+="#define "+i+" "+t[i].toFixed(1)+"\n":e+="#define "+i+" "+t[i]+"\n");return e},Jr.buildExtensionString=function(t){var e="";return(t=t||[]).forEach((function(t){e+="#ifdef GL_"+t+"\n#extension GL_"+t+" : enable\n#endif\n"})),e},Jr.addBlock=function(t){var e;Jr.blocks[t]=Jr.blocks[t]||[];for(var i=arguments.length,r=new Array(i>1?i-1:0),n=1;n<i;n++)r[n-1]=arguments[n];(e=Jr.blocks[t]).push.apply(e,r)},Jr.removeBlock=function(t){Jr.blocks[t]=[]},Jr.replaceBlock=function(t){Jr.removeBlock(t);for(var e=arguments.length,i=new Array(e>1?e-1:0),r=1;r<e;r++)i[r-1]=arguments[r];Jr.addBlock.apply(Jr,[t].concat(i))},Jr.updateProgram=function(t,e,i,r){var n=qr(t._tangram_id+"::"+i+"::"+r);if(Jr.programs_by_source[n])return Ki("trace","Reusing identical source GL program object"),Jr.programs_by_source[n];var o=Jr.createShader(t,i,t.VERTEX_SHADER),s=Jr.createShader(t,r,t.FRAGMENT_SHADER);if(t.useProgram(null),null!=e)for(var a=t.getAttachedShaders(e),l=0;l<a.length;l++)t.detachShader(e,a[l]);else e=t.createProgram();if(null==o||null==s)return e;if(t.attachShader(e,o),t.attachShader(e,s),t.bindAttribLocation(e,0,"a_position"),t.linkProgram(e),!t.getProgramParameter(e,t.LINK_STATUS)){var c=new Error("WebGL program error:\n            VALIDATE_STATUS: "+t.getProgramParameter(e,t.VALIDATE_STATUS)+"\n            ERROR: "+t.getError()+"\n            --- Vertex Shader ---\n            "+i+"\n            --- Fragment Shader ---\n            "+r);throw Object.assign(new Error(c),{type:"program"})}return Jr.programs_by_source[n]=e,e},Jr.createShader=function(t,e,i){var r=qr(t._tangram_id+"::"+e);if(Jr.shaders_by_source[r])return Ki("trace","Reusing identical source GL shader object"),Jr.shaders_by_source[r];var n=t.createShader(i);if(t.shaderSource(n,e),t.compileShader(n),!t.getShaderParameter(n,t.COMPILE_STATUS)){var o=i===t.VERTEX_SHADER?"vertex":"fragment",s=t.getShaderInfoLog(n),a=Kr(s);throw Object.assign(new Error(s),{type:o,errors:a})}return Jr.shaders_by_source[r]=n,n};var Yr={disabled:!1,bound_vao:[],init:function(t){var e;!0!==this.disabled&&(e=Zr(t,"OES_vertex_array_object")),null!=e?Ki("info","Vertex Array Object extension available"):!0!==this.disabled?Ki("warn","Vertex Array Object extension NOT available"):Ki("warn","Vertex Array Object extension force disabled")},getExtension:function(t,e){if(!0!==this.disabled)return Zr(t,e)},create:function(t,e,i){var r={};r.setup=e,r.teardown=i;var n=this.getExtension(t,"OES_vertex_array_object");return null!=n&&(r._vao=n.createVertexArrayOES(),n.bindVertexArrayOES(r._vao)),r.setup(),r},getCurrentBinding:function(t){var e=this.bound_vao.filter((function(e){return e[0]===t}))[0];return e&&e[1]},setCurrentBinding:function(t,e){var i=this.bound_vao,r=i.filter((function(e){return e[0]===t}))[0];null==r?i.push([t,e]):r[1]=e},bind:function(t,e){var i=this.getExtension(t,"OES_vertex_array_object");if(null!=e)null!=i&&null!=e._vao?(i.bindVertexArrayOES(e._vao),this.setCurrentBinding(t,e)):e.setup();else{var r=this.getCurrentBinding(t);null!=i?i.bindVertexArrayOES(null):null!=r&&"function"==typeof r.teardown&&r.teardown(),this.setCurrentBinding(t,null)}},destroy:function(t,e){var i=this.getExtension(t,"OES_vertex_array_object");null!=i&&null!=e&&null!=e._vao&&(i.deleteVertexArrayOES(e._vao),e._vao=null)}},tn=Ot(!1);U(U.S,"Object",{values:function(t){return tn(t)}});var en,rn=Qr(6),nn="findIndex",on=!0;function sn(t){for(var e=0;e<(arguments.length<=1?0:arguments.length-1);e++){var i=e+1<1||arguments.length<=e+1?void 0:arguments[e+1];if(i)for(var r in i){var n=i[r];null===n||"object"!=typeof n||Array.isArray(n)?void 0!==n&&(t[r]=n):null===t[r]||"object"!=typeof t[r]||Array.isArray(t[r])?t[r]=sn({},n):t[r]=sn(t[r],n)}}return t}nn in[]&&Array(1)[nn]((function(){on=!1})),U(U.P+U.F*on,"Array",{findIndex:function(t){return rn(this,t,arguments.length>1?arguments[1]:void 0)}}),T(nn);var an=en={};en.default_source_max_zoom=18,en.default_view_max_zoom=20,en.max_style_zoom=25,en.tile_size=256,en.half_circumference_meters=20037508.342789244,en.circumference_meters=2*en.half_circumference_meters,en.min_zoom_meters_per_pixel=en.circumference_meters/en.tile_size;var ln=[];en.metersPerPixel=function(t){return ln[t]=ln[t]||en.min_zoom_meters_per_pixel/Math.pow(2,t),ln[t]};var cn=[];en.metersPerTile=function(t){return cn[t]=cn[t]||en.circumference_meters/Math.pow(2,t),cn[t]},en.tile_scale=4096,en.units_per_pixel=en.tile_scale/en.tile_size,en.height_scale=16;var un=[];en.unitsPerMeter=function(t){return un[t]=un[t]||en.tile_scale/(en.tile_size*en.metersPerPixel(t)),un[t]},en.metersForTile=function(t){return{x:t.x*en.circumference_meters/Math.pow(2,t.z)-en.half_circumference_meters,y:-(t.y*en.circumference_meters/Math.pow(2,t.z)-en.half_circumference_meters)}},en.tileForMeters=function(t,e){var i=t[0],r=t[1];return{x:Math.floor((i+en.half_circumference_meters)/(en.circumference_meters/Math.pow(2,e))),y:Math.floor((-r+en.half_circumference_meters)/(en.circumference_meters/Math.pow(2,e))),z:e}},en.wrapTile=function(t,e){var i=t.x,r=t.y,n=t.z;void 0===e&&(e={x:!0,y:!1});var o=(1<<n)-1;return e.x&&(i&=o),e.y&&(r&=o),{x:i,y:r,z:n}},en.metersToLatLng=function(t){return t[0]/=en.half_circumference_meters,t[1]/=en.half_circumference_meters,t[1]=(2*Math.atan(Math.exp(t[1]*Math.PI))-Math.PI/2)/Math.PI,t[0]*=180,t[1]*=180,t},en.latLngToMeters=function(t){return t[1]=Math.log(Math.tan(t[1]*Math.PI/360+Math.PI/4))/Math.PI,t[1]*=en.half_circumference_meters,t[0]*=en.half_circumference_meters/180,t},en.tileSpaceToLatlng=function(t,e,i){var r=en.unitsPerMeter(e);return en.transformGeometry(t,(function(t){t[0]=t[0]/r+i.x,t[1]=t[1]/r+i.y,en.metersToLatLng(t)})),t},en.copyGeometry=function(t){if(null!=t){var e={type:t.type};return"Point"===t.type?e.coordinates=[t.coordinates[0],t.coordinates[1]]:"LineString"===t.type||"MultiPoint"===t.type?e.coordinates=t.coordinates.map((function(t){return[t[0],t[1]]})):"Polygon"===t.type||"MultiLineString"===t.type?e.coordinates=t.coordinates.map((function(t){return t.map((function(t){return[t[0],t[1]]}))})):"MultiPolygon"===t.type&&(e.coordinates=t.coordinates.map((function(t){return t.map((function(t){return t.map((function(t){return[t[0],t[1]]}))}))}))),e}},en.transformGeometry=function(t,e){null!=t&&("Point"===t.type?e(t.coordinates):"LineString"===t.type||"MultiPoint"===t.type?t.coordinates.forEach(e):"Polygon"===t.type||"MultiLineString"===t.type?t.coordinates.forEach((function(t){return t.forEach(e)})):"MultiPolygon"===t.type&&t.coordinates.forEach((function(t){t.forEach((function(t){return t.forEach(e)}))})))},en.boxIntersect=function(t,e){return!(e.sw.x>t.ne.x||e.ne.x<t.sw.x||e.sw.y>t.ne.y||e.ne.y<t.sw.y)},en.findBoundingBox=function(t){for(var e=1/0,i=-1/0,r=1/0,n=-1/0,o=t[0].length,s=0;s<o;s++){var a=t[0][s];a[0]<e&&(e=a[0]),a[1]<r&&(r=a[1]),a[0]>i&&(i=a[0]),a[1]>n&&(n=a[1])}return[e,r,i,n]},en.geometryType=function(t){return"Polygon"===t||"MultiPolygon"===t?"polygon":"LineString"===t||"MultiLineString"===t?"line":"Point"===t||"MultiPoint"===t?"point":void 0},en.centroid=function(t,e){if(void 0===e&&(e=!0),t&&0!==t.length){var i,r=0,n=0,o=0,s=t[0],a=s.length;e&&(i=s[0],s=s.map((function(t){return[t[0]-i[0],t[1]-i[1]]})));for(var l=0,c=a-1;l<a;c=l,l++){var u=s[l],h=s[c],d=u[1]*h[0]-h[1]*u[0];r+=(u[0]+h[0])*d,n+=(u[1]+h[1])*d,o+=3*d}if(o){var p=[r/o,n/o];return e&&(p[0]+=i[0],p[1]+=i[1]),p}}},en.multiCentroid=function(t){for(var e=0,i=null,r=0;r<t.length;r++){var n=en.centroid(t[r]);n&&((i=i||[0,0])[0]+=n[0],i[1]+=n[1],e++)}return e>0&&(i[0]/=e,i[1]/=e),i},en.signedPolygonRingAreaSum=function(t){for(var e=0,i=t.length,r=0;r<i-1;r++){var n=t[r],o=t[r+1];e+=n[0]*o[1]-o[0]*n[1]}return e+(t[i-1][0]*t[0][1]-t[0][0]*t[i-1][1])},en.polygonRingArea=function(t){return Math.abs(en.signedPolygonRingAreaSum(t))/2},en.polygonArea=function(t){if(t)return en.polygonRingArea(t[0])},en.multiPolygonArea=function(t){for(var e=0,i=0;i<t.length;i++)e+=en.polygonArea(t[i]);return e},en.ringWinding=function(t){var e=en.signedPolygonRingAreaSum(t);return e>0?"CW":e<0?"CCW":void 0};var hn="\t\n\v\f\r \u2028\u2029\ufeff",dn="["+hn+"]",pn=RegExp("^"+dn+dn+"*"),fn=RegExp(dn+dn+"*$"),An=function(t,e,i){var r={},n=h((function(){return!!hn[t]()||""!=""[t]()})),o=r[t]=n?e(mn):hn[t];i&&(r[i]=o),U(U.P+U.F*n,"String",r)},mn=An.trim=function(t,e){return t=String(M(t)),1&e&&(t=t.replace(pn,"")),2&e&&(t=t.replace(fn,"")),t},gn=An,_n=ar.f,yn=ir.f,vn=y.f,xn=gn.trim,bn=r.Number,wn=bn,Tn=bn.prototype,Bn="Number"==S(at(Tn)),En="trim"in String.prototype,Cn=function(t){var e=g(t,!1);if("string"==typeof e&&e.length>2){var i,r,n,o=(e=En?e.trim():xn(e,3)).charCodeAt(0);if(43===o||45===o){if(88===(i=e.charCodeAt(2))||120===i)return NaN}else if(48===o){switch(e.charCodeAt(1)){case 66:case 98:r=2,n=49;break;case 79:case 111:r=8,n=55;break;default:return+e}for(var s,a=e.slice(2),l=0,c=a.length;l<c;l++)if((s=a.charCodeAt(l))<48||s>n)return NaN;return parseInt(a,r)}}return+e};if(!bn(" 0o1")||!bn("0b1")||bn("+0x1")){bn=function(t){var e=arguments.length<1?0:t,i=this;return i instanceof bn&&(Bn?h((function(){Tn.valueOf.call(i)})):"Number"!=S(i))?or(new wn(Cn(e)),i,bn):Cn(e)};for(var Sn,In=d?_n(wn):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger".split(","),Mn=0;In.length>Mn;Mn++)L(wn,Sn=In[Mn])&&!L(bn,Sn)&&vn(bn,Sn,yn(wn,Sn));bn.prototype=Tn,Tn.constructor=bn,z(r,"Number",bn)}U(U.S,"Number",{MIN_SAFE_INTEGER:-9007199254740991});var kn=e((function(t){var e=a("meta"),i=y.f,r=0,n=Object.isExtensible||function(){return!0},o=!h((function(){return n(Object.preventExtensions({}))})),s=function(t){i(t,e,{value:{i:"O"+ ++r,w:{}}})},l=t.exports={KEY:e,NEED:!1,fastKey:function(t,i){if(!c(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!L(t,e)){if(!n(t))return"F";if(!i)return"E";s(t)}return t[e].i},getWeak:function(t,i){if(!L(t,e)){if(!n(t))return!0;if(!i)return!1;s(t)}return t[e].w},onFreeze:function(t){return o&&l.NEED&&n(t)&&!L(t,e)&&s(t),t}}})),Pn=(kn.KEY,kn.NEED,kn.fastKey,kn.getWeak,kn.onFreeze,kn.onFreeze);Li("freeze",(function(t){return function(e){return t&&c(e)?t(Pn(e)):e}}));var Ln={functions:{},num_functions:0,num_cached:0};function zn(t,e){if("string"==typeof t)t=Fn(t,e);else if(null!=t&&"object"==typeof t)for(var i in t)t[i]=zn(t[i],e);return t}function Fn(t,e){var i="string"==typeof t&&t.match(/^\s*function[^(]*\(([^)]*)\)\s*?\{([\s\S]*)\}$/m);if(i&&i.length>2)try{var r=i[2],n="function"==typeof e?e(r):r,o=qr(n);if(void 0===Ln.functions[o]){var s=i[1].length>0&&i[1].split(",").map((function(t){return t.trim()})).filter((function(t){return t}));s=s.length>0?s:["context"],Ln.functions[o]=new Function(s.toString(),n),Ln.functions[o].source=r,Ln.num_functions++}else Ln.num_cached++;return Ln.functions[o]}catch(e){return t}return t}var Dn=e((function(t,e){var i={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function r(t){return(t=Math.round(t))<0?0:t>255?255:t}function n(t){return t<0?0:t>1?1:t}function o(t){return"%"===t[t.length-1]?r(parseFloat(t)/100*255):r(parseInt(t))}function s(t){return"%"===t[t.length-1]?n(parseFloat(t)/100):n(parseFloat(t))}function a(t,e,i){return i<0?i+=1:i>1&&(i-=1),6*i<1?t+(e-t)*i*6:2*i<1?e:3*i<2?t+(e-t)*(2/3-i)*6:t}try{e.parseCSSColor=function(t){var e,n=t.replace(/ /g,"").toLowerCase();if(n in i)return i[n].slice();if("#"===n[0])return 4===n.length?(e=parseInt(n.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:7===n.length&&(e=parseInt(n.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var l=n.indexOf("("),c=n.indexOf(")");if(-1!==l&&c+1===n.length){var u=n.substr(0,l),h=n.substr(l+1,c-(l+1)).split(","),d=1;switch(u){case"rgba":if(4!==h.length)return null;d=s(h.pop());case"rgb":return 3!==h.length?null:[o(h[0]),o(h[1]),o(h[2]),d];case"hsla":if(4!==h.length)return null;d=s(h.pop());case"hsl":if(3!==h.length)return null;var p=(parseFloat(h[0])%360+360)%360/360,f=s(h[1]),A=s(h[2]),m=A<=.5?A*(f+1):A+f-A*f,g=2*A-m;return[r(255*a(g,m,p+1/3)),r(255*a(g,m,p)),r(255*a(g,m,p-1/3)),d];default:return null}}return null}}catch(t){}})),Rn=(Dn.parseCSSColor,{}),Un=function(t){return Math.max(t,0)},On=function(t){return isNaN(t)?0:t},Nn=function(t){return Array.isArray(t)?t.map(parseFloat).map(On):On(parseFloat(t))},Qn=function(t){return Array.isArray(t)?t.map(Nn).map(Un):Un(Nn(t))};Object.assign(Rn,{clampPositive:Un,noNaN:On,parseNumber:Nn,parsePositiveNumber:Qn}),Rn.wrapFunction=function(t){return"\n        var feature = context.feature.properties;\n        var global = context.global;\n        var $zoom = context.zoom;\n        var $layer = context.layer;\n        var $source = context.source;\n        var $geometry = context.geometry;\n        var $meters_per_pixel = context.meters_per_pixel;\n        var $id = context.id;\n\n        var val = (function(){ "+t+" }());\n\n        if (typeof val === 'number' && isNaN(val)) {\n            val = null; // convert NaNs to nulls\n        }\n\n        return val;\n    "},Rn.zeroPair=Object.freeze([0,0]),Rn.defaults={color:[1,1,1,1],width:1,size:1,extrude:!1,height:20,min_height:0,order:0,z:0,outline:{color:[0,0,0,0],width:0},material:{ambient:1,diffuse:1}},Rn.macros={"Style.color.pseudoRandomColor":function(){return[parseInt(feature.id,16)/100%1*.7,parseInt(feature.id,16)/1e4%1*.7,parseInt(feature.id,16)/1e6%1*.7,1]},"Style.color.randomColor":function(){return[.7*Math.random(),.7*Math.random(),.7*Math.random(),1]}},Rn.getFeatureParseContext=function(t,e,i){return{feature:t,id:t.id,tile:e,global:i,zoom:e.style_z,geometry:an.geometryType(t.geometry.type),meters_per_pixel:e.meters_per_pixel,meters_per_pixel_sq:e.meters_per_pixel_sq,units_per_meter_overzoom:e.units_per_meter_overzoom}};var Vn={STATIC:0,DYNAMIC:1,ZOOM:2};Rn.CACHE_TYPE=Vn,Rn.createPropertyCache=function(t,e,i){if(void 0===e&&(e=null),void 0===i&&(i=null),null!=t){if(t.value)return{value:t.value,zoom:t.zoom?{}:null,type:t.type};var r={value:t,type:Vn.STATIC};return Array.isArray(r.value)&&Array.isArray(r.value[0])?(r.zoom={},r.type=Vn.ZOOM):"function"==typeof r.value&&(r.type=Vn.DYNAMIC,r.dynamic_transform="function"==typeof i?i:null),"function"==typeof e&&(r.zoom?r.value=r.value.map((function(t,i){return[t[0],e(t[1],i)]})):"function"!=typeof r.value&&(r.value=e(r.value,0))),r}},Rn.createColorPropertyCache=function(t){return Rn.createPropertyCache(t,(function(t){return"Style.color.pseudoRandomColor"===t?Fn(Rn.wrapFunction(Rn.macros["Style.color.pseudoRandomColor"])):"Style.color.randomColor"===t?Rn.macros["Style.color.randomColor"]:t}))};var jn=function(t){return"string"==typeof t&&"%"===t[t.length-1]},Hn=function(t){return"auto"===t},Gn=function(t){return jn(t)||Hn(t)},$n="'size' can specify either width or height as derived from aspect ratio, but not both";function Zn(t,e){return Rn.createPropertyCache(t.value,(function(i,r){return Array.isArray(i)?(i=i.map((function(e,i){return t.has_ratio[r][i]?e:Qn(e)})).map((function(i,n){return t.has_pct[r][n]?e.css_size[n]*i/100:i})),t.has_ratio[r][0]?i[0]=i[1]*e.aspect:t.has_ratio[r][1]&&(i[1]=i[0]/e.aspect)):(i=Qn(i),i=t.has_pct[r]?e.css_size.map((function(t){return t*i/100})):[i,i]),i}))}function qn(t,e){try{return t(e)}catch(i){Ki("warn","Property function in layer '"+e.layers[e.layers.length-1]+"' failed with\n","error "+i.stack+"\n","function '"+t.source+"'\n",e.feature,e)}}Rn.createPointSizePropertyCache=function(t,e){var i=null,r=null;if(jn(t))i=[!0];else if(Array.isArray(t)){if(Array.isArray(t[0])){if(t.some((function(t){return Array.isArray(t[1])?t[1].some((function(t){return Gn(t)})):jn(t[1])}))&&(i=t.map((function(t){return Array.isArray(t[1])?t[1].map((function(t){return jn(t)})):jn(t[1])})),(r=t.map((function(t){return Array.isArray(t[1])&&t[1].map((function(t){return Hn(t)}))}))).some((function(t){return Array.isArray(t)&&t.every((function(t){return t}))}))))throw $n}else if(t.some(Gn)&&(i=[t.map(jn)],(r=[t.map(Hn)])[0].every((function(t){return t}))))throw $n}else if(Hn(t))throw"this value only allowed as half of an array, eg [16px, auto]:";if(i||r){if(!e)throw"% or 'auto' keywords can only be used to specify point size when a texture is defined";(t={value:t}).has_pct=i,t.has_ratio=r,t.sprites={}}else t=Rn.createPropertyCache(t,Qn);return t},Rn.evalCachedPointSizeProperty=function(t,e,i,r){if(null!=t)return t.has_pct||t.has_ratio?e?(t.sprites[e.sprite]||(t.sprites[e.sprite]=Zn(t,e)),Rn.evalCachedProperty(t.sprites[e.sprite],r)):(t.texture=t.texture||Zn(t,i),Rn.evalCachedProperty(t.texture,r)):Rn.evalCachedProperty(t,r)},Rn.evalCachedProperty=function(t,e){return null==t?void 0:t.dynamic?qn(t.dynamic,e):t.static?t.static:t.zoom&&t.zoom[e.zoom]?t.zoom[e.zoom]:"function"==typeof t.value?(t.dynamic_transform?t.dynamic=function(e){return t.dynamic_transform(t.value(e))}:t.dynamic=t.value,qn(t.dynamic,e)):Array.isArray(t.value)&&Array.isArray(t.value[0])?(t.zoom=t.zoom||{},t.zoom[e.zoom]=Yi.interpolate(e.zoom,t.value),t.zoom[e.zoom]):(t.static=t.value,t.static)},Rn.convertUnits=function(t,e){if(null!=t.value)return"px"===t.units?t.value*an.metersPerPixel(e.zoom):t.value;if("string"==typeof t)"px"===t.trim().slice(-2)?(t=Nn(t),t*=an.metersPerPixel(e.zoom)):t=Nn(t);else if(Array.isArray(t))return Array.isArray(t[0])?t.map((function(t){return[t[0],Rn.convertUnits(t[1],e)]})):t.map((function(t){return Rn.convertUnits(t,e)}));return t},Rn.parseUnits=function(t){var e={value:Nn(t)};return 0!==e.value&&"string"==typeof t&&"px"===t.trim().slice(-2)&&(e.units="px"),e},Rn.evalCachedDistanceProperty=function(t,e){return null==t?void 0:t.dynamic?qn(t.dynamic,e):t.zoom&&t.zoom[e.zoom]?t.zoom[e.zoom]:"function"==typeof t.value?(t.dynamic=t.value,qn(t.dynamic,e)):t.zoom?(t.zoom[e.zoom]=Yi.interpolate(e.zoom,t.value,(function(t){return Rn.convertUnits(t,e)})),t.zoom[e.zoom]):Rn.convertUnits(t.value,e)},Rn.string_colors={},Rn.colorForString=function(t){if(Rn.string_colors[t])return Rn.string_colors[t];var e=Dn.parseCSSColor(t);return e&&4===e.length?(e[0]/=255,e[1]/=255,e[2]/=255):e=Rn.defaults.color,Rn.string_colors[t]=e,e},Rn.evalCachedColorProperty=function(t,e){if(void 0===e&&(e={}),null!=t){if(t.dynamic){var i=qn(t.dynamic,e);return"string"==typeof i&&(i=Rn.colorForString(i)),i&&null==i[3]&&(i[3]=1),i}if(t.static)return t.static;if(t.zoom&&t.zoom[e.zoom])return t.zoom[e.zoom];if("function"==typeof t.value){t.dynamic=t.value;var r=qn(t.dynamic,e);return"string"==typeof r&&(r=Rn.colorForString(r)),r&&null==r[3]&&(r[3]=1),r}if("string"==typeof t.value)return t.static=Rn.colorForString(t.value),t.static;if(t.zoom){if(!t.zoom_preprocessed){for(var n=0;n<t.value.length;n++){var o=t.value[n];o&&"string"==typeof o[1]&&(o[1]=Rn.colorForString(o[1]))}t.zoom_preprocessed=!0}return t.zoom[e.zoom]=Yi.interpolate(e.zoom,t.value),t.zoom[e.zoom][3]=t.zoom[e.zoom][3]||1,t.zoom[e.zoom]}return t.static=t.value.map((function(t){return t})),t.static&&null==t.static[3]&&(t.static[3]=1),t.static}},Rn.evalCachedColorPropertyWithAlpha=function(t,e,i){var r=Rn.evalCachedColorProperty(t,i);if(null!=r&&null!=e){var n=Rn.evalCachedProperty(e,i);if(null!=n)return[r[0],r[1],r[2],n]}return r},Rn.parseColor=function(t,e){if(void 0===e&&(e={}),"function"==typeof t&&(t=qn(t,e)),"string"==typeof t)t=Rn.colorForString(t);else if(Array.isArray(t)&&Array.isArray(t[0])){for(var i=0;i<t.length;i++){var r=t[i];"string"==typeof r[1]&&(r[1]=Rn.colorForString(r[1]))}e.zoom&&(t=Yi.interpolate(e.zoom,t))}return Array.isArray(t)?null==(t=t.map((function(t){return t})))[3]&&(t[3]=1):t=[0,0,0,1],t},Rn.calculateOrder=function(t,e){return"function"==typeof t?t=qn(t,e):"string"==typeof t&&(t=e.feature.properties[t]?e.feature.properties[t]:Qn(t)),t},Rn.evalProperty=function(t,e){return"function"==typeof t?qn(t,e):t},U(U.P,"Array",{fill:Dr}),T("fill");var Kn,Wn=function(){function t(t,e,i){this.gl=t,this.workers=e,this._lock_fn="function"==typeof i&&i,this.init()}var e=t.prototype;return e.init=function(){this.requests={},this.feature=null,this.read_delay=0,this.read_delay_timer=null,this.pixels=null,this.fbo=this.gl.createFramebuffer(),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.fbo),this.fbo_size={width:256,height:256};var t=Hr.create(this.gl,"__selection_fbo",{filtering:"nearest"});t.setData(this.fbo_size.width,this.fbo_size.height,null,{filtering:"nearest"}),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,t.texture,0);var e=this.gl.createRenderbuffer();this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,e),this.gl.renderbufferStorage(this.gl.RENDERBUFFER,this.gl.DEPTH_COMPONENT16,this.fbo_size.width,this.fbo_size.height),this.gl.framebufferRenderbuffer(this.gl.FRAMEBUFFER,this.gl.DEPTH_ATTACHMENT,this.gl.RENDERBUFFER,e),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null)},e.destroy=function(){this.gl&&this.fbo&&(this.gl.deleteFramebuffer(this.fbo),this.fbo=null,this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null))},e.bind=function(){var e;this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.fbo),this.gl.viewport(0,0,this.fbo_size.width,this.fbo_size.height),(e=this.gl).clearColor.apply(e,t.defaultColor)},e.getFeatureAt=function(t,e){var i=this,r=e.radius;return!t||t.x<0||t.y<0||t.x>1||t.y>1?Promise.resolve({feature:null,changed:!1}):new Promise((function(e,n){i.selection_request_id=i.selection_request_id+1||0,i.requests[i.selection_request_id]={id:i.selection_request_id,point:t,radius:r,resolve:e,reject:n}}))},e.pendingRequests=function(){return Object.keys(this.requests).length?this.requests:null},e.hasPendingRequests=function(){return null!=this.pendingRequests()},e.clearPendingRequests=function(){for(var t in this.requests){var e=this.requests[t];e.sent||(e.reject({request:e}),delete this.requests[t])}},e.read=function(){var t=this;null!=this.read_delay_timer&&clearTimeout(this.read_delay_timer),this.read_delay_timer=setTimeout((function(){if(!t.locked){var e=t.gl;for(var i in e.bindFramebuffer(e.FRAMEBUFFER,t.fbo),t.requests){var r=t.requests[i];if(!r.sent){var n=void 0,o=255,s=r.point,a=r.radius,l=void 0;if(a){var c=Math.min(t.fbo_size.width,t.fbo_size.height);l={x:Math.min(Math.ceil(2*a.x*t.fbo_size.width),c),y:Math.min(Math.ceil(2*a.y*t.fbo_size.height),c)}}else a={x:0,y:0},l={x:1,y:1};if((null==t.pixels||t.pixels.byteLength<l.x*l.y*4)&&(t.pixels=new Uint8Array(l.x*l.y*4)),t.pixels.fill instanceof Function)t.pixels.fill(0);else for(var u=0;u<t.pixels.length;u++)t.pixels[u]=0;e.readPixels(Math.round((s.x-a.x)*t.fbo_size.width),Math.round((1-s.y-a.y)*t.fbo_size.height),l.x,l.y,e.RGBA,e.UNSIGNED_BYTE,t.pixels);var h=4*(Math.round(l.y/2)*l.x+Math.round(l.x/2)),d=t.pixels[h]+(t.pixels[h+1]<<8)+(t.pixels[h+2]<<16);if(d>0)n=d+(t.pixels[h+3]<<24)>>>0,o=t.pixels[h+3];else{var p=-1>>>0;h=0;for(var f=0;f<l.y;f++)for(var A=0;A<l.x;A++,h+=4)if((d=t.pixels[h]+(t.pixels[h+1]<<8)+(t.pixels[h+2]<<16))>0){var m=(A-l.x/2)*(A-l.x/2)+(f-l.y/2)*(f-l.y/2);m<=p&&(n=d+(t.pixels[h+3]<<24)>>>0,o=t.pixels[h+3],p=m)}}255!==o?null!=t.workers[o]&&Qi.postMessage(t.workers[o],"self.getFeatureSelection",{id:r.id,key:n}).then((function(e){t.finishRead(e)})):t.finishRead({id:r.id}),r.sent=!0}}e.bindFramebuffer(e.FRAMEBUFFER,null)}}),this.read_delay)},e.finishRead=function(t){var e=this.requests[t.id];if(e){var i=t.feature,r=!1;(null!=i&&null==this.feature||null==i&&null!=this.feature||null!=i&&null!=this.feature&&JSON.stringify(i)!==JSON.stringify(this.feature))&&(r=!0),this.feature=i,e.resolve({feature:i,changed:r,request:e}),delete this.requests[t.id]}else Ki("error","FeatureSelection.finishRead(): could not find message",t)},t.makeEntry=function(t){this.map_entry++;var e=255&this.map_entry,i=this.map_entry>>8&255,r=this.map_entry>>16&255,n=this.map_prefix,o=e/255,s=i/255,a=r/255,l=n/255,c=e+(i<<8)+(r<<16)+(n<<24)>>>0;return this.map[c]={color:[o,s,a,l]},this.map_size++,this.tiles[t.key]||(this.tiles[t.key]={entries:[],tile:{key:t.key,coords:t.coords,style_z:t.style_z,source:t.source,generation:t.generation}}),this.tiles[t.key].entries.push(c),this.map[c]},t.makeColor=function(t,e,i){var r=this.makeEntry(e);return r.feature={id:t.id,properties:t.properties,source_name:i.source,source_layer:i.layer,layers:i.layers,tile:this.tiles[e.key].tile},r.color},t.reset=function(t){var e=this;Array.isArray(t)?t.forEach((function(t){return e.clearSource(t)})):(this.tiles={},this.map={},this.map_size=0,this.map_entry=0)},t.clearSource=function(t){for(var e in this.tiles)this.tiles[e].tile.source===t&&this.clearTile(e)},t.clearTile=function(t){var e=this;this.tiles[t]&&(this.tiles[t].entries.forEach((function(t){return delete e.map[t]})),this.map_size-=this.tiles[t].entries.length,delete this.tiles[t])},t.getMapSize=function(){return this.map_size},t.setPrefix=function(t){this.map_prefix=t},pe(t,[{key:"locked",get:function(){return this._lock_fn&&this._lock_fn()||!1}}]),t}();Wn.map={},Wn.tiles={},Wn.map_size=0,Wn.map_entry=0,Wn.map_prefix=0,Wn.defaultColor=[0,0,0,1];var Xn=Kn={};Kn.BYTE=5120,Kn.UNSIGNED_BYTE=5121,Kn.SHORT=5122,Kn.UNSIGNED_SHORT=5123,Kn.INT=5124,Kn.UNSIGNED_INT=5125,Kn.FLOAT=5126,jr("Uint16",2,(function(t){return function(e,i,r){return t(this,e,i,r)}}));var Jn=function(){function t(t,e,i,r,n){n=n||{},this.gl=t,this.vertex_data=e,this.element_data=i,this.vertex_layout=r,this.vertex_buffer=this.gl.createBuffer(),this.buffer_size=this.vertex_data.byteLength,this.draw_mode=n.draw_mode||this.gl.TRIANGLES,this.data_usage=n.data_usage||this.gl.STATIC_DRAW,this.vertices_per_geometry=3,this.uniforms=n.uniforms,this.textures=n.textures,this.retain=n.retain||!1,this.created_at=+new Date,this.fade_in_time=n.fade_in_time||0,this.vertex_count=this.vertex_data.byteLength/this.vertex_layout.stride,this.element_count=0,this.vaos={},this.toggle_element_array=!1,this.element_data?(this.toggle_element_array=!0,this.element_count=this.element_data.length,this.geometry_count=this.element_count/this.vertices_per_geometry,this.element_type=this.element_data.constructor===Uint16Array?this.gl.UNSIGNED_SHORT:this.gl.UNSIGNED_INT,this.element_buffer=this.gl.createBuffer(),this.buffer_size+=this.element_data.byteLength,this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.element_buffer),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,this.element_data,this.data_usage)):this.geometry_count=this.vertex_count/this.vertices_per_geometry,this.upload(),this.retain||(delete this.vertex_data,delete this.element_data),this.valid=!0}var e=t.prototype;return e.render=function(t){if(void 0===t&&(t={}),!this.valid)return!1;var e=t.program||Jr.current;e.use(),this.uniforms&&(e.saveUniforms(this.uniforms),e.setUniforms(this.uniforms,!1));var i=(+new Date-this.created_at)/1e3;return e.uniform("1f","u_visible_time",i),this.bind(e),this.toggle_element_array?this.gl.drawElements(this.draw_mode,this.element_count,this.element_type,0):this.gl.drawArrays(this.draw_mode,0,this.vertex_count),Yr.bind(this.gl,null),this.uniforms&&e.restoreUniforms(this.uniforms),i<this.fade_in_time},e.bind=function(t){var e=this,i=this.vaos[t.id];i?Yr.bind(this.gl,i):this.vaos[t.id]=Yr.create(this.gl,(function(){e.gl.bindBuffer(e.gl.ARRAY_BUFFER,e.vertex_buffer),e.toggle_element_array&&e.gl.bindBuffer(e.gl.ELEMENT_ARRAY_BUFFER,e.element_buffer),e.vertex_layout.enableDynamicAttributes(e.gl,t)})),this.vertex_layout.enableStaticAttributes(this.gl,t)},e.upload=function(){this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertex_buffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,this.vertex_data,this.data_usage)},e.destroy=function(){if(!this.valid)return!1;for(var t in this.valid=!1,this.vaos)Yr.destroy(this.gl,this.vaos[t]);return this.gl.deleteBuffer(this.vertex_buffer),this.vertex_buffer=null,this.element_buffer&&(this.gl.deleteBuffer(this.element_buffer),this.element_buffer=null),delete this.vertex_data,delete this.element_data,this.textures&&this.textures.forEach((function(t){return Hr.release(t)})),!0},t}(),Yn=["emission","ambient","diffuse","specular"],to=function(){function t(t){var e=this;t=t||{},Yn.forEach((function(i){var r=t[i];null!=r&&(r.texture?e[i]={texture:r.texture,mapping:r.mapping||"spheremap",scale:Gr.expandVec3(null!=r.scale?r.scale:1),amount:Gr.expandVec4(null!=r.amount?r.amount:1)}:"number"==typeof r||Array.isArray(r)?e[i]={amount:Gr.expandVec4(r)}:e[i]="string"==typeof r?{amount:Rn.parseColor(r)}:r)})),this.specular&&(this.specular.shininess=t.shininess?parseFloat(t.shininess):.2),null!=t.normal&&(this.normal={texture:t.normal.texture,mapping:t.normal.mapping||"triplanar",scale:Gr.expandVec3(null!=t.normal.scale?t.normal.scale:1),amount:null!=t.normal.amount?t.normal.amount:1})}t.isValid=function(t){return null!=t&&(null!=t.emission||null!=t.ambient||null!=t.diffuse||null!=t.specular)};var e=t.prototype;return e.inject=function(e){var i=this;Yn.forEach((function(t){var r="TANGRAM_MATERIAL_"+t.toUpperCase(),n=r+"_TEXTURE";e.defines[r]=null!=i[t],i[t]&&i[t].texture&&(e.defines[n]=!0,e.defines[n+"_"+i[t].mapping.toUpperCase()]=!0,e.defines["TANGRAM_MATERIAL_TEXTURE_"+i[t].mapping.toUpperCase()]=!0,e.texcoords=e.texcoords||"uv"===i[t].mapping)})),this.normal&&this.normal.texture&&(e.defines.TANGRAM_MATERIAL_NORMAL_TEXTURE=!0,e.defines["TANGRAM_MATERIAL_NORMAL_TEXTURE_"+this.normal.mapping.toUpperCase()]=!0,e.defines["TANGRAM_MATERIAL_TEXTURE_"+this.normal.mapping.toUpperCase()]=!0,e.texcoords=e.texcoords||"uv"===this.normal.mapping),e.replaceShaderBlock(t.block,"/*\n\nDefines globals:\nmaterial\nlight_accumulator_*\n\n*/\n\n\n// MATERIALS\n//\nstruct Material {\n    #ifdef TANGRAM_MATERIAL_EMISSION\n        vec4 emission;\n        #ifdef TANGRAM_MATERIAL_EMISSION_TEXTURE\n            vec3 emissionScale;\n        #endif\n    #endif\n\n    #ifdef TANGRAM_MATERIAL_AMBIENT\n        vec4 ambient;\n        #ifdef TANGRAM_MATERIAL_AMBIENT_TEXTURE\n            vec3 ambientScale;\n        #endif\n    #endif\n\n    #ifdef TANGRAM_MATERIAL_DIFFUSE\n        vec4 diffuse;\n        #ifdef TANGRAM_MATERIAL_DIFFUSE_TEXTURE\n            vec3 diffuseScale;\n        #endif\n    #endif\n\n    #ifdef TANGRAM_MATERIAL_SPECULAR\n        vec4 specular;\n        float shininess;\n        #ifdef TANGRAM_MATERIAL_SPECULAR_TEXTURE\n            vec3 specularScale;\n        #endif\n    #endif\n\n\n    #ifdef TANGRAM_MATERIAL_NORMAL_TEXTURE\n        vec3 normalScale;\n        float normalAmount;\n    #endif\n};\n\n// Note: uniform is copied to a global instance to allow modification\nuniform Material u_material;\nMaterial material;\n\n#ifdef TANGRAM_MATERIAL_EMISSION_TEXTURE\nuniform sampler2D u_material_emission_texture;\n#endif\n\n#ifdef TANGRAM_MATERIAL_AMBIENT_TEXTURE\nuniform sampler2D u_material_ambient_texture;\n#endif\n\n#ifdef TANGRAM_MATERIAL_DIFFUSE_TEXTURE\nuniform sampler2D u_material_diffuse_texture;\n#endif\n\n#ifdef TANGRAM_MATERIAL_SPECULAR_TEXTURE\nuniform sampler2D u_material_specular_texture;\n#endif\n\n#ifdef TANGRAM_MATERIAL_NORMAL_TEXTURE\nuniform sampler2D u_material_normal_texture;\n#endif\n\n// Global light accumulators for each property\nvec4 light_accumulator_ambient = vec4(vec3(0.0), 1.);\nvec4 light_accumulator_diffuse = vec4(vec3(0.0), 1.);\n#ifdef TANGRAM_MATERIAL_SPECULAR\n    vec4 light_accumulator_specular = vec4(vec3(0.0), 1.);\n#endif\n\n\n#ifdef TANGRAM_MATERIAL_TEXTURE_SPHEREMAP\nvec4 getSphereMap (in sampler2D _tex, in vec3 _eyeToPoint, in vec3 _normal, in vec2 _skew) {\n    // Normalized vector from camera to surface\n    vec3 eye = normalize(_eyeToPoint);\n\n    // Adjust for camera skew\n    eye.xy -= _skew;\n    eye = normalize(eye);\n\n    // Reflection of eye off of surface normal\n    vec3 r = reflect(eye, _normal);\n\n    // Map reflected vector onto the surface of a sphere\n    r.z += 1.0;\n    float m = 2. * length(r);\n\n    // Adjust xy to account for spherical shape, and center in middle of texture\n    vec2 uv = r.xy / m + .5;\n\n    // Sample the environment map\n    return texture2D(_tex, uv);\n}\n#endif\n\n\n#ifdef TANGRAM_MATERIAL_TEXTURE_TRIPLANAR\nvec3 getTriPlanarBlend (in vec3 _normal) {\n    vec3 blending = abs(_normal);\n    blending = normalize(max(blending, 0.00001));\n    float b = (blending.x + blending.y + blending.z);\n    return blending / b;\n}\n\nvec4 getTriPlanar (in sampler2D _tex, in vec3 _pos, in vec3 _normal, in vec3 _scale) {\n    vec3 blending = getTriPlanarBlend(_normal);\n    vec4 xaxis = texture2D(_tex, fract(_pos.yz * _scale.x));\n    vec4 yaxis = texture2D(_tex, fract(_pos.xz * _scale.y));\n    vec4 zaxis = texture2D(_tex, fract(_pos.xy * _scale.z));\n    return  xaxis * blending.x + yaxis * blending.y + zaxis * blending.z;\n}\n#endif\n\n\n#ifdef TANGRAM_MATERIAL_TEXTURE_PLANAR\nvec4 getPlanar (in sampler2D _tex, in vec3 _pos, in vec2 _scale) {\n    return texture2D( _tex, fract(_pos.xy * _scale.x) );\n}\n#endif\n\n\n#ifdef TANGRAM_MATERIAL_NORMAL_TEXTURE\nvoid calculateNormal (inout vec3 _normal) {\n    // Get NORMALMAP\n    //------------------------------------------------\n    #ifdef TANGRAM_MATERIAL_NORMAL_TEXTURE_UV\n    _normal += texture2D(u_material_normal_texture, fract(v_texcoord*material.normalScale.xy)).rgb*2.0-1.0;\n    #endif\n\n    #ifdef TANGRAM_MATERIAL_NORMAL_TEXTURE_PLANAR\n    vec3 normalTex = getPlanar(u_material_normal_texture, v_world_position.xyz, material.normalScale.xy).rgb*2.0-1.0;\n    _normal += normalTex;\n    #endif\n\n    #ifdef TANGRAM_MATERIAL_NORMAL_TEXTURE_TRIPLANAR\n    vec3 normalTex = getTriPlanar(u_material_normal_texture, v_world_position.xyz, _normal, material.normalScale).rgb*2.0-1.0;\n    _normal += normalTex;\n    #endif\n\n    _normal = normalize(_normal);\n}\n#endif\n\nvoid calculateMaterial (in vec3 _eyeToPoint, inout vec3 _normal) {\n    // get EMISSION TEXTUREMAP\n    //------------------------------------------------\n    #ifdef TANGRAM_MATERIAL_EMISSION_TEXTURE\n        #ifdef TANGRAM_MATERIAL_EMISSION_TEXTURE_UV\n        material.emission *= texture2D(u_material_emission_texture,v_texcoord);\n        #endif\n\n        #ifdef TANGRAM_MATERIAL_EMISSION_TEXTURE_PLANAR\n        material.emission *= getPlanar(u_material_emission_texture, v_world_position.xyz, material.emissionScale.xy);\n        #endif\n\n        #ifdef TANGRAM_MATERIAL_EMISSION_TEXTURE_TRIPLANAR\n        material.emission *= getTriPlanar(u_material_emission_texture, v_world_position.xyz, _normal, material.emissionScale);\n        #endif\n\n        #ifdef TANGRAM_MATERIAL_EMISSION_TEXTURE_SPHEREMAP\n        material.emission *= getSphereMap(u_material_emission_texture, _eyeToPoint, _normal, u_vanishing_point);\n        #endif\n    #endif\n\n    // get AMBIENT TEXTUREMAP\n    //------------------------------------------------\n    #ifdef TANGRAM_MATERIAL_AMBIENT_TEXTURE\n        #ifdef TANGRAM_MATERIAL_AMBIENT_TEXTURE_UV\n        material.ambient *= texture2D(u_material_ambient_texture,v_texcoord);\n        #endif\n\n        #ifdef TANGRAM_MATERIAL_AMBIENT_TEXTURE_PLANAR\n        material.ambient *= getPlanar(u_material_ambient_texture, v_world_position.xyz, material.ambientScale.xy);\n        #endif\n\n        #ifdef TANGRAM_MATERIAL_AMBIENT_TEXTURE_TRIPLANAR\n        material.ambient *= getTriPlanar(u_material_ambient_texture, v_world_position.xyz, _normal, material.ambientScale);\n        #endif\n\n        #ifdef TANGRAM_MATERIAL_AMBIENT_TEXTURE_SPHEREMAP\n        material.ambient *= getSphereMap(u_material_ambient_texture, _eyeToPoint, _normal, u_vanishing_point);\n        #endif\n    #endif\n\n    // get DIFFUSE TEXTUREMAP\n    //------------------------------------------------\n    #ifdef TANGRAM_MATERIAL_DIFFUSE_TEXTURE\n        #ifdef TANGRAM_MATERIAL_DIFFUSE_TEXTURE_UV\n        material.diffuse *= texture2D(u_material_diffuse_texture,v_texcoord);\n        #endif\n\n        #ifdef TANGRAM_MATERIAL_DIFFUSE_TEXTURE_PLANAR\n        material.diffuse *= getPlanar(u_material_diffuse_texture, v_world_position.xyz, material.diffuseScale.xy);\n        #endif\n\n        #ifdef TANGRAM_MATERIAL_DIFFUSE_TEXTURE_TRIPLANAR\n        material.diffuse *= getTriPlanar(u_material_diffuse_texture, v_world_position.xyz, _normal, material.diffuseScale);\n        #endif\n\n        #ifdef TANGRAM_MATERIAL_DIFFUSE_TEXTURE_SPHEREMAP\n        material.diffuse *= getSphereMap(u_material_diffuse_texture, _eyeToPoint, _normal, u_vanishing_point);\n        #endif\n    #endif\n\n    // get SPECULAR TEXTUREMAP\n    //------------------------------------------------\n    #ifdef TANGRAM_MATERIAL_SPECULAR_TEXTURE\n        #ifdef TANGRAM_MATERIAL_SPECULAR_TEXTURE_UV\n        material.specular *= texture2D(u_material_specular_texture,v_texcoord);\n        #endif\n\n        #ifdef TANGRAM_MATERIAL_SPECULAR_TEXTURE_PLANAR\n        material.specular *= getPlanar(u_material_specular_texture, v_world_position.xyz, material.specularScale.xy);\n        #endif\n\n        #ifdef TANGRAM_MATERIAL_SPECULAR_TEXTURE_TRIPLANAR\n        material.specular *= getTriPlanar(u_material_specular_texture, v_world_position.xyz, _normal, material.specularScale);\n        #endif\n\n        #ifdef TANGRAM_MATERIAL_SPECULAR_TEXTURE_SPHEREMAP\n        material.specular *= getSphereMap(u_material_specular_texture, _eyeToPoint, _normal, u_vanishing_point);\n        #endif\n    #endif\n}\n","Material"),e.addShaderBlock("setup","\nmaterial = u_material;\n","Material")},e.setupProgram=function(t){var e=this;Yn.forEach((function(i){e[i]&&(e[i].texture?(t.setTextureUniform("u_material_"+i+"_texture",e[i].texture),t.uniform("3fv","u_material."+i+"Scale",e[i].scale),t.uniform("4fv","u_material."+i,e[i].amount)):e[i].amount&&t.uniform("4fv","u_material."+i,e[i].amount))})),this.specular&&t.uniform("1f","u_material.shininess",this.specular.shininess),this.normal&&this.normal.texture&&(t.setTextureUniform("u_material_normal_texture",this.normal.texture),t.uniform("3fv","u_material.normalScale",this.normal.scale),t.uniform("1f","u_material.normalAmount",this.normal.amount))},t}();to.block="material";var eo,io=/"/g,ro=function(t,e,i,r){var n=String(M(t)),o="<"+e;return""!==i&&(o+=" "+i+'="'+String(r).replace(io,"&quot;")+'"'),o+">"+n+"</"+e+">"},no=function(t,e){var i={};i[t]=e(ro),U(U.P+U.F*h((function(){var e=""[t]('"');return e!==e.toLowerCase()||e.split('"').length>3})),"String",i)};no("sub",(function(t){return function(){return t(this,"sub","","")}}));var oo=eo={};eo.copy=function(t){for(var e=[],i=t.length,r=0;r<i;r++)e[r]=t[r];return e},eo.neg=function(t){for(var e=[],i=t.length,r=0;r<i;r++)e[r]=-t[r];return e},eo.add=function(t,e){for(var i=[],r=Math.min(t.length,e.length),n=0;n<r;n++)i[n]=t[n]+e[n];return i},eo.sub=function(t,e){for(var i=[],r=Math.min(t.length,e.length),n=0;n<r;n++)i[n]=t[n]-e[n];return i},eo.signed_area=function(t,e,i){return(e[0]-t[0])*(i[1]-t[1])-(i[0]-t[0])*(e[1]-t[1])},eo.mult=function(t,e){var i,r=[],n=t.length;if("number"==typeof e)for(i=0;i<n;i++)r[i]=t[i]*e;else for(n=Math.min(t.length,e.length),i=0;i<n;i++)r[i]=t[i]*e[i];return r},eo.div=function(t,e){var i,r=[];if("number"==typeof e)for(i=0;i<t.length;i++)r[i]=t[i]/e;else{var n=Math.min(t.length,e.length);for(i=0;i<n;i++)r[i]=t[i]/e[i]}return r},eo.perp=function(t,e){return[e[1]-t[1],t[0]-e[0]]},eo.rot=function(t,e){var i=Math.cos(e),r=Math.sin(e);return[t[0]*i-t[1]*r,t[0]*r+t[1]*i]},eo.angle=function(t){var e=t[0],i=t[1];return Math.atan2(i,e)},eo.angleBetween=function(t,e){var i=eo.dot(eo.normalize(eo.copy(t)),eo.normalize(eo.copy(e)));return i>1&&(i=1),Math.acos(i)},eo.isEqual=function(t,e){for(var i=t.length,r=0;r<i;r++)if(t[r]!==e[r])return!1;return!0},eo.lengthSq=function(t){return 2===t.length?t[0]*t[0]+t[1]*t[1]:t.length>=3?t[0]*t[0]+t[1]*t[1]+t[2]*t[2]:0},eo.length=function(t){return Math.sqrt(eo.lengthSq(t))},eo.normalize=function(t){var e;if(2===t.length){if(1==(e=t[0]*t[0]+t[1]*t[1]))return t;0!==(e=Math.sqrt(e))?(t[0]/=e,t[1]/=e):(t[0]=0,t[1]=0)}else if(t.length>=3){if(1==(e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2]))return t;0!==(e=Math.sqrt(e))?(t[0]/=e,t[1]/=e,t[2]/=e):(t[0]=0,t[1]=0,t[2]=0)}return t},eo.cross=function(t,e){return 2===t.length?t[0]*e[1]-t[1]*e[0]:3===t.length?[t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0]]:void 0},eo.dot=function(t,e){for(var i=0,r=Math.min(t.length,e.length),n=0;n<r;n++)i+=t[n]*e[n];return i};var so=function(){function t(t,e){this.name=e.name,this.view=t,null==e.ambient||"number"==typeof e.ambient?this.ambient=Gr.expandVec3(e.ambient||0):this.ambient=Rn.parseColor(e.ambient).slice(0,3),null==e.diffuse||"number"==typeof e.diffuse?this.diffuse=Gr.expandVec3(null!=e.diffuse?e.diffuse:1):this.diffuse=Rn.parseColor(e.diffuse).slice(0,3),null==e.specular||"number"==typeof e.specular?this.specular=Gr.expandVec3(e.specular||0):this.specular=Rn.parseColor(e.specular).slice(0,3)}t.create=function(e,i){if(t.types[i.type])return new t.types[i.type](e,i)},t.setMode=function(e,i){!0===e&&(e="fragment"),e=t.enabled&&(null!=e?e:"fragment"),i.defines.TANGRAM_LIGHTING_FRAGMENT="fragment"===e,i.defines.TANGRAM_LIGHTING_VERTEX="vertex"===e},t.inject=function(e){if(Jr.removeBlock(t.block),t.enabled){var i="";if(e&&Object.keys(e).length>0){var r={};for(var n in e)r[e[n].type]=!0;for(var o in r)t.types[o].inject();for(var s in e)e[s].inject(),i+="calculateLight("+s+", _eyeToPoint, _normal);\n"}var a="\n            vec4 calculateLighting(in vec3 _eyeToPoint, in vec3 _normal, in vec4 _color) {\n\n                // Do initial material calculations over normal, emission, ambient, diffuse and specular values\n                calculateMaterial(_eyeToPoint,_normal);\n\n                // Un roll the loop of individual ligths to calculate\n                "+i+"\n\n                //  Final light intensity calculation\n                vec4 color = vec4(vec3(0.), _color.a); // start with vertex color alpha\n\n                #ifdef TANGRAM_MATERIAL_EMISSION\n                    color.rgb = material.emission.rgb;\n                    color.a *= material.emission.a;\n                #endif\n\n                #ifdef TANGRAM_MATERIAL_AMBIENT\n                    color.rgb += light_accumulator_ambient.rgb * _color.rgb * material.ambient.rgb;\n                    color.a *= material.ambient.a;\n                #else\n                    #ifdef TANGRAM_MATERIAL_DIFFUSE\n                        color.rgb += light_accumulator_ambient.rgb * _color.rgb * material.diffuse.rgb;\n                    #endif\n                #endif\n\n                #ifdef TANGRAM_MATERIAL_DIFFUSE\n                    color.rgb += light_accumulator_diffuse.rgb * _color.rgb * material.diffuse.rgb;\n                    color.a *= material.diffuse.a;\n                #endif\n\n                #ifdef TANGRAM_MATERIAL_SPECULAR\n                    color.rgb += light_accumulator_specular.rgb * material.specular.rgb;\n                    color.a *= material.specular.a;\n                #endif\n\n                // Clamp final color\n                color = clamp(color, 0.0, 1.0);\n\n                return color;\n            }";Jr.addBlock(t.block,a)}};var e=t.prototype;return e.inject=function(){var e="\n            uniform "+this.struct_name+" u_"+this.name+";\n            "+this.struct_name+" "+this.name+";\n            ",i="\n            "+this.name+" = u_"+this.name+";\n\n        ";Jr.addBlock(t.block,e),Jr.addBlock("setup",i)},e.update=function(){},e.setupProgram=function(t){t.uniform("3fv","u_"+this.name+".ambient",this.ambient),t.uniform("3fv","u_"+this.name+".diffuse",this.diffuse),t.uniform("3fv","u_"+this.name+".specular",this.specular)},t}();so.types={},so.block="lighting",so.enabled=!0;var ao=function(t){function e(e,i){var r;return(r=t.call(this,e,i)||this).type="ambient",r.struct_name="AmbientLight",r}return fe(e,t),e.inject=function(){Jr.addBlock(so.block,"/*\n\nExpected globals:\nlight_accumulator_*\n\n*/\n\nstruct AmbientLight {\n    vec3 ambient;\n};\n\nvoid calculateLight(in AmbientLight _light, in vec3 _eyeToPoint, in vec3 _normal) {\n    light_accumulator_ambient.rgb += _light.ambient;\n}\n")},e.prototype.setupProgram=function(t){t.uniform("3fv","u_"+this.name+".ambient",this.ambient)},e}(so);so.types.ambient=ao;var lo=function(t){function e(e,i){var r;if((r=t.call(this,e,i)||this).type="directional",r.struct_name="DirectionalLight",i.direction)r._direction=i.direction;else{var n=Math.sin(60*Math.PI/180);r._direction=[Math.cos(135*Math.PI/180)*n,Math.sin(135*Math.PI/180)*n,-.5],null==i.ambient&&(r.ambient=Gr.expandVec3(.5))}return r.direction=r._direction.map(parseFloat),r}return fe(e,t),e.inject=function(){Jr.addBlock(so.block,"/*\n\nExpected globals:\nmaterial\nlight_accumulator_*\n\n*/\n\nstruct DirectionalLight {\n    vec3 ambient;\n    vec3 diffuse;\n    vec3 specular;\n    vec3 direction;\n};\n\nvoid calculateLight(in DirectionalLight _light, in vec3 _eyeToPoint, in vec3 _normal) {\n\n    light_accumulator_ambient.rgb += _light.ambient;\n\n    float nDotVP = clamp(dot(_normal, -_light.direction), 0.0, 1.0);\n\n    #ifdef TANGRAM_MATERIAL_DIFFUSE\n        light_accumulator_diffuse.rgb += _light.diffuse * nDotVP;\n    #endif\n\n    #ifdef TANGRAM_MATERIAL_SPECULAR\n        float pf = 0.0;\n        if (nDotVP > 0.0) {\n            vec3 reflectVector = reflect(_light.direction, _normal);\n            float eyeDotR = max(dot(normalize(_eyeToPoint), reflectVector), 0.0);\n            pf = pow(eyeDotR, material.shininess);\n        }\n        light_accumulator_specular.rgb += _light.specular * pf;\n    #endif\n}\n")},e.prototype.setupProgram=function(e){t.prototype.setupProgram.call(this,e),e.uniform("3fv","u_"+this.name+".direction",this.direction)},pe(e,[{key:"direction",get:function(){return this._direction},set:function(t){this._direction=oo.normalize(oo.copy(t))}}]),e}(so);so.types.directional=lo;var co=function(t){function e(e,i){var r;return(r=t.call(this,e,i)||this).type="point",r.struct_name="PointLight",r.position=i.position||[0,0,"100px"],r.position_eye=[],r.origin=i.origin||"ground",r.attenuation=isNaN(parseFloat(i.attenuation))?0:parseFloat(i.attenuation),i.radius?Array.isArray(i.radius)&&2===i.radius.length?r.radius=i.radius:r.radius=[null,i.radius]:r.radius=null,r}fe(e,t),e.inject=function(){Jr.addBlock(so.block,"/*\n\nExpected globals:\nmaterial\nlight_accumulator_*\n\n*/\n\nstruct PointLight {\n    vec3 ambient;\n    vec3 diffuse;\n    vec3 specular;\n    vec4 position;\n\n#ifdef TANGRAM_POINTLIGHT_ATTENUATION_EXPONENT\n    float attenuationExponent;\n#endif\n\n#ifdef TANGRAM_POINTLIGHT_ATTENUATION_INNER_RADIUS\n    float innerRadius;\n#endif\n\n#ifdef TANGRAM_POINTLIGHT_ATTENUATION_OUTER_RADIUS\n    float outerRadius;\n#endif\n};\n\nvoid calculateLight(in PointLight _light, in vec3 _eyeToPoint, in vec3 _normal) {\n\n    float dist = length(_light.position.xyz - _eyeToPoint);\n\n    // Compute vector from surface to light position\n    vec3 VP = (_light.position.xyz - _eyeToPoint) / dist;\n\n    // Normalize the vector from surface to light position\n    float nDotVP = clamp(dot(VP, _normal), 0.0, 1.0);\n\n    // Attenuation defaults\n    float attenuation = 1.0;\n    #ifdef TANGRAM_POINTLIGHT_ATTENUATION_EXPONENT\n        float Rin = 1.0;\n        float e = _light.attenuationExponent;\n\n        #ifdef TANGRAM_POINTLIGHT_ATTENUATION_INNER_RADIUS\n            Rin = _light.innerRadius;\n        #endif\n\n        #ifdef TANGRAM_POINTLIGHT_ATTENUATION_OUTER_RADIUS\n            float Rdiff = _light.outerRadius-Rin;\n            float d = clamp(max(0.0,dist-Rin)/Rdiff, 0.0, 1.0);\n            attenuation = 1.0-(pow(d,e));\n        #else\n            // If no outer is provide behaves like:\n            // https://imdoingitwrong.wordpress.com/2011/01/31/light-attenuation/\n            float d = max(0.0,dist-Rin)/Rin+1.0;\n            attenuation = clamp(1.0/(pow(d,e)), 0.0, 1.0);\n        #endif\n    #else\n        float Rin = 0.0;\n\n        #ifdef TANGRAM_POINTLIGHT_ATTENUATION_INNER_RADIUS\n            Rin = _light.innerRadius;\n            #ifdef TANGRAM_POINTLIGHT_ATTENUATION_OUTER_RADIUS\n                float Rdiff = _light.outerRadius-Rin;\n                float d = clamp(max(0.0,dist-Rin)/Rdiff, 0.0, 1.0);\n                attenuation = 1.0-d*d;\n            #else\n                // If no outer is provide behaves like:\n                // https://imdoingitwrong.wordpress.com/2011/01/31/light-attenuation/\n                float d = max(0.0,dist-Rin)/Rin+1.0;\n                attenuation = clamp(1.0/d, 0.0, 1.0);\n            #endif\n        #else\n            #ifdef TANGRAM_POINTLIGHT_ATTENUATION_OUTER_RADIUS\n                float d = clamp(dist/_light.outerRadius, 0.0, 1.0);\n                attenuation = 1.0-d*d;\n            #else\n                attenuation = 1.0;\n            #endif\n        #endif\n    #endif\n\n    // Computer accumulators\n    light_accumulator_ambient.rgb += _light.ambient * attenuation;\n\n    #ifdef TANGRAM_MATERIAL_DIFFUSE\n        light_accumulator_diffuse.rgb += _light.diffuse * nDotVP * attenuation;\n    #endif\n\n    #ifdef TANGRAM_MATERIAL_SPECULAR\n        float pf = 0.0; // power factor for shiny speculars\n        if (nDotVP > 0.0) {\n            vec3 reflectVector = reflect(-VP, _normal);\n            float eyeDotR = max(0.0, dot(-normalize(_eyeToPoint), reflectVector));\n            pf = pow(eyeDotR, material.shininess);\n        }\n\n        light_accumulator_specular.rgb += _light.specular * pf * attenuation;\n    #endif\n}\n")};var i=e.prototype;return i.inject=function(){t.prototype.inject.call(this),Jr.defines.TANGRAM_POINTLIGHT_ATTENUATION_EXPONENT=0!==this.attenuation,Jr.defines.TANGRAM_POINTLIGHT_ATTENUATION_INNER_RADIUS=null!=this.radius&&null!=this.radius[0],Jr.defines.TANGRAM_POINTLIGHT_ATTENUATION_OUTER_RADIUS=null!=this.radius},i.update=function(){this.updateEyePosition()},i.updateEyePosition=function(){if("world"===this.origin){var t=an.latLngToMeters([].concat(this.position));this.position_eye[0]=t[0]-this.view.camera.position_meters[0],this.position_eye[1]=t[1]-this.view.camera.position_meters[1],this.position_eye[2]=Rn.convertUnits(this.position[2],{zoom:this.view.zoom,meters_per_pixel:an.metersPerPixel(this.view.zoom)}),this.position_eye[2]=this.position_eye[2]-this.view.camera.position_meters[2]}else"ground"!==this.origin&&"camera"!==this.origin||(this.position_eye=Rn.convertUnits(this.position,{zoom:this.view.zoom,meters_per_pixel:an.metersPerPixel(this.view.zoom)}),"ground"===this.origin&&(this.position_eye[2]=this.position_eye[2]-this.view.camera.position_meters[2]));this.position_eye[3]=1},i.setupProgram=function(e){t.prototype.setupProgram.call(this,e),e.uniform("4fv","u_"+this.name+".position",this.position_eye),Jr.defines.TANGRAM_POINTLIGHT_ATTENUATION_EXPONENT&&e.uniform("1f","u_"+this.name+".attenuationExponent",this.attenuation),Jr.defines.TANGRAM_POINTLIGHT_ATTENUATION_INNER_RADIUS&&e.uniform("1f","u_"+this.name+".innerRadius",Rn.convertUnits(this.radius[0],{zoom:this.view.zoom,meters_per_pixel:an.metersPerPixel(this.view.zoom)})),Jr.defines.TANGRAM_POINTLIGHT_ATTENUATION_OUTER_RADIUS&&e.uniform("1f","u_"+this.name+".outerRadius",Rn.convertUnits(this.radius[1],{zoom:this.view.zoom,meters_per_pixel:an.metersPerPixel(this.view.zoom)}))},e}(so);so.types.point=co;var uo=function(t){function e(e,i){var r;return(r=t.call(this,e,i)||this).type="spotlight",r.struct_name="SpotLight",r.direction=r._direction=(i.direction||[0,0,-1]).map(parseFloat),r.exponent=i.exponent?parseFloat(i.exponent):.2,r.angle=i.angle?parseFloat(i.angle):20,r}return fe(e,t),e.inject=function(){Jr.addBlock(so.block,"/*\n\nExpected globals:\nmaterial\nlight_accumulator_*\n\n*/\n\nstruct SpotLight {\n    vec3 ambient;\n    vec3 diffuse;\n    vec3 specular;\n    vec4 position;\n\n#ifdef TANGRAM_POINTLIGHT_ATTENUATION_EXPONENT\n    float attenuationExponent;\n#endif\n\n#ifdef TANGRAM_POINTLIGHT_ATTENUATION_INNER_RADIUS\n    float innerRadius;\n#endif\n\n#ifdef TANGRAM_POINTLIGHT_ATTENUATION_OUTER_RADIUS\n    float outerRadius;\n#endif\n\n    vec3 direction;\n    float spotCosCutoff;\n    float spotExponent;\n};\n\nvoid calculateLight(in SpotLight _light, in vec3 _eyeToPoint, in vec3 _normal) {\n\n    float dist = length(_light.position.xyz - _eyeToPoint);\n\n    // Compute vector from surface to light position\n    vec3 VP = (_light.position.xyz - _eyeToPoint) / dist;\n\n    // normal . light direction\n    float nDotVP = clamp(dot(_normal, VP), 0.0, 1.0);\n\n    // Attenuation defaults\n    float attenuation = 1.0;\n    #ifdef TANGRAM_POINTLIGHT_ATTENUATION_EXPONENT\n        float Rin = 1.0;\n        float e = _light.attenuationExponent;\n\n        #ifdef TANGRAM_POINTLIGHT_ATTENUATION_INNER_RADIUS\n            Rin = _light.innerRadius;\n        #endif\n\n        #ifdef TANGRAM_POINTLIGHT_ATTENUATION_OUTER_RADIUS\n            float Rdiff = _light.outerRadius-Rin;\n            float d = clamp(max(0.0,dist-Rin)/Rdiff, 0.0, 1.0);\n            attenuation = 1.0-(pow(d,e));\n        #else\n            // If no outer is provide behaves like:\n            // https://imdoingitwrong.wordpress.com/2011/01/31/light-attenuation/\n            float d = max(0.0,dist-Rin)/Rin+1.0;\n            attenuation = clamp(1.0/(pow(d,e)), 0.0, 1.0);\n        #endif\n    #else\n        float Rin = 0.0;\n\n        #ifdef TANGRAM_POINTLIGHT_ATTENUATION_INNER_RADIUS\n            Rin = _light.innerRadius;\n            #ifdef TANGRAM_POINTLIGHT_ATTENUATION_OUTER_RADIUS\n                float Rdiff = _light.outerRadius-Rin;\n                float d = clamp(max(0.0,dist-Rin)/Rdiff, 0.0, 1.0);\n                attenuation = 1.0-d*d;\n            #else\n                // If no outer is provide behaves like:\n                // https://imdoingitwrong.wordpress.com/2011/01/31/light-attenuation/\n                float d = max(0.0,dist-Rin)/Rin+1.0;\n                attenuation = clamp(1.0/d, 0.0, 1.0);\n            #endif\n        #else\n            #ifdef TANGRAM_POINTLIGHT_ATTENUATION_OUTER_RADIUS\n                float d = clamp(dist/_light.outerRadius, 0.0, 1.0);\n                attenuation = 1.0-d*d;\n            #else\n                attenuation = 1.0;\n            #endif\n        #endif\n    #endif\n\n    // spotlight attenuation factor\n    float spotAttenuation = 0.0;\n\n    // See if point on surface is inside cone of illumination\n    float spotDot = clamp(dot(-VP, _light.direction), 0.0, 1.0);\n\n    if (spotDot >= _light.spotCosCutoff) {\n        spotAttenuation = pow(spotDot, _light.spotExponent);\n    }\n\n    light_accumulator_ambient.rgb += _light.ambient * attenuation * spotAttenuation;\n\n    #ifdef TANGRAM_MATERIAL_DIFFUSE\n        light_accumulator_diffuse.rgb += _light.diffuse * nDotVP * attenuation * spotAttenuation;\n    #endif\n\n    #ifdef TANGRAM_MATERIAL_SPECULAR\n        // Power factor for shiny speculars\n        float pf = 0.0;\n        if (nDotVP > 0.0) {\n            vec3 reflectVector = reflect(-VP, _normal);\n            float eyeDotR = max(dot(-normalize(_eyeToPoint), reflectVector), 0.0);\n            pf = pow(eyeDotR, material.shininess);\n        }\n        light_accumulator_specular.rgb += _light.specular * pf * attenuation * spotAttenuation;\n    #endif\n}\n")},e.prototype.setupProgram=function(e){t.prototype.setupProgram.call(this,e),e.uniform("3fv","u_"+this.name+".direction",this.direction),e.uniform("1f","u_"+this.name+".spotCosCutoff",Math.cos(3.14159*this.angle/180)),e.uniform("1f","u_"+this.name+".spotExponent",this.exponent)},pe(e,[{key:"direction",get:function(){return this._direction},set:function(t){this._direction=oo.normalize(oo.copy(t))}}]),e}(co);so.types.spotlight=uo,U(U.S,"Math",{log2:function(t){return Math.log(t)/Math.LN2}});var ho=function(t){function e(e){var i;return(i=t.call(this)||this).name="MethodNotImplemented",i.message="Method "+e+" must be implemented in subclass",i}return fe(e,t),e}(_e(Error)),po=function(){function t(t,e){var i=this;this.validate(t),this.config=t,this.sources=e,this.id=t.id,this.name=t.name,this.pad_scale=t.pad_scale||1e-5,this.default_winding=null,this.rasters=[],Array.isArray(t.rasters)&&t.rasters.forEach((function(t){-1===i.rasters.indexOf(t)&&i.rasters.push(t)})),this.preprocess=t.preprocess,"function"==typeof this.preprocess&&this.preprocess.bind(this),this.transform=t.transform,"function"==typeof this.transform&&this.transform.bind(this),this.extra_data=t.extra_data,this.scripts=t.scripts,this.setZooms(t),this.zoom_offset=null!=t.zoom_offset?t.zoom_offset:0,this.zoom_offset<0&&(Ki({level:"warn",once:!0},"Data source '"+this.name+"' zoom_offset must not be negative  setting to 0."),this.zoom_offset=0),this.setTileSize(t.tile_size),this.min_display_zoom=Math.max(t.min_display_zoom||0,this.zooms[0]),this.max_display_zoom=null!=t.max_display_zoom?t.max_display_zoom:null}t.register=function(e,i){e&&i&&(t.types[e]=i)},t.create=function(e,i){if("function"==typeof t.types[e.type]){var r=t.types[e.type](e);if(r)return new r(e,i)}},t.tileLayoutChanged=function(t,e){if(!t||!e)return!0;var i=["max_zoom","zooms","min_display_zoom","max_display_zoom","bounds","tile_size","zoom_offset"],r=Er(t.config,i),n=Er(e.config,i);return JSON.stringify(r)!==JSON.stringify(n)},t.projectData=function(t){var e=+new Date;for(var i in t.layers)for(var r=t.layers[i].features.length,n=0;n<r;n++){var o=t.layers[i].features[n];an.transformGeometry(o.geometry,this.projectCoord)}void 0!==t.debug&&(t.debug.projection=+new Date-e)},t.projectCoord=function(t){an.latLngToMeters(t)},t.scaleData=function(t,e){var i=e.coords.z,r=e.min,n=an.unitsPerMeter(i);for(var o in t.layers)for(var s=t.layers[o].features.length,a=0;a<s;a++){var l=t.layers[o].features[a];an.transformGeometry(l.geometry,(function(t){t[0]=(t[0]-r.x)*n,t[1]=(t[1]-r.y)*n*-1}))}};var e=t.prototype;return e.load=function(t){var e=this;return t.source_data={},t.source_data.layers={},t.pad_scale=this.pad_scale,t.rasters=[].concat(this.rasters),this._load(t).then((function(t){for(var i in t.source_data.layers){var r=t.source_data.layers[i];r&&r.features&&r.features.forEach((function(t){an.transformGeometry(t.geometry,(function(t){t[1]=-t[1],e.pad_scale&&(t[0]=Math.round(t[0]*(1+e.pad_scale)-an.tile_scale*e.pad_scale/2),t[1]=Math.round(t[1]*(1+e.pad_scale)-an.tile_scale*e.pad_scale/2))})),e.updateDefaultWinding(t.geometry)}))}return t.default_winding=e.default_winding||"CCW",t}))},e._load=function(){throw new ho("_load")},e.copyTileData=function(t,e){return Ki("trace","Copy tile data from "+t.key+" to "+e.key),e.source_data={layers:t.source_data.layers},e.rasters=[].concat(t.rasters),e.pad_scale=t.pad_scale,e.default_winding=t.default_winding,e},e.setZooms=function(t){var e=t.max_zoom,i=t.zooms;if(this.max_zoom=null!=e?e:an.default_source_max_zoom,Array.isArray(i))this.zooms=i,this.max_zoom=this.zooms[this.zooms.length-1];else{this.zooms=[];for(var r=0;r<=this.max_zoom;r++)this.zooms[r]=r}},e.setTileSize=function(t){this.tile_size=t||256,("number"!=typeof this.tile_size||this.tile_size<256||!Yi.isPowerOf2(this.tile_size))&&(Ki({level:"warn",once:!0},"Data source '"+this.name+"': 'tile_size' parameter must be a number that is a power of 2 greater than or equal to 256, but was '"+t+"'"),this.tile_size=256),this.zoom_bias=Math.log2(this.tile_size)-8+this.zoom_offset},e.updateDefaultWinding=function(t){return null==this.default_winding&&("Polygon"===t.type?this.default_winding=an.ringWinding(t.coordinates[0]):"MultiPolygon"===t.type&&(this.default_winding=an.ringWinding(t.coordinates[0][0]))),this.default_winding},e.includesTile=function(t,e){if(t.z<this.min_display_zoom||null!=this.max_display_zoom&&e>this.max_display_zoom)return!1;for(var i=0;i<this.rasters.length;i++){var r=this.rasters[i];if(this.sources[r]&&this.sources[r]!==this&&!this.sources[r].includesTile(t,t.z))return!1}return!0},e.validate=function(){},t}();po.types={};var fo=0,Ao=function(t){function e(e,i){var r;(r=t.call(this,e,i)||this).response_type="";var n=function(t,e){if(!e||0===Object.keys(e).length)return[t,[]];var i=t.indexOf("?"),r=t.indexOf("#"),n="";r>-1&&(n=t.slice(r),t=t.slice(0,r)),-1===i&&(i=t.length,t+="?"),i++;var o="",s=[];for(var a in e)""===wr(a,t)?o+=a+"="+e[a]+"&":s.push([a,e[a]]);return[t=t.slice(0,i)+o+t.slice(i)+n,s]}(e.url,e.url_params),o=n[0],s=n[1];return r.url=o,s.forEach((function(t){var i=t[0],n=t[1];Ki({level:"warn",once:!0},"Data source '"+r.name+"': parameter '"+i+"' already present in URL '"+e.url+"', skipping value '"+i+"="+n+"' specified in 'url_params'")})),e.request_headers&&"object"==typeof e.request_headers&&(r.request_headers=e.request_headers),r}fe(e,t);var i=e.prototype;return i._load=function(t){var e=this,i=this.formatURL(this.url,t),r=t.source_data;return r.url=i,t.debug=t.debug||{},t.debug.network=+new Date,new Promise((function(n){var o=fo+++"-"+i,s=Yi.io(i,6e4,e.response_type,"GET",e.request_headers,o);r.request_id=o,r.error=null,s.then((function(i){var o=i.body;t.debug.response_size=o&&(o.length||o.byteLength),t.debug.network=+new Date-t.debug.network,t.debug.parsing=+new Date,null!=o&&"function"==typeof e.preprocess&&(o=e.preprocess(o)),(o=o instanceof Promise?o:Promise.resolve(o)).then((function(i){null!=i?e.parseSourceData(t,r,i):r.layers={},t.debug.parsing=+new Date-t.debug.parsing,n(t)}))})).catch((function(e){r.error=e.stack,n(t)}))}))},i.validate=function(t){if("string"!=typeof t.url)throw Error("Network data source must provide a string `url` property")},i.formatURL=function(){throw new ho("formatURL")},i.parseSourceData=function(){throw new ho("parseSourceData")},e}(po),mo=function(t){function e(e,i){var r;return(r=t.call(this,e,i)||this).tiled=!0,r.bounds=r.parseBounds(e),r.builds_geometry_tiles=!1,r.tms=!0===e.tms,r.url&&r.url.search("{s}")>-1&&(Array.isArray(e.url_subdomains)&&e.url_subdomains.length>0?(r.url_subdomains=e.url_subdomains,r.next_url_subdomain=0):Ki({level:"warn",once:!0},"Data source '"+r.name+"': source URL includes '{s}' subdomain marker ('"+r.url+"'), but no subdomains were specified in 'url_subdomains' parameter")),r.url&&r.url.search("{r}")>-1&&(Array.isArray(e.url_density_scales)&&e.url_density_scales.length>0?r.url_density_scales=e.url_density_scales:r.url_density_scales=[1,2]),r}fe(e,t);var i=e.prototype;return i.parseBounds=function(t){if(Array.isArray(t.bounds)&&4===t.bounds.length){var e=t.bounds,i=e[0],r=e[1],n=e[2],o=e[3];return{latlng:[].concat(t.bounds),meters:{min:an.latLngToMeters([i,o]),max:an.latLngToMeters([n,r])},tiles:{min:{},max:{}}}}},i.checkBounds=function(t,e){if(e){t=an.wrapTile(t);var i=e.tiles.min[t.z];i||(i=e.tiles.min[t.z]=an.tileForMeters(e.meters.min,t.z));var r=e.tiles.max[t.z];if(r||(r=e.tiles.max[t.z]=an.tileForMeters(e.meters.max,t.z)),t.y<i.y||t.y>r.y)return!1;if(i.x<=r.x){if(t.x<i.x||t.x>r.x)return!1}else if(t.x>r.x&&t.x<i.x)return!1}return!0},i.includesTile=function(e,i){return!!t.prototype.includesTile.call(this,e,i)&&!!this.checkBounds(e,this.bounds)},i.formatURL=function(t,e){var i=an.wrapTile(e.coords,{x:!0});this.tms&&(i.y=Math.pow(2,i.z)-1-i.y);var r=t.replace("{x}",i.x).replace("{y}",i.y).replace("{z}",i.z).replace("{r}",this.getDensityModifier()).replace("{q}",this.toQuadKey(i));return null!=this.url_subdomains&&(r=r.replace("{s}",this.url_subdomains[this.next_url_subdomain]),this.next_url_subdomain=(this.next_url_subdomain+1)%this.url_subdomains.length),r},i.getDensityModifier=function(){if(this.url_density_scales){var t=Yi.device_pixel_ratio,e=this.url_density_scales.filter((function(e){return t>=e})).reverse()[0];if((e=null!=e?e:this.url_density_scales[0])>1)return"@"+e+"x"}return""},i.toQuadKey=function(t){for(var e=t.x,i=t.y,r="",n=t.z;n>0;n--){var o=0,s=1<<n-1;0!=(e&s)&&o++,0!=(i&s)&&(o+=2),r+=o.toString()}return r},e.urlHasTilePattern=function(t){return t&&(t.search("{x}")>-1&&t.search("{y}")>-1&&t.search("{z}")>-1||t.search("{q}")>-1)},e}(Ao),go={coord:function(t){return{x:t.x,y:t.y,z:t.z,key:this.coordKey(t)}},coordKey:function(t){return t.x+"/"+t.y+"/"+t.z},key:function(t,e,i){if(!(t.y<0||t.y>=1<<t.z||t.z<0))return[e.name,t.x,t.y,t.z,i].join("/")},normalizedKey:function(t,e,i){return this.key(this.normalizedCoord(t,e),e,i)},normalizedCoord:function(t,e){return e.zoom_bias&&(t=this.coordAtZoom(t,Math.max(t.z-e.zoom_bias,e.zooms[0]))),this.coordForTileZooms(t,e.zooms)},coordAtZoom:function(t,e){var i=t.x,r=t.y,n=t.z;if(n!==(e=Math.max(0,e))){var o=Math.pow(2,n-e);i=Math.floor(i/o),r=Math.floor(r/o),n=e}return this.coord({x:i,y:r,z:n})},coordForTileZooms:function(t,e){var i=t.x,r=t.y,n=t.z,o=this.findZoomInRange(n,e);return o!==n?this.coordAtZoom({x:i,y:r,z:n},o):this.coord({x:i,y:r,z:n})},findZoomInRange:function(t,e){return e.filter((function(e){return t>=e})).reverse()[0]||e[0]},isDescendant:function(t,e){if(e.z>t.z){var i=this.coordAtZoom(e,t.z),r=i.x,n=i.y;return t.x===r&&t.y===n}return!1},parent:function(t){var e=t.coords,i=t.source,r=t.style_z;if(r>0){r--;var n=Math.max(r-i.zoom_bias,i.zooms[0]),o=this.coordForTileZooms(this.coordAtZoom(e,n),i.zooms);return o.z>r?null:{key:this.key(o,i,r),coords:o,style_z:r,source:i}}},children:function(t,e){var i=t.coords,r=t.source,n=t.style_z;void 0===e&&(e={}),n++;var o=this.coordForTileZooms(this.coordAtZoom(i,n-r.zoom_bias),r.zooms);if(o.z===i.z)return[{key:this.key(o,r,n),coords:o,style_z:n,source:r}];var s=this.key(o,r,n);if(e[r.id]=e[r.id]||{},null==e[r.id][s]){for(var a=Math.pow(2,o.z-i.z),l=i.x*a,c=i.y*a,u=[],h=l;h<l+a;h++)for(var d=c;d<c+a;d++){var p=this.coord({x:h,y:d,z:o.z});u.push({key:this.key(p,r,n),coords:p,style_z:n,source:r})}e[r.id][s]=u}return e[r.id][s]}},_o=function(t){function e(e,i){var r;return-1===(r=t.call(this,e,i)||this).rasters.indexOf(r.name)&&r.rasters.unshift(r.name),r.filtering=e.filtering,r.textures={},r}fe(e,t);var i=e.prototype;return i.load=function(t){return new Promise(function(e,i){t.source_data={},t.source_data.layers={},t.pad_scale=this.pad_scale,t.rasters=[].concat(this.rasters);var r=an.tile_scale;return t.source_data.layers={_default:{type:"FeatureCollection",features:[{geometry:{type:"Polygon",coordinates:[[[0,0],[r,0],[r,-r],[0,-r],[0,0]]]},properties:{}}]}},t.default_winding="CW",e(t)}.bind(this))},i.tileTexture=function(t){return new Promise(function(e,i){var r=this.adjustRasterTileZoom(t),n=r.key;if(!this.textures[n]){var o=this.formatURL(this.url,{coords:r});this.textures[n]={name:o,url:o,filtering:this.filtering,coords:r}}return e(this.textures[n])}.bind(this))},i.adjustRasterTileZoom=function(t){var e=t.coords,i=this.sources[t.source];if(i!==this){var r=this.zoom_bias-i.zoom_bias;r>0?e=go.normalizedCoord(t.coords,{zoom_bias:r,zooms:this.zooms}):(r<0&&Ki({level:"warn",once:!0},"Raster source '"+this.name+"' supports higher zoom detail than source '"+i.name+"' it's attached to. Downsampling this source "+-r+" extra zoom levels to match."),e=go.coordForTileZooms(e,this.zooms))}return e},e}(mo),yo=function(t){function e(e,i){var r;return(r=t.call(this,e,i)||this).load_image={},r.alpha=null!=e.alpha?Math.max(Math.min(e.alpha,1),0):null,r.mask_alpha=!0,r.preserve_tiles_within_zoom=0,r.max_display_density=e.max_display_density,Array.isArray(e.composite)?r.images=e.composite.map((function(t){return{url:t.url,bounds:r.parseBounds(t),alpha:null!=t.alpha?Math.max(Math.min(t.alpha,1),0):null}})):r.images=[{url:r.url,bounds:r.bounds,alpha:r.alpha}],r}fe(e,t);var i=e.prototype;return i.tileTexture=function(t,e){return new Promise(function(i,r){var n,o,s,a,l,c,u,h,d,p;return n=this,o=e.blend,s=e.generation,a=this.adjustRasterTileZoom(t),l="opaque"!==o,c="raster-"+this.name+"-"+a.key+"-"+(l?"alpha":"opaque")+"-"+s,Hr.textures[c]?i({name:c,coords:a,skip_create:!0}):(u=Yi.device_pixel_ratio,this.max_display_density&&(u=Math.min(u,this.max_display_density)),u*=2,h=document.createElement("canvas"),d=h.getContext("2d"),h.width=this.tile_size*u,h.height=this.tile_size*u,d.imageSmoothingEnabled="nearest"!==this.filtering,p=this.images.filter((function(e){return n.checkBounds(t.coords,e.bounds)})),Promise.resolve(Promise.all(p.map((function(e){var i=l?null!=e.alpha?e.alpha:n.alpha:1;return n.drawImage(e.url,e.bounds,i,t,u,d)})))).then(function(t){try{return i({name:c,element:h,filtering:this.filtering,coords:a})}catch(t){return r(t)}}.bind(this),r))}.bind(this))},i.drawImage=function(t,e,i,r,n,o){return new Promise(function(s,a){var l,c,u,h,d,p,f;return l=qr(t),this.load_image[l]=this.load_image[l]||this.loadImage(t),Promise.resolve(this.load_image[l]).then(function(t){try{return c=t,u=an.metersPerPixel(r.coords.z)/n/(this.tile_size/an.tile_size),h=(e.meters.min[0]-r.min.x)/u,d=-(e.meters.min[1]-r.min.y)/u,p=(e.meters.max[0]-e.meters.min[0])/u,f=-(e.meters.max[1]-e.meters.min[1])/u,o.globalAlpha=null!=i?i:1,o.drawImage(c,h,d,p,f),s()}catch(t){return a(t)}}.bind(this),a)}.bind(this))},i.loadImage=function(t){var e=this;return new Promise((function(i){var r=new Image;r.onload=function(){return i(r)},r.onerror=function(r){Ki("warn","Raster source '"+e.name+"': failed to load url: '"+t+"'",r),i(null)},Yi.isSafari()&&"data:"===t.slice(0,5)||(r.crossOrigin="anonymous"),r.src=t}))},i.includesTile=function(t,e){var i=this;return!!po.prototype.includesTile.call(this,t,e)&&this.images.some((function(e){return i.checkBounds(t,e.bounds)}))},i.validate=function(t){var e="Raster data source must provide a string `url` parameter, or an array of `composite` raster ";e+="image objects that each have a `url` parameter";var i="Raster data source must provide a `bounds` parameter, or an array of `composite` raster ";if(i+="image objects that each have a `bounds` parameter",Array.isArray(t.composite)){if(t.composite.some((function(t){return"string"!=typeof t.url})))throw Error(e);if(t.composite.some((function(t){return!(Array.isArray(t.bounds)&&4===t.bounds.length)})))throw Error(i);if(null!=t.url||null!=t.bounds)throw Error("Raster data source must have *either* a single image specified as `url` and `bounds `parameters, or an array of `composite` raster image objects, each with `url` and `bounds`.")}else{if("string"!=typeof t.url)throw Error(e);if(!Array.isArray(t.bounds)||4!==t.bounds.length)throw Error(i)}},e}(_o);po.register("Raster",(function(t){return _o.urlHasTilePattern(t.url)?_o:yo}));var vo={init:function(t){var e=void 0===t?{}:t,i=e.generation,r=e.styles,n=e.sources,o=void 0===n?{}:n,s=e.introspection;this.setGeneration(i),this.styles=r,this.sources=o,this.defines=Object.prototype.hasOwnProperty.call(this,"defines")&&this.defines||{},this.shaders=Object.prototype.hasOwnProperty.call(this,"shaders")&&this.shaders||{},this.introspection=s||!1,this.selection=this.selection||this.introspection||!1,this.compile_setup=!1,this.program=null,this.selection_program=null,this.feature_style={},this.vertex_template=[],this.tile_data={},this.stencil_proxy_tiles=!0,this.variants={},this.vertex_layouts={},this.defines.TANGRAM_WORLD_POSITION_WRAP=1e5,this.blend=this.blend||"opaque","opaque"!==this.blend?null==this.blend_order&&(this.blend_order=this.default_blend_orders[this.blend]):this.blend_order=this.default_blend_orders[this.blend],this.defines["TANGRAM_BLEND_"+this.blend.toUpperCase()]=!0,this.removeShaderBlock("setup"),this.material instanceof to||(to.isValid(this.material)||(this.material=Rn.defaults.material),this.material=new to(this.material)),this.material.inject(this),so.setMode(this.lighting,this),this.setupRasters(),this.setupCustomAttributes(),this.initialized=!0},destroy:function(){this.program&&(this.program.destroy(),this.program=null),this.selection_program&&(this.selection_program.destroy(),this.selection_program=null),Qi.removeTarget(this.main_thread_target),this.gl=null,this.initialized=!1},reset:function(){},baseStyle:function(){return this.base||this.name},setGeneration:function(t){this.generation=t,this.main_thread_target=["Style",this.name,this.generation].join("_"),Ht.is_main&&Qi.addTarget(this.main_thread_target,this)},startData:function(t){this.tile_data[t.id]=this.tile_data[t.id]||{meshes:{},uniforms:{},textures:[]}},endData:function(t){return new Promise(function(e,i){var r=this.tile_data[t.id];if(this.tile_data[t.id]=null,r&&Object.keys(r.meshes).length>0){for(var n in r.meshes){var o=r.meshes[n];0!==o.vertex_data.vertex_count?(o.vertex_data.end(),o.vertex_elements=o.vertex_data.element_buffer,o.vertex_data=o.vertex_data.vertex_buffer):delete r.meshes[n]}return e(this.buildRasterTextures(t,r))}return e(null)}.bind(this))},hasDataForTile:function(t){return null!=this.tile_data[t.id]},getTileMesh:function(t,e){var i=this.tile_data[t.id].meshes;if(null==i[e.key]){var r=this.vertexLayoutForMeshVariant(e);i[e.key]={variant:e,vertex_data:r.createVertexData()}}return i[e.key]},vertexLayoutForMeshVariant:function(){},meshVariantTypeForDraw:function(){},addFeature:function(t,e,i){var r=i.tile;if(r.generation===this.generation){this.tile_data[r.id]||this.startData(r);var n=this.parseFeature(t,e,i);n&&this.buildGeometry(t.geometry,n,i)>0&&(t.generation=this.generation)}},buildGeometry:function(t,e,i){var r,n=this;if("Polygon"===t.type?r=this.buildPolygons([t.coordinates],e,i):"MultiPolygon"===t.type?r=this.buildPolygons(t.coordinates,e,i):"LineString"===t.type?r=this.buildLines([t.coordinates],e,i):"MultiLineString"===t.type?r=this.buildLines(t.coordinates,e,i):"Point"===t.type?r=this.buildPoints([t.coordinates],e,i):"MultiPoint"===t.type&&(r=this.buildPoints(t.coordinates,e,i)),r>0&&tr.layer_stats){var o=i.tile;o.debug.layers=o.debug.layers||{list:{},tree:{}};var s=o.debug.layers.list,a=o.debug.layers.tree,l={};i.layers.forEach((function(t){var e,i;xo(s,t,1,r,((e={})[n.name]=r,e),((i={})[n.baseStyle()]=r,i));for(var o=a,c=l,u=t.split(":"),h=0;h<u.length;h++){var d,p,f=u[h];o[f]=o[f]||{features:0,geoms:0,styles:{},base:{}},null==c[f]&&(c[f]={},xo(o,f,1,r,((d={})[n.name]=r,d),((p={})[n.baseStyle()]=r,p))),h<u.length-1&&(o[f].layers=o[f].layers||{}),o=o[f].layers,c=c[f]}}))}return r},parseFeature:function(t,e,i){try{var r=this.feature_style;if(r.order=this.parseOrder(e.order,i),null==r.order&&"overlay"!==this.blend){var n="Layer '"+e.layers.join(", ")+"', draw group '"+e.group+"': ";return n+="'order' parameter is required unless blend mode is 'overlay'",null!=e.order&&(n+="; 'order' was set to a dynamic value (e.g. string tied to feature property, ",n+="or JS function), but evaluated to null for one or more features"),void Ki({level:"warn",once:!0},n)}if(!(r=this._parseFeature(t,e,i)))return;if(this.shaders.attributes)for(var o in r.attributes=r.attributes||{},this.shaders.attributes)r.attributes[o]=Rn.evalCachedProperty(e.attributes&&e.attributes[o],i),"number"!=typeof r.attributes[o]&&(r.attributes[o]=0);return this.selection?r.interactive=Rn.evalProperty(e.interactive,i):r.interactive=!1,!0===r.interactive?r.selection_color=Wn.makeColor(t,i.tile,i):r.selection_color=Wn.defaultColor,r}catch(e){Ki("error","Style.parseFeature: style parsing error",t,r,e.stack)}},_parseFeature:function(){return this.feature_style},preprocess:function(t){if(!t.preprocessed){if(this.draw)for(var e in this.draw){var i=this.draw[e];"object"!=typeof i||Array.isArray(i)?null==t[e]&&(t[e]=i):t[e]=sn({},i,t[e])}if(this.selection?this.introspection&&(t.interactive=!0):t.interactive=!1,!(t=this._preprocess(t)))return;if(this.shaders.attributes)for(var r in t.attributes=t.attributes||{},this.shaders.attributes)t.attributes[r]=Rn.createPropertyCache(null!=t.attributes[r]?t.attributes[r]:0);t.preprocessed=!0}return t},_preprocess:function(t){return t},parseOrder:function(t,e){return"number"!=typeof t?Rn.calculateOrder(t,e):t},scaleOrder:function(t){return 2*t},parseColor:function(t,e){return t?Rn.evalCachedColorProperty(t,e):this.shaders.blocks.color||this.shaders.blocks.filter?Rn.defaults.color:void 0},buildPolygons:function(){return 0},buildLines:function(){return 0},buildPoints:function(){return 0},setGL:function(t){this.gl=t,this.max_texture_size=Hr.getMaxTextureSize(this.gl)},makeMesh:function(t,e,i){void 0===i&&(i={});var r=this.vertexLayoutForMeshVariant(i.variant);return tr.wireframe?(e=function(t){for(var e=new Uint16Array(2*t.length),i=0;i<t.length;i+=3)e.set([t[i],t[i+1],t[i+1],t[i+2],t[i+2],t[i]],2*i);return e}(e),new Jn(this.gl,t,e,r,Object.assign({},i,{draw_mode:this.gl.LINES}))):new Jn(this.gl,t,e,r,i)},render:function(t){return t.render()},getProgram:function(t){void 0===t&&(t="program"),this.compileSetup();var e=this[t];if(e&&!e.error){if(!e.compiled){Ki("debug","Compiling style '"+this.name+"', program key '"+t+"'");try{e.compile()}catch(e){throw Ki("error","Style: error compiling program for style '"+this.name+"' (program key '"+t+"')",this,e.stack,e.type,e.shader_errors),e}}return e}},compileSetup:function(){if(!this.compile_setup){if(!this.gl)throw new Error("style.compile(): skipping for "+this.name+" because no GL context");var t=this.buildDefineList();if(this.selection){var e=Object.assign({},t);e.TANGRAM_FEATURE_SELECTION=!0}var i=this.shaders&&this.shaders.blocks,r=this.shaders&&this.shaders.block_scopes,n=Object.assign({},this.shaders&&this.shaders.uniforms);for(var o in n)null==n[o]&&Ki({level:"warn",once:!0},"Style '"+this.name+"' has invalid uniform '"+o+"': uniform values must be non-null");var s=this.shaders&&this.shaders.extensions;"string"==typeof s&&(s=[s]),this.program=new Jr(this.gl,this.vertex_shader_src,this.fragment_shader_src,{name:this.name,defines:t,uniforms:n,blocks:i,block_scopes:r,extensions:s}),this.selection?this.selection_program=new Jr(this.gl,this.vertex_shader_src,"// Fragment shader for feature selection passes\n// Renders in silhouette according to selection (picking) color, or black if none defined\n\n#ifdef TANGRAM_FEATURE_SELECTION\n    varying vec4 v_selection_color;\n#endif\n\nvoid main (void) {\n    #ifdef TANGRAM_FEATURE_SELECTION\n        gl_FragColor = v_selection_color;\n    #else\n        gl_FragColor = vec4(0., 0., 0., 1.);\n    #endif\n}\n",{name:this.name+" (selection)",defines:e,uniforms:n,blocks:i,block_scopes:r,extensions:s}):this.selection_program=null,this.compile_setup=!0}},addShaderBlock:function(t,e,i){void 0===i&&(i=null),this.shaders.blocks=this.shaders.blocks||{},this.shaders.blocks[t]=this.shaders.blocks[t]||[],this.shaders.blocks[t].push(e),this.shaders.block_scopes=this.shaders.block_scopes||{},this.shaders.block_scopes[t]=this.shaders.block_scopes[t]||[],this.shaders.block_scopes[t].push(i)},removeShaderBlock:function(t){this.shaders.blocks&&(this.shaders.blocks[t]=null),this.shaders.block_scopes&&(this.shaders.block_scopes[t]=null)},replaceShaderBlock:function(t,e,i){void 0===i&&(i=null),this.removeShaderBlock(t),this.addShaderBlock(t,e,i)},buildDefineList:function(){var t={};if(null!=this.defines)for(var e in this.defines)t[e]=this.defines[e];if(null!=this.shaders&&null!=this.shaders.defines)for(e in this.shaders.defines)t[e]=this.shaders.defines[e];return t},hasRasters:function(){return["color","normal","custom"].indexOf(this.raster)>-1},setupRasters:function(){var t=this;if(this.hasRasters()){"color"===this.raster?this.defines.TANGRAM_RASTER_TEXTURE_COLOR=!0:"normal"===this.raster&&(this.defines.TANGRAM_RASTER_TEXTURE_NORMAL=!0);var e=Object.keys(this.sources).filter((function(e){return t.sources[e]instanceof _o})).length;if(this.defines.TANGRAM_NUM_RASTER_SOURCES=""+e,e>0){var i=Object.keys(this.sources).filter((function(e){return t.sources[e].mask_alpha})).length;this.defines.TANGRAM_HAS_MASKED_RASTERS=i>0,this.defines.TANGRAM_ALL_MASKED_RASTERS=i===e,this.defines.TANGRAM_MODEL_POSITION_BASE_ZOOM_VARYING=!0,this.replaceShaderBlock("raster","// Uniforms defining raster textures and macros for accessing them\n\n#ifdef TANGRAM_FRAGMENT_SHADER\nuniform sampler2D u_rasters[TANGRAM_NUM_RASTER_SOURCES];    // raster tile texture samplers\nuniform vec2 u_raster_sizes[TANGRAM_NUM_RASTER_SOURCES];    // raster tile texture sizes (width/height in pixels)\nuniform vec3 u_raster_offsets[TANGRAM_NUM_RASTER_SOURCES];  // raster tile texture UV starting offset for tile\n\n// Raster sources can optionally mask by the alpha channel (render with only full or no alpha, based on a threshold),\n// which is used for handling transparency outside the raster image when rendering with opaque blending\n#if defined(TANGRAM_HAS_MASKED_RASTERS) && !defined(TANGRAM_ALL_MASKED_RASTERS) // only add uniform if we need it\nuniform bool u_raster_mask_alpha;\n#endif\n\n// Note: the raster accessors below are #defines rather than functions to\n// avoid issues with constant integer expressions for array indices\n\n// Adjusts UVs in model space to account for raster tile texture overzooming\n// (applies scale and offset adjustments)\n#define adjustRasterUV(raster_index, uv) \\\n    ((uv) * u_raster_offsets[raster_index].z + u_raster_offsets[raster_index].xy)\n\n// Returns the UVs of the current model position for a raster sampler\n#define currentRasterUV(raster_index) \\\n    (adjustRasterUV(raster_index, v_modelpos_base_zoom.xy))\n\n// Returns pixel location in raster tile texture at current model position\n#define currentRasterPixel(raster_index) \\\n    (currentRasterUV(raster_index) * rasterPixelSize(raster_index))\n\n// Samples a raster tile texture for the current model position\n#define sampleRaster(raster_index) \\\n    (texture2D(u_rasters[raster_index], currentRasterUV(raster_index)))\n\n// Samples a raster tile texture for a given pixel\n#define sampleRasterAtPixel(raster_index, pixel) \\\n    (texture2D(u_rasters[raster_index], (pixel) / rasterPixelSize(raster_index)))\n\n// Returns size of raster sampler in pixels\n#define rasterPixelSize(raster_index) \\\n    (u_raster_sizes[raster_index])\n\n#endif\n","Raster")}}},buildRasterTextures:function(t,e){return new Promise(function(i,r){var n,o,s,a;if(!this.hasRasters())return i(e);if(0===t.rasters.length)return i(e);var l=function(){try{return!n||n.length<1?i(e):n.some((function(t){return!t.loaded}))?i(null):(e.uniforms.u_raster_mask_alpha=!0===this.sources[t.rasters[0]].mask_alpha,o=e.uniforms.u_rasters=[],s=e.uniforms.u_raster_sizes=[],a=e.uniforms.u_raster_offsets=[],n.forEach((function(i){var r=i.index;if(o[r]=i.name,e.textures.push(i.name),s[r]=[i.width,i.height],t.coords.z>i.coords.z){var n=t.coords.z-i.coords.z,l=Math.pow(2,n);a[r]=[(t.coords.x%l+l)%l/l,(l-1-t.coords.y%l)/l,1/l]}else a[r]=[0,0,1]})),i(e))}catch(t){return r(t)}}.bind(this),c=function(t){try{return i(e)}catch(t){return r(t)}};try{return Promise.resolve(Qi.postMessage(this.main_thread_target+".loadTextures",{coords:t.coords,source:t.source,rasters:t.rasters,min:t.min,max:t.max})).then((function(t){try{return n=t,l()}catch(t){return c()}}),c)}catch(t){c()}}.bind(this))},loadTextures:function(t){return new Promise(function(e,i){var r,n,o,s,a;return r=this,n={},o={},s=[],t.rasters.map((function(t){return r.sources[t]})).filter((function(t){return t})).forEach((function(e,i){e instanceof _o&&s.push(e.tileTexture(t,r).then((function(t){n[t.name]=t,o[t.name]=i})))})),Promise.resolve(Promise.all(s)).then(function(t){try{return Promise.resolve(Hr.createFromObject(this.gl,n)).then((function(t){try{return Promise.resolve(Promise.all(Object.keys(n).map((function(t){return Hr.textures[t]&&Hr.textures[t].load()})).filter((function(t){return t})))).then((function(t){try{return(a=t).forEach((function(t){return t.retain()})),e(a.map((function(t){return{name:t.name,width:t.width,height:t.height,loaded:t.loaded,index:o[t.name],coords:n[t.name].coords}})))}catch(t){return i(t)}}),i)}catch(t){return i(t)}}),i)}catch(t){return i(t)}}.bind(this),i)}.bind(this))},setupCustomAttributes:function(){if(this.shaders.attributes)for(var t=0,e=Object.entries(this.shaders.attributes);t<e.length;t++){var i=e[t],r=i[0],n=i[1];"float"===n.type&&(!1!==n.varying?(this.addShaderBlock("attributes","\n                            #ifdef TANGRAM_VERTEX_SHADER\n                                attribute float a_"+r+";\n                                varying float v_"+r+";\n                                #define "+r+" a_"+r+"\n                            #else\n                                varying float v_"+r+";\n                                #define "+r+" v_"+r+"\n                            #endif\n                        "),this.addShaderBlock("setup","#ifdef TANGRAM_VERTEX_SHADER\nv_"+r+" = a_"+r+";\n#endif")):this.addShaderBlock("attributes","\n                            #ifdef TANGRAM_VERTEX_SHADER\n                                attribute float a_"+r+";\n                                #define "+r+" a_"+r+"\n                            #endif\n                        "))}},addCustomAttributesToAttributeList:function(t){if(this.shaders.attributes)for(var e=0,i=Object.entries(this.shaders.attributes);e<i.length;e++){var r=i[e],n=r[0];"float"===r[1].type&&t.push({name:"a_"+n,size:1,type:Xn.FLOAT,normalized:!1})}return t},addCustomAttributesToVertexTemplate:function(t,e){if(this.shaders.attributes)for(var i in this.shaders.attributes)this.vertex_template[e++]=null!=t.attributes[i]?t.attributes[i]:0},setup:function(){this.setUniforms(),this.material.setupProgram(Jr.current)},setUniforms:function(){var t=Jr.current;t&&t.setUniforms(this.shaders&&this.shaders.uniforms,!0)},render_states:{opaque:{depth_test:!0,depth_write:!0},translucent:{depth_test:!0,depth_write:!0},add:{depth_test:!0,depth_write:!1},multiply:{depth_test:!0,depth_write:!1},inlay:{depth_test:!0,depth_write:!1},overlay:{depth_test:!1,depth_write:!1}},default_blend_orders:{opaque:Number.MIN_SAFE_INTEGER,add:1,multiply:2,inlay:3,translucent:4,overlay:5},getBlendOrderForDraw:function(t){return"opaque"!==this.blend&&null!=t.blend_order?t.blend_order:this.blend_order}};function xo(t,e,i,r,n,o){for(var s in t[e]=t[e]||{features:0,geoms:0,styles:{},base:{}},t[e].features+=i,t[e].geoms+=r,n)t[e].styles[s]=t[e].styles[s]||0,t[e].styles[s]+=n[s];for(var a in o)t[e].base[a]=t[e].base[a]||0,t[e].base[a]+=o[a]}jr("Int16",2,(function(t){return function(e,i,r){return t(this,e,i,r)}})),jr("Uint32",4,(function(t){return function(e,i,r){return t(this,e,i,r)}})),jr("Int32",4,(function(t){return function(e,i,r){return t(this,e,i,r)}})),jr("Int8",1,(function(t){return function(e,i,r){return t(this,e,i,r)}})),jr("Float32",4,(function(t){return function(e,i,r){return t(this,e,i,r)}}));var bo,wo=Math.pow(2,16)-1,To=!1,Bo=function(){function t(){this.array=[],this.has_overflown=!1}var e=t.prototype;return e.push=function(t){this.has_overflown&&!To||t>wo&&(this.has_overflown=!0,!To)||this.array.push(t)},e.end=function(){if(this.array.length){var t=(e=this.array,new(this.has_overflown&&To?Uint32Array:Uint16Array)(e));return this.array=[],this.has_overflown=!1,t}return!1;var e},t}();Bo.setElementIndexUint=function(t){To=t};var Eo=((bo={})[Xn.FLOAT]=Float32Array,bo[Xn.BYTE]=Int8Array,bo[Xn.UNSIGNED_BYTE]=Uint8Array,bo[Xn.INT]=Int32Array,bo[Xn.UNSIGNED_INT]=Uint32Array,bo[Xn.SHORT]=Int16Array,bo[Xn.UNSIGNED_SHORT]=Uint16Array,bo),Co=function(){function t(e,i){var r=(void 0===i?{}:i).prealloc,n=void 0===r?500:r;this.vertex_layout=e,this.vertex_elements=new Bo,this.stride=this.vertex_layout.stride,t.array_pool.length>0?(this.vertex_buffer=t.array_pool.pop(),this.byte_length=this.vertex_buffer.byteLength,this.size=Math.floor(this.byte_length/this.stride),Ki("trace","VertexData: reused buffer of bytes "+this.byte_length+", "+this.size+" vertices")):(this.size=n,this.byte_length=this.stride*this.size,this.vertex_buffer=new Uint8Array(this.byte_length)),this.offset=0,this.vertex_count=0,this.realloc_count=0,this.setBufferViews(),this.setAddVertexFunction()}var e=t.prototype;return e.setBufferViews=function(){var t=this;this.views={},this.views[Xn.UNSIGNED_BYTE]=this.vertex_buffer,this.vertex_layout.dynamic_attribs.forEach((function(e){if(null==t.views[e.type]){var i=Eo[e.type];t.views[e.type]=new i(t.vertex_buffer.buffer)}}))},e.checkBufferSize=function(){if(this.offset+this.stride>this.byte_length){this.size=Math.floor(1.5*this.size),this.size-=this.size%4,this.byte_length=this.stride*this.size;var e=new Uint8Array(this.byte_length);e.set(this.vertex_buffer),t.array_pool.push(this.vertex_buffer),this.vertex_buffer=e,this.setBufferViews(),this.realloc_count++}},e.setAddVertexFunction=function(){this.vertexLayoutAddVertex=this.vertex_layout.getAddVertexFunction()},e.addVertex=function(t){this.checkBufferSize(),this.vertexLayoutAddVertex(t,this.views,this.offset),this.offset+=this.stride,this.vertex_count++},e.end=function(){return this.vertex_buffer=this.vertex_buffer.subarray(0,this.offset),this.element_buffer=this.vertex_elements.end(),Ki("trace","VertexData: "+this.size+" vertices total, realloc count "+this.realloc_count),this},t}();Co.array_pool=[];var So=function(){function t(t){this.attribs=t,this.dynamic_attribs=this.attribs.filter((function(t){return null==t.static})),this.static_attribs=this.attribs.filter((function(t){return null!=t.static})),this.components=[],this.index={},this.offset={},this.stride=0;for(var e=0,i=0,r=0;r<this.attribs.length;r++){var n=this.attribs[r];if(null==n.static){n.offset=this.stride,n.byte_size=n.size;var o=0;switch(n.type){case Xn.FLOAT:case Xn.INT:case Xn.UNSIGNED_INT:n.byte_size*=4,o=2;break;case Xn.SHORT:case Xn.UNSIGNED_SHORT:n.byte_size*=2,o=1}3&n.byte_size&&(n.byte_size+=4-(3&n.byte_size)),this.stride+=n.byte_size;for(var s=n.offset>>o,a=0;a<n.size;a++)this.components.push({type:n.type,shift:o,offset:s++,index:i++});this.index[n.name]=e,e+=n.size,this.offset[n.name]=n.offset}else n.static=Array.isArray(n.static)?n.static:[n.static],n.method="vertexAttrib"+n.static.length+"fv"}}var e=t.prototype;return e.enableDynamicAttributes=function(e,i){var r=this;for(var n in t.enabled_attribs)e.disableVertexAttribArray(n);t.enabled_attribs={},this.dynamic_attribs.forEach((function(n){var o=i.attribute(n.name).location;-1!==o&&(e.enableVertexAttribArray(o),e.vertexAttribPointer(o,n.size,n.type,n.normalized,r.stride,n.offset),t.enabled_attribs[o]=i)}))},e.enableStaticAttributes=function(t,e){this.static_attribs.forEach((function(i){var r=e.attribute(i.name).location;-1!==r&&t[i.method]instanceof Function&&(t.enableVertexAttribArray(r),t[i.method](r,i.static),t.disableVertexAttribArray(r))}))},e.createVertexData=function(){return new Co(this)},e.getAddVertexFunction=function(){return null==this.addVertex&&this.createAddVertexFunction(),this.addVertex},e.createAddVertexFunction=function(){var e=qr(JSON.stringify(this.attribs));if(null==t.add_vertex_funcs[e]){var i,r=["var t, o;"],n=[].concat(this.components);n.sort((function(t,e){return t.type!==e.type?t.type-e.type:t.index-e.index}));for(var o=0;o<n.length;o++){var s=n[o];i!==s.type&&(r.push("t = vs["+s.type+"];"),r.push("o = off"+(s.shift?" >> "+s.shift:"")+";"),i=s.type),r.push("t[o + "+s.offset+"] = v["+s.index+"];")}r=r.join("\n");var a=new Function("v","vs","off",r);t.add_vertex_funcs[e]=a}this.addVertex=t.add_vertex_funcs[e]},t}();So.enabled_attribs={},So.add_vertex_funcs={};var Io=[{x:0,y:0},{x:an.tile_scale,y:-an.tile_scale}],Mo=[0,0,1,1];function ko(t,e,i){var r=Io[0],n=Io[1];return t[0]<=r.x+i&&e[0]<=r.x+i||t[0]>=n.x-i&&e[0]>=n.x-i||t[1]>=r.y-i&&e[1]>=r.y-i||t[1]<=n.y+i&&e[1]<=n.y+i}function Po(t,e){e=e||0;var i=Io[0],r=Io[1];return t[0]<=i.x+e||t[0]>=r.x-e||t[1]>=i.y-e||t[1]<=r.y+e}var Lo=Fo,zo=Fo;function Fo(t,e,i){i=i||2;var r,n,o,s,a,l,c,u=e&&e.length,h=u?e[0]*i:t.length,d=Do(t,0,h,i,!0),p=[];if(!d||d.next===d.prev)return p;if(u&&(d=function(t,e,i,r){var n,o,s,a=[];for(n=0,o=e.length;n<o;n++)(s=Do(t,e[n]*r,n<o-1?e[n+1]*r:t.length,r,!1))===s.next&&(s.steiner=!0),a.push(Zo(s));for(a.sort(jo),n=0;n<a.length;n++)Ho(a[n],i),i=Ro(i,i.next);return i}(t,e,d,i)),t.length>80*i){r=o=t[0],n=s=t[1];for(var f=i;f<h;f+=i)(a=t[f])<r&&(r=a),(l=t[f+1])<n&&(n=l),a>o&&(o=a),l>s&&(s=l);c=0!==(c=Math.max(o-r,s-n))?1/c:0}return Uo(d,p,i,r,n,c),p}function Do(t,e,i,r,n){var o,s;if(n===ss(t,e,i,r)>0)for(o=e;o<i;o+=r)s=rs(o,t[o],t[o+1],s);else for(o=i-r;o>=e;o-=r)s=rs(o,t[o],t[o+1],s);return s&&Xo(s,s.next)&&(ns(s),s=s.next),s}function Ro(t,e){if(!t)return t;e||(e=t);var i,r=t;do{if(i=!1,r.steiner||!Xo(r,r.next)&&0!==Wo(r.prev,r,r.next))r=r.next;else{if(ns(r),(r=e=r.prev)===r.next)break;i=!0}}while(i||r!==e);return e}function Uo(t,e,i,r,n,o,s){if(t){!s&&o&&function(t,e,i,r){var n=t;do{null===n.z&&(n.z=$o(n.x,n.y,e,i,r)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next}while(n!==t);n.prevZ.nextZ=null,n.prevZ=null,function(t){var e,i,r,n,o,s,a,l,c=1;do{for(i=t,t=null,o=null,s=0;i;){for(s++,r=i,a=0,e=0;e<c&&(a++,r=r.nextZ);e++);for(l=c;a>0||l>0&&r;)0!==a&&(0===l||!r||i.z<=r.z)?(n=i,i=i.nextZ,a--):(n=r,r=r.nextZ,l--),o?o.nextZ=n:t=n,n.prevZ=o,o=n;i=r}o.nextZ=null,c*=2}while(s>1)}(n)}(t,r,n,o);for(var a,l,c=t;t.prev!==t.next;)if(a=t.prev,l=t.next,o?No(t,r,n,o):Oo(t))e.push(a.i/i),e.push(t.i/i),e.push(l.i/i),ns(t),t=l.next,c=l.next;else if((t=l)===c){s?1===s?Uo(t=Qo(Ro(t),e,i),e,i,r,n,o,2):2===s&&Vo(t,e,i,r,n,o):Uo(Ro(t),e,i,r,n,o,1);break}}}function Oo(t){var e=t.prev,i=t,r=t.next;if(Wo(e,i,r)>=0)return!1;for(var n=t.next.next;n!==t.prev;){if(qo(e.x,e.y,i.x,i.y,r.x,r.y,n.x,n.y)&&Wo(n.prev,n,n.next)>=0)return!1;n=n.next}return!0}function No(t,e,i,r){var n=t.prev,o=t,s=t.next;if(Wo(n,o,s)>=0)return!1;for(var a=n.x<o.x?n.x<s.x?n.x:s.x:o.x<s.x?o.x:s.x,l=n.y<o.y?n.y<s.y?n.y:s.y:o.y<s.y?o.y:s.y,c=n.x>o.x?n.x>s.x?n.x:s.x:o.x>s.x?o.x:s.x,u=n.y>o.y?n.y>s.y?n.y:s.y:o.y>s.y?o.y:s.y,h=$o(a,l,e,i,r),d=$o(c,u,e,i,r),p=t.prevZ,f=t.nextZ;p&&p.z>=h&&f&&f.z<=d;){if(p!==t.prev&&p!==t.next&&qo(n.x,n.y,o.x,o.y,s.x,s.y,p.x,p.y)&&Wo(p.prev,p,p.next)>=0)return!1;if(p=p.prevZ,f!==t.prev&&f!==t.next&&qo(n.x,n.y,o.x,o.y,s.x,s.y,f.x,f.y)&&Wo(f.prev,f,f.next)>=0)return!1;f=f.nextZ}for(;p&&p.z>=h;){if(p!==t.prev&&p!==t.next&&qo(n.x,n.y,o.x,o.y,s.x,s.y,p.x,p.y)&&Wo(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;f&&f.z<=d;){if(f!==t.prev&&f!==t.next&&qo(n.x,n.y,o.x,o.y,s.x,s.y,f.x,f.y)&&Wo(f.prev,f,f.next)>=0)return!1;f=f.nextZ}return!0}function Qo(t,e,i){var r=t;do{var n=r.prev,o=r.next.next;!Xo(n,o)&&Jo(n,r,r.next,o)&&es(n,o)&&es(o,n)&&(e.push(n.i/i),e.push(r.i/i),e.push(o.i/i),ns(r),ns(r.next),r=t=o),r=r.next}while(r!==t);return Ro(r)}function Vo(t,e,i,r,n,o){var s=t;do{for(var a=s.next.next;a!==s.prev;){if(s.i!==a.i&&Ko(s,a)){var l=is(s,a);return s=Ro(s,s.next),l=Ro(l,l.next),Uo(s,e,i,r,n,o),void Uo(l,e,i,r,n,o)}a=a.next}s=s.next}while(s!==t)}function jo(t,e){return t.x-e.x}function Ho(t,e){if(e=function(t,e){var i,r=e,n=t.x,o=t.y,s=-1/0;do{if(o<=r.y&&o>=r.next.y&&r.next.y!==r.y){var a=r.x+(o-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(a<=n&&a>s){if(s=a,a===n){if(o===r.y)return r;if(o===r.next.y)return r.next}i=r.x<r.next.x?r:r.next}}r=r.next}while(r!==e);if(!i)return null;if(n===s)return i;var l,c=i,u=i.x,h=i.y,d=1/0;r=i;do{n>=r.x&&r.x>=u&&n!==r.x&&qo(o<h?n:s,o,u,h,o<h?s:n,o,r.x,r.y)&&(l=Math.abs(o-r.y)/(n-r.x),es(r,t)&&(l<d||l===d&&(r.x>i.x||r.x===i.x&&Go(i,r)))&&(i=r,d=l)),r=r.next}while(r!==c);return i}(t,e)){var i=is(e,t);Ro(e,e.next),Ro(i,i.next)}}function Go(t,e){return Wo(t.prev,t,e.prev)<0&&Wo(e.next,t,t.next)<0}function $o(t,e,i,r,n){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*n)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*n)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Zo(t){var e=t,i=t;do{(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next}while(e!==t);return i}function qo(t,e,i,r,n,o,s,a){return(n-s)*(e-a)-(t-s)*(o-a)>=0&&(t-s)*(r-a)-(i-s)*(e-a)>=0&&(i-s)*(o-a)-(n-s)*(r-a)>=0}function Ko(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&Jo(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1}(t,e)&&(es(t,e)&&es(e,t)&&function(t,e){var i=t,r=!1,n=(t.x+e.x)/2,o=(t.y+e.y)/2;do{i.y>o!=i.next.y>o&&i.next.y!==i.y&&n<(i.next.x-i.x)*(o-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next}while(i!==t);return r}(t,e)&&(Wo(t.prev,t,e.prev)||Wo(t,e.prev,e))||Xo(t,e)&&Wo(t.prev,t,t.next)>0&&Wo(e.prev,e,e.next)>0)}function Wo(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function Xo(t,e){return t.x===e.x&&t.y===e.y}function Jo(t,e,i,r){var n=ts(Wo(t,e,i)),o=ts(Wo(t,e,r)),s=ts(Wo(i,r,t)),a=ts(Wo(i,r,e));return n!==o&&s!==a||!(0!==n||!Yo(t,i,e))||!(0!==o||!Yo(t,r,e))||!(0!==s||!Yo(i,t,r))||!(0!==a||!Yo(i,e,r))}function Yo(t,e,i){return e.x<=Math.max(t.x,i.x)&&e.x>=Math.min(t.x,i.x)&&e.y<=Math.max(t.y,i.y)&&e.y>=Math.min(t.y,i.y)}function ts(t){return t>0?1:t<0?-1:0}function es(t,e){return Wo(t.prev,t,t.next)<0?Wo(t,e,t.next)>=0&&Wo(t,t.prev,e)>=0:Wo(t,e,t.prev)<0||Wo(t,t.next,e)<0}function is(t,e){var i=new os(t.i,t.x,t.y),r=new os(e.i,e.x,e.y),n=t.next,o=e.prev;return t.next=e,e.prev=t,i.next=n,n.prev=i,r.next=i,i.prev=r,o.next=r,r.prev=o,r}function rs(t,e,i,r){var n=new os(t,e,i);return r?(n.next=r.next,n.prev=r,r.next.prev=n,r.next=n):(n.prev=n,n.next=n),n}function ns(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function os(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function ss(t,e,i,r){for(var n=0,o=e,s=i-r;o<i;o+=r)n+=(t[s]-t[o])*(t[o+1]+t[s+1]),s=o;return n}Fo.deviation=function(t,e,i,r){var n=e&&e.length,o=n?e[0]*i:t.length,s=Math.abs(ss(t,0,o,i));if(n)for(var a=0,l=e.length;a<l;a++){var c=e[a]*i,u=a<l-1?e[a+1]*i:t.length;s-=Math.abs(ss(t,c,u,i))}var h=0;for(a=0;a<r.length;a+=3){var d=r[a]*i,p=r[a+1]*i,f=r[a+2]*i;h+=Math.abs((t[d]-t[f])*(t[p+1]-t[d+1])-(t[d]-t[p])*(t[f+1]-t[d+1]))}return 0===s&&0===h?0:Math.abs((h-s)/s)},Fo.flatten=function(t){for(var e=t[0][0].length,i={vertices:[],holes:[],dimensions:e},r=0,n=0;n<t.length;n++){for(var o=0;o<t[n].length;o++)for(var s=0;s<e;s++)i.vertices.push(t[n][o][s]);n>0&&(r+=t[n-1].length,i.holes.push(r))}return i},Lo.default=zo;var as=[0,0,1];function ls(t,e,i,r){var n,o,s,a,l,c,u,h,d,p=r.texcoord_index,f=r.texcoord_scale,A=r.texcoord_normalize,m=e.vertex_elements,g=t.length,_=0;if(p){A=A||1;var y=f||Mo;n=y[0],o=y[1],s=y[2],a=y[3]}for(var v=0;v<g;v++){var x=t[v],b=e.vertex_count,w=(d=Lo.flatten(x),Lo(d.vertices,d.holes,d.dimensions)),T=w.length;if(T){var B;p&&(l=(B=an.findBoundingBox(x))[0],c=B[1],u=(s-n)/(B[2]-l),h=(a-o)/(B[3]-c));for(var E=0;E<x.length;E++)for(var C=x[E],S=0;S<C.length;S++){var I=C[S];i[0]=I[0],i[1]=I[1],p&&(i[p+0]=((I[0]-l)*u+n)*A,i[p+1]=((I[1]-c)*h+o)*A),e.addVertex(i)}for(var M=0;M<T;M++)m.push(b+w[M]);_+=T/3}}return _}var cs='uniform vec2 u_resolution;\nuniform float u_time;\nuniform vec3 u_map_position;\nuniform vec4 u_tile_origin;\nuniform float u_tile_proxy_order_offset;\nuniform float u_meters_per_pixel;\nuniform float u_device_pixel_ratio;\n\nuniform mat4 u_model;\nuniform mat4 u_modelView;\nuniform mat3 u_normalMatrix;\nuniform mat3 u_inverseNormalMatrix;\n\nattribute vec4 a_position;\nattribute vec4 a_color;\n\n// Optional normal attribute, otherwise default to up\n#ifdef TANGRAM_NORMAL_ATTRIBUTE\n    attribute vec3 a_normal;\n    #define TANGRAM_NORMAL a_normal\n#else\n    #define TANGRAM_NORMAL vec3(0., 0., 1.)\n#endif\n\n// Optional dynamic line extrusion\n#ifdef TANGRAM_EXTRUDE_LINES\n    attribute vec2 a_extrude; // extrusion direction in xy plane\n    attribute vec2 a_offset;  // offset direction in xy plane\n\n    // Polygon and line styles have slightly different VBO layouts, saving memory by optimizing vertex packing.\n    // All lines have a width scaling factor, but only some have a height (position.z) or offset.\n    // The vertex height is stored in different attributes to account for this.\n    attribute vec2 a_z_and_offset_scale; // stores vertex height in x, and offset scaling factor in y\n    #define TANGRAM_POSITION_Z a_z_and_offset_scale.x // vertex height is stored in separate line-specific attrib\n    #define TANGRAM_OFFSET_SCALING a_z_and_offset_scale.y // zoom scaling factor for line offset\n    #define TANGRAM_WIDTH_SCALING a_position.z // zoom scaling factor for line width (stored in position attrib)\n\n    uniform float u_v_scale_adjust; // scales texture UVs for line dash patterns w/fractional pixel width\n#else\n    #define TANGRAM_POSITION_Z a_position.z // vertex height\n#endif\n\nvarying vec4 v_position;\nvarying vec3 v_normal;\nvarying vec4 v_color;\nvarying vec4 v_world_position;\n\n// Optional texture UVs\n#if defined(TANGRAM_TEXTURE_COORDS) || defined(TANGRAM_EXTRUDE_LINES)\n    attribute vec2 a_texcoord;\n    varying vec2 v_texcoord;\n#endif\n\n// Optional model position varying for tile coordinate zoom\n#ifdef TANGRAM_MODEL_POSITION_BASE_ZOOM_VARYING\n    varying vec4 v_modelpos_base_zoom;\n#endif\n\n#if defined(TANGRAM_LIGHTING_VERTEX)\n    varying vec4 v_lighting;\n#endif\n\n#define TANGRAM_UNPACK_SCALING(x) (x / 1024.)\n\n#pragma tangram: attributes\n#pragma tangram: camera\n#pragma tangram: material\n#pragma tangram: lighting\n#pragma tangram: raster\n#pragma tangram: global\n\nvoid main() {\n    // Initialize globals\n    #pragma tangram: setup\n\n    // Texture UVs\n    #ifdef TANGRAM_TEXTURE_COORDS\n        v_texcoord = a_texcoord;\n        #ifdef TANGRAM_EXTRUDE_LINES\n            v_texcoord.y *= u_v_scale_adjust;\n        #endif\n    #endif\n\n    // Pass model position to fragment shader\n    #ifdef TANGRAM_MODEL_POSITION_BASE_ZOOM_VARYING\n        v_modelpos_base_zoom = modelPositionBaseZoom();\n    #endif\n\n    // Position\n    vec4 position = vec4(a_position.xy, TANGRAM_POSITION_Z / TANGRAM_HEIGHT_SCALE, 1.); // convert height back to meters\n\n    #ifdef TANGRAM_EXTRUDE_LINES\n        vec2 _extrude = a_extrude.xy;\n        vec2 _offset = a_offset.xy;\n\n        // Adjust line width based on zoom level, to prevent proxied lines\n        // from being either too small or too big.\n        // "Flattens" the zoom between 1-2 to peg it to 1 (keeps lines from\n        // prematurely shrinking), then interpolate and clamp to 4 (keeps lines\n        // from becoming too small when far away).\n        float _dz = clamp(u_map_position.z - u_tile_origin.z, 0., 4.);\n        _dz += step(1., _dz) * (1. - _dz) + mix(0., 2., clamp((_dz - 2.) / 2., 0., 1.));\n\n        // Interpolate line width between zooms\n        float _mdz = (_dz - 0.5) * 2.; // zoom from mid-point\n        _extrude -= _extrude * TANGRAM_UNPACK_SCALING(TANGRAM_WIDTH_SCALING) * _mdz;\n\n        // Interpolate line offset between zooms\n        // Scales from the larger value to the smaller one\n        float _dwdz = TANGRAM_UNPACK_SCALING(TANGRAM_OFFSET_SCALING);\n        float _sdwdz = sign(step(0., _dwdz) - 0.5); // sign indicates "direction" of scaling\n        _offset -= _offset * abs(_dwdz) * ((1.-step(0., _sdwdz)) - (_dz * -_sdwdz)); // scale "up" or "down"\n\n        // Scale line width and offset to be consistent in screen space\n        float _ssz = exp2(-_dz - (u_tile_origin.z - u_tile_origin.w));\n        _extrude *= _ssz;\n        _offset *= _ssz;\n\n        // Modify line width before extrusion\n        #ifdef TANGRAM_BLOCK_WIDTH\n            float width = 1.;\n            #pragma tangram: width\n            _extrude *= width;\n        #endif\n\n        position.xy += _extrude + _offset;\n    #endif\n\n    // World coordinates for 3d procedural textures\n    v_world_position = wrapWorldPosition(u_model * position);\n\n    // Adjust for tile and view position\n    position = u_modelView * position;\n\n    // Modify position before camera projection\n    #pragma tangram: position\n\n    // Setup varyings\n    v_position = position;\n    v_normal = normalize(u_normalMatrix * TANGRAM_NORMAL);\n    v_color = a_color;\n\n    #if defined(TANGRAM_LIGHTING_VERTEX)\n        // Vertex lighting\n        vec3 normal = v_normal;\n\n        // Modify normal before lighting\n        #pragma tangram: normal\n\n        // Pass lighting intensity to fragment shader\n        v_lighting = calculateLighting(position.xyz - u_eye, normal, vec4(1.));\n    #endif\n\n    // Camera\n    cameraProjection(position);\n\n    // +1 is to keep all layers including proxies > 0\n    applyLayerOrder(a_position.w + u_tile_proxy_order_offset + 1., position);\n\n    gl_Position = position;\n}\n',us="uniform vec2 u_resolution;\nuniform float u_time;\nuniform vec3 u_map_position;\nuniform vec4 u_tile_origin;\nuniform float u_meters_per_pixel;\nuniform float u_device_pixel_ratio;\n\nuniform mat3 u_normalMatrix;\nuniform mat3 u_inverseNormalMatrix;\n\nvarying vec4 v_position;\nvarying vec3 v_normal;\nvarying vec4 v_color;\nvarying vec4 v_world_position;\n\n#ifdef TANGRAM_EXTRUDE_LINES\n    uniform bool u_has_line_texture;\n    uniform sampler2D u_texture;\n    uniform float u_texture_ratio;\n    uniform vec4 u_dash_background_color;\n    uniform float u_has_dash;\n#endif\n\n#define TANGRAM_NORMAL v_normal\n\n#if defined(TANGRAM_TEXTURE_COORDS) || defined(TANGRAM_EXTRUDE_LINES)\n    varying vec2 v_texcoord;\n#endif\n\n#ifdef TANGRAM_MODEL_POSITION_BASE_ZOOM_VARYING\n    varying vec4 v_modelpos_base_zoom;\n#endif\n\n#if defined(TANGRAM_LIGHTING_VERTEX)\n    varying vec4 v_lighting;\n#endif\n\n#pragma tangram: attributes\n#pragma tangram: camera\n#pragma tangram: material\n#pragma tangram: lighting\n#pragma tangram: raster\n#pragma tangram: global\n\nvoid main (void) {\n    // Initialize globals\n    #pragma tangram: setup\n\n    vec4 color = v_color;\n    vec3 normal = TANGRAM_NORMAL;\n\n    // Apply raster to vertex color\n    #ifdef TANGRAM_RASTER_TEXTURE_COLOR\n        vec4 _raster_color = sampleRaster(0);\n\n        #if defined(TANGRAM_BLEND_OPAQUE) || defined(TANGRAM_BLEND_TRANSLUCENT) || defined(TANGRAM_BLEND_MULTIPLY)\n            // Raster sources can optionally mask by the alpha channel, which will render with only full or no alpha.\n            // This is used for handling transparency outside the raster image in some blend modes,\n            // which either don't support alpha, or would cause transparent pixels to write to the depth buffer,\n            // obscuring geometry underneath.\n            #ifdef TANGRAM_HAS_MASKED_RASTERS   // skip masking logic if no masked raster sources\n            #ifndef TANGRAM_ALL_MASKED_RASTERS  // skip source check for masking if *all* raster sources are masked\n            if (u_raster_mask_alpha) {\n            #else\n            {\n            #endif\n                #if defined(TANGRAM_BLEND_TRANSLUCENT) || defined(TANGRAM_BLEND_MULTIPLY)\n                if (_raster_color.a < TANGRAM_EPSILON) {\n                    discard;\n                }\n                #else // TANGRAM_BLEND_OPAQUE\n                if (_raster_color.a < 1. - TANGRAM_EPSILON) {\n                    discard;\n                }\n                // only allow full alpha in opaque blend mode (avoids artifacts blending w/canvas tile background)\n                _raster_color.a = 1.;\n                #endif\n            }\n            #endif\n        #endif\n\n        color *= _raster_color; // multiplied to tint texture color\n    #endif\n\n    // Apply line texture\n    #ifdef TANGRAM_EXTRUDE_LINES\n    { // enclose in scope to avoid leakage of internal variables\n        if (u_has_line_texture) {\n            vec2 _line_st = vec2(v_texcoord.x, fract(v_texcoord.y / u_texture_ratio));\n            vec4 _line_color = texture2D(u_texture, _line_st);\n\n            // If the line has a dash pattern, the line texture indicates if the current fragment should be\n            // the dash foreground or background color. If the line doesn't have a dash pattern,\n            // the line texture color is used directly (but also tinted by the vertex color).\n            color = mix(\n                color * _line_color, // no dash: tint the line texture with the vertex color\n                mix(u_dash_background_color, color, _line_color.a), // choose dash foreground or background color\n                u_has_dash // 0 if no dash, 1 if has dash\n            );\n\n            // Use alpha discard test as a lower-quality substitute for blending\n            #if defined(TANGRAM_BLEND_OPAQUE)\n                if (color.a < TANGRAM_ALPHA_TEST) {\n                    discard;\n                }\n            #endif\n        }\n    }\n    #endif\n\n    // First, get normal from raster tile (if applicable)\n    #ifdef TANGRAM_RASTER_TEXTURE_NORMAL\n        normal = normalize(sampleRaster(0).rgb * 2. - 1.);\n    #endif\n\n    // Second, alter normal with normal map texture (if applicable)\n    #if defined(TANGRAM_LIGHTING_FRAGMENT) && defined(TANGRAM_MATERIAL_NORMAL_TEXTURE)\n        calculateNormal(normal);\n    #endif\n\n    // Normal modification applied here for fragment lighting or no lighting,\n    // and in vertex shader for vertex lighting\n    #if !defined(TANGRAM_LIGHTING_VERTEX)\n        #pragma tangram: normal\n    #endif\n\n    // Color modification before lighting is applied\n    #pragma tangram: color\n\n    #if defined(TANGRAM_LIGHTING_FRAGMENT)\n        // Calculate per-fragment lighting\n        color = calculateLighting(v_position.xyz - u_eye, normal, color);\n    #elif defined(TANGRAM_LIGHTING_VERTEX)\n        // Apply lighting intensity interpolated from vertex shader\n        color *= v_lighting;\n    #endif\n\n    // Post-processing effects (modify color after lighting)\n    #pragma tangram: filter\n\n    gl_FragColor = color;\n}\n",hs=Object.create(vo);Object.assign(hs,{name:"polygons",built_in:!0,vertex_shader_src:cs,fragment_shader_src:us,selection:!0,init:function(){vo.init.apply(this,arguments),this.defines.TANGRAM_NORMAL_ATTRIBUTE=!0,this.defines.TANGRAM_TEXTURE_COORDS=this.texcoords},_parseFeature:function(t,e,i){var r=this.feature_style;return r.color=this.parseColor(e.color,i),r.color?(r.alpha=Rn.evalCachedProperty(e.alpha,i),r.variant=e.variant,r.z=Rn.evalCachedDistanceProperty(e.z,i)||Rn.defaults.z,r.z*=an.height_scale,r.extrude=Rn.evalProperty(e.extrude,i),r.extrude&&(!0===r.extrude?(r.height=t.properties.height||Rn.defaults.height,r.min_height=t.properties.min_height||Rn.defaults.min_height):"number"==typeof r.extrude?(r.height=r.extrude,r.min_height=0):Array.isArray(r.extrude)&&(r.min_height=r.extrude[0],r.height=r.extrude[1]),r.height*=an.height_scale,r.min_height*=an.height_scale),r.tile_edges=e.tile_edges,r):null},_preprocess:function(t){return t.color=Rn.createColorPropertyCache(t.color),t.alpha=Rn.createPropertyCache(t.alpha),t.z=Rn.createPropertyCache(t.z,Rn.parseUnits),this.computeVariant(t),t},computeVariant:function(t){var e=t.interactive?1:0,i=null!=t.extrude?1:0,r=this.texcoords?1:0,n=this.getBlendOrderForDraw(t),o=[e,i,r,n].join("/");t.variant=o,null==this.variants[o]&&(this.variants[o]={key:o,blend_order:n,mesh_order:0,selection:e,normal:i,texcoords:r})},vertexLayoutForMeshVariant:function(t){if(null==this.vertex_layouts[t.key]){var e=[{name:"a_position",size:4,type:Xn.SHORT,normalized:!1},{name:"a_normal",size:3,type:Xn.BYTE,normalized:!0,static:t.normal?null:[0,0,1]},{name:"a_color",size:4,type:Xn.UNSIGNED_BYTE,normalized:!0},{name:"a_selection_color",size:4,type:Xn.UNSIGNED_BYTE,normalized:!0,static:t.selection?null:[0,0,0,0]},{name:"a_texcoord",size:2,type:Xn.UNSIGNED_SHORT,normalized:!0,static:t.texcoords?null:[0,0]}];this.addCustomAttributesToAttributeList(e),this.vertex_layouts[t.key]=new So(e)}return this.vertex_layouts[t.key]},meshVariantTypeForDraw:function(t){return this.variants[t.variant]},makeVertexTemplate:function(t,e){var i=0;return this.vertex_template[i++]=0,this.vertex_template[i++]=0,this.vertex_template[i++]=t.z||0,this.vertex_template[i++]=this.scaleOrder(t.order),e.variant.normal&&(this.vertex_template[i++]=0,this.vertex_template[i++]=0,this.vertex_template[i++]=127),this.vertex_template[i++]=255*t.color[0],this.vertex_template[i++]=255*t.color[1],this.vertex_template[i++]=255*t.color[2],this.vertex_template[i++]=255*(null!=t.alpha?t.alpha:t.color[3]),e.variant.selection&&(this.vertex_template[i++]=255*t.selection_color[0],this.vertex_template[i++]=255*t.selection_color[1],this.vertex_template[i++]=255*t.selection_color[2],this.vertex_template[i++]=255*t.selection_color[3]),e.variant.texcoords&&(this.vertex_template[i++]=0,this.vertex_template[i++]=0),this.addCustomAttributesToVertexTemplate(t,i),this.vertex_template},buildPolygons:function(t,e,i){var r=this.getTileMesh(i.tile,this.meshVariantTypeForDraw(e)),n=r.vertex_data,o=n.vertex_layout,s=this.makeVertexTemplate(e,r),a={texcoord_index:o.index.a_texcoord,texcoord_normalize:65535,remove_tile_edges:!e.tile_edges,tile_edge_tolerance:an.tile_scale*i.tile.pad_scale*4,winding:i.winding};return e.extrude&&e.height?function(t,e,i,r,n,o,s,a,l){var c=l.remove_tile_edges,u=l.tile_edge_tolerance,h=l.texcoord_index,d=l.texcoord_scale,p=l.texcoord_normalize,f=l.winding,A=e+(r||0),m=e+i;o[2]=m;var g=ls(t,n,o,{texcoord_index:h,texcoord_scale:d,texcoord_normalize:p}),_=n.vertex_elements,y=n.vertex_count;if(h){p=p||1;var v=d||Mo,x=v[0],b=v[1],w=v[2],T=v[3],B=[[x,T],[x,b],[w,b],[w,T]]}for(var E=t.length,C=0;C<E;C++)for(var S=t[C],I=0;I<S.length;I++)for(var M=S[I],k=0;k<M.length-1;k++)if(!c||!ko(M[k],M[k+1],u)){var P=void 0,L=void 0;"CCW"===f?(P=k,L=k+1):(P=k+1,L=k);var z=[[M[L][0],M[L][1],m],[M[L][0],M[L][1],A],[M[P][0],M[P][1],A],[M[P][0],M[P][1],m]],F=oo.normalize([M[L][0]-M[P][0],M[L][1]-M[P][1],0]),D=oo.cross(as,F);o[s+0]=D[0]*a,o[s+1]=D[1]*a,o[s+2]=D[2]*a;for(var R=0;R<z.length;R++)o[0]=z[R][0],o[1]=z[R][1],o[2]=z[R][2],h&&(o[h+0]=B[R][0]*p,o[h+1]=B[R][1]*p),n.addVertex(o);_.push(y+0),_.push(y+1),_.push(y+2),_.push(y+2),_.push(y+3),_.push(y+0),y+=4,g+=2}return g}(t,e.z,e.height,e.min_height,n,s,o.index.a_normal,127,a):ls(t,n,s,a)}});var ds=[0,0],ps={butt:0,square:1,round:2},fs={miter:0,bevel:1,round:2},As=3,ms=5,gs=65535,_s=an.tile_scale,ys=[0,0],vs=[1,0],xs=[.5,0];function bs(t,e){if(!(t.length<2)){var i,r,n,o,s=e.join_type,a=e.cap_type,l=e.closed_polygon,c=e.remove_tile_edges,u=e.tile_edge_tolerance,h=e.v_scale,d=e.miter_len_sq,p=null!=e.texcoord_index,f=0;if(l&&s===fs.miter){var A=function(t){if(Po(t[0]))return 0;for(var e=0;e<t.length;e++)if(Po(t[t.length-1-e]))return t.length-1-e;return 0}(t);if(0!==A){var m=function(t,e){for(var i=[],r=0;r<t.length;r++){var n=(r+e)%t.length;0!==n&&i.push(t[n])}return i.push(i[0]),i}(t,A);return e.extra_lines=e.extra_lines||[],void e.extra_lines.push(m)}}var g=0,_=t.length-1,y=0;for(i=t[g],r=t[g+1];oo.isEqual(i,r);)if(i=r,r=t[1+ ++g],y++,g===t.length-1)return;for(;oo.isEqual(t[_],t[_-1]);)if(y++,0==--_)return;if(!(t.length<2+y))if(o=oo.normalize(oo.perp(i,r)),c&&ko(i,r,u)){var v=ws(t,g,u);v&&(e.extra_lines=e.extra_lines||[],e.extra_lines.push(v))}else{l?function(t,e,i,r,n){void 0===r||Po(t)?(Ss(t,i,i,1,0,n,1),Ss(t,i,i,0,0,n,-1)):r===fs.miter?Bs(0,t,e,i,n.miter_len_sq,!0,n):Es(r,0,t,e,i,!0,n)}(i,n=oo.normalize(oo.perp(t[_-1],i)),o,s,e):(Po(i)||(ks(i,f,o,a,!0,e),p&&a!==ps.butt&&(f+=.5*h*e.texcoord_width)),Ss(i,o,o,1,f,e,1),Ss(i,o,o,0,f,e,-1)),p&&(f+=h*oo.length(oo.sub(r,i)));for(var x=g+1;x<_;x++){var b=x,w=x+1;if(i=t[b],r=t[w],!oo.isEqual(i,r)){if(c&&ko(i,r,u)){Ss(i,o,o,1,f,e,1),Ss(i,o,o,0,f,e,-1),Cs(1,e);var T=ws(t,b+1,u);return void(T&&(e.extra_lines=e.extra_lines||[],e.extra_lines.push(T)))}n=o,o=oo.normalize(oo.perp(i,r)),s===fs.miter?Bs(f,i,n,o,d,!1,e):Es(s,f,i,n,o,!1,e),p&&(f+=h*oo.length(oo.sub(r,i)))}}i=r,n=o,l?function(t,e,i,r,n,o){if(Po(t))Ss(t,e,e,1,n,o,1),Ss(t,e,e,0,n,o,-1),Cs(1,o);else{var s=Ts(e,i);r===fs.miter&&oo.lengthSq(s)>o.miter_len_sq&&(r=fs.bevel),r===fs.miter?(Ss(t,s,e,1,n,o,1),Ss(t,s,e,0,n,o,-1),Cs(1,o)):(Ss(t,e,e,1,n,o,1),Ss(t,e,e,0,n,o,-1),Cs(1,o))}}(i,n,o=oo.normalize(oo.perp(i,t[1])),s,f,e):(Ss(i,n,o,1,f,e,1),Ss(i,n,o,0,f,e,-1),Cs(1,e),Po(i)||ks(i,f,n,a,!1,e))}}}function ws(t,e,i){for(var r=e;t[r+1]&&ko(t[r],t[r+1],i);)r++;return t.length-r>=2&&t.slice(r)}function Ts(t,e){var i=oo.normalize(oo.add(t,e)),r=2/(1+Math.abs(oo.dot(t,i)));return oo.mult(i,r*r)}function Bs(t,e,i,r,n,o,s){var a=Ts(i,r);oo.lengthSq(a)>n?Es(fs.bevel,t,e,i,r,o,s):(Ss(e,a,a,1,t,s,1),Ss(e,a,a,0,t,s,-1),o||Cs(1,s))}function Es(t,e,i,r,n,o,s){var a=Ts(r,n),l=n[0]*r[1]-n[1]*r[0]>0;null!=s.texcoord_index&&(ys[1]=e,vs[1]=e),l?(Ss(i,a,a,1,e,s,1),Ss(i,r,a,0,e,s,-1),o||Cs(1,s),Ms(i,oo.neg(r),a,oo.neg(n),a,ys,vs,ys,!1,t===fs.bevel,s),Ss(i,a,a,1,e,s,1),Ss(i,n,a,0,e,s,-1)):(Ss(i,r,a,1,e,s,1),Ss(i,a,a,0,e,s,-1),o||Cs(1,s),Ms(i,r,oo.neg(a),n,a,vs,ys,vs,!1,t===fs.bevel,s),Ss(i,n,a,1,e,s,1),Ss(i,a,a,0,e,s,-1))}function Cs(t,e){for(var i=e.vertex_data.vertex_elements,r=e.vertex_data.vertex_count-2*t-2,n=0;n<t;n++)i.push(r+2*n+2),i.push(r+2*n+1),i.push(r+2*n+0),i.push(r+2*n+2),i.push(r+2*n+3),i.push(r+2*n+1),e.geom_count+=2}function Ss(t,e,i,r,n,o,s){var a=o.vertex_template,l=o.vertex_data;a[0]=t[0],a[1]=t[1];var c=o.half_width*s;a[o.extrude_index+0]=e[0]*c,a[o.extrude_index+1]=e[1]*c,o.offset&&(a[o.offset_index+0]=i[0]*o.offset,a[o.offset_index+1]=i[1]*o.offset),null!=o.texcoord_index&&(a[o.texcoord_index+0]=r*gs,a[o.texcoord_index+1]=n*gs),l.addVertex(a)}var Is=[0,0];function Ms(t,e,i,r,n,o,s,a,l,c,u){for(var h=e[0]*r[1]-e[1]*r[0],d=oo.dot(e,r),p=Math.atan2(h,d);p>=Math.PI;)p-=2*Math.PI;if(c)f=1;else{var f=function(t,e){t<0&&(t=-t);var i=e>2*ms?Math.log2(e/ms):1;return Math.ceil(t/Math.PI*i)}(p,u.half_width);if(f<1)return}var A=u.vertex_data.vertex_count,m=u.vertex_data.vertex_elements;Ss(t,i,n,s[0],s[1],u,1),Ss(t,e,n,o[0],o[1],u,1);var g=e,_=null!=u.texcoord_index;if(_)if(l)var y=oo.sub(o,s);else{Is=oo.copy(o);var v=oo.div(oo.sub(a,o),f)}var x,b,w=p/f,T=p<0?-1:1;h>0?(x=2,b=1):(x=1,b=2);for(var B=0;B<f;B++)0===B&&p<0&&(g=oo.neg(g)),g=oo.rot(g,w),_&&(l?(y=oo.rot(y,w),Is[0]=y[0]+s[0],Is[1]=y[1]*u.texcoord_width*u.v_scale+s[1]):Is=oo.add(Is,v)),Ss(t,g,n,Is[0],Is[1],u,T),m.push(A+B+x),m.push(A),m.push(A+B+b)}function ks(t,e,i,r,n,o){var s=oo.neg(i),a=null!=o.texcoord_index;switch(r){case ps.square:var l;n?(l=[i[1],-i[0]],Ss(t,oo.add(i,l),i,1,e,o,1),Ss(t,oo.add(s,l),i,0,e,o,1),a&&(e+=.5*o.texcoord_width*o.v_scale),Ss(t,i,i,1,e,o,1),Ss(t,s,i,0,e,o,1)):(l=[-i[1],i[0]],Ss(t,i,i,1,e,o,1),Ss(t,s,i,0,e,o,1),a&&(e+=.5*o.texcoord_width*o.v_scale),Ss(t,oo.add(i,l),i,1,e,o,1),Ss(t,oo.add(s,l),i,0,e,o,1)),Cs(1,o);break;case ps.round:var c,u,h=ys,d=vs,p=xs;n?(c=i,u=s,a&&(e+=.5*o.texcoord_width*o.v_scale,h=vs,d=ys,p=xs)):(c=s,u=i),a&&(ys[1]=e,vs[1]=e,xs[1]=e),Ms(t,c,ds,u,i,h,p,d,!0,!1,o);break;case ps.butt:return}}var Ps=[255,255,255,255],Ls=[0,0,0,0],zs=Object.create(vo);Object.assign(zs,{name:"lines",built_in:!0,vertex_shader_src:cs,fragment_shader_src:us,selection:!0,init:function(){vo.init.apply(this,arguments),this.defines.TANGRAM_EXTRUDE_LINES=!0,this.defines.TANGRAM_TEXTURE_COORDS=!0,this.outline_feature_style={},this.inline_feature_style=this.feature_style,this.dash_textures={}},calcDistance:function(t,e){return Rn.evalCachedDistanceProperty(t,e)||0},calcDistanceNextZoom:function(t,e){e.zoom++;var i=this.calcDistance(t,e);return e.zoom--,i},calcWidth:function(t,e,i){var r=this.calcDistance(t.width,i);if(!(r<0)){var n;if(n=t.next_width?this.calcDistanceNextZoom(t.next_width,i):r/2,0===r&&0===n||n<0)return!1;if(e.width_unscaled=r,e.next_width_unscaled=n,t.next_width){var o=.5*(r+(n*=2));e.width=o*i.units_per_meter_overzoom,e.width_scale=1-n/o}else e.width=r*i.units_per_meter_overzoom,e.width_scale=0;return t.texcoords&&(t.inline_texcoord_width?e.texcoord_width=t.inline_texcoord_width:e.texcoord_width=(e.width_unscaled||e.next_width_unscaled)*i.units_per_meter_overzoom/i.tile.overzoom2),!0}},calcOffset:function(t,e,i){if(t.offset_precalc)e.offset=t.offset_precalc,e.offset_scale=t.offset_scale_precalc;else if(t.offset){var r=this.calcDistance(t.offset,i);if(t.next_offset){var n=2*this.calcDistanceNextZoom(t.next_offset,i);Math.abs(r)>=Math.abs(n)?(e.offset=r*i.units_per_meter_overzoom,e.offset_scale=0!==r?1-n/r:0):(e.offset=n*i.units_per_meter_overzoom,e.offset_scale=0!==n?-1*(1-r/n):0)}else e.offset=r*i.units_per_meter_overzoom,e.offset_scale=0}else e.offset=0,e.offset_scale=0},_parseFeature:function(t,e,i){var r=this.feature_style;if(!1!==this.calcWidth(e,r,i)&&(this.calcOffset(e,r,i),r.color=this.parseColor(e.color,i),r.color)){if(r.alpha=Rn.evalCachedProperty(e.alpha,i),r.variant=e.variant,r.z=Rn.evalCachedDistanceProperty(e.z,i)||Rn.defaults.z,r.height=t.properties.height||Rn.defaults.height,r.extrude=Rn.evalProperty(e.extrude,i),r.extrude&&("number"==typeof r.extrude?r.height=r.extrude:Array.isArray(r.extrude)&&(r.height=r.extrude[1])),r.extrude&&r.height&&(r.z+=r.height),r.z*=an.height_scale,r.cap=e.cap,r.join=e.join,r.miter_limit=e.miter_limit,r.tile_edges=e.tile_edges,r.outline=r.outline||{width:{},next_width:{},preprocessed:!0},e.outline&&!1!==e.outline.visible&&e.outline.color&&e.outline.width){var n=2*this.calcDistance(e.outline.width,i),o=2*this.calcDistanceNextZoom(e.outline.next_width,i);0===n&&0===o||n<0||o<0?(r.outline.width.value=null,r.outline.next_width.value=null,r.outline.color=null,r.outline.inline_texcoord_width=null,r.outline.texcoords=!1):(r.outline.width.value=n+r.width_unscaled,r.outline.next_width.value=o+r.next_width_unscaled,r.outline.inline_texcoord_width=r.texcoord_width,r.outline.offset_precalc=r.offset,r.outline.offset_scale_precalc=r.offset_scale,r.outline.color=e.outline.color,r.outline.alpha=e.outline.alpha,r.outline.interactive=e.outline.interactive,r.outline.cap=e.outline.cap,r.outline.join=e.outline.join,r.outline.miter_limit=e.outline.miter_limit,r.outline.texcoords=e.outline.texcoords,r.outline.extrude=e.outline.extrude,r.outline.z=e.outline.z,r.outline.style=e.outline.style,r.outline.variant=e.outline.variant,e.outline.order?r.outline.order=this.parseOrder(e.outline.order,i):r.outline.order=r.order,r.outline.order>r.order&&(r.outline.order=r.order),r.outline.order-=.5)}else r.outline.width.value=null,r.outline.next_width.value=null,r.outline.color=null,r.outline.inline_texcoord_width=null;return r}},_preprocess:function(t){if(t.color=Rn.createColorPropertyCache(t.color),t.alpha=Rn.createPropertyCache(t.alpha),t.width=Rn.createPropertyCache(t.width,Rn.parseUnits),t.width&&t.width.type!==Rn.CACHE_TYPE.STATIC&&(t.next_width=Rn.createPropertyCache(t.width,Rn.parseUnits)),t.offset=t.offset&&Rn.createPropertyCache(t.offset,Rn.parseUnits),t.offset&&t.offset.type!==Rn.CACHE_TYPE.STATIC&&(t.next_offset=Rn.createPropertyCache(t.offset,Rn.parseUnits)),t.z=Rn.createPropertyCache(t.z,Rn.parseUnits),t.dash=void 0!==t.dash?t.dash:this.dash,t.dash_key=t.dash&&this.dashTextureKey(t.dash),t.dash_background_color=void 0!==t.dash_background_color?t.dash_background_color:this.dash_background_color,t.dash_background_color=t.dash_background_color&&Rn.parseColor(t.dash_background_color),t.texture_merged=t.dash_key||(void 0!==t.texture?t.texture:this.texture),t.texcoords=this.texcoords||t.texture_merged?1:0,this.computeVariant(t),t.outline){t.outline.is_outline=!0,t.outline.style=t.outline.style||this.name,t.outline.color=Rn.createColorPropertyCache(t.outline.color),t.outline.alpha=Rn.createPropertyCache(t.outline.alpha),t.outline.width=Rn.createPropertyCache(t.outline.width,Rn.parseUnits),t.outline.next_width=Rn.createPropertyCache(t.outline.width,Rn.parseUnits),t.outline.interactive=null!=t.outline.interactive?t.outline.interactive:t.interactive,t.outline.cap=t.outline.cap||t.cap,t.outline.join=t.outline.join||t.join,t.outline.miter_limit=null!=t.outline.miter_limit?t.outline.miter_limit:t.miter_limit,t.outline.offset=t.offset,t.outline.extrude=t.extrude,t.outline.z=t.z;var e=this.styles[t.outline.style];e?(t.outline.dash=void 0!==t.outline.dash?t.outline.dash:e.dash,t.outline.texture=void 0!==t.outline.texture?t.outline.texture:e.texture,null!=t.outline.dash?(t.outline.dash_key=t.outline.dash&&this.dashTextureKey(t.outline.dash),t.outline.texture_merged=t.outline.dash_key):null===t.outline.dash||null!=t.outline.texture?(t.outline.dash_key=null,t.outline.texture_merged=t.outline.texture):(t.outline.dash=t.dash,t.outline.dash_key=t.outline.dash&&this.dashTextureKey(t.outline.dash),t.outline.texture_merged=t.outline.dash_key),t.outline.dash_background_color=void 0!==t.outline.dash_background_color?t.outline.dash_background_color:e.dash_background_color,t.outline.dash_background_color=void 0!==t.outline.dash_background_color?t.outline.dash_background_color:t.dash_background_color,t.outline.dash_background_color=t.outline.dash_background_color&&Rn.parseColor(t.outline.dash_background_color),t.outline.texcoords=e.texcoords||t.outline.texture_merged?1:0,void 0===t.outline.blend_order&&null!=t.blend_order&&(t.outline.blend_order=t.blend_order),e.computeVariant(t.outline)):(Ki({level:"warn",once:!0},"Layer group '"+t.layers.join(", ")+"': line 'outline' specifies non-existent draw style '"+t.outline.style+"' (or maybe the style is defined but is missing a 'base' or has another error), skipping outlines for features matching this layer group"),t.outline=null)}return t},dashTextureKey:function(t){return"__dash_"+JSON.stringify(t)},getDashTexture:function(t){var e=this.dashTextureKey(t);if(null==this.dash_textures[e]){this.dash_textures[e]=!0;var i=function(t,e){void 0===e&&(e={});var i=e.dash_color||Ps,r=e.background_color||Ls,n=t,o=e.scale||1;n.length%2==1&&Array.prototype.push.apply(n,n);for(var s=!0,a=[],l=0;l<n.length;l++){for(var c=Math.floor(n[l]*o),u=0;u<c;u++)Array.prototype.push.apply(a,s?i:r);s=!s}return a.reverse(),{pixels:a=new Uint8Array(a),length:a.length/4}}(t,{scale:20});Hr.create(this.gl,e,{data:i.pixels,height:i.length,width:1,filtering:"nearest"})}},endData:function(t){return new Promise(function(e,i){var r,n,o,s;return r=this,Promise.resolve(vo.endData.call(this,t)).then(function(t){try{if(n=t){n.uniforms.u_has_line_texture=!1,n.uniforms.u_texture=Hr.default,n.uniforms.u_v_scale_adjust=an.tile_scale,o=[],s=function(t){return new Promise((function(e,i){var s,a,l;if((s=n.meshes[t].variant).texture){if((a=n.meshes[t].uniforms=n.meshes[t].uniforms||{}).u_has_line_texture=!0,a.u_texture=s.texture,a.u_texture_ratio=1,s.dash&&(a.u_v_scale_adjust=20*an.tile_scale,a.u_has_dash=null!=s.dash_background_color?1:0,a.u_dash_background_color=s.dash_background_color||[0,0,0,0]),s.dash_key&&null==r.dash_textures[s.dash_key]){r.dash_textures[s.dash_key]=!0;var c=function(){try{return h.call(this)}catch(t){return i(t)}}.bind(this),u=function(t){try{return Ki("trace",r.name+": line dash texture create failed because style no longer on main thread"),c()}catch(t){return i(t)}};try{return Promise.resolve(Qi.postMessage(r.main_thread_target+".getDashTexture",s.dash)).then((function(t){try{return c()}catch(t){return u()}}),u)}catch(p){u()}}function h(){return null==Hr.textures[s.texture]?o.push(Hr.syncTexturesToWorker([s.texture]).then((function(t){var e=t[s.texture];e&&(a.u_texture_ratio=e.height/e.width)}))):(l=Hr.textures[s.texture],a.u_texture_ratio=l.height/l.width),d.call(this)}return h.call(this)}function d(){return e()}return d.call(this)}))};var a,l,c,u=[];for(a in n.meshes)u.push(a);function h(){return u.length?(l=u.shift(),Promise.resolve(s(l)).then((function(t){try{return h}catch(t){return i(t)}}),i)):[1]}return(c=function(t){for(;t;){if(t.then)return void t.then(c,i);try{if(t.pop){if(t.length)return t.pop()?d.call(this):t;t=h}else t=t.call(this)}catch(t){return i(t)}}}.bind(this))(h);function d(){return Promise.resolve(Promise.all(o)).then(function(t){try{return p.call(this)}catch(t){return i(t)}}.bind(this),i)}}function p(){return e(n)}return p.call(this)}catch(t){return i(t)}}.bind(this),i)}.bind(this))},computeVariant:function(t){var e=t.offset?1:0;e+="/"+t.texcoords,e+="/"+(t.interactive?1:0),e+="/"+(t.extrude||t.z?1:0),e+="/"+t.is_outline,t.dash_key&&(e+=t.dash_key,t.dash_background_color&&(e+=t.dash_background_color)),t.texture_merged&&(e+=t.texture_merged);var i=this.getBlendOrderForDraw(t);e=qr(e+="/"+i),t.variant=e,null==this.variants[e]&&(this.variants[e]={key:e,blend_order:i,mesh_order:t.is_outline?0:1,selection:t.interactive?1:0,offset:t.offset?1:0,z_or_offset:t.offset||t.extrude||t.z?1:0,texcoords:t.texcoords,texture:t.texture_merged,dash:t.dash,dash_key:t.dash_key,dash_background_color:t.dash_background_color})},vertexLayoutForMeshVariant:function(t){if(null==this.vertex_layouts[t.key]){var e=[{name:"a_position",size:4,type:Xn.SHORT,normalized:!1},{name:"a_extrude",size:2,type:Xn.SHORT,normalized:!1},{name:"a_offset",size:2,type:Xn.SHORT,normalized:!1,static:t.offset?null:[0,0]},{name:"a_z_and_offset_scale",size:2,type:Xn.SHORT,normalized:!1,static:t.z_or_offset?null:[0,0]},{name:"a_texcoord",size:2,type:Xn.UNSIGNED_SHORT,normalized:!0,static:t.texcoords?null:[0,0]},{name:"a_color",size:4,type:Xn.UNSIGNED_BYTE,normalized:!0},{name:"a_selection_color",size:4,type:Xn.UNSIGNED_BYTE,normalized:!0,static:t.selection?null:[0,0,0,0]}];this.addCustomAttributesToAttributeList(e),this.vertex_layouts[t.key]=new So(e)}return this.vertex_layouts[t.key]},meshVariantTypeForDraw:function(t){return this.variants[t.variant]},makeVertexTemplate:function(t,e){var i=0;return this.vertex_template[i++]=0,this.vertex_template[i++]=0,this.vertex_template[i++]=1024*t.width_scale,this.vertex_template[i++]=this.scaleOrder(t.order),this.vertex_template[i++]=0,this.vertex_template[i++]=0,e.variant.offset&&(this.vertex_template[i++]=0,this.vertex_template[i++]=0),e.variant.z_or_offset&&(this.vertex_template[i++]=t.z||0,this.vertex_template[i++]=1024*t.offset_scale),e.variant.texcoords&&(this.vertex_template[i++]=0,this.vertex_template[i++]=0),this.vertex_template[i++]=255*t.color[0],this.vertex_template[i++]=255*t.color[1],this.vertex_template[i++]=255*t.color[2],this.vertex_template[i++]=255*(null!=t.alpha?t.alpha:t.color[3]),e.variant.selection&&(this.vertex_template[i++]=255*t.selection_color[0],this.vertex_template[i++]=255*t.selection_color[1],this.vertex_template[i++]=255*t.selection_color[2],this.vertex_template[i++]=255*t.selection_color[3]),this.addCustomAttributesToVertexTemplate(t,i),this.vertex_template},buildLines:function(t,e,i,r){if(this.feature_style=this.outline_feature_style,e.outline&&null!=e.outline.color&&null!=e.outline.width.value){var n=this.styles[e.outline.style];n&&n.addFeature(i.feature,e.outline,i)}this.feature_style=this.inline_feature_style;var o=this.getTileMesh(i.tile,this.meshVariantTypeForDraw(e)),s=o.vertex_data,a=s.vertex_layout;return function(t,e,i,r,n,o,s,a){var l,c=e.cap?ps[e.cap]:ps.butt,u=e.join?fs[e.join]:fs.miter;if(u===fs.miter)var h=e.miter_limit||As,d=h*h;n.a_texcoord&&(l=1/(e.texcoord_width*_s));for(var p={closed_polygon:o,remove_tile_edges:s,tile_edge_tolerance:a,miter_len_sq:d,join_type:u,cap_type:c,vertex_data:i,vertex_template:r,half_width:e.width/2,extrude_index:n.a_extrude,offset_index:n.a_offset,v_scale:l,texcoord_index:n.a_texcoord,texcoord_width:e.texcoord_width,offset:e.offset,geom_count:0},f=0;f<t.length;f++)bs(t[f],p);if(p.extra_lines)for(var A=0;A<p.extra_lines.length;A++)bs(p.extra_lines[A],p);return p.geom_count}(t,e,s,this.makeVertexTemplate(e,o),a.index,r&&r.closed_polygon,!e.tile_edges&&r&&r.remove_tile_edges,an.tile_scale*i.tile.pad_scale*2)},buildPolygons:function(t,e,i){for(var r=0,n=0;n<t.length;n++)r+=this.buildLines(t[n],e,i,{closed_polygon:!0,remove_tile_edges:!0});return r}}),no("anchor",(function(t){return function(e){return t(this,"a","name",e)}}));var Fs=128/Math.PI,Ds=16384/Math.PI,Rs=64,Us=65535,Os=128,Ns=[0,2,2,0],Qs=[1,1,3,3],Vs=new Array(4),js=["left","top-left","bottom-left"],Hs=["right","top-right","bottom-right"],Gs=["top","top-left","top-right"],$s=["bottom","bottom-left","bottom-right"],Zs={computeOffset:function(t,e,i,r){if(void 0===r&&(r=null),!i||"center"===i)return t;var n=[t[0],t[1]];return r=r||this.default_buffer,this.isLeftAnchor(i)?(n[0]-=e[0]/2,"left"===i&&(n[0]-=r[0])):this.isRightAnchor(i)&&(n[0]+=e[0]/2,"right"===i&&(n[0]+=r[1])),this.isTopAnchor(i)?(n[1]-=e[1]/2,"top"===i&&(n[1]-=r[2])):this.isBottomAnchor(i)&&(n[1]+=e[1]/2,"bottom"===i&&(n[1]+=r[3])),n},alignForAnchor:function(t){if(t&&"center"!==t){if(this.isLeftAnchor(t))return"right";if(this.isRightAnchor(t))return"left"}return"center"},isLeftAnchor:function(t){return js.indexOf(t)>-1},isRightAnchor:function(t){return Hs.indexOf(t)>-1},isTopAnchor:function(t){return Gs.indexOf(t)>-1},isBottomAnchor:function(t){return $s.indexOf(t)>-1},default_buffer:[2.5,2.5,1.5,.75],zero_buffer:[0,0,0,0]};function qs(t,e){return!(t[2]<e[0]||t[0]>e[2]||t[3]<e[1]||t[1]>e[3])}var Ks,Ws,Xs,Js,Ys=[[1,0],[0,1]],ta=[],ea=[],ia=function(){function t(t,e,i,r,n){this.dimension=[r/2,n/2],this.angle=i,this.centroid=[t,e],this.quad=null,this.axis_0=null,this.axis_1=null,this.update()}var e=t.prototype;return e.toJSON=function(){return{x:this.centroid[0],y:this.centroid[1],a:this.angle,w:this.dimension[0],h:this.dimension[1]}},e.getExtent=function(){return 0===this.angle?[this.quad[0],this.quad[1],this.quad[4],this.quad[5]]:[Math.min(this.quad[0],this.quad[2],this.quad[4],this.quad[6]),Math.min(this.quad[1],this.quad[3],this.quad[5],this.quad[7]),Math.max(this.quad[0],this.quad[2],this.quad[4],this.quad[6]),Math.max(this.quad[1],this.quad[3],this.quad[5],this.quad[7])]},e.updateAxes=function(){this.axis_0=oo.normalize([this.quad[4]-this.quad[6],this.quad[5]-this.quad[7]]),this.axis_1=oo.normalize([this.quad[4]-this.quad[2],this.quad[5]-this.quad[3]])},e.update=function(){var t=this.centroid,e=this.dimension[0],i=this.dimension[1];if(0===this.angle)this.quad=[t[0]-e,t[1]-i,t[0]+e,t[1]-i,t[0]+e,t[1]+i,t[0]-e,t[1]+i],this.axis_0=Ys[0],this.axis_1=Ys[1];else{var r=Math.cos(this.angle)*e,n=Math.sin(this.angle)*e,o=-Math.sin(this.angle)*i,s=Math.cos(this.angle)*i;this.quad=[t[0]-r-o,t[1]-n-s,t[0]+r-o,t[1]+n-s,t[0]+r+o,t[1]+n+s,t[0]-r+o,t[1]-n+s],this.updateAxes()}},t.projectToAxis=function(t,e,i){var r=t.quad;return Ks=r[0]*e[0]+r[1]*e[1],Ws=r[2]*e[0]+r[3]*e[1],Xs=r[4]*e[0]+r[5]*e[1],Js=r[6]*e[0]+r[7]*e[1],i[0]=Math.min(Ks,Ws,Xs,Js),i[1]=Math.max(Ks,Ws,Xs,Js),i},t.axisCollide=function(e,i,r,n){return t.projectToAxis(e,r,ta),t.projectToAxis(i,r,ea),!(ea[0]>ta[1]||ea[1]<ta[0]||(t.projectToAxis(e,n,ta),t.projectToAxis(i,n,ea),ea[0]>ta[1]||ea[1]<ta[0]))},t.intersect=function(e,i){return t.axisCollide(e,i,e.axis_0,e.axis_1)&&t.axisCollide(e,i,i.axis_0,i.axis_1)},t}(),ra=function(){function t(e,i){void 0===i&&(i={}),this.id=t.nextLabelId(),this.type="",this.size=e,this.layout=i,this.position=null,this.angle=0,this.anchor=Array.isArray(this.layout.anchor)?this.layout.anchor[0]:this.layout.anchor,this.placed=null,this.offset=i.offset,this.unit_scale=this.layout.units_per_pixel,this.aabb=null,this.obb=null,this.align="center",this.throw_away=!1}var e=t.prototype;return e.toJSON=function(){return{id:this.id,type:this.type,obb:this.obb.toJSON(),position:this.position,angle:this.angle,size:this.size,offset:this.offset,breach:this.breach,may_repeat_across_tiles:this.may_repeat_across_tiles,layout:na(this.layout)}},e.update=function(){this.align=this.layout.align||Zs.alignForAnchor(this.anchor)},e.occluded=function(t,e){var i=this;void 0===e&&(e=null);var r=!1,n=t.aabb,o=t.obb;return n.length>0&&function(t,e,i){for(var r=0;r<e.length&&(!qs(t,e[r])||null==i(r));r++);}(this.aabb,n,(function(t){if(!e||n[t]!==e.aabb)return 0===i.obb.angle&&0===o[t].angle||ia.intersect(i.obb,o[t])?(r=!0,!0):void 0})),r},e.inTileBounds=function(){return this.aabb[0]>=0&&this.aabb[1]>-an.tile_scale&&this.aabb[0]<an.tile_scale&&this.aabb[1]<=0||this.aabb[2]>=0&&this.aabb[3]>-an.tile_scale&&this.aabb[2]<an.tile_scale&&this.aabb[3]<=0},e.mayRepeatAcrossTiles=function(){if(this.layout.collide)return!0;var t=this.layout.repeat_distance;return 0!==t&&(Math.abs(this.position[0])<t||Math.abs(this.position[0]-an.tile_scale)<t||Math.abs(this.position[1])<t||Math.abs(-(this.position[1]-an.tile_scale))<t)},e.discard=function(t,e){return void 0===e&&(e=null),!!this.throw_away||this.occluded(t,e)},t}();function na(t){return{priority:t.priority,collide:t.collide,repeat_distance:t.repeat_distance,repeat_group:t.repeat_group,buffer:t.buffer,italic:t.italic}}ra.add=function(t,e){if(t.placed=!0,t.aabb&&(e.aabb.push(t.aabb),e.obb.push(t.obb)),t.aabbs)for(var i=0;i<t.aabbs.length;i++)e.aabb.push(t.aabbs[i]),e.obb.push(t.obbs[i])},ra.id=0,ra.id_prefix=0,ra.id_multiplier=0,ra.nextLabelId=function(){return ra.id_prefix+ra.id++*ra.id_multiplier},ra.epsilon=.9999;var oa=function(){function t(t,e){this.key=t,this.repeat_dist=e,this.repeat_dist_sq=this.repeat_dist*this.repeat_dist,this.positions=[]}var e=t.prototype;return e.check=function(t){for(var e=t.position,i=0;i<this.positions.length;i++){var r=this.positions[i],n=e[0]-r[0],o=e[1]-r[1];if(n*n+o*o<this.repeat_dist_sq)return!0}},e.add=function(t){t&&t.position&&this.positions.push(t.position)},t.clear=function(t){this.groups[t]={}},t.check=function(t,e,i){if(e.repeat_distance&&e.repeat_group&&this.groups[i][e.repeat_group])return this.groups[i][e.repeat_group].check(t)},t.add=function(e,i,r){i.repeat_distance&&i.repeat_group&&(null==this.groups[r][i.repeat_group]&&(this.groups[r][i.repeat_group]=new t(i.repeat_group,i.repeat_distance*i.repeat_scale)),this.groups[r][i.repeat_group].add(e))},t}();oa.groups={};var sa=function(){function t(t,e){this.anchor=t,this.span=e,this.cells={}}var e=t.prototype;return e.addLabel=function(t){var e=this;t.aabb&&this.addLabelBboxes(t,t.aabb),t.aabbs&&t.aabbs.forEach((function(i){return e.addLabelBboxes(t,i)}))},e.addLabelBboxes=function(t,e){var i=[Math.max(Math.floor((e[0]-this.anchor.x)/this.span),0),Math.max(Math.floor(-(e[1]-this.anchor.y)/this.span),0),Math.max(Math.floor((e[2]-this.anchor.x)/this.span),0),Math.max(Math.floor(-(e[3]-this.anchor.y)/this.span),0)];t.cells=[];for(var r=i[1];r<=i[3];r++){this.cells[r]=this.cells[r]||{};for(var n=i[0];n<=i[2];n++)this.cells[r][n]=this.cells[r][n]||{aabb:[],obb:[]},t.cells.push(this.cells[r][n])}},t}(),aa={tiles:{},grid:null,initGrid:function(t){this.grid=null==t?null:new sa(t.anchor,t.span)},startTile:function(t,e){var i=void 0===e?{}:e,r=i.apply_repeat_groups,n=void 0===r||r,o=i.return_hidden,s=void 0!==o&&o,a=this.tiles[t]={bboxes:{aabb:[],obb:[]},objects:{},labels:{},styles:{},repeat:n,return_hidden:s};null==a.complete&&(a.complete=new Promise((function(t,e){a.resolve=t,a.reject=e})))},resetTile:function(t){delete this.tiles[t]},abortTile:function(t){this.tiles[t]&&this.tiles[t].resolve&&this.tiles[t].resolve([]),this.resetTile(t)},addStyle:function(t,e){this.tiles[e].styles[t]=!0},collide:function(t,e,i){var r=this.tiles[i];if(!r)return Ki("trace","Collision.collide() called with null tile",i,this.tiles,e,t),Promise.resolve([]);for(var n=r.objects,o=0;o<t.length;o++){var s=t[o],a=s.label.layout.priority;n[a]=n[a]||{},n[a][e]=n[a][e]||[],n[a][e].push(s)}return delete r.styles[e],0===Object.keys(r.styles).length&&this.endTile(i),r.complete.then((function(){return r.resolve=null,r.labels[e]||[]}))},endTile:function(t){var e=this.tiles[t],i=e.labels;this.grid&&this.addLabelsToGrid(t),e.repeat&&oa.clear(t);for(var r=Object.keys(e.objects).sort((function(t,e){return t-e})),n=0;n<r.length;n++){var o=e.objects[r[n]];if(o)for(var s in o){var a=o[s];i[s]=i[s]||[];for(var l=0;l<a.length;l++){var c=a[l];this.canBePlaced(c,t,c.linked,e)?c.linked?this.canBePlaced(c.linked,t,c,e)?(c.show=!0,(c.label.breach||c.linked.label.breach)&&(c.label.breach=!0,c.linked.label.breach=!0),(c.label.may_repeat_across_tiles||c.linked.label.may_repeat_across_tiles)&&(c.label.may_repeat_across_tiles=!0,c.linked.label.may_repeat_across_tiles=!0),i[s].push(c),this.place(c,t,e),this.place(c.linked,t,e)):e.return_hidden&&(c.show=!1,i[s].push(c)):(c.show=!0,i[s].push(c),this.place(c,t,e)):e.return_hidden&&(c.show=!1,i[s].push(c))}}}delete this.tiles[t],e.resolve()},addLabelsToGrid:function(t){var e=this,i=this.tiles[t];for(var r in i.objects){var n=i.objects[r];if(n)for(var o in n)n[o].forEach((function(t){return e.grid.addLabel(t.label)}))}},canBePlaced:function(t,e,i,r){void 0===i&&(i=null);var n=(void 0===r?{}:r).repeat,o=void 0===n||n,s=t.label,a=t.label.layout;if(null!=s.placed)return s.placed;var l=!a.collide;if(l||(l=this.grid&&s.cells?s.cells.reduce((function(t,e){return t&&s.discard(e,i&&i.label)&&(t=!1),t}),!0):!s.discard(this.tiles[e].bboxes,i&&i.label)),l){if(!o||!oa.check(s,a,e))return!0;s.placed=!1}else a.collide&&(s.placed=!1);return s.placed},place:function(t,e,i){var r=t.label,n=i.repeat,o=void 0===n||n;null==r.placed&&(o&&oa.add(r,r.layout,e),this.grid&&r.cells?r.cells.forEach((function(t){return ra.add(r,t)})):ra.add(r,this.tiles[e].bboxes))}},la=function(t){function e(e,i,r,n){var o;return void 0===n&&(n=0),(o=t.call(this,i,r)||this).type="point",o.position=[e[0],e[1]],o.angle=n,o.parent=o.layout.parent,o.update(),o.start_anchor_index=1,o.degenerate=!(o.size[0]||o.size[1]||o.layout.buffer[0]||o.layout.buffer[1]),o.throw_away=!1,o}fe(e,t);var i=e.prototype;return i.update=function(){t.prototype.update.call(this),this.computeOffset(),this.updateBBoxes()},i.computeOffset=function(){if(this.offset=[this.layout.offset[0],this.layout.offset[1]],this.parent){var t=this.parent;this.offset=Zs.computeOffset(this.offset,t.size,t.anchor,Zs.zero_buffer),this.offset=Zs.computeOffset(this.offset,t.size,this.anchor,Zs.zero_buffer),t.offset!==Rn.zeroPair&&(this.offset===Rn.zeroPair?this.offset=t.offset:(this.offset[0]+=t.offset[0],this.offset[1]+=t.offset[1]))}this.offset=Zs.computeOffset(this.offset,this.size,this.anchor)},i.updateBBoxes=function(){var t=(this.size[0]+2*this.layout.buffer[0])*this.unit_scale*ra.epsilon,e=(this.size[1]+2*this.layout.buffer[1])*this.unit_scale*ra.epsilon;this.layout.italic&&(t+=5*this.unit_scale),this.obb=new ia(this.position[0]+this.offset[0]*this.unit_scale,this.position[1]-this.offset[1]*this.unit_scale,-this.angle,t,e),this.aabb=this.obb.getExtent(),this.inTileBounds&&(this.breach=!this.inTileBounds()),this.mayRepeatAcrossTiles&&(this.may_repeat_across_tiles=this.mayRepeatAcrossTiles())},i.discard=function(e,i){if(void 0===i&&(i=null),this.degenerate)return!1;if(t.prototype.discard.call(this,e,i)){if(Array.isArray(this.layout.anchor))for(var r=this.start_anchor_index;r<this.layout.anchor.length;r++)if(this.anchor=this.layout.anchor[r],this.update(),!t.prototype.discard.call(this,e,i))return!1;return!0}return!1},e}(ra);la.PLACEMENT={VERTEX:0,MIDPOINT:1,SPACED:2,CENTROID:3};var ca=la.PLACEMENT,ua=80;function ha(t,e,i){var r=[],n=i.placement,o=Math.max(e[0],e[1])*i.placement_min_length_ratio*i.units_per_pixel;if(n===ca.SPACED){var s=function(t,e,i){var r=i.units_per_pixel,n=(i.placement_spacing||ua)*r,o=function(t){for(var e=0,i=0;i<t.length-1;i++)e+=pa(t[i],t[i+1]);return e}(t);if(o<=e)return!1;for(var s=Math.max(Math.floor(o/n),1),a=[],l=[],c=.5*(o-(s-1)*n),u=0;u<s;u++){var h=fa(t,c,e,i),d=h.position,p=h.angle;null!=d&&null!=p&&(a.push(d),l.push(p)),c+=n}return{positions:a,angles:l}}(t,o,i);if(!s)return[];for(var a=s.positions,l=s.angles,c=0;c<a.length;c++){var u=a[c],h=l[c];!0!==i.tile_edges&&Po(u)||r.push(new la(u,e,i,h))}}else if(n===ca.VERTEX){for(var d,p,f=0;f<t.length-1;f++)if(d=t[f],p=t[f+1],!0===i.tile_edges||!Po(d)){var A=da(d,p,i.angle);r.push(new la(d,e,i,A))}var m=da(d,p,i.angle);r.push(new la(p,e,i,m))}else if(n===ca.MIDPOINT)for(var g=0;g<t.length-1;g++){var _=t[g],y=t[g+1],v=[.5*(_[0]+y[0]),.5*(_[1]+y[1])];if((!0===i.tile_edges||!Po(v))&&(!o||pa(_,y)>o)){var x=da(_,y,i.angle);r.push(new la(v,e,i,x))}}return r}function da(t,e,i){return void 0===i&&(i=0),"auto"===i?Math.atan2(e[0]-t[0],e[1]-t[1]):i}function pa(t,e){return Math.sqrt(Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2))}function fa(t,e,i,r){for(var n,o,s=0,a=0;a<t.length-1;a++){var l=t[a],c=t[a+1],u=pa(l,c);if(!(u<=i)&&(s+=u)>e){n=Aa(l,c,s-e),o=da(l,c,r.angle);break}}return{position:n,angle:o}}function Aa(t,e,i){var r=i/pa(t,e);return[r*t[0]+(1-r)*e[0],r*t[1]+(1-r)*e[1]]}var ma={key:function(t){return[t.style,t.weight,t.family,t.px_size,t.fill,t.stroke,t.stroke_width,t.underline_width,t.background_color,t.background_width,t.background_stroke_color,t.background_stroke_width,t.transform,t.text_wrap,t.max_lines,t.supersample,Yi.device_pixel_ratio].join("/")},defaults:{style:"normal",weight:"normal",size:"12px",px_size:12,family:"Helvetica",fill:[1,1,1,1],text_wrap:15,max_lines:5,align:"center"},compute:function(t,e){var i={};t.font=t.font||this.defaults,i.supersample=t.supersample_text?1.5:1,i.can_articulate=t.can_articulate,i.fill=Rn.evalCachedColorPropertyWithAlpha(t.font.fill,t.font.alpha,e),i.fill=Yi.toCSSColor(i.fill),t.font.stroke&&t.font.stroke.color&&(i.stroke=Rn.evalCachedColorPropertyWithAlpha(t.font.stroke.color,t.font.stroke.alpha,e),i.stroke=Yi.toCSSColor(i.stroke),i.stroke_width=Rn.evalCachedProperty(t.font.stroke.width,e)),!0!==t.font.underline||i.can_articulate||(i.underline_width=1.5*i.supersample),t.font.background&&!i.can_articulate&&(i.background_color=Rn.evalCachedColorPropertyWithAlpha(t.font.background.color,t.font.background.alpha,e),i.background_color=Yi.toCSSColor(i.background_color),i.background_color&&(i.background_width=Rn.evalCachedProperty(t.font.background.width,e)),i.background_stroke_color=t.font.background.stroke&&t.font.background.stroke.color&&Rn.evalCachedColorPropertyWithAlpha(t.font.background.stroke.color,t.font.background.stroke.alpha,e),i.background_stroke_color&&(i.background_stroke_color=Yi.toCSSColor(i.background_stroke_color),i.background_stroke_width=null!=t.font.background.stroke.width?Rn.evalCachedProperty(t.font.background.stroke.width,e):1)),i.weight=Rn.evalCachedProperty(t.font.weight,e)||this.defaults.weight,"number"==typeof i.weight&&(i.weight=Math.min(Math.max(i.weight,1),1e3)),t.font.family?(i.family=t.font.family,i.family!==this.defaults.family&&(i.family+=", "+this.defaults.family)):i.family=this.defaults.family,i.style=t.font.style||this.defaults.style,i.transform=t.font.transform,i.px_size=Rn.evalCachedProperty(t.font.px_size,e)*i.supersample,i.font_css=this.fontCSS(i);var r=t.text_wrap;return null!=r||i.can_articulate||(r=!0),!0===r&&(r=this.defaults.text_wrap),i.text_wrap=r,i.max_lines=t.max_lines||this.defaults.max_lines,i},fontCSS:function(t){return[t.style,t.weight,t.px_size+"px",t.family].filter((function(t){return t})).join(" ")}},ga=e((function(t){!function(){function e(t,e){document.addEventListener?t.addEventListener("scroll",e,!1):t.attachEvent("scroll",e)}function i(t){this.a=document.createElement("div"),this.a.setAttribute("aria-hidden","true"),this.a.appendChild(document.createTextNode(t)),this.b=document.createElement("span"),this.c=document.createElement("span"),this.h=document.createElement("span"),this.f=document.createElement("span"),this.g=-1,this.b.style.cssText="max-width:none;display:inline-block;position:absolute;height:100%;width:100%;overflow:scroll;font-size:16px;",this.c.style.cssText="max-width:none;display:inline-block;position:absolute;height:100%;width:100%;overflow:scroll;font-size:16px;",this.f.style.cssText="max-width:none;display:inline-block;position:absolute;height:100%;width:100%;overflow:scroll;font-size:16px;",this.h.style.cssText="display:inline-block;width:200%;height:200%;font-size:16px;max-width:none;",this.b.appendChild(this.h),this.c.appendChild(this.f),this.a.appendChild(this.b),this.a.appendChild(this.c)}function r(t,e){t.a.style.cssText="max-width:none;min-width:20px;min-height:20px;display:inline-block;overflow:hidden;position:absolute;width:auto;margin:0;padding:0;top:-999px;left:-999px;white-space:nowrap;font:"+e+";"}function n(t){var e=t.a.offsetWidth,i=e+100;return t.f.style.width=i+"px",t.c.scrollLeft=i,t.b.scrollLeft=t.b.scrollWidth+100,t.g!==e&&(t.g=e,!0)}function o(t,i){function r(){var t=o;n(t)&&t.a.parentNode&&i(t.g)}var o=t;e(t.b,r),e(t.c,r),n(t)}function s(t,e){var i=e||{};this.family=t,this.style=i.style||"normal",this.weight=i.weight||"normal",this.stretch=i.stretch||"normal"}var a=null,l=null,c=null,u=null;function h(){if(null===c){var t=document.createElement("div");try{t.style.font="condensed 100px sans-serif"}catch(t){}c=""!==t.style.font}return c}function d(t,e){return[t.style,t.weight,h()?t.stretch:"","100px",e].join(" ")}s.prototype.load=function(t,e){var n=this,s=t||"BESbswy",c=0,h=e||3e3,p=(new Date).getTime();return new Promise((function(t,e){var f;if(null===u&&(u=!!document.fonts),(f=u)&&(null===l&&(l=/OS X.*Version\/10\..*Safari/.test(navigator.userAgent)&&/Apple/.test(navigator.vendor)),f=!l),f){f=new Promise((function(t,e){!function i(){(new Date).getTime()-p>=h?e():document.fonts.load(d(n,'"'+n.family+'"'),s).then((function(e){1<=e.length?t():setTimeout(i,25)}),(function(){e()}))}()}));var A=new Promise((function(t,e){c=setTimeout(e,h)}));Promise.race([A,f]).then((function(){clearTimeout(c),t(n)}),(function(){e(n)}))}else!function(t){document.body?t():document.addEventListener?document.addEventListener("DOMContentLoaded",(function e(){document.removeEventListener("DOMContentLoaded",e),t()})):document.attachEvent("onreadystatechange",(function e(){"interactive"!=document.readyState&&"complete"!=document.readyState||(document.detachEvent("onreadystatechange",e),t())}))}((function(){function l(){var e;(e=-1!=m&&-1!=g||-1!=m&&-1!=_||-1!=g&&-1!=_)&&((e=m!=g&&m!=_&&g!=_)||(null===a&&(e=/AppleWebKit\/([0-9]+)(?:\.([0-9]+))/.exec(window.navigator.userAgent),a=!!e&&(536>parseInt(e[1],10)||536===parseInt(e[1],10)&&11>=parseInt(e[2],10))),e=a&&(m==y&&g==y&&_==y||m==v&&g==v&&_==v||m==x&&g==x&&_==x)),e=!e),e&&(b.parentNode&&b.parentNode.removeChild(b),clearTimeout(c),t(n))}var u=new i(s),f=new i(s),A=new i(s),m=-1,g=-1,_=-1,y=-1,v=-1,x=-1,b=document.createElement("div");b.dir="ltr",r(u,d(n,"sans-serif")),r(f,d(n,"serif")),r(A,d(n,"monospace")),b.appendChild(u.a),b.appendChild(f.a),b.appendChild(A.a),document.body.appendChild(b),y=u.a.offsetWidth,v=f.a.offsetWidth,x=A.a.offsetWidth,function t(){if((new Date).getTime()-p>=h)b.parentNode&&b.parentNode.removeChild(b),e(n);else{var i=document.hidden;!0!==i&&void 0!==i||(m=u.a.offsetWidth,g=f.a.offsetWidth,_=A.a.offsetWidth,l()),c=setTimeout(t,50)}}(),o(u,(function(t){m=t,l()})),r(u,d(n,'"'+n.family+'",sans-serif')),o(f,(function(t){g=t,l()})),r(f,d(n,'"'+n.family+'",serif')),o(A,(function(t){_=t,l()})),r(A,d(n,'"'+n.family+'",monospace'))}))}))},t.exports=s}()})),_a={fonts_loaded:Promise.resolve(),last_loaded:null,loadFonts:function(t){var e=this,i=JSON.stringify(t)===this.last_loaded;return t&&!i&&function(){var i=[],r=function(r){Array.isArray(t[r])?t[r].forEach((function(t){return i.push(e.loadFontFace(r,t))})):i.push(e.loadFontFace(r,t[r]))};for(var n in t)r(n);e.last_loaded=JSON.stringify(t),e.fonts_loaded=Promise.all(i.filter((function(t){return t})))}(),this.fonts_loaded},loadFontFace:function(t,e){return new Promise(function(i,r){var n,o;if(null==e||"object"!=typeof e&&"external"!==e)return i();if(n={family:t},"object"==typeof e){if(Object.assign(n,e),"string"==typeof e.url)return Promise.resolve(this.injectFontFace(n)).then(function(t){try{return s.call(this)}catch(t){return r(t)}}.bind(this),r);function s(){return a.call(this)}return s.call(this)}function a(){var e=function(){try{return i()}catch(t){return r(t)}},s=function(i){try{return Ki("warn","Font face '"+t+"' is NOT available",n,i),e()}catch(t){return r(t)}};try{return n.weight="string"==typeof n.weight?n.weight.split(" ")[0]:n.weight,o=new ga(t,n),Promise.resolve(o.load()).then((function(i){try{return Ki("debug","Font face '"+t+"' is available",n),e()}catch(t){return s(t)}}),s)}catch(t){s(t)}}return a.call(this)}.bind(this))},injectFontFace:function(t){return new Promise(function(e,i){var r,n,o,s,a,l,c,u,h,d,p;if(r=t.family,n=t.url,o=t.weight,s=t.style,void 0===this.supports_native_font_loading&&(this.supports_native_font_loading=void 0!==window.FontFace),a=n,"blob:"===n.slice(0,5))return Promise.resolve(Yi.io(n,6e4,"arraybuffer")).then(function(t){try{if(a=t.body,l=new Uint8Array(a),this.supports_native_font_loading)a=l;else{for(c="",u=0;u<l.length;u++)c+=String.fromCharCode(l[u]);a="data:font/opentype;base64,"+btoa(c)}return f.call(this)}catch(t){return i(t)}}.bind(this),i);function f(){return this.supports_native_font_loading?("string"==typeof a?h=new FontFace(r,"url("+encodeURI(a)+")",{weight:o,style:s}):a instanceof Uint8Array&&(h=new FontFace(r,a,{weight:o,style:s})),document.fonts.add(h),Ki("trace","Adding FontFace to document.fonts:",h)):(d="\n                @font-face {\n                    font-family: '"+r+"';\n                    font-weight: "+(o||"normal")+";\n                    font-style: "+(s||"normal")+";\n                    src: url("+encodeURI(a)+");\n                }",(p=document.createElement("style")).appendChild(document.createTextNode("")),document.head.appendChild(p),p.sheet.insertRule(d,0),Ki("trace","Injecting CSS font face:",d)),e()}return f.call(this)}.bind(this))}},ya=new RegExp("[---]");function va(t){return ya.test(t)}var xa="\0-/:-@[-`{----\u2029-",ba=new RegExp("["+xa+"]+");function wa(t){return ba.test(t)}var Ta=new RegExp("^["+xa+"-]+"),Ba=new RegExp("["+xa+"-----]"),Ea=new RegExp("^[-----]+"),Ca="[------------------------------------------]",Sa=new RegExp("^.(?:"+Ca+"+)?([]\\W(?:"+Ca+"+)?)*"),Ia={Mongolian:"-"},Ma=Object.keys(Ia).map((function(t){return Ia[t]})).join(""),ka=new RegExp("["+Ma+"]"),Pa=2;function La(t,e,i){var r=e?1:Pa;if(t.length<r)return[t];var n=t;if(i.segment[n])return i.stats.segment_hits++,i.segment[n];var o=[];if(Ta.exec(t)){o=t.split(Ba);for(var s=-1,a=0;a<o.length-1;a++){if(a>0){var l=Ea.exec(o[a]);l&&(o[a]=o[a].substring(l[0].length),o[a-1]+=l[0],s+=l[0].length)}s+=1+o[a].length,o[a]+=t.slice(s,s+1)}t=""}for(;t.length;){for(var c="",u=t,h=0;h<r&&u.length;h++){var d=(Sa.exec(u)||u)[0];c+=d,u=u.substring(d.length)}o.push(c),t=t.substring(c.length)}return e&&o.reverse(),i.stats.segment_misses++,i.segment[n]=o,o}var za=function(){function t(t,e,i){void 0===e&&(e=1/0),void 0===i&&(i=1/0),this.width=0,this.height=0,this.lines=[],this.max_lines=e,this.text_wrap=i,this.context=t}var e=t.prototype;return e.createLine=function(t){return this.lines.length<this.max_lines&&new Fa(t,this.text_wrap)},e.push=function(t){if(this.lines.length<this.max_lines){var e=this.context.measureText(t.text).width;return t.width=e,e>this.width&&(this.width=Math.ceil(e)),this.lines.push(t),this.height+=t.height,!0}return this.addEllipsis(),!1},e.advance=function(t,e){return!!this.push(t)&&this.createLine(e)},e.addEllipsis=function(){var e=this.lines[this.lines.length-1],i=Math.ceil(this.context.measureText(t.ellipsis).width);e.append(t.ellipsis),e.width+=i,e.width>this.width&&(this.width=e.width)},e.finish=function(t){t?this.push(t):this.addEllipsis()},t.parse=function(e,i,r,n,o){var s;s="number"==typeof i?e.split(" "):[e];for(var a=new t(o,r,i),l=a.createLine(n),c=0;c<s.length;c++){for(var u=s[c].split("\n"),h=0===c,d=0;d<u.length&&l;d++){var p=u[d];va(p)&&wa(p[p.length-1])&&(p+="");var f=h?p:" "+p;if(i&&c>0&&l.exceedsTextwrap(f)){if(!(l=a.advance(l,n)))break;l.append(p),h=!0}else l.append(f);d<u.length-1&&(l=a.advance(l,n),h=!0)}c===s.length-1&&a.finish(l)}return a},t}();za.ellipsis="...";var Fa=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.chars=0,this.text="",this.height=Math.ceil(t),this.text_wrap=e}var e=t.prototype;return e.append=function(t){this.chars+=t.length,this.text+=t},e.exceedsTextwrap=function(t){return t.length+this.chars>this.text_wrap},t}(),Da=function(){function t(){this.createCanvas(),this.vertical_text_buffer=8,this.horizontal_text_buffer=4,this.background_size=4}var e=t.prototype;return e.createCanvas=function(){this.canvas=document.createElement("canvas"),this.canvas.style.backgroundColor="transparent",this.context=this.canvas.getContext("2d")},e.resize=function(t,e){this.canvas.width=t,this.canvas.height=e,this.context.clearRect(0,0,t,e)},e.setFont=function(t){var e=t.font_css,i=t.fill,r=t.stroke,n=t.stroke_width,o=t.px_size,s=t.supersample;this.px_size=o;var a=this.context,l=Yi.device_pixel_ratio*s;r&&n>0&&(a.strokeStyle=r,a.lineWidth=n*l),a.fillStyle=i,a.font=e,a.miterLimit=2},e.textSizes=function(t,e){return new Promise(function(i,r){return Promise.resolve(_a.loadFonts()).then(function(n){try{return i(Tr.add({type:"textSizes",run:this.processTextSizesTask.bind(this),texts:e,tile_id:t,cursor:{styles:Object.keys(e),texts:null,style_idx:null,text_idx:null}}))}catch(t){return r(t)}}.bind(this),r)}.bind(this))},e.processTextSizesTask=function(e){var i,r=e.cursor,n=e.texts;for(r.style_idx=r.style_idx||0;r.style_idx<r.styles.length;){var o=r.styles[r.style_idx];null==r.text_idx&&(r.text_idx=0,r.texts=Object.keys(n[o]));for(var s=n[o],a=!0;r.text_idx<r.texts.length;){var l=r.texts[r.text_idx],c=s[l],u=c.text_settings;if(a&&(this.setFont(u),a=!1),c.size=this.textSize(o,l,u).size,u.can_articulate){var h=!1,d=!1;if(va(l)&&(wa(l)?h=!0:d=!0),c.isRTL=h,c.no_curving=d||(i=l,ka.test(i)),c.vertical_buffer=this.vertical_text_buffer,c.segment_sizes=[],!c.no_curving){var p=La(l,h,t.cache);c.segments=p;for(var f=0;f<p.length;f++)c.segment_sizes.push(this.textSize(o,p[f],u).size)}}if(r.text_idx++,!Tr.shouldContinue(e))return!1}r.text_idx=null,r.style_idx++}return Tr.finish(e,n),!0},e.textSize=function(e,i,r){var n=r.transform,o=r.text_wrap,s=r.max_lines,a=r.stroke_width,l=void 0===a?0:a,c=r.background_color,u=r.background_stroke_width,h=void 0===u?0:u,d=r.background_width,p=r.underline_width,f=void 0===p?0:p,A=r.supersample;if(t.cache.text[e]=t.cache.text[e]||{},t.cache.text[e][i])return t.cache.stats.text_hits++,t.cache.text[e][i];t.cache.stats.text_misses++,t.cache.text_count++;var m=Yi.device_pixel_ratio*A,g=this.applyTextTransform(i,n),_=this.context,y=this.vertical_text_buffer*m,v=(l+this.horizontal_text_buffer)*m;d=null!=d?d:this.background_size;var x=c||h?(d+h)*m:0,b=(2+f+(f?l+1:0))*m,w=this.px_size+b,T=za.parse(g,o,s,w,_),B=T.width,E=T.height,C=T.lines,S=[(B+=2*x)/m,(E+=2*x)/m],I=[B+2*v,E+2*y],M=[I[0]/m,I[1]/m];return t.cache.text[e][i]={lines:C,size:{collision_size:S,texture_size:I,logical_size:M,horizontal_buffer:v,vertical_buffer:y,dpr:m,line_height:w,background_size:x}},t.cache.text[e][i]},e.drawTextMultiLine=function(t,e,i,r,n){var o=e[0],s=e[1],a=i.dpr,l=i.collision_size,c=i.texture_size,u=i.line_height,h=i.horizontal_buffer,d=i.vertical_buffer;if(r.background_color||r.background_stroke_color){var p=r.background_stroke_color,f=(r.background_stroke_width||0)*a;this.context.save(),r.background_color&&(this.context.fillStyle=r.background_color,this.context.fillRect(o+h+("curved"===n?c[0]:0)+f,s+d+f,a*l[0]-2*f,a*l[1]-2*f)),p&&f&&(this.context.strokeStyle=p,this.context.lineWidth=f,this.context.strokeRect(o+h+("curved"===n?c[0]:0)+.5*f,s+d+.5*f,a*l[0]-f,a*l[1]-f)),this.context.restore()}for(var A=r.underline_width||0,m=r.stroke_width||0,g=s-(A?.5*(A+m+1)*a:0),_=0;_<t.length;_++){var y=t[_];this.drawTextLine(y,[o,g],i,r,n),g+=u}this.drawTextDebug([o,s],i,n)},e.drawTextLine=function(t,e,i,r,n){var o,s=e[0],a=e[1],l=r.stroke,c=r.stroke_width,u=r.transform,h=r.align,d=void 0===h?"center":h,p=i.horizontal_buffer,f=i.vertical_buffer,A=i.texture_size,m=i.background_size,g=i.line_height,_=i.dpr,y=(r.underline_width||0)*_,v=this.applyTextTransform(t.text,u);"left"===d?o=s+p+m:"center"===d?o=s+A[0]/2-t.width/2:"right"===d&&(o=s+A[0]-t.width-p-m);var x=a+.75*f+g+m-.5*y,b=l&&c>0&&"curved"===n?A[0]:0;if(y){this.context.save(),this.context.strokeStyle=this.context.fillStyle,this.context.lineWidth=y;var w=x+(.5*c+2)*_+.5*this.context.lineWidth;this.context.beginPath(),this.context.moveTo(o+b,w),this.context.lineTo(o+b+t.width,w),this.context.stroke(),this.context.restore()}l&&c>0&&this.context.strokeText(v,o+b,x),this.context.fillText(v,o,x)},e.drawTextDebug=function(t,e,i){var r=t[0],n=t[1],o=e.dpr,s=e.horizontal_buffer,a=e.vertical_buffer,l=e.texture_size,c=e.collision_size;tr.draw_label_collision_boxes&&(this.context.save(),this.context.strokeStyle="blue",this.context.lineWidth=2,this.context.strokeRect(r+s,n+a,o*c[0],o*c[1]),"curved"===i&&this.context.strokeRect(r+l[0]+s,n+a,o*c[0],o*c[1]),this.context.restore()),tr.draw_label_texture_boxes&&(this.context.save(),this.context.strokeStyle="green",this.context.lineWidth=2,this.context.strokeRect(r+2,n+2,l[0]-4,l[1]-4),"curved"===i&&this.context.strokeRect(r+2+l[0],n+2,l[0]-4,l[1]-4),this.context.restore())},e.rasterize=function(t,e,i,r,n){return Tr.add({type:"rasterizeLabels",run:this.processRasterizeTask.bind(this),cancel:this.cancelRasterizeTask.bind(this),pause_factor:2,user_moving_view:!1,texts:t,textures:e,texture_prefix:r,gl:n,tile_id:i,cursor:{styles:Object.keys(t),texts:null,style_idx:0,text_idx:null,texture_idx:0,texture_resize:!0,texture_names:[]}})},e.processRasterizeTask=function(t){for(var e,i=t.cursor,r=t.texts,n=t.textures;i.texture_idx<t.textures.length;){for(e=n[i.texture_idx],i.texture_resize&&(i.texture_resize=!1,this.resize.apply(this,e.texture_size));i.style_idx<i.styles.length;){var o=i.styles[i.style_idx];null==i.text_idx&&(i.text_idx=0,i.texts=Object.keys(r[o]));for(var s=r[o],a=!0;i.text_idx<i.texts.length;){var l=i.texts[i.text_idx],c=s[l],u=c.text_settings;if(a&&(this.setFont(u),a=!1),u.can_articulate){c.texcoords=c.texcoords||{};for(var h=0;h<c.type.length;h++){var d=c.type[h];if("straight"===d){if(c.textures[h]!==i.texture_idx)continue;var p=c.isRTL?l.split().reverse().join():l,f=e.texcoord_cache[o][p],A=void 0;if(f.texcoord)A=f.texcoord;else{var m=f.texture_position,g=this.textSize(o,p,u),_=g.size,y=g.lines;this.drawTextMultiLine(y,m,_,u,d),A=Hr.getTexcoordsForSprite(m,_.texture_size,e.texture_size),f.texcoord=A}c.texcoords[d]={texcoord:A,texture_id:f.texture_id}}else if("curved"===d){var v=c.segments;c.texcoords.curved=c.texcoords.curved||[],c.texcoords_stroke=c.texcoords_stroke||[];for(var x=0;x<v.length;x++)if(c.textures[h][x]===i.texture_idx){var b=v[x],w=e.texcoord_cache[o][b],T=void 0,B=void 0;if(w.texcoord)T=w.texcoord,B=w.texcoord_stroke,c.texcoords_stroke.push(B);else{var E=w.texture_position,C=this.textSize(o,b,u),S=C.size,I=C.lines;this.drawTextMultiLine(I,E,S,u,d),T=Hr.getTexcoordsForSprite(E,S.texture_size,e.texture_size);var M=[E[0]+S.texture_size[0],E[1]];B=Hr.getTexcoordsForSprite(M,S.texture_size,e.texture_size),w.texcoord=T,w.texcoord_stroke=B,c.texcoords_stroke.push(B)}c.texcoords.curved.push({texcoord:T,texture_id:w.texture_id})}}}}else{var k=this.textSize(o,l,u).lines,P=Object.assign({},u);for(var L in c.align)c.align[L].texture_id===i.texture_idx&&(P.align=L,this.drawTextMultiLine(k,c.align[L].texture_position,c.size,P),c.align[L].texcoords=Hr.getTexcoordsForSprite(c.align[L].texture_position,c.size.texture_size,e.texture_size))}if(i.text_idx++,!Tr.shouldContinue(t))return!1}i.text_idx=null,i.style_idx++}var z=t.texture_prefix+i.texture_idx;Hr.create(t.gl,z,{element:this.canvas,filtering:"linear",UNPACK_PREMULTIPLY_ALPHA_WEBGL:!0}),Hr.retain(z),i.texture_names.push(z),i.texture_idx++,i.texture_resize=!0,i.style_idx=0}return Tr.finish(t,i.texture_names),!0},e.cancelRasterizeTask=function(t){Ki("trace","RasterizeTask: release textures ["+t.cursor.texture_names.join(", ")+"]"),t.cursor.texture_names.forEach((function(t){return Hr.release(t)}))},e.setTextureTextPositions=function(t,e){var i={cx:0,cy:0,width:0,height:0,column_width:0,texture_id:0,texcoord_cache:{}},r=[];for(var n in t){var o=t[n];for(var s in o){var a=o[s],l=void 0;if(a.text_settings.can_articulate){a.textures=[],i.texcoord_cache[n]=i.texcoord_cache[n]||{};for(var c=0;c<a.type.length;c++){var u=a.type[c];if("straight"===u){var h=a.isRTL?s.split().reverse().join():s;if(!i.texcoord_cache[n][h]){var d=a.size.texture_size;l=this.placeText(d[0],d[1],n,i,r,e),i.texcoord_cache[n][h]={texture_id:i.texture_id,texture_position:l}}a.textures[c]=i.texture_id}else if("curved"===u){a.textures[c]=[];for(var p=0;p<a.segment_sizes.length;p++){var f=a.segments[p];if(!i.texcoord_cache[n][f]){var A=a.segment_sizes[p].texture_size,m=2*A[0];l=this.placeText(m,A[1],n,i,r,e),i.texcoord_cache[n][f]={texture_id:i.texture_id,texture_position:l}}a.textures[c].push(i.texture_id)}}}}else{var g=a.size.texture_size;for(var _ in a.align)l=this.placeText(g[0],g[1],n,i,r,e),a.align[_].texture_id=i.texture_id,a.align[_].texture_position=l}}}return i.column_width>0&&i.height>0&&(r[i.texture_id]={texture_size:[i.width,i.height],texcoord_cache:i.texcoord_cache}),r},e.placeText=function(t,e,i,r,n,o){var s;return r.cy+e>o?(r.cx+=r.column_width,r.cy=0,r.column_width=t):r.column_width=Math.max(r.column_width,t),r.cx+r.column_width<=o?(s=[r.cx,r.cy],r.cy+=e,r.height=Math.max(r.height,r.cy),r.width=Math.max(r.width,r.cx+r.column_width)):(n[r.texture_id]={texture_size:[r.width,r.height],texcoord_cache:r.texcoord_cache},r.texcoord_cache={},r.texcoord_cache[i]={},r.texture_id++,r.cx=0,r.cy=e,r.column_width=t,r.width=t,r.height=e,s=[0,0]),s},e.applyTextTransform=function(t,e){return"capitalize"===e?t.replace(/\w\S*/g,(function(t){return t.charAt(0).toUpperCase()+t.substr(1)})):"uppercase"===e?t.toUpperCase():"lowercase"===e?t.toLowerCase():t},t.fontPixelSize=function(e){if(null!=e){var i=(e="string"==typeof e?e:String(e)).match(t.font_size_re)||[],r=i[1],n=i[2];return"em"===(n=n||"px")?r*=16:"pt"===n?r/=.75:"%"===n&&(r/=6.25),(r=Rn.parsePositiveNumber(r))*Yi.device_pixel_ratio}},t.pruneTextCache=function(){t.cache.text_count>t.cache.text_count_max&&(t.cache.text={},t.cache.text_count=0,Ki("debug","TextCanvas: pruning text cache")),Object.keys(t.cache.segment).length>t.cache.segment_count_max&&(t.cache.segment={},Ki("debug","TextCanvas: pruning segment cache"))},t}();Da.font_size_re=/((?:[0-9]*\.)?[0-9]+)\s*(px|pt|em|%)?/,Da.cache={text:{},text_count:0,text_count_max:2e3,segment:{},segment_count_max:2e3,stats:{text_hits:0,text_misses:0,segment_hits:0,segment_misses:0}};var Ra=0,Ua={resetText:function(){Ht.is_main?this.canvas=new Da:Ht.is_worker&&(this.texts={})},freeText:function(t){delete this.texts[t.id]},parseTextFeature:function(t,e,i,r){var n=this.parseTextSource(t,e,i);if(null!=n&&""!==n){var o=ma.compute(e,i),s=ma.key(o);this.texts[r.id]=this.texts[r.id]||{};var a=this.texts[r.id][s]=this.texts[r.id][s]||{};if(n instanceof Object){var l=[],c=n.left+"-"+n.right;for(var u in n){var h=n[u];if(h){var d=this.computeTextLayout({},t,e,i,r,h,o,c,u);a[h]||(a[h]={text_settings:o,ref:0}),l.push({draw:e,text:h,text_settings_key:s,layout:d})}}return l.length>0&&l}var p=this.computeTextLayout({},t,e,i,r,n,o);return a[n]||(a[n]={text_settings:o,ref:0}),{draw:e,text:n,text_settings_key:s,layout:p}}},parseTextSource:function(t,e,i){var r,n=e.text_source||"name";if(null==n||Array.isArray(n)||"object"!=typeof n)r=this.parseTextSourceValue(n,t,i);else for(var o in r={},n)r[o]=this.parseTextSourceValue(n[o],t,i);return r},parseTextSourceValue:function(t,e,i){var r;if(Array.isArray(t)){for(var n=0;n<t.length;n++)if("string"==typeof t[n]?r=e.properties[t[n]]:"function"==typeof t[n]&&(r=t[n](i)),r)return r}else"string"==typeof t?r=e.properties[t]:t instanceof Function&&(r=t(i));return r},prepareTextLabels:function(t,e){return new Promise(function(i,r){var n;if(0===Object.keys(this.texts[t.id]||{}).length)return i([]);var o=function(e){try{return aa.abortTile(t.id),i([])}catch(t){return r(t)}};try{return Promise.resolve(Qi.postMessage(this.main_thread_target+".calcTextSizes",t.id,this.texts[t.id])).then(function(r){try{return n=r,t.canceled?(Ki("trace","Style "+this.name+": stop tile build because tile was canceled: "+t.key+", post-calcTextSizes()"),i([])):(this.texts[t.id]=n||[],n?i(this.buildTextLabels(t,e)):(aa.abortTile(t.id),i([])))}catch(t){return o()}}.bind(this),o)}catch(t){o()}}.bind(this))},collideAndRenderTextLabels:function(t,e,i){return new Promise(function(r,n){var o,s,a;return Promise.resolve(this.prepareTextLabels(t,i)).then(function(i){try{return 0===(o=i).length?(aa.collide([],e,t.id),r({})):Promise.resolve(aa.collide(o,e,t.id)).then(function(e){try{if(o=e,t.canceled)return Ki("trace","stop tile build because tile was canceled: "+t.key+", post-collide()"),r({});if(null==(s=this.texts[t.id])||0===o.length)return r({});this.cullTextStyles(s,o),o.forEach((function(t){var e=t.text_settings_key,i=s[e]&&s[e][t.text];i.text_settings.can_articulate?(i.type||(i.type=[]),-1===i.type.indexOf(t.label.type)&&i.type.push(t.label.type)):(i.align=i.align||{},i.align[t.label.align]={})}));var i=function(t){try{return r({})}catch(t){return n(t)}};try{return Promise.resolve(Qi.postMessage(this.main_thread_target+".rasterizeTexts",t.id,t.key,s)).then((function(e){try{return a=e,t.canceled?(Ki("trace","stop tile build because tile was canceled: "+t.key+", post-rasterizeTexts()"),r({})):r(Object.assign({labels:o},a))}catch(t){return i()}}),i)}catch(t){i()}}catch(t){return n(t)}}.bind(this),n)}catch(t){return n(t)}}.bind(this),n)}.bind(this))},cullTextStyles:function(t,e){for(var i=0;i<e.length;i++){var r=e[i];t[r.text_settings_key][r.text].ref++}for(var n in t)for(var o in t[n])t[n][o].ref<1&&delete t[n][o];for(var s in t)0===Object.keys(t[s]).length&&delete t[s]},calcTextSizes:function(t,e){return this.canvas.textSizes(t,e)},rasterizeTexts:function(t,e,i){return new Promise(function(r,n){var o,s,a,l;return o=new Da,s=Math.min(this.max_texture_size,2048),a=o.setTextureTextPositions(i,s),l=["labels",this.name,e,t,Ra,""].join("-"),Ra++,Promise.resolve(o.rasterize(i,a,t,l,this.gl)).then((function(t){try{return r((a=t)?{texts:i,textures:a}:{})}catch(t){return n(t)}}),n)}.bind(this))},preprocessText:function(t){if(t&&t.font&&"object"==typeof t.font)return t.font.weight=Rn.createPropertyCache(t.font.weight),t.font.fill=Rn.createPropertyCache(t.font.fill||ma.defaults.fill),t.font.alpha=Rn.createPropertyCache(t.font.alpha),t.font.stroke&&(t.font.stroke.color=Rn.createPropertyCache(t.font.stroke.color),t.font.stroke.alpha=Rn.createPropertyCache(t.font.stroke.alpha)),t.font.background&&(t.font.background.color=Rn.createPropertyCache(t.font.background.color),t.font.background.alpha=Rn.createPropertyCache(t.font.background.alpha),t.font.background.width=Rn.createPropertyCache(t.font.background.width,Rn.parsePositiveNumber),t.font.background.stroke&&(t.font.background.stroke.color=Rn.createPropertyCache(t.font.background.stroke.color),t.font.background.stroke.alpha=Rn.createPropertyCache(t.font.background.stroke.alpha))),t.font.px_size=Rn.createPropertyCache(t.font.size||ma.defaults.size,Da.fontPixelSize,Da.fontPixelSize),t.font.stroke&&null!=t.font.stroke.width&&(t.font.stroke.width=Rn.createPropertyCache(t.font.stroke.width,Rn.parsePositiveNumber)),t.font.background&&t.font.background.stroke&&null!=t.font.background.stroke.width&&(t.font.background.stroke.width=Rn.createPropertyCache(t.font.background.stroke.width,Rn.parsePositiveNumber)),t.offset=Rn.createPropertyCache(t.offset,(function(t){return Array.isArray(t)&&t.map(Rn.parseNumber)})),t.buffer=Rn.createPropertyCache(t.buffer,(function(t){return(Array.isArray(t)?t:[t,t]).map(Rn.parsePositiveNumber)})),t.repeat_distance=Rn.createPropertyCache(t.repeat_distance,Rn.parsePositiveNumber),t},computeTextLayout:function(t,e,i,r,n,o,s,a,l){var c=t||{};return c=this.computeLayout(c,e,i,r,n),null==i.repeat_distance&&(c.repeat_distance="point"===r.geometry?0:an.tile_size,c.repeat_distance&&(c.repeat_distance*=c.units_per_pixel,c.repeat_scale=1,"function"==typeof i.repeat_group?c.repeat_group=i.repeat_group(r):c.repeat_group=i.repeat_group)),c.repeat_distance&&(a&&(c.repeat_group+="/"+a),c.repeat_group+="/"+o),c.subdiv=n.overzoom2,c.align=i.align,c.italic="normal"!==s.style,"right"===l?c.orientation=1:"left"===l&&(c.orientation=-1),c}};jr("Float64",8,(function(t){return function(e,i,r){return t(this,e,i,r)}}));var Oa=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Na=function(t,e,i){var r=new Float64Array(3);return r[0]=t,r[1]=e,r[2]=i,r},Qa={normalFromMat4:function(t,e){var i=e[0],r=e[1],n=e[2],o=e[3],s=e[4],a=e[5],l=e[6],c=e[7],u=e[8],h=e[9],d=e[10],p=e[11],f=e[12],A=e[13],m=e[14],g=e[15],_=i*a-r*s,y=i*l-n*s,v=i*c-o*s,x=r*l-n*a,b=r*c-o*a,w=n*c-o*l,T=u*A-h*f,B=u*m-d*f,E=u*g-p*f,C=h*m-d*A,S=h*g-p*A,I=d*g-p*m,M=_*I-y*S+v*C+x*E-b*B+w*T;return M?(M=1/M,t[0]=(a*I-l*S+c*C)*M,t[1]=(l*E-s*I-c*B)*M,t[2]=(s*S-a*E+c*T)*M,t[3]=(n*S-r*I-o*C)*M,t[4]=(i*I-n*E+o*B)*M,t[5]=(r*E-i*S-o*T)*M,t[6]=(A*w-m*b+g*x)*M,t[7]=(m*v-f*w-g*y)*M,t[8]=(f*b-A*v+g*_)*M,t):null},invert:function(t,e){var i=e[0],r=e[1],n=e[2],o=e[3],s=e[4],a=e[5],l=e[6],c=e[7],u=e[8],h=u*s-a*c,d=-u*o+a*l,p=c*o-s*l,f=i*h+r*d+n*p;return f?(f=1/f,t[0]=h*f,t[1]=(-u*r+n*c)*f,t[2]=(a*r-n*s)*f,t[3]=d*f,t[4]=(u*i-n*l)*f,t[5]=(-a*i+n*o)*f,t[6]=p*f,t[7]=(-c*i+r*l)*f,t[8]=(s*i-r*o)*f,t):null}},Va={multiply:function(t,e,i){var r=e[0],n=e[1],o=e[2],s=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=e[8],d=e[9],p=e[10],f=e[11],A=e[12],m=e[13],g=e[14],_=e[15],y=i[0],v=i[1],x=i[2],b=i[3];return t[0]=y*r+v*a+x*h+b*A,t[1]=y*n+v*l+x*d+b*m,t[2]=y*o+v*c+x*p+b*g,t[3]=y*s+v*u+x*f+b*_,y=i[4],v=i[5],x=i[6],b=i[7],t[4]=y*r+v*a+x*h+b*A,t[5]=y*n+v*l+x*d+b*m,t[6]=y*o+v*c+x*p+b*g,t[7]=y*s+v*u+x*f+b*_,y=i[8],v=i[9],x=i[10],b=i[11],t[8]=y*r+v*a+x*h+b*A,t[9]=y*n+v*l+x*d+b*m,t[10]=y*o+v*c+x*p+b*g,t[11]=y*s+v*u+x*f+b*_,y=i[12],v=i[13],x=i[14],b=i[15],t[12]=y*r+v*a+x*h+b*A,t[13]=y*n+v*l+x*d+b*m,t[14]=y*o+v*c+x*p+b*g,t[15]=y*s+v*u+x*f+b*_,t},translate:function(t,e,i){var r,n,o,s,a,l,c,u,h,d,p,f,A=i[0],m=i[1],g=i[2];return e===t?(t[12]=e[0]*A+e[4]*m+e[8]*g+e[12],t[13]=e[1]*A+e[5]*m+e[9]*g+e[13],t[14]=e[2]*A+e[6]*m+e[10]*g+e[14],t[15]=e[3]*A+e[7]*m+e[11]*g+e[15]):(r=e[0],n=e[1],o=e[2],s=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=e[8],d=e[9],p=e[10],f=e[11],t[0]=r,t[1]=n,t[2]=o,t[3]=s,t[4]=a,t[5]=l,t[6]=c,t[7]=u,t[8]=h,t[9]=d,t[10]=p,t[11]=f,t[12]=r*A+a*m+h*g+e[12],t[13]=n*A+l*m+d*g+e[13],t[14]=o*A+c*m+p*g+e[14],t[15]=s*A+u*m+f*g+e[15]),t},scale:function(t,e,i){var r=i[0],n=i[1],o=i[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},perspective:function(t,e,i,r,n){var o=1/Math.tan(e/2),s=1/(r-n);return t[0]=o/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=(n+r)*s,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*n*r*s,t[15]=0,t},lookAt:function(t,e,i,r){var n,o,s,a,l,c,u,h,d,p,f=e[0],A=e[1],m=e[2],g=r[0],_=r[1],y=r[2],v=i[0],x=i[1],b=i[2];return Math.abs(f-v)<1e-6&&Math.abs(A-x)<1e-6&&Math.abs(m-b)<1e-6?Oa(t):(u=f-v,h=A-x,d=m-b,n=_*(d*=p=1/Math.sqrt(u*u+h*h+d*d))-y*(h*=p),o=y*(u*=p)-g*d,s=g*h-_*u,(p=Math.sqrt(n*n+o*o+s*s))?(n*=p=1/p,o*=p,s*=p):(n=0,o=0,s=0),a=h*s-d*o,l=d*n-u*s,c=u*o-h*n,(p=Math.sqrt(a*a+l*l+c*c))?(a*=p=1/p,l*=p,c*=p):(a=0,l=0,c=0),t[0]=n,t[1]=a,t[2]=u,t[3]=0,t[4]=o,t[5]=l,t[6]=h,t[7]=0,t[8]=s,t[9]=c,t[10]=d,t[11]=0,t[12]=-(n*f+o*A+s*m),t[13]=-(a*f+l*A+c*m),t[14]=-(u*f+h*A+d*m),t[15]=1,t)},identity:Oa,copy:function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}},ja=function(){function t(t,e,i){void 0===i&&(i={}),this.view=e,this.position=i.position,this.zoom=i.zoom}t.create=function(t,e,i){switch(i.type){case"isometric":return new Ga(t,e,i);case"flat":return new $a(t,e,i);default:return new Ha(t,e,i)}};var e=t.prototype;return e.update=function(){},e.setupProgram=function(){},e.updateView=function(){if(this.position||this.zoom){var t={};this.position&&(t={lng:this.position[0],lat:this.position[1],zoom:this.position[2]}),this.zoom&&(t.zoom=this.zoom),this.view.setView(t)}},e.setupMatrices=function(t,e){Va.multiply(t.model_view32,this.view_matrix,t.model),e.uniform("Matrix4fv","u_modelView",t.model_view32),Qa.normalFromMat4(t.normal32,t.model_view32),Qa.invert(t.inverse_normal32,t.normal32),e.uniform("Matrix3fv","u_normalMatrix",t.normal32),e.uniform("Matrix3fv","u_inverseNormalMatrix",t.inverse_normal32)},t}(),Ha=function(t){function e(e,i,r){var n;return void 0===r&&(r={}),(n=t.call(this,e,i,r)||this).type="perspective",n.focal_length=r.focal_length,n.fov=r.fov,n.focal_length||n.fov||(n.focal_length=[[16,2],[17,2.5],[18,3],[19,4],[20,6]]),n.vanishing_point=r.vanishing_point||[0,0],n.vanishing_point=n.vanishing_point.map(parseFloat),n.vanishing_point_skew=[],n.position_meters=null,n.view_matrix=new Float64Array(16),n.projection_matrix=new Float32Array(16),Jr.replaceBlock("camera","\n            uniform mat4 u_projection;\n            uniform vec3 u_eye;\n            uniform vec2 u_vanishing_point;\n\n            void cameraProjection (inout vec4 position) {\n                position = u_projection * position;\n            }"),n}fe(e,t);var i=e.prototype;return i.constrainCamera=function(t){var e=t.view_height,i=t.height,r=t.focal_length,n=t.fov;return i?(r=2*i/e,n=2*Math.atan(1/r)):(r?n=2*Math.atan(1/r):n&&(n=n*Math.PI/180,r=1/Math.tan(n/2)),i=e/2*r),{view_height:e,height:i,focal_length:r,fov:n}},i.updateMatrices=function(){var t=this.view.size.css.height*this.view.meters_per_pixel,e=this.constrainCamera({view_height:t,focal_length:Yi.interpolate(this.view.zoom,this.focal_length),fov:Yi.interpolate(this.view.zoom,this.fov)}),i=e.height,r=e.fov,n=[this.view.center.meters.x,this.view.center.meters.y,i];this.position_meters=n,Va.lookAt(this.view_matrix,Na(n[0],n[1],0),Na(n[0],n[1],-1),Na(0,1,0)),Va.perspective(this.projection_matrix,r,this.view.aspect,1,2*i),this.vanishing_point_skew[0]=this.vanishing_point[0]/this.view.size.css.width,this.vanishing_point_skew[1]=this.vanishing_point[1]/this.view.size.css.height,this.projection_matrix[8]=2*-this.vanishing_point_skew[0],this.projection_matrix[9]=2*-this.vanishing_point_skew[1],Va.translate(this.projection_matrix,this.projection_matrix,Na(t/2*this.view.aspect*(2*-this.vanishing_point_skew[0]),t/2*(2*-this.vanishing_point_skew[1]),0)),Va.translate(this.projection_matrix,this.projection_matrix,Na(0,0,-i))},i.update=function(){t.prototype.update.call(this),this.updateMatrices()},i.setupProgram=function(t){t.uniform("Matrix4fv","u_projection",this.projection_matrix),t.uniform("3f","u_eye",[0,0,this.position_meters[2]]),t.uniform("2fv","u_vanishing_point",this.vanishing_point_skew)},e}(ja),Ga=function(t){function e(e,i,r){var n;return void 0===r&&(r={}),(n=t.call(this,e,i,r)||this).type="isometric",n.axis=r.axis||{x:0,y:1},2===n.axis.length&&(n.axis={x:n.axis[0],y:n.axis[1]}),n.position_meters=null,n.viewport_height=null,n.view_matrix=new Float64Array(16),n.projection_matrix=new Float32Array(16),Jr.replaceBlock("camera","\n            uniform mat4 u_projection;\n            uniform vec3 u_eye;\n            uniform vec2 u_vanishing_point;\n\n            void cameraProjection (inout vec4 position) {\n                position = u_projection * position;\n                // position.xy += position.z * u_isometric_axis;\n\n                // Reverse z for depth buffer so up is negative,\n                // and scale down values so objects higher than one screen height will not get clipped\n                // pull forward slightly to avoid going past far clipping plane\n                position.z = -position.z / 100. + 1. - 0.001;\n            }"),n}fe(e,t);var i=e.prototype;return i.update=function(){t.prototype.update.call(this),this.viewport_height=this.view.size.css.height*this.view.meters_per_pixel;var e=[this.view.center.meters.x,this.view.center.meters.y,this.viewport_height];this.position_meters=e,Va.identity(this.view_matrix),Va.translate(this.view_matrix,this.view_matrix,Na(-e[0],-e[1],0)),Va.identity(this.projection_matrix),this.projection_matrix[8]=this.axis.x/this.view.aspect,this.projection_matrix[9]=this.axis.y,Va.scale(this.projection_matrix,this.projection_matrix,Na(2/this.view.size.meters.x,2/this.view.size.meters.y,2/this.view.size.meters.y))},i.setupProgram=function(t){t.uniform("Matrix4fv","u_projection",this.projection_matrix),t.uniform("3fv","u_eye",[0,0,this.viewport_height]),t.uniform("2fv","u_vanishing_point",[0,0])},e}(ja),$a=function(t){function e(e,i,r){var n;return void 0===r&&(r={}),(n=t.call(this,e,i,r)||this).type="flat",n}return fe(e,t),e.prototype.update=function(){this.axis.x=0,this.axis.y=0,t.prototype.update.call(this)},e}(Ga),Za=function(){function t(t,e){Br(this),this.scene=t,this.createMatrices(),this.zoom=null,this.center=null,this.bounds=null,this.meters_per_pixel=null,this.panning=!1,this.panning_stop_at=0,this.pan_snap_timer=0,this.zoom_direction=0,this.user_input_at=0,this.user_input_timeout=50,this.user_input_active=!1,this.size={css:{},device:{},meters:{}},this.aspect=null,this.buffer=0,this.continuous_zoom="boolean"!=typeof e.continuousZoom||e.continuousZoom,this.wrap=!1!==e.wrapView,this.preserve_tiles_within_zoom=1,this.reset()}var e=t.prototype;return e.reset=function(){this.createCamera()},e.createCamera=function(){var t=this.getActiveCamera();t&&(this.camera=ja.create(t,this,this.scene.config.cameras[t]),this.camera.updateView())},e.getActiveCamera=function(){if(this.scene.config&&this.scene.config.cameras){for(var t in this.scene.config.cameras)if(this.scene.config.cameras[t].active)return t;var e=Object.keys(this.scene.config.cameras);return e.length&&e[0]}},e.setActiveCamera=function(t){var e=this.getActiveCamera();return e===t?t:(this.scene.config.cameras[t]&&(this.scene.config.cameras[t].active=!0,e&&this.scene.config.cameras[e]&&delete this.scene.config.cameras[e].active),this.scene.updateConfig({rebuild:!1,normalize:!1}),this.getActiveCamera())},e.update=function(){null!=this.camera&&this.ready()&&this.camera.update(),this.pan_snap_timer=(+new Date-this.panning_stop_at)/1e3,this.user_input_active=+new Date-this.user_input_at<this.user_input_timeout},e.setViewportSize=function(t,e){this.size.css={width:t,height:e},this.size.device={width:Math.round(this.size.css.width*Yi.device_pixel_ratio),height:Math.round(this.size.css.height*Yi.device_pixel_ratio)},this.aspect=this.size.css.width/this.size.css.height,this.updateBounds()},e.setView=function(t){var e=void 0===t?{}:t,i=e.lng,r=e.lat,n=e.zoom,o=!1;return"number"==typeof i&&"number"==typeof r&&(this.center&&i===this.center.lng&&r===this.center.lat||(o=!0,this.center={lng:i,lat:r})),"number"==typeof n&&n!==this.zoom&&(o=!0,this.setZoom(n)),o&&this.updateBounds(),o},e.setZoom=function(t){var e=this.tile_zoom,i=this.baseZoom(t);this.continuous_zoom||(t=i),i!==e&&(this.zoom_direction=i>e?1:-1),this.zoom=t,this.tile_zoom=i,this.updateBounds(),this.scene.requestRedraw()},e.baseZoom=function(t){return Math.floor(t)},e.setPanning=function(t){this.panning=t,this.panning||(this.panning_stop_at=+new Date)},e.markUserInput=function(){this.user_input_at=+new Date},e.ready=function(){return"number"==typeof this.size.css.width&&"number"==typeof this.size.css.height&&null!=this.center&&"number"==typeof this.zoom},e.updateBounds=function(){if(this.ready()){this.meters_per_pixel=an.metersPerPixel(this.zoom),this.size.meters={x:this.size.css.width*this.meters_per_pixel,y:this.size.css.height*this.meters_per_pixel};var t=an.latLngToMeters([this.center.lng,this.center.lat]);this.center.meters={x:t[0],y:t[1]},this.center.tile=an.tileForMeters([this.center.meters.x,this.center.meters.y],this.tile_zoom),this.bounds={sw:{x:this.center.meters.x-this.size.meters.x/2,y:this.center.meters.y-this.size.meters.y/2},ne:{x:this.center.meters.x+this.size.meters.x/2,y:this.center.meters.y+this.size.meters.y/2}},this.scene.tile_manager.updateTilesForView(),this.trigger("move"),this.scene.requestRedraw()}},e.findVisibleTileCoordinates=function(){if(!this.bounds)return[];var t=this.tile_zoom,e=an.tileForMeters([this.bounds.sw.x,this.bounds.sw.y],t),i=an.tileForMeters([this.bounds.ne.x,this.bounds.ne.y],t),r=[e.x-this.buffer,i.x+this.buffer,i.y-this.buffer,e.y+this.buffer];if(!1===this.wrap){var n=(1<<t)-1;r=r.map((function(t){return Math.min(Math.max(0,t),n)}))}for(var o=[],s=r[0];s<=r[1];s++)for(var a=r[2];a<=r[3];a++)o.push(go.coord({x:s,y:a,z:t}));return o},e.pruneTilesForView=function(){var t=this;this.ready()&&this.scene.tile_manager.removeTiles((function(e){if(e.visible||e.isProxy())return!1;if(e.loading&&e.style_z!==t.tile_zoom)return!0;if(Math.abs(e.style_z-t.tile_zoom)>(null!=e.preserve_tiles_within_zoom?e.preserve_tiles_within_zoom:t.preserve_tiles_within_zoom))return!0;var i=t.meters_per_pixel*an.tile_size,r=go.coordAtZoom(an.tileForMeters([t.center.meters.x-t.size.meters.x/2-i,t.center.meters.y+t.size.meters.y/2+i],t.tile_zoom),e.coords.z),n=go.coordAtZoom(an.tileForMeters([t.center.meters.x+t.size.meters.x/2+i,t.center.meters.y-t.size.meters.y/2-i],t.tile_zoom),e.coords.z);return(e.coords.x<r.x||e.coords.x>n.x||e.coords.y<r.y||e.coords.y>n.y)&&(Ki("trace","View: remove tile "+e.key+" (as "+e.coords.key+") for being too far out of visible area ("+r.key+", "+n.key+")"),!0)}))},e.createMatrices=function(){this.matrices={},this.matrices.model=new Float64Array(16),this.matrices.model32=new Float32Array(16),this.matrices.model_view=new Float64Array(16),this.matrices.model_view32=new Float32Array(16),this.matrices.normal=new Float64Array(9),this.matrices.normal32=new Float32Array(9),this.matrices.inverse_normal32=new Float32Array(9)},e.setupTile=function(t,e){t.setupProgram(this.matrices,e),this.camera.setupMatrices(this.matrices,e)},e.setupProgram=function(t){t.uniform("2fv","u_resolution",[this.size.device.width,this.size.device.height]),t.uniform("3fv","u_map_position",[this.center.meters.x,this.center.meters.y,this.zoom]),t.uniform("1f","u_meters_per_pixel",this.meters_per_pixel),t.uniform("1f","u_device_pixel_ratio",Yi.device_pixel_ratio),t.uniform("1f","u_view_pan_snap_timer",this.pan_snap_timer),t.uniform("1i","u_view_panning",this.panning),this.camera.setupProgram(t)},e.isAnimating=function(){return this.pan_snap_timer<=.5},t}(),qa=la.PLACEMENT,Ka=Object.create(vo);Object.assign(Ka,Ua),Object.assign(Ka,{name:"points",built_in:!0,vertex_shader_src:"uniform vec2 u_resolution;\nuniform float u_time;\nuniform vec3 u_map_position;\nuniform vec4 u_tile_origin;\nuniform float u_tile_proxy_order_offset;\nuniform bool u_tile_fade_in;\nuniform float u_meters_per_pixel;\nuniform float u_device_pixel_ratio;\nuniform float u_visible_time;\nuniform bool u_view_panning;\nuniform float u_view_pan_snap_timer;\n\nuniform mat4 u_model;\nuniform mat4 u_modelView;\nuniform mat3 u_normalMatrix;\nuniform mat3 u_inverseNormalMatrix;\n\nattribute vec4 a_position;\nattribute vec4 a_shape;\nattribute vec4 a_color;\nattribute vec2 a_texcoord;\nattribute vec2 a_offset;\n\nuniform float u_point_type;\n\n#ifdef TANGRAM_CURVED_LABEL\n    attribute vec4 a_offsets;\n    attribute vec4 a_pre_angles;\n    attribute vec4 a_angles;\n#endif\n\nvarying vec4 v_color;\nvarying vec2 v_texcoord;\nvarying vec4 v_world_position;\nvarying float v_alpha_factor;\n\n#ifdef TANGRAM_HAS_SHADER_POINTS\n    attribute float a_outline_edge;\n    attribute vec4 a_outline_color;\n\n    varying float v_outline_edge;\n    varying vec4 v_outline_color;\n    varying float v_aa_offset;\n#endif\n\n#ifdef TANGRAM_SHOW_HIDDEN_LABELS\n    varying float v_label_hidden;\n#endif\n\n#define TANGRAM_PI 3.14159265359\n#define TANGRAM_NORMAL vec3(0., 0., 1.)\n\n#pragma tangram: attributes\n#pragma tangram: camera\n#pragma tangram: material\n#pragma tangram: lighting\n#pragma tangram: raster\n#pragma tangram: global\n\nvec2 rotate2D(vec2 _st, float _angle) {\n    return mat2(cos(_angle),-sin(_angle),\n                sin(_angle),cos(_angle)) * _st;\n}\n\n#ifdef TANGRAM_CURVED_LABEL\n    // Assumes stops are [0, 0.33, 0.66, 0.99];\n    float mix4linear(vec4 v, float x) {\n        x = clamp(x, 0., 1.);\n        return mix(mix(v[0], v[1], 3. * x),\n                   mix(v[1],\n                       mix(v[2], v[3], 3. * (max(x, .66) - .66)),\n                       3. * (clamp(x, .33, .66) - .33)),\n                   step(0.33, x)\n                );\n    }\n#endif\n\nvoid main() {\n    // Initialize globals\n    #pragma tangram: setup\n\n    // discard hidden labels by collapsing into degenerate triangle\n    #ifndef TANGRAM_SHOW_HIDDEN_LABELS\n        if (a_shape.w == 0.) {\n            gl_Position = vec4(0., 0., 0., 1.);\n            return;\n        }\n    #else\n        // highlight hidden label in fragment shader for debugging\n        if (a_shape.w == 0.) {\n            v_label_hidden = 1.; // label debug testing\n        }\n        else {\n            v_label_hidden = 0.;\n        }\n    #endif\n\n    v_alpha_factor = 1.0;\n    v_color = a_color;\n    v_texcoord = a_texcoord; // UV from vertex attribute\n\n    #ifdef TANGRAM_HAS_SHADER_POINTS\n        v_outline_color = a_outline_color;\n        v_outline_edge = a_outline_edge;\n\n        if (u_point_type == TANGRAM_POINT_TYPE_SHADER) { // shader point\n            // use point dimensions for UVs instead (ignore attribute), add antialiasing info for fragment shader\n            float _size = abs(a_shape.x / 128.); // radius in pixels\n            v_texcoord = sign(a_shape.xy) * (_size + 1.) / _size;\n            _size += 2.;\n            v_aa_offset = 2. / _size;\n        }\n    #endif\n\n    // Position\n    vec4 position = u_modelView * vec4(a_position.xyz, 1.);\n\n    // Apply positioning and scaling in screen space\n    vec2 _shape = a_shape.xy / 256.;                 // values have an 8-bit fraction\n    vec2 _offset = vec2(a_offset.x, -a_offset.y);    // flip y to make it point down\n    float _theta = a_shape.z / 4096.;\n\n    #ifdef TANGRAM_CURVED_LABEL\n        //TODO: potential bug? null is passed in for non-curved labels, otherwise the first offset will be 0\n        if (a_offsets[0] != 0.){\n            vec4 _angles_scaled = (TANGRAM_PI / 16384.) * a_angles;\n            vec4 _pre_angles_scaled = (TANGRAM_PI / 128.) * a_pre_angles;\n            vec4 _offsets_scaled = (1. / 64.) * a_offsets;\n\n            float _zoom = clamp(u_map_position.z - u_tile_origin.z, 0., 1.); //fract(u_map_position.z);\n            float _pre_angle = mix4linear(_pre_angles_scaled, _zoom);\n            float _angle = mix4linear(_angles_scaled, _zoom);\n            float _offset_curve = mix4linear(_offsets_scaled, _zoom);\n\n            _shape = rotate2D(_shape, _pre_angle); // rotate in place\n            _shape.x += _offset_curve;            // offset for curved label segment\n            _shape = rotate2D(_shape, _angle);     // rotate relative to curved label anchor\n            _shape += rotate2D(_offset, _theta);   // offset if specified in the scene file\n        }\n        else {\n            _shape = rotate2D(_shape + _offset, _theta);\n        }\n    #else\n        _shape = rotate2D(_shape + _offset, _theta);\n    #endif\n\n    // Fade in (if requested) based on time mesh has been visible.\n    // Value passed to fragment shader in the v_alpha_factor varying\n    #ifdef TANGRAM_FADE_IN_RATE\n        if (u_tile_fade_in) {\n            v_alpha_factor *= clamp(u_visible_time * TANGRAM_FADE_IN_RATE, 0., 1.);\n        }\n    #endif\n\n    // World coordinates for 3d procedural textures\n    v_world_position = u_model * position;\n    v_world_position.xy += _shape * u_meters_per_pixel;\n    v_world_position = wrapWorldPosition(v_world_position);\n\n    // Modify position before camera projection\n    #pragma tangram: position\n\n    cameraProjection(position);\n\n    #ifdef TANGRAM_LAYER_ORDER\n        // +1 is to keep all layers including proxies > 0\n        applyLayerOrder(a_position.w + u_tile_proxy_order_offset + 1., position);\n    #endif\n\n    // Apply pixel offset in screen-space\n    // Multiply by 2 is because screen is 2 units wide Normalized Device Coords (and u_resolution device pixels wide)\n    // Device pixel ratio adjustment is because shape is in logical pixels\n    position.xy += _shape * position.w * 2. * u_device_pixel_ratio / u_resolution;\n    #ifdef TANGRAM_HAS_SHADER_POINTS\n        if (u_point_type == TANGRAM_POINT_TYPE_SHADER) { // shader point\n            // enlarge by 1px to catch missed MSAA fragments\n            position.xy += sign(_shape) * position.w * u_device_pixel_ratio / u_resolution;\n        }\n    #endif\n\n    // Snap to pixel grid\n    // Only applied to fully upright sprites/labels (not shader-drawn points), while panning is not active\n    #ifdef TANGRAM_HAS_SHADER_POINTS\n    if (!u_view_panning && (abs(_theta) < TANGRAM_EPSILON) && u_point_type != TANGRAM_POINT_TYPE_SHADER) {\n    #else\n    if (!u_view_panning && (abs(_theta) < TANGRAM_EPSILON)) {\n    #endif\n        vec2 _position_fract = fract((((position.xy / position.w) + 1.) * .5) * u_resolution);\n        vec2 _position_snap = position.xy + ((step(0.5, _position_fract) - _position_fract) * position.w * 2. / u_resolution);\n\n        // Animate the snapping to smooth the transition and make it less noticeable\n        #ifdef TANGRAM_VIEW_PAN_SNAP_RATE\n            position.xy = mix(position.xy, _position_snap, clamp(u_view_pan_snap_timer * TANGRAM_VIEW_PAN_SNAP_RATE, 0., 1.));\n        #else\n            position.xy = _position_snap;\n        #endif\n    }\n\n    gl_Position = position;\n}\n",fragment_shader_src:"uniform vec2 u_resolution;\nuniform float u_time;\nuniform vec3 u_map_position;\nuniform vec4 u_tile_origin;\nuniform float u_meters_per_pixel;\nuniform float u_device_pixel_ratio;\nuniform float u_visible_time;\n\nuniform mat3 u_normalMatrix;\nuniform mat3 u_inverseNormalMatrix;\n\nuniform sampler2D u_texture;\nuniform float u_point_type;\nuniform bool u_apply_color_blocks;\n\nvarying vec4 v_color;\nvarying vec2 v_texcoord;\nvarying vec4 v_world_position;\nvarying float v_alpha_factor;\n\n#ifdef TANGRAM_HAS_SHADER_POINTS\n    varying vec4 v_outline_color;\n    varying float v_outline_edge;\n    varying float v_aa_offset;\n#endif\n\n#ifdef TANGRAM_SHOW_HIDDEN_LABELS\n    varying float v_label_hidden;\n#endif\n\n#define TANGRAM_NORMAL vec3(0., 0., 1.)\n\n#pragma tangram: attributes\n#pragma tangram: camera\n#pragma tangram: material\n#pragma tangram: lighting\n#pragma tangram: raster\n#pragma tangram: global\n\n#ifdef TANGRAM_HAS_SHADER_POINTS\n    //l is the distance from the center to the fragment, R is the radius of the drawn point\n    float _tangram_antialias(float l, float R){\n        float low  = R - v_aa_offset;\n        float high = R + v_aa_offset;\n        return 1. - smoothstep(low, high, l);\n    }\n#endif\n\nvoid main (void) {\n    // Initialize globals\n    #pragma tangram: setup\n\n    vec4 color = v_color;\n\n    #ifdef TANGRAM_HAS_SHADER_POINTS\n        // Only apply shader blocks to point, not to attached text (N.B.: for compatibility with ES)\n        if (u_point_type == TANGRAM_POINT_TYPE_TEXTURE) { // sprite texture\n            color *= texture2D(u_texture, v_texcoord);\n        }\n        else if (u_point_type == TANGRAM_POINT_TYPE_LABEL) { // label texture\n            color = texture2D(u_texture, v_texcoord);\n            color.rgb /= max(color.a, 0.001); // un-multiply canvas texture\n        }\n        else if (u_point_type == TANGRAM_POINT_TYPE_SHADER) { // shader point\n            // Mask of outermost circle, either outline or point boundary\n            float _d = length(v_texcoord); // distance to this fragment from the point center\n            float _outer_alpha = _tangram_antialias(_d, 1.);\n            float _fill_alpha = _tangram_antialias(_d, 1. - (v_outline_edge * 0.5)) * color.a;\n            float _stroke_alpha = (_outer_alpha - _tangram_antialias(_d, 1. - v_outline_edge)) * v_outline_color.a;\n\n            // Apply alpha compositing with stroke 'over' fill.\n            #ifdef TANGRAM_BLEND_ADD\n                color.a = _stroke_alpha + _fill_alpha;\n                color.rgb = color.rgb * _fill_alpha + v_outline_color.rgb * _stroke_alpha;\n            #else // TANGRAM_BLEND_OVERLAY (and fallback for not implemented blending modes)\n                color.a = _stroke_alpha + _fill_alpha * (1. - _stroke_alpha);\n                color.rgb = mix(color.rgb * _fill_alpha, v_outline_color.rgb, _stroke_alpha) / max(color.a, 0.001); // avoid divide by zero\n            #endif\n        }\n    #else\n        // If shader points not supported, assume label texture\n        color = texture2D(u_texture, v_texcoord);\n        color.rgb /= max(color.a, 0.001); // un-multiply canvas texture\n    #endif\n\n    // Shader blocks for color/filter are only applied for sprites, shader points, and standalone text,\n    // NOT for text attached to a point (N.B.: for compatibility with ES)\n    if (u_apply_color_blocks) {\n        #pragma tangram: color\n        #pragma tangram: filter\n    }\n\n    color.a *= v_alpha_factor;\n\n    // highlight hidden label in fragment shader for debugging\n    #ifdef TANGRAM_SHOW_HIDDEN_LABELS\n        if (v_label_hidden > 0.) {\n            color.a *= 0.5;\n            color.rgb = vec3(1., 0., 0.);\n        }\n    #endif\n\n    // Use alpha test as a lower-quality substitute\n    // For opaque and translucent: avoid transparent pixels writing to depth buffer, obscuring geometry underneath\n    // For multiply: avoid transparent pixels multiplying geometry underneath to zero/full black\n    #if defined(TANGRAM_BLEND_OPAQUE) || defined(TANGRAM_BLEND_TRANSLUCENT) || defined(TANGRAM_BLEND_MULTIPLY)\n        if (color.a < TANGRAM_ALPHA_TEST) {\n            discard;\n        }\n    #endif\n\n    // Make points more visible in wireframe debug mode\n    #ifdef TANGRAM_WIREFRAME\n        color = vec4(vec3(0.5), 1.); // use gray outline for textured points\n        #ifdef TANGRAM_HAS_SHADER_POINTS\n            if (u_point_type == TANGRAM_POINT_TYPE_SHADER) {\n                color = vec4(v_color.rgb, 1.); // use original vertex color outline for shader points\n            }\n        #endif\n    #endif\n\n    gl_FragColor = color;\n}\n",selection:!0,collision:!0,blend:"overlay",init:function(t){void 0===t&&(t={}),vo.init.call(this,t),this.setupDefines(),this.defines.TANGRAM_HAS_SHADER_POINTS=!0,this.defines.TANGRAM_POINT_TYPE_TEXTURE=1,this.defines.TANGRAM_POINT_TYPE_LABEL=2,this.defines.TANGRAM_POINT_TYPE_SHADER=3,this.collision_group_points=this.name+"-points",this.collision_group_text=this.name+"-text",this.stencil_proxy_tiles=!1,this.reset()},setupDefines:function(){"overlay"!==this.blend&&(this.defines.TANGRAM_LAYER_ORDER=!0),!0===tr.suppress_label_fade_in?(this.fade_in_time=0,this.defines.TANGRAM_FADE_IN_RATE=null):(this.fade_in_time=.15,this.defines.TANGRAM_FADE_IN_RATE=1/this.fade_in_time),!0!==tr.suppress_label_snap_animation&&(this.defines.TANGRAM_VIEW_PAN_SNAP_RATE=2),!0===tr.show_hidden_labels&&(this.defines.TANGRAM_SHOW_HIDDEN_LABELS=!0),!0===tr.wireframe&&(this.defines.TANGRAM_WIREFRAME=!0)},reset:function(){this.queues={},this.resetText(),this.texture_missing_sprites={}},addFeature:function(t,e,i){var r=i.tile;if(r.generation===this.generation){var n={};if(n.color=this.parseColor(e.color,i),n.texture=e.texture,n.label_texture=null,n.blend_order=e.blend_order,n.color||n.texture){var o;if(n.alpha=Rn.evalCachedProperty(e.alpha,i),this.hasSprites(n)){if(!(o=this.parseSprite(n,e,i)))return void Ki({level:"debug",once:!0},"Layer group '"+e.layers.join(", ")+"' uses a texture '"+n.texture+"', but doesn't specify which sprite to draw. Features that match this layer group won't be drawn without specifying the sprite with the 'sprite' or 'sprite_default' properties. The merged draw parameters for this layer group are:",e).then((function(i){i&&Ki("debug","Example feature for layer group '"+e.layers.join(", ")+"'",t)}));n.texcoords=o.texcoords}else if(e.sprite)return void Ki({level:"warn",once:!0},"Layer group '"+e.layers.join(", ")+"' specifies sprite '"+e.sprite+"', but the texture '"+e.texture+"' doesn't define any sprites. Features that match this layer group won't be drawn. The merged draw parameters for this layer group are:",e);if(this.calcSize(e,n,o,i),e.outline&&(n.outline_width=Rn.evalCachedProperty(e.outline.width,i)||Rn.defaults.outline.width,n.outline_color=this.parseColor(e.outline.color,i)),n.outline_edge_pct=0,n.outline_width&&n.outline_color){var s=n.outline_width;n.size[0]+=s,n.size[1]+=s,n.outline_edge_pct=s/Math.min(n.size[0],n.size[1])*2,n.outline_alpha=Rn.evalCachedProperty(e.outline.alpha,i)}n.size[0]=Math.min(n.size[0],256),n.size[1]=Math.min(n.size[1],256),n.placement=e.placement,n.placement_min_length_ratio=Rn.evalCachedProperty(e.placement_min_length_ratio,i),n.placement===qa.SPACED&&e.placement_spacing&&(n.placement_spacing=Rn.evalCachedProperty(e.placement_spacing,i)),n.angle=Rn.evalProperty(e.angle,i)||0,n.z=Rn.evalCachedDistanceProperty(e.z,i)||Rn.defaults.z,n.tile_edges=e.tile_edges,this.computeLayout(n,t,e,i,r);var a=e.text&&!1!==e.text.visible&&this.parseTextFeature(t,e.text,i,r);Array.isArray(a)&&(a=null,Ki({level:"warn",once:!0},"Layer group '"+e.layers.join(", ")+"': cannot use boundary labels (e.g. 'text_source: { left: ..., right: ... }') for 'text' labels attached to 'points'; provided 'text_source' value was "+JSON.stringify(e.text.text_source))),a&&(a.layout.parent=n,a.layout.priority=e.text.priority?Math.max(a.layout.priority,n.priority+.5):n.priority+.5,aa.addStyle(this.collision_group_text,r.id)),this.queueFeature({feature:t,draw:e,context:i,style:n,text_feature:a},r),aa.addStyle(this.collision_group_points,r.id)}}},calcSize:function(t,e,i,r){if(e.size=t.size,e.size){if(e.size=Rn.evalCachedPointSizeProperty(t.size,i,Hr.textures[e.texture],r),null==e.size)return void Ki({level:"warn",once:!0},"Layer group '"+t.layers.join(", ")+"': 'size' ("+JSON.stringify(t.size.value)+") couldn't be interpreted, features that match this layer group won't be drawn");"number"==typeof e.size&&(e.size=[e.size,e.size])}else e.size=i&&i.css_size||[16,16]},hasSprites:function(t){return t.texture&&Hr.textures[t.texture]&&Hr.textures[t.texture].sprites},getSpriteInfo:function(t,e){var i=Hr.textures[t.texture].sprites[e]&&Hr.getSpriteInfo(t.texture,e);return e&&!i?(this.texture_missing_sprites[t.texture]=this.texture_missing_sprites[t.texture]||{},this.texture_missing_sprites[t.texture][e]||(Ki("debug","Style: in style '"+this.name+"', could not find sprite '"+e+"' for texture '"+t.texture+"'"),this.texture_missing_sprites[t.texture][e]=!0)):i&&(i.sprite=e),i},parseSprite:function(t,e,i){var r=Rn.evalProperty(e.sprite,i);return this.getSpriteInfo(t,r)||this.getSpriteInfo(t,e.sprite_default)},queueFeature:function(t,e){this.tile_data[e.id]&&this.queues[e.id]||this.startData(e),this.queues[e.id]=this.queues[e.id]||[],this.queues[e.id].push(t)},endData:function(t){return new Promise(function(e,i){var r,n,o,s,a,l,c,u,h,d;return r=this,t.canceled?(Ki("trace","Style "+this.name+": stop tile build because tile was canceled: "+t.key),e(null)):(n=this.queues[t.id],delete this.queues[t.id],o=[],s=[],n.forEach((function(t){for(var e=t.style,i=t.feature,n=i.geometry,a=r.buildLabels(e.size,n,e),l=0;l<a.length;l++){var c=a[l],u={feature:i,draw:t.draw,context:t.context,style:e,label:c};if(s.push(u),t.text_feature){var h={feature:i,draw:t.text_feature.draw,context:t.context,text:t.text_feature.text,text_settings_key:t.text_feature.text_settings_key,layout:t.text_feature.layout,point_label:c,linked:u};o.push(h),t.draw.text.optional||(u.linked=h)}}})),Promise.resolve(Promise.all([aa.collide(s,this.collision_group_points,t.id).then((function(t){t.forEach((function(t){r.feature_style=t.style,r.feature_style.label=t.label,r.feature_style.linked=t.linked,vo.addFeature.call(r,t.feature,t.draw,t.context)}))})),this.collideAndRenderTextLabels(t,this.collision_group_text,o)])).then(function(n){try{return a=n[1],l=a.labels,c=a.texts,u=a.textures,l&&c&&l.forEach((function(t){var e=t.text_settings_key,i=c[e]&&c[e][t.text],n=r.feature_style;n.label=t.label,n.linked=t.linked,n.size=i.size.logical_size,n.texcoords=i.align[t.label.align].texcoords,n.label_texture=u[i.align[t.label.align].texture_id],n.blend_order=t.draw.blend_order,vo.addFeature.call(r,t.feature,t.draw,t.context)})),this.freeText(t),Promise.resolve(vo.endData.call(this,t)).then((function(t){try{return(h=t)&&u&&u.length&&(h.textures=h.textures||[],(d=h.textures).push.apply(d,u)),e(h)}catch(t){return i(t)}}),i)}catch(t){return i(t)}}.bind(this),i))}.bind(this))},_preprocess:function(t){t.color=Rn.createColorPropertyCache(t.color),t.alpha=Rn.createPropertyCache(t.alpha),t.texture=void 0!==t.texture?t.texture:this.texture,t.blend_order=this.getBlendOrderForDraw(t),t.outline&&(t.outline.color=Rn.createColorPropertyCache(t.outline.color),t.outline.alpha=Rn.createPropertyCache(t.outline.alpha),t.outline.width=Rn.createPropertyCache(t.outline.width,Rn.parsePositiveNumber)),t.z=Rn.createPropertyCache(t.z,Rn.parseUnits);try{t.size=Rn.createPointSizePropertyCache(t.size,t.texture)}catch(e){return Ki({level:"warn",once:!0},"Layer group '"+t.layers.join(", ")+"': "+e+" ("+JSON.stringify(t.size)+"), features that match this layer group won't be drawn."),null}if(t.offset=Rn.createPropertyCache(t.offset,(function(t){return Array.isArray(t)&&t.map(Rn.parseNumber)})),t.buffer=Rn.createPropertyCache(t.buffer,(function(t){return(Array.isArray(t)?t:[t,t]).map(Rn.parsePositiveNumber)})),t.repeat_distance=Rn.createPropertyCache(t.repeat_distance,Rn.parseNumber),t.placement=qa[t.placement&&t.placement.toUpperCase()],null==t.placement&&(t.placement=qa.VERTEX),t.placement_spacing=null!=t.placement_spacing?t.placement_spacing:80,t.placement_spacing=Rn.createPropertyCache(t.placement_spacing,Rn.parsePositiveNumber),t.placement_min_length_ratio=null!=t.placement_min_length_ratio?t.placement_min_length_ratio:1,t.placement_min_length_ratio=Rn.createPropertyCache(t.placement_min_length_ratio,Rn.parsePositiveNumber),"number"==typeof t.angle)t.angle=t.angle*Math.PI/180;else if("function"==typeof t.angle){var e=t.angle;t.angle=function(t){return e(t)*Math.PI/180}}else t.angle=t.angle||0;return t.text=this.preprocessText(t.text),t.text&&(t.text.key=t.key,t.text.group=t.group,t.text.layers=t.layers,t.text.order=t.order,t.text.blend_order=t.blend_order,t.text.repeat_group=null!=t.text.repeat_group?t.text.repeat_group:t.repeat_group,t.text.anchor=t.text.anchor||this.default_anchor,t.text.optional="boolean"==typeof t.text.optional&&t.text.optional,t.text.interactive=t.text.interactive||t.interactive),t},default_anchor:["bottom","top","right","left"],computeLayout:function(t,e,i,r,n){var o=t||{};o.id=e,o.units_per_pixel=n.units_per_pixel||1,o.collide=!1!==i.collide,o.anchor=i.anchor,o.offset=Rn.evalCachedProperty(i.offset,r)||Rn.zeroPair,o.buffer=Rn.evalCachedProperty(i.buffer,r)||Rn.zeroPair,o.repeat_distance=Rn.evalCachedProperty(i.repeat_distance,r),o.repeat_distance&&(o.repeat_distance*=o.units_per_pixel,o.repeat_scale=1,"function"==typeof i.repeat_group?o.repeat_group=i.repeat_group(r):o.repeat_group=i.repeat_group||r.layer);var s=i.priority;return null!=s?"function"==typeof s&&(s=s(r)):s=-1>>>0,o.priority=s,o},buildTextLabels:function(t,e){for(var i=[],r=0;r<e.length;r++){var n=e[r],o=this.texts[t.id][n.text_settings_key][n.text].size.collision_size;n.label=new la(n.point_label.position,o,n.layout),i.push(n)}return i},buildLabels:function(t,e,i){var r=[];if("Point"===e.type)r.push(new la(e.coordinates,t,i,i.angle));else if("MultiPoint"===e.type)for(var n=e.coordinates,o=0;o<n.length;++o){var s=n[o];r.push(new la(s,t,i,i.angle))}else if("LineString"===e.type)for(var a=ha(e.coordinates,t,i),l=0;l<a.length;++l)r.push(a[l]);else if("MultiLineString"===e.type)for(var c=e.coordinates,u=0;u<c.length;u++)for(var h=ha(c[u],t,i),d=0;d<h.length;++d)r.push(h[d]);else if("Polygon"===e.type)if(i.placement===qa.CENTROID){var p=an.centroid(e.coordinates);p&&r.push(new la(p,t,i,i.angle))}else for(var f=e.coordinates,A=0;A<f.length;A++)for(var m=ha(f[A],t,i),g=0;g<m.length;++g)r.push(m[g]);else if("MultiPolygon"===e.type)if(i.placement===qa.CENTROID){var _=an.multiCentroid(e.coordinates);_&&r.push(new la(_,t,i,i.angle))}else for(var y=e.coordinates,v=0;v<y.length;v++)for(var x=y[v],b=0;b<x.length;b++)for(var w=ha(x[b],t,i),T=0;T<w.length;++T)r.push(w[T]);return r},makeVertexTemplate:function(t,e,i){void 0===i&&(i=!0);var r=0;this.vertex_template[r++]=0,this.vertex_template[r++]=0,this.vertex_template[r++]=t.z||0,this.vertex_template[r++]=this.scaleOrder(t.order),this.vertex_template[r++]=0,this.vertex_template[r++]=0,this.vertex_template[r++]=0,this.vertex_template[r++]=t.label.layout.collide?0:1,e.variant.shader_point||(this.vertex_template[r++]=0,this.vertex_template[r++]=0),this.vertex_template[r++]=0,this.vertex_template[r++]=0;var n=t.color||Rn.defaults.color;if(this.vertex_template[r++]=255*n[0],this.vertex_template[r++]=255*n[1],this.vertex_template[r++]=255*n[2],this.vertex_template[r++]=255*(null!=t.alpha?t.alpha:n[3]),e.variant.selection&&(this.vertex_template[r++]=255*t.selection_color[0],this.vertex_template[r++]=255*t.selection_color[1],this.vertex_template[r++]=255*t.selection_color[2],this.vertex_template[r++]=255*t.selection_color[3]),e.variant.shader_point){var o=t.outline_color||Rn.defaults.outline.color;this.vertex_template[r++]=255*o[0],this.vertex_template[r++]=255*o[1],this.vertex_template[r++]=255*o[2],this.vertex_template[r++]=255*(null!=t.outline_alpha?t.outline_alpha:o[3]),this.vertex_template[r++]=t.outline_edge_pct||Rn.defaults.outline.width}return i&&this.addCustomAttributesToVertexTemplate(t,r),this.vertex_template},buildQuad:function(t,e,i,r,n,o,s,a,l,c,u){return e[0]<=0||e[1]<=0?0:function(t,e,i,r,n,o,s,a,l,c,u,h){var d=n[0]*Os,p=n[1]*Os;Vs[0]=-d,Vs[1]=-p,Vs[2]=d,Vs[3]=p;for(var f=u||Mo,A=e.vertex_elements,m=e.vertex_count,g=0;g<4;g++)i[r.a_position+0]=t[0],i[r.a_position+1]=t[1],i[r.a_shape+0]=Vs[Ns[g]],i[r.a_shape+1]=Vs[Qs[g]],i[r.a_shape+2]=l,i[r.a_offset+0]=o[0],i[r.a_offset+1]=o[1],r.a_texcoord&&(i[r.a_texcoord+0]=f[Ns[g]]*Us,i[r.a_texcoord+1]=f[Qs[g]]*Us),h&&(i[r.a_pre_angles+0]=Fs*a[0],i[r.a_pre_angles+1]=Fs*a[1],i[r.a_pre_angles+2]=Fs*a[2],i[r.a_pre_angles+3]=Fs*a[3],i[r.a_angles+0]=Ds*c[0],i[r.a_angles+1]=Ds*c[1],i[r.a_angles+2]=Ds*c[2],i[r.a_angles+3]=Ds*c[3],i[r.a_offsets+0]=Rs*s[0],i[r.a_offsets+1]=Rs*s[1],i[r.a_offsets+2]=Rs*s[2],i[r.a_offsets+3]=Rs*s[3]),e.addVertex(i);return A.push(m+0),A.push(m+1),A.push(m+2),A.push(m+2),A.push(m+3),A.push(m+0),2}(t,c,u,c.vertex_layout.index,e,o,s,n,4096*i,r,a,l)},build:function(t,e){var i=t.label;return"curved"===i.type?this.buildCurvedLabel(i,t,e):this.buildStraightLabel(i,t,e)},buildStraightLabel:function(t,e,i){var r,n,o=this.getTileMesh(i.tile,this.meshVariantTypeForDraw(e)),s=this.makeVertexTemplate(e,o);"point"!==t.type?(r=e.size[t.type],n=e.texcoords[t.type].texcoord):(r=e.size,n=e.texcoords),o.uniforms=o.uniforms||{},e.label_texture?(o.uniforms.u_texture=e.label_texture,o.uniforms.u_point_type=2,o.uniforms.u_apply_color_blocks=!1):e.texture?(o.uniforms.u_texture=e.texture,o.uniforms.u_point_type=1,o.uniforms.u_apply_color_blocks=!0):(o.uniforms.u_texture=Hr.default,o.uniforms.u_point_type=3,o.uniforms.u_apply_color_blocks=!0);var a=t.offset,l=this.buildQuad(t.position,r,t.angle,null,null,a,null,n,!1,o.vertex_data,s),c=e.linked&&e.linked.label.id;return this.trackLabel(t,c,o,l,i),l},buildCurvedLabel:function(t,e,i){for(var r,n,o=0,s=0;s<t.num_segments;s++){var a=e.size[t.type][s],l=e.texcoords_stroke[s];e.label_texture=e.label_textures[s],r=this.getTileMesh(i.tile,this.meshVariantTypeForDraw(e)),n=this.makeVertexTemplate(e,r),r.uniforms=r.uniforms||{},r.uniforms.u_texture=e.label_texture,r.uniforms.u_point_type=2,r.uniforms.u_apply_color_blocks=!1;var c=t.offset||[0,0],u=t.position,h=t.angles[s],d=t.offsets[s],p=t.pre_angles[s],f=this.buildQuad(u,a,t.angle,h,p,c,d,l,!0,r.vertex_data,n);o+=f;var A=e.linked&&e.linked.label.id;this.trackLabel(t,A,r,f,i)}for(var m=0;m<t.num_segments;m++){var g=e.size[t.type][m],_=e.texcoords[t.type][m].texcoord;e.label_texture=e.label_textures[m],r=this.getTileMesh(i.tile,this.meshVariantTypeForDraw(e)),n=this.makeVertexTemplate(e,r),r.uniforms=r.uniforms||{},r.uniforms.u_texture=e.label_texture,r.uniforms.u_point_type=2,r.uniforms.u_apply_color_blocks=!1;var y=t.offset||[0,0],v=t.position,x=t.angles[m],b=t.offsets[m],w=t.pre_angles[m],T=this.buildQuad(v,g,t.angle,x,w,y,b,_,!0,r.vertex_data,n);o+=T;var B=e.linked&&e.linked.label.id;this.trackLabel(t,B,r,T,i)}return o},trackLabel:function(t,e,i,r){if(t.layout.collide||t.may_repeat_across_tiles){i.labels=i.labels||{},i.labels[t.id]=i.labels[t.id]||{container:{label:t.toJSON(),linked:e},ranges:[]};var n=2*r,o=i.vertex_data.offset-i.vertex_data.stride*n;i.labels[t.id].ranges.push([o,n])}},buildLines:function(t,e,i){return this.build(e,i)},buildPoints:function(t,e,i){return this.build(e,i)},buildPolygons:function(t,e,i){return this.build(e,i)},vertexLayoutForMeshVariant:function(t){if(null==this.vertex_layouts[t.shader_point]){var e=[{name:"a_position",size:4,type:Xn.SHORT,normalized:!1},{name:"a_shape",size:4,type:Xn.SHORT,normalized:!1},{name:"a_texcoord",size:2,type:Xn.UNSIGNED_SHORT,normalized:!0,static:t.shader_point?[0,0]:null},{name:"a_offset",size:2,type:Xn.SHORT,normalized:!1},{name:"a_color",size:4,type:Xn.UNSIGNED_BYTE,normalized:!0},{name:"a_selection_color",size:4,type:Xn.UNSIGNED_BYTE,normalized:!0,static:t.selection?null:[0,0,0,0]},{name:"a_outline_color",size:4,type:Xn.UNSIGNED_BYTE,normalized:!0,static:t.shader_point?null:[0,0,0,0]},{name:"a_outline_edge",size:1,type:Xn.FLOAT,normalized:!1,static:t.shader_point?null:0}];this.addCustomAttributesToAttributeList(e),this.vertex_layouts[t.shader_point]=new So(e)}return this.vertex_layouts[t.shader_point]},meshVariantTypeForDraw:function(t){var e=t.label_texture||t.texture||"__shader_point",i=e+"/"+t.blend_order;return null==this.variants[i]&&(this.variants[i]={key:i,selection:1,shader_point:"__shader_point"===e,blend_order:t.blend_order,mesh_order:t.label_texture?1:0}),this.variants[i]},makeMesh:function(t,e,i){return void 0===i&&(i={}),i=Object.assign({},i,{fade_in_time:this.fade_in_time}),vo.makeMesh.call(this,t,e,i)}});var Wa=Math.abs;U(U.S,"Math",{hypot:function(t,e){for(var i,r,n=0,o=0,s=arguments.length,a=0;o<s;)a<(i=Wa(arguments[o++]))?(n=n*(r=a/i)*r+1,a=i):n+=i>0?(r=i/a)*r:i;return a===1/0?1/0:a*Math.sqrt(n)}});var Xa=[0,.33,.66,.99],Ja=function(t,e,i,r){for(var n=[{type:"straight",tolerance:r.no_curving?1.8:1.5},{type:"curved"},{type:"straight",tolerance:2.3}],o=0;o<n.length;o++){var s=n[o],a=void 0;if("straight"===s.type?a=new tl(e,i,r,s.tolerance):"curved"===s.type&&!r.no_curving&&i.length>2&&(a=new el(t,i,r)),a&&!a.throw_away)return a}return!1},Ya=function(){function t(t){this.id=ra.nextLabelId(),this.layout=t,this.position=[],this.angle=0,this.offset=t.offset.slice(),this.unit_scale=this.layout.units_per_pixel,this.obbs=[],this.aabbs=[],this.type="",this.throw_away=!1}var e=t.prototype;return e.toJSON=function(){return{id:this.id,type:this.type,position:this.position,size:this.size,offset:this.offset,angle:this.angle,breach:this.breach,may_repeat_across_tiles:this.may_repeat_across_tiles,layout:na(this.layout)}},t.splitLineByOrientation=function(t){for(var e=[t[0]],i=0,r=0,n=0,o=e,s=!1,a=1;a<t.length;a++){var l=t[a],c=t[a-1],u=oo.length(oo.sub(l,c));l[0]>c[0]?1===n?(e.push(l),(i+=u)>r&&(o=e,r=i,s=!1)):(e=[c,l],(i=u)>r&&(o=e,r=i,s=!1),n=1):l[0]<c[0]?-1===n?(e.unshift(l),(i+=u)>r&&(o=e,r=i,s=!0)):(e=[l,c],(i=u)>r&&(o=e,r=i,s=!0),n=-1):(-1===n?e.unshift(l):(e.push(l),n=1),(i+=u)>r&&(o=e,r=i,s=-1===n))}return[o,s]},e.discard=function(t,e){if(void 0===e&&(e=null),this.throw_away)return!0;for(var i=0;i<this.obbs.length;i++){var r={aabb:this.aabbs[i],obb:this.obbs[i]};if(ra.prototype.occluded.call(r,t,e))return!0}return!1},e.inTileBounds=function(){for(var t=0;t<this.aabbs.length;t++){var e={aabb:this.aabbs[t]};if(!ra.prototype.inTileBounds.call(e))return!1}return!0},t.createOBB=function(t,e,i,r,n,o,s){var a=t[0],l=t[1];return!o||0===o[0]&&0===o[1]||(a+=(o=oo.rot(o,n))[0]*s,l-=o[1]*s),new ia(a,l,-r,e,i)},t}(),tl=function(t){function e(e,i,r,n){var o;return(o=t.call(this,r)||this).type="straight",o.size=e,o.throw_away=!o.fit(e,i,r,n),o}fe(e,t);var i=e.prototype;return i.fit=function(t,e,i,r){var n,o=this.unit_scale,s=Ya.splitLineByOrientation(e);e=s[0],n=s[1],"number"==typeof i.orientation&&(this.offset[1]+=1.2*(t[1]-i.vertical_buffer),n&&(this.offset[1]*=-1),-1===i.orientation&&(this.offset[1]*=-1));for(var a=nl(e),l=t[0]*o,c=0;c<e.length-1;c++)for(var u=e[c],h=0,d=0,p=c+1,f=void 0;p<e.length;){var A=e[p-1],m=e[p],g=rl(A,m);if(p!==c+1&&(h+=ol(g,f)),Math.abs(h)>.1)break;if(il(d+=a[p-1],l)<r){var _=oo.mult(oo.add(u,m),.5);return this.angle=-g,Math.abs(this.angle-Math.PI/2)<.01&&(this.angle=-Math.PI/2,"number"==typeof i.orientation&&(this.offset[1]*=-1)),this.position=_,this.updateBBoxes(this.position,t,this.angle,this.angle,this.offset),!0}f=g,p++}return!1},i.updateBBoxes=function(t,e,i,r,n){var o=this.unit_scale;this.obbs=[],this.aabbs=[];var s=(e[0]+2*this.layout.buffer[0])*o*ra.epsilon,a=(e[1]+2*this.layout.buffer[1])*o*ra.epsilon,l=Ya.createOBB(t,s,a,i,r,n,o),c=l.getExtent();this.obbs.push(l),this.aabbs.push(c),this.inTileBounds&&(this.breach=!this.inTileBounds()),this.mayRepeatAcrossTiles&&(this.may_repeat_across_tiles=this.mayRepeatAcrossTiles())},e}(Ya),el=function(t){function e(e,i,r){var n;return(n=t.call(this,r)||this).type="curved",n.angles=[],n.pre_angles=[],n.offsets=[],n.num_segments=e.length,n.sizes=e,n.throw_away=!n.fit(n.sizes,i,r),n}fe(e,t);var i=e.prototype;return i.toJSON=function(){return{id:this.id,type:this.type,obbs:this.obbs.map((function(t){return t.toJSON()})),position:this.position,breach:this.breach,may_repeat_across_tiles:this.may_repeat_across_tiles,layout:na(this.layout)}},i.fit=function(t,i,r){var n,o=this.unit_scale,s=Math.max.apply(Math,t.map((function(t){return t[1]}))),a=s*o,l=Ya.splitLineByOrientation(i);i=l[0],n=l[1],"number"==typeof r.orientation&&(this.offset[1]+=1.2*(s-r.vertical_buffer),n&&(this.offset[1]*=-1),-1===r.orientation&&(this.offset[1]*=-1));var c=nl(i),u=t.map((function(t){return t[0]*o})),h=c.reduce((function(t,e){return t+e}),0),d=u.reduce((function(t,e){return t+e}),0);if(d>h)return!1;var p=i.length-1;if(p-0<2)return!1;var f=e.curvaturePlacement(i,h,c,d,0,p),A=i[f];if(-1===f||p-f<2)return!1;this.position=A;for(var m=0;m<u.length;m++){this.offsets[m]=[],this.angles[m]=[],this.pre_angles[m]=[];for(var g=0;g<Xa.length;g++){var _=Xa[g],y=e.scaleLine(_,i),v=y[0],x=y[1];A=v[f];var b=e.placeAtIndex(f,v,x,u),w=b.positions,T=b.offsets,B=b.angles,E=b.pre_angles,C=T.map((function(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])/o}));if(0===_){this.angle=1/B.length*B.reduce((function(t,e){return t+e}));for(var S=0;S<w.length;S++){var I=w[S],M=E[S],k=u[S],P=M+B[S],L=this.angle,z=Ya.createOBB(I,k,a,P,L,this.offset,o),F=z.getExtent();this.obbs.push(z),this.aabbs.push(F)}}this.offsets[m].push(C[m]),this.angles[m].push(B[m]),this.pre_angles[m].push(E[m])}}return!0},e.curvaturePlacement=function(t,e,i,r,n,o){n=n||0,o=o||t.length-1;for(var s=[],a=n+1;a<o;a++){var l=t[a-1],c=t[a],u=t[a+1],h=oo.perp(c,l),d=oo.perp(u,c),p=oo.angleBetween(h,d);p>1&&(p=1/0),s.push(p)}s.push(1/0);for(var f=[],A=[],m=n,g=0,_=0;_<n;_++)g+=i[_];for(;g+r<e;){for(var y=g+r,v=g,x=m,b=0;x<o&&v+i[x]<y&&(b+=s[x])!==1/0;)v+=i[x],x++;if(0===b)return m;var w=b/(x-m);f.push(b),A.push(w),g+=i[m],m++}if(0===f.length)return-1;var T=Math.min.apply(null,f),B=A[f.indexOf(T)];return T<1.3&&B<.4?f.indexOf(T):-1},e.scaleLine=function(t,e){var i=[e[0]],r=[];return e.forEach((function(n,o){if(o!==e.length-1){var s=oo.sub(e[o+1],e[o]),a=oo.mult(s,1+t);i.push(oo.add(i[o],a)),r.push(oo.length(a))}})),[i,r]},e.placeAtIndex=function(t,i,r,n){var o=i[t],s=e.getIndicesAndOffsets(t,r,n),a=s[0],l=s[1],c=e.getPositionsFromIndicesAndOffsets(i,a,l),u=e.getAnglesFromIndicesAndOffsets(o,a,i,c);return{positions:c,offsets:u[0],angles:u[1],pre_angles:u[2]}},e.getIndicesAndOffsets=function(t,e,i){for(var r=i.length,n=[],o=[],s=0,a=0,l=0;s<r;){for(var c=i[s];s<r&&a+.5*c<=l+e[t];){var u=a-l+.5*c;o.push(u),n.push(t),a+=c,c=i[++s]}l+=e[t],t++}return[n,o]},e.getPositionsFromIndicesAndOffsets=function(t,e,i){for(var r=[],n=0;n<e.length;n++){var o=e[n],s=i[n],a=rl(t[o],t[o+1]),l=oo.rot([s,0],a),c=oo.add(t[o],l);r.push(c)}return r},e.getAnglesFromIndicesAndOffsets=function(t,e,i,r){for(var n=[],o=[],s=[],a=0;a<r.length;a++){var l=r[a],c=e[a],u=oo.sub(l,t),h=-oo.angle(u),d=-rl(i[c],i[c+1])-h;if(a>0){var p=n[a-1],f=o[a-1];Math.abs(h-p)>Math.PI&&(h+=h>p?-2*Math.PI:2*Math.PI),Math.abs(f-d)>Math.PI&&(d+=d>f?-2*Math.PI:2*Math.PI)}n.push(h),o.push(d),s.push(u)}return[s,n,o]},e}(Ya);function il(t,e){return e/t}function rl(t,e){var i=oo.sub(e,t);return oo.angle(i)}function nl(t){for(var e=[],i=0;i<t.length-1;i++){var r=t[i],n=t[i+1],o=Math.hypot(r[0]-n[0],r[1]-n[1]);e.push(o)}return e}function ol(t,e){var i,r;for(t>e?(i=e,r=t):(i=t,r=e);r-i>Math.PI;)i+=2*Math.PI;return Math.abs(r-i)}var sl=Object.create(Ka);Object.assign(sl,{name:"text",super:Ka,built_in:!0,init:function(t){void 0===t&&(t={}),vo.init.call(this,t),this.setupDefines(),this.defines.TANGRAM_HAS_SHADER_POINTS=!1,this.defines.TANGRAM_CURVED_LABEL=!0,this.reset()},makeVertexTemplate:function(t,e){this.super.makeVertexTemplate.call(this,t,e,!1);for(var i=e.vertex_data.vertex_layout.index.a_pre_angles,r=0;r<12;r++)this.vertex_template[i++]=0;return this.addCustomAttributesToVertexTemplate(t,i),this.vertex_template},reset:function(){this.queues={},this.resetText()},addFeature:function(t,e,i){var r=this,n=i.tile;if(n.generation===this.generation){var o=t.geometry.type;e.can_articulate="LineString"===o||"MultiLineString"===o,e.supersample_text="LineString"===o||"MultiLineString"===o;var s=this.parseTextFeature(t,e,i,n);s&&(s instanceof Array?s.forEach((function(e){e.feature=t,e.context=i,e.layout.vertex=!1,r.queueFeature(e,n)})):(s.feature=t,s.context=i,s.layout.vertex=!1,this.queueFeature(s,n)),aa.addStyle(this.name,n.id))}},endData:function(t){return new Promise(function(e,i){var r,n,o,s,a,l,c,u;return r=this,n=this.queues[t.id],delete this.queues[t.id],Promise.resolve(this.collideAndRenderTextLabels(t,this.name,n)).then(function(n){try{return s=(o=n).labels,a=o.texts,l=o.textures,s&&a&&(this.texts[t.id]=a,s.forEach((function(e){var i=e.text_settings_key,n=r.texts[t.id][i]&&r.texts[t.id][i][e.text],o=r.feature_style;o.label=e.label,n.text_settings.can_articulate?(o.size={},o.texcoords={},"straight"===e.label.type?(o.size.straight=n.size.logical_size,o.texcoords.straight=n.texcoords.straight,o.label_texture=l[n.texcoords.straight.texture_id]):(o.size.curved=n.segment_sizes.map((function(t){return t.logical_size})),o.texcoords_stroke=n.texcoords_stroke,o.texcoords.curved=n.texcoords.curved,o.label_textures=n.texcoords.curved.map((function(t){return l[t.texture_id]})))):(o.size=n.size.logical_size,o.texcoords=n.align[e.label.align].texcoords,o.label_texture=l[n.align[e.label.align].texture_id]),o.blend_order=e.draw.blend_order,vo.addFeature.call(r,e.feature,e.draw,e.context)}))),this.freeText(t),Promise.resolve(vo.endData.call(this,t)).then((function(t){try{if(c=t)for(var r in l&&l.length&&(u=c.textures).push.apply(u,l),c.meshes)c.meshes[r].uniforms.u_apply_color_blocks=!0;return e(c)}catch(t){return i(t)}}),i)}catch(t){return i(t)}}.bind(this),i)}.bind(this))},_preprocess:function(t){return t.blend_order=this.getBlendOrderForDraw(t),this.preprocessText(t)},buildTextLabels:function(t,e){for(var i=[],r=0;r<e.length;r++){var n=e[r],o=this.texts[t.id][n.text_settings_key][n.text],s=void 0;if(n.layout.vertical_buffer=o.vertical_buffer,o.text_settings.can_articulate){var a=o.segment_sizes.map((function(t){return t.collision_size}));n.layout.no_curving=o.no_curving,s=this.buildLabels(a,n.feature.geometry,n.layout,o.size.collision_size)}else s=this.buildLabels(o.size.collision_size,n.feature.geometry,n.layout);for(var l=0;l<s.length;l++){var c=Object.create(n);c.label=s[l],i.push(c)}}return i},buildLabels:function(t,e,i,r){var n=[];if("LineString"===e.type)Array.prototype.push.apply(n,this.buildLineLabels(e.coordinates,t,i,r));else if("MultiLineString"===e.type)for(var o=e.coordinates,s=0;s<o.length;++s)Array.prototype.push.apply(n,this.buildLineLabels(o[s],t,i,r));else if("Point"===e.type)n.push(new la(e.coordinates,t,i));else if("MultiPoint"===e.type)for(var a=e.coordinates,l=0;l<a.length;++l)n.push(new la(a[l],t,i));else if("Polygon"===e.type){var c=an.centroid(e.coordinates);c&&n.push(new la(c,t,i))}else if("MultiPolygon"===e.type){var u=an.multiCentroid(e.coordinates);u&&n.push(new la(u,t,i))}return n},buildLineLabels:function(t,e,i,r){var n=[],o=Math.min(i.subdiv,t.length-1);if(o>1)for(var s=(t.length-1)/o,a=0;a<o;a++){var l=Math.floor(a*s),c=Math.floor((a+1)*s)+1,u=t.slice(l,c),h=Ja(e,r,u,i);h&&n.push(h)}if(n.length<o){var d=Ja(e,r,t,i);d&&n.push(d)}return n},vertexLayoutForMeshVariant:function(t){if(null==this.vertex_layouts[t.shader_point]){var e=[{name:"a_position",size:4,type:Xn.SHORT,normalized:!1},{name:"a_shape",size:4,type:Xn.SHORT,normalized:!1},{name:"a_texcoord",size:2,type:Xn.UNSIGNED_SHORT,normalized:!0},{name:"a_offset",size:2,type:Xn.SHORT,normalized:!1},{name:"a_color",size:4,type:Xn.UNSIGNED_BYTE,normalized:!0},{name:"a_selection_color",size:4,type:Xn.UNSIGNED_BYTE,normalized:!0,static:t.selection?null:[0,0,0,0]},{name:"a_pre_angles",size:4,type:Xn.BYTE,normalized:!1},{name:"a_angles",size:4,type:Xn.SHORT,normalized:!1},{name:"a_offsets",size:4,type:Xn.UNSIGNED_SHORT,normalized:!1}];this.addCustomAttributesToAttributeList(e),this.vertex_layouts[t.shader_point]=new So(e)}return this.vertex_layouts[t.shader_point]}}),sl.texture_id=0;var al=Object.create(hs);Object.assign(al,{name:"raster",super:hs,built_in:!0,init:function(){this.raster=this.raster||"color",this.super.init.apply(this,arguments),this.selection=!1},_preprocess:function(t){return t.color=t.color||Rn.defaults.color,this.super._preprocess.apply(this,arguments)}});var ll=function(){function t(){this.styles={},this.base_styles={},this.active_styles=[],this.active_blend_orders=[],this.register(Object.create(hs)),this.register(Object.create(zs)),this.register(Object.create(Ka)),this.register(Object.create(sl)),this.register(Object.create(al))}var e=t.prototype;return e.init=function(){Jr.removeBlock("global"),Jr.removeBlock("setup"),Jr.addBlock("global","#ifdef TANGRAM_VERTEX_SHADER\n\n// Apply layer ordering to avoid z-fighting\nvoid applyLayerOrder (float layer, inout vec4 position) {\n    position.z -= layer * TANGRAM_LAYER_DELTA * position.w;\n}\n\n// Vertex position in model space: [0, 1] range over the local tile\n// Note positions can be outside that range due to unclipped geometry, geometry higher than a unit cube, etc.\nvec4 modelPosition() {\n    return\n        vec4(\n            a_position.xyz / TANGRAM_TILE_SCALE         // scale coords to ~0-1 range\n            * exp2(u_tile_origin.z - u_tile_origin.w),  // adjust for tile overzooming\n        1.)\n        + vec4(0., 1., 0., 0.);\n        // NB: additional offset to account for unusual Tangram JS y coords,\n        // should be refactored to remove\n}\n\n// Position in model space as above, but according to tile coordinate (as opposed to style) zoom\n// e.g. unadjusted for tile overzooming\nvec4 modelPositionBaseZoom() {\n    return\n        vec4(\n            a_position.xyz / TANGRAM_TILE_SCALE,    // scale coords to ~0-1 range\n        1.)\n        + vec4(0., 1., 0., 0.); // see note on offset above\n}\n\n#endif\n\n// Vertex position in world coordinates, useful for 3d procedural textures, etc.\nvec4 worldPosition() {\n    return v_world_position;\n}\n\n// Optionally wrap world coordinates (allows more precision at higher zooms)\n// e.g. at wrap 1000, the world space will wrap every 1000 meters\n#ifdef TANGRAM_VERTEX_SHADER\n\nvec4 wrapWorldPosition(vec4 world_position) {\n    #if defined(TANGRAM_WORLD_POSITION_WRAP)\n    vec2 anchor = u_tile_origin.xy - mod(u_tile_origin.xy, TANGRAM_WORLD_POSITION_WRAP);\n        world_position.xy -= anchor;\n    #endif\n    return world_position;\n}\n\n#endif\n\n// Normal in world space\n#if defined(TANGRAM_VERTEX_SHADER)\n\nvec3 worldNormal() {\n    return TANGRAM_NORMAL;\n}\n\n#elif defined(TANGRAM_FRAGMENT_SHADER)\n\nvec3 worldNormal() {\n    return u_inverseNormalMatrix * TANGRAM_NORMAL;\n}\n\n#endif\n"),Jr.addBlock("global","// Vertex attribute + varying for feature selection\n#if defined(TANGRAM_FEATURE_SELECTION) && defined(TANGRAM_VERTEX_SHADER)\n    attribute vec4 a_selection_color;\n    varying vec4 v_selection_color;\n#endif\n"),Jr.replaceBlock("setup","// Selection pass-specific rendering\n#if defined(TANGRAM_FEATURE_SELECTION) && defined(TANGRAM_VERTEX_SHADER)\n    if (a_selection_color.rgb == vec3(0.)) {\n        // Discard by forcing invalid triangle if we're in the feature\n        // selection pass but have no selection info\n        // TODO: in some cases we may actually want non-selectable features to occlude selectable ones?\n        gl_Position = vec4(0., 0., 0., 1.);\n        return;\n    }\n    v_selection_color = a_selection_color;\n#endif\n"),Jr.defines.TANGRAM_EPSILON=1e-5,Jr.defines.TANGRAM_LAYER_DELTA=1/16384,Jr.defines.TANGRAM_TILE_SCALE="vec3("+an.tile_scale+"., "+an.tile_scale+"., u_meters_per_pixel * "+an.tile_size+".)",Jr.defines.TANGRAM_HEIGHT_SCALE=an.height_scale,Jr.defines.TANGRAM_ALPHA_TEST=.5},e.destroy=function(t){var e=this;Object.keys(this.styles).forEach((function(i){var r=e.styles[i];r.gl===t&&(Ki("trace","StyleManager.destroy: destroying render style "+r.name),r.base&&e.remove(r.name),r.destroy())}))},e.register=function(t){this.styles[t.name]=t,this.base_styles[t.name]=t},e.remove=function(t){delete this.styles[t]},e.getActiveStyles=function(){return this.active_styles},e.updateActiveStyles=function(t){return this.active_styles=Object.keys(t.reduce((function(t,e){return Object.keys(e.meshes).forEach((function(e){return t[e]=!0})),t}),{})),this.active_styles},e.getActiveBlendOrders=function(){return this.active_blend_orders},e.updateActiveBlendOrders=function(t){var e=[];t.forEach((function(t){Object.entries(t.meshes).forEach((function(t){var i=t[0];t[1].forEach((function(t){var r=t.variant.blend_order,n=e.findIndex((function(t){return t.blend_order===r}));n=n>-1?n:e.push({blend_order:r,styles:[]})-1,-1===e[n].styles.indexOf(i)&&e[n].styles.push(i)}))}))})),this.active_blend_orders=e.sort((function(t,e){return t.blend_order-e.blend_order}))},e.mix=function(t,e){if(t.mixed)return t;t.mixed={};var i,r=[];t.mix&&(Array.isArray(t.mix)?(i=r).push.apply(i,t.mix):r.push(t.mix),(r=r.map((function(t){return e[t]})).filter((function(e){return e&&e!==t}))).forEach((function(e){return t.mixed[e.name]=!0}))),r.push(t),t.animated=r.some((function(t){return t&&t.animated})),t.texcoords=r.some((function(t){return t&&t.texcoords})),t.base=r.map((function(t){return t.base})).filter((function(t){return t})).pop(),t.lighting=r.map((function(t){return t.lighting})).filter((function(t){return null!=t})).pop(),t.texture=r.map((function(t){return t.texture})).filter((function(t){return t})).pop(),t.raster=r.map((function(t){return t.raster})).filter((function(t){return null!=t})).pop(),t.dash=r.map((function(t){return t.dash})).filter((function(t){return null!=t})).pop(),t.dash_background_color=r.map((function(t){return t.dash_background_color})).filter((function(t){return null!=t})).pop(),r.some((function(t){return Object.prototype.hasOwnProperty.call(t,"blend")&&t.blend}))&&(t.blend=r.map((function(t){return Object.prototype.hasOwnProperty.call(t,"blend")&&t.blend})).filter((function(t){return t})).pop()),t.blend_order=r.map((function(t){return t.blend_order})).filter((function(t){return null!=t})).pop(),t.defines=Object.assign.apply(Object,[{}].concat(r.map((function(t){return t.defines})).filter((function(t){return t})))),t.material=Object.assign.apply(Object,[{}].concat(r.map((function(t){return t.material})).filter((function(t){return t}))));var n=r.map((function(t){return t.draw})).filter((function(t){return t}));return n.length>0&&(t.draw=sn.apply(void 0,[{}].concat(n))),this.mixShaders(t,e,r),t},e.mixShaders=function(t,e,i){var r={},n=i.map((function(t){return t.shaders})).filter((function(t){return t}));if(r.defines=Object.assign.apply(Object,[{}].concat(n.map((function(t){return t.defines})).filter((function(t){return t})))),r.attributes=Object.assign.apply(Object,[{}].concat(n.map((function(t){return t.attributes})).filter((function(t){return t})))),r.uniforms={},r._uniforms=t.shaders&&t.shaders.uniforms||{},r._uniform_scopes={},i.filter((function(t){return t.shaders&&t.shaders.uniforms})).forEach((function(t){var i=function(i){r._uniform_scopes[i]=t.name,Object.defineProperty(r.uniforms,i,{enumerable:!0,configurable:!0,get:function(){return void 0!==r._uniforms[i]?r._uniforms[i]:e[r._uniform_scopes[i]].shaders.uniforms!==r.uniforms?e[r._uniform_scopes[i]].shaders.uniforms[i]:void 0},set:function(t){r._uniforms[i]=t}})};for(var n in t.shaders.uniforms)i(n)})),r.extensions=Object.keys(n.map((function(t){return t.extensions})).filter((function(t){return t})).reduce((function(t,e){return"string"==typeof e?t[e]=!0:e.forEach((function(e){return t[e]=!0})),t}),{})||{}),t.shaders&&t.shaders.blocks)for(var o in t.shaders.block_scopes=t.shaders.block_scopes||{},t.shaders.blocks){var s,a=t.shaders.blocks[o];t.shaders.block_scopes[o]=t.shaders.block_scopes[o]||[],Array.isArray(a)?(s=t.shaders.block_scopes[o]).push.apply(s,a.map((function(){return t.name}))):t.shaders.block_scopes[o].push(t.name)}var l={};return n.forEach((function(t){if(t.blocks){r.blocks=r.blocks||{},r.block_scopes=r.block_scopes||{};var e={};for(var i in t.blocks){var n=t.blocks[i],o=t.block_scopes[i];r.blocks[i]=r.blocks[i]||[],r.block_scopes[i]=r.block_scopes[i]||[],n=Array.isArray(n)?n:[n],o=Array.isArray(o)?o:[o];for(var s=0;s<n.length;s++)l[o[s]]||(e[o[s]]=!0,r.blocks[i].push(n[s]),r.block_scopes[i].push(o[s]))}Object.assign(l,e)}})),Object.assign(t.mixed,l),t.shaders=r,t},e.create=function(t,e,i){void 0===i&&(i={});var r=sn({},e);return r.name=t,(r=this.mix(r,i)).base&&this.base_styles[r.base]?this.styles[t]=r=Object.assign(Object.create(this.base_styles[r.base]),r):r.base=null,r},e.build=function(t){var e=this,i=Object.assign({},t);this.styles&&Object.values(this.styles).forEach((function(t){return Qi.removeTarget(t.main_thread_target)}));for(var r=["polygons","lines","points","text","raster"],n=0,o=["opaque","add","multiply","overlay","inlay","translucent"];n<o.length;n++)for(var s,a=o[n],l=ve(r);!(s=l()).done;){var c=s.value,u=a+"_"+c;null==i[u]&&(i[u]={base:c,blend:a})}var h=Object.keys(i).sort((function(t,r){return e.inheritanceDepth(t,i)-e.inheritanceDepth(r,i)}));for(var d in this.styles)this.base_styles[d]?this.styles[d].reset():delete this.styles[d];var p={};return h.forEach((function(t){p[t]=e.create(t,i[t],p)})),this.styles},e.initStyles=function(t){for(var e in void 0===t&&(t={}),this.styles)this.styles[e].init(t)},e.inheritanceDepth=function(t,e){for(var i=this,r=0;;){var n=e[t];if(!n)break;if(!n.mix)break;if(r++,Array.isArray(n.mix)){r+=Math.max.apply(Math,n.mix.map((function(r){if(t!==r)return i.inheritanceDepth(r,e)})));break}if(t===n.mix)break;t=n.mix}return r},t}();function cl(t){return null!=t}function ul(t){return"("+t+")"}function hl(t){return"string"==typeof t?'"'+t+'"':t}function dl(t){return"$"===t[0]?"context['"+t.substring(1)+"']":t.indexOf(".")>-1?-1===t.indexOf("\\.")?"context.feature.properties"+t.split(".").map((function(t){return"['"+t+"']"})).join(""):"context.feature.properties"+t.replace(/\\\./g,"__TANGRAM_DELIMITER__").split(".").map((function(t){return t.replace(/__TANGRAM_DELIMITER__/g,".")})).map((function(t){return"['"+t+"']"})).join(""):"context.feature.properties['"+t+"']"}function pl(t,e){return ul(hl(e)+" === "+dl(t))}function fl(t,e){return ul("["+e.map(hl).join(",")+"].indexOf("+dl(t)+") > -1")}function Al(t,e){return ul(t.filter(cl).map((function(t){return ul(t.join(" && "))})).join(" "+e+" "))}function ml(t,e,i){return e&&e.length>0?Al(e.map((function(t){return wl(t,i)})),"||"):"true"}function gl(t,e,i){return e&&e.length>0?Al(e.map((function(t){return wl(t,i)})),"&&"):"true"}function _l(t,e,i){return"!"+ul(wl(e,i).join(" && "))}function yl(t,e,i){return"!"+ul(ml(0,e,i))}function vl(t,e){return ul(dl(t)+(e?" != ":" == ")+"null")}function xl(t,e,i){var r=[],n=i&&"function"==typeof i.rangeTransform&&i.rangeTransform;if(e.max){var o=n?n(e.max):e.max;r.push(dl(t)+" < "+o)}if(e.min){var s=n?s=n(e.min):e.min;r.push(dl(t)+" >= "+s)}return ul(r.join(" && "))}function bl(t,e){var i=[];if(e.includes_any){var r="["+(Array.isArray(e.includes_any)?e.includes_any:[e.includes_any]).map(hl).join(",")+"]";i.push(dl(t)+" != null && "+r+".some(function(v) { return "+dl(t)+".indexOf(v) > -1 })")}if(e.includes_all){var n="["+(Array.isArray(e.includes_all)?e.includes_all:[e.includes_all]).map(hl).join(",")+"]";i.push(dl(t)+" != null && "+n+".every(function(v) { return "+dl(t)+".indexOf(v) > -1 })")}return ul(i.join(" && "))}function wl(t,e){var i=[];if("function"==typeof t)return[ul(t.toString()+"(context)")];if(Array.isArray(t))return[ml(0,t,e)];if(null==t)return["true"];for(var r=Object.keys(t),n=0;n<r.length;n++){var o=r[n],s=t[o],a=typeof s;if("string"===a||"number"===a)i.push(pl(o,s));else if("boolean"===a)i.push(vl(o,s));else if("not"===o)i.push(_l(0,s,e));else if("any"===o)i.push(ml(0,s,e));else if("all"===o)i.push(gl(0,s,e));else if("none"===o)i.push(yl(0,s,e));else if(Array.isArray(s))i.push(fl(o,s));else if("object"===a&&null!=s)s.max||s.min?i.push(xl(o,s,e)):(s.includes_any||s.includes_all)&&i.push(bl(o,s));else{if(null!=s)throw new Error("Unknown Query syntax: "+s);i.push(" true ")}}return 0===r.length?["true"]:i}function Tl(t,e){return null==t?function(){return!0}:new Function("context","return "+ul(wl(t,e).join(" && "))+";")}U(U.S,"Number",{MAX_SAFE_INTEGER:9007199254740991});var Bl=["filter","draw","visible","enabled","data","exclusive","priority"],El={};function Cl(t,e){for(var i,r=0,n=0;n<t.length;n++)t[n].length>r&&(r=t[n].length);if(0===r)return null;for(var o={visible:!0},s=function(r){if(i=[],t.forEach((function(t){t[r]&&t[r][e]&&-1===i.indexOf(t[r][e])&&i.push(t[r][e])})),0===i.length)return"continue";sn.apply(void 0,[o].concat(i))},a=0;a<r;a++)s(a);return!1===o.visible?null:o}var Sl=["any","all","not","none"],Il=function(){function t(e){var i=e.layer,r=e.name,n=e.parent,o=e.draw,s=e.visible,a=e.enabled,l=e.filter,c=e.exclusive,u=e.priority,h=e.styles;if(this.id=t.id++,this.config_data=i.data,this.parent=n,this.name=r,this.full_name=this.parent?this.parent.full_name+":"+this.name:this.name,this.draw=o,this.filter=l,this.exclusive=!0===c,this.priority=null!=u?u:Number.MAX_SAFE_INTEGER,this.styles=h,this.is_built=!1,a=void 0===a?s:a,this.enabled=!1!==a,this.draw)for(var d in this.draw)if(this.draw[d]=null==this.draw[d]?{}:this.draw[d],"object"!=typeof this.draw[d]){var p="Draw group '"+d+"' for layer "+this.full_name+" is invalid, must be an object, ";Ki("warn",p+="but was set to `"+d+": "+this.draw[d]+"` instead"),delete this.draw[d]}}var e=t.prototype;return e.build=function(){Ki("trace","Building layer '"+this.full_name+"'"),this.buildFilter(),this.buildDraw(),this.is_built=!0},e.buildDraw=function(){this.draw=zn(this.draw,Rn.wrapFunction),this.calculatedDraw=function(t){var e=[];if(t.parent){var i=t.parent.calculatedDraw||[];e.push.apply(e,i)}return e.push(t.draw),e}(this)},e.buildFilter=function(){this.filter_original=this.filter,this.filter=zn(this.filter,Rn.wrapFunction);var t=typeof this.filter;if(null==this.filter||"object"===t||"function"===t)try{this.buildZooms(),this.buildPropMatches(),null!=this.filter&&("function"==typeof this.filter||Object.keys(this.filter).length>0)?this.filter=Tl(this.filter,Pl):this.filter=null}catch(t){var e="Filter for layer "+this.full_name+" is invalid, `filter: "+JSON.stringify(this.filter)+"` ";Ki("warn",e+="failed with error '"+t.message+"', stack trace: "+t.stack)}else{var i="Filter for layer "+this.full_name+" is invalid, filter value must be an object or function, ";Ki("warn",i+="but was set to `filter: "+this.filter+"` instead")}},e.buildZooms=function(){var t=this.filter&&this.filter.$zoom,e=typeof t;if(null!=t){if(this.zooms={},"number"===e)this.zooms[t]=!0;else if(Array.isArray(t))for(var i=0;i<t.length;i++)this.zooms[t[i]]=!0;else if("object"===e&&(null!=t.min||null!=t.max))for(var r=t.min||0,n=t.max||an.max_style_zoom,o=r;o<n;o++)this.zooms[o]=!0;delete this.filter.$zoom}},e.buildPropMatches=function(){var t=this;this.filter&&!Array.isArray(this.filter)&&"function"!=typeof this.filter&&Object.keys(this.filter).forEach((function(e){if(-1===Sl.indexOf(e)){var i=t.filter[e],r=typeof i,n=Array.isArray(i);if(!n&&"string"!==r&&"number"!==r)return;"$"===e[0]?(t.context_prop_matches=t.context_prop_matches||[],t.context_prop_matches.push([e.substring(1),n?i:[i]]),delete t.filter[e]):-1===e.indexOf(".")&&(t.feature_prop_matches=t.feature_prop_matches||[],t.feature_prop_matches.push([e,n?i:[i]]),delete t.filter[e])}}))},e.doPropMatches=function(t){if(this.feature_prop_matches)for(var e=0;e<this.feature_prop_matches.length;e++){var i=this.feature_prop_matches[e],r=t.feature.properties[i[0]];if(null==r||-1===i[1].indexOf(r))return!1}if(this.context_prop_matches)for(var n=0;n<this.context_prop_matches.length;n++){var o=this.context_prop_matches[n],s=t[o[0]];if(null==s||-1===o[1].indexOf(s))return!1}return!0},e.doesMatch=function(t){if(!this.enabled)return!1;if(this.is_built||this.build(),null!=this.zooms&&!this.zooms[t.zoom])return!1;if(!this.doPropMatches(t))return!1;var e;if(this.filter instanceof Function)try{e=this.filter(t)}catch(e){var i="Filter for this "+this.full_name+": `filter: "+this.filter_original+"` ";Ki("error",i+="failed with error '"+e.message+"', stack trace: "+e.stack,t.feature)}else e=null==this.filter;return!!e&&(this.children_to_parse&&(function(t,e,i){for(var r in e){var n=e[r];if("object"!=typeof n||Array.isArray(n)){var o="Layer value must be an object: cannot create layer '"+r+": "+JSON.stringify(n)+"'";o+=", under parent layer '"+t.full_name+"'.",i[t.name]&&(o+=" The parent name '"+t.name+"' is also the name of a style, did you mean to create a 'draw' group",t.parent&&(o+=" under '"+t.parent.name+"'"),o+=" instead?"),Ki("warn",o)}else zl(r,n,t,i)}t.layers.sort((function(t,e){if(t.exclusive<e.exclusive)return 1;if(t.exclusive>e.exclusive)return-1;var i=t.exclusive?1:-1;return t.priority>e.priority?i:t.priority<e.priority?-i:t.full_name<e.full_name?i:t.full_name>e.full_name?-i:void 0}))}(this,this.children_to_parse,this.styles),delete this.children_to_parse),!0)},t}();Il.id=0;var Ml=function(t){function e(e){var i;return(i=t.call(this,e)||this).is_leaf=!0,i}return fe(e,t),e}(Il),kl=function(t){function e(e){var i;return(i=t.call(this,e)||this).is_tree=!0,i.layers=e.layers||[],i}fe(e,t);var i=e.prototype;return i.addLayer=function(t){this.layers.push(t)},i.buildDrawGroups=function(t){var e=[],i=[];if(function t(e,i,r,n){var o=!1;if(0!==i.length){for(var s=0;s<i.length;s++){var a=i[s];if(a.is_leaf){if(a.doesMatch(e)&&(o=!0,r.push(a),n.push(a.id),a.exclusive))break}else if(a.is_tree&&a.doesMatch(e)&&(o=!0,t(e,a.layers,r,n)||(r.push(a),n.push(a.id)),a.exclusive))break}return o}}(t,[this],e,i),e.length>0){var r=function(t){if(t.length>1){for(var e=t[0],i=1;i<t.length;i++)e+="/"+t[i];return e}return t[0]}(i);if(void 0===El[r]){for(var n=e.map((function(t){return t&&!1!==t.visible&&t.calculatedDraw})),o={},s=0;s<n.length;s++){var a=n[s];if(a)for(var l=0;l<a.length;l++){var c=a[l];for(var u in c)o[u]=!0}}for(var h in o)El[r]=El[r]||{},El[r][h]=Cl(n,h),El[r][h]?(El[r][h].key=r+"/"+h,El[r][h].layers=e.map((function(t){return t&&t.full_name})),El[r][h].group=h):delete El[r][h];El[r]&&0===Object.keys(El[r]).length&&(El[r]=null)}return El[r]}},e}(Il),Pl={rangeTransform:function(t){return"string"==typeof t&&"px2"===t.trim().slice(-3)?parseFloat(t)+" * context.meters_per_pixel_sq":t}};function Ll(t){return Bl.indexOf(t)>-1}function zl(t,e,i,r){var n,o={name:t,layer:e=null==e?{}:e,parent:i,styles:r},s=function(t){var e={},i={};for(var r in t)Ll(r)?e[r]=t[r]:i[r]=t[r];return[e,i]}(e),a=s[0],l=s[1],c=(n=l,0===Object.keys(n).length),u=new(c&&null!=i?Ml:kl)(Object.assign(o,a));return u.enabled&&(i&&i.addLayer(u),u.children_to_parse=c?null:l),u}var Fl=0,Dl=0,Rl=function(){function t(t){var e=t.coords,i=t.style_z,r=t.source,n=t.workers,o=t.view;this.id=Fl++,this.view=o,this.source=r,this.generation=null,this.valid=!0,this.visible=!1,this.proxy_for=null,this.proxied_as=null,this.proxy_level=0,this.proxy_order_offset=0,this.fade_in=!0,this.loading=!1,this.loaded=!1,this.built=!1,this.labeled=!1,this.error=null,this.debug={},this.style_z=i,this.coords=go.normalizedCoord(e,this.source),this.key=go.key(this.coords,this.source,this.style_z),this.overzoom=Math.max(this.style_z-this.coords.z,0),this.overzoom2=Math.pow(2,this.overzoom),this.min=an.metersForTile(this.coords),this.max=an.metersForTile({x:this.coords.x+1,y:this.coords.y+1,z:this.coords.z}),this.span={x:this.max.x-this.min.x,y:-(this.max.y-this.min.y)},this.bounds={sw:{x:this.min.x,y:this.max.y},ne:{x:this.max.x,y:this.min.y}},this.meters_per_pixel=an.metersPerPixel(this.style_z),this.meters_per_pixel_sq=this.meters_per_pixel*this.meters_per_pixel,this.units_per_pixel=an.units_per_pixel/this.overzoom2,this.units_per_meter_overzoom=an.unitsPerMeter(this.coords.z)*this.overzoom2,this.preserve_tiles_within_zoom=this.source.preserve_tiles_within_zoom,this.meshes={},this.new_mesh_styles=[],this.pending_label_meshes=null,this.setWorker(n)}var e=t.prototype;return e.freeResources=function(){for(var t in this.meshes)this.meshes[t].forEach((function(t){return t.destroy()}));if(this.meshes={},this.pending_label_meshes)for(var e in this.pending_label_meshes)this.pending_label_meshes[e].forEach((function(t){return t.destroy()}));this.pending_label_meshes=null},e.destroy=function(){Tr.removeForTile(this.id),this.workerMessage("self.removeTile",this.key),this.freeResources(),this.worker=null,this.valid=!1},e.buildAsMessage=function(){return{id:this.id,key:this.key,source:this.source.name,coords:this.coords,min:this.min,max:this.max,units_per_pixel:this.units_per_pixel,meters_per_pixel:this.meters_per_pixel,meters_per_pixel_sq:this.meters_per_pixel_sq,units_per_meter_overzoom:this.units_per_meter_overzoom,style_z:this.style_z,overzoom:this.overzoom,overzoom2:this.overzoom2,generation:this.generation,debug:this.debug}},e.setWorker=function(t){this.source.tiled?this.worker_id=Math.abs(this.coords.x+this.coords.y+this.coords.z)%t.length:this.worker_id=this.source.id%t.length,this.worker=t[this.worker_id]},e.workerMessage=function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return Qi.postMessage.apply(Qi,[this.worker].concat(e))},e.build=function(t,e){var i=(void 0===e?{}:e).fade_in,r=void 0===i||i;return this.generation=t,this.fade_in=r,this.loaded||(this.loading=!0,this.built=!1,this.labeled=!1),this.workerMessage("self.buildTile",{tile:this.buildAsMessage()}).catch((function(t){throw t}))},t.cancel=function(e){e&&(e.canceled=!0,e.source_data&&e.source_data.request_id&&(Yi.cancelRequest(e.source_data.request_id),e.source_data.request_id=null),t.abortBuild(e))},t.buildGeometry=function(e,i){var r=i.scene_id,n=i.layers,o=i.styles,s=i.global,a=e.source_data;for(var l in e.debug.building=+new Date,e.debug.feature_count=0,e.debug.layers=null,aa.startTile(e.id,{apply_repeat_groups:!0}),n){var c=n[l];if(c&&c.config_data){if(c.config_data.source===e.source)for(var u=t.getDataForSource(a,c.config_data,l),h=0;h<u.length;h++){var d=u[h],p=d.geom;if(p)for(var f=0;f<p.features.length;f++){var A=p.features[f];if(null!=A.geometry){var m=Rn.getFeatureParseContext(A,e,s);m.winding=e.default_winding,m.source=e.source,m.layer=d.layer;var g=c.buildDrawGroups(m,!0);if(g){for(var _ in g){var y=g[_],v=y.style||_,x=o[v];x?null!=(y=x.preprocess(y))&&!1!==y.visible&&(m.layers=y.layers,x.addFeature(A,y,m)):Ki("warn","Style '"+v+"' not found, skipping layer '"+l+"':",y,A)}e.debug.feature_count++}}}}}else Ki("warn","Layer "+l+" was defined without a geometry data source and will not be rendered.")}e.debug.building=+new Date-e.debug.building;var b=this.stylesForTile(e,o).map((function(t){return o[t]}));t.buildStyleGroups(e,b,r,(function(t){return t.collision?"collision":"non-collision"}))},t.stylesForTile=function(t,e){var i=[];for(var r in e)e[r].hasDataForTile(t)&&i.push(r);return i},t.buildStyleGroups=function(e,i,r,n){var o=i.reduce((function(t,e){var i=n(e);return t[i]=t[i]||[],t[i].push(e),t}),{});if(0===Object.keys(o).length)return Qi.postMessage("TileManager_"+r+".buildTileStylesCompleted",Qi.withTransferables({tile:t.slice(e),progress:{start:!0,done:!0}})),void aa.resetTile(e.id);var s={};for(var a in o)t.buildStyleGroup({group_name:a,groups:o,tile:e,progress:s,scene_id:r})},t.buildStyleGroup=function(e){return new Promise((function(i,r){var n,o,s,a,l,c,u;n=e.group_name,o=e.groups,s=e.tile,a=e.progress,l=e.scene_id,c=o[n],u={};var h=function(){try{return i()}catch(t){return r(t)}},d=function(t){try{return Ki("error","Error for style group '"+n+"' for tile "+s.key,t&&t.stack||t),h()}catch(t){return r(t)}};try{return Promise.resolve(Promise.all(c.map((function(t){return new Promise((function(e,i){var r;return Promise.resolve(t.endData(s)).then((function(n){try{return(r=n)&&(u[t.name]=r),e()}catch(t){return i(t)}}),i)}))})))).then((function(e){try{return Ki("trace","Finished style group '"+n+"' for tile "+s.key),o[n]=null,Object.keys(o).every((function(t){return null==o[t]}))&&(a.done=!0),Qi.postMessage("TileManager_"+l+".buildTileStylesCompleted",Qi.withTransferables({tile:Object.assign({},t.slice(s),{mesh_data:u}),progress:a})),a.done&&aa.resetTile(s.id),h()}catch(t){return d(t)}}),d)}catch(t){d(t)}}))},t.getDataForSource=function(t,e,i){var r=[];if(null!=e&&null!=t&&null!=t.layers)if(!0===e.all_layers)for(var n in null!=e.layer&&Ki({level:"warn",once:!0},"Layer "+i+" includes both 'all_layers: true' and an explicit 'layer' keyword in its 'data' block. 'all_layers: true' takes precedence, 'layer' will be ignored."),t.layers)r.push({layer:n,geom:t.layers[n]});else!e.layer&&t.layers._default?r.push({geom:t.layers._default}):!e.layer&&i?r.push({layer:i,geom:t.layers[i]}):"string"==typeof e.layer?r.push({layer:e.layer,geom:t.layers[e.layer]}):Array.isArray(e.layer)&&e.layer.forEach((function(e){r.push({layer:e,geom:t.layers[e]})}));return r},e.buildMeshes=function(t,e){if(!this.error){this.build_id=Dl++,e.start&&(this.debug.geometry_count=0,this.debug.buffer_size=0);var i={},r=this.mesh_data;if(r)for(var n in r){for(var o in r[n].meshes){var s=r[n].meshes[o];if(s.vertex_data){if(!t[n]){Ki("warn","Could not create mesh because style '"+n+"' not found, for tile "+this.key+", aborting tile");break}var a=Object.assign({},r[n]);a.uniforms=Object.assign({},a.uniforms,s.uniforms),a.variant=s.variant,s.labels&&(a.retain=!0);var l=t[n].makeMesh(s.vertex_data,s.vertex_elements,a);l.variant=a.variant,l.labels=s.labels,i[n]=i[n]||[],i[n].push(l),null==l.variant.mesh_order&&(l.variant.mesh_order=i[n].length-1),this.debug.buffer_size+=l.buffer_size,this.debug.geometry_count+=l.geometry_count}}i[n]&&i[n].sort((function(t,e){var i=t.variant.mesh_order,r=e.variant.mesh_order;return null==i?1:null==r||i<r?-1:1}))}for(var c in delete this.mesh_data,i)t[c].collision?(this.pending_label_meshes=this.pending_label_meshes||{},this.pending_label_meshes[c]=i[c]):(this.meshes[c]&&this.meshes[c].forEach((function(t){return t.destroy()})),this.meshes[c]=i[c],this.new_mesh_styles.push(c));if(e.done){for(var u in this.meshes)-1!==this.new_mesh_styles.indexOf(u)||this.pending_label_meshes&&null!=this.pending_label_meshes[u]||(this.meshes[u].forEach((function(t){return t.destroy()})),delete this.meshes[u]);this.new_mesh_styles=[],this.debug.geometry_ratio=(this.debug.geometry_count/this.debug.feature_count).toFixed(1)}this.printDebug(e)}},e.pendingLabelStyleCount=function(){return this.pending_label_meshes?Object.keys(this.pending_label_meshes).length:0},e.swapPendingLabels=function(){if(this.labeled=!0,this.pending_label_meshes){for(var t in this.pending_label_meshes)this.meshes[t]&&this.meshes[t].forEach((function(t){return t.destroy()})),this.meshes[t]=this.pending_label_meshes[t];this.pending_label_meshes=null}},t.abortBuild=function(t){if(Tr.removeForTile(t.id),aa.abortTile(t.id),t.mesh_data)for(var e in t.mesh_data){var i=t.mesh_data[e].textures;i&&i.forEach((function(e){var i=Hr.textures[e];i&&(Ki("trace","releasing texture "+e+" for tile "+t.key),i.release())}))}},e.setProxyFor=function(t){t?(this.visible=!0,this.proxy_for=this.proxy_for||[],this.proxy_for.push(t),this.proxy_order_offset=1,t.proxied_as=t.style_z>this.style_z?"child":"parent",this.proxy_level=Math.abs(t.style_z-this.style_z)):(this.proxy_for=null,this.proxy_order_offset=0,this.proxy_level=0)},e.isProxy=function(){return null!=this.proxy_for},e.shouldProxyForStyle=function(t){return!this.proxy_for||this.proxy_for.some((function(e){return null==e.meshes[t]}))},e.setupProgram=function(t,e){var i=t.model,r=t.model32;e.uniform("4fv","u_tile_origin",[this.min.x,this.min.y,this.style_z,this.coords.z]),e.uniform("1f","u_tile_proxy_order_offset",this.proxy_order_offset),Va.identity(i),Va.translate(i,i,Na(this.min.x,this.min.y,0)),Va.scale(i,i,Na(this.span.x/an.tile_scale,this.span.y/an.tile_scale,1)),Va.copy(r,i),e.uniform("Matrix4fv","u_model",r),e.uniform("1i","u_tile_fade_in",this.fade_in&&"child"!==this.proxied_as)},t.slice=function(t,e){var i=["id","key","loading","loaded","generation","error","debug"];Array.isArray(e)&&i.push.apply(i,e);for(var r={},n=0;n<i.length;n++){var o=i[n];r[o]=t[o]}return r},e.merge=function(t){return this.loading=t.loading,this.loaded=t.loaded,this.generation=t.generation,this.error=t.error,this.mesh_data=t.mesh_data,this.debug=sn(this.debug,t.debug),this},e.printDebug=function(t){var e=["layers"],i={};for(var r in this.debug)-1===e.indexOf(r)&&(i[r]=this.debug[r]);Ki("debug","Tile "+(t.done?"(done)":"")+": debug for "+this.key+": [  "+JSON.stringify(i)+" ]")},t}();Rl.coord_children={};var Ul=function(t,e,i,r,n){var o,s,a=8*n-r-1,l=(1<<a)-1,c=l>>1,u=-7,h=i?n-1:0,d=i?-1:1,p=t[e+h];for(h+=d,o=p&(1<<-u)-1,p>>=-u,u+=a;u>0;o=256*o+t[e+h],h+=d,u-=8);for(s=o&(1<<-u)-1,o>>=-u,u+=r;u>0;s=256*s+t[e+h],h+=d,u-=8);if(0===o)o=1-c;else{if(o===l)return s?NaN:1/0*(p?-1:1);s+=Math.pow(2,r),o-=c}return(p?-1:1)*s*Math.pow(2,o-r)},Ol=function(t,e,i,r,n,o){var s,a,l,c=8*o-n-1,u=(1<<c)-1,h=u>>1,d=23===n?Math.pow(2,-24)-Math.pow(2,-77):0,p=r?0:o-1,f=r?1:-1,A=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,s=u):(s=Math.floor(Math.log(e)/Math.LN2),e*(l=Math.pow(2,-s))<1&&(s--,l*=2),(e+=s+h>=1?d/l:d*Math.pow(2,1-h))*l>=2&&(s++,l/=2),s+h>=u?(a=0,s=u):s+h>=1?(a=(e*l-1)*Math.pow(2,n),s+=h):(a=e*Math.pow(2,h-1)*Math.pow(2,n),s=0));n>=8;t[i+p]=255&a,p+=f,a/=256,n-=8);for(s=s<<n|a,c+=n;c>0;t[i+p]=255&s,p+=f,s/=256,c-=8);t[i+p-f]|=128*A},Nl=Ql;function Ql(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}function Vl(t){return t.type===Ql.Bytes?t.readVarint()+t.pos:t.pos+1}function jl(t,e,i){return i?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function Hl(t,e,i){var r=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.ceil(Math.log(e)/(7*Math.LN2));i.realloc(r);for(var n=i.pos-1;n>=t;n--)i.buf[n+r]=i.buf[n]}function Gl(t,e){for(var i=0;i<t.length;i++)e.writeVarint(t[i])}function $l(t,e){for(var i=0;i<t.length;i++)e.writeSVarint(t[i])}function Zl(t,e){for(var i=0;i<t.length;i++)e.writeFloat(t[i])}function ql(t,e){for(var i=0;i<t.length;i++)e.writeDouble(t[i])}function Kl(t,e){for(var i=0;i<t.length;i++)e.writeBoolean(t[i])}function Wl(t,e){for(var i=0;i<t.length;i++)e.writeFixed32(t[i])}function Xl(t,e){for(var i=0;i<t.length;i++)e.writeSFixed32(t[i])}function Jl(t,e){for(var i=0;i<t.length;i++)e.writeFixed64(t[i])}function Yl(t,e){for(var i=0;i<t.length;i++)e.writeSFixed64(t[i])}function tc(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function ec(t,e,i){t[i]=e,t[i+1]=e>>>8,t[i+2]=e>>>16,t[i+3]=e>>>24}function ic(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}Ql.Varint=0,Ql.Fixed64=1,Ql.Bytes=2,Ql.Fixed32=5,Ql.prototype={destroy:function(){this.buf=null},readFields:function(t,e,i){for(i=i||this.length;this.pos<i;){var r=this.readVarint(),n=r>>3,o=this.pos;this.type=7&r,t(n,e,this),this.pos===o&&this.skip(r)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=tc(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=ic(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=tc(this.buf,this.pos)+4294967296*tc(this.buf,this.pos+4);return this.pos+=8,t},readSFixed64:function(){var t=tc(this.buf,this.pos)+4294967296*ic(this.buf,this.pos+4);return this.pos+=8,t},readFloat:function(){var t=Ul(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=Ul(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,i,r=this.buf;return e=127&(i=r[this.pos++]),i<128?e:(e|=(127&(i=r[this.pos++]))<<7,i<128?e:(e|=(127&(i=r[this.pos++]))<<14,i<128?e:(e|=(127&(i=r[this.pos++]))<<21,i<128?e:function(t,e,i){var r,n,o=i.buf;if(r=(112&(n=o[i.pos++]))>>4,n<128)return jl(t,r,e);if(r|=(127&(n=o[i.pos++]))<<3,n<128)return jl(t,r,e);if(r|=(127&(n=o[i.pos++]))<<10,n<128)return jl(t,r,e);if(r|=(127&(n=o[i.pos++]))<<17,n<128)return jl(t,r,e);if(r|=(127&(n=o[i.pos++]))<<24,n<128)return jl(t,r,e);if(r|=(1&(n=o[i.pos++]))<<31,n<128)return jl(t,r,e);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(i=r[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=function(t,e,i){for(var r="",n=e;n<i;){var o,s,a,l=t[n],c=null,u=l>239?4:l>223?3:l>191?2:1;if(n+u>i)break;1===u?l<128&&(c=l):2===u?128==(192&(o=t[n+1]))&&(c=(31&l)<<6|63&o)<=127&&(c=null):3===u?(o=t[n+1],s=t[n+2],128==(192&o)&&128==(192&s)&&((c=(15&l)<<12|(63&o)<<6|63&s)<=2047||c>=55296&&c<=57343)&&(c=null)):4===u&&(o=t[n+1],s=t[n+2],a=t[n+3],128==(192&o)&&128==(192&s)&&128==(192&a)&&((c=(15&l)<<18|(63&o)<<12|(63&s)<<6|63&a)<=65535||c>=1114112)&&(c=null)),null===c?(c=65533,u=1):c>65535&&(c-=65536,r+=String.fromCharCode(c>>>10&1023|55296),c=56320|1023&c),r+=String.fromCharCode(c),n+=u}return r}(this.buf,this.pos,t);return this.pos=t,e},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){var i=Vl(this);for(t=t||[];this.pos<i;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){var e=Vl(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){var e=Vl(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){var e=Vl(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){var e=Vl(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){var e=Vl(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){var e=Vl(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){var e=Vl(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){var e=Vl(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===Ql.Varint)for(;this.buf[this.pos++]>127;);else if(e===Ql.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Ql.Fixed32)this.pos+=4;else{if(e!==Ql.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var i=new Uint8Array(e);i.set(this.buf),this.buf=i,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),ec(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),ec(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),ec(this.buf,-1&t,this.pos),ec(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),ec(this.buf,-1&t,this.pos),ec(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(t,e){var i,r;if(t>=0?(i=t%4294967296|0,r=t/4294967296|0):(r=~(-t/4294967296),4294967295^(i=~(-t%4294967296))?i=i+1|0:(i=0,r=r+1|0)),t>=0x10000000000000000||t<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),function(t,e,i){i.buf[i.pos++]=127&t|128,t>>>=7,i.buf[i.pos++]=127&t|128,t>>>=7,i.buf[i.pos++]=127&t|128,t>>>=7,i.buf[i.pos++]=127&t|128,t>>>=7,i.buf[i.pos]=127&t}(i,0,e),function(t,e){var i=(7&t)<<4;e.buf[e.pos++]|=i|((t>>>=3)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t)))))}(r,e)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(t,e,i){for(var r,n,o=0;o<e.length;o++){if((r=e.charCodeAt(o))>55295&&r<57344){if(!n){r>56319||o+1===e.length?(t[i++]=239,t[i++]=191,t[i++]=189):n=r;continue}if(r<56320){t[i++]=239,t[i++]=191,t[i++]=189,n=r;continue}r=n-55296<<10|r-56320|65536,n=null}else n&&(t[i++]=239,t[i++]=191,t[i++]=189,n=null);r<128?t[i++]=r:(r<2048?t[i++]=r>>6|192:(r<65536?t[i++]=r>>12|224:(t[i++]=r>>18|240,t[i++]=r>>12&63|128),t[i++]=r>>6&63|128),t[i++]=63&r|128)}return i}(this.buf,t,this.pos);var i=this.pos-e;i>=128&&Hl(e,i,this),this.pos=e-1,this.writeVarint(i),this.pos+=i},writeFloat:function(t){this.realloc(4),Ol(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),Ol(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var i=0;i<e;i++)this.buf[this.pos++]=t[i]},writeRawMessage:function(t,e){this.pos++;var i=this.pos;t(e,this);var r=this.pos-i;r>=128&&Hl(i,r,this),this.pos=i-1,this.writeVarint(r),this.pos+=r},writeMessage:function(t,e,i){this.writeTag(t,Ql.Bytes),this.writeRawMessage(e,i)},writePackedVarint:function(t,e){this.writeMessage(t,Gl,e)},writePackedSVarint:function(t,e){this.writeMessage(t,$l,e)},writePackedBoolean:function(t,e){this.writeMessage(t,Kl,e)},writePackedFloat:function(t,e){this.writeMessage(t,Zl,e)},writePackedDouble:function(t,e){this.writeMessage(t,ql,e)},writePackedFixed32:function(t,e){this.writeMessage(t,Wl,e)},writePackedSFixed32:function(t,e){this.writeMessage(t,Xl,e)},writePackedFixed64:function(t,e){this.writeMessage(t,Jl,e)},writePackedSFixed64:function(t,e){this.writeMessage(t,Yl,e)},writeBytesField:function(t,e){this.writeTag(t,Ql.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,Ql.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,Ql.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,Ql.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,Ql.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,Ql.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,Ql.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,Ql.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,Ql.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,Ql.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}};var rc=nc;function nc(t,e){this.x=t,this.y=e}nc.prototype={clone:function(){return new nc(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,i=t.y-this.y;return e*e+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[0]*this.x+t[1]*this.y,i=t[2]*this.x+t[3]*this.y;return this.x=e,this.y=i,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),i=Math.sin(t),r=e*this.x-i*this.y,n=i*this.x+e*this.y;return this.x=r,this.y=n,this},_rotateAround:function(t,e){var i=Math.cos(t),r=Math.sin(t),n=e.x+i*(this.x-e.x)-r*(this.y-e.y),o=e.y+r*(this.x-e.x)+i*(this.y-e.y);return this.x=n,this.y=o,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},nc.convert=function(t){return t instanceof nc?t:Array.isArray(t)?new nc(t[0],t[1]):t};var oc=sc;function sc(t,e,i,r,n){this.properties={},this.extent=i,this.type=0,this._pbf=t,this._geometry=-1,this._keys=r,this._values=n,t.readFields(ac,this,e)}function ac(t,e,i){1==t?e.id=i.readVarint():2==t?function(t,e){for(var i=t.readVarint()+t.pos;t.pos<i;){var r=e._keys[t.readVarint()],n=e._values[t.readVarint()];e.properties[r]=n}}(i,e):3==t?e.type=i.readVarint():4==t&&(e._geometry=i.pos)}function lc(t){for(var e,i,r=0,n=0,o=t.length,s=o-1;n<o;s=n++)e=t[n],r+=((i=t[s]).x-e.x)*(e.y+i.y);return r}sc.types=["Unknown","Point","LineString","Polygon"],sc.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,i=t.readVarint()+t.pos,r=1,n=0,o=0,s=0,a=[];t.pos<i;){if(!n){var l=t.readVarint();r=7&l,n=l>>3}if(n--,1===r||2===r)o+=t.readSVarint(),s+=t.readSVarint(),1===r&&(e&&a.push(e),e=[]),e.push(new rc(o,s));else{if(7!==r)throw new Error("unknown command "+r);e&&e.push(e[0].clone())}}return e&&a.push(e),a},sc.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,i=1,r=0,n=0,o=0,s=1/0,a=-1/0,l=1/0,c=-1/0;t.pos<e;){if(!r){var u=t.readVarint();i=7&u,r=u>>3}if(r--,1===i||2===i)(n+=t.readSVarint())<s&&(s=n),n>a&&(a=n),(o+=t.readSVarint())<l&&(l=o),o>c&&(c=o);else if(7!==i)throw new Error("unknown command "+i)}return[s,l,a,c]},sc.prototype.toGeoJSON=function(t,e,i){var r,n,o=this.extent*Math.pow(2,i),s=this.extent*t,a=this.extent*e,l=this.loadGeometry(),c=sc.types[this.type];function u(t){for(var e=0;e<t.length;e++){var i=t[e],r=180-360*(i.y+a)/o;t[e]=[360*(i.x+s)/o-180,360/Math.PI*Math.atan(Math.exp(r*Math.PI/180))-90]}}switch(this.type){case 1:var h=[];for(r=0;r<l.length;r++)h[r]=l[r][0];u(l=h);break;case 2:for(r=0;r<l.length;r++)u(l[r]);break;case 3:for(l=function(t){var e=t.length;if(e<=1)return[t];for(var i,r,n=[],o=0;o<e;o++){var s=lc(t[o]);0!==s&&(void 0===r&&(r=s<0),r===s<0?(i&&n.push(i),i=[t[o]]):i.push(t[o]))}return i&&n.push(i),n}(l),r=0;r<l.length;r++)for(n=0;n<l[r].length;n++)u(l[r][n])}1===l.length?l=l[0]:c="Multi"+c;var d={type:"Feature",geometry:{type:c,coordinates:l},properties:this.properties};return"id"in this&&(d.id=this.id),d};var cc=uc;function uc(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(hc,this,e),this.length=this._features.length}function hc(t,e,i){15===t?e.version=i.readVarint():1===t?e.name=i.readString():5===t?e.extent=i.readVarint():2===t?e._features.push(i.pos):3===t?e._keys.push(i.readString()):4===t&&e._values.push(function(t){for(var e=null,i=t.readVarint()+t.pos;t.pos<i;){var r=t.readVarint()>>3;e=1===r?t.readString():2===r?t.readFloat():3===r?t.readDouble():4===r?t.readVarint64():5===r?t.readVarint():6===r?t.readSVarint():7===r?t.readBoolean():null}return e}(i))}function dc(t,e,i){if(3===t){var r=new cc(i,i.readVarint()+i.pos);r.length&&(e[r.name]=r)}}uc.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new oc(this._pbf,e,this.extent,this._keys,this._values)};var pc=function(t,e){this.layers=t.readFields(dc,{},e)},fc=oc,Ac={NONE:0,ALL:1,SOME:2},mc=["{","["],gc=function(t){function e(e,i){var r;return(r=t.call(this,e,i)||this).response_type="arraybuffer",!0===e.parse_json?r.parse_json_type=Ac.ALL:Array.isArray(e.parse_json)?(r.parse_json_type=Ac.SOME,r.parse_json_prop_list=e.parse_json):(null!=e.parse_json&&Ki({level:"warn",once:!0},"Data source '"+r.name+"': 'parse_json' parameter should be 'true', or an array of property names (was '"+JSON.stringify(e.parse_json)+"')"),r.parse_json_type=Ac.NONE),r}fe(e,t);var i=e.prototype;return i.parseSourceData=function(t,e,i){var r=new Uint8Array(i),n=new Nl(r);if(e.data=new pc(n),e.layers=this.toGeoJSON(e.data),"function"==typeof this.transform){var o={min:Object.assign({},t.min),max:Object.assign({},t.max),coords:Object.assign({},t.coords)};e.layers=this.transform(e.layers,this.extra_data,o)}delete e.data},i.toGeoJSON=function(t){var e={};for(var i in t.layers){for(var r=t.layers[i],n=an.tile_scale/r.extent,o={type:"FeatureCollection",features:[]},s=0;s<r.length;s++){var a=r.feature(s),l={type:"Feature",geometry:{},id:a.id,properties:a.properties};this.parseJSONProperties(l);for(var c=l.geometry,u=a.loadGeometry(),h=0;h<u.length;h++)for(var d=u[h],p=0;p<d.length;p++)d[p]=[d[p].x*n,d[p].y*n];c.coordinates=u,"Point"===fc.types[a.type]?1===u.length?(c.type="Point",c.coordinates=c.coordinates[0][0]):(c.type="MultiPoint",c.coordinates=c.coordinates[0]):"LineString"===fc.types[a.type]?1===u.length?(c.type="LineString",c.coordinates=c.coordinates[0]):c.type="MultiLineString":"Polygon"===fc.types[a.type]&&(c=_c(c)),o.features.push(l)}e[i]=o}return e},i.parseJSONProperties=function(t){if(this.parse_json_type!==Ac.NONE){var e=t.properties;if(this.parse_json_type===Ac.SOME)this.parse_json_prop_list.forEach((function(t){try{e[t]=JSON.parse(e[t])}catch(t){}}));else for(var i in e)if(mc.indexOf(e[i][0])>-1)try{e[i]=JSON.parse(e[i])}catch(t){}}},e}(mo);function _c(t){for(var e,i=[],r=[],n=0;n<t.coordinates.length;n++){var o=t.coordinates[n],s=an.ringWinding(o);null!=s&&(s===(e=e||s)&&r.length>0&&(i.push(r),r=[]),r.push(o))}return r.length>0&&i.push(r),1===i.length?(t.type="Polygon",t.coordinates=i[0]):i.length>1?(t.type="MultiPolygon",t.coordinates=i):t=null,t}function yc(t,e,i,r,n,o){var s=n-i,a=o-r;if(0!==s||0!==a){var l=((t-i)*s+(e-r)*a)/(s*s+a*a);l>1?(i=n,r=o):l>0&&(i+=s*l,r+=a*l)}return(s=t-i)*s+(a=e-r)*a}function vc(t,e,i,r){var n={id:void 0===t?null:t,type:e,geometry:i,tags:r,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(t){var e=t.geometry,i=t.type;if("Point"===i||"MultiPoint"===i||"LineString"===i)xc(t,e);else if("Polygon"===i||"MultiLineString"===i)for(var r=0;r<e.length;r++)xc(t,e[r]);else if("MultiPolygon"===i)for(r=0;r<e.length;r++)for(var n=0;n<e[r].length;n++)xc(t,e[r][n])}(n),n}function xc(t,e){for(var i=0;i<e.length;i+=3)t.minX=Math.min(t.minX,e[i]),t.minY=Math.min(t.minY,e[i+1]),t.maxX=Math.max(t.maxX,e[i]),t.maxY=Math.max(t.maxY,e[i+1])}function bc(t,e,i,r){if(e.geometry){var n=e.geometry.coordinates,o=e.geometry.type,s=Math.pow(i.tolerance/((1<<i.maxZoom)*i.extent),2),a=[],l=e.id;if(i.promoteId?l=e.properties[i.promoteId]:i.generateId&&(l=r||0),"Point"===o)wc(n,a);else if("MultiPoint"===o)for(var c=0;c<n.length;c++)wc(n[c],a);else if("LineString"===o)Tc(n,a,s,!1);else if("MultiLineString"===o){if(i.lineMetrics){for(c=0;c<n.length;c++)a=[],Tc(n[c],a,s,!1),t.push(vc(l,"LineString",a,e.properties));return}Bc(n,a,s,!1)}else if("Polygon"===o)Bc(n,a,s,!0);else{if("MultiPolygon"!==o){if("GeometryCollection"===o){for(c=0;c<e.geometry.geometries.length;c++)bc(t,{id:l,geometry:e.geometry.geometries[c],properties:e.properties},i,r);return}throw new Error("Input data is not a valid GeoJSON object.")}for(c=0;c<n.length;c++){var u=[];Bc(n[c],u,s,!0),a.push(u)}}t.push(vc(l,o,a,e.properties))}}function wc(t,e){e.push(Ec(t[0])),e.push(Cc(t[1])),e.push(0)}function Tc(t,e,i,r){for(var n,o,s=0,a=0;a<t.length;a++){var l=Ec(t[a][0]),c=Cc(t[a][1]);e.push(l),e.push(c),e.push(0),a>0&&(s+=r?(n*c-l*o)/2:Math.sqrt(Math.pow(l-n,2)+Math.pow(c-o,2))),n=l,o=c}var u=e.length-3;e[2]=1,function t(e,i,r,n){for(var o,s=n,a=r-i>>1,l=r-i,c=e[i],u=e[i+1],h=e[r],d=e[r+1],p=i+3;p<r;p+=3){var f=yc(e[p],e[p+1],c,u,h,d);if(f>s)o=p,s=f;else if(f===s){var A=Math.abs(p-a);A<l&&(o=p,l=A)}}s>n&&(o-i>3&&t(e,i,o,n),e[o+2]=s,r-o>3&&t(e,o,r,n))}(e,0,u,i),e[u+2]=1,e.size=Math.abs(s),e.start=0,e.end=e.size}function Bc(t,e,i,r){for(var n=0;n<t.length;n++){var o=[];Tc(t[n],o,i,r),e.push(o)}}function Ec(t){return t/360+.5}function Cc(t){var e=Math.sin(t*Math.PI/180),i=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return i<0?0:i>1?1:i}function Sc(t,e,i,r,n,o,s,a){if(r/=e,o>=(i/=e)&&s<r)return t;if(s<i||o>=r)return null;for(var l=[],c=0;c<t.length;c++){var u=t[c],h=u.geometry,d=u.type,p=0===n?u.minX:u.minY,f=0===n?u.maxX:u.maxY;if(p>=i&&f<r)l.push(u);else if(!(f<i||p>=r)){var A=[];if("Point"===d||"MultiPoint"===d)Ic(h,A,i,r,n);else if("LineString"===d)Mc(h,A,i,r,n,!1,a.lineMetrics);else if("MultiLineString"===d)Pc(h,A,i,r,n,!1);else if("Polygon"===d)Pc(h,A,i,r,n,!0);else if("MultiPolygon"===d)for(var m=0;m<h.length;m++){var g=[];Pc(h[m],g,i,r,n,!0),g.length&&A.push(g)}if(A.length){if(a.lineMetrics&&"LineString"===d){for(m=0;m<A.length;m++)l.push(vc(u.id,d,A[m],u.tags));continue}"LineString"!==d&&"MultiLineString"!==d||(1===A.length?(d="LineString",A=A[0]):d="MultiLineString"),"Point"!==d&&"MultiPoint"!==d||(d=3===A.length?"Point":"MultiPoint"),l.push(vc(u.id,d,A,u.tags))}}}return l.length?l:null}function Ic(t,e,i,r,n){for(var o=0;o<t.length;o+=3){var s=t[o+n];s>=i&&s<=r&&(e.push(t[o]),e.push(t[o+1]),e.push(t[o+2]))}}function Mc(t,e,i,r,n,o,s){for(var a,l,c=kc(t),u=0===n?zc:Fc,h=t.start,d=0;d<t.length-3;d+=3){var p=t[d],f=t[d+1],A=t[d+2],m=t[d+3],g=t[d+4],_=0===n?p:f,y=0===n?m:g,v=!1;s&&(a=Math.sqrt(Math.pow(p-m,2)+Math.pow(f-g,2))),_<i?y>i&&(l=u(c,p,f,m,g,i),s&&(c.start=h+a*l)):_>r?y<r&&(l=u(c,p,f,m,g,r),s&&(c.start=h+a*l)):Lc(c,p,f,A),y<i&&_>=i&&(l=u(c,p,f,m,g,i),v=!0),y>r&&_<=r&&(l=u(c,p,f,m,g,r),v=!0),!o&&v&&(s&&(c.end=h+a*l),e.push(c),c=kc(t)),s&&(h+=a)}var x=t.length-3;p=t[x],f=t[x+1],A=t[x+2],(_=0===n?p:f)>=i&&_<=r&&Lc(c,p,f,A),x=c.length-3,o&&x>=3&&(c[x]!==c[0]||c[x+1]!==c[1])&&Lc(c,c[0],c[1],c[2]),c.length&&e.push(c)}function kc(t){var e=[];return e.size=t.size,e.start=t.start,e.end=t.end,e}function Pc(t,e,i,r,n,o){for(var s=0;s<t.length;s++)Mc(t[s],e,i,r,n,o,!1)}function Lc(t,e,i,r){t.push(e),t.push(i),t.push(r)}function zc(t,e,i,r,n,o){var s=(o-e)/(r-e);return t.push(o),t.push(i+(n-i)*s),t.push(1),s}function Fc(t,e,i,r,n,o){var s=(o-i)/(n-i);return t.push(e+(r-e)*s),t.push(o),t.push(1),s}function Dc(t,e){for(var i=[],r=0;r<t.length;r++){var n,o=t[r],s=o.type;if("Point"===s||"MultiPoint"===s||"LineString"===s)n=Rc(o.geometry,e);else if("MultiLineString"===s||"Polygon"===s){n=[];for(var a=0;a<o.geometry.length;a++)n.push(Rc(o.geometry[a],e))}else if("MultiPolygon"===s)for(n=[],a=0;a<o.geometry.length;a++){for(var l=[],c=0;c<o.geometry[a].length;c++)l.push(Rc(o.geometry[a][c],e));n.push(l)}i.push(vc(o.id,s,n,o.tags))}return i}function Rc(t,e){var i=[];i.size=t.size,void 0!==t.start&&(i.start=t.start,i.end=t.end);for(var r=0;r<t.length;r+=3)i.push(t[r]+e,t[r+1],t[r+2]);return i}function Uc(t,e){if(t.transformed)return t;var i,r,n,o=1<<t.z,s=t.x,a=t.y;for(i=0;i<t.features.length;i++){var l=t.features[i],c=l.geometry,u=l.type;if(l.geometry=[],1===u)for(r=0;r<c.length;r+=2)l.geometry.push(Oc(c[r],c[r+1],e,o,s,a));else for(r=0;r<c.length;r++){var h=[];for(n=0;n<c[r].length;n+=2)h.push(Oc(c[r][n],c[r][n+1],e,o,s,a));l.geometry.push(h)}}return t.transformed=!0,t}function Oc(t,e,i,r,n,o){return[Math.round(i*(t*r-n)),Math.round(i*(e*r-o))]}function Nc(t,e,i,r,n){for(var o=e===n.maxZoom?0:n.tolerance/((1<<e)*n.extent),s={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:i,y:r,z:e,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},a=0;a<t.length;a++){s.numFeatures++,Qc(s,t[a],o,n);var l=t[a].minX,c=t[a].minY,u=t[a].maxX,h=t[a].maxY;l<s.minX&&(s.minX=l),c<s.minY&&(s.minY=c),u>s.maxX&&(s.maxX=u),h>s.maxY&&(s.maxY=h)}return s}function Qc(t,e,i,r){var n=e.geometry,o=e.type,s=[];if("Point"===o||"MultiPoint"===o)for(var a=0;a<n.length;a+=3)s.push(n[a]),s.push(n[a+1]),t.numPoints++,t.numSimplified++;else if("LineString"===o)Vc(s,n,t,i,!1,!1);else if("MultiLineString"===o||"Polygon"===o)for(a=0;a<n.length;a++)Vc(s,n[a],t,i,"Polygon"===o,0===a);else if("MultiPolygon"===o)for(var l=0;l<n.length;l++){var c=n[l];for(a=0;a<c.length;a++)Vc(s,c[a],t,i,!0,0===a)}if(s.length){var u=e.tags||null;if("LineString"===o&&r.lineMetrics){for(var h in u={},e.tags)u[h]=e.tags[h];u.mapbox_clip_start=n.start/n.size,u.mapbox_clip_end=n.end/n.size}var d={geometry:s,type:"Polygon"===o||"MultiPolygon"===o?3:"LineString"===o||"MultiLineString"===o?2:1,tags:u};null!==e.id&&(d.id=e.id),t.features.push(d)}}function Vc(t,e,i,r,n,o){var s=r*r;if(r>0&&e.size<(n?s:r))i.numPoints+=e.length/3;else{for(var a=[],l=0;l<e.length;l+=3)(0===r||e[l+2]>s)&&(i.numSimplified++,a.push(e[l]),a.push(e[l+1])),i.numPoints++;n&&function(t,e){for(var i=0,r=0,n=t.length,o=n-2;r<n;o=r,r+=2)i+=(t[r]-t[o])*(t[r+1]+t[o+1]);if(i>0===e)for(r=0,n=t.length;r<n/2;r+=2){var s=t[r],a=t[r+1];t[r]=t[n-2-r],t[r+1]=t[n-1-r],t[n-2-r]=s,t[n-1-r]=a}}(a,o),t.push(a)}}function jc(t,e){return new Hc(t,e)}function Hc(t,e){var i=(e=this.options=function(t,e){for(var i in e)t[i]=e[i];return t}(Object.create(this.options),e)).debug;if(i&&console.time("preprocess data"),e.maxZoom<0||e.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(e.promoteId&&e.generateId)throw new Error("promoteId and generateId cannot be used together.");var r=function(t,e){var i=[];if("FeatureCollection"===t.type)for(var r=0;r<t.features.length;r++)bc(i,t.features[r],e,r);else"Feature"===t.type?bc(i,t,e):bc(i,{geometry:t},e);return i}(t,e);this.tiles={},this.tileCoords=[],i&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",e.indexMaxZoom,e.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(r=function(t,e){var i=e.buffer/e.extent,r=t,n=Sc(t,1,-1-i,i,0,-1,2,e),o=Sc(t,1,1-i,2+i,0,-1,2,e);return(n||o)&&(r=Sc(t,1,-i,1+i,0,-1,2,e)||[],n&&(r=Dc(n,1).concat(r)),o&&(r=r.concat(Dc(o,-1)))),r}(r,e)).length&&this.splitTile(r,0,0,0),i&&(r.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Gc(t,e,i){return 32*((1<<t)*i+e)+t}po.register("MVT",(function(){return gc})),Hc.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Hc.prototype.splitTile=function(t,e,i,r,n,o,s){for(var a=[t,e,i,r],l=this.options,c=l.debug;a.length;){r=a.pop(),i=a.pop(),e=a.pop(),t=a.pop();var u=1<<e,h=Gc(e,i,r),d=this.tiles[h];if(!d&&(c>1&&console.time("creation"),d=this.tiles[h]=Nc(t,e,i,r,l),this.tileCoords.push({z:e,x:i,y:r}),c)){c>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",e,i,r,d.numFeatures,d.numPoints,d.numSimplified),console.timeEnd("creation"));var p="z"+e;this.stats[p]=(this.stats[p]||0)+1,this.total++}if(d.source=t,n){if(e===l.maxZoom||e===n)continue;var f=1<<n-e;if(i!==Math.floor(o/f)||r!==Math.floor(s/f))continue}else if(e===l.indexMaxZoom||d.numPoints<=l.indexMaxPoints)continue;if(d.source=null,0!==t.length){c>1&&console.time("clipping");var A,m,g,_,y,v,x=.5*l.buffer/l.extent,b=.5-x,w=.5+x,T=1+x;A=m=g=_=null,y=Sc(t,u,i-x,i+w,0,d.minX,d.maxX,l),v=Sc(t,u,i+b,i+T,0,d.minX,d.maxX,l),t=null,y&&(A=Sc(y,u,r-x,r+w,1,d.minY,d.maxY,l),m=Sc(y,u,r+b,r+T,1,d.minY,d.maxY,l),y=null),v&&(g=Sc(v,u,r-x,r+w,1,d.minY,d.maxY,l),_=Sc(v,u,r+b,r+T,1,d.minY,d.maxY,l),v=null),c>1&&console.timeEnd("clipping"),a.push(A||[],e+1,2*i,2*r),a.push(m||[],e+1,2*i,2*r+1),a.push(g||[],e+1,2*i+1,2*r),a.push(_||[],e+1,2*i+1,2*r+1)}}},Hc.prototype.getTile=function(t,e,i){var r=this.options,n=r.extent,o=r.debug;if(t<0||t>24)return null;var s=1<<t,a=Gc(t,e=(e%s+s)%s,i);if(this.tiles[a])return Uc(this.tiles[a],n);o>1&&console.log("drilling down to z%d-%d-%d",t,e,i);for(var l,c=t,u=e,h=i;!l&&c>0;)c--,u=Math.floor(u/2),h=Math.floor(h/2),l=this.tiles[Gc(c,u,h)];return l&&l.source?(o>1&&console.log("found parent tile z%d-%d-%d",c,u,h),o>1&&console.time("drilling down"),this.splitTile(l.source,c,u,h,t,e,i),o>1&&console.timeEnd("drilling down"),this.tiles[a]?Uc(this.tiles[a],n):null):null};var $c=function(t){function e(e,i){var r;return(r=t.call(this,e,i)||this).load_data=null,r.tile_indexes={},r.setTileSize(512),r.pad_scale=0,r}fe(e,t);var i=e.prototype;return i._load=function(e){var i=this;return this.load_data||(this.load_data=t.prototype._load.call(this,{source_data:{layers:{}}}).then((function(t){t.source_data.error&&Ki("warn","data source load error(s) for source '"+i.name+"', URL '"+i.url+"': "+t.source_data.error);var e=t.source_data.layers;for(var r in e)i.tile_indexes[r]=jc(e[r],{maxZoom:i.max_zoom,tolerance:1.5,extent:an.tile_scale,buffer:1e-4});return i.loaded=!0,t}))),this.load_data.then((function(){for(var t in i.tile_indexes)e.source_data.layers[t]=i.getTileFeatures(e,t);return e}))},i.getTileFeatures=function(t,e){var i,r=an.wrapTile(t.coords,{x:!0}),n=this.tile_indexes[e].getTile(r.z,r.x,r.y);if(n&&n.features){i={type:"FeatureCollection",features:[]};for(var o=0;o<n.features.length;o++){var s=n.features[o],a={type:"Feature",geometry:{},id:s.id,properties:s.tags};if(1===s.type)a.geometry.coordinates=s.geometry.map((function(t){return[t[0],t[1]]})),a.geometry.type="MultiPoint";else{if(2!==s.type&&3!==s.type)continue;if(a.geometry.coordinates=s.geometry.map((function(t){return t.map((function(t){return[t[0],t[1]]}))})),2===s.type)a.geometry.type="MultiLineString";else if(a.geometry=_c(a.geometry),null==a.geometry)continue}i.features.push(a)}}return i},i.formatURL=function(){return this.url},i.parseSourceData=function(t,e,i){var r="string"==typeof i?JSON.parse(i):i,n=this.getLayers(r);e.layers=this.preprocessLayers(n,t)},i.preprocessLayers=function(t,e){for(var i in t){var r=t[i];r.features=this.preprocessFeatures(r.features)}if("function"==typeof this.transform){var n={min:Object.assign({},e.min),max:Object.assign({},e.max),coords:Object.assign({},e.coords)};1===Object.keys(t).length&&t._default?t._default=this.transform(t._default,this.extra_data,n):t=this.transform(t,this.extra_data,n)}return t},i.preprocessFeatures=function(t){if(t=t.filter((function(t){return null!=t.geometry})),this.config.generate_label_centroids){var e=[],i={label_placement:!0};t.forEach((function(t){var r,n;if("Polygon"===t.geometry.type)n=qc(r=t.geometry.coordinates,t.id,t.properties,i),e.push(n);else if("MultiPolygon"===t.geometry.type){r=t.geometry.coordinates;for(var o=-1/0,s=0,a=0;a<r.length;a++){var l=an.polygonArea(r[a]);l>o&&(o=l,s=a)}n=qc(r[s],t.id,t.properties,i),e.push(n)}})),e=e.filter((function(t){return t})),Array.prototype.push.apply(t,e)}return t},i.getLayers=function(t){return"Feature"===t.type?{_default:{type:"FeatureCollection",features:[t]}}:"FeatureCollection"===t.type?{_default:t}:t},e}(Ao),Zc=function(t){function e(e,i){return t.call(this,e,i)||this}fe(e,t);var i=e.prototype;return i.parseSourceData=function(t,e,i){var r="string"==typeof i?JSON.parse(i):i;this.prepareGeoJSON(r,t,e)},i.prepareGeoJSON=function(t,e,i){if("function"==typeof this.transform){var r={min:Object.assign({},e.min),max:Object.assign({},e.max),coords:Object.assign({},e.coords)};t=this.transform(t,this.extra_data,r)}i.layers=$c.prototype.getLayers(t);var n={coords:e.coords,min:an.metersForTile(an.wrapTile(e.coords,{x:!0}))};po.projectData(i),po.scaleData(i,n)},e}(mo);function qc(t,e,i,r){var n=an.centroid(t);if(n){var o={};return Object.assign(o,i,r),{type:"Feature",id:e,properties:o,geometry:{type:"Point",coordinates:n}}}}function Kc(t){return t}function Wc(t,e){var i=e.id,r=e.bbox,n=null==e.properties?{}:e.properties,o=function(t,e){var i=function(t){if(null==(e=t.transform))return Kc;var e,i,r,n=e.scale[0],o=e.scale[1],s=e.translate[0],a=e.translate[1];return function(t,e){return e||(i=r=0),t[0]=(i+=t[0])*n+s,t[1]=(r+=t[1])*o+a,t}}(t),r=t.arcs;function n(t,e){e.length&&e.pop();for(var n=r[t<0?~t:t],o=0,s=n.length;o<s;++o)e.push(i(n[o].slice(),o));t<0&&function(t,e){for(var i,r=t.length,n=r-e;n<--r;)i=t[n],t[n++]=t[r],t[r]=i}(e,s)}function o(t){return i(t.slice())}function s(t){for(var e=[],i=0,r=t.length;i<r;++i)n(t[i],e);return e.length<2&&e.push(e[0].slice()),e}function a(t){for(var e=s(t);e.length<4;)e.push(e[0].slice());return e}function l(t){return t.map(a)}return function t(e){var i,r=e.type;switch(r){case"GeometryCollection":return{type:r,geometries:e.geometries.map(t)};case"Point":i=o(e.coordinates);break;case"MultiPoint":i=e.coordinates.map(o);break;case"LineString":i=s(e.arcs);break;case"MultiLineString":i=e.arcs.map(s);break;case"Polygon":i=l(e.arcs);break;case"MultiPolygon":i=e.arcs.map(l);break;default:return null}return{type:r,coordinates:i}}(e)}(t,e);return null==i&&null==r?{type:"Feature",properties:n,geometry:o}:null==r?{type:"Feature",id:i,properties:n,geometry:o}:{type:"Feature",id:i,bbox:r,properties:n,geometry:o}}po.register("GeoJSON",(function(t){return Zc.urlHasTilePattern(t.url)?Zc:$c}));var Xc=function(t){function e(){return t.apply(this,arguments)||this}fe(e,t);var i=e.prototype;return i.parseSourceData=function(e,i,r){var n="string"==typeof r?JSON.parse(r):r;n=this.toGeoJSON(n);var o=this.getLayers(n);t.prototype.preprocessLayers.call(this,o,e),i.layers=o},i.toGeoJSON=function(t){if(t.objects&&1===Object.keys(t.objects).length){var e=Object.keys(t.objects)[0];t=Jc(t,t.objects[e])}else{var i={};for(var r in t.objects)i[r]=Jc(t,t.objects[r]);t=i}return t},e}($c);function Jc(t,e){var i=function(t,e){return"GeometryCollection"===e.type?{type:"FeatureCollection",features:e.geometries.map((function(e){return Wc(t,e)}))}:Wc(t,e)}(t,e);return"Feature"===i.type&&(i={type:"FeatureCollection",features:[i]}),i}var Yc=function(t){function e(e,i){return t.call(this,e,i)||this}return fe(e,t),e.prototype.parseSourceData=function(t,e,i){var r="string"==typeof i?JSON.parse(i):i;r=Xc.prototype.toGeoJSON(r),this.prepareGeoJSON(r,t,e)},e}(Zc);po.register("TopoJSON",(function(t){return Yc.urlHasTilePattern(t.url)?Yc:Xc})),t.Collision=aa,t.DataSource=po,t.FeatureSelection=Wn,t.FilterOptions=Pl,t.FontManager=_a,t.GLSL=Gr,t.Geo=an,t.Label=ra,t.LabelLineStraight=tl,t.LabelPoint=la,t.Light=so,t.Material=to,t.OBB=ia,t.ShaderProgram=Jr,t.Style=vo,t.StyleManager=ll,t.StyleParser=Rn,t.Task=Tr,t.TextCanvas=Da,t.Texture=Hr,t.Thread=Ht,t.Tile=Rl,t.TileID=go,t.Utils=Yi,t.Vector=oo,t.VertexArrayObject=Yr,t.VertexData=Co,t.VertexElements=Bo,t.View=Za,t.WorkerBroker=Qi,t._createClass=pe,t._createForOfIteratorHelperLoose=ve,t._inheritsLoose=fe,t.addBaseURL=function(t,e){if(!t||!br(t))return t;var i,r="/"!==t[0];if(e?(i=document.createElement("a")).href=e:i=window.location,r)t=xr(i.href)+t;else{var n=i.origin;n||(n=i.protocol+"//"+i.host),t=n+t}return t},t.buildFilter=Tl,t.cache=Ln,t.clearFunctionStringCache=function(){Ln.functions={},Ln.num_functions=0,Ln.num_cached=0},t.commonjsRequire=function(){throw new Error("Dynamic requires are not currently supported by rollup-plugin-commonjs")},t.compileFunctionStrings=zn,t.createCommonjsModule=e,t.createObjectURL=function(t){return void 0===yr&&"function"!=typeof(yr=window.URL&&window.URL.createObjectURL||window.webkitURL&&window.webkitURL.createObjectURL)&&(yr=null,Ki("warn","window.URL.createObjectURL (or vendor prefix) not found, unable to create local blob URLs")),yr?yr(t):t},t.debugSettings=tr,t.debugSumLayerStats=function(t){var e={},i={};return t.filter((function(t){return t.debug.layers})).forEach((function(t){Object.keys(t.debug.layers.list).forEach((function(i){var r=t.debug.layers.list[i];xo(e,i,r.features,r.geoms,r.styles,r.base)})),function t(e,i){for(var r in e){var n=e[r];xo(i,r,n.features,n.geoms,n.styles,n.base),n.layers&&(i[r].layers=i[r].layers||{},t(n.layers,i[r].layers))}}(t.debug.layers.tree,i)})),{list:e,tree:i}},t.extensionForURL=function(t){var e=(t=t.split("/").pop()).lastIndexOf(".");if(e>-1)return t.substring(e+1)},t.flattenRelativeURL=function(t){for(var e=(t||"").split("/"),i=1;i<e.length;i++)"."===e[i]?(e.splice(i,1),i--):".."===e[i]&&(i+=0,e.splice(i-1,2),i--);return e.join("/")},t.isLocalURL=function(t){if("string"==typeof t)return t.search(/^(data|blob):/)>-1},t.isRelativeURL=br,t.isReserved=Ll,t.layerCache=function(){return El},t.log=Ki,t.mergeDebugSettings=function(t){Object.assign(Ji,t)},t.mergeObjects=sn,t.parseLayers=function(t,e){El={};var i={};for(var r in t){var n=t[r];n&&(i[r]=zl(r,n,null,e))}return i},t.pathForURL=xr,t.require$$0=jr,t.sliceObject=Er,t.subscribeMixin=Br,t.version=Fi})),r(["./shared"],(function(t){var e=Object.assign(self,{FeatureSelection:t.FeatureSelection,sources:{},styles:{},layers:{},tiles:{},init:function(e,i,r,n,o,s,a){return this.scene_id=e,this._worker_id=i,this.num_workers=r,t.log.setLevel(n),t.Utils.device_pixel_ratio=o,t.VertexElements.setElementIndexUint(s),t.FeatureSelection.setPrefix(this._worker_id),this.style_manager=new t.StyleManager,this.importExternalScripts(a),t.Label.id_prefix=i,t.Label.id_multiplier=r,i},importExternalScripts:function(e){var i=this;if(0!==e.length){t.log("debug","loading custom data source scripts in worker:",e);var r=Object.getOwnPropertyNames(window);importScripts.apply(void 0,e),Object.getOwnPropertyNames(window).forEach((function(t){-1===r.indexOf(t)&&(i[t]=window[t])}))}},updateConfig:function(e,i){var r=e.config,n=e.generation,o=e.introspection;return r=JSON.parse(r),t.mergeDebugSettings(i),this.generation=n,this.introspection=o,this.global=t.compileFunctionStrings(r.global),this.createDataSources(r),r.styles=t.compileFunctionStrings(r.styles,t.StyleParser.wrapFunction),this.styles=this.style_manager.build(r.styles),this.style_manager.initStyles({generation:this.generation,styles:this.styles,sources:this.sources,introspection:this.introspection}),this.layers=t.parseLayers(r.layers,this.style_manager.styles),this.syncing_textures=this.syncTextures(r.textures),this.configuring=this.syncing_textures.then((function(){t.log("debug","updated config")})),this.configuring},createDataSources:function(e){var i=this;this.last_config_sources=this.config_sources||{},this.config_sources=e.sources;var r=this.sources,n=[];for(var o in this.sources={},e.sources)if(JSON.stringify(this.last_config_sources[o])!==JSON.stringify(e.sources[o])){e.sources[o]=t.compileFunctionStrings(e.sources[o]);var s=void 0;try{s=t.DataSource.create(Object.assign({},e.sources[o],{name:o}),this.sources)}catch(t){continue}s&&(this.sources[o]=s,n.push(o))}else this.sources[o]=r[o];n.forEach((function(t){for(var e in i.tiles)i.tiles[e].source===t&&delete i.tiles[e]}))},awaitConfiguration:function(){return this.configuring},buildTile:function(e){var i=this,r=e.tile;if(null==this.getTile(r.key)||!0!==this.getTile(r.key).loading)return r=this.tiles[r.key]=Object.assign(this.getTile(r.key)||{},r),this.awaitConfiguration().then((function(){if(!0!==r.loaded)r.loading=!0,r.loaded=!1,r.error=null,i.loadTileSourceData(r).then((function(){i.getTile(r.key)?(r.source_data.error&&t.log("warn","tile load error(s) for "+r.key+": "+r.source_data.error),r.loading=!1,r.loaded=!0,t.Tile.buildGeometry(r,i)):t.log("trace","stop tile build after data source load because tile was removed: "+r.key)})).catch((function(e){r.loading=!1,r.loaded=!1,r.error=e.stack,t.log("error","tile load error for "+r.key+": "+r.error),t.WorkerBroker.postMessage("TileManager_"+i.scene_id+".buildTileError",t.Tile.slice(r))}));else{t.log("trace","used worker cache for tile "+r.key);try{t.Tile.buildGeometry(r,i)}catch(e){r.error=e.toString(),t.WorkerBroker.postMessage("TileManager_"+i.scene_id+".buildTileError",t.Tile.slice(r))}}}))},loadTileSourceData:function(t){var e=this.sources[t.source];if(e){for(var i in this.tiles){var r=this.tiles[i];if(r.source===t.source&&r.coords.key===t.coords.key&&r.loaded)return Promise.resolve(e.copyTileData(r,t))}return e.load(t)}return t.source_data={},Promise.resolve(t)},getTile:function(t){return this.tiles[t]},removeTile:function(e){var i=this.tiles[e];null!=i&&(!0===i.loading&&(t.log("trace","cancel tile load for "+e),i.loading=!1,t.Tile.cancel(i)),t.FeatureSelection.clearTile(e),delete this.tiles[e],t.log("trace","remove tile from cache for "+e))},queryFeatures:function(e){var i=this,r=e.filter,n=e.visible,o=e.geometry,s=e.tile_keys,a=[],l=s.map((function(t){return i.tiles[t]})).filter((function(t){return t&&t.loaded}));return null!=r&&(r=["{","["].indexOf(r[0])>-1?JSON.parse(r):r,r=t.compileFunctionStrings(r,t.StyleParser.wrapFunction)),r=t.buildFilter(r,t.FilterOptions),l.forEach((function(e){var s=function(s){var l=e.source_data.layers[s];if(null==l)return{v:void 0};l.features.forEach((function(l){var c=l.generation===i.generation;if(!(!0===n&&!c||!1===n&&c)){var u=t.StyleParser.getFeatureParseContext(l,e,i.global);if(u.source=e.source,u.layer=s,u.id=l.id,r(u)){var h={type:l.type,id:l.id,properties:Object.assign({},l.properties,{$source:u.source,$layer:u.layer,$geometry:u.geometry,$visible:c})};!0===o&&(h.geometry=t.Geo.copyGeometry(l.geometry),t.Geo.tileSpaceToLatlng(h.geometry,e.coords.z,e.min)),a.push(h)}}}))};for(var l in e.source_data.layers){var c=s(l);if("object"==typeof c)return c.v}})),a},getFeatureSelection:function(e){var i=void 0===e?{}:e,r=i.id,n=i.key,o=t.FeatureSelection.map[n];return{id:r,feature:o&&o.feature}},resetFeatureSelection:function(e){void 0===e&&(e=null),t.FeatureSelection.reset(e)},getFeatureSelectionMapSize:function(){return t.FeatureSelection.getMapSize()},syncTextures:function(e){var i=[];return e&&i.push.apply(i,Object.keys(e)),t.log("trace","sync textures to worker:",i),i.length>0?t.Texture.syncTexturesToWorker(i):Promise.resolve()},updateDevicePixelRatio:function(e){t.Utils.device_pixel_ratio=e},clearFunctionStringCache:function(){t.clearFunctionStringCache()},profile:function(t){console.profile("worker "+this._worker_id+": "+t)},profileEnd:function(t){console.profileEnd("worker "+this._worker_id+": "+t)},debug:{debugSettings:t.debugSettings,layerCache:t.layerCache,functionStringCache:t.cache}});t.WorkerBroker.addTarget("self",e)})),r(["./shared"],(function(t){var e,r=e={},n=0;function o(t,e){var i,r=e[e.length-1];return null==(i=a(t,e))?void 0:i[r]}function s(t,e,i){var r=e[e.length-1],n=a(t,e);n&&(n[r]=i)}function a(t,e){if(0!==e.length){for(var i=t,r=0;r<e.length-1;r++)if(null==(i=i[e[r]]))return;return i}}e.getContext=function(t,i){var r=!1;null==t&&((t=document.createElement("canvas")).style.position="absolute",t.style.top=0,t.style.left=0,t.style.zIndex=-1,document.body.appendChild(t),r=!0),t.addEventListener("webglcontextlost",(function(){})),t.addEventListener("webglcontextrestored",(function(){}));var o=t.getContext("webgl",i)||t.getContext("experimental-webgl",i);if(!o)throw new Error("Couldn't create WebGL context.");return o._tangram_id=n++,r?(e.resize(o,window.innerWidth,window.innerHeight,i.device_pixel_ratio),window.addEventListener("resize",(function(){e.resize(o,window.innerWidth,window.innerHeight,i.device_pixel_ratio)}))):e.resize(o,parseFloat(t.style.width),parseFloat(t.style.height),i.device_pixel_ratio),o},e.resize=function(t,e,i,r){r=r||window.devicePixelRatio||1,t.canvas.style.width=e+"px",t.canvas.style.height=i+"px",t.canvas.width=Math.round(e*r),t.canvas.height=Math.round(i*r),t.bindFramebuffer(t.FRAMEBUFFER,null),t.viewport(0,0,t.canvas.width,t.canvas.height)};var l="global.",c=l.length,u="__global_prop";function h(t){return(null==t?void 0:t.slice(0,c))===l}function d(t,e){var i,r=Array.isArray(e)?e:[e],n=a(t,r),o=r[r.length-1];return void 0!==(null==n||null==(i=n[u])?void 0:i[o])}var p=void 0!==mt?mt:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},f=[],A=[],m="undefined"!=typeof Uint8Array?Uint8Array:Array,g=!1;function _(){g=!0;for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",e=0,i=t.length;e<i;++e)f[e]=t[e],A[t.charCodeAt(e)]=e;A["-".charCodeAt(0)]=62,A["_".charCodeAt(0)]=63}function y(t,e,i){for(var r,n,o=[],s=e;s<i;s+=3)r=(t[s]<<16)+(t[s+1]<<8)+t[s+2],o.push(f[(n=r)>>18&63]+f[n>>12&63]+f[n>>6&63]+f[63&n]);return o.join("")}function v(t){var e;g||_();for(var i=t.length,r=i%3,n="",o=[],s=0,a=i-r;s<a;s+=16383)o.push(y(t,s,s+16383>a?a:s+16383));return 1===r?(e=t[i-1],n+=f[e>>2],n+=f[e<<4&63],n+="=="):2===r&&(e=(t[i-2]<<8)+t[i-1],n+=f[e>>10],n+=f[e>>4&63],n+=f[e<<2&63],n+="="),o.push(n),o.join("")}function x(t,e,i,r,n){var o,s,a=8*n-r-1,l=(1<<a)-1,c=l>>1,u=-7,h=i?n-1:0,d=i?-1:1,p=t[e+h];for(h+=d,o=p&(1<<-u)-1,p>>=-u,u+=a;u>0;o=256*o+t[e+h],h+=d,u-=8);for(s=o&(1<<-u)-1,o>>=-u,u+=r;u>0;s=256*s+t[e+h],h+=d,u-=8);if(0===o)o=1-c;else{if(o===l)return s?NaN:1/0*(p?-1:1);s+=Math.pow(2,r),o-=c}return(p?-1:1)*s*Math.pow(2,o-r)}function b(t,e,i,r,n,o){var s,a,l,c=8*o-n-1,u=(1<<c)-1,h=u>>1,d=23===n?Math.pow(2,-24)-Math.pow(2,-77):0,p=r?0:o-1,f=r?1:-1,A=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,s=u):(s=Math.floor(Math.log(e)/Math.LN2),e*(l=Math.pow(2,-s))<1&&(s--,l*=2),(e+=s+h>=1?d/l:d*Math.pow(2,1-h))*l>=2&&(s++,l/=2),s+h>=u?(a=0,s=u):s+h>=1?(a=(e*l-1)*Math.pow(2,n),s+=h):(a=e*Math.pow(2,h-1)*Math.pow(2,n),s=0));n>=8;t[i+p]=255&a,p+=f,a/=256,n-=8);for(s=s<<n|a,c+=n;c>0;t[i+p]=255&s,p+=f,s/=256,c-=8);t[i+p-f]|=128*A}var w={}.toString,T=Array.isArray||function(t){return"[object Array]"==w.call(t)};S.TYPED_ARRAY_SUPPORT=void 0===p.TYPED_ARRAY_SUPPORT||p.TYPED_ARRAY_SUPPORT;var B=E();function E(){return S.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function C(t,e){if(E()<e)throw new RangeError("Invalid typed array length");return S.TYPED_ARRAY_SUPPORT?(t=new Uint8Array(e)).__proto__=S.prototype:(null===t&&(t=new S(e)),t.length=e),t}function S(t,e,i){if(!(S.TYPED_ARRAY_SUPPORT||this instanceof S))return new S(t,e,i);if("number"==typeof t){if("string"==typeof e)throw new Error("If encoding is specified then the first argument must be a string");return k(this,t)}return I(this,t,e,i)}function I(t,e,i,r){if("number"==typeof e)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer?function(t,e,i,r){if(e.byteLength,i<0||e.byteLength<i)throw new RangeError("'offset' is out of bounds");if(e.byteLength<i+(r||0))throw new RangeError("'length' is out of bounds");return e=void 0===i&&void 0===r?new Uint8Array(e):void 0===r?new Uint8Array(e,i):new Uint8Array(e,i,r),S.TYPED_ARRAY_SUPPORT?(t=e).__proto__=S.prototype:t=P(t,e),t}(t,e,i,r):"string"==typeof e?function(t,e,i){if("string"==typeof i&&""!==i||(i="utf8"),!S.isEncoding(i))throw new TypeError('"encoding" must be a valid string encoding');var r=0|F(e,i),n=(t=C(t,r)).write(e,i);return n!==r&&(t=t.slice(0,n)),t}(t,e,i):function(t,e){if(z(e)){var i=0|L(e.length);return 0===(t=C(t,i)).length||e.copy(t,0,0,i),t}if(e){if("undefined"!=typeof ArrayBuffer&&e.buffer instanceof ArrayBuffer||"length"in e)return"number"!=typeof e.length||(r=e.length)!=r?C(t,0):P(t,e);if("Buffer"===e.type&&T(e.data))return P(t,e.data)}var r;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(t,e)}function M(t){if("number"!=typeof t)throw new TypeError('"size" argument must be a number');if(t<0)throw new RangeError('"size" argument must not be negative')}function k(t,e){if(M(e),t=C(t,e<0?0:0|L(e)),!S.TYPED_ARRAY_SUPPORT)for(var i=0;i<e;++i)t[i]=0;return t}function P(t,e){var i=e.length<0?0:0|L(e.length);t=C(t,i);for(var r=0;r<i;r+=1)t[r]=255&e[r];return t}function L(t){if(t>=E())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+E().toString(16)+" bytes");return 0|t}function z(t){return!(null==t||!t._isBuffer)}function F(t,e){if(z(t))return t.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(t)||t instanceof ArrayBuffer))return t.byteLength;"string"!=typeof t&&(t=""+t);var i=t.length;if(0===i)return 0;for(var r=!1;;)switch(e){case"ascii":case"latin1":case"binary":return i;case"utf8":case"utf-8":case void 0:return at(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*i;case"hex":return i>>>1;case"base64":return lt(t).length;default:if(r)return at(t).length;e=(""+e).toLowerCase(),r=!0}}function D(t,e,i){var r=t[e];t[e]=t[i],t[i]=r}function R(t,e,i,r,n){if(0===t.length)return-1;if("string"==typeof i?(r=i,i=0):i>2147483647?i=2147483647:i<-2147483648&&(i=-2147483648),i=+i,isNaN(i)&&(i=n?0:t.length-1),i<0&&(i=t.length+i),i>=t.length){if(n)return-1;i=t.length-1}else if(i<0){if(!n)return-1;i=0}if("string"==typeof e&&(e=S.from(e,r)),z(e))return 0===e.length?-1:U(t,e,i,r,n);if("number"==typeof e)return e&=255,S.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?n?Uint8Array.prototype.indexOf.call(t,e,i):Uint8Array.prototype.lastIndexOf.call(t,e,i):U(t,[e],i,r,n);throw new TypeError("val must be string, number or Buffer")}function U(t,e,i,r,n){var o,s=1,a=t.length,l=e.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(t.length<2||e.length<2)return-1;s=2,a/=2,l/=2,i/=2}function c(t,e){return 1===s?t[e]:t.readUInt16BE(e*s)}if(n){var u=-1;for(o=i;o<a;o++)if(c(t,o)===c(e,-1===u?0:o-u)){if(-1===u&&(u=o),o-u+1===l)return u*s}else-1!==u&&(o-=o-u),u=-1}else for(i+l>a&&(i=a-l),o=i;o>=0;o--){for(var h=!0,d=0;d<l;d++)if(c(t,o+d)!==c(e,d)){h=!1;break}if(h)return o}return-1}function O(t,e,i,r){i=Number(i)||0;var n=t.length-i;r?(r=Number(r))>n&&(r=n):r=n;var o=e.length;if(o%2!=0)throw new TypeError("Invalid hex string");r>o/2&&(r=o/2);for(var s=0;s<r;++s){var a=parseInt(e.substr(2*s,2),16);if(isNaN(a))return s;t[i+s]=a}return s}function N(t,e,i,r){return ct(at(e,t.length-i),t,i,r)}function Q(t,e,i,r){return ct(function(t){for(var e=[],i=0;i<t.length;++i)e.push(255&t.charCodeAt(i));return e}(e),t,i,r)}function V(t,e,i,r){return Q(t,e,i,r)}function j(t,e,i,r){return ct(lt(e),t,i,r)}function H(t,e,i,r){return ct(function(t,e){for(var i,r,n,o=[],s=0;s<t.length&&!((e-=2)<0);++s)r=(i=t.charCodeAt(s))>>8,n=i%256,o.push(n),o.push(r);return o}(e,t.length-i),t,i,r)}function G(t,e,i){return 0===e&&i===t.length?v(t):v(t.slice(e,i))}function $(t,e,i){i=Math.min(t.length,i);for(var r=[],n=e;n<i;){var o,s,a,l,c=t[n],u=null,h=c>239?4:c>223?3:c>191?2:1;if(n+h<=i)switch(h){case 1:c<128&&(u=c);break;case 2:128==(192&(o=t[n+1]))&&(l=(31&c)<<6|63&o)>127&&(u=l);break;case 3:o=t[n+1],s=t[n+2],128==(192&o)&&128==(192&s)&&(l=(15&c)<<12|(63&o)<<6|63&s)>2047&&(l<55296||l>57343)&&(u=l);break;case 4:o=t[n+1],s=t[n+2],a=t[n+3],128==(192&o)&&128==(192&s)&&128==(192&a)&&(l=(15&c)<<18|(63&o)<<12|(63&s)<<6|63&a)>65535&&l<1114112&&(u=l)}null===u?(u=65533,h=1):u>65535&&(u-=65536,r.push(u>>>10&1023|55296),u=56320|1023&u),r.push(u),n+=h}return function(t){var e=t.length;if(e<=Z)return String.fromCharCode.apply(String,t);for(var i="",r=0;r<e;)i+=String.fromCharCode.apply(String,t.slice(r,r+=Z));return i}(r)}S.poolSize=8192,S._augment=function(t){return t.__proto__=S.prototype,t},S.from=function(t,e,i){return I(null,t,e,i)},S.TYPED_ARRAY_SUPPORT&&(S.prototype.__proto__=Uint8Array.prototype,S.__proto__=Uint8Array),S.alloc=function(t,e,i){return function(t,e,i,r){return M(e),e<=0?C(t,e):void 0!==i?"string"==typeof r?C(t,e).fill(i,r):C(t,e).fill(i):C(t,e)}(null,t,e,i)},S.allocUnsafe=function(t){return k(null,t)},S.allocUnsafeSlow=function(t){return k(null,t)},S.isBuffer=ut,S.compare=function(t,e){if(!z(t)||!z(e))throw new TypeError("Arguments must be Buffers");if(t===e)return 0;for(var i=t.length,r=e.length,n=0,o=Math.min(i,r);n<o;++n)if(t[n]!==e[n]){i=t[n],r=e[n];break}return i<r?-1:r<i?1:0},S.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},S.concat=function(t,e){if(!T(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return S.alloc(0);var i;if(void 0===e)for(e=0,i=0;i<t.length;++i)e+=t[i].length;var r=S.allocUnsafe(e),n=0;for(i=0;i<t.length;++i){var o=t[i];if(!z(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(r,n),n+=o.length}return r},S.byteLength=F,S.prototype._isBuffer=!0,S.prototype.swap16=function(){var t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var e=0;e<t;e+=2)D(this,e,e+1);return this},S.prototype.swap32=function(){var t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var e=0;e<t;e+=4)D(this,e,e+3),D(this,e+1,e+2);return this},S.prototype.swap64=function(){var t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var e=0;e<t;e+=8)D(this,e,e+7),D(this,e+1,e+6),D(this,e+2,e+5),D(this,e+3,e+4);return this},S.prototype.toString=function(){var t=0|this.length;return 0===t?"":0===arguments.length?$(this,0,t):function(t,e,i){var r=!1;if((void 0===e||e<0)&&(e=0),e>this.length)return"";if((void 0===i||i>this.length)&&(i=this.length),i<=0)return"";if((i>>>=0)<=(e>>>=0))return"";for(t||(t="utf8");;)switch(t){case"hex":return W(this,e,i);case"utf8":case"utf-8":return $(this,e,i);case"ascii":return q(this,e,i);case"latin1":case"binary":return K(this,e,i);case"base64":return G(this,e,i);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return X(this,e,i);default:if(r)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),r=!0}}.apply(this,arguments)},S.prototype.equals=function(t){if(!z(t))throw new TypeError("Argument must be a Buffer");return this===t||0===S.compare(this,t)},S.prototype.inspect=function(){var t="";return this.length>0&&(t=this.toString("hex",0,50).match(/.{2}/g).join(" "),this.length>50&&(t+=" ... ")),"<Buffer "+t+">"},S.prototype.compare=function(t,e,i,r,n){if(!z(t))throw new TypeError("Argument must be a Buffer");if(void 0===e&&(e=0),void 0===i&&(i=t?t.length:0),void 0===r&&(r=0),void 0===n&&(n=this.length),e<0||i>t.length||r<0||n>this.length)throw new RangeError("out of range index");if(r>=n&&e>=i)return 0;if(r>=n)return-1;if(e>=i)return 1;if(this===t)return 0;for(var o=(n>>>=0)-(r>>>=0),s=(i>>>=0)-(e>>>=0),a=Math.min(o,s),l=this.slice(r,n),c=t.slice(e,i),u=0;u<a;++u)if(l[u]!==c[u]){o=l[u],s=c[u];break}return o<s?-1:s<o?1:0},S.prototype.includes=function(t,e,i){return-1!==this.indexOf(t,e,i)},S.prototype.indexOf=function(t,e,i){return R(this,t,e,i,!0)},S.prototype.lastIndexOf=function(t,e,i){return R(this,t,e,i,!1)},S.prototype.write=function(t,e,i,r){if(void 0===e)r="utf8",i=this.length,e=0;else if(void 0===i&&"string"==typeof e)r=e,i=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e|=0,isFinite(i)?(i|=0,void 0===r&&(r="utf8")):(r=i,i=void 0)}var n=this.length-e;if((void 0===i||i>n)&&(i=n),t.length>0&&(i<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var o=!1;;)switch(r){case"hex":return O(this,t,e,i);case"utf8":case"utf-8":return N(this,t,e,i);case"ascii":return Q(this,t,e,i);case"latin1":case"binary":return V(this,t,e,i);case"base64":return j(this,t,e,i);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return H(this,t,e,i);default:if(o)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),o=!0}},S.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var Z=4096;function q(t,e,i){var r="";i=Math.min(t.length,i);for(var n=e;n<i;++n)r+=String.fromCharCode(127&t[n]);return r}function K(t,e,i){var r="";i=Math.min(t.length,i);for(var n=e;n<i;++n)r+=String.fromCharCode(t[n]);return r}function W(t,e,i){var r=t.length;(!e||e<0)&&(e=0),(!i||i<0||i>r)&&(i=r);for(var n="",o=e;o<i;++o)n+=st(t[o]);return n}function X(t,e,i){for(var r=t.slice(e,i),n="",o=0;o<r.length;o+=2)n+=String.fromCharCode(r[o]+256*r[o+1]);return n}function J(t,e,i){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(t+e>i)throw new RangeError("Trying to access beyond buffer length")}function Y(t,e,i,r,n,o){if(!z(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>n||e<o)throw new RangeError('"value" argument is out of bounds');if(i+r>t.length)throw new RangeError("Index out of range")}function tt(t,e,i,r){e<0&&(e=65535+e+1);for(var n=0,o=Math.min(t.length-i,2);n<o;++n)t[i+n]=(e&255<<8*(r?n:1-n))>>>8*(r?n:1-n)}function et(t,e,i,r){e<0&&(e=4294967295+e+1);for(var n=0,o=Math.min(t.length-i,4);n<o;++n)t[i+n]=e>>>8*(r?n:3-n)&255}function it(t,e,i,r,n,o){if(i+r>t.length)throw new RangeError("Index out of range");if(i<0)throw new RangeError("Index out of range")}function rt(t,e,i,r,n){return n||it(t,0,i,4),b(t,e,i,r,23,4),i+4}function nt(t,e,i,r,n){return n||it(t,0,i,8),b(t,e,i,r,52,8),i+8}S.prototype.slice=function(t,e){var i,r=this.length;if((t=~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),(e=void 0===e?r:~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),e<t&&(e=t),S.TYPED_ARRAY_SUPPORT)(i=this.subarray(t,e)).__proto__=S.prototype;else{var n=e-t;i=new S(n,void 0);for(var o=0;o<n;++o)i[o]=this[o+t]}return i},S.prototype.readUIntLE=function(t,e,i){t|=0,e|=0,i||J(t,e,this.length);for(var r=this[t],n=1,o=0;++o<e&&(n*=256);)r+=this[t+o]*n;return r},S.prototype.readUIntBE=function(t,e,i){t|=0,e|=0,i||J(t,e,this.length);for(var r=this[t+--e],n=1;e>0&&(n*=256);)r+=this[t+--e]*n;return r},S.prototype.readUInt8=function(t,e){return e||J(t,1,this.length),this[t]},S.prototype.readUInt16LE=function(t,e){return e||J(t,2,this.length),this[t]|this[t+1]<<8},S.prototype.readUInt16BE=function(t,e){return e||J(t,2,this.length),this[t]<<8|this[t+1]},S.prototype.readUInt32LE=function(t,e){return e||J(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},S.prototype.readUInt32BE=function(t,e){return e||J(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},S.prototype.readIntLE=function(t,e,i){t|=0,e|=0,i||J(t,e,this.length);for(var r=this[t],n=1,o=0;++o<e&&(n*=256);)r+=this[t+o]*n;return r>=(n*=128)&&(r-=Math.pow(2,8*e)),r},S.prototype.readIntBE=function(t,e,i){t|=0,e|=0,i||J(t,e,this.length);for(var r=e,n=1,o=this[t+--r];r>0&&(n*=256);)o+=this[t+--r]*n;return o>=(n*=128)&&(o-=Math.pow(2,8*e)),o},S.prototype.readInt8=function(t,e){return e||J(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},S.prototype.readInt16LE=function(t,e){e||J(t,2,this.length);var i=this[t]|this[t+1]<<8;return 32768&i?4294901760|i:i},S.prototype.readInt16BE=function(t,e){e||J(t,2,this.length);var i=this[t+1]|this[t]<<8;return 32768&i?4294901760|i:i},S.prototype.readInt32LE=function(t,e){return e||J(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},S.prototype.readInt32BE=function(t,e){return e||J(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},S.prototype.readFloatLE=function(t,e){return e||J(t,4,this.length),x(this,t,!0,23,4)},S.prototype.readFloatBE=function(t,e){return e||J(t,4,this.length),x(this,t,!1,23,4)},S.prototype.readDoubleLE=function(t,e){return e||J(t,8,this.length),x(this,t,!0,52,8)},S.prototype.readDoubleBE=function(t,e){return e||J(t,8,this.length),x(this,t,!1,52,8)},S.prototype.writeUIntLE=function(t,e,i,r){t=+t,e|=0,i|=0,r||Y(this,t,e,i,Math.pow(2,8*i)-1,0);var n=1,o=0;for(this[e]=255&t;++o<i&&(n*=256);)this[e+o]=t/n&255;return e+i},S.prototype.writeUIntBE=function(t,e,i,r){t=+t,e|=0,i|=0,r||Y(this,t,e,i,Math.pow(2,8*i)-1,0);var n=i-1,o=1;for(this[e+n]=255&t;--n>=0&&(o*=256);)this[e+n]=t/o&255;return e+i},S.prototype.writeUInt8=function(t,e,i){return t=+t,e|=0,i||Y(this,t,e,1,255,0),S.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),this[e]=255&t,e+1},S.prototype.writeUInt16LE=function(t,e,i){return t=+t,e|=0,i||Y(this,t,e,2,65535,0),S.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):tt(this,t,e,!0),e+2},S.prototype.writeUInt16BE=function(t,e,i){return t=+t,e|=0,i||Y(this,t,e,2,65535,0),S.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):tt(this,t,e,!1),e+2},S.prototype.writeUInt32LE=function(t,e,i){return t=+t,e|=0,i||Y(this,t,e,4,4294967295,0),S.TYPED_ARRAY_SUPPORT?(this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t):et(this,t,e,!0),e+4},S.prototype.writeUInt32BE=function(t,e,i){return t=+t,e|=0,i||Y(this,t,e,4,4294967295,0),S.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):et(this,t,e,!1),e+4},S.prototype.writeIntLE=function(t,e,i,r){if(t=+t,e|=0,!r){var n=Math.pow(2,8*i-1);Y(this,t,e,i,n-1,-n)}var o=0,s=1,a=0;for(this[e]=255&t;++o<i&&(s*=256);)t<0&&0===a&&0!==this[e+o-1]&&(a=1),this[e+o]=(t/s>>0)-a&255;return e+i},S.prototype.writeIntBE=function(t,e,i,r){if(t=+t,e|=0,!r){var n=Math.pow(2,8*i-1);Y(this,t,e,i,n-1,-n)}var o=i-1,s=1,a=0;for(this[e+o]=255&t;--o>=0&&(s*=256);)t<0&&0===a&&0!==this[e+o+1]&&(a=1),this[e+o]=(t/s>>0)-a&255;return e+i},S.prototype.writeInt8=function(t,e,i){return t=+t,e|=0,i||Y(this,t,e,1,127,-128),S.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),t<0&&(t=255+t+1),this[e]=255&t,e+1},S.prototype.writeInt16LE=function(t,e,i){return t=+t,e|=0,i||Y(this,t,e,2,32767,-32768),S.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):tt(this,t,e,!0),e+2},S.prototype.writeInt16BE=function(t,e,i){return t=+t,e|=0,i||Y(this,t,e,2,32767,-32768),S.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):tt(this,t,e,!1),e+2},S.prototype.writeInt32LE=function(t,e,i){return t=+t,e|=0,i||Y(this,t,e,4,2147483647,-2147483648),S.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24):et(this,t,e,!0),e+4},S.prototype.writeInt32BE=function(t,e,i){return t=+t,e|=0,i||Y(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),S.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):et(this,t,e,!1),e+4},S.prototype.writeFloatLE=function(t,e,i){return rt(this,t,e,!0,i)},S.prototype.writeFloatBE=function(t,e,i){return rt(this,t,e,!1,i)},S.prototype.writeDoubleLE=function(t,e,i){return nt(this,t,e,!0,i)},S.prototype.writeDoubleBE=function(t,e,i){return nt(this,t,e,!1,i)},S.prototype.copy=function(t,e,i,r){if(i||(i=0),r||0===r||(r=this.length),e>=t.length&&(e=t.length),e||(e=0),r>0&&r<i&&(r=i),r===i)return 0;if(0===t.length||0===this.length)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(i<0||i>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),t.length-e<r-i&&(r=t.length-e+i);var n,o=r-i;if(this===t&&i<e&&e<r)for(n=o-1;n>=0;--n)t[n+e]=this[n+i];else if(o<1e3||!S.TYPED_ARRAY_SUPPORT)for(n=0;n<o;++n)t[n+e]=this[n+i];else Uint8Array.prototype.set.call(t,this.subarray(i,i+o),e);return o},S.prototype.fill=function(t,e,i,r){if("string"==typeof t){if("string"==typeof e?(r=e,e=0,i=this.length):"string"==typeof i&&(r=i,i=this.length),1===t.length){var n=t.charCodeAt(0);n<256&&(t=n)}if(void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!S.isEncoding(r))throw new TypeError("Unknown encoding: "+r)}else"number"==typeof t&&(t&=255);if(e<0||this.length<e||this.length<i)throw new RangeError("Out of range index");if(i<=e)return this;var o;if(e>>>=0,i=void 0===i?this.length:i>>>0,t||(t=0),"number"==typeof t)for(o=e;o<i;++o)this[o]=t;else{var s=z(t)?t:at(new S(t,r).toString()),a=s.length;for(o=0;o<i-e;++o)this[o+e]=s[o%a]}return this};var ot=/[^+\/0-9A-Za-z-_]/g;function st(t){return t<16?"0"+t.toString(16):t.toString(16)}function at(t,e){var i;e=e||1/0;for(var r=t.length,n=null,o=[],s=0;s<r;++s){if((i=t.charCodeAt(s))>55295&&i<57344){if(!n){if(i>56319){(e-=3)>-1&&o.push(239,191,189);continue}if(s+1===r){(e-=3)>-1&&o.push(239,191,189);continue}n=i;continue}if(i<56320){(e-=3)>-1&&o.push(239,191,189),n=i;continue}i=65536+(n-55296<<10|i-56320)}else n&&(e-=3)>-1&&o.push(239,191,189);if(n=null,i<128){if((e-=1)<0)break;o.push(i)}else if(i<2048){if((e-=2)<0)break;o.push(i>>6|192,63&i|128)}else if(i<65536){if((e-=3)<0)break;o.push(i>>12|224,i>>6&63|128,63&i|128)}else{if(!(i<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;o.push(i>>18|240,i>>12&63|128,i>>6&63|128,63&i|128)}}return o}function lt(t){return function(t){var e,i,r,n,o,s;g||_();var a=t.length;if(a%4>0)throw new Error("Invalid string. Length must be a multiple of 4");o="="===t[a-2]?2:"="===t[a-1]?1:0,s=new m(3*a/4-o),r=o>0?a-4:a;var l=0;for(e=0,i=0;e<r;e+=4,i+=3)n=A[t.charCodeAt(e)]<<18|A[t.charCodeAt(e+1)]<<12|A[t.charCodeAt(e+2)]<<6|A[t.charCodeAt(e+3)],s[l++]=n>>16&255,s[l++]=n>>8&255,s[l++]=255&n;return 2===o?(n=A[t.charCodeAt(e)]<<2|A[t.charCodeAt(e+1)]>>4,s[l++]=255&n):1===o&&(n=A[t.charCodeAt(e)]<<10|A[t.charCodeAt(e+1)]<<4|A[t.charCodeAt(e+2)]>>2,s[l++]=n>>8&255,s[l++]=255&n),s}(function(t){if((t=function(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}(t).replace(ot,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}(t))}function ct(t,e,i,r){for(var n=0;n<r&&!(n+i>=e.length||n>=t.length);++n)e[n+i]=t[n];return n}function ut(t){return null!=t&&(!!t._isBuffer||ht(t)||function(t){return"function"==typeof t.readFloatLE&&"function"==typeof t.slice&&ht(t.slice(0,0))}(t))}function ht(t){return!!t.constructor&&"function"==typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)}var dt=Object.freeze({__proto__:null,INSPECT_MAX_BYTES:50,kMaxLength:B,Buffer:S,SlowBuffer:function(t){return+t!=t&&(t=0),S.alloc(+t)},isBuffer:ut});function pt(){}function ft(){ft.init.call(this)}function At(t){return void 0===t._maxListeners?ft.defaultMaxListeners:t._maxListeners}function gt(t,e,i,r){var n,o,s,a;if("function"!=typeof i)throw new TypeError('"listener" argument must be a function');if((o=t._events)?(o.newListener&&(t.emit("newListener",e,i.listener?i.listener:i),o=t._events),s=o[e]):(o=t._events=new pt,t._eventsCount=0),s){if("function"==typeof s?s=o[e]=r?[i,s]:[s,i]:r?s.unshift(i):s.push(i),!s.warned&&(n=At(t))&&n>0&&s.length>n){s.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+e+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",l.emitter=t,l.type=e,l.count=s.length,a=l,"function"==typeof console.warn?console.warn(a):console.log(a)}}else s=o[e]=i,++t._eventsCount;return t}function _t(t,e,i){var r=!1;function n(){t.removeListener(e,n),r||(r=!0,i.apply(t,arguments))}return n.listener=i,n}function yt(t){var e=this._events;if(e){var i=e[t];if("function"==typeof i)return 1;if(i)return i.length}return 0}function vt(t,e){for(var i=new Array(e);e--;)i[e]=t[e];return i}function xt(){throw new Error("setTimeout has not been defined")}function bt(){throw new Error("clearTimeout has not been defined")}pt.prototype=Object.create(null),ft.EventEmitter=ft,ft.usingDomains=!1,ft.prototype.domain=void 0,ft.prototype._events=void 0,ft.prototype._maxListeners=void 0,ft.defaultMaxListeners=10,ft.init=function(){this.domain=null,ft.usingDomains&&(void 0).active,this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=new pt,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},ft.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||isNaN(t))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=t,this},ft.prototype.getMaxListeners=function(){return At(this)},ft.prototype.emit=function(t){var e,i,r,n,o,s,a,l="error"===t;if(s=this._events)l=l&&null==s.error;else if(!l)return!1;if(a=this.domain,l){if(e=arguments[1],!a){if(e instanceof Error)throw e;var c=new Error('Uncaught, unspecified "error" event. ('+e+")");throw c.context=e,c}return e||(e=new Error('Uncaught, unspecified "error" event')),e.domainEmitter=this,e.domain=a,e.domainThrown=!1,a.emit("error",e),!1}if(!(i=s[t]))return!1;var u="function"==typeof i;switch(r=arguments.length){case 1:!function(t,e,i){if(e)t.call(i);else for(var r=t.length,n=vt(t,r),o=0;o<r;++o)n[o].call(i)}(i,u,this);break;case 2:!function(t,e,i,r){if(e)t.call(i,r);else for(var n=t.length,o=vt(t,n),s=0;s<n;++s)o[s].call(i,r)}(i,u,this,arguments[1]);break;case 3:!function(t,e,i,r,n){if(e)t.call(i,r,n);else for(var o=t.length,s=vt(t,o),a=0;a<o;++a)s[a].call(i,r,n)}(i,u,this,arguments[1],arguments[2]);break;case 4:!function(t,e,i,r,n,o){if(e)t.call(i,r,n,o);else for(var s=t.length,a=vt(t,s),l=0;l<s;++l)a[l].call(i,r,n,o)}(i,u,this,arguments[1],arguments[2],arguments[3]);break;default:for(n=new Array(r-1),o=1;o<r;o++)n[o-1]=arguments[o];!function(t,e,i,r){if(e)t.apply(i,r);else for(var n=t.length,o=vt(t,n),s=0;s<n;++s)o[s].apply(i,r)}(i,u,this,n)}return!0},ft.prototype.addListener=function(t,e){return gt(this,t,e,!1)},ft.prototype.on=ft.prototype.addListener,ft.prototype.prependListener=function(t,e){return gt(this,t,e,!0)},ft.prototype.once=function(t,e){if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');return this.on(t,_t(this,t,e)),this},ft.prototype.prependOnceListener=function(t,e){if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');return this.prependListener(t,_t(this,t,e)),this},ft.prototype.removeListener=function(t,e){var i,r,n,o,s;if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');if(!(r=this._events))return this;if(!(i=r[t]))return this;if(i===e||i.listener&&i.listener===e)0==--this._eventsCount?this._events=new pt:(delete r[t],r.removeListener&&this.emit("removeListener",t,i.listener||e));else if("function"!=typeof i){for(n=-1,o=i.length;o-- >0;)if(i[o]===e||i[o].listener&&i[o].listener===e){s=i[o].listener,n=o;break}if(n<0)return this;if(1===i.length){if(i[0]=void 0,0==--this._eventsCount)return this._events=new pt,this;delete r[t]}else!function(t,e){for(var i=e,r=i+1,n=t.length;r<n;i+=1,r+=1)t[i]=t[r];t.pop()}(i,n);r.removeListener&&this.emit("removeListener",t,s||e)}return this},ft.prototype.removeAllListeners=function(t){var e,i;if(!(i=this._events))return this;if(!i.removeListener)return 0===arguments.length?(this._events=new pt,this._eventsCount=0):i[t]&&(0==--this._eventsCount?this._events=new pt:delete i[t]),this;if(0===arguments.length){for(var r,n=Object.keys(i),o=0;o<n.length;++o)"removeListener"!==(r=n[o])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=new pt,this._eventsCount=0,this}if("function"==typeof(e=i[t]))this.removeListener(t,e);else if(e)do{this.removeListener(t,e[e.length-1])}while(e[0]);return this},ft.prototype.listeners=function(t){var e,i=this._events;return i&&(e=i[t])?"function"==typeof e?[e.listener||e]:function(t){for(var e=new Array(t.length),i=0;i<e.length;++i)e[i]=t[i].listener||t[i];return e}(e):[]},ft.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):yt.call(t,e)},ft.prototype.listenerCount=yt,ft.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};var wt=xt,Tt=bt;function Bt(t){if(wt===setTimeout)return setTimeout(t,0);if((wt===xt||!wt)&&setTimeout)return wt=setTimeout,setTimeout(t,0);try{return wt(t,0)}catch(e){try{return wt.call(null,t,0)}catch(e){return wt.call(this,t,0)}}}"function"==typeof p.setTimeout&&(wt=setTimeout),"function"==typeof p.clearTimeout&&(Tt=clearTimeout);var Et,Ct=[],St=!1,It=-1;function Mt(){St&&Et&&(St=!1,Et.length?Ct=Et.concat(Ct):It=-1,Ct.length&&kt())}function kt(){if(!St){var t=Bt(Mt);St=!0;for(var e=Ct.length;e;){for(Et=Ct,Ct=[];++It<e;)Et&&Et[It].run();It=-1,e=Ct.length}Et=null,St=!1,function(t){if(Tt===clearTimeout)return clearTimeout(t);if((Tt===bt||!Tt)&&clearTimeout)return Tt=clearTimeout,clearTimeout(t);try{Tt(t)}catch(e){try{return Tt.call(null,t)}catch(e){return Tt.call(this,t)}}}(t)}}function Pt(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)e[i-1]=arguments[i];Ct.push(new Lt(t,e)),1!==Ct.length||St||Bt(kt)}function Lt(t,e){this.fun=t,this.array=e}function zt(){}Lt.prototype.run=function(){this.fun.apply(null,this.array)};var Ft=zt,Dt=zt,Rt=zt,Ut=zt,Ot=zt,Nt=zt,Qt=zt,Vt=p.performance||{},jt=Vt.now||Vt.mozNow||Vt.msNow||Vt.oNow||Vt.webkitNow||function(){return(new Date).getTime()},Ht=new Date,Gt={nextTick:Pt,title:"browser",browser:!0,env:{},argv:[],version:"",versions:{},on:Ft,addListener:Dt,once:Rt,off:Ut,removeListener:Ot,removeAllListeners:Nt,emit:Qt,binding:function(t){throw new Error("process.binding is not supported")},cwd:function(){return"/"},chdir:function(t){throw new Error("process.chdir is not supported")},umask:function(){return 0},hrtime:function(t){var e=.001*jt.call(Vt),i=Math.floor(e),r=Math.floor(e%1*1e9);return t&&(i-=t[0],(r-=t[1])<0&&(i--,r+=1e9)),[i,r]},platform:"browser",release:{},config:{},uptime:function(){return(new Date-Ht)/1e3}},$t=function(t){return t&&"object"==typeof t&&"function"==typeof t.copy&&"function"==typeof t.fill&&"function"==typeof t.readUInt8},Zt=t.createCommonjsModule((function(t){"function"==typeof Object.create?t.exports=function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(t,e){t.super_=e;var i=function(){};i.prototype=e.prototype,t.prototype=new i,t.prototype.constructor=t}})),qt=t.createCommonjsModule((function(t,e){var i=/%[sdj%]/g;e.format=function(t){if(!m(t)){for(var e=[],r=0;r<arguments.length;r++)e.push(o(arguments[r]));return e.join(" ")}r=1;for(var n=arguments,s=n.length,a=String(t).replace(i,(function(t){if("%%"===t)return"%";if(r>=s)return t;switch(t){case"%s":return String(n[r++]);case"%d":return Number(n[r++]);case"%j":try{return JSON.stringify(n[r++])}catch(t){return"[Circular]"}default:return t}})),l=n[r];r<s;l=n[++r])f(l)||!y(l)?a+=" "+l:a+=" "+o(l);return a},e.deprecate=function(t,i){if(g(p.process))return function(){return e.deprecate(t,i).apply(this,arguments)};var r=!1;return function(){return r||(console.error(i),r=!0),t.apply(this,arguments)}};var r,n={};function o(t,i){var r={seen:[],stylize:a};return arguments.length>=3&&(r.depth=arguments[2]),arguments.length>=4&&(r.colors=arguments[3]),d(i)?r.showHidden=i:i&&e._extend(r,i),g(r.showHidden)&&(r.showHidden=!1),g(r.depth)&&(r.depth=2),g(r.colors)&&(r.colors=!1),g(r.customInspect)&&(r.customInspect=!0),r.colors&&(r.stylize=s),l(r,t,r.depth)}function s(t,e){var i=o.styles[e];return i?"["+o.colors[i][0]+"m"+t+"["+o.colors[i][1]+"m":t}function a(t,e){return t}function l(t,i,r){if(t.customInspect&&i&&b(i.inspect)&&i.inspect!==e.inspect&&(!i.constructor||i.constructor.prototype!==i)){var n=i.inspect(r,t);return m(n)||(n=l(t,n,r)),n}var o=function(t,e){if(g(e))return t.stylize("undefined","undefined");if(m(e)){var i="'"+JSON.stringify(e).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return t.stylize(i,"string")}return A(e)?t.stylize(""+e,"number"):d(e)?t.stylize(""+e,"boolean"):f(e)?t.stylize("null","null"):void 0}(t,i);if(o)return o;var s=Object.keys(i),a=function(t){var e={};return t.forEach((function(t,i){e[t]=!0})),e}(s);if(t.showHidden&&(s=Object.getOwnPropertyNames(i)),x(i)&&(s.indexOf("message")>=0||s.indexOf("description")>=0))return c(i);if(0===s.length){if(b(i)){var p=i.name?": "+i.name:"";return t.stylize("[Function"+p+"]","special")}if(_(i))return t.stylize(RegExp.prototype.toString.call(i),"regexp");if(v(i))return t.stylize(Date.prototype.toString.call(i),"date");if(x(i))return c(i)}var y,w="",T=!1,B=["{","}"];return h(i)&&(T=!0,B=["[","]"]),b(i)&&(w=" [Function"+(i.name?": "+i.name:"")+"]"),_(i)&&(w=" "+RegExp.prototype.toString.call(i)),v(i)&&(w=" "+Date.prototype.toUTCString.call(i)),x(i)&&(w=" "+c(i)),0!==s.length||T&&0!=i.length?r<0?_(i)?t.stylize(RegExp.prototype.toString.call(i),"regexp"):t.stylize("[Object]","special"):(t.seen.push(i),y=T?function(t,e,i,r,n){for(var o=[],s=0,a=e.length;s<a;++s)E(e,String(s))?o.push(u(t,e,i,r,String(s),!0)):o.push("");return n.forEach((function(n){n.match(/^\d+$/)||o.push(u(t,e,i,r,n,!0))})),o}(t,i,r,a,s):s.map((function(e){return u(t,i,r,a,e,T)})),t.seen.pop(),function(t,e,i){return t.reduce((function(t,e){return e.indexOf("\n"),t+e.replace(/\u001b\[\d\d?m/g,"").length+1}),0)>60?i[0]+(""===e?"":e+"\n ")+" "+t.join(",\n  ")+" "+i[1]:i[0]+e+" "+t.join(", ")+" "+i[1]}(y,w,B)):B[0]+w+B[1]}function c(t){return"["+Error.prototype.toString.call(t)+"]"}function u(t,e,i,r,n,o){var s,a,c;if((c=Object.getOwnPropertyDescriptor(e,n)||{value:e[n]}).get?a=c.set?t.stylize("[Getter/Setter]","special"):t.stylize("[Getter]","special"):c.set&&(a=t.stylize("[Setter]","special")),E(r,n)||(s="["+n+"]"),a||(t.seen.indexOf(c.value)<0?(a=f(i)?l(t,c.value,null):l(t,c.value,i-1)).indexOf("\n")>-1&&(a=o?a.split("\n").map((function(t){return"  "+t})).join("\n").substr(2):"\n"+a.split("\n").map((function(t){return"   "+t})).join("\n")):a=t.stylize("[Circular]","special")),g(s)){if(o&&n.match(/^\d+$/))return a;(s=JSON.stringify(""+n)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(s=s.substr(1,s.length-2),s=t.stylize(s,"name")):(s=s.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),s=t.stylize(s,"string"))}return s+": "+a}function h(t){return Array.isArray(t)}function d(t){return"boolean"==typeof t}function f(t){return null===t}function A(t){return"number"==typeof t}function m(t){return"string"==typeof t}function g(t){return void 0===t}function _(t){return y(t)&&"[object RegExp]"===w(t)}function y(t){return"object"==typeof t&&null!==t}function v(t){return y(t)&&"[object Date]"===w(t)}function x(t){return y(t)&&("[object Error]"===w(t)||t instanceof Error)}function b(t){return"function"==typeof t}function w(t){return Object.prototype.toString.call(t)}function T(t){return t<10?"0"+t.toString(10):t.toString(10)}e.debuglog=function(t){if(g(r)&&(r=""),t=t.toUpperCase(),!n[t])if(new RegExp("\\b"+t+"\\b","i").test(r)){var i=Gt.pid;n[t]=function(){var r=e.format.apply(e,arguments);console.error("%s %d: %s",t,i,r)}}else n[t]=function(){};return n[t]},e.inspect=o,o.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},o.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},e.isArray=h,e.isBoolean=d,e.isNull=f,e.isNullOrUndefined=function(t){return null==t},e.isNumber=A,e.isString=m,e.isSymbol=function(t){return"symbol"==typeof t},e.isUndefined=g,e.isRegExp=_,e.isObject=y,e.isDate=v,e.isError=x,e.isFunction=b,e.isPrimitive=function(t){return null===t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||"symbol"==typeof t||void 0===t},e.isBuffer=$t;var B=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function E(t,e){return Object.prototype.hasOwnProperty.call(t,e)}e.log=function(){var t,i;console.log("%s - %s",(i=[T((t=new Date).getHours()),T(t.getMinutes()),T(t.getSeconds())].join(":"),[t.getDate(),B[t.getMonth()],i].join(" ")),e.format.apply(e,arguments))},e.inherits=Zt,e._extend=function(t,e){if(!e||!y(e))return t;for(var i=Object.keys(e),r=i.length;r--;)t[i[r]]=e[i[r]];return t}})),Kt=(qt.format,qt.deprecate),Wt=qt.debuglog,Xt=(qt.inspect,qt.isArray,qt.isBoolean,qt.isNull,qt.isNullOrUndefined,qt.isNumber,qt.isString,qt.isSymbol,qt.isUndefined,qt.isRegExp,qt.isObject,qt.isDate,qt.isError,qt.isFunction,qt.isPrimitive,qt.isBuffer,qt.log,qt.inherits);function Jt(){this.head=null,this.tail=null,this.length=0}qt._extend,Jt.prototype.push=function(t){var e={data:t,next:null};this.length>0?this.tail.next=e:this.head=e,this.tail=e,++this.length},Jt.prototype.unshift=function(t){var e={data:t,next:this.head};0===this.length&&(this.tail=e),this.head=e,++this.length},Jt.prototype.shift=function(){if(0!==this.length){var t=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,t}},Jt.prototype.clear=function(){this.head=this.tail=null,this.length=0},Jt.prototype.join=function(t){if(0===this.length)return"";for(var e=this.head,i=""+e.data;e=e.next;)i+=t+e.data;return i},Jt.prototype.concat=function(t){if(0===this.length)return S.alloc(0);if(1===this.length)return this.head.data;for(var e=S.allocUnsafe(t>>>0),i=this.head,r=0;i;)i.data.copy(e,r),r+=i.data.length,i=i.next;return e};var Yt=t.createCommonjsModule((function(t,e){var i=dt.Buffer;function r(t,e){for(var i in t)e[i]=t[i]}function n(t,e,r){return i(t,e,r)}i.from&&i.alloc&&i.allocUnsafe&&i.allocUnsafeSlow?t.exports=dt:(r(dt,e),e.Buffer=n),r(i,n),n.from=function(t,e,r){if("number"==typeof t)throw new TypeError("Argument must not be a number");return i(t,e,r)},n.alloc=function(t,e,r){if("number"!=typeof t)throw new TypeError("Argument must be a number");var n=i(t);return void 0!==e?"string"==typeof r?n.fill(e,r):n.fill(e):n.fill(0),n},n.allocUnsafe=function(t){if("number"!=typeof t)throw new TypeError("Argument must be a number");return i(t)},n.allocUnsafeSlow=function(t){if("number"!=typeof t)throw new TypeError("Argument must be a number");return dt.SlowBuffer(t)}})),te=(Yt.Buffer,Yt.Buffer),ee=te.isEncoding||function(t){switch((t=""+t)&&t.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}},ie=re;function re(t){var e;switch(this.encoding=function(t){var e=function(t){if(!t)return"utf8";for(var e;;)switch(t){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return t;default:if(e)return;t=(""+t).toLowerCase(),e=!0}}(t);if("string"!=typeof e&&(te.isEncoding===ee||!ee(t)))throw new Error("Unknown encoding: "+t);return e||t}(t),this.encoding){case"utf16le":this.text=se,this.end=ae,e=4;break;case"utf8":this.fillLast=oe,e=4;break;case"base64":this.text=le,this.end=ce,e=3;break;default:return this.write=ue,void(this.end=he)}this.lastNeed=0,this.lastTotal=0,this.lastChar=te.allocUnsafe(e)}function ne(t){return t<=127?0:t>>5==6?2:t>>4==14?3:t>>3==30?4:-1}function oe(t){var e=this.lastTotal-this.lastNeed,i=function(t,e,i){if(128!=(192&e[0]))return t.lastNeed=0,"".repeat(i);if(t.lastNeed>1&&e.length>1){if(128!=(192&e[1]))return t.lastNeed=1,"".repeat(i+1);if(t.lastNeed>2&&e.length>2&&128!=(192&e[2]))return t.lastNeed=2,"".repeat(i+2)}}(this,t,e);return void 0!==i?i:this.lastNeed<=t.length?(t.copy(this.lastChar,e,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(t.copy(this.lastChar,e,0,t.length),void(this.lastNeed-=t.length))}function se(t,e){if((t.length-e)%2==0){var i=t.toString("utf16le",e);if(i){var r=i.charCodeAt(i.length-1);if(r>=55296&&r<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=t[t.length-2],this.lastChar[1]=t[t.length-1],i.slice(0,-1)}return i}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=t[t.length-1],t.toString("utf16le",e,t.length-1)}function ae(t){var e=t&&t.length?this.write(t):"";if(this.lastNeed){var i=this.lastTotal-this.lastNeed;return e+this.lastChar.toString("utf16le",0,i)}return e}function le(t,e){var i=(t.length-e)%3;return 0===i?t.toString("base64",e):(this.lastNeed=3-i,this.lastTotal=3,1===i?this.lastChar[0]=t[t.length-1]:(this.lastChar[0]=t[t.length-2],this.lastChar[1]=t[t.length-1]),t.toString("base64",e,t.length-i))}function ce(t){var e=t&&t.length?this.write(t):"";return this.lastNeed?e+this.lastChar.toString("base64",0,3-this.lastNeed):e}function ue(t){return t.toString(this.encoding)}function he(t){return t&&t.length?this.write(t):""}re.prototype.write=function(t){if(0===t.length)return"";var e,i;if(this.lastNeed){if(void 0===(e=this.fillLast(t)))return"";i=this.lastNeed,this.lastNeed=0}else i=0;return i<t.length?e?e+this.text(t,i):this.text(t,i):e||""},re.prototype.end=function(t){var e=t&&t.length?this.write(t):"";return this.lastNeed?e+"".repeat(this.lastTotal-this.lastNeed):e},re.prototype.text=function(t,e){var i=function(t,e,i){var r=e.length-1;if(r<i)return 0;var n=ne(e[r]);return n>=0?(n>0&&(t.lastNeed=n-1),n):--r<i?0:(n=ne(e[r]))>=0?(n>0&&(t.lastNeed=n-2),n):--r<i?0:(n=ne(e[r]))>=0?(n>0&&(2===n?n=0:t.lastNeed=n-3),n):0}(this,t,e);if(!this.lastNeed)return t.toString("utf8",e);this.lastTotal=i;var r=t.length-(i-this.lastNeed);return t.copy(this.lastChar,0,r),t.toString("utf8",e,r)},re.prototype.fillLast=function(t){if(this.lastNeed<=t.length)return t.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);t.copy(this.lastChar,this.lastTotal-this.lastNeed,0,t.length),this.lastNeed-=t.length},fe.ReadableState=pe;var de=Wt("stream");function pe(t,e){t=t||{},this.objectMode=!!t.objectMode,e instanceof Ve&&(this.objectMode=this.objectMode||!!t.readableObjectMode);var i=t.highWaterMark,r=this.objectMode?16:16384;this.highWaterMark=i||0===i?i:r,this.highWaterMark=~~this.highWaterMark,this.buffer=new Jt,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.defaultEncoding=t.defaultEncoding||"utf8",this.ranOut=!1,this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,t.encoding&&(this.decoder=new ie(t.encoding),this.encoding=t.encoding)}function fe(t){if(!(this instanceof fe))return new fe(t);this._readableState=new pe(t,this),this.readable=!0,t&&"function"==typeof t.read&&(this._read=t.read),ft.call(this)}function Ae(t,e,i,r,n){var o=function(t,e){var i=null;return ut(e)||"string"==typeof e||null==e||t.objectMode||(i=new TypeError("Invalid non-string/buffer chunk")),i}(e,i);if(o)t.emit("error",o);else if(null===i)e.reading=!1,function(t,e){if(!e.ended){if(e.decoder){var i=e.decoder.end();i&&i.length&&(e.buffer.push(i),e.length+=e.objectMode?1:i.length)}e.ended=!0,_e(t)}}(t,e);else if(e.objectMode||i&&i.length>0)if(e.ended&&!n){var s=new Error("stream.push() after EOF");t.emit("error",s)}else if(e.endEmitted&&n){var a=new Error("stream.unshift() after end event");t.emit("error",a)}else{var l;!e.decoder||n||r||(i=e.decoder.write(i),l=!e.objectMode&&0===i.length),n||(e.reading=!1),l||(e.flowing&&0===e.length&&!e.sync?(t.emit("data",i),t.read(0)):(e.length+=e.objectMode?1:i.length,n?e.buffer.unshift(i):e.buffer.push(i),e.needReadable&&_e(t))),function(t,e){e.readingMore||(e.readingMore=!0,Pt(ve,t,e))}(t,e)}else n||(e.reading=!1);return function(t){return!t.ended&&(t.needReadable||t.length<t.highWaterMark||0===t.length)}(e)}Xt(fe,ft),fe.prototype.push=function(t,e){var i=this._readableState;return i.objectMode||"string"!=typeof t||(e=e||i.defaultEncoding)!==i.encoding&&(t=S.from(t,e),e=""),Ae(this,i,t,e,!1)},fe.prototype.unshift=function(t){return Ae(this,this._readableState,t,"",!0)},fe.prototype.isPaused=function(){return!1===this._readableState.flowing},fe.prototype.setEncoding=function(t){return this._readableState.decoder=new ie(t),this._readableState.encoding=t,this};var me=8388608;function ge(t,e){return t<=0||0===e.length&&e.ended?0:e.objectMode?1:t!=t?e.flowing&&e.length?e.buffer.head.data.length:e.length:(t>e.highWaterMark&&(e.highWaterMark=function(t){return t>=me?t=me:(t--,t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,t|=t>>>16,t++),t}(t)),t<=e.length?t:e.ended?e.length:(e.needReadable=!0,0))}function _e(t){var e=t._readableState;e.needReadable=!1,e.emittedReadable||(de("emitReadable",e.flowing),e.emittedReadable=!0,e.sync?Pt(ye,t):ye(t))}function ye(t){de("emit readable"),t.emit("readable"),we(t)}function ve(t,e){for(var i=e.length;!e.reading&&!e.flowing&&!e.ended&&e.length<e.highWaterMark&&(de("maybeReadMore read 0"),t.read(0),i!==e.length);)i=e.length;e.readingMore=!1}function xe(t){de("readable nexttick read 0"),t.read(0)}function be(t,e){e.reading||(de("resume read 0"),t.read(0)),e.resumeScheduled=!1,e.awaitDrain=0,t.emit("resume"),we(t),e.flowing&&!e.reading&&t.read(0)}function we(t){var e=t._readableState;for(de("flow",e.flowing);e.flowing&&null!==t.read(););}function Te(t,e){return 0===e.length?null:(e.objectMode?i=e.buffer.shift():!t||t>=e.length?(i=e.decoder?e.buffer.join(""):1===e.buffer.length?e.buffer.head.data:e.buffer.concat(e.length),e.buffer.clear()):i=function(t,e,i){var r;return t<e.head.data.length?(r=e.head.data.slice(0,t),e.head.data=e.head.data.slice(t)):r=t===e.head.data.length?e.shift():i?function(t,e){var i=e.head,r=1,n=i.data;for(t-=n.length;i=i.next;){var o=i.data,s=t>o.length?o.length:t;if(s===o.length?n+=o:n+=o.slice(0,t),0==(t-=s)){s===o.length?(++r,i.next?e.head=i.next:e.head=e.tail=null):(e.head=i,i.data=o.slice(s));break}++r}return e.length-=r,n}(t,e):function(t,e){var i=S.allocUnsafe(t),r=e.head,n=1;for(r.data.copy(i),t-=r.data.length;r=r.next;){var o=r.data,s=t>o.length?o.length:t;if(o.copy(i,i.length-t,0,s),0==(t-=s)){s===o.length?(++n,r.next?e.head=r.next:e.head=e.tail=null):(e.head=r,r.data=o.slice(s));break}++n}return e.length-=n,i}(t,e),r}(t,e.buffer,e.decoder),i);var i}function Be(t){var e=t._readableState;if(e.length>0)throw new Error('"endReadable()" called on non-empty stream');e.endEmitted||(e.ended=!0,Pt(Ee,e,t))}function Ee(t,e){t.endEmitted||0!==t.length||(t.endEmitted=!0,e.readable=!1,e.emit("end"))}function Ce(t,e){for(var i=0,r=t.length;i<r;i++)if(t[i]===e)return i;return-1}function Se(){}function Ie(t,e,i){this.chunk=t,this.encoding=e,this.callback=i,this.next=null}function Me(t,e){Object.defineProperty(this,"buffer",{get:Kt((function(){return this.getBuffer()}),"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.")}),t=t||{},this.objectMode=!!t.objectMode,e instanceof Ve&&(this.objectMode=this.objectMode||!!t.writableObjectMode);var i=t.highWaterMark,r=this.objectMode?16:16384;this.highWaterMark=i||0===i?i:r,this.highWaterMark=~~this.highWaterMark,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1;var n=!1===t.decodeStrings;this.decodeStrings=!n,this.defaultEncoding=t.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(t){!function(t,e){var i=t._writableState,r=i.sync,n=i.writecb;if(function(t){t.writing=!1,t.writecb=null,t.length-=t.writelen,t.writelen=0}(i),e)!function(t,e,i,r,n){--e.pendingcb,i?Pt(n,r):n(r),t._writableState.errorEmitted=!0,t.emit("error",r)}(t,i,r,e,n);else{var o=Fe(i);o||i.corked||i.bufferProcessing||!i.bufferedRequest||ze(t,i),r?Pt(Le,t,i,o,n):Le(t,i,o,n)}}(e,t)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new Ue(this)}function ke(t){if(!(this instanceof ke||this instanceof Ve))return new ke(t);this._writableState=new Me(t,this),this.writable=!0,t&&("function"==typeof t.write&&(this._write=t.write),"function"==typeof t.writev&&(this._writev=t.writev)),ft.call(this)}function Pe(t,e,i,r,n,o,s){e.writelen=r,e.writecb=s,e.writing=!0,e.sync=!0,i?t._writev(n,e.onwrite):t._write(n,o,e.onwrite),e.sync=!1}function Le(t,e,i,r){i||function(t,e){0===e.length&&e.needDrain&&(e.needDrain=!1,t.emit("drain"))}(t,e),e.pendingcb--,r(),Re(t,e)}function ze(t,e){e.bufferProcessing=!0;var i=e.bufferedRequest;if(t._writev&&i&&i.next){var r=e.bufferedRequestCount,n=new Array(r),o=e.corkedRequestsFree;o.entry=i;for(var s=0;i;)n[s]=i,i=i.next,s+=1;Pe(t,e,!0,e.length,n,"",o.finish),e.pendingcb++,e.lastBufferedRequest=null,o.next?(e.corkedRequestsFree=o.next,o.next=null):e.corkedRequestsFree=new Ue(e)}else{for(;i;){var a=i.chunk,l=i.encoding,c=i.callback;if(Pe(t,e,!1,e.objectMode?1:a.length,a,l,c),i=i.next,e.writing)break}null===i&&(e.lastBufferedRequest=null)}e.bufferedRequestCount=0,e.bufferedRequest=i,e.bufferProcessing=!1}function Fe(t){return t.ending&&0===t.length&&null===t.bufferedRequest&&!t.finished&&!t.writing}function De(t,e){e.prefinished||(e.prefinished=!0,t.emit("prefinish"))}function Re(t,e){var i=Fe(e);return i&&(0===e.pendingcb?(De(t,e),e.finished=!0,t.emit("finish")):De(t,e)),i}function Ue(t){var e=this;this.next=null,this.entry=null,this.finish=function(i){var r=e.entry;for(e.entry=null;r;){var n=r.callback;t.pendingcb--,n(i),r=r.next}t.corkedRequestsFree?t.corkedRequestsFree.next=e:t.corkedRequestsFree=e}}fe.prototype.read=function(t){de("read",t),t=parseInt(t,10);var e=this._readableState,i=t;if(0!==t&&(e.emittedReadable=!1),0===t&&e.needReadable&&(e.length>=e.highWaterMark||e.ended))return de("read: emitReadable",e.length,e.ended),0===e.length&&e.ended?Be(this):_e(this),null;if(0===(t=ge(t,e))&&e.ended)return 0===e.length&&Be(this),null;var r,n=e.needReadable;return de("need readable",n),(0===e.length||e.length-t<e.highWaterMark)&&de("length less than watermark",n=!0),e.ended||e.reading?de("reading or ended",n=!1):n&&(de("do read"),e.reading=!0,e.sync=!0,0===e.length&&(e.needReadable=!0),this._read(e.highWaterMark),e.sync=!1,e.reading||(t=ge(i,e))),null===(r=t>0?Te(t,e):null)?(e.needReadable=!0,t=0):e.length-=t,0===e.length&&(e.ended||(e.needReadable=!0),i!==t&&e.ended&&Be(this)),null!==r&&this.emit("data",r),r},fe.prototype._read=function(t){this.emit("error",new Error("not implemented"))},fe.prototype.pipe=function(t,e){var i=this,r=this._readableState;switch(r.pipesCount){case 0:r.pipes=t;break;case 1:r.pipes=[r.pipes,t];break;default:r.pipes.push(t)}r.pipesCount+=1,de("pipe count=%d opts=%j",r.pipesCount,e);var n=e&&!1===e.end?c:s;function o(t){de("onunpipe"),t===i&&c()}function s(){de("onend"),t.end()}r.endEmitted?Pt(n):i.once("end",n),t.on("unpipe",o);var a=function(t){return function(){var e=t._readableState;de("pipeOnDrain",e.awaitDrain),e.awaitDrain&&e.awaitDrain--,0===e.awaitDrain&&t.listeners("data").length&&(e.flowing=!0,we(t))}}(i);t.on("drain",a);var l=!1;function c(){de("cleanup"),t.removeListener("close",p),t.removeListener("finish",f),t.removeListener("drain",a),t.removeListener("error",d),t.removeListener("unpipe",o),i.removeListener("end",s),i.removeListener("end",c),i.removeListener("data",h),l=!0,!r.awaitDrain||t._writableState&&!t._writableState.needDrain||a()}var u=!1;function h(e){de("ondata"),u=!1,!1!==t.write(e)||u||((1===r.pipesCount&&r.pipes===t||r.pipesCount>1&&-1!==Ce(r.pipes,t))&&!l&&(de("false write response, pause",i._readableState.awaitDrain),i._readableState.awaitDrain++,u=!0),i.pause())}function d(e){var i;de("onerror",e),A(),t.removeListener("error",d),0===(i="error",t.listeners(i).length)&&t.emit("error",e)}function p(){t.removeListener("finish",f),A()}function f(){de("onfinish"),t.removeListener("close",p),A()}function A(){de("unpipe"),i.unpipe(t)}return i.on("data",h),function(t,e,i){if("function"==typeof t.prependListener)return t.prependListener(e,i);t._events&&t._events[e]?Array.isArray(t._events[e])?t._events[e].unshift(i):t._events[e]=[i,t._events[e]]:t.on(e,i)}(t,"error",d),t.once("close",p),t.once("finish",f),t.emit("pipe",i),r.flowing||(de("pipe resume"),i.resume()),t},fe.prototype.unpipe=function(t){var e=this._readableState;if(0===e.pipesCount)return this;if(1===e.pipesCount)return t&&t!==e.pipes||(t||(t=e.pipes),e.pipes=null,e.pipesCount=0,e.flowing=!1,t&&t.emit("unpipe",this)),this;if(!t){var i=e.pipes,r=e.pipesCount;e.pipes=null,e.pipesCount=0,e.flowing=!1;for(var n=0;n<r;n++)i[n].emit("unpipe",this);return this}var o=Ce(e.pipes,t);return-1===o||(e.pipes.splice(o,1),e.pipesCount-=1,1===e.pipesCount&&(e.pipes=e.pipes[0]),t.emit("unpipe",this)),this},fe.prototype.on=function(t,e){var i=ft.prototype.on.call(this,t,e);if("data"===t)!1!==this._readableState.flowing&&this.resume();else if("readable"===t){var r=this._readableState;r.endEmitted||r.readableListening||(r.readableListening=r.needReadable=!0,r.emittedReadable=!1,r.reading?r.length&&_e(this):Pt(xe,this))}return i},fe.prototype.addListener=fe.prototype.on,fe.prototype.resume=function(){var t=this._readableState;return t.flowing||(de("resume"),t.flowing=!0,function(t,e){e.resumeScheduled||(e.resumeScheduled=!0,Pt(be,t,e))}(this,t)),this},fe.prototype.pause=function(){return de("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(de("pause"),this._readableState.flowing=!1,this.emit("pause")),this},fe.prototype.wrap=function(t){var e=this._readableState,i=!1,r=this;for(var n in t.on("end",(function(){if(de("wrapped end"),e.decoder&&!e.ended){var t=e.decoder.end();t&&t.length&&r.push(t)}r.push(null)})),t.on("data",(function(n){de("wrapped data"),e.decoder&&(n=e.decoder.write(n)),e.objectMode&&null==n||(e.objectMode||n&&n.length)&&(r.push(n)||(i=!0,t.pause()))})),t)void 0===this[n]&&"function"==typeof t[n]&&(this[n]=function(e){return function(){return t[e].apply(t,arguments)}}(n));return function(t,e){for(var i=0,r=t.length;i<r;i++)e(t[i],i)}(["error","close","destroy","pause","resume"],(function(e){t.on(e,r.emit.bind(r,e))})),r._read=function(e){de("wrapped _read",e),i&&(i=!1,t.resume())},r},fe._fromList=Te,ke.WritableState=Me,Xt(ke,ft),Me.prototype.getBuffer=function(){for(var t=this.bufferedRequest,e=[];t;)e.push(t),t=t.next;return e},ke.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},ke.prototype.write=function(t,e,i){var r=this._writableState,n=!1;return"function"==typeof e&&(i=e,e=null),S.isBuffer(t)?e="buffer":e||(e=r.defaultEncoding),"function"!=typeof i&&(i=Se),r.ended?function(t,e){var i=new Error("write after end");t.emit("error",i),Pt(e,i)}(this,i):function(t,e,i,r){var n=!0,o=!1;return null===i?o=new TypeError("May not write null values to stream"):S.isBuffer(i)||"string"==typeof i||void 0===i||e.objectMode||(o=new TypeError("Invalid non-string/buffer chunk")),o&&(t.emit("error",o),Pt(r,o),n=!1),n}(this,r,t,i)&&(r.pendingcb++,n=function(t,e,i,r,n){i=function(t,e,i){return t.objectMode||!1===t.decodeStrings||"string"!=typeof e||(e=S.from(e,i)),e}(e,i,r),S.isBuffer(i)&&(r="buffer");var o=e.objectMode?1:i.length;e.length+=o;var s=e.length<e.highWaterMark;if(s||(e.needDrain=!0),e.writing||e.corked){var a=e.lastBufferedRequest;e.lastBufferedRequest=new Ie(i,r,n),a?a.next=e.lastBufferedRequest:e.bufferedRequest=e.lastBufferedRequest,e.bufferedRequestCount+=1}else Pe(t,e,!1,o,i,r,n);return s}(this,r,t,e,i)),n},ke.prototype.cork=function(){this._writableState.corked++},ke.prototype.uncork=function(){var t=this._writableState;t.corked&&(t.corked--,t.writing||t.corked||t.finished||t.bufferProcessing||!t.bufferedRequest||ze(this,t))},ke.prototype.setDefaultEncoding=function(t){if("string"==typeof t&&(t=t.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((t+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+t);return this._writableState.defaultEncoding=t,this},ke.prototype._write=function(t,e,i){i(new Error("not implemented"))},ke.prototype._writev=null,ke.prototype.end=function(t,e,i){var r=this._writableState;"function"==typeof t?(i=t,t=null,e=null):"function"==typeof e&&(i=e,e=null),null!=t&&this.write(t,e),r.corked&&(r.corked=1,this.uncork()),r.ending||r.finished||function(t,e,i){e.ending=!0,Re(t,e),i&&(e.finished?Pt(i):t.once("finish",i)),e.ended=!0,t.writable=!1}(this,r,i)},Xt(Ve,fe);for(var Oe=Object.keys(ke.prototype),Ne=0;Ne<Oe.length;Ne++){var Qe=Oe[Ne];Ve.prototype[Qe]||(Ve.prototype[Qe]=ke.prototype[Qe])}function Ve(t){if(!(this instanceof Ve))return new Ve(t);fe.call(this,t),ke.call(this,t),t&&!1===t.readable&&(this.readable=!1),t&&!1===t.writable&&(this.writable=!1),this.allowHalfOpen=!0,t&&!1===t.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",je)}function je(){this.allowHalfOpen||this._writableState.ended||Pt(He,this)}function He(t){t.end()}function Ge(t){this.afterTransform=function(e,i){return function(t,e,i){var r=t._transformState;r.transforming=!1;var n=r.writecb;if(!n)return t.emit("error",new Error("no writecb in Transform class"));r.writechunk=null,r.writecb=null,null!=i&&t.push(i),n(e);var o=t._readableState;o.reading=!1,(o.needReadable||o.length<o.highWaterMark)&&t._read(o.highWaterMark)}(t,e,i)},this.needTransform=!1,this.transforming=!1,this.writecb=null,this.writechunk=null,this.writeencoding=null}function $e(t){if(!(this instanceof $e))return new $e(t);Ve.call(this,t),this._transformState=new Ge(this);var e=this;this._readableState.needReadable=!0,this._readableState.sync=!1,t&&("function"==typeof t.transform&&(this._transform=t.transform),"function"==typeof t.flush&&(this._flush=t.flush)),this.once("prefinish",(function(){"function"==typeof this._flush?this._flush((function(t){Ze(e,t)})):Ze(e)}))}function Ze(t,e){if(e)return t.emit("error",e);var i=t._writableState,r=t._transformState;if(i.length)throw new Error("Calling transform done when ws.length != 0");if(r.transforming)throw new Error("Calling transform done when still transforming");return t.push(null)}function qe(t){if(!(this instanceof qe))return new qe(t);$e.call(this,t)}function Ke(){ft.call(this)}Xt($e,Ve),$e.prototype.push=function(t,e){return this._transformState.needTransform=!1,Ve.prototype.push.call(this,t,e)},$e.prototype._transform=function(t,e,i){throw new Error("Not implemented")},$e.prototype._write=function(t,e,i){var r=this._transformState;if(r.writecb=i,r.writechunk=t,r.writeencoding=e,!r.transforming){var n=this._readableState;(r.needTransform||n.needReadable||n.length<n.highWaterMark)&&this._read(n.highWaterMark)}},$e.prototype._read=function(t){var e=this._transformState;null!==e.writechunk&&e.writecb&&!e.transforming?(e.transforming=!0,this._transform(e.writechunk,e.writeencoding,e.afterTransform)):e.needTransform=!0},Xt(qe,$e),qe.prototype._transform=function(t,e,i){i(null,t)},Xt(Ke,ft),Ke.Readable=fe,Ke.Writable=ke,Ke.Duplex=Ve,Ke.Transform=$e,Ke.PassThrough=qe,Ke.Stream=Ke,Ke.prototype.pipe=function(t,e){var i=this;function r(e){t.writable&&!1===t.write(e)&&i.pause&&i.pause()}function n(){i.readable&&i.resume&&i.resume()}i.on("data",r),t.on("drain",n),t._isStdio||e&&!1===e.end||(i.on("end",s),i.on("close",a));var o=!1;function s(){o||(o=!0,t.end())}function a(){o||(o=!0,"function"==typeof t.destroy&&t.destroy())}function l(t){if(c(),0===ft.listenerCount(this,"error"))throw t}function c(){i.removeListener("data",r),t.removeListener("drain",n),i.removeListener("end",s),i.removeListener("close",a),i.removeListener("error",l),t.removeListener("error",l),i.removeListener("end",c),i.removeListener("close",c),t.removeListener("close",c)}return i.on("error",l),t.on("error",l),i.on("end",c),i.on("close",c),t.on("close",c),t.emit("pipe",i),t};var We=Ke,Xe=t.createCommonjsModule((function(t,e){if(e.base64=!0,e.array=!0,e.string=!0,e.arraybuffer="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array,e.nodebuffer=!0,e.uint8array="undefined"!=typeof Uint8Array,"undefined"==typeof ArrayBuffer)e.blob=!1;else{var i=new ArrayBuffer(0);try{e.blob=0===new Blob([i],{type:"application/zip"}).size}catch(t){try{var r=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);r.append(i),e.blob=0===r.getBlob("application/zip").size}catch(t){e.blob=!1}}}try{e.nodestream=!!We.Readable}catch(t){e.nodestream=!1}})),Je=(Xe.base64,Xe.array,Xe.string,Xe.arraybuffer,Xe.nodebuffer,Xe.uint8array,Xe.blob,Xe.nodestream,"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="),Ye={encode:function(t){for(var e,i,r,n,o,s,a,l=[],c=0,u=t.length,h=u,d="string"!==or.getTypeOf(t);c<t.length;)h=u-c,d?(e=t[c++],i=c<u?t[c++]:0,r=c<u?t[c++]:0):(e=t.charCodeAt(c++),i=c<u?t.charCodeAt(c++):0,r=c<u?t.charCodeAt(c++):0),n=e>>2,o=(3&e)<<4|i>>4,s=h>1?(15&i)<<2|r>>6:64,a=h>2?63&r:64,l.push(Je.charAt(n)+Je.charAt(o)+Je.charAt(s)+Je.charAt(a));return l.join("")},decode:function(t){var e,i,r,n,o,s,a=0,l=0;if("data:"===t.substr(0,5))throw new Error("Invalid base64 input, it looks like a data url.");var c,u=3*(t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"")).length/4;if(t.charAt(t.length-1)===Je.charAt(64)&&u--,t.charAt(t.length-2)===Je.charAt(64)&&u--,u%1!=0)throw new Error("Invalid base64 input, bad content length.");for(c=Xe.uint8array?new Uint8Array(0|u):new Array(0|u);a<t.length;)e=Je.indexOf(t.charAt(a++))<<2|(n=Je.indexOf(t.charAt(a++)))>>4,i=(15&n)<<4|(o=Je.indexOf(t.charAt(a++)))>>2,r=(3&o)<<6|(s=Je.indexOf(t.charAt(a++))),c[l++]=e,64!==o&&(c[l++]=i),64!==s&&(c[l++]=r);return c}},ti=function(t,e){return new S(t,e)},ei=function(t){return S.alloc?S.alloc(t):new S(t)},ii=function(t){return ut(t)},ri=function(t){return t&&"function"==typeof t.on&&"function"==typeof t.pause&&"function"==typeof t.resume},ni=t.createCommonjsModule((function(t){var e=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=e)})),oi=t.createCommonjsModule((function(t){var e=t.exports={version:"2.3.0"};"number"==typeof __e&&(__e=e)})),si=(oi.version,function(t,e,i){if(function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!")}(t),void 0===e)return t;switch(i){case 1:return function(i){return t.call(e,i)};case 2:return function(i,r){return t.call(e,i,r)};case 3:return function(i,r,n){return t.call(e,i,r,n)}}return function(){return t.apply(e,arguments)}}),ai=function(t){return"object"==typeof t?null!==t:"function"==typeof t},li=function(t){if(!ai(t))throw TypeError(t+" is not an object!");return t},ci=function(t){try{return!!t()}catch(t){return!0}},ui=!ci((function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})),hi=ni.document,di=ai(hi)&&ai(hi.createElement),pi=function(t){return di?hi.createElement(t):{}},fi=!ui&&!ci((function(){return 7!=Object.defineProperty(pi("div"),"a",{get:function(){return 7}}).a})),Ai=Object.defineProperty,mi={f:ui?Object.defineProperty:function(t,e,i){if(li(t),e=function(t,e){if(!ai(t))return t;var i,r;if(e&&"function"==typeof(i=t.toString)&&!ai(r=i.call(t)))return r;if("function"==typeof(i=t.valueOf)&&!ai(r=i.call(t)))return r;if(!e&&"function"==typeof(i=t.toString)&&!ai(r=i.call(t)))return r;throw TypeError("Can't convert object to primitive value")}(e,!0),li(i),fi)try{return Ai(t,e,i)}catch(t){}if("get"in i||"set"in i)throw TypeError("Accessors not supported!");return"value"in i&&(t[e]=i.value),t}},gi=ui?function(t,e,i){return mi.f(t,e,function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}}(1,i))}:function(t,e,i){return t[e]=i,t},_i=function(t,e,i){var r,n,o,s=t&_i.F,a=t&_i.G,l=t&_i.S,c=t&_i.P,u=t&_i.B,h=t&_i.W,d=a?oi:oi[e]||(oi[e]={}),p=d.prototype,f=a?ni:l?ni[e]:(ni[e]||{}).prototype;for(r in a&&(i=e),i)(n=!s&&f&&void 0!==f[r])&&r in d||(o=n?f[r]:i[r],d[r]=a&&"function"!=typeof f[r]?i[r]:u&&n?si(o,ni):h&&f[r]==o?function(t){var e=function(e,i,r){if(this instanceof t){switch(arguments.length){case 0:return new t;case 1:return new t(e);case 2:return new t(e,i)}return new t(e,i,r)}return t.apply(this,arguments)};return e.prototype=t.prototype,e}(o):c&&"function"==typeof o?si(Function.call,o):o,c&&((d.virtual||(d.virtual={}))[r]=o,t&_i.R&&p&&!p[r]&&gi(p,r,o)))};_i.F=1,_i.G=2,_i.S=4,_i.P=8,_i.B=16,_i.W=32,_i.U=64,_i.R=128;var yi,vi,xi,bi,wi=_i,Ti=ni.document&&document.documentElement,Bi={}.toString,Ei=ni.process,Ci=ni.setImmediate,Si=ni.clearImmediate,Ii=ni.MessageChannel,Mi=0,ki={},Pi=function(){var t=+this;if(ki.hasOwnProperty(t)){var e=ki[t];delete ki[t],e()}},Li=function(t){Pi.call(t.data)};Ci&&Si||(Ci=function(t){for(var e=[],i=1;arguments.length>i;)e.push(arguments[i++]);return ki[++Mi]=function(){!function(t,e,i){var r=void 0===i;switch(e.length){case 0:return r?t():t.call(i);case 1:return r?t(e[0]):t.call(i,e[0]);case 2:return r?t(e[0],e[1]):t.call(i,e[0],e[1]);case 3:return r?t(e[0],e[1],e[2]):t.call(i,e[0],e[1],e[2]);case 4:return r?t(e[0],e[1],e[2],e[3]):t.call(i,e[0],e[1],e[2],e[3])}t.apply(i,e)}("function"==typeof t?t:Function(t),e)},yi(Mi),Mi},Si=function(t){delete ki[t]},"process"==(bi=Ei,Bi.call(bi).slice(8,-1))?yi=function(t){Ei.nextTick(si(Pi,t,1))}:Ii?(xi=(vi=new Ii).port2,vi.port1.onmessage=Li,yi=si(xi.postMessage,xi,1)):ni.addEventListener&&"function"==typeof postMessage&&!ni.importScripts?(yi=function(t){ni.postMessage(t+"","*")},ni.addEventListener("message",Li,!1)):yi="onreadystatechange"in pi("script")?function(t){Ti.appendChild(pi("script")).onreadystatechange=function(){Ti.removeChild(this),Pi.call(t)}}:function(t){setTimeout(si(Pi,t,1),0)});var zi={set:Ci,clear:Si};wi(wi.G+wi.B,{setImmediate:zi.set,clearImmediate:zi.clear});var Fi,Di,Ri=oi.setImmediate,Ui=p.MutationObserver||p.WebKitMutationObserver;if(Ui){var Oi=0,Ni=new Ui(Hi),Qi=p.document.createTextNode("");Ni.observe(Qi,{characterData:!0}),Fi=function(){Qi.data=Oi=++Oi%2}}else if(p.setImmediate||void 0===p.MessageChannel)Fi="document"in p&&"onreadystatechange"in p.document.createElement("script")?function(){var t=p.document.createElement("script");t.onreadystatechange=function(){Hi(),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},p.document.documentElement.appendChild(t)}:function(){setTimeout(Hi,0)};else{var Vi=new p.MessageChannel;Vi.port1.onmessage=Hi,Fi=function(){Vi.port2.postMessage(0)}}var ji=[];function Hi(){var t,e;Di=!0;for(var i=ji.length;i;){for(e=ji,ji=[],t=-1;++t<i;)e[t]();i=ji.length}Di=!1}var Gi=function(t){1!==ji.push(t)||Di||Fi()};function $i(){}var Zi={},qi=["REJECTED"],Ki=["FULFILLED"],Wi=["PENDING"],Xi=Ji;function Ji(t){if("function"!=typeof t)throw new TypeError("resolver must be a function");this.state=Wi,this.queue=[],this.outcome=void 0,t!==$i&&ir(this,t)}function Yi(t,e,i){this.promise=t,"function"==typeof e&&(this.onFulfilled=e,this.callFulfilled=this.otherCallFulfilled),"function"==typeof i&&(this.onRejected=i,this.callRejected=this.otherCallRejected)}function tr(t,e,i){Gi((function(){var r;try{r=e(i)}catch(e){return Zi.reject(t,e)}r===t?Zi.reject(t,new TypeError("Cannot resolve promise with itself")):Zi.resolve(t,r)}))}function er(t){var e=t&&t.then;if(t&&("object"==typeof t||"function"==typeof t)&&"function"==typeof e)return function(){e.apply(t,arguments)}}function ir(t,e){var i=!1;function r(e){i||(i=!0,Zi.reject(t,e))}function n(e){i||(i=!0,Zi.resolve(t,e))}var o=rr((function(){e(n,r)}));"error"===o.status&&r(o.value)}function rr(t,e){var i={};try{i.value=t(e),i.status="success"}catch(t){i.status="error",i.value=t}return i}Ji.prototype.catch=function(t){return this.then(null,t)},Ji.prototype.then=function(t,e){if("function"!=typeof t&&this.state===Ki||"function"!=typeof e&&this.state===qi)return this;var i=new this.constructor($i);return this.state!==Wi?tr(i,this.state===Ki?t:e,this.outcome):this.queue.push(new Yi(i,t,e)),i},Yi.prototype.callFulfilled=function(t){Zi.resolve(this.promise,t)},Yi.prototype.otherCallFulfilled=function(t){tr(this.promise,this.onFulfilled,t)},Yi.prototype.callRejected=function(t){Zi.reject(this.promise,t)},Yi.prototype.otherCallRejected=function(t){tr(this.promise,this.onRejected,t)},Zi.resolve=function(t,e){var i=rr(er,e);if("error"===i.status)return Zi.reject(t,i.value);var r=i.value;if(r)ir(t,r);else{t.state=Ki,t.outcome=e;for(var n=-1,o=t.queue.length;++n<o;)t.queue[n].callFulfilled(e)}return t},Zi.reject=function(t,e){t.state=qi,t.outcome=e;for(var i=-1,r=t.queue.length;++i<r;)t.queue[i].callRejected(e);return t},Ji.resolve=function(t){return t instanceof this?t:Zi.resolve(new this($i),t)},Ji.reject=function(t){var e=new this($i);return Zi.reject(e,t)},Ji.all=function(t){var e=this;if("[object Array]"!==Object.prototype.toString.call(t))return this.reject(new TypeError("must be an array"));var i=t.length,r=!1;if(!i)return this.resolve([]);for(var n=new Array(i),o=0,s=-1,a=new this($i);++s<i;)l(t[s],s);return a;function l(t,s){e.resolve(t).then((function(t){n[s]=t,++o!==i||r||(r=!0,Zi.resolve(a,n))}),(function(t){r||(r=!0,Zi.reject(a,t))}))}},Ji.race=function(t){var e=this;if("[object Array]"!==Object.prototype.toString.call(t))return this.reject(new TypeError("must be an array"));var i=t.length,r=!1;if(!i)return this.resolve([]);for(var n,o=-1,s=new this($i);++o<i;)n=t[o],e.resolve(n).then((function(t){r||(r=!0,Zi.resolve(s,t))}),(function(t){r||(r=!0,Zi.reject(s,t))}));return s};var nr={Promise:"undefined"!=typeof Promise?Promise:Xi},or=t.createCommonjsModule((function(t,e){function i(t){return t}function r(t,e){for(var i=0;i<t.length;++i)e[i]=255&t.charCodeAt(i);return e}e.newBlob=function(t,i){e.checkSupport("blob");try{return new Blob([t],{type:i})}catch(e){try{var r=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return r.append(t),r.getBlob(i)}catch(t){throw new Error("Bug : can't construct the Blob.")}}};var n={stringifyByChunk:function(t,e,i){var r=[],n=0,o=t.length;if(o<=i)return String.fromCharCode.apply(null,t);for(;n<o;)"array"===e||"nodebuffer"===e?r.push(String.fromCharCode.apply(null,t.slice(n,Math.min(n+i,o)))):r.push(String.fromCharCode.apply(null,t.subarray(n,Math.min(n+i,o)))),n+=i;return r.join("")},stringifyByChar:function(t){for(var e="",i=0;i<t.length;i++)e+=String.fromCharCode(t[i]);return e},applyCanBeUsed:{uint8array:function(){try{return Xe.uint8array&&1===String.fromCharCode.apply(null,new Uint8Array(1)).length}catch(t){return!1}}(),nodebuffer:function(){try{return Xe.nodebuffer&&1===String.fromCharCode.apply(null,ei(1)).length}catch(t){return!1}}()}};function o(t){var i=65536,r=e.getTypeOf(t),o=!0;if("uint8array"===r?o=n.applyCanBeUsed.uint8array:"nodebuffer"===r&&(o=n.applyCanBeUsed.nodebuffer),o)for(;i>1;)try{return n.stringifyByChunk(t,r,i)}catch(t){i=Math.floor(i/2)}return n.stringifyByChar(t)}function s(t,e){for(var i=0;i<t.length;i++)e[i]=t[i];return e}e.applyFromCharCode=o;var a={};a.string={string:i,array:function(t){return r(t,new Array(t.length))},arraybuffer:function(t){return a.string.uint8array(t).buffer},uint8array:function(t){return r(t,new Uint8Array(t.length))},nodebuffer:function(t){return r(t,ei(t.length))}},a.array={string:o,array:i,arraybuffer:function(t){return new Uint8Array(t).buffer},uint8array:function(t){return new Uint8Array(t)},nodebuffer:function(t){return ti(t)}},a.arraybuffer={string:function(t){return o(new Uint8Array(t))},array:function(t){return s(new Uint8Array(t),new Array(t.byteLength))},arraybuffer:i,uint8array:function(t){return new Uint8Array(t)},nodebuffer:function(t){return ti(new Uint8Array(t))}},a.uint8array={string:o,array:function(t){return s(t,new Array(t.length))},arraybuffer:function(t){return t.buffer},uint8array:i,nodebuffer:function(t){return ti(t)}},a.nodebuffer={string:o,array:function(t){return s(t,new Array(t.length))},arraybuffer:function(t){return a.nodebuffer.uint8array(t).buffer},uint8array:function(t){return s(t,new Uint8Array(t.length))},nodebuffer:i},e.transformTo=function(t,i){if(i||(i=""),!t)return i;e.checkSupport(t);var r=e.getTypeOf(i);return a[r][t](i)},e.getTypeOf=function(t){return"string"==typeof t?"string":"[object Array]"===Object.prototype.toString.call(t)?"array":Xe.nodebuffer&&ii(t)?"nodebuffer":Xe.uint8array&&t instanceof Uint8Array?"uint8array":Xe.arraybuffer&&t instanceof ArrayBuffer?"arraybuffer":void 0},e.checkSupport=function(t){if(!Xe[t.toLowerCase()])throw new Error(t+" is not supported by this platform")},e.MAX_VALUE_16BITS=65535,e.MAX_VALUE_32BITS=-1,e.pretty=function(t){var e,i,r="";for(i=0;i<(t||"").length;i++)r+="\\x"+((e=t.charCodeAt(i))<16?"0":"")+e.toString(16).toUpperCase();return r},e.delay=function(t,e,i){Ri((function(){t.apply(i||null,e||[])}))},e.inherits=function(t,e){var i=function(){};i.prototype=e.prototype,t.prototype=new i},e.extend=function(){var t,e,i={};for(t=0;t<arguments.length;t++)for(e in arguments[t])arguments[t].hasOwnProperty(e)&&void 0===i[e]&&(i[e]=arguments[t][e]);return i},e.prepareContent=function(t,i,n,o,s){return nr.Promise.resolve(i).then((function(t){return Xe.blob&&(t instanceof Blob||-1!==["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(t)))&&"undefined"!=typeof FileReader?new nr.Promise((function(e,i){var r=new FileReader;r.onload=function(t){e(t.target.result)},r.onerror=function(t){i(t.target.error)},r.readAsArrayBuffer(t)})):t})).then((function(i){var a,l=e.getTypeOf(i);return l?("arraybuffer"===l?i=e.transformTo("uint8array",i):"string"===l&&(s?i=Ye.decode(i):n&&!0!==o&&(i=r(a=i,Xe.uint8array?new Uint8Array(a.length):new Array(a.length)))),i):nr.Promise.reject(new Error("Can't read the data of '"+t+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))}))}}));function sr(t){this.name=t||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}or.newBlob,or.applyFromCharCode,or.transformTo,or.getTypeOf,or.checkSupport,or.MAX_VALUE_16BITS,or.MAX_VALUE_32BITS,or.pretty,or.delay,or.inherits,or.extend,or.prepareContent,sr.prototype={push:function(t){this.emit("data",t)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(t){this.emit("error",t)}return!0},error:function(t){return!this.isFinished&&(this.isPaused?this.generatedError=t:(this.isFinished=!0,this.emit("error",t),this.previous&&this.previous.error(t),this.cleanUp()),!0)},on:function(t,e){return this._listeners[t].push(e),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(t,e){if(this._listeners[t])for(var i=0;i<this._listeners[t].length;i++)this._listeners[t][i].call(this,e)},pipe:function(t){return t.registerPrevious(this)},registerPrevious:function(t){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=t.streamInfo,this.mergeStreamInfo(),this.previous=t;var e=this;return t.on("data",(function(t){e.processChunk(t)})),t.on("end",(function(){e.end()})),t.on("error",(function(t){e.error(t)})),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;this.isPaused=!1;var t=!1;return this.generatedError&&(this.error(this.generatedError),t=!0),this.previous&&this.previous.resume(),!t},flush:function(){},processChunk:function(t){this.push(t)},withStreamInfo:function(t,e){return this.extraStreamInfo[t]=e,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var t in this.extraStreamInfo)this.extraStreamInfo.hasOwnProperty(t)&&(this.streamInfo[t]=this.extraStreamInfo[t])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var t="Worker "+this.name;return this.previous?this.previous+" -> "+t:t}};var ar=sr,lr=t.createCommonjsModule((function(t,e){for(var i=new Array(256),r=0;r<256;r++)i[r]=r>=252?6:r>=248?5:r>=240?4:r>=224?3:r>=192?2:1;function n(){ar.call(this,"utf-8 decode"),this.leftOver=null}function o(){ar.call(this,"utf-8 encode")}i[254]=i[254]=1,e.utf8encode=function(t){return Xe.nodebuffer?ti(t,"utf-8"):function(t){var e,i,r,n,o,s=t.length,a=0;for(n=0;n<s;n++)55296==(64512&(i=t.charCodeAt(n)))&&n+1<s&&56320==(64512&(r=t.charCodeAt(n+1)))&&(i=65536+(i-55296<<10)+(r-56320),n++),a+=i<128?1:i<2048?2:i<65536?3:4;for(e=Xe.uint8array?new Uint8Array(a):new Array(a),o=0,n=0;o<a;n++)55296==(64512&(i=t.charCodeAt(n)))&&n+1<s&&56320==(64512&(r=t.charCodeAt(n+1)))&&(i=65536+(i-55296<<10)+(r-56320),n++),i<128?e[o++]=i:i<2048?(e[o++]=192|i>>>6,e[o++]=128|63&i):i<65536?(e[o++]=224|i>>>12,e[o++]=128|i>>>6&63,e[o++]=128|63&i):(e[o++]=240|i>>>18,e[o++]=128|i>>>12&63,e[o++]=128|i>>>6&63,e[o++]=128|63&i);return e}(t)},e.utf8decode=function(t){return Xe.nodebuffer?or.transformTo("nodebuffer",t).toString("utf-8"):function(t){var e,r,n,o,s=t.length,a=new Array(2*s);for(r=0,e=0;e<s;)if((n=t[e++])<128)a[r++]=n;else if((o=i[n])>4)a[r++]=65533,e+=o-1;else{for(n&=2===o?31:3===o?15:7;o>1&&e<s;)n=n<<6|63&t[e++],o--;o>1?a[r++]=65533:n<65536?a[r++]=n:(n-=65536,a[r++]=55296|n>>10&1023,a[r++]=56320|1023&n)}return a.length!==r&&(a.subarray?a=a.subarray(0,r):a.length=r),or.applyFromCharCode(a)}(t=or.transformTo(Xe.uint8array?"uint8array":"array",t))},or.inherits(n,ar),n.prototype.processChunk=function(t){var r=or.transformTo(Xe.uint8array?"uint8array":"array",t.data);if(this.leftOver&&this.leftOver.length){if(Xe.uint8array){var n=r;(r=new Uint8Array(n.length+this.leftOver.length)).set(this.leftOver,0),r.set(n,this.leftOver.length)}else r=this.leftOver.concat(r);this.leftOver=null}var o=function(t,e){var r;for((e=e||t.length)>t.length&&(e=t.length),r=e-1;r>=0&&128==(192&t[r]);)r--;return r<0||0===r?e:r+i[t[r]]>e?r:e}(r),s=r;o!==r.length&&(Xe.uint8array?(s=r.subarray(0,o),this.leftOver=r.subarray(o,r.length)):(s=r.slice(0,o),this.leftOver=r.slice(o,r.length))),this.push({data:e.utf8decode(s),meta:t.meta})},n.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:e.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},e.Utf8DecodeWorker=n,or.inherits(o,ar),o.prototype.processChunk=function(t){this.push({data:e.utf8encode(t.data),meta:t.meta})},e.Utf8EncodeWorker=o}));function cr(t){ar.call(this,"ConvertWorker to "+t),this.destType=t}lr.utf8encode,lr.utf8decode,lr.Utf8DecodeWorker,lr.Utf8EncodeWorker,or.inherits(cr,ar),cr.prototype.processChunk=function(t){this.push({data:or.transformTo(this.destType,t.data),meta:t.meta})};var ur=cr,hr=We.Readable;function dr(t,e,i){hr.call(this,e),this._helper=t;var r=this;t.on("data",(function(t,e){r.push(t)||r._helper.pause(),i&&i(e)})).on("error",(function(t){r.emit("error",t)})).on("end",(function(){r.push(null)}))}or.inherits(dr,hr),dr.prototype._read=function(){this._helper.resume()};var pr=dr,fr=null;if(Xe.nodestream)try{fr=pr}catch(t){}function Ar(t,e){return new nr.Promise((function(i,r){var n=[],o=t._internalType,s=t._outputType,a=t._mimeType;t.on("data",(function(t,i){n.push(t),e&&e(i)})).on("error",(function(t){n=[],r(t)})).on("end",(function(){try{var t=function(t,e,i){switch(t){case"blob":return or.newBlob(or.transformTo("arraybuffer",e),i);case"base64":return Ye.encode(e);default:return or.transformTo(t,e)}}(s,function(t,e){var i,r=0,n=null,o=0;for(i=0;i<e.length;i++)o+=e[i].length;switch(t){case"string":return e.join("");case"array":return Array.prototype.concat.apply([],e);case"uint8array":for(n=new Uint8Array(o),i=0;i<e.length;i++)n.set(e[i],r),r+=e[i].length;return n;case"nodebuffer":return S.concat(e);default:throw new Error("concat : unsupported type '"+t+"'")}}(o,n),a);i(t)}catch(t){r(t)}n=[]})).resume()}))}function mr(t,e,i){var r=e;switch(e){case"blob":case"arraybuffer":r="uint8array";break;case"base64":r="string"}try{this._internalType=r,this._outputType=e,this._mimeType=i,or.checkSupport(r),this._worker=t.pipe(new ur(r)),t.lock()}catch(t){this._worker=new ar("error"),this._worker.error(t)}}mr.prototype={accumulate:function(t){return Ar(this,t)},on:function(t,e){var i=this;return"data"===t?this._worker.on(t,(function(t){e.call(i,t.data,t.meta)})):this._worker.on(t,(function(){or.delay(e,arguments,i)})),this},resume:function(){return or.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(t){if(or.checkSupport("nodestream"),"nodebuffer"!==this._outputType)throw new Error(this._outputType+" is not supported by this method");return new fr(this,{objectMode:"nodebuffer"!==this._outputType},t)}};var gr=mr,_r={base64:!1,binary:!1,dir:!1,createFolders:!0,date:null,compression:null,compressionOptions:null,comment:null,unixPermissions:null,dosPermissions:null};function yr(t){ar.call(this,"DataWorker");var e=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,t.then((function(t){e.dataIsReady=!0,e.data=t,e.max=t&&t.length||0,e.type=or.getTypeOf(t),e.isPaused||e._tickAndRepeat()}),(function(t){e.error(t)}))}or.inherits(yr,ar),yr.prototype.cleanUp=function(){ar.prototype.cleanUp.call(this),this.data=null},yr.prototype.resume=function(){return!!ar.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,or.delay(this._tickAndRepeat,[],this)),!0)},yr.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(or.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},yr.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var t=null,e=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":t=this.data.substring(this.index,e);break;case"uint8array":t=this.data.subarray(this.index,e);break;case"array":case"nodebuffer":t=this.data.slice(this.index,e)}return this.index=e,this.push({data:t,meta:{percent:this.max?this.index/this.max*100:0}})};var vr=yr;function xr(t){ar.call(this,"DataLengthProbe for "+t),this.propName=t,this.withStreamInfo(t,0)}or.inherits(xr,ar),xr.prototype.processChunk=function(t){if(t){var e=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=e+t.data.length}ar.prototype.processChunk.call(this,t)};var br=xr,wr=function(){for(var t,e=[],i=0;i<256;i++){t=i;for(var r=0;r<8;r++)t=1&t?3988292384^t>>>1:t>>>1;e[i]=t}return e}(),Tr=function(t,e){return void 0!==t&&t.length?"string"!==or.getTypeOf(t)?function(t,e,i,r){var n=wr,o=r+i;t^=-1;for(var s=r;s<o;s++)t=t>>>8^n[255&(t^e[s])];return-1^t}(0|e,t,t.length,0):function(t,e,i,r){var n=wr,o=r+i;t^=-1;for(var s=r;s<o;s++)t=t>>>8^n[255&(t^e.charCodeAt(s))];return-1^t}(0|e,t,t.length,0):0};function Br(){ar.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}or.inherits(Br,ar),Br.prototype.processChunk=function(t){this.streamInfo.crc32=Tr(t.data,this.streamInfo.crc32||0),this.push(t)};var Er=Br;function Cr(t,e,i,r,n){this.compressedSize=t,this.uncompressedSize=e,this.crc32=i,this.compression=r,this.compressedContent=n}Cr.prototype={getContentWorker:function(){var t=new vr(nr.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new br("data_length")),e=this;return t.on("end",(function(){if(this.streamInfo.data_length!==e.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")})),t},getCompressedWorker:function(){return new vr(nr.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},Cr.createWorkerFrom=function(t,e,i){return t.pipe(new Er).pipe(new br("uncompressedSize")).pipe(e.compressWorker(i)).pipe(new br("compressedSize")).withStreamInfo("compression",e)};var Sr=Cr,Ir=function(t,e,i){this.name=t,this.dir=i.dir,this.date=i.date,this.comment=i.comment,this.unixPermissions=i.unixPermissions,this.dosPermissions=i.dosPermissions,this._data=e,this._dataBinary=i.binary,this.options={compression:i.compression,compressionOptions:i.compressionOptions}};Ir.prototype={internalStream:function(t){var e=null,i="string";try{if(!t)throw new Error("No output type specified.");var r="string"===(i=t.toLowerCase())||"text"===i;"binarystring"!==i&&"text"!==i||(i="string"),e=this._decompressWorker();var n=!this._dataBinary;n&&!r&&(e=e.pipe(new lr.Utf8EncodeWorker)),!n&&r&&(e=e.pipe(new lr.Utf8DecodeWorker))}catch(t){(e=new ar("error")).error(t)}return new gr(e,i,"")},async:function(t,e){return this.internalStream(t).accumulate(e)},nodeStream:function(t,e){return this.internalStream(t||"nodebuffer").toNodejsStream(e)},_compressWorker:function(t,e){if(this._data instanceof Sr&&this._data.compression.magic===t.magic)return this._data.getCompressedWorker();var i=this._decompressWorker();return this._dataBinary||(i=i.pipe(new lr.Utf8EncodeWorker)),Sr.createWorkerFrom(i,t,e)},_decompressWorker:function(){return this._data instanceof Sr?this._data.getContentWorker():this._data instanceof ar?this._data:new vr(this._data)}};for(var Mr=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],kr=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},Pr=0;Pr<Mr.length;Pr++)Ir.prototype[Mr[Pr]]=kr;var Lr=Ir,zr=t.createCommonjsModule((function(t,e){var i="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;function r(t,e){return Object.prototype.hasOwnProperty.call(t,e)}e.assign=function(t){for(var e=Array.prototype.slice.call(arguments,1);e.length;){var i=e.shift();if(i){if("object"!=typeof i)throw new TypeError(i+"must be non-object");for(var n in i)r(i,n)&&(t[n]=i[n])}}return t},e.shrinkBuf=function(t,e){return t.length===e?t:t.subarray?t.subarray(0,e):(t.length=e,t)};var n={arraySet:function(t,e,i,r,n){if(e.subarray&&t.subarray)t.set(e.subarray(i,i+r),n);else for(var o=0;o<r;o++)t[n+o]=e[i+o]},flattenChunks:function(t){var e,i,r,n,o,s;for(r=0,e=0,i=t.length;e<i;e++)r+=t[e].length;for(s=new Uint8Array(r),n=0,e=0,i=t.length;e<i;e++)o=t[e],s.set(o,n),n+=o.length;return s}},o={arraySet:function(t,e,i,r,n){for(var o=0;o<r;o++)t[n+o]=e[i+o]},flattenChunks:function(t){return[].concat.apply([],t)}};e.setTyped=function(t){t?(e.Buf8=Uint8Array,e.Buf16=Uint16Array,e.Buf32=Int32Array,e.assign(e,n)):(e.Buf8=Array,e.Buf16=Array,e.Buf32=Array,e.assign(e,o))},e.setTyped(i)})),Fr=(zr.assign,zr.shrinkBuf,zr.setTyped,zr.Buf8,zr.Buf16,zr.Buf32,4),Dr=0,Rr=1,Ur=2;function Or(t){for(var e=t.length;--e>=0;)t[e]=0}var Nr=0,Qr=1,Vr=2,jr=29,Hr=256,Gr=Hr+1+jr,$r=30,Zr=19,qr=2*Gr+1,Kr=15,Wr=16,Xr=7,Jr=256,Yr=16,tn=17,en=18,rn=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],nn=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],on=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],sn=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],an=new Array(2*(Gr+2));Or(an);var ln=new Array(2*$r);Or(ln);var cn=new Array(512);Or(cn);var un=new Array(256);Or(un);var hn=new Array(jr);Or(hn);var dn,pn,fn,An=new Array($r);function mn(t,e,i,r,n){this.static_tree=t,this.extra_bits=e,this.extra_base=i,this.elems=r,this.max_length=n,this.has_stree=t&&t.length}function gn(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}function _n(t){return t<256?cn[t]:cn[256+(t>>>7)]}function yn(t,e){t.pending_buf[t.pending++]=255&e,t.pending_buf[t.pending++]=e>>>8&255}function vn(t,e,i){t.bi_valid>Wr-i?(t.bi_buf|=e<<t.bi_valid&65535,yn(t,t.bi_buf),t.bi_buf=e>>Wr-t.bi_valid,t.bi_valid+=i-Wr):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=i)}function xn(t,e,i){vn(t,i[2*e],i[2*e+1])}function bn(t,e){var i=0;do{i|=1&t,t>>>=1,i<<=1}while(--e>0);return i>>>1}function wn(t,e,i){var r,n,o=new Array(Kr+1),s=0;for(r=1;r<=Kr;r++)o[r]=s=s+i[r-1]<<1;for(n=0;n<=e;n++){var a=t[2*n+1];0!==a&&(t[2*n]=bn(o[a]++,a))}}function Tn(t){var e;for(e=0;e<Gr;e++)t.dyn_ltree[2*e]=0;for(e=0;e<$r;e++)t.dyn_dtree[2*e]=0;for(e=0;e<Zr;e++)t.bl_tree[2*e]=0;t.dyn_ltree[2*Jr]=1,t.opt_len=t.static_len=0,t.last_lit=t.matches=0}function Bn(t){t.bi_valid>8?yn(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0}function En(t,e,i,r){var n=2*e,o=2*i;return t[n]<t[o]||t[n]===t[o]&&r[e]<=r[i]}function Cn(t,e,i){for(var r=t.heap[i],n=i<<1;n<=t.heap_len&&(n<t.heap_len&&En(e,t.heap[n+1],t.heap[n],t.depth)&&n++,!En(e,r,t.heap[n],t.depth));)t.heap[i]=t.heap[n],i=n,n<<=1;t.heap[i]=r}function Sn(t,e,i){var r,n,o,s,a=0;if(0!==t.last_lit)do{r=t.pending_buf[t.d_buf+2*a]<<8|t.pending_buf[t.d_buf+2*a+1],n=t.pending_buf[t.l_buf+a],a++,0===r?xn(t,n,e):(xn(t,(o=un[n])+Hr+1,e),0!==(s=rn[o])&&vn(t,n-=hn[o],s),xn(t,o=_n(--r),i),0!==(s=nn[o])&&vn(t,r-=An[o],s))}while(a<t.last_lit);xn(t,Jr,e)}function In(t,e){var i,r,n,o=e.dyn_tree,s=e.stat_desc.static_tree,a=e.stat_desc.has_stree,l=e.stat_desc.elems,c=-1;for(t.heap_len=0,t.heap_max=qr,i=0;i<l;i++)0!==o[2*i]?(t.heap[++t.heap_len]=c=i,t.depth[i]=0):o[2*i+1]=0;for(;t.heap_len<2;)o[2*(n=t.heap[++t.heap_len]=c<2?++c:0)]=1,t.depth[n]=0,t.opt_len--,a&&(t.static_len-=s[2*n+1]);for(e.max_code=c,i=t.heap_len>>1;i>=1;i--)Cn(t,o,i);n=l;do{i=t.heap[1],t.heap[1]=t.heap[t.heap_len--],Cn(t,o,1),r=t.heap[1],t.heap[--t.heap_max]=i,t.heap[--t.heap_max]=r,o[2*n]=o[2*i]+o[2*r],t.depth[n]=(t.depth[i]>=t.depth[r]?t.depth[i]:t.depth[r])+1,o[2*i+1]=o[2*r+1]=n,t.heap[1]=n++,Cn(t,o,1)}while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],function(t,e){var i,r,n,o,s,a,l=e.dyn_tree,c=e.max_code,u=e.stat_desc.static_tree,h=e.stat_desc.has_stree,d=e.stat_desc.extra_bits,p=e.stat_desc.extra_base,f=e.stat_desc.max_length,A=0;for(o=0;o<=Kr;o++)t.bl_count[o]=0;for(l[2*t.heap[t.heap_max]+1]=0,i=t.heap_max+1;i<qr;i++)(o=l[2*l[2*(r=t.heap[i])+1]+1]+1)>f&&(o=f,A++),l[2*r+1]=o,r>c||(t.bl_count[o]++,s=0,r>=p&&(s=d[r-p]),a=l[2*r],t.opt_len+=a*(o+s),h&&(t.static_len+=a*(u[2*r+1]+s)));if(0!==A){do{for(o=f-1;0===t.bl_count[o];)o--;t.bl_count[o]--,t.bl_count[o+1]+=2,t.bl_count[f]--,A-=2}while(A>0);for(o=f;0!==o;o--)for(r=t.bl_count[o];0!==r;)(n=t.heap[--i])>c||(l[2*n+1]!==o&&(t.opt_len+=(o-l[2*n+1])*l[2*n],l[2*n+1]=o),r--)}}(t,e),wn(o,c,t.bl_count)}function Mn(t,e,i){var r,n,o=-1,s=e[1],a=0,l=7,c=4;for(0===s&&(l=138,c=3),e[2*(i+1)+1]=65535,r=0;r<=i;r++)n=s,s=e[2*(r+1)+1],++a<l&&n===s||(a<c?t.bl_tree[2*n]+=a:0!==n?(n!==o&&t.bl_tree[2*n]++,t.bl_tree[2*Yr]++):a<=10?t.bl_tree[2*tn]++:t.bl_tree[2*en]++,a=0,o=n,0===s?(l=138,c=3):n===s?(l=6,c=3):(l=7,c=4))}function kn(t,e,i){var r,n,o=-1,s=e[1],a=0,l=7,c=4;for(0===s&&(l=138,c=3),r=0;r<=i;r++)if(n=s,s=e[2*(r+1)+1],!(++a<l&&n===s)){if(a<c)do{xn(t,n,t.bl_tree)}while(0!=--a);else 0!==n?(n!==o&&(xn(t,n,t.bl_tree),a--),xn(t,Yr,t.bl_tree),vn(t,a-3,2)):a<=10?(xn(t,tn,t.bl_tree),vn(t,a-3,3)):(xn(t,en,t.bl_tree),vn(t,a-11,7));a=0,o=n,0===s?(l=138,c=3):n===s?(l=6,c=3):(l=7,c=4)}}Or(An);var Pn=!1;function Ln(t,e,i,r){vn(t,(Nr<<1)+(r?1:0),3),function(t,e,i,r){Bn(t),r&&(yn(t,i),yn(t,~i)),zr.arraySet(t.pending_buf,t.window,e,i,t.pending),t.pending+=i}(t,e,i,!0)}var zn,Fn={_tr_init:function(t){Pn||(function(){var t,e,i,r,n,o=new Array(Kr+1);for(i=0,r=0;r<jr-1;r++)for(hn[r]=i,t=0;t<1<<rn[r];t++)un[i++]=r;for(un[i-1]=r,n=0,r=0;r<16;r++)for(An[r]=n,t=0;t<1<<nn[r];t++)cn[n++]=r;for(n>>=7;r<$r;r++)for(An[r]=n<<7,t=0;t<1<<nn[r]-7;t++)cn[256+n++]=r;for(e=0;e<=Kr;e++)o[e]=0;for(t=0;t<=143;)an[2*t+1]=8,t++,o[8]++;for(;t<=255;)an[2*t+1]=9,t++,o[9]++;for(;t<=279;)an[2*t+1]=7,t++,o[7]++;for(;t<=287;)an[2*t+1]=8,t++,o[8]++;for(wn(an,Gr+1,o),t=0;t<$r;t++)ln[2*t+1]=5,ln[2*t]=bn(t,5);dn=new mn(an,rn,Hr+1,Gr,Kr),pn=new mn(ln,nn,0,$r,Kr),fn=new mn(new Array(0),on,0,Zr,Xr)}(),Pn=!0),t.l_desc=new gn(t.dyn_ltree,dn),t.d_desc=new gn(t.dyn_dtree,pn),t.bl_desc=new gn(t.bl_tree,fn),t.bi_buf=0,t.bi_valid=0,Tn(t)},_tr_stored_block:Ln,_tr_flush_block:function(t,e,i,r){var n,o,s=0;t.level>0?(t.strm.data_type===Ur&&(t.strm.data_type=function(t){var e,i=4093624447;for(e=0;e<=31;e++,i>>>=1)if(1&i&&0!==t.dyn_ltree[2*e])return Dr;if(0!==t.dyn_ltree[18]||0!==t.dyn_ltree[20]||0!==t.dyn_ltree[26])return Rr;for(e=32;e<Hr;e++)if(0!==t.dyn_ltree[2*e])return Rr;return Dr}(t)),In(t,t.l_desc),In(t,t.d_desc),s=function(t){var e;for(Mn(t,t.dyn_ltree,t.l_desc.max_code),Mn(t,t.dyn_dtree,t.d_desc.max_code),In(t,t.bl_desc),e=Zr-1;e>=3&&0===t.bl_tree[2*sn[e]+1];e--);return t.opt_len+=3*(e+1)+5+5+4,e}(t),n=t.opt_len+3+7>>>3,(o=t.static_len+3+7>>>3)<=n&&(n=o)):n=o=i+5,i+4<=n&&-1!==e?Ln(t,e,i,r):t.strategy===Fr||o===n?(vn(t,(Qr<<1)+(r?1:0),3),Sn(t,an,ln)):(vn(t,(Vr<<1)+(r?1:0),3),function(t,e,i,r){var n;for(vn(t,e-257,5),vn(t,i-1,5),vn(t,r-4,4),n=0;n<r;n++)vn(t,t.bl_tree[2*sn[n]+1],3);kn(t,t.dyn_ltree,e-1),kn(t,t.dyn_dtree,i-1)}(t,t.l_desc.max_code+1,t.d_desc.max_code+1,s+1),Sn(t,t.dyn_ltree,t.dyn_dtree)),Tn(t),r&&Bn(t)},_tr_tally:function(t,e,i){return t.pending_buf[t.d_buf+2*t.last_lit]=e>>>8&255,t.pending_buf[t.d_buf+2*t.last_lit+1]=255&e,t.pending_buf[t.l_buf+t.last_lit]=255&i,t.last_lit++,0===e?t.dyn_ltree[2*i]++:(t.matches++,e--,t.dyn_ltree[2*(un[i]+Hr+1)]++,t.dyn_dtree[2*_n(e)]++),t.last_lit===t.lit_bufsize-1},_tr_align:function(t){vn(t,Qr<<1,3),xn(t,Jr,an),function(t){16===t.bi_valid?(yn(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)}(t)}},Dn=function(t,e,i,r){for(var n=65535&t|0,o=t>>>16&65535|0,s=0;0!==i;){i-=s=i>2e3?2e3:i;do{o=o+(n=n+e[r++]|0)|0}while(--s);n%=65521,o%=65521}return n|o<<16|0},Rn=function(){for(var t,e=[],i=0;i<256;i++){t=i;for(var r=0;r<8;r++)t=1&t?3988292384^t>>>1:t>>>1;e[i]=t}return e}(),Un=function(t,e,i,r){var n=Rn,o=r+i;t^=-1;for(var s=r;s<o;s++)t=t>>>8^n[255&(t^e[s])];return-1^t},On={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},Nn=0,Qn=1,Vn=3,jn=4,Hn=5,Gn=0,$n=1,Zn=-2,qn=-3,Kn=-5,Wn=-1,Xn=1,Jn=2,Yn=3,to=4,eo=0,io=2,ro=8,no=9,oo=15,so=8,ao=286,lo=30,co=19,uo=2*ao+1,ho=15,po=3,fo=258,Ao=fo+po+1,mo=32,go=42,_o=69,yo=73,vo=91,xo=103,bo=113,wo=666,To=1,Bo=2,Eo=3,Co=4,So=3;function Io(t,e){return t.msg=On[e],e}function Mo(t){return(t<<1)-(t>4?9:0)}function ko(t){for(var e=t.length;--e>=0;)t[e]=0}function Po(t){var e=t.state,i=e.pending;i>t.avail_out&&(i=t.avail_out),0!==i&&(zr.arraySet(t.output,e.pending_buf,e.pending_out,i,t.next_out),t.next_out+=i,e.pending_out+=i,t.total_out+=i,t.avail_out-=i,e.pending-=i,0===e.pending&&(e.pending_out=0))}function Lo(t,e){Fn._tr_flush_block(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,Po(t.strm)}function zo(t,e){t.pending_buf[t.pending++]=e}function Fo(t,e){t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=255&e}function Do(t,e){var i,r,n=t.max_chain_length,o=t.strstart,s=t.prev_length,a=t.nice_match,l=t.strstart>t.w_size-Ao?t.strstart-(t.w_size-Ao):0,c=t.window,u=t.w_mask,h=t.prev,d=t.strstart+fo,p=c[o+s-1],f=c[o+s];t.prev_length>=t.good_match&&(n>>=2),a>t.lookahead&&(a=t.lookahead);do{if(c[(i=e)+s]===f&&c[i+s-1]===p&&c[i]===c[o]&&c[++i]===c[o+1]){o+=2,i++;do{}while(c[++o]===c[++i]&&c[++o]===c[++i]&&c[++o]===c[++i]&&c[++o]===c[++i]&&c[++o]===c[++i]&&c[++o]===c[++i]&&c[++o]===c[++i]&&c[++o]===c[++i]&&o<d);if(r=fo-(d-o),o=d-fo,r>s){if(t.match_start=e,s=r,r>=a)break;p=c[o+s-1],f=c[o+s]}}}while((e=h[e&u])>l&&0!=--n);return s<=t.lookahead?s:t.lookahead}function Ro(t){var e,i,r,n,o,s,a,l,c,u,h=t.w_size;do{if(n=t.window_size-t.lookahead-t.strstart,t.strstart>=h+(h-Ao)){zr.arraySet(t.window,t.window,h,h,0),t.match_start-=h,t.strstart-=h,t.block_start-=h,e=i=t.hash_size;do{r=t.head[--e],t.head[e]=r>=h?r-h:0}while(--i);e=i=h;do{r=t.prev[--e],t.prev[e]=r>=h?r-h:0}while(--i);n+=h}if(0===t.strm.avail_in)break;if(s=t.strm,a=t.window,l=t.strstart+t.lookahead,c=n,u=void 0,(u=s.avail_in)>c&&(u=c),i=0===u?0:(s.avail_in-=u,zr.arraySet(a,s.input,s.next_in,u,l),1===s.state.wrap?s.adler=Dn(s.adler,a,u,l):2===s.state.wrap&&(s.adler=Un(s.adler,a,u,l)),s.next_in+=u,s.total_in+=u,u),t.lookahead+=i,t.lookahead+t.insert>=po)for(o=t.strstart-t.insert,t.ins_h=t.window[o],t.ins_h=(t.ins_h<<t.hash_shift^t.window[o+1])&t.hash_mask;t.insert&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[o+po-1])&t.hash_mask,t.prev[o&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=o,o++,t.insert--,!(t.lookahead+t.insert<po)););}while(t.lookahead<Ao&&0!==t.strm.avail_in)}function Uo(t,e){for(var i,r;;){if(t.lookahead<Ao){if(Ro(t),t.lookahead<Ao&&e===Nn)return To;if(0===t.lookahead)break}if(i=0,t.lookahead>=po&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+po-1])&t.hash_mask,i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!==i&&t.strstart-i<=t.w_size-Ao&&(t.match_length=Do(t,i)),t.match_length>=po)if(r=Fn._tr_tally(t,t.strstart-t.match_start,t.match_length-po),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=po){t.match_length--;do{t.strstart++,t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+po-1])&t.hash_mask,i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart}while(0!=--t.match_length);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+1])&t.hash_mask;else r=Fn._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(r&&(Lo(t,!1),0===t.strm.avail_out))return To}return t.insert=t.strstart<po-1?t.strstart:po-1,e===jn?(Lo(t,!0),0===t.strm.avail_out?Eo:Co):t.last_lit&&(Lo(t,!1),0===t.strm.avail_out)?To:Bo}function Oo(t,e){for(var i,r,n;;){if(t.lookahead<Ao){if(Ro(t),t.lookahead<Ao&&e===Nn)return To;if(0===t.lookahead)break}if(i=0,t.lookahead>=po&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+po-1])&t.hash_mask,i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=po-1,0!==i&&t.prev_length<t.max_lazy_match&&t.strstart-i<=t.w_size-Ao&&(t.match_length=Do(t,i),t.match_length<=5&&(t.strategy===Xn||t.match_length===po&&t.strstart-t.match_start>4096)&&(t.match_length=po-1)),t.prev_length>=po&&t.match_length<=t.prev_length){n=t.strstart+t.lookahead-po,r=Fn._tr_tally(t,t.strstart-1-t.prev_match,t.prev_length-po),t.lookahead-=t.prev_length-1,t.prev_length-=2;do{++t.strstart<=n&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+po-1])&t.hash_mask,i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart)}while(0!=--t.prev_length);if(t.match_available=0,t.match_length=po-1,t.strstart++,r&&(Lo(t,!1),0===t.strm.avail_out))return To}else if(t.match_available){if((r=Fn._tr_tally(t,0,t.window[t.strstart-1]))&&Lo(t,!1),t.strstart++,t.lookahead--,0===t.strm.avail_out)return To}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(r=Fn._tr_tally(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<po-1?t.strstart:po-1,e===jn?(Lo(t,!0),0===t.strm.avail_out?Eo:Co):t.last_lit&&(Lo(t,!1),0===t.strm.avail_out)?To:Bo}function No(t,e,i,r,n){this.good_length=t,this.max_lazy=e,this.nice_length=i,this.max_chain=r,this.func=n}function Qo(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=ro,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new zr.Buf16(2*uo),this.dyn_dtree=new zr.Buf16(2*(2*lo+1)),this.bl_tree=new zr.Buf16(2*(2*co+1)),ko(this.dyn_ltree),ko(this.dyn_dtree),ko(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new zr.Buf16(ho+1),this.heap=new zr.Buf16(2*ao+1),ko(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new zr.Buf16(2*ao+1),ko(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Vo(t){var e;return t&&t.state?(t.total_in=t.total_out=0,t.data_type=io,(e=t.state).pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap?go:bo,t.adler=2===e.wrap?0:1,e.last_flush=Nn,Fn._tr_init(e),Gn):Io(t,Zn)}function jo(t){var e,i=Vo(t);return i===Gn&&((e=t.state).window_size=2*e.w_size,ko(e.head),e.max_lazy_match=zn[e.level].max_lazy,e.good_match=zn[e.level].good_length,e.nice_match=zn[e.level].nice_length,e.max_chain_length=zn[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=po-1,e.match_available=0,e.ins_h=0),i}function Ho(t,e,i,r,n,o){if(!t)return Zn;var s=1;if(e===Wn&&(e=6),r<0?(s=0,r=-r):r>15&&(s=2,r-=16),n<1||n>no||i!==ro||r<8||r>15||e<0||e>9||o<0||o>to)return Io(t,Zn);8===r&&(r=9);var a=new Qo;return t.state=a,a.strm=t,a.wrap=s,a.gzhead=null,a.w_bits=r,a.w_size=1<<a.w_bits,a.w_mask=a.w_size-1,a.hash_bits=n+7,a.hash_size=1<<a.hash_bits,a.hash_mask=a.hash_size-1,a.hash_shift=~~((a.hash_bits+po-1)/po),a.window=new zr.Buf8(2*a.w_size),a.head=new zr.Buf16(a.hash_size),a.prev=new zr.Buf16(a.w_size),a.lit_bufsize=1<<n+6,a.pending_buf_size=4*a.lit_bufsize,a.pending_buf=new zr.Buf8(a.pending_buf_size),a.d_buf=1*a.lit_bufsize,a.l_buf=3*a.lit_bufsize,a.level=e,a.strategy=o,a.method=i,jo(t)}zn=[new No(0,0,0,0,(function(t,e){var i=65535;for(i>t.pending_buf_size-5&&(i=t.pending_buf_size-5);;){if(t.lookahead<=1){if(Ro(t),0===t.lookahead&&e===Nn)return To;if(0===t.lookahead)break}t.strstart+=t.lookahead,t.lookahead=0;var r=t.block_start+i;if((0===t.strstart||t.strstart>=r)&&(t.lookahead=t.strstart-r,t.strstart=r,Lo(t,!1),0===t.strm.avail_out))return To;if(t.strstart-t.block_start>=t.w_size-Ao&&(Lo(t,!1),0===t.strm.avail_out))return To}return t.insert=0,e===jn?(Lo(t,!0),0===t.strm.avail_out?Eo:Co):(t.strstart>t.block_start&&(Lo(t,!1),t.strm.avail_out),To)})),new No(4,4,8,4,Uo),new No(4,5,16,8,Uo),new No(4,6,32,32,Uo),new No(4,4,16,16,Oo),new No(8,16,32,32,Oo),new No(8,16,128,128,Oo),new No(8,32,128,256,Oo),new No(32,128,258,1024,Oo),new No(32,258,258,4096,Oo)];var Go={deflateInit:function(t,e){return Ho(t,e,ro,oo,so,eo)},deflateInit2:Ho,deflateReset:jo,deflateResetKeep:Vo,deflateSetHeader:function(t,e){return t&&t.state?2!==t.state.wrap?Zn:(t.state.gzhead=e,Gn):Zn},deflate:function(t,e){var i,r,n,o;if(!t||!t.state||e>Hn||e<0)return t?Io(t,Zn):Zn;if(r=t.state,!t.output||!t.input&&0!==t.avail_in||r.status===wo&&e!==jn)return Io(t,0===t.avail_out?Kn:Zn);if(r.strm=t,i=r.last_flush,r.last_flush=e,r.status===go)if(2===r.wrap)t.adler=0,zo(r,31),zo(r,139),zo(r,8),r.gzhead?(zo(r,(r.gzhead.text?1:0)+(r.gzhead.hcrc?2:0)+(r.gzhead.extra?4:0)+(r.gzhead.name?8:0)+(r.gzhead.comment?16:0)),zo(r,255&r.gzhead.time),zo(r,r.gzhead.time>>8&255),zo(r,r.gzhead.time>>16&255),zo(r,r.gzhead.time>>24&255),zo(r,9===r.level?2:r.strategy>=Jn||r.level<2?4:0),zo(r,255&r.gzhead.os),r.gzhead.extra&&r.gzhead.extra.length&&(zo(r,255&r.gzhead.extra.length),zo(r,r.gzhead.extra.length>>8&255)),r.gzhead.hcrc&&(t.adler=Un(t.adler,r.pending_buf,r.pending,0)),r.gzindex=0,r.status=_o):(zo(r,0),zo(r,0),zo(r,0),zo(r,0),zo(r,0),zo(r,9===r.level?2:r.strategy>=Jn||r.level<2?4:0),zo(r,So),r.status=bo);else{var s=ro+(r.w_bits-8<<4)<<8;s|=(r.strategy>=Jn||r.level<2?0:r.level<6?1:6===r.level?2:3)<<6,0!==r.strstart&&(s|=mo),s+=31-s%31,r.status=bo,Fo(r,s),0!==r.strstart&&(Fo(r,t.adler>>>16),Fo(r,65535&t.adler)),t.adler=1}if(r.status===_o)if(r.gzhead.extra){for(n=r.pending;r.gzindex<(65535&r.gzhead.extra.length)&&(r.pending!==r.pending_buf_size||(r.gzhead.hcrc&&r.pending>n&&(t.adler=Un(t.adler,r.pending_buf,r.pending-n,n)),Po(t),n=r.pending,r.pending!==r.pending_buf_size));)zo(r,255&r.gzhead.extra[r.gzindex]),r.gzindex++;r.gzhead.hcrc&&r.pending>n&&(t.adler=Un(t.adler,r.pending_buf,r.pending-n,n)),r.gzindex===r.gzhead.extra.length&&(r.gzindex=0,r.status=yo)}else r.status=yo;if(r.status===yo)if(r.gzhead.name){n=r.pending;do{if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>n&&(t.adler=Un(t.adler,r.pending_buf,r.pending-n,n)),Po(t),n=r.pending,r.pending===r.pending_buf_size)){o=1;break}o=r.gzindex<r.gzhead.name.length?255&r.gzhead.name.charCodeAt(r.gzindex++):0,zo(r,o)}while(0!==o);r.gzhead.hcrc&&r.pending>n&&(t.adler=Un(t.adler,r.pending_buf,r.pending-n,n)),0===o&&(r.gzindex=0,r.status=vo)}else r.status=vo;if(r.status===vo)if(r.gzhead.comment){n=r.pending;do{if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>n&&(t.adler=Un(t.adler,r.pending_buf,r.pending-n,n)),Po(t),n=r.pending,r.pending===r.pending_buf_size)){o=1;break}o=r.gzindex<r.gzhead.comment.length?255&r.gzhead.comment.charCodeAt(r.gzindex++):0,zo(r,o)}while(0!==o);r.gzhead.hcrc&&r.pending>n&&(t.adler=Un(t.adler,r.pending_buf,r.pending-n,n)),0===o&&(r.status=xo)}else r.status=xo;if(r.status===xo&&(r.gzhead.hcrc?(r.pending+2>r.pending_buf_size&&Po(t),r.pending+2<=r.pending_buf_size&&(zo(r,255&t.adler),zo(r,t.adler>>8&255),t.adler=0,r.status=bo)):r.status=bo),0!==r.pending){if(Po(t),0===t.avail_out)return r.last_flush=-1,Gn}else if(0===t.avail_in&&Mo(e)<=Mo(i)&&e!==jn)return Io(t,Kn);if(r.status===wo&&0!==t.avail_in)return Io(t,Kn);if(0!==t.avail_in||0!==r.lookahead||e!==Nn&&r.status!==wo){var a=r.strategy===Jn?function(t,e){for(var i;;){if(0===t.lookahead&&(Ro(t),0===t.lookahead)){if(e===Nn)return To;break}if(t.match_length=0,i=Fn._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,i&&(Lo(t,!1),0===t.strm.avail_out))return To}return t.insert=0,e===jn?(Lo(t,!0),0===t.strm.avail_out?Eo:Co):t.last_lit&&(Lo(t,!1),0===t.strm.avail_out)?To:Bo}(r,e):r.strategy===Yn?function(t,e){for(var i,r,n,o,s=t.window;;){if(t.lookahead<=fo){if(Ro(t),t.lookahead<=fo&&e===Nn)return To;if(0===t.lookahead)break}if(t.match_length=0,t.lookahead>=po&&t.strstart>0&&(r=s[n=t.strstart-1])===s[++n]&&r===s[++n]&&r===s[++n]){o=t.strstart+fo;do{}while(r===s[++n]&&r===s[++n]&&r===s[++n]&&r===s[++n]&&r===s[++n]&&r===s[++n]&&r===s[++n]&&r===s[++n]&&n<o);t.match_length=fo-(o-n),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=po?(i=Fn._tr_tally(t,1,t.match_length-po),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(i=Fn._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),i&&(Lo(t,!1),0===t.strm.avail_out))return To}return t.insert=0,e===jn?(Lo(t,!0),0===t.strm.avail_out?Eo:Co):t.last_lit&&(Lo(t,!1),0===t.strm.avail_out)?To:Bo}(r,e):zn[r.level].func(r,e);if(a!==Eo&&a!==Co||(r.status=wo),a===To||a===Eo)return 0===t.avail_out&&(r.last_flush=-1),Gn;if(a===Bo&&(e===Qn?Fn._tr_align(r):e!==Hn&&(Fn._tr_stored_block(r,0,0,!1),e===Vn&&(ko(r.head),0===r.lookahead&&(r.strstart=0,r.block_start=0,r.insert=0))),Po(t),0===t.avail_out))return r.last_flush=-1,Gn}return e!==jn?Gn:r.wrap<=0?$n:(2===r.wrap?(zo(r,255&t.adler),zo(r,t.adler>>8&255),zo(r,t.adler>>16&255),zo(r,t.adler>>24&255),zo(r,255&t.total_in),zo(r,t.total_in>>8&255),zo(r,t.total_in>>16&255),zo(r,t.total_in>>24&255)):(Fo(r,t.adler>>>16),Fo(r,65535&t.adler)),Po(t),r.wrap>0&&(r.wrap=-r.wrap),0!==r.pending?Gn:$n)},deflateEnd:function(t){var e;return t&&t.state?(e=t.state.status)!==go&&e!==_o&&e!==yo&&e!==vo&&e!==xo&&e!==bo&&e!==wo?Io(t,Zn):(t.state=null,e===bo?Io(t,qn):Gn):Zn},deflateSetDictionary:function(t,e){var i,r,n,o,s,a,l,c,u=e.length;if(!t||!t.state)return Zn;if(2===(o=(i=t.state).wrap)||1===o&&i.status!==go||i.lookahead)return Zn;for(1===o&&(t.adler=Dn(t.adler,e,u,0)),i.wrap=0,u>=i.w_size&&(0===o&&(ko(i.head),i.strstart=0,i.block_start=0,i.insert=0),c=new zr.Buf8(i.w_size),zr.arraySet(c,e,u-i.w_size,i.w_size,0),e=c,u=i.w_size),s=t.avail_in,a=t.next_in,l=t.input,t.avail_in=u,t.next_in=0,t.input=e,Ro(i);i.lookahead>=po;){r=i.strstart,n=i.lookahead-(po-1);do{i.ins_h=(i.ins_h<<i.hash_shift^i.window[r+po-1])&i.hash_mask,i.prev[r&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=r,r++}while(--n);i.strstart=r,i.lookahead=po-1,Ro(i)}return i.strstart+=i.lookahead,i.block_start=i.strstart,i.insert=i.lookahead,i.lookahead=0,i.match_length=i.prev_length=po-1,i.match_available=0,t.next_in=a,t.input=l,t.avail_in=s,i.wrap=o,Gn},deflateInfo:"pako deflate (from Nodeca project)"},$o=!0,Zo=!0;try{String.fromCharCode.apply(null,[0])}catch(t){$o=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(t){Zo=!1}for(var qo=new zr.Buf8(256),Ko=0;Ko<256;Ko++)qo[Ko]=Ko>=252?6:Ko>=248?5:Ko>=240?4:Ko>=224?3:Ko>=192?2:1;function Wo(t,e){if(e<65537&&(t.subarray&&Zo||!t.subarray&&$o))return String.fromCharCode.apply(null,zr.shrinkBuf(t,e));for(var i="",r=0;r<e;r++)i+=String.fromCharCode(t[r]);return i}qo[254]=qo[254]=1;var Xo={string2buf:function(t){var e,i,r,n,o,s=t.length,a=0;for(n=0;n<s;n++)55296==(64512&(i=t.charCodeAt(n)))&&n+1<s&&56320==(64512&(r=t.charCodeAt(n+1)))&&(i=65536+(i-55296<<10)+(r-56320),n++),a+=i<128?1:i<2048?2:i<65536?3:4;for(e=new zr.Buf8(a),o=0,n=0;o<a;n++)55296==(64512&(i=t.charCodeAt(n)))&&n+1<s&&56320==(64512&(r=t.charCodeAt(n+1)))&&(i=65536+(i-55296<<10)+(r-56320),n++),i<128?e[o++]=i:i<2048?(e[o++]=192|i>>>6,e[o++]=128|63&i):i<65536?(e[o++]=224|i>>>12,e[o++]=128|i>>>6&63,e[o++]=128|63&i):(e[o++]=240|i>>>18,e[o++]=128|i>>>12&63,e[o++]=128|i>>>6&63,e[o++]=128|63&i);return e},buf2binstring:function(t){return Wo(t,t.length)},binstring2buf:function(t){for(var e=new zr.Buf8(t.length),i=0,r=e.length;i<r;i++)e[i]=t.charCodeAt(i);return e},buf2string:function(t,e){var i,r,n,o,s=e||t.length,a=new Array(2*s);for(r=0,i=0;i<s;)if((n=t[i++])<128)a[r++]=n;else if((o=qo[n])>4)a[r++]=65533,i+=o-1;else{for(n&=2===o?31:3===o?15:7;o>1&&i<s;)n=n<<6|63&t[i++],o--;o>1?a[r++]=65533:n<65536?a[r++]=n:(n-=65536,a[r++]=55296|n>>10&1023,a[r++]=56320|1023&n)}return Wo(a,r)},utf8border:function(t,e){var i;for((e=e||t.length)>t.length&&(e=t.length),i=e-1;i>=0&&128==(192&t[i]);)i--;return i<0||0===i?e:i+qo[t[i]]>e?i:e}},Jo=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0},Yo=Object.prototype.toString,ts=0,es=-1,is=0,rs=8;function ns(t){if(!(this instanceof ns))return new ns(t);this.options=zr.assign({level:es,method:rs,chunkSize:16384,windowBits:15,memLevel:8,strategy:is,to:""},t||{});var e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Jo,this.strm.avail_out=0;var i=Go.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(i!==ts)throw new Error(On[i]);if(e.header&&Go.deflateSetHeader(this.strm,e.header),e.dictionary){var r;if(r="string"==typeof e.dictionary?Xo.string2buf(e.dictionary):"[object ArrayBuffer]"===Yo.call(e.dictionary)?new Uint8Array(e.dictionary):e.dictionary,(i=Go.deflateSetDictionary(this.strm,r))!==ts)throw new Error(On[i]);this._dict_set=!0}}function os(t,e){var i=new ns(e);if(i.push(t,!0),i.err)throw i.msg||On[i.err];return i.result}ns.prototype.push=function(t,e){var i,r,n=this.strm,o=this.options.chunkSize;if(this.ended)return!1;r=e===~~e?e:!0===e?4:0,"string"==typeof t?n.input=Xo.string2buf(t):"[object ArrayBuffer]"===Yo.call(t)?n.input=new Uint8Array(t):n.input=t,n.next_in=0,n.avail_in=n.input.length;do{if(0===n.avail_out&&(n.output=new zr.Buf8(o),n.next_out=0,n.avail_out=o),1!==(i=Go.deflate(n,r))&&i!==ts)return this.onEnd(i),this.ended=!0,!1;0!==n.avail_out&&(0!==n.avail_in||4!==r&&2!==r)||("string"===this.options.to?this.onData(Xo.buf2binstring(zr.shrinkBuf(n.output,n.next_out))):this.onData(zr.shrinkBuf(n.output,n.next_out)))}while((n.avail_in>0||0===n.avail_out)&&1!==i);return 4===r?(i=Go.deflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===ts):2!==r||(this.onEnd(ts),n.avail_out=0,!0)},ns.prototype.onData=function(t){this.chunks.push(t)},ns.prototype.onEnd=function(t){t===ts&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=zr.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var ss={Deflate:ns,deflate:os,deflateRaw:function(t,e){return(e=e||{}).raw=!0,os(t,e)},gzip:function(t,e){return(e=e||{}).gzip=!0,os(t,e)}},as=function(t,e){var i,r,n,o,s,a,l,c,u,h,d,p,f,A,m,g,_,y,v,x,b,w,T,B,E;i=t.state,r=t.next_in,B=t.input,n=r+(t.avail_in-5),o=t.next_out,E=t.output,s=o-(e-t.avail_out),a=o+(t.avail_out-257),l=i.dmax,c=i.wsize,u=i.whave,h=i.wnext,d=i.window,p=i.hold,f=i.bits,A=i.lencode,m=i.distcode,g=(1<<i.lenbits)-1,_=(1<<i.distbits)-1;t:do{f<15&&(p+=B[r++]<<f,f+=8,p+=B[r++]<<f,f+=8),y=A[p&g];e:for(;;){if(p>>>=v=y>>>24,f-=v,0==(v=y>>>16&255))E[o++]=65535&y;else{if(!(16&v)){if(0==(64&v)){y=A[(65535&y)+(p&(1<<v)-1)];continue e}if(32&v){i.mode=12;break t}t.msg="invalid literal/length code",i.mode=30;break t}x=65535&y,(v&=15)&&(f<v&&(p+=B[r++]<<f,f+=8),x+=p&(1<<v)-1,p>>>=v,f-=v),f<15&&(p+=B[r++]<<f,f+=8,p+=B[r++]<<f,f+=8),y=m[p&_];i:for(;;){if(p>>>=v=y>>>24,f-=v,!(16&(v=y>>>16&255))){if(0==(64&v)){y=m[(65535&y)+(p&(1<<v)-1)];continue i}t.msg="invalid distance code",i.mode=30;break t}if(b=65535&y,f<(v&=15)&&(p+=B[r++]<<f,(f+=8)<v&&(p+=B[r++]<<f,f+=8)),(b+=p&(1<<v)-1)>l){t.msg="invalid distance too far back",i.mode=30;break t}if(p>>>=v,f-=v,b>(v=o-s)){if((v=b-v)>u&&i.sane){t.msg="invalid distance too far back",i.mode=30;break t}if(w=0,T=d,0===h){if(w+=c-v,v<x){x-=v;do{E[o++]=d[w++]}while(--v);w=o-b,T=E}}else if(h<v){if(w+=c+h-v,(v-=h)<x){x-=v;do{E[o++]=d[w++]}while(--v);if(w=0,h<x){x-=v=h;do{E[o++]=d[w++]}while(--v);w=o-b,T=E}}}else if(w+=h-v,v<x){x-=v;do{E[o++]=d[w++]}while(--v);w=o-b,T=E}for(;x>2;)E[o++]=T[w++],E[o++]=T[w++],E[o++]=T[w++],x-=3;x&&(E[o++]=T[w++],x>1&&(E[o++]=T[w++]))}else{w=o-b;do{E[o++]=E[w++],E[o++]=E[w++],E[o++]=E[w++],x-=3}while(x>2);x&&(E[o++]=E[w++],x>1&&(E[o++]=E[w++]))}break}}break}}while(r<n&&o<a);r-=x=f>>3,p&=(1<<(f-=x<<3))-1,t.next_in=r,t.next_out=o,t.avail_in=r<n?n-r+5:5-(r-n),t.avail_out=o<a?a-o+257:257-(o-a),i.hold=p,i.bits=f},ls=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],cs=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],us=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],hs=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64],ds=function(t,e,i,r,n,o,s,a){var l,c,u,h,d,p,f,A,m,g=a.bits,_=0,y=0,v=0,x=0,b=0,w=0,T=0,B=0,E=0,C=0,S=null,I=0,M=new zr.Buf16(16),k=new zr.Buf16(16),P=null,L=0;for(_=0;_<=15;_++)M[_]=0;for(y=0;y<r;y++)M[e[i+y]]++;for(b=g,x=15;x>=1&&0===M[x];x--);if(b>x&&(b=x),0===x)return n[o++]=20971520,n[o++]=20971520,a.bits=1,0;for(v=1;v<x&&0===M[v];v++);for(b<v&&(b=v),B=1,_=1;_<=15;_++)if(B<<=1,(B-=M[_])<0)return-1;if(B>0&&(0===t||1!==x))return-1;for(k[1]=0,_=1;_<15;_++)k[_+1]=k[_]+M[_];for(y=0;y<r;y++)0!==e[i+y]&&(s[k[e[i+y]]++]=y);if(0===t?(S=P=s,p=19):1===t?(S=ls,I-=257,P=cs,L-=257,p=256):(S=us,P=hs,p=-1),C=0,y=0,_=v,d=o,w=b,T=0,u=-1,h=(E=1<<b)-1,1===t&&E>852||2===t&&E>592)return 1;for(;;){f=_-T,s[y]<p?(A=0,m=s[y]):s[y]>p?(A=P[L+s[y]],m=S[I+s[y]]):(A=96,m=0),l=1<<_-T,v=c=1<<w;do{n[d+(C>>T)+(c-=l)]=f<<24|A<<16|m|0}while(0!==c);for(l=1<<_-1;C&l;)l>>=1;if(0!==l?(C&=l-1,C+=l):C=0,y++,0==--M[_]){if(_===x)break;_=e[i+s[y]]}if(_>b&&(C&h)!==u){for(0===T&&(T=b),d+=v,B=1<<(w=_-T);w+T<x&&!((B-=M[w+T])<=0);)w++,B<<=1;if(E+=1<<w,1===t&&E>852||2===t&&E>592)return 1;n[u=C&h]=b<<24|w<<16|d-o|0}}return 0!==C&&(n[d+C]=_-T<<24|64<<16|0),a.bits=b,0},ps=0,fs=1,As=2,ms=4,gs=5,_s=6,ys=0,vs=1,xs=2,bs=-2,ws=-3,Ts=-4,Bs=-5,Es=8,Cs=1,Ss=2,Is=3,Ms=4,ks=5,Ps=6,Ls=7,zs=8,Fs=9,Ds=10,Rs=11,Us=12,Os=13,Ns=14,Qs=15,Vs=16,js=17,Hs=18,Gs=19,$s=20,Zs=21,qs=22,Ks=23,Ws=24,Xs=25,Js=26,Ys=27,ta=28,ea=29,ia=30,ra=31,na=852,oa=592,sa=15;function aa(t){return(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24)}function la(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new zr.Buf16(320),this.work=new zr.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function ca(t){var e;return t&&t.state?(e=t.state,t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=1&e.wrap),e.mode=Cs,e.last=0,e.havedict=0,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new zr.Buf32(na),e.distcode=e.distdyn=new zr.Buf32(oa),e.sane=1,e.back=-1,ys):bs}function ua(t){var e;return t&&t.state?((e=t.state).wsize=0,e.whave=0,e.wnext=0,ca(t)):bs}function ha(t,e){var i,r;return t&&t.state?(r=t.state,e<0?(i=0,e=-e):(i=1+(e>>4),e<48&&(e&=15)),e&&(e<8||e>15)?bs:(null!==r.window&&r.wbits!==e&&(r.window=null),r.wrap=i,r.wbits=e,ua(t))):bs}function da(t,e){var i,r;return t?(r=new la,t.state=r,r.window=null,(i=ha(t,e))!==ys&&(t.state=null),i):bs}var pa,fa,Aa=!0;function ma(t){if(Aa){var e;for(pa=new zr.Buf32(512),fa=new zr.Buf32(32),e=0;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(ds(fs,t.lens,0,288,pa,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;ds(As,t.lens,0,32,fa,0,t.work,{bits:5}),Aa=!1}t.lencode=pa,t.lenbits=9,t.distcode=fa,t.distbits=5}function ga(t,e,i,r){var n,o=t.state;return null===o.window&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new zr.Buf8(o.wsize)),r>=o.wsize?(zr.arraySet(o.window,e,i-o.wsize,o.wsize,0),o.wnext=0,o.whave=o.wsize):((n=o.wsize-o.wnext)>r&&(n=r),zr.arraySet(o.window,e,i-r,n,o.wnext),(r-=n)?(zr.arraySet(o.window,e,i-r,r,0),o.wnext=r,o.whave=o.wsize):(o.wnext+=n,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=n))),0}var _a={inflateReset:ua,inflateReset2:ha,inflateResetKeep:ca,inflateInit:function(t){return da(t,sa)},inflateInit2:da,inflate:function(t,e){var i,r,n,o,s,a,l,c,u,h,d,p,f,A,m,g,_,y,v,x,b,w,T,B,E=0,C=new zr.Buf8(4),S=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!t||!t.state||!t.output||!t.input&&0!==t.avail_in)return bs;(i=t.state).mode===Us&&(i.mode=Os),s=t.next_out,n=t.output,l=t.avail_out,o=t.next_in,r=t.input,a=t.avail_in,c=i.hold,u=i.bits,h=a,d=l,w=ys;t:for(;;)switch(i.mode){case Cs:if(0===i.wrap){i.mode=Os;break}for(;u<16;){if(0===a)break t;a--,c+=r[o++]<<u,u+=8}if(2&i.wrap&&35615===c){i.check=0,C[0]=255&c,C[1]=c>>>8&255,i.check=Un(i.check,C,2,0),c=0,u=0,i.mode=Ss;break}if(i.flags=0,i.head&&(i.head.done=!1),!(1&i.wrap)||(((255&c)<<8)+(c>>8))%31){t.msg="incorrect header check",i.mode=ia;break}if((15&c)!==Es){t.msg="unknown compression method",i.mode=ia;break}if(u-=4,b=8+(15&(c>>>=4)),0===i.wbits)i.wbits=b;else if(b>i.wbits){t.msg="invalid window size",i.mode=ia;break}i.dmax=1<<b,t.adler=i.check=1,i.mode=512&c?Ds:Us,c=0,u=0;break;case Ss:for(;u<16;){if(0===a)break t;a--,c+=r[o++]<<u,u+=8}if(i.flags=c,(255&i.flags)!==Es){t.msg="unknown compression method",i.mode=ia;break}if(57344&i.flags){t.msg="unknown header flags set",i.mode=ia;break}i.head&&(i.head.text=c>>8&1),512&i.flags&&(C[0]=255&c,C[1]=c>>>8&255,i.check=Un(i.check,C,2,0)),c=0,u=0,i.mode=Is;case Is:for(;u<32;){if(0===a)break t;a--,c+=r[o++]<<u,u+=8}i.head&&(i.head.time=c),512&i.flags&&(C[0]=255&c,C[1]=c>>>8&255,C[2]=c>>>16&255,C[3]=c>>>24&255,i.check=Un(i.check,C,4,0)),c=0,u=0,i.mode=Ms;case Ms:for(;u<16;){if(0===a)break t;a--,c+=r[o++]<<u,u+=8}i.head&&(i.head.xflags=255&c,i.head.os=c>>8),512&i.flags&&(C[0]=255&c,C[1]=c>>>8&255,i.check=Un(i.check,C,2,0)),c=0,u=0,i.mode=ks;case ks:if(1024&i.flags){for(;u<16;){if(0===a)break t;a--,c+=r[o++]<<u,u+=8}i.length=c,i.head&&(i.head.extra_len=c),512&i.flags&&(C[0]=255&c,C[1]=c>>>8&255,i.check=Un(i.check,C,2,0)),c=0,u=0}else i.head&&(i.head.extra=null);i.mode=Ps;case Ps:if(1024&i.flags&&((p=i.length)>a&&(p=a),p&&(i.head&&(b=i.head.extra_len-i.length,i.head.extra||(i.head.extra=new Array(i.head.extra_len)),zr.arraySet(i.head.extra,r,o,p,b)),512&i.flags&&(i.check=Un(i.check,r,p,o)),a-=p,o+=p,i.length-=p),i.length))break t;i.length=0,i.mode=Ls;case Ls:if(2048&i.flags){if(0===a)break t;p=0;do{b=r[o+p++],i.head&&b&&i.length<65536&&(i.head.name+=String.fromCharCode(b))}while(b&&p<a);if(512&i.flags&&(i.check=Un(i.check,r,p,o)),a-=p,o+=p,b)break t}else i.head&&(i.head.name=null);i.length=0,i.mode=zs;case zs:if(4096&i.flags){if(0===a)break t;p=0;do{b=r[o+p++],i.head&&b&&i.length<65536&&(i.head.comment+=String.fromCharCode(b))}while(b&&p<a);if(512&i.flags&&(i.check=Un(i.check,r,p,o)),a-=p,o+=p,b)break t}else i.head&&(i.head.comment=null);i.mode=Fs;case Fs:if(512&i.flags){for(;u<16;){if(0===a)break t;a--,c+=r[o++]<<u,u+=8}if(c!==(65535&i.check)){t.msg="header crc mismatch",i.mode=ia;break}c=0,u=0}i.head&&(i.head.hcrc=i.flags>>9&1,i.head.done=!0),t.adler=i.check=0,i.mode=Us;break;case Ds:for(;u<32;){if(0===a)break t;a--,c+=r[o++]<<u,u+=8}t.adler=i.check=aa(c),c=0,u=0,i.mode=Rs;case Rs:if(0===i.havedict)return t.next_out=s,t.avail_out=l,t.next_in=o,t.avail_in=a,i.hold=c,i.bits=u,xs;t.adler=i.check=1,i.mode=Us;case Us:if(e===gs||e===_s)break t;case Os:if(i.last){c>>>=7&u,u-=7&u,i.mode=Ys;break}for(;u<3;){if(0===a)break t;a--,c+=r[o++]<<u,u+=8}switch(i.last=1&c,u-=1,3&(c>>>=1)){case 0:i.mode=Ns;break;case 1:if(ma(i),i.mode=$s,e===_s){c>>>=2,u-=2;break t}break;case 2:i.mode=js;break;case 3:t.msg="invalid block type",i.mode=ia}c>>>=2,u-=2;break;case Ns:for(c>>>=7&u,u-=7&u;u<32;){if(0===a)break t;a--,c+=r[o++]<<u,u+=8}if((65535&c)!=(c>>>16^65535)){t.msg="invalid stored block lengths",i.mode=ia;break}if(i.length=65535&c,c=0,u=0,i.mode=Qs,e===_s)break t;case Qs:i.mode=Vs;case Vs:if(p=i.length){if(p>a&&(p=a),p>l&&(p=l),0===p)break t;zr.arraySet(n,r,o,p,s),a-=p,o+=p,l-=p,s+=p,i.length-=p;break}i.mode=Us;break;case js:for(;u<14;){if(0===a)break t;a--,c+=r[o++]<<u,u+=8}if(i.nlen=257+(31&c),c>>>=5,u-=5,i.ndist=1+(31&c),c>>>=5,u-=5,i.ncode=4+(15&c),c>>>=4,u-=4,i.nlen>286||i.ndist>30){t.msg="too many length or distance symbols",i.mode=ia;break}i.have=0,i.mode=Hs;case Hs:for(;i.have<i.ncode;){for(;u<3;){if(0===a)break t;a--,c+=r[o++]<<u,u+=8}i.lens[S[i.have++]]=7&c,c>>>=3,u-=3}for(;i.have<19;)i.lens[S[i.have++]]=0;if(i.lencode=i.lendyn,i.lenbits=7,T={bits:i.lenbits},w=ds(ps,i.lens,0,19,i.lencode,0,i.work,T),i.lenbits=T.bits,w){t.msg="invalid code lengths set",i.mode=ia;break}i.have=0,i.mode=Gs;case Gs:for(;i.have<i.nlen+i.ndist;){for(;g=(E=i.lencode[c&(1<<i.lenbits)-1])>>>16&255,_=65535&E,!((m=E>>>24)<=u);){if(0===a)break t;a--,c+=r[o++]<<u,u+=8}if(_<16)c>>>=m,u-=m,i.lens[i.have++]=_;else{if(16===_){for(B=m+2;u<B;){if(0===a)break t;a--,c+=r[o++]<<u,u+=8}if(c>>>=m,u-=m,0===i.have){t.msg="invalid bit length repeat",i.mode=ia;break}b=i.lens[i.have-1],p=3+(3&c),c>>>=2,u-=2}else if(17===_){for(B=m+3;u<B;){if(0===a)break t;a--,c+=r[o++]<<u,u+=8}u-=m,b=0,p=3+(7&(c>>>=m)),c>>>=3,u-=3}else{for(B=m+7;u<B;){if(0===a)break t;a--,c+=r[o++]<<u,u+=8}u-=m,b=0,p=11+(127&(c>>>=m)),c>>>=7,u-=7}if(i.have+p>i.nlen+i.ndist){t.msg="invalid bit length repeat",i.mode=ia;break}for(;p--;)i.lens[i.have++]=b}}if(i.mode===ia)break;if(0===i.lens[256]){t.msg="invalid code -- missing end-of-block",i.mode=ia;break}if(i.lenbits=9,T={bits:i.lenbits},w=ds(fs,i.lens,0,i.nlen,i.lencode,0,i.work,T),i.lenbits=T.bits,w){t.msg="invalid literal/lengths set",i.mode=ia;break}if(i.distbits=6,i.distcode=i.distdyn,T={bits:i.distbits},w=ds(As,i.lens,i.nlen,i.ndist,i.distcode,0,i.work,T),i.distbits=T.bits,w){t.msg="invalid distances set",i.mode=ia;break}if(i.mode=$s,e===_s)break t;case $s:i.mode=Zs;case Zs:if(a>=6&&l>=258){t.next_out=s,t.avail_out=l,t.next_in=o,t.avail_in=a,i.hold=c,i.bits=u,as(t,d),s=t.next_out,n=t.output,l=t.avail_out,o=t.next_in,r=t.input,a=t.avail_in,c=i.hold,u=i.bits,i.mode===Us&&(i.back=-1);break}for(i.back=0;g=(E=i.lencode[c&(1<<i.lenbits)-1])>>>16&255,_=65535&E,!((m=E>>>24)<=u);){if(0===a)break t;a--,c+=r[o++]<<u,u+=8}if(g&&0==(240&g)){for(y=m,v=g,x=_;g=(E=i.lencode[x+((c&(1<<y+v)-1)>>y)])>>>16&255,_=65535&E,!(y+(m=E>>>24)<=u);){if(0===a)break t;a--,c+=r[o++]<<u,u+=8}c>>>=y,u-=y,i.back+=y}if(c>>>=m,u-=m,i.back+=m,i.length=_,0===g){i.mode=Js;break}if(32&g){i.back=-1,i.mode=Us;break}if(64&g){t.msg="invalid literal/length code",i.mode=ia;break}i.extra=15&g,i.mode=qs;case qs:if(i.extra){for(B=i.extra;u<B;){if(0===a)break t;a--,c+=r[o++]<<u,u+=8}i.length+=c&(1<<i.extra)-1,c>>>=i.extra,u-=i.extra,i.back+=i.extra}i.was=i.length,i.mode=Ks;case Ks:for(;g=(E=i.distcode[c&(1<<i.distbits)-1])>>>16&255,_=65535&E,!((m=E>>>24)<=u);){if(0===a)break t;a--,c+=r[o++]<<u,u+=8}if(0==(240&g)){for(y=m,v=g,x=_;g=(E=i.distcode[x+((c&(1<<y+v)-1)>>y)])>>>16&255,_=65535&E,!(y+(m=E>>>24)<=u);){if(0===a)break t;a--,c+=r[o++]<<u,u+=8}c>>>=y,u-=y,i.back+=y}if(c>>>=m,u-=m,i.back+=m,64&g){t.msg="invalid distance code",i.mode=ia;break}i.offset=_,i.extra=15&g,i.mode=Ws;case Ws:if(i.extra){for(B=i.extra;u<B;){if(0===a)break t;a--,c+=r[o++]<<u,u+=8}i.offset+=c&(1<<i.extra)-1,c>>>=i.extra,u-=i.extra,i.back+=i.extra}if(i.offset>i.dmax){t.msg="invalid distance too far back",i.mode=ia;break}i.mode=Xs;case Xs:if(0===l)break t;if(p=d-l,i.offset>p){if((p=i.offset-p)>i.whave&&i.sane){t.msg="invalid distance too far back",i.mode=ia;break}p>i.wnext?(p-=i.wnext,f=i.wsize-p):f=i.wnext-p,p>i.length&&(p=i.length),A=i.window}else A=n,f=s-i.offset,p=i.length;p>l&&(p=l),l-=p,i.length-=p;do{n[s++]=A[f++]}while(--p);0===i.length&&(i.mode=Zs);break;case Js:if(0===l)break t;n[s++]=i.length,l--,i.mode=Zs;break;case Ys:if(i.wrap){for(;u<32;){if(0===a)break t;a--,c|=r[o++]<<u,u+=8}if(d-=l,t.total_out+=d,i.total+=d,d&&(t.adler=i.check=i.flags?Un(i.check,n,d,s-d):Dn(i.check,n,d,s-d)),d=l,(i.flags?c:aa(c))!==i.check){t.msg="incorrect data check",i.mode=ia;break}c=0,u=0}i.mode=ta;case ta:if(i.wrap&&i.flags){for(;u<32;){if(0===a)break t;a--,c+=r[o++]<<u,u+=8}if(c!==(4294967295&i.total)){t.msg="incorrect length check",i.mode=ia;break}c=0,u=0}i.mode=ea;case ea:w=vs;break t;case ia:w=ws;break t;case ra:return Ts;default:return bs}return t.next_out=s,t.avail_out=l,t.next_in=o,t.avail_in=a,i.hold=c,i.bits=u,(i.wsize||d!==t.avail_out&&i.mode<ia&&(i.mode<Ys||e!==ms))&&ga(t,t.output,t.next_out,d-t.avail_out),h-=t.avail_in,d-=t.avail_out,t.total_in+=h,t.total_out+=d,i.total+=d,i.wrap&&d&&(t.adler=i.check=i.flags?Un(i.check,n,d,t.next_out-d):Dn(i.check,n,d,t.next_out-d)),t.data_type=i.bits+(i.last?64:0)+(i.mode===Us?128:0)+(i.mode===$s||i.mode===Qs?256:0),(0===h&&0===d||e===ms)&&w===ys&&(w=Bs),w},inflateEnd:function(t){if(!t||!t.state)return bs;var e=t.state;return e.window&&(e.window=null),t.state=null,ys},inflateGetHeader:function(t,e){var i;return t&&t.state?0==(2&(i=t.state).wrap)?bs:(i.head=e,e.done=!1,ys):bs},inflateSetDictionary:function(t,e){var i,r=e.length;return t&&t.state?0!==(i=t.state).wrap&&i.mode!==Rs?bs:i.mode===Rs&&Dn(1,e,r,0)!==i.check?ws:ga(t,e,r,r)?(i.mode=ra,Ts):(i.havedict=1,ys):bs},inflateInfo:"pako inflate (from Nodeca project)"},ya={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8},va=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1},xa=Object.prototype.toString;function ba(t){if(!(this instanceof ba))return new ba(t);this.options=zr.assign({chunkSize:16384,windowBits:0,to:""},t||{});var e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,0===e.windowBits&&(e.windowBits=-15)),!(e.windowBits>=0&&e.windowBits<16)||t&&t.windowBits||(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&0==(15&e.windowBits)&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Jo,this.strm.avail_out=0;var i=_a.inflateInit2(this.strm,e.windowBits);if(i!==ya.Z_OK)throw new Error(On[i]);this.header=new va,_a.inflateGetHeader(this.strm,this.header)}function wa(t,e){var i=new ba(e);if(i.push(t,!0),i.err)throw i.msg||On[i.err];return i.result}ba.prototype.push=function(t,e){var i,r,n,o,s,a,l=this.strm,c=this.options.chunkSize,u=this.options.dictionary,h=!1;if(this.ended)return!1;r=e===~~e?e:!0===e?ya.Z_FINISH:ya.Z_NO_FLUSH,"string"==typeof t?l.input=Xo.binstring2buf(t):"[object ArrayBuffer]"===xa.call(t)?l.input=new Uint8Array(t):l.input=t,l.next_in=0,l.avail_in=l.input.length;do{if(0===l.avail_out&&(l.output=new zr.Buf8(c),l.next_out=0,l.avail_out=c),(i=_a.inflate(l,ya.Z_NO_FLUSH))===ya.Z_NEED_DICT&&u&&(a="string"==typeof u?Xo.string2buf(u):"[object ArrayBuffer]"===xa.call(u)?new Uint8Array(u):u,i=_a.inflateSetDictionary(this.strm,a)),i===ya.Z_BUF_ERROR&&!0===h&&(i=ya.Z_OK,h=!1),i!==ya.Z_STREAM_END&&i!==ya.Z_OK)return this.onEnd(i),this.ended=!0,!1;l.next_out&&(0!==l.avail_out&&i!==ya.Z_STREAM_END&&(0!==l.avail_in||r!==ya.Z_FINISH&&r!==ya.Z_SYNC_FLUSH)||("string"===this.options.to?(n=Xo.utf8border(l.output,l.next_out),o=l.next_out-n,s=Xo.buf2string(l.output,n),l.next_out=o,l.avail_out=c-o,o&&zr.arraySet(l.output,l.output,n,o,0),this.onData(s)):this.onData(zr.shrinkBuf(l.output,l.next_out)))),0===l.avail_in&&0===l.avail_out&&(h=!0)}while((l.avail_in>0||0===l.avail_out)&&i!==ya.Z_STREAM_END);return i===ya.Z_STREAM_END&&(r=ya.Z_FINISH),r===ya.Z_FINISH?(i=_a.inflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===ya.Z_OK):r!==ya.Z_SYNC_FLUSH||(this.onEnd(ya.Z_OK),l.avail_out=0,!0)},ba.prototype.onData=function(t){this.chunks.push(t)},ba.prototype.onEnd=function(t){t===ya.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=zr.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var Ta={Inflate:ba,inflate:wa,inflateRaw:function(t,e){return(e=e||{}).raw=!0,wa(t,e)},ungzip:wa},Ba={};(0,zr.assign)(Ba,ss,Ta,ya);var Ea=Ba,Ca="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array?"uint8array":"array";function Sa(t,e){ar.call(this,"FlateWorker/"+t),this._pako=null,this._pakoAction=t,this._pakoOptions=e,this.meta={}}or.inherits(Sa,ar),Sa.prototype.processChunk=function(t){this.meta=t.meta,null===this._pako&&this._createPako(),this._pako.push(or.transformTo(Ca,t.data),!1)},Sa.prototype.flush=function(){ar.prototype.flush.call(this),null===this._pako&&this._createPako(),this._pako.push([],!0)},Sa.prototype.cleanUp=function(){ar.prototype.cleanUp.call(this),this._pako=null},Sa.prototype._createPako=function(){this._pako=new Ea[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var t=this;this._pako.onData=function(e){t.push({data:e,meta:t.meta})}};var Ia={STORE:{magic:"\0\0",compressWorker:function(t){return new ar("STORE compression")},uncompressWorker:function(){return new ar("STORE decompression")}},DEFLATE:{magic:"\b\0",compressWorker:function(t){return new Sa("Deflate",t)},uncompressWorker:function(){return new Sa("Inflate",{})}}},Ma="PK",ka="PK",Pa="PK",La="PK",za="PK",Fa="PK\b",Da=function(t,e){var i,r="";for(i=0;i<e;i++)r+=String.fromCharCode(255&t),t>>>=8;return r},Ra=function(t,e,i,r,n,o){var s,a,l=t.file,c=t.compression,u=o!==lr.utf8encode,h=or.transformTo("string",o(l.name)),d=or.transformTo("string",lr.utf8encode(l.name)),p=l.comment,f=or.transformTo("string",o(p)),A=or.transformTo("string",lr.utf8encode(p)),m=d.length!==l.name.length,g=A.length!==p.length,_="",y="",v="",x=l.dir,b=l.date,w={crc32:0,compressedSize:0,uncompressedSize:0};e&&!i||(w.crc32=t.crc32,w.compressedSize=t.compressedSize,w.uncompressedSize=t.uncompressedSize);var T=0;e&&(T|=8),u||!m&&!g||(T|=2048);var B,E,C=0,S=0;x&&(C|=16),"UNIX"===n?(S=798,C|=(E=B=l.unixPermissions,B||(E=x?16893:33204),(65535&E)<<16)):(S=20,C|=63&(l.dosPermissions||0)),s=b.getUTCHours(),s<<=6,s|=b.getUTCMinutes(),s<<=5,s|=b.getUTCSeconds()/2,a=b.getUTCFullYear()-1980,a<<=4,a|=b.getUTCMonth()+1,a<<=5,a|=b.getUTCDate(),m&&(y=Da(1,1)+Da(Tr(h),4)+d,_+="up"+Da(y.length,2)+y),g&&(v=Da(1,1)+Da(Tr(f),4)+A,_+="uc"+Da(v.length,2)+v);var I="";return I+="\n\0",I+=Da(T,2),I+=c.magic,I+=Da(s,2),I+=Da(a,2),I+=Da(w.crc32,4),I+=Da(w.compressedSize,4),I+=Da(w.uncompressedSize,4),I+=Da(h.length,2),I+=Da(_.length,2),{fileRecord:Ma+I+h+_,dirRecord:ka+Da(S,2)+I+Da(f.length,2)+"\0\0\0\0"+Da(C,4)+Da(r,4)+h+_+f}},Ua=function(t){return Fa+Da(t.crc32,4)+Da(t.compressedSize,4)+Da(t.uncompressedSize,4)};function Oa(t,e,i,r){ar.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=e,this.zipPlatform=i,this.encodeFileName=r,this.streamFiles=t,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}or.inherits(Oa,ar),Oa.prototype.push=function(t){var e=t.meta.percent||0,i=this.entriesCount,r=this._sources.length;this.accumulate?this.contentBuffer.push(t):(this.bytesWritten+=t.data.length,ar.prototype.push.call(this,{data:t.data,meta:{currentFile:this.currentFile,percent:i?(e+100*(i-r-1))/i:100}}))},Oa.prototype.openedSource=function(t){this.currentSourceOffset=this.bytesWritten,this.currentFile=t.file.name;var e=this.streamFiles&&!t.file.dir;if(e){var i=Ra(t,e,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:i.fileRecord,meta:{percent:0}})}else this.accumulate=!0},Oa.prototype.closedSource=function(t){this.accumulate=!1;var e=this.streamFiles&&!t.file.dir,i=Ra(t,e,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(i.dirRecord),e)this.push({data:Ua(t),meta:{percent:100}});else for(this.push({data:i.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},Oa.prototype.flush=function(){for(var t=this.bytesWritten,e=0;e<this.dirRecords.length;e++)this.push({data:this.dirRecords[e],meta:{percent:100}});var i=this.bytesWritten-t,r=function(t,e,i,r,n){var o=or.transformTo("string",n(r));return Pa+"\0\0\0\0"+Da(t,2)+Da(t,2)+Da(e,4)+Da(i,4)+Da(o.length,2)+o}(this.dirRecords.length,i,t,this.zipComment,this.encodeFileName);this.push({data:r,meta:{percent:100}})},Oa.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},Oa.prototype.registerPrevious=function(t){this._sources.push(t);var e=this;return t.on("data",(function(t){e.processChunk(t)})),t.on("end",(function(){e.closedSource(e.previous.streamInfo),e._sources.length?e.prepareNextSource():e.end()})),t.on("error",(function(t){e.error(t)})),this},Oa.prototype.resume=function(){return!!ar.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},Oa.prototype.error=function(t){var e=this._sources;if(!ar.prototype.error.call(this,t))return!1;for(var i=0;i<e.length;i++)try{e[i].error(t)}catch(t){}return!0},Oa.prototype.lock=function(){ar.prototype.lock.call(this);for(var t=this._sources,e=0;e<t.length;e++)t[e].lock()};var Na=Oa,Qa=function(t,e,i){var r=new Na(e.streamFiles,i,e.platform,e.encodeFileName),n=0;try{t.forEach((function(t,i){n++;var o=function(t,e){var i=t||e,r=Ia[i];if(!r)throw new Error(i+" is not a valid compression method !");return r}(i.options.compression,e.compression),s=i.options.compressionOptions||e.compressionOptions||{},a=i.dir,l=i.date;i._compressWorker(o,s).withStreamInfo("file",{name:t,dir:a,date:l,comment:i.comment||"",unixPermissions:i.unixPermissions,dosPermissions:i.dosPermissions}).pipe(r)})),r.entriesCount=n}catch(t){r.error(t)}return r};function Va(t,e){ar.call(this,"Nodejs stream input adapter for "+t),this._upstreamEnded=!1,this._bindStream(e)}or.inherits(Va,ar),Va.prototype._bindStream=function(t){var e=this;this._stream=t,t.pause(),t.on("data",(function(t){e.push({data:t,meta:{percent:0}})})).on("error",(function(t){e.isPaused?this.generatedError=t:e.error(t)})).on("end",(function(){e.isPaused?e._upstreamEnded=!0:e.end()}))},Va.prototype.pause=function(){return!!ar.prototype.pause.call(this)&&(this._stream.pause(),!0)},Va.prototype.resume=function(){return!!ar.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)};var ja=Va,Ha=function(t,e,i){var r,n=or.getTypeOf(e),o=or.extend(i||{},_r);o.date=o.date||new Date,null!==o.compression&&(o.compression=o.compression.toUpperCase()),"string"==typeof o.unixPermissions&&(o.unixPermissions=parseInt(o.unixPermissions,8)),o.unixPermissions&&16384&o.unixPermissions&&(o.dir=!0),o.dosPermissions&&16&o.dosPermissions&&(o.dir=!0),o.dir&&(t=$a(t)),o.createFolders&&(r=Ga(t))&&Za.call(this,r,!0);var s="string"===n&&!1===o.binary&&!1===o.base64;i&&void 0!==i.binary||(o.binary=!s),(e instanceof Sr&&0===e.uncompressedSize||o.dir||!e||0===e.length)&&(o.base64=!1,o.binary=!0,e="",o.compression="STORE",n="string");var a=null;a=e instanceof Sr||e instanceof ar?e:ri(e)?new ja(t,e):or.prepareContent(t,e,o.binary,o.optimizedBinaryString,o.base64);var l=new Lr(t,a,o);this.files[t]=l},Ga=function(t){"/"===t.slice(-1)&&(t=t.substring(0,t.length-1));var e=t.lastIndexOf("/");return e>0?t.substring(0,e):""},$a=function(t){return"/"!==t.slice(-1)&&(t+="/"),t},Za=function(t,e){return e=void 0!==e?e:_r.createFolders,t=$a(t),this.files[t]||Ha.call(this,t,null,{dir:!0,createFolders:e}),this.files[t]};function qa(t){return"[object RegExp]"===Object.prototype.toString.call(t)}var Ka={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(t){var e,i,r;for(e in this.files)this.files.hasOwnProperty(e)&&(r=this.files[e],(i=e.slice(this.root.length,e.length))&&e.slice(0,this.root.length)===this.root&&t(i,r))},filter:function(t){var e=[];return this.forEach((function(i,r){t(i,r)&&e.push(r)})),e},file:function(t,e,i){if(1===arguments.length){if(qa(t)){var r=t;return this.filter((function(t,e){return!e.dir&&r.test(t)}))}var n=this.files[this.root+t];return n&&!n.dir?n:null}return t=this.root+t,Ha.call(this,t,e,i),this},folder:function(t){if(!t)return this;if(qa(t))return this.filter((function(e,i){return i.dir&&t.test(e)}));var e=this.root+t,i=Za.call(this,e),r=this.clone();return r.root=i.name,r},remove:function(t){t=this.root+t;var e=this.files[t];if(e||("/"!==t.slice(-1)&&(t+="/"),e=this.files[t]),e&&!e.dir)delete this.files[t];else for(var i=this.filter((function(e,i){return i.name.slice(0,t.length)===t})),r=0;r<i.length;r++)delete this.files[i[r].name];return this},generate:function(t){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(t){var e,i={};try{if((i=or.extend(t||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:lr.utf8encode})).type=i.type.toLowerCase(),i.compression=i.compression.toUpperCase(),"binarystring"===i.type&&(i.type="string"),!i.type)throw new Error("No output type specified.");or.checkSupport(i.type),"darwin"!==i.platform&&"freebsd"!==i.platform&&"linux"!==i.platform&&"sunos"!==i.platform||(i.platform="UNIX"),"win32"===i.platform&&(i.platform="DOS");var r=i.comment||this.comment||"";e=Qa(this,i,r)}catch(t){(e=new ar("error")).error(t)}return new gr(e,i.type||"string",i.mimeType)},generateAsync:function(t,e){return this.generateInternalStream(t).accumulate(e)},generateNodeStream:function(t,e){return(t=t||{}).type||(t.type="nodebuffer"),this.generateInternalStream(t).toNodejsStream(e)}};function Wa(t){this.data=t,this.length=t.length,this.index=0,this.zero=0}Wa.prototype={checkOffset:function(t){this.checkIndex(this.index+t)},checkIndex:function(t){if(this.length<this.zero+t||t<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+t+"). Corrupted zip ?")},setIndex:function(t){this.checkIndex(t),this.index=t},skip:function(t){this.setIndex(this.index+t)},byteAt:function(t){},readInt:function(t){var e,i=0;for(this.checkOffset(t),e=this.index+t-1;e>=this.index;e--)i=(i<<8)+this.byteAt(e);return this.index+=t,i},readString:function(t){return or.transformTo("string",this.readData(t))},readData:function(t){},lastIndexOfSignature:function(t){},readAndCheckSignature:function(t){},readDate:function(){var t=this.readInt(4);return new Date(Date.UTC(1980+(t>>25&127),(t>>21&15)-1,t>>16&31,t>>11&31,t>>5&63,(31&t)<<1))}};var Xa=Wa;function Ja(t){Xa.call(this,t);for(var e=0;e<this.data.length;e++)t[e]=255&t[e]}or.inherits(Ja,Xa),Ja.prototype.byteAt=function(t){return this.data[this.zero+t]},Ja.prototype.lastIndexOfSignature=function(t){for(var e=t.charCodeAt(0),i=t.charCodeAt(1),r=t.charCodeAt(2),n=t.charCodeAt(3),o=this.length-4;o>=0;--o)if(this.data[o]===e&&this.data[o+1]===i&&this.data[o+2]===r&&this.data[o+3]===n)return o-this.zero;return-1},Ja.prototype.readAndCheckSignature=function(t){var e=t.charCodeAt(0),i=t.charCodeAt(1),r=t.charCodeAt(2),n=t.charCodeAt(3),o=this.readData(4);return e===o[0]&&i===o[1]&&r===o[2]&&n===o[3]},Ja.prototype.readData=function(t){if(this.checkOffset(t),0===t)return[];var e=this.data.slice(this.zero+this.index,this.zero+this.index+t);return this.index+=t,e};var Ya=Ja;function tl(t){Xa.call(this,t)}or.inherits(tl,Xa),tl.prototype.byteAt=function(t){return this.data.charCodeAt(this.zero+t)},tl.prototype.lastIndexOfSignature=function(t){return this.data.lastIndexOf(t)-this.zero},tl.prototype.readAndCheckSignature=function(t){return t===this.readData(4)},tl.prototype.readData=function(t){this.checkOffset(t);var e=this.data.slice(this.zero+this.index,this.zero+this.index+t);return this.index+=t,e};var el=tl;function il(t){Ya.call(this,t)}or.inherits(il,Ya),il.prototype.readData=function(t){if(this.checkOffset(t),0===t)return new Uint8Array(0);var e=this.data.subarray(this.zero+this.index,this.zero+this.index+t);return this.index+=t,e};var rl=il;function nl(t){rl.call(this,t)}or.inherits(nl,rl),nl.prototype.readData=function(t){this.checkOffset(t);var e=this.data.slice(this.zero+this.index,this.zero+this.index+t);return this.index+=t,e};var ol=nl,sl=function(t){var e=or.getTypeOf(t);return or.checkSupport(e),"string"!==e||Xe.uint8array?"nodebuffer"===e?new ol(t):Xe.uint8array?new rl(or.transformTo("uint8array",t)):new Ya(or.transformTo("array",t)):new el(t)};function al(t,e){this.options=t,this.loadOptions=e}al.prototype={isEncrypted:function(){return 1==(1&this.bitFlag)},useUTF8:function(){return 2048==(2048&this.bitFlag)},readLocalPart:function(t){var e,i;if(t.skip(22),this.fileNameLength=t.readInt(2),i=t.readInt(2),this.fileName=t.readData(this.fileNameLength),t.skip(i),-1===this.compressedSize||-1===this.uncompressedSize)throw new Error("Bug or corrupted zip : didn't get enough informations from the central directory (compressedSize === -1 || uncompressedSize === -1)");if(null===(e=function(t){for(var e in Ia)if(Ia.hasOwnProperty(e)&&Ia[e].magic===t)return Ia[e];return null}(this.compressionMethod)))throw new Error("Corrupted zip : compression "+or.pretty(this.compressionMethod)+" unknown (inner file : "+or.transformTo("string",this.fileName)+")");this.decompressed=new Sr(this.compressedSize,this.uncompressedSize,this.crc32,e,t.readData(this.compressedSize))},readCentralPart:function(t){this.versionMadeBy=t.readInt(2),t.skip(2),this.bitFlag=t.readInt(2),this.compressionMethod=t.readString(2),this.date=t.readDate(),this.crc32=t.readInt(4),this.compressedSize=t.readInt(4),this.uncompressedSize=t.readInt(4);var e=t.readInt(2);if(this.extraFieldsLength=t.readInt(2),this.fileCommentLength=t.readInt(2),this.diskNumberStart=t.readInt(2),this.internalFileAttributes=t.readInt(2),this.externalFileAttributes=t.readInt(4),this.localHeaderOffset=t.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");t.skip(e),this.readExtraFields(t),this.parseZIP64ExtraField(t),this.fileComment=t.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var t=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),0===t&&(this.dosPermissions=63&this.externalFileAttributes),3===t&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||"/"!==this.fileNameStr.slice(-1)||(this.dir=!0)},parseZIP64ExtraField:function(t){if(this.extraFields[1]){var e=sl(this.extraFields[1].value);this.uncompressedSize===or.MAX_VALUE_32BITS&&(this.uncompressedSize=e.readInt(8)),this.compressedSize===or.MAX_VALUE_32BITS&&(this.compressedSize=e.readInt(8)),this.localHeaderOffset===or.MAX_VALUE_32BITS&&(this.localHeaderOffset=e.readInt(8)),this.diskNumberStart===or.MAX_VALUE_32BITS&&(this.diskNumberStart=e.readInt(4))}},readExtraFields:function(t){var e,i,r,n=t.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});t.index<n;)e=t.readInt(2),i=t.readInt(2),r=t.readData(i),this.extraFields[e]={id:e,length:i,value:r}},handleUTF8:function(){var t=Xe.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=lr.utf8decode(this.fileName),this.fileCommentStr=lr.utf8decode(this.fileComment);else{var e=this.findExtraFieldUnicodePath();if(null!==e)this.fileNameStr=e;else{var i=or.transformTo(t,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(i)}var r=this.findExtraFieldUnicodeComment();if(null!==r)this.fileCommentStr=r;else{var n=or.transformTo(t,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(n)}}},findExtraFieldUnicodePath:function(){var t=this.extraFields[28789];if(t){var e=sl(t.value);return 1!==e.readInt(1)||Tr(this.fileName)!==e.readInt(4)?null:lr.utf8decode(e.readData(t.length-5))}return null},findExtraFieldUnicodeComment:function(){var t=this.extraFields[25461];if(t){var e=sl(t.value);return 1!==e.readInt(1)||Tr(this.fileComment)!==e.readInt(4)?null:lr.utf8decode(e.readData(t.length-5))}return null}};var ll=al;function cl(t){this.files=[],this.loadOptions=t}cl.prototype={checkSignature:function(t){if(!this.reader.readAndCheckSignature(t)){this.reader.index-=4;var e=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+or.pretty(e)+", expected "+or.pretty(t)+")")}},isSignature:function(t,e){var i=this.reader.index;this.reader.setIndex(t);var r=this.reader.readString(4)===e;return this.reader.setIndex(i),r},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var t=this.reader.readData(this.zipCommentLength),e=Xe.uint8array?"uint8array":"array",i=or.transformTo(e,t);this.zipComment=this.loadOptions.decodeFileName(i)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var t,e,i,r=this.zip64EndOfCentralSize-44;0<r;)t=this.reader.readInt(2),e=this.reader.readInt(4),i=this.reader.readData(e),this.zip64ExtensibleData[t]={id:t,length:e,value:i}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),this.disksCount>1)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var t,e;for(t=0;t<this.files.length;t++)e=this.files[t],this.reader.setIndex(e.localHeaderOffset),this.checkSignature(Ma),e.readLocalPart(this.reader),e.handleUTF8(),e.processAttributes()},readCentralDir:function(){var t;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(ka);)(t=new ll({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(t);if(this.centralDirRecords!==this.files.length&&0!==this.centralDirRecords&&0===this.files.length)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var t=this.reader.lastIndexOfSignature(Pa);if(t<0)throw this.isSignature(0,Ma)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(t);var e=t;if(this.checkSignature(Pa),this.readBlockEndOfCentral(),this.diskNumber===or.MAX_VALUE_16BITS||this.diskWithCentralDirStart===or.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===or.MAX_VALUE_16BITS||this.centralDirRecords===or.MAX_VALUE_16BITS||this.centralDirSize===or.MAX_VALUE_32BITS||this.centralDirOffset===or.MAX_VALUE_32BITS){if(this.zip64=!0,(t=this.reader.lastIndexOfSignature(La))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(t),this.checkSignature(La),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,za)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(za),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(za),this.readBlockZip64EndOfCentral()}var i=this.centralDirOffset+this.centralDirSize;this.zip64&&(i+=20,i+=12+this.zip64EndOfCentralSize);var r=e-i;if(r>0)this.isSignature(e,ka)||(this.reader.zero=r);else if(r<0)throw new Error("Corrupted zip: missing "+Math.abs(r)+" bytes.")},prepareReader:function(t){this.reader=sl(t)},load:function(t){this.prepareReader(t),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}};var ul=cl;function hl(t){return new nr.Promise((function(e,i){var r=t.decompressed.getContentWorker().pipe(new Er);r.on("error",(function(t){i(t)})).on("end",(function(){r.streamInfo.crc32!==t.decompressed.crc32?i(new Error("Corrupted zip : CRC32 mismatch")):e()})).resume()}))}function dl(){if(!(this instanceof dl))return new dl;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files={},this.comment=null,this.root="",this.clone=function(){var t=new dl;for(var e in this)"function"!=typeof this[e]&&(t[e]=this[e]);return t}}dl.prototype=Ka,dl.prototype.loadAsync=function(t,e){var i=this;return e=or.extend(e||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:lr.utf8decode}),ri(t)?nr.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):or.prepareContent("the loaded zip file",t,!0,e.optimizedBinaryString,e.base64).then((function(t){var i=new ul(e);return i.load(t),i})).then((function(t){var i=[nr.Promise.resolve(t)],r=t.files;if(e.checkCRC32)for(var n=0;n<r.length;n++)i.push(hl(r[n]));return nr.Promise.all(i)})).then((function(t){for(var r=t.shift(),n=r.files,o=0;o<n.length;o++){var s=n[o];i.file(s.fileNameStr,s.decompressed,{binary:!0,optimizedBinaryString:!0,date:s.date,dir:s.dir,comment:s.fileCommentStr.length?s.fileCommentStr:null,unixPermissions:s.unixPermissions,dosPermissions:s.dosPermissions,createFolders:e.createFolders})}return r.zipComment.length&&(i.comment=r.zipComment),i}))},dl.support=Xe,dl.defaults=_r,dl.version="3.1.5",dl.loadAsync=function(t,e){return(new dl).loadAsync(t,e)},dl.external=nr;var pl=dl;function fl(t){return null==t}var Al={isNothing:fl,isObject:function(t){return"object"==typeof t&&null!==t},toArray:function(t){return Array.isArray(t)?t:fl(t)?[]:[t]},repeat:function(t,e){var i,r="";for(i=0;i<e;i+=1)r+=t;return r},isNegativeZero:function(t){return 0===t&&Number.NEGATIVE_INFINITY===1/t},extend:function(t,e){var i,r,n,o;if(e)for(i=0,r=(o=Object.keys(e)).length;i<r;i+=1)t[n=o[i]]=e[n];return t}};function ml(t,e){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack||"",this.name="YAMLException",this.reason=t,this.mark=e,this.message=(this.reason||"(unknown reason)")+(this.mark?" "+this.mark.toString():"")}ml.prototype=Object.create(Error.prototype),ml.prototype.constructor=ml,ml.prototype.toString=function(t){var e=this.name+": ";return e+=this.reason||"(unknown reason)",!t&&this.mark&&(e+=" "+this.mark.toString()),e};var gl=ml;function _l(t,e,i,r,n){this.name=t,this.buffer=e,this.position=i,this.line=r,this.column=n}_l.prototype.getSnippet=function(t,e){var i,r,n,o,s;if(!this.buffer)return null;for(t=t||4,e=e||75,i="",r=this.position;r>0&&-1==="\0\r\n\u2028\u2029".indexOf(this.buffer.charAt(r-1));)if(r-=1,this.position-r>e/2-1){i=" ... ",r+=5;break}for(n="",o=this.position;o<this.buffer.length&&-1==="\0\r\n\u2028\u2029".indexOf(this.buffer.charAt(o));)if((o+=1)-this.position>e/2-1){n=" ... ",o-=5;break}return s=this.buffer.slice(r,o),Al.repeat(" ",t)+i+s+n+"\n"+Al.repeat(" ",t+this.position-r+i.length)+"^"},_l.prototype.toString=function(t){var e,i="";return this.name&&(i+='in "'+this.name+'" '),i+="at line "+(this.line+1)+", column "+(this.column+1),t||(e=this.getSnippet())&&(i+=":\n"+e),i};var yl=_l,vl=["kind","resolve","construct","instanceOf","predicate","represent","defaultStyle","styleAliases"],xl=["scalar","sequence","mapping"],bl=function(t,e){var i,r;if(e=e||{},Object.keys(e).forEach((function(e){if(-1===vl.indexOf(e))throw new gl('Unknown option "'+e+'" is met in definition of "'+t+'" YAML type.')})),this.tag=t,this.kind=e.kind||null,this.resolve=e.resolve||function(){return!0},this.construct=e.construct||function(t){return t},this.instanceOf=e.instanceOf||null,this.predicate=e.predicate||null,this.represent=e.represent||null,this.defaultStyle=e.defaultStyle||null,this.styleAliases=(i=e.styleAliases||null,r={},null!==i&&Object.keys(i).forEach((function(t){i[t].forEach((function(e){r[String(e)]=t}))})),r),-1===xl.indexOf(this.kind))throw new gl('Unknown kind "'+this.kind+'" is specified for "'+t+'" YAML type.')};function wl(t,e,i){var r=[];return t.include.forEach((function(t){i=wl(t,e,i)})),t[e].forEach((function(t){i.forEach((function(e,i){e.tag===t.tag&&r.push(i)})),i.push(t)})),i.filter((function(t,e){return-1===r.indexOf(e)}))}function Tl(t){this.include=t.include||[],this.implicit=t.implicit||[],this.explicit=t.explicit||[],this.implicit.forEach((function(t){if(t.loadKind&&"scalar"!==t.loadKind)throw new gl("There is a non-scalar type in the implicit list of a schema. Implicit resolving of such types is not supported.")})),this.compiledImplicit=wl(this,"implicit",[]),this.compiledExplicit=wl(this,"explicit",[]),this.compiledTypeMap=function(){var t,e,i={};function r(t){i[t.tag]=t}for(t=0,e=arguments.length;t<e;t+=1)arguments[t].forEach(r);return i}(this.compiledImplicit,this.compiledExplicit)}Tl.DEFAULT=null,Tl.create=function(){var t,e;switch(arguments.length){case 1:t=Tl.DEFAULT,e=arguments[0];break;case 2:t=arguments[0],e=arguments[1];break;default:throw new gl("Wrong number of arguments for Schema.create function")}if(t=Al.toArray(t),e=Al.toArray(e),!t.every((function(t){return t instanceof Tl})))throw new gl("Specified list of super schemas (or a single Schema object) contains a non-Schema object.");if(!e.every((function(t){return t instanceof bl})))throw new gl("Specified list of YAML types (or a single Type object) contains a non-Type object.");return new Tl({include:t,explicit:e})};var Bl=Tl,El=new Bl({explicit:[new bl("tag:yaml.org,2002:str",{kind:"scalar",construct:function(t){return null!==t?t:""}}),new bl("tag:yaml.org,2002:seq",{kind:"sequence",construct:function(t){return null!==t?t:[]}}),new bl("tag:yaml.org,2002:map",{kind:"mapping",construct:function(t){return null!==t?t:{}}})]}),Cl=new bl("tag:yaml.org,2002:null",{kind:"scalar",resolve:function(t){if(null===t)return!0;var e=t.length;return 1===e&&"~"===t||4===e&&("null"===t||"Null"===t||"NULL"===t)},construct:function(){return null},predicate:function(t){return null===t},represent:{canonical:function(){return"~"},lowercase:function(){return"null"},uppercase:function(){return"NULL"},camelcase:function(){return"Null"}},defaultStyle:"lowercase"}),Sl=new bl("tag:yaml.org,2002:bool",{kind:"scalar",resolve:function(t){if(null===t)return!1;var e=t.length;return 4===e&&("true"===t||"True"===t||"TRUE"===t)||5===e&&("false"===t||"False"===t||"FALSE"===t)},construct:function(t){return"true"===t||"True"===t||"TRUE"===t},predicate:function(t){return"[object Boolean]"===Object.prototype.toString.call(t)},represent:{lowercase:function(t){return t?"true":"false"},uppercase:function(t){return t?"TRUE":"FALSE"},camelcase:function(t){return t?"True":"False"}},defaultStyle:"lowercase"});function Il(t){return 48<=t&&t<=55}function Ml(t){return 48<=t&&t<=57}var kl,Pl=new bl("tag:yaml.org,2002:int",{kind:"scalar",resolve:function(t){if(null===t)return!1;var e,i,r=t.length,n=0,o=!1;if(!r)return!1;if("-"!==(e=t[n])&&"+"!==e||(e=t[++n]),"0"===e){if(n+1===r)return!0;if("b"===(e=t[++n])){for(n++;n<r;n++)if("_"!==(e=t[n])){if("0"!==e&&"1"!==e)return!1;o=!0}return o}if("x"===e){for(n++;n<r;n++)if("_"!==(e=t[n])){if(!(48<=(i=t.charCodeAt(n))&&i<=57||65<=i&&i<=70||97<=i&&i<=102))return!1;o=!0}return o}for(;n<r;n++)if("_"!==(e=t[n])){if(!Il(t.charCodeAt(n)))return!1;o=!0}return o}for(;n<r;n++)if("_"!==(e=t[n])){if(":"===e)break;if(!Ml(t.charCodeAt(n)))return!1;o=!0}return!!o&&(":"!==e||/^(:[0-5]?[0-9])+$/.test(t.slice(n)))},construct:function(t){var e,i,r=t,n=1,o=[];return-1!==r.indexOf("_")&&(r=r.replace(/_/g,"")),"-"!==(e=r[0])&&"+"!==e||("-"===e&&(n=-1),e=(r=r.slice(1))[0]),"0"===r?0:"0"===e?"b"===r[1]?n*parseInt(r.slice(2),2):"x"===r[1]?n*parseInt(r,16):n*parseInt(r,8):-1!==r.indexOf(":")?(r.split(":").forEach((function(t){o.unshift(parseInt(t,10))})),r=0,i=1,o.forEach((function(t){r+=t*i,i*=60})),n*r):n*parseInt(r,10)},predicate:function(t){return"[object Number]"===Object.prototype.toString.call(t)&&t%1==0&&!Al.isNegativeZero(t)},represent:{binary:function(t){return"0b"+t.toString(2)},octal:function(t){return"0"+t.toString(8)},decimal:function(t){return t.toString(10)},hexadecimal:function(t){return"0x"+t.toString(16).toUpperCase()}},defaultStyle:"decimal",styleAliases:{binary:[2,"bin"],octal:[8,"oct"],decimal:[10,"dec"],hexadecimal:[16,"hex"]}}),Ll=new RegExp("^(?:[-+]?(?:[0-9][0-9_]*)\\.[0-9_]*(?:[eE][-+][0-9]+)?|\\.[0-9_]+(?:[eE][-+][0-9]+)?|[-+]?[0-9][0-9_]*(?::[0-5]?[0-9])+\\.[0-9_]*|[-+]?\\.(?:inf|Inf|INF)|\\.(?:nan|NaN|NAN))$"),zl=/^[-+]?[0-9]+e/,Fl=new Bl({include:[El],implicit:[Cl,Sl,Pl,new bl("tag:yaml.org,2002:float",{kind:"scalar",resolve:function(t){return null!==t&&!!Ll.test(t)},construct:function(t){var e,i,r,n;return i="-"===(e=t.replace(/_/g,"").toLowerCase())[0]?-1:1,n=[],"+-".indexOf(e[0])>=0&&(e=e.slice(1)),".inf"===e?1===i?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY:".nan"===e?NaN:e.indexOf(":")>=0?(e.split(":").forEach((function(t){n.unshift(parseFloat(t,10))})),e=0,r=1,n.forEach((function(t){e+=t*r,r*=60})),i*e):i*parseFloat(e,10)},predicate:function(t){return"[object Number]"===Object.prototype.toString.call(t)&&(t%1!=0||Al.isNegativeZero(t))},represent:function(t,e){var i;if(isNaN(t))switch(e){case"lowercase":return".nan";case"uppercase":return".NAN";case"camelcase":return".NaN"}else if(Number.POSITIVE_INFINITY===t)switch(e){case"lowercase":return".inf";case"uppercase":return".INF";case"camelcase":return".Inf"}else if(Number.NEGATIVE_INFINITY===t)switch(e){case"lowercase":return"-.inf";case"uppercase":return"-.INF";case"camelcase":return"-.Inf"}else if(Al.isNegativeZero(t))return"-0.0";return i=t.toString(10),zl.test(i)?i.replace("e",".e"):i},defaultStyle:"lowercase"})]}),Dl=new Bl({include:[Fl]}),Rl=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9]?)-([0-9][0-9]?)(?:(?:[Tt]|[ \\t]+)([0-9][0-9]?):([0-9][0-9]):([0-9][0-9])(?:\\.([0-9]*))?(?:[ \\t]*(Z|([-+])([0-9][0-9]?)(?::([0-9][0-9]))?))?)?$"),Ul=new bl("tag:yaml.org,2002:timestamp",{kind:"scalar",resolve:function(t){return null!==t&&null!==Rl.exec(t)},construct:function(t){var e,i,r,n,o,s,a,l,c=0,u=null;if(null===(e=Rl.exec(t)))throw new Error("Date resolve error");if(i=+e[1],r=+e[2]-1,n=+e[3],!e[4])return new Date(Date.UTC(i,r,n));if(o=+e[4],s=+e[5],a=+e[6],e[7]){for(c=e[7].slice(0,3);c.length<3;)c+="0";c=+c}return e[9]&&(u=6e4*(60*+e[10]+ +(e[11]||0)),"-"===e[9]&&(u=-u)),l=new Date(Date.UTC(i,r,n,o,s,a,c)),u&&l.setTime(l.getTime()-u),l},instanceOf:Date,represent:function(t){return t.toISOString()}}),Ol=new bl("tag:yaml.org,2002:merge",{kind:"scalar",resolve:function(t){return"<<"===t||null===t}}),Nl={}.Buffer,Ql="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\n\r",Vl=new bl("tag:yaml.org,2002:binary",{kind:"scalar",resolve:function(t){if(null===t)return!1;var e,i,r=0,n=t.length,o=Ql;for(i=0;i<n;i++)if(!((e=o.indexOf(t.charAt(i)))>64)){if(e<0)return!1;r+=6}return r%8==0},construct:function(t){var e,i,r=t.replace(/[\r\n=]/g,""),n=r.length,o=Ql,s=0,a=[];for(e=0;e<n;e++)e%4==0&&e&&(a.push(s>>16&255),a.push(s>>8&255),a.push(255&s)),s=s<<6|o.indexOf(r.charAt(e));return 0==(i=n%4*6)?(a.push(s>>16&255),a.push(s>>8&255),a.push(255&s)):18===i?(a.push(s>>10&255),a.push(s>>2&255)):12===i&&a.push(s>>4&255),a},predicate:function(t){return Nl},represent:function(t){var e,i,r="",n=0,o=t.length,s=Ql;for(e=0;e<o;e++)e%3==0&&e&&(r+=s[n>>18&63],r+=s[n>>12&63],r+=s[n>>6&63],r+=s[63&n]),n=(n<<8)+t[e];return 0==(i=o%3)?(r+=s[n>>18&63],r+=s[n>>12&63],r+=s[n>>6&63],r+=s[63&n]):2===i?(r+=s[n>>10&63],r+=s[n>>4&63],r+=s[n<<2&63],r+=s[64]):1===i&&(r+=s[n>>2&63],r+=s[n<<4&63],r+=s[64],r+=s[64]),r}}),jl=Object.prototype.hasOwnProperty,Hl=Object.prototype.toString,Gl=new bl("tag:yaml.org,2002:omap",{kind:"sequence",resolve:function(t){if(null===t)return!0;var e,i,r,n,o,s=[],a=t;for(e=0,i=a.length;e<i;e+=1){if(r=a[e],o=!1,"[object Object]"!==Hl.call(r))return!1;for(n in r)if(jl.call(r,n)){if(o)return!1;o=!0}if(!o)return!1;if(-1!==s.indexOf(n))return!1;s.push(n)}return!0},construct:function(t){return null!==t?t:[]}}),$l=Object.prototype.toString,Zl=new bl("tag:yaml.org,2002:pairs",{kind:"sequence",resolve:function(t){if(null===t)return!0;var e,i,r,n,o,s=t;for(o=new Array(s.length),e=0,i=s.length;e<i;e+=1){if(r=s[e],"[object Object]"!==$l.call(r))return!1;if(1!==(n=Object.keys(r)).length)return!1;o[e]=[n[0],r[n[0]]]}return!0},construct:function(t){if(null===t)return[];var e,i,r,n,o,s=t;for(o=new Array(s.length),e=0,i=s.length;e<i;e+=1)r=s[e],n=Object.keys(r),o[e]=[n[0],r[n[0]]];return o}}),ql=Object.prototype.hasOwnProperty,Kl=new Bl({include:[Dl],implicit:[Ul,Ol],explicit:[Vl,Gl,Zl,new bl("tag:yaml.org,2002:set",{kind:"mapping",resolve:function(t){if(null===t)return!0;var e,i=t;for(e in i)if(ql.call(i,e)&&null!==i[e])return!1;return!0},construct:function(t){return null!==t?t:{}}})]}),Wl=new bl("tag:yaml.org,2002:js/undefined",{kind:"scalar",resolve:function(){return!0},construct:function(){},predicate:function(t){return void 0===t},represent:function(){return""}}),Xl=new bl("tag:yaml.org,2002:js/regexp",{kind:"scalar",resolve:function(t){if(null===t)return!1;if(0===t.length)return!1;var e=t,i=/\/([gim]*)$/.exec(t),r="";if("/"===e[0]){if(i&&(r=i[1]),r.length>3)return!1;if("/"!==e[e.length-r.length-1])return!1}return!0},construct:function(t){var e=t,i=/\/([gim]*)$/.exec(t),r="";return"/"===e[0]&&(i&&(r=i[1]),e=e.slice(1,e.length-r.length-1)),new RegExp(e,r)},predicate:function(t){return"[object RegExp]"===Object.prototype.toString.call(t)},represent:function(t){var e="/"+t.source+"/";return t.global&&(e+="g"),t.multiline&&(e+="m"),t.ignoreCase&&(e+="i"),e}});try{var Jl=t.commonjsRequire;kl=Jl("esprima")}catch(t){"undefined"!=typeof window&&(kl=window.esprima)}var Yl=new bl("tag:yaml.org,2002:js/function",{kind:"scalar",resolve:function(t){if(null===t)return!1;try{var e="("+t+")",i=kl.parse(e,{range:!0});return"Program"===i.type&&1===i.body.length&&"ExpressionStatement"===i.body[0].type&&"FunctionExpression"===i.body[0].expression.type}catch(t){return!1}},construct:function(t){var e,i="("+t+")",r=kl.parse(i,{range:!0}),n=[];if("Program"!==r.type||1!==r.body.length||"ExpressionStatement"!==r.body[0].type||"FunctionExpression"!==r.body[0].expression.type)throw new Error("Failed to resolve function");return r.body[0].expression.params.forEach((function(t){n.push(t.name)})),e=r.body[0].expression.body.range,new Function(n,i.slice(e[0]+1,e[1]-1))},predicate:function(t){return"[object Function]"===Object.prototype.toString.call(t)},represent:function(t){return t.toString()}}),tc=Bl.DEFAULT=new Bl({include:[Kl],explicit:[Wl,Xl,Yl]}),ec=Object.prototype.hasOwnProperty,ic=1,rc=2,nc=3,oc=4,sc=1,ac=2,lc=3,cc=/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F-\x84\x86-\x9F\uFFFE\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/,uc=/[\x85\u2028\u2029]/,hc=/[,\[\]\{\}]/,dc=/^(?:!|!!|![a-z\-]+!)$/i,pc=/^(?:!|[^,\[\]\{\}])(?:%[0-9a-f]{2}|[0-9a-z\-#;\/\?:@&=\+\$,_\.!~\*'\(\)\[\]])*$/i;function fc(t){return 10===t||13===t}function Ac(t){return 9===t||32===t}function mc(t){return 9===t||32===t||10===t||13===t}function gc(t){return 44===t||91===t||93===t||123===t||125===t}function _c(t){var e;return 48<=t&&t<=57?t-48:97<=(e=32|t)&&e<=102?e-97+10:-1}function yc(t){return 48===t?"\0":97===t?"":98===t?"\b":116===t||9===t?"\t":110===t?"\n":118===t?"\v":102===t?"\f":114===t?"\r":101===t?"":32===t?" ":34===t?'"':47===t?"/":92===t?"\\":78===t?"":95===t?"":76===t?"\u2028":80===t?"\u2029":""}function vc(t){return t<=65535?String.fromCharCode(t):String.fromCharCode(55296+(t-65536>>10),56320+(t-65536&1023))}for(var xc=new Array(256),bc=new Array(256),wc=0;wc<256;wc++)xc[wc]=yc(wc)?1:0,bc[wc]=yc(wc);function Tc(t,e){this.input=t,this.filename=e.filename||null,this.schema=e.schema||tc,this.onWarning=e.onWarning||null,this.legacy=e.legacy||!1,this.json=e.json||!1,this.listener=e.listener||null,this.implicitTypes=this.schema.compiledImplicit,this.typeMap=this.schema.compiledTypeMap,this.length=t.length,this.position=0,this.line=0,this.lineStart=0,this.lineIndent=0,this.documents=[]}function Bc(t,e){return new gl(e,new yl(t.filename,t.input,t.position,t.line,t.position-t.lineStart))}function Ec(t,e){throw Bc(t,e)}function Cc(t,e){t.onWarning&&t.onWarning.call(null,Bc(t,e))}var Sc={YAML:function(t,e,i){var r,n,o;null!==t.version&&Ec(t,"duplication of %YAML directive"),1!==i.length&&Ec(t,"YAML directive accepts exactly one argument"),null===(r=/^([0-9]+)\.([0-9]+)$/.exec(i[0]))&&Ec(t,"ill-formed argument of the YAML directive"),n=parseInt(r[1],10),o=parseInt(r[2],10),1!==n&&Ec(t,"unacceptable YAML version of the document"),t.version=i[0],t.checkLineBreaks=o<2,1!==o&&2!==o&&Cc(t,"unsupported YAML version of the document")},TAG:function(t,e,i){var r,n;2!==i.length&&Ec(t,"TAG directive accepts exactly two arguments"),r=i[0],n=i[1],dc.test(r)||Ec(t,"ill-formed tag handle (first argument) of the TAG directive"),ec.call(t.tagMap,r)&&Ec(t,'there is a previously declared suffix for "'+r+'" tag handle'),pc.test(n)||Ec(t,"ill-formed tag prefix (second argument) of the TAG directive"),t.tagMap[r]=n}};function Ic(t,e,i,r){var n,o,s,a;if(e<i){if(a=t.input.slice(e,i),r)for(n=0,o=a.length;n<o;n+=1)9===(s=a.charCodeAt(n))||32<=s&&s<=1114111||Ec(t,"expected valid JSON character");else cc.test(a)&&Ec(t,"the stream contains non-printable characters");t.result+=a}}function Mc(t,e,i,r){var n,o,s,a;for(Al.isObject(i)||Ec(t,"cannot merge mappings; the provided source object is unacceptable"),s=0,a=(n=Object.keys(i)).length;s<a;s+=1)o=n[s],ec.call(e,o)||(e[o]=i[o],r[o]=!0)}function kc(t,e,i,r,n,o){var s,a;if(n=String(n),null===e&&(e={}),"tag:yaml.org,2002:merge"===r)if(Array.isArray(o))for(s=0,a=o.length;s<a;s+=1)Mc(t,e,o[s],i);else Mc(t,e,o,i);else t.json||ec.call(i,n)||!ec.call(e,n)||Ec(t,"duplicated mapping key"),e[n]=o,delete i[n];return e}function Pc(t){var e;10===(e=t.input.charCodeAt(t.position))?t.position++:13===e?(t.position++,10===t.input.charCodeAt(t.position)&&t.position++):Ec(t,"a line break is expected"),t.line+=1,t.lineStart=t.position}function Lc(t,e,i){for(var r=0,n=t.input.charCodeAt(t.position);0!==n;){for(;Ac(n);)n=t.input.charCodeAt(++t.position);if(e&&35===n)do{n=t.input.charCodeAt(++t.position)}while(10!==n&&13!==n&&0!==n);if(!fc(n))break;for(Pc(t),n=t.input.charCodeAt(t.position),r++,t.lineIndent=0;32===n;)t.lineIndent++,n=t.input.charCodeAt(++t.position)}return-1!==i&&0!==r&&t.lineIndent<i&&Cc(t,"deficient indentation"),r}function zc(t){var e,i=t.position;return!(45!==(e=t.input.charCodeAt(i))&&46!==e||e!==t.input.charCodeAt(i+1)||e!==t.input.charCodeAt(i+2)||(i+=3,0!==(e=t.input.charCodeAt(i))&&!mc(e)))}function Fc(t,e){1===e?t.result+=" ":e>1&&(t.result+=Al.repeat("\n",e-1))}function Dc(t,e){var i,r,n=t.tag,o=t.anchor,s=[],a=!1;for(null!==t.anchor&&(t.anchorMap[t.anchor]=s),r=t.input.charCodeAt(t.position);0!==r&&45===r&&mc(t.input.charCodeAt(t.position+1));)if(a=!0,t.position++,Lc(t,!0,-1)&&t.lineIndent<=e)s.push(null),r=t.input.charCodeAt(t.position);else if(i=t.line,Oc(t,e,nc,!1,!0),s.push(t.result),Lc(t,!0,-1),r=t.input.charCodeAt(t.position),(t.line===i||t.lineIndent>e)&&0!==r)Ec(t,"bad indentation of a sequence entry");else if(t.lineIndent<e)break;return!!a&&(t.tag=n,t.anchor=o,t.kind="sequence",t.result=s,!0)}function Rc(t){var e,i,r,n,o=!1,s=!1;if(33!==(n=t.input.charCodeAt(t.position)))return!1;if(null!==t.tag&&Ec(t,"duplication of a tag property"),60===(n=t.input.charCodeAt(++t.position))?(o=!0,n=t.input.charCodeAt(++t.position)):33===n?(s=!0,i="!!",n=t.input.charCodeAt(++t.position)):i="!",e=t.position,o){do{n=t.input.charCodeAt(++t.position)}while(0!==n&&62!==n);t.position<t.length?(r=t.input.slice(e,t.position),n=t.input.charCodeAt(++t.position)):Ec(t,"unexpected end of the stream within a verbatim tag")}else{for(;0!==n&&!mc(n);)33===n&&(s?Ec(t,"tag suffix cannot contain exclamation marks"):(i=t.input.slice(e-1,t.position+1),dc.test(i)||Ec(t,"named tag handle cannot contain such characters"),s=!0,e=t.position+1)),n=t.input.charCodeAt(++t.position);r=t.input.slice(e,t.position),hc.test(r)&&Ec(t,"tag suffix cannot contain flow indicator characters")}return r&&!pc.test(r)&&Ec(t,"tag name cannot contain such characters: "+r),o?t.tag=r:ec.call(t.tagMap,i)?t.tag=t.tagMap[i]+r:"!"===i?t.tag="!"+r:"!!"===i?t.tag="tag:yaml.org,2002:"+r:Ec(t,'undeclared tag handle "'+i+'"'),!0}function Uc(t){var e,i;if(38!==(i=t.input.charCodeAt(t.position)))return!1;for(null!==t.anchor&&Ec(t,"duplication of an anchor property"),i=t.input.charCodeAt(++t.position),e=t.position;0!==i&&!mc(i)&&!gc(i);)i=t.input.charCodeAt(++t.position);return t.position===e&&Ec(t,"name of an anchor node must contain at least one character"),t.anchor=t.input.slice(e,t.position),!0}function Oc(t,e,i,r,n){var o,s,a,l,c,u,h,d,p=1,f=!1,A=!1;if(null!==t.listener&&t.listener("open",t),t.tag=null,t.anchor=null,t.kind=null,t.result=null,o=s=a=oc===i||nc===i,r&&Lc(t,!0,-1)&&(f=!0,t.lineIndent>e?p=1:t.lineIndent===e?p=0:t.lineIndent<e&&(p=-1)),1===p)for(;Rc(t)||Uc(t);)Lc(t,!0,-1)?(f=!0,a=o,t.lineIndent>e?p=1:t.lineIndent===e?p=0:t.lineIndent<e&&(p=-1)):a=!1;if(a&&(a=f||n),1!==p&&oc!==i||(h=ic===i||rc===i?e:e+1,d=t.position-t.lineStart,1===p?a&&(Dc(t,d)||function(t,e,i){var r,n,o,s,a=t.tag,l=t.anchor,c={},u={},h=null,d=null,p=null,f=!1,A=!1;for(null!==t.anchor&&(t.anchorMap[t.anchor]=c),s=t.input.charCodeAt(t.position);0!==s;){if(r=t.input.charCodeAt(t.position+1),o=t.line,63!==s&&58!==s||!mc(r)){if(!Oc(t,i,rc,!1,!0))break;if(t.line===o){for(s=t.input.charCodeAt(t.position);Ac(s);)s=t.input.charCodeAt(++t.position);if(58===s)mc(s=t.input.charCodeAt(++t.position))||Ec(t,"a whitespace character is expected after the key-value separator within a block mapping"),f&&(kc(t,c,u,h,d,null),h=d=p=null),A=!0,f=!1,n=!1,h=t.tag,d=t.result;else{if(!A)return t.tag=a,t.anchor=l,!0;Ec(t,"can not read an implicit mapping pair; a colon is missed")}}else{if(!A)return t.tag=a,t.anchor=l,!0;Ec(t,"can not read a block mapping entry; a multiline key may not be an implicit key")}}else 63===s?(f&&(kc(t,c,u,h,d,null),h=d=p=null),A=!0,f=!0,n=!0):f?(f=!1,n=!0):Ec(t,"incomplete explicit mapping pair; a key node is missed"),t.position+=1,s=r;if((t.line===o||t.lineIndent>e)&&(Oc(t,e,oc,!0,n)&&(f?d=t.result:p=t.result),f||(kc(t,c,u,h,d,p),h=d=p=null),Lc(t,!0,-1),s=t.input.charCodeAt(t.position)),t.lineIndent>e&&0!==s)Ec(t,"bad indentation of a mapping entry");else if(t.lineIndent<e)break}return f&&kc(t,c,u,h,d,null),A&&(t.tag=a,t.anchor=l,t.kind="mapping",t.result=c),A}(t,d,h))||function(t,e){var i,r,n,o,s,a,l,c,u,h,d=!0,p=t.tag,f=t.anchor,A={};if(91===(h=t.input.charCodeAt(t.position)))n=93,a=!1,r=[];else{if(123!==h)return!1;n=125,a=!0,r={}}for(null!==t.anchor&&(t.anchorMap[t.anchor]=r),h=t.input.charCodeAt(++t.position);0!==h;){if(Lc(t,!0,e),(h=t.input.charCodeAt(t.position))===n)return t.position++,t.tag=p,t.anchor=f,t.kind=a?"mapping":"sequence",t.result=r,!0;d||Ec(t,"missed comma between flow collection entries"),u=null,o=s=!1,63===h&&mc(t.input.charCodeAt(t.position+1))&&(o=s=!0,t.position++,Lc(t,!0,e)),i=t.line,Oc(t,e,ic,!1,!0),c=t.tag,l=t.result,Lc(t,!0,e),h=t.input.charCodeAt(t.position),!s&&t.line!==i||58!==h||(o=!0,h=t.input.charCodeAt(++t.position),Lc(t,!0,e),Oc(t,e,ic,!1,!0),u=t.result),a?kc(t,r,A,c,l,u):o?r.push(kc(t,null,A,c,l,u)):r.push(l),Lc(t,!0,e),44===(h=t.input.charCodeAt(t.position))?(d=!0,h=t.input.charCodeAt(++t.position)):d=!1}Ec(t,"unexpected end of the stream within a flow collection")}(t,h)?A=!0:(s&&function(t,e){var i,r,n,o,s,a=sc,l=!1,c=e,u=0,h=!1;if(124===(o=t.input.charCodeAt(t.position)))r=!1;else{if(62!==o)return!1;r=!0}for(t.kind="scalar",t.result="";0!==o;)if(43===(o=t.input.charCodeAt(++t.position))||45===o)sc===a?a=43===o?lc:ac:Ec(t,"repeat of a chomping mode identifier");else{if(!((n=48<=(s=o)&&s<=57?s-48:-1)>=0))break;0===n?Ec(t,"bad explicit indentation width of a block scalar; it cannot be less than one"):l?Ec(t,"repeat of an indentation width identifier"):(c=e+n-1,l=!0)}if(Ac(o)){do{o=t.input.charCodeAt(++t.position)}while(Ac(o));if(35===o)do{o=t.input.charCodeAt(++t.position)}while(!fc(o)&&0!==o)}for(;0!==o;){for(Pc(t),t.lineIndent=0,o=t.input.charCodeAt(t.position);(!l||t.lineIndent<c)&&32===o;)t.lineIndent++,o=t.input.charCodeAt(++t.position);if(!l&&t.lineIndent>c&&(c=t.lineIndent),fc(o))u++;else{if(t.lineIndent<c){a===lc?t.result+=Al.repeat("\n",u):a===sc&&l&&(t.result+="\n");break}for(r?Ac(o)?(h=!0,t.result+=Al.repeat("\n",u+1)):h?(h=!1,t.result+=Al.repeat("\n",u+1)):0===u?l&&(t.result+=" "):t.result+=Al.repeat("\n",u):t.result+=l?Al.repeat("\n",u+1):Al.repeat("\n",u),l=!0,u=0,i=t.position;!fc(o)&&0!==o;)o=t.input.charCodeAt(++t.position);Ic(t,i,t.position,!1)}}return!0}(t,h)||function(t,e){var i,r,n;if(39!==(i=t.input.charCodeAt(t.position)))return!1;for(t.kind="scalar",t.result="",t.position++,r=n=t.position;0!==(i=t.input.charCodeAt(t.position));)if(39===i){if(Ic(t,r,t.position,!0),39!==(i=t.input.charCodeAt(++t.position)))return!0;r=n=t.position,t.position++}else fc(i)?(Ic(t,r,n,!0),Fc(t,Lc(t,!1,e)),r=n=t.position):t.position===t.lineStart&&zc(t)?Ec(t,"unexpected end of the document within a single quoted scalar"):(t.position++,n=t.position);Ec(t,"unexpected end of the stream within a single quoted scalar")}(t,h)||function(t,e){var i,r,n,o,s,a,l;if(34!==(a=t.input.charCodeAt(t.position)))return!1;for(t.kind="scalar",t.result="",t.position++,i=r=t.position;0!==(a=t.input.charCodeAt(t.position));){if(34===a)return Ic(t,i,t.position,!0),t.position++,!0;if(92===a){if(Ic(t,i,t.position,!0),fc(a=t.input.charCodeAt(++t.position)))Lc(t,!1,e);else if(a<256&&xc[a])t.result+=bc[a],t.position++;else if((s=120===(l=a)?2:117===l?4:85===l?8:0)>0){for(n=s,o=0;n>0;n--)(s=_c(a=t.input.charCodeAt(++t.position)))>=0?o=(o<<4)+s:Ec(t,"expected hexadecimal character");t.result+=vc(o),t.position++}else Ec(t,"unknown escape sequence");i=r=t.position}else fc(a)?(Ic(t,i,r,!0),Fc(t,Lc(t,!1,e)),i=r=t.position):t.position===t.lineStart&&zc(t)?Ec(t,"unexpected end of the document within a double quoted scalar"):(t.position++,r=t.position)}Ec(t,"unexpected end of the stream within a double quoted scalar")}(t,h)?A=!0:function(t){var e,i,r;if(42!==(r=t.input.charCodeAt(t.position)))return!1;for(r=t.input.charCodeAt(++t.position),e=t.position;0!==r&&!mc(r)&&!gc(r);)r=t.input.charCodeAt(++t.position);return t.position===e&&Ec(t,"name of an alias node must contain at least one character"),i=t.input.slice(e,t.position),t.anchorMap.hasOwnProperty(i)||Ec(t,'unidentified alias "'+i+'"'),t.result=t.anchorMap[i],Lc(t,!0,-1),!0}(t)?(A=!0,null===t.tag&&null===t.anchor||Ec(t,"alias node should not have any properties")):function(t,e,i){var r,n,o,s,a,l,c,u,h=t.kind,d=t.result;if(mc(u=t.input.charCodeAt(t.position))||gc(u)||35===u||38===u||42===u||33===u||124===u||62===u||39===u||34===u||37===u||64===u||96===u)return!1;if((63===u||45===u)&&(mc(r=t.input.charCodeAt(t.position+1))||i&&gc(r)))return!1;for(t.kind="scalar",t.result="",n=o=t.position,s=!1;0!==u;){if(58===u){if(mc(r=t.input.charCodeAt(t.position+1))||i&&gc(r))break}else if(35===u){if(mc(t.input.charCodeAt(t.position-1)))break}else{if(t.position===t.lineStart&&zc(t)||i&&gc(u))break;if(fc(u)){if(a=t.line,l=t.lineStart,c=t.lineIndent,Lc(t,!1,-1),t.lineIndent>=e){s=!0,u=t.input.charCodeAt(t.position);continue}t.position=o,t.line=a,t.lineStart=l,t.lineIndent=c;break}}s&&(Ic(t,n,o,!1),Fc(t,t.line-a),n=o=t.position,s=!1),Ac(u)||(o=t.position+1),u=t.input.charCodeAt(++t.position)}return Ic(t,n,o,!1),!!t.result||(t.kind=h,t.result=d,!1)}(t,h,ic===i)&&(A=!0,null===t.tag&&(t.tag="?")),null!==t.anchor&&(t.anchorMap[t.anchor]=t.result)):0===p&&(A=a&&Dc(t,d))),null!==t.tag&&"!"!==t.tag)if("?"===t.tag){for(l=0,c=t.implicitTypes.length;l<c;l+=1)if((u=t.implicitTypes[l]).resolve(t.result)){t.result=u.construct(t.result),t.tag=u.tag,null!==t.anchor&&(t.anchorMap[t.anchor]=t.result);break}}else ec.call(t.typeMap,t.tag)?(u=t.typeMap[t.tag],null!==t.result&&u.kind!==t.kind&&Ec(t,"unacceptable node kind for !<"+t.tag+'> tag; it should be "'+u.kind+'", not "'+t.kind+'"'),u.resolve(t.result)?(t.result=u.construct(t.result),null!==t.anchor&&(t.anchorMap[t.anchor]=t.result)):Ec(t,"cannot resolve a node with !<"+t.tag+"> explicit tag")):Ec(t,"unknown tag !<"+t.tag+">");return null!==t.listener&&t.listener("close",t),null!==t.tag||null!==t.anchor||A}function Nc(t){var e,i,r,n,o=t.position,s=!1;for(t.version=null,t.checkLineBreaks=t.legacy,t.tagMap={},t.anchorMap={};0!==(n=t.input.charCodeAt(t.position))&&(Lc(t,!0,-1),n=t.input.charCodeAt(t.position),!(t.lineIndent>0||37!==n));){for(s=!0,n=t.input.charCodeAt(++t.position),e=t.position;0!==n&&!mc(n);)n=t.input.charCodeAt(++t.position);for(r=[],(i=t.input.slice(e,t.position)).length<1&&Ec(t,"directive name must not be less than one character in length");0!==n;){for(;Ac(n);)n=t.input.charCodeAt(++t.position);if(35===n){do{n=t.input.charCodeAt(++t.position)}while(0!==n&&!fc(n));break}if(fc(n))break;for(e=t.position;0!==n&&!mc(n);)n=t.input.charCodeAt(++t.position);r.push(t.input.slice(e,t.position))}0!==n&&Pc(t),ec.call(Sc,i)?Sc[i](t,i,r):Cc(t,'unknown document directive "'+i+'"')}Lc(t,!0,-1),0===t.lineIndent&&45===t.input.charCodeAt(t.position)&&45===t.input.charCodeAt(t.position+1)&&45===t.input.charCodeAt(t.position+2)?(t.position+=3,Lc(t,!0,-1)):s&&Ec(t,"directives end mark is expected"),Oc(t,t.lineIndent-1,oc,!1,!0),Lc(t,!0,-1),t.checkLineBreaks&&uc.test(t.input.slice(o,t.position))&&Cc(t,"non-ASCII line breaks are interpreted as content"),t.documents.push(t.result),t.position===t.lineStart&&zc(t)?46===t.input.charCodeAt(t.position)&&(t.position+=3,Lc(t,!0,-1)):t.position<t.length-1&&Ec(t,"end of the stream or a document separator is expected")}function Qc(t,e){e=e||{},0!==(t=String(t)).length&&(10!==t.charCodeAt(t.length-1)&&13!==t.charCodeAt(t.length-1)&&(t+="\n"),65279===t.charCodeAt(0)&&(t=t.slice(1)));var i=new Tc(t,e);for(i.input+="\0";32===i.input.charCodeAt(i.position);)i.lineIndent+=1,i.position+=1;for(;i.position<i.length-1;)Nc(i);return i.documents}function Vc(t,e,i){var r,n,o=Qc(t,i);for(r=0,n=o.length;r<n;r+=1)e(o[r])}function jc(t,e){var i=Qc(t,e);if(0!==i.length){if(1===i.length)return i[0];throw new gl("expected a single document in the stream, but found more")}}var Hc={loadAll:Vc,load:jc,safeLoadAll:function(t,e,i){Vc(t,e,Al.extend({schema:Kl},i))},safeLoad:function(t,e){return jc(t,Al.extend({schema:Kl},e))}};function Gc(t){return function(){throw new Error("Function "+t+" is deprecated and cannot be used.")}}var $c={Type:bl,Schema:Bl,FAILSAFE_SCHEMA:El,JSON_SCHEMA:Fl,CORE_SCHEMA:Dl,DEFAULT_SAFE_SCHEMA:Kl,DEFAULT_FULL_SCHEMA:tc,load:Hc.load,loadAll:Hc.loadAll,safeLoad:Hc.safeLoad,safeLoadAll:Hc.safeLoadAll,YAMLException:gl,MINIMAL_SCHEMA:El,SAFE_SCHEMA:Kl,DEFAULT_SCHEMA:tc,scan:Gc("scan"),parse:Gc("parse"),compose:Gc("compose"),addConstructor:Gc("addConstructor")},Zc=function(){function e(e,i,r){void 0===r&&(r=null),this.url=e,!i||t.isRelativeURL(i)&&!t.isRelativeURL(this.url)?this.path=t.pathForURL(this.url):this.path=i,this.path_for_parent=i||this.path,this.parent=r,this.container=null,this.parent&&(this.parent.container?this.container=this.parent.container:this.parent.isContainer()&&(this.container=this.parent))}var i=e.prototype;return i.load=function(){return Kc(this.url)},i.resourceFor=function(t){return{url:this.urlFor(t),path:this.pathFor(t),type:this.typeFor(t)}},i.urlFor=function(e){return h(e)?e:t.isRelativeURL(e)&&this.container?this.parent.urlFor(this.path_for_parent+e):t.addBaseURL(e,this.path)},i.pathFor=function(e){return t.pathForURL(e)},i.typeFor=function(e){return t.extensionForURL(e)},i.isContainer=function(){return!1},e}(),qc=function(e){function i(t,i,r){var n;return(n=e.call(this,t,i,r)||this).zip=null,n.files={},n.root=null,n.path="",n}t._inheritsLoose(i,e);var r=i.prototype;return r.isContainer=function(){return!0},r.load=function(){return new Promise(function(e,i){var r;return this.zip=new pl,"string"==typeof this.url?Promise.resolve(t.Utils.io(this.url,6e4,"arraybuffer")).then(function(t){try{return r=t.body,Promise.resolve(this.zip.loadAsync(r)).then(function(t){try{return Promise.resolve(this.parseZipFiles()).then(function(t){try{return e(this.loadRoot())}catch(t){return i(t)}}.bind(this),i)}catch(t){return i(t)}}.bind(this),i)}catch(t){return i(t)}}.bind(this),i):e(this)}.bind(this))},r.urlFor=function(i){return h(i)?i:t.isRelativeURL(i)?this.urlForZipFile(t.flattenRelativeURL(i)):e.prototype.urlFor.call(this,i)},r.typeFor=function(i){return t.isRelativeURL(i)?this.typeForZipFile(i):e.prototype.typeFor.call(this,i)},r.loadRoot=function(){return this.findRoot(),Kc(this.urlForZipFile(this.root))},r.findRoot=function(){var e=this,i=Object.keys(this.files).filter((function(t){return 0===e.files[t].depth})).filter((function(e){return"yaml"===t.extensionForURL(e)}));if(1===i.length&&(this.root=i[0]),!this.root){var r="Could not find root scene for bundle '"+this.url+"': ";throw r+="The zip archive's root level must contain a single scene file with the '.yaml' extension. ",i.length>0?r+="Found multiple YAML files at the root level: "+i.map((function(t){return"'"+t+"'"})).join(", ")+".":r+="Found NO YAML files at the root level.",Error(r)}},r.parseZipFiles=function(){return new Promise(function(e,i){var r,n,o,s,a,l;return r=[],n=[],this.zip.forEach((function(t,e){e.dir||(r.push(t),n.push(e.async("arraybuffer")))})),Promise.resolve(Promise.all(n)).then(function(n){try{for(o=n,s=0;s<o.length;s++)a=r[s],l=a.split("/").length-1,this.files[a]={data:o[s],type:t.extensionForURL(a),depth:l};return e()}catch(t){return i(t)}}.bind(this),i)}.bind(this))},r.urlForZipFile=function(e){if(this.files[e])return this.files[e].url||(this.files[e].url=t.createObjectURL(new Blob([this.files[e].data]))),this.files[e].url},r.typeForZipFile=function(t){return this.files[t]&&this.files[t].type},i}(Zc);function Kc(e){return new Promise((function(i,r){"string"==typeof e?t.Utils.io(e).then((function(t){var e=t.body;try{i(function(t){return $c.safeLoad(t,{json:!0})}(e))}catch(t){r(t)}}),r):(e=Object.assign({},e),i(e))}))}var Wc={loadScene:function(e,i){return new Promise(function(r,n){var o,s,a,l,c,u,h,d,p,f;return o=this,a=(s=void 0===i?{}:i).path,l=s.type,c=[],u={},Promise.resolve(this.loadSceneRecursive({url:e,path:a,type:l},null,u,c)).then(function(e){try{return h=e,d=this.finalize(h),p=d.config,f=d.bundle,p?(c.length>0&&c.forEach((function(e){var i="Failed to import scene: "+e.url;t.log("error",i,e),o.trigger("error",{type:"scene_import",message:i,error:e,url:e.url})})),r({config:p,bundle:f,texture_nodes:u})):n(c[0])}catch(t){return n(t)}}.bind(this),n)}.bind(this))},loadSceneRecursive:function(e,i,r,n){return new Promise(function(o,s){var a,l,c,u,h,d,p,f,A;if(a=this,l=e.url,c=e.path,u=e.type,void 0===r&&(r={}),void 0===n&&(n=[]),!l)return o({});h=function(e,i,r,n){return void 0===n&&(n=null),null!=n&&"zip"===n||"string"==typeof e&&!t.isLocalURL(e)&&"zip"===t.extensionForURL(e)?new qc(e,i,r):new Zc(e,i,r)}(l,c,i,u);var m=function(t){try{return t.url=l,n.push(t),o({})}catch(t){return s(t)}};try{return Promise.resolve(h.load()).then(function(e){try{return null==(d=e).import?(this.normalize(d,h,r),o({config:d,bundle:h})):(Array.isArray(d.import)||(d.import=[d.import]),p=[],d.import.forEach((function(e){"object"==typeof e&&(e=t.createObjectURL(new Blob([JSON.stringify(e)]))),p.push(h.resourceFor(e))})),delete d.import,f=p.map((function(t){return a.loadSceneRecursive(t,h,r,n)})),Promise.resolve(Promise.all(f)).then(function(e){try{return A=e.map((function(t){return a.normalize(t.config,t.bundle,r)})).map((function(t){return t.config})),this.normalize(d,h,r),d=t.mergeObjects.apply(void 0,A.concat([d])),o({config:d,bundle:h,texture_nodes:r})}catch(t){return m(t)}}.bind(this),m))}catch(t){return m(t)}}.bind(this),m)}catch(t){m(t)}}.bind(this))},normalize:function(t,e,i){return void 0===i&&(i={}),this.normalizeDataSources(t,e),this.normalizeFonts(t,e),this.normalizeTextures(t,e),this.collectTextures(t,e,i),{config:t,bundle:e,texture_nodes:i}},normalizeDataSources:function(t,e){for(var i in t.sources=t.sources||{},t.sources)this.normalizeDataSource(t.sources[i],e);return t},normalizeDataSource:function(t,e){if(t.url=e.urlFor(t.url),Array.isArray(t.composite)&&t.composite.forEach((function(t){return t.url=e.urlFor(t.url)})),t.scripts)for(var i in Array.isArray(t.scripts)&&(t.scripts=t.scripts.reduce((function(t,e){return t[e]=e,t}),{})),t.scripts)t.scripts[i]=e.urlFor(t.scripts[i]);return t},normalizeFonts:function(t,e){for(var i in t.fonts=t.fonts||{},t.fonts)if(Array.isArray(t.fonts[i]))t.fonts[i].forEach((function(t){t.url=t.url&&e.urlFor(t.url)}));else{var r=t.fonts[i];r.url=r.url&&e.urlFor(r.url)}return t},normalizeTextures:function(t,e){if(t.textures=t.textures||{},t.textures)for(var i in t.textures){var r=t.textures[i];r.url&&(r.url=e.urlFor(r.url))}},collectTextures:function(e,i,r){var n=this;if(e.styles){var o=function(t){var o=e.styles[t],s=o.texture;if("string"==typeof s&&!e.textures[s]){var a=["styles",t,"texture"];n.addTextureNode(a,i,r)}o.material&&["emission","ambient","diffuse","specular","normal"].forEach((function(s){var a=null!=o.material[s]&&o.material[s].texture;if("string"==typeof a&&!e.textures[a]){var l=["styles",t,"material",s,"texture"];n.addTextureNode(l,i,r)}}))};for(var s in e.styles)o(s)}if(e.styles){var a=function(o){var s=e.styles[o];s.shaders&&s.shaders.uniforms&&t.GLSL.parseUniforms(s.shaders.uniforms).forEach((function(t){var s=t.type,a=t.value,l=t.key;if("sampler2D"===s&&"string"==typeof a&&!e.textures[a]){var c=["styles",o,"shaders","uniforms",l];n.addTextureNode(c,i,r)}}))};for(var l in e.styles)a(l)}if(e.layers)for(var c=[e.layers],u=[["layers"]];c.length>0;){var h=c.pop(),d=u.pop();if("object"==typeof h&&!Array.isArray(h))for(var p in h)if("draw"===p){var f=h[p];for(var A in f){if(f[A].texture){var m=f[A].texture;if("string"==typeof m&&!e.textures[m]){var g=[].concat(d,[p,"draw",A,"texture"]);this.addTextureNode(g,i,r)}}if(f[A].outline&&f[A].outline.texture){var _=f[A].outline.texture;if("string"==typeof _&&!e.textures[_]){var y=[].concat(d,[p,"draw",A,"outline","texture"]);this.addTextureNode(y,i,r)}}}}else{if(t.isReserved(p))continue;c.push(h[p]),u.push([].concat(d,[p]))}}},addTextureNode:function(t,e,i){i[JSON.stringify(t)]={path:t,bundle:e}},hoistTextureNodes:function(t,e,i){void 0===i&&(i={});for(var r=0,n=Object.values(i);r<n.length;r++){var a=n[r],l=a.path,c=a.bundle,u=o(t,l);if("string"==typeof u&&null==t.textures[u])if(d(t,l)){var h=e.urlFor(u);t.textures[u]={url:h}}else{var p=c.urlFor(u);t.textures[p]={url:p},s(t,l,p)}}},applyGlobalProperties:function(e){return e.global&&0!==Object.keys(e.global).length?function e(i,r,n,o){var s,a;if((null==n||null==(s=n[u])?void 0:s[o])?a=n[u][o]:"string"==typeof r&&r.slice(0,c)===l&&(a=r),a){null==n[u]&&Object.defineProperty(n,u,{value:{}}),n[u][o]=a;for(var h,d=i[a];"string"==typeof d&&d.slice(0,c)===l;){if((h=h||[a]).indexOf(d)>-1){t.log({level:"warn",once:!0},"Global properties: cyclical reference detected",h),d=null;break}h.push(d),d=i[d]}Object.defineProperty(n,o,{enumerable:!0,get:function(){return d},set:function(t){delete n[u][o],delete n[o],n[o]=t}})}else if(Array.isArray(r))for(var p=0;p<r.length;p++)e(i,r[p],r,p);else if("object"==typeof r)for(var f in r)e(i,r[f],r,f);return r}(function t(e,i,r){for(var n in void 0===i&&(i=null),void 0===r&&(r={}),i=i?i+".":l,e){var o=i+n,s=e[n];r[o]=s,"object"!=typeof s||Array.isArray(s)||t(s,o,r)}return r}(e.global),e):e},finalize:function(t){var e=t.config,i=t.bundle;return e?(e.global=e.global||{},e.scene=e.scene||{},e.cameras=e.cameras||{},e.lights=e.lights||{},e.styles=e.styles||{},e.layers=e.layers||{},e.camera&&(e.cameras.default=e.camera),0===Object.keys(e.cameras).length&&(e.cameras.default={}),(0===Object.keys(e.lights).length||Object.keys(e.lights).every((function(t){return!1===e.lights[t].visible})))&&(e.lights.default_light={type:"directional"}),{config:e,bundle:i}):{}}};t.subscribeMixin(Wc);var Xc=function(){function e(){this.tiles={},this.max_proxy_descendant_depth=6,this.max_proxy_ancestor_depth=7,this.children_cache={}}var i=e.prototype;return i.addTile=function(e){for(this.tiles[e.key]=this.tiles[e.key]||{descendants:0},this.tiles[e.key].tile=e;e.style_z>=0;){if(!(e=t.TileID.parent(e)))return;this.tiles[e.key]||(this.tiles[e.key]={descendants:0}),this.tiles[e.key].descendants++}},i.removeTile=function(e){for(this.tiles[e.key]&&(delete this.tiles[e.key].tile,0===this.tiles[e.key].descendants&&delete this.tiles[e.key]);e.style_z>=0;){if(!(e=t.TileID.parent(e)))return;this.tiles[e.key]&&this.tiles[e.key].descendants>0&&(this.tiles[e.key].descendants--,0!==this.tiles[e.key].descendants||this.tiles[e.key].tile||delete this.tiles[e.key])}},i.getAncestor=function(e){for(var i=0;i<this.max_proxy_ancestor_depth;){if(!(e=t.TileID.parent(e)))return;if(this.tiles[e.key]&&this.tiles[e.key].tile&&this.tiles[e.key].tile.loaded)return this.tiles[e.key].tile;i++}},i.getDescendants=function(e,i){var r=this;void 0===i&&(i=0);var n=[];if(i<this.max_proxy_descendant_depth){var o=t.TileID.children(e,this.children_cache);if(!o)return;o.forEach((function(t){r.tiles[t.key]&&(r.tiles[t.key].tile&&r.tiles[t.key].tile.loaded?n.push(r.tiles[t.key].tile):r.tiles[t.key].descendants>0&&n.push.apply(n,r.getDescendants(t,i+1)))}))}return n},e}(),Jc={},Yc={};function tu(e,i,r){return new Promise((function(n,o){var s,a,l,c,u;return void 0===r&&(r=!1),Yc=Jc,Jc={},s=function(e,i){var r={};for(var n in e.forEach((function(e){var n=t.Geo.unitsPerMeter(e.coords.z),o=Math.pow(2,i-e.style_z),s=n*o,a=t.Geo.metersPerPixel(i),l=Object.assign({},e.meshes,e.pending_label_meshes);for(var c in l)l[c].forEach((function(i){if(i.labels)for(var o in i.labels)if(!e.isProxy()||Yc[o]){var l=i.labels[o].container.label,c=i.labels[o].container.linked,u=i.labels[o].ranges,h={};if(h.discard=eu.bind(h),h.build_id=e.build_id,Object.assign(h,l),h.layout=Object.assign({},l.layout),h.layout.repeat_scale=.75,h.layout.repeat_distance=h.layout.repeat_distance||0,h.layout.repeat_distance/=s,h.position=[h.position[0]/n+e.min.x,h.position[1]/n+e.min.y],h.unit_scale=a,"point"===h.type)t.LabelPoint.prototype.updateBBoxes.call(h);else if("straight"===h.type)t.LabelLineStraight.prototype.updateBBoxes.call(h,h.position,h.size,h.angle,h.angle,h.offset);else if(l.obbs){var d=l.obbs.map((function(i){var r=i.x,o=i.y,a=i.a,l=i.w,c=i.h;return r=r/n+e.min.x,o=o/n+e.min.y,l/=s,c/=s,new t.OBB(r,o,a,l,c)}));h.obbs=d,h.aabbs=d.map((function(t){return t.getExtent()}))}r[o]={label:h,linked:c,ranges:u,mesh:i}}}))})),r){var o=r[n];o.linked&&(o.linked=r[o.linked])}return r=Object.keys(r).map((function(t){return r[t]}))}(e,i),t.Collision.startTile("main",{apply_repeat_groups:!0,return_hidden:!0}),t.Collision.addStyle("main","main"),a=Math.max.apply(Math,[0].concat(Object.values(e).map((function(t){return Object.values(t.meshes)})).flat().map((function(t){return Math.max.apply(Math,[0].concat(t.map((function(t){return t.labels?Object.keys(t.labels).length:0}))))})))),(l=Math.floor(a/t.Geo.tile_size))>0?t.Collision.initGrid({anchor:{x:Math.min.apply(Math,e.map((function(t){return t.min.x}))),y:Math.min.apply(Math,e.map((function(t){return t.min.y})))},span:e[0].span.x/l}):t.Collision.initGrid(),Promise.resolve(t.Collision.collide(s,"main","main")).then((function(t){try{return u=[],(c=t).forEach((function(t){var e=0;!0!==t.show||r&&t.label.breach&&!Yc[t.label.id]||(e=1),e&&(Jc[t.label.id]=!0);var i=!0;t.ranges.forEach((function(r){if(i){var n=t.mesh;if(n.valid){for(var o=n.vertex_layout.offset.a_shape,s=n.vertex_layout.stride,a=0;a<r[1];a++){if(n.vertex_data[r[0]+a*s+o+6]===e)return void(i=!1);n.vertex_data[r[0]+a*s+o+6]=e}-1===u.indexOf(n)&&u.push(n)}}}))})),u.forEach((function(t){return t.upload()})),e.forEach((function(t){return t.swapPendingLabels()})),n({labels:c,containers:s})}catch(t){return o(t)}}),o)}))}function eu(e,i){if(void 0===i&&(i=null),this.obb)return t.Label.prototype.occluded.call(this,e,i);if(this.obbs)for(var r=0;r<this.obbs.length;r++){var n={aabb:this.aabbs[r],obb:this.obbs[r]};if(t.Label.prototype.occluded.call(n,e,i))return!0}return!1}var iu=function(){function e(e){var i=e.scene;this.scene=i,this.tiles={},this.pyramid=new Xc,this.visible_coords={},this.queued_coords=[],this.building_tiles=null,this.renderable_tiles=[],this.collision={tile_keys:null,mesh_set:null,zoom:null,zoom_steps:3},this.main_thread_target=["TileManager",this.scene.id].join("_"),t.WorkerBroker.addTarget(this.main_thread_target,this)}var i=e.prototype;return i.destroy=function(){this.forEachTile((function(t){return t.destroy()})),this.tiles={},this.pyramid=null,this.visible_coords={},this.queued_coords=[],this.scene=null,t.WorkerBroker.removeTarget(this.main_thread_target)},i.keepTile=function(t){this.tiles[t.key]=t,this.pyramid.addTile(t)},i.hasTile=function(t){return void 0!==this.tiles[t]},i.forgetTile=function(t){if(this.hasTile(t)){var e=this.tiles[t];this.pyramid.removeTile(e)}delete this.tiles[t],this.tileBuildStop(t)},i.removeTile=function(e){t.log("trace","tile unload for "+e);var i=this.tiles[e];null!=i&&i.destroy(),this.forgetTile(i.key),this.scene.requestRedraw()},i.forEachTile=function(t){for(var e in this.tiles)t(this.tiles[e])},i.removeTiles=function(t){var e=[];for(var i in this.tiles)t(this.tiles[i])&&e.push(i);for(var r=0;r<e.length;r++){var n=e[r];this.removeTile(n)}},i.updateTilesForView=function(){this.visible_coords={};for(var t=this.view.findVisibleTileCoordinates(),e=0;e<t.length;e++){var i=t[e];this.queueCoordinate(i),this.visible_coords[i.key]=i}this.updateTileStates()},i.updateTileStates=function(){var t=this;return this.forEachTile((function(e){t.updateVisibility(e)})),this.loadQueuedCoordinates(),this.updateProxyTiles(),this.view.pruneTilesForView(),this.updateRenderableTiles(),this.style_manager.updateActiveStyles(this.renderable_tiles),this.style_manager.updateActiveBlendOrders(this.renderable_tiles),this.updateLabels()},i.updateLabels=function(){var e=this;if(this.scene.building&&!this.scene.building.initial)return Promise.resolve({});var i=this.renderable_tiles.filter((function(t){return t.valid})).filter((function(t){return t.built}));return 0===i.length?Promise.resolve({}):(i.sort((function(t,e){return t.build_id<e.build_id?-1:t.build_id>e.build_id?1:0})),this.collision.zoom===ru(this.view.zoom,this.collision.zoom_steps)&&this.collision.tile_keys===JSON.stringify(i.map((function(t){return t.key})))&&this.collision.mesh_set===nu(i)?Promise.resolve({}):(this.collision.task||(this.collision.zoom=ru(this.view.zoom,this.collision.zoom_steps),this.collision.tile_keys=JSON.stringify(i.map((function(t){return t.key}))),this.collision.mesh_set=nu(i),this.collision.task={type:"tileManagerUpdateLabels",run:function(r){return new Promise((function(n,o){var s;return Promise.resolve(tu(i,e.collision.zoom,e.isLoadingVisibleTiles())).then((function(i){try{return s=i,e.scene.requestRedraw(),e.collision.task=null,t.Task.finish(r,s),e.updateTileStates(),n()}catch(t){return o(t)}}),o)}))},immediate:!0},t.Task.add(this.collision.task)),this.collision.task.promise))},i.updateProxyTiles=function(){var t=this;if(0!==this.view.zoom_direction){this.forEachTile((function(t){return t.setProxyFor(null)}));var e=!1;this.forEachTile((function(i){if(i.visible&&!i.labeled){var r=t.pyramid.getAncestor(i);if(r)r.setProxyFor(i),e=!0;else for(var n=t.pyramid.getDescendants(i),o=0;o<n.length;o++)n[o].setProxyFor(i),e=!0}})),e||(this.view.zoom_direction=0)}},i.updateVisibility=function(e){if(e.visible=!1,e.style_z===this.view.tile_zoom)if(this.visible_coords[e.coords.key])e.visible=!0;else for(var i in this.visible_coords)if(t.TileID.isDescendant(e.coords,this.visible_coords[i])){e.visible=!0;break}},i.pruneToVisibleTiles=function(){this.removeTiles((function(t){return!t.visible}))},i.getRenderableTiles=function(){return this.renderable_tiles},i.updateRenderableTiles=function(){for(var t in this.renderable_tiles=[],this.tiles){var e=this.tiles[t];e.visible&&e.loaded&&this.renderable_tiles.push(e)}return this.renderable_tiles},i.isLoadingVisibleTiles=function(){var t=this;return Object.keys(this.tiles).some((function(e){return t.tiles[e].visible&&!t.tiles[e].built}))},i.allVisibleTilesLabeled=function(){return this.renderable_tiles.every((function(t){return t.labeled}))},i.queueCoordinate=function(t){this.queued_coords[this.queued_coords.length]=t},i.loadQueuedCoordinates=function(){var e=this;0!==this.queued_coords.length&&(this.queued_coords.sort((function(i,r){var n=e.view.center.meters,o=t.Geo.metersPerTile(i.z)/2,s=t.Geo.metersForTile(i);s.x+=o,s.y-=o;var a=t.Geo.metersForTile(r);a.x+=o,a.y-=o;var l=Math.abs(n.x-s.x)+Math.abs(n.y-s.y),c=Math.abs(n.x-a.x)+Math.abs(n.y-a.y);return i.center_dist=l,r.center_dist=c,c>l?-1:c===l?0:1})),this.queued_coords.forEach((function(t){return e.loadCoordinate(t)})),this.queued_coords=[])},i.loadCoordinate=function(e){if(e.z===this.view.center.tile.z)for(var i in this.scene.sources){var r=this.scene.sources[i];if(r.builds_geometry_tiles&&r.includesTile(e,this.view.tile_zoom)){var n=t.TileID.normalizedKey(e,r,this.view.tile_zoom);if(n&&!this.hasTile(n)){t.log("trace","load tile "+n+", distance from view center: "+e.center_dist);var o=new t.Tile({source:r,coords:e,workers:this.scene.workers,style_z:this.view.baseZoom(e.z),view:this.view});this.keepTile(o),this.buildTile(o)}}}},i.buildTile=function(t,e){this.tileBuildStart(t.key),this.updateVisibility(t),t.build(this.scene.generation,e)},i.buildTileStylesCompleted=function(e){var i=e.tile,r=e.progress;if(null==this.tiles[i.key])t.log("trace","discarded tile "+i.key+" in TileManager.buildTileStylesCompleted because previously removed"),t.Tile.abortBuild(i),this.updateTileStates();else if(i.generation!==this.scene.generation)t.log("trace","discarded tile "+i.key+" in TileManager.buildTileStylesCompleted because built with scene config gen "+i.generation+", current "+this.scene.generation),t.Tile.abortBuild(i),this.updateTileStates();else{if(this.tiles[i.key]){if(i.id<this.tiles[i.key].id)return t.log("trace","discarded tile "+i.key+" for id "+i.id+" in TileManager.buildTileStylesCompleted because built for discarded tile id"),void t.Tile.abortBuild(i);i=this.tiles[i.key].merge(i)}r.done&&(i.built=!0),i.buildMeshes(this.scene.styles,r),this.updateTileStates(),this.scene.requestRedraw()}r.done&&this.tileBuildStop(i.key)},i.buildTileError=function(e){t.log("error","Error building tile "+e.key+":",e.error),this.forgetTile(e.key),t.Tile.abortBuild(e)},i.tileBuildStart=function(e){this.building_tiles=this.building_tiles||{},this.building_tiles[e]=!0,t.log("trace","tileBuildStart for "+e+": "+Object.keys(this.building_tiles).length)},i.tileBuildStop=function(e){this.building_tiles&&(t.log("trace","tileBuildStop for "+e+": "+Object.keys(this.building_tiles).length),delete this.building_tiles[e],this.checkBuildQueue())},i.checkBuildQueue=function(){this.building_tiles&&0!==Object.keys(this.building_tiles).length||(this.building_tiles=null,this.scene.tileManagerBuildDone())},i.getDebugProp=function(t,e){var i=[];for(var r in this.tiles)null==this.tiles[r].debug[t]||"function"==typeof e&&!0!==e(this.tiles[r])||i.push(this.tiles[r].debug[t]);return i},i.getDebugSum=function(t,e){var i=0;for(var r in this.tiles)null==this.tiles[r].debug[t]||"function"==typeof e&&!0!==e(this.tiles[r])||(i+=this.tiles[r].debug[t]);return i},i.getDebugAverage=function(t,e){return this.getDebugSum(t,e)/Object.keys(this.tiles).length},t._createClass(e,[{key:"view",get:function(){return this.scene.view}},{key:"style_manager",get:function(){return this.scene.style_manager}}]),e}();function ru(t,e,i){return void 0===i&&(i=2),(Math.floor(t*e)/e).toFixed(i)}function nu(t){return JSON.stringify(Object.entries(t).map((function(t){var e=t[1];return Object.entries(e.meshes).map((function(t){return t[1].map((function(t){return t.created_at}))}))})))}var ou=function(){function t(t,e){e(t),this.value=t,this.setup=e}return t.prototype.set=function(t){JSON.stringify(this.value)!==JSON.stringify(t)&&(this.setup(t),this.value=t)},t}(),su=function(t){this.defaults={},this.defaults.culling=!0,this.defaults.culling_face=t.BACK,this.defaults.blending=!1,this.defaults.blending_src=t.ONE_MINUS_SRC_ALPHA,this.defaults.blending_dst=t.ONE_MINUS_SRC_ALPHA,this.defaults.blending_src_alpha=t.ONE,this.defaults.blending_dst_alpha=t.ONE_MINUS_SRC_ALPHA,this.defaults.depth_write=!0,this.defaults.depth_test=!0,t.depthFunc(t.LESS),this.culling=new ou({cull:this.defaults.culling,face:this.defaults.culling_face},(function(e){e.cull?(t.enable(t.CULL_FACE),t.cullFace(e.face)):t.disable(t.CULL_FACE)})),this.blending=new ou({blend:this.defaults.blending,src:this.defaults.blending_src,dst:this.defaults.blending_dst,src_alpha:this.defaults.blending_src_alpha,dst_alpha:this.defaults.blending_dst_alpha},(function(e){e.blend?(t.enable(t.BLEND),e.src_alpha&&e.dst_alpha?t.blendFuncSeparate(e.src,e.dst,e.src_alpha,e.dst_alpha):t.blendFunc(e.src,e.dst)):t.disable(t.BLEND)})),this.depth_write=new ou({depth_write:this.defaults.depth_write},(function(e){t.depthMask(e.depth_write)})),this.depth_test=new ou({depth_test:this.defaults.depth_test},(function(e){e.depth_test?t.enable(t.DEPTH_TEST):t.disable(t.DEPTH_TEST)}))};t.require$$0("Uint8",1,(function(t){return function(e,i,r){return t(this,e,i,r)}}),!0);var au,lu=function(){function e(){this.canvas=null,this.gl=null,this.screenshot_canvas=null,this.screenshot_context=null,this.queue_screenshot=null,this.video_capture=null}var i=e.prototype;return i.setCanvas=function(t,e){this.canvas=t,this.gl=e},i.screenshot=function(t){var e=this,i=(void 0===t?{}:t).background;return null!=this.queue_screenshot||(this.queue_screenshot={background:i},this.queue_screenshot.promise=new Promise((function(t,i){e.queue_screenshot.resolve=t,e.queue_screenshot.reject=i}))),this.queue_screenshot.promise},i.completeScreenshot=function(){if(null!=this.queue_screenshot){var e=this.canvas.width,i=this.canvas.height,r=new Uint8Array(e*i*4);this.gl.readPixels(0,0,e,i,this.gl.RGBA,this.gl.UNSIGNED_BYTE,r);var n=this.queue_screenshot.background;n=n&&"transparent"!==n?t.StyleParser.parseColor(n).slice(0,3).map((function(t){return 255*t})):null;for(var o=new Uint8ClampedArray(e*i*4),s=0;s<i;s++)for(var a=0;a<e;a++){var l=4*((i-s-1)*e+a),c=4*(s*e+a),u=r[l+3];o[c+0]=255*r[l+0]/u,o[c+1]=255*r[l+1]/u,o[c+2]=255*r[l+2]/u,o[c+3]=u,n&&(u/=255,o[c+0]=o[c+0]*u+n[0]*(1-u),o[c+1]=o[c+1]*u+n[1]*(1-u),o[c+2]=o[c+2]*u+n[2]*(1-u),o[c+3]=255)}this.screenshot_canvas=this.screenshot_canvas||document.createElement("canvas");var h=this.screenshot_canvas;h.width=e,h.height=i,this.screenshot_context=this.screenshot_context||h.getContext("2d");var d=this.screenshot_context,p=new ImageData(o,e,i);d.putImageData(p,0,0);for(var f=h.toDataURL("image/png"),A=atob(f.slice(22)),m=new Uint8Array(A.length),g=0;g<A.length;++g)m[g]=A.charCodeAt(g);var _=new Blob([m],{type:"image/png"});this.queue_screenshot.resolve({url:f,blob:_,type:"png"}),this.queue_screenshot=null}},i.startVideoCapture=function(){var e=this;if("function"!=typeof window.MediaRecorder||!this.canvas||"function"!=typeof this.canvas.captureStream)return t.log("warn","Video capture (Canvas.captureStream and/or MediaRecorder APIs) not supported by browser"),!1;if(this.video_capture)return t.log("warn","Video capture already in progress, call Scene.stopVideoCapture() first"),!1;try{var i=this.video_capture={};i.chunks=[],i.stream=this.canvas.captureStream(),i.options={mimeType:"video/webm"},i.media_recorder=new MediaRecorder(i.stream,i.options),i.media_recorder.ondataavailable=function(r){if(r.data.size>0&&i.chunks.push(r.data),i.resolve){var n=new Blob(i.chunks,{type:i.options.mimeType}),o=t.createObjectURL(n);i.stream&&(i.stream.getTracks()||[]).forEach((function(t){t.stop(),i.stream.removeTrack(t)})),i.stream=null,i.media_recorder=null,e.video_capture=null,i.resolve({url:o,blob:n,type:"webm"})}},i.media_recorder.start()}catch(e){return this.video_capture=null,t.log("error","Scene video capture failed",e),!1}return!0},i.stopVideoCapture=function(){var e=this;return this.video_capture?(this.video_capture.promise=new Promise((function(t,i){e.video_capture.resolve=t,e.video_capture.reject=i})),this.video_capture.media_recorder.stop(),this.video_capture.promise):(t.log("warn","No scene video capture in progress, call Scene.startVideoCapture() first"),Promise.resolve({}))},e}(),cu=function(){function e(i,r){var n;r=r||{},t.subscribeMixin(this),this.id=e.id++,this.initialized=!1,this.initializing=null,this.sources={},this.view=new t.View(this,r),this.tile_manager=new iu({scene:this}),this.num_workers=r.numWorkers||2,!0===r.disableVertexArrayObjects&&(t.VertexArrayObject.disabled=!0),t.Utils.use_high_density_display=void 0===r.highDensityDisplay||r.highDensityDisplay,t.Utils.updateDevicePixelRatio(),this.config=null,this.config_source=i,this.config_bundle=null,this.last_valid_config_source=null,this.styles=null,this.style_manager=new t.StyleManager,this.building=null,this.dirty=!0,r.preUpdate&&this.subscribe({pre_update:r.preUpdate}),r.postUpdate&&this.subscribe({post_update:r.postUpdate}),this.render_loop=!r.disableRenderLoop,this.render_loop_active=!1,this.render_loop_stop=!1,this.render_count=0,this.last_render_count=0,this.render_count_changed=!1,this.frame=0,this.last_main_render=-1,this.last_selection_render=-1,this.media_capture=new lu,this.selection=null,this.selection_feature_count=0,this.fetching_selection_map=null,this.prev_textures=null,this.introspection=!0===r.introspection,this.times={},this.resetTime(),this.container=r.container,this.canvas=null,this.contextOptions=r.webGLContextOptions,this.lights=null,this.background=null,this.createListeners(),this.updating=0,this.generation=e.generation,this.last_complete_generation=e.generation,(n=this).debug={profile:function(e){console.profile("main thread: "+e),t.WorkerBroker.postMessage(n.workers,"self.profile",e)},profileEnd:function(e){console.profileEnd("main thread: "+e),t.WorkerBroker.postMessage(n.workers,"self.profileEnd",e)},timeRebuild:function(e,i){void 0===e&&(e=1),void 0===i&&(i={});var r=[];!function o(){var s=+new Date;n.rebuild(i).then((function(){if(r.push(+new Date-s),r.length<e)o();else{var i=~~(r.reduce((function(t,e){return t+e}))/r.length);t.log("info","Profiled rebuild "+e+" times: "+i+" avg ("+Math.min.apply(Math,r)+" min, "+Math.max.apply(Math,r)+" max)")}}))}()},geometryCountByStyle:function(){var t={};return n.tile_manager.getRenderableTiles().forEach((function(e){var i=function(i){t[i]=t[i]||0,e.meshes[i].forEach((function(e){t[i]+=e.geometry_count}))};for(var r in e.meshes)i(r)})),t},geometryCountByBaseStyle:function(){var t=n.debug.geometryCountByStyle(),e={};for(var i in t){var r=n.styles[i].baseStyle();e[r]=e[r]||0,e[r]+=t[i]}return e},geometryCountTotal:function(){var t=n.debug.geometryCountByStyle();return Object.keys(t).reduce((function(e,i){return t[i]+e}),0)},geometrySizeByStyle:function(){var t={};return n.tile_manager.getRenderableTiles().forEach((function(e){var i=function(i){t[i]=t[i]||0,e.meshes[i].forEach((function(e){t[i]+=e.buffer_size}))};for(var r in e.meshes)i(r)})),t},geometrySizeByBaseStyle:function(){var t=n.debug.geometrySizeByStyle(),e={};for(var i in t){var r=n.styles[i].baseStyle();e[r]=e[r]||0,e[r]+=t[i]}return e},geometrySizeTotal:function(){var t=n.debug.geometrySizeByStyle();return Object.keys(t).reduce((function(e,i){return t[i]+e}),0)},textureSizeTotal:function(){return Object.values(t.Texture.textures).map((function(t){return t.byteSize()})).reduce((function(t,e){return t+e}))},layerStats:function(){return t.debugSettings.layer_stats?t.debugSumLayerStats(n.tile_manager.getRenderableTiles()):(t.log("warn","Enable the 'layer_stats' debug setting to collect layer stats"),{})},renderableTilesCount:function(){return n.tile_manager.getRenderableTiles().length}},this.log_level=r.logLevel||"warn",t.log.setLevel(this.log_level),t.log.reset()}e.create=function(t,i){return void 0===i&&(i={}),new e(t,i)};var n=e.prototype;return n.load=function(e,i){var r=this;return void 0===e&&(e=null),void 0===i&&(i={}),this.initializing||(t.log.reset(),this.updating++,this.initialized=!1,this.view_complete=!1,this.times.frame=null,this.times.build=null,(i="string"==typeof i?{base_path:i}:i).blocking=void 0===i.blocking||i.blocking,!1!==this.render_loop&&this.setupRenderLoop(),this.createCanvas(),this.prev_textures=this.config&&Object.keys(this.config.textures),this.initializing=this.loadScene(e,i).then((function(e){return new Promise((function(n,o){var s,a,l;return s=e.texture_nodes,Promise.resolve(r.createWorkers()).then(function(e){try{if(r.destroyFeatureSelection(),t.WorkerBroker.postMessage(r.workers,"self.clearFunctionStringCache"),a="object"==typeof r.config_source||r.hasSubscribersFor("load"),l=r.updateConfig({texture_nodes:s,serialize_funcs:a,normalize:!1,loading:!0,fade_in:!0}),!0===i.blocking)return Promise.resolve(l).then(function(t){try{return c.call(this)}catch(t){return o(t)}}.bind(this),o);function c(){return r.freePreviousTextures(),r.updating--,r.initializing=null,r.initialized=!0,r.last_valid_config_source=r.config_source,r.last_valid_options={base_path:i.base_path,file_type:i.file_type},r.requestRedraw(),n()}return c.call(this)}catch(u){return o(u)}}.bind(this),o)}))})).catch((function(e){var i,n;if(r.initializing=null,r.updating=0,"YAMLException"===e.name?(i="yaml",n="Error parsing scene YAML"):n="Error initializing scene",r.trigger("error",{type:i,message:n,error:e,url:r.config_source}),n="Scene.load() failed to load "+JSON.stringify(r.config_source)+": "+e.message,r.last_valid_config_source)return t.log("warn",n,e),t.log("info","Scene.load() reverting to last valid configuration"),r.load(r.last_valid_config_source,r.last_valid_base_path);throw t.log("error",n,e),e}))),this.initializing},n.destroy=function(){if(this.initialized=!1,this.render_loop_stop=!0,this.destroyListeners(),this.destroyFeatureSelection(),this.canvas&&this.canvas.parentNode&&(this.canvas.parentNode.removeChild(this.canvas),this.canvas=null),this.container=null,this.gl){t.Texture.destroy(this.gl),this.style_manager.destroy(this.gl),this.styles={},t.ShaderProgram.reset();var e=this.gl.getExtension("WEBGL_lose_context");e&&e.loseContext(),this.gl=null}this.sources={},this.destroyWorkers(),this.tile_manager.destroy(),this.tile_manager=null,t.log.reset()},n.createCanvas=function(){if(!this.canvas){this.container=this.container||document.body,this.canvas=document.createElement("canvas"),this.canvas.style.position="absolute",this.canvas.style.top=0,this.canvas.style.left=0,this.container.style.backgroundColor="transparent",this.container.appendChild(this.canvas);try{this.gl=r.getContext(this.canvas,Object.assign({alpha:!0,premultipliedAlpha:!0,stencil:!0,device_pixel_ratio:t.Utils.device_pixel_ratio,powerPreference:"high-performance"},this.contextOptions))}catch(t){throw new Error("Couldn't create WebGL context. Your browser may not support WebGL, or it's turned off? Visit http://webglreport.com/ for more info.")}this.resizeMap(this.container.clientWidth,this.container.clientHeight),t.VertexArrayObject.init(this.gl),this.render_states=new su(this.gl),this.media_capture.setCanvas(this.canvas,this.gl)}},n.updateExternalScripts=function(){var t=[].concat(this.external_scripts||[]),e=[];if(this.config.scene.scripts)for(var i in this.config.scene.scripts)-1===e.indexOf(this.config.scene.scripts[i])&&e.push(this.config.scene.scripts[i]);for(var r in this.config.sources){var n=this.config.sources[r];if(n.scripts)for(var o in n.scripts)-1===e.indexOf(n.scripts[o])&&e.push(n.scripts[o])}return this.external_scripts=e,!(this.external_scripts.length===t.length&&this.external_scripts.every((function(e,i){return e===t[i]})))},n.createWorkers=function(){return this.updateExternalScripts()&&this.destroyWorkers(),this.workers?Promise.resolve():this.makeWorkers()},n.makeWorkers=function(){var e=this,r=!!this.gl.getExtension("OES_element_index_uint"),n=[];this.workers=[];for(var o=function(o){var s=new Worker(i.workerURL);e.workers[o]=s,t.WorkerBroker.addWorker(s),t.log("debug","Scene.makeWorkers: initializing worker "+o);var a=o;n.push(t.WorkerBroker.postMessage(s,"self.init",e.id,o,e.num_workers,e.log_level,t.Utils.device_pixel_ratio,r,e.external_scripts).then((function(e){return t.log("debug","Scene.makeWorkers: initialized worker "+e),e}),(function(e){return t.log("error","Scene.makeWorkers: failed to initialize worker "+a+":",e),Promise.reject(e)})))},s=0;s<this.num_workers;s++)o(s);return this.next_worker=0,Promise.all(n).then((function(){t.log.setWorkers(e.workers)}))},n.destroyWorkers=function(){this.selection=null,Array.isArray(this.workers)&&(t.log.setWorkers(null),this.workers.forEach((function(t){t.terminate()})),this.workers=null)},n.ready=function(){return!(!this.view.ready()||0===Object.keys(this.sources).length)},n.updateDevicePixelRatio=function(){var e=this;t.Utils.updateDevicePixelRatio()&&t.WorkerBroker.postMessage(this.workers,"self.updateDevicePixelRatio",t.Utils.device_pixel_ratio).then((function(){return e.rebuild()})).then((function(){return e.resizeMap(e.view.size.css.width,e.view.size.css.height)}))},n.resizeMap=function(e,i){0===e&&0===i||(this.dirty=!0,this.view.setViewportSize(e,i),this.gl&&r.resize(this.gl,e,i,t.Utils.device_pixel_ratio))},n.requestRedraw=function(){this.dirty=!0},n.immediateRedraw=function(){this.dirty=!0,this.update()},n.renderLoop=function(){this.render_loop_active=!0,this.update(),t.Task.setState({user_moving_view:this.view.user_input_active}),t.Task.processAll(),this.render_loop_stop?(this.render_loop_stop=!1,this.render_loop_active=!1):window.requestAnimationFrame(this.renderLoop.bind(this))},n.setupRenderLoop=function(){var t=this;this.render_loop_active||setTimeout((function(){t.renderLoop()}),0)},n.update=function(){var e=this.dirty,i=!!this.selection&&this.selection.hasPendingRequests(),r=!(!1===e&&!1===i||!1===this.initialized||this.updating>0||!1===this.ready());return this.trigger("pre_update",r),this.view.update(),!!r&&(this.dirty=!1,this.updateDevicePixelRatio(),this.render({main:e,selection:i}),this.updateViewComplete(),this.media_capture.completeScreenshot(),this.trigger("post_update",r),(!0===this.animated||this.view.isAnimating())&&(this.dirty=!0),this.frame++,t.log("trace","Scene.render()"),!0)},n.render=function(e){var i=this,r=e.main,n=e.selection,o=this.gl;if(this.updateBackground(),Object.keys(this.lights).forEach((function(t){return i.lights[t].update()})),this.render_count_changed=!1,r&&(this.render_count=this.renderPass(),this.last_main_render=this.frame,this.render_count!==this.last_render_count&&(this.render_count_changed=!0,this.logFirstFrame(),this.getFeatureSelectionMapSize().then((function(e){i.selection_feature_count=e,t.log("info","Scene: rendered "+i.render_count+" primitives ("+e+" features in selection map)")}))),this.last_render_count=this.render_count),n){if(this.view.panning||this.view.user_input_active)return void this.selection.clearPendingRequests();!this.selection.locked&&this.last_selection_render<this.last_main_render&&(this.selection.bind(),this.renderPass("selection_program",{allow_blend:!1}),o.bindFramebuffer(o.FRAMEBUFFER,null),o.viewport(0,0,this.canvas.width,this.canvas.height),o.clearColor.apply(o,this.background.computed_color),this.last_selection_render=this.frame),this.selection.read()}return!0},n.renderPass=function(e,i){var r=this;void 0===e&&(e="program");var n=(void 0===i?{}:i).allow_blend;n=null==n||n,this.clearFrame();for(var o,s,a=0,l=this.style_manager.getActiveBlendOrders(),c=t._createForOfIteratorHelperLoose(l);!(s=c()).done;)for(var u=s.value,h=u.blend_order,d=u.styles,p=function(i){var s=r.styles[d[i]];if(null==s)return"continue";if(s.blend!==o){var l=Object.assign({},t.Style.render_states[s.blend],{blend:n&&s.blend});r.setRenderState(l)}var c=n&&s.blend;if("translucent"===c)r.gl.colorMask(!1,!1,!1,!1),r.renderStyle(s.name,e,h),r.gl.colorMask(!0,!0,!0,!0),r.gl.depthFunc(r.gl.EQUAL),r.gl.enable(r.gl.STENCIL_TEST),r.gl.clearStencil(0),r.gl.clear(r.gl.STENCIL_BUFFER_BIT),r.gl.stencilFunc(r.gl.EQUAL,r.gl.ZERO,255),r.gl.stencilOp(r.gl.KEEP,r.gl.KEEP,r.gl.INCR),a+=r.renderStyle(s.name,e,h),r.gl.disable(r.gl.STENCIL_TEST),r.gl.depthFunc(r.gl.LESS);else if("opaque"!==c&&!0===s.stencil_proxy_tiles){var u=r.tile_manager.getRenderableTiles().filter((function(t){return t.meshes[s.name]})).map((function(t){return t.proxy_level})).reduce((function(t,e){return t.indexOf(e)>-1||t.push(e),t}),[]).sort();if(u.length>1){r.gl.enable(r.gl.STENCIL_TEST),r.gl.clearStencil(0),r.gl.clear(r.gl.STENCIL_BUFFER_BIT),r.gl.stencilOp(r.gl.KEEP,r.gl.KEEP,r.gl.REPLACE);for(var p=0;p<u.length;p++)r.gl.stencilFunc(r.gl.GEQUAL,u.length-p,255),a+=r.renderStyle(s.name,e,h,u[p]);r.gl.disable(r.gl.STENCIL_TEST)}else a+=r.renderStyle(s.name,e,h)}else a+=r.renderStyle(s.name,e,h);o=s.blend},f=0;f<d.length;f++)p(f);return a},n.renderStyle=function(e,i,r,n){var o=this;void 0===n&&(n=null);for(var s,a=this.styles[e],l=!0,c=0,u=this.tile_manager.getRenderableTiles().filter((function(t){return"number"!=typeof n||t.proxy_level===n})).map((function(t){if(t.meshes[e])return[t,t.meshes[e].filter((function(t){return t.variant.blend_order===r}))]})).filter((function(t){return t})),h=Math.max.apply(Math,u.map((function(t){var e=t[1];return Math.max.apply(Math,e.map((function(t){return t.variant.mesh_order})))}))),d=function(r){for(var n,h=function(){var t=n.value,u=t[0],h=t[1],d=!0;if(!u.shouldProxyForStyle(e))return"continue";var p=h.filter((function(t){return t.variant.mesh_order===r}));return 0===p.length?"continue":!0!==l||(l=!1,s=o.setupStyle(a,i))?void p.forEach((function(t){!0===d&&(d=!1,o.view.setupTile(u,s)),a.render(t)&&o.requestRedraw(),c+=t.geometry_count})):{v:{v:0}}},d=t._createForOfIteratorHelperLoose(u);!(n=d()).done;){var p=h();if("continue"!==p&&"object"==typeof p)return p.v}},p=0;p<h+1;p++){var f=d(p);if("object"==typeof f)return f.v}return c},n.setupStyle=function(t,e){var i;try{if(!(i=t.getProgram(e)))return}catch(e){return void this.trigger("warning",{type:"styles",message:"Error compiling style "+t.name,style:t,shader_errors:t.program&&t.program.shader_errors})}for(var r in i.use(),t.setup(),i.uniform("1f","u_time",this.animated?(+new Date-this.start_time)/1e3:0),this.view.setupProgram(i),this.lights)this.lights[r].setupProgram(i);return i},n.clearFrame=function(){this.initialized&&(this.render_states.depth_write.set({depth_write:!0}),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT|this.gl.STENCIL_BUFFER_BIT))},n.setRenderState=function(t){var e=void 0===t?{}:t,i=e.depth_test,r=e.depth_write,n=e.cull_face,o=e.blend;if(this.initialized){var s=this.render_states;i=!1!==i&&s.defaults.depth_test,r=!1!==r&&s.defaults.depth_write,n=!1!==n&&s.defaults.culling,o=null!=o?o:s.defaults.blending;var a=this.gl;s.depth_test.set({depth_test:i}),s.depth_write.set({depth_write:r}),s.culling.set({cull:n,face:s.defaults.culling_face}),o?"opaque"===o?s.blending.set({blend:!1}):"overlay"===o||"inlay"===o||"translucent"===o?s.blending.set({blend:!0,src:a.SRC_ALPHA,dst:a.ONE_MINUS_SRC_ALPHA,src_alpha:a.ONE,dst_alpha:a.ONE_MINUS_SRC_ALPHA}):"add"===o?s.blending.set({blend:!0,src:a.ONE,dst:a.ONE}):"multiply"===o&&s.blending.set({blend:!0,src:a.ZERO,dst:a.SRC_COLOR}):s.blending.set({blend:!1})}},n.getFeatureAt=function(e,i){var r=(void 0===i?{}:i).radius;if(!this.initialized)return t.log("debug","Scene.getFeatureAt() called before scene was initialized"),Promise.resolve();if(0===this.selection_feature_count)return Promise.resolve();this.selection||this.resetFeatureSelection();var n={x:e.x/this.view.size.css.width,y:e.y/this.view.size.css.height};return r=r>0?{x:r/this.view.size.css.width,y:r/this.view.size.css.height}:null,this.selection.getFeatureAt(n,{radius:r}).then((function(t){return Object.assign(t,{pixel:e})})).catch((function(t){return Promise.resolve({error:t})}))},n.queryFeatures=function(e){return new Promise(function(i,r){var n,o,s,a,l,c,u,h,d,p,f,A,m,g,_,y,v;return o=(n=void 0===e?{}:e).filter,s=n.unique,a=void 0===s||s,l=n.group_by,c=void 0===l?null:l,h=void 0===(u=n.visible)?null:u,d=n.geometry,p=void 0!==d&&d,this.initialized?(o=t.Utils.serializeWithFunctions(o),f=!0===(a="string"==typeof a?[a]:a)||Array.isArray(a)&&a.indexOf("$id")>-1,A=a&&function(e){var i=Array.isArray(a)?t.sliceObject(e.properties,a):e.properties,r=f?e.id:null;return p?JSON.stringify({geometry:e.geometry,properties:i,id:r}):JSON.stringify({properties:i,id:r})},c=("string"==typeof c||Array.isArray(c))&&c,m=c&&function(e){return Array.isArray(c)?JSON.stringify(t.sliceObject(e,c)):e[c]},g=this.tile_manager.getRenderableTiles().map((function(t){return t.key})),Promise.resolve(t.WorkerBroker.postMessage(this.workers,"self.queryFeatures",{filter:o,visible:h,geometry:p,tile_keys:g})).then((function(t){try{return _=[],y={},v={},t.forEach((function(t){return t.forEach((function(t){if(A){var e=A(t);if(y[e])return;y[e]=!0}if(m){var i=m(t.properties);v[i]=v[i]||[],v[i].push(t)}else _.push(t)}))})),i(m?v:_)}catch(t){return r(t)}}),r)):i([])}.bind(this))},n.rebuild=function(i){var r=this,n=void 0===i?{}:i,o=n.initial,s=void 0!==o&&o,a=n.new_generation,l=void 0===a||a,c=n.sources,u=void 0===c?null:c,h=n.serialize_funcs,d=n.profile,p=void 0!==d&&d,f=n.fade_in,A=void 0!==f&&f;return new Promise((function(i,n){if(r.building){r.building.queued&&r.building.queued.reject&&(t.log("debug","Scene.rebuild: request superceded by a newer call"),r.building.queued.resolve(!1));var o={initial:s,new_generation:l,sources:u,serialize_funcs:h,profile:p,fade_in:A};return r.building.queued={resolve:i,reject:n,options:o},void t.log("trace","Scene.rebuild(): queuing request")}if(r.building={resolve:i,reject:n,initial:s},p&&r.debug.profile("Scene.rebuild"),l)for(var a in r.generation=++e.generation,r.styles)r.styles[a].setGeneration(r.generation);r.syncConfigToWorker({serialize_funcs:h}),r.resetWorkerFeatureSelection(u),r.resetTime(),r.tile_manager.pruneToVisibleTiles(),r.tile_manager.forEachTile((function(t){(!u||u.indexOf(t.source.name)>-1)&&r.tile_manager.buildTile(t,{fade_in:A})})),r.tile_manager.updateTilesForView(),r.tile_manager.checkBuildQueue()})).then((function(){p&&r.debug.profileEnd("Scene.rebuild")}))},n.tileManagerBuildDone=function(){if(t.TextCanvas.pruneTextCache(),this.building){t.log("info","Scene: build geometry finished"),this.building.resolve&&(this.logFirstBuild(),this.building.resolve(!0));var e=this.building.queued;this.building=null,e?(t.log("debug","Scene: starting queued rebuild() request"),this.rebuild(e.options).then(e.resolve,e.reject)):this.tile_manager.updateLabels()}},n.loadScene=function(e,i){return new Promise(function(r,n){var o,s,a,l,c,u,h;return void 0===e&&(e=null),s=(o=void 0===i?{}:i).base_path,a=o.file_type,this.config_source=e||this.config_source,"string"==typeof this.config_source?this.base_path=t.pathForURL(s||this.config_source):this.base_path=t.pathForURL(s),this.config_path=this.base_path,Promise.resolve(Wc.loadScene(this.config_source,{path:this.base_path,type:a})).then(function(t){try{return c=(l=t).config,u=l.bundle,h=l.texture_nodes,this.config=c,this.config_bundle=u,r({texture_nodes:h})}catch(t){return n(t)}}.bind(this),n)}.bind(this))},n.setDataSource=function(e,i){if(e&&i&&i.type&&(i.url||i.data)){var r=null==this.config.sources[e],n=this.config.sources[e]=Object.assign({},i);return n.data&&"object"==typeof n.data&&(n.url=t.createObjectURL(new Blob([JSON.stringify(n.data)])),delete n.data),r?this.updateConfig({rebuild:{sources:[e]}}):this.rebuild({sources:[e]})}t.log("error","No name provided or not a valid config:",e,i)},n.createDataSources=function(e){var i=this;void 0===e&&(e=!1);var r=[],n=Object.keys(this.sources),o=0;for(var s in this.config.sources){var a=this.config.sources[s],l=this.sources[s];try{var c=Object.assign({},a,{name:s,id:o++});if(this.sources[s]=t.DataSource.create(c,this.sources),!this.sources[s])throw{}}catch(e){delete this.sources[s];var u="Could not create data source: "+e.message;t.log("warn","Scene: "+u,a),this.trigger("warning",{type:"sources",source:a,message:u})}(e||t.DataSource.tileLayoutChanged(this.sources[s],l))&&r.push(s)}for(var h in n.forEach((function(t){i.config.sources[t]||(delete i.sources[t],r.push(t))})),r.length>0&&this.tile_manager.removeTiles((function(t){return r.indexOf(t.source.name)>-1})),this.config.layers){var d=this.config.layers[h];!1!==d.enabled&&d.data&&this.sources[d.data.source]&&(this.sources[d.data.source].builds_geometry_tiles=!0)}},n.loadTextures=function(){var e=this;return t.Texture.createFromObject(this.gl,this.config.textures).then((function(){return t.Texture.createDefault(e.gl)}))},n.freePreviousTextures=function(){var e=this;this.prev_textures&&(this.prev_textures.forEach((function(i){!e.config.textures[i]&&t.Texture.textures[i]&&t.Texture.textures[i].destroy()})),this.prev_textures=null)},n.updateStyles=function(){if(!this.initialized&&!this.initializing)throw new Error("Scene.updateStyles() called before scene was initialized");for(var t in this.styles=this.style_manager.build(this.config.styles),this.style_manager.initStyles(this),this.styles)this.styles[t].setGL(this.gl);this.dirty=!0},n.getActiveCamera=function(){return this.view.getActiveCamera()},n.setActiveCamera=function(t){return this.view.setActiveCamera(t)},n.createLights=function(){for(var e in this.lights={},t.debugSettings.wireframe&&(t.Light.enabled=!1),this.config.lights)if(this.config.lights[e]&&"object"==typeof this.config.lights[e]){var i=this.config.lights[e];i.name=e.replace("-","_"),i.visible=!1!==i.visible,i.visible&&(this.lights[i.name]=t.Light.create(this.view,i))}t.Light.inject(this.lights)},n.setBackground=function(){var e=this.config.scene.background;this.background={},e&&e.color&&(this.background.color=t.StyleParser.createColorPropertyCache(e.color)),this.background.color||(this.background.color=t.StyleParser.createColorPropertyCache([0,0,0,0]))},n.updateBackground=function(){var e,i=this.background.computed_color,r=this.background.computed_color=t.StyleParser.evalCachedColorProperty(this.background.color,{zoom:this.view.tile_zoom});i&&!r.some((function(t,e){return i[e]!==t}))||(1===r[3]?this.canvas.style.backgroundColor="rgba("+r.map((function(t){return Math.floor(255*t)})).join(", ")+")":this.canvas.style.backgroundColor="transparent",(e=this.gl).clearColor.apply(e,r))},n.setIntrospection=function(t){var e=this;return t!==this.introspection?(this.introspection=null!=t&&t,this.updating++,this.updateConfig({normalize:!1}).then((function(){return e.updating--}))):Promise.resolve()},n.updateConfig=function(i){var r=this,n=void 0===i?{}:i,o=n.loading,s=void 0!==o&&o,a=n.rebuild,l=void 0===a||a,c=n.serialize_funcs,u=n.texture_nodes,h=void 0===u?{}:u,d=n.normalize,p=void 0===d||d,f=n.fade_in,A=void 0!==f&&f;this.generation=++e.generation,this.updating++,this.config=Wc.applyGlobalProperties(this.config),p&&Wc.normalize(this.config,this.config_bundle,h),Wc.hoistTextureNodes(this.config,this.config_bundle,h),this.trigger(s?"load":"update",{config:this.config}),this.style_manager.init(),this.view.reset(),this.createLights(),this.createDataSources(s),this.loadTextures(),this.setBackground(),t.FontManager.loadFonts(this.config.fonts),this.updateStyles();var m=l?this.rebuild(Object.assign({initial:s,new_generation:!1,serialize_funcs:c,fade_in:A},"object"==typeof l&&l)):this.syncConfigToWorker({serialize_funcs:c});return this.updating--,this.view.updateBounds(),this.requestRedraw(),m.then((function(){r.last_render_count=0,r.requestRedraw()}))},n.syncConfigToWorker=function(e){var i=(void 0===e?{}:e).serialize_funcs,r=void 0===i||i?t.Utils.serializeWithFunctions(this.config):JSON.stringify(this.config);return t.WorkerBroker.postMessage(this.workers,"self.updateConfig",{config:r,generation:this.generation,introspection:this.introspection},t.debugSettings)},n.createListeners=function(){var e=this;this.listeners={},this.listeners.view={move:function(){return e.trigger("move")}},this.view.subscribe(this.listeners.view),this.listeners.texture={update:function(){return e.dirty=!0},warning:function(t){return e.trigger("warning",Object.assign({type:"textures"},t))}},t.Texture.subscribe(this.listeners.texture),this.listeners.scene_loader={error:function(t){return e.trigger("error",Object.assign({type:"scene"},t))}},Wc.subscribe(this.listeners.scene_loader)},n.destroyListeners=function(){this.unsubscribeAll(),this.view.unsubscribe(this.listeners.view),t.Texture.unsubscribe(this.listeners.texture),Wc.unsubscribe(this.listeners.scene_loader),this.listeners=null},n.destroyFeatureSelection=function(){this.selection&&(this.selection.destroy(),this.selection=null)},n.resetFeatureSelection=function(){var e=this;this.selection=new t.FeatureSelection(this.gl,this.workers,(function(){return e.building})),this.last_render_count=0},n.resetWorkerFeatureSelection=function(e){void 0===e&&(e=null),this.workers&&t.WorkerBroker.postMessage(this.workers,"self.resetFeatureSelection",e)},n.getFeatureSelectionMapSize=function(){var e=this;return null==this.fetching_selection_map&&(this.fetching_selection_map=t.WorkerBroker.postMessage(this.workers,"self.getFeatureSelectionMapSize").then((function(t){return e.fetching_selection_map=null,t.reduce((function(t,e){return t+e}))}))),this.fetching_selection_map},n.resetTime=function(){this.start_time=+new Date},n.updateViewComplete=function(){!this.render_count_changed&&this.generation===this.last_complete_generation||this.building||this.tile_manager.isLoadingVisibleTiles()||!this.tile_manager.allVisibleTilesLabeled()||(this.tile_manager.updateLabels(),this.last_complete_generation=this.generation,this.trigger("view_complete",{first:!0!==this.view_complete}),this.view_complete=!0)},n.resetViewComplete=function(){this.last_complete_generation=null},n.screenshot=function(t){var e=(void 0===t?{}:t).background,i=void 0===e?"white":e;return this.requestRedraw(),this.media_capture.screenshot({background:i})},n.startVideoCapture=function(){return this.requestRedraw(),this.media_capture.startVideoCapture()},n.stopVideoCapture=function(){return this.media_capture.stopVideoCapture()},n.logFirstFrame=function(){0!==this.last_render_count||this.times.first_frame||(this.times.first_frame=+new Date-this.start_time,t.log("debug","Scene: initial frame time: "+this.times.first_frame))},n.logFirstBuild=function(){null==this.times.first_build&&(this.times.first_build=+new Date-this.start_time,t.log("debug","Scene: initial build time: "+this.times.first_build))},t._createClass(e,[{key:"animated",get:function(){var t=this;return!1!==this.config.scene.animated&&this.style_manager.getActiveStyles().some((function(e){return t.styles[e].animated}))}}]),e}();cu.id=0,cu.generation=0;var uu={map:{},scrollWheelZoom:{},doubleClickZoom:{}};return{leafletLayer:function(e){return function(e){if(void 0!==au)return new au(e);if(t.Thread.is_main){var i,r=e.leaflet||window.L,n=r.GridLayer?r.GridLayer:r.TileLayer,o=n===r.GridLayer?"1.x":"0.7.x",s={};return n===r.TileLayer&&(s._addTile=function(){},s._removeTile=function(){},s._reset=function(){n.prototype._reset.apply(this,arguments),this.scene&&this.scene.container&&this.scene.canvas&&this.scene.container.appendChild(this.scene.canvas)}),Object.assign(s,{initialize:function(t){t.showDebug=!!t.showDebug,r.setOptions(this,t),this.updateTangramDebugSettings(),this.createScene(),this.hooks={},this._updating_tangram=!1},createScene:function(){this.scene=cu.create(this.options.scene,{numWorkers:this.options.numWorkers,preUpdate:this.options.preUpdate,postUpdate:this.options.postUpdate,continuousZoom:"1.x"===au.leafletVersion,wrapView:!0!==this.options.noWrap,highDensityDisplay:this.options.highDensityDisplay,logLevel:this.options.logLevel,introspection:this.options.introspection,webGLContextOptions:this.options.webGLContextOptions,disableRenderLoop:this.options.disableRenderLoop})},onAdd:function(e){var i=this;this.scene||this.createScene(),n.prototype.onAdd.apply(this,arguments),this.hooks.resize=function(){i._updating_tangram=!0,i.updateSize(),i._updating_tangram=!1},e.on("resize",this.hooks.resize),this.hooks.move=function(){if(!i._updating_tangram){i._updating_tangram=!0,i.scene.view.setPanning(!0);var r=e.getCenter();r.zoom=Math.max(Math.min(e.getZoom(),e.getMaxZoom()||t.Geo.default_view_max_zoom),e.getMinZoom()),i.scene.view.setView(r),i._mapLayerCount>1&&i.scene.immediateRedraw(),i._updating_tangram=!1}},e.on("move",this.hooks.move),this.hooks.moveend=function(){i.scene.view.setPanning(!1),i.scene.requestRedraw()},e.on("moveend",this.hooks.moveend),this.hooks.drag=function(){i.scene.view.markUserInput()},e.on("drag",this.hooks.drag),this._map_pane_observer=new MutationObserver((function(t){t.forEach((function(){return i.reverseTransform()}))})),this._map_pane_observer.observe(e.getPanes().mapPane,{attributes:!0}),this.modifyScrollWheelBehavior(e),this.modifyZoomBehavior(e),this.trackMapLayerCounts(e),this.setupSelectionEventHandlers(e),this.setSelectionEvents(this.options.events,{radius:this.options.selectionRadius}),this.scene.container=this.getContainer(),this.updateSize(),this.updateView(),this.resizeOnFirstVisible(),this.scene.subscribe({move:this.onTangramViewUpdate.bind(this)}),this.scene.load(this.options.scene,{base_path:this.options.sceneBasePath,file_type:this.options.sceneFileType,blocking:!1}).then((function(){if(!i.options.attribution)for(var t=0,r=Object.entries(i.scene.config.sources);t<r.length;t++){var n=r[t][1];n.attribution&&e.attributionControl.addAttribution(n.attribution)}i._updating_tangram=!0,i.updateSize(),i.updateView(),i.reverseTransform(),i._updating_tangram=!1,i.fire("init")})).catch((function(t){i.fire("error",t)}))},onRemove:function(t){n.prototype.onRemove.apply(this,arguments),t.off("layeradd layerremove overlayadd overlayremove",this._updateMapLayerCount),t.off("resize",this.hooks.resize),t.off("move",this.hooks.move),t.off("moveend",this.hooks.moveend),t.off("drag",this.hooks.drag),t.off("click",this.hooks.click),t.off("mousemove",this.hooks.mousemove),t.off("mouseout",this.hooks.mouseout),document.removeEventListener("visibilitychange",this.hooks.visibilitychange),this.hooks={},this._map_pane_observer.disconnect(),this.scene&&(this.scene.destroy(),this.scene=null)},createTile:function(t){var e=t.x+"/"+t.y+"/"+t.z,i=document.createElement("div");if(i.setAttribute("data-tile-key",e),i.style.width="256px",i.style.height="256px",this.options.showDebug){var r=document.createElement("div");r.textContent=e,r.style.position="absolute",r.style.left=0,r.style.top=0,r.style.color="white",r.style.fontSize="16px",r.style.textOutline="1px #000000",r.style.padding="8px",i.appendChild(r),i.style.borderStyle="solid",i.style.borderColor="white",i.style.borderWidth="1px"}return i},modifyScrollWheelBehavior:function(t){if(this.scene.view.continuous_zoom&&t.scrollWheelZoom&&!1!==this.options.modifyScrollWheel){t.options.zoomSnap=0;var e=t.scrollWheelZoom.enabled();t.scrollWheelZoom.disable(),r.Browser.chrome||r.Browser.safari?t.scrollWheelZoom._onWheelScroll=function(t){var e=r.DomEvent.getWheelDelta(t);this._delta+=e,this._lastMousePos=this._map.mouseEventToContainerPoint(t),this._performZoom(),r.DomEvent.stop(t)}:t.options.wheelDebounceTime=20;var n=(s=function(t){t._moveEnd(!0),t.fire("viewreset")},a=2*t.options.wheelDebounceTime,function(){var t=this,e=arguments;clearTimeout(l),l=setTimeout((function(){l=null,s.apply(t,e)}),a)});uu.scrollWheelZoom._performZoom||(uu.scrollWheelZoom._performZoom=t.scrollWheelZoom._performZoom);var o=this;t.scrollWheelZoom._performZoom=function(){if(this._map===o._map){var t=this._map,e=t.getZoom();t._stop();var r=this._delta/(4*this._map.options.wheelPxPerZoomLevel);this._delta=0,e+r>=this._map.getMaxZoom()?r=this._map.getMaxZoom()-e:e+r<=this._map.getMinZoom()&&(r=this._map.getMinZoom()-e),r&&("center"===t.options.scrollWheelZoom?i(o,t.getCenter(),e+r):i(o,this._lastMousePos,e+r),n(t))}else uu.scrollWheelZoom._performZoom.call(this)},e&&t.scrollWheelZoom.enable()}var s,a,l},modifyZoomBehavior:function(t){if(this.scene.view.continuous_zoom&&!1!==this.options.modifyZoomBehavior){var e=this,n=function(e,n,o){t._stop();var s=t._zoom;n=r.latLng(n),o=void 0===o?s:o,o=Math.min(o,t.getMaxZoom());var a=Date.now(),l=75;return t._moveStart(!0),function c(){var u=(Date.now()-a)/l;u<=1?(t._flyToFrame=r.Util.requestAnimFrame(c,t),i(e,n,s+(o-s)*u)):i(e,n,o)._moveEnd(!0)}.call(t),t};if(t.doubleClickZoom){var o=t.doubleClickZoom.enabled();t.doubleClickZoom.disable(),uu.doubleClickZoom._onDoubleClick||(uu.doubleClickZoom._onDoubleClick=t.doubleClickZoom._onDoubleClick),t.doubleClickZoom._onDoubleClick=function(t){if(this._map===e._map){var i=this._map,r=i.getZoom(),o=i.options.zoomDelta,s=t.originalEvent.shiftKey?r-o:r+o;"center"===i.options.doubleClickZoom?n(e,i.getCenter(),s):n(e,i.containerPointToLatLng(t.containerPoint),s)}else uu.doubleClickZoom._onDoubleClick.call(this,t)},o&&t.doubleClickZoom.enable()}t._zoomAnimated&&(uu.map._animateZoom||(uu.map._animateZoom=t._animateZoom),t._animateZoom=function(t,i,o,s){this===e._map?(o&&(this._animatingZoom=!0,this._animateToCenter=t,this._animateToZoom=i,n(e,t,i)),setTimeout(r.Util.bind(this._onZoomTransitionEnd,this),250)):uu.map._animateZoom.call(this,t,i,o,s)})}},updateView:function(){var e=this._map.getCenter();e.zoom=Math.max(Math.min(this._map.getZoom(),this._map.getMaxZoom()||t.Geo.default_view_max_zoom),this._map.getMinZoom()),this.scene.view.setView(e)},updateSize:function(){var t=this._map.getSize();this.scene.resizeMap(t.x,t.y)},resizeOnFirstVisible:function(){var t=this,e=!0;this.hooks.visibilitychange=function(){e&&(e=!1,t.updateSize())},document.addEventListener("visibilitychange",this.hooks.visibilitychange)},onTangramViewUpdate:function(){if(this._map&&!this._updating_tangram){var t=this._map.getCenter(),e=this.scene.view.center;t.lng===e.lng&&t.lat===e.lat&&this._map.getZoom()===this.scene.view.zoom||(this._updating_tangram=!0,this._map.setView([this.scene.view.center.lat,this.scene.view.center.lng],this.scene.view.zoom,{animate:!1}),this._updating_tangram=!1)}},render:function(){this.scene&&this.scene.update()},reverseTransform:function(){if(this._map&&this.scene&&this.scene.container){var t=this._map.containerPointToLayerPoint([0,0]);r.DomUtil.setPosition(this.scene.container,t)}},setupSelectionEventHandlers:function(t){var e=this;this._selection_events={},this._selection_radius=null,this.hooks.click=function(t){"function"==typeof e._selection_events.click&&e.scene.getFeatureAt(t.containerPoint,{radius:e._selection_radius}).then((function(i){var r=Object.assign({},i,{leaflet_event:t});e._selection_events.click(r)}))},t.on("click",this.hooks.click),this.hooks.mousemove=function(t){"function"==typeof e._selection_events.hover&&e.scene.getFeatureAt(t.containerPoint,{radius:e._selection_radius}).then((function(i){var r=Object.assign({},i,{leaflet_event:t});e._selection_events.hover(r)}))},t.on("mousemove",this.hooks.mousemove),this.hooks.mouseout=function(t){"function"==typeof e._selection_events.hover&&e._selection_events.hover({changed:!0,leaflet_event:t})},t.on("mouseout",this.hooks.mouseout)},setSelectionEvents:function(t,e){var i=(void 0===e?{}:e).radius;this._selection_events=Object.assign(this._selection_events,t),this._selection_radius=void 0!==i?i:this._selection_radius},trackMapLayerCounts:function(t){var e=this;this._updateMapLayerCount=function(){var i=t.getPanes().mapPane.childNodes;e._mapLayerCount=0;for(var r=0;r<i.length;r++)e._mapLayerCount+=i[r].childNodes.length},t.on("layeradd layerremove overlayadd overlayremove",this._updateMapLayerCount),this._updateMapLayerCount()},updateTangramDebugSettings:function(){t.mergeDebugSettings(this.options.debug||{})}}),i=function(t,e,i){var n=t._map,o=t.scene,s=n.getZoomScale(i),a=n.getSize().divideBy(2),l=(e instanceof r.Point?e:n.latLngToContainerPoint(e)).subtract(a).multiplyBy(1-1/s),c=n.containerPointToLatLng(a.add(l));return o&&o.view.markUserInput(),n._move(c,i,{flyTo:!0})},"function"!=typeof(au=n.extend(s)).remove&&(au.prototype.remove=function(){this._map&&this._map.removeLayer(this),this.fire("remove")}),au.layerBaseClass=n,au.leafletVersion=o,new au(e)}}(e)},debug:{log:t.log,yaml:$c,Utils:t.Utils,Geo:t.Geo,Vector:t.Vector,DataSource:t.DataSource,GLSL:t.GLSL,ShaderProgram:t.ShaderProgram,VertexData:t.VertexData,Texture:t.Texture,Material:t.Material,Light:t.Light,Scene:cu,WorkerBroker:t.WorkerBroker,Task:t.Task,StyleManager:t.StyleManager,StyleParser:t.StyleParser,TileID:t.TileID,Collision:t.Collision,FeatureSelection:t.FeatureSelection,TextCanvas:t.TextCanvas,debugSettings:t.debugSettings},version:t.version}}));try{i.debug.ESM=!1,i.debug.SHA="81ee5a1ddf14547d5653c42972e0a66fa999d545"}catch(t){}return i}();class cl extends At{constructor(t){super(),ft(this,t,ll,al,a,{mapStyle:0})}}var ul={prefix:"fas",iconName:"compress",icon:[448,512,[],"f066","M160 64c0-17.7-14.3-32-32-32s-32 14.3-32 32v64H32c-17.7 0-32 14.3-32 32s14.3 32 32 32h96c17.7 0 32-14.3 32-32V64zM32 320c-17.7 0-32 14.3-32 32s14.3 32 32 32H96v64c0 17.7 14.3 32 32 32s32-14.3 32-32V352c0-17.7-14.3-32-32-32H32zM352 64c0-17.7-14.3-32-32-32s-32 14.3-32 32v96c0 17.7 14.3 32 32 32h96c17.7 0 32-14.3 32-32s-14.3-32-32-32H352V64zM320 320c-17.7 0-32 14.3-32 32v96c0 17.7 14.3 32 32 32s32-14.3 32-32V384h64c17.7 0 32-14.3 32-32s-14.3-32-32-32H320z"]},hl={prefix:"fas",iconName:"camera",icon:[512,512,[62258,"camera-alt"],"f030","M149.1 64.8L138.7 96H64C28.7 96 0 124.7 0 160V416c0 35.3 28.7 64 64 64H448c35.3 0 64-28.7 64-64V160c0-35.3-28.7-64-64-64H373.3L362.9 64.8C356.4 45.2 338.1 32 317.4 32H194.6c-20.7 0-39 13.2-45.5 32.8zM256 192a96 96 0 1 1 0 192 96 96 0 1 1 0-192z"]},dl={prefix:"fas",iconName:"link",icon:[640,512,[128279,"chain"],"f0c1","M579.8 267.7c56.5-56.5 56.5-148 0-204.5c-50-50-128.8-56.5-186.3-15.4l-1.6 1.1c-14.4 10.3-17.7 30.3-7.4 44.6s30.3 17.7 44.6 7.4l1.6-1.1c32.1-22.9 76-19.3 103.8 8.6c31.5 31.5 31.5 82.5 0 114L422.3 334.8c-31.5 31.5-82.5 31.5-114 0c-27.9-27.9-31.5-71.8-8.6-103.8l1.1-1.6c10.3-14.4 6.9-34.4-7.4-44.6s-34.4-6.9-44.6 7.4l-1.1 1.6C206.5 251.2 213 330 263 380c56.5 56.5 148 56.5 204.5 0L579.8 267.7zM60.2 244.3c-56.5 56.5-56.5 148 0 204.5c50 50 128.8 56.5 186.3 15.4l1.6-1.1c14.4-10.3 17.7-30.3 7.4-44.6s-30.3-17.7-44.6-7.4l-1.6 1.1c-32.1 22.9-76 19.3-103.8-8.6C74 372 74 321 105.5 289.5L217.7 177.2c31.5-31.5 82.5-31.5 114 0c27.9 27.9 31.5 71.8 8.6 103.9l-1.1 1.6c-10.3 14.4-6.9 34.4 7.4 44.6s34.4 6.9 44.6-7.4l1.1-1.6C433.5 260.8 427 182 377 132c-56.5-56.5-148-56.5-204.5 0L60.2 244.3z"]},pl={prefix:"fas",iconName:"plus",icon:[448,512,[10133,61543,"add"],"2b","M256 80c0-17.7-14.3-32-32-32s-32 14.3-32 32V224H48c-17.7 0-32 14.3-32 32s14.3 32 32 32H192V432c0 17.7 14.3 32 32 32s32-14.3 32-32V288H400c17.7 0 32-14.3 32-32s-14.3-32-32-32H256V80z"]},fl={prefix:"fas",iconName:"expand",icon:[448,512,[],"f065","M32 32C14.3 32 0 46.3 0 64v96c0 17.7 14.3 32 32 32s32-14.3 32-32V96h64c17.7 0 32-14.3 32-32s-14.3-32-32-32H32zM64 352c0-17.7-14.3-32-32-32s-32 14.3-32 32v96c0 17.7 14.3 32 32 32h96c17.7 0 32-14.3 32-32s-14.3-32-32-32H64V352zM320 32c-17.7 0-32 14.3-32 32s14.3 32 32 32h64v64c0 17.7 14.3 32 32 32s32-14.3 32-32V64c0-17.7-14.3-32-32-32H320zM448 352c0-17.7-14.3-32-32-32s-32 14.3-32 32v64H320c-17.7 0-32 14.3-32 32s14.3 32 32 32h96c17.7 0 32-14.3 32-32V352z"]},Al={prefix:"fas",iconName:"xmark",icon:[384,512,[128473,10005,10006,10060,215,"close","multiply","remove","times"],"f00d","M342.6 150.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L192 210.7 86.6 105.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L146.7 256 41.4 361.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L192 301.3 297.4 406.6c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L237.3 256 342.6 150.6z"]},ml={prefix:"fas",iconName:"link-slash",icon:[640,512,["chain-broken","chain-slash","unlink"],"f127","M38.8 5.1C28.4-3.1 13.3-1.2 5.1 9.2S-1.2 34.7 9.2 42.9l592 464c10.4 8.2 25.5 6.3 33.7-4.1s6.3-25.5-4.1-33.7L489.3 358.2l90.5-90.5c56.5-56.5 56.5-148 0-204.5c-50-50-128.8-56.5-186.3-15.4l-1.6 1.1c-14.4 10.3-17.7 30.3-7.4 44.6s30.3 17.7 44.6 7.4l1.6-1.1c32.1-22.9 76-19.3 103.8 8.6c31.5 31.5 31.5 82.5 0 114l-96 96-31.9-25C430.9 239.6 420.1 175.1 377 132c-52.2-52.3-134.5-56.2-191.3-11.7L38.8 5.1zM239 162c30.1-14.9 67.7-9.9 92.8 15.3c20 20 27.5 48.3 21.7 74.5L239 162zM406.6 416.4L220.9 270c-2.1 39.8 12.2 80.1 42.2 110c38.9 38.9 94.4 51 143.6 36.3zm-290-228.5L60.2 244.3c-56.5 56.5-56.5 148 0 204.5c50 50 128.8 56.5 186.3 15.4l1.6-1.1c14.4-10.3 17.7-30.3 7.4-44.6s-30.3-17.7-44.6-7.4l-1.6 1.1c-32.1 22.9-76 19.3-103.8-8.6C74 372 74 321 105.5 289.5l61.8-61.8-50.6-39.9z"]};const gl=parseFloat;function _l(t,e=";"){let i;if(Array.isArray(t))i=t.filter((t=>t));else{i=[];for(const e in t)t[e]&&i.push(`${e}:${t[e]}`)}return i.join(e)}function yl(t){let e,i,r,n,o,s,a;function l(t,e){return"string"==typeof t[7][4]?xl:vl}let c=l(t),u=c(t);return{c(){e=w("svg"),i=w("g"),r=w("g"),u.c(),S(r,"transform",t[10]),S(i,"transform",n=`translate(${t[7][0]/2} ${t[7][1]/2})`),S(i,"transform-origin",o=t[7][0]/4+" 0"),S(e,"id",t[0]),S(e,"class",s=m(t[8])+" svelte-1cj2gr0"),S(e,"style",t[9]),S(e,"viewBox",a=`0 0 ${t[7][0]} ${t[7][1]}`),S(e,"aria-hidden","true"),S(e,"role","img"),S(e,"xmlns","http://www.w3.org/2000/svg")},m(t,n){y(t,e,n),_(e,i),_(i,r),u.m(r,null)},p(t,h){c===(c=l(t))&&u?u.p(t,h):(u.d(1),u=c(t),u&&(u.c(),u.m(r,null))),1024&h&&S(r,"transform",t[10]),128&h&&n!==(n=`translate(${t[7][0]/2} ${t[7][1]/2})`)&&S(i,"transform",n),128&h&&o!==(o=t[7][0]/4+" 0")&&S(i,"transform-origin",o),1&h&&S(e,"id",t[0]),256&h&&s!==(s=m(t[8])+" svelte-1cj2gr0")&&S(e,"class",s),512&h&&S(e,"style",t[9]),128&h&&a!==(a=`0 0 ${t[7][0]} ${t[7][1]}`)&&S(e,"viewBox",a)},d(t){t&&v(e),u.d()}}}function vl(t){let e,i,r,n,o,s,a,l,c,u;return{c(){e=w("path"),s=w("path"),S(e,"d",i=t[7][4][0]),S(e,"fill",r=t[3]||t[1]||"currentColor"),S(e,"fill-opacity",n=0!=t[6]?t[4]:t[5]),S(e,"transform",o=`translate(${t[7][0]/-2} ${t[7][1]/-2})`),S(s,"d",a=t[7][4][1]),S(s,"fill",l=t[2]||t[1]||"currentColor"),S(s,"fill-opacity",c=0!=t[6]?t[5]:t[4]),S(s,"transform",u=`translate(${t[7][0]/-2} ${t[7][1]/-2})`)},m(t,i){y(t,e,i),y(t,s,i)},p(t,h){128&h&&i!==(i=t[7][4][0])&&S(e,"d",i),10&h&&r!==(r=t[3]||t[1]||"currentColor")&&S(e,"fill",r),112&h&&n!==(n=0!=t[6]?t[4]:t[5])&&S(e,"fill-opacity",n),128&h&&o!==(o=`translate(${t[7][0]/-2} ${t[7][1]/-2})`)&&S(e,"transform",o),128&h&&a!==(a=t[7][4][1])&&S(s,"d",a),6&h&&l!==(l=t[2]||t[1]||"currentColor")&&S(s,"fill",l),112&h&&c!==(c=0!=t[6]?t[5]:t[4])&&S(s,"fill-opacity",c),128&h&&u!==(u=`translate(${t[7][0]/-2} ${t[7][1]/-2})`)&&S(s,"transform",u)},d(t){t&&v(e),t&&v(s)}}}function xl(t){let e,i,r,n;return{c(){e=w("path"),S(e,"d",i=t[7][4]),S(e,"fill",r=t[1]||t[2]||"currentColor"),S(e,"transform",n=`translate(${t[7][0]/-2} ${t[7][1]/-2})`)},m(t,i){y(t,e,i)},p(t,o){128&o&&i!==(i=t[7][4])&&S(e,"d",i),6&o&&r!==(r=t[1]||t[2]||"currentColor")&&S(e,"fill",r),128&o&&n!==(n=`translate(${t[7][0]/-2} ${t[7][1]/-2})`)&&S(e,"transform",n)},d(t){t&&v(e)}}}function bl(t){let i,r=t[7][4]&&yl(t);return{c(){r&&r.c(),i=E()},m(t,e){r&&r.m(t,e),y(t,i,e)},p(t,[e]){t[7][4]?r?r.p(t,e):(r=yl(t),r.c(),r.m(i.parentNode,i)):r&&(r.d(1),r=null)},i:e,o:e,d(t){r&&r.d(t),t&&v(i)}}}function wl(t,e,i){let r,n,o,s,{class:a=""}=e,{id:l=""}=e,{style:c=""}=e,{icon:u}=e,{size:h=""}=e,{color:d=""}=e,{fw:p=!1}=e,{pull:f=""}=e,{scale:A=1}=e,{translateX:m=0}=e,{translateY:g=0}=e,{rotate:_=""}=e,{flip:y=!1}=e,{spin:v=!1}=e,{pulse:x=!1}=e,{primaryColor:b=""}=e,{secondaryColor:w=""}=e,{primaryOpacity:T=1}=e,{secondaryOpacity:B=.4}=e,{swapOpacity:E=!1}=e;return t.$$set=t=>{"class"in t&&i(11,a=t.class),"id"in t&&i(0,l=t.id),"style"in t&&i(12,c=t.style),"icon"in t&&i(13,u=t.icon),"size"in t&&i(14,h=t.size),"color"in t&&i(1,d=t.color),"fw"in t&&i(15,p=t.fw),"pull"in t&&i(16,f=t.pull),"scale"in t&&i(17,A=t.scale),"translateX"in t&&i(18,m=t.translateX),"translateY"in t&&i(19,g=t.translateY),"rotate"in t&&i(20,_=t.rotate),"flip"in t&&i(21,y=t.flip),"spin"in t&&i(22,v=t.spin),"pulse"in t&&i(23,x=t.pulse),"primaryColor"in t&&i(2,b=t.primaryColor),"secondaryColor"in t&&i(3,w=t.secondaryColor),"primaryOpacity"in t&&i(4,T=t.primaryOpacity),"secondaryOpacity"in t&&i(5,B=t.secondaryOpacity),"swapOpacity"in t&&i(6,E=t.swapOpacity)},t.$$.update=()=>{8192&t.$$.dirty&&i(7,r=u&&u.icon||[0,0,"",[],""]),12584960&t.$$.dirty&&i(8,n=_l([a,"svelte-fa",v&&"spin",x&&"pulse"]," ")),118784&t.$$.dirty&&i(9,o=function(t,e,i,r){let n,o,s,a,l,c="-.125em";return r&&(l="center",o="1.25em"),i&&(n=i),e&&("lg"==e?(a="1.33333em",s=".75em",c="-.225em"):a="xs"==e?".75em":"sm"==e?".875em":e.replace("x","em")),_l([_l({float:n,width:o,height:"1em","line-height":s,"font-size":a,"text-align":l,"vertical-align":c,"transform-origin":"center",overflow:"visible"}),t])}(c,h,f,p)),4063232&t.$$.dirty&&i(10,s=function(t,e,i,r,n,o=1,s="",a=""){let l=1,c=1;return n&&("horizontal"==n?l=-1:"vertical"==n?c=-1:l=c=-1),_l([`translate(${gl(e)*o}${s},${gl(i)*o}${s})`,`scale(${l*gl(t)},${c*gl(t)})`,r&&`rotate(${r}${a})`]," ")}(A,m,g,_,y,512))},[l,d,b,w,T,B,E,r,n,o,s,a,c,u,h,p,f,A,m,g,_,y,v,x]}var Tl=class extends At{constructor(t){super(),ft(this,t,wl,bl,a,{class:11,id:0,style:12,icon:13,size:14,color:1,fw:15,pull:16,scale:17,translateX:18,translateY:19,rotate:20,flip:21,spin:22,pulse:23,primaryColor:2,secondaryColor:3,primaryOpacity:4,secondaryOpacity:5,swapOpacity:6})}},Bl={exports:{}},El=Bl.exports=function(t,e){if(e||(e=16),void 0===t&&(t=128),t<=0)return"0";for(var i=Math.log(Math.pow(2,t))/Math.log(e),r=2;i===1/0;r*=2)i=Math.log(Math.pow(2,t/r))/Math.log(e)*r;var n=i-Math.floor(i),o="";for(r=0;r<Math.floor(i);r++){o=Math.floor(Math.random()*e).toString(e)+o}if(n){var s=Math.pow(e,n);o=Math.floor(Math.random()*s).toString(e)+o}var a=parseInt(o,e);return a!==1/0&&a>=Math.pow(2,t)?El(t,e):o};El.rack=function(t,e,i){var r=function(r){var o=0;do{if(o++>10){if(!i)throw new Error("too many ID collisions, use more bits");t+=i}var s=El(t,e)}while(Object.hasOwnProperty.call(n,s));return n[s]=r,s},n=r.hats={};return r.get=function(t){return r.hats[t]},r.set=function(t,e){return r.hats[t]=e,r},r.bits=t||128,r.base=e||16,r};var Cl=Bl.exports;const Sl=(t,e,i)=>t.replace("{branch}",e).replace("{style}",i),Il=t=>{if("string"!=typeof t)return!1;return t.startsWith("mapbox://")},Ml={name:"Mapbox GL JS",value:"mapbox-gl"},kl=[Ml,{name:"Maplibre GL JS",value:"maplibre-gl"},{name:"MapTiler SDK",value:"maptiler-sdk"}],Pl={google:[{name:"Google Maps",value:"google"}],leaflet:[{name:"Leaflet",value:"leaflet"}],tangram:[{name:"Tangram (Leaflet)",value:"tangram"}],"vector-gl":kl,"mapbox-gl":kl,"maplibre-gl":kl,"maptiler-sdk":kl},Ll=(t,e)=>{let i=!1;return"mapbox-gl"!==t.type?Pl[t.type]:(t.url&&Il(t.url)?i=!0:e&&(i=Object.values(e).some((t=>Il(t?.url)||(t?.tiles??[]).some((t=>Il(t)))))),i?[Ml]:Pl[t.type])},zl=(t,e)=>{let i;const r=()=>window.removeEventListener("keydown",i),n=()=>{r(),e&&(i=i=>{!!e.alt==i.altKey&&!!e.shift==i.shiftKey&&!!e.control==(i.ctrlKey||i.metaKey)&&e.code==i.code&&(i.preventDefault(),e.callback?e.callback():t.click())},window.addEventListener("keydown",i))};return n(),{update:n,destroy:r}};let Fl,Dl;It.subscribe((t=>({mapboxGlAccessToken:Fl,maptilerApiKey:Dl}=t)));function Rl(t){let i,r,n,a,l,c,u,h,d,p,f,A=(t[2]??t[3])+"";return{c(){i=b("div"),r=b("div"),n=b("div"),l=B(),c=b("div"),u=b("div"),h=T(A),S(n,"class",a=m(t[1]?`caret-${t[4]}`:"caret-right")+" svelte-1q5ddxk"),S(r,"class","caret-container svelte-1q5ddxk"),S(u,"class","label svelte-1q5ddxk"),S(c,"class","label-container svelte-1q5ddxk"),S(i,"class",d=m(`toggle ${t[1]&&("up"===t[4]?"active-toggle-top":"active-toggle-bottom")}`)+" svelte-1q5ddxk")},m(e,o){y(e,i,o),_(i,r),_(r,n),_(i,l),_(i,c),_(c,u),_(u,h),p||(f=[C(i,"click",(function(){s(t[0])&&t[0].apply(this,arguments)})),C(i,"keydown",t[5])],p=!0)},p(e,[r]){t=e,18&r&&a!==(a=m(t[1]?`caret-${t[4]}`:"caret-right")+" svelte-1q5ddxk")&&S(n,"class",a),12&r&&A!==(A=(t[2]??t[3])+"")&&M(h,A),18&r&&d!==(d=m(`toggle ${t[1]&&("up"===t[4]?"active-toggle-top":"active-toggle-bottom")}`)+" svelte-1q5ddxk")&&S(i,"class",d)},i:e,o:e,d(t){t&&v(i),p=!1,o(f)}}}function Ul(t,e,i){let{openTopLevel:r}=e,{topLevelOpen:n}=e,{activeLabel:o}=e,{placeholder:s}=e,{direction:a}=e;return t.$$set=t=>{"openTopLevel"in t&&i(0,r=t.openTopLevel),"topLevelOpen"in t&&i(1,n=t.topLevelOpen),"activeLabel"in t&&i(2,o=t.activeLabel),"placeholder"in t&&i(3,s=t.placeholder),"direction"in t&&i(4,a=t.direction)},[r,n,o,s,a,()=>!1]}class Ol extends At{constructor(t){super(),ft(this,t,Ul,Rl,a,{openTopLevel:0,topLevelOpen:1,activeLabel:2,placeholder:3,direction:4})}}function Nl(t,e,i){const r=t.slice();return r[16]=e[i],r}function Ql(t,e,i){const r=t.slice();return r[19]=e[i],r}function Vl(t){let e,i;return e=new Ol({props:{openTopLevel:t[7],topLevelOpen:t[4],activeLabel:t[6],direction:t[1],placeholder:t[2]}}),{c(){ht(e.$$.fragment)},m(t,r){dt(e,t,r),i=!0},p(t,i){const r={};16&i&&(r.topLevelOpen=t[4]),64&i&&(r.activeLabel=t[6]),2&i&&(r.direction=t[1]),4&i&&(r.placeholder=t[2]),e.$set(r)},i(t){i||(at(e.$$.fragment,t),i=!0)},o(t){lt(e.$$.fragment,t),i=!1},d(t){pt(e,t)}}}function jl(t){let e,i,r=t[3],n=[];for(let e=0;e<r.length;e+=1)n[e]=Kl(Nl(t,r,e));return{c(){e=b("div");for(let t=0;t<n.length;t+=1)n[t].c();S(e,"class",i=m("menu "+("up"===t[1]?"menu-top":"menu-bottom"))+" svelte-rhj8v9")},m(t,i){y(t,e,i);for(let t=0;t<n.length;t+=1)n[t]&&n[t].m(e,null)},p(t,o){if(1833&o){let i;for(r=t[3],i=0;i<r.length;i+=1){const s=Nl(t,r,i);n[i]?n[i].p(s,o):(n[i]=Kl(s),n[i].c(),n[i].m(e,null))}for(;i<n.length;i+=1)n[i].d(1);n.length=r.length}2&o&&i!==(i=m("menu "+("up"===t[1]?"menu-top":"menu-bottom"))+" svelte-rhj8v9")&&S(e,"class",i)},d(t){t&&v(e),x(n,t)}}}function Hl(t){let e,i,r,n,s,a,l,c,u,h,d,p=t[16].label+"";function f(){return t[15](t[16])}return{c(){e=b("div"),i=b("div"),r=B(),n=b("div"),s=b("div"),a=T(p),l=B(),S(i,"class","caret-container svelte-rhj8v9"),S(s,"class","label svelte-rhj8v9"),S(n,"class","label-container svelte-rhj8v9"),S(e,"class",c=m(`menu-item ${t[0]===t[16].value&&"active"}`)+" svelte-rhj8v9"),S(e,"title",u=t[16].label)},m(o,c){y(o,e,c),_(e,i),_(e,r),_(e,n),_(n,s),_(s,a),_(e,l),h||(d=[C(e,"click",f),C(e,"keydown",t[9])],h=!0)},p(i,r){t=i,8&r&&p!==(p=t[16].label+"")&&M(a,p),9&r&&c!==(c=m(`menu-item ${t[0]===t[16].value&&"active"}`)+" svelte-rhj8v9")&&S(e,"class",c),8&r&&u!==(u=t[16].label)&&S(e,"title",u)},d(t){t&&v(e),h=!1,o(d)}}}function Gl(t){let e,i,r,n,s,a,l,c,u,h,d,p,f,A,g,x=t[16].label+"";function w(){return t[13](t[16])}let E=t[5]===t[16].id&&Zl(t);return{c(){e=b("div"),i=b("div"),r=b("div"),n=b("div"),a=B(),l=b("div"),c=b("div"),u=T(x),p=B(),E&&E.c(),f=B(),S(n,"class",s=m(t[5]===t[16].id?"caret-down":"caret-right")+" svelte-rhj8v9"),S(r,"class","caret-container svelte-rhj8v9"),S(c,"class","label svelte-rhj8v9"),S(l,"class","label-container svelte-rhj8v9"),S(i,"class",h=m(`menu-item ${t[0]===t[16].value&&"active"}`)+" svelte-rhj8v9"),S(i,"title",d=t[16].label),S(e,"class","dropdown svelte-rhj8v9")},m(o,s){y(o,e,s),_(e,i),_(i,r),_(r,n),_(i,a),_(i,l),_(l,c),_(c,u),_(e,p),E&&E.m(e,null),_(e,f),A||(g=[C(i,"click",w),C(i,"keydown",t[9])],A=!0)},p(r,o){t=r,40&o&&s!==(s=m(t[5]===t[16].id?"caret-down":"caret-right")+" svelte-rhj8v9")&&S(n,"class",s),8&o&&x!==(x=t[16].label+"")&&M(u,x),9&o&&h!==(h=m(`menu-item ${t[0]===t[16].value&&"active"}`)+" svelte-rhj8v9")&&S(i,"class",h),8&o&&d!==(d=t[16].label)&&S(i,"title",d),t[5]===t[16].id?E?E.p(t,o):(E=Zl(t),E.c(),E.m(e,f)):E&&(E.d(1),E=null)},d(t){t&&v(e),E&&E.d(),A=!1,o(g)}}}function $l(t){let e,i,r,n,o,s=t[16]?.header+"";return{c(){e=b("div"),i=b("div"),r=b("div"),n=T(s),o=B(),S(r,"class","label svelte-rhj8v9"),S(i,"class","label-container svelte-rhj8v9"),S(e,"class","header svelte-rhj8v9")},m(t,s){y(t,e,s),_(e,i),_(i,r),_(r,n),y(t,o,s)},p(t,e){8&e&&s!==(s=t[16]?.header+"")&&M(n,s)},d(t){t&&v(e),t&&v(o)}}}function Zl(t){let e,i=t[16]?.options,r=[];for(let e=0;e<i.length;e+=1)r[e]=ql(Ql(t,i,e));return{c(){e=b("div");for(let t=0;t<r.length;t+=1)r[t].c();S(e,"class","submenu svelte-rhj8v9")},m(t,i){y(t,e,i);for(let t=0;t<r.length;t+=1)r[t]&&r[t].m(e,null)},p(t,n){if(1545&n){let o;for(i=t[16]?.options,o=0;o<i.length;o+=1){const s=Ql(t,i,o);r[o]?r[o].p(s,n):(r[o]=ql(s),r[o].c(),r[o].m(e,null))}for(;o<r.length;o+=1)r[o].d(1);r.length=i.length}},d(t){t&&v(e),x(r,t)}}}function ql(t){let e,i,r,n,s,a,l,c,u,h=t[19].label+"";function d(){return t[14](t[19])}return{c(){e=b("div"),i=b("div"),r=b("div"),n=T(h),s=B(),S(r,"class","label svelte-rhj8v9"),S(i,"class","label-container svelte-rhj8v9"),S(e,"class",a=m(`menu-item ${t[0]===t[19].value&&"active"}`)+" svelte-rhj8v9"),S(e,"title",l=t[19].label)},m(o,a){y(o,e,a),_(e,i),_(i,r),_(r,n),_(e,s),c||(u=[C(e,"click",d),C(e,"keydown",t[9])],c=!0)},p(i,r){t=i,8&r&&h!==(h=t[19].label+"")&&M(n,h),9&r&&a!==(a=m(`menu-item ${t[0]===t[19].value&&"active"}`)+" svelte-rhj8v9")&&S(e,"class",a),8&r&&l!==(l=t[19].label)&&S(e,"title",l)},d(t){t&&v(e),c=!1,o(u)}}}function Kl(t){let e;function i(t,e){return t[16]?.header?$l:t[16]?.options?Gl:Hl}let r=i(t),n=r(t);return{c(){n.c(),e=E()},m(t,i){n.m(t,i),y(t,e,i)},p(t,o){r===(r=i(t))&&n?n.p(t,o):(n.d(1),n=r(t),n&&(n.c(),n.m(e.parentNode,e)))},d(t){n.d(t),t&&v(e)}}}function Wl(t){let e,i;return e=new Ol({props:{openTopLevel:t[7],topLevelOpen:t[4],activeLabel:t[6],direction:t[1],placeholder:t[2]}}),{c(){ht(e.$$.fragment)},m(t,r){dt(e,t,r),i=!0},p(t,i){const r={};16&i&&(r.topLevelOpen=t[4]),64&i&&(r.activeLabel=t[6]),2&i&&(r.direction=t[1]),4&i&&(r.placeholder=t[2]),e.$set(r)},i(t){i||(at(e.$$.fragment,t),i=!0)},o(t){lt(e.$$.fragment,t),i=!1},d(t){pt(e,t)}}}function Xl(t){let e,i,r,n,o="down"===t[1]&&Vl(t),s=t[4]&&jl(t),a="up"===t[1]&&Wl(t);return{c(){e=b("div"),o&&o.c(),i=B(),s&&s.c(),r=B(),a&&a.c(),S(e,"class","dropdown svelte-rhj8v9")},m(t,l){y(t,e,l),o&&o.m(e,null),_(e,i),s&&s.m(e,null),_(e,r),a&&a.m(e,null),n=!0},p(t,[n]){"down"===t[1]?o?(o.p(t,n),2&n&&at(o,1)):(o=Vl(t),o.c(),at(o,1),o.m(e,i)):o&&(ot(),lt(o,1,1,(()=>{o=null})),st()),t[4]?s?s.p(t,n):(s=jl(t),s.c(),s.m(e,r)):s&&(s.d(1),s=null),"up"===t[1]?a?(a.p(t,n),2&n&&at(a,1)):(a=Wl(t),a.c(),at(a,1),a.m(e,null)):a&&(ot(),lt(a,1,1,(()=>{a=null})),st())},i(t){n||(at(o),at(a),n=!0)},o(t){lt(o),lt(a),n=!1},d(t){t&&v(e),o&&o.d(),s&&s.d(),a&&a.d()}}}function Jl(t,e,i){let r,n,{options:o}=e,{activeValue:s}=e,{onSelect:a}=e,{direction:l="up"}=e,{placeholder:c=""}=e,u=!1,h=null;const d=t=>{i(5,h=h===t?null:t)},p=t=>{a(t),i(4,u=!1),i(5,h=null)};return t.$$set=t=>{"options"in t&&i(11,o=t.options),"activeValue"in t&&i(0,s=t.activeValue),"onSelect"in t&&i(12,a=t.onSelect),"direction"in t&&i(1,l=t.direction),"placeholder"in t&&i(2,c=t.placeholder)},t.$$.update=()=>{2048&t.$$.dirty&&i(3,r=o.map(((t,e)=>{let i={...t,id:`${e}`};return i.options&&(i.options=i.options.map(((t,i)=>({...t,id:`${e}-${i}`})))),i}))),9&t.$$.dirty&&i(6,n=r.filter((t=>!t?.header)).map((t=>t?.options?t?.options:t)).flat().find((t=>t.value===s))?.label)},[s,l,c,r,u,h,n,()=>{if(i(4,u=!u),u){const t=r.filter((t=>t.options)).find((t=>t.options.some((t=>t.value===s))));t&&i(5,h=t.id)}else i(5,h=null)},d,()=>!1,p,o,a,t=>d(t.id),t=>p(t.value),t=>p(t.value)]}class Yl extends At{constructor(t){super(),ft(this,t,Jl,Xl,a,{options:11,activeValue:0,onSelect:12,direction:1,placeholder:2})}}function tc(t){let e,i,r,n;return i=new Yl({props:{options:t[4],activeValue:t[0].dropdownId,onSelect:t[1],direction:t[3]}}),{c(){e=b("div"),ht(i.$$.fragment),S(e,"id",r=`styles-dropdown-${t[2]}`)},m(t,r){y(t,e,r),dt(i,e,null),n=!0},p(t,[o]){const s={};16&o&&(s.options=t[4]),1&o&&(s.activeValue=t[0].dropdownId),2&o&&(s.onSelect=t[1]),8&o&&(s.direction=t[3]),i.$set(s),(!n||4&o&&r!==(r=`styles-dropdown-${t[2]}`))&&S(e,"id",r)},i(t){n||(at(i.$$.fragment,t),n=!0)},o(t){lt(i.$$.fragment,t),n=!1},d(t){t&&v(e),pt(i)}}}function ec(t,e,i){let r,{dropdownDisplayOptions:n}=e,{dropdownValue:o}=e,{onSelect:s}=e,{index:a}=e,l="up";return Q((()=>{const t=document?.body?.clientHeight,e=document?.getElementById(`styles-dropdown-${a}`),r=e?.getBoundingClientRect(),n=r?.top;n&&t&&i(3,l=n<t/2?"down":"up")})),t.$$set=t=>{"dropdownDisplayOptions"in t&&i(5,n=t.dropdownDisplayOptions),"dropdownValue"in t&&i(0,o=t.dropdownValue),"onSelect"in t&&i(1,s=t.onSelect),"index"in t&&i(2,a=t.index)},t.$$.update=()=>{32&t.$$.dirty&&i(4,r=Object.entries(n).reduce(((t,[e,i])=>{t.push({header:e});for(const e of i)"sublist"===e.type?t.push({label:e.text,options:e.presets.map((t=>({label:t.text,value:t.dropdownId})))}):t.push({label:e.text,value:e.dropdownId});return t}),[]))},[o,s,a,l,r,n]}class ic extends At{constructor(t){super(),ft(this,t,ec,tc,a,{dropdownDisplayOptions:5,dropdownValue:0,onSelect:1,index:2})}}function rc(t){let e,i,r,n,s,a,l,c,u;return{c(){e=b("div"),i=b("input"),n=B(),s=b("button"),a=T("Submit"),S(i,"placeholder",r="branch"===t[6].dropdownType?"enter a branch name":"enter a url to a style"),S(i,"class","svelte-1fo36py"),R(i,"input-error",t[7]),s.disabled=l=t[6]?.url===t[5],S(e,"class","custom-input svelte-1fo36py")},m(r,o){y(r,e,o),_(e,i),k(i,t[5]),_(e,n),_(e,s),_(s,a),c||(u=[C(i,"input",t[15]),C(i,"focus",t[11]),C(i,"blur",t[12]),g(zl.call(null,s,{code:"Enter",callback:t[10]})),C(s,"click",t[9])],c=!0)},p(t,e){64&e&&r!==(r="branch"===t[6].dropdownType?"enter a branch name":"enter a url to a style")&&S(i,"placeholder",r),32&e&&i.value!==t[5]&&k(i,t[5]),128&e&&R(i,"input-error",t[7]),96&e&&l!==(l=t[6]?.url===t[5])&&(s.disabled=l)},d(t){t&&v(e),c=!1,o(u)}}}function nc(t){let e,i;return{c(){e=b("div"),i=T(t[7]),S(e,"class","error-message svelte-1fo36py")},m(t,r){y(t,e,r),_(e,i)},p(t,e){128&e&&M(i,t[7])},d(t){t&&v(e)}}}function oc(t){let e,i,r,n,o,s,a,l,c,u;i=new ic({props:{dropdownDisplayOptions:t[0],dropdownValue:t[1],index:t[4],onSelect:t[14]}});let h=("custom"===t[6]?.dropdownType||"branch"===t[6]?.dropdownType)&&rc(t),d=!!t[7]&&nc(t);return c=new Yl({props:{options:t[2].map(sc),activeValue:t[3],onSelect:t[16],direction:"up"}}),{c(){e=b("div"),ht(i.$$.fragment),r=B(),h&&h.c(),n=B(),d&&d.c(),o=B(),s=b("div"),a=b("span"),a.textContent="Rendered with",l=B(),ht(c.$$.fragment),S(a,"class","nowrap svelte-1fo36py"),S(s,"class","renderer-control svelte-1fo36py"),S(e,"class","map-style-input svelte-1fo36py")},m(t,p){y(t,e,p),dt(i,e,null),_(e,r),h&&h.m(e,null),_(e,n),d&&d.m(e,null),_(e,o),_(e,s),_(s,a),_(s,l),dt(c,s,null),u=!0},p(t,[r]){const s={};1&r&&(s.dropdownDisplayOptions=t[0]),2&r&&(s.dropdownValue=t[1]),16&r&&(s.index=t[4]),i.$set(s),"custom"===t[6]?.dropdownType||"branch"===t[6]?.dropdownType?h?h.p(t,r):(h=rc(t),h.c(),h.m(e,n)):h&&(h.d(1),h=null),t[7]?d?d.p(t,r):(d=nc(t),d.c(),d.m(e,o)):d&&(d.d(1),d=null);const a={};4&r&&(a.options=t[2].map(sc)),8&r&&(a.activeValue=t[3]),c.$set(a)},i(t){u||(at(i.$$.fragment,t),at(c.$$.fragment,t),u=!0)},o(t){lt(i.$$.fragment,t),lt(c.$$.fragment,t),u=!1},d(t){t&&v(e),pt(i),h&&h.d(),d&&d.d(),pt(c)}}}const sc=t=>({label:t.name,value:t.value});function ac(t,e,i){const r=j();let n,o,{dropdownDisplayOptions:s}=e,{dropdownValue:a}=e,{rendererOptions:l}=e,{rendererValue:c}=e,{activeUrl:u}=e,{index:h}=e,d=!1,p=null,f=!0;V((()=>{f=!1})),Q((()=>{i(6,n=a),i(5,o=n.defaultText),A(n.url)}));const A=t=>{const e=t=>{if(!f||!t||u!==t)return!1;const e=new RegExp("^(?:[a-z+]+:)?//","i");return t.includes("localhost")||!e.test(t)};e(t)&&setTimeout((()=>e(t)&&g(t,!0)),3e3)},m=t=>{const e=["dropdownType","selected","defaultText"];let i={...Object.fromEntries(Object.entries(t).filter((([t,i])=>!e.includes(t))))};"branch"===n.dropdownType&&(i.branch=o),t&&(i.id=t?.style?.id??t.id,i.name=t?.style?.name??t.name),r("updateMapStore",{value:i})},g=async(t,e=!1)=>{let o;try{const i=await(async t=>{const e=Il(t);let i,r=new URL(t);e?r=((t,e)=>{const[,,,i,r]=t.split("/");return`https://api.mapbox.com/styles/v1/${i}/${r}?title=true&access_token=${e}`})(r.toString(),Fl):"api.maptiler.com"===r.host&&(r=Ja(r,Dl));try{i=await fetch(r)}catch(t){throw{message:t.message}}if(!i.ok)throw{status:i.status,message:i.statusText};const n=await i.json();if(e&&n.message)throw{message:n.message};return n})(t);if(i&&"object"==typeof i)return o=i,A(t),e?r("updateMapStore",{value:{style:o,isPolling:e}}):m({...n,style:o,url:t,isPolling:e}),{status:"200"}}catch(t){const{status:e,message:r}=t;return i(7,p=new Error(r)),{status:e}}},_=async t=>{const{status:e}=await g(t);"200"===e&&(i(6,n.url=t,n),A(t)),r("setUrl",{value:t})},y=async()=>{const{dropdownType:t,pattern:e}=n;let i="branch"===t?Sl(e,o,n.id):o;if(n?.url!==i){if(i.includes("localhost")){const[t,e]=i.split("localhost");t||(i=`http://localhost${e}`)}_(i)}};return t.$$set=t=>{"dropdownDisplayOptions"in t&&i(0,s=t.dropdownDisplayOptions),"dropdownValue"in t&&i(1,a=t.dropdownValue),"rendererOptions"in t&&i(2,l=t.rendererOptions),"rendererValue"in t&&i(3,c=t.rendererValue),"activeUrl"in t&&i(13,u=t.activeUrl),"index"in t&&i(4,h=t.index)},t.$$.update=()=>{32&t.$$.dirty&&(t=>{p&&void 0!==t&&i(7,p=null)})(o),2&t.$$.dirty&&(()=>{const t=Object.entries(a).every((t=>{const[e,i]=t;return"url"===e||!(!n||n[e]!==i)||void 0}));if(t)return;const e=n?.dropdownType;i(6,n=a),i(7,p=null);const{dropdownType:r}=n;switch(r){case"preset":{const{type:t,url:e}=n;if(["google","leaflet"].includes(t)){m(n);break}_(e);break}case"branch":o&&"branch"===e&&y()}i(5,o=n.defaultText)})()},[s,a,l,c,h,o,n,p,r,y,()=>{d&&y()},()=>{d=!0},()=>{d=!1,p&&i(5,o=n.defaultText)},u,t=>r("selectOption",{dropdownId:t}),function(){o=this.value,i(5,o)},t=>r("selectRenderer",{value:t})]}class lc extends At{constructor(t){super(),ft(this,t,ac,oc,a,{dropdownDisplayOptions:0,dropdownValue:1,rendererOptions:2,rendererValue:3,activeUrl:13,index:4})}}function cc(t){let e,i;return e=new lc({props:{dropdownValue:t[5],dropdownDisplayOptions:t[3],rendererOptions:t[6],rendererValue:t[1],index:t[0],activeUrl:t[2]}}),e.$on("setUrl",t[7]),e.$on("selectOption",t[8]),e.$on("selectRenderer",t[9]),e.$on("updateMapStore",t[10]),{c(){ht(e.$$.fragment)},m(t,r){dt(e,t,r),i=!0},p(t,i){const r={};32&i&&(r.dropdownValue=t[5]),8&i&&(r.dropdownDisplayOptions=t[3]),64&i&&(r.rendererOptions=t[6]),2&i&&(r.rendererValue=t[1]),1&i&&(r.index=t[0]),4&i&&(r.activeUrl=t[2]),e.$set(r)},i(t){i||(at(e.$$.fragment,t),i=!0)},o(t){lt(e.$$.fragment,t),i=!1},d(t){pt(e,t)}}}function uc(t){let e,i,r=t[4]&&cc(t);return{c(){e=b("div"),r&&r.c(),S(e,"class","map-style-input-wrapper svelte-7abtsv")},m(t,n){y(t,e,n),r&&r.m(e,null),i=!0},p(t,[i]){t[4]?r?(r.p(t,i),16&i&&at(r,1)):(r=cc(t),r.c(),at(r,1),r.m(e,null)):r&&(ot(),lt(r,1,1,(()=>{r=null})),st())},i(t){i||(at(r),i=!0)},o(t){lt(r),i=!1},d(t){t&&v(e),r&&r.d()}}}function hc(t,e,i){let r,n,o,s,a,l,{index:c}=e,{stylesheet:u}=e;It.subscribe((t=>({branchPatterns:r}=t)));let h=[];Ct.subscribe((t=>{i(12,n=t.find((t=>t.index===c))),n&&(o=n.branch,s=n.renderer,a=n.type,i(2,l=n.url))}));let d,p,f={},A=[],m=[];const g=()=>{let t;for(const e of A)if(e?.selected&&(t=e),"sublist"===e?.type)for(const i of e?.presets)i?.selected&&(t=i);if(t){switch(t=JSON.parse(JSON.stringify(t)),t.dropdownType){case"preset":t={...t,defaultText:""};break;case"branch":t={...t,defaultText:o??""};break;case"custom":t={...t,defaultText:l,url:l}}i(5,d=t)}},_=()=>{i(6,m=Ll(d,u?.sources)),y()},y=()=>{let t=s;const e=Ll(d,u?.sources).map((t=>t.value));t&&e.includes(t)||(t=e.includes(d.type)?d.type:e[0]),i(1,p=t)},v=()=>{(()=>{if(i(3,f={}),i(4,A=[]),h.length){const t=h.map((t=>({...t,dropdownType:"preset",selected:l===t?.url&&a===t?.type,dropdownId:Cl(),..."sublist"===t.type&&{presets:t.presets.map((t=>({...t,dropdownType:"preset",selected:l===t?.url&&a===t?.type,dropdownId:Cl()})))}})));i(4,A=A.concat(t)),i(3,f.Presets=t.map((t=>({text:t.name,..."sublist"!==t.type&&{dropdownId:t.dropdownId},..."sublist"===t.type&&{type:"sublist",presets:t.presets.map((t=>({text:t.name,dropdownId:t.dropdownId})))}}))),f)}if(r){let t=[];for(const e of r){let r={name:e.name??e.id,type:"sublist",dropdownId:Cl(),presets:[]};if(e?.styles?.length){const t=e?.styles.map((t=>({name:`${t.charAt(0).toUpperCase()+t.slice(1)} on...`,id:t,type:e.type,dropdownType:"branch",selected:!(!o||Sl(e.pattern,o,t)!==l||e.type!==a),pattern:e.pattern,dropdownId:Cl()})));r.presets=r.presets.concat(t)}t.push(r),i(4,A=A.concat(t)),i(3,f["Styles on a branch"]=t.map((t=>({text:t.name,..."sublist"!==t.type&&{dropdownId:t.dropdownId},..."sublist"===t.type&&{type:"sublist",presets:t.presets.map((t=>({text:t.name,dropdownId:t.dropdownId})))}}))),f)}}const t=A.some((t=>!!t?.selected||t?.presets?.some((t=>!!t.selected)))),e=[{name:"Fetch URL at...",dropdownType:"custom",selected:!t,type:"mapbox-gl",renderer:"mapbox-gl",dropdownId:Cl()}];i(4,A=A.concat(e)),i(3,f.Custom=e.map((t=>({text:t.name,dropdownId:t.dropdownId}))),f)})(),g()};St.subscribe((t=>{h=t,v(),_()}));return t.$$set=t=>{"index"in t&&i(0,c=t.index),"stylesheet"in t&&i(11,u=t.stylesheet)},t.$$.update=()=>{var e;4096&t.$$.dirty&&(!(e=n)||"branch"===d?.dropdownType&&!d?.url&&n.isPolling||e.type===d.type&&e.url===d.url||v()),2&t.$$.dirty&&(t=>{Ct.update((e=>e.map(((e,i)=>i!==c?e:{...e,renderer:t}))))})(p)},[c,p,l,f,A,d,m,t=>{i(5,d.url=t.detail.value,d),_()},t=>{const{dropdownId:e}=t.detail;i(4,A=A.reduce(((t,i)=>{let r=i;return"sublist"===r?.type?r.presets=r.presets.map((t=>({...t,selected:t.dropdownId===e}))):r={...r,selected:i.dropdownId===e},t.push(r),t}),[])),g(),_()},t=>{i(1,p=t.detail.value)},t=>{const{value:e}=t.detail;if(e.isPolling)Ct.update((t=>t.map(((t,i)=>i===c?{...t,...e}:t))));else{const t={...e,index:c,renderer:s};delete t.dropdownId,Ct.update((e=>e.map(((e,i)=>i===c?t:e))))}},u,n]}class dc extends At{constructor(t){super(),ft(this,t,hc,uc,a,{index:0,stylesheet:11})}}function pc(t){let e,i,r,n;const o=t[1].default,s=c(o,t,t[0],null);return{c(){e=b("button"),s&&s.c(),S(e,"class","svelte-d9bm20")},m(o,a){y(o,e,a),s&&s.m(e,null),i=!0,r||(n=C(e,"click",t[2]),r=!0)},p(t,[e]){s&&s.p&&(!i||1&e)&&d(s,o,t,t[0],i?h(o,t[0],e,null):p(t[0]),null)},i(t){i||(at(s,t),i=!0)},o(t){lt(s,t),i=!1},d(t){t&&v(e),s&&s.d(t),r=!1,n()}}}function fc(t,e,i){let{$$slots:r={},$$scope:n}=e;return t.$$set=t=>{"$$scope"in t&&i(0,n=t.$$scope)},[n,r,function(e){H.call(this,t,e)}]}class Ac extends At{constructor(t){super(),ft(this,t,fc,pc,a,{})}}function mc(t){let e,i,r,n,o,s,a,l,c,u,h,d,p;return a=new Ac({props:{$$slots:{default:[_c]},$$scope:{ctx:t}}}),a.$on("click",t[6]),u=new Ac({props:{$$slots:{default:[yc]},$$scope:{ctx:t}}}),u.$on("click",t[5]),{c(){e=b("div"),i=b("div"),r=T(t[2]),n=B(),o=b("div"),s=b("div"),ht(a.$$.fragment),l=B(),c=b("div"),ht(u.$$.fragment),S(i,"class","map-state svelte-1nshzal"),S(s,"class","svelte-1nshzal"),S(c,"class","svelte-1nshzal"),S(o,"class","location-actions svelte-1nshzal"),S(e,"class","map-state-container svelte-1nshzal")},m(f,A){y(f,e,A),_(e,i),_(i,r),_(e,n),_(e,o),_(o,s),dt(a,s,null),_(o,l),_(o,c),dt(u,c,null),h=!0,d||(p=C(i,"click",t[5]),d=!0)},p(t,e){(!h||4&e)&&M(r,t[2]);const i={};2097152&e&&(i.$$scope={dirty:e,ctx:t}),a.$set(i);const n={};2097153&e&&(n.$$scope={dirty:e,ctx:t}),u.$set(n)},i(t){h||(at(a.$$.fragment,t),at(u.$$.fragment,t),h=!0)},o(t){lt(a.$$.fragment,t),lt(u.$$.fragment,t),h=!1},d(t){t&&v(e),pt(a),pt(u),d=!1,p()}}}function gc(t){let i,r,n,s,a;return{c(){i=b("div"),r=b("input"),n=b("label"),n.textContent="enter zoom/lat/lng[/pitch/bearing]",P(r,"height","18px"),S(r,"type","text"),S(n,"class","input-label svelte-1nshzal"),S(i,"class","state-record svelte-1nshzal")},m(e,o){y(e,i,o),_(i,r),k(r,t[3]),t[17](r),_(i,n),s||(a=[C(r,"input",t[15]),C(r,"keydown",t[16]),C(r,"focus",xc)],s=!0)},p(t,e){8&e&&r.value!==t[3]&&k(r,t[3])},i:e,o:e,d(e){e&&v(i),t[17](null),s=!1,o(a)}}}function _c(t){let e;return{c(){e=T("change")},m(t,i){y(t,e,i)},d(t){t&&v(e)}}}function yc(t){let e,i=t[0]?"copied":"copy";return{c(){e=T(i)},m(t,i){y(t,e,i)},p(t,r){1&r&&i!==(i=t[0]?"copied":"copy")&&M(e,i)},d(t){t&&v(e)}}}function vc(t){let e,i,r,n;const o=[gc,mc],s=[];function a(t,e){return t[1]?0:1}return i=a(t),r=s[i]=o[i](t),{c(){e=b("div"),r.c()},m(t,r){y(t,e,r),s[i].m(e,null),n=!0},p(t,[n]){let l=i;i=a(t),i===l?s[i].p(t,n):(ot(),lt(s[l],1,1,(()=>{s[l]=null})),st(),r=s[i],r?r.p(t,n):(r=s[i]=o[i](t),r.c()),at(r,1),r.m(e,null))},i(t){n||(at(r),n=!0)},o(t){lt(r),n=!1},d(t){t&&v(e),s[i].d()}}}const xc=t=>t.target.select();function bc(t,e,i){let r,n,{bearing:o}=e,{center:s}=e,{pitch:a}=e,{zoom:l}=e;const c=j();let u,h=!1,d=!1,p="",f="";const A=()=>{i(1,d=!1)},m=()=>{i(1,d=!1),i(0,h=!1);const[t,e,r,n,o]=f.split("/"),s=(({zoom:t,lat:e,lng:i,pitch:r,bearing:n})=>{let o=!0;return[t,e,i,r,n].filter(Boolean).every((t=>!isNaN(Number(t))))||(o=!1),(+t<0||+t>24)&&(o=!1),(+e<-90||+e>90)&&(o=!1),(+i<-180||+i>180)&&(o=!1),void 0!==r&&(+r<0||+r>85)&&(o=!1),void 0!==n&&(+n<0||+n>360)&&(o=!1),o})({zoom:t,lat:e,lng:r,pitch:n,bearing:o});if(!s)return;const a={mapStateUpdateOrigin:"controls"};void 0!==t&&(a.zoom=+t),void 0!==e&&void 0!==r&&(a.center={lng:+r,lat:+e}),void 0!==n&&(a.pitch=+n),void 0!==o&&(a.bearing=+o),c("mapState",{options:a})};return t.$$set=t=>{"bearing"in t&&i(9,o=t.bearing),"center"in t&&i(10,s=t.center),"pitch"in t&&i(11,a=t.pitch),"zoom"in t&&i(12,l=t.zoom)},t.$$.update=()=>{1024&t.$$.dirty&&i(14,r=s.lat),1024&t.$$.dirty&&i(13,n=s.lng),31232&t.$$.dirty&&((t,e,r,n,o)=>{let s=[zt(r,2),zt(t,3),zt(e,3)];(n||o)&&(s.push(zt(n,1)),s.push(zt(o,1))),i(2,p=s.join("/")),i(0,h=!1)})(r,n,l,a,o)},[h,d,p,f,u,()=>{i(0,h=!0),navigator.clipboard.writeText(p)},async()=>{i(1,d=!0),i(3,f=p),await(X(),K),u.focus()},A,m,o,s,a,l,n,r,function(){f=this.value,i(3,f)},t=>{"Enter"===t.key&&m(),"Escape"===t.key&&A()},function(t){$[t?"unshift":"push"]((()=>{u=t,i(4,u)}))}]}class wc extends At{constructor(t){super(),ft(this,t,bc,vc,a,{bearing:9,center:10,pitch:11,zoom:12})}}function Tc(t){let e,i,r,n,o,a,l,c,u,h,d,p,f,A=!t[7]&&Object.keys(t[5]).length;r=new Tl({props:{icon:Al}}),u=new dc({props:{index:t[0],stylesheet:t[4]}});let m=A&&Bc(t);return{c(){e=b("div"),i=b("button"),ht(r.$$.fragment),n=B(),o=b("div"),a=T(t[1]),l=B(),c=b("div"),ht(u.$$.fragment),h=B(),m&&m.c(),S(i,"class","close-button svelte-1mnw17n"),i.disabled=t[3],S(o,"class","map-name svelte-1mnw17n"),S(c,"class","options-container svelte-1mnw17n"),S(e,"class","map-label svelte-1mnw17n")},m(A,g){y(A,e,g),_(e,i),dt(r,i,null),_(e,n),_(e,o),_(o,a),_(e,l),_(e,c),dt(u,c,null),_(c,h),m&&m.m(c,null),d=!0,p||(f=C(i,"click",(function(){s(t[2])&&t[2].apply(this,arguments)})),p=!0)},p(e,r){t=e,(!d||8&r)&&(i.disabled=t[3]),(!d||2&r)&&M(a,t[1]);const n={};1&r&&(n.index=t[0]),16&r&&(n.stylesheet=t[4]),u.$set(n),160&r&&(A=!t[7]&&Object.keys(t[5]).length),A?m?(m.p(t,r),160&r&&at(m,1)):(m=Bc(t),m.c(),at(m,1),m.m(c,null)):m&&(ot(),lt(m,1,1,(()=>{m=null})),st())},i(t){d||(at(r.$$.fragment,t),at(u.$$.fragment,t),at(m),d=!0)},o(t){lt(r.$$.fragment,t),lt(u.$$.fragment,t),lt(m),d=!1},d(t){t&&v(e),pt(r),pt(u),m&&m.d(),p=!1,f()}}}function Bc(t){let e,r,n;const o=[t[5]];let s={};for(let t=0;t<o.length;t+=1)s=i(s,o[t]);return r=new wc({props:s}),r.$on("mapState",t[9]),{c(){e=b("div"),ht(r.$$.fragment),S(e,"class","location-control svelte-1mnw17n")},m(t,i){y(t,e,i),dt(r,e,null),n=!0},p(t,e){const i=32&e?ct(o,[ut(t[5])]):{};r.$set(i)},i(t){n||(at(r.$$.fragment,t),n=!0)},o(t){lt(r.$$.fragment,t),n=!1},d(t){t&&v(e),pt(r)}}}function Ec(t){let e,i,r=t[6]&&Tc(t);return{c(){r&&r.c(),e=E()},m(t,n){r&&r.m(t,n),y(t,e,n),i=!0},p(t,[i]){t[6]?r?(r.p(t,i),64&i&&at(r,1)):(r=Tc(t),r.c(),at(r,1),r.m(e.parentNode,e)):r&&(ot(),lt(r,1,1,(()=>{r=null})),st())},i(t){i||(at(r),i=!0)},o(t){lt(r),i=!1},d(t){r&&r.d(t),t&&v(e)}}}function Cc(t,e,i){let r,n,o,s;l(t,Mt,(t=>i(6,o=t))),l(t,kt,(t=>i(7,s=t)));let a,{index:c}=e,{name:u}=e,{onClose:h}=e,{disableClose:d}=e,{mapState:p}=e,{stylesheet:f}=e;return t.$$set=t=>{"index"in t&&i(0,c=t.index),"name"in t&&i(1,u=t.name),"onClose"in t&&i(2,h=t.onClose),"disableClose"in t&&i(3,d=t.disableClose),"mapState"in t&&i(8,p=t.mapState),"stylesheet"in t&&i(4,f=t.stylesheet)},t.$$.update=()=>{256&t.$$.dirty&&i(5,({showBoundaries:r,showCollisions:n,...a}=p),a)},[c,u,h,d,f,a,o,s,p,function(e){H.call(this,t,e)}]}class Sc extends At{constructor(t){super(),ft(this,t,Cc,Ec,a,{index:0,name:1,onClose:2,disableClose:3,mapState:8,stylesheet:4})}}const Ic=["swipe","mirror","phone","responsive"],Mc=(t,e)=>e.some((({type:t})=>"google"===t))?t.zoom<12?35:45:60,kc=(t,e)=>{const i={...t};if((t=>t.some((({type:t})=>"google"===t)))(e)){const r=Mc(t,e);i.pitch>r&&(i.pitch=r)}return i};var Pc={exports:{}};!function(t,e){var i="__lodash_hash_undefined__",r=1,n=2,o=9007199254740991,s="[object Arguments]",a="[object Array]",l="[object AsyncFunction]",c="[object Boolean]",u="[object Date]",h="[object Error]",d="[object Function]",p="[object GeneratorFunction]",f="[object Map]",A="[object Number]",m="[object Null]",g="[object Object]",_="[object Promise]",y="[object Proxy]",v="[object RegExp]",x="[object Set]",b="[object String]",w="[object Symbol]",T="[object Undefined]",B="[object WeakMap]",E="[object ArrayBuffer]",C="[object DataView]",S=/^\[object .+?Constructor\]$/,I=/^(?:0|[1-9]\d*)$/,M={};M["[object Float32Array]"]=M["[object Float64Array]"]=M["[object Int8Array]"]=M["[object Int16Array]"]=M["[object Int32Array]"]=M["[object Uint8Array]"]=M["[object Uint8ClampedArray]"]=M["[object Uint16Array]"]=M["[object Uint32Array]"]=!0,M[s]=M[a]=M[E]=M[c]=M[C]=M[u]=M[h]=M[d]=M[f]=M[A]=M[g]=M[v]=M[x]=M[b]=M[B]=!1;var k="object"==typeof mt&&mt&&mt.Object===Object&&mt,P="object"==typeof self&&self&&self.Object===Object&&self,L=k||P||Function("return this")(),z=e&&!e.nodeType&&e,F=z&&t&&!t.nodeType&&t,D=F&&F.exports===z,R=D&&k.process,U=function(){try{return R&&R.binding&&R.binding("util")}catch(t){}}(),O=U&&U.isTypedArray;function N(t,e){for(var i=-1,r=null==t?0:t.length;++i<r;)if(e(t[i],i,t))return!0;return!1}function Q(t){var e=-1,i=Array(t.size);return t.forEach((function(t,r){i[++e]=[r,t]})),i}function V(t){var e=-1,i=Array(t.size);return t.forEach((function(t){i[++e]=t})),i}var j,H=Array.prototype,G=Function.prototype,$=Object.prototype,Z=L["__core-js_shared__"],q=G.toString,K=$.hasOwnProperty,W=(j=/[^.]+$/.exec(Z&&Z.keys&&Z.keys.IE_PROTO||""))?"Symbol(src)_1."+j:"",X=$.toString,J=RegExp("^"+q.call(K).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Y=D?L.Buffer:void 0,tt=L.Symbol,et=L.Uint8Array,it=$.propertyIsEnumerable,rt=H.splice,nt=tt?tt.toStringTag:void 0,ot=Object.getOwnPropertySymbols,st=Y?Y.isBuffer:void 0,at=function(t,e){return function(i){return t(e(i))}}(Object.keys,Object),lt=Rt(L,"DataView"),ct=Rt(L,"Map"),ut=Rt(L,"Promise"),ht=Rt(L,"Set"),dt=Rt(L,"WeakMap"),pt=Rt(Object,"create"),ft=Qt(lt),At=Qt(ct),gt=Qt(ut),_t=Qt(ht),yt=Qt(dt),vt=tt?tt.prototype:void 0,xt=vt?vt.valueOf:void 0;function bt(t){var e=-1,i=null==t?0:t.length;for(this.clear();++e<i;){var r=t[e];this.set(r[0],r[1])}}function wt(t){var e=-1,i=null==t?0:t.length;for(this.clear();++e<i;){var r=t[e];this.set(r[0],r[1])}}function Tt(t){var e=-1,i=null==t?0:t.length;for(this.clear();++e<i;){var r=t[e];this.set(r[0],r[1])}}function Bt(t){var e=-1,i=null==t?0:t.length;for(this.__data__=new Tt;++e<i;)this.add(t[e])}function Et(t){var e=this.__data__=new wt(t);this.size=e.size}function Ct(t,e){var i=Ht(t),r=!i&&jt(t),n=!i&&!r&&Gt(t),o=!i&&!r&&!n&&Wt(t),s=i||r||n||o,a=s?function(t,e){for(var i=-1,r=Array(t);++i<t;)r[i]=e(i);return r}(t.length,String):[],l=a.length;for(var c in t)!e&&!K.call(t,c)||s&&("length"==c||n&&("offset"==c||"parent"==c)||o&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||Nt(c,l))||a.push(c);return a}function St(t,e){for(var i=t.length;i--;)if(Vt(t[i][0],e))return i;return-1}function It(t){return null==t?void 0===t?T:m:nt&&nt in Object(t)?function(t){var e=K.call(t,nt),i=t[nt];try{t[nt]=void 0;var r=!0}catch(t){}var n=X.call(t);r&&(e?t[nt]=i:delete t[nt]);return n}(t):function(t){return X.call(t)}(t)}function Mt(t){return Kt(t)&&It(t)==s}function kt(t,e,i,o,l){return t===e||(null==t||null==e||!Kt(t)&&!Kt(e)?t!=t&&e!=e:function(t,e,i,o,l,d){var p=Ht(t),m=Ht(e),_=p?a:Ot(t),y=m?a:Ot(e),T=(_=_==s?g:_)==g,B=(y=y==s?g:y)==g,S=_==y;if(S&&Gt(t)){if(!Gt(e))return!1;p=!0,T=!1}if(S&&!T)return d||(d=new Et),p||Wt(t)?zt(t,e,i,o,l,d):function(t,e,i,o,s,a,l){switch(i){case C:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case E:return!(t.byteLength!=e.byteLength||!a(new et(t),new et(e)));case c:case u:case A:return Vt(+t,+e);case h:return t.name==e.name&&t.message==e.message;case v:case b:return t==e+"";case f:var d=Q;case x:var p=o&r;if(d||(d=V),t.size!=e.size&&!p)return!1;var m=l.get(t);if(m)return m==e;o|=n,l.set(t,e);var g=zt(d(t),d(e),o,s,a,l);return l.delete(t),g;case w:if(xt)return xt.call(t)==xt.call(e)}return!1}(t,e,_,i,o,l,d);if(!(i&r)){var I=T&&K.call(t,"__wrapped__"),M=B&&K.call(e,"__wrapped__");if(I||M){var k=I?t.value():t,P=M?e.value():e;return d||(d=new Et),l(k,P,i,o,d)}}if(!S)return!1;return d||(d=new Et),function(t,e,i,n,o,s){var a=i&r,l=Ft(t),c=l.length,u=Ft(e),h=u.length;if(c!=h&&!a)return!1;var d=c;for(;d--;){var p=l[d];if(!(a?p in e:K.call(e,p)))return!1}var f=s.get(t);if(f&&s.get(e))return f==e;var A=!0;s.set(t,e),s.set(e,t);var m=a;for(;++d<c;){var g=t[p=l[d]],_=e[p];if(n)var y=a?n(_,g,p,e,t,s):n(g,_,p,t,e,s);if(!(void 0===y?g===_||o(g,_,i,n,s):y)){A=!1;break}m||(m="constructor"==p)}if(A&&!m){var v=t.constructor,x=e.constructor;v==x||!("constructor"in t)||!("constructor"in e)||"function"==typeof v&&v instanceof v&&"function"==typeof x&&x instanceof x||(A=!1)}return s.delete(t),s.delete(e),A}(t,e,i,o,l,d)}(t,e,i,o,kt,l))}function Pt(t){return!(!qt(t)||function(t){return!!W&&W in t}(t))&&($t(t)?J:S).test(Qt(t))}function Lt(t){if(i=(e=t)&&e.constructor,r="function"==typeof i&&i.prototype||$,e!==r)return at(t);var e,i,r,n=[];for(var o in Object(t))K.call(t,o)&&"constructor"!=o&&n.push(o);return n}function zt(t,e,i,o,s,a){var l=i&r,c=t.length,u=e.length;if(c!=u&&!(l&&u>c))return!1;var h=a.get(t);if(h&&a.get(e))return h==e;var d=-1,p=!0,f=i&n?new Bt:void 0;for(a.set(t,e),a.set(e,t);++d<c;){var A=t[d],m=e[d];if(o)var g=l?o(m,A,d,e,t,a):o(A,m,d,t,e,a);if(void 0!==g){if(g)continue;p=!1;break}if(f){if(!N(e,(function(t,e){if(r=e,!f.has(r)&&(A===t||s(A,t,i,o,a)))return f.push(e);var r}))){p=!1;break}}else if(A!==m&&!s(A,m,i,o,a)){p=!1;break}}return a.delete(t),a.delete(e),p}function Ft(t){return function(t,e,i){var r=e(t);return Ht(t)?r:function(t,e){for(var i=-1,r=e.length,n=t.length;++i<r;)t[n+i]=e[i];return t}(r,i(t))}(t,Xt,Ut)}function Dt(t,e){var i,r,n=t.__data__;return("string"==(r=typeof(i=e))||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==i:null===i)?n["string"==typeof e?"string":"hash"]:n.map}function Rt(t,e){var i=function(t,e){return null==t?void 0:t[e]}(t,e);return Pt(i)?i:void 0}bt.prototype.clear=function(){this.__data__=pt?pt(null):{},this.size=0},bt.prototype.delete=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},bt.prototype.get=function(t){var e=this.__data__;if(pt){var r=e[t];return r===i?void 0:r}return K.call(e,t)?e[t]:void 0},bt.prototype.has=function(t){var e=this.__data__;return pt?void 0!==e[t]:K.call(e,t)},bt.prototype.set=function(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=pt&&void 0===e?i:e,this},wt.prototype.clear=function(){this.__data__=[],this.size=0},wt.prototype.delete=function(t){var e=this.__data__,i=St(e,t);return!(i<0)&&(i==e.length-1?e.pop():rt.call(e,i,1),--this.size,!0)},wt.prototype.get=function(t){var e=this.__data__,i=St(e,t);return i<0?void 0:e[i][1]},wt.prototype.has=function(t){return St(this.__data__,t)>-1},wt.prototype.set=function(t,e){var i=this.__data__,r=St(i,t);return r<0?(++this.size,i.push([t,e])):i[r][1]=e,this},Tt.prototype.clear=function(){this.size=0,this.__data__={hash:new bt,map:new(ct||wt),string:new bt}},Tt.prototype.delete=function(t){var e=Dt(this,t).delete(t);return this.size-=e?1:0,e},Tt.prototype.get=function(t){return Dt(this,t).get(t)},Tt.prototype.has=function(t){return Dt(this,t).has(t)},Tt.prototype.set=function(t,e){var i=Dt(this,t),r=i.size;return i.set(t,e),this.size+=i.size==r?0:1,this},Bt.prototype.add=Bt.prototype.push=function(t){return this.__data__.set(t,i),this},Bt.prototype.has=function(t){return this.__data__.has(t)},Et.prototype.clear=function(){this.__data__=new wt,this.size=0},Et.prototype.delete=function(t){var e=this.__data__,i=e.delete(t);return this.size=e.size,i},Et.prototype.get=function(t){return this.__data__.get(t)},Et.prototype.has=function(t){return this.__data__.has(t)},Et.prototype.set=function(t,e){var i=this.__data__;if(i instanceof wt){var r=i.__data__;if(!ct||r.length<199)return r.push([t,e]),this.size=++i.size,this;i=this.__data__=new Tt(r)}return i.set(t,e),this.size=i.size,this};var Ut=ot?function(t){return null==t?[]:(t=Object(t),function(t,e){for(var i=-1,r=null==t?0:t.length,n=0,o=[];++i<r;){var s=t[i];e(s,i,t)&&(o[n++]=s)}return o}(ot(t),(function(e){return it.call(t,e)})))}:function(){return[]},Ot=It;function Nt(t,e){return!!(e=null==e?o:e)&&("number"==typeof t||I.test(t))&&t>-1&&t%1==0&&t<e}function Qt(t){if(null!=t){try{return q.call(t)}catch(t){}try{return t+""}catch(t){}}return""}function Vt(t,e){return t===e||t!=t&&e!=e}(lt&&Ot(new lt(new ArrayBuffer(1)))!=C||ct&&Ot(new ct)!=f||ut&&Ot(ut.resolve())!=_||ht&&Ot(new ht)!=x||dt&&Ot(new dt)!=B)&&(Ot=function(t){var e=It(t),i=e==g?t.constructor:void 0,r=i?Qt(i):"";if(r)switch(r){case ft:return C;case At:return f;case gt:return _;case _t:return x;case yt:return B}return e});var jt=Mt(function(){return arguments}())?Mt:function(t){return Kt(t)&&K.call(t,"callee")&&!it.call(t,"callee")},Ht=Array.isArray;var Gt=st||function(){return!1};function $t(t){if(!qt(t))return!1;var e=It(t);return e==d||e==p||e==l||e==y}function Zt(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=o}function qt(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}function Kt(t){return null!=t&&"object"==typeof t}var Wt=O?function(t){return function(e){return t(e)}}(O):function(t){return Kt(t)&&Zt(t.length)&&!!M[It(t)]};function Xt(t){return null!=(e=t)&&Zt(e.length)&&!$t(e)?Ct(t):Lt(t);var e}t.exports=function(t,e){return kt(t,e)}}(Pc,Pc.exports);var Lc=Pc.exports;function zc(t){let e,r,n;const o=[t[7],t[8]];var s=t[6];function a(t){let e={};for(let t=0;t<o.length;t+=1)e=i(e,o[t]);return{props:e}}return s&&(r=U(s,a()),r.$on("mapMove",t[10])),{c(){e=b("div"),r&&ht(r.$$.fragment),S(e,"class","map svelte-gam7py"),R(e,"highlight-diff",t[2])},m(t,i){y(t,e,i),r&&dt(r,e,null),n=!0},p(t,i){const l=384&i?ct(o,[128&i&&ut(t[7]),256&i&&ut(t[8])]):{};if(64&i&&s!==(s=t[6])){if(r){ot();const t=r;lt(t.$$.fragment,1,0,(()=>{pt(t,1)})),st()}s?(r=U(s,a()),r.$on("mapMove",t[10]),ht(r.$$.fragment),at(r.$$.fragment,1),dt(r,e,null)):r=null}else s&&r.$set(l);(!n||4&i)&&R(e,"highlight-diff",t[2])},i(t){n||(r&&at(r.$$.fragment,t),n=!0)},o(t){r&&lt(r.$$.fragment,t),n=!1},d(t){t&&v(e),r&&pt(r)}}}function Fc(t){let e,i,r,n,o;return i=new Sc({props:{index:t[0].index,name:t[0].name,onClose:t[9],disableClose:t[1]<=1,mapState:t[8],stylesheet:t[4]}}),i.$on("mapState",t[10]),{c(){e=b("div"),ht(i.$$.fragment),S(e,"id",r=t[0].id),S(e,"class",n=m("map-label-container "+(2===t[1]?`map-label-container-${t[0].index}`:""))+" svelte-gam7py"),S(e,"style",t[3])},m(t,r){y(t,e,r),dt(i,e,null),o=!0},p(t,s){const a={};1&s&&(a.index=t[0].index),1&s&&(a.name=t[0].name),2&s&&(a.disableClose=t[1]<=1),256&s&&(a.mapState=t[8]),16&s&&(a.stylesheet=t[4]),i.$set(a),(!o||1&s&&r!==(r=t[0].id))&&S(e,"id",r),(!o||3&s&&n!==(n=m("map-label-container "+(2===t[1]?`map-label-container-${t[0].index}`:""))+" svelte-gam7py"))&&S(e,"class",n),(!o||8&s)&&S(e,"style",t[3])},i(t){o||(at(i.$$.fragment,t),o=!0)},o(t){lt(i.$$.fragment,t),o=!1},d(t){t&&v(e),pt(i)}}}function Dc(t){let i,r,n,o,s,l,c=(t[0].name??t[0].id)+"",u=t[5],h=`${t[1]}-${t[0].index}`,d=zc(t),p=Fc(t);return{c(){i=b("div"),r=b("div"),n=T(c),o=B(),d.c(),s=B(),p.c(),S(r,"class","screenshot-label-transparent svelte-gam7py"),S(i,"class","map-container svelte-gam7py")},m(t,e){y(t,i,e),_(i,r),_(r,n),_(i,o),d.m(i,null),_(i,s),p.m(i,null),l=!0},p(t,[r]){(!l||1&r)&&c!==(c=(t[0].name??t[0].id)+"")&&M(n,c),32&r&&a(u,u=t[5])?(ot(),lt(d,1,1,e),st(),d=zc(t),d.c(),at(d,1),d.m(i,s)):d.p(t,r),3&r&&a(h,h=`${t[1]}-${t[0].index}`)?(ot(),lt(p,1,1,e),st(),p=Fc(t),p.c(),at(p,1),p.m(i,null)):p.p(t,r)},i(t){l||(at(d),at(p),l=!0)},o(t){lt(d),lt(p),l=!1},d(t){t&&v(i),d.d(t),p.d(t)}}}function Rc(t,e,r){let n,o,s,a;const c=["map","numberOfMaps","highlightDifferences","labelStyle"];let u,h,d=A(e,c);l(t,kt,(t=>r(14,u=t))),l(t,Pt,(t=>r(12,h=t)));let{map:p}=e,{numberOfMaps:m}=e,{highlightDifferences:g=!1}=e,{labelStyle:_=""}=e;const y=j();let v,x={},b={};const w=t=>{switch(t){case"google":r(6,v=Xa);break;case"leaflet":r(6,v=ol);break;case"tangram":r(6,v=cl);break;default:r(6,v=el),r(7,x.mapRenderer=t,x)}};return t.$$set=t=>{e=i(i({},e),f(t)),r(19,d=A(e,c)),"map"in t&&r(0,p=t.map),"numberOfMaps"in t&&r(1,m=t.numberOfMaps),"highlightDifferences"in t&&r(2,g=t.highlightDifferences),"labelStyle"in t&&r(3,_=t.labelStyle)},t.$$.update=()=>{4097&t.$$.dirty&&(n=h?.[p.index]??{}),1&t.$$.dirty&&r(11,o=`${p.id}-${p.index}`),17&t.$$.dirty&&(Lc(b,p?.style)||r(4,b=p?.style)),1&t.$$.dirty&&r(5,s=p.renderer),2066&t.$$.dirty&&(r(7,x={id:o,mapStyle:p,numberOfMaps:m}),w(s)),32&t.$$.dirty&&w(s),r(8,a=(t=>{if(u)return t;const{bearing:e,center:i,pitch:r,zoom:o,...s}=t;let a={...s,...{bearing:e,center:i,pitch:r,zoom:o,...n}};return a=kc(a,[p]),a})(d))},[p,m,g,_,b,s,v,x,a,()=>{Ct.update((t=>t.filter(((t,e)=>e!==p.index)).map(((t,e)=>({...t,index:e}))))),u||Pt.update((t=>t.filter(((t,e)=>e!==p.index))))},t=>{if(u)y("mapMove",t.detail);else{const{options:e}=t.detail;Pt.update((t=>t.map(((t,i)=>i===p.index?e:t))))}},o,h]}class Uc extends At{constructor(t){super(),ft(this,t,Rc,Dc,a,{map:0,numberOfMaps:1,highlightDifferences:2,labelStyle:3})}}function Oc(t,e,i){const r=t.slice();return r[1]=e[i],r}function Nc(t,e,i){const r=t.slice();return r[10]=e[i],r}function Qc(t){let e,r,n;const o=[{map:t[10]},t[0],{numberOfMaps:t[2]}];let s={};for(let t=0;t<o.length;t+=1)s=i(s,o[t]);return r=new Uc({props:s}),r.$on("mapMove",t[5]),{c(){e=b("div"),ht(r.$$.fragment),S(e,"class","map-container map-container-border svelte-1xkn139")},m(t,i){y(t,e,i),dt(r,e,null),n=!0},p(t,e){const i=13&e?ct(o,[8&e&&{map:t[10]},1&e&&ut(t[0]),4&e&&{numberOfMaps:t[2]}]):{};r.$set(i)},i(t){n||(at(r.$$.fragment,t),n=!0)},o(t){lt(r.$$.fragment,t),n=!1},d(t){t&&v(e),pt(r)}}}function Vc(t){let e,i,r,n=t[1],o=[];for(let e=0;e<n.length;e+=1)o[e]=Qc(Nc(t,n,e));const s=t=>lt(o[t],1,1,(()=>{o[t]=null}));return{c(){e=b("div");for(let t=0;t<o.length;t+=1)o[t].c();i=B(),S(e,"class","section svelte-1xkn139")},m(t,n){y(t,e,n);for(let t=0;t<o.length;t+=1)o[t]&&o[t].m(e,null);_(e,i),r=!0},p(t,r){if(13&r){let a;for(n=t[1],a=0;a<n.length;a+=1){const s=Nc(t,n,a);o[a]?(o[a].p(s,r),at(o[a],1)):(o[a]=Qc(s),o[a].c(),at(o[a],1),o[a].m(e,i))}for(ot(),a=n.length;a<o.length;a+=1)s(a);st()}},i(t){if(!r){for(let t=0;t<n.length;t+=1)at(o[t]);r=!0}},o(t){o=o.filter(Boolean);for(let t=0;t<o.length;t+=1)lt(o[t]);r=!1},d(t){t&&v(e),x(o,t)}}}function jc(t){let e,i,r,n,o=t[3],s=[];for(let e=0;e<o.length;e+=1)s[e]=Vc(Oc(t,o,e));const a=t=>lt(s[t],1,1,(()=>{s[t]=null}));return{c(){e=b("div"),i=b("div");for(let t=0;t<s.length;t+=1)s[t].c();S(i,"class","maps svelte-1xkn139"),S(e,"class",r=m(`mirror mirror-${t[4]}-orientation`)+" svelte-1xkn139")},m(t,r){y(t,e,r),_(e,i);for(let t=0;t<s.length;t+=1)s[t]&&s[t].m(i,null);n=!0},p(t,[l]){if(13&l){let e;for(o=t[3],e=0;e<o.length;e+=1){const r=Oc(t,o,e);s[e]?(s[e].p(r,l),at(s[e],1)):(s[e]=Vc(r),s[e].c(),at(s[e],1),s[e].m(i,null))}for(ot(),e=o.length;e<s.length;e+=1)a(e);st()}(!n||16&l&&r!==(r=m(`mirror mirror-${t[4]}-orientation`)+" svelte-1xkn139"))&&S(e,"class",r)},i(t){if(!n){for(let t=0;t<o.length;t+=1)at(s[t]);n=!0}},o(t){s=s.filter(Boolean);for(let t=0;t<s.length;t+=1)lt(s[t]);n=!1},d(t){t&&v(e),x(s,t)}}}function Hc(t,e,i){let{maps:r=[]}=e,{mapState:n}=e,o=[],s=0;const a=[2,6];let l;return t.$$set=t=>{"maps"in t&&i(1,r=t.maps),"mapState"in t&&i(0,n=t.mapState)},t.$$.update=()=>{2&t.$$.dirty&&i(2,s=r.length),4&t.$$.dirty&&i(4,l=a.includes(s)?"row":"column"),2&t.$$.dirty&&(t=>{const e=Math.round(Math.sqrt(s)),r=Math.floor(s/e);let n=JSON.parse(JSON.stringify(t)),a=[];for(;n.length;)a.push(n.slice(0,r)),n=n.slice(r);i(3,o=a)})(r)},[n,r,s,o,l,function(e){H.call(this,t,e)}]}class Gc extends At{constructor(t){super(),ft(this,t,Hc,jc,a,{maps:1,mapState:0})}}function $c(t,e,i){const r=t.slice();return r[3]=e[i],r}function Zc(t){let e,r,n,o;const s=[{map:t[3]},t[1],{labelStyle:"position: absolute; margin-top: 48px; left: 0; right: 0; bottom: unset; max-width: unset;"},{numberOfMaps:t[0].length}];let a={};for(let t=0;t<s.length;t+=1)a=i(a,s[t]);return r=new Uc({props:a}),r.$on("mapMove",t[2]),{c(){e=b("div"),ht(r.$$.fragment),n=B(),S(e,"class","map-container svelte-1hvjgnk")},m(t,i){y(t,e,i),dt(r,e,null),_(e,n),o=!0},p(t,e){const i=3&e?ct(s,[1&e&&{map:t[3]},2&e&&ut(t[1]),s[2],1&e&&{numberOfMaps:t[0].length}]):{};r.$set(i)},i(t){o||(at(r.$$.fragment,t),o=!0)},o(t){lt(r.$$.fragment,t),o=!1},d(t){t&&v(e),pt(r)}}}function qc(t){let e,i,r,n=t[0],o=[];for(let e=0;e<n.length;e+=1)o[e]=Zc($c(t,n,e));const s=t=>lt(o[t],1,1,(()=>{o[t]=null}));return{c(){e=b("div"),i=b("div");for(let t=0;t<o.length;t+=1)o[t].c();S(i,"class","maps phone svelte-1hvjgnk"),S(e,"class","viewer-container svelte-1hvjgnk")},m(t,n){y(t,e,n),_(e,i);for(let t=0;t<o.length;t+=1)o[t]&&o[t].m(i,null);r=!0},p(t,[e]){if(3&e){let r;for(n=t[0],r=0;r<n.length;r+=1){const s=$c(t,n,r);o[r]?(o[r].p(s,e),at(o[r],1)):(o[r]=Zc(s),o[r].c(),at(o[r],1),o[r].m(i,null))}for(ot(),r=n.length;r<o.length;r+=1)s(r);st()}},i(t){if(!r){for(let t=0;t<n.length;t+=1)at(o[t]);r=!0}},o(t){o=o.filter(Boolean);for(let t=0;t<o.length;t+=1)lt(o[t]);r=!1},d(t){t&&v(e),x(o,t)}}}function Kc(t,e,i){let{maps:r}=e,{mapState:n}=e;return t.$$set=t=>{"maps"in t&&i(0,r=t.maps),"mapState"in t&&i(1,n=t.mapState)},[r,n,function(e){H.call(this,t,e)}]}class Wc extends At{constructor(t){super(),ft(this,t,Kc,qc,a,{maps:0,mapState:1})}}function Xc(t,e,i){const r=t.slice();return r[15]=e[i],r}function Jc(t){let e,r,n,o;const s=[{map:t[15]},t[1],{numberOfMaps:t[0].length},{highlightDifferences:1===t[15].index&&t[1]?.showDiff},{labelStyle:0===t[15].index?t[7]:t[6]}];let a={};for(let t=0;t<s.length;t+=1)a=i(a,s[t]);return r=new Uc({props:a}),r.$on("mapMove",t[13]),{c(){e=b("div"),ht(r.$$.fragment),S(e,"class","map-container svelte-myzk36"),S(e,"style",n=1===t[15].index&&t[2]?`clip: rect(0px, ${t[3]}px, ${t[5]}px, ${t[2]}px)`:null)},m(t,i){y(t,e,i),dt(r,e,null),o=!0},p(t,i){const a=195&i?ct(s,[1&i&&{map:t[15]},2&i&&ut(t[1]),1&i&&{numberOfMaps:t[0].length},3&i&&{highlightDifferences:1===t[15].index&&t[1]?.showDiff},193&i&&{labelStyle:0===t[15].index?t[7]:t[6]}]):{};r.$set(a),(!o||45&i&&n!==(n=1===t[15].index&&t[2]?`clip: rect(0px, ${t[3]}px, ${t[5]}px, ${t[2]}px)`:null))&&S(e,"style",n)},i(t){o||(at(r.$$.fragment,t),o=!0)},o(t){lt(r.$$.fragment,t),o=!1},d(t){t&&v(e),pt(r)}}}function Yc(t){let e,i,r,n,s,a,l,c=t[0],u=[];for(let e=0;e<c.length;e+=1)u[e]=Jc(Xc(t,c,e));const h=t=>lt(u[t],1,1,(()=>{u[t]=null}));return{c(){e=b("div");for(let t=0;t<u.length;t+=1)u[t].c();i=B(),r=b("div"),S(r,"class","slider svelte-myzk36"),P(r,"left",t[2]+"px"),P(r,"width",tu+"px"),S(e,"class","maps svelte-myzk36"),J((()=>t[14].call(e))),R(e,"dragging",t[4])},m(o,c){y(o,e,c);for(let t=0;t<u.length;t+=1)u[t]&&u[t].m(e,null);_(e,i),_(e,r),n=function(t,e){"static"===getComputedStyle(t).position&&(t.style.position="relative");const i=b("iframe");i.setAttribute("style","display: block; position: absolute; top: 0; left: 0; width: 100%; height: 100%; overflow: hidden; border: 0; opacity: 0; pointer-events: none; z-index: -1;"),i.setAttribute("aria-hidden","true"),i.tabIndex=-1;const r=D();let n;return r?(i.src="data:text/html,<script>onresize=function(){parent.postMessage(0,'*')}<\/script>",n=C(window,"message",(t=>{t.source===i.contentWindow&&e()}))):(i.src="about:blank",i.onload=()=>{n=C(i.contentWindow,"resize",e),e()}),_(t,i),()=>{(r||n&&i.contentWindow)&&n(),v(i)}}(e,t[14].bind(e)),s=!0,a||(l=[C(r,"mousedown",t[8]),C(e,"mousemove",t[10]),C(e,"mouseup",t[9])],a=!0)},p(t,[n]){if(239&n){let r;for(c=t[0],r=0;r<c.length;r+=1){const o=Xc(t,c,r);u[r]?(u[r].p(o,n),at(u[r],1)):(u[r]=Jc(o),u[r].c(),at(u[r],1),u[r].m(e,i))}for(ot(),r=c.length;r<u.length;r+=1)h(r);st()}(!s||4&n)&&P(r,"left",t[2]+"px"),(!s||16&n)&&R(e,"dragging",t[4])},i(t){if(!s){for(let t=0;t<c.length;t+=1)at(u[t]);s=!0}},o(t){u=u.filter(Boolean);for(let t=0;t<u.length;t+=1)lt(u[t]);s=!1},d(t){t&&v(e),x(u,t),n(),a=!1,o(l)}}}const tu=5;function eu(t,e,i){let r,n,o,s,a,l,{maps:c}=e,{mapState:u}=e,h=!1,d=0;return t.$$set=t=>{"maps"in t&&i(0,c=t.maps),"mapState"in t&&i(1,u=t.mapState)},t.$$.update=()=>{8&t.$$.dirty&&i(2,d=a/2),12&t.$$.dirty&&i(11,r=a-d),2056&t.$$.dirty&&i(12,n=a-r),4096&t.$$.dirty&&i(7,o=`right: unset; margin-right:unset; left:0; margin-left:1em; max-width:calc(${n}px - 6em)`),2048&t.$$.dirty&&i(6,s=`max-width:calc(${r}px - 6em)`)},[c,u,d,a,h,l,s,o,()=>i(4,h=!0),()=>i(4,h=!1),t=>{h&&0!==t.clientX&&i(2,d=t.clientX-tu/2)},r,n,function(e){H.call(this,t,e)},function(){l=this.clientHeight,a=this.clientWidth,i(5,l),i(3,a)}]}class iu extends At{constructor(t){super(),ft(this,t,eu,Yc,a,{maps:0,mapState:1})}}function ru(t){let e,r;const n=[{map:t[8]},t[6],{numberOfMaps:t[7]},{labelStyle:"position: fixed;"}];let o={};for(let t=0;t<n.length;t+=1)o=i(o,n[t]);return e=new Uc({props:o}),e.$on("mapMove",t[14]),{c(){ht(e.$$.fragment)},m(t,i){dt(e,t,i),r=!0},p(t,i){const r=448&i?ct(n,[256&i&&{map:t[8]},64&i&&ut(t[6]),128&i&&{numberOfMaps:t[7]},n[3]]):{};e.$set(r)},i(t){r||(at(e.$$.fragment,t),r=!0)},o(t){lt(e.$$.fragment,t),r=!1},d(t){pt(e,t)}}}function nu(t){let e,i,r,n,s,a,l,c,u,h,d,p,f,A,m,x,w,E,M,P,L,z,F,D,R,U,O,N,Q=t[8]&&ru(t);return{c(){e=b("div"),i=b("div"),Q&&Q.c(),n=B(),s=b("div"),a=b("div"),l=b("span"),l.textContent="Height:",c=B(),u=b("div"),h=b("input"),d=B(),p=b("div"),f=b("span"),f.textContent="Width:",A=B(),m=b("div"),x=b("input"),w=B(),E=b("div"),M=b("button"),P=T("Set Dimensions"),z=B(),F=b("button"),D=T("Reset"),S(i,"class","map-container svelte-1pk77jp"),S(i,"style",r=`height:${t[0]}px; width:${t[1]}px`),S(h,"type","number"),S(h,"class","input svelte-1pk77jp"),S(u,"class","input-container svelte-1pk77jp"),S(a,"class","dimension-input svelte-1pk77jp"),S(x,"type","number"),S(x,"class","input svelte-1pk77jp"),S(m,"class","input-container svelte-1pk77jp"),S(p,"class","dimension-input svelte-1pk77jp"),M.disabled=L=!t[3]||!t[2],F.disabled=R="100%"===t[0]&&"100%"===t[1],S(E,"class","buttons svelte-1pk77jp"),S(s,"class","responsive-input svelte-1pk77jp"),S(e,"class","maps responsive svelte-1pk77jp")},m(r,o){y(r,e,o),_(e,i),Q&&Q.m(i,null),_(e,n),_(e,s),_(s,a),_(a,l),_(a,c),_(a,u),_(u,h),k(h,t[2]),_(s,d),_(s,p),_(p,f),_(p,A),_(p,m),_(m,x),k(x,t[3]),_(s,w),_(s,E),_(E,M),_(M,P),_(E,z),_(E,F),_(F,D),U=!0,O||(N=[C(h,"input",t[15]),C(h,"focus",t[16]),C(h,"blur",t[17]),C(x,"input",t[18]),C(x,"focus",t[19]),C(x,"blur",t[20]),C(M,"click",t[10]),g(zl.call(null,M,{code:"Enter",callback:t[9]})),C(F,"click",t[11])],O=!0)},p(t,[e]){t[8]?Q?(Q.p(t,e),256&e&&at(Q,1)):(Q=ru(t),Q.c(),at(Q,1),Q.m(i,null)):Q&&(ot(),lt(Q,1,1,(()=>{Q=null})),st()),(!U||3&e&&r!==(r=`height:${t[0]}px; width:${t[1]}px`))&&S(i,"style",r),4&e&&I(h.value)!==t[2]&&k(h,t[2]),8&e&&I(x.value)!==t[3]&&k(x,t[3]),(!U||12&e&&L!==(L=!t[3]||!t[2]))&&(M.disabled=L),(!U||3&e&&R!==(R="100%"===t[0]&&"100%"===t[1]))&&(F.disabled=R)},i(t){U||(at(Q),U=!0)},o(t){lt(Q),U=!1},d(t){t&&v(e),Q&&Q.d(),O=!1,o(N)}}}function ou(t,e,i){let r,n,{maps:o}=e,{mapState:s}=e;const a=j();let l=s.height||"100%",c=s.width||"100%",u=s.height||"",h=s.width||"",d=!1,p=!1,f=s;delete f.width,delete f.height;const A=()=>{i(0,l=u),i(1,c=h),a("mapSetDimensions",{options:{height:l,width:c}})};return t.$$set=t=>{"maps"in t&&i(12,o=t.maps),"mapState"in t&&i(13,s=t.mapState)},t.$$.update=()=>{if(4096&t.$$.dirty&&i(8,r=o[0]),4096&t.$$.dirty&&i(7,n=o?.length??0),8192&t.$$.dirty){let{width:t,height:e,...r}=s;i(6,f=r)}},[l,c,u,h,d,p,f,n,r,()=>{(d||p)&&!(!h||!u)&&A()},A,()=>{i(0,l="100%"),i(1,c="100%"),i(2,u=""),i(3,h=""),a("mapSetDimensions",{options:{height:null,width:null}})},o,s,function(e){H.call(this,t,e)},function(){u=I(this.value),i(2,u)},()=>i(4,d=!0),()=>i(4,d=!1),function(){h=I(this.value),i(3,h)},()=>i(5,p=!0),()=>i(5,p=!1)]}class su extends At{constructor(t){super(),ft(this,t,ou,nu,a,{maps:12,mapState:13})}}function au(t){let e,i,r;var n=t[2];function o(t){return{props:{maps:t[0],mapState:t[1]}}}return n&&(e=U(n,o(t)),e.$on("mapMove",t[3]),e.$on("mapSetDimensions",t[4])),{c(){e&&ht(e.$$.fragment),i=E()},m(t,n){e&&dt(e,t,n),y(t,i,n),r=!0},p(t,[r]){const s={};if(1&r&&(s.maps=t[0]),2&r&&(s.mapState=t[1]),4&r&&n!==(n=t[2])){if(e){ot();const t=e;lt(t.$$.fragment,1,0,(()=>{pt(t,1)})),st()}n?(e=U(n,o(t)),e.$on("mapMove",t[3]),e.$on("mapSetDimensions",t[4]),ht(e.$$.fragment),at(e.$$.fragment,1),dt(e,i.parentNode,i)):e=null}else n&&e.$set(s)},i(t){r||(e&&at(e.$$.fragment,t),r=!0)},o(t){e&&lt(e.$$.fragment,t),r=!1},d(t){t&&v(i),e&&pt(e,t)}}}function lu(t,e,i){let r,n,{maps:o}=e,{mapState:s}=e,{viewMode:a}=e;const l=j();let c;const u=t=>{l("setDimensions",{...t.detail.options})};return t.$$set=t=>{"maps"in t&&i(0,o=t.maps),"mapState"in t&&i(1,s=t.mapState),"viewMode"in t&&i(5,a=t.viewMode)},t.$$.update=()=>{2&t.$$.dirty&&i(7,r=s.height),2&t.$$.dirty&&i(6,n=s.width),32&t.$$.dirty&&(t=>{switch(t){case"phone":i(2,c=Wc);break;case"mirror":i(2,c=Gc);break;case"responsive":i(2,c=su);break;default:i(2,c=iu)}})(a),224&t.$$.dirty&&"responsive"!==a&&(r||n)&&u({detail:{options:{height:null,width:null}}})},[o,s,c,t=>{l("mapState",{options:t.detail.options})},u,a,n,r]}class cu extends At{constructor(t){super(),ft(this,t,lu,au,a,{maps:0,mapState:1,viewMode:5})}}var uu={exports:{}};
/*!
 * html2canvas 1.4.1 <https://html2canvas.hertzen.com>
 * Copyright (c) 2022 Niklas von Hertzen <https://hertzen.com>
 * Released under MIT License
 */uu.exports=function(){
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */
var t=function(e,i){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},t(e,i)};function e(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}var i=function(){return i=Object.assign||function(t){for(var e,i=1,r=arguments.length;i<r;i++)for(var n in e=arguments[i])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t},i.apply(this,arguments)};function r(t,e,i,r){function n(t){return t instanceof i?t:new i((function(e){e(t)}))}return new(i||(i=Promise))((function(i,o){function s(t){try{l(r.next(t))}catch(t){o(t)}}function a(t){try{l(r.throw(t))}catch(t){o(t)}}function l(t){t.done?i(t.value):n(t.value).then(s,a)}l((r=r.apply(t,e||[])).next())}))}function n(t,e){var i,r,n,o,s={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(t){return function(e){return l([t,e])}}function l(o){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,r&&(n=2&o[0]?r.return:o[0]?r.throw||((n=r.return)&&n.call(r),0):r.next)&&!(n=n.call(r,o[1])).done)return n;switch(r=0,n&&(o=[2&o[0],n.value]),o[0]){case 0:case 1:n=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!((n=(n=s.trys).length>0&&n[n.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!n||o[1]>n[0]&&o[1]<n[3])){s.label=o[1];break}if(6===o[0]&&s.label<n[1]){s.label=n[1],n=o;break}if(n&&s.label<n[2]){s.label=n[2],s.ops.push(o);break}n[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],r=0}finally{i=n=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}}function o(t,e,i){if(i||2===arguments.length)for(var r,n=0,o=e.length;n<o;n++)!r&&n in e||(r||(r=Array.prototype.slice.call(e,0,n)),r[n]=e[n]);return t.concat(r||e)}for(var s=function(){function t(t,e,i,r){this.left=t,this.top=e,this.width=i,this.height=r}return t.prototype.add=function(e,i,r,n){return new t(this.left+e,this.top+i,this.width+r,this.height+n)},t.fromClientRect=function(e,i){return new t(i.left+e.windowBounds.left,i.top+e.windowBounds.top,i.width,i.height)},t.fromDOMRectList=function(e,i){var r=Array.from(i).find((function(t){return 0!==t.width}));return r?new t(r.left+e.windowBounds.left,r.top+e.windowBounds.top,r.width,r.height):t.EMPTY},t.EMPTY=new t(0,0,0,0),t}(),a=function(t,e){return s.fromClientRect(t,e.getBoundingClientRect())},l=function(t){var e=t.body,i=t.documentElement;if(!e||!i)throw new Error("Unable to get document size");var r=Math.max(Math.max(e.scrollWidth,i.scrollWidth),Math.max(e.offsetWidth,i.offsetWidth),Math.max(e.clientWidth,i.clientWidth)),n=Math.max(Math.max(e.scrollHeight,i.scrollHeight),Math.max(e.offsetHeight,i.offsetHeight),Math.max(e.clientHeight,i.clientHeight));return new s(0,0,r,n)},c=function(t){for(var e=[],i=0,r=t.length;i<r;){var n=t.charCodeAt(i++);if(n>=55296&&n<=56319&&i<r){var o=t.charCodeAt(i++);56320==(64512&o)?e.push(((1023&n)<<10)+(1023&o)+65536):(e.push(n),i--)}else e.push(n)}return e},u=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(String.fromCodePoint)return String.fromCodePoint.apply(String,t);var i=t.length;if(!i)return"";for(var r=[],n=-1,o="";++n<i;){var s=t[n];s<=65535?r.push(s):(s-=65536,r.push(55296+(s>>10),s%1024+56320)),(n+1===i||r.length>16384)&&(o+=String.fromCharCode.apply(String,r),r.length=0)}return o},h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",d="undefined"==typeof Uint8Array?[]:new Uint8Array(256),p=0;p<h.length;p++)d[h.charCodeAt(p)]=p;for(var f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",A="undefined"==typeof Uint8Array?[]:new Uint8Array(256),m=0;m<f.length;m++)A[f.charCodeAt(m)]=m;for(var g=function(t){var e,i,r,n,o,s=.75*t.length,a=t.length,l=0;"="===t[t.length-1]&&(s--,"="===t[t.length-2]&&s--);var c="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array&&void 0!==Uint8Array.prototype.slice?new ArrayBuffer(s):new Array(s),u=Array.isArray(c)?c:new Uint8Array(c);for(e=0;e<a;e+=4)i=A[t.charCodeAt(e)],r=A[t.charCodeAt(e+1)],n=A[t.charCodeAt(e+2)],o=A[t.charCodeAt(e+3)],u[l++]=i<<2|r>>4,u[l++]=(15&r)<<4|n>>2,u[l++]=(3&n)<<6|63&o;return c},_=function(t){for(var e=t.length,i=[],r=0;r<e;r+=2)i.push(t[r+1]<<8|t[r]);return i},y=function(t){for(var e=t.length,i=[],r=0;r<e;r+=4)i.push(t[r+3]<<24|t[r+2]<<16|t[r+1]<<8|t[r]);return i},v=5,x=11,b=2,w=65536>>v,T=(1<<v)-1,B=w+(1024>>v)+32,E=65536>>x,C=(1<<x-v)-1,S=function(t,e,i){return t.slice?t.slice(e,i):new Uint16Array(Array.prototype.slice.call(t,e,i))},I=function(t,e,i){return t.slice?t.slice(e,i):new Uint32Array(Array.prototype.slice.call(t,e,i))},M=function(t,e){var i=g(t),r=Array.isArray(i)?y(i):new Uint32Array(i),n=Array.isArray(i)?_(i):new Uint16Array(i),o=24,s=S(n,o/2,r[4]/2),a=2===r[5]?S(n,(o+r[4])/2):I(r,Math.ceil((o+r[4])/4));return new k(r[0],r[1],r[2],r[3],s,a)},k=function(){function t(t,e,i,r,n,o){this.initialValue=t,this.errorValue=e,this.highStart=i,this.highValueIndex=r,this.index=n,this.data=o}return t.prototype.get=function(t){var e;if(t>=0){if(t<55296||t>56319&&t<=65535)return e=((e=this.index[t>>v])<<b)+(t&T),this.data[e];if(t<=65535)return e=((e=this.index[w+(t-55296>>v)])<<b)+(t&T),this.data[e];if(t<this.highStart)return e=B-E+(t>>x),e=this.index[e],e+=t>>v&C,e=((e=this.index[e])<<b)+(t&T),this.data[e];if(t<=1114111)return this.data[this.highValueIndex]}return this.errorValue},t}(),P="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",L="undefined"==typeof Uint8Array?[]:new Uint8Array(256),z=0;z<P.length;z++)L[P.charCodeAt(z)]=z;var F=50,D=1,R=2,U=3,O=4,N=5,Q=7,V=8,j=9,H=10,G=11,$=12,Z=13,q=14,K=15,W=16,X=17,J=18,Y=19,tt=20,et=21,it=22,rt=23,nt=24,ot=25,st=26,at=27,lt=28,ct=29,ut=30,ht=31,dt=32,pt=33,ft=34,At=35,mt=36,gt=37,_t=38,yt=39,vt=40,xt=41,bt=42,wt=43,Tt=[9001,65288],Bt="!",Et="",Ct="",St=M("KwAAAAAAAAAACA4AUD0AADAgAAACAAAAAAAIABAAGABAAEgAUABYAGAAaABgAGgAYgBqAF8AZwBgAGgAcQB5AHUAfQCFAI0AlQCdAKIAqgCyALoAYABoAGAAaABgAGgAwgDKAGAAaADGAM4A0wDbAOEA6QDxAPkAAQEJAQ8BFwF1AH0AHAEkASwBNAE6AUIBQQFJAVEBWQFhAWgBcAF4ATAAgAGGAY4BlQGXAZ8BpwGvAbUBvQHFAc0B0wHbAeMB6wHxAfkBAQIJAvEBEQIZAiECKQIxAjgCQAJGAk4CVgJeAmQCbAJ0AnwCgQKJApECmQKgAqgCsAK4ArwCxAIwAMwC0wLbAjAA4wLrAvMC+AIAAwcDDwMwABcDHQMlAy0DNQN1AD0DQQNJA0kDSQNRA1EDVwNZA1kDdQB1AGEDdQBpA20DdQN1AHsDdQCBA4kDkQN1AHUAmQOhA3UAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AKYDrgN1AHUAtgO+A8YDzgPWAxcD3gPjA+sD8wN1AHUA+wMDBAkEdQANBBUEHQQlBCoEFwMyBDgEYABABBcDSARQBFgEYARoBDAAcAQzAXgEgASIBJAEdQCXBHUAnwSnBK4EtgS6BMIEyAR1AHUAdQB1AHUAdQCVANAEYABgAGAAYABgAGAAYABgANgEYADcBOQEYADsBPQE/AQEBQwFFAUcBSQFLAU0BWQEPAVEBUsFUwVbBWAAYgVgAGoFcgV6BYIFigWRBWAAmQWfBaYFYABgAGAAYABgAKoFYACxBbAFuQW6BcEFwQXHBcEFwQXPBdMF2wXjBeoF8gX6BQIGCgYSBhoGIgYqBjIGOgZgAD4GRgZMBmAAUwZaBmAAYABgAGAAYABgAGAAYABgAGAAYABgAGIGYABpBnAGYABgAGAAYABgAGAAYABgAGAAYAB4Bn8GhQZgAGAAYAB1AHcDFQSLBmAAYABgAJMGdQA9A3UAmwajBqsGqwaVALMGuwbDBjAAywbSBtIG1QbSBtIG0gbSBtIG0gbdBuMG6wbzBvsGAwcLBxMHAwcbByMHJwcsBywHMQcsB9IGOAdAB0gHTgfSBkgHVgfSBtIG0gbSBtIG0gbSBtIG0gbSBiwHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAdgAGAALAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAdbB2MHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsB2kH0gZwB64EdQB1AHUAdQB1AHUAdQB1AHUHfQdgAIUHjQd1AHUAlQedB2AAYAClB6sHYACzB7YHvgfGB3UAzgfWBzMB3gfmB1EB7gf1B/0HlQENAQUIDQh1ABUIHQglCBcDLQg1CD0IRQhNCEEDUwh1AHUAdQBbCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIcAh3CHoIMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIgggwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAALAcsBywHLAcsBywHLAcsBywHLAcsB4oILAcsB44I0gaWCJ4Ipgh1AHUAqgiyCHUAdQB1AHUAdQB1AHUAdQB1AHUAtwh8AXUAvwh1AMUIyQjRCNkI4AjoCHUAdQB1AO4I9gj+CAYJDgkTCS0HGwkjCYIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiAAIAAAAFAAYABgAGIAXwBgAHEAdQBFAJUAogCyAKAAYABgAEIA4ABGANMA4QDxAMEBDwE1AFwBLAE6AQEBUQF4QkhCmEKoQrhCgAHIQsAB0MLAAcABwAHAAeDC6ABoAHDCwMMAAcABwAHAAdDDGMMAAcAB6MM4wwjDWMNow3jDaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAEjDqABWw6bDqABpg6gAaABoAHcDvwOPA+gAaABfA/8DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DpcPAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcAB9cPKwkyCToJMAB1AHUAdQBCCUoJTQl1AFUJXAljCWcJawkwADAAMAAwAHMJdQB2CX4JdQCECYoJjgmWCXUAngkwAGAAYABxAHUApgn3A64JtAl1ALkJdQDACTAAMAAwADAAdQB1AHUAdQB1AHUAdQB1AHUAowYNBMUIMAAwADAAMADICcsJ0wnZCRUE4QkwAOkJ8An4CTAAMAB1AAAKvwh1AAgKDwoXCh8KdQAwACcKLgp1ADYKqAmICT4KRgowADAAdQB1AE4KMAB1AFYKdQBeCnUAZQowADAAMAAwADAAMAAwADAAMAAVBHUAbQowADAAdQC5CXUKMAAwAHwBxAijBogEMgF9CoQKiASMCpQKmgqIBKIKqgquCogEDQG2Cr4KxgrLCjAAMADTCtsKCgHjCusK8Qr5CgELMAAwADAAMAB1AIsECQsRC3UANAEZCzAAMAAwADAAMAB1ACELKQswAHUANAExCzkLdQBBC0kLMABRC1kLMAAwADAAMAAwADAAdQBhCzAAMAAwAGAAYABpC3ELdwt/CzAAMACHC4sLkwubC58Lpwt1AK4Ltgt1APsDMAAwADAAMAAwADAAMAAwAL4LwwvLC9IL1wvdCzAAMADlC+kL8Qv5C/8LSQswADAAMAAwADAAMAAwADAAMAAHDDAAMAAwADAAMAAODBYMHgx1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1ACYMMAAwADAAdQB1AHUALgx1AHUAdQB1AHUAdQA2DDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AD4MdQBGDHUAdQB1AHUAdQB1AEkMdQB1AHUAdQB1AFAMMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQBYDHUAdQB1AF8MMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUA+wMVBGcMMAAwAHwBbwx1AHcMfwyHDI8MMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAYABgAJcMMAAwADAAdQB1AJ8MlQClDDAAMACtDCwHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsB7UMLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AA0EMAC9DDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAsBywHLAcsBywHLAcsBywHLQcwAMEMyAwsBywHLAcsBywHLAcsBywHLAcsBywHzAwwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1ANQM2QzhDDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMABgAGAAYABgAGAAYABgAOkMYADxDGAA+AwADQYNYABhCWAAYAAODTAAMAAwADAAFg1gAGAAHg37AzAAMAAwADAAYABgACYNYAAsDTQNPA1gAEMNPg1LDWAAYABgAGAAYABgAGAAYABgAGAAUg1aDYsGVglhDV0NcQBnDW0NdQ15DWAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAlQCBDZUAiA2PDZcNMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAnw2nDTAAMAAwADAAMAAwAHUArw23DTAAMAAwADAAMAAwADAAMAAwADAAMAB1AL8NMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAB1AHUAdQB1AHUAdQDHDTAAYABgAM8NMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAA1w11ANwNMAAwAD0B5A0wADAAMAAwADAAMADsDfQN/A0EDgwOFA4wABsOMAAwADAAMAAwADAAMAAwANIG0gbSBtIG0gbSBtIG0gYjDigOwQUuDsEFMw7SBjoO0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGQg5KDlIOVg7SBtIGXg5lDm0OdQ7SBtIGfQ6EDooOjQ6UDtIGmg6hDtIG0gaoDqwO0ga0DrwO0gZgAGAAYADEDmAAYAAkBtIGzA5gANIOYADaDokO0gbSBt8O5w7SBu8O0gb1DvwO0gZgAGAAxA7SBtIG0gbSBtIGYABgAGAAYAAED2AAsAUMD9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGFA8sBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAccD9IGLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHJA8sBywHLAcsBywHLAccDywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywPLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAc0D9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAccD9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGFA8sBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHPA/SBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gYUD0QPlQCVAJUAMAAwADAAMACVAJUAlQCVAJUAlQCVAEwPMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAA//8EAAQABAAEAAQABAAEAAQABAANAAMAAQABAAIABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQACgATABcAHgAbABoAHgAXABYAEgAeABsAGAAPABgAHABLAEsASwBLAEsASwBLAEsASwBLABgAGAAeAB4AHgATAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQABYAGwASAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAWAA0AEQAeAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAFAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAJABYAGgAbABsAGwAeAB0AHQAeAE8AFwAeAA0AHgAeABoAGwBPAE8ADgBQAB0AHQAdAE8ATwAXAE8ATwBPABYAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAFAAUABQAFAAUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAB4AHgAeAFAATwBAAE8ATwBPAEAATwBQAFAATwBQAB4AHgAeAB4AHgAeAB0AHQAdAB0AHgAdAB4ADgBQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgBQAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAJAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAkACQAJAAkACQAJAAkABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAFAAHgAeAB4AKwArAFAAUABQAFAAGABQACsAKwArACsAHgAeAFAAHgBQAFAAUAArAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAUAAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAYAA0AKwArAB4AHgAbACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQADQAEAB4ABAAEAB4ABAAEABMABAArACsAKwArACsAKwArACsAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAKwArACsAKwBWAFYAVgBWAB4AHgArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AGgAaABoAGAAYAB4AHgAEAAQABAAEAAQABAAEAAQABAAEAAQAEwAEACsAEwATAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABLAEsASwBLAEsASwBLAEsASwBLABoAGQAZAB4AUABQAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQABMAUAAEAAQABAAEAAQABAAEAB4AHgAEAAQABAAEAAQABABQAFAABAAEAB4ABAAEAAQABABQAFAASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUAAeAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAFAABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQAUABQAB4AHgAYABMAUAArACsABAAbABsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAFAABAAEAAQABAAEAFAABAAEAAQAUAAEAAQABAAEAAQAKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAArACsAHgArAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAUAAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAABAAEAA0ADQBLAEsASwBLAEsASwBLAEsASwBLAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUAArACsAKwBQAFAAUABQACsAKwAEAFAABAAEAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABABQACsAKwArACsAKwArACsAKwAEACsAKwArACsAUABQACsAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAFAAUAAaABoAUABQAFAAUABQAEwAHgAbAFAAHgAEACsAKwAEAAQABAArAFAAUABQAFAAUABQACsAKwArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQACsAUABQACsAKwAEACsABAAEAAQABAAEACsAKwArACsABAAEACsAKwAEAAQABAArACsAKwAEACsAKwArACsAKwArACsAUABQAFAAUAArAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLAAQABABQAFAAUAAEAB4AKwArACsAKwArACsAKwArACsAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQACsAKwAEAFAABAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAArACsAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAB4AGwArACsAKwArACsAKwArAFAABAAEAAQABAAEAAQAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABAArACsAKwArACsAKwArAAQABAAEACsAKwArACsAUABQACsAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAB4AUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAAQAUAArAFAAUABQAFAAUABQACsAKwArAFAAUABQACsAUABQAFAAUAArACsAKwBQAFAAKwBQACsAUABQACsAKwArAFAAUAArACsAKwBQAFAAUAArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArAAQABAAEAAQABAArACsAKwAEAAQABAArAAQABAAEAAQAKwArAFAAKwArACsAKwArACsABAArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAHgAeAB4AHgAeAB4AGwAeACsAKwArACsAKwAEAAQABAAEAAQAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAUAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAAEACsAKwArACsAKwArACsABAAEACsAUABQAFAAKwArACsAKwArAFAAUAAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAKwAOAFAAUABQAFAAUABQAFAAHgBQAAQABAAEAA4AUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAKwArAAQAUAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAAEACsAKwArACsAKwArACsABAAEACsAKwArACsAKwArACsAUAArAFAAUAAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwBQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAFAABAAEAAQABAAEAAQABAArAAQABAAEACsABAAEAAQABABQAB4AKwArACsAKwBQAFAAUAAEAFAAUABQAFAAUABQAFAAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAFAAUABQAFAAUABQAFAAUABQABoAUABQAFAAUABQAFAAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQACsAUAArACsAUABQAFAAUABQAFAAUAArACsAKwAEACsAKwArACsABAAEAAQABAAEAAQAKwAEACsABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArAAQABAAeACsAKwArACsAKwArACsAKwArACsAKwArAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAAqAFwAXAAqACoAKgAqACoAKgAqACsAKwArACsAGwBcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAeAEsASwBLAEsASwBLAEsASwBLAEsADQANACsAKwArACsAKwBcAFwAKwBcACsAXABcAFwAXABcACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACsAXAArAFwAXABcAFwAXABcAFwAXABcAFwAKgBcAFwAKgAqACoAKgAqACoAKgAqACoAXAArACsAXABcAFwAXABcACsAXAArACoAKgAqACoAKgAqACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwBcAFwAXABcAFAADgAOAA4ADgAeAA4ADgAJAA4ADgANAAkAEwATABMAEwATAAkAHgATAB4AHgAeAAQABAAeAB4AHgAeAB4AHgBLAEsASwBLAEsASwBLAEsASwBLAFAAUABQAFAAUABQAFAAUABQAFAADQAEAB4ABAAeAAQAFgARABYAEQAEAAQAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQADQAEAAQABAAEAAQADQAEAAQAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArAA0ADQAeAB4AHgAeAB4AHgAEAB4AHgAeAB4AHgAeACsAHgAeAA4ADgANAA4AHgAeAB4AHgAeAAkACQArACsAKwArACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgBcAEsASwBLAEsASwBLAEsASwBLAEsADQANAB4AHgAeAB4AXABcAFwAXABcAFwAKgAqACoAKgBcAFwAXABcACoAKgAqAFwAKgAqACoAXABcACoAKgAqACoAKgAqACoAXABcAFwAKgAqACoAKgBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKgAqAFwAKgBLAEsASwBLAEsASwBLAEsASwBLACoAKgAqACoAKgAqAFAAUABQAFAAUABQACsAUAArACsAKwArACsAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgBQAFAAUABQAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUAArACsAUABQAFAAUABQAFAAUAArAFAAKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAKwBQACsAUABQAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsABAAEAAQAHgANAB4AHgAeAB4AHgAeAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUAArACsADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAANAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAWABEAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAA0ADQANAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAANAA0AKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUAArAAQABAArACsAKwArACsAKwArACsAKwArACsAKwBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqAA0ADQAVAFwADQAeAA0AGwBcACoAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwAeAB4AEwATAA0ADQAOAB4AEwATAB4ABAAEAAQACQArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUAAEAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAHgArACsAKwATABMASwBLAEsASwBLAEsASwBLAEsASwBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAArACsAXABcAFwAXABcACsAKwArACsAKwArACsAKwArACsAKwBcAFwAXABcAFwAXABcAFwAXABcAFwAXAArACsAKwArAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAXAArACsAKwAqACoAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAArACsAHgAeAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKwAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKwArAAQASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArACoAKgAqACoAKgAqACoAXAAqACoAKgAqACoAKgArACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABABQAFAAUABQAFAAUABQACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwANAA0AHgANAA0ADQANAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAEAAQAHgAeAB4AHgAeAB4AHgAeAB4AKwArACsABAAEAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwAeAB4AHgAeAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArAA0ADQANAA0ADQBLAEsASwBLAEsASwBLAEsASwBLACsAKwArAFAAUABQAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAA0ADQBQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUAAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArAAQABAAEAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAAQAUABQAFAAUABQAFAABABQAFAABAAEAAQAUAArACsAKwArACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsABAAEAAQABAAEAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAKwBQACsAUAArAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgBQAB4AHgAeAFAAUABQACsAHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQACsAKwAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQACsAHgAeAB4AHgAeAB4AHgAOAB4AKwANAA0ADQANAA0ADQANAAkADQANAA0ACAAEAAsABAAEAA0ACQANAA0ADAAdAB0AHgAXABcAFgAXABcAFwAWABcAHQAdAB4AHgAUABQAFAANAAEAAQAEAAQABAAEAAQACQAaABoAGgAaABoAGgAaABoAHgAXABcAHQAVABUAHgAeAB4AHgAeAB4AGAAWABEAFQAVABUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ADQAeAA0ADQANAA0AHgANAA0ADQAHAB4AHgAeAB4AKwAEAAQABAAEAAQABAAEAAQABAAEAFAAUAArACsATwBQAFAAUABQAFAAHgAeAB4AFgARAE8AUABPAE8ATwBPAFAAUABQAFAAUAAeAB4AHgAWABEAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArABsAGwAbABsAGwAbABsAGgAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGgAbABsAGwAbABoAGwAbABoAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAHgAeAFAAGgAeAB0AHgBQAB4AGgAeAB4AHgAeAB4AHgAeAB4AHgBPAB4AUAAbAB4AHgBQAFAAUABQAFAAHgAeAB4AHQAdAB4AUAAeAFAAHgBQAB4AUABPAFAAUAAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAHgBQAFAAUABQAE8ATwBQAFAAUABQAFAATwBQAFAATwBQAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAFAAUABQAFAATwBPAE8ATwBPAE8ATwBPAE8ATwBQAFAAUABQAFAAUABQAFAAUAAeAB4AUABQAFAAUABPAB4AHgArACsAKwArAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB4AHQAdAB4AHgAeAB0AHQAeAB4AHQAeAB4AHgAdAB4AHQAbABsAHgAdAB4AHgAeAB4AHQAeAB4AHQAdAB0AHQAeAB4AHQAeAB0AHgAdAB0AHQAdAB0AHQAeAB0AHgAeAB4AHgAeAB0AHQAdAB0AHgAeAB4AHgAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB4AHgAeAB0AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHgAeAB0AHQAdAB0AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAeAB4AHgAdAB4AHgAeAB4AHgAeAB4AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABYAEQAWABEAHgAeAB4AHgAeAB4AHQAeAB4AHgAeAB4AHgAeACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAWABEAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAFAAHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAeAB4AHQAdAB0AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHQAdAB4AHgAeAB4AHQAdAB0AHgAeAB0AHgAeAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlAB4AHQAdAB4AHgAdAB4AHgAeAB4AHQAdAB4AHgAeAB4AJQAlAB0AHQAlAB4AJQAlACUAIAAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAeAB4AHgAeAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHgAdAB0AHQAeAB0AJQAdAB0AHgAdAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAdAB0AHQAdACUAHgAlACUAJQAdACUAJQAdAB0AHQAlACUAHQAdACUAHQAdACUAJQAlAB4AHQAeAB4AHgAeAB0AHQAlAB0AHQAdAB0AHQAdACUAJQAlACUAJQAdACUAJQAgACUAHQAdACUAJQAlACUAJQAlACUAJQAeAB4AHgAlACUAIAAgACAAIAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AFwAXABcAFwAXABcAHgATABMAJQAeAB4AHgAWABEAFgARABYAEQAWABEAFgARABYAEQAWABEATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABYAEQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAWABEAFgARABYAEQAWABEAFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFgARABYAEQAWABEAFgARABYAEQAWABEAFgARABYAEQAWABEAFgARABYAEQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAWABEAFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAEAAQABAAeAB4AKwArACsAKwArABMADQANAA0AUAATAA0AUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAUAANACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAA0ADQANAA0ADQANAA0ADQAeAA0AFgANAB4AHgAXABcAHgAeABcAFwAWABEAFgARABYAEQAWABEADQANAA0ADQATAFAADQANAB4ADQANAB4AHgAeAB4AHgAMAAwADQANAA0AHgANAA0AFgANAA0ADQANAA0ADQANAA0AHgANAB4ADQANAB4AHgAeACsAKwArACsAKwArACsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwArACsAKwArACsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArAA0AEQARACUAJQBHAFcAVwAWABEAFgARABYAEQAWABEAFgARACUAJQAWABEAFgARABYAEQAWABEAFQAWABEAEQAlAFcAVwBXAFcAVwBXAFcAVwBXAAQABAAEAAQABAAEACUAVwBXAFcAVwA2ACUAJQBXAFcAVwBHAEcAJQAlACUAKwBRAFcAUQBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFEAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBRAFcAUQBXAFEAVwBXAFcAVwBXAFcAUQBXAFcAVwBXAFcAVwBRAFEAKwArAAQABAAVABUARwBHAFcAFQBRAFcAUQBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBRAFcAVwBXAFcAVwBXAFEAUQBXAFcAVwBXABUAUQBHAEcAVwArACsAKwArACsAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwAlACUAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACsAKwArACsAKwArACsAKwArACsAKwArAFEAUQBRAFEAUQBRAFEAUQBRAFEAUQBRAFEAUQBRAFEAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBPAE8ATwBPAE8ATwBPAE8AJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQAlAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAEcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAADQATAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABLAEsASwBLAEsASwBLAEsASwBLAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAABAAEAAQABAAeAAQABAAEAAQABAAEAAQABAAEAAQAHgBQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUABQAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAeAA0ADQANAA0ADQArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAB4AHgAeAB4AHgAeAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAeAB4AUABQAFAAUABQAFAAUABQAFAAUABQAAQAUABQAFAABABQAFAAUABQAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAeAB4AHgAeAAQAKwArACsAUABQAFAAUABQAFAAHgAeABoAHgArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAADgAOABMAEwArACsAKwArACsAKwArACsABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwANAA0ASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAFAAUAAeAB4AHgBQAA4AUABQAAQAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAA0ADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArAB4AWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYACsAKwArAAQAHgAeAB4AHgAeAB4ADQANAA0AHgAeAB4AHgArAFAASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArAB4AHgBcAFwAXABcAFwAKgBcAFwAXABcAFwAXABcAFwAXABcAEsASwBLAEsASwBLAEsASwBLAEsAXABcAFwAXABcACsAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArAFAAUABQAAQAUABQAFAAUABQAFAAUABQAAQABAArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAHgANAA0ADQBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKgAqACoAXAAqACoAKgBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAAqAFwAKgAqACoAXABcACoAKgBcAFwAXABcAFwAKgAqAFwAKgBcACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFwAXABcACoAKgBQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAA0ADQBQAFAAUAAEAAQAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUAArACsAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQADQAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAVABVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBUAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVACsAKwArACsAKwArACsAKwArACsAKwArAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAKwArACsAKwBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAKwArACsAKwAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAKwArACsAKwArAFYABABWAFYAVgBWAFYAVgBWAFYAVgBWAB4AVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgArAFYAVgBWAFYAVgArAFYAKwBWAFYAKwBWAFYAKwBWAFYAVgBWAFYAVgBWAFYAVgBWAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAEQAWAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAaAB4AKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAGAARABEAGAAYABMAEwAWABEAFAArACsAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACUAJQAlACUAJQAWABEAFgARABYAEQAWABEAFgARABYAEQAlACUAFgARACUAJQAlACUAJQAlACUAEQAlABEAKwAVABUAEwATACUAFgARABYAEQAWABEAJQAlACUAJQAlACUAJQAlACsAJQAbABoAJQArACsAKwArAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAcAKwATACUAJQAbABoAJQAlABYAEQAlACUAEQAlABEAJQBXAFcAVwBXAFcAVwBXAFcAVwBXABUAFQAlACUAJQATACUAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXABYAJQARACUAJQAlAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAWACUAEQAlABYAEQARABYAEQARABUAVwBRAFEAUQBRAFEAUQBRAFEAUQBRAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAEcARwArACsAVwBXAFcAVwBXAFcAKwArAFcAVwBXAFcAVwBXACsAKwBXAFcAVwBXAFcAVwArACsAVwBXAFcAKwArACsAGgAbACUAJQAlABsAGwArAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwAEAAQABAAQAB0AKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsADQANAA0AKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAAQAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAA0AUABQAFAAUAArACsAKwArAFAAUABQAFAAUABQAFAAUAANAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwAeACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAKwArAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUAArACsAKwBQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwANAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAB4AUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAUABQAFAAUABQAAQABAAEACsABAAEACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAKwBQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEACsAKwArACsABABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAA0ADQANAA0ADQANAA0ADQAeACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAArACsAKwArAFAAUABQAFAAUAANAA0ADQANAA0ADQAUACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsADQANAA0ADQANAA0ADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAAQABAAEAAQAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArAAQABAANACsAKwBQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAB4AHgAeAB4AHgArACsAKwArACsAKwAEAAQABAAEAAQABAAEAA0ADQAeAB4AHgAeAB4AKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgANAA0ADQANACsAKwArACsAKwArACsAKwArACsAKwAeACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsASwBLAEsASwBLAEsASwBLAEsASwANAA0ADQANAFAABAAEAFAAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAeAA4AUAArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAADQANAB4ADQAEAAQABAAEAB4ABAAEAEsASwBLAEsASwBLAEsASwBLAEsAUAAOAFAADQANAA0AKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAANAA0AHgANAA0AHgAEACsAUABQAFAAUABQAFAAUAArAFAAKwBQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAA0AKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsABAAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQACsABAAEAFAABAAEAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABAArACsAUAArACsAKwArACsAKwAEACsAKwArACsAKwBQAFAAUABQAFAABAAEACsAKwAEAAQABAAEAAQABAAEACsAKwArAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwArACsABAAEAAQABAAEAAQABABQAFAAUABQAA0ADQANAA0AHgBLAEsASwBLAEsASwBLAEsASwBLAA0ADQArAB4ABABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAFAAUAAeAFAAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAArACsABAAEAAQABAAEAAQABAAEAAQADgANAA0AEwATAB4AHgAeAA0ADQANAA0ADQANAA0ADQANAA0ADQANAA0ADQANAFAAUABQAFAABAAEACsAKwAEAA0ADQAeAFAAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKwArACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBcAFwADQANAA0AKgBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAKwArAFAAKwArAFAAUABQAFAAUABQAFAAUAArAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQAKwAEAAQAKwArAAQABAAEAAQAUAAEAFAABAAEAA0ADQANACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAArACsABAAEAAQABAAEAAQABABQAA4AUAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAFAABAAEAAQABAAOAB4ADQANAA0ADQAOAB4ABAArACsAKwArACsAKwArACsAUAAEAAQABAAEAAQABAAEAAQABAAEAAQAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAA0ADQANAFAADgAOAA4ADQANACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEACsABAAEAAQABAAEAAQABAAEAFAADQANAA0ADQANACsAKwArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwAOABMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAArACsAKwAEACsABAAEACsABAAEAAQABAAEAAQABABQAAQAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAKwBQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQAKwAEAAQAKwAEAAQABAAEAAQAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAaABoAGgAaAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsADQANAA0ADQANACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAASABIAEgAQwBDAEMAUABQAFAAUABDAFAAUABQAEgAQwBIAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAASABDAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwAJAAkACQAJAAkACQAJABYAEQArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABIAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwANAA0AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEAAQABAANACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAA0ADQANAB4AHgAeAB4AHgAeAFAAUABQAFAADQAeACsAKwArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAANAA0AHgAeACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwAEAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAARwBHABUARwAJACsAKwArACsAKwArACsAKwArACsAKwAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACsAKwArACsAKwArACsAKwBXAFcAVwBXAFcAVwBXAFcAVwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUQBRAFEAKwArACsAKwArACsAKwArACsAKwArACsAKwBRAFEAUQBRACsAKwArACsAKwArACsAKwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArACsAHgAEAAQADQAEAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArAB4AHgAeAB4AHgAeAB4AKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAAQABAAEAAQABAAeAB4AHgAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAB4AHgAEAAQABAAEAAQABAAEAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQAHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwBQAFAAKwArAFAAKwArAFAAUAArACsAUABQAFAAUAArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAUAArAFAAUABQAFAAUABQAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAHgAeAFAAUABQAFAAUAArAFAAKwArACsAUABQAFAAUABQAFAAUAArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeACsAKwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4ABAAeAB4AHgAeAB4AHgAeAB4AHgAeAAQAHgAeAA0ADQANAA0AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAAQAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArAAQABAAEAAQABAAEAAQAKwAEAAQAKwAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwBQAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArABsAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArAB4AHgAeAB4ABAAEAAQABAAEAAQABABQACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArABYAFgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAGgBQAFAAUAAaAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAKwBQACsAKwBQACsAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwBQACsAUAArACsAKwArACsAKwBQACsAKwArACsAUAArAFAAKwBQACsAUABQAFAAKwBQAFAAKwBQACsAKwBQACsAUAArAFAAKwBQACsAUAArAFAAUAArAFAAKwArAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUAArAFAAUABQAFAAKwBQACsAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAUABQAFAAKwBQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8AJQAlACUAHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB4AHgAeACUAJQAlAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAB4AHgAlACUAJQAlACUAHgAlACUAJQAlACUAIAAgACAAJQAlACAAJQAlACAAIAAgACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACEAIQAhACEAIQAlACUAIAAgACUAJQAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlACUAIAAlACUAJQAlACAAIAAgACUAIAAgACAAJQAlACUAJQAlACUAJQAgACUAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAlAB4AJQAeACUAJQAlACUAJQAgACUAJQAlACUAHgAlAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAgACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACAAIAAgACUAJQAlACAAIAAgACAAIAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABcAFwAXABUAFQAVAB4AHgAeAB4AJQAlACUAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAgACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAgACUAJQAgACUAJQAlACUAJQAlACUAJQAgACAAIAAgACAAIAAgACAAJQAlACUAJQAlACUAIAAlACUAJQAlACUAJQAlACUAJQAgACAAIAAgACAAIAAgACAAIAAgACUAJQAgACAAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAgACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAlACAAIAAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAgACAAIAAlACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwArAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACUAVwBXACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAA=="),It=[ut,mt],Mt=[D,R,U,N],kt=[H,V],Pt=[at,st],Lt=Mt.concat(kt),zt=[_t,yt,vt,ft,At],Ft=[K,Z],Dt=function(t,e){void 0===e&&(e="strict");var i=[],r=[],n=[];return t.forEach((function(t,o){var s=St.get(t);if(s>F?(n.push(!0),s-=F):n.push(!1),-1!==["normal","auto","loose"].indexOf(e)&&-1!==[8208,8211,12316,12448].indexOf(t))return r.push(o),i.push(W);if(s===O||s===G){if(0===o)return r.push(o),i.push(ut);var a=i[o-1];return-1===Lt.indexOf(a)?(r.push(r[o-1]),i.push(a)):(r.push(o),i.push(ut))}return r.push(o),s===ht?i.push("strict"===e?et:gt):s===bt||s===ct?i.push(ut):s===wt?t>=131072&&t<=196605||t>=196608&&t<=262141?i.push(gt):i.push(ut):void i.push(s)})),[r,i,n]},Rt=function(t,e,i,r){var n=r[i];if(Array.isArray(t)?-1!==t.indexOf(n):t===n)for(var o=i;o<=r.length;){if((l=r[++o])===e)return!0;if(l!==H)break}if(n===H)for(o=i;o>0;){var s=r[--o];if(Array.isArray(t)?-1!==t.indexOf(s):t===s)for(var a=i;a<=r.length;){var l;if((l=r[++a])===e)return!0;if(l!==H)break}if(s!==H)break}return!1},Ut=function(t,e){for(var i=t;i>=0;){var r=e[i];if(r!==H)return r;i--}return 0},Ot=function(t,e,i,r,n){if(0===i[r])return Et;var o=r-1;if(Array.isArray(n)&&!0===n[o])return Et;var s=o-1,a=o+1,l=e[o],c=s>=0?e[s]:0,u=e[a];if(l===R&&u===U)return Et;if(-1!==Mt.indexOf(l))return Bt;if(-1!==Mt.indexOf(u))return Et;if(-1!==kt.indexOf(u))return Et;if(Ut(o,e)===V)return Ct;if(St.get(t[o])===G)return Et;if((l===dt||l===pt)&&St.get(t[a])===G)return Et;if(l===Q||u===Q)return Et;if(l===j)return Et;if(-1===[H,Z,K].indexOf(l)&&u===j)return Et;if(-1!==[X,J,Y,nt,lt].indexOf(u))return Et;if(Ut(o,e)===it)return Et;if(Rt(rt,it,o,e))return Et;if(Rt([X,J],et,o,e))return Et;if(Rt($,$,o,e))return Et;if(l===H)return Ct;if(l===rt||u===rt)return Et;if(u===W||l===W)return Ct;if(-1!==[Z,K,et].indexOf(u)||l===q)return Et;if(c===mt&&-1!==Ft.indexOf(l))return Et;if(l===lt&&u===mt)return Et;if(u===tt)return Et;if(-1!==It.indexOf(u)&&l===ot||-1!==It.indexOf(l)&&u===ot)return Et;if(l===at&&-1!==[gt,dt,pt].indexOf(u)||-1!==[gt,dt,pt].indexOf(l)&&u===st)return Et;if(-1!==It.indexOf(l)&&-1!==Pt.indexOf(u)||-1!==Pt.indexOf(l)&&-1!==It.indexOf(u))return Et;if(-1!==[at,st].indexOf(l)&&(u===ot||-1!==[it,K].indexOf(u)&&e[a+1]===ot)||-1!==[it,K].indexOf(l)&&u===ot||l===ot&&-1!==[ot,lt,nt].indexOf(u))return Et;if(-1!==[ot,lt,nt,X,J].indexOf(u))for(var h=o;h>=0;){if((d=e[h])===ot)return Et;if(-1===[lt,nt].indexOf(d))break;h--}if(-1!==[at,st].indexOf(u))for(h=-1!==[X,J].indexOf(l)?s:o;h>=0;){var d;if((d=e[h])===ot)return Et;if(-1===[lt,nt].indexOf(d))break;h--}if(_t===l&&-1!==[_t,yt,ft,At].indexOf(u)||-1!==[yt,ft].indexOf(l)&&-1!==[yt,vt].indexOf(u)||-1!==[vt,At].indexOf(l)&&u===vt)return Et;if(-1!==zt.indexOf(l)&&-1!==[tt,st].indexOf(u)||-1!==zt.indexOf(u)&&l===at)return Et;if(-1!==It.indexOf(l)&&-1!==It.indexOf(u))return Et;if(l===nt&&-1!==It.indexOf(u))return Et;if(-1!==It.concat(ot).indexOf(l)&&u===it&&-1===Tt.indexOf(t[a])||-1!==It.concat(ot).indexOf(u)&&l===J)return Et;if(l===xt&&u===xt){for(var p=i[o],f=1;p>0&&e[--p]===xt;)f++;if(f%2!=0)return Et}return l===dt&&u===pt?Et:Ct},Nt=function(t,e){e||(e={lineBreak:"normal",wordBreak:"normal"});var i=Dt(t,e.lineBreak),r=i[0],n=i[1],o=i[2];"break-all"!==e.wordBreak&&"break-word"!==e.wordBreak||(n=n.map((function(t){return-1!==[ot,ut,bt].indexOf(t)?gt:t})));var s="keep-all"===e.wordBreak?o.map((function(e,i){return e&&t[i]>=19968&&t[i]<=40959})):void 0;return[r,n,s]},Qt=function(){function t(t,e,i,r){this.codePoints=t,this.required=e===Bt,this.start=i,this.end=r}return t.prototype.slice=function(){return u.apply(void 0,this.codePoints.slice(this.start,this.end))},t}(),Vt=function(t,e){var i=c(t),r=Nt(i,e),n=r[0],o=r[1],s=r[2],a=i.length,l=0,u=0;return{next:function(){if(u>=a)return{done:!0,value:null};for(var t=Et;u<a&&(t=Ot(i,o,n,++u,s))===Et;);if(t!==Et||u===a){var e=new Qt(i,t,l,u);return l=u,{value:e,done:!1}}return{done:!0,value:null}}}},jt=1,Ht=2,Gt=4,$t=8,Zt=10,qt=47,Kt=92,Wt=9,Xt=32,Jt=34,Yt=61,te=35,ee=36,ie=37,re=39,ne=40,oe=41,se=95,ae=45,le=33,ce=60,ue=62,he=64,de=91,pe=93,fe=61,Ae=123,me=63,ge=125,_e=124,ye=126,ve=128,xe=65533,be=42,we=43,Te=44,Be=58,Ee=59,Ce=46,Se=0,Ie=8,Me=11,ke=14,Pe=31,Le=127,ze=-1,Fe=48,De=97,Re=101,Ue=102,Oe=117,Ne=122,Qe=65,Ve=69,je=70,He=85,Ge=90,$e=function(t){return t>=Fe&&t<=57},Ze=function(t){return t>=55296&&t<=57343},qe=function(t){return $e(t)||t>=Qe&&t<=je||t>=De&&t<=Ue},Ke=function(t){return t>=De&&t<=Ne},We=function(t){return t>=Qe&&t<=Ge},Xe=function(t){return Ke(t)||We(t)},Je=function(t){return t>=ve},Ye=function(t){return t===Zt||t===Wt||t===Xt},ti=function(t){return Xe(t)||Je(t)||t===se},ei=function(t){return ti(t)||$e(t)||t===ae},ii=function(t){return t>=Se&&t<=Ie||t===Me||t>=ke&&t<=Pe||t===Le},ri=function(t,e){return t===Kt&&e!==Zt},ni=function(t,e,i){return t===ae?ti(e)||ri(e,i):!!ti(t)||!(t!==Kt||!ri(t,e))},oi=function(t,e,i){return t===we||t===ae?!!$e(e)||e===Ce&&$e(i):$e(t===Ce?e:t)},si=function(t){var e=0,i=1;t[e]!==we&&t[e]!==ae||(t[e]===ae&&(i=-1),e++);for(var r=[];$e(t[e]);)r.push(t[e++]);var n=r.length?parseInt(u.apply(void 0,r),10):0;t[e]===Ce&&e++;for(var o=[];$e(t[e]);)o.push(t[e++]);var s=o.length,a=s?parseInt(u.apply(void 0,o),10):0;t[e]!==Ve&&t[e]!==Re||e++;var l=1;t[e]!==we&&t[e]!==ae||(t[e]===ae&&(l=-1),e++);for(var c=[];$e(t[e]);)c.push(t[e++]);var h=c.length?parseInt(u.apply(void 0,c),10):0;return i*(n+a*Math.pow(10,-s))*Math.pow(10,l*h)},ai={type:2},li={type:3},ci={type:4},ui={type:13},hi={type:8},di={type:21},pi={type:9},fi={type:10},Ai={type:11},mi={type:12},gi={type:14},_i={type:23},yi={type:1},vi={type:25},xi={type:24},bi={type:26},wi={type:27},Ti={type:28},Bi={type:29},Ei={type:31},Ci={type:32},Si=function(){function t(){this._value=[]}return t.prototype.write=function(t){this._value=this._value.concat(c(t))},t.prototype.read=function(){for(var t=[],e=this.consumeToken();e!==Ci;)t.push(e),e=this.consumeToken();return t},t.prototype.consumeToken=function(){var t=this.consumeCodePoint();switch(t){case Jt:return this.consumeStringToken(Jt);case te:var e=this.peekCodePoint(0),i=this.peekCodePoint(1),r=this.peekCodePoint(2);if(ei(e)||ri(i,r)){var n=ni(e,i,r)?Ht:jt;return{type:5,value:this.consumeName(),flags:n}}break;case ee:if(this.peekCodePoint(0)===Yt)return this.consumeCodePoint(),ui;break;case re:return this.consumeStringToken(re);case ne:return ai;case oe:return li;case be:if(this.peekCodePoint(0)===Yt)return this.consumeCodePoint(),gi;break;case we:if(oi(t,this.peekCodePoint(0),this.peekCodePoint(1)))return this.reconsumeCodePoint(t),this.consumeNumericToken();break;case Te:return ci;case ae:var o=t,s=this.peekCodePoint(0),a=this.peekCodePoint(1);if(oi(o,s,a))return this.reconsumeCodePoint(t),this.consumeNumericToken();if(ni(o,s,a))return this.reconsumeCodePoint(t),this.consumeIdentLikeToken();if(s===ae&&a===ue)return this.consumeCodePoint(),this.consumeCodePoint(),xi;break;case Ce:if(oi(t,this.peekCodePoint(0),this.peekCodePoint(1)))return this.reconsumeCodePoint(t),this.consumeNumericToken();break;case qt:if(this.peekCodePoint(0)===be)for(this.consumeCodePoint();;){var l=this.consumeCodePoint();if(l===be&&(l=this.consumeCodePoint())===qt)return this.consumeToken();if(l===ze)return this.consumeToken()}break;case Be:return bi;case Ee:return wi;case ce:if(this.peekCodePoint(0)===le&&this.peekCodePoint(1)===ae&&this.peekCodePoint(2)===ae)return this.consumeCodePoint(),this.consumeCodePoint(),vi;break;case he:var c=this.peekCodePoint(0),h=this.peekCodePoint(1),d=this.peekCodePoint(2);if(ni(c,h,d))return{type:7,value:this.consumeName()};break;case de:return Ti;case Kt:if(ri(t,this.peekCodePoint(0)))return this.reconsumeCodePoint(t),this.consumeIdentLikeToken();break;case pe:return Bi;case fe:if(this.peekCodePoint(0)===Yt)return this.consumeCodePoint(),hi;break;case Ae:return Ai;case ge:return mi;case Oe:case He:var p=this.peekCodePoint(0),f=this.peekCodePoint(1);return p!==we||!qe(f)&&f!==me||(this.consumeCodePoint(),this.consumeUnicodeRangeToken()),this.reconsumeCodePoint(t),this.consumeIdentLikeToken();case _e:if(this.peekCodePoint(0)===Yt)return this.consumeCodePoint(),pi;if(this.peekCodePoint(0)===_e)return this.consumeCodePoint(),di;break;case ye:if(this.peekCodePoint(0)===Yt)return this.consumeCodePoint(),fi;break;case ze:return Ci}return Ye(t)?(this.consumeWhiteSpace(),Ei):$e(t)?(this.reconsumeCodePoint(t),this.consumeNumericToken()):ti(t)?(this.reconsumeCodePoint(t),this.consumeIdentLikeToken()):{type:6,value:u(t)}},t.prototype.consumeCodePoint=function(){var t=this._value.shift();return void 0===t?-1:t},t.prototype.reconsumeCodePoint=function(t){this._value.unshift(t)},t.prototype.peekCodePoint=function(t){return t>=this._value.length?-1:this._value[t]},t.prototype.consumeUnicodeRangeToken=function(){for(var t=[],e=this.consumeCodePoint();qe(e)&&t.length<6;)t.push(e),e=this.consumeCodePoint();for(var i=!1;e===me&&t.length<6;)t.push(e),e=this.consumeCodePoint(),i=!0;if(i)return{type:30,start:parseInt(u.apply(void 0,t.map((function(t){return t===me?Fe:t}))),16),end:parseInt(u.apply(void 0,t.map((function(t){return t===me?je:t}))),16)};var r=parseInt(u.apply(void 0,t),16);if(this.peekCodePoint(0)===ae&&qe(this.peekCodePoint(1))){this.consumeCodePoint(),e=this.consumeCodePoint();for(var n=[];qe(e)&&n.length<6;)n.push(e),e=this.consumeCodePoint();return{type:30,start:r,end:parseInt(u.apply(void 0,n),16)}}return{type:30,start:r,end:r}},t.prototype.consumeIdentLikeToken=function(){var t=this.consumeName();return"url"===t.toLowerCase()&&this.peekCodePoint(0)===ne?(this.consumeCodePoint(),this.consumeUrlToken()):this.peekCodePoint(0)===ne?(this.consumeCodePoint(),{type:19,value:t}):{type:20,value:t}},t.prototype.consumeUrlToken=function(){var t=[];if(this.consumeWhiteSpace(),this.peekCodePoint(0)===ze)return{type:22,value:""};var e=this.peekCodePoint(0);if(e===re||e===Jt){var i=this.consumeStringToken(this.consumeCodePoint());return 0===i.type&&(this.consumeWhiteSpace(),this.peekCodePoint(0)===ze||this.peekCodePoint(0)===oe)?(this.consumeCodePoint(),{type:22,value:i.value}):(this.consumeBadUrlRemnants(),_i)}for(;;){var r=this.consumeCodePoint();if(r===ze||r===oe)return{type:22,value:u.apply(void 0,t)};if(Ye(r))return this.consumeWhiteSpace(),this.peekCodePoint(0)===ze||this.peekCodePoint(0)===oe?(this.consumeCodePoint(),{type:22,value:u.apply(void 0,t)}):(this.consumeBadUrlRemnants(),_i);if(r===Jt||r===re||r===ne||ii(r))return this.consumeBadUrlRemnants(),_i;if(r===Kt){if(!ri(r,this.peekCodePoint(0)))return this.consumeBadUrlRemnants(),_i;t.push(this.consumeEscapedCodePoint())}else t.push(r)}},t.prototype.consumeWhiteSpace=function(){for(;Ye(this.peekCodePoint(0));)this.consumeCodePoint()},t.prototype.consumeBadUrlRemnants=function(){for(;;){var t=this.consumeCodePoint();if(t===oe||t===ze)return;ri(t,this.peekCodePoint(0))&&this.consumeEscapedCodePoint()}},t.prototype.consumeStringSlice=function(t){for(var e=5e4,i="";t>0;){var r=Math.min(e,t);i+=u.apply(void 0,this._value.splice(0,r)),t-=r}return this._value.shift(),i},t.prototype.consumeStringToken=function(t){for(var e="",i=0;;){var r=this._value[i];if(r===ze||void 0===r||r===t)return{type:0,value:e+=this.consumeStringSlice(i)};if(r===Zt)return this._value.splice(0,i),yi;if(r===Kt){var n=this._value[i+1];n!==ze&&void 0!==n&&(n===Zt?(e+=this.consumeStringSlice(i),i=-1,this._value.shift()):ri(r,n)&&(e+=this.consumeStringSlice(i),e+=u(this.consumeEscapedCodePoint()),i=-1))}i++}},t.prototype.consumeNumber=function(){var t=[],e=Gt,i=this.peekCodePoint(0);for(i!==we&&i!==ae||t.push(this.consumeCodePoint());$e(this.peekCodePoint(0));)t.push(this.consumeCodePoint());i=this.peekCodePoint(0);var r=this.peekCodePoint(1);if(i===Ce&&$e(r))for(t.push(this.consumeCodePoint(),this.consumeCodePoint()),e=$t;$e(this.peekCodePoint(0));)t.push(this.consumeCodePoint());i=this.peekCodePoint(0),r=this.peekCodePoint(1);var n=this.peekCodePoint(2);if((i===Ve||i===Re)&&((r===we||r===ae)&&$e(n)||$e(r)))for(t.push(this.consumeCodePoint(),this.consumeCodePoint()),e=$t;$e(this.peekCodePoint(0));)t.push(this.consumeCodePoint());return[si(t),e]},t.prototype.consumeNumericToken=function(){var t=this.consumeNumber(),e=t[0],i=t[1],r=this.peekCodePoint(0),n=this.peekCodePoint(1),o=this.peekCodePoint(2);return ni(r,n,o)?{type:15,number:e,flags:i,unit:this.consumeName()}:r===ie?(this.consumeCodePoint(),{type:16,number:e,flags:i}):{type:17,number:e,flags:i}},t.prototype.consumeEscapedCodePoint=function(){var t=this.consumeCodePoint();if(qe(t)){for(var e=u(t);qe(this.peekCodePoint(0))&&e.length<6;)e+=u(this.consumeCodePoint());Ye(this.peekCodePoint(0))&&this.consumeCodePoint();var i=parseInt(e,16);return 0===i||Ze(i)||i>1114111?xe:i}return t===ze?xe:t},t.prototype.consumeName=function(){for(var t="";;){var e=this.consumeCodePoint();if(ei(e))t+=u(e);else{if(!ri(e,this.peekCodePoint(0)))return this.reconsumeCodePoint(e),t;t+=u(this.consumeEscapedCodePoint())}}},t}(),Ii=function(){function t(t){this._tokens=t}return t.create=function(e){var i=new Si;return i.write(e),new t(i.read())},t.parseValue=function(e){return t.create(e).parseComponentValue()},t.parseValues=function(e){return t.create(e).parseComponentValues()},t.prototype.parseComponentValue=function(){for(var t=this.consumeToken();31===t.type;)t=this.consumeToken();if(32===t.type)throw new SyntaxError("Error parsing CSS component value, unexpected EOF");this.reconsumeToken(t);var e=this.consumeComponentValue();do{t=this.consumeToken()}while(31===t.type);if(32===t.type)return e;throw new SyntaxError("Error parsing CSS component value, multiple values found when expecting only one")},t.prototype.parseComponentValues=function(){for(var t=[];;){var e=this.consumeComponentValue();if(32===e.type)return t;t.push(e),t.push()}},t.prototype.consumeComponentValue=function(){var t=this.consumeToken();switch(t.type){case 11:case 28:case 2:return this.consumeSimpleBlock(t.type);case 19:return this.consumeFunction(t)}return t},t.prototype.consumeSimpleBlock=function(t){for(var e={type:t,values:[]},i=this.consumeToken();;){if(32===i.type||Ui(i,t))return e;this.reconsumeToken(i),e.values.push(this.consumeComponentValue()),i=this.consumeToken()}},t.prototype.consumeFunction=function(t){for(var e={name:t.value,values:[],type:18};;){var i=this.consumeToken();if(32===i.type||3===i.type)return e;this.reconsumeToken(i),e.values.push(this.consumeComponentValue())}},t.prototype.consumeToken=function(){var t=this._tokens.shift();return void 0===t?Ci:t},t.prototype.reconsumeToken=function(t){this._tokens.unshift(t)},t}(),Mi=function(t){return 15===t.type},ki=function(t){return 17===t.type},Pi=function(t){return 20===t.type},Li=function(t){return 0===t.type},zi=function(t,e){return Pi(t)&&t.value===e},Fi=function(t){return 31!==t.type},Di=function(t){return 31!==t.type&&4!==t.type},Ri=function(t){var e=[],i=[];return t.forEach((function(t){if(4===t.type){if(0===i.length)throw new Error("Error parsing function args, zero tokens for arg");return e.push(i),void(i=[])}31!==t.type&&i.push(t)})),i.length&&e.push(i),e},Ui=function(t,e){return 11===e&&12===t.type||28===e&&29===t.type||2===e&&3===t.type},Oi=function(t){return 17===t.type||15===t.type},Ni=function(t){return 16===t.type||Oi(t)},Qi=function(t){return t.length>1?[t[0],t[1]]:[t[0]]},Vi={type:17,number:0,flags:Gt},ji={type:16,number:50,flags:Gt},Hi={type:16,number:100,flags:Gt},Gi=function(t,e,i){var r=t[0],n=t[1];return[$i(r,e),$i(void 0!==n?n:r,i)]},$i=function(t,e){if(16===t.type)return t.number/100*e;if(Mi(t))switch(t.unit){case"rem":case"em":return 16*t.number;default:return t.number}return t.number},Zi="deg",qi="grad",Ki="rad",Wi="turn",Xi={name:"angle",parse:function(t,e){if(15===e.type)switch(e.unit){case Zi:return Math.PI*e.number/180;case qi:return Math.PI/200*e.number;case Ki:return e.number;case Wi:return 2*Math.PI*e.number}throw new Error("Unsupported angle type")}},Ji=function(t){return 15===t.type&&(t.unit===Zi||t.unit===qi||t.unit===Ki||t.unit===Wi)},Yi=function(t){switch(t.filter(Pi).map((function(t){return t.value})).join(" ")){case"to bottom right":case"to right bottom":case"left top":case"top left":return[Vi,Vi];case"to top":case"bottom":return tr(0);case"to bottom left":case"to left bottom":case"right top":case"top right":return[Vi,Hi];case"to right":case"left":return tr(90);case"to top left":case"to left top":case"right bottom":case"bottom right":return[Hi,Hi];case"to bottom":case"top":return tr(180);case"to top right":case"to right top":case"left bottom":case"bottom left":return[Hi,Vi];case"to left":case"right":return tr(270)}return 0},tr=function(t){return Math.PI*t/180},er={name:"color",parse:function(t,e){if(18===e.type){var i=cr[e.name];if(void 0===i)throw new Error('Attempting to parse an unsupported color function "'+e.name+'"');return i(t,e.values)}if(5===e.type){if(3===e.value.length){var r=e.value.substring(0,1),n=e.value.substring(1,2),o=e.value.substring(2,3);return nr(parseInt(r+r,16),parseInt(n+n,16),parseInt(o+o,16),1)}if(4===e.value.length){r=e.value.substring(0,1),n=e.value.substring(1,2),o=e.value.substring(2,3);var s=e.value.substring(3,4);return nr(parseInt(r+r,16),parseInt(n+n,16),parseInt(o+o,16),parseInt(s+s,16)/255)}if(6===e.value.length)return r=e.value.substring(0,2),n=e.value.substring(2,4),o=e.value.substring(4,6),nr(parseInt(r,16),parseInt(n,16),parseInt(o,16),1);if(8===e.value.length)return r=e.value.substring(0,2),n=e.value.substring(2,4),o=e.value.substring(4,6),s=e.value.substring(6,8),nr(parseInt(r,16),parseInt(n,16),parseInt(o,16),parseInt(s,16)/255)}if(20===e.type){var a=hr[e.value.toUpperCase()];if(void 0!==a)return a}return hr.TRANSPARENT}},ir=function(t){return 0==(255&t)},rr=function(t){var e=255&t,i=255&t>>8,r=255&t>>16,n=255&t>>24;return e<255?"rgba("+n+","+r+","+i+","+e/255+")":"rgb("+n+","+r+","+i+")"},nr=function(t,e,i,r){return(t<<24|e<<16|i<<8|Math.round(255*r)<<0)>>>0},or=function(t,e){if(17===t.type)return t.number;if(16===t.type){var i=3===e?1:255;return 3===e?t.number/100*i:Math.round(t.number/100*i)}return 0},sr=function(t,e){var i=e.filter(Di);if(3===i.length){var r=i.map(or),n=r[0],o=r[1],s=r[2];return nr(n,o,s,1)}if(4===i.length){var a=i.map(or),l=(n=a[0],o=a[1],s=a[2],a[3]);return nr(n,o,s,l)}return 0};function ar(t,e,i){return i<0&&(i+=1),i>=1&&(i-=1),i<1/6?(e-t)*i*6+t:i<.5?e:i<2/3?6*(e-t)*(2/3-i)+t:t}var lr=function(t,e){var i=e.filter(Di),r=i[0],n=i[1],o=i[2],s=i[3],a=(17===r.type?tr(r.number):Xi.parse(t,r))/(2*Math.PI),l=Ni(n)?n.number/100:0,c=Ni(o)?o.number/100:0,u=void 0!==s&&Ni(s)?$i(s,1):1;if(0===l)return nr(255*c,255*c,255*c,1);var h=c<=.5?c*(l+1):c+l-c*l,d=2*c-h,p=ar(d,h,a+1/3),f=ar(d,h,a),A=ar(d,h,a-1/3);return nr(255*p,255*f,255*A,u)},cr={hsl:lr,hsla:lr,rgb:sr,rgba:sr},ur=function(t,e){return er.parse(t,Ii.create(e).parseComponentValue())},hr={ALICEBLUE:4042850303,ANTIQUEWHITE:4209760255,AQUA:16777215,AQUAMARINE:2147472639,AZURE:4043309055,BEIGE:4126530815,BISQUE:4293182719,BLACK:255,BLANCHEDALMOND:4293643775,BLUE:65535,BLUEVIOLET:2318131967,BROWN:2771004159,BURLYWOOD:3736635391,CADETBLUE:1604231423,CHARTREUSE:2147418367,CHOCOLATE:3530104575,CORAL:4286533887,CORNFLOWERBLUE:1687547391,CORNSILK:4294499583,CRIMSON:3692313855,CYAN:16777215,DARKBLUE:35839,DARKCYAN:9145343,DARKGOLDENROD:3095837695,DARKGRAY:2846468607,DARKGREEN:6553855,DARKGREY:2846468607,DARKKHAKI:3182914559,DARKMAGENTA:2332068863,DARKOLIVEGREEN:1433087999,DARKORANGE:4287365375,DARKORCHID:2570243327,DARKRED:2332033279,DARKSALMON:3918953215,DARKSEAGREEN:2411499519,DARKSLATEBLUE:1211993087,DARKSLATEGRAY:793726975,DARKSLATEGREY:793726975,DARKTURQUOISE:13554175,DARKVIOLET:2483082239,DEEPPINK:4279538687,DEEPSKYBLUE:12582911,DIMGRAY:1768516095,DIMGREY:1768516095,DODGERBLUE:512819199,FIREBRICK:2988581631,FLORALWHITE:4294635775,FORESTGREEN:579543807,FUCHSIA:4278255615,GAINSBORO:3705462015,GHOSTWHITE:4177068031,GOLD:4292280575,GOLDENROD:3668254975,GRAY:2155905279,GREEN:8388863,GREENYELLOW:2919182335,GREY:2155905279,HONEYDEW:4043305215,HOTPINK:4285117695,INDIANRED:3445382399,INDIGO:1258324735,IVORY:4294963455,KHAKI:4041641215,LAVENDER:3873897215,LAVENDERBLUSH:4293981695,LAWNGREEN:2096890111,LEMONCHIFFON:4294626815,LIGHTBLUE:2916673279,LIGHTCORAL:4034953471,LIGHTCYAN:3774873599,LIGHTGOLDENRODYELLOW:4210742015,LIGHTGRAY:3553874943,LIGHTGREEN:2431553791,LIGHTGREY:3553874943,LIGHTPINK:4290167295,LIGHTSALMON:4288707327,LIGHTSEAGREEN:548580095,LIGHTSKYBLUE:2278488831,LIGHTSLATEGRAY:2005441023,LIGHTSLATEGREY:2005441023,LIGHTSTEELBLUE:2965692159,LIGHTYELLOW:4294959359,LIME:16711935,LIMEGREEN:852308735,LINEN:4210091775,MAGENTA:4278255615,MAROON:2147483903,MEDIUMAQUAMARINE:1724754687,MEDIUMBLUE:52735,MEDIUMORCHID:3126187007,MEDIUMPURPLE:2473647103,MEDIUMSEAGREEN:1018393087,MEDIUMSLATEBLUE:2070474495,MEDIUMSPRINGGREEN:16423679,MEDIUMTURQUOISE:1221709055,MEDIUMVIOLETRED:3340076543,MIDNIGHTBLUE:421097727,MINTCREAM:4127193855,MISTYROSE:4293190143,MOCCASIN:4293178879,NAVAJOWHITE:4292783615,NAVY:33023,OLDLACE:4260751103,OLIVE:2155872511,OLIVEDRAB:1804477439,ORANGE:4289003775,ORANGERED:4282712319,ORCHID:3664828159,PALEGOLDENROD:4008225535,PALEGREEN:2566625535,PALETURQUOISE:2951671551,PALEVIOLETRED:3681588223,PAPAYAWHIP:4293907967,PEACHPUFF:4292524543,PERU:3448061951,PINK:4290825215,PLUM:3718307327,POWDERBLUE:2967529215,PURPLE:2147516671,REBECCAPURPLE:1714657791,RED:4278190335,ROSYBROWN:3163525119,ROYALBLUE:1097458175,SADDLEBROWN:2336560127,SALMON:4202722047,SANDYBROWN:4104413439,SEAGREEN:780883967,SEASHELL:4294307583,SIENNA:2689740287,SILVER:3233857791,SKYBLUE:2278484991,SLATEBLUE:1784335871,SLATEGRAY:1887473919,SLATEGREY:1887473919,SNOW:4294638335,SPRINGGREEN:16744447,STEELBLUE:1182971135,TAN:3535047935,TEAL:8421631,THISTLE:3636451583,TOMATO:4284696575,TRANSPARENT:0,TURQUOISE:1088475391,VIOLET:4001558271,WHEAT:4125012991,WHITE:4294967295,WHITESMOKE:4126537215,YELLOW:4294902015,YELLOWGREEN:2597139199},dr={name:"background-clip",initialValue:"border-box",prefix:!1,type:1,parse:function(t,e){return e.map((function(t){if(Pi(t))switch(t.value){case"padding-box":return 1;case"content-box":return 2}return 0}))}},pr={name:"background-color",initialValue:"transparent",prefix:!1,type:3,format:"color"},fr=function(t,e){var i=er.parse(t,e[0]),r=e[1];return r&&Ni(r)?{color:i,stop:r}:{color:i,stop:null}},Ar=function(t,e){var i=t[0],r=t[t.length-1];null===i.stop&&(i.stop=Vi),null===r.stop&&(r.stop=Hi);for(var n=[],o=0,s=0;s<t.length;s++){var a=t[s].stop;if(null!==a){var l=$i(a,e);l>o?n.push(l):n.push(o),o=l}else n.push(null)}var c=null;for(s=0;s<n.length;s++){var u=n[s];if(null===u)null===c&&(c=s);else if(null!==c){for(var h=s-c,d=(u-n[c-1])/(h+1),p=1;p<=h;p++)n[c+p-1]=d*p;c=null}}return t.map((function(t,i){return{color:t.color,stop:Math.max(Math.min(1,n[i]/e),0)}}))},mr=function(t,e,i){var r=e/2,n=i/2,o=$i(t[0],e)-r,s=n-$i(t[1],i);return(Math.atan2(s,o)+2*Math.PI)%(2*Math.PI)},gr=function(t,e,i){var r="number"==typeof t?t:mr(t,e,i),n=Math.abs(e*Math.sin(r))+Math.abs(i*Math.cos(r)),o=e/2,s=i/2,a=n/2,l=Math.sin(r-Math.PI/2)*a,c=Math.cos(r-Math.PI/2)*a;return[n,o-c,o+c,s-l,s+l]},_r=function(t,e){return Math.sqrt(t*t+e*e)},yr=function(t,e,i,r,n){return[[0,0],[0,e],[t,0],[t,e]].reduce((function(t,e){var o=e[0],s=e[1],a=_r(i-o,r-s);return(n?a<t.optimumDistance:a>t.optimumDistance)?{optimumCorner:e,optimumDistance:a}:t}),{optimumDistance:n?1/0:-1/0,optimumCorner:null}).optimumCorner},vr=function(t,e,i,r,n){var o=0,s=0;switch(t.size){case 0:0===t.shape?o=s=Math.min(Math.abs(e),Math.abs(e-r),Math.abs(i),Math.abs(i-n)):1===t.shape&&(o=Math.min(Math.abs(e),Math.abs(e-r)),s=Math.min(Math.abs(i),Math.abs(i-n)));break;case 2:if(0===t.shape)o=s=Math.min(_r(e,i),_r(e,i-n),_r(e-r,i),_r(e-r,i-n));else if(1===t.shape){var a=Math.min(Math.abs(i),Math.abs(i-n))/Math.min(Math.abs(e),Math.abs(e-r)),l=yr(r,n,e,i,!0),c=l[0],u=l[1];s=a*(o=_r(c-e,(u-i)/a))}break;case 1:0===t.shape?o=s=Math.max(Math.abs(e),Math.abs(e-r),Math.abs(i),Math.abs(i-n)):1===t.shape&&(o=Math.max(Math.abs(e),Math.abs(e-r)),s=Math.max(Math.abs(i),Math.abs(i-n)));break;case 3:if(0===t.shape)o=s=Math.max(_r(e,i),_r(e,i-n),_r(e-r,i),_r(e-r,i-n));else if(1===t.shape){a=Math.max(Math.abs(i),Math.abs(i-n))/Math.max(Math.abs(e),Math.abs(e-r));var h=yr(r,n,e,i,!1);c=h[0],u=h[1],s=a*(o=_r(c-e,(u-i)/a))}}return Array.isArray(t.size)&&(o=$i(t.size[0],r),s=2===t.size.length?$i(t.size[1],n):o),[o,s]},xr=function(t,e){var i=tr(180),r=[];return Ri(e).forEach((function(e,n){if(0===n){var o=e[0];if(20===o.type&&-1!==["top","left","right","bottom"].indexOf(o.value))return void(i=Yi(e));if(Ji(o))return void(i=(Xi.parse(t,o)+tr(270))%tr(360))}var s=fr(t,e);r.push(s)})),{angle:i,stops:r,type:1}},br="closest-side",wr="farthest-side",Tr="closest-corner",Br="farthest-corner",Er="circle",Cr="ellipse",Sr="cover",Ir="contain",Mr=function(t,e){var i=0,r=3,n=[],o=[];return Ri(e).forEach((function(e,s){var a=!0;if(0===s?a=e.reduce((function(t,e){if(Pi(e))switch(e.value){case"center":return o.push(ji),!1;case"top":case"left":return o.push(Vi),!1;case"right":case"bottom":return o.push(Hi),!1}else if(Ni(e)||Oi(e))return o.push(e),!1;return t}),a):1===s&&(a=e.reduce((function(t,e){if(Pi(e))switch(e.value){case Er:return i=0,!1;case Cr:return i=1,!1;case Ir:case br:return r=0,!1;case wr:return r=1,!1;case Tr:return r=2,!1;case Sr:case Br:return r=3,!1}else if(Oi(e)||Ni(e))return Array.isArray(r)||(r=[]),r.push(e),!1;return t}),a)),a){var l=fr(t,e);n.push(l)}})),{size:r,shape:i,stops:n,position:o,type:2}},kr=function(t){return 1===t.type},Pr=function(t){return 2===t.type},Lr={name:"image",parse:function(t,e){if(22===e.type){var i={url:e.value,type:0};return t.cache.addImage(e.value),i}if(18===e.type){var r=Dr[e.name];if(void 0===r)throw new Error('Attempting to parse an unsupported image function "'+e.name+'"');return r(t,e.values)}throw new Error("Unsupported image type "+e.type)}};function zr(t){return!(20===t.type&&"none"===t.value||18===t.type&&!Dr[t.name])}var Fr,Dr={"linear-gradient":function(t,e){var i=tr(180),r=[];return Ri(e).forEach((function(e,n){if(0===n){var o=e[0];if(20===o.type&&"to"===o.value)return void(i=Yi(e));if(Ji(o))return void(i=Xi.parse(t,o))}var s=fr(t,e);r.push(s)})),{angle:i,stops:r,type:1}},"-moz-linear-gradient":xr,"-ms-linear-gradient":xr,"-o-linear-gradient":xr,"-webkit-linear-gradient":xr,"radial-gradient":function(t,e){var i=0,r=3,n=[],o=[];return Ri(e).forEach((function(e,s){var a=!0;if(0===s){var l=!1;a=e.reduce((function(t,e){if(l)if(Pi(e))switch(e.value){case"center":return o.push(ji),t;case"top":case"left":return o.push(Vi),t;case"right":case"bottom":return o.push(Hi),t}else(Ni(e)||Oi(e))&&o.push(e);else if(Pi(e))switch(e.value){case Er:return i=0,!1;case Cr:return i=1,!1;case"at":return l=!0,!1;case br:return r=0,!1;case Sr:case wr:return r=1,!1;case Ir:case Tr:return r=2,!1;case Br:return r=3,!1}else if(Oi(e)||Ni(e))return Array.isArray(r)||(r=[]),r.push(e),!1;return t}),a)}if(a){var c=fr(t,e);n.push(c)}})),{size:r,shape:i,stops:n,position:o,type:2}},"-moz-radial-gradient":Mr,"-ms-radial-gradient":Mr,"-o-radial-gradient":Mr,"-webkit-radial-gradient":Mr,"-webkit-gradient":function(t,e){var i=tr(180),r=[],n=1,o=0,s=3,a=[];return Ri(e).forEach((function(e,i){var o=e[0];if(0===i){if(Pi(o)&&"linear"===o.value)return void(n=1);if(Pi(o)&&"radial"===o.value)return void(n=2)}if(18===o.type)if("from"===o.name){var s=er.parse(t,o.values[0]);r.push({stop:Vi,color:s})}else if("to"===o.name)s=er.parse(t,o.values[0]),r.push({stop:Hi,color:s});else if("color-stop"===o.name){var a=o.values.filter(Di);if(2===a.length){s=er.parse(t,a[1]);var l=a[0];ki(l)&&r.push({stop:{type:16,number:100*l.number,flags:l.flags},color:s})}}})),1===n?{angle:(i+tr(180))%tr(360),stops:r,type:n}:{size:s,shape:o,stops:r,position:a,type:n}}},Rr={name:"background-image",initialValue:"none",type:1,prefix:!1,parse:function(t,e){if(0===e.length)return[];var i=e[0];return 20===i.type&&"none"===i.value?[]:e.filter((function(t){return Di(t)&&zr(t)})).map((function(e){return Lr.parse(t,e)}))}},Ur={name:"background-origin",initialValue:"border-box",prefix:!1,type:1,parse:function(t,e){return e.map((function(t){if(Pi(t))switch(t.value){case"padding-box":return 1;case"content-box":return 2}return 0}))}},Or={name:"background-position",initialValue:"0% 0%",type:1,prefix:!1,parse:function(t,e){return Ri(e).map((function(t){return t.filter(Ni)})).map(Qi)}},Nr={name:"background-repeat",initialValue:"repeat",prefix:!1,type:1,parse:function(t,e){return Ri(e).map((function(t){return t.filter(Pi).map((function(t){return t.value})).join(" ")})).map(Qr)}},Qr=function(t){switch(t){case"no-repeat":return 1;case"repeat-x":case"repeat no-repeat":return 2;case"repeat-y":case"no-repeat repeat":return 3;default:return 0}};!function(t){t.AUTO="auto",t.CONTAIN="contain",t.COVER="cover"}(Fr||(Fr={}));var Vr,jr={name:"background-size",initialValue:"0",prefix:!1,type:1,parse:function(t,e){return Ri(e).map((function(t){return t.filter(Hr)}))}},Hr=function(t){return Pi(t)||Ni(t)},Gr=function(t){return{name:"border-"+t+"-color",initialValue:"transparent",prefix:!1,type:3,format:"color"}},$r=Gr("top"),Zr=Gr("right"),qr=Gr("bottom"),Kr=Gr("left"),Wr=function(t){return{name:"border-radius-"+t,initialValue:"0 0",prefix:!1,type:1,parse:function(t,e){return Qi(e.filter(Ni))}}},Xr=Wr("top-left"),Jr=Wr("top-right"),Yr=Wr("bottom-right"),tn=Wr("bottom-left"),en=function(t){return{name:"border-"+t+"-style",initialValue:"solid",prefix:!1,type:2,parse:function(t,e){switch(e){case"none":return 0;case"dashed":return 2;case"dotted":return 3;case"double":return 4}return 1}}},rn=en("top"),nn=en("right"),on=en("bottom"),sn=en("left"),an=function(t){return{name:"border-"+t+"-width",initialValue:"0",type:0,prefix:!1,parse:function(t,e){return Mi(e)?e.number:0}}},ln=an("top"),cn=an("right"),un=an("bottom"),hn=an("left"),dn={name:"color",initialValue:"transparent",prefix:!1,type:3,format:"color"},pn={name:"direction",initialValue:"ltr",prefix:!1,type:2,parse:function(t,e){return"rtl"===e?1:0}},fn={name:"display",initialValue:"inline-block",prefix:!1,type:1,parse:function(t,e){return e.filter(Pi).reduce((function(t,e){return t|An(e.value)}),0)}},An=function(t){switch(t){case"block":case"-webkit-box":return 2;case"inline":return 4;case"run-in":return 8;case"flow":return 16;case"flow-root":return 32;case"table":return 64;case"flex":case"-webkit-flex":return 128;case"grid":case"-ms-grid":return 256;case"ruby":return 512;case"subgrid":return 1024;case"list-item":return 2048;case"table-row-group":return 4096;case"table-header-group":return 8192;case"table-footer-group":return 16384;case"table-row":return 32768;case"table-cell":return 65536;case"table-column-group":return 131072;case"table-column":return 262144;case"table-caption":return 524288;case"ruby-base":return 1048576;case"ruby-text":return 2097152;case"ruby-base-container":return 4194304;case"ruby-text-container":return 8388608;case"contents":return 16777216;case"inline-block":return 33554432;case"inline-list-item":return 67108864;case"inline-table":return 134217728;case"inline-flex":return 268435456;case"inline-grid":return 536870912}return 0},mn={name:"float",initialValue:"none",prefix:!1,type:2,parse:function(t,e){switch(e){case"left":return 1;case"right":return 2;case"inline-start":return 3;case"inline-end":return 4}return 0}},gn={name:"letter-spacing",initialValue:"0",prefix:!1,type:0,parse:function(t,e){return 20===e.type&&"normal"===e.value?0:17===e.type||15===e.type?e.number:0}};!function(t){t.NORMAL="normal",t.STRICT="strict"}(Vr||(Vr={}));var _n,yn={name:"line-break",initialValue:"normal",prefix:!1,type:2,parse:function(t,e){return"strict"===e?Vr.STRICT:Vr.NORMAL}},vn={name:"line-height",initialValue:"normal",prefix:!1,type:4},xn=function(t,e){return Pi(t)&&"normal"===t.value?1.2*e:17===t.type?e*t.number:Ni(t)?$i(t,e):e},bn={name:"list-style-image",initialValue:"none",type:0,prefix:!1,parse:function(t,e){return 20===e.type&&"none"===e.value?null:Lr.parse(t,e)}},wn={name:"list-style-position",initialValue:"outside",prefix:!1,type:2,parse:function(t,e){return"inside"===e?0:1}},Tn={name:"list-style-type",initialValue:"none",prefix:!1,type:2,parse:function(t,e){switch(e){case"disc":return 0;case"circle":return 1;case"square":return 2;case"decimal":return 3;case"cjk-decimal":return 4;case"decimal-leading-zero":return 5;case"lower-roman":return 6;case"upper-roman":return 7;case"lower-greek":return 8;case"lower-alpha":return 9;case"upper-alpha":return 10;case"arabic-indic":return 11;case"armenian":return 12;case"bengali":return 13;case"cambodian":return 14;case"cjk-earthly-branch":return 15;case"cjk-heavenly-stem":return 16;case"cjk-ideographic":return 17;case"devanagari":return 18;case"ethiopic-numeric":return 19;case"georgian":return 20;case"gujarati":return 21;case"gurmukhi":case"hebrew":return 22;case"hiragana":return 23;case"hiragana-iroha":return 24;case"japanese-formal":return 25;case"japanese-informal":return 26;case"kannada":return 27;case"katakana":return 28;case"katakana-iroha":return 29;case"khmer":return 30;case"korean-hangul-formal":return 31;case"korean-hanja-formal":return 32;case"korean-hanja-informal":return 33;case"lao":return 34;case"lower-armenian":return 35;case"malayalam":return 36;case"mongolian":return 37;case"myanmar":return 38;case"oriya":return 39;case"persian":return 40;case"simp-chinese-formal":return 41;case"simp-chinese-informal":return 42;case"tamil":return 43;case"telugu":return 44;case"thai":return 45;case"tibetan":return 46;case"trad-chinese-formal":return 47;case"trad-chinese-informal":return 48;case"upper-armenian":return 49;case"disclosure-open":return 50;case"disclosure-closed":return 51;default:return-1}}},Bn=function(t){return{name:"margin-"+t,initialValue:"0",prefix:!1,type:4}},En=Bn("top"),Cn=Bn("right"),Sn=Bn("bottom"),In=Bn("left"),Mn={name:"overflow",initialValue:"visible",prefix:!1,type:1,parse:function(t,e){return e.filter(Pi).map((function(t){switch(t.value){case"hidden":return 1;case"scroll":return 2;case"clip":return 3;case"auto":return 4;default:return 0}}))}},kn={name:"overflow-wrap",initialValue:"normal",prefix:!1,type:2,parse:function(t,e){return"break-word"===e?"break-word":"normal"}},Pn=function(t){return{name:"padding-"+t,initialValue:"0",prefix:!1,type:3,format:"length-percentage"}},Ln=Pn("top"),zn=Pn("right"),Fn=Pn("bottom"),Dn=Pn("left"),Rn={name:"text-align",initialValue:"left",prefix:!1,type:2,parse:function(t,e){switch(e){case"right":return 2;case"center":case"justify":return 1;default:return 0}}},Un={name:"position",initialValue:"static",prefix:!1,type:2,parse:function(t,e){switch(e){case"relative":return 1;case"absolute":return 2;case"fixed":return 3;case"sticky":return 4}return 0}},On={name:"text-shadow",initialValue:"none",type:1,prefix:!1,parse:function(t,e){return 1===e.length&&zi(e[0],"none")?[]:Ri(e).map((function(e){for(var i={color:hr.TRANSPARENT,offsetX:Vi,offsetY:Vi,blur:Vi},r=0,n=0;n<e.length;n++){var o=e[n];Oi(o)?(0===r?i.offsetX=o:1===r?i.offsetY=o:i.blur=o,r++):i.color=er.parse(t,o)}return i}))}},Nn={name:"text-transform",initialValue:"none",prefix:!1,type:2,parse:function(t,e){switch(e){case"uppercase":return 2;case"lowercase":return 1;case"capitalize":return 3}return 0}},Qn={name:"transform",initialValue:"none",prefix:!0,type:0,parse:function(t,e){if(20===e.type&&"none"===e.value)return null;if(18===e.type){var i=Vn[e.name];if(void 0===i)throw new Error('Attempting to parse an unsupported transform function "'+e.name+'"');return i(e.values)}return null}},Vn={matrix:function(t){var e=t.filter((function(t){return 17===t.type})).map((function(t){return t.number}));return 6===e.length?e:null},matrix3d:function(t){var e=t.filter((function(t){return 17===t.type})).map((function(t){return t.number})),i=e[0],r=e[1];e[2],e[3];var n=e[4],o=e[5];e[6],e[7],e[8],e[9],e[10],e[11];var s=e[12],a=e[13];return e[14],e[15],16===e.length?[i,r,n,o,s,a]:null}},jn={type:16,number:50,flags:Gt},Hn=[jn,jn],Gn={name:"transform-origin",initialValue:"50% 50%",prefix:!0,type:1,parse:function(t,e){var i=e.filter(Ni);return 2!==i.length?Hn:[i[0],i[1]]}},$n={name:"visible",initialValue:"none",prefix:!1,type:2,parse:function(t,e){switch(e){case"hidden":return 1;case"collapse":return 2;default:return 0}}};!function(t){t.NORMAL="normal",t.BREAK_ALL="break-all",t.KEEP_ALL="keep-all"}(_n||(_n={}));for(var Zn={name:"word-break",initialValue:"normal",prefix:!1,type:2,parse:function(t,e){switch(e){case"break-all":return _n.BREAK_ALL;case"keep-all":return _n.KEEP_ALL;default:return _n.NORMAL}}},qn={name:"z-index",initialValue:"auto",prefix:!1,type:0,parse:function(t,e){if(20===e.type)return{auto:!0,order:0};if(ki(e))return{auto:!1,order:e.number};throw new Error("Invalid z-index number parsed")}},Kn={name:"time",parse:function(t,e){if(15===e.type)switch(e.unit.toLowerCase()){case"s":return 1e3*e.number;case"ms":return e.number}throw new Error("Unsupported time type")}},Wn={name:"opacity",initialValue:"1",type:0,prefix:!1,parse:function(t,e){return ki(e)?e.number:1}},Xn={name:"text-decoration-color",initialValue:"transparent",prefix:!1,type:3,format:"color"},Jn={name:"text-decoration-line",initialValue:"none",prefix:!1,type:1,parse:function(t,e){return e.filter(Pi).map((function(t){switch(t.value){case"underline":return 1;case"overline":return 2;case"line-through":return 3;case"none":return 4}return 0})).filter((function(t){return 0!==t}))}},Yn={name:"font-family",initialValue:"",prefix:!1,type:1,parse:function(t,e){var i=[],r=[];return e.forEach((function(t){switch(t.type){case 20:case 0:i.push(t.value);break;case 17:i.push(t.number.toString());break;case 4:r.push(i.join(" ")),i.length=0}})),i.length&&r.push(i.join(" ")),r.map((function(t){return-1===t.indexOf(" ")?t:"'"+t+"'"}))}},to={name:"font-size",initialValue:"0",prefix:!1,type:3,format:"length"},eo={name:"font-weight",initialValue:"normal",type:0,prefix:!1,parse:function(t,e){return ki(e)?e.number:Pi(e)&&"bold"===e.value?700:400}},io={name:"font-variant",initialValue:"none",type:1,prefix:!1,parse:function(t,e){return e.filter(Pi).map((function(t){return t.value}))}},ro={name:"font-style",initialValue:"normal",prefix:!1,type:2,parse:function(t,e){switch(e){case"oblique":return"oblique";case"italic":return"italic";default:return"normal"}}},no=function(t,e){return 0!=(t&e)},oo={name:"content",initialValue:"none",type:1,prefix:!1,parse:function(t,e){if(0===e.length)return[];var i=e[0];return 20===i.type&&"none"===i.value?[]:e}},so={name:"counter-increment",initialValue:"none",prefix:!0,type:1,parse:function(t,e){if(0===e.length)return null;var i=e[0];if(20===i.type&&"none"===i.value)return null;for(var r=[],n=e.filter(Fi),o=0;o<n.length;o++){var s=n[o],a=n[o+1];if(20===s.type){var l=a&&ki(a)?a.number:1;r.push({counter:s.value,increment:l})}}return r}},ao={name:"counter-reset",initialValue:"none",prefix:!0,type:1,parse:function(t,e){if(0===e.length)return[];for(var i=[],r=e.filter(Fi),n=0;n<r.length;n++){var o=r[n],s=r[n+1];if(Pi(o)&&"none"!==o.value){var a=s&&ki(s)?s.number:0;i.push({counter:o.value,reset:a})}}return i}},lo={name:"duration",initialValue:"0s",prefix:!1,type:1,parse:function(t,e){return e.filter(Mi).map((function(e){return Kn.parse(t,e)}))}},co={name:"quotes",initialValue:"none",prefix:!0,type:1,parse:function(t,e){if(0===e.length)return null;var i=e[0];if(20===i.type&&"none"===i.value)return null;var r=[],n=e.filter(Li);if(n.length%2!=0)return null;for(var o=0;o<n.length;o+=2){var s=n[o].value,a=n[o+1].value;r.push({open:s,close:a})}return r}},uo=function(t,e,i){if(!t)return"";var r=t[Math.min(e,t.length-1)];return r?i?r.open:r.close:""},ho={name:"box-shadow",initialValue:"none",type:1,prefix:!1,parse:function(t,e){return 1===e.length&&zi(e[0],"none")?[]:Ri(e).map((function(e){for(var i={color:255,offsetX:Vi,offsetY:Vi,blur:Vi,spread:Vi,inset:!1},r=0,n=0;n<e.length;n++){var o=e[n];zi(o,"inset")?i.inset=!0:Oi(o)?(0===r?i.offsetX=o:1===r?i.offsetY=o:2===r?i.blur=o:i.spread=o,r++):i.color=er.parse(t,o)}return i}))}},po={name:"paint-order",initialValue:"normal",prefix:!1,type:1,parse:function(t,e){var i=[0,1,2],r=[];return e.filter(Pi).forEach((function(t){switch(t.value){case"stroke":r.push(1);break;case"fill":r.push(0);break;case"markers":r.push(2)}})),i.forEach((function(t){-1===r.indexOf(t)&&r.push(t)})),r}},fo={name:"-webkit-text-stroke-color",initialValue:"currentcolor",prefix:!1,type:3,format:"color"},Ao={name:"-webkit-text-stroke-width",initialValue:"0",type:0,prefix:!1,parse:function(t,e){return Mi(e)?e.number:0}},mo=function(){function t(t,e){var i,r;this.animationDuration=yo(t,lo,e.animationDuration),this.backgroundClip=yo(t,dr,e.backgroundClip),this.backgroundColor=yo(t,pr,e.backgroundColor),this.backgroundImage=yo(t,Rr,e.backgroundImage),this.backgroundOrigin=yo(t,Ur,e.backgroundOrigin),this.backgroundPosition=yo(t,Or,e.backgroundPosition),this.backgroundRepeat=yo(t,Nr,e.backgroundRepeat),this.backgroundSize=yo(t,jr,e.backgroundSize),this.borderTopColor=yo(t,$r,e.borderTopColor),this.borderRightColor=yo(t,Zr,e.borderRightColor),this.borderBottomColor=yo(t,qr,e.borderBottomColor),this.borderLeftColor=yo(t,Kr,e.borderLeftColor),this.borderTopLeftRadius=yo(t,Xr,e.borderTopLeftRadius),this.borderTopRightRadius=yo(t,Jr,e.borderTopRightRadius),this.borderBottomRightRadius=yo(t,Yr,e.borderBottomRightRadius),this.borderBottomLeftRadius=yo(t,tn,e.borderBottomLeftRadius),this.borderTopStyle=yo(t,rn,e.borderTopStyle),this.borderRightStyle=yo(t,nn,e.borderRightStyle),this.borderBottomStyle=yo(t,on,e.borderBottomStyle),this.borderLeftStyle=yo(t,sn,e.borderLeftStyle),this.borderTopWidth=yo(t,ln,e.borderTopWidth),this.borderRightWidth=yo(t,cn,e.borderRightWidth),this.borderBottomWidth=yo(t,un,e.borderBottomWidth),this.borderLeftWidth=yo(t,hn,e.borderLeftWidth),this.boxShadow=yo(t,ho,e.boxShadow),this.color=yo(t,dn,e.color),this.direction=yo(t,pn,e.direction),this.display=yo(t,fn,e.display),this.float=yo(t,mn,e.cssFloat),this.fontFamily=yo(t,Yn,e.fontFamily),this.fontSize=yo(t,to,e.fontSize),this.fontStyle=yo(t,ro,e.fontStyle),this.fontVariant=yo(t,io,e.fontVariant),this.fontWeight=yo(t,eo,e.fontWeight),this.letterSpacing=yo(t,gn,e.letterSpacing),this.lineBreak=yo(t,yn,e.lineBreak),this.lineHeight=yo(t,vn,e.lineHeight),this.listStyleImage=yo(t,bn,e.listStyleImage),this.listStylePosition=yo(t,wn,e.listStylePosition),this.listStyleType=yo(t,Tn,e.listStyleType),this.marginTop=yo(t,En,e.marginTop),this.marginRight=yo(t,Cn,e.marginRight),this.marginBottom=yo(t,Sn,e.marginBottom),this.marginLeft=yo(t,In,e.marginLeft),this.opacity=yo(t,Wn,e.opacity);var n=yo(t,Mn,e.overflow);this.overflowX=n[0],this.overflowY=n[n.length>1?1:0],this.overflowWrap=yo(t,kn,e.overflowWrap),this.paddingTop=yo(t,Ln,e.paddingTop),this.paddingRight=yo(t,zn,e.paddingRight),this.paddingBottom=yo(t,Fn,e.paddingBottom),this.paddingLeft=yo(t,Dn,e.paddingLeft),this.paintOrder=yo(t,po,e.paintOrder),this.position=yo(t,Un,e.position),this.textAlign=yo(t,Rn,e.textAlign),this.textDecorationColor=yo(t,Xn,null!==(i=e.textDecorationColor)&&void 0!==i?i:e.color),this.textDecorationLine=yo(t,Jn,null!==(r=e.textDecorationLine)&&void 0!==r?r:e.textDecoration),this.textShadow=yo(t,On,e.textShadow),this.textTransform=yo(t,Nn,e.textTransform),this.transform=yo(t,Qn,e.transform),this.transformOrigin=yo(t,Gn,e.transformOrigin),this.visibility=yo(t,$n,e.visibility),this.webkitTextStrokeColor=yo(t,fo,e.webkitTextStrokeColor),this.webkitTextStrokeWidth=yo(t,Ao,e.webkitTextStrokeWidth),this.wordBreak=yo(t,Zn,e.wordBreak),this.zIndex=yo(t,qn,e.zIndex)}return t.prototype.isVisible=function(){return this.display>0&&this.opacity>0&&0===this.visibility},t.prototype.isTransparent=function(){return ir(this.backgroundColor)},t.prototype.isTransformed=function(){return null!==this.transform},t.prototype.isPositioned=function(){return 0!==this.position},t.prototype.isPositionedWithZIndex=function(){return this.isPositioned()&&!this.zIndex.auto},t.prototype.isFloating=function(){return 0!==this.float},t.prototype.isInlineLevel=function(){return no(this.display,4)||no(this.display,33554432)||no(this.display,268435456)||no(this.display,536870912)||no(this.display,67108864)||no(this.display,134217728)},t}(),go=function(){function t(t,e){this.content=yo(t,oo,e.content),this.quotes=yo(t,co,e.quotes)}return t}(),_o=function(){function t(t,e){this.counterIncrement=yo(t,so,e.counterIncrement),this.counterReset=yo(t,ao,e.counterReset)}return t}(),yo=function(t,e,i){var r=new Si,n=null!=i?i.toString():e.initialValue;r.write(n);var o=new Ii(r.read());switch(e.type){case 2:var s=o.parseComponentValue();return e.parse(t,Pi(s)?s.value:e.initialValue);case 0:return e.parse(t,o.parseComponentValue());case 1:return e.parse(t,o.parseComponentValues());case 4:return o.parseComponentValue();case 3:switch(e.format){case"angle":return Xi.parse(t,o.parseComponentValue());case"color":return er.parse(t,o.parseComponentValue());case"image":return Lr.parse(t,o.parseComponentValue());case"length":var a=o.parseComponentValue();return Oi(a)?a:Vi;case"length-percentage":var l=o.parseComponentValue();return Ni(l)?l:Vi;case"time":return Kn.parse(t,o.parseComponentValue())}}},vo="data-html2canvas-debug",xo=function(t){switch(t.getAttribute(vo)){case"all":return 1;case"clone":return 2;case"parse":return 3;case"render":return 4;default:return 0}},bo=function(t,e){var i=xo(t);return 1===i||e===i},wo=function(){function t(t,e){this.context=t,this.textNodes=[],this.elements=[],this.flags=0,bo(e,3),this.styles=new mo(t,window.getComputedStyle(e,null)),ua(e)&&(this.styles.animationDuration.some((function(t){return t>0}))&&(e.style.animationDuration="0s"),null!==this.styles.transform&&(e.style.transform="none")),this.bounds=a(this.context,e),bo(e,4)&&(this.flags|=16)}return t}(),To="AAAAAAAAAAAAEA4AGBkAAFAaAAACAAAAAAAIABAAGAAwADgACAAQAAgAEAAIABAACAAQAAgAEAAIABAACAAQAAgAEAAIABAAQABIAEQATAAIABAACAAQAAgAEAAIABAAVABcAAgAEAAIABAACAAQAGAAaABwAHgAgACIAI4AlgAIABAAmwCjAKgAsAC2AL4AvQDFAMoA0gBPAVYBWgEIAAgACACMANoAYgFkAWwBdAF8AX0BhQGNAZUBlgGeAaMBlQGWAasBswF8AbsBwwF0AcsBYwHTAQgA2wG/AOMBdAF8AekB8QF0AfkB+wHiAHQBfAEIAAMC5gQIAAsCEgIIAAgAFgIeAggAIgIpAggAMQI5AkACygEIAAgASAJQAlgCYAIIAAgACAAKBQoFCgUTBRMFGQUrBSsFCAAIAAgACAAIAAgACAAIAAgACABdAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABoAmgCrwGvAQgAbgJ2AggAHgEIAAgACADnAXsCCAAIAAgAgwIIAAgACAAIAAgACACKAggAkQKZAggAPADJAAgAoQKkAqwCsgK6AsICCADJAggA0AIIAAgACAAIANYC3gIIAAgACAAIAAgACABAAOYCCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAkASoB+QIEAAgACAA8AEMCCABCBQgACABJBVAFCAAIAAgACAAIAAgACAAIAAgACABTBVoFCAAIAFoFCABfBWUFCAAIAAgACAAIAAgAbQUIAAgACAAIAAgACABzBXsFfQWFBYoFigWKBZEFigWKBYoFmAWfBaYFrgWxBbkFCAAIAAgACAAIAAgACAAIAAgACAAIAMEFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAMgFCADQBQgACAAIAAgACAAIAAgACAAIAAgACAAIAO4CCAAIAAgAiQAIAAgACABAAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAD0AggACAD8AggACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIANYFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAMDvwAIAAgAJAIIAAgACAAIAAgACAAIAAgACwMTAwgACAB9BOsEGwMjAwgAKwMyAwsFYgE3A/MEPwMIAEUDTQNRAwgAWQOsAGEDCAAIAAgACAAIAAgACABpAzQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFIQUoBSwFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABtAwgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABMAEwACAAIAAgACAAIABgACAAIAAgACAC/AAgACAAyAQgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACACAAIAAwAAgACAAIAAgACAAIAAgACAAIAAAARABIAAgACAAIABQASAAIAAgAIABwAEAAjgCIABsAqAC2AL0AigDQAtwC+IJIQqVAZUBWQqVAZUBlQGVAZUBlQGrC5UBlQGVAZUBlQGVAZUBlQGVAXsKlQGVAbAK6wsrDGUMpQzlDJUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAfAKAAuZA64AtwCJALoC6ADwAAgAuACgA/oEpgO6AqsD+AAIAAgAswMIAAgACAAIAIkAuwP5AfsBwwPLAwgACAAIAAgACADRA9kDCAAIAOED6QMIAAgACAAIAAgACADuA/YDCAAIAP4DyQAIAAgABgQIAAgAXQAOBAgACAAIAAgACAAIABMECAAIAAgACAAIAAgACAD8AAQBCAAIAAgAGgQiBCoECAExBAgAEAEIAAgACAAIAAgACAAIAAgACAAIAAgACAA4BAgACABABEYECAAIAAgATAQYAQgAVAQIAAgACAAIAAgACAAIAAgACAAIAFoECAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAOQEIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAB+BAcACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAEABhgSMBAgACAAIAAgAlAQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAwAEAAQABAADAAMAAwADAAQABAAEAAQABAAEAAQABHATAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAdQMIAAgACAAIAAgACAAIAMkACAAIAAgAfQMIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACACFA4kDCAAIAAgACAAIAOcBCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAIcDCAAIAAgACAAIAAgACAAIAAgACAAIAJEDCAAIAAgACADFAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABgBAgAZgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAbAQCBXIECAAIAHkECAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABAAJwEQACjBKoEsgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAC6BMIECAAIAAgACAAIAAgACABmBAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAxwQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAGYECAAIAAgAzgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAigWKBYoFigWKBYoFigWKBd0FXwUIAOIF6gXxBYoF3gT5BQAGCAaKBYoFigWKBYoFigWKBYoFigWKBYoFigXWBIoFigWKBYoFigWKBYoFigWKBYsFEAaKBYoFigWKBYoFigWKBRQGCACKBYoFigWKBQgACAAIANEECAAIABgGigUgBggAJgYIAC4GMwaKBYoF0wQ3Bj4GigWKBYoFigWKBYoFigWKBYoFigWKBYoFigUIAAgACAAIAAgACAAIAAgAigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWLBf///////wQABAAEAAQABAAEAAQABAAEAAQAAwAEAAQAAgAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAQADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAUAAAAFAAUAAAAFAAUAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUAAQAAAAUABQAFAAUABQAFAAAAAAAFAAUAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAFAAUAAQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUABQAFAAAABwAHAAcAAAAHAAcABwAFAAEAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAcABwAFAAUAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAQABAAAAAAAAAAAAAAAFAAUABQAFAAAABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABwAHAAcAAAAHAAcAAAAAAAUABQAHAAUAAQAHAAEABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABwABAAUABQAFAAUAAAAAAAAAAAAAAAEAAQABAAEAAQABAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABQANAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQABAAEAAQABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAABQAHAAUABQAFAAAAAAAAAAcABQAFAAUABQAFAAQABAAEAAQABAAEAAQABAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUAAAAFAAUABQAFAAUAAAAFAAUABQAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAAAAAAAAAAAAUABQAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAUAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABwAHAAcABwAFAAcABwAAAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAUABwAHAAUABQAFAAUAAAAAAAcABwAAAAAABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAABQAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAABwAHAAcABQAFAAAAAAAAAAAABQAFAAAAAAAFAAUABQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAFAAUABQAFAAUAAAAFAAUABwAAAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAFAAUABwAFAAUABQAFAAAAAAAHAAcAAAAAAAcABwAFAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABwAAAAAAAAAHAAcABwAAAAcABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAABQAHAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAcABwAAAAUABQAFAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABQAHAAcABQAHAAcAAAAFAAcABwAAAAcABwAFAAUAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAFAAcABwAFAAUABQAAAAUAAAAHAAcABwAHAAcABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAHAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAABwAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAUAAAAFAAAAAAAAAAAABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUABQAFAAUAAAAFAAUAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABwAFAAUABQAFAAUABQAAAAUABQAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABQAFAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABQAFAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAHAAUABQAFAAUABQAFAAUABwAHAAcABwAHAAcABwAHAAUABwAHAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABwAHAAcABwAFAAUABwAHAAcAAAAAAAAAAAAHAAcABQAHAAcABwAHAAcABwAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAHAAUABQAFAAUABQAFAAUAAAAFAAAABQAAAAAABQAFAAUABQAFAAUABQAFAAcABwAHAAcABwAHAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAUABQAFAAUABQAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABwAFAAcABwAHAAcABwAFAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAUABQAFAAUABwAHAAUABQAHAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABQAFAAcABwAHAAUABwAFAAUABQAHAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAUABQAFAAUABQAFAAUABQAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAcABQAFAAUABQAFAAUABQAAAAAAAAAAAAUAAAAAAAAAAAAAAAAABQAAAAAABwAFAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUAAAAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAABQAAAAAAAAAFAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAUABQAHAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAHAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABwAFAAUABQAFAAcABwAFAAUABwAHAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAcABwAFAAUABwAHAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAFAAUABQAAAAAABQAFAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAFAAcABwAAAAAAAAAAAAAABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAFAAcABwAFAAcABwAAAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAFAAUABQAAAAUABQAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABwAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABQAFAAUABQAFAAUABQAFAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAHAAcABQAHAAUABQAAAAAAAAAAAAAAAAAFAAAABwAHAAcABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAcABwAAAAAABwAHAAAAAAAHAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABwAHAAUABQAFAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABQAFAAUABQAFAAUABwAFAAcABwAFAAcABQAFAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABQAFAAUABQAAAAAABwAHAAcABwAFAAUABwAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAHAAUABQAFAAUABQAFAAUABQAHAAcABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAFAAcABwAFAAUABQAFAAUABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAcABwAFAAUABQAFAAcABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABQAHAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAAAAAAFAAUABwAHAAcABwAFAAAAAAAAAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABwAHAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAHAAUABQAFAAUABQAFAAUABwAFAAUABwAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAAAAAAAABQAAAAUABQAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAHAAcAAAAFAAUAAAAHAAcABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAAAAAAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAUABQAFAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAABQAFAAUABQAFAAUABQAAAAUABQAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAFAAUABQAFAAUADgAOAA4ADgAOAA4ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAAAAAAAAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAMAAwADAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkAAAAAAAAAAAAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAAAAAAAAAAAAsADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwACwAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAADgAOAA4AAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAAAA4ADgAOAA4ADgAOAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAA4AAAAOAAAAAAAAAAAAAAAAAA4AAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAADgAAAAAAAAAAAA4AAAAOAAAAAAAAAAAADgAOAA4AAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAA4ADgAOAA4ADgAOAA4ADgAOAAAADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4AAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAOAA4ADgAOAA4ADgAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAAAAAAA=",Bo="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Eo="undefined"==typeof Uint8Array?[]:new Uint8Array(256),Co=0;Co<Bo.length;Co++)Eo[Bo.charCodeAt(Co)]=Co;for(var So=function(t){var e,i,r,n,o,s=.75*t.length,a=t.length,l=0;"="===t[t.length-1]&&(s--,"="===t[t.length-2]&&s--);var c="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array&&void 0!==Uint8Array.prototype.slice?new ArrayBuffer(s):new Array(s),u=Array.isArray(c)?c:new Uint8Array(c);for(e=0;e<a;e+=4)i=Eo[t.charCodeAt(e)],r=Eo[t.charCodeAt(e+1)],n=Eo[t.charCodeAt(e+2)],o=Eo[t.charCodeAt(e+3)],u[l++]=i<<2|r>>4,u[l++]=(15&r)<<4|n>>2,u[l++]=(3&n)<<6|63&o;return c},Io=function(t){for(var e=t.length,i=[],r=0;r<e;r+=2)i.push(t[r+1]<<8|t[r]);return i},Mo=function(t){for(var e=t.length,i=[],r=0;r<e;r+=4)i.push(t[r+3]<<24|t[r+2]<<16|t[r+1]<<8|t[r]);return i},ko=5,Po=11,Lo=2,zo=65536>>ko,Fo=(1<<ko)-1,Do=zo+(1024>>ko)+32,Ro=65536>>Po,Uo=(1<<Po-ko)-1,Oo=function(t,e,i){return t.slice?t.slice(e,i):new Uint16Array(Array.prototype.slice.call(t,e,i))},No=function(t,e,i){return t.slice?t.slice(e,i):new Uint32Array(Array.prototype.slice.call(t,e,i))},Qo=function(t,e){var i=So(t),r=Array.isArray(i)?Mo(i):new Uint32Array(i),n=Array.isArray(i)?Io(i):new Uint16Array(i),o=24,s=Oo(n,o/2,r[4]/2),a=2===r[5]?Oo(n,(o+r[4])/2):No(r,Math.ceil((o+r[4])/4));return new Vo(r[0],r[1],r[2],r[3],s,a)},Vo=function(){function t(t,e,i,r,n,o){this.initialValue=t,this.errorValue=e,this.highStart=i,this.highValueIndex=r,this.index=n,this.data=o}return t.prototype.get=function(t){var e;if(t>=0){if(t<55296||t>56319&&t<=65535)return e=((e=this.index[t>>ko])<<Lo)+(t&Fo),this.data[e];if(t<=65535)return e=((e=this.index[zo+(t-55296>>ko)])<<Lo)+(t&Fo),this.data[e];if(t<this.highStart)return e=Do-Ro+(t>>Po),e=this.index[e],e+=t>>ko&Uo,e=((e=this.index[e])<<Lo)+(t&Fo),this.data[e];if(t<=1114111)return this.data[this.highValueIndex]}return this.errorValue},t}(),jo="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Ho="undefined"==typeof Uint8Array?[]:new Uint8Array(256),Go=0;Go<jo.length;Go++)Ho[jo.charCodeAt(Go)]=Go;var $o,Zo=1,qo=2,Ko=3,Wo=4,Xo=5,Jo=7,Yo=8,ts=9,es=10,is=11,rs=12,ns=13,os=14,ss=15,as=function(t){for(var e=[],i=0,r=t.length;i<r;){var n=t.charCodeAt(i++);if(n>=55296&&n<=56319&&i<r){var o=t.charCodeAt(i++);56320==(64512&o)?e.push(((1023&n)<<10)+(1023&o)+65536):(e.push(n),i--)}else e.push(n)}return e},ls=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(String.fromCodePoint)return String.fromCodePoint.apply(String,t);var i=t.length;if(!i)return"";for(var r=[],n=-1,o="";++n<i;){var s=t[n];s<=65535?r.push(s):(s-=65536,r.push(55296+(s>>10),s%1024+56320)),(n+1===i||r.length>16384)&&(o+=String.fromCharCode.apply(String,r),r.length=0)}return o},cs=Qo(To),us="",hs="",ds=function(t){return cs.get(t)},ps=function(t,e,i){var r=i-2,n=e[r],o=e[i-1],s=e[i];if(o===qo&&s===Ko)return us;if(o===qo||o===Ko||o===Wo)return hs;if(s===qo||s===Ko||s===Wo)return hs;if(o===Yo&&-1!==[Yo,ts,is,rs].indexOf(s))return us;if(!(o!==is&&o!==ts||s!==ts&&s!==es))return us;if((o===rs||o===es)&&s===es)return us;if(s===ns||s===Xo)return us;if(s===Jo)return us;if(o===Zo)return us;if(o===ns&&s===os){for(;n===Xo;)n=e[--r];if(n===os)return us}if(o===ss&&s===ss){for(var a=0;n===ss;)a++,n=e[--r];if(a%2==0)return us}return hs},fs=function(t){var e=as(t),i=e.length,r=0,n=0,o=e.map(ds);return{next:function(){if(r>=i)return{done:!0,value:null};for(var t=us;r<i&&(t=ps(e,o,++r))===us;);if(t!==us||r===i){var s=ls.apply(null,e.slice(n,r));return n=r,{value:s,done:!1}}return{done:!0,value:null}}}},As=function(t){for(var e,i=fs(t),r=[];!(e=i.next()).done;)e.value&&r.push(e.value.slice());return r},ms=function(t){var e=123;if(t.createRange){var i=t.createRange();if(i.getBoundingClientRect){var r=t.createElement("boundtest");r.style.height=e+"px",r.style.display="block",t.body.appendChild(r),i.selectNode(r);var n=i.getBoundingClientRect(),o=Math.round(n.height);if(t.body.removeChild(r),o===e)return!0}}return!1},gs=function(t){var e=t.createElement("boundtest");e.style.width="50px",e.style.display="block",e.style.fontSize="12px",e.style.letterSpacing="0px",e.style.wordSpacing="0px",t.body.appendChild(e);var i=t.createRange();e.innerHTML="function"==typeof"".repeat?"&#128104;".repeat(10):"";var r=e.firstChild,n=c(r.data).map((function(t){return u(t)})),o=0,s={},a=n.every((function(t,e){i.setStart(r,o),i.setEnd(r,o+t.length);var n=i.getBoundingClientRect();o+=t.length;var a=n.x>s.x||n.y>s.y;return s=n,0===e||a}));return t.body.removeChild(e),a},_s=function(){return void 0!==(new Image).crossOrigin},ys=function(){return"string"==typeof(new XMLHttpRequest).responseType},vs=function(t){var e=new Image,i=t.createElement("canvas"),r=i.getContext("2d");if(!r)return!1;e.src="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg'></svg>";try{r.drawImage(e,0,0),i.toDataURL()}catch(t){return!1}return!0},xs=function(t){return 0===t[0]&&255===t[1]&&0===t[2]&&255===t[3]},bs=function(t){var e=t.createElement("canvas"),i=100;e.width=i,e.height=i;var r=e.getContext("2d");if(!r)return Promise.reject(!1);r.fillStyle="rgb(0, 255, 0)",r.fillRect(0,0,i,i);var n=new Image,o=e.toDataURL();n.src=o;var s=ws(i,i,0,0,n);return r.fillStyle="red",r.fillRect(0,0,i,i),Ts(s).then((function(e){r.drawImage(e,0,0);var n=r.getImageData(0,0,i,i).data;r.fillStyle="red",r.fillRect(0,0,i,i);var s=t.createElement("div");return s.style.backgroundImage="url("+o+")",s.style.height=i+"px",xs(n)?Ts(ws(i,i,0,0,s)):Promise.reject(!1)})).then((function(t){return r.drawImage(t,0,0),xs(r.getImageData(0,0,i,i).data)})).catch((function(){return!1}))},ws=function(t,e,i,r,n){var o="http://www.w3.org/2000/svg",s=document.createElementNS(o,"svg"),a=document.createElementNS(o,"foreignObject");return s.setAttributeNS(null,"width",t.toString()),s.setAttributeNS(null,"height",e.toString()),a.setAttributeNS(null,"width","100%"),a.setAttributeNS(null,"height","100%"),a.setAttributeNS(null,"x",i.toString()),a.setAttributeNS(null,"y",r.toString()),a.setAttributeNS(null,"externalResourcesRequired","true"),s.appendChild(a),a.appendChild(n),s},Ts=function(t){return new Promise((function(e,i){var r=new Image;r.onload=function(){return e(r)},r.onerror=i,r.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent((new XMLSerializer).serializeToString(t))}))},Bs={get SUPPORT_RANGE_BOUNDS(){var t=ms(document);return Object.defineProperty(Bs,"SUPPORT_RANGE_BOUNDS",{value:t}),t},get SUPPORT_WORD_BREAKING(){var t=Bs.SUPPORT_RANGE_BOUNDS&&gs(document);return Object.defineProperty(Bs,"SUPPORT_WORD_BREAKING",{value:t}),t},get SUPPORT_SVG_DRAWING(){var t=vs(document);return Object.defineProperty(Bs,"SUPPORT_SVG_DRAWING",{value:t}),t},get SUPPORT_FOREIGNOBJECT_DRAWING(){var t="function"==typeof Array.from&&"function"==typeof window.fetch?bs(document):Promise.resolve(!1);return Object.defineProperty(Bs,"SUPPORT_FOREIGNOBJECT_DRAWING",{value:t}),t},get SUPPORT_CORS_IMAGES(){var t=_s();return Object.defineProperty(Bs,"SUPPORT_CORS_IMAGES",{value:t}),t},get SUPPORT_RESPONSE_TYPE(){var t=ys();return Object.defineProperty(Bs,"SUPPORT_RESPONSE_TYPE",{value:t}),t},get SUPPORT_CORS_XHR(){var t="withCredentials"in new XMLHttpRequest;return Object.defineProperty(Bs,"SUPPORT_CORS_XHR",{value:t}),t},get SUPPORT_NATIVE_TEXT_SEGMENTATION(){var t=!("undefined"==typeof Intl||!Intl.Segmenter);return Object.defineProperty(Bs,"SUPPORT_NATIVE_TEXT_SEGMENTATION",{value:t}),t}},Es=function(){function t(t,e){this.text=t,this.bounds=e}return t}(),Cs=function(t,e,i,r){var n=Ps(e,i),o=[],a=0;return n.forEach((function(e){if(i.textDecorationLine.length||e.trim().length>0)if(Bs.SUPPORT_RANGE_BOUNDS){var n=Is(r,a,e.length).getClientRects();if(n.length>1){var l=Ms(e),c=0;l.forEach((function(e){o.push(new Es(e,s.fromDOMRectList(t,Is(r,c+a,e.length).getClientRects()))),c+=e.length}))}else o.push(new Es(e,s.fromDOMRectList(t,n)))}else{var u=r.splitText(e.length);o.push(new Es(e,Ss(t,r))),r=u}else Bs.SUPPORT_RANGE_BOUNDS||(r=r.splitText(e.length));a+=e.length})),o},Ss=function(t,e){var i=e.ownerDocument;if(i){var r=i.createElement("html2canvaswrapper");r.appendChild(e.cloneNode(!0));var n=e.parentNode;if(n){n.replaceChild(r,e);var o=a(t,r);return r.firstChild&&n.replaceChild(r.firstChild,r),o}}return s.EMPTY},Is=function(t,e,i){var r=t.ownerDocument;if(!r)throw new Error("Node has no owner document");var n=r.createRange();return n.setStart(t,e),n.setEnd(t,e+i),n},Ms=function(t){if(Bs.SUPPORT_NATIVE_TEXT_SEGMENTATION){var e=new Intl.Segmenter(void 0,{granularity:"grapheme"});return Array.from(e.segment(t)).map((function(t){return t.segment}))}return As(t)},ks=function(t,e){if(Bs.SUPPORT_NATIVE_TEXT_SEGMENTATION){var i=new Intl.Segmenter(void 0,{granularity:"word"});return Array.from(i.segment(t)).map((function(t){return t.segment}))}return zs(t,e)},Ps=function(t,e){return 0!==e.letterSpacing?Ms(t):ks(t,e)},Ls=[32,160,4961,65792,65793,4153,4241],zs=function(t,e){for(var i,r=Vt(t,{lineBreak:e.lineBreak,wordBreak:"break-word"===e.overflowWrap?"break-word":e.wordBreak}),n=[],o=function(){if(i.value){var t=i.value.slice(),e=c(t),r="";e.forEach((function(t){-1===Ls.indexOf(t)?r+=u(t):(r.length&&n.push(r),n.push(u(t)),r="")})),r.length&&n.push(r)}};!(i=r.next()).done;)o();return n},Fs=function(){function t(t,e,i){this.text=Ds(e.data,i.textTransform),this.textBounds=Cs(t,this.text,i,e)}return t}(),Ds=function(t,e){switch(e){case 1:return t.toLowerCase();case 3:return t.replace(Rs,Us);case 2:return t.toUpperCase();default:return t}},Rs=/(^|\s|:|-|\(|\))([a-z])/g,Us=function(t,e,i){return t.length>0?e+i.toUpperCase():t},Os=function(t){function i(e,i){var r=t.call(this,e,i)||this;return r.src=i.currentSrc||i.src,r.intrinsicWidth=i.naturalWidth,r.intrinsicHeight=i.naturalHeight,r.context.cache.addImage(r.src),r}return e(i,t),i}(wo),Ns=function(t){function i(e,i){var r=t.call(this,e,i)||this;return r.canvas=i,r.intrinsicWidth=i.width,r.intrinsicHeight=i.height,r}return e(i,t),i}(wo),Qs=function(t){function i(e,i){var r=t.call(this,e,i)||this,n=new XMLSerializer,o=a(e,i);return i.setAttribute("width",o.width+"px"),i.setAttribute("height",o.height+"px"),r.svg="data:image/svg+xml,"+encodeURIComponent(n.serializeToString(i)),r.intrinsicWidth=i.width.baseVal.value,r.intrinsicHeight=i.height.baseVal.value,r.context.cache.addImage(r.svg),r}return e(i,t),i}(wo),Vs=function(t){function i(e,i){var r=t.call(this,e,i)||this;return r.value=i.value,r}return e(i,t),i}(wo),js=function(t){function i(e,i){var r=t.call(this,e,i)||this;return r.start=i.start,r.reversed="boolean"==typeof i.reversed&&!0===i.reversed,r}return e(i,t),i}(wo),Hs=[{type:15,flags:0,unit:"px",number:3}],Gs=[{type:16,flags:0,number:50}],$s=function(t){return t.width>t.height?new s(t.left+(t.width-t.height)/2,t.top,t.height,t.height):t.width<t.height?new s(t.left,t.top+(t.height-t.width)/2,t.width,t.width):t},Zs=function(t){var e=t.type===Ws?new Array(t.value.length+1).join(""):t.value;return 0===e.length?t.placeholder||"":e},qs="checkbox",Ks="radio",Ws="password",Xs=707406591,Js=function(t){function i(e,i){var r=t.call(this,e,i)||this;switch(r.type=i.type.toLowerCase(),r.checked=i.checked,r.value=Zs(i),r.type!==qs&&r.type!==Ks||(r.styles.backgroundColor=3739148031,r.styles.borderTopColor=r.styles.borderRightColor=r.styles.borderBottomColor=r.styles.borderLeftColor=2779096575,r.styles.borderTopWidth=r.styles.borderRightWidth=r.styles.borderBottomWidth=r.styles.borderLeftWidth=1,r.styles.borderTopStyle=r.styles.borderRightStyle=r.styles.borderBottomStyle=r.styles.borderLeftStyle=1,r.styles.backgroundClip=[0],r.styles.backgroundOrigin=[0],r.bounds=$s(r.bounds)),r.type){case qs:r.styles.borderTopRightRadius=r.styles.borderTopLeftRadius=r.styles.borderBottomRightRadius=r.styles.borderBottomLeftRadius=Hs;break;case Ks:r.styles.borderTopRightRadius=r.styles.borderTopLeftRadius=r.styles.borderBottomRightRadius=r.styles.borderBottomLeftRadius=Gs}return r}return e(i,t),i}(wo),Ys=function(t){function i(e,i){var r=t.call(this,e,i)||this,n=i.options[i.selectedIndex||0];return r.value=n&&n.text||"",r}return e(i,t),i}(wo),ta=function(t){function i(e,i){var r=t.call(this,e,i)||this;return r.value=i.value,r}return e(i,t),i}(wo),ea=function(t){function i(e,i){var r=t.call(this,e,i)||this;r.src=i.src,r.width=parseInt(i.width,10)||0,r.height=parseInt(i.height,10)||0,r.backgroundColor=r.styles.backgroundColor;try{if(i.contentWindow&&i.contentWindow.document&&i.contentWindow.document.documentElement){r.tree=oa(e,i.contentWindow.document.documentElement);var n=i.contentWindow.document.documentElement?ur(e,getComputedStyle(i.contentWindow.document.documentElement).backgroundColor):hr.TRANSPARENT,o=i.contentWindow.document.body?ur(e,getComputedStyle(i.contentWindow.document.body).backgroundColor):hr.TRANSPARENT;r.backgroundColor=ir(n)?ir(o)?r.styles.backgroundColor:o:n}}catch(t){}return r}return e(i,t),i}(wo),ia=["OL","UL","MENU"],ra=function(t,e,i,r){for(var n=e.firstChild,o=void 0;n;n=o)if(o=n.nextSibling,la(n)&&n.data.trim().length>0)i.textNodes.push(new Fs(t,n,i.styles));else if(ca(n))if(Ea(n)&&n.assignedNodes)n.assignedNodes().forEach((function(e){return ra(t,e,i,r)}));else{var s=na(t,n);s.styles.isVisible()&&(sa(n,s,r)?s.flags|=4:aa(s.styles)&&(s.flags|=2),-1!==ia.indexOf(n.tagName)&&(s.flags|=8),i.elements.push(s),n.slot,n.shadowRoot?ra(t,n.shadowRoot,s,r):Ta(n)||ma(n)||Ba(n)||ra(t,n,s,r))}},na=function(t,e){return va(e)?new Os(t,e):_a(e)?new Ns(t,e):ma(e)?new Qs(t,e):da(e)?new Vs(t,e):pa(e)?new js(t,e):fa(e)?new Js(t,e):Ba(e)?new Ys(t,e):Ta(e)?new ta(t,e):xa(e)?new ea(t,e):new wo(t,e)},oa=function(t,e){var i=na(t,e);return i.flags|=4,ra(t,e,i,i),i},sa=function(t,e,i){return e.styles.isPositionedWithZIndex()||e.styles.opacity<1||e.styles.isTransformed()||ga(t)&&i.styles.isTransparent()},aa=function(t){return t.isPositioned()||t.isFloating()},la=function(t){return t.nodeType===Node.TEXT_NODE},ca=function(t){return t.nodeType===Node.ELEMENT_NODE},ua=function(t){return ca(t)&&void 0!==t.style&&!ha(t)},ha=function(t){return"object"==typeof t.className},da=function(t){return"LI"===t.tagName},pa=function(t){return"OL"===t.tagName},fa=function(t){return"INPUT"===t.tagName},Aa=function(t){return"HTML"===t.tagName},ma=function(t){return"svg"===t.tagName},ga=function(t){return"BODY"===t.tagName},_a=function(t){return"CANVAS"===t.tagName},ya=function(t){return"VIDEO"===t.tagName},va=function(t){return"IMG"===t.tagName},xa=function(t){return"IFRAME"===t.tagName},ba=function(t){return"STYLE"===t.tagName},wa=function(t){return"SCRIPT"===t.tagName},Ta=function(t){return"TEXTAREA"===t.tagName},Ba=function(t){return"SELECT"===t.tagName},Ea=function(t){return"SLOT"===t.tagName},Ca=function(t){return t.tagName.indexOf("-")>0},Sa=function(){function t(){this.counters={}}return t.prototype.getCounterValue=function(t){var e=this.counters[t];return e&&e.length?e[e.length-1]:1},t.prototype.getCounterValues=function(t){var e=this.counters[t];return e||[]},t.prototype.pop=function(t){var e=this;t.forEach((function(t){return e.counters[t].pop()}))},t.prototype.parse=function(t){var e=this,i=t.counterIncrement,r=t.counterReset,n=!0;null!==i&&i.forEach((function(t){var i=e.counters[t.counter];i&&0!==t.increment&&(n=!1,i.length||i.push(1),i[Math.max(0,i.length-1)]+=t.increment)}));var o=[];return n&&r.forEach((function(t){var i=e.counters[t.counter];o.push(t.counter),i||(i=e.counters[t.counter]=[]),i.push(t.reset)})),o},t}(),Ia={integers:[1e3,900,500,400,100,90,50,40,10,9,5,4,1],values:["M","CM","D","CD","C","XC","L","XL","X","IX","V","IV","I"]},Ma={integers:[9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,900,800,700,600,500,400,300,200,100,90,80,70,60,50,40,30,20,10,9,8,7,6,5,4,3,2,1],values:["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]},ka={integers:[1e4,9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,400,300,200,100,90,80,70,60,50,40,30,20,19,18,17,16,15,10,9,8,7,6,5,4,3,2,1],values:["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]},Pa={integers:[1e4,9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,900,800,700,600,500,400,300,200,100,90,80,70,60,50,40,30,20,10,9,8,7,6,5,4,3,2,1],values:["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]},La=function(t,e,i,r,n,o){return t<e||t>i?$a(t,n,o.length>0):r.integers.reduce((function(e,i,n){for(;t>=i;)t-=i,e+=r.values[n];return e}),"")+o},za=function(t,e,i,r){var n="";do{i||t--,n=r(t)+n,t/=e}while(t*e>=e);return n},Fa=function(t,e,i,r,n){var o=i-e+1;return(t<0?"-":"")+(za(Math.abs(t),o,r,(function(t){return u(Math.floor(t%o)+e)}))+n)},Da=function(t,e,i){void 0===i&&(i=". ");var r=e.length;return za(Math.abs(t),r,!1,(function(t){return e[Math.floor(t%r)]}))+i},Ra=1,Ua=2,Oa=4,Na=8,Qa=function(t,e,i,r,n,o){if(t<-9999||t>9999)return $a(t,4,n.length>0);var s=Math.abs(t),a=n;if(0===s)return e[0]+a;for(var l=0;s>0&&l<=4;l++){var c=s%10;0===c&&no(o,Ra)&&""!==a?a=e[c]+a:c>1||1===c&&0===l||1===c&&1===l&&no(o,Ua)||1===c&&1===l&&no(o,Oa)&&t>100||1===c&&l>1&&no(o,Na)?a=e[c]+(l>0?i[l-1]:"")+a:1===c&&l>0&&(a=i[l-1]+a),s=Math.floor(s/10)}return(t<0?r:"")+a},Va="",ja="",Ha="",Ga="",$a=function(t,e,i){var r=i?". ":"",n=i?"":"",o=i?", ":"",s=i?" ":"";switch(e){case 0:return""+s;case 1:return""+s;case 2:return""+s;case 5:var a=Fa(t,48,57,!0,r);return a.length<4?"0"+a:a;case 4:return Da(t,"",n);case 6:return La(t,1,3999,Ia,3,r).toLowerCase();case 7:return La(t,1,3999,Ia,3,r);case 8:return Fa(t,945,969,!1,r);case 9:return Fa(t,97,122,!1,r);case 10:return Fa(t,65,90,!1,r);case 11:return Fa(t,1632,1641,!0,r);case 12:case 49:return La(t,1,9999,Ma,3,r);case 35:return La(t,1,9999,Ma,3,r).toLowerCase();case 13:return Fa(t,2534,2543,!0,r);case 14:case 30:return Fa(t,6112,6121,!0,r);case 15:return Da(t,"",n);case 16:return Da(t,"",n);case 17:case 48:return Qa(t,"",Va,"",n,Ua|Oa|Na);case 47:return Qa(t,"",ja,"",n,Ra|Ua|Oa|Na);case 42:return Qa(t,"",Va,"",n,Ua|Oa|Na);case 41:return Qa(t,"",ja,"",n,Ra|Ua|Oa|Na);case 26:return Qa(t,"","",Ha,n,0);case 25:return Qa(t,"","",Ha,n,Ra|Ua|Oa);case 31:return Qa(t,"","",Ga,o,Ra|Ua|Oa);case 33:return Qa(t,"","",Ga,o,0);case 32:return Qa(t,"","",Ga,o,Ra|Ua|Oa);case 18:return Fa(t,2406,2415,!0,r);case 20:return La(t,1,19999,Pa,3,r);case 21:return Fa(t,2790,2799,!0,r);case 22:return Fa(t,2662,2671,!0,r);case 22:return La(t,1,10999,ka,3,r);case 23:return Da(t,"");case 24:return Da(t,"");case 27:return Fa(t,3302,3311,!0,r);case 28:return Da(t,"",n);case 29:return Da(t,"",n);case 34:return Fa(t,3792,3801,!0,r);case 37:return Fa(t,6160,6169,!0,r);case 38:return Fa(t,4160,4169,!0,r);case 39:return Fa(t,2918,2927,!0,r);case 40:return Fa(t,1776,1785,!0,r);case 43:return Fa(t,3046,3055,!0,r);case 44:return Fa(t,3174,3183,!0,r);case 45:return Fa(t,3664,3673,!0,r);case 46:return Fa(t,3872,3881,!0,r);default:return Fa(t,48,57,!0,r)}},Za="data-html2canvas-ignore",qa=function(){function t(t,e,i){if(this.context=t,this.options=i,this.scrolledElements=[],this.referenceElement=e,this.counters=new Sa,this.quoteDepth=0,!e.ownerDocument)throw new Error("Cloned element does not have an owner document");this.documentElement=this.cloneNode(e.ownerDocument.documentElement,!1)}return t.prototype.toIFrame=function(t,e){var i=this,o=Wa(t,e);if(!o.contentWindow)return Promise.reject("Unable to find iframe window");var s=t.defaultView.pageXOffset,a=t.defaultView.pageYOffset,l=o.contentWindow,c=l.document,u=Ya(o).then((function(){return r(i,void 0,void 0,(function(){var t,i;return n(this,(function(r){switch(r.label){case 0:return this.scrolledElements.forEach(nl),l&&(l.scrollTo(e.left,e.top),!/(iPad|iPhone|iPod)/g.test(navigator.userAgent)||l.scrollY===e.top&&l.scrollX===e.left||(this.context.logger.warn("Unable to restore scroll position for cloned document"),this.context.windowBounds=this.context.windowBounds.add(l.scrollX-e.left,l.scrollY-e.top,0,0))),t=this.options.onclone,void 0===(i=this.clonedReferenceElement)?[2,Promise.reject("Error finding the "+this.referenceElement.nodeName+" in the cloned document")]:c.fonts&&c.fonts.ready?[4,c.fonts.ready]:[3,2];case 1:r.sent(),r.label=2;case 2:return/(AppleWebKit)/g.test(navigator.userAgent)?[4,Ja(c)]:[3,4];case 3:r.sent(),r.label=4;case 4:return"function"==typeof t?[2,Promise.resolve().then((function(){return t(c,i)})).then((function(){return o}))]:[2,o]}}))}))}));return c.open(),c.write(il(document.doctype)+"<html></html>"),rl(this.referenceElement.ownerDocument,s,a),c.replaceChild(c.adoptNode(this.documentElement),c.documentElement),c.close(),u},t.prototype.createElementClone=function(t){if(bo(t,2),_a(t))return this.createCanvasClone(t);if(ya(t))return this.createVideoClone(t);if(ba(t))return this.createStyleClone(t);var e=t.cloneNode(!1);return va(e)&&(va(t)&&t.currentSrc&&t.currentSrc!==t.src&&(e.src=t.currentSrc,e.srcset=""),"lazy"===e.loading&&(e.loading="eager")),Ca(e)?this.createCustomElementClone(e):e},t.prototype.createCustomElementClone=function(t){var e=document.createElement("html2canvascustomelement");return el(t.style,e),e},t.prototype.createStyleClone=function(t){try{var e=t.sheet;if(e&&e.cssRules){var i=[].slice.call(e.cssRules,0).reduce((function(t,e){return e&&"string"==typeof e.cssText?t+e.cssText:t}),""),r=t.cloneNode(!1);return r.textContent=i,r}}catch(t){if(this.context.logger.error("Unable to access cssRules property",t),"SecurityError"!==t.name)throw t}return t.cloneNode(!1)},t.prototype.createCanvasClone=function(t){var e;if(this.options.inlineImages&&t.ownerDocument){var i=t.ownerDocument.createElement("img");try{return i.src=t.toDataURL(),i}catch(e){this.context.logger.info("Unable to inline canvas contents, canvas is tainted",t)}}var r=t.cloneNode(!1);try{r.width=t.width,r.height=t.height;var n=t.getContext("2d"),o=r.getContext("2d");if(o)if(!this.options.allowTaint&&n)o.putImageData(n.getImageData(0,0,t.width,t.height),0,0);else{var s=null!==(e=t.getContext("webgl2"))&&void 0!==e?e:t.getContext("webgl");if(s){var a=s.getContextAttributes();!1===(null==a?void 0:a.preserveDrawingBuffer)&&this.context.logger.warn("Unable to clone WebGL context as it has preserveDrawingBuffer=false",t)}o.drawImage(t,0,0)}return r}catch(e){this.context.logger.info("Unable to clone canvas as it is tainted",t)}return r},t.prototype.createVideoClone=function(t){var e=t.ownerDocument.createElement("canvas");e.width=t.offsetWidth,e.height=t.offsetHeight;var i=e.getContext("2d");try{return i&&(i.drawImage(t,0,0,e.width,e.height),this.options.allowTaint||i.getImageData(0,0,e.width,e.height)),e}catch(e){this.context.logger.info("Unable to clone video as it is tainted",t)}var r=t.ownerDocument.createElement("canvas");return r.width=t.offsetWidth,r.height=t.offsetHeight,r},t.prototype.appendChildNode=function(t,e,i){ca(e)&&(wa(e)||e.hasAttribute(Za)||"function"==typeof this.options.ignoreElements&&this.options.ignoreElements(e))||this.options.copyStyles&&ca(e)&&ba(e)||t.appendChild(this.cloneNode(e,i))},t.prototype.cloneChildNodes=function(t,e,i){for(var r=this,n=t.shadowRoot?t.shadowRoot.firstChild:t.firstChild;n;n=n.nextSibling)if(ca(n)&&Ea(n)&&"function"==typeof n.assignedNodes){var o=n.assignedNodes();o.length&&o.forEach((function(t){return r.appendChildNode(e,t,i)}))}else this.appendChildNode(e,n,i)},t.prototype.cloneNode=function(t,e){if(la(t))return document.createTextNode(t.data);if(!t.ownerDocument)return t.cloneNode(!1);var i=t.ownerDocument.defaultView;if(i&&ca(t)&&(ua(t)||ha(t))){var r=this.createElementClone(t);r.style.transitionProperty="none";var n=i.getComputedStyle(t),o=i.getComputedStyle(t,":before"),s=i.getComputedStyle(t,":after");this.referenceElement===t&&ua(r)&&(this.clonedReferenceElement=r),ga(r)&&ul(r);var a=this.counters.parse(new _o(this.context,n)),l=this.resolvePseudoContent(t,r,o,$o.BEFORE);Ca(t)&&(e=!0),ya(t)||this.cloneChildNodes(t,r,e),l&&r.insertBefore(l,r.firstChild);var c=this.resolvePseudoContent(t,r,s,$o.AFTER);return c&&r.appendChild(c),this.counters.pop(a),(n&&(this.options.copyStyles||ha(t))&&!xa(t)||e)&&el(n,r),0===t.scrollTop&&0===t.scrollLeft||this.scrolledElements.push([r,t.scrollLeft,t.scrollTop]),(Ta(t)||Ba(t))&&(Ta(r)||Ba(r))&&(r.value=t.value),r}return t.cloneNode(!1)},t.prototype.resolvePseudoContent=function(t,e,i,r){var n=this;if(i){var o=i.content,s=e.ownerDocument;if(s&&o&&"none"!==o&&"-moz-alt-content"!==o&&"none"!==i.display){this.counters.parse(new _o(this.context,i));var a=new go(this.context,i),l=s.createElement("html2canvaspseudoelement");el(i,l),a.content.forEach((function(e){if(0===e.type)l.appendChild(s.createTextNode(e.value));else if(22===e.type){var i=s.createElement("img");i.src=e.value,i.style.opacity="1",l.appendChild(i)}else if(18===e.type){if("attr"===e.name){var r=e.values.filter(Pi);r.length&&l.appendChild(s.createTextNode(t.getAttribute(r[0].value)||""))}else if("counter"===e.name){var o=e.values.filter(Di),c=o[0],u=o[1];if(c&&Pi(c)){var h=n.counters.getCounterValue(c.value),d=u&&Pi(u)?Tn.parse(n.context,u.value):3;l.appendChild(s.createTextNode($a(h,d,!1)))}}else if("counters"===e.name){var p=e.values.filter(Di),f=(c=p[0],p[1]);if(u=p[2],c&&Pi(c)){var A=n.counters.getCounterValues(c.value),m=u&&Pi(u)?Tn.parse(n.context,u.value):3,g=f&&0===f.type?f.value:"",_=A.map((function(t){return $a(t,m,!1)})).join(g);l.appendChild(s.createTextNode(_))}}}else if(20===e.type)switch(e.value){case"open-quote":l.appendChild(s.createTextNode(uo(a.quotes,n.quoteDepth++,!0)));break;case"close-quote":l.appendChild(s.createTextNode(uo(a.quotes,--n.quoteDepth,!1)));break;default:l.appendChild(s.createTextNode(e.value))}})),l.className=al+" "+ll;var c=r===$o.BEFORE?" "+al:" "+ll;return ha(e)?e.className.baseValue+=c:e.className+=c,l}}},t.destroy=function(t){return!!t.parentNode&&(t.parentNode.removeChild(t),!0)},t}();!function(t){t[t.BEFORE=0]="BEFORE",t[t.AFTER=1]="AFTER"}($o||($o={}));var Ka,Wa=function(t,e){var i=t.createElement("iframe");return i.className="html2canvas-container",i.style.visibility="hidden",i.style.position="fixed",i.style.left="-10000px",i.style.top="0px",i.style.border="0",i.width=e.width.toString(),i.height=e.height.toString(),i.scrolling="no",i.setAttribute(Za,"true"),t.body.appendChild(i),i},Xa=function(t){return new Promise((function(e){t.complete?e():t.src?(t.onload=e,t.onerror=e):e()}))},Ja=function(t){return Promise.all([].slice.call(t.images,0).map(Xa))},Ya=function(t){return new Promise((function(e,i){var r=t.contentWindow;if(!r)return i("No window assigned for iframe");var n=r.document;r.onload=t.onload=function(){r.onload=t.onload=null;var i=setInterval((function(){n.body.childNodes.length>0&&"complete"===n.readyState&&(clearInterval(i),e(t))}),50)}}))},tl=["all","d","content"],el=function(t,e){for(var i=t.length-1;i>=0;i--){var r=t.item(i);-1===tl.indexOf(r)&&e.style.setProperty(r,t.getPropertyValue(r))}return e},il=function(t){var e="";return t&&(e+="<!DOCTYPE ",t.name&&(e+=t.name),t.internalSubset&&(e+=t.internalSubset),t.publicId&&(e+='"'+t.publicId+'"'),t.systemId&&(e+='"'+t.systemId+'"'),e+=">"),e},rl=function(t,e,i){t&&t.defaultView&&(e!==t.defaultView.pageXOffset||i!==t.defaultView.pageYOffset)&&t.defaultView.scrollTo(e,i)},nl=function(t){var e=t[0],i=t[1],r=t[2];e.scrollLeft=i,e.scrollTop=r},ol=":before",sl=":after",al="___html2canvas___pseudoelement_before",ll="___html2canvas___pseudoelement_after",cl='{\n    content: "" !important;\n    display: none !important;\n}',ul=function(t){hl(t,"."+al+ol+cl+"\n         ."+ll+sl+cl)},hl=function(t,e){var i=t.ownerDocument;if(i){var r=i.createElement("style");r.textContent=e,t.appendChild(r)}},dl=function(){function t(){}return t.getOrigin=function(e){var i=t._link;return i?(i.href=e,i.href=i.href,i.protocol+i.hostname+i.port):"about:blank"},t.isSameOrigin=function(e){return t.getOrigin(e)===t._origin},t.setContext=function(e){t._link=e.document.createElement("a"),t._origin=t.getOrigin(e.location.href)},t._origin="about:blank",t}(),pl=function(){function t(t,e){this.context=t,this._options=e,this._cache={}}return t.prototype.addImage=function(t){var e=Promise.resolve();return this.has(t)?e:vl(t)||gl(t)?((this._cache[t]=this.loadImage(t)).catch((function(){})),e):e},t.prototype.match=function(t){return this._cache[t]},t.prototype.loadImage=function(t){return r(this,void 0,void 0,(function(){var e,i,r,o,s=this;return n(this,(function(n){switch(n.label){case 0:return e=dl.isSameOrigin(t),i=!_l(t)&&!0===this._options.useCORS&&Bs.SUPPORT_CORS_IMAGES&&!e,r=!_l(t)&&!e&&!vl(t)&&"string"==typeof this._options.proxy&&Bs.SUPPORT_CORS_XHR&&!i,e||!1!==this._options.allowTaint||_l(t)||vl(t)||r||i?(o=t,r?[4,this.proxy(o)]:[3,2]):[2];case 1:o=n.sent(),n.label=2;case 2:return this.context.logger.debug("Added image "+t.substring(0,256)),[4,new Promise((function(t,e){var r=new Image;r.onload=function(){return t(r)},r.onerror=e,(yl(o)||i)&&(r.crossOrigin="anonymous"),r.src=o,!0===r.complete&&setTimeout((function(){return t(r)}),500),s._options.imageTimeout>0&&setTimeout((function(){return e("Timed out ("+s._options.imageTimeout+"ms) loading image")}),s._options.imageTimeout)}))];case 3:return[2,n.sent()]}}))}))},t.prototype.has=function(t){return void 0!==this._cache[t]},t.prototype.keys=function(){return Promise.resolve(Object.keys(this._cache))},t.prototype.proxy=function(t){var e=this,i=this._options.proxy;if(!i)throw new Error("No proxy defined");var r=t.substring(0,256);return new Promise((function(n,o){var s=Bs.SUPPORT_RESPONSE_TYPE?"blob":"text",a=new XMLHttpRequest;a.onload=function(){if(200===a.status)if("text"===s)n(a.response);else{var t=new FileReader;t.addEventListener("load",(function(){return n(t.result)}),!1),t.addEventListener("error",(function(t){return o(t)}),!1),t.readAsDataURL(a.response)}else o("Failed to proxy resource "+r+" with status code "+a.status)},a.onerror=o;var l=i.indexOf("?")>-1?"&":"?";if(a.open("GET",""+i+l+"url="+encodeURIComponent(t)+"&responseType="+s),"text"!==s&&a instanceof XMLHttpRequest&&(a.responseType=s),e._options.imageTimeout){var c=e._options.imageTimeout;a.timeout=c,a.ontimeout=function(){return o("Timed out ("+c+"ms) proxying "+r)}}a.send()}))},t}(),fl=/^data:image\/svg\+xml/i,Al=/^data:image\/.*;base64,/i,ml=/^data:image\/.*/i,gl=function(t){return Bs.SUPPORT_SVG_DRAWING||!xl(t)},_l=function(t){return ml.test(t)},yl=function(t){return Al.test(t)},vl=function(t){return"blob"===t.substr(0,4)},xl=function(t){return"svg"===t.substr(-3).toLowerCase()||fl.test(t)},bl=function(){function t(t,e){this.type=0,this.x=t,this.y=e}return t.prototype.add=function(e,i){return new t(this.x+e,this.y+i)},t}(),wl=function(t,e,i){return new bl(t.x+(e.x-t.x)*i,t.y+(e.y-t.y)*i)},Tl=function(){function t(t,e,i,r){this.type=1,this.start=t,this.startControl=e,this.endControl=i,this.end=r}return t.prototype.subdivide=function(e,i){var r=wl(this.start,this.startControl,e),n=wl(this.startControl,this.endControl,e),o=wl(this.endControl,this.end,e),s=wl(r,n,e),a=wl(n,o,e),l=wl(s,a,e);return i?new t(this.start,r,s,l):new t(l,a,o,this.end)},t.prototype.add=function(e,i){return new t(this.start.add(e,i),this.startControl.add(e,i),this.endControl.add(e,i),this.end.add(e,i))},t.prototype.reverse=function(){return new t(this.end,this.endControl,this.startControl,this.start)},t}(),Bl=function(t){return 1===t.type},El=function(){function t(t){var e=t.styles,i=t.bounds,r=Gi(e.borderTopLeftRadius,i.width,i.height),n=r[0],o=r[1],s=Gi(e.borderTopRightRadius,i.width,i.height),a=s[0],l=s[1],c=Gi(e.borderBottomRightRadius,i.width,i.height),u=c[0],h=c[1],d=Gi(e.borderBottomLeftRadius,i.width,i.height),p=d[0],f=d[1],A=[];A.push((n+a)/i.width),A.push((p+u)/i.width),A.push((o+f)/i.height),A.push((l+h)/i.height);var m=Math.max.apply(Math,A);m>1&&(n/=m,o/=m,a/=m,l/=m,u/=m,h/=m,p/=m,f/=m);var g=i.width-a,_=i.height-h,y=i.width-u,v=i.height-f,x=e.borderTopWidth,b=e.borderRightWidth,w=e.borderBottomWidth,T=e.borderLeftWidth,B=$i(e.paddingTop,t.bounds.width),E=$i(e.paddingRight,t.bounds.width),C=$i(e.paddingBottom,t.bounds.width),S=$i(e.paddingLeft,t.bounds.width);this.topLeftBorderDoubleOuterBox=n>0||o>0?Cl(i.left+T/3,i.top+x/3,n-T/3,o-x/3,Ka.TOP_LEFT):new bl(i.left+T/3,i.top+x/3),this.topRightBorderDoubleOuterBox=n>0||o>0?Cl(i.left+g,i.top+x/3,a-b/3,l-x/3,Ka.TOP_RIGHT):new bl(i.left+i.width-b/3,i.top+x/3),this.bottomRightBorderDoubleOuterBox=u>0||h>0?Cl(i.left+y,i.top+_,u-b/3,h-w/3,Ka.BOTTOM_RIGHT):new bl(i.left+i.width-b/3,i.top+i.height-w/3),this.bottomLeftBorderDoubleOuterBox=p>0||f>0?Cl(i.left+T/3,i.top+v,p-T/3,f-w/3,Ka.BOTTOM_LEFT):new bl(i.left+T/3,i.top+i.height-w/3),this.topLeftBorderDoubleInnerBox=n>0||o>0?Cl(i.left+2*T/3,i.top+2*x/3,n-2*T/3,o-2*x/3,Ka.TOP_LEFT):new bl(i.left+2*T/3,i.top+2*x/3),this.topRightBorderDoubleInnerBox=n>0||o>0?Cl(i.left+g,i.top+2*x/3,a-2*b/3,l-2*x/3,Ka.TOP_RIGHT):new bl(i.left+i.width-2*b/3,i.top+2*x/3),this.bottomRightBorderDoubleInnerBox=u>0||h>0?Cl(i.left+y,i.top+_,u-2*b/3,h-2*w/3,Ka.BOTTOM_RIGHT):new bl(i.left+i.width-2*b/3,i.top+i.height-2*w/3),this.bottomLeftBorderDoubleInnerBox=p>0||f>0?Cl(i.left+2*T/3,i.top+v,p-2*T/3,f-2*w/3,Ka.BOTTOM_LEFT):new bl(i.left+2*T/3,i.top+i.height-2*w/3),this.topLeftBorderStroke=n>0||o>0?Cl(i.left+T/2,i.top+x/2,n-T/2,o-x/2,Ka.TOP_LEFT):new bl(i.left+T/2,i.top+x/2),this.topRightBorderStroke=n>0||o>0?Cl(i.left+g,i.top+x/2,a-b/2,l-x/2,Ka.TOP_RIGHT):new bl(i.left+i.width-b/2,i.top+x/2),this.bottomRightBorderStroke=u>0||h>0?Cl(i.left+y,i.top+_,u-b/2,h-w/2,Ka.BOTTOM_RIGHT):new bl(i.left+i.width-b/2,i.top+i.height-w/2),this.bottomLeftBorderStroke=p>0||f>0?Cl(i.left+T/2,i.top+v,p-T/2,f-w/2,Ka.BOTTOM_LEFT):new bl(i.left+T/2,i.top+i.height-w/2),this.topLeftBorderBox=n>0||o>0?Cl(i.left,i.top,n,o,Ka.TOP_LEFT):new bl(i.left,i.top),this.topRightBorderBox=a>0||l>0?Cl(i.left+g,i.top,a,l,Ka.TOP_RIGHT):new bl(i.left+i.width,i.top),this.bottomRightBorderBox=u>0||h>0?Cl(i.left+y,i.top+_,u,h,Ka.BOTTOM_RIGHT):new bl(i.left+i.width,i.top+i.height),this.bottomLeftBorderBox=p>0||f>0?Cl(i.left,i.top+v,p,f,Ka.BOTTOM_LEFT):new bl(i.left,i.top+i.height),this.topLeftPaddingBox=n>0||o>0?Cl(i.left+T,i.top+x,Math.max(0,n-T),Math.max(0,o-x),Ka.TOP_LEFT):new bl(i.left+T,i.top+x),this.topRightPaddingBox=a>0||l>0?Cl(i.left+Math.min(g,i.width-b),i.top+x,g>i.width+b?0:Math.max(0,a-b),Math.max(0,l-x),Ka.TOP_RIGHT):new bl(i.left+i.width-b,i.top+x),this.bottomRightPaddingBox=u>0||h>0?Cl(i.left+Math.min(y,i.width-T),i.top+Math.min(_,i.height-w),Math.max(0,u-b),Math.max(0,h-w),Ka.BOTTOM_RIGHT):new bl(i.left+i.width-b,i.top+i.height-w),this.bottomLeftPaddingBox=p>0||f>0?Cl(i.left+T,i.top+Math.min(v,i.height-w),Math.max(0,p-T),Math.max(0,f-w),Ka.BOTTOM_LEFT):new bl(i.left+T,i.top+i.height-w),this.topLeftContentBox=n>0||o>0?Cl(i.left+T+S,i.top+x+B,Math.max(0,n-(T+S)),Math.max(0,o-(x+B)),Ka.TOP_LEFT):new bl(i.left+T+S,i.top+x+B),this.topRightContentBox=a>0||l>0?Cl(i.left+Math.min(g,i.width+T+S),i.top+x+B,g>i.width+T+S?0:a-T+S,l-(x+B),Ka.TOP_RIGHT):new bl(i.left+i.width-(b+E),i.top+x+B),this.bottomRightContentBox=u>0||h>0?Cl(i.left+Math.min(y,i.width-(T+S)),i.top+Math.min(_,i.height+x+B),Math.max(0,u-(b+E)),h-(w+C),Ka.BOTTOM_RIGHT):new bl(i.left+i.width-(b+E),i.top+i.height-(w+C)),this.bottomLeftContentBox=p>0||f>0?Cl(i.left+T+S,i.top+v,Math.max(0,p-(T+S)),f-(w+C),Ka.BOTTOM_LEFT):new bl(i.left+T+S,i.top+i.height-(w+C))}return t}();!function(t){t[t.TOP_LEFT=0]="TOP_LEFT",t[t.TOP_RIGHT=1]="TOP_RIGHT",t[t.BOTTOM_RIGHT=2]="BOTTOM_RIGHT",t[t.BOTTOM_LEFT=3]="BOTTOM_LEFT"}(Ka||(Ka={}));var Cl=function(t,e,i,r,n){var o=(Math.sqrt(2)-1)/3*4,s=i*o,a=r*o,l=t+i,c=e+r;switch(n){case Ka.TOP_LEFT:return new Tl(new bl(t,c),new bl(t,c-a),new bl(l-s,e),new bl(l,e));case Ka.TOP_RIGHT:return new Tl(new bl(t,e),new bl(t+s,e),new bl(l,c-a),new bl(l,c));case Ka.BOTTOM_RIGHT:return new Tl(new bl(l,e),new bl(l,e+a),new bl(t+s,c),new bl(t,c));case Ka.BOTTOM_LEFT:default:return new Tl(new bl(l,c),new bl(l-s,c),new bl(t,e+a),new bl(t,e))}},Sl=function(t){return[t.topLeftBorderBox,t.topRightBorderBox,t.bottomRightBorderBox,t.bottomLeftBorderBox]},Il=function(t){return[t.topLeftContentBox,t.topRightContentBox,t.bottomRightContentBox,t.bottomLeftContentBox]},Ml=function(t){return[t.topLeftPaddingBox,t.topRightPaddingBox,t.bottomRightPaddingBox,t.bottomLeftPaddingBox]},kl=function(){function t(t,e,i){this.offsetX=t,this.offsetY=e,this.matrix=i,this.type=0,this.target=6}return t}(),Pl=function(){function t(t,e){this.path=t,this.target=e,this.type=1}return t}(),Ll=function(){function t(t){this.opacity=t,this.type=2,this.target=6}return t}(),zl=function(t){return 0===t.type},Fl=function(t){return 1===t.type},Dl=function(t){return 2===t.type},Rl=function(t,e){return t.length===e.length&&t.some((function(t,i){return t===e[i]}))},Ul=function(t,e,i,r,n){return t.map((function(t,o){switch(o){case 0:return t.add(e,i);case 1:return t.add(e+r,i);case 2:return t.add(e+r,i+n);case 3:return t.add(e,i+n)}return t}))},Ol=function(){function t(t){this.element=t,this.inlineLevel=[],this.nonInlineLevel=[],this.negativeZIndex=[],this.zeroOrAutoZIndexOrTransformedOrOpacity=[],this.positiveZIndex=[],this.nonPositionedFloats=[],this.nonPositionedInlineLevel=[]}return t}(),Nl=function(){function t(t,e){if(this.container=t,this.parent=e,this.effects=[],this.curves=new El(this.container),this.container.styles.opacity<1&&this.effects.push(new Ll(this.container.styles.opacity)),null!==this.container.styles.transform){var i=this.container.bounds.left+this.container.styles.transformOrigin[0].number,r=this.container.bounds.top+this.container.styles.transformOrigin[1].number,n=this.container.styles.transform;this.effects.push(new kl(i,r,n))}if(0!==this.container.styles.overflowX){var o=Sl(this.curves),s=Ml(this.curves);Rl(o,s)?this.effects.push(new Pl(o,6)):(this.effects.push(new Pl(o,2)),this.effects.push(new Pl(s,4)))}}return t.prototype.getEffects=function(t){for(var e=-1===[2,3].indexOf(this.container.styles.position),i=this.parent,r=this.effects.slice(0);i;){var n=i.effects.filter((function(t){return!Fl(t)}));if(e||0!==i.container.styles.position||!i.parent){if(r.unshift.apply(r,n),e=-1===[2,3].indexOf(i.container.styles.position),0!==i.container.styles.overflowX){var o=Sl(i.curves),s=Ml(i.curves);Rl(o,s)||r.unshift(new Pl(s,6))}}else r.unshift.apply(r,n);i=i.parent}return r.filter((function(e){return no(e.target,t)}))},t}(),Ql=function(t,e,i,r){t.container.elements.forEach((function(n){var o=no(n.flags,4),s=no(n.flags,2),a=new Nl(n,t);no(n.styles.display,2048)&&r.push(a);var l=no(n.flags,8)?[]:r;if(o||s){var c=o||n.styles.isPositioned()?i:e,u=new Ol(a);if(n.styles.isPositioned()||n.styles.opacity<1||n.styles.isTransformed()){var h=n.styles.zIndex.order;if(h<0){var d=0;c.negativeZIndex.some((function(t,e){return h>t.element.container.styles.zIndex.order?(d=e,!1):d>0})),c.negativeZIndex.splice(d,0,u)}else if(h>0){var p=0;c.positiveZIndex.some((function(t,e){return h>=t.element.container.styles.zIndex.order?(p=e+1,!1):p>0})),c.positiveZIndex.splice(p,0,u)}else c.zeroOrAutoZIndexOrTransformedOrOpacity.push(u)}else n.styles.isFloating()?c.nonPositionedFloats.push(u):c.nonPositionedInlineLevel.push(u);Ql(a,u,o?u:i,l)}else n.styles.isInlineLevel()?e.inlineLevel.push(a):e.nonInlineLevel.push(a),Ql(a,e,i,l);no(n.flags,8)&&Vl(n,l)}))},Vl=function(t,e){for(var i=t instanceof js?t.start:1,r=t instanceof js&&t.reversed,n=0;n<e.length;n++){var o=e[n];o.container instanceof Vs&&"number"==typeof o.container.value&&0!==o.container.value&&(i=o.container.value),o.listValue=$a(i,o.container.styles.listStyleType,!0),i+=r?-1:1}},jl=function(t){var e=new Nl(t,null),i=new Ol(e),r=[];return Ql(e,i,i,r),Vl(e.container,r),i},Hl=function(t,e){switch(e){case 0:return Kl(t.topLeftBorderBox,t.topLeftPaddingBox,t.topRightBorderBox,t.topRightPaddingBox);case 1:return Kl(t.topRightBorderBox,t.topRightPaddingBox,t.bottomRightBorderBox,t.bottomRightPaddingBox);case 2:return Kl(t.bottomRightBorderBox,t.bottomRightPaddingBox,t.bottomLeftBorderBox,t.bottomLeftPaddingBox);default:return Kl(t.bottomLeftBorderBox,t.bottomLeftPaddingBox,t.topLeftBorderBox,t.topLeftPaddingBox)}},Gl=function(t,e){switch(e){case 0:return Kl(t.topLeftBorderBox,t.topLeftBorderDoubleOuterBox,t.topRightBorderBox,t.topRightBorderDoubleOuterBox);case 1:return Kl(t.topRightBorderBox,t.topRightBorderDoubleOuterBox,t.bottomRightBorderBox,t.bottomRightBorderDoubleOuterBox);case 2:return Kl(t.bottomRightBorderBox,t.bottomRightBorderDoubleOuterBox,t.bottomLeftBorderBox,t.bottomLeftBorderDoubleOuterBox);default:return Kl(t.bottomLeftBorderBox,t.bottomLeftBorderDoubleOuterBox,t.topLeftBorderBox,t.topLeftBorderDoubleOuterBox)}},$l=function(t,e){switch(e){case 0:return Kl(t.topLeftBorderDoubleInnerBox,t.topLeftPaddingBox,t.topRightBorderDoubleInnerBox,t.topRightPaddingBox);case 1:return Kl(t.topRightBorderDoubleInnerBox,t.topRightPaddingBox,t.bottomRightBorderDoubleInnerBox,t.bottomRightPaddingBox);case 2:return Kl(t.bottomRightBorderDoubleInnerBox,t.bottomRightPaddingBox,t.bottomLeftBorderDoubleInnerBox,t.bottomLeftPaddingBox);default:return Kl(t.bottomLeftBorderDoubleInnerBox,t.bottomLeftPaddingBox,t.topLeftBorderDoubleInnerBox,t.topLeftPaddingBox)}},Zl=function(t,e){switch(e){case 0:return ql(t.topLeftBorderStroke,t.topRightBorderStroke);case 1:return ql(t.topRightBorderStroke,t.bottomRightBorderStroke);case 2:return ql(t.bottomRightBorderStroke,t.bottomLeftBorderStroke);default:return ql(t.bottomLeftBorderStroke,t.topLeftBorderStroke)}},ql=function(t,e){var i=[];return Bl(t)?i.push(t.subdivide(.5,!1)):i.push(t),Bl(e)?i.push(e.subdivide(.5,!0)):i.push(e),i},Kl=function(t,e,i,r){var n=[];return Bl(t)?n.push(t.subdivide(.5,!1)):n.push(t),Bl(i)?n.push(i.subdivide(.5,!0)):n.push(i),Bl(r)?n.push(r.subdivide(.5,!0).reverse()):n.push(r),Bl(e)?n.push(e.subdivide(.5,!1).reverse()):n.push(e),n},Wl=function(t){var e=t.bounds,i=t.styles;return e.add(i.borderLeftWidth,i.borderTopWidth,-(i.borderRightWidth+i.borderLeftWidth),-(i.borderTopWidth+i.borderBottomWidth))},Xl=function(t){var e=t.styles,i=t.bounds,r=$i(e.paddingLeft,i.width),n=$i(e.paddingRight,i.width),o=$i(e.paddingTop,i.width),s=$i(e.paddingBottom,i.width);return i.add(r+e.borderLeftWidth,o+e.borderTopWidth,-(e.borderRightWidth+e.borderLeftWidth+r+n),-(e.borderTopWidth+e.borderBottomWidth+o+s))},Jl=function(t,e){return 0===t?e.bounds:2===t?Xl(e):Wl(e)},Yl=function(t,e){return 0===t?e.bounds:2===t?Xl(e):Wl(e)},tc=function(t,e,i){var r=Jl(nc(t.styles.backgroundOrigin,e),t),n=Yl(nc(t.styles.backgroundClip,e),t),o=rc(nc(t.styles.backgroundSize,e),i,r),s=o[0],a=o[1],l=Gi(nc(t.styles.backgroundPosition,e),r.width-s,r.height-a);return[oc(nc(t.styles.backgroundRepeat,e),l,o,r,n),Math.round(r.left+l[0]),Math.round(r.top+l[1]),s,a]},ec=function(t){return Pi(t)&&t.value===Fr.AUTO},ic=function(t){return"number"==typeof t},rc=function(t,e,i){var r=e[0],n=e[1],o=e[2],s=t[0],a=t[1];if(!s)return[0,0];if(Ni(s)&&a&&Ni(a))return[$i(s,i.width),$i(a,i.height)];var l=ic(o);if(Pi(s)&&(s.value===Fr.CONTAIN||s.value===Fr.COVER))return ic(o)?i.width/i.height<o!=(s.value===Fr.COVER)?[i.width,i.width/o]:[i.height*o,i.height]:[i.width,i.height];var c=ic(r),u=ic(n),h=c||u;if(ec(s)&&(!a||ec(a)))return c&&u?[r,n]:l||h?h&&l?[c?r:n*o,u?n:r/o]:[c?r:i.width,u?n:i.height]:[i.width,i.height];if(l){var d=0,p=0;return Ni(s)?d=$i(s,i.width):Ni(a)&&(p=$i(a,i.height)),ec(s)?d=p*o:a&&!ec(a)||(p=d/o),[d,p]}var f=null,A=null;if(Ni(s)?f=$i(s,i.width):a&&Ni(a)&&(A=$i(a,i.height)),null===f||a&&!ec(a)||(A=c&&u?f/r*n:i.height),null!==A&&ec(s)&&(f=c&&u?A/n*r:i.width),null!==f&&null!==A)return[f,A];throw new Error("Unable to calculate background-size for element")},nc=function(t,e){var i=t[e];return void 0===i?t[0]:i},oc=function(t,e,i,r,n){var o=e[0],s=e[1],a=i[0],l=i[1];switch(t){case 2:return[new bl(Math.round(r.left),Math.round(r.top+s)),new bl(Math.round(r.left+r.width),Math.round(r.top+s)),new bl(Math.round(r.left+r.width),Math.round(l+r.top+s)),new bl(Math.round(r.left),Math.round(l+r.top+s))];case 3:return[new bl(Math.round(r.left+o),Math.round(r.top)),new bl(Math.round(r.left+o+a),Math.round(r.top)),new bl(Math.round(r.left+o+a),Math.round(r.height+r.top)),new bl(Math.round(r.left+o),Math.round(r.height+r.top))];case 1:return[new bl(Math.round(r.left+o),Math.round(r.top+s)),new bl(Math.round(r.left+o+a),Math.round(r.top+s)),new bl(Math.round(r.left+o+a),Math.round(r.top+s+l)),new bl(Math.round(r.left+o),Math.round(r.top+s+l))];default:return[new bl(Math.round(n.left),Math.round(n.top)),new bl(Math.round(n.left+n.width),Math.round(n.top)),new bl(Math.round(n.left+n.width),Math.round(n.height+n.top)),new bl(Math.round(n.left),Math.round(n.height+n.top))]}},sc="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",ac="Hidden Text",lc=function(){function t(t){this._data={},this._document=t}return t.prototype.parseMetrics=function(t,e){var i=this._document.createElement("div"),r=this._document.createElement("img"),n=this._document.createElement("span"),o=this._document.body;i.style.visibility="hidden",i.style.fontFamily=t,i.style.fontSize=e,i.style.margin="0",i.style.padding="0",i.style.whiteSpace="nowrap",o.appendChild(i),r.src=sc,r.width=1,r.height=1,r.style.margin="0",r.style.padding="0",r.style.verticalAlign="baseline",n.style.fontFamily=t,n.style.fontSize=e,n.style.margin="0",n.style.padding="0",n.appendChild(this._document.createTextNode(ac)),i.appendChild(n),i.appendChild(r);var s=r.offsetTop-n.offsetTop+2;i.removeChild(n),i.appendChild(this._document.createTextNode(ac)),i.style.lineHeight="normal",r.style.verticalAlign="super";var a=r.offsetTop-i.offsetTop+2;return o.removeChild(i),{baseline:s,middle:a}},t.prototype.getMetrics=function(t,e){var i=t+" "+e;return void 0===this._data[i]&&(this._data[i]=this.parseMetrics(t,e)),this._data[i]},t}(),cc=function(){function t(t,e){this.context=t,this.options=e}return t}(),uc=1e4,hc=function(t){function i(e,i){var r=t.call(this,e,i)||this;return r._activeEffects=[],r.canvas=i.canvas?i.canvas:document.createElement("canvas"),r.ctx=r.canvas.getContext("2d"),i.canvas||(r.canvas.width=Math.floor(i.width*i.scale),r.canvas.height=Math.floor(i.height*i.scale),r.canvas.style.width=i.width+"px",r.canvas.style.height=i.height+"px"),r.fontMetrics=new lc(document),r.ctx.scale(r.options.scale,r.options.scale),r.ctx.translate(-i.x,-i.y),r.ctx.textBaseline="bottom",r._activeEffects=[],r.context.logger.debug("Canvas renderer initialized ("+i.width+"x"+i.height+") with scale "+i.scale),r}return e(i,t),i.prototype.applyEffects=function(t){for(var e=this;this._activeEffects.length;)this.popEffect();t.forEach((function(t){return e.applyEffect(t)}))},i.prototype.applyEffect=function(t){this.ctx.save(),Dl(t)&&(this.ctx.globalAlpha=t.opacity),zl(t)&&(this.ctx.translate(t.offsetX,t.offsetY),this.ctx.transform(t.matrix[0],t.matrix[1],t.matrix[2],t.matrix[3],t.matrix[4],t.matrix[5]),this.ctx.translate(-t.offsetX,-t.offsetY)),Fl(t)&&(this.path(t.path),this.ctx.clip()),this._activeEffects.push(t)},i.prototype.popEffect=function(){this._activeEffects.pop(),this.ctx.restore()},i.prototype.renderStack=function(t){return r(this,void 0,void 0,(function(){return n(this,(function(e){switch(e.label){case 0:return t.element.container.styles.isVisible()?[4,this.renderStackContent(t)]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))},i.prototype.renderNode=function(t){return r(this,void 0,void 0,(function(){return n(this,(function(e){switch(e.label){case 0:return no(t.container.flags,16),t.container.styles.isVisible()?[4,this.renderNodeBackgroundAndBorders(t)]:[3,3];case 1:return e.sent(),[4,this.renderNodeContent(t)];case 2:e.sent(),e.label=3;case 3:return[2]}}))}))},i.prototype.renderTextWithLetterSpacing=function(t,e,i){var r=this;0===e?this.ctx.fillText(t.text,t.bounds.left,t.bounds.top+i):Ms(t.text).reduce((function(e,n){return r.ctx.fillText(n,e,t.bounds.top+i),e+r.ctx.measureText(n).width}),t.bounds.left)},i.prototype.createFontStyle=function(t){var e=t.fontVariant.filter((function(t){return"normal"===t||"small-caps"===t})).join(""),i=mc(t.fontFamily).join(", "),r=Mi(t.fontSize)?""+t.fontSize.number+t.fontSize.unit:t.fontSize.number+"px";return[[t.fontStyle,e,t.fontWeight,r,i].join(" "),i,r]},i.prototype.renderTextNode=function(t,e){return r(this,void 0,void 0,(function(){var i,r,o,s,a,l,c,u,h=this;return n(this,(function(n){return i=this.createFontStyle(e),r=i[0],o=i[1],s=i[2],this.ctx.font=r,this.ctx.direction=1===e.direction?"rtl":"ltr",this.ctx.textAlign="left",this.ctx.textBaseline="alphabetic",a=this.fontMetrics.getMetrics(o,s),l=a.baseline,c=a.middle,u=e.paintOrder,t.textBounds.forEach((function(t){u.forEach((function(i){switch(i){case 0:h.ctx.fillStyle=rr(e.color),h.renderTextWithLetterSpacing(t,e.letterSpacing,l);var r=e.textShadow;r.length&&t.text.trim().length&&(r.slice(0).reverse().forEach((function(i){h.ctx.shadowColor=rr(i.color),h.ctx.shadowOffsetX=i.offsetX.number*h.options.scale,h.ctx.shadowOffsetY=i.offsetY.number*h.options.scale,h.ctx.shadowBlur=i.blur.number,h.renderTextWithLetterSpacing(t,e.letterSpacing,l)})),h.ctx.shadowColor="",h.ctx.shadowOffsetX=0,h.ctx.shadowOffsetY=0,h.ctx.shadowBlur=0),e.textDecorationLine.length&&(h.ctx.fillStyle=rr(e.textDecorationColor||e.color),e.textDecorationLine.forEach((function(e){switch(e){case 1:h.ctx.fillRect(t.bounds.left,Math.round(t.bounds.top+l),t.bounds.width,1);break;case 2:h.ctx.fillRect(t.bounds.left,Math.round(t.bounds.top),t.bounds.width,1);break;case 3:h.ctx.fillRect(t.bounds.left,Math.ceil(t.bounds.top+c),t.bounds.width,1)}})));break;case 1:e.webkitTextStrokeWidth&&t.text.trim().length&&(h.ctx.strokeStyle=rr(e.webkitTextStrokeColor),h.ctx.lineWidth=e.webkitTextStrokeWidth,h.ctx.lineJoin=window.chrome?"miter":"round",h.ctx.strokeText(t.text,t.bounds.left,t.bounds.top+l)),h.ctx.strokeStyle="",h.ctx.lineWidth=0,h.ctx.lineJoin="miter"}}))})),[2]}))}))},i.prototype.renderReplacedElement=function(t,e,i){if(i&&t.intrinsicWidth>0&&t.intrinsicHeight>0){var r=Xl(t),n=Ml(e);this.path(n),this.ctx.save(),this.ctx.clip(),this.ctx.drawImage(i,0,0,t.intrinsicWidth,t.intrinsicHeight,r.left,r.top,r.width,r.height),this.ctx.restore()}},i.prototype.renderNodeContent=function(t){return r(this,void 0,void 0,(function(){var e,r,o,a,l,c,u,h,d,p,f,A,m,g,_,y,v,x;return n(this,(function(n){switch(n.label){case 0:this.applyEffects(t.getEffects(4)),e=t.container,r=t.curves,o=e.styles,a=0,l=e.textNodes,n.label=1;case 1:return a<l.length?(c=l[a],[4,this.renderTextNode(c,o)]):[3,4];case 2:n.sent(),n.label=3;case 3:return a++,[3,1];case 4:if(!(e instanceof Os))return[3,8];n.label=5;case 5:return n.trys.push([5,7,,8]),[4,this.context.cache.match(e.src)];case 6:return _=n.sent(),this.renderReplacedElement(e,r,_),[3,8];case 7:return n.sent(),this.context.logger.error("Error loading image "+e.src),[3,8];case 8:if(e instanceof Ns&&this.renderReplacedElement(e,r,e.canvas),!(e instanceof Qs))return[3,12];n.label=9;case 9:return n.trys.push([9,11,,12]),[4,this.context.cache.match(e.svg)];case 10:return _=n.sent(),this.renderReplacedElement(e,r,_),[3,12];case 11:return n.sent(),this.context.logger.error("Error loading svg "+e.svg.substring(0,255)),[3,12];case 12:return e instanceof ea&&e.tree?[4,new i(this.context,{scale:this.options.scale,backgroundColor:e.backgroundColor,x:0,y:0,width:e.width,height:e.height}).render(e.tree)]:[3,14];case 13:u=n.sent(),e.width&&e.height&&this.ctx.drawImage(u,0,0,e.width,e.height,e.bounds.left,e.bounds.top,e.bounds.width,e.bounds.height),n.label=14;case 14:if(e instanceof Js&&(h=Math.min(e.bounds.width,e.bounds.height),e.type===qs?e.checked&&(this.ctx.save(),this.path([new bl(e.bounds.left+.39363*h,e.bounds.top+.79*h),new bl(e.bounds.left+.16*h,e.bounds.top+.5549*h),new bl(e.bounds.left+.27347*h,e.bounds.top+.44071*h),new bl(e.bounds.left+.39694*h,e.bounds.top+.5649*h),new bl(e.bounds.left+.72983*h,e.bounds.top+.23*h),new bl(e.bounds.left+.84*h,e.bounds.top+.34085*h),new bl(e.bounds.left+.39363*h,e.bounds.top+.79*h)]),this.ctx.fillStyle=rr(Xs),this.ctx.fill(),this.ctx.restore()):e.type===Ks&&e.checked&&(this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(e.bounds.left+h/2,e.bounds.top+h/2,h/4,0,2*Math.PI,!0),this.ctx.fillStyle=rr(Xs),this.ctx.fill(),this.ctx.restore())),dc(e)&&e.value.length){switch(d=this.createFontStyle(o),v=d[0],p=d[1],f=this.fontMetrics.getMetrics(v,p).baseline,this.ctx.font=v,this.ctx.fillStyle=rr(o.color),this.ctx.textBaseline="alphabetic",this.ctx.textAlign=fc(e.styles.textAlign),x=Xl(e),A=0,e.styles.textAlign){case 1:A+=x.width/2;break;case 2:A+=x.width}m=x.add(A,0,0,-x.height/2+1),this.ctx.save(),this.path([new bl(x.left,x.top),new bl(x.left+x.width,x.top),new bl(x.left+x.width,x.top+x.height),new bl(x.left,x.top+x.height)]),this.ctx.clip(),this.renderTextWithLetterSpacing(new Es(e.value,m),o.letterSpacing,f),this.ctx.restore(),this.ctx.textBaseline="alphabetic",this.ctx.textAlign="left"}if(!no(e.styles.display,2048))return[3,20];if(null===e.styles.listStyleImage)return[3,19];if(0!==(g=e.styles.listStyleImage).type)return[3,18];_=void 0,y=g.url,n.label=15;case 15:return n.trys.push([15,17,,18]),[4,this.context.cache.match(y)];case 16:return _=n.sent(),this.ctx.drawImage(_,e.bounds.left-(_.width+10),e.bounds.top),[3,18];case 17:return n.sent(),this.context.logger.error("Error loading list-style-image "+y),[3,18];case 18:return[3,20];case 19:t.listValue&&-1!==e.styles.listStyleType&&(v=this.createFontStyle(o)[0],this.ctx.font=v,this.ctx.fillStyle=rr(o.color),this.ctx.textBaseline="middle",this.ctx.textAlign="right",x=new s(e.bounds.left,e.bounds.top+$i(e.styles.paddingTop,e.bounds.width),e.bounds.width,xn(o.lineHeight,o.fontSize.number)/2+1),this.renderTextWithLetterSpacing(new Es(t.listValue,x),o.letterSpacing,xn(o.lineHeight,o.fontSize.number)/2+2),this.ctx.textBaseline="bottom",this.ctx.textAlign="left"),n.label=20;case 20:return[2]}}))}))},i.prototype.renderStackContent=function(t){return r(this,void 0,void 0,(function(){var e,i,r,o,s,a,l,c,u,h,d,p,f,A,m;return n(this,(function(n){switch(n.label){case 0:return no(t.element.container.flags,16),[4,this.renderNodeBackgroundAndBorders(t.element)];case 1:n.sent(),e=0,i=t.negativeZIndex,n.label=2;case 2:return e<i.length?(m=i[e],[4,this.renderStack(m)]):[3,5];case 3:n.sent(),n.label=4;case 4:return e++,[3,2];case 5:return[4,this.renderNodeContent(t.element)];case 6:n.sent(),r=0,o=t.nonInlineLevel,n.label=7;case 7:return r<o.length?(m=o[r],[4,this.renderNode(m)]):[3,10];case 8:n.sent(),n.label=9;case 9:return r++,[3,7];case 10:s=0,a=t.nonPositionedFloats,n.label=11;case 11:return s<a.length?(m=a[s],[4,this.renderStack(m)]):[3,14];case 12:n.sent(),n.label=13;case 13:return s++,[3,11];case 14:l=0,c=t.nonPositionedInlineLevel,n.label=15;case 15:return l<c.length?(m=c[l],[4,this.renderStack(m)]):[3,18];case 16:n.sent(),n.label=17;case 17:return l++,[3,15];case 18:u=0,h=t.inlineLevel,n.label=19;case 19:return u<h.length?(m=h[u],[4,this.renderNode(m)]):[3,22];case 20:n.sent(),n.label=21;case 21:return u++,[3,19];case 22:d=0,p=t.zeroOrAutoZIndexOrTransformedOrOpacity,n.label=23;case 23:return d<p.length?(m=p[d],[4,this.renderStack(m)]):[3,26];case 24:n.sent(),n.label=25;case 25:return d++,[3,23];case 26:f=0,A=t.positiveZIndex,n.label=27;case 27:return f<A.length?(m=A[f],[4,this.renderStack(m)]):[3,30];case 28:n.sent(),n.label=29;case 29:return f++,[3,27];case 30:return[2]}}))}))},i.prototype.mask=function(t){this.ctx.beginPath(),this.ctx.moveTo(0,0),this.ctx.lineTo(this.canvas.width,0),this.ctx.lineTo(this.canvas.width,this.canvas.height),this.ctx.lineTo(0,this.canvas.height),this.ctx.lineTo(0,0),this.formatPath(t.slice(0).reverse()),this.ctx.closePath()},i.prototype.path=function(t){this.ctx.beginPath(),this.formatPath(t),this.ctx.closePath()},i.prototype.formatPath=function(t){var e=this;t.forEach((function(t,i){var r=Bl(t)?t.start:t;0===i?e.ctx.moveTo(r.x,r.y):e.ctx.lineTo(r.x,r.y),Bl(t)&&e.ctx.bezierCurveTo(t.startControl.x,t.startControl.y,t.endControl.x,t.endControl.y,t.end.x,t.end.y)}))},i.prototype.renderRepeat=function(t,e,i,r){this.path(t),this.ctx.fillStyle=e,this.ctx.translate(i,r),this.ctx.fill(),this.ctx.translate(-i,-r)},i.prototype.resizeImage=function(t,e,i){var r;if(t.width===e&&t.height===i)return t;var n=(null!==(r=this.canvas.ownerDocument)&&void 0!==r?r:document).createElement("canvas");return n.width=Math.max(1,e),n.height=Math.max(1,i),n.getContext("2d").drawImage(t,0,0,t.width,t.height,0,0,e,i),n},i.prototype.renderBackgroundImage=function(t){return r(this,void 0,void 0,(function(){var e,i,r,o,s,a;return n(this,(function(l){switch(l.label){case 0:e=t.styles.backgroundImage.length-1,i=function(i){var o,s,a,l,c,u,h,d,p,f,A,m,g,_,y,v,x,b,w,T,B,E,C,S,I,M,k,P,L,z,F;return n(this,(function(n){switch(n.label){case 0:if(0!==i.type)return[3,5];o=void 0,s=i.url,n.label=1;case 1:return n.trys.push([1,3,,4]),[4,r.context.cache.match(s)];case 2:return o=n.sent(),[3,4];case 3:return n.sent(),r.context.logger.error("Error loading background-image "+s),[3,4];case 4:return o&&(a=tc(t,e,[o.width,o.height,o.width/o.height]),v=a[0],E=a[1],C=a[2],w=a[3],T=a[4],_=r.ctx.createPattern(r.resizeImage(o,w,T),"repeat"),r.renderRepeat(v,_,E,C)),[3,6];case 5:kr(i)?(l=tc(t,e,[null,null,null]),v=l[0],E=l[1],C=l[2],w=l[3],T=l[4],c=gr(i.angle,w,T),u=c[0],h=c[1],d=c[2],p=c[3],f=c[4],(A=document.createElement("canvas")).width=w,A.height=T,m=A.getContext("2d"),g=m.createLinearGradient(h,p,d,f),Ar(i.stops,u).forEach((function(t){return g.addColorStop(t.stop,rr(t.color))})),m.fillStyle=g,m.fillRect(0,0,w,T),w>0&&T>0&&(_=r.ctx.createPattern(A,"repeat"),r.renderRepeat(v,_,E,C))):Pr(i)&&(y=tc(t,e,[null,null,null]),v=y[0],x=y[1],b=y[2],w=y[3],T=y[4],B=0===i.position.length?[ji]:i.position,E=$i(B[0],w),C=$i(B[B.length-1],T),S=vr(i,E,C,w,T),I=S[0],M=S[1],I>0&&M>0&&(k=r.ctx.createRadialGradient(x+E,b+C,0,x+E,b+C,I),Ar(i.stops,2*I).forEach((function(t){return k.addColorStop(t.stop,rr(t.color))})),r.path(v),r.ctx.fillStyle=k,I!==M?(P=t.bounds.left+.5*t.bounds.width,L=t.bounds.top+.5*t.bounds.height,F=1/(z=M/I),r.ctx.save(),r.ctx.translate(P,L),r.ctx.transform(1,0,0,z,0,0),r.ctx.translate(-P,-L),r.ctx.fillRect(x,F*(b-L)+L,w,T*F),r.ctx.restore()):r.ctx.fill())),n.label=6;case 6:return e--,[2]}}))},r=this,o=0,s=t.styles.backgroundImage.slice(0).reverse(),l.label=1;case 1:return o<s.length?(a=s[o],[5,i(a)]):[3,4];case 2:l.sent(),l.label=3;case 3:return o++,[3,1];case 4:return[2]}}))}))},i.prototype.renderSolidBorder=function(t,e,i){return r(this,void 0,void 0,(function(){return n(this,(function(r){return this.path(Hl(i,e)),this.ctx.fillStyle=rr(t),this.ctx.fill(),[2]}))}))},i.prototype.renderDoubleBorder=function(t,e,i,o){return r(this,void 0,void 0,(function(){var r,s;return n(this,(function(n){switch(n.label){case 0:return e<3?[4,this.renderSolidBorder(t,i,o)]:[3,2];case 1:return n.sent(),[2];case 2:return r=Gl(o,i),this.path(r),this.ctx.fillStyle=rr(t),this.ctx.fill(),s=$l(o,i),this.path(s),this.ctx.fill(),[2]}}))}))},i.prototype.renderNodeBackgroundAndBorders=function(t){return r(this,void 0,void 0,(function(){var e,i,r,o,s,a,l,c,u=this;return n(this,(function(n){switch(n.label){case 0:return this.applyEffects(t.getEffects(2)),e=t.container.styles,i=!ir(e.backgroundColor)||e.backgroundImage.length,r=[{style:e.borderTopStyle,color:e.borderTopColor,width:e.borderTopWidth},{style:e.borderRightStyle,color:e.borderRightColor,width:e.borderRightWidth},{style:e.borderBottomStyle,color:e.borderBottomColor,width:e.borderBottomWidth},{style:e.borderLeftStyle,color:e.borderLeftColor,width:e.borderLeftWidth}],o=pc(nc(e.backgroundClip,0),t.curves),i||e.boxShadow.length?(this.ctx.save(),this.path(o),this.ctx.clip(),ir(e.backgroundColor)||(this.ctx.fillStyle=rr(e.backgroundColor),this.ctx.fill()),[4,this.renderBackgroundImage(t.container)]):[3,2];case 1:n.sent(),this.ctx.restore(),e.boxShadow.slice(0).reverse().forEach((function(e){u.ctx.save();var i=Sl(t.curves),r=e.inset?0:uc,n=Ul(i,-r+(e.inset?1:-1)*e.spread.number,(e.inset?1:-1)*e.spread.number,e.spread.number*(e.inset?-2:2),e.spread.number*(e.inset?-2:2));e.inset?(u.path(i),u.ctx.clip(),u.mask(n)):(u.mask(i),u.ctx.clip(),u.path(n)),u.ctx.shadowOffsetX=e.offsetX.number+r,u.ctx.shadowOffsetY=e.offsetY.number,u.ctx.shadowColor=rr(e.color),u.ctx.shadowBlur=e.blur.number,u.ctx.fillStyle=e.inset?rr(e.color):"rgba(0,0,0,1)",u.ctx.fill(),u.ctx.restore()})),n.label=2;case 2:s=0,a=0,l=r,n.label=3;case 3:return a<l.length?0!==(c=l[a]).style&&!ir(c.color)&&c.width>0?2!==c.style?[3,5]:[4,this.renderDashedDottedBorder(c.color,c.width,s,t.curves,2)]:[3,11]:[3,13];case 4:return n.sent(),[3,11];case 5:return 3!==c.style?[3,7]:[4,this.renderDashedDottedBorder(c.color,c.width,s,t.curves,3)];case 6:return n.sent(),[3,11];case 7:return 4!==c.style?[3,9]:[4,this.renderDoubleBorder(c.color,c.width,s,t.curves)];case 8:return n.sent(),[3,11];case 9:return[4,this.renderSolidBorder(c.color,s,t.curves)];case 10:n.sent(),n.label=11;case 11:s++,n.label=12;case 12:return a++,[3,3];case 13:return[2]}}))}))},i.prototype.renderDashedDottedBorder=function(t,e,i,o,s){return r(this,void 0,void 0,(function(){var r,a,l,c,u,h,d,p,f,A,m,g,_,y,v,x;return n(this,(function(n){return this.ctx.save(),r=Zl(o,i),a=Hl(o,i),2===s&&(this.path(a),this.ctx.clip()),Bl(a[0])?(l=a[0].start.x,c=a[0].start.y):(l=a[0].x,c=a[0].y),Bl(a[1])?(u=a[1].end.x,h=a[1].end.y):(u=a[1].x,h=a[1].y),d=0===i||2===i?Math.abs(l-u):Math.abs(c-h),this.ctx.beginPath(),3===s?this.formatPath(r):this.formatPath(a.slice(0,2)),p=e<3?3*e:2*e,f=e<3?2*e:e,3===s&&(p=e,f=e),A=!0,d<=2*p?A=!1:d<=2*p+f?(p*=m=d/(2*p+f),f*=m):(g=Math.floor((d+f)/(p+f)),_=(d-g*p)/(g-1),f=(y=(d-(g+1)*p)/g)<=0||Math.abs(f-_)<Math.abs(f-y)?_:y),A&&(3===s?this.ctx.setLineDash([0,p+f]):this.ctx.setLineDash([p,f])),3===s?(this.ctx.lineCap="round",this.ctx.lineWidth=e):this.ctx.lineWidth=2*e+1.1,this.ctx.strokeStyle=rr(t),this.ctx.stroke(),this.ctx.setLineDash([]),2===s&&(Bl(a[0])&&(v=a[3],x=a[0],this.ctx.beginPath(),this.formatPath([new bl(v.end.x,v.end.y),new bl(x.start.x,x.start.y)]),this.ctx.stroke()),Bl(a[1])&&(v=a[1],x=a[2],this.ctx.beginPath(),this.formatPath([new bl(v.end.x,v.end.y),new bl(x.start.x,x.start.y)]),this.ctx.stroke())),this.ctx.restore(),[2]}))}))},i.prototype.render=function(t){return r(this,void 0,void 0,(function(){var e;return n(this,(function(i){switch(i.label){case 0:return this.options.backgroundColor&&(this.ctx.fillStyle=rr(this.options.backgroundColor),this.ctx.fillRect(this.options.x,this.options.y,this.options.width,this.options.height)),e=jl(t),[4,this.renderStack(e)];case 1:return i.sent(),this.applyEffects([]),[2,this.canvas]}}))}))},i}(cc),dc=function(t){return t instanceof ta||t instanceof Ys||t instanceof Js&&t.type!==Ks&&t.type!==qs},pc=function(t,e){switch(t){case 0:return Sl(e);case 2:return Il(e);default:return Ml(e)}},fc=function(t){switch(t){case 1:return"center";case 2:return"right";default:return"left"}},Ac=["-apple-system","system-ui"],mc=function(t){return/iPhone OS 15_(0|1)/.test(window.navigator.userAgent)?t.filter((function(t){return-1===Ac.indexOf(t)})):t},gc=function(t){function i(e,i){var r=t.call(this,e,i)||this;return r.canvas=i.canvas?i.canvas:document.createElement("canvas"),r.ctx=r.canvas.getContext("2d"),r.options=i,r.canvas.width=Math.floor(i.width*i.scale),r.canvas.height=Math.floor(i.height*i.scale),r.canvas.style.width=i.width+"px",r.canvas.style.height=i.height+"px",r.ctx.scale(r.options.scale,r.options.scale),r.ctx.translate(-i.x,-i.y),r.context.logger.debug("EXPERIMENTAL ForeignObject renderer initialized ("+i.width+"x"+i.height+" at "+i.x+","+i.y+") with scale "+i.scale),r}return e(i,t),i.prototype.render=function(t){return r(this,void 0,void 0,(function(){var e,i;return n(this,(function(r){switch(r.label){case 0:return e=ws(this.options.width*this.options.scale,this.options.height*this.options.scale,this.options.scale,this.options.scale,t),[4,_c(e)];case 1:return i=r.sent(),this.options.backgroundColor&&(this.ctx.fillStyle=rr(this.options.backgroundColor),this.ctx.fillRect(0,0,this.options.width*this.options.scale,this.options.height*this.options.scale)),this.ctx.drawImage(i,-this.options.x*this.options.scale,-this.options.y*this.options.scale),[2,this.canvas]}}))}))},i}(cc),_c=function(t){return new Promise((function(e,i){var r=new Image;r.onload=function(){e(r)},r.onerror=i,r.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent((new XMLSerializer).serializeToString(t))}))},yc=function(){function t(t){var e=t.id,i=t.enabled;this.id=e,this.enabled=i,this.start=Date.now()}return t.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.enabled&&("undefined"!=typeof window&&window.console&&"function"==typeof console.debug?console.debug.apply(console,o([this.id,this.getTime()+"ms"],t)):this.info.apply(this,t))},t.prototype.getTime=function(){return Date.now()-this.start},t.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.enabled&&"undefined"!=typeof window&&window.console&&"function"==typeof console.info&&console.info.apply(console,o([this.id,this.getTime()+"ms"],t))},t.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.enabled&&("undefined"!=typeof window&&window.console&&"function"==typeof console.warn?console.warn.apply(console,o([this.id,this.getTime()+"ms"],t)):this.info.apply(this,t))},t.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.enabled&&("undefined"!=typeof window&&window.console&&"function"==typeof console.error?console.error.apply(console,o([this.id,this.getTime()+"ms"],t)):this.info.apply(this,t))},t.instances={},t}(),vc=function(){function t(e,i){var r;this.windowBounds=i,this.instanceName="#"+t.instanceCount++,this.logger=new yc({id:this.instanceName,enabled:e.logging}),this.cache=null!==(r=e.cache)&&void 0!==r?r:new pl(this,e)}return t.instanceCount=1,t}(),xc=function(t,e){return void 0===e&&(e={}),bc(t,e)};"undefined"!=typeof window&&dl.setContext(window);var bc=function(t,e){return r(void 0,void 0,void 0,(function(){var r,o,c,u,h,d,p,f,A,m,g,_,y,v,x,b,w,T,B,E,C,S,I,M,k,P,L,z,F,D,R,U,O,N,Q,V,j,H;return n(this,(function(n){switch(n.label){case 0:if(!t||"object"!=typeof t)return[2,Promise.reject("Invalid element provided as first argument")];if(!(r=t.ownerDocument))throw new Error("Element is not attached to a Document");if(!(o=r.defaultView))throw new Error("Document is not attached to a Window");return c={allowTaint:null!==(S=e.allowTaint)&&void 0!==S&&S,imageTimeout:null!==(I=e.imageTimeout)&&void 0!==I?I:15e3,proxy:e.proxy,useCORS:null!==(M=e.useCORS)&&void 0!==M&&M},u=i({logging:null===(k=e.logging)||void 0===k||k,cache:e.cache},c),h={windowWidth:null!==(P=e.windowWidth)&&void 0!==P?P:o.innerWidth,windowHeight:null!==(L=e.windowHeight)&&void 0!==L?L:o.innerHeight,scrollX:null!==(z=e.scrollX)&&void 0!==z?z:o.pageXOffset,scrollY:null!==(F=e.scrollY)&&void 0!==F?F:o.pageYOffset},d=new s(h.scrollX,h.scrollY,h.windowWidth,h.windowHeight),p=new vc(u,d),f=null!==(D=e.foreignObjectRendering)&&void 0!==D&&D,A={allowTaint:null!==(R=e.allowTaint)&&void 0!==R&&R,onclone:e.onclone,ignoreElements:e.ignoreElements,inlineImages:f,copyStyles:f},p.logger.debug("Starting document clone with size "+d.width+"x"+d.height+" scrolled to "+-d.left+","+-d.top),m=new qa(p,t,A),(g=m.clonedReferenceElement)?[4,m.toIFrame(r,d)]:[2,Promise.reject("Unable to find element in cloned iframe")];case 1:return _=n.sent(),y=ga(g)||Aa(g)?l(g.ownerDocument):a(p,g),v=y.width,x=y.height,b=y.left,w=y.top,T=wc(p,g,e.backgroundColor),B={canvas:e.canvas,backgroundColor:T,scale:null!==(O=null!==(U=e.scale)&&void 0!==U?U:o.devicePixelRatio)&&void 0!==O?O:1,x:(null!==(N=e.x)&&void 0!==N?N:0)+b,y:(null!==(Q=e.y)&&void 0!==Q?Q:0)+w,width:null!==(V=e.width)&&void 0!==V?V:Math.ceil(v),height:null!==(j=e.height)&&void 0!==j?j:Math.ceil(x)},f?(p.logger.debug("Document cloned, using foreign object rendering"),[4,new gc(p,B).render(g)]):[3,3];case 2:return E=n.sent(),[3,5];case 3:return p.logger.debug("Document cloned, element located at "+b+","+w+" with size "+v+"x"+x+" using computed rendering"),p.logger.debug("Starting DOM parsing"),C=oa(p,g),T===C.styles.backgroundColor&&(C.styles.backgroundColor=hr.TRANSPARENT),p.logger.debug("Starting renderer for element at "+B.x+","+B.y+" with size "+B.width+"x"+B.height),[4,new hc(p,B).render(C)];case 4:E=n.sent(),n.label=5;case 5:return(null===(H=e.removeContainer)||void 0===H||H)&&(qa.destroy(_)||p.logger.error("Cannot detach cloned iframe as it is not in the DOM anymore")),p.logger.debug("Finished rendering"),[2,E]}}))}))},wc=function(t,e,i){var r=e.ownerDocument,n=r.documentElement?ur(t,getComputedStyle(r.documentElement).backgroundColor):hr.TRANSPARENT,o=r.body?ur(t,getComputedStyle(r.body).backgroundColor):hr.TRANSPARENT,s="string"==typeof i?ur(t,i):null===i?hr.TRANSPARENT:4294967295;return e===r.documentElement?ir(n)?ir(o)?s:o:n:s};return xc}();var hu=uu.exports;function du(t,e={}){const i=[{type:"script",value:`//api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/${e.version}/mapbox-gl-geocoder.min.js`,id:"byk-gc-js"},{type:"link",value:`//api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/${e.version}/mapbox-gl-geocoder.css`,id:"byk-gc-css"}],r=e.customStylesheetUrl;r&&i.push({type:"link",value:r,id:"byk-gcsu-css"});let n=()=>{};return function(t,e){for(const{type:i,value:r,id:n}of t){if(document.getElementById(n))return void("script"===i&&e());const t=document.createElement(i);t.id=n,"script"===i?(t.async=!0,t.defer=!0,t.src=r,t.onload=()=>e()):(t.rel="stylesheet",t.href=r),document.body.appendChild(t)}}(i,(()=>{n=function(t,e){const i=new window.MapboxGeocoder(t);i.addTo(`#${e.id}`),t.value&&i.setInput(t.value);return function(t,e,i,r){const n=[];for(const[o,s]of Object.entries(e)){const e=e=>{const[n,o]=s(t,e,i);r.dispatchEvent(new CustomEvent(n,{detail:o}))};t.on(o,e),n.push([o,e])}return()=>{for(const[e,i]of n)t.off(e,i)}}(i,pu,!1,e)}(e,t)})),{destroy(){n()}}}const pu={results:(t,e)=>["results",e],result:(t,e)=>["result",e],loading:(t,e)=>["loading",e],error:(t,e)=>["error",e],clear:(t,e)=>["clear",e],load:t=>["ready",{geocoder:t}]};function fu(t){let i,r,n;return{c(){i=b("div"),S(i,"id",t[0]),S(i,"class","svelte-1k1b3t4")},m(e,o){y(e,i,o),r||(n=[g(du.call(null,i,t[1])),C(i,"ready",t[2]),C(i,"results",t[11]),C(i,"result",t[12]),C(i,"loading",t[13]),C(i,"error",t[14]),C(i,"clear",t[15]),C(i,"load",t[16])],r=!0)},p:e,i:e,o:e,d(t){t&&v(i),r=!1,o(n)}}}function Au(t,e,i){let{accessToken:r}=e,{options:n={}}=e,{version:o="v4.5.1"}=e,{types:s=["country","region","postcode","district","place","locality","neighborhood","address"]}=e,{placeholder:a="Search"}=e,{value:l=null}=e,{customStylesheetUrl:c=!1}=e,{geocoder:u}=e;const h=j(),d="bsm-"+Math.random().toString(36).substring(6),p=Object.assign({version:o,accessToken:r,types:s.join(","),placeholder:a,customStylesheetUrl:c,value:l},n);return t.$$set=t=>{"accessToken"in t&&i(4,r=t.accessToken),"options"in t&&i(5,n=t.options),"version"in t&&i(6,o=t.version),"types"in t&&i(7,s=t.types),"placeholder"in t&&i(8,a=t.placeholder),"value"in t&&i(9,l=t.value),"customStylesheetUrl"in t&&i(10,c=t.customStylesheetUrl),"geocoder"in t&&i(3,u=t.geocoder)},[d,p,function({detail:t}){i(3,u=t.geocoder),h("ready")},u,r,n,o,s,a,l,c,function(e){H.call(this,t,e)},function(e){H.call(this,t,e)},function(e){H.call(this,t,e)},function(e){H.call(this,t,e)},function(e){H.call(this,t,e)},function(e){H.call(this,t,e)}]}class mu extends At{constructor(t){super(),ft(this,t,Au,fu,a,{accessToken:4,options:5,version:6,types:7,placeholder:8,value:9,customStylesheetUrl:10,geocoder:3})}}function gu(t){let e,i,r;return i=new Yl({props:{options:t[1].map(_u),activeValue:t[0],onSelect:t[2],direction:"down"}}),{c(){e=b("div"),ht(i.$$.fragment),S(e,"class","dropdown-container svelte-1yvkhcz")},m(t,n){y(t,e,n),dt(i,e,null),r=!0},p(t,[e]){const r={};2&e&&(r.options=t[1].map(_u)),1&e&&(r.activeValue=t[0]),4&e&&(r.onSelect=t[2]),i.$set(r)},i(t){r||(at(i.$$.fragment,t),r=!0)},o(t){lt(i.$$.fragment,t),r=!1},d(t){t&&v(e),pt(i)}}}const _u=t=>({label:t,value:t});function yu(t,e,i){let r,n;l(t,kt,(t=>i(5,n=t)));let{mode:o}=e,{mapsNum:s}=e;const a=j();let c=o??"",u=Ic;const h=t=>{1===t&&i(1,u=Ic.filter((t=>"swipe"!==t))),2===t&&i(1,u=Ic.filter((t=>"responsive"!==t))),t>2&&t<=4&&i(1,u=Ic.filter((t=>"swipe"!==t&&"responsive"!==t))),t>4&&i(1,u=Ic.filter((t=>"swipe"!==t&&"phone"!==t&&"responsive"!==t))),n||i(1,u=["mirror"]),u.includes(c)||i(0,c=u[0])};return kt.subscribe((()=>{h(s)})),t.$$set=t=>{"mode"in t&&i(3,o=t.mode),"mapsNum"in t&&i(4,s=t.mapsNum)},t.$$.update=()=>{var e;16&t.$$.dirty&&h(s),1&t.$$.dirty&&(t=>{a("viewMode",{mode:t})})(c),8&t.$$.dirty&&(e=o)!==c&&i(0,c=e)},i(2,r=t=>{i(0,c=t)}),[c,u,r,o,s]}class vu extends At{constructor(t){super(),ft(this,t,yu,gu,a,{mode:3,mapsNum:4})}}function xu(t){let e,i,r;return i=new Yl({props:{placeholder:"Go to...",options:t[3],activeValue:t[1],onSelect:t[2],direction:"down"}}),{c(){e=b("div"),ht(i.$$.fragment),S(e,"class","dropdown-container svelte-1ho45wf")},m(t,n){y(t,e,n),dt(i,e,null),r=!0},p(t,e){const r={};8&e&&(r.options=t[3]),2&e&&(r.activeValue=t[1]),4&e&&(r.onSelect=t[2]),i.$set(r)},i(t){r||(at(i.$$.fragment,t),r=!0)},o(t){lt(i.$$.fragment,t),r=!1},d(t){t&&v(e),pt(i)}}}function bu(t){let e,i,r=t[0]&&xu(t);return{c(){r&&r.c(),e=E()},m(t,n){r&&r.m(t,n),y(t,e,n),i=!0},p(t,[i]){t[0]?r?(r.p(t,i),1&i&&at(r,1)):(r=xu(t),r.c(),at(r,1),r.m(e.parentNode,e)):r&&(ot(),lt(r,1,1,(()=>{r=null})),st())},i(t){i||(at(r),i=!0)},o(t){lt(r),i=!1},d(t){r&&r.d(t),t&&v(e)}}}function wu(t,e,i){let r,n,{bearing:o}=e,{center:s}=e,{pitch:a}=e,{zoom:l}=e;const c=j();let u;It.subscribe((t=>i(0,({gazetteer:u}=t),u)));const h=(t,e)=>Number.parseFloat(t).toFixed(e),d=t=>{if(!u)return"";const e=Object.keys(u).reduce(((t,e)=>t=t.concat(u[e])),[]).find((e=>{const i=Object.values(e)[0];return Object.keys(i).every((e=>{if("center"===e&&t.center){const{lng:e,lat:r}=i.center,{lng:n,lat:o}=t.center;return h(e,4)===h(n,4)&&h(r,4)===h(o,4)}return h(i[e],2)===h(t[e],2)}))}));return e?JSON.stringify(e):""};let p=d({zoom:l,center:s,pitch:a,bearing:o});const f=()=>{const{options:t}=(t=>{if(!t)return{};try{const e=JSON.parse(t),i=Object.keys(e)[0],r=e[i];return c("mapState",{options:r}),{label:i,options:r}}catch(t){return console.error(t),{}}})(p);t&&c("mapState",{options:t})};return t.$$set=t=>{"bearing"in t&&i(4,o=t.bearing),"center"in t&&i(5,s=t.center),"pitch"in t&&i(6,a=t.pitch),"zoom"in t&&i(7,l=t.zoom)},t.$$.update=()=>{240&t.$$.dirty&&(t=>{const e=d(t);p!==e&&i(1,p=e??"")})({zoom:l,center:s,pitch:a,bearing:o}),2&t.$$.dirty&&f(),1&t.$$.dirty&&i(3,r=Object.entries(u).reduce(((t,[e,i])=>{t.push({header:e});for(const e of i){let[i,r]=Object.entries(e)[0];t.push({label:i,value:JSON.stringify(e)})}return t}),[]))},i(2,n=t=>{i(1,p=t)}),[u,p,n,r,o,s,a,l]}class Tu extends At{constructor(t){super(),ft(this,t,wu,bu,a,{bearing:4,center:5,pitch:6,zoom:7})}}function Bu(t){let e,i;return{c(){e=b("div"),i=T(t[0]),P(e,"top",t[3]+"px"),P(e,"left",t[2]+"px"),S(e,"class","tooltip svelte-1qc780y")},m(t,r){y(t,e,r),_(e,i)},p(t,r){1&r&&M(i,t[0]),8&r&&P(e,"top",t[3]+"px"),4&r&&P(e,"left",t[2]+"px")},d(t){t&&v(e)}}}function Eu(t){let e,i,r,n,s,a;const l=t[8].default,u=c(l,t,t[7],null);let f=t[1]&&Bu(t);return{c(){e=b("div"),u&&u.c(),i=B(),f&&f.c(),r=E()},m(o,l){y(o,e,l),u&&u.m(e,null),y(o,i,l),f&&f.m(o,l),y(o,r,l),n=!0,s||(a=[C(e,"mouseover",t[4]),C(e,"mouseleave",t[6]),C(e,"mousemove",t[5])],s=!0)},p(t,[e]){u&&u.p&&(!n||128&e)&&d(u,l,t,t[7],n?h(l,t[7],e,null):p(t[7]),null),t[1]?f?f.p(t,e):(f=Bu(t),f.c(),f.m(r.parentNode,r)):f&&(f.d(1),f=null)},i(t){n||(at(u,t),n=!0)},o(t){lt(u,t),n=!1},d(t){t&&v(e),u&&u.d(t),t&&v(i),f&&f.d(t),t&&v(r),s=!1,o(a)}}}function Cu(t,e,i){let r,n,{$$slots:o={},$$scope:s}=e,{title:a=""}=e,l=!1;return t.$$set=t=>{"title"in t&&i(0,a=t.title),"$$scope"in t&&i(7,s=t.$$scope)},[a,l,r,n,function(t){i(1,l=!0),i(2,r=t.pageX+5),i(3,n=t.pageY+5)},function(t){i(2,r=t.pageX+5),i(3,n=t.pageY+5)},function(){i(1,l=!1)},s,o]}class Su extends At{constructor(t){super(),ft(this,t,Cu,Eu,a,{title:0})}}function Iu(t,e,i){const r=t.slice();return r[27]=e[i],r}function Mu(t){let i,r,n,s,a;return r=new Tl({props:{icon:ul}}),{c(){i=b("button"),ht(r.$$.fragment),S(i,"class","fullscreen-btn show-ui svelte-1g6kozd"),S(i,"title","Show UI")},m(e,o){y(e,i,o),dt(r,i,null),n=!0,s||(a=[C(i,"click",t[13]),g(zl.call(null,i,{shift:!0,control:!0,code:"KeyF",callback:t[13]}))],s=!0)},p:e,i(t){n||(at(r.$$.fragment,t),n=!0)},o(t){lt(r.$$.fragment,t),n=!1},d(t){t&&v(i),pt(r),s=!1,o(a)}}}function ku(t){let e,r,n,s,a,l,c,u,h,d,p,f,A,m,x,w,E,I,M,k,L,z,F,D,R,U,O,N,Q,V,j,H,G,$,Z,q,K,W,X,J,Y,tt,et,it,rt,nt,ft,At,mt,gt;a=new Tl({props:{icon:t[8]?dl:ml}});let _t=t[8]&&Pu(t);d=new vu({props:{mode:t[4],mapsNum:t[5].length}}),d.$on("viewMode",t[21]);let yt=t[3]&&Lu(t);const vt=[t[6]];let xt={};for(let t=0;t<vt.length;t+=1)xt=i(xt,vt[t]);x=new Tu({props:xt}),x.$on("mapState",t[22]);let bt="swipe"===t[4]&&zu(t);G=new Tl({props:{icon:pl}}),X=new Tl({props:{icon:hl}}),nt=new Tl({props:{icon:fl}});let wt=t[7].length>0&&Du(t);return{c(){e=b("div"),r=b("div"),n=b("div"),s=b("div"),ht(a.$$.fragment),c=B(),_t&&_t.c(),u=B(),h=b("div"),ht(d.$$.fragment),p=B(),f=b("div"),yt&&yt.c(),A=B(),m=b("div"),ht(x.$$.fragment),w=B(),E=b("div"),I=b("div"),M=b("label"),k=b("span"),k.innerHTML='Label <span class="hotkey svelte-1g6kozd">C</span>ollisions',L=B(),z=b("input"),F=B(),D=b("label"),R=b("span"),R.innerHTML='<span class="hotkey svelte-1g6kozd">T</span>ile Boundaries',U=B(),O=b("input"),N=B(),bt&&bt.c(),Q=B(),V=b("div"),j=b("div"),H=b("button"),ht(G.$$.fragment),$=T(" Add map"),K=B(),W=b("button"),ht(X.$$.fragment),J=T("\n            Copy image"),et=B(),it=b("div"),rt=b("button"),ht(nt.$$.fragment),ft=B(),wt&&wt.c(),S(s,"class","link-button svelte-1g6kozd"),P(s,"margin-right","6px"),S(s,"title",l=t[8]?"Unlink locations":"Link locations"),S(n,"class","control-section svelte-1g6kozd"),S(h,"class","control-section svelte-1g6kozd"),S(f,"class","control-section svelte-1g6kozd"),S(m,"class","control-section svelte-1g6kozd"),S(k,"class","checkbox-label svelte-1g6kozd"),S(z,"type","checkbox"),S(M,"class","checkbox-container svelte-1g6kozd"),S(R,"class","checkbox-label svelte-1g6kozd"),S(O,"type","checkbox"),S(D,"class","checkbox-container svelte-1g6kozd"),S(I,"class","checkboxes svelte-1g6kozd"),S(E,"class","control-section svelte-1g6kozd"),P(H,"margin-right","6px"),H.disabled=Z=t[5].length>=8,S(H,"title",q=t[5].length>=8?"Maximum of 8 maps allowed.":""),W.disabled=Y="swipe"===t[4],S(W,"title",tt="swipe"===t[4]?"Must be in phone or mirror mode to screenshot.":"Copy image to clipboard"),S(j,"class","buttons svelte-1g6kozd"),S(V,"class","control-section svelte-1g6kozd"),S(rt,"class","fullscreen-btn svelte-1g6kozd"),S(rt,"title","Hide UI"),S(it,"class","control-section svelte-1g6kozd"),S(r,"class","control-row svelte-1g6kozd"),S(e,"class","map-controls svelte-1g6kozd")},m(i,o){y(i,e,o),_(e,r),_(r,n),_(n,s),dt(a,s,null),_(n,c),_t&&_t.m(n,null),_(r,u),_(r,h),dt(d,h,null),_(r,p),_(r,f),yt&&yt.m(f,null),_(r,A),_(r,m),dt(x,m,null),_(r,w),_(r,E),_(E,I),_(I,M),_(M,k),_(M,L),_(M,z),z.checked=t[0],_(I,F),_(I,D),_(D,R),_(D,U),_(D,O),O.checked=t[1],_(I,N),bt&&bt.m(I,null),_(r,Q),_(r,V),_(V,j),_(j,H),dt(G,H,null),_(H,$),_(j,K),_(j,W),dt(X,W,null),_(W,J),_(r,et),_(r,it),_(it,rt),dt(nt,rt,null),_(e,ft),wt&&wt.m(e,null),At=!0,mt||(gt=[C(s,"click",t[14]),C(z,"change",t[23]),C(O,"change",t[24]),C(H,"click",t[11]),C(W,"click",t[12]),C(rt,"click",t[13]),g(zl.call(null,rt,{shift:!0,control:!0,code:"KeyF",callback:t[13]}))],mt=!0)},p(t,i){const r={};256&i&&(r.icon=t[8]?dl:ml),a.$set(r),(!At||256&i&&l!==(l=t[8]?"Unlink locations":"Link locations"))&&S(s,"title",l),t[8]?_t?(_t.p(t,i),256&i&&at(_t,1)):(_t=Pu(t),_t.c(),at(_t,1),_t.m(n,null)):_t&&(ot(),lt(_t,1,1,(()=>{_t=null})),st());const o={};16&i&&(o.mode=t[4]),32&i&&(o.mapsNum=t[5].length),d.$set(o),t[3]?yt?(yt.p(t,i),8&i&&at(yt,1)):(yt=Lu(t),yt.c(),at(yt,1),yt.m(f,null)):yt&&(ot(),lt(yt,1,1,(()=>{yt=null})),st());const c=64&i?ct(vt,[ut(t[6])]):{};x.$set(c),1&i&&(z.checked=t[0]),2&i&&(O.checked=t[1]),"swipe"===t[4]?bt?(bt.p(t,i),16&i&&at(bt,1)):(bt=zu(t),bt.c(),at(bt,1),bt.m(I,null)):bt&&(ot(),lt(bt,1,1,(()=>{bt=null})),st()),(!At||32&i&&Z!==(Z=t[5].length>=8))&&(H.disabled=Z),(!At||32&i&&q!==(q=t[5].length>=8?"Maximum of 8 maps allowed.":""))&&S(H,"title",q),(!At||16&i&&Y!==(Y="swipe"===t[4]))&&(W.disabled=Y),(!At||16&i&&tt!==(tt="swipe"===t[4]?"Must be in phone or mirror mode to screenshot.":"Copy image to clipboard"))&&S(W,"title",tt),t[7].length>0?wt?wt.p(t,i):(wt=Du(t),wt.c(),wt.m(e,null)):wt&&(wt.d(1),wt=null)},i(t){At||(at(a.$$.fragment,t),at(_t),at(d.$$.fragment,t),at(yt),at(x.$$.fragment,t),at(bt),at(G.$$.fragment,t),at(X.$$.fragment,t),at(nt.$$.fragment,t),At=!0)},o(t){lt(a.$$.fragment,t),lt(_t),lt(d.$$.fragment,t),lt(yt),lt(x.$$.fragment,t),lt(bt),lt(G.$$.fragment,t),lt(X.$$.fragment,t),lt(nt.$$.fragment,t),At=!1},d(t){t&&v(e),pt(a),_t&&_t.d(),pt(d),yt&&yt.d(),pt(x),bt&&bt.d(),pt(G),pt(X),pt(nt),wt&&wt.d(),mt=!1,o(gt)}}}function Pu(t){let e,r;const n=[t[6]];let o={};for(let t=0;t<n.length;t+=1)o=i(o,n[t]);return e=new wc({props:o}),e.$on("mapState",t[20]),{c(){ht(e.$$.fragment)},m(t,i){dt(e,t,i),r=!0},p(t,i){const r=64&i?ct(n,[ut(t[6])]):{};e.$set(r)},i(t){r||(at(e.$$.fragment,t),r=!0)},o(t){lt(e.$$.fragment,t),r=!1},d(t){pt(e,t)}}}function Lu(t){let e,i;return e=new mu({props:{accessToken:t[3],geocoder:null}}),e.$on("result",t[10]),{c(){ht(e.$$.fragment)},m(t,r){dt(e,t,r),i=!0},p(t,i){const r={};8&i&&(r.accessToken=t[3]),e.$set(r)},i(t){i||(at(e.$$.fragment,t),i=!0)},o(t){lt(e.$$.fragment,t),i=!1},d(t){pt(e,t)}}}function zu(t){let e,i;return e=new Su({props:{title:"Highlights visual differences between two styles.",$$slots:{default:[Fu]},$$scope:{ctx:t}}}),{c(){ht(e.$$.fragment)},m(t,r){dt(e,t,r),i=!0},p(t,i){const r={};1073741828&i&&(r.$$scope={dirty:i,ctx:t}),e.$set(r)},i(t){i||(at(e.$$.fragment,t),i=!0)},o(t){lt(e.$$.fragment,t),i=!1},d(t){pt(e,t)}}}function Fu(t){let e,i,r,n,o,s;return{c(){e=b("label"),i=b("span"),i.innerHTML='Highlight <span class="hotkey svelte-1g6kozd">D</span>ifferences',r=B(),n=b("input"),S(i,"class","checkbox-label svelte-1g6kozd"),S(n,"type","checkbox"),S(e,"class","checkbox-container svelte-1g6kozd")},m(a,l){y(a,e,l),_(e,i),_(e,r),_(e,n),n.checked=t[2],o||(s=C(n,"change",t[25]),o=!0)},p(t,e){4&e&&(n.checked=t[2])},d(t){t&&v(e),o=!1,s()}}}function Du(t){let e,i=t[7],r=[];for(let e=0;e<i.length;e+=1)r[e]=Ru(Iu(t,i,e));return{c(){e=b("div");for(let t=0;t<r.length;t+=1)r[t].c();S(e,"class","validation-messages svelte-1g6kozd")},m(t,i){y(t,e,i);for(let t=0;t<r.length;t+=1)r[t]&&r[t].m(e,null)},p(t,n){if(128&n){let o;for(i=t[7],o=0;o<i.length;o+=1){const s=Iu(t,i,o);r[o]?r[o].p(s,n):(r[o]=Ru(s),r[o].c(),r[o].m(e,null))}for(;o<r.length;o+=1)r[o].d(1);r.length=i.length}},d(t){t&&v(e),x(r,t)}}}function Ru(t){let e,i,r,n=t[27].message+"";return{c(){e=b("div"),i=T(n),S(e,"class",r=m(`validation-message-${t[27].type}`)+" svelte-1g6kozd")},m(t,r){y(t,e,r),_(e,i)},p(t,o){128&o&&n!==(n=t[27].message+"")&&M(i,n),128&o&&r!==(r=m(`validation-message-${t[27].type}`)+" svelte-1g6kozd")&&S(e,"class",r)},d(t){t&&v(e)}}}function Uu(t){let e,i,r,n,o,s;const a=[ku,Mu],l=[];function c(t,e){return t[9]?0:1}return e=c(t),i=l[e]=a[e](t),{c(){i.c(),r=E()},m(i,a){l[e].m(i,a),y(i,r,a),n=!0,o||(s=C(window,"keydown",t[15]),o=!0)},p(t,[n]){let o=e;e=c(t),e===o?l[e].p(t,n):(ot(),lt(l[o],1,1,(()=>{l[o]=null})),st(),i=l[e],i?i.p(t,n):(i=l[e]=a[e](t),i.c()),at(i,1),i.m(r.parentNode,r))},i(t){n||(at(i),n=!0)},o(t){lt(i),n=!1},d(t){l[e].d(t),t&&v(r),o=!1,s()}}}function Ou(t,e,i){let r,n;l(t,kt,(t=>i(8,r=t))),l(t,Mt,(t=>i(9,n=t)));let{bearing:o}=e,{center:s}=e,{mapboxGlAccessToken:a}=e,{pitch:c}=e,{showCollisions:u}=e,{showBoundaries:h}=e,{showDiff:d}=e,{viewMode:p}=e,{zoom:f}=e;const A=j();let m,g=[],_=[];Ct.subscribe((t=>i(5,g=t)));return t.$$set=t=>{"bearing"in t&&i(16,o=t.bearing),"center"in t&&i(17,s=t.center),"mapboxGlAccessToken"in t&&i(3,a=t.mapboxGlAccessToken),"pitch"in t&&i(18,c=t.pitch),"showCollisions"in t&&i(0,u=t.showCollisions),"showBoundaries"in t&&i(1,h=t.showBoundaries),"showDiff"in t&&i(2,d=t.showDiff),"viewMode"in t&&i(4,p=t.viewMode),"zoom"in t&&i(19,f=t.zoom)},t.$$.update=()=>{983040&t.$$.dirty&&i(6,m={bearing:o,center:s,pitch:c,zoom:f}),96&t.$$.dirty&&i(7,_=((t,e)=>{const i=[],r=Mc(t,e);return t.pitch>=r&&i.push({type:"warning",message:`Pitch capped at ${r} as that is the maximum for this zoom level.`}),i})(m,g)),20&t.$$.dirty&&"swipe"!==p&&d&&i(2,d=!1),7&t.$$.dirty&&A("mapState",{options:{showCollisions:u,showBoundaries:h,showDiff:d}})},[u,h,d,a,p,g,m,_,r,n,({detail:t})=>{const{result:e}=t,i={center:{lat:e.center[1],lng:e.center[0]},zoom:17};e.bbox&&(i.zoom=14),A("mapState",{options:i})},()=>{Ct.update((t=>{let e=t[t.length-1];e={...e,index:e.index+1};return t.concat([e])})),r||Pt.update((t=>[...t,{...t[t.length-1]}]))},async()=>{const t=document.getElementsByClassName("maps")[0];let e=[...document.getElementsByClassName("screenshot-label-transparent")];e.forEach((t=>{t.classList.remove("screenshot-label-transparent"),t.classList.add("screenshot-label")}));let i=[];"mirror"===p&&(i=[...document.getElementsByClassName("map-container-border")],i.forEach((t=>{t.classList.remove("map-container-border"),t.classList.add("map-container-border-transparent")})));hu(t,{ignoreElements:t=>!(!t.className||"string"!=typeof t.className)&&t.className.includes("map-label")}).then((t=>{t.toBlob((t=>navigator.clipboard.write([new ClipboardItem({"image/png":t})])))})),e.forEach((t=>{t.classList.remove("screenshot-label"),t.classList.add("screenshot-label-transparent")})),"mirror"===p&&i.forEach((t=>{t.classList.remove("map-container-border-transparent"),t.classList.add("map-container-border")}))},()=>{Mt.update((t=>!t))},()=>{kt.update((t=>!t))},function(t){"input"!==t.target.tagName.toLowerCase()&&("c"!==t.key&&"C"!==t.key||i(0,u=!u),"t"!==t.key&&"T"!==t.key||i(1,h=!h),"d"!==t.key&&"D"!==t.key||i(2,d=!d))},o,s,c,f,function(e){H.call(this,t,e)},function(e){H.call(this,t,e)},function(e){H.call(this,t,e)},function(){u=this.checked,i(0,u)},function(){h=this.checked,i(1,h)},function(){d=this.checked,i(2,d),i(4,p)}]}class Nu extends At{constructor(t){super(),ft(this,t,Ou,Uu,a,{bearing:16,center:17,mapboxGlAccessToken:3,pitch:18,showCollisions:0,showBoundaries:1,showDiff:2,viewMode:4,zoom:19})}}let Qu;kt.subscribe((t=>Qu=t));const Vu=["maps","locations"],ju=["showCollisions","showBoundaries","showDiff"],Hu=["bearing","center","pitch","zoom"],Gu=["bearing","lat","lng","pitch","zoom"],$u=["map","stylePresets"];const Zu=({zoom:t,center:e,pitch:i,bearing:r})=>[zt(t,2),zt(e.lat,4),zt(e.lng,4),zt(i??0,1),zt(r??0,1)].join("/"),qu=t=>{const[e,i,r,n,o]=t.split("/");return{bearing:o,center:{lat:i,lng:r},pitch:n,zoom:e}};const Ku=t=>{let e=JSON.parse(JSON.stringify(t));if(e.maps?.length){const t=e.maps;e.maps=t.map((t=>(delete t.style,t)))}let i=Object.fromEntries(Object.entries(e).filter((([t,e])=>!Hu.includes(t)&&"locations"!==t)).map((([t,e])=>[t,Vu.includes(t)?JSON.stringify(e):e])));i=(t=>{let e=Object.keys(t).reduce(((e,i)=>{const r=t[i];return null!==r&&(e[i]=r),e}),{});return e})(i);const r=Wu(window.location.hash),n=Object.entries(i).some((t=>{let[e,i]=t;if($u.includes(e))return!1;try{i=JSON.parse(i)}catch(t){}return!Lc(i,r?.[e])}));let o={...i};o=Qu?{map:Zu(e),...o}:{locations:JSON.stringify(e.locations.map((t=>Zu(t)))),...o};return{nextHash:function(t){let e=t.map?`map=${t.map}`:"";return Object.entries(t).forEach((([t,i],r)=>{if($u.includes(t))return;let n=encodeURIComponent(i);e=`${e}${""!==e?"&":""}${t}=${n}`})),e}(o),requiresHistoryItem:n}};function Wu(t){let e=Object.fromEntries(Object.entries(function(t){const e=t.split("#")[1];if(!e)return{};let i=Object.fromEntries(e.split("&").map((t=>t.split("=").map(decodeURIComponent))));return i.map&&(i={...i,...qu(i.map)}),i.locations&&(i.locations=JSON.stringify(JSON.parse(i.locations).map((t=>qu(t))))),i}(t)).filter((([t,e])=>!!e)).map((([t,e])=>Vu.includes(t)?[t,JSON.parse(e)]:ju.includes(t)?[t,"true"===e]:Gu.includes(t)?[t,+e||0]:[t,e])));return e.map&&delete e.map,e}const Xu=t=>{const{mapState:e,maps:i,viewMode:r,stylePresets:n}=t;return{...e,viewMode:r,maps:i,stylePresets:n,...Wu(window.location.hash)}};var Ju={};Object.defineProperty(Ju,"__esModule",{value:!0}),Ju.updateStyle=ah=Ju.addLink=void 0;var Yu={};Object.defineProperty(Yu,"__esModule",{value:!0}),Yu.stamenSvg=void 0;function th(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var i=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==i)return;var r,n,o=[],s=!0,a=!1;try{for(i=i.call(t);!(s=(r=i.next()).done)&&(o.push(r.value),!e||o.length!==e);s=!0);}catch(t){a=!0,n=t}finally{try{s||null==i.return||i.return()}finally{if(a)throw n}}return o}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return eh(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return eh(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function eh(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,r=new Array(e);i<e;i++)r[i]=t[i];return r}Yu.stamenSvg='<?xml version="1.0" encoding="utf-8"?>\n\x3c!-- Generator: Adobe Illustrator 24.0.3, SVG Export Plug-In . SVG Version: 6.00 Build 0)  --\x3e\n<svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"\n\t viewBox="0 0 98.6 21.7" style="enable-background:new 0 0 98.6 21.7;" xml:space="preserve">\n<g id="palnts">\n</g>\n<path d="M4.1,14.8c0.1,0.9,0.4,1.6,0.8,2.1c0.7,0.8,1.9,1.3,3.7,1.3c1,0,1.9-0.1,2.5-0.3c1.2-0.4,1.8-1.2,1.8-2.4\n\tc0-0.7-0.3-1.2-0.9-1.6c-0.6-0.4-1.6-0.7-2.9-1l-2.2-0.5c-2.2-0.5-3.7-1-4.5-1.6C1,9.9,0.3,8.4,0.3,6.4c0-1.8,0.7-3.4,2-4.6\n\tC3.7,0.6,5.7,0,8.4,0c2.2,0,4.1,0.6,5.6,1.7c1.6,1.2,2.4,2.8,2.4,5h-4.1c-0.1-1.2-0.6-2.1-1.7-2.6C9.9,3.7,9.1,3.6,8.1,3.6\n\tc-1.1,0-2,0.2-2.7,0.7s-1,1.1-1,1.9c0,0.7,0.3,1.3,1,1.6C5.7,8,6.7,8.3,8.1,8.6l3.6,0.9c1.6,0.4,2.8,0.9,3.6,1.5\n\tc1.2,1,1.8,2.4,1.8,4.2c0,1.9-0.7,3.4-2.2,4.7c-1.5,1.2-3.5,1.9-6.2,1.9S3.9,21.2,2.3,20C0.8,18.7,0,17,0,14.8H4.1z" fill=\'white\'/>\n<path d="M17.6,8.9V6.1h2.1V1.9h3.9v4.2h2.5v2.8h-2.5v8c0,0.6,0.1,1,0.2,1.2c0.2,0.2,0.6,0.2,1.5,0.2c0.1,0,0.2,0,0.4,0\n\tc0.1,0,0.3,0,0.4,0v3l-1.9,0.1c-1.9,0.1-3.2-0.3-3.9-1c-0.4-0.5-0.7-1.2-0.7-2.1V8.9H17.6z" fill=\'white\'/>\n<path d="M34.8,11.9c0.7-0.1,1.3-0.2,1.6-0.3c0.6-0.2,0.9-0.6,0.9-1.1c0-0.6-0.2-1.1-0.7-1.3s-1.1-0.4-1.9-0.4c-1,0-1.6,0.2-2,0.7\n\tc-0.3,0.3-0.5,0.8-0.6,1.4h-3.8c0.1-1.3,0.5-2.4,1.1-3.3c1.1-1.3,2.9-2,5.4-2c1.7,0,3.2,0.3,4.5,1s1.9,1.9,1.9,3.7v7\n\tc0,0.5,0,1.1,0,1.8c0,0.5,0.1,0.9,0.2,1.1s0.3,0.3,0.6,0.5v0.6h-4.3c-0.1-0.3-0.2-0.6-0.3-0.9c0-0.3-0.1-0.6-0.1-0.9\n\tc-0.6,0.6-1.2,1.1-1.9,1.5c-0.9,0.5-1.8,0.7-2.9,0.7c-1.4,0-2.5-0.4-3.4-1.2c-0.9-0.8-1.4-1.9-1.4-3.3c0-1.9,0.7-3.2,2.2-4.1\n\tc0.8-0.5,2-0.8,3.5-1L34.8,11.9z M37.2,13.8c-0.3,0.2-0.5,0.3-0.8,0.4c-0.3,0.1-0.6,0.2-1.1,0.3l-0.9,0.2c-0.8,0.1-1.5,0.3-1.8,0.5\n\tc-0.6,0.4-0.9,0.9-0.9,1.7c0,0.7,0.2,1.2,0.6,1.5c0.4,0.3,0.8,0.5,1.4,0.5c0.9,0,1.7-0.3,2.4-0.8s1.1-1.4,1.1-2.8\n\tC37.2,15.3,37.2,13.8,37.2,13.8z" fill=\'white\'/>\n<path d="M63.1,6c0.7,0.3,1.2,0.7,1.8,1.4c0.4,0.5,0.7,1.2,0.9,2c0.1,0.5,0.1,1.3,0.1,2.2v9.6h-4.1v-9.7c0-0.6-0.1-1.1-0.3-1.4\n\tc-0.4-0.7-1-1.1-2-1.1c-1.1,0-1.9,0.5-2.3,1.4c-0.2,0.5-0.3,1.1-0.3,1.7v9.1h-4v-9.1c0-0.9-0.1-1.6-0.3-2c-0.3-0.7-1-1.1-2-1.1\n\tc-1.1,0-1.9,0.4-2.3,1.1c-0.2,0.4-0.3,1-0.3,1.9v9.2h-4V6h3.9v2.2c0.5-0.8,1-1.4,1.4-1.7c0.8-0.6,1.8-0.9,3-0.9s2.1,0.3,2.8,0.8\n\tc0.6,0.5,1,1.1,1.3,1.8c0.5-0.9,1.2-1.6,1.9-2C59.1,5.8,60,5.6,61,5.6C61.7,5.6,62.4,5.8,63.1,6z" fill=\'white\'/>\n<path d="M78.9,6.3c1.1,0.5,1.9,1.2,2.6,2.3c0.6,0.9,1,2,1.2,3.1c0.1,0.7,0.2,1.7,0.1,3H71.7c0.1,1.5,0.6,2.6,1.6,3.2\n\tc0.6,0.4,1.3,0.6,2.2,0.6c0.9,0,1.6-0.2,2.2-0.7c0.3-0.3,0.6-0.6,0.8-1h4.1c-0.1,0.9-0.6,1.8-1.5,2.8c-1.4,1.5-3.3,2.2-5.7,2.2\n\tc-2,0-3.8-0.6-5.4-1.9s-2.3-3.3-2.3-6.1c0-2.6,0.7-4.7,2.1-6.1s3.2-2.1,5.4-2.1C76.6,5.6,77.8,5.8,78.9,6.3z M72.9,9.7\n\tc-0.6,0.6-0.9,1.4-1.1,2.4h6.9c-0.1-1.1-0.4-1.9-1.1-2.4s-1.4-0.8-2.4-0.8C74.2,8.8,73.5,9.1,72.9,9.7z" fill=\'white\'/>\n<path d="M97.1,6.8c1,0.8,1.5,2.2,1.5,4.1v10.3h-4.1v-9.3c0-0.8-0.1-1.4-0.3-1.8c-0.4-0.8-1.1-1.2-2.2-1.2c-1.3,0-2.3,0.6-2.8,1.7\n\tC89,11.2,88.8,12,88.8,13v8.2h-4V6h3.9v2.2c0.5-0.8,1-1.3,1.4-1.7C91,5.9,92,5.6,93.3,5.6C94.8,5.6,96.1,6,97.1,6.8z" fill=\'white\'/>\n</svg>';var ih=function(t,e){Object.entries(e).forEach((function(e){var i=th(e,2),r=i[0],n=i[1];t.style[r]=n}))},rh=document.createElement("img");rh.src="data:image/svg+xml;charset=utf-8,".concat(Yu.stamenSvg);var nh=document.createElement("a");nh.href="https://stamen.com";var oh=document.createElement("div");ih(rh,{height:"24px",position:"absolute",bottom:"-1px"});ih(nh,{width:"110px",position:"relative"});ih(oh,{position:"fixed",bottom:"0px",right:"12px",zIndex:1e4,display:"flex",flexDirection:"row-reverse"}),nh.appendChild(rh),oh.appendChild(nh),document.body.appendChild(oh);Ju.updateStyle=function(t){for(var e=0,i=Object.entries(t);e<i.length;e++){var r=th(i[e],2),n=r[0],o=r[1];oh.style[n]=o}};var sh=!1,ah=Ju.addLink=function(t,e){nh.style.marginRight="6px";var i=document.createElement("a");i.innerHTML=e,i.href=t;var r=document.createElement("div");r.innerHTML=sh?"|":" ",oh.appendChild(r),oh.appendChild(i);var n={color:"white",marginRight:"6px",marginBottom:"6px",fontSize:"14px"};ih(i,n),ih(r,n),sh=!0};function lh(t){let e,r,n,o,s,a,l,c,u,h;o=new cu({props:{maps:t[2],mapState:t[1],viewMode:t[0].viewMode}}),o.$on("mapState",t[4]),o.$on("setDimensions",t[6]);const d=[{mapboxGlAccessToken:t[3]},t[1],{viewMode:t[0].viewMode}];let p={};for(let t=0;t<d.length;t+=1)p=i(p,d[t]);return u=new Nu({props:p}),u.$on("mapState",t[4]),u.$on("viewMode",t[5]),{c(){e=b("base"),r=B(),n=b("main"),ht(o.$$.fragment),s=B(),a=b("div"),l=B(),c=b("div"),ht(u.$$.fragment),S(e,"href","/"),S(a,"class","attribution-space svelte-bsitwh"),S(c,"class","map-controls-container svelte-bsitwh"),S(n,"class","svelte-bsitwh")},m(t,i){_(document.head,e),y(t,r,i),y(t,n,i),dt(o,n,null),_(n,s),_(n,a),_(n,l),_(n,c),dt(u,c,null),h=!0},p(t,[e]){const i={};4&e&&(i.maps=t[2]),2&e&&(i.mapState=t[1]),1&e&&(i.viewMode=t[0].viewMode),o.$set(i);const r=11&e?ct(d,[8&e&&{mapboxGlAccessToken:t[3]},2&e&&ut(t[1]),1&e&&{viewMode:t[0].viewMode}]):{};u.$set(r)},i(t){h||(at(o.$$.fragment,t),at(u.$$.fragment,t),h=!0)},o(t){lt(o.$$.fragment,t),lt(u.$$.fragment,t),h=!1},d(t){v(e),t&&v(r),t&&v(n),pt(o),pt(u)}}}function ch(t,e,i){let r;l(t,Pt,(t=>i(9,r=t))),ah("https://stamen.com/blog/","Learn more"),ah("https://github.com/stamen/maperture","Fork on Github");let{localConfig:n}=e;const o=(t=>({maps:[{id:"mapbox-streets",name:"Mapbox Streets",type:"mapbox-gl",url:"mapbox://styles/mapbox/streets-v11"},{id:"mapbox-light",name:"Mapbox Light",type:"mapbox-gl",url:"mapbox://styles/mapbox/light-v10"}].map(((e,i)=>t?.stylePresets?.[i]??e)),mapState:{bearing:0,center:{lng:-73.92169,lat:40.83962},pitch:0,showCollisions:!1,showBoundaries:!1,showDiff:!1,zoom:13.25},viewMode:"swipe",gazetteer:{Scenarios:[{"Zoomed out":{pitch:0,zoom:10}},{"Zoomed in/Tilted":{pitch:45,zoom:16}}],Locations:[{"San Francisco, CA":{zoom:18,center:{lng:-122.4193,lat:37.7648}}},{"Washington DC":{zoom:12,center:{lng:-77.0435,lat:38.9098}}}]},branchPatterns:[{pattern:"",styles:[]}],stylePresetUrls:[],...t}))(n),{mapboxGlAccessToken:s,stylePresetUrls:a}=o;It.set(o);let c=Xu(o),u={},h=!1;const d=()=>location.hash.slice(1)!==Ku(c)?.nextHash;Ct.set(c.maps.map(((t,e)=>({...t,index:e})))),St.set(c.stylePresets),Pt.set(c?.locations??null),r&&r.length&&kt.set(!1);let p=[];Q((()=>{a.length>0&&a.forEach((async t=>{const e=await(async t=>{const e=await fetch(t),i=await e.json();return Lt(i)?i:(console.warn(`Style presets at ${t} is not valid, check the format`),[])})(t);St.update((t=>[...t,...e]))}))})),window.addEventListener("hashchange",(()=>{if(!h&&d()){const t=Xu(o);if(i(0,c=t),c.maps.length){const t=c.maps.map(((t,e)=>({...t,index:e})));Ct.set(t)}}h=!1})),Ct.subscribe((t=>{const e=JSON.parse(JSON.stringify(t)).map((t=>(delete t.isPolling,t)));i(0,c={...c,maps:e})})),Pt.subscribe((t=>{i(0,c={...c,locations:t})})),kt.subscribe((t=>{if(!t&&!r){const t=p.map((()=>u));Pt.set(t)}t&&r&&Pt.set(null)}));const f=te((()=>{d()&&(h=!0,function(t){const{nextHash:e,requiresHistoryItem:i}=Ku(t);i?window.location.hash=e:window.location.replace(`${window.location.pathname}#${e}`)}(c))}),250);return vt.setRTLTextPlugin("https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-rtl-text/v0.2.0/mapbox-gl-rtl-text.js"),wt.setRTLTextPlugin("https://unpkg.com/@mapbox/mapbox-gl-rtl-text@0.2.3/mapbox-gl-rtl-text.min.js"),t.$$set=t=>{"localConfig"in t&&i(7,n=t.localConfig)},t.$$.update=()=>{5&t.$$.dirty&&(Lc(p,c.maps)||i(2,p=c.maps)),6&t.$$.dirty&&i(1,u=kc(u,p)),1&t.$$.dirty&&c&&f(),1&t.$$.dirty&&(c||height||width)&&i(1,u=(()=>{const{bearing:t,center:e,pitch:i,showCollisions:r,showBoundaries:n,showDiff:o,zoom:s,height:a,width:l}=c;return{bearing:t,center:e,pitch:i,showCollisions:r,showBoundaries:n,showDiff:o,zoom:s,...a&&{height:a},...l&&{width:l}}})())},[c,u,p,s,t=>{let e={...u,...t.detail.options};i(0,c={...c,...kc(e,p)})},t=>{i(0,c={...c,viewMode:t.detail.mode})},t=>{i(0,c={...c,...t.detail})},n]}class uh extends At{constructor(t){super(),ft(this,t,ch,lh,a,{localConfig:7})}}const hh=(t,e)=>new uh({target:t,props:e});var dh=Object.freeze({__proto__:null,default:undefined}),ph=Object.freeze({__proto__:null,default:undefined}),fh={exports:{}};fh.exports=function(){var t={},e={};function i(i,r,n){if(e[i]=n,"index"===i){var o="var sharedModule = {}; ("+e.shared+")(sharedModule); ("+e.worker+")(sharedModule);",s={};return e.shared(s),e.index(t,s),"undefined"!=typeof window&&t.setWorkerUrl(window.URL.createObjectURL(new Blob([o],{type:"text/javascript"}))),t}}i("shared",["exports"],(function(t){function e(t,e,i,r){return new(i||(i=Promise))((function(n,o){function s(t){try{l(r.next(t))}catch(t){o(t)}}function a(t){try{l(r.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(s,a)}l((r=r.apply(t,e||[])).next())}))}function i(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}"function"==typeof SuppressedError&&SuppressedError;var r=n;function n(t,e){this.x=t,this.y=e}n.prototype={clone:function(){return new n(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,i=t.y-this.y;return e*e+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=e,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),i=Math.sin(t),r=i*this.x+e*this.y;return this.x=e*this.x-i*this.y,this.y=r,this},_rotateAround:function(t,e){var i=Math.cos(t),r=Math.sin(t),n=e.y+r*(this.x-e.x)+i*(this.y-e.y);return this.x=e.x+i*(this.x-e.x)-r*(this.y-e.y),this.y=n,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},n.convert=function(t){return t instanceof n?t:Array.isArray(t)?new n(t[0],t[1]):t};var o=i(r),s=a;function a(t,e,i,r){this.cx=3*t,this.bx=3*(i-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(r-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=e,this.p2x=i,this.p2y=r}a.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,e){if(void 0===e&&(e=1e-6),t<0)return 0;if(t>1)return 1;for(var i=t,r=0;r<8;r++){var n=this.sampleCurveX(i)-t;if(Math.abs(n)<e)return i;var o=this.sampleCurveDerivativeX(i);if(Math.abs(o)<1e-6)break;i-=n/o}var s=0,a=1;for(i=t,r=0;r<20&&(n=this.sampleCurveX(i),!(Math.abs(n-t)<e));r++)t>n?s=i:a=i,i=.5*(a-s)+s;return i},solve:function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))}};var l=i(s);let c,u;function h(){return null==c&&(c="undefined"!=typeof OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof createImageBitmap),c}function d(){if(null==u&&(u=!1,h())){const t=5,e=new OffscreenCanvas(t,t).getContext("2d",{willReadFrequently:!0});if(e){for(let i=0;i<t*t;i++){const r=4*i;e.fillStyle=`rgb(${r},${r+1},${r+2})`,e.fillRect(i%t,Math.floor(i/t),1,1)}const i=e.getImageData(0,0,t,t).data;for(let e=0;e<t*t*4;e++)if(e%4!=3&&i[e]!==e){u=!0;break}}}return u||!1}function p(t,e,i,r){const n=new l(t,e,i,r);return t=>n.solve(t)}const f=p(.25,.1,.25,1);function A(t,e,i){return Math.min(i,Math.max(e,t))}function m(t,e,i){const r=i-e,n=((t-e)%r+r)%r+e;return n===e?i:n}function g(t,...e){for(const i of e)for(const e in i)t[e]=i[e];return t}let _=1;function y(t,e,i){const r={};for(const i in t)r[i]=e.call(this,t[i],i,t);return r}function v(t,e,i){const r={};for(const i in t)e.call(this,t[i],i,t)&&(r[i]=t[i]);return r}function x(t){return Array.isArray(t)?t.map(x):"object"==typeof t&&t?y(t,x):t}const b={};function w(t){b[t]||("undefined"!=typeof console&&console.warn(t),b[t]=!0)}function T(t,e,i){return(i.y-t.y)*(e.x-t.x)>(e.y-t.y)*(i.x-t.x)}function B(t){return"undefined"!=typeof WorkerGlobalScope&&void 0!==t&&t instanceof WorkerGlobalScope}let E=null;function C(t){return"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap}const S="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function I(t,i,r,n,o){return e(this,void 0,void 0,(function*(){if("undefined"==typeof VideoFrame)throw new Error("VideoFrame not supported");const e=new VideoFrame(t,{timestamp:0});try{const s=null==e?void 0:e.format;if(!s||!s.startsWith("BGR")&&!s.startsWith("RGB"))throw new Error(`Unrecognized format ${s}`);const a=s.startsWith("BGR"),l=new Uint8ClampedArray(n*o*4);if(yield e.copyTo(l,function(t,e,i,r,n){const o=4*Math.max(-e,0),s=(Math.max(0,i)-i)*r*4+o,a=4*r,l=Math.max(0,e),c=Math.max(0,i);return{rect:{x:l,y:c,width:Math.min(t.width,e+r)-l,height:Math.min(t.height,i+n)-c},layout:[{offset:s,stride:a}]}}(t,i,r,n,o)),a)for(let t=0;t<l.length;t+=4){const e=l[t];l[t]=l[t+2],l[t+2]=e}return l}finally{e.close()}}))}let M,k;const P="AbortError";function L(){return new Error(P)}const z={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function F(t){return z.REGISTERED_PROTOCOLS[t.substring(0,t.indexOf("://"))]}const D="global-dispatcher";class R extends Error{constructor(t,e,i,r){super(`AJAXError: ${e} (${t}): ${i}`),this.status=t,this.statusText=e,this.url=i,this.body=r}}const U=()=>B(self)?self.worker&&self.worker.referrer:("blob:"===window.location.protocol?window.parent:window).location.href,O=function(t,i){if(/:\/\//.test(t.url)&&!/^https?:|^file:/.test(t.url)){const e=F(t.url);if(e)return e(t,i);if(B(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:t,targetMapId:D},i)}if(!(/^file:/.test(r=t.url)||/^file:/.test(U())&&!/^\w+:/.test(r))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(t,i){return e(this,void 0,void 0,(function*(){const e=new Request(t.url,{method:t.method||"GET",body:t.body,credentials:t.credentials,headers:t.headers,cache:t.cache,referrer:U(),signal:i.signal});"json"!==t.type||e.headers.has("Accept")||e.headers.set("Accept","application/json");const r=yield fetch(e);if(!r.ok){const e=yield r.blob();throw new R(r.status,r.statusText,t.url,e)}let n;n="arrayBuffer"===t.type||"image"===t.type?r.arrayBuffer():"json"===t.type?r.json():r.text();const o=yield n;if(i.signal.aborted)throw L();return{data:o,cacheControl:r.headers.get("Cache-Control"),expires:r.headers.get("Expires")}}))}(t,i);if(B(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:t,mustQueue:!0,targetMapId:D},i)}var r;return function(t,e){return new Promise(((i,r)=>{var n;const o=new XMLHttpRequest;o.open(t.method||"GET",t.url,!0),"arrayBuffer"!==t.type&&"image"!==t.type||(o.responseType="arraybuffer");for(const e in t.headers)o.setRequestHeader(e,t.headers[e]);"json"===t.type&&(o.responseType="text",(null===(n=t.headers)||void 0===n?void 0:n.Accept)||o.setRequestHeader("Accept","application/json")),o.withCredentials="include"===t.credentials,o.onerror=()=>{r(new Error(o.statusText))},o.onload=()=>{if(!e.signal.aborted)if((o.status>=200&&o.status<300||0===o.status)&&null!==o.response){let e=o.response;if("json"===t.type)try{e=JSON.parse(o.response)}catch(t){return void r(t)}i({data:e,cacheControl:o.getResponseHeader("Cache-Control"),expires:o.getResponseHeader("Expires")})}else{const e=new Blob([o.response],{type:o.getResponseHeader("Content-Type")});r(new R(o.status,o.statusText,t.url,e))}},e.signal.addEventListener("abort",(()=>{o.abort(),r(L())})),o.send(t.body)}))}(t,i)};function N(t){if(!t||t.indexOf("://")<=0||0===t.indexOf("data:image/")||0===t.indexOf("blob:"))return!0;const e=new URL(t),i=window.location;return e.protocol===i.protocol&&e.host===i.host}function Q(t,e,i){i[t]&&-1!==i[t].indexOf(e)||(i[t]=i[t]||[],i[t].push(e))}function V(t,e,i){if(i&&i[t]){const r=i[t].indexOf(e);-1!==r&&i[t].splice(r,1)}}class j{constructor(t,e={}){g(this,e),this.type=t}}class H extends j{constructor(t,e={}){super("error",g({error:t},e))}}class G{on(t,e){return this._listeners=this._listeners||{},Q(t,e,this._listeners),this}off(t,e){return V(t,e,this._listeners),V(t,e,this._oneTimeListeners),this}once(t,e){return e?(this._oneTimeListeners=this._oneTimeListeners||{},Q(t,e,this._oneTimeListeners),this):new Promise((e=>this.once(t,e)))}fire(t,e){"string"==typeof t&&(t=new j(t,e||{}));const i=t.type;if(this.listens(i)){t.target=this;const e=this._listeners&&this._listeners[i]?this._listeners[i].slice():[];for(const i of e)i.call(this,t);const r=this._oneTimeListeners&&this._oneTimeListeners[i]?this._oneTimeListeners[i].slice():[];for(const e of r)V(i,e,this._oneTimeListeners),e.call(this,t);const n=this._eventedParent;n&&(g(t,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),n.fire(t))}else t instanceof H&&console.error(t.error);return this}listens(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)}setEventedParent(t,e){return this._eventedParent=t,this._eventedParentData=e,this}}var $={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"enum",default:"mercator",values:{mercator:{},globe:{}}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const Z=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function q(t,e){const i={};for(const e in t)"ref"!==e&&(i[e]=t[e]);return Z.forEach((t=>{t in e&&(i[t]=e[t])})),i}function K(t,e){if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let i=0;i<t.length;i++)if(!K(t[i],e[i]))return!1;return!0}if("object"==typeof t&&null!==t&&null!==e){if("object"!=typeof e)return!1;if(Object.keys(t).length!==Object.keys(e).length)return!1;for(const i in t)if(!K(t[i],e[i]))return!1;return!0}return t===e}function W(t,e){t.push(e)}function X(t,e,i){W(i,{command:"addSource",args:[t,e[t]]})}function J(t,e,i){W(e,{command:"removeSource",args:[t]}),i[t]=!0}function Y(t,e,i,r){J(t,i,r),X(t,e,i)}function tt(t,e,i){let r;for(r in t[i])if(Object.prototype.hasOwnProperty.call(t[i],r)&&"data"!==r&&!K(t[i][r],e[i][r]))return!1;for(r in e[i])if(Object.prototype.hasOwnProperty.call(e[i],r)&&"data"!==r&&!K(t[i][r],e[i][r]))return!1;return!0}function et(t,e,i,r,n,o){t=t||{},e=e||{};for(const s in t)Object.prototype.hasOwnProperty.call(t,s)&&(K(t[s],e[s])||i.push({command:o,args:[r,s,e[s],n]}));for(const s in e)Object.prototype.hasOwnProperty.call(e,s)&&!Object.prototype.hasOwnProperty.call(t,s)&&(K(t[s],e[s])||i.push({command:o,args:[r,s,e[s],n]}))}function it(t){return t.id}function rt(t,e){return t[e.id]=e,t}class nt{constructor(t,e,i,r){this.message=(t?`${t}: `:"")+i,r&&(this.identifier=r),null!=e&&e.__line__&&(this.line=e.__line__)}}function ot(t,...e){for(const i of e)for(const e in i)t[e]=i[e];return t}class st extends Error{constructor(t,e){super(e),this.message=e,this.key=t}}class at{constructor(t,e=[]){this.parent=t,this.bindings={};for(const[t,i]of e)this.bindings[t]=i}concat(t){return new at(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const lt={kind:"null"},ct={kind:"number"},ut={kind:"string"},ht={kind:"boolean"},dt={kind:"color"},pt={kind:"object"},ft={kind:"value"},At={kind:"collator"},mt={kind:"formatted"},gt={kind:"padding"},_t={kind:"resolvedImage"},yt={kind:"variableAnchorOffsetCollection"};function vt(t,e){return{kind:"array",itemType:t,N:e}}function xt(t){if("array"===t.kind){const e=xt(t.itemType);return"number"==typeof t.N?`array<${e}, ${t.N}>`:"value"===t.itemType.kind?"array":`array<${e}>`}return t.kind}const bt=[lt,ct,ut,ht,dt,mt,pt,vt(ft),gt,_t,yt];function wt(t,e){if("error"===e.kind)return null;if("array"===t.kind){if("array"===e.kind&&(0===e.N&&"value"===e.itemType.kind||!wt(t.itemType,e.itemType))&&("number"!=typeof t.N||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if("value"===t.kind)for(const t of bt)if(!wt(t,e))return null}return`Expected ${xt(t)} but found ${xt(e)} instead.`}function Tt(t,e){return e.some((e=>e.kind===t.kind))}function Bt(t,e){return e.some((e=>"null"===e?null===t:"array"===e?Array.isArray(t):"object"===e?t&&!Array.isArray(t)&&"object"==typeof t:e===typeof t))}function Et(t,e){return"array"===t.kind&&"array"===e.kind?t.itemType.kind===e.itemType.kind&&"number"==typeof t.N:t.kind===e.kind}const Ct=.96422,St=.82521,It=4/29,Mt=6/29,kt=3*Mt*Mt,Pt=Mt*Mt*Mt,Lt=Math.PI/180,zt=180/Math.PI;function Ft(t){return(t%=360)<0&&(t+=360),t}function Dt([t,e,i,r]){let n,o;const s=Ut((.2225045*(t=Rt(t))+.7168786*(e=Rt(e))+.0606169*(i=Rt(i)))/1);t===e&&e===i?n=o=s:(n=Ut((.4360747*t+.3850649*e+.1430804*i)/Ct),o=Ut((.0139322*t+.0971045*e+.7141733*i)/St));const a=116*s-16;return[a<0?0:a,500*(n-s),200*(s-o),r]}function Rt(t){return t<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function Ut(t){return t>Pt?Math.pow(t,1/3):t/kt+It}function Ot([t,e,i,r]){let n=(t+16)/116,o=isNaN(e)?n:n+e/500,s=isNaN(i)?n:n-i/200;return n=1*Qt(n),o=Ct*Qt(o),s=St*Qt(s),[Nt(3.1338561*o-1.6168667*n-.4906146*s),Nt(-.9787684*o+1.9161415*n+.033454*s),Nt(.0719453*o-.2289914*n+1.4052427*s),r]}function Nt(t){return(t=t<=.00304?12.92*t:1.055*Math.pow(t,1/2.4)-.055)<0?0:t>1?1:t}function Qt(t){return t>Mt?t*t*t:kt*(t-It)}function Vt(t){return parseInt(t.padEnd(2,t),16)/255}function jt(t,e){return Ht(e?t/100:t,0,1)}function Ht(t,e,i){return Math.min(Math.max(e,t),i)}function Gt(t){return!t.some(Number.isNaN)}const $t={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class Zt{constructor(t,e,i,r=1,n=!0){this.r=t,this.g=e,this.b=i,this.a=r,n||(this.r*=r,this.g*=r,this.b*=r,r||this.overwriteGetter("rgb",[t,e,i,r]))}static parse(t){if(t instanceof Zt)return t;if("string"!=typeof t)return;const e=function(t){if("transparent"===(t=t.toLowerCase().trim()))return[0,0,0,0];const e=$t[t];if(e){const[t,i,r]=e;return[t/255,i/255,r/255,1]}if(t.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(t)){const e=t.length<6?1:2;let i=1;return[Vt(t.slice(i,i+=e)),Vt(t.slice(i,i+=e)),Vt(t.slice(i,i+=e)),Vt(t.slice(i,i+e)||"ff")]}if(t.startsWith("rgb")){const e=t.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(e){const[t,i,r,n,o,s,a,l,c,u,h,d]=e,p=[n||" ",a||" ",u].join("");if("  "===p||"  /"===p||",,"===p||",,,"===p){const t=[r,s,c].join(""),e="%%%"===t?100:""===t?255:0;if(e){const t=[Ht(+i/e,0,1),Ht(+o/e,0,1),Ht(+l/e,0,1),h?jt(+h,d):1];if(Gt(t))return t}}return}}const i=t.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(i){const[t,e,r,n,o,s,a,l,c]=i,u=[r||" ",o||" ",a].join("");if("  "===u||"  /"===u||",,"===u||",,,"===u){const t=[+e,Ht(+n,0,100),Ht(+s,0,100),l?jt(+l,c):1];if(Gt(t))return function([t,e,i,r]){function n(r){const n=(r+t/30)%12,o=e*Math.min(i,1-i);return i-o*Math.max(-1,Math.min(n-3,9-n,1))}return t=Ft(t),e/=100,i/=100,[n(0),n(8),n(4),r]}(t)}}}(t);return e?new Zt(...e,!1):void 0}get rgb(){const{r:t,g:e,b:i,a:r}=this,n=r||1/0;return this.overwriteGetter("rgb",[t/n,e/n,i/n,r])}get hcl(){return this.overwriteGetter("hcl",function(t){const[e,i,r,n]=Dt(t),o=Math.sqrt(i*i+r*r);return[Math.round(1e4*o)?Ft(Math.atan2(r,i)*zt):NaN,o,e,n]}(this.rgb))}get lab(){return this.overwriteGetter("lab",Dt(this.rgb))}overwriteGetter(t,e){return Object.defineProperty(this,t,{value:e}),e}toString(){const[t,e,i,r]=this.rgb;return`rgba(${[t,e,i].map((t=>Math.round(255*t))).join(",")},${r})`}}Zt.black=new Zt(0,0,0,1),Zt.white=new Zt(1,1,1,1),Zt.transparent=new Zt(0,0,0,0),Zt.red=new Zt(1,0,0,1);class qt{constructor(t,e,i){this.sensitivity=t?e?"variant":"case":e?"accent":"base",this.locale=i,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,e){return this.collator.compare(t,e)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Kt{constructor(t,e,i,r,n){this.text=t,this.image=e,this.scale=i,this.fontStack=r,this.textColor=n}}class Wt{constructor(t){this.sections=t}static fromString(t){return new Wt([new Kt(t,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some((t=>0!==t.text.length||t.image&&0!==t.image.name.length))}static factory(t){return t instanceof Wt?t:Wt.fromString(t)}toString(){return 0===this.sections.length?"":this.sections.map((t=>t.text)).join("")}}class Xt{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof Xt)return t;if("number"==typeof t)return new Xt([t,t,t,t]);if(Array.isArray(t)&&!(t.length<1||t.length>4)){for(const e of t)if("number"!=typeof e)return;switch(t.length){case 1:t=[t[0],t[0],t[0],t[0]];break;case 2:t=[t[0],t[1],t[0],t[1]];break;case 3:t=[t[0],t[1],t[2],t[1]]}return new Xt(t)}}toString(){return JSON.stringify(this.values)}}const Jt=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Yt{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof Yt)return t;if(Array.isArray(t)&&!(t.length<1)&&t.length%2==0){for(let e=0;e<t.length;e+=2){const i=t[e],r=t[e+1];if("string"!=typeof i||!Jt.has(i))return;if(!Array.isArray(r)||2!==r.length||"number"!=typeof r[0]||"number"!=typeof r[1])return}return new Yt(t)}}toString(){return JSON.stringify(this.values)}}class te{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new te({name:t,available:!1}):null}}function ee(t,e,i,r){return"number"==typeof t&&t>=0&&t<=255&&"number"==typeof e&&e>=0&&e<=255&&"number"==typeof i&&i>=0&&i<=255?void 0===r||"number"==typeof r&&r>=0&&r<=1?null:`Invalid rgba value [${[t,e,i,r].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof r?[t,e,i,r]:[t,e,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function ie(t){if(null===t||"string"==typeof t||"boolean"==typeof t||"number"==typeof t||t instanceof Zt||t instanceof qt||t instanceof Wt||t instanceof Xt||t instanceof Yt||t instanceof te)return!0;if(Array.isArray(t)){for(const e of t)if(!ie(e))return!1;return!0}if("object"==typeof t){for(const e in t)if(!ie(t[e]))return!1;return!0}return!1}function re(t){if(null===t)return lt;if("string"==typeof t)return ut;if("boolean"==typeof t)return ht;if("number"==typeof t)return ct;if(t instanceof Zt)return dt;if(t instanceof qt)return At;if(t instanceof Wt)return mt;if(t instanceof Xt)return gt;if(t instanceof Yt)return yt;if(t instanceof te)return _t;if(Array.isArray(t)){const e=t.length;let i;for(const e of t){const t=re(e);if(i){if(i===t)continue;i=ft;break}i=t}return vt(i||ft,e)}return pt}function ne(t){const e=typeof t;return null===t?"":"string"===e||"number"===e||"boolean"===e?String(t):t instanceof Zt||t instanceof Wt||t instanceof Xt||t instanceof Yt||t instanceof te?t.toString():JSON.stringify(t)}class oe{constructor(t,e){this.type=t,this.value=e}static parse(t,e){if(2!==t.length)return e.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!ie(t[1]))return e.error("invalid value");const i=t[1];let r=re(i);const n=e.expectedType;return"array"!==r.kind||0!==r.N||!n||"array"!==n.kind||"number"==typeof n.N&&0!==n.N||(r=n),new oe(r,i)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class se{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}}const ae={string:ut,number:ct,boolean:ht,object:pt};class le{constructor(t,e){this.type=t,this.args=e}static parse(t,e){if(t.length<2)return e.error("Expected at least one argument.");let i,r=1;const n=t[0];if("array"===n){let n,o;if(t.length>2){const i=t[1];if("string"!=typeof i||!(i in ae)||"object"===i)return e.error('The item type argument of "array" must be one of string, number, boolean',1);n=ae[i],r++}else n=ft;if(t.length>3){if(null!==t[2]&&("number"!=typeof t[2]||t[2]<0||t[2]!==Math.floor(t[2])))return e.error('The length argument to "array" must be a positive integer literal',2);o=t[2],r++}i=vt(n,o)}else{if(!ae[n])throw new Error(`Types doesn't contain name = ${n}`);i=ae[n]}const o=[];for(;r<t.length;r++){const i=e.parse(t[r],r,ft);if(!i)return null;o.push(i)}return new le(i,o)}evaluate(t){for(let e=0;e<this.args.length;e++){const i=this.args[e].evaluate(t);if(!wt(this.type,re(i)))return i;if(e===this.args.length-1)throw new se(`Expected value to be of type ${xt(this.type)}, but found ${xt(re(i))} instead.`)}throw new Error}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}}const ce={"to-boolean":ht,"to-color":dt,"to-number":ct,"to-string":ut};class ue{constructor(t,e){this.type=t,this.args=e}static parse(t,e){if(t.length<2)return e.error("Expected at least one argument.");const i=t[0];if(!ce[i])throw new Error(`Can't parse ${i} as it is not part of the known types`);if(("to-boolean"===i||"to-string"===i)&&2!==t.length)return e.error("Expected one argument.");const r=ce[i],n=[];for(let i=1;i<t.length;i++){const r=e.parse(t[i],i,ft);if(!r)return null;n.push(r)}return new ue(r,n)}evaluate(t){switch(this.type.kind){case"boolean":return Boolean(this.args[0].evaluate(t));case"color":{let e,i;for(const r of this.args){if(e=r.evaluate(t),i=null,e instanceof Zt)return e;if("string"==typeof e){const i=t.parseColor(e);if(i)return i}else if(Array.isArray(e)&&(i=e.length<3||e.length>4?`Invalid rbga value ${JSON.stringify(e)}: expected an array containing either three or four numeric values.`:ee(e[0],e[1],e[2],e[3]),!i))return new Zt(e[0]/255,e[1]/255,e[2]/255,e[3])}throw new se(i||`Could not parse color from value '${"string"==typeof e?e:JSON.stringify(e)}'`)}case"padding":{let e;for(const i of this.args){e=i.evaluate(t);const r=Xt.parse(e);if(r)return r}throw new se(`Could not parse padding from value '${"string"==typeof e?e:JSON.stringify(e)}'`)}case"variableAnchorOffsetCollection":{let e;for(const i of this.args){e=i.evaluate(t);const r=Yt.parse(e);if(r)return r}throw new se(`Could not parse variableAnchorOffsetCollection from value '${"string"==typeof e?e:JSON.stringify(e)}'`)}case"number":{let e=null;for(const i of this.args){if(e=i.evaluate(t),null===e)return 0;const r=Number(e);if(!isNaN(r))return r}throw new se(`Could not convert ${JSON.stringify(e)} to number.`)}case"formatted":return Wt.fromString(ne(this.args[0].evaluate(t)));case"resolvedImage":return te.fromString(ne(this.args[0].evaluate(t)));default:return ne(this.args[0].evaluate(t))}}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}}const he=["Unknown","Point","LineString","Polygon"];class de{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?he[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(t){let e=this._parseColorCache[t];return e||(e=this._parseColorCache[t]=Zt.parse(t)),e}}class pe{constructor(t,e,i=[],r,n=new at,o=[]){this.registry=t,this.path=i,this.key=i.map((t=>`[${t}]`)).join(""),this.scope=n,this.errors=o,this.expectedType=r,this._isConstant=e}parse(t,e,i,r,n={}){return e?this.concat(e,i,r)._parse(t,n):this._parse(t,n)}_parse(t,e){function i(t,e,i){return"assert"===i?new le(e,[t]):"coerce"===i?new ue(e,[t]):t}if(null!==t&&"string"!=typeof t&&"boolean"!=typeof t&&"number"!=typeof t||(t=["literal",t]),Array.isArray(t)){if(0===t.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const r=t[0];if("string"!=typeof r)return this.error(`Expression name must be a string, but found ${typeof r} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const n=this.registry[r];if(n){let r=n.parse(t,this);if(!r)return null;if(this.expectedType){const t=this.expectedType,n=r.type;if("string"!==t.kind&&"number"!==t.kind&&"boolean"!==t.kind&&"object"!==t.kind&&"array"!==t.kind||"value"!==n.kind)if("color"!==t.kind&&"formatted"!==t.kind&&"resolvedImage"!==t.kind||"value"!==n.kind&&"string"!==n.kind)if("padding"!==t.kind||"value"!==n.kind&&"number"!==n.kind&&"array"!==n.kind)if("variableAnchorOffsetCollection"!==t.kind||"value"!==n.kind&&"array"!==n.kind){if(this.checkSubtype(t,n))return null}else r=i(r,t,e.typeAnnotation||"coerce");else r=i(r,t,e.typeAnnotation||"coerce");else r=i(r,t,e.typeAnnotation||"coerce");else r=i(r,t,e.typeAnnotation||"assert")}if(!(r instanceof oe)&&"resolvedImage"!==r.type.kind&&this._isConstant(r)){const e=new de;try{r=new oe(r.type,r.evaluate(e))}catch(t){return this.error(t.message),null}}return r}return this.error(`Unknown expression "${r}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===t?"'undefined' value invalid. Use null instead.":"object"==typeof t?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,e,i){const r="number"==typeof t?this.path.concat(t):this.path,n=i?this.scope.concat(i):this.scope;return new pe(this.registry,this._isConstant,r,e||null,n,this.errors)}error(t,...e){const i=`${this.key}${e.map((t=>`[${t}]`)).join("")}`;this.errors.push(new st(i,t))}checkSubtype(t,e){const i=wt(t,e);return i&&this.error(i),i}}class fe{constructor(t,e){this.type=e.type,this.bindings=[].concat(t),this.result=e}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const e of this.bindings)t(e[1]);t(this.result)}static parse(t,e){if(t.length<4)return e.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const i=[];for(let r=1;r<t.length-1;r+=2){const n=t[r];if("string"!=typeof n)return e.error(`Expected string, but found ${typeof n} instead.`,r);if(/[^a-zA-Z0-9_]/.test(n))return e.error("Variable names must contain only alphanumeric characters or '_'.",r);const o=e.parse(t[r+1],r+1);if(!o)return null;i.push([n,o])}const r=e.parse(t[t.length-1],t.length-1,e.expectedType,i);return r?new fe(i,r):null}outputDefined(){return this.result.outputDefined()}}class Ae{constructor(t,e){this.type=e.type,this.name=t,this.boundExpression=e}static parse(t,e){if(2!==t.length||"string"!=typeof t[1])return e.error("'var' expression requires exactly one string literal argument.");const i=t[1];return e.scope.has(i)?new Ae(i,e.scope.get(i)):e.error(`Unknown variable "${i}". Make sure "${i}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}}class me{constructor(t,e,i){this.type=t,this.index=e,this.input=i}static parse(t,e){if(3!==t.length)return e.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const i=e.parse(t[1],1,ct),r=e.parse(t[2],2,vt(e.expectedType||ft));return i&&r?new me(r.type.itemType,i,r):null}evaluate(t){const e=this.index.evaluate(t),i=this.input.evaluate(t);if(e<0)throw new se(`Array index out of bounds: ${e} < 0.`);if(e>=i.length)throw new se(`Array index out of bounds: ${e} > ${i.length-1}.`);if(e!==Math.floor(e))throw new se(`Array index must be an integer, but found ${e} instead.`);return i[e]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}}class ge{constructor(t,e){this.type=ht,this.needle=t,this.haystack=e}static parse(t,e){if(3!==t.length)return e.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const i=e.parse(t[1],1,ft),r=e.parse(t[2],2,ft);return i&&r?Tt(i.type,[ht,ut,ct,lt,ft])?new ge(i,r):e.error(`Expected first argument to be of type boolean, string, number or null, but found ${xt(i.type)} instead`):null}evaluate(t){const e=this.needle.evaluate(t),i=this.haystack.evaluate(t);if(!i)return!1;if(!Bt(e,["boolean","string","number","null"]))throw new se(`Expected first argument to be of type boolean, string, number or null, but found ${xt(re(e))} instead.`);if(!Bt(i,["string","array"]))throw new se(`Expected second argument to be of type array or string, but found ${xt(re(i))} instead.`);return i.indexOf(e)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}}class _e{constructor(t,e,i){this.type=ct,this.needle=t,this.haystack=e,this.fromIndex=i}static parse(t,e){if(t.length<=2||t.length>=5)return e.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const i=e.parse(t[1],1,ft),r=e.parse(t[2],2,ft);if(!i||!r)return null;if(!Tt(i.type,[ht,ut,ct,lt,ft]))return e.error(`Expected first argument to be of type boolean, string, number or null, but found ${xt(i.type)} instead`);if(4===t.length){const n=e.parse(t[3],3,ct);return n?new _e(i,r,n):null}return new _e(i,r)}evaluate(t){const e=this.needle.evaluate(t),i=this.haystack.evaluate(t);if(!Bt(e,["boolean","string","number","null"]))throw new se(`Expected first argument to be of type boolean, string, number or null, but found ${xt(re(e))} instead.`);let r;if(this.fromIndex&&(r=this.fromIndex.evaluate(t)),Bt(i,["string"])){const t=i.indexOf(e,r);return-1===t?-1:[...i.slice(0,t)].length}if(Bt(i,["array"]))return i.indexOf(e,r);throw new se(`Expected second argument to be of type array or string, but found ${xt(re(i))} instead.`)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}}class ye{constructor(t,e,i,r,n,o){this.inputType=t,this.type=e,this.input=i,this.cases=r,this.outputs=n,this.otherwise=o}static parse(t,e){if(t.length<5)return e.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return e.error("Expected an even number of arguments.");let i,r;e.expectedType&&"value"!==e.expectedType.kind&&(r=e.expectedType);const n={},o=[];for(let s=2;s<t.length-1;s+=2){let a=t[s];const l=t[s+1];Array.isArray(a)||(a=[a]);const c=e.concat(s);if(0===a.length)return c.error("Expected at least one branch label.");for(const t of a){if("number"!=typeof t&&"string"!=typeof t)return c.error("Branch labels must be numbers or strings.");if("number"==typeof t&&Math.abs(t)>Number.MAX_SAFE_INTEGER)return c.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof t&&Math.floor(t)!==t)return c.error("Numeric branch labels must be integer values.");if(i){if(c.checkSubtype(i,re(t)))return null}else i=re(t);if(void 0!==n[String(t)])return c.error("Branch labels must be unique.");n[String(t)]=o.length}const u=e.parse(l,s,r);if(!u)return null;r=r||u.type,o.push(u)}const s=e.parse(t[1],1,ft);if(!s)return null;const a=e.parse(t[t.length-1],t.length-1,r);return a?"value"!==s.type.kind&&e.concat(1).checkSubtype(i,s.type)?null:new ye(i,r,s,n,o,a):null}evaluate(t){const e=this.input.evaluate(t);return(re(e)===this.inputType&&this.outputs[this.cases[e]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))&&this.otherwise.outputDefined()}}class ve{constructor(t,e,i){this.type=t,this.branches=e,this.otherwise=i}static parse(t,e){if(t.length<4)return e.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return e.error("Expected an odd number of arguments.");let i;e.expectedType&&"value"!==e.expectedType.kind&&(i=e.expectedType);const r=[];for(let n=1;n<t.length-1;n+=2){const o=e.parse(t[n],n,ht);if(!o)return null;const s=e.parse(t[n+1],n+1,i);if(!s)return null;r.push([o,s]),i=i||s.type}const n=e.parse(t[t.length-1],t.length-1,i);if(!n)return null;if(!i)throw new Error("Can't infer output type");return new ve(i,r,n)}evaluate(t){for(const[e,i]of this.branches)if(e.evaluate(t))return i.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[e,i]of this.branches)t(e),t(i);t(this.otherwise)}outputDefined(){return this.branches.every((([t,e])=>e.outputDefined()))&&this.otherwise.outputDefined()}}class xe{constructor(t,e,i,r){this.type=t,this.input=e,this.beginIndex=i,this.endIndex=r}static parse(t,e){if(t.length<=2||t.length>=5)return e.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const i=e.parse(t[1],1,ft),r=e.parse(t[2],2,ct);if(!i||!r)return null;if(!Tt(i.type,[vt(ft),ut,ft]))return e.error(`Expected first argument to be of type array or string, but found ${xt(i.type)} instead`);if(4===t.length){const n=e.parse(t[3],3,ct);return n?new xe(i.type,i,r,n):null}return new xe(i.type,i,r)}evaluate(t){const e=this.input.evaluate(t),i=this.beginIndex.evaluate(t);let r;if(this.endIndex&&(r=this.endIndex.evaluate(t)),Bt(e,["string"]))return[...e].slice(i,r).join("");if(Bt(e,["array"]))return e.slice(i,r);throw new se(`Expected first argument to be of type array or string, but found ${xt(re(e))} instead.`)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}}function be(t,e){const i=t.length-1;let r,n,o=0,s=i,a=0;for(;o<=s;)if(a=Math.floor((o+s)/2),r=t[a],n=t[a+1],r<=e){if(a===i||e<n)return a;o=a+1}else{if(!(r>e))throw new se("Input is not a number.");s=a-1}return 0}class we{constructor(t,e,i){this.type=t,this.input=e,this.labels=[],this.outputs=[];for(const[t,e]of i)this.labels.push(t),this.outputs.push(e)}static parse(t,e){if(t.length-1<4)return e.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return e.error("Expected an even number of arguments.");const i=e.parse(t[1],1,ct);if(!i)return null;const r=[];let n=null;e.expectedType&&"value"!==e.expectedType.kind&&(n=e.expectedType);for(let i=1;i<t.length;i+=2){const o=1===i?-1/0:t[i],s=t[i+1],a=i,l=i+1;if("number"!=typeof o)return e.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',a);if(r.length&&r[r.length-1][0]>=o)return e.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',a);const c=e.parse(s,l,n);if(!c)return null;n=n||c.type,r.push([o,c])}return new we(n,i,r)}evaluate(t){const e=this.labels,i=this.outputs;if(1===e.length)return i[0].evaluate(t);const r=this.input.evaluate(t);if(r<=e[0])return i[0].evaluate(t);const n=e.length;return r>=e[n-1]?i[n-1].evaluate(t):i[be(e,r)].evaluate(t)}eachChild(t){t(this.input);for(const e of this.outputs)t(e)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))}}function Te(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Be=Ee;function Ee(t,e,i,r){this.cx=3*t,this.bx=3*(i-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(r-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=e,this.p2x=i,this.p2y=r}Ee.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,e){if(void 0===e&&(e=1e-6),t<0)return 0;if(t>1)return 1;for(var i=t,r=0;r<8;r++){var n=this.sampleCurveX(i)-t;if(Math.abs(n)<e)return i;var o=this.sampleCurveDerivativeX(i);if(Math.abs(o)<1e-6)break;i-=n/o}var s=0,a=1;for(i=t,r=0;r<20&&(n=this.sampleCurveX(i),!(Math.abs(n-t)<e));r++)t>n?s=i:a=i,i=.5*(a-s)+s;return i},solve:function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))}};var Ce=Te(Be);function Se(t,e,i){return t+i*(e-t)}function Ie(t,e,i){return t.map(((t,r)=>Se(t,e[r],i)))}const Me={number:Se,color:function(t,e,i,r="rgb"){switch(r){case"rgb":{const[r,n,o,s]=Ie(t.rgb,e.rgb,i);return new Zt(r,n,o,s,!1)}case"hcl":{const[r,n,o,s]=t.hcl,[a,l,c,u]=e.hcl;let h,d;if(isNaN(r)||isNaN(a))isNaN(r)?isNaN(a)?h=NaN:(h=a,1!==o&&0!==o||(d=l)):(h=r,1!==c&&0!==c||(d=n));else{let t=a-r;a>r&&t>180?t-=360:a<r&&r-a>180&&(t+=360),h=r+i*t}const[p,f,A,m]=function([t,e,i,r]){return t=isNaN(t)?0:t*Lt,Ot([i,Math.cos(t)*e,Math.sin(t)*e,r])}([h,null!=d?d:Se(n,l,i),Se(o,c,i),Se(s,u,i)]);return new Zt(p,f,A,m,!1)}case"lab":{const[r,n,o,s]=Ot(Ie(t.lab,e.lab,i));return new Zt(r,n,o,s,!1)}}},array:Ie,padding:function(t,e,i){return new Xt(Ie(t.values,e.values,i))},variableAnchorOffsetCollection:function(t,e,i){const r=t.values,n=e.values;if(r.length!==n.length)throw new se(`Cannot interpolate values of different length. from: ${t.toString()}, to: ${e.toString()}`);const o=[];for(let t=0;t<r.length;t+=2){if(r[t]!==n[t])throw new se(`Cannot interpolate values containing mismatched anchors. from[${t}]: ${r[t]}, to[${t}]: ${n[t]}`);o.push(r[t]);const[e,s]=r[t+1],[a,l]=n[t+1];o.push([Se(e,a,i),Se(s,l,i)])}return new Yt(o)}};class ke{constructor(t,e,i,r,n){this.type=t,this.operator=e,this.interpolation=i,this.input=r,this.labels=[],this.outputs=[];for(const[t,e]of n)this.labels.push(t),this.outputs.push(e)}static interpolationFactor(t,e,i,r){let n=0;if("exponential"===t.name)n=Pe(e,t.base,i,r);else if("linear"===t.name)n=Pe(e,1,i,r);else if("cubic-bezier"===t.name){const o=t.controlPoints;n=new Ce(o[0],o[1],o[2],o[3]).solve(Pe(e,1,i,r))}return n}static parse(t,e){let[i,r,n,...o]=t;if(!Array.isArray(r)||0===r.length)return e.error("Expected an interpolation type expression.",1);if("linear"===r[0])r={name:"linear"};else if("exponential"===r[0]){const t=r[1];if("number"!=typeof t)return e.error("Exponential interpolation requires a numeric base.",1,1);r={name:"exponential",base:t}}else{if("cubic-bezier"!==r[0])return e.error(`Unknown interpolation type ${String(r[0])}`,1,0);{const t=r.slice(1);if(4!==t.length||t.some((t=>"number"!=typeof t||t<0||t>1)))return e.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);r={name:"cubic-bezier",controlPoints:t}}}if(t.length-1<4)return e.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return e.error("Expected an even number of arguments.");if(n=e.parse(n,2,ct),!n)return null;const s=[];let a=null;"interpolate-hcl"===i||"interpolate-lab"===i?a=dt:e.expectedType&&"value"!==e.expectedType.kind&&(a=e.expectedType);for(let t=0;t<o.length;t+=2){const i=o[t],r=o[t+1],n=t+3,l=t+4;if("number"!=typeof i)return e.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',n);if(s.length&&s[s.length-1][0]>=i)return e.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',n);const c=e.parse(r,l,a);if(!c)return null;a=a||c.type,s.push([i,c])}return Et(a,ct)||Et(a,dt)||Et(a,gt)||Et(a,yt)||Et(a,vt(ct))?new ke(a,i,r,n,s):e.error(`Type ${xt(a)} is not interpolatable.`)}evaluate(t){const e=this.labels,i=this.outputs;if(1===e.length)return i[0].evaluate(t);const r=this.input.evaluate(t);if(r<=e[0])return i[0].evaluate(t);const n=e.length;if(r>=e[n-1])return i[n-1].evaluate(t);const o=be(e,r),s=ke.interpolationFactor(this.interpolation,r,e[o],e[o+1]),a=i[o].evaluate(t),l=i[o+1].evaluate(t);switch(this.operator){case"interpolate":return Me[this.type.kind](a,l,s);case"interpolate-hcl":return Me.color(a,l,s,"hcl");case"interpolate-lab":return Me.color(a,l,s,"lab")}}eachChild(t){t(this.input);for(const e of this.outputs)t(e)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))}}function Pe(t,e,i,r){const n=r-i,o=t-i;return 0===n?0:1===e?o/n:(Math.pow(e,o)-1)/(Math.pow(e,n)-1)}class Le{constructor(t,e){this.type=t,this.args=e}static parse(t,e){if(t.length<2)return e.error("Expectected at least one argument.");let i=null;const r=e.expectedType;r&&"value"!==r.kind&&(i=r);const n=[];for(const r of t.slice(1)){const t=e.parse(r,1+n.length,i,void 0,{typeAnnotation:"omit"});if(!t)return null;i=i||t.type,n.push(t)}if(!i)throw new Error("No output type");const o=r&&n.some((t=>wt(r,t.type)));return new Le(o?ft:i,n)}evaluate(t){let e,i=null,r=0;for(const n of this.args)if(r++,i=n.evaluate(t),i&&i instanceof te&&!i.available&&(e||(e=i.name),i=null,r===this.args.length&&(i=e)),null!==i)break;return i}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}}function ze(t,e){return"=="===t||"!="===t?"boolean"===e.kind||"string"===e.kind||"number"===e.kind||"null"===e.kind||"value"===e.kind:"string"===e.kind||"number"===e.kind||"value"===e.kind}function Fe(t,e,i,r){return 0===r.compare(e,i)}function De(t,e,i){const r="=="!==t&&"!="!==t;return class n{constructor(t,e,i){this.type=ht,this.lhs=t,this.rhs=e,this.collator=i,this.hasUntypedArgument="value"===t.type.kind||"value"===e.type.kind}static parse(t,e){if(3!==t.length&&4!==t.length)return e.error("Expected two or three arguments.");const i=t[0];let o=e.parse(t[1],1,ft);if(!o)return null;if(!ze(i,o.type))return e.concat(1).error(`"${i}" comparisons are not supported for type '${xt(o.type)}'.`);let s=e.parse(t[2],2,ft);if(!s)return null;if(!ze(i,s.type))return e.concat(2).error(`"${i}" comparisons are not supported for type '${xt(s.type)}'.`);if(o.type.kind!==s.type.kind&&"value"!==o.type.kind&&"value"!==s.type.kind)return e.error(`Cannot compare types '${xt(o.type)}' and '${xt(s.type)}'.`);r&&("value"===o.type.kind&&"value"!==s.type.kind?o=new le(s.type,[o]):"value"!==o.type.kind&&"value"===s.type.kind&&(s=new le(o.type,[s])));let a=null;if(4===t.length){if("string"!==o.type.kind&&"string"!==s.type.kind&&"value"!==o.type.kind&&"value"!==s.type.kind)return e.error("Cannot use collator to compare non-string types.");if(a=e.parse(t[3],3,At),!a)return null}return new n(o,s,a)}evaluate(n){const o=this.lhs.evaluate(n),s=this.rhs.evaluate(n);if(r&&this.hasUntypedArgument){const e=re(o),i=re(s);if(e.kind!==i.kind||"string"!==e.kind&&"number"!==e.kind)throw new se(`Expected arguments for "${t}" to be (string, string) or (number, number), but found (${e.kind}, ${i.kind}) instead.`)}if(this.collator&&!r&&this.hasUntypedArgument){const t=re(o),i=re(s);if("string"!==t.kind||"string"!==i.kind)return e(n,o,s)}return this.collator?i(n,o,s,this.collator.evaluate(n)):e(n,o,s)}eachChild(t){t(this.lhs),t(this.rhs),this.collator&&t(this.collator)}outputDefined(){return!0}}}const Re=De("==",(function(t,e,i){return e===i}),Fe),Ue=De("!=",(function(t,e,i){return e!==i}),(function(t,e,i,r){return!Fe(0,e,i,r)})),Oe=De("<",(function(t,e,i){return e<i}),(function(t,e,i,r){return r.compare(e,i)<0})),Ne=De(">",(function(t,e,i){return e>i}),(function(t,e,i,r){return r.compare(e,i)>0})),Qe=De("<=",(function(t,e,i){return e<=i}),(function(t,e,i,r){return r.compare(e,i)<=0})),Ve=De(">=",(function(t,e,i){return e>=i}),(function(t,e,i,r){return r.compare(e,i)>=0}));class je{constructor(t,e,i){this.type=At,this.locale=i,this.caseSensitive=t,this.diacriticSensitive=e}static parse(t,e){if(2!==t.length)return e.error("Expected one argument.");const i=t[1];if("object"!=typeof i||Array.isArray(i))return e.error("Collator options argument must be an object.");const r=e.parse(void 0!==i["case-sensitive"]&&i["case-sensitive"],1,ht);if(!r)return null;const n=e.parse(void 0!==i["diacritic-sensitive"]&&i["diacritic-sensitive"],1,ht);if(!n)return null;let o=null;return i.locale&&(o=e.parse(i.locale,1,ut),!o)?null:new je(r,n,o)}evaluate(t){return new qt(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}}class He{constructor(t,e,i,r,n){this.type=ut,this.number=t,this.locale=e,this.currency=i,this.minFractionDigits=r,this.maxFractionDigits=n}static parse(t,e){if(3!==t.length)return e.error("Expected two arguments.");const i=e.parse(t[1],1,ct);if(!i)return null;const r=t[2];if("object"!=typeof r||Array.isArray(r))return e.error("NumberFormat options argument must be an object.");let n=null;if(r.locale&&(n=e.parse(r.locale,1,ut),!n))return null;let o=null;if(r.currency&&(o=e.parse(r.currency,1,ut),!o))return null;let s=null;if(r["min-fraction-digits"]&&(s=e.parse(r["min-fraction-digits"],1,ct),!s))return null;let a=null;return r["max-fraction-digits"]&&(a=e.parse(r["max-fraction-digits"],1,ct),!a)?null:new He(i,n,o,s,a)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}}class Ge{constructor(t){this.type=mt,this.sections=t}static parse(t,e){if(t.length<2)return e.error("Expected at least one argument.");const i=t[1];if(!Array.isArray(i)&&"object"==typeof i)return e.error("First argument must be an image or text section.");const r=[];let n=!1;for(let i=1;i<=t.length-1;++i){const o=t[i];if(n&&"object"==typeof o&&!Array.isArray(o)){n=!1;let t=null;if(o["font-scale"]&&(t=e.parse(o["font-scale"],1,ct),!t))return null;let i=null;if(o["text-font"]&&(i=e.parse(o["text-font"],1,vt(ut)),!i))return null;let s=null;if(o["text-color"]&&(s=e.parse(o["text-color"],1,dt),!s))return null;const a=r[r.length-1];a.scale=t,a.font=i,a.textColor=s}else{const o=e.parse(t[i],1,ft);if(!o)return null;const s=o.type.kind;if("string"!==s&&"value"!==s&&"null"!==s&&"resolvedImage"!==s)return e.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");n=!0,r.push({content:o,scale:null,font:null,textColor:null})}}return new Ge(r)}evaluate(t){return new Wt(this.sections.map((e=>{const i=e.content.evaluate(t);return re(i)===_t?new Kt("",i,null,null,null):new Kt(ne(i),null,e.scale?e.scale.evaluate(t):null,e.font?e.font.evaluate(t).join(","):null,e.textColor?e.textColor.evaluate(t):null)})))}eachChild(t){for(const e of this.sections)t(e.content),e.scale&&t(e.scale),e.font&&t(e.font),e.textColor&&t(e.textColor)}outputDefined(){return!1}}class $e{constructor(t){this.type=_t,this.input=t}static parse(t,e){if(2!==t.length)return e.error("Expected two arguments.");const i=e.parse(t[1],1,ut);return i?new $e(i):e.error("No image name provided.")}evaluate(t){const e=this.input.evaluate(t),i=te.fromString(e);return i&&t.availableImages&&(i.available=t.availableImages.indexOf(e)>-1),i}eachChild(t){t(this.input)}outputDefined(){return!1}}class Ze{constructor(t){this.type=ct,this.input=t}static parse(t,e){if(2!==t.length)return e.error(`Expected 1 argument, but found ${t.length-1} instead.`);const i=e.parse(t[1],1);return i?"array"!==i.type.kind&&"string"!==i.type.kind&&"value"!==i.type.kind?e.error(`Expected argument of type string or array, but found ${xt(i.type)} instead.`):new Ze(i):null}evaluate(t){const e=this.input.evaluate(t);if("string"==typeof e)return[...e].length;if(Array.isArray(e))return e.length;throw new se(`Expected value to be of type string or array, but found ${xt(re(e))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}}const qe=8192;function Ke(t,e){const i=(180+t[0])/360,r=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,n=Math.pow(2,e.z);return[Math.round(i*n*qe),Math.round(r*n*qe)]}function We(t,e){const i=Math.pow(2,e.z);return[(n=(t[0]/qe+e.x)/i,360*n-180),(r=(t[1]/qe+e.y)/i,360/Math.PI*Math.atan(Math.exp((180-360*r)*Math.PI/180))-90)];var r,n}function Xe(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function Je(t,e){return!(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function Ye(t,e,i){const r=t[0]-e[0],n=t[1]-e[1],o=t[0]-i[0],s=t[1]-i[1];return r*s-o*n==0&&r*o<=0&&n*s<=0}function ti(t,e,i,r){return 0!=(n=[r[0]-i[0],r[1]-i[1]])[0]*(o=[e[0]-t[0],e[1]-t[1]])[1]-n[1]*o[0]&&!(!si(t,e,i,r)||!si(i,r,t,e));var n,o}function ei(t,e,i){for(const r of i)for(let i=0;i<r.length-1;++i)if(ti(t,e,r[i],r[i+1]))return!0;return!1}function ii(t,e,i=!1){let r=!1;for(const a of e)for(let e=0;e<a.length-1;e++){if(Ye(t,a[e],a[e+1]))return i;(o=a[e])[1]>(n=t)[1]!=(s=a[e+1])[1]>n[1]&&n[0]<(s[0]-o[0])*(n[1]-o[1])/(s[1]-o[1])+o[0]&&(r=!r)}var n,o,s;return r}function ri(t,e){for(const i of e)if(ii(t,i))return!0;return!1}function ni(t,e){for(const i of t)if(!ii(i,e))return!1;for(let i=0;i<t.length-1;++i)if(ei(t[i],t[i+1],e))return!1;return!0}function oi(t,e){for(const i of e)if(ni(t,i))return!0;return!1}function si(t,e,i,r){const n=r[0]-i[0],o=r[1]-i[1],s=(t[0]-i[0])*o-n*(t[1]-i[1]),a=(e[0]-i[0])*o-n*(e[1]-i[1]);return s>0&&a<0||s<0&&a>0}function ai(t,e,i){const r=[];for(let n=0;n<t.length;n++){const o=[];for(let r=0;r<t[n].length;r++){const s=Ke(t[n][r],i);Xe(e,s),o.push(s)}r.push(o)}return r}function li(t,e,i){const r=[];for(let n=0;n<t.length;n++){const o=ai(t[n],e,i);r.push(o)}return r}function ci(t,e,i,r){if(t[0]<i[0]||t[0]>i[2]){const e=.5*r;let n=t[0]-i[0]>e?-r:i[0]-t[0]>e?r:0;0===n&&(n=t[0]-i[2]>e?-r:i[2]-t[0]>e?r:0),t[0]+=n}Xe(e,t)}function ui(t,e,i,r){const n=Math.pow(2,r.z)*qe,o=[r.x*qe,r.y*qe],s=[];for(const r of t)for(const t of r){const r=[t.x+o[0],t.y+o[1]];ci(r,e,i,n),s.push(r)}return s}function hi(t,e,i,r){const n=Math.pow(2,r.z)*qe,o=[r.x*qe,r.y*qe],s=[];for(const i of t){const t=[];for(const r of i){const i=[r.x+o[0],r.y+o[1]];Xe(e,i),t.push(i)}s.push(t)}if(e[2]-e[0]<=n/2){(a=e)[0]=a[1]=1/0,a[2]=a[3]=-1/0;for(const t of s)for(const r of t)ci(r,e,i,n)}var a;return s}class di{constructor(t,e){this.type=ht,this.geojson=t,this.geometries=e}static parse(t,e){if(2!==t.length)return e.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(ie(t[1])){const e=t[1];if("FeatureCollection"===e.type){const t=[];for(const i of e.features){const{type:e,coordinates:r}=i.geometry;"Polygon"===e&&t.push(r),"MultiPolygon"===e&&t.push(...r)}if(t.length)return new di(e,{type:"MultiPolygon",coordinates:t})}else if("Feature"===e.type){const t=e.geometry.type;if("Polygon"===t||"MultiPolygon"===t)return new di(e,e.geometry)}else if("Polygon"===e.type||"MultiPolygon"===e.type)return new di(e,e)}return e.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(null!=t.geometry()&&null!=t.canonicalID()){if("Point"===t.geometryType())return function(t,e){const i=[1/0,1/0,-1/0,-1/0],r=[1/0,1/0,-1/0,-1/0],n=t.canonicalID();if("Polygon"===e.type){const o=ai(e.coordinates,r,n),s=ui(t.geometry(),i,r,n);if(!Je(i,r))return!1;for(const t of s)if(!ii(t,o))return!1}if("MultiPolygon"===e.type){const o=li(e.coordinates,r,n),s=ui(t.geometry(),i,r,n);if(!Je(i,r))return!1;for(const t of s)if(!ri(t,o))return!1}return!0}(t,this.geometries);if("LineString"===t.geometryType())return function(t,e){const i=[1/0,1/0,-1/0,-1/0],r=[1/0,1/0,-1/0,-1/0],n=t.canonicalID();if("Polygon"===e.type){const o=ai(e.coordinates,r,n),s=hi(t.geometry(),i,r,n);if(!Je(i,r))return!1;for(const t of s)if(!ni(t,o))return!1}if("MultiPolygon"===e.type){const o=li(e.coordinates,r,n),s=hi(t.geometry(),i,r,n);if(!Je(i,r))return!1;for(const t of s)if(!oi(t,o))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let pi=class{constructor(t=[],e=((t,e)=>t<e?-1:t>e?1:0)){if(this.data=t,this.length=this.data.length,this.compare=e,this.length>0)for(let t=(this.length>>1)-1;t>=0;t--)this._down(t)}push(t){this.data.push(t),this._up(this.length++)}pop(){if(0===this.length)return;const t=this.data[0],e=this.data.pop();return--this.length>0&&(this.data[0]=e,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:e,compare:i}=this,r=e[t];for(;t>0;){const n=t-1>>1,o=e[n];if(i(r,o)>=0)break;e[t]=o,t=n}e[t]=r}_down(t){const{data:e,compare:i}=this,r=this.length>>1,n=e[t];for(;t<r;){let r=1+(t<<1);const o=r+1;if(o<this.length&&i(e[o],e[r])<0&&(r=o),i(e[r],n)>=0)break;e[t]=e[r],t=r}e[t]=n}};function fi(t,e,i,r,n){Ai(t,e,i,r||t.length-1,n||gi)}function Ai(t,e,i,r,n){for(;r>i;){if(r-i>600){var o=r-i+1,s=e-i+1,a=Math.log(o),l=.5*Math.exp(2*a/3),c=.5*Math.sqrt(a*l*(o-l)/o)*(s-o/2<0?-1:1);Ai(t,e,Math.max(i,Math.floor(e-s*l/o+c)),Math.min(r,Math.floor(e+(o-s)*l/o+c)),n)}var u=t[e],h=i,d=r;for(mi(t,i,e),n(t[r],u)>0&&mi(t,i,r);h<d;){for(mi(t,h,d),h++,d--;n(t[h],u)<0;)h++;for(;n(t[d],u)>0;)d--}0===n(t[i],u)?mi(t,i,d):mi(t,++d,r),d<=e&&(i=d+1),e<=d&&(r=d-1)}}function mi(t,e,i){var r=t[e];t[e]=t[i],t[i]=r}function gi(t,e){return t<e?-1:t>e?1:0}function _i(t,e){if(t.length<=1)return[t];const i=[];let r,n;for(const e of t){const t=vi(e);0!==t&&(e.area=Math.abs(t),void 0===n&&(n=t<0),n===t<0?(r&&i.push(r),r=[e]):r.push(e))}if(r&&i.push(r),e>1)for(let t=0;t<i.length;t++)i[t].length<=e||(fi(i[t],e,1,i[t].length-1,yi),i[t]=i[t].slice(0,e));return i}function yi(t,e){return e.area-t.area}function vi(t){let e=0;for(let i,r,n=0,o=t.length,s=o-1;n<o;s=n++)i=t[n],r=t[s],e+=(r.x-i.x)*(i.y+r.y);return e}const xi=1/298.257223563,bi=xi*(2-xi),wi=Math.PI/180;class Ti{constructor(t){const e=6378.137*wi*1e3,i=Math.cos(t*wi),r=1/(1-bi*(1-i*i)),n=Math.sqrt(r);this.kx=e*n*i,this.ky=e*n*r*(1-bi)}distance(t,e){const i=this.wrap(t[0]-e[0])*this.kx,r=(t[1]-e[1])*this.ky;return Math.sqrt(i*i+r*r)}pointOnLine(t,e){let i,r,n,o,s=1/0;for(let a=0;a<t.length-1;a++){let l=t[a][0],c=t[a][1],u=this.wrap(t[a+1][0]-l)*this.kx,h=(t[a+1][1]-c)*this.ky,d=0;0===u&&0===h||(d=(this.wrap(e[0]-l)*this.kx*u+(e[1]-c)*this.ky*h)/(u*u+h*h),d>1?(l=t[a+1][0],c=t[a+1][1]):d>0&&(l+=u/this.kx*d,c+=h/this.ky*d)),u=this.wrap(e[0]-l)*this.kx,h=(e[1]-c)*this.ky;const p=u*u+h*h;p<s&&(s=p,i=l,r=c,n=a,o=d)}return{point:[i,r],index:n,t:Math.max(0,Math.min(1,o))}}wrap(t){for(;t<-180;)t+=360;for(;t>180;)t-=360;return t}}function Bi(t,e){return e[0]-t[0]}function Ei(t){return t[1]-t[0]+1}function Ci(t,e){return t[1]>=t[0]&&t[1]<e}function Si(t,e){if(t[0]>t[1])return[null,null];const i=Ei(t);if(e){if(2===i)return[t,null];const e=Math.floor(i/2);return[[t[0],t[0]+e],[t[0]+e,t[1]]]}if(1===i)return[t,null];const r=Math.floor(i/2)-1;return[[t[0],t[0]+r],[t[0]+r+1,t[1]]]}function Ii(t,e){if(!Ci(e,t.length))return[1/0,1/0,-1/0,-1/0];const i=[1/0,1/0,-1/0,-1/0];for(let r=e[0];r<=e[1];++r)Xe(i,t[r]);return i}function Mi(t){const e=[1/0,1/0,-1/0,-1/0];for(const i of t)for(const t of i)Xe(e,t);return e}function ki(t){return t[0]!==-1/0&&t[1]!==-1/0&&t[2]!==1/0&&t[3]!==1/0}function Pi(t,e,i){if(!ki(t)||!ki(e))return NaN;let r=0,n=0;return t[2]<e[0]&&(r=e[0]-t[2]),t[0]>e[2]&&(r=t[0]-e[2]),t[1]>e[3]&&(n=t[1]-e[3]),t[3]<e[1]&&(n=e[1]-t[3]),i.distance([0,0],[r,n])}function Li(t,e,i){const r=i.pointOnLine(e,t);return i.distance(t,r.point)}function zi(t,e,i,r,n){const o=Math.min(Li(t,[i,r],n),Li(e,[i,r],n)),s=Math.min(Li(i,[t,e],n),Li(r,[t,e],n));return Math.min(o,s)}function Fi(t,e,i,r,n){if(!Ci(e,t.length)||!Ci(r,i.length))return 1/0;let o=1/0;for(let s=e[0];s<e[1];++s){const e=t[s],a=t[s+1];for(let t=r[0];t<r[1];++t){const r=i[t],s=i[t+1];if(ti(e,a,r,s))return 0;o=Math.min(o,zi(e,a,r,s,n))}}return o}function Di(t,e,i,r,n){if(!Ci(e,t.length)||!Ci(r,i.length))return NaN;let o=1/0;for(let s=e[0];s<=e[1];++s)for(let e=r[0];e<=r[1];++e)if(o=Math.min(o,n.distance(t[s],i[e])),0===o)return o;return o}function Ri(t,e,i){if(ii(t,e,!0))return 0;let r=1/0;for(const n of e){const e=n[0],o=n[n.length-1];if(e!==o&&(r=Math.min(r,Li(t,[o,e],i)),0===r))return r;const s=i.pointOnLine(n,t);if(r=Math.min(r,i.distance(t,s.point)),0===r)return r}return r}function Ui(t,e,i,r){if(!Ci(e,t.length))return NaN;for(let r=e[0];r<=e[1];++r)if(ii(t[r],i,!0))return 0;let n=1/0;for(let o=e[0];o<e[1];++o){const e=t[o],s=t[o+1];for(const t of i)for(let i=0,o=t.length,a=o-1;i<o;a=i++){const o=t[a],l=t[i];if(ti(e,s,o,l))return 0;n=Math.min(n,zi(e,s,o,l,r))}}return n}function Oi(t,e){for(const i of t)for(const t of i)if(ii(t,e,!0))return!0;return!1}function Ni(t,e,i,r=1/0){const n=Mi(t),o=Mi(e);if(r!==1/0&&Pi(n,o,i)>=r)return r;if(Je(n,o)){if(Oi(t,e))return 0}else if(Oi(e,t))return 0;let s=1/0;for(const r of t)for(let t=0,n=r.length,o=n-1;t<n;o=t++){const n=r[o],a=r[t];for(const t of e)for(let e=0,r=t.length,o=r-1;e<r;o=e++){const r=t[o],l=t[e];if(ti(n,a,r,l))return 0;s=Math.min(s,zi(n,a,r,l,i))}}return s}function Qi(t,e,i,r,n,o){if(!o)return;const s=Pi(Ii(r,o),n,i);s<e&&t.push([s,o,[0,0]])}function Vi(t,e,i,r,n,o,s){if(!o||!s)return;const a=Pi(Ii(r,o),Ii(n,s),i);a<e&&t.push([a,o,s])}function ji(t,e,i,r,n=1/0){let o=Math.min(r.distance(t[0],i[0][0]),n);if(0===o)return o;const s=new pi([[0,[0,t.length-1],[0,0]]],Bi),a=Mi(i);for(;s.length>0;){const n=s.pop();if(n[0]>=o)continue;const l=n[1],c=e?50:100;if(Ei(l)<=c){if(!Ci(l,t.length))return NaN;if(e){const e=Ui(t,l,i,r);if(isNaN(e)||0===e)return e;o=Math.min(o,e)}else for(let e=l[0];e<=l[1];++e){const n=Ri(t[e],i,r);if(o=Math.min(o,n),0===o)return 0}}else{const i=Si(l,e);Qi(s,o,r,t,a,i[0]),Qi(s,o,r,t,a,i[1])}}return o}function Hi(t,e,i,r,n,o=1/0){let s=Math.min(o,n.distance(t[0],i[0]));if(0===s)return s;const a=new pi([[0,[0,t.length-1],[0,i.length-1]]],Bi);for(;a.length>0;){const o=a.pop();if(o[0]>=s)continue;const l=o[1],c=o[2],u=e?50:100,h=r?50:100;if(Ei(l)<=u&&Ei(c)<=h){if(!Ci(l,t.length)&&Ci(c,i.length))return NaN;let o;if(e&&r)o=Fi(t,l,i,c,n),s=Math.min(s,o);else if(e&&!r){const e=t.slice(l[0],l[1]+1);for(let t=c[0];t<=c[1];++t)if(o=Li(i[t],e,n),s=Math.min(s,o),0===s)return s}else if(!e&&r){const e=i.slice(c[0],c[1]+1);for(let i=l[0];i<=l[1];++i)if(o=Li(t[i],e,n),s=Math.min(s,o),0===s)return s}else o=Di(t,l,i,c,n),s=Math.min(s,o)}else{const o=Si(l,e),u=Si(c,r);Vi(a,s,n,t,i,o[0],u[0]),Vi(a,s,n,t,i,o[0],u[1]),Vi(a,s,n,t,i,o[1],u[0]),Vi(a,s,n,t,i,o[1],u[1])}}return s}function Gi(t){return"MultiPolygon"===t.type?t.coordinates.map((t=>({type:"Polygon",coordinates:t}))):"MultiLineString"===t.type?t.coordinates.map((t=>({type:"LineString",coordinates:t}))):"MultiPoint"===t.type?t.coordinates.map((t=>({type:"Point",coordinates:t}))):[t]}class $i{constructor(t,e){this.type=ct,this.geojson=t,this.geometries=e}static parse(t,e){if(2!==t.length)return e.error(`'distance' expression requires exactly one argument, but found ${t.length-1} instead.`);if(ie(t[1])){const e=t[1];if("FeatureCollection"===e.type)return new $i(e,e.features.map((t=>Gi(t.geometry))).flat());if("Feature"===e.type)return new $i(e,Gi(e.geometry));if("type"in e&&"coordinates"in e)return new $i(e,Gi(e))}return e.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(null!=t.geometry()&&null!=t.canonicalID()){if("Point"===t.geometryType())return function(t,e){const i=t.geometry(),r=i.flat().map((e=>We([e.x,e.y],t.canonical)));if(0===i.length)return NaN;const n=new Ti(r[0][1]);let o=1/0;for(const t of e){switch(t.type){case"Point":o=Math.min(o,Hi(r,!1,[t.coordinates],!1,n,o));break;case"LineString":o=Math.min(o,Hi(r,!1,t.coordinates,!0,n,o));break;case"Polygon":o=Math.min(o,ji(r,!1,t.coordinates,n,o))}if(0===o)return o}return o}(t,this.geometries);if("LineString"===t.geometryType())return function(t,e){const i=t.geometry(),r=i.flat().map((e=>We([e.x,e.y],t.canonical)));if(0===i.length)return NaN;const n=new Ti(r[0][1]);let o=1/0;for(const t of e){switch(t.type){case"Point":o=Math.min(o,Hi(r,!0,[t.coordinates],!1,n,o));break;case"LineString":o=Math.min(o,Hi(r,!0,t.coordinates,!0,n,o));break;case"Polygon":o=Math.min(o,ji(r,!0,t.coordinates,n,o))}if(0===o)return o}return o}(t,this.geometries);if("Polygon"===t.geometryType())return function(t,e){const i=t.geometry();if(0===i.length||0===i[0].length)return NaN;const r=_i(i,0).map((e=>e.map((e=>e.map((e=>We([e.x,e.y],t.canonical))))))),n=new Ti(r[0][0][0][1]);let o=1/0;for(const t of e)for(const e of r){switch(t.type){case"Point":o=Math.min(o,ji([t.coordinates],!1,e,n,o));break;case"LineString":o=Math.min(o,ji(t.coordinates,!0,e,n,o));break;case"Polygon":o=Math.min(o,Ni(e,t.coordinates,n,o))}if(0===o)return o}return o}(t,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}const Zi={"==":Re,"!=":Ue,">":Ne,"<":Oe,">=":Ve,"<=":Qe,array:le,at:me,boolean:le,case:ve,coalesce:Le,collator:je,format:Ge,image:$e,in:ge,"index-of":_e,interpolate:ke,"interpolate-hcl":ke,"interpolate-lab":ke,length:Ze,let:fe,literal:oe,match:ye,number:le,"number-format":He,object:le,slice:xe,step:we,string:le,"to-boolean":ue,"to-color":ue,"to-number":ue,"to-string":ue,var:Ae,within:di,distance:$i};class qi{constructor(t,e,i,r){this.name=t,this.type=e,this._evaluate=i,this.args=r}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}static parse(t,e){const i=t[0],r=qi.definitions[i];if(!r)return e.error(`Unknown expression "${i}". If you wanted a literal array, use ["literal", [...]].`,0);const n=Array.isArray(r)?r[0]:r.type,o=Array.isArray(r)?[[r[1],r[2]]]:r.overloads,s=o.filter((([e])=>!Array.isArray(e)||e.length===t.length-1));let a=null;for(const[r,o]of s){a=new pe(e.registry,Yi,e.path,null,e.scope);const s=[];let l=!1;for(let e=1;e<t.length;e++){const i=t[e],n=Array.isArray(r)?r[e-1]:r.type,o=a.parse(i,1+s.length,n);if(!o){l=!0;break}s.push(o)}if(!l)if(Array.isArray(r)&&r.length!==s.length)a.error(`Expected ${r.length} arguments, but found ${s.length} instead.`);else{for(let t=0;t<s.length;t++){const e=Array.isArray(r)?r[t]:r.type,i=s[t];a.concat(t+1).checkSubtype(e,i.type)}if(0===a.errors.length)return new qi(i,n,o,s)}}if(1===s.length)e.errors.push(...a.errors);else{const i=(s.length?s:o).map((([t])=>{return e=t,Array.isArray(e)?`(${e.map(xt).join(", ")})`:`(${xt(e.type)}...)`;var e})).join(" | "),r=[];for(let i=1;i<t.length;i++){const n=e.parse(t[i],1+r.length);if(!n)return null;r.push(xt(n.type))}e.error(`Expected arguments of type ${i}, but found (${r.join(", ")}) instead.`)}return null}static register(t,e){qi.definitions=e;for(const i in e)t[i]=qi}}function Ki(t,[e,i,r,n]){e=e.evaluate(t),i=i.evaluate(t),r=r.evaluate(t);const o=n?n.evaluate(t):1,s=ee(e,i,r,o);if(s)throw new se(s);return new Zt(e/255,i/255,r/255,o,!1)}function Wi(t,e){return t in e}function Xi(t,e){const i=e[t];return void 0===i?null:i}function Ji(t){return{type:t}}function Yi(t){if(t instanceof Ae)return Yi(t.boundExpression);if(t instanceof qi&&"error"===t.name)return!1;if(t instanceof je)return!1;if(t instanceof di)return!1;if(t instanceof $i)return!1;const e=t instanceof ue||t instanceof le;let i=!0;return t.eachChild((t=>{i=e?i&&Yi(t):i&&t instanceof oe})),!!i&&tr(t)&&ir(t,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function tr(t){if(t instanceof qi){if("get"===t.name&&1===t.args.length)return!1;if("feature-state"===t.name)return!1;if("has"===t.name&&1===t.args.length)return!1;if("properties"===t.name||"geometry-type"===t.name||"id"===t.name)return!1;if(/^filter-/.test(t.name))return!1}if(t instanceof di)return!1;if(t instanceof $i)return!1;let e=!0;return t.eachChild((t=>{e&&!tr(t)&&(e=!1)})),e}function er(t){if(t instanceof qi&&"feature-state"===t.name)return!1;let e=!0;return t.eachChild((t=>{e&&!er(t)&&(e=!1)})),e}function ir(t,e){if(t instanceof qi&&e.indexOf(t.name)>=0)return!1;let i=!0;return t.eachChild((t=>{i&&!ir(t,e)&&(i=!1)})),i}function rr(t){return{result:"success",value:t}}function nr(t){return{result:"error",value:t}}function or(t){return"data-driven"===t["property-type"]||"cross-faded-data-driven"===t["property-type"]}function sr(t){return!!t.expression&&t.expression.parameters.indexOf("zoom")>-1}function ar(t){return!!t.expression&&t.expression.interpolated}function lr(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":null===t?"null":typeof t}function cr(t){return"object"==typeof t&&null!==t&&!Array.isArray(t)}function ur(t){return t}function hr(t,e){const i="color"===e.type,r=t.stops&&"object"==typeof t.stops[0][0],n=r||!(r||void 0!==t.property),o=t.type||(ar(e)?"exponential":"interval");if(i||"padding"===e.type){const r=i?Zt.parse:Xt.parse;(t=ot({},t)).stops&&(t.stops=t.stops.map((t=>[t[0],r(t[1])]))),t.default=r(t.default?t.default:e.default)}if(t.colorSpace&&"rgb"!==(s=t.colorSpace)&&"hcl"!==s&&"lab"!==s)throw new Error(`Unknown color space: "${t.colorSpace}"`);var s;let a,l,c;if("exponential"===o)a=Ar;else if("interval"===o)a=fr;else if("categorical"===o){a=pr,l=Object.create(null);for(const e of t.stops)l[e[0]]=e[1];c=typeof t.stops[0][0]}else{if("identity"!==o)throw new Error(`Unknown function type "${o}"`);a=mr}if(r){const i={},r=[];for(let e=0;e<t.stops.length;e++){const n=t.stops[e],o=n[0].zoom;void 0===i[o]&&(i[o]={zoom:o,type:t.type,property:t.property,default:t.default,stops:[]},r.push(o)),i[o].stops.push([n[0].value,n[1]])}const n=[];for(const t of r)n.push([i[t].zoom,hr(i[t],e)]);const o={name:"linear"};return{kind:"composite",interpolationType:o,interpolationFactor:ke.interpolationFactor.bind(void 0,o),zoomStops:n.map((t=>t[0])),evaluate:({zoom:i},r)=>Ar({stops:n,base:t.base},e,i).evaluate(i,r)}}if(n){const i="exponential"===o?{name:"exponential",base:void 0!==t.base?t.base:1}:null;return{kind:"camera",interpolationType:i,interpolationFactor:ke.interpolationFactor.bind(void 0,i),zoomStops:t.stops.map((t=>t[0])),evaluate:({zoom:i})=>a(t,e,i,l,c)}}return{kind:"source",evaluate(i,r){const n=r&&r.properties?r.properties[t.property]:void 0;return void 0===n?dr(t.default,e.default):a(t,e,n,l,c)}}}function dr(t,e,i){return void 0!==t?t:void 0!==e?e:void 0!==i?i:void 0}function pr(t,e,i,r,n){return dr(typeof i===n?r[i]:void 0,t.default,e.default)}function fr(t,e,i){if("number"!==lr(i))return dr(t.default,e.default);const r=t.stops.length;if(1===r)return t.stops[0][1];if(i<=t.stops[0][0])return t.stops[0][1];if(i>=t.stops[r-1][0])return t.stops[r-1][1];const n=be(t.stops.map((t=>t[0])),i);return t.stops[n][1]}function Ar(t,e,i){const r=void 0!==t.base?t.base:1;if("number"!==lr(i))return dr(t.default,e.default);const n=t.stops.length;if(1===n)return t.stops[0][1];if(i<=t.stops[0][0])return t.stops[0][1];if(i>=t.stops[n-1][0])return t.stops[n-1][1];const o=be(t.stops.map((t=>t[0])),i),s=function(t,e,i,r){const n=r-i,o=t-i;return 0===n?0:1===e?o/n:(Math.pow(e,o)-1)/(Math.pow(e,n)-1)}(i,r,t.stops[o][0],t.stops[o+1][0]),a=t.stops[o][1],l=t.stops[o+1][1],c=Me[e.type]||ur;return"function"==typeof a.evaluate?{evaluate(...e){const i=a.evaluate.apply(void 0,e),r=l.evaluate.apply(void 0,e);if(void 0!==i&&void 0!==r)return c(i,r,s,t.colorSpace)}}:c(a,l,s,t.colorSpace)}function mr(t,e,i){switch(e.type){case"color":i=Zt.parse(i);break;case"formatted":i=Wt.fromString(i.toString());break;case"resolvedImage":i=te.fromString(i.toString());break;case"padding":i=Xt.parse(i);break;default:lr(i)===e.type||"enum"===e.type&&e.values[i]||(i=void 0)}return dr(i,t.default,e.default)}qi.register(Zi,{error:[{kind:"error"},[ut],(t,[e])=>{throw new se(e.evaluate(t))}],typeof:[ut,[ft],(t,[e])=>xt(re(e.evaluate(t)))],"to-rgba":[vt(ct,4),[dt],(t,[e])=>{const[i,r,n,o]=e.evaluate(t).rgb;return[255*i,255*r,255*n,o]}],rgb:[dt,[ct,ct,ct],Ki],rgba:[dt,[ct,ct,ct,ct],Ki],has:{type:ht,overloads:[[[ut],(t,[e])=>Wi(e.evaluate(t),t.properties())],[[ut,pt],(t,[e,i])=>Wi(e.evaluate(t),i.evaluate(t))]]},get:{type:ft,overloads:[[[ut],(t,[e])=>Xi(e.evaluate(t),t.properties())],[[ut,pt],(t,[e,i])=>Xi(e.evaluate(t),i.evaluate(t))]]},"feature-state":[ft,[ut],(t,[e])=>Xi(e.evaluate(t),t.featureState||{})],properties:[pt,[],t=>t.properties()],"geometry-type":[ut,[],t=>t.geometryType()],id:[ft,[],t=>t.id()],zoom:[ct,[],t=>t.globals.zoom],"heatmap-density":[ct,[],t=>t.globals.heatmapDensity||0],"line-progress":[ct,[],t=>t.globals.lineProgress||0],accumulated:[ft,[],t=>void 0===t.globals.accumulated?null:t.globals.accumulated],"+":[ct,Ji(ct),(t,e)=>{let i=0;for(const r of e)i+=r.evaluate(t);return i}],"*":[ct,Ji(ct),(t,e)=>{let i=1;for(const r of e)i*=r.evaluate(t);return i}],"-":{type:ct,overloads:[[[ct,ct],(t,[e,i])=>e.evaluate(t)-i.evaluate(t)],[[ct],(t,[e])=>-e.evaluate(t)]]},"/":[ct,[ct,ct],(t,[e,i])=>e.evaluate(t)/i.evaluate(t)],"%":[ct,[ct,ct],(t,[e,i])=>e.evaluate(t)%i.evaluate(t)],ln2:[ct,[],()=>Math.LN2],pi:[ct,[],()=>Math.PI],e:[ct,[],()=>Math.E],"^":[ct,[ct,ct],(t,[e,i])=>Math.pow(e.evaluate(t),i.evaluate(t))],sqrt:[ct,[ct],(t,[e])=>Math.sqrt(e.evaluate(t))],log10:[ct,[ct],(t,[e])=>Math.log(e.evaluate(t))/Math.LN10],ln:[ct,[ct],(t,[e])=>Math.log(e.evaluate(t))],log2:[ct,[ct],(t,[e])=>Math.log(e.evaluate(t))/Math.LN2],sin:[ct,[ct],(t,[e])=>Math.sin(e.evaluate(t))],cos:[ct,[ct],(t,[e])=>Math.cos(e.evaluate(t))],tan:[ct,[ct],(t,[e])=>Math.tan(e.evaluate(t))],asin:[ct,[ct],(t,[e])=>Math.asin(e.evaluate(t))],acos:[ct,[ct],(t,[e])=>Math.acos(e.evaluate(t))],atan:[ct,[ct],(t,[e])=>Math.atan(e.evaluate(t))],min:[ct,Ji(ct),(t,e)=>Math.min(...e.map((e=>e.evaluate(t))))],max:[ct,Ji(ct),(t,e)=>Math.max(...e.map((e=>e.evaluate(t))))],abs:[ct,[ct],(t,[e])=>Math.abs(e.evaluate(t))],round:[ct,[ct],(t,[e])=>{const i=e.evaluate(t);return i<0?-Math.round(-i):Math.round(i)}],floor:[ct,[ct],(t,[e])=>Math.floor(e.evaluate(t))],ceil:[ct,[ct],(t,[e])=>Math.ceil(e.evaluate(t))],"filter-==":[ht,[ut,ft],(t,[e,i])=>t.properties()[e.value]===i.value],"filter-id-==":[ht,[ft],(t,[e])=>t.id()===e.value],"filter-type-==":[ht,[ut],(t,[e])=>t.geometryType()===e.value],"filter-<":[ht,[ut,ft],(t,[e,i])=>{const r=t.properties()[e.value],n=i.value;return typeof r==typeof n&&r<n}],"filter-id-<":[ht,[ft],(t,[e])=>{const i=t.id(),r=e.value;return typeof i==typeof r&&i<r}],"filter->":[ht,[ut,ft],(t,[e,i])=>{const r=t.properties()[e.value],n=i.value;return typeof r==typeof n&&r>n}],"filter-id->":[ht,[ft],(t,[e])=>{const i=t.id(),r=e.value;return typeof i==typeof r&&i>r}],"filter-<=":[ht,[ut,ft],(t,[e,i])=>{const r=t.properties()[e.value],n=i.value;return typeof r==typeof n&&r<=n}],"filter-id-<=":[ht,[ft],(t,[e])=>{const i=t.id(),r=e.value;return typeof i==typeof r&&i<=r}],"filter->=":[ht,[ut,ft],(t,[e,i])=>{const r=t.properties()[e.value],n=i.value;return typeof r==typeof n&&r>=n}],"filter-id->=":[ht,[ft],(t,[e])=>{const i=t.id(),r=e.value;return typeof i==typeof r&&i>=r}],"filter-has":[ht,[ft],(t,[e])=>e.value in t.properties()],"filter-has-id":[ht,[],t=>null!==t.id()&&void 0!==t.id()],"filter-type-in":[ht,[vt(ut)],(t,[e])=>e.value.indexOf(t.geometryType())>=0],"filter-id-in":[ht,[vt(ft)],(t,[e])=>e.value.indexOf(t.id())>=0],"filter-in-small":[ht,[ut,vt(ft)],(t,[e,i])=>i.value.indexOf(t.properties()[e.value])>=0],"filter-in-large":[ht,[ut,vt(ft)],(t,[e,i])=>function(t,e,i,r){for(;i<=r;){const n=i+r>>1;if(e[n]===t)return!0;e[n]>t?r=n-1:i=n+1}return!1}(t.properties()[e.value],i.value,0,i.value.length-1)],all:{type:ht,overloads:[[[ht,ht],(t,[e,i])=>e.evaluate(t)&&i.evaluate(t)],[Ji(ht),(t,e)=>{for(const i of e)if(!i.evaluate(t))return!1;return!0}]]},any:{type:ht,overloads:[[[ht,ht],(t,[e,i])=>e.evaluate(t)||i.evaluate(t)],[Ji(ht),(t,e)=>{for(const i of e)if(i.evaluate(t))return!0;return!1}]]},"!":[ht,[ht],(t,[e])=>!e.evaluate(t)],"is-supported-script":[ht,[ut],(t,[e])=>{const i=t.globals&&t.globals.isSupportedScript;return!i||i(e.evaluate(t))}],upcase:[ut,[ut],(t,[e])=>e.evaluate(t).toUpperCase()],downcase:[ut,[ut],(t,[e])=>e.evaluate(t).toLowerCase()],concat:[ut,Ji(ft),(t,e)=>e.map((e=>ne(e.evaluate(t)))).join("")],"resolved-locale":[ut,[At],(t,[e])=>e.evaluate(t).resolvedLocale()]});class gr{constructor(t,e){var i;this.expression=t,this._warningHistory={},this._evaluator=new de,this._defaultValue=e?"color"===(i=e).type&&cr(i.default)?new Zt(0,0,0,0):"color"===i.type?Zt.parse(i.default)||null:"padding"===i.type?Xt.parse(i.default)||null:"variableAnchorOffsetCollection"===i.type?Yt.parse(i.default)||null:void 0===i.default?null:i.default:null,this._enumValues=e&&"enum"===e.type?e.values:null}evaluateWithoutErrorHandling(t,e,i,r,n,o){return this._evaluator.globals=t,this._evaluator.feature=e,this._evaluator.featureState=i,this._evaluator.canonical=r,this._evaluator.availableImages=n||null,this._evaluator.formattedSection=o,this.expression.evaluate(this._evaluator)}evaluate(t,e,i,r,n,o){this._evaluator.globals=t,this._evaluator.feature=e||null,this._evaluator.featureState=i||null,this._evaluator.canonical=r,this._evaluator.availableImages=n||null,this._evaluator.formattedSection=o||null;try{const t=this.expression.evaluate(this._evaluator);if(null==t||"number"==typeof t&&t!=t)return this._defaultValue;if(this._enumValues&&!(t in this._enumValues))throw new se(`Expected value to be one of ${Object.keys(this._enumValues).map((t=>JSON.stringify(t))).join(", ")}, but found ${JSON.stringify(t)} instead.`);return t}catch(t){return this._warningHistory[t.message]||(this._warningHistory[t.message]=!0,"undefined"!=typeof console&&console.warn(t.message)),this._defaultValue}}}function _r(t){return Array.isArray(t)&&t.length>0&&"string"==typeof t[0]&&t[0]in Zi}function yr(t,e){const i=new pe(Zi,Yi,[],e?function(t){const e={color:dt,string:ut,number:ct,enum:ut,boolean:ht,formatted:mt,padding:gt,resolvedImage:_t,variableAnchorOffsetCollection:yt};return"array"===t.type?vt(e[t.value]||ft,t.length):e[t.type]}(e):void 0),r=i.parse(t,void 0,void 0,void 0,e&&"string"===e.type?{typeAnnotation:"coerce"}:void 0);return r?rr(new gr(r,e)):nr(i.errors)}class vr{constructor(t,e){this.kind=t,this._styleExpression=e,this.isStateDependent="constant"!==t&&!er(e.expression)}evaluateWithoutErrorHandling(t,e,i,r,n,o){return this._styleExpression.evaluateWithoutErrorHandling(t,e,i,r,n,o)}evaluate(t,e,i,r,n,o){return this._styleExpression.evaluate(t,e,i,r,n,o)}}class xr{constructor(t,e,i,r){this.kind=t,this.zoomStops=i,this._styleExpression=e,this.isStateDependent="camera"!==t&&!er(e.expression),this.interpolationType=r}evaluateWithoutErrorHandling(t,e,i,r,n,o){return this._styleExpression.evaluateWithoutErrorHandling(t,e,i,r,n,o)}evaluate(t,e,i,r,n,o){return this._styleExpression.evaluate(t,e,i,r,n,o)}interpolationFactor(t,e,i){return this.interpolationType?ke.interpolationFactor(this.interpolationType,t,e,i):0}}function br(t,e){const i=yr(t,e);if("error"===i.result)return i;const r=i.value.expression,n=tr(r);if(!n&&!or(e))return nr([new st("","data expressions not supported")]);const o=ir(r,["zoom"]);if(!o&&!sr(e))return nr([new st("","zoom expressions not supported")]);const s=Tr(r);return s||o?s instanceof st?nr([s]):s instanceof ke&&!ar(e)?nr([new st("",'"interpolate" expressions cannot be used with this property')]):rr(s?new xr(n?"camera":"composite",i.value,s.labels,s instanceof ke?s.interpolation:void 0):new vr(n?"constant":"source",i.value)):nr([new st("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class wr{constructor(t,e){this._parameters=t,this._specification=e,ot(this,hr(this._parameters,this._specification))}static deserialize(t){return new wr(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function Tr(t){let e=null;if(t instanceof fe)e=Tr(t.result);else if(t instanceof Le){for(const i of t.args)if(e=Tr(i),e)break}else(t instanceof we||t instanceof ke)&&t.input instanceof qi&&"zoom"===t.input.name&&(e=t);return e instanceof st||t.eachChild((t=>{const i=Tr(t);i instanceof st?e=i:!e&&i?e=new st("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&i&&e!==i&&(e=new st("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),e}function Br(t){if(!0===t||!1===t)return!0;if(!Array.isArray(t)||0===t.length)return!1;switch(t[0]){case"has":return t.length>=2&&"$id"!==t[1]&&"$type"!==t[1];case"in":return t.length>=3&&("string"!=typeof t[1]||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==t.length||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(const e of t.slice(1))if(!Br(e)&&"boolean"!=typeof e)return!1;return!0;default:return!0}}const Er={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Cr(t){if(null==t)return{filter:()=>!0,needGeometry:!1};Br(t)||(t=Mr(t));const e=yr(t,Er);if("error"===e.result)throw new Error(e.value.map((t=>`${t.key}: ${t.message}`)).join(", "));return{filter:(t,i,r)=>e.value.evaluate(t,i,{},r),needGeometry:Ir(t)}}function Sr(t,e){return t<e?-1:t>e?1:0}function Ir(t){if(!Array.isArray(t))return!1;if("within"===t[0]||"distance"===t[0])return!0;for(let e=1;e<t.length;e++)if(Ir(t[e]))return!0;return!1}function Mr(t){if(!t)return!0;const e=t[0];return t.length<=1?"any"!==e:"=="===e?kr(t[1],t[2],"=="):"!="===e?zr(kr(t[1],t[2],"==")):"<"===e||">"===e||"<="===e||">="===e?kr(t[1],t[2],e):"any"===e?(i=t.slice(1),["any"].concat(i.map(Mr))):"all"===e?["all"].concat(t.slice(1).map(Mr)):"none"===e?["all"].concat(t.slice(1).map(Mr).map(zr)):"in"===e?Pr(t[1],t.slice(2)):"!in"===e?zr(Pr(t[1],t.slice(2))):"has"===e?Lr(t[1]):"!has"!==e||zr(Lr(t[1]));var i}function kr(t,e,i){switch(t){case"$type":return[`filter-type-${i}`,e];case"$id":return[`filter-id-${i}`,e];default:return[`filter-${i}`,t,e]}}function Pr(t,e){if(0===e.length)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some((t=>typeof t!=typeof e[0]))?["filter-in-large",t,["literal",e.sort(Sr)]]:["filter-in-small",t,["literal",e]]}}function Lr(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function zr(t){return["!",t]}function Fr(t){const e=typeof t;if("number"===e||"boolean"===e||"string"===e||null==t)return JSON.stringify(t);if(Array.isArray(t)){let e="[";for(const i of t)e+=`${Fr(i)},`;return`${e}]`}const i=Object.keys(t).sort();let r="{";for(let e=0;e<i.length;e++)r+=`${JSON.stringify(i[e])}:${Fr(t[i[e]])},`;return`${r}}`}function Dr(t){let e="";for(const i of Z)e+=`/${Fr(t[i])}`;return e}function Rr(t){const e=t.value;return e?[new nt(t.key,e,"constants have been deprecated as of v8")]:[]}function Ur(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function Or(t){if(Array.isArray(t))return t.map(Or);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){const e={};for(const i in t)e[i]=Or(t[i]);return e}return Ur(t)}function Nr(t){const e=t.key,i=t.value,r=t.valueSpec||{},n=t.objectElementValidators||{},o=t.style,s=t.styleSpec,a=t.validateSpec;let l=[];const c=lr(i);if("object"!==c)return[new nt(e,i,`object expected, ${c} found`)];for(const t in i){const c=t.split(".")[0],u=r[c]||r["*"];let h;if(n[c])h=n[c];else if(r[c])h=a;else if(n["*"])h=n["*"];else{if(!r["*"]){l.push(new nt(e,i[t],`unknown property "${t}"`));continue}h=a}l=l.concat(h({key:(e?`${e}.`:e)+t,value:i[t],valueSpec:u,style:o,styleSpec:s,object:i,objectKey:t,validateSpec:a},i))}for(const t in r)n[t]||r[t].required&&void 0===r[t].default&&void 0===i[t]&&l.push(new nt(e,i,`missing required property "${t}"`));return l}function Qr(t){const e=t.value,i=t.valueSpec,r=t.style,n=t.styleSpec,o=t.key,s=t.arrayElementValidator||t.validateSpec;if("array"!==lr(e))return[new nt(o,e,`array expected, ${lr(e)} found`)];if(i.length&&e.length!==i.length)return[new nt(o,e,`array length ${i.length} expected, length ${e.length} found`)];if(i["min-length"]&&e.length<i["min-length"])return[new nt(o,e,`array length at least ${i["min-length"]} expected, length ${e.length} found`)];let a={type:i.value,values:i.values};n.$version<7&&(a.function=i.function),"object"===lr(i.value)&&(a=i.value);let l=[];for(let i=0;i<e.length;i++)l=l.concat(s({array:e,arrayIndex:i,value:e[i],valueSpec:a,validateSpec:t.validateSpec,style:r,styleSpec:n,key:`${o}[${i}]`}));return l}function Vr(t){const e=t.key,i=t.value,r=t.valueSpec;let n=lr(i);return"number"===n&&i!=i&&(n="NaN"),"number"!==n?[new nt(e,i,`number expected, ${n} found`)]:"minimum"in r&&i<r.minimum?[new nt(e,i,`${i} is less than the minimum value ${r.minimum}`)]:"maximum"in r&&i>r.maximum?[new nt(e,i,`${i} is greater than the maximum value ${r.maximum}`)]:[]}function jr(t){const e=t.valueSpec,i=Ur(t.value.type);let r,n,o,s={};const a="categorical"!==i&&void 0===t.value.property,l=!a,c="array"===lr(t.value.stops)&&"array"===lr(t.value.stops[0])&&"object"===lr(t.value.stops[0][0]),u=Nr({key:t.key,value:t.value,valueSpec:t.styleSpec.function,validateSpec:t.validateSpec,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(t){if("identity"===i)return[new nt(t.key,t.value,'identity function may not have a "stops" property')];let e=[];const r=t.value;return e=e.concat(Qr({key:t.key,value:r,valueSpec:t.valueSpec,validateSpec:t.validateSpec,style:t.style,styleSpec:t.styleSpec,arrayElementValidator:h})),"array"===lr(r)&&0===r.length&&e.push(new nt(t.key,r,"array must have at least one stop")),e},default:function(t){return t.validateSpec({key:t.key,value:t.value,valueSpec:e,validateSpec:t.validateSpec,style:t.style,styleSpec:t.styleSpec})}}});return"identity"===i&&a&&u.push(new nt(t.key,t.value,'missing required property "property"')),"identity"===i||t.value.stops||u.push(new nt(t.key,t.value,'missing required property "stops"')),"exponential"===i&&t.valueSpec.expression&&!ar(t.valueSpec)&&u.push(new nt(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(l&&!or(t.valueSpec)?u.push(new nt(t.key,t.value,"property functions not supported")):a&&!sr(t.valueSpec)&&u.push(new nt(t.key,t.value,"zoom functions not supported"))),"categorical"!==i&&!c||void 0!==t.value.property||u.push(new nt(t.key,t.value,'"property" property is required')),u;function h(t){let i=[];const r=t.value,a=t.key;if("array"!==lr(r))return[new nt(a,r,`array expected, ${lr(r)} found`)];if(2!==r.length)return[new nt(a,r,`array length 2 expected, length ${r.length} found`)];if(c){if("object"!==lr(r[0]))return[new nt(a,r,`object expected, ${lr(r[0])} found`)];if(void 0===r[0].zoom)return[new nt(a,r,"object stop key must have zoom")];if(void 0===r[0].value)return[new nt(a,r,"object stop key must have value")];if(o&&o>Ur(r[0].zoom))return[new nt(a,r[0].zoom,"stop zoom values must appear in ascending order")];Ur(r[0].zoom)!==o&&(o=Ur(r[0].zoom),n=void 0,s={}),i=i.concat(Nr({key:`${a}[0]`,value:r[0],valueSpec:{zoom:{}},validateSpec:t.validateSpec,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{zoom:Vr,value:d}}))}else i=i.concat(d({key:`${a}[0]`,value:r[0],valueSpec:{},validateSpec:t.validateSpec,style:t.style,styleSpec:t.styleSpec},r));return _r(Or(r[1]))?i.concat([new nt(`${a}[1]`,r[1],"expressions are not allowed in function stops.")]):i.concat(t.validateSpec({key:`${a}[1]`,value:r[1],valueSpec:e,validateSpec:t.validateSpec,style:t.style,styleSpec:t.styleSpec}))}function d(t,o){const a=lr(t.value),l=Ur(t.value),c=null!==t.value?t.value:o;if(r){if(a!==r)return[new nt(t.key,c,`${a} stop domain type must match previous stop domain type ${r}`)]}else r=a;if("number"!==a&&"string"!==a&&"boolean"!==a)return[new nt(t.key,c,"stop domain value must be a number, string, or boolean")];if("number"!==a&&"categorical"!==i){let r=`number expected, ${a} found`;return or(e)&&void 0===i&&(r+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new nt(t.key,c,r)]}return"categorical"!==i||"number"!==a||isFinite(l)&&Math.floor(l)===l?"categorical"!==i&&"number"===a&&void 0!==n&&l<n?[new nt(t.key,c,"stop domain values must appear in ascending order")]:(n=l,"categorical"===i&&l in s?[new nt(t.key,c,"stop domain values must be unique")]:(s[l]=!0,[])):[new nt(t.key,c,`integer expected, found ${l}`)]}}function Hr(t){const e=("property"===t.expressionContext?br:yr)(Or(t.value),t.valueSpec);if("error"===e.result)return e.value.map((e=>new nt(`${t.key}${e.key}`,t.value,e.message)));const i=e.value.expression||e.value._styleExpression.expression;if("property"===t.expressionContext&&"text-font"===t.propertyKey&&!i.outputDefined())return[new nt(t.key,t.value,`Invalid data expression for "${t.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===t.expressionContext&&"layout"===t.propertyType&&!er(i))return[new nt(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===t.expressionContext&&!er(i))return[new nt(t.key,t.value,'"feature-state" data expressions are not supported with filters.')];if(t.expressionContext&&0===t.expressionContext.indexOf("cluster")){if(!ir(i,["zoom","feature-state"]))return[new nt(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===t.expressionContext&&!tr(i))return[new nt(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Gr(t){const e=t.key,i=t.value,r=t.valueSpec,n=[];return Array.isArray(r.values)?-1===r.values.indexOf(Ur(i))&&n.push(new nt(e,i,`expected one of [${r.values.join(", ")}], ${JSON.stringify(i)} found`)):-1===Object.keys(r.values).indexOf(Ur(i))&&n.push(new nt(e,i,`expected one of [${Object.keys(r.values).join(", ")}], ${JSON.stringify(i)} found`)),n}function $r(t){return Br(Or(t.value))?Hr(ot({},t,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Zr(t)}function Zr(t){const e=t.value,i=t.key;if("array"!==lr(e))return[new nt(i,e,`array expected, ${lr(e)} found`)];const r=t.styleSpec;let n,o=[];if(e.length<1)return[new nt(i,e,"filter array must have at least 1 element")];switch(o=o.concat(Gr({key:`${i}[0]`,value:e[0],valueSpec:r.filter_operator,style:t.style,styleSpec:t.styleSpec})),Ur(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&"$type"===Ur(e[1])&&o.push(new nt(i,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":3!==e.length&&o.push(new nt(i,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(n=lr(e[1]),"string"!==n&&o.push(new nt(`${i}[1]`,e[1],`string expected, ${n} found`)));for(let s=2;s<e.length;s++)n=lr(e[s]),"$type"===Ur(e[1])?o=o.concat(Gr({key:`${i}[${s}]`,value:e[s],valueSpec:r.geometry_type,style:t.style,styleSpec:t.styleSpec})):"string"!==n&&"number"!==n&&"boolean"!==n&&o.push(new nt(`${i}[${s}]`,e[s],`string, number, or boolean expected, ${n} found`));break;case"any":case"all":case"none":for(let r=1;r<e.length;r++)o=o.concat(Zr({key:`${i}[${r}]`,value:e[r],style:t.style,styleSpec:t.styleSpec}));break;case"has":case"!has":n=lr(e[1]),2!==e.length?o.push(new nt(i,e,`filter array for "${e[0]}" operator must have 2 elements`)):"string"!==n&&o.push(new nt(`${i}[1]`,e[1],`string expected, ${n} found`))}return o}function qr(t,e){const i=t.key,r=t.validateSpec,n=t.style,o=t.styleSpec,s=t.value,a=t.objectKey,l=o[`${e}_${t.layerType}`];if(!l)return[];const c=a.match(/^(.*)-transition$/);if("paint"===e&&c&&l[c[1]]&&l[c[1]].transition)return r({key:i,value:s,valueSpec:o.transition,style:n,styleSpec:o});const u=t.valueSpec||l[a];if(!u)return[new nt(i,s,`unknown property "${a}"`)];let h;if("string"===lr(s)&&or(u)&&!u.tokens&&(h=/^{([^}]+)}$/.exec(s)))return[new nt(i,s,`"${a}" does not support interpolation syntax\nUse an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(h[1])} }\`.`)];const d=[];return"symbol"===t.layerType&&("text-field"===a&&n&&!n.glyphs&&d.push(new nt(i,s,'use of "text-field" requires a style "glyphs" property')),"text-font"===a&&cr(Or(s))&&"identity"===Ur(s.type)&&d.push(new nt(i,s,'"text-font" does not support identity functions'))),d.concat(r({key:t.key,value:s,valueSpec:u,style:n,styleSpec:o,expressionContext:"property",propertyType:e,propertyKey:a}))}function Kr(t){return qr(t,"paint")}function Wr(t){return qr(t,"layout")}function Xr(t){let e=[];const i=t.value,r=t.key,n=t.style,o=t.styleSpec;i.type||i.ref||e.push(new nt(r,i,'either "type" or "ref" is required'));let s=Ur(i.type);const a=Ur(i.ref);if(i.id){const o=Ur(i.id);for(let s=0;s<t.arrayIndex;s++){const t=n.layers[s];Ur(t.id)===o&&e.push(new nt(r,i.id,`duplicate layer id "${i.id}", previously used at line ${t.id.__line__}`))}}if("ref"in i){let t;["type","source","source-layer","filter","layout"].forEach((t=>{t in i&&e.push(new nt(r,i[t],`"${t}" is prohibited for ref layers`))})),n.layers.forEach((e=>{Ur(e.id)===a&&(t=e)})),t?t.ref?e.push(new nt(r,i.ref,"ref cannot reference another ref layer")):s=Ur(t.type):e.push(new nt(r,i.ref,`ref layer "${a}" not found`))}else if("background"!==s)if(i.source){const t=n.sources&&n.sources[i.source],o=t&&Ur(t.type);t?"vector"===o&&"raster"===s?e.push(new nt(r,i.source,`layer "${i.id}" requires a raster source`)):"raster-dem"!==o&&"hillshade"===s?e.push(new nt(r,i.source,`layer "${i.id}" requires a raster-dem source`)):"raster"===o&&"raster"!==s?e.push(new nt(r,i.source,`layer "${i.id}" requires a vector source`)):"vector"!==o||i["source-layer"]?"raster-dem"===o&&"hillshade"!==s?e.push(new nt(r,i.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==s||!i.paint||!i.paint["line-gradient"]||"geojson"===o&&t.lineMetrics||e.push(new nt(r,i,`layer "${i.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new nt(r,i,`layer "${i.id}" must specify a "source-layer"`)):e.push(new nt(r,i.source,`source "${i.source}" not found`))}else e.push(new nt(r,i,'missing required property "source"'));return e=e.concat(Nr({key:r,value:i,valueSpec:o.layer,style:t.style,styleSpec:t.styleSpec,validateSpec:t.validateSpec,objectElementValidators:{"*":()=>[],type:()=>t.validateSpec({key:`${r}.type`,value:i.type,valueSpec:o.layer.type,style:t.style,styleSpec:t.styleSpec,validateSpec:t.validateSpec,object:i,objectKey:"type"}),filter:$r,layout:t=>Nr({layer:i,key:t.key,value:t.value,style:t.style,styleSpec:t.styleSpec,validateSpec:t.validateSpec,objectElementValidators:{"*":t=>Wr(ot({layerType:s},t))}}),paint:t=>Nr({layer:i,key:t.key,value:t.value,style:t.style,styleSpec:t.styleSpec,validateSpec:t.validateSpec,objectElementValidators:{"*":t=>Kr(ot({layerType:s},t))}})}})),e}function Jr(t){const e=t.value,i=t.key,r=lr(e);return"string"!==r?[new nt(i,e,`string expected, ${r} found`)]:[]}const Yr={promoteId:function({key:t,value:e}){if("string"===lr(e))return Jr({key:t,value:e});{const i=[];for(const r in e)i.push(...Jr({key:`${t}.${r}`,value:e[r]}));return i}}};function tn(t){const e=t.value,i=t.key,r=t.styleSpec,n=t.style,o=t.validateSpec;if(!e.type)return[new nt(i,e,'"type" is required')];const s=Ur(e.type);let a;switch(s){case"vector":case"raster":return a=Nr({key:i,value:e,valueSpec:r[`source_${s.replace("-","_")}`],style:t.style,styleSpec:r,objectElementValidators:Yr,validateSpec:o}),a;case"raster-dem":return a=function(t){var e;const i=null!==(e=t.sourceName)&&void 0!==e?e:"",r=t.value,n=t.styleSpec,o=n.source_raster_dem,s=t.style;let a=[];const l=lr(r);if(void 0===r)return a;if("object"!==l)return a.push(new nt("source_raster_dem",r,`object expected, ${l} found`)),a;const c="custom"===Ur(r.encoding),u=["redFactor","greenFactor","blueFactor","baseShift"],h=t.value.encoding?`"${t.value.encoding}"`:"Default";for(const e in r)!c&&u.includes(e)?a.push(new nt(e,r[e],`In "${i}": "${e}" is only valid when "encoding" is set to "custom". ${h} encoding found`)):o[e]?a=a.concat(t.validateSpec({key:e,value:r[e],valueSpec:o[e],validateSpec:t.validateSpec,style:s,styleSpec:n})):a.push(new nt(e,r[e],`unknown property "${e}"`));return a}({sourceName:i,value:e,style:t.style,styleSpec:r,validateSpec:o}),a;case"geojson":if(a=Nr({key:i,value:e,valueSpec:r.source_geojson,style:n,styleSpec:r,validateSpec:o,objectElementValidators:Yr}),e.cluster)for(const t in e.clusterProperties){const[r,n]=e.clusterProperties[t],s="string"==typeof r?[r,["accumulated"],["get",t]]:r;a.push(...Hr({key:`${i}.${t}.map`,value:n,validateSpec:o,expressionContext:"cluster-map"})),a.push(...Hr({key:`${i}.${t}.reduce`,value:s,validateSpec:o,expressionContext:"cluster-reduce"}))}return a;case"video":return Nr({key:i,value:e,valueSpec:r.source_video,style:n,validateSpec:o,styleSpec:r});case"image":return Nr({key:i,value:e,valueSpec:r.source_image,style:n,validateSpec:o,styleSpec:r});case"canvas":return[new nt(i,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Gr({key:`${i}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:n,validateSpec:o,styleSpec:r})}}function en(t){const e=t.value,i=t.styleSpec,r=i.light,n=t.style;let o=[];const s=lr(e);if(void 0===e)return o;if("object"!==s)return o=o.concat([new nt("light",e,`object expected, ${s} found`)]),o;for(const s in e){const a=s.match(/^(.*)-transition$/);o=o.concat(a&&r[a[1]]&&r[a[1]].transition?t.validateSpec({key:s,value:e[s],valueSpec:i.transition,validateSpec:t.validateSpec,style:n,styleSpec:i}):r[s]?t.validateSpec({key:s,value:e[s],valueSpec:r[s],validateSpec:t.validateSpec,style:n,styleSpec:i}):[new nt(s,e[s],`unknown property "${s}"`)])}return o}function rn(t){const e=t.value,i=t.styleSpec,r=i.sky,n=t.style,o=lr(e);if(void 0===e)return[];if("object"!==o)return[new nt("sky",e,`object expected, ${o} found`)];let s=[];for(const o in e)s=s.concat(r[o]?t.validateSpec({key:o,value:e[o],valueSpec:r[o],style:n,styleSpec:i}):[new nt(o,e[o],`unknown property "${o}"`)]);return s}function nn(t){const e=t.value,i=t.styleSpec,r=i.terrain,n=t.style;let o=[];const s=lr(e);if(void 0===e)return o;if("object"!==s)return o=o.concat([new nt("terrain",e,`object expected, ${s} found`)]),o;for(const s in e)o=o.concat(r[s]?t.validateSpec({key:s,value:e[s],valueSpec:r[s],validateSpec:t.validateSpec,style:n,styleSpec:i}):[new nt(s,e[s],`unknown property "${s}"`)]);return o}function on(t){let e=[];const i=t.value,r=t.key;if(Array.isArray(i)){const n=[],o=[];for(const s in i)i[s].id&&n.includes(i[s].id)&&e.push(new nt(r,i,`all the sprites' ids must be unique, but ${i[s].id} is duplicated`)),n.push(i[s].id),i[s].url&&o.includes(i[s].url)&&e.push(new nt(r,i,`all the sprites' URLs must be unique, but ${i[s].url} is duplicated`)),o.push(i[s].url),e=e.concat(Nr({key:`${r}[${s}]`,value:i[s],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:t.validateSpec}));return e}return Jr({key:r,value:i})}const sn={"*":()=>[],array:Qr,boolean:function(t){const e=t.value,i=t.key,r=lr(e);return"boolean"!==r?[new nt(i,e,`boolean expected, ${r} found`)]:[]},number:Vr,color:function(t){const e=t.key,i=t.value,r=lr(i);return"string"!==r?[new nt(e,i,`color expected, ${r} found`)]:Zt.parse(String(i))?[]:[new nt(e,i,`color expected, "${i}" found`)]},constants:Rr,enum:Gr,filter:$r,function:jr,layer:Xr,object:Nr,source:tn,light:en,sky:rn,terrain:nn,projection:function(t){const e=t.value,i=t.styleSpec,r=i.projection,n=t.style,o=lr(e);if(void 0===e)return[];if("object"!==o)return[new nt("projection",e,`object expected, ${o} found`)];let s=[];for(const o in e)s=s.concat(r[o]?t.validateSpec({key:o,value:e[o],valueSpec:r[o],style:n,styleSpec:i}):[new nt(o,e[o],`unknown property "${o}"`)]);return s},string:Jr,formatted:function(t){return 0===Jr(t).length?[]:Hr(t)},resolvedImage:function(t){return 0===Jr(t).length?[]:Hr(t)},padding:function(t){const e=t.key,i=t.value;if("array"===lr(i)){if(i.length<1||i.length>4)return[new nt(e,i,`padding requires 1 to 4 values; ${i.length} values found`)];const r={type:"number"};let n=[];for(let o=0;o<i.length;o++)n=n.concat(t.validateSpec({key:`${e}[${o}]`,value:i[o],validateSpec:t.validateSpec,valueSpec:r}));return n}return Vr({key:e,value:i,valueSpec:{}})},variableAnchorOffsetCollection:function(t){const e=t.key,i=t.value,r=lr(i),n=t.styleSpec;if("array"!==r||i.length<1||i.length%2!=0)return[new nt(e,i,"variableAnchorOffsetCollection requires a non-empty array of even length")];let o=[];for(let r=0;r<i.length;r+=2)o=o.concat(Gr({key:`${e}[${r}]`,value:i[r],valueSpec:n.layout_symbol["text-anchor"]})),o=o.concat(Qr({key:`${e}[${r+1}]`,value:i[r+1],valueSpec:{length:2,value:"number"},validateSpec:t.validateSpec,style:t.style,styleSpec:n}));return o},sprite:on};function an(t){const e=t.value,i=t.valueSpec,r=t.styleSpec;return t.validateSpec=an,i.expression&&cr(Ur(e))?jr(t):i.expression&&_r(Or(e))?Hr(t):i.type&&sn[i.type]?sn[i.type](t):Nr(ot({},t,{valueSpec:i.type?r[i.type]:i}))}function ln(t){const e=t.value,i=t.key,r=Jr(t);return r.length||(-1===e.indexOf("{fontstack}")&&r.push(new nt(i,e,'"glyphs" url must include a "{fontstack}" token')),-1===e.indexOf("{range}")&&r.push(new nt(i,e,'"glyphs" url must include a "{range}" token'))),r}function cn(t,e=$){let i=[];return i=i.concat(an({key:"",value:t,valueSpec:e.$root,styleSpec:e,style:t,validateSpec:an,objectElementValidators:{glyphs:ln,"*":()=>[]}})),t.constants&&(i=i.concat(Rr({key:"constants",value:t.constants,style:t,styleSpec:e,validateSpec:an}))),hn(i)}function un(t){return function(e){return t({...e,validateSpec:an})}}function hn(t){return[].concat(t).sort(((t,e)=>t.line-e.line))}function dn(t){return function(...e){return hn(t.apply(this,e))}}cn.source=dn(un(tn)),cn.sprite=dn(un(on)),cn.glyphs=dn(un(ln)),cn.light=dn(un(en)),cn.sky=dn(un(rn)),cn.terrain=dn(un(nn)),cn.layer=dn(un(Xr)),cn.filter=dn(un($r)),cn.paintProperty=dn(un(Kr)),cn.layoutProperty=dn(un(Wr));const pn=cn,fn=pn.light,An=pn.sky,mn=pn.paintProperty,gn=pn.layoutProperty;function _n(t,e){let i=!1;if(e&&e.length)for(const r of e)t.fire(new H(new Error(r.message))),i=!0;return i}class yn{constructor(t,e,i){const r=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;const n=new Int32Array(this.arrayBuffer);t=n[0],this.d=(e=n[1])+2*(i=n[2]);for(let t=0;t<this.d*this.d;t++){const e=n[3+t],i=n[3+t+1];r.push(e===i?null:n.subarray(e,i))}const o=n[3+r.length+1];this.keys=n.subarray(n[3+r.length],o),this.bboxes=n.subarray(o),this.insert=this._insertReadonly}else{this.d=e+2*i;for(let t=0;t<this.d*this.d;t++)r.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=i,this.scale=e/t,this.uid=0;const n=i/e*t;this.min=-n,this.max=t+n}insert(t,e,i,r,n){this._forEachCell(e,i,r,n,this._insertCell,this.uid++,void 0,void 0),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(i),this.bboxes.push(r),this.bboxes.push(n)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(t,e,i,r,n,o){this.cells[n].push(o)}query(t,e,i,r,n){const o=this.min,s=this.max;if(t<=o&&e<=o&&s<=i&&s<=r&&!n)return Array.prototype.slice.call(this.keys);{const o=[];return this._forEachCell(t,e,i,r,this._queryCell,o,{},n),o}}_queryCell(t,e,i,r,n,o,s,a){const l=this.cells[n];if(null!==l){const n=this.keys,c=this.bboxes;for(let u=0;u<l.length;u++){const h=l[u];if(void 0===s[h]){const l=4*h;(a?a(c[l+0],c[l+1],c[l+2],c[l+3]):t<=c[l+2]&&e<=c[l+3]&&i>=c[l+0]&&r>=c[l+1])?(s[h]=!0,o.push(n[h])):s[h]=!1}}}}_forEachCell(t,e,i,r,n,o,s,a){const l=this._convertToCellCoord(t),c=this._convertToCellCoord(e),u=this._convertToCellCoord(i),h=this._convertToCellCoord(r);for(let d=l;d<=u;d++)for(let l=c;l<=h;l++){const c=this.d*l+d;if((!a||a(this._convertFromCellCoord(d),this._convertFromCellCoord(l),this._convertFromCellCoord(d+1),this._convertFromCellCoord(l+1)))&&n.call(this,t,e,i,r,c,o,s,a))return}}_convertFromCellCoord(t){return(t-this.padding)/this.scale}_convertToCellCoord(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const t=this.cells,e=3+this.cells.length+1+1;let i=0;for(let t=0;t<this.cells.length;t++)i+=this.cells[t].length;const r=new Int32Array(e+i+this.keys.length+this.bboxes.length);r[0]=this.extent,r[1]=this.n,r[2]=this.padding;let n=e;for(let e=0;e<t.length;e++){const i=t[e];r[3+e]=n,r.set(i,n),n+=i.length}return r[3+t.length]=n,r.set(this.keys,n),n+=this.keys.length,r[3+t.length+1]=n,r.set(this.bboxes,n),n+=this.bboxes.length,r.buffer}static serialize(t,e){const i=t.toArrayBuffer();return e&&e.push(i),{buffer:i}}static deserialize(t){return new yn(t.buffer)}}const vn={};function xn(t,e,i={}){if(vn[t])throw new Error(`${t} is already registered.`);Object.defineProperty(e,"_classRegistryKey",{value:t,writeable:!1}),vn[t]={klass:e,omit:i.omit||[],shallow:i.shallow||[]}}xn("Object",Object),xn("TransferableGridIndex",yn),xn("Color",Zt),xn("Error",Error),xn("AJAXError",R),xn("ResolvedImage",te),xn("StylePropertyFunction",wr),xn("StyleExpression",gr,{omit:["_evaluator"]}),xn("ZoomDependentExpression",xr),xn("ZoomConstantExpression",vr),xn("CompoundExpression",qi,{omit:["_evaluate"]});for(const t in Zi)Zi[t]._classRegistryKey||xn(`Expression_${t}`,Zi[t]);function bn(t){return t&&"undefined"!=typeof ArrayBuffer&&(t instanceof ArrayBuffer||t.constructor&&"ArrayBuffer"===t.constructor.name)}function wn(t){return t.$name||t.constructor._classRegistryKey}function Tn(t){return!function(t){if(null===t||"object"!=typeof t)return!1;const e=wn(t);return!(!e||"Object"===e)}(t)&&(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||t instanceof Blob||t instanceof Error||bn(t)||C(t)||ArrayBuffer.isView(t)||t instanceof ImageData)}function Bn(t,e){if(Tn(t))return(bn(t)||C(t))&&e&&e.push(t),ArrayBuffer.isView(t)&&e&&e.push(t.buffer),t instanceof ImageData&&e&&e.push(t.data.buffer),t;if(Array.isArray(t)){const i=[];for(const r of t)i.push(Bn(r,e));return i}if("object"!=typeof t)throw new Error("can't serialize object of type "+typeof t);const i=wn(t);if(!i)throw new Error(`can't serialize object of unregistered class ${t.constructor.name}`);if(!vn[i])throw new Error(`${i} is not registered.`);const{klass:r}=vn[i],n=r.serialize?r.serialize(t,e):{};if(r.serialize){if(e&&n===e[e.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const r in t){if(!t.hasOwnProperty(r))continue;if(vn[i].omit.indexOf(r)>=0)continue;const o=t[r];n[r]=vn[i].shallow.indexOf(r)>=0?o:Bn(o,e)}t instanceof Error&&(n.message=t.message)}if(n.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==i&&(n.$name=i),n}function En(t){if(Tn(t))return t;if(Array.isArray(t))return t.map(En);if("object"!=typeof t)throw new Error("can't deserialize object of type "+typeof t);const e=wn(t)||"Object";if(!vn[e])throw new Error(`can't deserialize unregistered class ${e}`);const{klass:i}=vn[e];if(!i)throw new Error(`can't deserialize unregistered class ${e}`);if(i.deserialize)return i.deserialize(t);const r=Object.create(i.prototype);for(const i of Object.keys(t)){if("$name"===i)continue;const n=t[i];r[i]=vn[e].shallow.indexOf(i)>=0?n:En(n)}return r}class Cn{constructor(){this.first=!0}update(t,e){const i=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=i,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=i,!0):(this.lastFloorZoom>i?(this.lastIntegerZoom=i+1,this.lastIntegerZoomTime=e):this.lastFloorZoom<i&&(this.lastIntegerZoom=i,this.lastIntegerZoomTime=e),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=i,!0))}}const Sn={"Latin-1 Supplement":t=>t>=128&&t<=255,"Hangul Jamo":t=>t>=4352&&t<=4607,Khmer:t=>t>=6016&&t<=6143,"General Punctuation":t=>t>=8192&&t<=8303,"Letterlike Symbols":t=>t>=8448&&t<=8527,"Number Forms":t=>t>=8528&&t<=8591,"Miscellaneous Technical":t=>t>=8960&&t<=9215,"Control Pictures":t=>t>=9216&&t<=9279,"Optical Character Recognition":t=>t>=9280&&t<=9311,"Enclosed Alphanumerics":t=>t>=9312&&t<=9471,"Geometric Shapes":t=>t>=9632&&t<=9727,"Miscellaneous Symbols":t=>t>=9728&&t<=9983,"Miscellaneous Symbols and Arrows":t=>t>=11008&&t<=11263,"Ideographic Description Characters":t=>t>=12272&&t<=12287,"CJK Symbols and Punctuation":t=>t>=12288&&t<=12351,Katakana:t=>t>=12448&&t<=12543,Kanbun:t=>t>=12688&&t<=12703,"CJK Strokes":t=>t>=12736&&t<=12783,"Enclosed CJK Letters and Months":t=>t>=12800&&t<=13055,"CJK Compatibility":t=>t>=13056&&t<=13311,"Yijing Hexagram Symbols":t=>t>=19904&&t<=19967,"Private Use Area":t=>t>=57344&&t<=63743,"Vertical Forms":t=>t>=65040&&t<=65055,"CJK Compatibility Forms":t=>t>=65072&&t<=65103,"Small Form Variants":t=>t>=65104&&t<=65135,"Halfwidth and Fullwidth Forms":t=>t>=65280&&t<=65519};function In(t){for(const e of t)if(Fn(e.charCodeAt(0)))return!0;return!1}function Mn(t){for(const e of t)if(!Ln(e.charCodeAt(0)))return!1;return!0}function kn(t){const e=t.map((t=>{try{return new RegExp(`\\p{sc=${t}}`,"u").source}catch(t){return null}})).filter((t=>t));return new RegExp(e.join("|"),"u")}const Pn=kn(["Arab","Dupl","Mong","Ougr","Syrc"]);function Ln(t){return!Pn.test(String.fromCodePoint(t))}const zn=kn(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function Fn(t){return!(746!==t&&747!==t&&(t<4352||!(Sn["CJK Compatibility Forms"](t)&&!(t>=65097&&t<=65103)||Sn["CJK Compatibility"](t)||Sn["CJK Strokes"](t)||!(!Sn["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||12336===t)||Sn["Enclosed CJK Letters and Months"](t)||Sn["Ideographic Description Characters"](t)||Sn.Kanbun(t)||Sn.Katakana(t)&&12540!==t||!(!Sn["Halfwidth and Fullwidth Forms"](t)||65288===t||65289===t||65293===t||t>=65306&&t<=65310||65339===t||65341===t||65343===t||t>=65371&&t<=65503||65507===t||t>=65512&&t<=65519)||!(!Sn["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||Sn["Vertical Forms"](t)||Sn["Yijing Hexagram Symbols"](t)||/\p{sc=Cans}/u.test(String.fromCodePoint(t))||/\p{sc=Hang}/u.test(String.fromCodePoint(t))||zn.test(String.fromCodePoint(t)))))}function Dn(t){return!(Fn(t)||function(t){return!!(Sn["Latin-1 Supplement"](t)&&(167===t||169===t||174===t||177===t||188===t||189===t||190===t||215===t||247===t)||Sn["General Punctuation"](t)&&(8214===t||8224===t||8225===t||8240===t||8241===t||8251===t||8252===t||8258===t||8263===t||8264===t||8265===t||8273===t)||Sn["Letterlike Symbols"](t)||Sn["Number Forms"](t)||Sn["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||9003===t||t>=9085&&t<=9114||t>=9150&&t<=9165||9167===t||t>=9169&&t<=9179||t>=9186&&t<=9215)||Sn["Control Pictures"](t)&&9251!==t||Sn["Optical Character Recognition"](t)||Sn["Enclosed Alphanumerics"](t)||Sn["Geometric Shapes"](t)||Sn["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||Sn["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||Sn["CJK Symbols and Punctuation"](t)||Sn.Katakana(t)||Sn["Private Use Area"](t)||Sn["CJK Compatibility Forms"](t)||Sn["Small Form Variants"](t)||Sn["Halfwidth and Fullwidth Forms"](t)||8734===t||8756===t||8757===t||t>=9984&&t<=10087||t>=10102&&t<=10131||65532===t||65533===t)}(t))}const Rn=kn(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function Un(t){return Rn.test(String.fromCodePoint(t))}function On(t,e){return!(!e&&Un(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||Sn.Khmer(t))}function Nn(t){for(const e of t)if(Un(e.charCodeAt(0)))return!0;return!1}const Qn=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(t){this.pluginStatus=t.pluginStatus,this.pluginURL=t.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(t){this.applyArabicShaping=t.applyArabicShaping,this.processBidirectionalText=t.processBidirectionalText,this.processStyledBidirectionalText=t.processStyledBidirectionalText}isParsed(){return null!=this.applyArabicShaping&&null!=this.processBidirectionalText&&null!=this.processStyledBidirectionalText}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class Vn{constructor(t,e){this.zoom=t,e?(this.now=e.now,this.fadeDuration=e.fadeDuration,this.zoomHistory=e.zoomHistory,this.transition=e.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Cn,this.transition={})}isSupportedScript(t){return function(t,e){for(const i of t)if(!On(i.charCodeAt(0),e))return!1;return!0}(t,"loaded"===Qn.getRTLTextPluginStatus())}crossFadingFactor(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const t=this.zoom,e=t-Math.floor(t),i=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:e+(1-e)*i}:{fromScale:.5,toScale:1,t:1-(1-i)*e}}}class jn{constructor(t,e){this.property=t,this.value=e,this.expression=function(t,e){if(cr(t))return new wr(t,e);if(_r(t)){const i=br(t,e);if("error"===i.result)throw new Error(i.value.map((t=>`${t.key}: ${t.message}`)).join(", "));return i.value}{let i=t;return"color"===e.type&&"string"==typeof t?i=Zt.parse(t):"padding"!==e.type||"number"!=typeof t&&!Array.isArray(t)?"variableAnchorOffsetCollection"===e.type&&Array.isArray(t)&&(i=Yt.parse(t)):i=Xt.parse(t),{kind:"constant",evaluate:()=>i}}}(void 0===e?t.specification.default:e,t.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(t,e,i){return this.property.possiblyEvaluate(this,t,e,i)}}class Hn{constructor(t){this.property=t,this.value=new jn(t,void 0)}transitioned(t,e){return new $n(this.property,this.value,e,g({},t.transition,this.transition),t.now)}untransitioned(){return new $n(this.property,this.value,null,{},0)}}class Gn{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return x(this._values[t].value.value)}setValue(t,e){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new Hn(this._values[t].property)),this._values[t].value=new jn(this._values[t].property,null===e?void 0:x(e))}getTransition(t){return x(this._values[t].transition)}setTransition(t,e){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new Hn(this._values[t].property)),this._values[t].transition=x(e)||void 0}serialize(){const t={};for(const e of Object.keys(this._values)){const i=this.getValue(e);void 0!==i&&(t[e]=i);const r=this.getTransition(e);void 0!==r&&(t[`${e}-transition`]=r)}return t}transitioned(t,e){const i=new Zn(this._properties);for(const r of Object.keys(this._values))i._values[r]=this._values[r].transitioned(t,e._values[r]);return i}untransitioned(){const t=new Zn(this._properties);for(const e of Object.keys(this._values))t._values[e]=this._values[e].untransitioned();return t}}class $n{constructor(t,e,i,r,n){this.property=t,this.value=e,this.begin=n+r.delay||0,this.end=this.begin+r.duration||0,t.specification.transition&&(r.delay||r.duration)&&(this.prior=i)}possiblyEvaluate(t,e,i){const r=t.now||0,n=this.value.possiblyEvaluate(t,e,i),o=this.prior;if(o){if(r>this.end)return this.prior=null,n;if(this.value.isDataDriven())return this.prior=null,n;if(r<this.begin)return o.possiblyEvaluate(t,e,i);{const s=(r-this.begin)/(this.end-this.begin);return this.property.interpolate(o.possiblyEvaluate(t,e,i),n,function(t){if(t<=0)return 0;if(t>=1)return 1;const e=t*t,i=e*t;return 4*(t<.5?i:3*(t-e)+i-.75)}(s))}}return n}}class Zn{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,e,i){const r=new Wn(this._properties);for(const n of Object.keys(this._values))r._values[n]=this._values[n].possiblyEvaluate(t,e,i);return r}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class qn{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}hasValue(t){return void 0!==this._values[t].value}getValue(t){return x(this._values[t].value)}setValue(t,e){this._values[t]=new jn(this._values[t].property,null===e?void 0:x(e))}serialize(){const t={};for(const e of Object.keys(this._values)){const i=this.getValue(e);void 0!==i&&(t[e]=i)}return t}possiblyEvaluate(t,e,i){const r=new Wn(this._properties);for(const n of Object.keys(this._values))r._values[n]=this._values[n].possiblyEvaluate(t,e,i);return r}}class Kn{constructor(t,e,i){this.property=t,this.value=e,this.parameters=i}isConstant(){return"constant"===this.value.kind}constantOr(t){return"constant"===this.value.kind?this.value.value:t}evaluate(t,e,i,r){return this.property.evaluate(this.value,this.parameters,t,e,i,r)}}class Wn{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class Xn{constructor(t){this.specification=t}possiblyEvaluate(t,e){if(t.isDataDriven())throw new Error("Value should not be data driven");return t.expression.evaluate(e)}interpolate(t,e,i){const r=Me[this.specification.type];return r?r(t,e,i):t}}class Jn{constructor(t,e){this.specification=t,this.overrides=e}possiblyEvaluate(t,e,i,r){return new Kn(this,"constant"===t.expression.kind||"camera"===t.expression.kind?{kind:"constant",value:t.expression.evaluate(e,null,{},i,r)}:t.expression,e)}interpolate(t,e,i){if("constant"!==t.value.kind||"constant"!==e.value.kind)return t;if(void 0===t.value.value||void 0===e.value.value)return new Kn(this,{kind:"constant",value:void 0},t.parameters);const r=Me[this.specification.type];if(r){const n=r(t.value.value,e.value.value,i);return new Kn(this,{kind:"constant",value:n},t.parameters)}return t}evaluate(t,e,i,r,n,o){return"constant"===t.kind?t.value:t.evaluate(e,i,r,n,o)}}class Yn extends Jn{possiblyEvaluate(t,e,i,r){if(void 0===t.value)return new Kn(this,{kind:"constant",value:void 0},e);if("constant"===t.expression.kind){const n=t.expression.evaluate(e,null,{},i,r),o="resolvedImage"===t.property.specification.type&&"string"!=typeof n?n.name:n,s=this._calculate(o,o,o,e);return new Kn(this,{kind:"constant",value:s},e)}if("camera"===t.expression.kind){const i=this._calculate(t.expression.evaluate({zoom:e.zoom-1}),t.expression.evaluate({zoom:e.zoom}),t.expression.evaluate({zoom:e.zoom+1}),e);return new Kn(this,{kind:"constant",value:i},e)}return new Kn(this,t.expression,e)}evaluate(t,e,i,r,n,o){if("source"===t.kind){const s=t.evaluate(e,i,r,n,o);return this._calculate(s,s,s,e)}return"composite"===t.kind?this._calculate(t.evaluate({zoom:Math.floor(e.zoom)-1},i,r),t.evaluate({zoom:Math.floor(e.zoom)},i,r),t.evaluate({zoom:Math.floor(e.zoom)+1},i,r),e):t.value}_calculate(t,e,i,r){return r.zoom>r.zoomHistory.lastIntegerZoom?{from:t,to:e}:{from:i,to:e}}interpolate(t){return t}}class to{constructor(t){this.specification=t}possiblyEvaluate(t,e,i,r){if(void 0!==t.value){if("constant"===t.expression.kind){const n=t.expression.evaluate(e,null,{},i,r);return this._calculate(n,n,n,e)}return this._calculate(t.expression.evaluate(new Vn(Math.floor(e.zoom-1),e)),t.expression.evaluate(new Vn(Math.floor(e.zoom),e)),t.expression.evaluate(new Vn(Math.floor(e.zoom+1),e)),e)}}_calculate(t,e,i,r){return r.zoom>r.zoomHistory.lastIntegerZoom?{from:t,to:e}:{from:i,to:e}}interpolate(t){return t}}class eo{constructor(t){this.specification=t}possiblyEvaluate(t,e,i,r){return!!t.expression.evaluate(e,null,{},i,r)}interpolate(){return!1}}class io{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const e in t){const i=t[e];i.specification.overridable&&this.overridableProperties.push(e);const r=this.defaultPropertyValues[e]=new jn(i,void 0),n=this.defaultTransitionablePropertyValues[e]=new Hn(i);this.defaultTransitioningPropertyValues[e]=n.untransitioned(),this.defaultPossiblyEvaluatedValues[e]=r.possiblyEvaluate({})}}}xn("DataDrivenProperty",Jn),xn("DataConstantProperty",Xn),xn("CrossFadedDataDrivenProperty",Yn),xn("CrossFadedProperty",to),xn("ColorRampProperty",eo);const ro="-transition";class no extends G{constructor(t,e){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1},"custom"!==t.type&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,"background"!==t.type&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),e.layout&&(this._unevaluatedLayout=new qn(e.layout)),e.paint)){this._transitionablePaint=new Gn(e.paint);for(const e in t.paint)this.setPaintProperty(e,t.paint[e],{validate:!1});for(const e in t.layout)this.setLayoutProperty(e,t.layout[e],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Wn(e.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return"visibility"===t?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,e,i={}){null!=e&&this._validate(gn,`layers.${this.id}.layout.${t}`,t,e,i)||("visibility"!==t?this._unevaluatedLayout.setValue(t,e):this.visibility=e)}getPaintProperty(t){return t.endsWith(ro)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,e,i={}){if(null!=e&&this._validate(mn,`layers.${this.id}.paint.${t}`,t,e,i))return!1;if(t.endsWith(ro))return this._transitionablePaint.setTransition(t.slice(0,-11),e||void 0),!1;{const i=this._transitionablePaint._values[t],r="cross-faded-data-driven"===i.property.specification["property-type"],n=i.value.isDataDriven(),o=i.value;this._transitionablePaint.setValue(t,e),this._handleSpecialPaintPropertyUpdate(t);const s=this._transitionablePaint._values[t].value;return s.isDataDriven()||n||r||this._handleOverridablePaintPropertyUpdate(t,o,s)}}_handleSpecialPaintPropertyUpdate(t){}_handleOverridablePaintPropertyUpdate(t,e,i){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||"none"===this.visibility}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,e){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,e)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,e)}serialize(){const t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),v(t,((t,e)=>!(void 0===t||"layout"===e&&!Object.keys(t).length||"paint"===e&&!Object.keys(t).length)))}_validate(t,e,i,r,n={}){return(!n||!1!==n.validate)&&_n(this,t.call(pn,{key:e,layerType:this.type,objectKey:i,value:r,styleSpec:$,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){const e=this.paint.get(t);if(e instanceof Kn&&or(e.property.specification)&&("source"===e.value.kind||"composite"===e.value.kind)&&e.value.isStateDependent)return!0}return!1}}const oo={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class so{constructor(t,e){this._structArray=t,this._pos1=e*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class ao{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,e){return t._trim(),e&&(t.isTransferred=!0,e.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const e=Object.create(this.prototype);return e.arrayBuffer=t.arrayBuffer,e.length=t.length,e.capacity=t.arrayBuffer.byteLength/e.bytesPerElement,e._refreshViews(),e}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const e=this.uint8;this._refreshViews(),e&&this.uint8.set(e)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function lo(t,e=1){let i=0,r=0;return{members:t.map((t=>{const n=oo[t.type].BYTES_PER_ELEMENT,o=i=co(i,Math.max(e,n)),s=t.components||1;return r=Math.max(r,n),i+=n*s,{name:t.name,type:t.type,components:s,offset:o}})),size:co(i,Math.max(r,e)),alignment:e}}function co(t,e){return Math.ceil(t/e)*e}class uo extends ao{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e){const i=this.length;return this.resize(i+1),this.emplace(i,t,e)}emplace(t,e,i){const r=2*t;return this.int16[r+0]=e,this.int16[r+1]=i,t}}uo.prototype.bytesPerElement=4,xn("StructArrayLayout2i4",uo);class ho extends ao{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,i){const r=this.length;return this.resize(r+1),this.emplace(r,t,e,i)}emplace(t,e,i,r){const n=3*t;return this.int16[n+0]=e,this.int16[n+1]=i,this.int16[n+2]=r,t}}ho.prototype.bytesPerElement=6,xn("StructArrayLayout3i6",ho);class po extends ao{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,i,r){const n=this.length;return this.resize(n+1),this.emplace(n,t,e,i,r)}emplace(t,e,i,r,n){const o=4*t;return this.int16[o+0]=e,this.int16[o+1]=i,this.int16[o+2]=r,this.int16[o+3]=n,t}}po.prototype.bytesPerElement=8,xn("StructArrayLayout4i8",po);class fo extends ao{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,i,r,n,o){const s=this.length;return this.resize(s+1),this.emplace(s,t,e,i,r,n,o)}emplace(t,e,i,r,n,o,s){const a=6*t;return this.int16[a+0]=e,this.int16[a+1]=i,this.int16[a+2]=r,this.int16[a+3]=n,this.int16[a+4]=o,this.int16[a+5]=s,t}}fo.prototype.bytesPerElement=12,xn("StructArrayLayout2i4i12",fo);class Ao extends ao{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,i,r,n,o){const s=this.length;return this.resize(s+1),this.emplace(s,t,e,i,r,n,o)}emplace(t,e,i,r,n,o,s){const a=4*t,l=8*t;return this.int16[a+0]=e,this.int16[a+1]=i,this.uint8[l+4]=r,this.uint8[l+5]=n,this.uint8[l+6]=o,this.uint8[l+7]=s,t}}Ao.prototype.bytesPerElement=8,xn("StructArrayLayout2i4ub8",Ao);class mo extends ao{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e){const i=this.length;return this.resize(i+1),this.emplace(i,t,e)}emplace(t,e,i){const r=2*t;return this.float32[r+0]=e,this.float32[r+1]=i,t}}mo.prototype.bytesPerElement=8,xn("StructArrayLayout2f8",mo);class go extends ao{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e,i,r,n,o,s,a,l,c){const u=this.length;return this.resize(u+1),this.emplace(u,t,e,i,r,n,o,s,a,l,c)}emplace(t,e,i,r,n,o,s,a,l,c,u){const h=10*t;return this.uint16[h+0]=e,this.uint16[h+1]=i,this.uint16[h+2]=r,this.uint16[h+3]=n,this.uint16[h+4]=o,this.uint16[h+5]=s,this.uint16[h+6]=a,this.uint16[h+7]=l,this.uint16[h+8]=c,this.uint16[h+9]=u,t}}go.prototype.bytesPerElement=20,xn("StructArrayLayout10ui20",go);class _o extends ao{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e,i,r,n,o,s,a,l,c,u,h){const d=this.length;return this.resize(d+1),this.emplace(d,t,e,i,r,n,o,s,a,l,c,u,h)}emplace(t,e,i,r,n,o,s,a,l,c,u,h,d){const p=12*t;return this.int16[p+0]=e,this.int16[p+1]=i,this.int16[p+2]=r,this.int16[p+3]=n,this.uint16[p+4]=o,this.uint16[p+5]=s,this.uint16[p+6]=a,this.uint16[p+7]=l,this.int16[p+8]=c,this.int16[p+9]=u,this.int16[p+10]=h,this.int16[p+11]=d,t}}_o.prototype.bytesPerElement=24,xn("StructArrayLayout4i4ui4i24",_o);class yo extends ao{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,i){const r=this.length;return this.resize(r+1),this.emplace(r,t,e,i)}emplace(t,e,i,r){const n=3*t;return this.float32[n+0]=e,this.float32[n+1]=i,this.float32[n+2]=r,t}}yo.prototype.bytesPerElement=12,xn("StructArrayLayout3f12",yo);class vo extends ao{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const e=this.length;return this.resize(e+1),this.emplace(e,t)}emplace(t,e){return this.uint32[1*t+0]=e,t}}vo.prototype.bytesPerElement=4,xn("StructArrayLayout1ul4",vo);class xo extends ao{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e,i,r,n,o,s,a,l){const c=this.length;return this.resize(c+1),this.emplace(c,t,e,i,r,n,o,s,a,l)}emplace(t,e,i,r,n,o,s,a,l,c){const u=10*t,h=5*t;return this.int16[u+0]=e,this.int16[u+1]=i,this.int16[u+2]=r,this.int16[u+3]=n,this.int16[u+4]=o,this.int16[u+5]=s,this.uint32[h+3]=a,this.uint16[u+8]=l,this.uint16[u+9]=c,t}}xo.prototype.bytesPerElement=20,xn("StructArrayLayout6i1ul2ui20",xo);class bo extends ao{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,i,r,n,o){const s=this.length;return this.resize(s+1),this.emplace(s,t,e,i,r,n,o)}emplace(t,e,i,r,n,o,s){const a=6*t;return this.int16[a+0]=e,this.int16[a+1]=i,this.int16[a+2]=r,this.int16[a+3]=n,this.int16[a+4]=o,this.int16[a+5]=s,t}}bo.prototype.bytesPerElement=12,xn("StructArrayLayout2i2i2i12",bo);class wo extends ao{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,i,r,n){const o=this.length;return this.resize(o+1),this.emplace(o,t,e,i,r,n)}emplace(t,e,i,r,n,o){const s=4*t,a=8*t;return this.float32[s+0]=e,this.float32[s+1]=i,this.float32[s+2]=r,this.int16[a+6]=n,this.int16[a+7]=o,t}}wo.prototype.bytesPerElement=16,xn("StructArrayLayout2f1f2i16",wo);class To extends ao{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,i,r,n,o){const s=this.length;return this.resize(s+1),this.emplace(s,t,e,i,r,n,o)}emplace(t,e,i,r,n,o,s){const a=16*t,l=4*t,c=8*t;return this.uint8[a+0]=e,this.uint8[a+1]=i,this.float32[l+1]=r,this.float32[l+2]=n,this.int16[c+6]=o,this.int16[c+7]=s,t}}To.prototype.bytesPerElement=16,xn("StructArrayLayout2ub2f2i16",To);class Bo extends ao{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e,i){const r=this.length;return this.resize(r+1),this.emplace(r,t,e,i)}emplace(t,e,i,r){const n=3*t;return this.uint16[n+0]=e,this.uint16[n+1]=i,this.uint16[n+2]=r,t}}Bo.prototype.bytesPerElement=6,xn("StructArrayLayout3ui6",Bo);class Eo extends ao{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,i,r,n,o,s,a,l,c,u,h,d,p,f,A,m){const g=this.length;return this.resize(g+1),this.emplace(g,t,e,i,r,n,o,s,a,l,c,u,h,d,p,f,A,m)}emplace(t,e,i,r,n,o,s,a,l,c,u,h,d,p,f,A,m,g){const _=24*t,y=12*t,v=48*t;return this.int16[_+0]=e,this.int16[_+1]=i,this.uint16[_+2]=r,this.uint16[_+3]=n,this.uint32[y+2]=o,this.uint32[y+3]=s,this.uint32[y+4]=a,this.uint16[_+10]=l,this.uint16[_+11]=c,this.uint16[_+12]=u,this.float32[y+7]=h,this.float32[y+8]=d,this.uint8[v+36]=p,this.uint8[v+37]=f,this.uint8[v+38]=A,this.uint32[y+10]=m,this.int16[_+22]=g,t}}Eo.prototype.bytesPerElement=48,xn("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Eo);class Co extends ao{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,i,r,n,o,s,a,l,c,u,h,d,p,f,A,m,g,_,y,v,x,b,w,T,B,E,C){const S=this.length;return this.resize(S+1),this.emplace(S,t,e,i,r,n,o,s,a,l,c,u,h,d,p,f,A,m,g,_,y,v,x,b,w,T,B,E,C)}emplace(t,e,i,r,n,o,s,a,l,c,u,h,d,p,f,A,m,g,_,y,v,x,b,w,T,B,E,C,S){const I=32*t,M=16*t;return this.int16[I+0]=e,this.int16[I+1]=i,this.int16[I+2]=r,this.int16[I+3]=n,this.int16[I+4]=o,this.int16[I+5]=s,this.int16[I+6]=a,this.int16[I+7]=l,this.uint16[I+8]=c,this.uint16[I+9]=u,this.uint16[I+10]=h,this.uint16[I+11]=d,this.uint16[I+12]=p,this.uint16[I+13]=f,this.uint16[I+14]=A,this.uint16[I+15]=m,this.uint16[I+16]=g,this.uint16[I+17]=_,this.uint16[I+18]=y,this.uint16[I+19]=v,this.uint16[I+20]=x,this.uint16[I+21]=b,this.uint16[I+22]=w,this.uint32[M+12]=T,this.float32[M+13]=B,this.float32[M+14]=E,this.uint16[I+30]=C,this.uint16[I+31]=S,t}}Co.prototype.bytesPerElement=64,xn("StructArrayLayout8i15ui1ul2f2ui64",Co);class So extends ao{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const e=this.length;return this.resize(e+1),this.emplace(e,t)}emplace(t,e){return this.float32[1*t+0]=e,t}}So.prototype.bytesPerElement=4,xn("StructArrayLayout1f4",So);class Io extends ao{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,i){const r=this.length;return this.resize(r+1),this.emplace(r,t,e,i)}emplace(t,e,i,r){const n=3*t;return this.uint16[6*t+0]=e,this.float32[n+1]=i,this.float32[n+2]=r,t}}Io.prototype.bytesPerElement=12,xn("StructArrayLayout1ui2f12",Io);class Mo extends ao{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e,i){const r=this.length;return this.resize(r+1),this.emplace(r,t,e,i)}emplace(t,e,i,r){const n=4*t;return this.uint32[2*t+0]=e,this.uint16[n+2]=i,this.uint16[n+3]=r,t}}Mo.prototype.bytesPerElement=8,xn("StructArrayLayout1ul2ui8",Mo);class ko extends ao{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e){const i=this.length;return this.resize(i+1),this.emplace(i,t,e)}emplace(t,e,i){const r=2*t;return this.uint16[r+0]=e,this.uint16[r+1]=i,t}}ko.prototype.bytesPerElement=4,xn("StructArrayLayout2ui4",ko);class Po extends ao{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const e=this.length;return this.resize(e+1),this.emplace(e,t)}emplace(t,e){return this.uint16[1*t+0]=e,t}}Po.prototype.bytesPerElement=2,xn("StructArrayLayout1ui2",Po);class Lo extends ao{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,i,r){const n=this.length;return this.resize(n+1),this.emplace(n,t,e,i,r)}emplace(t,e,i,r,n){const o=4*t;return this.float32[o+0]=e,this.float32[o+1]=i,this.float32[o+2]=r,this.float32[o+3]=n,t}}Lo.prototype.bytesPerElement=16,xn("StructArrayLayout4f16",Lo);class zo extends so{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new o(this.anchorPointX,this.anchorPointY)}}zo.prototype.size=20;class Fo extends xo{get(t){return new zo(this,t)}}xn("CollisionBoxArray",Fo);class Do extends so{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(t){this._structArray.uint8[this._pos1+37]=t}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(t){this._structArray.uint8[this._pos1+38]=t}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(t){this._structArray.uint32[this._pos4+10]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}Do.prototype.size=48;class Ro extends Eo{get(t){return new Do(this,t)}}xn("PlacedSymbolArray",Ro);class Uo extends so{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(t){this._structArray.uint32[this._pos4+12]=t}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}Uo.prototype.size=64;class Oo extends Co{get(t){return new Uo(this,t)}}xn("SymbolInstanceArray",Oo);class No extends So{getoffsetX(t){return this.float32[1*t+0]}}xn("GlyphOffsetArray",No);class Qo extends ho{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}xn("SymbolLineVertexArray",Qo);class Vo extends so{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}Vo.prototype.size=12;class jo extends Io{get(t){return new Vo(this,t)}}xn("TextAnchorOffsetArray",jo);class Ho extends so{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}Ho.prototype.size=8;class Go extends Mo{get(t){return new Ho(this,t)}}xn("FeatureIndexArray",Go);class $o extends uo{}class Zo extends uo{}class qo extends uo{}class Ko extends fo{}class Wo extends Ao{}class Xo extends mo{}class Jo extends go{}class Yo extends _o{}class ts extends yo{}class es extends vo{}class is extends bo{}class rs extends To{}class ns extends Bo{}class os extends ko{}const ss=lo([{name:"a_pos",components:2,type:"Int16"}],4),{members:as}=ss;class ls{constructor(t=[]){this.segments=t}prepareSegment(t,e,i,r){let n=this.segments[this.segments.length-1];return t>ls.MAX_VERTEX_ARRAY_LENGTH&&w(`Max vertices per segment is ${ls.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!n||n.vertexLength+t>ls.MAX_VERTEX_ARRAY_LENGTH||n.sortKey!==r)&&(n={vertexOffset:e.length,primitiveOffset:i.length,vertexLength:0,primitiveLength:0},void 0!==r&&(n.sortKey=r),this.segments.push(n)),n}get(){return this.segments}destroy(){for(const t of this.segments)for(const e in t.vaos)t.vaos[e].destroy()}static simpleSegment(t,e,i,r){return new ls([{vertexOffset:t,primitiveOffset:e,vertexLength:i,primitiveLength:r,vaos:{},sortKey:0}])}}function cs(t,e){return 256*(t=A(Math.floor(t),0,255))+A(Math.floor(e),0,255)}ls.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,xn("SegmentVector",ls);const us=lo([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var hs={exports:{}},ds={exports:{}};ds.exports=function(t,e){var i,r,n,o,s,a,l,c;for(r=t.length-(i=3&t.length),n=e,s=3432918353,a=461845907,c=0;c<r;)l=255&t.charCodeAt(c)|(255&t.charCodeAt(++c))<<8|(255&t.charCodeAt(++c))<<16|(255&t.charCodeAt(++c))<<24,++c,n=27492+(65535&(o=5*(65535&(n=(n^=l=(65535&(l=(l=(65535&l)*s+(((l>>>16)*s&65535)<<16)&4294967295)<<15|l>>>17))*a+(((l>>>16)*a&65535)<<16)&4294967295)<<13|n>>>19))+((5*(n>>>16)&65535)<<16)&4294967295))+((58964+(o>>>16)&65535)<<16);switch(l=0,i){case 3:l^=(255&t.charCodeAt(c+2))<<16;case 2:l^=(255&t.charCodeAt(c+1))<<8;case 1:n^=l=(65535&(l=(l=(65535&(l^=255&t.charCodeAt(c)))*s+(((l>>>16)*s&65535)<<16)&4294967295)<<15|l>>>17))*a+(((l>>>16)*a&65535)<<16)&4294967295}return n^=t.length,n=2246822507*(65535&(n^=n>>>16))+((2246822507*(n>>>16)&65535)<<16)&4294967295,n=3266489909*(65535&(n^=n>>>13))+((3266489909*(n>>>16)&65535)<<16)&4294967295,(n^=n>>>16)>>>0};var ps=ds.exports,fs={exports:{}};fs.exports=function(t,e){for(var i,r=t.length,n=e^r,o=0;r>=4;)i=1540483477*(65535&(i=255&t.charCodeAt(o)|(255&t.charCodeAt(++o))<<8|(255&t.charCodeAt(++o))<<16|(255&t.charCodeAt(++o))<<24))+((1540483477*(i>>>16)&65535)<<16),n=1540483477*(65535&n)+((1540483477*(n>>>16)&65535)<<16)^(i=1540483477*(65535&(i^=i>>>24))+((1540483477*(i>>>16)&65535)<<16)),r-=4,++o;switch(r){case 3:n^=(255&t.charCodeAt(o+2))<<16;case 2:n^=(255&t.charCodeAt(o+1))<<8;case 1:n=1540483477*(65535&(n^=255&t.charCodeAt(o)))+((1540483477*(n>>>16)&65535)<<16)}return n=1540483477*(65535&(n^=n>>>13))+((1540483477*(n>>>16)&65535)<<16),(n^=n>>>15)>>>0};var As=ps,ms=fs.exports;hs.exports=As,hs.exports.murmur3=As,hs.exports.murmur2=ms;var gs=i(hs.exports);class _s{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,e,i,r){this.ids.push(ys(t)),this.positions.push(e,i,r)}getPositions(t){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const e=ys(t);let i=0,r=this.ids.length-1;for(;i<r;){const t=i+r>>1;this.ids[t]>=e?r=t:i=t+1}const n=[];for(;this.ids[i]===e;)n.push({index:this.positions[3*i],start:this.positions[3*i+1],end:this.positions[3*i+2]}),i++;return n}static serialize(t,e){const i=new Float64Array(t.ids),r=new Uint32Array(t.positions);return vs(i,r,0,i.length-1),e&&e.push(i.buffer,r.buffer),{ids:i,positions:r}}static deserialize(t){const e=new _s;return e.ids=t.ids,e.positions=t.positions,e.indexed=!0,e}}function ys(t){const e=+t;return!isNaN(e)&&e<=Number.MAX_SAFE_INTEGER?e:gs(String(t))}function vs(t,e,i,r){for(;i<r;){const n=t[i+r>>1];let o=i-1,s=r+1;for(;;){do{o++}while(t[o]<n);do{s--}while(t[s]>n);if(o>=s)break;xs(t,o,s),xs(e,3*o,3*s),xs(e,3*o+1,3*s+1),xs(e,3*o+2,3*s+2)}s-i<r-s?(vs(t,e,i,s),i=s+1):(vs(t,e,s+1,r),r=s)}}function xs(t,e,i){const r=t[e];t[e]=t[i],t[i]=r}xn("FeaturePositionMap",_s);class bs{constructor(t,e){this.gl=t.gl,this.location=e}}class ws extends bs{constructor(t,e){super(t,e),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))}}class Ts extends bs{constructor(t,e){super(t,e),this.current=[0,0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))}}class Bs extends bs{constructor(t,e){super(t,e),this.current=Zt.transparent}set(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))}}const Es=new Float32Array(16);function Cs(t){return[cs(255*t.r,255*t.g),cs(255*t.b,255*t.a)]}class Ss{constructor(t,e,i){this.value=t,this.uniformNames=e.map((t=>`u_${t}`)),this.type=i}setUniform(t,e,i){t.set(i.constantOr(this.value))}getBinding(t,e,i){return"color"===this.type?new Bs(t,e):new ws(t,e)}}class Is{constructor(t,e){this.uniformNames=e.map((t=>`u_${t}`)),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,e){this.pixelRatioFrom=e.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=e.tlbr,this.patternTo=t.tlbr}setUniform(t,e,i,r){const n="u_pattern_to"===r?this.patternTo:"u_pattern_from"===r?this.patternFrom:"u_pixel_ratio_to"===r?this.pixelRatioTo:"u_pixel_ratio_from"===r?this.pixelRatioFrom:null;n&&t.set(n)}getBinding(t,e,i){return"u_pattern"===i.substr(0,9)?new Ts(t,e):new ws(t,e)}}class Ms{constructor(t,e,i,r){this.expression=t,this.type=i,this.maxValue=0,this.paintVertexAttributes=e.map((t=>({name:`a_${t}`,type:"Float32",components:"color"===i?2:1,offset:0}))),this.paintVertexArray=new r}populatePaintArray(t,e,i,r,n){const o=this.paintVertexArray.length,s=this.expression.evaluate(new Vn(0),e,{},r,[],n);this.paintVertexArray.resize(t),this._setPaintValue(o,t,s)}updatePaintArray(t,e,i,r){const n=this.expression.evaluate({zoom:0},i,r);this._setPaintValue(t,e,n)}_setPaintValue(t,e,i){if("color"===this.type){const r=Cs(i);for(let i=t;i<e;i++)this.paintVertexArray.emplace(i,r[0],r[1])}else{for(let r=t;r<e;r++)this.paintVertexArray.emplace(r,i);this.maxValue=Math.max(this.maxValue,Math.abs(i))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ks{constructor(t,e,i,r,n,o){this.expression=t,this.uniformNames=e.map((t=>`u_${t}_t`)),this.type=i,this.useIntegerZoom=r,this.zoom=n,this.maxValue=0,this.paintVertexAttributes=e.map((t=>({name:`a_${t}`,type:"Float32",components:"color"===i?4:2,offset:0}))),this.paintVertexArray=new o}populatePaintArray(t,e,i,r,n){const o=this.expression.evaluate(new Vn(this.zoom),e,{},r,[],n),s=this.expression.evaluate(new Vn(this.zoom+1),e,{},r,[],n),a=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(a,t,o,s)}updatePaintArray(t,e,i,r){const n=this.expression.evaluate({zoom:this.zoom},i,r),o=this.expression.evaluate({zoom:this.zoom+1},i,r);this._setPaintValue(t,e,n,o)}_setPaintValue(t,e,i,r){if("color"===this.type){const n=Cs(i),o=Cs(r);for(let i=t;i<e;i++)this.paintVertexArray.emplace(i,n[0],n[1],o[0],o[1])}else{for(let n=t;n<e;n++)this.paintVertexArray.emplace(n,i,r);this.maxValue=Math.max(this.maxValue,Math.abs(i),Math.abs(r))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,e){const i=this.useIntegerZoom?Math.floor(e.zoom):e.zoom,r=A(this.expression.interpolationFactor(i,this.zoom,this.zoom+1),0,1);t.set(r)}getBinding(t,e,i){return new ws(t,e)}}class Ps{constructor(t,e,i,r,n,o){this.expression=t,this.type=e,this.useIntegerZoom=i,this.zoom=r,this.layerId=o,this.zoomInPaintVertexArray=new n,this.zoomOutPaintVertexArray=new n}populatePaintArray(t,e,i){const r=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(r,t,e.patterns&&e.patterns[this.layerId],i)}updatePaintArray(t,e,i,r,n){this._setPaintValues(t,e,i.patterns&&i.patterns[this.layerId],n)}_setPaintValues(t,e,i,r){if(!r||!i)return;const{min:n,mid:o,max:s}=i,a=r[n],l=r[o],c=r[s];if(a&&l&&c)for(let i=t;i<e;i++)this.zoomInPaintVertexArray.emplace(i,l.tl[0],l.tl[1],l.br[0],l.br[1],a.tl[0],a.tl[1],a.br[0],a.br[1],l.pixelRatio,a.pixelRatio),this.zoomOutPaintVertexArray.emplace(i,l.tl[0],l.tl[1],l.br[0],l.br[1],c.tl[0],c.tl[1],c.br[0],c.br[1],l.pixelRatio,c.pixelRatio)}upload(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,us.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,us.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Ls{constructor(t,e,i){this.binders={},this._buffers=[];const r=[];for(const n in t.paint._values){if(!i(n))continue;const o=t.paint.get(n);if(!(o instanceof Kn&&or(o.property.specification)))continue;const s=Fs(n,t.type),a=o.value,l=o.property.specification.type,c=o.property.useIntegerZoom,u=o.property.specification["property-type"],h="cross-faded"===u||"cross-faded-data-driven"===u;if("constant"===a.kind)this.binders[n]=h?new Is(a.value,s):new Ss(a.value,s,l),r.push(`/u_${n}`);else if("source"===a.kind||h){const i=Ds(n,l,"source");this.binders[n]=h?new Ps(a,l,c,e,i,t.id):new Ms(a,s,l,i),r.push(`/a_${n}`)}else{const t=Ds(n,l,"composite");this.binders[n]=new ks(a,s,l,c,e,t),r.push(`/z_${n}`)}}this.cacheKey=r.sort().join("")}getMaxValue(t){const e=this.binders[t];return e instanceof Ms||e instanceof ks?e.maxValue:0}populatePaintArrays(t,e,i,r,n){for(const o in this.binders){const s=this.binders[o];(s instanceof Ms||s instanceof ks||s instanceof Ps)&&s.populatePaintArray(t,e,i,r,n)}}setConstantPatternPositions(t,e){for(const i in this.binders){const r=this.binders[i];r instanceof Is&&r.setConstantPatternPositions(t,e)}}updatePaintArrays(t,e,i,r,n){let o=!1;for(const s in t){const a=e.getPositions(s);for(const e of a){const a=i.feature(e.index);for(const i in this.binders){const l=this.binders[i];if((l instanceof Ms||l instanceof ks||l instanceof Ps)&&!0===l.expression.isStateDependent){const c=r.paint.get(i);l.expression=c.value,l.updatePaintArray(e.start,e.end,a,t[s],n),o=!0}}}}return o}defines(){const t=[];for(const e in this.binders){const i=this.binders[e];(i instanceof Ss||i instanceof Is)&&t.push(...i.uniformNames.map((t=>`#define HAS_UNIFORM_${t}`)))}return t}getBinderAttributes(){const t=[];for(const e in this.binders){const i=this.binders[e];if(i instanceof Ms||i instanceof ks)for(let e=0;e<i.paintVertexAttributes.length;e++)t.push(i.paintVertexAttributes[e].name);else if(i instanceof Ps)for(let e=0;e<us.members.length;e++)t.push(us.members[e].name)}return t}getBinderUniforms(){const t=[];for(const e in this.binders){const i=this.binders[e];if(i instanceof Ss||i instanceof Is||i instanceof ks)for(const e of i.uniformNames)t.push(e)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t,e){const i=[];for(const r in this.binders){const n=this.binders[r];if(n instanceof Ss||n instanceof Is||n instanceof ks)for(const o of n.uniformNames)if(e[o]){const s=n.getBinding(t,e[o],o);i.push({name:o,property:r,binding:s})}}return i}setUniforms(t,e,i,r){for(const{name:t,property:n,binding:o}of e)this.binders[n].setUniform(o,r,i.get(n),t)}updatePaintBuffers(t){this._buffers=[];for(const e in this.binders){const i=this.binders[e];if(t&&i instanceof Ps){const e=2===t.fromScale?i.zoomInPaintVertexBuffer:i.zoomOutPaintVertexBuffer;e&&this._buffers.push(e)}else(i instanceof Ms||i instanceof ks)&&i.paintVertexBuffer&&this._buffers.push(i.paintVertexBuffer)}}upload(t){for(const e in this.binders){const i=this.binders[e];(i instanceof Ms||i instanceof ks||i instanceof Ps)&&i.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const e=this.binders[t];(e instanceof Ms||e instanceof ks||e instanceof Ps)&&e.destroy()}}}class zs{constructor(t,e,i=(()=>!0)){this.programConfigurations={};for(const r of t)this.programConfigurations[r.id]=new Ls(r,e,i);this.needsUpload=!1,this._featureMap=new _s,this._bufferOffset=0}populatePaintArrays(t,e,i,r,n,o){for(const i in this.programConfigurations)this.programConfigurations[i].populatePaintArrays(t,e,r,n,o);void 0!==e.id&&this._featureMap.add(e.id,i,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,e,i,r){for(const n of i)this.needsUpload=this.programConfigurations[n.id].updatePaintArrays(t,this._featureMap,e,n,r)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const e in this.programConfigurations)this.programConfigurations[e].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}function Fs(t,e){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[t]||[t.replace(`${e}-`,"").replace(/-/g,"_")]}function Ds(t,e,i){const r={color:{source:mo,composite:Lo},number:{source:So,composite:mo}},n=function(t){return{"line-pattern":{source:Jo,composite:Jo},"fill-pattern":{source:Jo,composite:Jo},"fill-extrusion-pattern":{source:Jo,composite:Jo}}[t]}(t);return n&&n[i]||r[e][i]}xn("ConstantBinder",Ss),xn("CrossFadedConstantBinder",Is),xn("SourceExpressionBinder",Ms),xn("CrossFadedCompositeBinder",Ps),xn("CompositeExpressionBinder",ks),xn("ProgramConfiguration",Ls,{omit:["_buffers"]}),xn("ProgramConfigurationSet",zs);const Rs=8192,Us=Math.pow(2,14)-1,Os=-Us-1;function Ns(t){const e=Rs/t.extent,i=t.loadGeometry();for(let t=0;t<i.length;t++){const r=i[t];for(let t=0;t<r.length;t++){const i=r[t],n=Math.round(i.x*e),o=Math.round(i.y*e);i.x=A(n,Os,Us),i.y=A(o,Os,Us),(n<i.x||n>i.x+1||o<i.y||o>i.y+1)&&w("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return i}function Qs(t,e){return{type:t.type,id:t.id,properties:t.properties,geometry:e?Ns(t):[]}}function Vs(t,e,i,r,n){t.emplaceBack(2*e+(r+1)/2,2*i+(n+1)/2)}class js{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((t=>t.id)),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Zo,this.indexArray=new ns,this.segments=new ls,this.programConfigurations=new zs(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter((t=>t.isStateDependent())).map((t=>t.id))}populate(t,e,i){const r=this.layers[0],n=[];let o=null,s=!1;"circle"===r.type&&(o=r.layout.get("circle-sort-key"),s=!o.isConstant());for(const{feature:e,id:r,index:a,sourceLayerIndex:l}of t){const t=this.layers[0]._featureFilter.needGeometry,c=Qs(e,t);if(!this.layers[0]._featureFilter.filter(new Vn(this.zoom),c,i))continue;const u=s?o.evaluate(c,{},i):void 0,h={id:r,properties:e.properties,type:e.type,sourceLayerIndex:l,index:a,geometry:t?c.geometry:Ns(e),patterns:{},sortKey:u};n.push(h)}s&&n.sort(((t,e)=>t.sortKey-e.sortKey));for(const r of n){const{geometry:n,index:o,sourceLayerIndex:s}=r,a=t[o].feature;this.addFeature(r,n,o,i),e.featureIndex.insert(a,n,o,s,this.index)}}update(t,e,i){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,i)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,as),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,e,i,r){for(const i of e)for(const e of i){const i=e.x,r=e.y;if(i<0||i>=Rs||r<0||r>=Rs)continue;const n=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),o=n.vertexLength;Vs(this.layoutVertexArray,i,r,-1,-1),Vs(this.layoutVertexArray,i,r,1,-1),Vs(this.layoutVertexArray,i,r,1,1),Vs(this.layoutVertexArray,i,r,-1,1),this.indexArray.emplaceBack(o,o+1,o+2),this.indexArray.emplaceBack(o,o+3,o+2),n.vertexLength+=4,n.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,i,{},r)}}function Hs(t,e){for(let i=0;i<t.length;i++)if(Ys(e,t[i]))return!0;for(let i=0;i<e.length;i++)if(Ys(t,e[i]))return!0;return!!qs(t,e)}function Gs(t,e,i){return!!Ys(t,e)||!!Ws(e,t,i)}function $s(t,e){if(1===t.length)return Js(e,t[0]);for(let i=0;i<e.length;i++){const r=e[i];for(let e=0;e<r.length;e++)if(Ys(t,r[e]))return!0}for(let i=0;i<t.length;i++)if(Js(e,t[i]))return!0;for(let i=0;i<e.length;i++)if(qs(t,e[i]))return!0;return!1}function Zs(t,e,i){if(t.length>1){if(qs(t,e))return!0;for(let r=0;r<e.length;r++)if(Ws(e[r],t,i))return!0}for(let r=0;r<t.length;r++)if(Ws(t[r],e,i))return!0;return!1}function qs(t,e){if(0===t.length||0===e.length)return!1;for(let i=0;i<t.length-1;i++){const r=t[i],n=t[i+1];for(let t=0;t<e.length-1;t++)if(Ks(r,n,e[t],e[t+1]))return!0}return!1}function Ks(t,e,i,r){return T(t,i,r)!==T(e,i,r)&&T(t,e,i)!==T(t,e,r)}function Ws(t,e,i){const r=i*i;if(1===e.length)return t.distSqr(e[0])<r;for(let i=1;i<e.length;i++)if(Xs(t,e[i-1],e[i])<r)return!0;return!1}function Xs(t,e,i){const r=e.distSqr(i);if(0===r)return t.distSqr(e);const n=((t.x-e.x)*(i.x-e.x)+(t.y-e.y)*(i.y-e.y))/r;return t.distSqr(n<0?e:n>1?i:i.sub(e)._mult(n)._add(e))}function Js(t,e){let i,r,n,o=!1;for(let s=0;s<t.length;s++){i=t[s];for(let t=0,s=i.length-1;t<i.length;s=t++)r=i[t],n=i[s],r.y>e.y!=n.y>e.y&&e.x<(n.x-r.x)*(e.y-r.y)/(n.y-r.y)+r.x&&(o=!o)}return o}function Ys(t,e){let i=!1;for(let r=0,n=t.length-1;r<t.length;n=r++){const o=t[r],s=t[n];o.y>e.y!=s.y>e.y&&e.x<(s.x-o.x)*(e.y-o.y)/(s.y-o.y)+o.x&&(i=!i)}return i}function ta(t,e,i){const r=i[0],n=i[2];if(t.x<r.x&&e.x<r.x||t.x>n.x&&e.x>n.x||t.y<r.y&&e.y<r.y||t.y>n.y&&e.y>n.y)return!1;const o=T(t,e,i[0]);return o!==T(t,e,i[1])||o!==T(t,e,i[2])||o!==T(t,e,i[3])}function ea(t,e,i){const r=e.paint.get(t).value;return"constant"===r.kind?r.value:i.programConfigurations.get(e.id).getMaxValue(t)}function ia(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function ra(t,e,i,r,n){if(!e[0]&&!e[1])return t;const s=o.convert(e)._mult(n);"viewport"===i&&s._rotate(-r);const a=[];for(let e=0;e<t.length;e++)a.push(t[e].sub(s));return a}let na,oa;xn("CircleBucket",js,{omit:["layers"]});var sa={get paint(){return oa=oa||new io({"circle-radius":new Jn($.paint_circle["circle-radius"]),"circle-color":new Jn($.paint_circle["circle-color"]),"circle-blur":new Jn($.paint_circle["circle-blur"]),"circle-opacity":new Jn($.paint_circle["circle-opacity"]),"circle-translate":new Xn($.paint_circle["circle-translate"]),"circle-translate-anchor":new Xn($.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Xn($.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Xn($.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Jn($.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Jn($.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Jn($.paint_circle["circle-stroke-opacity"])})},get layout(){return na=na||new io({"circle-sort-key":new Jn($.layout_circle["circle-sort-key"])})}},aa=1e-6,la="undefined"!=typeof Float32Array?Float32Array:Array;function ca(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function ua(t,e,i){var r=e[0],n=e[1],o=e[2],s=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=e[8],d=e[9],p=e[10],f=e[11],A=e[12],m=e[13],g=e[14],_=e[15],y=i[0],v=i[1],x=i[2],b=i[3];return t[0]=y*r+v*a+x*h+b*A,t[1]=y*n+v*l+x*d+b*m,t[2]=y*o+v*c+x*p+b*g,t[3]=y*s+v*u+x*f+b*_,t[4]=(y=i[4])*r+(v=i[5])*a+(x=i[6])*h+(b=i[7])*A,t[5]=y*n+v*l+x*d+b*m,t[6]=y*o+v*c+x*p+b*g,t[7]=y*s+v*u+x*f+b*_,t[8]=(y=i[8])*r+(v=i[9])*a+(x=i[10])*h+(b=i[11])*A,t[9]=y*n+v*l+x*d+b*m,t[10]=y*o+v*c+x*p+b*g,t[11]=y*s+v*u+x*f+b*_,t[12]=(y=i[12])*r+(v=i[13])*a+(x=i[14])*h+(b=i[15])*A,t[13]=y*n+v*l+x*d+b*m,t[14]=y*o+v*c+x*p+b*g,t[15]=y*s+v*u+x*f+b*_,t}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var ha,da=ua;function pa(t,e,i){var r=e[0],n=e[1],o=e[2],s=e[3];return t[0]=i[0]*r+i[4]*n+i[8]*o+i[12]*s,t[1]=i[1]*r+i[5]*n+i[9]*o+i[13]*s,t[2]=i[2]*r+i[6]*n+i[10]*o+i[14]*s,t[3]=i[3]*r+i[7]*n+i[11]*o+i[15]*s,t}ha=new la(4),la!=Float32Array&&(ha[0]=0,ha[1]=0,ha[2]=0,ha[3]=0);class fa extends no{constructor(t){super(t,sa)}createBucket(t){return new js(t)}queryRadius(t){const e=t;return ea("circle-radius",this,e)+ea("circle-stroke-width",this,e)+ia(this.paint.get("circle-translate"))}queryIntersectsFeature(t,e,i,r,n,o,s,a){const l=ra(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),o.angle,s),c=this.paint.get("circle-radius").evaluate(e,i)+this.paint.get("circle-stroke-width").evaluate(e,i),u="map"===this.paint.get("circle-pitch-alignment"),h=u?l:function(t,e){return t.map((t=>Aa(t,e)))}(l,a),d=u?c*s:c;for(const t of r)for(const e of t){const t=u?e:Aa(e,a);let i=d;const r=pa([],[e.x,e.y,0,1],a);if("viewport"===this.paint.get("circle-pitch-scale")&&"map"===this.paint.get("circle-pitch-alignment")?i*=r[3]/o.cameraToCenterDistance:"map"===this.paint.get("circle-pitch-scale")&&"viewport"===this.paint.get("circle-pitch-alignment")&&(i*=o.cameraToCenterDistance/r[3]),Gs(h,t,i))return!0}return!1}}function Aa(t,e){const i=pa([],[t.x,t.y,0,1],e);return new o(i[0]/i[3],i[1]/i[3])}class ma extends js{}let ga;xn("HeatmapBucket",ma,{omit:["layers"]});var _a={get paint(){return ga=ga||new io({"heatmap-radius":new Jn($.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Jn($.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Xn($.paint_heatmap["heatmap-intensity"]),"heatmap-color":new eo($.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Xn($.paint_heatmap["heatmap-opacity"])})}};function ya(t,{width:e,height:i},r,n){if(n){if(n instanceof Uint8ClampedArray)n=new Uint8Array(n.buffer);else if(n.length!==e*i*r)throw new RangeError(`mismatched image size. expected: ${n.length} but got: ${e*i*r}`)}else n=new Uint8Array(e*i*r);return t.width=e,t.height=i,t.data=n,t}function va(t,{width:e,height:i},r){if(e===t.width&&i===t.height)return;const n=ya({},{width:e,height:i},r);xa(t,n,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,e),height:Math.min(t.height,i)},r),t.width=e,t.height=i,t.data=n.data}function xa(t,e,i,r,n,o){if(0===n.width||0===n.height)return e;if(n.width>t.width||n.height>t.height||i.x>t.width-n.width||i.y>t.height-n.height)throw new RangeError("out of range source coordinates for image copy");if(n.width>e.width||n.height>e.height||r.x>e.width-n.width||r.y>e.height-n.height)throw new RangeError("out of range destination coordinates for image copy");const s=t.data,a=e.data;if(s===a)throw new Error("srcData equals dstData, so image is already copied");for(let l=0;l<n.height;l++){const c=((i.y+l)*t.width+i.x)*o,u=((r.y+l)*e.width+r.x)*o;for(let t=0;t<n.width*o;t++)a[u+t]=s[c+t]}return e}class ba{constructor(t,e){ya(this,t,1,e)}resize(t){va(this,t,1)}clone(){return new ba({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,e,i,r,n){xa(t,e,i,r,n,1)}}class wa{constructor(t,e){ya(this,t,4,e)}resize(t){va(this,t,4)}replace(t,e){e?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new wa({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,e,i,r,n){xa(t,e,i,r,n,4)}}function Ta(t){const e={},i=t.resolution||256,r=t.clips?t.clips.length:1,n=t.image||new wa({width:i,height:r});if(Math.log(i)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${i}`);const o=(i,r,o)=>{e[t.evaluationKey]=o;const s=t.expression.evaluate(e);n.data[i+r+0]=Math.floor(255*s.r/s.a),n.data[i+r+1]=Math.floor(255*s.g/s.a),n.data[i+r+2]=Math.floor(255*s.b/s.a),n.data[i+r+3]=Math.floor(255*s.a)};if(t.clips)for(let e=0,n=0;e<r;++e,n+=4*i)for(let r=0,s=0;r<i;r++,s+=4){const a=r/(i-1),{start:l,end:c}=t.clips[e];o(n,s,l*(1-a)+c*a)}else for(let t=0,e=0;t<i;t++,e+=4)o(0,e,t/(i-1));return n}xn("AlphaImage",ba),xn("RGBAImage",wa);const Ba="big-fb";class Ea extends no{createBucket(t){return new ma(t)}constructor(t){super(t,_a),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){"heatmap-color"===t&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Ta({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(Ba)&&this.heatmapFbos.delete(Ba)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}}let Ca;var Sa={get paint(){return Ca=Ca||new io({"hillshade-illumination-direction":new Xn($.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Xn($.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Xn($.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Xn($.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Xn($.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Xn($.paint_hillshade["hillshade-accent-color"])})}};class Ia extends no{constructor(t){super(t,Sa)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}}const Ma=lo([{name:"a_pos",components:2,type:"Int16"}],4),{members:ka}=Ma;function Pa(t,e,i=2){const r=e&&e.length,n=r?e[0]*i:t.length;let o=La(t,0,n,i,!0);const s=[];if(!o||o.next===o.prev)return s;let a,l,c;if(r&&(o=function(t,e,i,r){const n=[];for(let i=0,o=e.length;i<o;i++){const s=La(t,e[i]*r,i<o-1?e[i+1]*r:t.length,r,!1);s===s.next&&(s.steiner=!0),n.push(Ha(s))}n.sort(Na);for(let t=0;t<n.length;t++)i=Qa(n[t],i);return i}(t,e,o,i)),t.length>80*i){a=1/0,l=1/0;let e=-1/0,r=-1/0;for(let o=i;o<n;o+=i){const i=t[o],n=t[o+1];i<a&&(a=i),n<l&&(l=n),i>e&&(e=i),n>r&&(r=n)}c=Math.max(e-a,r-l),c=0!==c?32767/c:0}return Fa(o,s,i,a,l,c,0),s}function La(t,e,i,r,n){let o;if(n===function(t,e,i,r){let n=0;for(let o=e,s=i-r;o<i;o+=r)n+=(t[s]-t[o])*(t[o+1]+t[s+1]),s=o;return n}(t,e,i,r)>0)for(let n=e;n<i;n+=r)o=tl(n/r|0,t[n],t[n+1],o);else for(let n=i-r;n>=e;n-=r)o=tl(n/r|0,t[n],t[n+1],o);return o&&qa(o,o.next)&&(el(o),o=o.next),o}function za(t,e){if(!t)return t;e||(e=t);let i,r=t;do{if(i=!1,r.steiner||!qa(r,r.next)&&0!==Za(r.prev,r,r.next))r=r.next;else{if(el(r),r=e=r.prev,r===r.next)break;i=!0}}while(i||r!==e);return e}function Fa(t,e,i,r,n,o,s){if(!t)return;!s&&o&&function(t,e,i,r){let n=t;do{0===n.z&&(n.z=ja(n.x,n.y,e,i,r)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next}while(n!==t);n.prevZ.nextZ=null,n.prevZ=null,function(t){let e,i=1;do{let r,n=t;t=null;let o=null;for(e=0;n;){e++;let s=n,a=0;for(let t=0;t<i&&(a++,s=s.nextZ,s);t++);let l=i;for(;a>0||l>0&&s;)0!==a&&(0===l||!s||n.z<=s.z)?(r=n,n=n.nextZ,a--):(r=s,s=s.nextZ,l--),o?o.nextZ=r:t=r,r.prevZ=o,o=r;n=s}o.nextZ=null,i*=2}while(e>1)}(n)}(t,r,n,o);let a=t;for(;t.prev!==t.next;){const l=t.prev,c=t.next;if(o?Ra(t,r,n,o):Da(t))e.push(l.i,t.i,c.i),el(t),t=c.next,a=c.next;else if((t=c)===a){s?1===s?Fa(t=Ua(za(t),e),e,i,r,n,o,2):2===s&&Oa(t,e,i,r,n,o):Fa(za(t),e,i,r,n,o,1);break}}}function Da(t){const e=t.prev,i=t,r=t.next;if(Za(e,i,r)>=0)return!1;const n=e.x,o=i.x,s=r.x,a=e.y,l=i.y,c=r.y,u=n<o?n<s?n:s:o<s?o:s,h=a<l?a<c?a:c:l<c?l:c,d=n>o?n>s?n:s:o>s?o:s,p=a>l?a>c?a:c:l>c?l:c;let f=r.next;for(;f!==e;){if(f.x>=u&&f.x<=d&&f.y>=h&&f.y<=p&&Ga(n,a,o,l,s,c,f.x,f.y)&&Za(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}function Ra(t,e,i,r){const n=t.prev,o=t,s=t.next;if(Za(n,o,s)>=0)return!1;const a=n.x,l=o.x,c=s.x,u=n.y,h=o.y,d=s.y,p=a<l?a<c?a:c:l<c?l:c,f=u<h?u<d?u:d:h<d?h:d,A=a>l?a>c?a:c:l>c?l:c,m=u>h?u>d?u:d:h>d?h:d,g=ja(p,f,e,i,r),_=ja(A,m,e,i,r);let y=t.prevZ,v=t.nextZ;for(;y&&y.z>=g&&v&&v.z<=_;){if(y.x>=p&&y.x<=A&&y.y>=f&&y.y<=m&&y!==n&&y!==s&&Ga(a,u,l,h,c,d,y.x,y.y)&&Za(y.prev,y,y.next)>=0)return!1;if(y=y.prevZ,v.x>=p&&v.x<=A&&v.y>=f&&v.y<=m&&v!==n&&v!==s&&Ga(a,u,l,h,c,d,v.x,v.y)&&Za(v.prev,v,v.next)>=0)return!1;v=v.nextZ}for(;y&&y.z>=g;){if(y.x>=p&&y.x<=A&&y.y>=f&&y.y<=m&&y!==n&&y!==s&&Ga(a,u,l,h,c,d,y.x,y.y)&&Za(y.prev,y,y.next)>=0)return!1;y=y.prevZ}for(;v&&v.z<=_;){if(v.x>=p&&v.x<=A&&v.y>=f&&v.y<=m&&v!==n&&v!==s&&Ga(a,u,l,h,c,d,v.x,v.y)&&Za(v.prev,v,v.next)>=0)return!1;v=v.nextZ}return!0}function Ua(t,e){let i=t;do{const r=i.prev,n=i.next.next;!qa(r,n)&&Ka(r,i,i.next,n)&&Ja(r,n)&&Ja(n,r)&&(e.push(r.i,i.i,n.i),el(i),el(i.next),i=t=n),i=i.next}while(i!==t);return za(i)}function Oa(t,e,i,r,n,o){let s=t;do{let t=s.next.next;for(;t!==s.prev;){if(s.i!==t.i&&$a(s,t)){let a=Ya(s,t);return s=za(s,s.next),a=za(a,a.next),Fa(s,e,i,r,n,o,0),void Fa(a,e,i,r,n,o,0)}t=t.next}s=s.next}while(s!==t)}function Na(t,e){return t.x-e.x}function Qa(t,e){const i=function(t,e){let i=e;const r=t.x,n=t.y;let o,s=-1/0;do{if(n<=i.y&&n>=i.next.y&&i.next.y!==i.y){const t=i.x+(n-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(t<=r&&t>s&&(s=t,o=i.x<i.next.x?i:i.next,t===r))return o}i=i.next}while(i!==e);if(!o)return null;const a=o,l=o.x,c=o.y;let u=1/0;i=o;do{if(r>=i.x&&i.x>=l&&r!==i.x&&Ga(n<c?r:s,n,l,c,n<c?s:r,n,i.x,i.y)){const e=Math.abs(n-i.y)/(r-i.x);Ja(i,t)&&(e<u||e===u&&(i.x>o.x||i.x===o.x&&Va(o,i)))&&(o=i,u=e)}i=i.next}while(i!==a);return o}(t,e);if(!i)return e;const r=Ya(i,t);return za(r,r.next),za(i,i.next)}function Va(t,e){return Za(t.prev,t,e.prev)<0&&Za(e.next,t,t.next)<0}function ja(t,e,i,r,n){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-i)*n|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-r)*n|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Ha(t){let e=t,i=t;do{(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next}while(e!==t);return i}function Ga(t,e,i,r,n,o,s,a){return(n-s)*(e-a)>=(t-s)*(o-a)&&(t-s)*(r-a)>=(i-s)*(e-a)&&(i-s)*(o-a)>=(n-s)*(r-a)}function $a(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){let i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&Ka(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1}(t,e)&&(Ja(t,e)&&Ja(e,t)&&function(t,e){let i=t,r=!1;const n=(t.x+e.x)/2,o=(t.y+e.y)/2;do{i.y>o!=i.next.y>o&&i.next.y!==i.y&&n<(i.next.x-i.x)*(o-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next}while(i!==t);return r}(t,e)&&(Za(t.prev,t,e.prev)||Za(t,e.prev,e))||qa(t,e)&&Za(t.prev,t,t.next)>0&&Za(e.prev,e,e.next)>0)}function Za(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function qa(t,e){return t.x===e.x&&t.y===e.y}function Ka(t,e,i,r){const n=Xa(Za(t,e,i)),o=Xa(Za(t,e,r)),s=Xa(Za(i,r,t)),a=Xa(Za(i,r,e));return n!==o&&s!==a||!(0!==n||!Wa(t,i,e))||!(0!==o||!Wa(t,r,e))||!(0!==s||!Wa(i,t,r))||!(0!==a||!Wa(i,e,r))}function Wa(t,e,i){return e.x<=Math.max(t.x,i.x)&&e.x>=Math.min(t.x,i.x)&&e.y<=Math.max(t.y,i.y)&&e.y>=Math.min(t.y,i.y)}function Xa(t){return t>0?1:t<0?-1:0}function Ja(t,e){return Za(t.prev,t,t.next)<0?Za(t,e,t.next)>=0&&Za(t,t.prev,e)>=0:Za(t,e,t.prev)<0||Za(t,t.next,e)<0}function Ya(t,e){const i=il(t.i,t.x,t.y),r=il(e.i,e.x,e.y),n=t.next,o=e.prev;return t.next=e,e.prev=t,i.next=n,n.prev=i,r.next=i,i.prev=r,o.next=r,r.prev=o,r}function tl(t,e,i,r){const n=il(t,e,i);return r?(n.next=r.next,n.prev=r,r.next.prev=n,r.next=n):(n.prev=n,n.next=n),n}function el(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function il(t,e,i){return{i:t,x:e,y:i,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function rl(t,e,i){const r=i.patternDependencies;let n=!1;for(const i of e){const e=i.paint.get(`${t}-pattern`);e.isConstant()||(n=!0);const o=e.constantOr(null);o&&(n=!0,r[o.to]=!0,r[o.from]=!0)}return n}function nl(t,e,i,r,n){const o=n.patternDependencies;for(const s of e){const e=s.paint.get(`${t}-pattern`).value;if("constant"!==e.kind){let t=e.evaluate({zoom:r-1},i,{},n.availableImages),a=e.evaluate({zoom:r},i,{},n.availableImages),l=e.evaluate({zoom:r+1},i,{},n.availableImages);t=t&&t.name?t.name:t,a=a&&a.name?a.name:a,l=l&&l.name?l.name:l,o[t]=!0,o[a]=!0,o[l]=!0,i.patterns[s.id]={min:t,mid:a,max:l}}}return i}class ol{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((t=>t.id)),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new qo,this.indexArray=new ns,this.indexArray2=new os,this.programConfigurations=new zs(t.layers,t.zoom),this.segments=new ls,this.segments2=new ls,this.stateDependentLayerIds=this.layers.filter((t=>t.isStateDependent())).map((t=>t.id))}populate(t,e,i){this.hasPattern=rl("fill",this.layers,e);const r=this.layers[0].layout.get("fill-sort-key"),n=!r.isConstant(),o=[];for(const{feature:s,id:a,index:l,sourceLayerIndex:c}of t){const t=this.layers[0]._featureFilter.needGeometry,u=Qs(s,t);if(!this.layers[0]._featureFilter.filter(new Vn(this.zoom),u,i))continue;const h=n?r.evaluate(u,{},i,e.availableImages):void 0,d={id:a,properties:s.properties,type:s.type,sourceLayerIndex:c,index:l,geometry:t?u.geometry:Ns(s),patterns:{},sortKey:h};o.push(d)}n&&o.sort(((t,e)=>t.sortKey-e.sortKey));for(const r of o){const{geometry:n,index:o,sourceLayerIndex:s}=r;if(this.hasPattern){const t=nl("fill",this.layers,r,this.zoom,e);this.patternFeatures.push(t)}else this.addFeature(r,n,o,i,{});e.featureIndex.insert(t[o].feature,n,o,s,this.index)}}update(t,e,i){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,i)}addFeatures(t,e,i){for(const t of this.patternFeatures)this.addFeature(t,t.geometry,t.index,e,i)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,ka),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,e,i,r,n){for(const t of _i(e,500)){let e=0;for(const i of t)e+=i.length;const i=this.segments.prepareSegment(e,this.layoutVertexArray,this.indexArray),r=i.vertexLength,n=[],o=[];for(const e of t){if(0===e.length)continue;e!==t[0]&&o.push(n.length/2);const i=this.segments2.prepareSegment(e.length,this.layoutVertexArray,this.indexArray2),r=i.vertexLength;this.layoutVertexArray.emplaceBack(e[0].x,e[0].y),this.indexArray2.emplaceBack(r+e.length-1,r),n.push(e[0].x),n.push(e[0].y);for(let t=1;t<e.length;t++)this.layoutVertexArray.emplaceBack(e[t].x,e[t].y),this.indexArray2.emplaceBack(r+t-1,r+t),n.push(e[t].x),n.push(e[t].y);i.vertexLength+=e.length,i.primitiveLength+=e.length}const s=Pa(n,o);for(let t=0;t<s.length;t+=3)this.indexArray.emplaceBack(r+s[t],r+s[t+1],r+s[t+2]);i.vertexLength+=e,i.primitiveLength+=s.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,i,n,r)}}let sl,al;xn("FillBucket",ol,{omit:["layers","patternFeatures"]});var ll={get paint(){return al=al||new io({"fill-antialias":new Xn($.paint_fill["fill-antialias"]),"fill-opacity":new Jn($.paint_fill["fill-opacity"]),"fill-color":new Jn($.paint_fill["fill-color"]),"fill-outline-color":new Jn($.paint_fill["fill-outline-color"]),"fill-translate":new Xn($.paint_fill["fill-translate"]),"fill-translate-anchor":new Xn($.paint_fill["fill-translate-anchor"]),"fill-pattern":new Yn($.paint_fill["fill-pattern"])})},get layout(){return sl=sl||new io({"fill-sort-key":new Jn($.layout_fill["fill-sort-key"])})}};class cl extends no{constructor(t){super(t,ll)}recalculate(t,e){super.recalculate(t,e);const i=this.paint._values["fill-outline-color"];"constant"===i.value.kind&&void 0===i.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new ol(t)}queryRadius(){return ia(this.paint.get("fill-translate"))}queryIntersectsFeature(t,e,i,r,n,o,s){return $s(ra(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),o.angle,s),r)}isTileClipped(){return!0}}const ul=lo([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),hl=lo([{name:"a_centroid",components:2,type:"Int16"}],4),{members:dl}=ul;var pl={},fl=r,Al=ml;function ml(t,e,i,r,n){this.properties={},this.extent=i,this.type=0,this._pbf=t,this._geometry=-1,this._keys=r,this._values=n,t.readFields(gl,this,e)}function gl(t,e,i){1==t?e.id=i.readVarint():2==t?function(t,e){for(var i=t.readVarint()+t.pos;t.pos<i;){var r=e._keys[t.readVarint()],n=e._values[t.readVarint()];e.properties[r]=n}}(i,e):3==t?e.type=i.readVarint():4==t&&(e._geometry=i.pos)}function _l(t){for(var e,i,r=0,n=0,o=t.length,s=o-1;n<o;s=n++)r+=((i=t[s]).x-(e=t[n]).x)*(e.y+i.y);return r}ml.types=["Unknown","Point","LineString","Polygon"],ml.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,i=t.readVarint()+t.pos,r=1,n=0,o=0,s=0,a=[];t.pos<i;){if(n<=0){var l=t.readVarint();r=7&l,n=l>>3}if(n--,1===r||2===r)o+=t.readSVarint(),s+=t.readSVarint(),1===r&&(e&&a.push(e),e=[]),e.push(new fl(o,s));else{if(7!==r)throw new Error("unknown command "+r);e&&e.push(e[0].clone())}}return e&&a.push(e),a},ml.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,i=1,r=0,n=0,o=0,s=1/0,a=-1/0,l=1/0,c=-1/0;t.pos<e;){if(r<=0){var u=t.readVarint();i=7&u,r=u>>3}if(r--,1===i||2===i)(n+=t.readSVarint())<s&&(s=n),n>a&&(a=n),(o+=t.readSVarint())<l&&(l=o),o>c&&(c=o);else if(7!==i)throw new Error("unknown command "+i)}return[s,l,a,c]},ml.prototype.toGeoJSON=function(t,e,i){var r,n,o=this.extent*Math.pow(2,i),s=this.extent*t,a=this.extent*e,l=this.loadGeometry(),c=ml.types[this.type];function u(t){for(var e=0;e<t.length;e++){var i=t[e];t[e]=[360*(i.x+s)/o-180,360/Math.PI*Math.atan(Math.exp((180-360*(i.y+a)/o)*Math.PI/180))-90]}}switch(this.type){case 1:var h=[];for(r=0;r<l.length;r++)h[r]=l[r][0];u(l=h);break;case 2:for(r=0;r<l.length;r++)u(l[r]);break;case 3:for(l=function(t){var e=t.length;if(e<=1)return[t];for(var i,r,n=[],o=0;o<e;o++){var s=_l(t[o]);0!==s&&(void 0===r&&(r=s<0),r===s<0?(i&&n.push(i),i=[t[o]]):i.push(t[o]))}return i&&n.push(i),n}(l),r=0;r<l.length;r++)for(n=0;n<l[r].length;n++)u(l[r][n])}1===l.length?l=l[0]:c="Multi"+c;var d={type:"Feature",geometry:{type:c,coordinates:l},properties:this.properties};return"id"in this&&(d.id=this.id),d};var yl=Al,vl=xl;function xl(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(bl,this,e),this.length=this._features.length}function bl(t,e,i){15===t?e.version=i.readVarint():1===t?e.name=i.readString():5===t?e.extent=i.readVarint():2===t?e._features.push(i.pos):3===t?e._keys.push(i.readString()):4===t&&e._values.push(function(t){for(var e=null,i=t.readVarint()+t.pos;t.pos<i;){var r=t.readVarint()>>3;e=1===r?t.readString():2===r?t.readFloat():3===r?t.readDouble():4===r?t.readVarint64():5===r?t.readVarint():6===r?t.readSVarint():7===r?t.readBoolean():null}return e}(i))}xl.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new yl(this._pbf,e,this.extent,this._keys,this._values)};var wl=vl;function Tl(t,e,i){if(3===t){var r=new wl(i,i.readVarint()+i.pos);r.length&&(e[r.name]=r)}}pl.VectorTile=function(t,e){this.layers=t.readFields(Tl,{},e)},pl.VectorTileFeature=Al,pl.VectorTileLayer=vl;const Bl=pl.VectorTileFeature.types,El=Math.pow(2,13);function Cl(t,e,i,r,n,o,s,a){t.emplaceBack(e,i,2*Math.floor(r*El)+s,n*El*2,o*El*2,Math.round(a))}class Sl{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((t=>t.id)),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Ko,this.centroidVertexArray=new $o,this.indexArray=new ns,this.programConfigurations=new zs(t.layers,t.zoom),this.segments=new ls,this.stateDependentLayerIds=this.layers.filter((t=>t.isStateDependent())).map((t=>t.id))}populate(t,e,i){this.features=[],this.hasPattern=rl("fill-extrusion",this.layers,e);for(const{feature:r,id:n,index:o,sourceLayerIndex:s}of t){const t=this.layers[0]._featureFilter.needGeometry,a=Qs(r,t);if(!this.layers[0]._featureFilter.filter(new Vn(this.zoom),a,i))continue;const l={id:n,sourceLayerIndex:s,index:o,geometry:t?a.geometry:Ns(r),properties:r.properties,type:r.type,patterns:{}};this.hasPattern?this.features.push(nl("fill-extrusion",this.layers,l,this.zoom,e)):this.addFeature(l,l.geometry,o,i,{}),e.featureIndex.insert(r,l.geometry,o,s,this.index,!0)}}addFeatures(t,e,i){for(const t of this.features){const{geometry:r}=t;this.addFeature(t,r,t.index,e,i)}}update(t,e,i){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,i)}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.centroidVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,dl),this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,hl.members,!0),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(t,e,i,r,n){for(const i of _i(e,500)){const e={x:0,y:0,vertexCount:0};let r=0;for(const t of i)r+=t.length;let n=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const t of i){if(0===t.length)continue;if(Ml(t))continue;let i=0;for(let r=0;r<t.length;r++){const o=t[r];if(r>=1){const s=t[r-1];if(!Il(o,s)){n.vertexLength+4>ls.MAX_VERTEX_ARRAY_LENGTH&&(n=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const t=o.sub(s)._perp()._unit(),r=s.dist(o);i+r>32768&&(i=0),Cl(this.layoutVertexArray,o.x,o.y,t.x,t.y,0,0,i),Cl(this.layoutVertexArray,o.x,o.y,t.x,t.y,0,1,i),e.x+=2*o.x,e.y+=2*o.y,e.vertexCount+=2,i+=r,Cl(this.layoutVertexArray,s.x,s.y,t.x,t.y,0,0,i),Cl(this.layoutVertexArray,s.x,s.y,t.x,t.y,0,1,i),e.x+=2*s.x,e.y+=2*s.y,e.vertexCount+=2;const a=n.vertexLength;this.indexArray.emplaceBack(a,a+2,a+1),this.indexArray.emplaceBack(a+1,a+2,a+3),n.vertexLength+=4,n.primitiveLength+=2}}}}if(n.vertexLength+r>ls.MAX_VERTEX_ARRAY_LENGTH&&(n=this.segments.prepareSegment(r,this.layoutVertexArray,this.indexArray)),"Polygon"!==Bl[t.type])continue;const o=[],s=[],a=n.vertexLength;for(const t of i)if(0!==t.length){t!==i[0]&&s.push(o.length/2);for(let i=0;i<t.length;i++){const r=t[i];Cl(this.layoutVertexArray,r.x,r.y,0,0,1,1,0),e.x+=r.x,e.y+=r.y,e.vertexCount+=1,o.push(r.x),o.push(r.y)}}const l=Pa(o,s);for(let t=0;t<l.length;t+=3)this.indexArray.emplaceBack(a+l[t],a+l[t+2],a+l[t+1]);n.primitiveLength+=l.length/3,n.vertexLength+=r;for(let t=0;t<e.vertexCount;t++){const t=Math.floor(e.x/e.vertexCount),i=Math.floor(e.y/e.vertexCount);this.centroidVertexArray.emplaceBack(t,i)}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,i,n,r)}}function Il(t,e){return t.x===e.x&&(t.x<0||t.x>Rs)||t.y===e.y&&(t.y<0||t.y>Rs)}function Ml(t){return t.every((t=>t.x<0))||t.every((t=>t.x>Rs))||t.every((t=>t.y<0))||t.every((t=>t.y>Rs))}let kl;xn("FillExtrusionBucket",Sl,{omit:["layers","features"]});var Pl={get paint(){return kl=kl||new io({"fill-extrusion-opacity":new Xn($["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Jn($["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Xn($["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Xn($["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Yn($["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Jn($["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Jn($["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Xn($["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class Ll extends no{constructor(t){super(t,Pl)}createBucket(t){return new Sl(t)}queryRadius(){return ia(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(t,e,i,r,n,s,a,l){const c=ra(t,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),s.angle,a),u=this.paint.get("fill-extrusion-height").evaluate(e,i),h=this.paint.get("fill-extrusion-base").evaluate(e,i),d=function(t,e,i,r){const n=[];for(const i of t){const t=[i.x,i.y,0,1];pa(t,t,e),n.push(new o(t[0]/t[3],t[1]/t[3]))}return n}(c,l),p=function(t,e,i,r){const n=[],s=[],a=r[8]*e,l=r[9]*e,c=r[10]*e,u=r[11]*e,h=r[8]*i,d=r[9]*i,p=r[10]*i,f=r[11]*i;for(const e of t){const t=[],i=[];for(const n of e){const e=n.x,s=n.y,A=r[0]*e+r[4]*s+r[12],m=r[1]*e+r[5]*s+r[13],g=r[2]*e+r[6]*s+r[14],_=r[3]*e+r[7]*s+r[15],y=g+c,v=_+u,x=A+h,b=m+d,w=g+p,T=_+f,B=new o((A+a)/v,(m+l)/v);B.z=y/v,t.push(B);const E=new o(x/T,b/T);E.z=w/T,i.push(E)}n.push(t),s.push(i)}return[n,s]}(r,h,u,l);return function(t,e,i){let r=1/0;$s(i,e)&&(r=Fl(i,e[0]));for(let n=0;n<e.length;n++){const o=e[n],s=t[n];for(let t=0;t<o.length-1;t++){const e=o[t],n=[e,o[t+1],s[t+1],s[t],e];Hs(i,n)&&(r=Math.min(r,Fl(i,n)))}}return r!==1/0&&r}(p[0],p[1],d)}}function zl(t,e){return t.x*e.x+t.y*e.y}function Fl(t,e){if(1===t.length){let i=0;const r=e[i++];let n;for(;!n||r.equals(n);)if(n=e[i++],!n)return 1/0;for(;i<e.length;i++){const o=e[i],s=t[0],a=n.sub(r),l=o.sub(r),c=s.sub(r),u=zl(a,a),h=zl(a,l),d=zl(l,l),p=zl(c,a),f=zl(c,l),A=u*d-h*h,m=(d*p-h*f)/A,g=(u*f-h*p)/A,_=r.z*(1-m-g)+n.z*m+o.z*g;if(isFinite(_))return _}return 1/0}{let t=1/0;for(const i of e)t=Math.min(t,i.z);return t}}const Dl=lo([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Rl}=Dl,Ul=lo([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:Ol}=Ul,Nl=pl.VectorTileFeature.types,Ql=Math.cos(Math.PI/180*37.5),Vl=Math.pow(2,14)/.5;class jl{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((t=>t.id)),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((t=>{this.gradients[t.id]={}})),this.layoutVertexArray=new Wo,this.layoutVertexArray2=new Xo,this.indexArray=new ns,this.programConfigurations=new zs(t.layers,t.zoom),this.segments=new ls,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((t=>t.isStateDependent())).map((t=>t.id))}populate(t,e,i){this.hasPattern=rl("line",this.layers,e);const r=this.layers[0].layout.get("line-sort-key"),n=!r.isConstant(),o=[];for(const{feature:e,id:s,index:a,sourceLayerIndex:l}of t){const t=this.layers[0]._featureFilter.needGeometry,c=Qs(e,t);if(!this.layers[0]._featureFilter.filter(new Vn(this.zoom),c,i))continue;const u=n?r.evaluate(c,{},i):void 0,h={id:s,properties:e.properties,type:e.type,sourceLayerIndex:l,index:a,geometry:t?c.geometry:Ns(e),patterns:{},sortKey:u};o.push(h)}n&&o.sort(((t,e)=>t.sortKey-e.sortKey));for(const r of o){const{geometry:n,index:o,sourceLayerIndex:s}=r;if(this.hasPattern){const t=nl("line",this.layers,r,this.zoom,e);this.patternFeatures.push(t)}else this.addFeature(r,n,o,i,{});e.featureIndex.insert(t[o].feature,n,o,s,this.index)}}update(t,e,i){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,i)}addFeatures(t,e,i){for(const t of this.patternFeatures)this.addFeature(t,t.geometry,t.index,e,i)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,Ol)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Rl),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,e,i,r,n){const o=this.layers[0].layout,s=o.get("line-join").evaluate(t,{}),a=o.get("line-cap"),l=o.get("line-miter-limit"),c=o.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const i of e)this.addLine(i,t,s,a,l,c);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,i,n,r)}addLine(t,e,i,r,n,o){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let e=0;e<t.length-1;e++)this.totalDistance+=t[e].dist(t[e+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const s="Polygon"===Nl[e.type];let a=t.length;for(;a>=2&&t[a-1].equals(t[a-2]);)a--;let l=0;for(;l<a-1&&t[l].equals(t[l+1]);)l++;if(a<(s?3:2))return;"bevel"===i&&(n=1.05);const c=this.overscaling<=16?15*Rs/(512*this.overscaling):0,u=this.segments.prepareSegment(10*a,this.layoutVertexArray,this.indexArray);let h,d,p,f,A;this.e1=this.e2=-1,s&&(h=t[a-2],A=t[l].sub(h)._unit()._perp());for(let e=l;e<a;e++){if(p=e===a-1?s?t[l+1]:void 0:t[e+1],p&&t[e].equals(p))continue;A&&(f=A),h&&(d=h),h=t[e],A=p?p.sub(h)._unit()._perp():f,f=f||A;let m=f.add(A);0===m.x&&0===m.y||m._unit();const g=f.x*A.x+f.y*A.y,_=m.x*A.x+m.y*A.y,y=0!==_?1/_:1/0,v=2*Math.sqrt(2-2*_),x=_<Ql&&d&&p,b=f.x*A.y-f.y*A.x>0;if(x&&e>l){const t=h.dist(d);if(t>2*c){const e=h.sub(h.sub(d)._mult(c/t)._round());this.updateDistance(d,e),this.addCurrentVertex(e,f,0,0,u),d=e}}const w=d&&p;let T=w?i:s?"butt":r;if(w&&"round"===T&&(y<o?T="miter":y<=2&&(T="fakeround")),"miter"===T&&y>n&&(T="bevel"),"bevel"===T&&(y>2&&(T="flipbevel"),y<n&&(T="miter")),d&&this.updateDistance(d,h),"miter"===T)m._mult(y),this.addCurrentVertex(h,m,0,0,u);else if("flipbevel"===T){if(y>100)m=A.mult(-1);else{const t=y*f.add(A).mag()/f.sub(A).mag();m._perp()._mult(t*(b?-1:1))}this.addCurrentVertex(h,m,0,0,u),this.addCurrentVertex(h,m.mult(-1),0,0,u)}else if("bevel"===T||"fakeround"===T){const t=-Math.sqrt(y*y-1),e=b?t:0,i=b?0:t;if(d&&this.addCurrentVertex(h,f,e,i,u),"fakeround"===T){const t=Math.round(180*v/Math.PI/20);for(let e=1;e<t;e++){let i=e/t;if(.5!==i){const t=i-.5;i+=i*t*(i-1)*((1.0904+g*(g*(3.55645-1.43519*g)-3.2452))*t*t+(.848013+g*(.215638*g-1.06021)))}const r=A.sub(f)._mult(i)._add(f)._unit()._mult(b?-1:1);this.addHalfVertex(h,r.x,r.y,!1,b,0,u)}}p&&this.addCurrentVertex(h,A,-e,-i,u)}else if("butt"===T)this.addCurrentVertex(h,m,0,0,u);else if("square"===T){const t=d?1:-1;this.addCurrentVertex(h,m,t,t,u)}else"round"===T&&(d&&(this.addCurrentVertex(h,f,0,0,u),this.addCurrentVertex(h,f,1,1,u,!0)),p&&(this.addCurrentVertex(h,A,-1,-1,u,!0),this.addCurrentVertex(h,A,0,0,u)));if(x&&e<a-1){const t=h.dist(p);if(t>2*c){const e=h.add(p.sub(h)._mult(c/t)._round());this.updateDistance(h,e),this.addCurrentVertex(e,A,0,0,u),h=e}}}}addCurrentVertex(t,e,i,r,n,o=!1){const s=e.y*r-e.x,a=-e.y-e.x*r;this.addHalfVertex(t,e.x+e.y*i,e.y-e.x*i,o,!1,i,n),this.addHalfVertex(t,s,a,o,!0,-r,n),this.distance>Vl/2&&0===this.totalDistance&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(t,e,i,r,n,o))}addHalfVertex({x:t,y:e},i,r,n,o,s,a){const l=.5*(this.lineClips?this.scaledDistance*(Vl-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t<<1)+(n?1:0),(e<<1)+(o?1:0),Math.round(63*i)+128,Math.round(63*r)+128,1+(0===s?0:s<0?-1:1)|(63&l)<<2,l>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const c=a.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,c),a.primitiveLength++),o?this.e2=c:this.e1=c}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(t,e){this.distance+=t.dist(e),this.updateScaledDistance()}}let Hl,Gl;xn("LineBucket",jl,{omit:["layers","patternFeatures"]});var $l={get paint(){return Gl=Gl||new io({"line-opacity":new Jn($.paint_line["line-opacity"]),"line-color":new Jn($.paint_line["line-color"]),"line-translate":new Xn($.paint_line["line-translate"]),"line-translate-anchor":new Xn($.paint_line["line-translate-anchor"]),"line-width":new Jn($.paint_line["line-width"]),"line-gap-width":new Jn($.paint_line["line-gap-width"]),"line-offset":new Jn($.paint_line["line-offset"]),"line-blur":new Jn($.paint_line["line-blur"]),"line-dasharray":new to($.paint_line["line-dasharray"]),"line-pattern":new Yn($.paint_line["line-pattern"]),"line-gradient":new eo($.paint_line["line-gradient"])})},get layout(){return Hl=Hl||new io({"line-cap":new Xn($.layout_line["line-cap"]),"line-join":new Jn($.layout_line["line-join"]),"line-miter-limit":new Xn($.layout_line["line-miter-limit"]),"line-round-limit":new Xn($.layout_line["line-round-limit"]),"line-sort-key":new Jn($.layout_line["line-sort-key"])})}};class Zl extends Jn{possiblyEvaluate(t,e){return e=new Vn(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,zoomHistory:e.zoomHistory,transition:e.transition}),super.possiblyEvaluate(t,e)}evaluate(t,e,i,r){return e=g({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(t,e,i,r)}}let ql;class Kl extends no{constructor(t){super(t,$l),this.gradientVersion=0,ql||(ql=new Zl($l.paint.properties["line-width"].specification),ql.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(t){if("line-gradient"===t){const t=this.gradientExpression();this.stepInterpolant=!!function(t){return void 0!==t._styleExpression}(t)&&t._styleExpression.expression instanceof we,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,e){super.recalculate(t,e),this.paint._values["line-floorwidth"]=ql.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new jl(t)}queryRadius(t){const e=t,i=Wl(ea("line-width",this,e),ea("line-gap-width",this,e)),r=ea("line-offset",this,e);return i/2+Math.abs(r)+ia(this.paint.get("line-translate"))}queryIntersectsFeature(t,e,i,r,n,s,a){const l=ra(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),s.angle,a),c=a/2*Wl(this.paint.get("line-width").evaluate(e,i),this.paint.get("line-gap-width").evaluate(e,i)),u=this.paint.get("line-offset").evaluate(e,i);return u&&(r=function(t,e){const i=[];for(let r=0;r<t.length;r++){const n=t[r],s=[];for(let t=0;t<n.length;t++){const i=n[t-1],r=n[t],a=n[t+1],l=0===t?new o(0,0):r.sub(i)._unit()._perp(),c=t===n.length-1?new o(0,0):a.sub(r)._unit()._perp(),u=l._add(c)._unit(),h=u.x*c.x+u.y*c.y;0!==h&&u._mult(1/h),s.push(u._mult(e)._add(r))}i.push(s)}return i}(r,u*a)),function(t,e,i){for(let r=0;r<e.length;r++){const n=e[r];if(t.length>=3)for(let e=0;e<n.length;e++)if(Ys(t,n[e]))return!0;if(Zs(t,n,i))return!0}return!1}(l,r,c)}isTileClipped(){return!0}}function Wl(t,e){return e>0?e+2*t:t}const Xl=lo([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Jl=lo([{name:"a_projected_pos",components:3,type:"Float32"}],4);lo([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Yl=lo([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);lo([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const tc=lo([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),ec=lo([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function ic(t,e,i){return t.sections.forEach((t=>{t.text=function(t,e,i){const r=e.layout.get("text-transform").evaluate(i,{});return"uppercase"===r?t=t.toLocaleUpperCase():"lowercase"===r&&(t=t.toLocaleLowerCase()),Qn.applyArabicShaping&&(t=Qn.applyArabicShaping(t)),t}(t.text,e,i)})),t}lo([{name:"triangle",components:3,type:"Uint16"}]),lo([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),lo([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),lo([{type:"Float32",name:"offsetX"}]),lo([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),lo([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const rc={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var nc=24,oc=lc,sc=function(t,e,i,r,n){var o,s,a=8*n-r-1,l=(1<<a)-1,c=l>>1,u=-7,h=i?n-1:0,d=i?-1:1,p=t[e+h];for(h+=d,o=p&(1<<-u)-1,p>>=-u,u+=a;u>0;o=256*o+t[e+h],h+=d,u-=8);for(s=o&(1<<-u)-1,o>>=-u,u+=r;u>0;s=256*s+t[e+h],h+=d,u-=8);if(0===o)o=1-c;else{if(o===l)return s?NaN:1/0*(p?-1:1);s+=Math.pow(2,r),o-=c}return(p?-1:1)*s*Math.pow(2,o-r)},ac=function(t,e,i,r,n,o){var s,a,l,c=8*o-n-1,u=(1<<c)-1,h=u>>1,d=23===n?Math.pow(2,-24)-Math.pow(2,-77):0,p=r?0:o-1,f=r?1:-1,A=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,s=u):(s=Math.floor(Math.log(e)/Math.LN2),e*(l=Math.pow(2,-s))<1&&(s--,l*=2),(e+=s+h>=1?d/l:d*Math.pow(2,1-h))*l>=2&&(s++,l/=2),s+h>=u?(a=0,s=u):s+h>=1?(a=(e*l-1)*Math.pow(2,n),s+=h):(a=e*Math.pow(2,h-1)*Math.pow(2,n),s=0));n>=8;t[i+p]=255&a,p+=f,a/=256,n-=8);for(s=s<<n|a,c+=n;c>0;t[i+p]=255&s,p+=f,s/=256,c-=8);t[i+p-f]|=128*A};function lc(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}lc.Varint=0,lc.Fixed64=1,lc.Bytes=2,lc.Fixed32=5;var cc=4294967296,uc=1/cc,hc="undefined"==typeof TextDecoder?null:new TextDecoder("utf-8");function dc(t){return t.type===lc.Bytes?t.readVarint()+t.pos:t.pos+1}function pc(t,e,i){return i?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function fc(t,e,i){var r=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));i.realloc(r);for(var n=i.pos-1;n>=t;n--)i.buf[n+r]=i.buf[n]}function Ac(t,e){for(var i=0;i<t.length;i++)e.writeVarint(t[i])}function mc(t,e){for(var i=0;i<t.length;i++)e.writeSVarint(t[i])}function gc(t,e){for(var i=0;i<t.length;i++)e.writeFloat(t[i])}function _c(t,e){for(var i=0;i<t.length;i++)e.writeDouble(t[i])}function yc(t,e){for(var i=0;i<t.length;i++)e.writeBoolean(t[i])}function vc(t,e){for(var i=0;i<t.length;i++)e.writeFixed32(t[i])}function xc(t,e){for(var i=0;i<t.length;i++)e.writeSFixed32(t[i])}function bc(t,e){for(var i=0;i<t.length;i++)e.writeFixed64(t[i])}function wc(t,e){for(var i=0;i<t.length;i++)e.writeSFixed64(t[i])}function Tc(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function Bc(t,e,i){t[i]=e,t[i+1]=e>>>8,t[i+2]=e>>>16,t[i+3]=e>>>24}function Ec(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}lc.prototype={destroy:function(){this.buf=null},readFields:function(t,e,i){for(i=i||this.length;this.pos<i;){var r=this.readVarint(),n=r>>3,o=this.pos;this.type=7&r,t(n,e,this),this.pos===o&&this.skip(r)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=Tc(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=Ec(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=Tc(this.buf,this.pos)+Tc(this.buf,this.pos+4)*cc;return this.pos+=8,t},readSFixed64:function(){var t=Tc(this.buf,this.pos)+Ec(this.buf,this.pos+4)*cc;return this.pos+=8,t},readFloat:function(){var t=sc(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=sc(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,i,r=this.buf;return e=127&(i=r[this.pos++]),i<128?e:(e|=(127&(i=r[this.pos++]))<<7,i<128?e:(e|=(127&(i=r[this.pos++]))<<14,i<128?e:(e|=(127&(i=r[this.pos++]))<<21,i<128?e:function(t,e,i){var r,n,o=i.buf;if(r=(112&(n=o[i.pos++]))>>4,n<128)return pc(t,r,e);if(r|=(127&(n=o[i.pos++]))<<3,n<128)return pc(t,r,e);if(r|=(127&(n=o[i.pos++]))<<10,n<128)return pc(t,r,e);if(r|=(127&(n=o[i.pos++]))<<17,n<128)return pc(t,r,e);if(r|=(127&(n=o[i.pos++]))<<24,n<128)return pc(t,r,e);if(r|=(1&(n=o[i.pos++]))<<31,n<128)return pc(t,r,e);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(i=r[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&hc?function(t,e,i){return hc.decode(t.subarray(e,i))}(this.buf,e,t):function(t,e,i){for(var r="",n=e;n<i;){var o,s,a,l=t[n],c=null,u=l>239?4:l>223?3:l>191?2:1;if(n+u>i)break;1===u?l<128&&(c=l):2===u?128==(192&(o=t[n+1]))&&(c=(31&l)<<6|63&o)<=127&&(c=null):3===u?(s=t[n+2],128==(192&(o=t[n+1]))&&128==(192&s)&&((c=(15&l)<<12|(63&o)<<6|63&s)<=2047||c>=55296&&c<=57343)&&(c=null)):4===u&&(s=t[n+2],a=t[n+3],128==(192&(o=t[n+1]))&&128==(192&s)&&128==(192&a)&&((c=(15&l)<<18|(63&o)<<12|(63&s)<<6|63&a)<=65535||c>=1114112)&&(c=null)),null===c?(c=65533,u=1):c>65535&&(c-=65536,r+=String.fromCharCode(c>>>10&1023|55296),c=56320|1023&c),r+=String.fromCharCode(c),n+=u}return r}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==lc.Bytes)return t.push(this.readVarint(e));var i=dc(this);for(t=t||[];this.pos<i;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==lc.Bytes)return t.push(this.readSVarint());var e=dc(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==lc.Bytes)return t.push(this.readBoolean());var e=dc(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==lc.Bytes)return t.push(this.readFloat());var e=dc(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==lc.Bytes)return t.push(this.readDouble());var e=dc(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==lc.Bytes)return t.push(this.readFixed32());var e=dc(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==lc.Bytes)return t.push(this.readSFixed32());var e=dc(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==lc.Bytes)return t.push(this.readFixed64());var e=dc(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==lc.Bytes)return t.push(this.readSFixed64());var e=dc(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===lc.Varint)for(;this.buf[this.pos++]>127;);else if(e===lc.Bytes)this.pos=this.readVarint()+this.pos;else if(e===lc.Fixed32)this.pos+=4;else{if(e!==lc.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var i=new Uint8Array(e);i.set(this.buf),this.buf=i,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),Bc(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),Bc(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),Bc(this.buf,-1&t,this.pos),Bc(this.buf,Math.floor(t*uc),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),Bc(this.buf,-1&t,this.pos),Bc(this.buf,Math.floor(t*uc),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(t,e){var i,r;if(t>=0?(i=t%4294967296|0,r=t/4294967296|0):(r=~(-t/4294967296),4294967295^(i=~(-t%4294967296))?i=i+1|0:(i=0,r=r+1|0)),t>=0x10000000000000000||t<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),function(t,e,i){i.buf[i.pos++]=127&t|128,t>>>=7,i.buf[i.pos++]=127&t|128,t>>>=7,i.buf[i.pos++]=127&t|128,t>>>=7,i.buf[i.pos++]=127&t|128,i.buf[i.pos]=127&(t>>>=7)}(i,0,e),function(t,e){var i=(7&t)<<4;e.buf[e.pos++]|=i|((t>>>=3)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t)))))}(r,e)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(t,e,i){for(var r,n,o=0;o<e.length;o++){if((r=e.charCodeAt(o))>55295&&r<57344){if(!n){r>56319||o+1===e.length?(t[i++]=239,t[i++]=191,t[i++]=189):n=r;continue}if(r<56320){t[i++]=239,t[i++]=191,t[i++]=189,n=r;continue}r=n-55296<<10|r-56320|65536,n=null}else n&&(t[i++]=239,t[i++]=191,t[i++]=189,n=null);r<128?t[i++]=r:(r<2048?t[i++]=r>>6|192:(r<65536?t[i++]=r>>12|224:(t[i++]=r>>18|240,t[i++]=r>>12&63|128),t[i++]=r>>6&63|128),t[i++]=63&r|128)}return i}(this.buf,t,this.pos);var i=this.pos-e;i>=128&&fc(e,i,this),this.pos=e-1,this.writeVarint(i),this.pos+=i},writeFloat:function(t){this.realloc(4),ac(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),ac(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var i=0;i<e;i++)this.buf[this.pos++]=t[i]},writeRawMessage:function(t,e){this.pos++;var i=this.pos;t(e,this);var r=this.pos-i;r>=128&&fc(i,r,this),this.pos=i-1,this.writeVarint(r),this.pos+=r},writeMessage:function(t,e,i){this.writeTag(t,lc.Bytes),this.writeRawMessage(e,i)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,Ac,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,mc,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,yc,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,gc,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,_c,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,vc,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,xc,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,bc,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,wc,e)},writeBytesField:function(t,e){this.writeTag(t,lc.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,lc.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,lc.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,lc.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,lc.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,lc.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,lc.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,lc.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,lc.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,lc.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}};var Cc=i(oc);const Sc=3;function Ic(t,e,i){1===t&&i.readMessage(Mc,e)}function Mc(t,e,i){if(3===t){const{id:t,bitmap:r,width:n,height:o,left:s,top:a,advance:l}=i.readMessage(kc,{});e.push({id:t,bitmap:new ba({width:n+2*Sc,height:o+2*Sc},r),metrics:{width:n,height:o,left:s,top:a,advance:l}})}}function kc(t,e,i){1===t?e.id=i.readVarint():2===t?e.bitmap=i.readBytes():3===t?e.width=i.readVarint():4===t?e.height=i.readVarint():5===t?e.left=i.readSVarint():6===t?e.top=i.readSVarint():7===t&&(e.advance=i.readVarint())}const Pc=Sc;function Lc(t){let e=0,i=0;for(const r of t)e+=r.w*r.h,i=Math.max(i,r.w);t.sort(((t,e)=>e.h-t.h));const r=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),i),h:1/0}];let n=0,o=0;for(const e of t)for(let t=r.length-1;t>=0;t--){const i=r[t];if(!(e.w>i.w||e.h>i.h)){if(e.x=i.x,e.y=i.y,o=Math.max(o,e.y+e.h),n=Math.max(n,e.x+e.w),e.w===i.w&&e.h===i.h){const e=r.pop();t<r.length&&(r[t]=e)}else e.h===i.h?(i.x+=e.w,i.w-=e.w):e.w===i.w?(i.y+=e.h,i.h-=e.h):(r.push({x:i.x+e.w,y:i.y,w:i.w-e.w,h:e.h}),i.y+=e.h,i.h-=e.h);break}}return{w:n,h:o,fill:e/(n*o)||0}}const zc=1;class Fc{constructor(t,{pixelRatio:e,version:i,stretchX:r,stretchY:n,content:o,textFitWidth:s,textFitHeight:a}){this.paddedRect=t,this.pixelRatio=e,this.stretchX=r,this.stretchY=n,this.content=o,this.version=i,this.textFitWidth=s,this.textFitHeight=a}get tl(){return[this.paddedRect.x+zc,this.paddedRect.y+zc]}get br(){return[this.paddedRect.x+this.paddedRect.w-zc,this.paddedRect.y+this.paddedRect.h-zc]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*zc)/this.pixelRatio,(this.paddedRect.h-2*zc)/this.pixelRatio]}}class Dc{constructor(t,e){const i={},r={};this.haveRenderCallbacks=[];const n=[];this.addImages(t,i,n),this.addImages(e,r,n);const{w:o,h:s}=Lc(n),a=new wa({width:o||1,height:s||1});for(const e in t){const r=t[e],n=i[e].paddedRect;wa.copy(r.data,a,{x:0,y:0},{x:n.x+zc,y:n.y+zc},r.data)}for(const t in e){const i=e[t],n=r[t].paddedRect,o=n.x+zc,s=n.y+zc,l=i.data.width,c=i.data.height;wa.copy(i.data,a,{x:0,y:0},{x:o,y:s},i.data),wa.copy(i.data,a,{x:0,y:c-1},{x:o,y:s-1},{width:l,height:1}),wa.copy(i.data,a,{x:0,y:0},{x:o,y:s+c},{width:l,height:1}),wa.copy(i.data,a,{x:l-1,y:0},{x:o-1,y:s},{width:1,height:c}),wa.copy(i.data,a,{x:0,y:0},{x:o+l,y:s},{width:1,height:c})}this.image=a,this.iconPositions=i,this.patternPositions=r}addImages(t,e,i){for(const r in t){const n=t[r],o={x:0,y:0,w:n.data.width+2*zc,h:n.data.height+2*zc};i.push(o),e[r]=new Fc(o,n),n.hasRenderCallback&&this.haveRenderCallbacks.push(r)}}patchUpdatedImages(t,e){t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const i in t.updatedImages)this.patchUpdatedImage(this.iconPositions[i],t.getImage(i),e),this.patchUpdatedImage(this.patternPositions[i],t.getImage(i),e)}patchUpdatedImage(t,e,i){if(!t||!e)return;if(t.version===e.version)return;t.version=e.version;const[r,n]=t.tl;i.update(e.data,void 0,{x:r,y:n})}}var Rc;xn("ImagePosition",Fc),xn("ImageAtlas",Dc),t.ah=void 0,(Rc=t.ah||(t.ah={}))[Rc.none=0]="none",Rc[Rc.horizontal=1]="horizontal",Rc[Rc.vertical=2]="vertical",Rc[Rc.horizontalOnly=3]="horizontalOnly";const Uc=-17;class Oc{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(t,e){const i=new Oc;return i.scale=t||1,i.fontStack=e,i}static forImage(t){const e=new Oc;return e.imageName=t,e}}class Nc{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,e){const i=new Nc;for(let r=0;r<t.sections.length;r++){const n=t.sections[r];n.image?i.addImageSection(n):i.addTextSection(n,e)}return i}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(){this.text=function(t){let e="";for(let i=0;i<t.length;i++){const r=t.charCodeAt(i+1)||null,n=t.charCodeAt(i-1)||null;e+=r&&Dn(r)&&!rc[t[i+1]]||n&&Dn(n)&&!rc[t[i-1]]||!rc[t[i]]?t[i]:rc[t[i]]}return e}(this.text)}trim(){let t=0;for(let e=0;e<this.text.length&&Vc[this.text.charCodeAt(e)];e++)t++;let e=this.text.length;for(let i=this.text.length-1;i>=0&&i>=t&&Vc[this.text.charCodeAt(i)];i--)e--;this.text=this.text.substring(t,e),this.sectionIndex=this.sectionIndex.slice(t,e)}substring(t,e){const i=new Nc;return i.text=this.text.substring(t,e),i.sectionIndex=this.sectionIndex.slice(t,e),i.sections=this.sections,i}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((t,e)=>Math.max(t,this.sections[e].scale)),0)}addTextSection(t,e){this.text+=t.text,this.sections.push(Oc.forText(t.scale,t.fontStack||e));const i=this.sections.length-1;for(let e=0;e<t.text.length;++e)this.sectionIndex.push(i)}addImageSection(t){const e=t.image?t.image.name:"";if(0===e.length)return void w("Can't add FormattedSection with an empty image.");const i=this.getNextImageSectionCharCode();i?(this.text+=String.fromCharCode(i),this.sections.push(Oc.forImage(e)),this.sectionIndex.push(this.sections.length-1)):w("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Qc(e,i,r,n,o,s,a,l,c,u,h,d,p,f,A){const m=Nc.fromFeature(e,o);let g;d===t.ah.vertical&&m.verticalizePunctuation();const{processBidirectionalText:_,processStyledBidirectionalText:y}=Qn;if(_&&1===m.sections.length){g=[];const t=_(m.toString(),Wc(m,u,s,i,n,f));for(const e of t){const t=new Nc;t.text=e,t.sections=m.sections;for(let i=0;i<e.length;i++)t.sectionIndex.push(0);g.push(t)}}else if(y){g=[];const t=y(m.text,m.sectionIndex,Wc(m,u,s,i,n,f));for(const e of t){const t=new Nc;t.text=e[0],t.sectionIndex=e[1],t.sections=m.sections,g.push(t)}}else g=function(t,e){const i=[],r=t.text;let n=0;for(const r of e)i.push(t.substring(n,r)),n=r;return n<r.length&&i.push(t.substring(n,r.length)),i}(m,Wc(m,u,s,i,n,f));const v=[],x={positionedLines:v,text:m.toString(),top:h[1],bottom:h[1],left:h[0],right:h[0],writingMode:d,iconsInText:!1,verticalizable:!1};return function(e,i,r,n,o,s,a,l,c,u,h,d){let p=0,f=Uc,A=0,m=0;const g="right"===l?1:"left"===l?0:.5;let _=0;for(const a of o){a.trim();const o=a.getMaxScale(),l=(o-1)*nc,v={positionedGlyphs:[],lineOffset:0};e.positionedLines[_]=v;const x=v.positionedGlyphs;let b=0;if(!a.length()){f+=s,++_;continue}for(let s=0;s<a.length();s++){const A=a.getSection(s),m=a.getSectionIndex(s),g=a.getCharCode(s);let _=0,v=null,w=null,T=null,B=nc;const E=!(c===t.ah.horizontal||!h&&!Fn(g)||h&&(Vc[g]||(y=g,/\p{sc=Arab}/u.test(String.fromCodePoint(y)))));if(A.imageName){const t=n[A.imageName];if(!t)continue;T=A.imageName,e.iconsInText=e.iconsInText||!0,w=t.paddedRect;const i=t.displaySize;A.scale=A.scale*nc/d,v={width:i[0],height:i[1],left:zc,top:-Pc,advance:E?i[1]:i[0]},_=l+(nc-i[1]*A.scale),B=v.advance;const r=E?i[0]*A.scale-nc*o:i[1]*A.scale-nc*o;r>0&&r>b&&(b=r)}else{const t=r[A.fontStack],e=t&&t[g];if(e&&e.rect)w=e.rect,v=e.metrics;else{const t=i[A.fontStack],e=t&&t[g];if(!e)continue;v=e.metrics}_=(o-A.scale)*nc}E?(e.verticalizable=!0,x.push({glyph:g,imageName:T,x:p,y:f+_,vertical:E,scale:A.scale,fontStack:A.fontStack,sectionIndex:m,metrics:v,rect:w}),p+=B*A.scale+u):(x.push({glyph:g,imageName:T,x:p,y:f+_,vertical:E,scale:A.scale,fontStack:A.fontStack,sectionIndex:m,metrics:v,rect:w}),p+=v.advance*A.scale+u)}0!==x.length&&(A=Math.max(p-u,A),Jc(x,0,x.length-1,g,b)),p=0;const w=s*o+b;v.lineOffset=Math.max(b,l),f+=w,m=Math.max(w,m),++_}var y;const v=f-Uc,{horizontalAlign:x,verticalAlign:b}=Xc(a);(function(t,e,i,r,n,o,s,a,l){const c=(e-i)*n;let u=0;u=o!==s?-a*r-Uc:(-r*l+.5)*s;for(const e of t)for(const t of e.positionedGlyphs)t.x+=c,t.y+=u})(e.positionedLines,g,x,b,A,m,s,v,o.length),e.top+=-b*v,e.bottom=e.top+v,e.left+=-x*A,e.right=e.left+A}(x,i,r,n,g,a,l,c,d,u,p,A),!function(t){for(const e of t)if(0!==e.positionedGlyphs.length)return!1;return!0}(v)&&x}const Vc={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},jc={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},Hc={40:!0};function Gc(t,e,i,r,n,o){if(e.imageName){const t=r[e.imageName];return t?t.displaySize[0]*e.scale*nc/o+n:0}{const r=i[e.fontStack],o=r&&r[t];return o?o.metrics.advance*e.scale+n:0}}function $c(t,e,i,r){const n=Math.pow(t-e,2);return r?t<e?n/2:2*n:n+Math.abs(i)*i}function Zc(t,e,i){let r=0;return 10===t&&(r-=1e4),i&&(r+=150),40!==t&&65288!==t||(r+=50),41!==e&&65289!==e||(r+=50),r}function qc(t,e,i,r,n,o){let s=null,a=$c(e,i,n,o);for(const t of r){const r=$c(e-t.x,i,n,o)+t.badness;r<=a&&(s=t,a=r)}return{index:t,x:e,priorBreak:s,badness:a}}function Kc(t){return t?Kc(t.priorBreak).concat(t.index):[]}function Wc(t,e,i,r,n,o){if(!t)return[];const s=[],a=function(t,e,i,r,n,o){let s=0;for(let i=0;i<t.length();i++){const a=t.getSection(i);s+=Gc(t.getCharCode(i),a,r,n,e,o)}return s/Math.max(1,Math.ceil(s/i))}(t,e,i,r,n,o),l=t.text.indexOf("")>=0;let c=0;for(let i=0;i<t.length();i++){const h=t.getSection(i),d=t.getCharCode(i);if(Vc[d]||(c+=Gc(d,h,r,n,e,o)),i<t.length()-1){const e=!((u=d)<11904)&&(!!Sn["CJK Compatibility Forms"](u)||!!Sn["CJK Compatibility"](u)||!!Sn["CJK Strokes"](u)||!!Sn["CJK Symbols and Punctuation"](u)||!!Sn["Enclosed CJK Letters and Months"](u)||!!Sn["Halfwidth and Fullwidth Forms"](u)||!!Sn["Ideographic Description Characters"](u)||!!Sn["Vertical Forms"](u)||zn.test(String.fromCodePoint(u)));(jc[d]||e||h.imageName||i!==t.length()-2&&Hc[t.getCharCode(i+1)])&&s.push(qc(i+1,c,a,s,Zc(d,t.getCharCode(i+1),e&&l),!1))}}var u;return Kc(qc(t.length(),c,a,s,0,!0))}function Xc(t){let e=.5,i=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:e,verticalAlign:i}}function Jc(t,e,i,r,n){if(!r&&!n)return;const o=t[i],s=(t[i].x+o.metrics.advance*o.scale)*r;for(let r=e;r<=i;r++)t[r].x-=s,t[r].y+=n}function Yc(t,e,i){const{horizontalAlign:r,verticalAlign:n}=Xc(i),o=e[0]-t.displaySize[0]*r,s=e[1]-t.displaySize[1]*n;return{image:t,top:s,bottom:s+t.displaySize[1],left:o,right:o+t.displaySize[0]}}function tu(t){var e,i;let r=t.left,n=t.top,o=t.right-r,s=t.bottom-n;const a=null!==(e=t.image.textFitWidth)&&void 0!==e?e:"stretchOrShrink",l=null!==(i=t.image.textFitHeight)&&void 0!==i?i:"stretchOrShrink",c=(t.image.content[2]-t.image.content[0])/(t.image.content[3]-t.image.content[1]);if("proportional"===l){if("stretchOnly"===a&&o/s<c||"proportional"===a){const t=Math.ceil(s*c);r*=t/o,o=t}}else if("proportional"===a&&"stretchOnly"===l&&0!==c&&o/s>c){const t=Math.ceil(o/c);n*=t/s,s=t}return{x1:r,y1:n,x2:r+o,y2:n+s}}function eu(t,e,i,r,n,o){const s=t.image;let a;if(s.content){const t=s.content,e=s.pixelRatio||1;a=[t[0]/e,t[1]/e,s.displaySize[0]-t[2]/e,s.displaySize[1]-t[3]/e]}const l=e.left*o,c=e.right*o;let u,h,d,p;"width"===i||"both"===i?(p=n[0]+l-r[3],h=n[0]+c+r[1]):(p=n[0]+(l+c-s.displaySize[0])/2,h=p+s.displaySize[0]);const f=e.top*o,A=e.bottom*o;return"height"===i||"both"===i?(u=n[1]+f-r[0],d=n[1]+A+r[2]):(u=n[1]+(f+A-s.displaySize[1])/2,d=u+s.displaySize[1]),{image:s,top:u,right:h,bottom:d,left:p,collisionPadding:a}}const iu=255,ru=128,nu=iu*ru;function ou(t,e){const{expression:i}=e;if("constant"===i.kind)return{kind:"constant",layoutSize:i.evaluate(new Vn(t+1))};if("source"===i.kind)return{kind:"source"};{const{zoomStops:e,interpolationType:r}=i;let n=0;for(;n<e.length&&e[n]<=t;)n++;n=Math.max(0,n-1);let o=n;for(;o<e.length&&e[o]<t+1;)o++;o=Math.min(e.length-1,o);const s=e[n],a=e[o];return"composite"===i.kind?{kind:"composite",minZoom:s,maxZoom:a,interpolationType:r}:{kind:"camera",minZoom:s,maxZoom:a,minSize:i.evaluate(new Vn(s)),maxSize:i.evaluate(new Vn(a)),interpolationType:r}}}function su(t,e,i){let r="never";const n=t.get(e);return n?r=n:t.get(i)&&(r="always"),r}const au=pl.VectorTileFeature.types,lu=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function cu(t,e,i,r,n,o,s,a,l,c,u,h,d){const p=a?Math.min(nu,Math.round(a[0])):0,f=a?Math.min(nu,Math.round(a[1])):0;t.emplaceBack(e,i,Math.round(32*r),Math.round(32*n),o,s,(p<<1)+(l?1:0),f,16*c,16*u,256*h,256*d)}function uu(t,e,i){t.emplaceBack(e.x,e.y,i),t.emplaceBack(e.x,e.y,i),t.emplaceBack(e.x,e.y,i),t.emplaceBack(e.x,e.y,i)}function hu(t){for(const e of t.sections)if(Nn(e.text))return!0;return!1}class du{constructor(t){this.layoutVertexArray=new Yo,this.indexArray=new ns,this.programConfigurations=t,this.segments=new ls,this.dynamicLayoutVertexArray=new ts,this.opacityVertexArray=new es,this.hasVisibleVertices=!1,this.placedSymbolArray=new Ro}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(t,e,i,r){this.isEmpty()||(i&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Xl.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,e),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,Jl.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,lu,!0),this.opacityVertexBuffer.itemSize=1),(i||r)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}xn("SymbolBuffers",du);class pu{constructor(t,e,i){this.layoutVertexArray=new t,this.layoutAttributes=e,this.indexArray=new i,this.segments=new ls,this.collisionVertexArray=new rs}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,Yl.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}xn("CollisionBuffers",pu);class fu{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((t=>t.id)),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=ca([]),this.placementViewportMatrix=ca([]);const i=this.layers[0]._unevaluatedLayout._values;this.textSizeData=ou(this.zoom,i["text-size"]),this.iconSizeData=ou(this.zoom,i["icon-size"]);const r=this.layers[0].layout,n=r.get("symbol-sort-key"),o=r.get("symbol-z-order");this.canOverlap="never"!==su(r,"text-overlap","text-allow-overlap")||"never"!==su(r,"icon-overlap","icon-allow-overlap")||r.get("text-ignore-placement")||r.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==o&&!n.isConstant(),this.sortFeaturesByY=("viewport-y"===o||"auto"===o&&!this.sortFeaturesByKey)&&this.canOverlap,"point"===r.get("symbol-placement")&&(this.writingModes=r.get("text-writing-mode").map((e=>t.ah[e]))),this.stateDependentLayerIds=this.layers.filter((t=>t.isStateDependent())).map((t=>t.id)),this.sourceID=e.sourceID}createArrays(){this.text=new du(new zs(this.layers,this.zoom,(t=>/^text/.test(t)))),this.icon=new du(new zs(this.layers,this.zoom,(t=>/^icon/.test(t)))),this.glyphOffsetArray=new No,this.lineVertexArray=new Qo,this.symbolInstances=new Oo,this.textAnchorOffsets=new jo}calculateGlyphDependencies(t,e,i,r,n){for(let o=0;o<t.length;o++)if(e[t.charCodeAt(o)]=!0,(i||r)&&n){const i=rc[t.charAt(o)];i&&(e[i.charCodeAt(0)]=!0)}}populate(e,i,r){const n=this.layers[0],o=n.layout,s=o.get("text-font"),a=o.get("text-field"),l=o.get("icon-image"),c=("constant"!==a.value.kind||a.value.value instanceof Wt&&!a.value.value.isEmpty()||a.value.value.toString().length>0)&&("constant"!==s.value.kind||s.value.value.length>0),u="constant"!==l.value.kind||!!l.value.value||Object.keys(l.parameters).length>0,h=o.get("symbol-sort-key");if(this.features=[],!c&&!u)return;const d=i.iconDependencies,p=i.glyphDependencies,f=i.availableImages,A=new Vn(this.zoom);for(const{feature:i,id:a,index:l,sourceLayerIndex:m}of e){const e=n._featureFilter.needGeometry,g=Qs(i,e);if(!n._featureFilter.filter(A,g,r))continue;let _,y;if(e||(g.geometry=Ns(i)),c){const t=n.getValueAndResolveTokens("text-field",g,r,f),e=Wt.factory(t),i=this.hasRTLText=this.hasRTLText||hu(e);(!i||"unavailable"===Qn.getRTLTextPluginStatus()||i&&Qn.isParsed())&&(_=ic(e,n,g))}if(u){const t=n.getValueAndResolveTokens("icon-image",g,r,f);y=t instanceof te?t:te.fromString(t)}if(!_&&!y)continue;const v=this.sortFeaturesByKey?h.evaluate(g,{},r):void 0;if(this.features.push({id:a,text:_,icon:y,index:l,sourceLayerIndex:m,geometry:g.geometry,properties:i.properties,type:au[i.type],sortKey:v}),y&&(d[y.name]=!0),_){const e=s.evaluate(g,{},r).join(","),i="viewport"!==o.get("text-rotation-alignment")&&"point"!==o.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(t.ah.vertical)>=0;for(const t of _.sections)if(t.image)d[t.image.name]=!0;else{const r=In(_.toString()),n=t.fontStack||e,o=p[n]=p[n]||{};this.calculateGlyphDependencies(t.text,o,i,this.allowVerticalPlacement,r)}}}"line"===o.get("symbol-placement")&&(this.features=function(t){const e={},i={},r=[];let n=0;function o(e){r.push(t[e]),n++}function s(t,e,n){const o=i[t];return delete i[t],i[e]=o,r[o].geometry[0].pop(),r[o].geometry[0]=r[o].geometry[0].concat(n[0]),o}function a(t,i,n){const o=e[i];return delete e[i],e[t]=o,r[o].geometry[0].shift(),r[o].geometry[0]=n[0].concat(r[o].geometry[0]),o}function l(t,e,i){const r=i?e[0][e[0].length-1]:e[0][0];return`${t}:${r.x}:${r.y}`}for(let c=0;c<t.length;c++){const u=t[c],h=u.geometry,d=u.text?u.text.toString():null;if(!d){o(c);continue}const p=l(d,h),f=l(d,h,!0);if(p in i&&f in e&&i[p]!==e[f]){const t=a(p,f,h),n=s(p,f,r[t].geometry);delete e[p],delete i[f],i[l(d,r[n].geometry,!0)]=n,r[t].geometry=null}else p in i?s(p,f,h):f in e?a(p,f,h):(o(c),e[p]=n-1,i[f]=n-1)}return r.filter((t=>t.geometry))}(this.features)),this.sortFeaturesByKey&&this.features.sort(((t,e)=>t.sortKey-e.sortKey))}update(t,e,i){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,e,this.layers,i),this.icon.programConfigurations.updatePaintArrays(t,e,this.layers,i))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,e){const i=this.lineVertexArray.length;if(void 0!==t.segment){let i=t.dist(e[t.segment+1]),r=t.dist(e[t.segment]);const n={};for(let r=t.segment+1;r<e.length;r++)n[r]={x:e[r].x,y:e[r].y,tileUnitDistanceFromAnchor:i},r<e.length-1&&(i+=e[r+1].dist(e[r]));for(let i=t.segment||0;i>=0;i--)n[i]={x:e[i].x,y:e[i].y,tileUnitDistanceFromAnchor:r},i>0&&(r+=e[i-1].dist(e[i]));for(let t=0;t<e.length;t++){const e=n[t];this.lineVertexArray.emplaceBack(e.x,e.y,e.tileUnitDistanceFromAnchor)}}return{lineStartIndex:i,lineLength:this.lineVertexArray.length-i}}addSymbols(e,i,r,n,o,s,a,l,c,u,h,d){const p=e.indexArray,f=e.layoutVertexArray,A=e.segments.prepareSegment(4*i.length,f,p,this.canOverlap?s.sortKey:void 0),m=this.glyphOffsetArray.length,g=A.vertexLength,_=this.allowVerticalPlacement&&a===t.ah.vertical?Math.PI/2:0,y=s.text&&s.text.sections;for(let t=0;t<i.length;t++){const{tl:n,tr:o,bl:a,br:c,tex:u,pixelOffsetTL:h,pixelOffsetBR:m,minFontScaleX:g,minFontScaleY:v,glyphOffset:x,isSDF:b,sectionIndex:w}=i[t],T=A.vertexLength,B=x[1];cu(f,l.x,l.y,n.x,B+n.y,u.x,u.y,r,b,h.x,h.y,g,v),cu(f,l.x,l.y,o.x,B+o.y,u.x+u.w,u.y,r,b,m.x,h.y,g,v),cu(f,l.x,l.y,a.x,B+a.y,u.x,u.y+u.h,r,b,h.x,m.y,g,v),cu(f,l.x,l.y,c.x,B+c.y,u.x+u.w,u.y+u.h,r,b,m.x,m.y,g,v),uu(e.dynamicLayoutVertexArray,l,_),p.emplaceBack(T,T+1,T+2),p.emplaceBack(T+1,T+2,T+3),A.vertexLength+=4,A.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(x[0]),t!==i.length-1&&w===i[t+1].sectionIndex||e.programConfigurations.populatePaintArrays(f.length,s,s.index,{},d,y&&y[w])}e.placedSymbolArray.emplaceBack(l.x,l.y,m,this.glyphOffsetArray.length-m,g,c,u,l.segment,r?r[0]:0,r?r[1]:0,n[0],n[1],a,0,!1,0,h)}_addCollisionDebugVertex(t,e,i,r,n,o){return e.emplaceBack(0,0),t.emplaceBack(i.x,i.y,r,n,Math.round(o.x),Math.round(o.y))}addCollisionDebugVertices(t,e,i,r,n,s,a){const l=n.segments.prepareSegment(4,n.layoutVertexArray,n.indexArray),c=l.vertexLength,u=n.layoutVertexArray,h=n.collisionVertexArray,d=a.anchorX,p=a.anchorY;this._addCollisionDebugVertex(u,h,s,d,p,new o(t,e)),this._addCollisionDebugVertex(u,h,s,d,p,new o(i,e)),this._addCollisionDebugVertex(u,h,s,d,p,new o(i,r)),this._addCollisionDebugVertex(u,h,s,d,p,new o(t,r)),l.vertexLength+=4;const f=n.indexArray;f.emplaceBack(c,c+1),f.emplaceBack(c+1,c+2),f.emplaceBack(c+2,c+3),f.emplaceBack(c+3,c),l.primitiveLength+=4}addDebugCollisionBoxes(t,e,i,r){for(let n=t;n<e;n++){const t=this.collisionBoxArray.get(n);this.addCollisionDebugVertices(t.x1,t.y1,t.x2,t.y2,r?this.textCollisionBox:this.iconCollisionBox,t.anchorPoint,i)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new pu(is,tc.members,os),this.iconCollisionBox=new pu(is,tc.members,os);for(let t=0;t<this.symbolInstances.length;t++){const e=this.symbolInstances.get(t);this.addDebugCollisionBoxes(e.textBoxStartIndex,e.textBoxEndIndex,e,!0),this.addDebugCollisionBoxes(e.verticalTextBoxStartIndex,e.verticalTextBoxEndIndex,e,!0),this.addDebugCollisionBoxes(e.iconBoxStartIndex,e.iconBoxEndIndex,e,!1),this.addDebugCollisionBoxes(e.verticalIconBoxStartIndex,e.verticalIconBoxEndIndex,e,!1)}}_deserializeCollisionBoxesForSymbol(t,e,i,r,n,o,s,a,l){const c={};for(let r=e;r<i;r++){const e=t.get(r);c.textBox={x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2,anchorPointX:e.anchorPointX,anchorPointY:e.anchorPointY},c.textFeatureIndex=e.featureIndex;break}for(let e=r;e<n;e++){const i=t.get(e);c.verticalTextBox={x1:i.x1,y1:i.y1,x2:i.x2,y2:i.y2,anchorPointX:i.anchorPointX,anchorPointY:i.anchorPointY},c.verticalTextFeatureIndex=i.featureIndex;break}for(let e=o;e<s;e++){const i=t.get(e);c.iconBox={x1:i.x1,y1:i.y1,x2:i.x2,y2:i.y2,anchorPointX:i.anchorPointX,anchorPointY:i.anchorPointY},c.iconFeatureIndex=i.featureIndex;break}for(let e=a;e<l;e++){const i=t.get(e);c.verticalIconBox={x1:i.x1,y1:i.y1,x2:i.x2,y2:i.y2,anchorPointX:i.anchorPointX,anchorPointY:i.anchorPointY},c.verticalIconFeatureIndex=i.featureIndex;break}return c}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let e=0;e<this.symbolInstances.length;e++){const i=this.symbolInstances.get(e);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,i.textBoxStartIndex,i.textBoxEndIndex,i.verticalTextBoxStartIndex,i.verticalTextBoxEndIndex,i.iconBoxStartIndex,i.iconBoxEndIndex,i.verticalIconBoxStartIndex,i.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,e){const i=t.placedSymbolArray.get(e),r=i.vertexStartIndex+4*i.numGlyphs;for(let e=i.vertexStartIndex;e<r;e+=4)t.indexArray.emplaceBack(e,e+1,e+2),t.indexArray.emplaceBack(e+1,e+2,e+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const e=Math.sin(t),i=Math.cos(t),r=[],n=[],o=[];for(let t=0;t<this.symbolInstances.length;++t){o.push(t);const s=this.symbolInstances.get(t);r.push(0|Math.round(e*s.anchorX+i*s.anchorY)),n.push(s.featureIndex)}return o.sort(((t,e)=>r[t]-r[e]||n[e]-n[t])),o}addToSortKeyRanges(t,e){const i=this.sortKeyRanges[this.sortKeyRanges.length-1];i&&i.sortKey===e?i.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:e,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const t of this.symbolInstanceIndexes){const e=this.symbolInstances.get(t);this.featureSortOrder.push(e.featureIndex),[e.rightJustifiedTextSymbolIndex,e.centerJustifiedTextSymbolIndex,e.leftJustifiedTextSymbolIndex].forEach(((t,e,i)=>{t>=0&&i.indexOf(t)===e&&this.addIndicesForPlacedSymbol(this.text,t)})),e.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,e.verticalPlacedTextSymbolIndex),e.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,e.placedIconSymbolIndex),e.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,e.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let Au,mu;xn("SymbolBucket",fu,{omit:["layers","collisionBoxArray","features","compareText"]}),fu.MAX_GLYPHS=65535,fu.addDynamicAttributes=uu;var gu={get paint(){return mu=mu||new io({"icon-opacity":new Jn($.paint_symbol["icon-opacity"]),"icon-color":new Jn($.paint_symbol["icon-color"]),"icon-halo-color":new Jn($.paint_symbol["icon-halo-color"]),"icon-halo-width":new Jn($.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Jn($.paint_symbol["icon-halo-blur"]),"icon-translate":new Xn($.paint_symbol["icon-translate"]),"icon-translate-anchor":new Xn($.paint_symbol["icon-translate-anchor"]),"text-opacity":new Jn($.paint_symbol["text-opacity"]),"text-color":new Jn($.paint_symbol["text-color"],{runtimeType:dt,getOverride:t=>t.textColor,hasOverride:t=>!!t.textColor}),"text-halo-color":new Jn($.paint_symbol["text-halo-color"]),"text-halo-width":new Jn($.paint_symbol["text-halo-width"]),"text-halo-blur":new Jn($.paint_symbol["text-halo-blur"]),"text-translate":new Xn($.paint_symbol["text-translate"]),"text-translate-anchor":new Xn($.paint_symbol["text-translate-anchor"])})},get layout(){return Au=Au||new io({"symbol-placement":new Xn($.layout_symbol["symbol-placement"]),"symbol-spacing":new Xn($.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Xn($.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Jn($.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Xn($.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Xn($.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Xn($.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Xn($.layout_symbol["icon-ignore-placement"]),"icon-optional":new Xn($.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Xn($.layout_symbol["icon-rotation-alignment"]),"icon-size":new Jn($.layout_symbol["icon-size"]),"icon-text-fit":new Xn($.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Xn($.layout_symbol["icon-text-fit-padding"]),"icon-image":new Jn($.layout_symbol["icon-image"]),"icon-rotate":new Jn($.layout_symbol["icon-rotate"]),"icon-padding":new Jn($.layout_symbol["icon-padding"]),"icon-keep-upright":new Xn($.layout_symbol["icon-keep-upright"]),"icon-offset":new Jn($.layout_symbol["icon-offset"]),"icon-anchor":new Jn($.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Xn($.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Xn($.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Xn($.layout_symbol["text-rotation-alignment"]),"text-field":new Jn($.layout_symbol["text-field"]),"text-font":new Jn($.layout_symbol["text-font"]),"text-size":new Jn($.layout_symbol["text-size"]),"text-max-width":new Jn($.layout_symbol["text-max-width"]),"text-line-height":new Xn($.layout_symbol["text-line-height"]),"text-letter-spacing":new Jn($.layout_symbol["text-letter-spacing"]),"text-justify":new Jn($.layout_symbol["text-justify"]),"text-radial-offset":new Jn($.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Xn($.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Jn($.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Jn($.layout_symbol["text-anchor"]),"text-max-angle":new Xn($.layout_symbol["text-max-angle"]),"text-writing-mode":new Xn($.layout_symbol["text-writing-mode"]),"text-rotate":new Jn($.layout_symbol["text-rotate"]),"text-padding":new Xn($.layout_symbol["text-padding"]),"text-keep-upright":new Xn($.layout_symbol["text-keep-upright"]),"text-transform":new Jn($.layout_symbol["text-transform"]),"text-offset":new Jn($.layout_symbol["text-offset"]),"text-allow-overlap":new Xn($.layout_symbol["text-allow-overlap"]),"text-overlap":new Xn($.layout_symbol["text-overlap"]),"text-ignore-placement":new Xn($.layout_symbol["text-ignore-placement"]),"text-optional":new Xn($.layout_symbol["text-optional"])})}};class _u{constructor(t){if(void 0===t.property.overrides)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=t.property.overrides?t.property.overrides.runtimeType:lt,this.defaultValue=t}evaluate(t){if(t.formattedSection){const e=this.defaultValue.property.overrides;if(e&&e.hasOverride(t.formattedSection))return e.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}xn("FormatSectionOverride",_u,{omit:["defaultValue"]});class yu extends no{constructor(t){super(t,gu)}recalculate(t,e){if(super.recalculate(t,e),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]="map"===this.layout.get("text-rotation-alignment")?"map":"viewport"),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),"point"===this.layout.get("symbol-placement")){const t=this.layout.get("text-writing-mode");if(t){const e=[];for(const i of t)e.indexOf(i)<0&&e.push(i);this.layout._values["text-writing-mode"]=e}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(t,e,i,r){const n=this.layout.get(t).evaluate(e,{},i,r),o=this._unevaluatedLayout._values[t];return o.isDataDriven()||_r(o.value)||!n?n:function(t,e){return e.replace(/{([^{}]+)}/g,((e,i)=>t&&i in t?String(t[i]):""))}(e.properties,n)}createBucket(t){return new fu(t)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const t of gu.paint.overridableProperties){if(!yu.hasPaintOverride(this.layout,t))continue;const e=this.paint.get(t),i=new _u(e),r=new gr(i,e.property.specification);let n=null;n="constant"===e.value.kind||"source"===e.value.kind?new vr("source",r):new xr("composite",r,e.value.zoomStops),this.paint._values[t]=new Kn(e.property,n,e.parameters)}}_handleOverridablePaintPropertyUpdate(t,e,i){return!(!this.layout||e.isDataDriven()||i.isDataDriven())&&yu.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,e){const i=t.get("text-field"),r=gu.paint.properties[e];let n=!1;const o=t=>{for(const e of t)if(r.overrides&&r.overrides.hasOverride(e))return void(n=!0)};if("constant"===i.value.kind&&i.value.value instanceof Wt)o(i.value.value.sections);else if("source"===i.value.kind){const t=e=>{n||(e instanceof oe&&re(e.value)===mt?o(e.value.sections):e instanceof Ge?o(e.sections):e.eachChild(t))},e=i.value;e._styleExpression&&t(e._styleExpression.expression)}return n}}let vu;var xu={get paint(){return vu=vu||new io({"background-color":new Xn($.paint_background["background-color"]),"background-pattern":new to($.paint_background["background-pattern"]),"background-opacity":new Xn($.paint_background["background-opacity"])})}};class bu extends no{constructor(t){super(t,xu)}}let wu;var Tu={get paint(){return wu=wu||new io({"raster-opacity":new Xn($.paint_raster["raster-opacity"]),"raster-hue-rotate":new Xn($.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Xn($.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Xn($.paint_raster["raster-brightness-max"]),"raster-saturation":new Xn($.paint_raster["raster-saturation"]),"raster-contrast":new Xn($.paint_raster["raster-contrast"]),"raster-resampling":new Xn($.paint_raster["raster-resampling"]),"raster-fade-duration":new Xn($.paint_raster["raster-fade-duration"])})}};class Bu extends no{constructor(t){super(t,Tu)}}class Eu extends no{constructor(t){super(t,{}),this.onAdd=t=>{this.implementation.onAdd&&this.implementation.onAdd(t,t.painter.context.gl)},this.onRemove=t=>{this.implementation.onRemove&&this.implementation.onRemove(t,t.painter.context.gl)},this.implementation=t}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class Cu{constructor(t){this._methodToThrottle=t,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._methodToThrottle()}),0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const Su=6371008.8;class Iu{constructor(t,e){if(isNaN(t)||isNaN(e))throw new Error(`Invalid LngLat object: (${t}, ${e})`);if(this.lng=+t,this.lat=+e,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Iu(m(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const e=Math.PI/180,i=this.lat*e,r=t.lat*e,n=Math.sin(i)*Math.sin(r)+Math.cos(i)*Math.cos(r)*Math.cos((t.lng-this.lng)*e);return Su*Math.acos(Math.min(n,1))}static convert(t){if(t instanceof Iu)return t;if(Array.isArray(t)&&(2===t.length||3===t.length))return new Iu(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&"object"==typeof t&&null!==t)return new Iu(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Mu=2*Math.PI*Su;function ku(t){return Mu*Math.cos(t*Math.PI/180)}function Pu(t){return(180+t)/360}function Lu(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function zu(t,e){return t/ku(e)}function Fu(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}class Du{constructor(t,e,i=0){this.x=+t,this.y=+e,this.z=+i}static fromLngLat(t,e=0){const i=Iu.convert(t);return new Du(Pu(i.lng),Lu(i.lat),zu(e,i.lat))}toLngLat(){return new Iu(360*this.x-180,Fu(this.y))}toAltitude(){return this.z*ku(Fu(this.y))}meterInMercatorCoordinateUnits(){return 1/Mu*(t=Fu(this.y),1/Math.cos(t*Math.PI/180));var t}}function Ru(t,e,i){var r=2*Math.PI*6378137/256/Math.pow(2,i);return[t*r-2*Math.PI*6378137/2,e*r-2*Math.PI*6378137/2]}class Uu{constructor(t,e,i){if(!function(t,e,i){return!(t<0||t>25||i<0||i>=Math.pow(2,t)||e<0||e>=Math.pow(2,t))}(t,e,i))throw new Error(`x=${e}, y=${i}, z=${t} outside of bounds. 0<=x<${Math.pow(2,t)}, 0<=y<${Math.pow(2,t)} 0<=z<=25 `);this.z=t,this.x=e,this.y=i,this.key=Qu(0,t,t,e,i)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,e,i){const r=(o=this.y,s=this.z,a=Ru(256*(n=this.x),256*(o=Math.pow(2,s)-o-1),s),l=Ru(256*(n+1),256*(o+1),s),a[0]+","+a[1]+","+l[0]+","+l[1]);var n,o,s,a,l;const c=function(t,e,i){let r,n="";for(let o=t;o>0;o--)r=1<<o-1,n+=(e&r?1:0)+(i&r?2:0);return n}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===i?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,e>1?"@2x":"").replace(/{quadkey}/g,c).replace(/{bbox-epsg-3857}/g,r)}isChildOf(t){const e=this.z-t.z;return e>0&&t.x===this.x>>e&&t.y===this.y>>e}getTilePoint(t){const e=Math.pow(2,this.z);return new o((t.x*e-this.x)*Rs,(t.y*e-this.y)*Rs)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Ou{constructor(t,e){this.wrap=t,this.canonical=e,this.key=Qu(t,e.z,e.z,e.x,e.y)}}class Nu{constructor(t,e,i,r,n){if(t<i)throw new Error(`overscaledZ should be >= z; overscaledZ = ${t}; z = ${i}`);this.overscaledZ=t,this.wrap=e,this.canonical=new Uu(i,+r,+n),this.key=Qu(e,t,i,r,n)}clone(){return new Nu(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const e=this.canonical.z-t;return t>this.canonical.z?new Nu(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Nu(t,this.wrap,t,this.canonical.x>>e,this.canonical.y>>e)}calculateScaledKey(t,e){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const i=this.canonical.z-t;return t>this.canonical.z?Qu(this.wrap*+e,t,this.canonical.z,this.canonical.x,this.canonical.y):Qu(this.wrap*+e,t,t,this.canonical.x>>i,this.canonical.y>>i)}isChildOf(t){if(t.wrap!==this.wrap)return!1;const e=this.canonical.z-t.canonical.z;return 0===t.overscaledZ||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>e&&t.canonical.y===this.canonical.y>>e}children(t){if(this.overscaledZ>=t)return[new Nu(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const e=this.canonical.z+1,i=2*this.canonical.x,r=2*this.canonical.y;return[new Nu(e,this.wrap,e,i,r),new Nu(e,this.wrap,e,i+1,r),new Nu(e,this.wrap,e,i,r+1),new Nu(e,this.wrap,e,i+1,r+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new Nu(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new Nu(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Ou(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(t){return this.canonical.getTilePoint(new Du(t.x-this.wrap,t.y))}}function Qu(t,e,i,r,n){(t*=2)<0&&(t=-1*t-1);const o=1<<i;return(o*o*t+o*n+r).toString(36)+i.toString(36)+e.toString(36)}xn("CanonicalTileID",Uu),xn("OverscaledTileID",Nu,{omit:["posMatrix"]});class Vu{constructor(t,e,i,r=1,n=1,o=1,s=0){if(this.uid=t,e.height!==e.width)throw new RangeError("DEM tiles must be square");if(i&&!["mapbox","terrarium","custom"].includes(i))return void w(`"${i}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=e.height;const a=this.dim=e.height-2;switch(this.data=new Uint32Array(e.data.buffer),i){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=r,this.greenFactor=n,this.blueFactor=o,this.baseShift=s;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let t=0;t<a;t++)this.data[this._idx(-1,t)]=this.data[this._idx(0,t)],this.data[this._idx(a,t)]=this.data[this._idx(a-1,t)],this.data[this._idx(t,-1)]=this.data[this._idx(t,0)],this.data[this._idx(t,a)]=this.data[this._idx(t,a-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(a,-1)]=this.data[this._idx(a-1,0)],this.data[this._idx(-1,a)]=this.data[this._idx(0,a-1)],this.data[this._idx(a,a)]=this.data[this._idx(a-1,a-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let t=0;t<a;t++)for(let e=0;e<a;e++){const i=this.get(t,e);i>this.max&&(this.max=i),i<this.min&&(this.min=i)}}get(t,e){const i=new Uint8Array(this.data.buffer),r=4*this._idx(t,e);return this.unpack(i[r],i[r+1],i[r+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(t,e){if(t<-1||t>=this.dim+1||e<-1||e>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(e+1)*this.stride+(t+1)}unpack(t,e,i){return t*this.redFactor+e*this.greenFactor+i*this.blueFactor-this.baseShift}getPixels(){return new wa({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(t,e,i){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let r=e*this.dim,n=e*this.dim+this.dim,o=i*this.dim,s=i*this.dim+this.dim;switch(e){case-1:r=n-1;break;case 1:n=r+1}switch(i){case-1:o=s-1;break;case 1:s=o+1}const a=-e*this.dim,l=-i*this.dim;for(let e=o;e<s;e++)for(let i=r;i<n;i++)this.data[this._idx(i,e)]=t.data[this._idx(i+a,e+l)]}}xn("DEMData",Vu);class ju{constructor(t){this._stringToNumber={},this._numberToString=[];for(let e=0;e<t.length;e++){const i=t[e];this._stringToNumber[i]=e,this._numberToString[e]=i}}encode(t){return this._stringToNumber[t]}decode(t){if(t>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${t} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[t]}}class Hu{constructor(t,e,i,r,n){this.type="Feature",this._vectorTileFeature=t,t._z=e,t._x=i,t._y=r,this.properties=t.properties,this.id=n}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={geometry:this.geometry};for(const e in this)"_geometry"!==e&&"_vectorTileFeature"!==e&&(t[e]=this[e]);return t}}class Gu{constructor(t,e){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new yn(Rs,16,0),this.grid3D=new yn(Rs,16,0),this.featureIndexArray=new Go,this.promoteId=e}insert(t,e,i,r,n,o){const s=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(i,r,n);const a=o?this.grid3D:this.grid;for(let t=0;t<e.length;t++){const i=e[t],r=[1/0,1/0,-1/0,-1/0];for(let t=0;t<i.length;t++){const e=i[t];r[0]=Math.min(r[0],e.x),r[1]=Math.min(r[1],e.y),r[2]=Math.max(r[2],e.x),r[3]=Math.max(r[3],e.y)}r[0]<Rs&&r[1]<Rs&&r[2]>=0&&r[3]>=0&&a.insert(s,r[0],r[1],r[2],r[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new pl.VectorTile(new Cc(this.rawTileData)).layers,this.sourceLayerCoder=new ju(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(t,e,i,r){this.loadVTLayers();const n=t.params||{},s=Rs/t.tileSize/t.scale,a=Cr(n.filter),l=t.queryGeometry,c=t.queryPadding*s,u=Zu(l),h=this.grid.query(u.minX-c,u.minY-c,u.maxX+c,u.maxY+c),d=Zu(t.cameraQueryGeometry),p=this.grid3D.query(d.minX-c,d.minY-c,d.maxX+c,d.maxY+c,((e,i,r,n)=>function(t,e,i,r,n){for(const o of t)if(e<=o.x&&i<=o.y&&r>=o.x&&n>=o.y)return!0;const s=[new o(e,i),new o(e,n),new o(r,n),new o(r,i)];if(t.length>2)for(const e of s)if(Ys(t,e))return!0;for(let e=0;e<t.length-1;e++)if(ta(t[e],t[e+1],s))return!0;return!1}(t.cameraQueryGeometry,e-c,i-c,r+c,n+c)));for(const t of p)h.push(t);h.sort(qu);const f={};let A;for(let o=0;o<h.length;o++){const c=h[o];if(c===A)continue;A=c;const u=this.featureIndexArray.get(c);let d=null;this.loadMatchingFeature(f,u.bucketIndex,u.sourceLayerIndex,u.featureIndex,a,n.layers,n.availableImages,e,i,r,((e,i,r)=>(d||(d=Ns(e)),i.queryIntersectsFeature(l,e,r,d,this.z,t.transform,s,t.pixelPosMatrix))))}return f}loadMatchingFeature(t,e,i,r,n,o,s,a,l,c,u){const h=this.bucketLayerIDs[e];if(o&&!function(t,e){for(let i=0;i<t.length;i++)if(e.indexOf(t[i])>=0)return!0;return!1}(o,h))return;const d=this.sourceLayerCoder.decode(i),p=this.vtLayers[d].feature(r);if(n.needGeometry){const t=Qs(p,!0);if(!n.filter(new Vn(this.tileID.overscaledZ),t,this.tileID.canonical))return}else if(!n.filter(new Vn(this.tileID.overscaledZ),p))return;const f=this.getId(p,d);for(let e=0;e<h.length;e++){const i=h[e];if(o&&o.indexOf(i)<0)continue;const n=a[i];if(!n)continue;let d={};f&&c&&(d=c.getState(n.sourceLayer||"_geojsonTileLayer",f));const A=g({},l[i]);A.paint=$u(A.paint,n.paint,p,d,s),A.layout=$u(A.layout,n.layout,p,d,s);const m=!u||u(p,n,d);if(!m)continue;const _=new Hu(p,this.z,this.x,this.y,f);_.layer=A;let y=t[i];void 0===y&&(y=t[i]=[]),y.push({featureIndex:r,feature:_,intersectionZ:m})}}lookupSymbolFeatures(t,e,i,r,n,o,s,a){const l={};this.loadVTLayers();const c=Cr(n);for(const n of t)this.loadMatchingFeature(l,i,r,n,c,o,s,a,e);return l}hasLayer(t){for(const e of this.bucketLayerIDs)for(const i of e)if(t===i)return!0;return!1}getId(t,e){let i=t.id;return this.promoteId&&(i=t.properties["string"==typeof this.promoteId?this.promoteId:this.promoteId[e]],"boolean"==typeof i&&(i=Number(i))),i}}function $u(t,e,i,r,n){return y(t,((t,o)=>{const s=e instanceof Wn?e.get(o):null;return s&&s.evaluate?s.evaluate(i,r,n):s}))}function Zu(t){let e=1/0,i=1/0,r=-1/0,n=-1/0;for(const o of t)e=Math.min(e,o.x),i=Math.min(i,o.y),r=Math.max(r,o.x),n=Math.max(n,o.y);return{minX:e,minY:i,maxX:r,maxY:n}}function qu(t,e){return e-t}function Ku(t,e,i,r,n){const s=[];for(let a=0;a<t.length;a++){const l=t[a];let c;for(let t=0;t<l.length-1;t++){let a=l[t],u=l[t+1];a.x<e&&u.x<e||(a.x<e?a=new o(e,a.y+(e-a.x)/(u.x-a.x)*(u.y-a.y))._round():u.x<e&&(u=new o(e,a.y+(e-a.x)/(u.x-a.x)*(u.y-a.y))._round()),a.y<i&&u.y<i||(a.y<i?a=new o(a.x+(i-a.y)/(u.y-a.y)*(u.x-a.x),i)._round():u.y<i&&(u=new o(a.x+(i-a.y)/(u.y-a.y)*(u.x-a.x),i)._round()),a.x>=r&&u.x>=r||(a.x>=r?a=new o(r,a.y+(r-a.x)/(u.x-a.x)*(u.y-a.y))._round():u.x>=r&&(u=new o(r,a.y+(r-a.x)/(u.x-a.x)*(u.y-a.y))._round()),a.y>=n&&u.y>=n||(a.y>=n?a=new o(a.x+(n-a.y)/(u.y-a.y)*(u.x-a.x),n)._round():u.y>=n&&(u=new o(a.x+(n-a.y)/(u.y-a.y)*(u.x-a.x),n)._round()),c&&a.equals(c[c.length-1])||(c=[a],s.push(c)),c.push(u)))))}}return s}xn("FeatureIndex",Gu,{omit:["rawTileData","sourceLayerCoder"]});class Wu extends o{constructor(t,e,i,r){super(t,e),this.angle=i,void 0!==r&&(this.segment=r)}clone(){return new Wu(this.x,this.y,this.angle,this.segment)}}function Xu(t,e,i,r,n){if(void 0===e.segment||0===i)return!0;let o=e,s=e.segment+1,a=0;for(;a>-i/2;){if(s--,s<0)return!1;a-=t[s].dist(o),o=t[s]}a+=t[s].dist(t[s+1]),s++;const l=[];let c=0;for(;a<i/2;){const e=t[s],i=t[s+1];if(!i)return!1;let o=t[s-1].angleTo(e)-e.angleTo(i);for(o=Math.abs((o+3*Math.PI)%(2*Math.PI)-Math.PI),l.push({distance:a,angleDelta:o}),c+=o;a-l[0].distance>r;)c-=l.shift().angleDelta;if(c>n)return!1;s++,a+=e.dist(i)}return!0}function Ju(t){let e=0;for(let i=0;i<t.length-1;i++)e+=t[i].dist(t[i+1]);return e}function Yu(t,e,i){return t?.6*e*i:0}function th(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function eh(t,e,i,r,n,o){const s=Yu(i,n,o),a=th(i,r)*o;let l=0;const c=Ju(t)/2;for(let i=0;i<t.length-1;i++){const r=t[i],n=t[i+1],o=r.dist(n);if(l+o>c){const u=(c-l)/o,h=Me.number(r.x,n.x,u),d=Me.number(r.y,n.y,u),p=new Wu(h,d,n.angleTo(r),i);return p._round(),!s||Xu(t,p,a,s,e)?p:void 0}l+=o}}function ih(t,e,i,r,n,o,s,a,l){const c=Yu(r,o,s),u=th(r,n),h=u*s,d=0===t[0].x||t[0].x===l||0===t[0].y||t[0].y===l;return e-h<e/4&&(e=h+e/4),rh(t,d?e/2*a%e:(u/2+2*o)*s*a%e,e,c,i,h,d,!1,l)}function rh(t,e,i,r,n,o,s,a,l){const c=o/2,u=Ju(t);let h=0,d=e-i,p=[];for(let e=0;e<t.length-1;e++){const s=t[e],a=t[e+1],f=s.dist(a),A=a.angleTo(s);for(;d+i<h+f;){d+=i;const m=(d-h)/f,g=Me.number(s.x,a.x,m),_=Me.number(s.y,a.y,m);if(g>=0&&g<l&&_>=0&&_<l&&d-c>=0&&d+c<=u){const i=new Wu(g,_,A,e);i._round(),r&&!Xu(t,i,o,r,n)||p.push(i)}}h+=f}return a||p.length||s||(p=rh(t,h/2,i,r,n,o,s,!0,l)),p}xn("Anchor",Wu);const nh=zc;function oh(t,e,i,r){const n=[],s=t.image,a=s.pixelRatio,l=s.paddedRect.w-2*nh,c=s.paddedRect.h-2*nh;let u={x1:t.left,y1:t.top,x2:t.right,y2:t.bottom};const h=s.stretchX||[[0,l]],d=s.stretchY||[[0,c]],p=(t,e)=>t+e[1]-e[0],f=h.reduce(p,0),A=d.reduce(p,0),m=l-f,g=c-A;let _=0,y=f,v=0,x=A,b=0,w=m,T=0,B=g;if(s.content&&r){const e=s.content,i=e[2]-e[0],r=e[3]-e[1];(s.textFitWidth||s.textFitHeight)&&(u=tu(t)),_=sh(h,0,e[0]),v=sh(d,0,e[1]),y=sh(h,e[0],e[2]),x=sh(d,e[1],e[3]),b=e[0]-_,T=e[1]-v,w=i-y,B=r-x}const E=u.x1,C=u.y1,S=u.x2-E,I=u.y2-C,M=(t,r,n,l)=>{const c=lh(t.stretch-_,y,S,E),u=ch(t.fixed-b,w,t.stretch,f),h=lh(r.stretch-v,x,I,C),d=ch(r.fixed-T,B,r.stretch,A),p=lh(n.stretch-_,y,S,E),m=ch(n.fixed-b,w,n.stretch,f),g=lh(l.stretch-v,x,I,C),M=ch(l.fixed-T,B,l.stretch,A),k=new o(c,h),P=new o(p,h),L=new o(p,g),z=new o(c,g),F=new o(u/a,d/a),D=new o(m/a,M/a),R=e*Math.PI/180;if(R){const t=Math.sin(R),e=Math.cos(R),i=[e,-t,t,e];k._matMult(i),P._matMult(i),z._matMult(i),L._matMult(i)}const U=t.stretch+t.fixed,O=r.stretch+r.fixed;return{tl:k,tr:P,bl:z,br:L,tex:{x:s.paddedRect.x+nh+U,y:s.paddedRect.y+nh+O,w:n.stretch+n.fixed-U,h:l.stretch+l.fixed-O},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:F,pixelOffsetBR:D,minFontScaleX:w/a/S,minFontScaleY:B/a/I,isSDF:i}};if(r&&(s.stretchX||s.stretchY)){const t=ah(h,m,f),e=ah(d,g,A);for(let i=0;i<t.length-1;i++){const r=t[i],o=t[i+1];for(let t=0;t<e.length-1;t++)n.push(M(r,e[t],o,e[t+1]))}}else n.push(M({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:l+1},{fixed:0,stretch:c+1}));return n}function sh(t,e,i){let r=0;for(const n of t)r+=Math.max(e,Math.min(i,n[1]))-Math.max(e,Math.min(i,n[0]));return r}function ah(t,e,i){const r=[{fixed:-nh,stretch:0}];for(const[e,i]of t){const t=r[r.length-1];r.push({fixed:e-t.stretch,stretch:t.stretch}),r.push({fixed:e-t.stretch,stretch:t.stretch+(i-e)})}return r.push({fixed:e+nh,stretch:i}),r}function lh(t,e,i,r){return t/e*i+r}function ch(t,e,i,r){return t-e*i/r}class uh{constructor(t,e,i,r,n,s,a,l,c,u){var h;if(this.boxStartIndex=t.length,c){let t=s.top,e=s.bottom;const i=s.collisionPadding;i&&(t-=i[1],e+=i[3]);let r=e-t;r>0&&(r=Math.max(10,r),this.circleDiameter=r)}else{const c=(null===(h=s.image)||void 0===h?void 0:h.content)&&(s.image.textFitWidth||s.image.textFitHeight)?tu(s):{x1:s.left,y1:s.top,x2:s.right,y2:s.bottom};c.y1=c.y1*a-l[0],c.y2=c.y2*a+l[2],c.x1=c.x1*a-l[3],c.x2=c.x2*a+l[1];const d=s.collisionPadding;if(d&&(c.x1-=d[0]*a,c.y1-=d[1]*a,c.x2+=d[2]*a,c.y2+=d[3]*a),u){const t=new o(c.x1,c.y1),e=new o(c.x2,c.y1),i=new o(c.x1,c.y2),r=new o(c.x2,c.y2),n=u*Math.PI/180;t._rotate(n),e._rotate(n),i._rotate(n),r._rotate(n),c.x1=Math.min(t.x,e.x,i.x,r.x),c.x2=Math.max(t.x,e.x,i.x,r.x),c.y1=Math.min(t.y,e.y,i.y,r.y),c.y2=Math.max(t.y,e.y,i.y,r.y)}t.emplaceBack(e.x,e.y,c.x1,c.y1,c.x2,c.y2,i,r,n)}this.boxEndIndex=t.length}}class hh{constructor(t=[],e=((t,e)=>t<e?-1:t>e?1:0)){if(this.data=t,this.length=this.data.length,this.compare=e,this.length>0)for(let t=(this.length>>1)-1;t>=0;t--)this._down(t)}push(t){this.data.push(t),this._up(this.length++)}pop(){if(0===this.length)return;const t=this.data[0],e=this.data.pop();return--this.length>0&&(this.data[0]=e,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:e,compare:i}=this,r=e[t];for(;t>0;){const n=t-1>>1,o=e[n];if(i(r,o)>=0)break;e[t]=o,t=n}e[t]=r}_down(t){const{data:e,compare:i}=this,r=this.length>>1,n=e[t];for(;t<r;){let r=1+(t<<1);const o=r+1;if(o<this.length&&i(e[o],e[r])<0&&(r=o),i(e[r],n)>=0)break;e[t]=e[r],t=r}e[t]=n}}function dh(t,e=1,i=!1){let r=1/0,n=1/0,s=-1/0,a=-1/0;const l=t[0];for(let t=0;t<l.length;t++){const e=l[t];(!t||e.x<r)&&(r=e.x),(!t||e.y<n)&&(n=e.y),(!t||e.x>s)&&(s=e.x),(!t||e.y>a)&&(a=e.y)}const c=Math.min(s-r,a-n);let u=c/2;const h=new hh([],ph);if(0===c)return new o(r,n);for(let e=r;e<s;e+=c)for(let i=n;i<a;i+=c)h.push(new fh(e+u,i+u,u,t));let d=function(t){let e=0,i=0,r=0;const n=t[0];for(let t=0,o=n.length,s=o-1;t<o;s=t++){const o=n[t],a=n[s],l=o.x*a.y-a.x*o.y;i+=(o.x+a.x)*l,r+=(o.y+a.y)*l,e+=3*l}return new fh(i/e,r/e,0,t)}(t),p=h.length;for(;h.length;){const r=h.pop();(r.d>d.d||!d.d)&&(d=r,i&&console.log("found best %d after %d probes",Math.round(1e4*r.d)/1e4,p)),r.max-d.d<=e||(u=r.h/2,h.push(new fh(r.p.x-u,r.p.y-u,u,t)),h.push(new fh(r.p.x+u,r.p.y-u,u,t)),h.push(new fh(r.p.x-u,r.p.y+u,u,t)),h.push(new fh(r.p.x+u,r.p.y+u,u,t)),p+=4)}return i&&(console.log(`num probes: ${p}`),console.log(`best distance: ${d.d}`)),d.p}function ph(t,e){return e.max-t.max}function fh(t,e,i,r){this.p=new o(t,e),this.h=i,this.d=function(t,e){let i=!1,r=1/0;for(let n=0;n<e.length;n++){const o=e[n];for(let e=0,n=o.length,s=n-1;e<n;s=e++){const n=o[e],a=o[s];n.y>t.y!=a.y>t.y&&t.x<(a.x-n.x)*(t.y-n.y)/(a.y-n.y)+n.x&&(i=!i),r=Math.min(r,Xs(t,n,a))}}return(i?1:-1)*Math.sqrt(r)}(this.p,r),this.max=this.d+this.h*Math.SQRT2}var Ah;t.aq=void 0,(Ah=t.aq||(t.aq={}))[Ah.center=1]="center",Ah[Ah.left=2]="left",Ah[Ah.right=3]="right",Ah[Ah.top=4]="top",Ah[Ah.bottom=5]="bottom",Ah[Ah["top-left"]=6]="top-left",Ah[Ah["top-right"]=7]="top-right",Ah[Ah["bottom-left"]=8]="bottom-left",Ah[Ah["bottom-right"]=9]="bottom-right";const mh=7,gh=Number.POSITIVE_INFINITY;function _h(t,e){return e[1]!==gh?function(t,e,i){let r=0,n=0;switch(e=Math.abs(e),i=Math.abs(i),t){case"top-right":case"top-left":case"top":n=i-mh;break;case"bottom-right":case"bottom-left":case"bottom":n=-i+mh}switch(t){case"top-right":case"bottom-right":case"right":r=-e;break;case"top-left":case"bottom-left":case"left":r=e}return[r,n]}(t,e[0],e[1]):function(t,e){let i=0,r=0;e<0&&(e=0);const n=e/Math.SQRT2;switch(t){case"top-right":case"top-left":r=n-mh;break;case"bottom-right":case"bottom-left":r=-n+mh;break;case"bottom":r=-e+mh;break;case"top":r=e-mh}switch(t){case"top-right":case"bottom-right":i=-n;break;case"top-left":case"bottom-left":i=n;break;case"left":i=e;break;case"right":i=-e}return[i,r]}(t,e[0])}function yh(t,e,i){var r;const n=t.layout,o=null===(r=n.get("text-variable-anchor-offset"))||void 0===r?void 0:r.evaluate(e,{},i);if(o){const t=o.values,e=[];for(let i=0;i<t.length;i+=2){const r=e[i]=t[i],n=t[i+1].map((t=>t*nc));r.startsWith("top")?n[1]-=mh:r.startsWith("bottom")&&(n[1]+=mh),e[i+1]=n}return new Yt(e)}const s=n.get("text-variable-anchor");if(s){let r;r=void 0!==t._unevaluatedLayout.getValue("text-radial-offset")?[n.get("text-radial-offset").evaluate(e,{},i)*nc,gh]:n.get("text-offset").evaluate(e,{},i).map((t=>t*nc));const o=[];for(const t of s)o.push(t,_h(t,r));return new Yt(o)}return null}function vh(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function xh(e,i,r,n,o,s,a,l,c,u,h){let d=s.textMaxSize.evaluate(i,{});void 0===d&&(d=a);const p=e.layers[0].layout,f=p.get("icon-offset").evaluate(i,{},h),A=wh(r.horizontal),m=a/24,g=e.tilePixelRatio*m,_=e.tilePixelRatio*d/24,y=e.tilePixelRatio*l,v=e.tilePixelRatio*p.get("symbol-spacing"),x=p.get("text-padding")*e.tilePixelRatio,b=function(t,e,i,r=1){const n=t.get("icon-padding").evaluate(e,{},i),o=n&&n.values;return[o[0]*r,o[1]*r,o[2]*r,o[3]*r]}(p,i,h,e.tilePixelRatio),T=p.get("text-max-angle")/180*Math.PI,B="viewport"!==p.get("text-rotation-alignment")&&"point"!==p.get("symbol-placement"),E="map"===p.get("icon-rotation-alignment")&&"point"!==p.get("symbol-placement"),C=p.get("symbol-placement"),S=v/2,I=p.get("icon-text-fit");let M;n&&"none"!==I&&(e.allowVerticalPlacement&&r.vertical&&(M=eu(n,r.vertical,I,p.get("icon-text-fit-padding"),f,m)),A&&(n=eu(n,A,I,p.get("icon-text-fit-padding"),f,m)));const k=(l,d)=>{d.x<0||d.x>=Rs||d.y<0||d.y>=Rs||function(e,i,r,n,o,s,a,l,c,u,h,d,p,f,A,m,g,_,y,v,x,b,T,B,E){const C=e.addToLineVertexArray(i,r);let S,I,M,k,P=0,L=0,z=0,F=0,D=-1,R=-1;const U={};let O=gs("");if(e.allowVerticalPlacement&&n.vertical){const t=l.layout.get("text-rotate").evaluate(x,{},B)+90;M=new uh(c,i,u,h,d,n.vertical,p,f,A,t),a&&(k=new uh(c,i,u,h,d,a,g,_,A,t))}if(o){const r=l.layout.get("icon-rotate").evaluate(x,{}),n="none"!==l.layout.get("icon-text-fit"),s=oh(o,r,T,n),p=a?oh(a,r,T,n):void 0;I=new uh(c,i,u,h,d,o,g,_,!1,r),P=4*s.length;const f=e.iconSizeData;let A=null;"source"===f.kind?(A=[ru*l.layout.get("icon-size").evaluate(x,{})],A[0]>nu&&w(`${e.layerIds[0]}: Value for "icon-size" is >= ${iu}. Reduce your "icon-size".`)):"composite"===f.kind&&(A=[ru*b.compositeIconSizes[0].evaluate(x,{},B),ru*b.compositeIconSizes[1].evaluate(x,{},B)],(A[0]>nu||A[1]>nu)&&w(`${e.layerIds[0]}: Value for "icon-size" is >= ${iu}. Reduce your "icon-size".`)),e.addSymbols(e.icon,s,A,v,y,x,t.ah.none,i,C.lineStartIndex,C.lineLength,-1,B),D=e.icon.placedSymbolArray.length-1,p&&(L=4*p.length,e.addSymbols(e.icon,p,A,v,y,x,t.ah.vertical,i,C.lineStartIndex,C.lineLength,-1,B),R=e.icon.placedSymbolArray.length-1)}const N=Object.keys(n.horizontal);for(const r of N){const o=n.horizontal[r];if(!S){O=gs(o.text);const t=l.layout.get("text-rotate").evaluate(x,{},B);S=new uh(c,i,u,h,d,o,p,f,A,t)}const a=1===o.positionedLines.length;if(z+=bh(e,i,o,s,l,A,x,m,C,n.vertical?t.ah.horizontal:t.ah.horizontalOnly,a?N:[r],U,D,b,B),a)break}n.vertical&&(F+=bh(e,i,n.vertical,s,l,A,x,m,C,t.ah.vertical,["vertical"],U,R,b,B));const Q=S?S.boxStartIndex:e.collisionBoxArray.length,V=S?S.boxEndIndex:e.collisionBoxArray.length,j=M?M.boxStartIndex:e.collisionBoxArray.length,H=M?M.boxEndIndex:e.collisionBoxArray.length,G=I?I.boxStartIndex:e.collisionBoxArray.length,$=I?I.boxEndIndex:e.collisionBoxArray.length,Z=k?k.boxStartIndex:e.collisionBoxArray.length,q=k?k.boxEndIndex:e.collisionBoxArray.length;let K=-1;const W=(t,e)=>t&&t.circleDiameter?Math.max(t.circleDiameter,e):e;K=W(S,K),K=W(M,K),K=W(I,K),K=W(k,K);const X=K>-1?1:0;X&&(K*=E/nc),e.glyphOffsetArray.length>=fu.MAX_GLYPHS&&w("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==x.sortKey&&e.addToSortKeyRanges(e.symbolInstances.length,x.sortKey);const J=yh(l,x,B),[Y,tt]=function(e,i){const r=e.length,n=null==i?void 0:i.values;if((null==n?void 0:n.length)>0)for(let i=0;i<n.length;i+=2){const r=n[i+1];e.emplaceBack(t.aq[n[i]],r[0],r[1])}return[r,e.length]}(e.textAnchorOffsets,J);e.symbolInstances.emplaceBack(i.x,i.y,U.right>=0?U.right:-1,U.center>=0?U.center:-1,U.left>=0?U.left:-1,U.vertical||-1,D,R,O,Q,V,j,H,G,$,Z,q,u,z,F,P,L,X,0,p,K,Y,tt)}(e,d,l,r,n,o,M,e.layers[0],e.collisionBoxArray,i.index,i.sourceLayerIndex,e.index,g,[x,x,x,x],B,c,y,b,E,f,i,s,u,h,a)};if("line"===C)for(const t of Ku(i.geometry,0,0,Rs,Rs)){const i=ih(t,v,T,r.vertical||A,n,24,_,e.overscaling,Rs);for(const r of i)A&&Th(e,A.text,S,r)||k(t,r)}else if("line-center"===C){for(const t of i.geometry)if(t.length>1){const e=eh(t,T,r.vertical||A,n,24,_);e&&k(t,e)}}else if("Polygon"===i.type)for(const t of _i(i.geometry,0)){const e=dh(t,16);k(t[0],new Wu(e.x,e.y,0))}else if("LineString"===i.type)for(const t of i.geometry)k(t,new Wu(t[0].x,t[0].y,0));else if("Point"===i.type)for(const t of i.geometry)for(const e of t)k([e],new Wu(e.x,e.y,0))}function bh(t,e,i,r,n,s,a,l,c,u,h,d,p,f,A){const m=function(t,e,i,r,n,s,a,l){const c=r.layout.get("text-rotate").evaluate(s,{})*Math.PI/180,u=[];for(const t of e.positionedLines)for(const r of t.positionedGlyphs){if(!r.rect)continue;const s=r.rect||{};let h=Pc+1,d=!0,p=1,f=0;const A=(n||l)&&r.vertical,m=r.metrics.advance*r.scale/2;if(l&&e.verticalizable&&(f=t.lineOffset/2-(r.imageName?-(nc-r.metrics.width*r.scale)/2:(r.scale-1)*nc)),r.imageName){const t=a[r.imageName];d=t.sdf,p=t.pixelRatio,h=zc/p}const g=n?[r.x+m,r.y]:[0,0];let _=n?[0,0]:[r.x+m+i[0],r.y+i[1]-f],y=[0,0];A&&(y=_,_=[0,0]);const v=r.metrics.isDoubleResolution?2:1,x=(r.metrics.left-h)*r.scale-m+_[0],b=(-r.metrics.top-h)*r.scale+_[1],w=x+s.w/v*r.scale/p,T=b+s.h/v*r.scale/p,B=new o(x,b),E=new o(w,b),C=new o(x,T),S=new o(w,T);if(A){const t=new o(-m,m-Uc),e=-Math.PI/2,i=nc/2-m,n=new o(5-Uc-i,-(r.imageName?i:0)),s=new o(...y);B._rotateAround(e,t)._add(n)._add(s),E._rotateAround(e,t)._add(n)._add(s),C._rotateAround(e,t)._add(n)._add(s),S._rotateAround(e,t)._add(n)._add(s)}if(c){const t=Math.sin(c),e=Math.cos(c),i=[e,-t,t,e];B._matMult(i),E._matMult(i),C._matMult(i),S._matMult(i)}const I=new o(0,0),M=new o(0,0);u.push({tl:B,tr:E,bl:C,br:S,tex:s,writingMode:e.writingMode,glyphOffset:g,sectionIndex:r.sectionIndex,isSDF:d,pixelOffsetTL:I,pixelOffsetBR:M,minFontScaleX:0,minFontScaleY:0})}return u}(0,i,l,n,s,a,r,t.allowVerticalPlacement),g=t.textSizeData;let _=null;"source"===g.kind?(_=[ru*n.layout.get("text-size").evaluate(a,{})],_[0]>nu&&w(`${t.layerIds[0]}: Value for "text-size" is >= ${iu}. Reduce your "text-size".`)):"composite"===g.kind&&(_=[ru*f.compositeTextSizes[0].evaluate(a,{},A),ru*f.compositeTextSizes[1].evaluate(a,{},A)],(_[0]>nu||_[1]>nu)&&w(`${t.layerIds[0]}: Value for "text-size" is >= ${iu}. Reduce your "text-size".`)),t.addSymbols(t.text,m,_,l,s,a,u,e,c.lineStartIndex,c.lineLength,p,A);for(const e of h)d[e]=t.text.placedSymbolArray.length-1;return 4*m.length}function wh(t){for(const e in t)return t[e];return null}function Th(t,e,i,r){const n=t.compareText;if(e in n){const t=n[e];for(let e=t.length-1;e>=0;e--)if(r.dist(t[e])<i)return!0}else n[e]=[];return n[e].push(r),!1}const Bh=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Eh{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[e,i]=new Uint8Array(t,0,2);if(219!==e)throw new Error("Data does not appear to be in a KDBush format.");const r=i>>4;if(1!==r)throw new Error(`Got v${r} data when expected v1.`);const n=Bh[15&i];if(!n)throw new Error("Unrecognized array type.");const[o]=new Uint16Array(t,2,1),[s]=new Uint32Array(t,4,1);return new Eh(s,o,n,t)}constructor(t,e=64,i=Float64Array,r){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+e,2),65535),this.ArrayType=i,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const n=Bh.indexOf(this.ArrayType),o=2*t*this.ArrayType.BYTES_PER_ELEMENT,s=t*this.IndexArrayType.BYTES_PER_ELEMENT,a=(8-s%8)%8;if(n<0)throw new Error(`Unexpected typed array class: ${i}.`);r&&r instanceof ArrayBuffer?(this.data=r,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+s+a,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+o+s+a),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+s+a,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+n]),new Uint16Array(this.data,2,1)[0]=e,new Uint32Array(this.data,4,1)[0]=t)}add(t,e){const i=this._pos>>1;return this.ids[i]=i,this.coords[this._pos++]=t,this.coords[this._pos++]=e,i}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return Ch(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,e,i,r){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:n,coords:o,nodeSize:s}=this,a=[0,n.length-1,0],l=[];for(;a.length;){const c=a.pop()||0,u=a.pop()||0,h=a.pop()||0;if(u-h<=s){for(let s=h;s<=u;s++){const a=o[2*s],c=o[2*s+1];a>=t&&a<=i&&c>=e&&c<=r&&l.push(n[s])}continue}const d=h+u>>1,p=o[2*d],f=o[2*d+1];p>=t&&p<=i&&f>=e&&f<=r&&l.push(n[d]),(0===c?t<=p:e<=f)&&(a.push(h),a.push(d-1),a.push(1-c)),(0===c?i>=p:r>=f)&&(a.push(d+1),a.push(u),a.push(1-c))}return l}within(t,e,i){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:r,coords:n,nodeSize:o}=this,s=[0,r.length-1,0],a=[],l=i*i;for(;s.length;){const c=s.pop()||0,u=s.pop()||0,h=s.pop()||0;if(u-h<=o){for(let i=h;i<=u;i++)kh(n[2*i],n[2*i+1],t,e)<=l&&a.push(r[i]);continue}const d=h+u>>1,p=n[2*d],f=n[2*d+1];kh(p,f,t,e)<=l&&a.push(r[d]),(0===c?t-i<=p:e-i<=f)&&(s.push(h),s.push(d-1),s.push(1-c)),(0===c?t+i>=p:e+i>=f)&&(s.push(d+1),s.push(u),s.push(1-c))}return a}}function Ch(t,e,i,r,n,o){if(n-r<=i)return;const s=r+n>>1;Sh(t,e,s,r,n,o),Ch(t,e,i,r,s-1,1-o),Ch(t,e,i,s+1,n,1-o)}function Sh(t,e,i,r,n,o){for(;n>r;){if(n-r>600){const s=n-r+1,a=i-r+1,l=Math.log(s),c=.5*Math.exp(2*l/3),u=.5*Math.sqrt(l*c*(s-c)/s)*(a-s/2<0?-1:1);Sh(t,e,i,Math.max(r,Math.floor(i-a*c/s+u)),Math.min(n,Math.floor(i+(s-a)*c/s+u)),o)}const s=e[2*i+o];let a=r,l=n;for(Ih(t,e,r,i),e[2*n+o]>s&&Ih(t,e,r,n);a<l;){for(Ih(t,e,a,l),a++,l--;e[2*a+o]<s;)a++;for(;e[2*l+o]>s;)l--}e[2*r+o]===s?Ih(t,e,r,l):(l++,Ih(t,e,l,n)),l<=i&&(r=l+1),i<=l&&(n=l-1)}}function Ih(t,e,i,r){Mh(t,i,r),Mh(e,2*i,2*r),Mh(e,2*i+1,2*r+1)}function Mh(t,e,i){const r=t[e];t[e]=t[i],t[i]=r}function kh(t,e,i,r){const n=t-i,o=e-r;return n*n+o*o}var Ph;t.bg=void 0,(Ph=t.bg||(t.bg={})).create="create",Ph.load="load",Ph.fullLoad="fullLoad";let Lh=null,zh=[];const Fh=1e3/60,Dh="loadTime",Rh="fullLoadTime",Uh={mark(t){performance.mark(t)},frame(t){const e=t;null!=Lh&&zh.push(e-Lh),Lh=e},clearMetrics(){Lh=null,zh=[],performance.clearMeasures(Dh),performance.clearMeasures(Rh);for(const e in t.bg)performance.clearMarks(t.bg[e])},getPerformanceMetrics(){performance.measure(Dh,t.bg.create,t.bg.load),performance.measure(Rh,t.bg.create,t.bg.fullLoad);const e=performance.getEntriesByName(Dh)[0].duration,i=performance.getEntriesByName(Rh)[0].duration,r=zh.length,n=1/(zh.reduce(((t,e)=>t+e),0)/r/1e3),o=zh.filter((t=>t>Fh)).reduce(((t,e)=>t+(e-Fh)/Fh),0);return{loadTime:e,fullLoadTime:i,fps:n,percentDroppedFrames:o/(r+o)*100,totalFrames:r}}};t.$=class extends po{},t.A=la,t.B=An,t.C=function(t){if(null==E){const e=t.navigator?t.navigator.userAgent:null;E=!!t.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return E},t.D=Xn,t.E=G,t.F=class{constructor(t,e){this.target=t,this.mapId=e,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new Cu((()=>this.process())),this.subscription=function(t,e,i,r){return t.addEventListener(e,i,!1),{unsubscribe:()=>{t.removeEventListener(e,i,!1)}}}(this.target,"message",(t=>this.receive(t))),this.globalScope=B(self)?t:window}registerMessageHandler(t,e){this.messageHandlers[t]=e}sendAsync(t,e){return new Promise(((i,r)=>{const n=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[n]={resolve:i,reject:r},e&&e.signal.addEventListener("abort",(()=>{delete this.resolveRejects[n];const e={id:n,type:"<cancel>",origin:location.origin,targetMapId:t.targetMapId,sourceMapId:this.mapId};this.target.postMessage(e)}),{once:!0});const o=[],s=Object.assign(Object.assign({},t),{id:n,sourceMapId:this.mapId,origin:location.origin,data:Bn(t.data,o)});this.target.postMessage(s,{transfer:o})}))}receive(t){const e=t.data,i=e.id;if(!("file://"!==e.origin&&"file://"!==location.origin&&"resource://android"!==e.origin&&"resource://android"!==location.origin&&e.origin!==location.origin||e.targetMapId&&this.mapId!==e.targetMapId)){if("<cancel>"===e.type){delete this.tasks[i];const t=this.abortControllers[i];return delete this.abortControllers[i],void(t&&t.abort())}if(B(self)||e.mustQueue)return this.tasks[i]=e,this.taskQueue.push(i),void this.invoker.trigger();this.processTask(i,e)}}process(){if(0===this.taskQueue.length)return;const t=this.taskQueue.shift(),e=this.tasks[t];delete this.tasks[t],this.taskQueue.length>0&&this.invoker.trigger(),e&&this.processTask(t,e)}processTask(t,i){return e(this,void 0,void 0,(function*(){if("<response>"===i.type){const e=this.resolveRejects[t];if(delete this.resolveRejects[t],!e)return;return void(i.error?e.reject(En(i.error)):e.resolve(En(i.data)))}if(!this.messageHandlers[i.type])return void this.completeTask(t,new Error(`Could not find a registered handler for ${i.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const e=En(i.data),r=new AbortController;this.abortControllers[t]=r;try{const n=yield this.messageHandlers[i.type](i.sourceMapId,e,r);this.completeTask(t,null,n)}catch(e){this.completeTask(t,e)}}))}completeTask(t,e,i){const r=[];delete this.abortControllers[t];const n={id:t,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:e?Bn(e):null,data:Bn(i,r)};this.target.postMessage(n,{transfer:r})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},t.G=D,t.H=function(){var t=new la(16);return la!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},t.I=Fc,t.J=function(t,e,i){var r,n,o,s,a,l,c,u,h,d,p,f,A=i[0],m=i[1],g=i[2];return e===t?(t[12]=e[0]*A+e[4]*m+e[8]*g+e[12],t[13]=e[1]*A+e[5]*m+e[9]*g+e[13],t[14]=e[2]*A+e[6]*m+e[10]*g+e[14],t[15]=e[3]*A+e[7]*m+e[11]*g+e[15]):(n=e[1],o=e[2],s=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=e[8],d=e[9],p=e[10],f=e[11],t[0]=r=e[0],t[1]=n,t[2]=o,t[3]=s,t[4]=a,t[5]=l,t[6]=c,t[7]=u,t[8]=h,t[9]=d,t[10]=p,t[11]=f,t[12]=r*A+a*m+h*g+e[12],t[13]=n*A+l*m+d*g+e[13],t[14]=o*A+c*m+p*g+e[14],t[15]=s*A+u*m+f*g+e[15]),t},t.K=function(t,e,i){var r=i[0],n=i[1],o=i[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},t.L=ua,t.M=function(t,e){const i={};for(let r=0;r<e.length;r++){const n=e[r];n in t&&(i[n]=t[n])}return i},t.N=Iu,t.O=Pu,t.P=o,t.Q=Lu,t.R=wa,t.S=Nu,t.T=Gn,t.U=h,t.V=d,t.W=I,t.X=Rs,t.Y=lo,t.Z=Du,t._=e,t.a=z,t.a$=function(t,e){var i=t[0],r=t[1],n=t[2],o=t[3],s=t[4],a=t[5],l=t[6],c=t[7],u=t[8],h=t[9],d=t[10],p=t[11],f=t[12],A=t[13],m=t[14],g=t[15],_=e[0],y=e[1],v=e[2],x=e[3],b=e[4],w=e[5],T=e[6],B=e[7],E=e[8],C=e[9],S=e[10],I=e[11],M=e[12],k=e[13],P=e[14],L=e[15];return Math.abs(i-_)<=aa*Math.max(1,Math.abs(i),Math.abs(_))&&Math.abs(r-y)<=aa*Math.max(1,Math.abs(r),Math.abs(y))&&Math.abs(n-v)<=aa*Math.max(1,Math.abs(n),Math.abs(v))&&Math.abs(o-x)<=aa*Math.max(1,Math.abs(o),Math.abs(x))&&Math.abs(s-b)<=aa*Math.max(1,Math.abs(s),Math.abs(b))&&Math.abs(a-w)<=aa*Math.max(1,Math.abs(a),Math.abs(w))&&Math.abs(l-T)<=aa*Math.max(1,Math.abs(l),Math.abs(T))&&Math.abs(c-B)<=aa*Math.max(1,Math.abs(c),Math.abs(B))&&Math.abs(u-E)<=aa*Math.max(1,Math.abs(u),Math.abs(E))&&Math.abs(h-C)<=aa*Math.max(1,Math.abs(h),Math.abs(C))&&Math.abs(d-S)<=aa*Math.max(1,Math.abs(d),Math.abs(S))&&Math.abs(p-I)<=aa*Math.max(1,Math.abs(p),Math.abs(I))&&Math.abs(f-M)<=aa*Math.max(1,Math.abs(f),Math.abs(M))&&Math.abs(A-k)<=aa*Math.max(1,Math.abs(A),Math.abs(k))&&Math.abs(m-P)<=aa*Math.max(1,Math.abs(m),Math.abs(P))&&Math.abs(g-L)<=aa*Math.max(1,Math.abs(g),Math.abs(L))},t.a0=ls,t.a1=Uu,t.a2=nt,t.a3=t=>{const e=window.document.createElement("video");return e.muted=!0,new Promise((i=>{e.onloadstart=()=>{i(e)};for(const i of t){const t=window.document.createElement("source");N(i)||(e.crossOrigin="Anonymous"),t.src=i,e.appendChild(t)}}))},t.a4=function(){return _++},t.a5=Fo,t.a6=fu,t.a7=Cr,t.a8=Qs,t.a9=Hu,t.aA=function(t){if("custom"===t.type)return new Eu(t);switch(t.type){case"background":return new bu(t);case"circle":return new fa(t);case"fill":return new cl(t);case"fill-extrusion":return new Ll(t);case"heatmap":return new Ea(t);case"hillshade":return new Ia(t);case"line":return new Kl(t);case"raster":return new Bu(t);case"symbol":return new yu(t)}},t.aB=x,t.aC=function(t,e){if(!t)return[{command:"setStyle",args:[e]}];let i=[];try{if(!K(t.version,e.version))return[{command:"setStyle",args:[e]}];K(t.center,e.center)||i.push({command:"setCenter",args:[e.center]}),K(t.zoom,e.zoom)||i.push({command:"setZoom",args:[e.zoom]}),K(t.bearing,e.bearing)||i.push({command:"setBearing",args:[e.bearing]}),K(t.pitch,e.pitch)||i.push({command:"setPitch",args:[e.pitch]}),K(t.sprite,e.sprite)||i.push({command:"setSprite",args:[e.sprite]}),K(t.glyphs,e.glyphs)||i.push({command:"setGlyphs",args:[e.glyphs]}),K(t.transition,e.transition)||i.push({command:"setTransition",args:[e.transition]}),K(t.light,e.light)||i.push({command:"setLight",args:[e.light]}),K(t.terrain,e.terrain)||i.push({command:"setTerrain",args:[e.terrain]}),K(t.sky,e.sky)||i.push({command:"setSky",args:[e.sky]}),K(t.projection,e.projection)||i.push({command:"setProjection",args:[e.projection]});const r={},n=[];!function(t,e,i,r){let n;for(n in e=e||{},t=t||{})Object.prototype.hasOwnProperty.call(t,n)&&(Object.prototype.hasOwnProperty.call(e,n)||J(n,i,r));for(n in e)Object.prototype.hasOwnProperty.call(e,n)&&(Object.prototype.hasOwnProperty.call(t,n)?K(t[n],e[n])||("geojson"===t[n].type&&"geojson"===e[n].type&&tt(t,e,n)?W(i,{command:"setGeoJSONSourceData",args:[n,e[n].data]}):Y(n,e,i,r)):X(n,e,i))}(t.sources,e.sources,n,r);const o=[];t.layers&&t.layers.forEach((t=>{"source"in t&&r[t.source]?i.push({command:"removeLayer",args:[t.id]}):o.push(t)})),i=i.concat(n),function(t,e,i){e=e||[];const r=(t=t||[]).map(it),n=e.map(it),o=t.reduce(rt,{}),s=e.reduce(rt,{}),a=r.slice(),l=Object.create(null);let c,u,h,d,p;for(let t=0,e=0;t<r.length;t++)c=r[t],Object.prototype.hasOwnProperty.call(s,c)?e++:(W(i,{command:"removeLayer",args:[c]}),a.splice(a.indexOf(c,e),1));for(let t=0,e=0;t<n.length;t++)c=n[n.length-1-t],a[a.length-1-t]!==c&&(Object.prototype.hasOwnProperty.call(o,c)?(W(i,{command:"removeLayer",args:[c]}),a.splice(a.lastIndexOf(c,a.length-e),1)):e++,d=a[a.length-t],W(i,{command:"addLayer",args:[s[c],d]}),a.splice(a.length-t,0,c),l[c]=!0);for(let t=0;t<n.length;t++)if(c=n[t],u=o[c],h=s[c],!l[c]&&!K(u,h))if(K(u.source,h.source)&&K(u["source-layer"],h["source-layer"])&&K(u.type,h.type)){for(p in et(u.layout,h.layout,i,c,null,"setLayoutProperty"),et(u.paint,h.paint,i,c,null,"setPaintProperty"),K(u.filter,h.filter)||W(i,{command:"setFilter",args:[c,h.filter]}),K(u.minzoom,h.minzoom)&&K(u.maxzoom,h.maxzoom)||W(i,{command:"setLayerZoomRange",args:[c,h.minzoom,h.maxzoom]}),u)Object.prototype.hasOwnProperty.call(u,p)&&"layout"!==p&&"paint"!==p&&"filter"!==p&&"metadata"!==p&&"minzoom"!==p&&"maxzoom"!==p&&(0===p.indexOf("paint.")?et(u[p],h[p],i,c,p.slice(6),"setPaintProperty"):K(u[p],h[p])||W(i,{command:"setLayerProperty",args:[c,p,h[p]]}));for(p in h)Object.prototype.hasOwnProperty.call(h,p)&&!Object.prototype.hasOwnProperty.call(u,p)&&"layout"!==p&&"paint"!==p&&"filter"!==p&&"metadata"!==p&&"minzoom"!==p&&"maxzoom"!==p&&(0===p.indexOf("paint.")?et(u[p],h[p],i,c,p.slice(6),"setPaintProperty"):K(u[p],h[p])||W(i,{command:"setLayerProperty",args:[c,p,h[p]]}))}else W(i,{command:"removeLayer",args:[c]}),d=a[a.lastIndexOf(c)+1],W(i,{command:"addLayer",args:[h,d]})}(o,e.layers,i)}catch(t){console.warn("Unable to compute style diff:",t),i=[{command:"setStyle",args:[e]}]}return i},t.aD=function(t){const e=[],i=t.id;return void 0===i&&e.push({message:`layers.${i}: missing required property "id"`}),void 0===t.render&&e.push({message:`layers.${i}: missing required method "render"`}),t.renderingMode&&"2d"!==t.renderingMode&&"3d"!==t.renderingMode&&e.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),e},t.aE=function t(e,i){if(Array.isArray(e)){if(!Array.isArray(i)||e.length!==i.length)return!1;for(let r=0;r<e.length;r++)if(!t(e[r],i[r]))return!1;return!0}if("object"==typeof e&&null!==e&&null!==i){if("object"!=typeof i)return!1;if(Object.keys(e).length!==Object.keys(i).length)return!1;for(const r in e)if(!t(e[r],i[r]))return!1;return!0}return e===i},t.aF=y,t.aG=v,t.aH=class extends bs{constructor(t,e){super(t,e),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1i(this.location,t))}},t.aI=ws,t.aJ=class extends bs{constructor(t,e){super(t,e),this.current=Es}set(t){if(t[12]!==this.current[12]||t[0]!==this.current[0])return this.current=t,void this.gl.uniformMatrix4fv(this.location,!1,t);for(let e=1;e<16;e++)if(t[e]!==this.current[e]){this.current=t,this.gl.uniformMatrix4fv(this.location,!1,t);break}}},t.aK=Ts,t.aL=Bs,t.aM=Zt,t.aN=class extends bs{constructor(t,e){super(t,e),this.current=[0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]||(this.current=t,this.gl.uniform3f(this.location,t[0],t[1],t[2]))}},t.aO=class extends bs{constructor(t,e){super(t,e),this.current=[0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]||(this.current=t,this.gl.uniform2f(this.location,t[0],t[1]))}},t.aP=function(t,e,i,r,n,o,s){var a=1/(e-i),l=1/(r-n),c=1/(o-s);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(e+i)*a,t[13]=(n+r)*l,t[14]=(s+o)*c,t[15]=1,t},t.aQ=da,t.aR=class extends wo{},t.aS=ec,t.aT=class extends Bo{},t.aU=Ba,t.aV=function(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},t.aW=Ta,t.aX=$o,t.aY=ns,t.aZ=class extends Po{},t.a_=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]},t.aa=function(t){const e={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((t,i,r,n)=>{const o=r||n;return e[i]=!o||o.toLowerCase(),""})),e["max-age"]){const t=parseInt(e["max-age"],10);isNaN(t)?delete e["max-age"]:e["max-age"]=t}return e},t.ab=function(t,e){const i=[];for(const r in t)r in e||i.push(r);return i},t.ac=A,t.ad=function(t,e,i){var r=Math.sin(i),n=Math.cos(i),o=e[0],s=e[1],a=e[2],l=e[3],c=e[4],u=e[5],h=e[6],d=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*n+c*r,t[1]=s*n+u*r,t[2]=a*n+h*r,t[3]=l*n+d*r,t[4]=c*n-o*r,t[5]=u*n-s*r,t[6]=h*n-a*r,t[7]=d*n-l*r,t},t.ae=function(t){var e=new la(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},t.af=pa,t.ag=function(t,e){let i=0,r=0;if("constant"===t.kind)r=t.layoutSize;else if("source"!==t.kind){const{interpolationType:n,minZoom:o,maxZoom:s}=t,a=n?A(ke.interpolationFactor(n,e,o,s),0,1):0;"camera"===t.kind?r=Me.number(t.minSize,t.maxSize,a):i=a}return{uSizeT:i,uSize:r}},t.ai=function(t,{uSize:e,uSizeT:i},{lowerSize:r,upperSize:n}){return"source"===t.kind?r/ru:"composite"===t.kind?Me.number(r/ru,n/ru,i):e},t.aj=uu,t.ak=function(t,e,i,r){const n=e.y-t.y,s=e.x-t.x,a=r.y-i.y,l=r.x-i.x,c=a*s-l*n;if(0===c)return null;const u=(l*(t.y-i.y)-a*(t.x-i.x))/c;return new o(t.x+u*s,t.y+u*n)},t.al=Ku,t.am=Hs,t.an=ca,t.ao=function(t){let e=1/0,i=1/0,r=-1/0,n=-1/0;for(const o of t)e=Math.min(e,o.x),i=Math.min(i,o.y),r=Math.max(r,o.x),n=Math.max(n,o.y);return[e,i,r,n]},t.ap=nc,t.ar=su,t.as=function(t,e){var i=e[0],r=e[1],n=e[2],o=e[3],s=e[4],a=e[5],l=e[6],c=e[7],u=e[8],h=e[9],d=e[10],p=e[11],f=e[12],A=e[13],m=e[14],g=e[15],_=i*a-r*s,y=i*l-n*s,v=i*c-o*s,x=r*l-n*a,b=r*c-o*a,w=n*c-o*l,T=u*A-h*f,B=u*m-d*f,E=u*g-p*f,C=h*m-d*A,S=h*g-p*A,I=d*g-p*m,M=_*I-y*S+v*C+x*E-b*B+w*T;return M?(t[0]=(a*I-l*S+c*C)*(M=1/M),t[1]=(n*S-r*I-o*C)*M,t[2]=(A*w-m*b+g*x)*M,t[3]=(d*b-h*w-p*x)*M,t[4]=(l*E-s*I-c*B)*M,t[5]=(i*I-n*E+o*B)*M,t[6]=(m*v-f*w-g*y)*M,t[7]=(u*w-d*v+p*y)*M,t[8]=(s*S-a*E+c*T)*M,t[9]=(r*E-i*S-o*T)*M,t[10]=(f*b-A*v+g*_)*M,t[11]=(h*v-u*b-p*_)*M,t[12]=(a*B-s*C-l*T)*M,t[13]=(i*C-r*B+n*T)*M,t[14]=(A*y-f*x-m*_)*M,t[15]=(u*x-h*y+d*_)*M,t):null},t.at=vh,t.au=Xc,t.av=Eh,t.aw=function(){const t={},e=$.$version;for(const i in $.$root){const r=$.$root[i];if(r.required){let n=null;n="version"===i?e:"array"===r.type?[]:{},null!=n&&(t[i]=n)}}return t},t.ax=Cn,t.ay=U,t.az=function(t){t=t.slice();const e=Object.create(null);for(let i=0;i<t.length;i++)e[t[i].id]=t[i];for(let i=0;i<t.length;i++)"ref"in t[i]&&(t[i]=q(t[i],e[t[i].ref]));return t},t.b=C,t.b0=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},t.b1=function(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t[3]=e[3]*i[3],t},t.b2=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},t.b3=m,t.b4=Ou,t.b5=zu,t.b6=function(t,e,i,r,n){var o,s=1/Math.tan(e/2);return t[0]=s/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=n&&n!==1/0?(t[10]=(n+r)*(o=1/(r-n)),t[14]=2*n*r*o):(t[10]=-1,t[14]=-2*r),t},t.b7=function(t,e,i){var r=Math.sin(i),n=Math.cos(i),o=e[4],s=e[5],a=e[6],l=e[7],c=e[8],u=e[9],h=e[10],d=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=o*n+c*r,t[5]=s*n+u*r,t[6]=a*n+h*r,t[7]=l*n+d*r,t[8]=c*n-o*r,t[9]=u*n-s*r,t[10]=h*n-a*r,t[11]=d*n-l*r,t},t.b8=p,t.b9=f,t.bA=oc,t.bB=function(t){return t.message===P},t.bC=yr,t.bD=Qn,t.ba=function(t){return t*Math.PI/180},t.bb=function(t,e){const{x:i,y:r}=Du.fromLngLat(e);return!(t<0||t>25||r<0||r>=1||i<0||i>=1)},t.bc=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},t.bd=class extends ho{},t.be=Su,t.bf=Uh,t.bh=R,t.bi=function(t,e){z.REGISTERED_PROTOCOLS[t]=e},t.bj=function(t){delete z.REGISTERED_PROTOCOLS[t]},t.bk=function(t,e){const i={};for(let r=0;r<t.length;r++){const n=e&&e[t[r].id]||Dr(t[r]);e&&(e[t[r].id]=n);let o=i[n];o||(o=i[n]=[]),o.push(t[r])}const r=[];for(const t in i)r.push(i[t]);return r},t.bl=xn,t.bm=ju,t.bn=Gu,t.bo=Dc,t.bp=function(e){e.bucket.createArrays(),e.bucket.tilePixelRatio=Rs/(512*e.bucket.overscaling),e.bucket.compareText={},e.bucket.iconsNeedLinear=!1;const i=e.bucket.layers[0],r=i.layout,n=i._unevaluatedLayout._values,o={layoutIconSize:n["icon-size"].possiblyEvaluate(new Vn(e.bucket.zoom+1),e.canonical),layoutTextSize:n["text-size"].possiblyEvaluate(new Vn(e.bucket.zoom+1),e.canonical),textMaxSize:n["text-size"].possiblyEvaluate(new Vn(18))};if("composite"===e.bucket.textSizeData.kind){const{minZoom:t,maxZoom:i}=e.bucket.textSizeData;o.compositeTextSizes=[n["text-size"].possiblyEvaluate(new Vn(t),e.canonical),n["text-size"].possiblyEvaluate(new Vn(i),e.canonical)]}if("composite"===e.bucket.iconSizeData.kind){const{minZoom:t,maxZoom:i}=e.bucket.iconSizeData;o.compositeIconSizes=[n["icon-size"].possiblyEvaluate(new Vn(t),e.canonical),n["icon-size"].possiblyEvaluate(new Vn(i),e.canonical)]}const s=r.get("text-line-height")*nc,a="viewport"!==r.get("text-rotation-alignment")&&"point"!==r.get("symbol-placement"),l=r.get("text-keep-upright"),c=r.get("text-size");for(const n of e.bucket.features){const u=r.get("text-font").evaluate(n,{},e.canonical).join(","),h=c.evaluate(n,{},e.canonical),d=o.layoutTextSize.evaluate(n,{},e.canonical),p=o.layoutIconSize.evaluate(n,{},e.canonical),f={horizontal:{},vertical:void 0},A=n.text;let m,g=[0,0];if(A){const o=A.toString(),c=r.get("text-letter-spacing").evaluate(n,{},e.canonical)*nc,p=Mn(o)?c:0,m=r.get("text-anchor").evaluate(n,{},e.canonical),_=yh(i,n,e.canonical);if(!_){const t=r.get("text-radial-offset").evaluate(n,{},e.canonical);g=t?_h(m,[t*nc,gh]):r.get("text-offset").evaluate(n,{},e.canonical).map((t=>t*nc))}let y=a?"center":r.get("text-justify").evaluate(n,{},e.canonical);const v="point"===r.get("symbol-placement")?r.get("text-max-width").evaluate(n,{},e.canonical)*nc:1/0,x=()=>{e.bucket.allowVerticalPlacement&&In(o)&&(f.vertical=Qc(A,e.glyphMap,e.glyphPositions,e.imagePositions,u,v,s,m,"left",p,g,t.ah.vertical,!0,d,h))};if(!a&&_){const i=new Set;if("auto"===y)for(let t=0;t<_.values.length;t+=2)i.add(vh(_.values[t]));else i.add(y);let r=!1;for(const n of i)if(!f.horizontal[n])if(r)f.horizontal[n]=f.horizontal[0];else{const i=Qc(A,e.glyphMap,e.glyphPositions,e.imagePositions,u,v,s,"center",n,p,g,t.ah.horizontal,!1,d,h);i&&(f.horizontal[n]=i,r=1===i.positionedLines.length)}x()}else{"auto"===y&&(y=vh(m));const i=Qc(A,e.glyphMap,e.glyphPositions,e.imagePositions,u,v,s,m,y,p,g,t.ah.horizontal,!1,d,h);i&&(f.horizontal[y]=i),x(),In(o)&&a&&l&&(f.vertical=Qc(A,e.glyphMap,e.glyphPositions,e.imagePositions,u,v,s,m,y,p,g,t.ah.vertical,!1,d,h))}}let _=!1;if(n.icon&&n.icon.name){const t=e.imageMap[n.icon.name];t&&(m=Yc(e.imagePositions[n.icon.name],r.get("icon-offset").evaluate(n,{},e.canonical),r.get("icon-anchor").evaluate(n,{},e.canonical)),_=!!t.sdf,void 0===e.bucket.sdfIcons?e.bucket.sdfIcons=_:e.bucket.sdfIcons!==_&&w("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(t.pixelRatio!==e.bucket.pixelRatio||0!==r.get("icon-rotate").constantOr(1))&&(e.bucket.iconsNeedLinear=!0))}const y=wh(f.horizontal)||f.vertical;e.bucket.iconsInText=!!y&&y.iconsInText,(y||m)&&xh(e.bucket,n,f,m,e.imageMap,o,d,p,g,_,e.canonical)}e.showCollisionBoxes&&e.bucket.generateCollisionDebugBuffers()},t.bq=jl,t.br=ol,t.bs=Sl,t.bt=pl,t.bu=Cc,t.bv=class{constructor(t){this._marks={start:[t.url,"start"].join("#"),end:[t.url,"end"].join("#"),measure:t.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let t=performance.getEntriesByName(this._marks.measure);return 0===t.length&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),t=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),t}},t.bw=function(t,i,r,n,o){return e(this,void 0,void 0,(function*(){if(d())try{return yield I(t,i,r,n,o)}catch(t){}return function(t,e,i,r,n){const o=t.width,s=t.height;M&&k||(M=new OffscreenCanvas(o,s),k=M.getContext("2d",{willReadFrequently:!0})),M.width=o,M.height=s,k.drawImage(t,0,0,o,s);const a=k.getImageData(e,i,r,n);return k.clearRect(0,0,o,s),a.data}(t,i,r,n,o)}))},t.bx=Vu,t.by=i,t.bz=r,t.c=L,t.d=t=>e(void 0,void 0,void 0,(function*(){if(0===t.byteLength)return createImageBitmap(new ImageData(1,1));const e=new Blob([new Uint8Array(t)],{type:"image/png"});try{return createImageBitmap(e)}catch(t){throw new Error(`Could not load image because of ${t.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}})),t.e=g,t.f=t=>new Promise(((e,i)=>{const r=new Image;r.onload=()=>{e(r),URL.revokeObjectURL(r.src),r.onload=null,window.requestAnimationFrame((()=>{r.src=S}))},r.onerror=()=>i(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const n=new Blob([new Uint8Array(t)],{type:"image/png"});r.src=t.byteLength?URL.createObjectURL(n):S})),t.g=F,t.h=(t,e)=>O(g(t,{type:"json"}),e),t.i=B,t.j=H,t.k=j,t.l=(t,e)=>O(g(t,{type:"arrayBuffer"}),e),t.m=O,t.n=function(t){return new Cc(t).readFields(Ic,[])},t.o=ba,t.p=Lc,t.q=io,t.r=fn,t.s=N,t.t=_n,t.u=pn,t.v=$,t.w=w,t.x=function([t,e,i]){return e+=90,e*=Math.PI/180,i*=Math.PI/180,{x:t*Math.cos(e)*Math.sin(i),y:t*Math.sin(e)*Math.sin(i),z:t*Math.cos(i)}},t.y=Me,t.z=Vn})),i("worker",["./shared"],(function(t){class e{constructor(t){this.keyCache={},t&&this.replace(t)}replace(t){this._layerConfigs={},this._layers={},this.update(t,[])}update(e,i){for(const i of e){this._layerConfigs[i.id]=i;const e=this._layers[i.id]=t.aA(i);e._featureFilter=t.a7(e.filter),this.keyCache[i.id]&&delete this.keyCache[i.id]}for(const t of i)delete this.keyCache[t],delete this._layerConfigs[t],delete this._layers[t];this.familiesBySource={};const r=t.bk(Object.values(this._layerConfigs),this.keyCache);for(const t of r){const e=t.map((t=>this._layers[t.id])),i=e[0];if("none"===i.visibility)continue;const r=i.source||"";let n=this.familiesBySource[r];n||(n=this.familiesBySource[r]={});const o=i.sourceLayer||"_geojsonTileLayer";let s=n[o];s||(s=n[o]=[]),s.push(e)}}}class i{constructor(e){const i={},r=[];for(const t in e){const n=e[t],o=i[t]={};for(const t in n){const e=n[+t];if(!e||0===e.bitmap.width||0===e.bitmap.height)continue;const i={x:0,y:0,w:e.bitmap.width+2,h:e.bitmap.height+2};r.push(i),o[t]={rect:i,metrics:e.metrics}}}const{w:n,h:o}=t.p(r),s=new t.o({width:n||1,height:o||1});for(const r in e){const n=e[r];for(const e in n){const o=n[+e];if(!o||0===o.bitmap.width||0===o.bitmap.height)continue;const a=i[r][e].rect;t.o.copy(o.bitmap,s,{x:0,y:0},{x:a.x+1,y:a.y+1},o.bitmap)}}this.image=s,this.positions=i}}t.bl("GlyphAtlas",i);class r{constructor(e){this.tileID=new t.S(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.uid=e.uid,this.zoom=e.zoom,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId,this.inFlightDependencies=[]}parse(e,r,o,s){return t._(this,void 0,void 0,(function*(){this.status="parsing",this.data=e,this.collisionBoxArray=new t.a5;const a=new t.bm(Object.keys(e.layers).sort()),l=new t.bn(this.tileID,this.promoteId);l.bucketLayerIDs=[];const c={},u={featureIndex:l,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:o},h=r.familiesBySource[this.source];for(const i in h){const r=e.layers[i];if(!r)continue;1===r.version&&t.w(`Vector tile source "${this.source}" layer "${i}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const s=a.encode(i),d=[];for(let t=0;t<r.length;t++){const e=r.feature(t),n=l.getId(e,i);d.push({feature:e,id:n,index:t,sourceLayerIndex:s})}for(const e of h[i]){const i=e[0];i.source!==this.source&&t.w(`layer.source = ${i.source} does not equal this.source = ${this.source}`),i.minzoom&&this.zoom<Math.floor(i.minzoom)||i.maxzoom&&this.zoom>=i.maxzoom||"none"!==i.visibility&&(n(e,this.zoom,o),(c[i.id]=i.createBucket({index:l.bucketLayerIDs.length,layers:e,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:s,sourceID:this.source})).populate(d,u,this.tileID.canonical),l.bucketLayerIDs.push(e.map((t=>t.id))))}}const d=t.aF(u.glyphDependencies,(t=>Object.keys(t).map(Number)));this.inFlightDependencies.forEach((t=>null==t?void 0:t.abort())),this.inFlightDependencies=[];let p=Promise.resolve({});if(Object.keys(d).length){const t=new AbortController;this.inFlightDependencies.push(t),p=s.sendAsync({type:"GG",data:{stacks:d,source:this.source,tileID:this.tileID,type:"glyphs"}},t)}const f=Object.keys(u.iconDependencies);let A=Promise.resolve({});if(f.length){const t=new AbortController;this.inFlightDependencies.push(t),A=s.sendAsync({type:"GI",data:{icons:f,source:this.source,tileID:this.tileID,type:"icons"}},t)}const m=Object.keys(u.patternDependencies);let g=Promise.resolve({});if(m.length){const t=new AbortController;this.inFlightDependencies.push(t),g=s.sendAsync({type:"GI",data:{icons:m,source:this.source,tileID:this.tileID,type:"patterns"}},t)}const[_,y,v]=yield Promise.all([p,A,g]),x=new i(_),b=new t.bo(y,v);for(const e in c){const i=c[e];i instanceof t.a6?(n(i.layers,this.zoom,o),t.bp({bucket:i,glyphMap:_,glyphPositions:x.positions,imageMap:y,imagePositions:b.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):i.hasPattern&&(i instanceof t.bq||i instanceof t.br||i instanceof t.bs)&&(n(i.layers,this.zoom,o),i.addFeatures(u,this.tileID.canonical,b.patternPositions))}return this.status="done",{buckets:Object.values(c).filter((t=>!t.isEmpty())),featureIndex:l,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:x.image,imageAtlas:b,glyphMap:this.returnDependencies?_:null,iconMap:this.returnDependencies?y:null,glyphPositions:this.returnDependencies?x.positions:null}}))}}function n(e,i,r){const n=new t.z(i);for(const t of e)t.recalculate(n,r)}class o{constructor(t,e,i){this.actor=t,this.layerIndex=e,this.availableImages=i,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(e,i){return t._(this,void 0,void 0,(function*(){const r=yield t.l(e.request,i);try{return{vectorTile:new t.bt.VectorTile(new t.bu(r.data)),rawData:r.data,cacheControl:r.cacheControl,expires:r.expires}}catch(t){const i=new Uint8Array(r.data);let n=`Unable to parse the tile at ${e.request.url}, `;throw n+=31===i[0]&&139===i[1]?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${t.message}`,new Error(n)}}))}loadTile(e){return t._(this,void 0,void 0,(function*(){const i=e.uid,n=!!(e&&e.request&&e.request.collectResourceTiming)&&new t.bv(e.request),o=new r(e);this.loading[i]=o;const s=new AbortController;o.abort=s;try{const r=yield this.loadVectorTile(e,s);if(delete this.loading[i],!r)return null;const a=r.rawData,l={};r.expires&&(l.expires=r.expires),r.cacheControl&&(l.cacheControl=r.cacheControl);const c={};if(n){const t=n.finish();t&&(c.resourceTiming=JSON.parse(JSON.stringify(t)))}o.vectorTile=r.vectorTile;const u=o.parse(r.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[i]=o,this.fetching[i]={rawTileData:a,cacheControl:l,resourceTiming:c};try{const e=yield u;return t.e({rawTileData:a.slice(0)},e,l,c)}finally{delete this.fetching[i]}}catch(t){throw delete this.loading[i],o.status="done",this.loaded[i]=o,t}}))}reloadTile(e){return t._(this,void 0,void 0,(function*(){const i=e.uid;if(!this.loaded||!this.loaded[i])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const r=this.loaded[i];if(r.showCollisionBoxes=e.showCollisionBoxes,"parsing"===r.status){const e=yield r.parse(r.vectorTile,this.layerIndex,this.availableImages,this.actor);let n;if(this.fetching[i]){const{rawTileData:r,cacheControl:o,resourceTiming:s}=this.fetching[i];delete this.fetching[i],n=t.e({rawTileData:r.slice(0)},e,o,s)}else n=e;return n}if("done"===r.status&&r.vectorTile)return r.parse(r.vectorTile,this.layerIndex,this.availableImages,this.actor)}))}abortTile(e){return t._(this,void 0,void 0,(function*(){const t=this.loading,i=e.uid;t&&t[i]&&t[i].abort&&(t[i].abort.abort(),delete t[i])}))}removeTile(e){return t._(this,void 0,void 0,(function*(){this.loaded&&this.loaded[e.uid]&&delete this.loaded[e.uid]}))}}class s{constructor(){this.loaded={}}loadTile(e){return t._(this,void 0,void 0,(function*(){const{uid:i,encoding:r,rawImageData:n,redFactor:o,greenFactor:s,blueFactor:a,baseShift:l}=e,c=n.width+2,u=n.height+2,h=t.b(n)?new t.R({width:c,height:u},yield t.bw(n,-1,-1,c,u)):n,d=new t.bx(i,h,r,o,s,a,l);return this.loaded=this.loaded||{},this.loaded[i]=d,d}))}removeTile(t){const e=this.loaded,i=t.uid;e&&e[i]&&delete e[i]}}function a(t,e){if(0!==t.length){l(t[0],e);for(var i=1;i<t.length;i++)l(t[i],!e)}}function l(t,e){for(var i=0,r=0,n=0,o=t.length,s=o-1;n<o;s=n++){var a=(t[n][0]-t[s][0])*(t[s][1]+t[n][1]),l=i+a;r+=Math.abs(i)>=Math.abs(a)?i-l+a:a-l+i,i=l}i+r>=0!=!!e&&t.reverse()}var c=t.by((function t(e,i){var r,n=e&&e.type;if("FeatureCollection"===n)for(r=0;r<e.features.length;r++)t(e.features[r],i);else if("GeometryCollection"===n)for(r=0;r<e.geometries.length;r++)t(e.geometries[r],i);else if("Feature"===n)t(e.geometry,i);else if("Polygon"===n)a(e.coordinates,i);else if("MultiPolygon"===n)for(r=0;r<e.coordinates.length;r++)a(e.coordinates[r],i);return e}));const u=t.bt.VectorTileFeature.prototype.toGeoJSON;var h={exports:{}},d=t.bz,p=t.bt.VectorTileFeature,f=A;function A(t,e){this.options=e||{},this.features=t,this.length=t.length}function m(t,e){this.id="number"==typeof t.id?t.id:void 0,this.type=t.type,this.rawGeometry=1===t.type?[t.geometry]:t.geometry,this.properties=t.tags,this.extent=e||4096}A.prototype.feature=function(t){return new m(this.features[t],this.options.extent)},m.prototype.loadGeometry=function(){var t=this.rawGeometry;this.geometry=[];for(var e=0;e<t.length;e++){for(var i=t[e],r=[],n=0;n<i.length;n++)r.push(new d(i[n][0],i[n][1]));this.geometry.push(r)}return this.geometry},m.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var t=this.geometry,e=1/0,i=-1/0,r=1/0,n=-1/0,o=0;o<t.length;o++)for(var s=t[o],a=0;a<s.length;a++){var l=s[a];e=Math.min(e,l.x),i=Math.max(i,l.x),r=Math.min(r,l.y),n=Math.max(n,l.y)}return[e,r,i,n]},m.prototype.toGeoJSON=p.prototype.toGeoJSON;var g=t.bA,_=f;function y(t){var e=new g;return function(t,e){for(var i in t.layers)e.writeMessage(3,v,t.layers[i])}(t,e),e.finish()}function v(t,e){var i;e.writeVarintField(15,t.version||1),e.writeStringField(1,t.name||""),e.writeVarintField(5,t.extent||4096);var r={keys:[],values:[],keycache:{},valuecache:{}};for(i=0;i<t.length;i++)r.feature=t.feature(i),e.writeMessage(2,x,r);var n=r.keys;for(i=0;i<n.length;i++)e.writeStringField(3,n[i]);var o=r.values;for(i=0;i<o.length;i++)e.writeMessage(4,E,o[i])}function x(t,e){var i=t.feature;void 0!==i.id&&e.writeVarintField(1,i.id),e.writeMessage(2,b,t),e.writeVarintField(3,i.type),e.writeMessage(4,B,i)}function b(t,e){var i=t.feature,r=t.keys,n=t.values,o=t.keycache,s=t.valuecache;for(var a in i.properties){var l=i.properties[a],c=o[a];if(null!==l){void 0===c&&(r.push(a),o[a]=c=r.length-1),e.writeVarint(c);var u=typeof l;"string"!==u&&"boolean"!==u&&"number"!==u&&(l=JSON.stringify(l));var h=u+":"+l,d=s[h];void 0===d&&(n.push(l),s[h]=d=n.length-1),e.writeVarint(d)}}}function w(t,e){return(e<<3)+(7&t)}function T(t){return t<<1^t>>31}function B(t,e){for(var i=t.loadGeometry(),r=t.type,n=0,o=0,s=i.length,a=0;a<s;a++){var l=i[a],c=1;1===r&&(c=l.length),e.writeVarint(w(1,c));for(var u=3===r?l.length-1:l.length,h=0;h<u;h++){1===h&&1!==r&&e.writeVarint(w(2,u-1));var d=l[h].x-n,p=l[h].y-o;e.writeVarint(T(d)),e.writeVarint(T(p)),n+=d,o+=p}3===r&&e.writeVarint(w(7,1))}}function E(t,e){var i=typeof t;"string"===i?e.writeStringField(1,t):"boolean"===i?e.writeBooleanField(7,t):"number"===i&&(t%1!=0?e.writeDoubleField(3,t):t<0?e.writeSVarintField(6,t):e.writeVarintField(5,t))}h.exports=y,h.exports.fromVectorTileJs=y,h.exports.fromGeojsonVt=function(t,e){e=e||{};var i={};for(var r in t)i[r]=new _(t[r].features,e),i[r].name=r,i[r].version=e.version,i[r].extent=e.extent;return y({layers:i})},h.exports.GeoJSONWrapper=_;var C=t.by(h.exports);const S={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:t=>t},I=Math.fround||(M=new Float32Array(1),t=>(M[0]=+t,M[0]));var M;const k=3,P=5,L=6;class z{constructor(t){this.options=Object.assign(Object.create(S),t),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(t){const{log:e,minZoom:i,maxZoom:r}=this.options;e&&console.time("total time");const n=`prepare ${t.length} points`;e&&console.time(n),this.points=t;const o=[];for(let e=0;e<t.length;e++){const i=t[e];if(!i.geometry)continue;const[r,n]=i.geometry.coordinates,s=I(R(r)),a=I(U(n));o.push(s,a,1/0,e,-1,1),this.options.reduce&&o.push(0)}let s=this.trees[r+1]=this._createTree(o);e&&console.timeEnd(n);for(let t=r;t>=i;t--){const i=+Date.now();s=this.trees[t]=this._createTree(this._cluster(s,t)),e&&console.log("z%d: %d clusters in %dms",t,s.numItems,+Date.now()-i)}return e&&console.timeEnd("total time"),this}getClusters(t,e){let i=((t[0]+180)%360+360)%360-180;const r=Math.max(-90,Math.min(90,t[1]));let n=180===t[2]?180:((t[2]+180)%360+360)%360-180;const o=Math.max(-90,Math.min(90,t[3]));if(t[2]-t[0]>=360)i=-180,n=180;else if(i>n){const t=this.getClusters([i,r,180,o],e),s=this.getClusters([-180,r,n,o],e);return t.concat(s)}const s=this.trees[this._limitZoom(e)],a=s.range(R(i),U(o),R(n),U(r)),l=s.data,c=[];for(const t of a){const e=this.stride*t;c.push(l[e+P]>1?F(l,e,this.clusterProps):this.points[l[e+k]])}return c}getChildren(t){const e=this._getOriginId(t),i=this._getOriginZoom(t),r="No cluster with the specified id.",n=this.trees[i];if(!n)throw new Error(r);const o=n.data;if(e*this.stride>=o.length)throw new Error(r);const s=this.options.radius/(this.options.extent*Math.pow(2,i-1)),a=n.within(o[e*this.stride],o[e*this.stride+1],s),l=[];for(const e of a){const i=e*this.stride;o[i+4]===t&&l.push(o[i+P]>1?F(o,i,this.clusterProps):this.points[o[i+k]])}if(0===l.length)throw new Error(r);return l}getLeaves(t,e,i){const r=[];return this._appendLeaves(r,t,e=e||10,i=i||0,0),r}getTile(t,e,i){const r=this.trees[this._limitZoom(t)],n=Math.pow(2,t),{extent:o,radius:s}=this.options,a=s/o,l=(i-a)/n,c=(i+1+a)/n,u={features:[]};return this._addTileFeatures(r.range((e-a)/n,l,(e+1+a)/n,c),r.data,e,i,n,u),0===e&&this._addTileFeatures(r.range(1-a/n,l,1,c),r.data,n,i,n,u),e===n-1&&this._addTileFeatures(r.range(0,l,a/n,c),r.data,-1,i,n,u),u.features.length?u:null}getClusterExpansionZoom(t){let e=this._getOriginZoom(t)-1;for(;e<=this.options.maxZoom;){const i=this.getChildren(t);if(e++,1!==i.length)break;t=i[0].properties.cluster_id}return e}_appendLeaves(t,e,i,r,n){const o=this.getChildren(e);for(const e of o){const o=e.properties;if(o&&o.cluster?n+o.point_count<=r?n+=o.point_count:n=this._appendLeaves(t,o.cluster_id,i,r,n):n<r?n++:t.push(e),t.length===i)break}return n}_createTree(e){const i=new t.av(e.length/this.stride|0,this.options.nodeSize,Float32Array);for(let t=0;t<e.length;t+=this.stride)i.add(e[t],e[t+1]);return i.finish(),i.data=e,i}_addTileFeatures(t,e,i,r,n,o){for(const s of t){const t=s*this.stride,a=e[t+P]>1;let l,c,u;if(a)l=D(e,t,this.clusterProps),c=e[t],u=e[t+1];else{const i=this.points[e[t+k]];l=i.properties;const[r,n]=i.geometry.coordinates;c=R(r),u=U(n)}const h={type:1,geometry:[[Math.round(this.options.extent*(c*n-i)),Math.round(this.options.extent*(u*n-r))]],tags:l};let d;d=a||this.options.generateId?e[t+k]:this.points[e[t+k]].id,void 0!==d&&(h.id=d),o.features.push(h)}}_limitZoom(t){return Math.max(this.options.minZoom,Math.min(Math.floor(+t),this.options.maxZoom+1))}_cluster(t,e){const{radius:i,extent:r,reduce:n,minPoints:o}=this.options,s=i/(r*Math.pow(2,e)),a=t.data,l=[],c=this.stride;for(let i=0;i<a.length;i+=c){if(a[i+2]<=e)continue;a[i+2]=e;const r=a[i],u=a[i+1],h=t.within(a[i],a[i+1],s),d=a[i+P];let p=d;for(const t of h){const i=t*c;a[i+2]>e&&(p+=a[i+P])}if(p>d&&p>=o){let t,o=r*d,s=u*d,f=-1;const A=((i/c|0)<<5)+(e+1)+this.points.length;for(const r of h){const l=r*c;if(a[l+2]<=e)continue;a[l+2]=e;const u=a[l+P];o+=a[l]*u,s+=a[l+1]*u,a[l+4]=A,n&&(t||(t=this._map(a,i,!0),f=this.clusterProps.length,this.clusterProps.push(t)),n(t,this._map(a,l)))}a[i+4]=A,l.push(o/p,s/p,1/0,A,-1,p),n&&l.push(f)}else{for(let t=0;t<c;t++)l.push(a[i+t]);if(p>1)for(const t of h){const i=t*c;if(!(a[i+2]<=e)){a[i+2]=e;for(let t=0;t<c;t++)l.push(a[i+t])}}}}return l}_getOriginId(t){return t-this.points.length>>5}_getOriginZoom(t){return(t-this.points.length)%32}_map(t,e,i){if(t[e+P]>1){const r=this.clusterProps[t[e+L]];return i?Object.assign({},r):r}const r=this.points[t[e+k]].properties,n=this.options.map(r);return i&&n===r?Object.assign({},n):n}}function F(t,e,i){return{type:"Feature",id:t[e+k],properties:D(t,e,i),geometry:{type:"Point",coordinates:[(r=t[e],360*(r-.5)),O(t[e+1])]}};var r}function D(t,e,i){const r=t[e+P],n=r>=1e4?`${Math.round(r/1e3)}k`:r>=1e3?Math.round(r/100)/10+"k":r,o=t[e+L],s=-1===o?{}:Object.assign({},i[o]);return Object.assign(s,{cluster:!0,cluster_id:t[e+k],point_count:r,point_count_abbreviated:n})}function R(t){return t/360+.5}function U(t){const e=Math.sin(t*Math.PI/180),i=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return i<0?0:i>1?1:i}function O(t){const e=(180-360*t)*Math.PI/180;return 360*Math.atan(Math.exp(e))/Math.PI-90}function N(t,e,i,r){let n=r;const o=e+(i-e>>1);let s,a=i-e;const l=t[e],c=t[e+1],u=t[i],h=t[i+1];for(let r=e+3;r<i;r+=3){const e=Q(t[r],t[r+1],l,c,u,h);if(e>n)s=r,n=e;else if(e===n){const t=Math.abs(r-o);t<a&&(s=r,a=t)}}n>r&&(s-e>3&&N(t,e,s,r),t[s+2]=n,i-s>3&&N(t,s,i,r))}function Q(t,e,i,r,n,o){let s=n-i,a=o-r;if(0!==s||0!==a){const l=((t-i)*s+(e-r)*a)/(s*s+a*a);l>1?(i=n,r=o):l>0&&(i+=s*l,r+=a*l)}return s=t-i,a=e-r,s*s+a*a}function V(t,e,i,r){const n={id:null==t?null:t,type:e,geometry:i,tags:r,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if("Point"===e||"MultiPoint"===e||"LineString"===e)j(n,i);else if("Polygon"===e)j(n,i[0]);else if("MultiLineString"===e)for(const t of i)j(n,t);else if("MultiPolygon"===e)for(const t of i)j(n,t[0]);return n}function j(t,e){for(let i=0;i<e.length;i+=3)t.minX=Math.min(t.minX,e[i]),t.minY=Math.min(t.minY,e[i+1]),t.maxX=Math.max(t.maxX,e[i]),t.maxY=Math.max(t.maxY,e[i+1])}function H(t,e,i,r){if(!e.geometry)return;const n=e.geometry.coordinates;if(n&&0===n.length)return;const o=e.geometry.type,s=Math.pow(i.tolerance/((1<<i.maxZoom)*i.extent),2);let a=[],l=e.id;if(i.promoteId?l=e.properties[i.promoteId]:i.generateId&&(l=r||0),"Point"===o)G(n,a);else if("MultiPoint"===o)for(const t of n)G(t,a);else if("LineString"===o)$(n,a,s,!1);else if("MultiLineString"===o){if(i.lineMetrics){for(const i of n)a=[],$(i,a,s,!1),t.push(V(l,"LineString",a,e.properties));return}Z(n,a,s,!1)}else if("Polygon"===o)Z(n,a,s,!0);else{if("MultiPolygon"!==o){if("GeometryCollection"===o){for(const n of e.geometry.geometries)H(t,{id:l,geometry:n,properties:e.properties},i,r);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const t of n){const e=[];Z(t,e,s,!0),a.push(e)}}t.push(V(l,o,a,e.properties))}function G(t,e){e.push(q(t[0]),K(t[1]),0)}function $(t,e,i,r){let n,o,s=0;for(let i=0;i<t.length;i++){const a=q(t[i][0]),l=K(t[i][1]);e.push(a,l,0),i>0&&(s+=r?(n*l-a*o)/2:Math.sqrt(Math.pow(a-n,2)+Math.pow(l-o,2))),n=a,o=l}const a=e.length-3;e[2]=1,N(e,0,a,i),e[a+2]=1,e.size=Math.abs(s),e.start=0,e.end=e.size}function Z(t,e,i,r){for(let n=0;n<t.length;n++){const o=[];$(t[n],o,i,r),e.push(o)}}function q(t){return t/360+.5}function K(t){const e=Math.sin(t*Math.PI/180),i=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return i<0?0:i>1?1:i}function W(t,e,i,r,n,o,s,a){if(r/=e,o>=(i/=e)&&s<r)return t;if(s<i||o>=r)return null;const l=[];for(const e of t){const t=e.geometry;let o=e.type;const s=0===n?e.minX:e.minY,c=0===n?e.maxX:e.maxY;if(s>=i&&c<r){l.push(e);continue}if(c<i||s>=r)continue;let u=[];if("Point"===o||"MultiPoint"===o)X(t,u,i,r,n);else if("LineString"===o)J(t,u,i,r,n,!1,a.lineMetrics);else if("MultiLineString"===o)tt(t,u,i,r,n,!1);else if("Polygon"===o)tt(t,u,i,r,n,!0);else if("MultiPolygon"===o)for(const e of t){const t=[];tt(e,t,i,r,n,!0),t.length&&u.push(t)}if(u.length){if(a.lineMetrics&&"LineString"===o){for(const t of u)l.push(V(e.id,o,t,e.tags));continue}"LineString"!==o&&"MultiLineString"!==o||(1===u.length?(o="LineString",u=u[0]):o="MultiLineString"),"Point"!==o&&"MultiPoint"!==o||(o=3===u.length?"Point":"MultiPoint"),l.push(V(e.id,o,u,e.tags))}}return l.length?l:null}function X(t,e,i,r,n){for(let o=0;o<t.length;o+=3){const s=t[o+n];s>=i&&s<=r&&et(e,t[o],t[o+1],t[o+2])}}function J(t,e,i,r,n,o,s){let a=Y(t);const l=0===n?it:rt;let c,u,h=t.start;for(let d=0;d<t.length-3;d+=3){const p=t[d],f=t[d+1],A=t[d+2],m=t[d+3],g=t[d+4],_=0===n?p:f,y=0===n?m:g;let v=!1;s&&(c=Math.sqrt(Math.pow(p-m,2)+Math.pow(f-g,2))),_<i?y>i&&(u=l(a,p,f,m,g,i),s&&(a.start=h+c*u)):_>r?y<r&&(u=l(a,p,f,m,g,r),s&&(a.start=h+c*u)):et(a,p,f,A),y<i&&_>=i&&(u=l(a,p,f,m,g,i),v=!0),y>r&&_<=r&&(u=l(a,p,f,m,g,r),v=!0),!o&&v&&(s&&(a.end=h+c*u),e.push(a),a=Y(t)),s&&(h+=c)}let d=t.length-3;const p=t[d],f=t[d+1],A=0===n?p:f;A>=i&&A<=r&&et(a,p,f,t[d+2]),d=a.length-3,o&&d>=3&&(a[d]!==a[0]||a[d+1]!==a[1])&&et(a,a[0],a[1],a[2]),a.length&&e.push(a)}function Y(t){const e=[];return e.size=t.size,e.start=t.start,e.end=t.end,e}function tt(t,e,i,r,n,o){for(const s of t)J(s,e,i,r,n,o,!1)}function et(t,e,i,r){t.push(e,i,r)}function it(t,e,i,r,n,o){const s=(o-e)/(r-e);return et(t,o,i+(n-i)*s,1),s}function rt(t,e,i,r,n,o){const s=(o-i)/(n-i);return et(t,e+(r-e)*s,o,1),s}function nt(t,e){const i=[];for(let r=0;r<t.length;r++){const n=t[r],o=n.type;let s;if("Point"===o||"MultiPoint"===o||"LineString"===o)s=ot(n.geometry,e);else if("MultiLineString"===o||"Polygon"===o){s=[];for(const t of n.geometry)s.push(ot(t,e))}else if("MultiPolygon"===o){s=[];for(const t of n.geometry){const i=[];for(const r of t)i.push(ot(r,e));s.push(i)}}i.push(V(n.id,o,s,n.tags))}return i}function ot(t,e){const i=[];i.size=t.size,void 0!==t.start&&(i.start=t.start,i.end=t.end);for(let r=0;r<t.length;r+=3)i.push(t[r]+e,t[r+1],t[r+2]);return i}function st(t,e){if(t.transformed)return t;const i=1<<t.z,r=t.x,n=t.y;for(const o of t.features){const t=o.geometry,s=o.type;if(o.geometry=[],1===s)for(let s=0;s<t.length;s+=2)o.geometry.push(at(t[s],t[s+1],e,i,r,n));else for(let s=0;s<t.length;s++){const a=[];for(let o=0;o<t[s].length;o+=2)a.push(at(t[s][o],t[s][o+1],e,i,r,n));o.geometry.push(a)}}return t.transformed=!0,t}function at(t,e,i,r,n,o){return[Math.round(i*(t*r-n)),Math.round(i*(e*r-o))]}function lt(t,e,i,r,n){const o=e===n.maxZoom?0:n.tolerance/((1<<e)*n.extent),s={features:[],numPoints:0,numSimplified:0,numFeatures:t.length,source:null,x:i,y:r,z:e,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const e of t)ct(s,e,o,n);return s}function ct(t,e,i,r){const n=e.geometry,o=e.type,s=[];if(t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),"Point"===o||"MultiPoint"===o)for(let e=0;e<n.length;e+=3)s.push(n[e],n[e+1]),t.numPoints++,t.numSimplified++;else if("LineString"===o)ut(s,n,t,i,!1,!1);else if("MultiLineString"===o||"Polygon"===o)for(let e=0;e<n.length;e++)ut(s,n[e],t,i,"Polygon"===o,0===e);else if("MultiPolygon"===o)for(let e=0;e<n.length;e++){const r=n[e];for(let e=0;e<r.length;e++)ut(s,r[e],t,i,!0,0===e)}if(s.length){let i=e.tags||null;if("LineString"===o&&r.lineMetrics){i={};for(const t in e.tags)i[t]=e.tags[t];i.mapbox_clip_start=n.start/n.size,i.mapbox_clip_end=n.end/n.size}const a={geometry:s,type:"Polygon"===o||"MultiPolygon"===o?3:"LineString"===o||"MultiLineString"===o?2:1,tags:i};null!==e.id&&(a.id=e.id),t.features.push(a)}}function ut(t,e,i,r,n,o){const s=r*r;if(r>0&&e.size<(n?s:r))return void(i.numPoints+=e.length/3);const a=[];for(let t=0;t<e.length;t+=3)(0===r||e[t+2]>s)&&(i.numSimplified++,a.push(e[t],e[t+1])),i.numPoints++;n&&function(t,e){let i=0;for(let e=0,r=t.length,n=r-2;e<r;n=e,e+=2)i+=(t[e]-t[n])*(t[e+1]+t[n+1]);if(i>0===e)for(let e=0,i=t.length;e<i/2;e+=2){const r=t[e],n=t[e+1];t[e]=t[i-2-e],t[e+1]=t[i-1-e],t[i-2-e]=r,t[i-1-e]=n}}(a,o),t.push(a)}const ht={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class dt{constructor(t,e){const i=(e=this.options=function(t,e){for(const i in e)t[i]=e[i];return t}(Object.create(ht),e)).debug;if(i&&console.time("preprocess data"),e.maxZoom<0||e.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(e.promoteId&&e.generateId)throw new Error("promoteId and generateId cannot be used together.");let r=function(t,e){const i=[];if("FeatureCollection"===t.type)for(let r=0;r<t.features.length;r++)H(i,t.features[r],e,r);else H(i,"Feature"===t.type?t:{geometry:t},e);return i}(t,e);this.tiles={},this.tileCoords=[],i&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",e.indexMaxZoom,e.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),r=function(t,e){const i=e.buffer/e.extent;let r=t;const n=W(t,1,-1-i,i,0,-1,2,e),o=W(t,1,1-i,2+i,0,-1,2,e);return(n||o)&&(r=W(t,1,-i,1+i,0,-1,2,e)||[],n&&(r=nt(n,1).concat(r)),o&&(r=r.concat(nt(o,-1)))),r}(r,e),r.length&&this.splitTile(r,0,0,0),i&&(r.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(t,e,i,r,n,o,s){const a=[t,e,i,r],l=this.options,c=l.debug;for(;a.length;){r=a.pop(),i=a.pop(),e=a.pop(),t=a.pop();const u=1<<e,h=pt(e,i,r);let d=this.tiles[h];if(!d&&(c>1&&console.time("creation"),d=this.tiles[h]=lt(t,e,i,r,l),this.tileCoords.push({z:e,x:i,y:r}),c)){c>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",e,i,r,d.numFeatures,d.numPoints,d.numSimplified),console.timeEnd("creation"));const t=`z${e}`;this.stats[t]=(this.stats[t]||0)+1,this.total++}if(d.source=t,null==n){if(e===l.indexMaxZoom||d.numPoints<=l.indexMaxPoints)continue}else{if(e===l.maxZoom||e===n)continue;if(null!=n){const t=n-e;if(i!==o>>t||r!==s>>t)continue}}if(d.source=null,0===t.length)continue;c>1&&console.time("clipping");const p=.5*l.buffer/l.extent,f=.5-p,A=.5+p,m=1+p;let g=null,_=null,y=null,v=null,x=W(t,u,i-p,i+A,0,d.minX,d.maxX,l),b=W(t,u,i+f,i+m,0,d.minX,d.maxX,l);t=null,x&&(g=W(x,u,r-p,r+A,1,d.minY,d.maxY,l),_=W(x,u,r+f,r+m,1,d.minY,d.maxY,l),x=null),b&&(y=W(b,u,r-p,r+A,1,d.minY,d.maxY,l),v=W(b,u,r+f,r+m,1,d.minY,d.maxY,l),b=null),c>1&&console.timeEnd("clipping"),a.push(g||[],e+1,2*i,2*r),a.push(_||[],e+1,2*i,2*r+1),a.push(y||[],e+1,2*i+1,2*r),a.push(v||[],e+1,2*i+1,2*r+1)}}getTile(t,e,i){t=+t,e=+e,i=+i;const r=this.options,{extent:n,debug:o}=r;if(t<0||t>24)return null;const s=1<<t,a=pt(t,e=e+s&s-1,i);if(this.tiles[a])return st(this.tiles[a],n);o>1&&console.log("drilling down to z%d-%d-%d",t,e,i);let l,c=t,u=e,h=i;for(;!l&&c>0;)c--,u>>=1,h>>=1,l=this.tiles[pt(c,u,h)];return l&&l.source?(o>1&&(console.log("found parent tile z%d-%d-%d",c,u,h),console.time("drilling down")),this.splitTile(l.source,c,u,h,t,e,i),o>1&&console.timeEnd("drilling down"),this.tiles[a]?st(this.tiles[a],n):null):null}}function pt(t,e,i){return 32*((1<<t)*i+e)+t}function ft(t,e){return e?t.properties[e]:t.id}function At(t,e){if(null==t)return!0;if("Feature"===t.type)return null!=ft(t,e);if("FeatureCollection"===t.type){const i=new Set;for(const r of t.features){const t=ft(r,e);if(null==t)return!1;if(i.has(t))return!1;i.add(t)}return!0}return!1}function mt(t,e){const i=new Map;if(null==t);else if("Feature"===t.type)i.set(ft(t,e),t);else for(const r of t.features)i.set(ft(r,e),r);return i}class gt extends o{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(e,i){return t._(this,void 0,void 0,(function*(){const i=e.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const r=this._geoJSONIndex.getTile(i.z,i.x,i.y);if(!r)return null;const n=new class{constructor(e){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=t.X,this.length=e.length,this._features=e}feature(e){return new class{constructor(e){this._feature=e,this.extent=t.X,this.type=e.type,this.properties=e.tags,"id"in e&&!isNaN(e.id)&&(this.id=parseInt(e.id,10))}loadGeometry(){if(1===this._feature.type){const e=[];for(const i of this._feature.geometry)e.push([new t.P(i[0],i[1])]);return e}{const e=[];for(const i of this._feature.geometry){const r=[];for(const e of i)r.push(new t.P(e[0],e[1]));e.push(r)}return e}}toGeoJSON(t,e,i){return u.call(this,t,e,i)}}(this._features[e])}}(r.features);let o=C(n);return 0===o.byteOffset&&o.byteLength===o.buffer.byteLength||(o=new Uint8Array(o)),{vectorTile:n,rawData:o.buffer}}))}loadData(e){return t._(this,void 0,void 0,(function*(){var i;null===(i=this._pendingRequest)||void 0===i||i.abort();const r=!!(e&&e.request&&e.request.collectResourceTiming)&&new t.bv(e.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(e,this._pendingRequest),this._geoJSONIndex=e.cluster?new z(function({superclusterOptions:e,clusterProperties:i}){if(!i||!e)return e;const r={},n={},o={accumulated:null,zoom:0},s={properties:null},a=Object.keys(i);for(const e of a){const[o,s]=i[e],a=t.bC(s),l=t.bC("string"==typeof o?[o,["accumulated"],["get",e]]:o);r[e]=a.value,n[e]=l.value}return e.map=t=>{s.properties=t;const e={};for(const t of a)e[t]=r[t].evaluate(o,s);return e},e.reduce=(t,e)=>{s.properties=e;for(const e of a)o.accumulated=t[e],t[e]=n[e].evaluate(o,s)},e}(e)).load((yield this._pendingData).features):(n=yield this._pendingData,new dt(n,e.geojsonVtOptions)),this.loaded={};const i={};if(r){const t=r.finish();t&&(i.resourceTiming={},i.resourceTiming[e.source]=JSON.parse(JSON.stringify(t)))}return i}catch(e){if(delete this._pendingRequest,t.bB(e))return{abandoned:!0};throw e}var n}))}getData(){return t._(this,void 0,void 0,(function*(){return this._pendingData}))}reloadTile(t){const e=this.loaded;return e&&e[t.uid]?super.reloadTile(t):this.loadTile(t)}loadAndProcessGeoJSON(e,i){return t._(this,void 0,void 0,(function*(){let r=yield this.loadGeoJSON(e,i);if(delete this._pendingRequest,"object"!=typeof r)throw new Error(`Input data given to '${e.source}' is not a valid GeoJSON object.`);if(c(r,!0),e.filter){const i=t.bC(e.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===i.result)throw new Error(i.value.map((t=>`${t.key}: ${t.message}`)).join(", "));const n=r.features.filter((t=>i.value.evaluate({zoom:0},t)));r={type:"FeatureCollection",features:n}}return r}))}loadGeoJSON(e,i){return t._(this,void 0,void 0,(function*(){const{promoteId:r}=e;if(e.request){const n=yield t.h(e.request,i);return this._dataUpdateable=At(n.data,r)?mt(n.data,r):void 0,n.data}if("string"==typeof e.data)try{const t=JSON.parse(e.data);return this._dataUpdateable=At(t,r)?mt(t,r):void 0,t}catch(t){throw new Error(`Input data given to '${e.source}' is not a valid GeoJSON object.`)}if(!e.dataDiff)throw new Error(`Input data given to '${e.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${e.source}`);return function(t,e,i){var r,n,o,s;if(e.removeAll&&t.clear(),e.remove)for(const i of e.remove)t.delete(i);if(e.add)for(const r of e.add){const e=ft(r,i);null!=e&&t.set(e,r)}if(e.update)for(const i of e.update){let e=t.get(i.id);if(null==e)continue;const a=!i.removeAllProperties&&((null===(r=i.removeProperties)||void 0===r?void 0:r.length)>0||(null===(n=i.addOrUpdateProperties)||void 0===n?void 0:n.length)>0);if((i.newGeometry||i.removeAllProperties||a)&&(e=Object.assign({},e),t.set(i.id,e),a&&(e.properties=Object.assign({},e.properties))),i.newGeometry&&(e.geometry=i.newGeometry),i.removeAllProperties)e.properties={};else if((null===(o=i.removeProperties)||void 0===o?void 0:o.length)>0)for(const t of i.removeProperties)Object.prototype.hasOwnProperty.call(e.properties,t)&&delete e.properties[t];if((null===(s=i.addOrUpdateProperties)||void 0===s?void 0:s.length)>0)for(const{key:t,value:r}of i.addOrUpdateProperties)e.properties[t]=r}}(this._dataUpdateable,e.dataDiff,r),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}}))}removeSource(e){return t._(this,void 0,void 0,(function*(){this._pendingRequest&&this._pendingRequest.abort()}))}getClusterExpansionZoom(t){return this._geoJSONIndex.getClusterExpansionZoom(t.clusterId)}getClusterChildren(t){return this._geoJSONIndex.getChildren(t.clusterId)}getClusterLeaves(t){return this._geoJSONIndex.getLeaves(t.clusterId,t.limit,t.offset)}}class _t{constructor(e){this.self=e,this.actor=new t.F(e),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(t,e)=>{if(this.externalWorkerSourceTypes[t])throw new Error(`Worker source with name "${t}" already registered.`);this.externalWorkerSourceTypes[t]=e},this.self.addProtocol=t.bi,this.self.removeProtocol=t.bj,this.self.registerRTLTextPlugin=e=>{if(t.bD.isParsed())throw new Error("RTL text plugin already registered.");t.bD.setMethods(e)},this.actor.registerMessageHandler("LDT",((t,e)=>this._getDEMWorkerSource(t,e.source).loadTile(e))),this.actor.registerMessageHandler("RDT",((e,i)=>t._(this,void 0,void 0,(function*(){this._getDEMWorkerSource(e,i.source).removeTile(i)})))),this.actor.registerMessageHandler("GCEZ",((e,i)=>t._(this,void 0,void 0,(function*(){return this._getWorkerSource(e,i.type,i.source).getClusterExpansionZoom(i)})))),this.actor.registerMessageHandler("GCC",((e,i)=>t._(this,void 0,void 0,(function*(){return this._getWorkerSource(e,i.type,i.source).getClusterChildren(i)})))),this.actor.registerMessageHandler("GCL",((e,i)=>t._(this,void 0,void 0,(function*(){return this._getWorkerSource(e,i.type,i.source).getClusterLeaves(i)})))),this.actor.registerMessageHandler("LD",((t,e)=>this._getWorkerSource(t,e.type,e.source).loadData(e))),this.actor.registerMessageHandler("GD",((t,e)=>this._getWorkerSource(t,e.type,e.source).getData())),this.actor.registerMessageHandler("LT",((t,e)=>this._getWorkerSource(t,e.type,e.source).loadTile(e))),this.actor.registerMessageHandler("RT",((t,e)=>this._getWorkerSource(t,e.type,e.source).reloadTile(e))),this.actor.registerMessageHandler("AT",((t,e)=>this._getWorkerSource(t,e.type,e.source).abortTile(e))),this.actor.registerMessageHandler("RMT",((t,e)=>this._getWorkerSource(t,e.type,e.source).removeTile(e))),this.actor.registerMessageHandler("RS",((e,i)=>t._(this,void 0,void 0,(function*(){if(!this.workerSources[e]||!this.workerSources[e][i.type]||!this.workerSources[e][i.type][i.source])return;const t=this.workerSources[e][i.type][i.source];delete this.workerSources[e][i.type][i.source],void 0!==t.removeSource&&t.removeSource(i)})))),this.actor.registerMessageHandler("RM",(e=>t._(this,void 0,void 0,(function*(){delete this.layerIndexes[e],delete this.availableImages[e],delete this.workerSources[e],delete this.demWorkerSources[e]})))),this.actor.registerMessageHandler("SR",((e,i)=>t._(this,void 0,void 0,(function*(){this.referrer=i})))),this.actor.registerMessageHandler("SRPS",((t,e)=>this._syncRTLPluginState(t,e))),this.actor.registerMessageHandler("IS",((e,i)=>t._(this,void 0,void 0,(function*(){this.self.importScripts(i)})))),this.actor.registerMessageHandler("SI",((t,e)=>this._setImages(t,e))),this.actor.registerMessageHandler("UL",((e,i)=>t._(this,void 0,void 0,(function*(){this._getLayerIndex(e).update(i.layers,i.removedIds)})))),this.actor.registerMessageHandler("SL",((e,i)=>t._(this,void 0,void 0,(function*(){this._getLayerIndex(e).replace(i)}))))}_setImages(e,i){return t._(this,void 0,void 0,(function*(){this.availableImages[e]=i;for(const t in this.workerSources[e]){const r=this.workerSources[e][t];for(const t in r)r[t].availableImages=i}}))}_syncRTLPluginState(e,i){return t._(this,void 0,void 0,(function*(){if(t.bD.isParsed())return t.bD.getState();if("loading"!==i.pluginStatus)return t.bD.setState(i),i;const e=i.pluginURL;if(this.self.importScripts(e),t.bD.isParsed()){const i={pluginStatus:"loaded",pluginURL:e};return t.bD.setState(i),i}throw t.bD.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${e}`)}))}_getAvailableImages(t){let e=this.availableImages[t];return e||(e=[]),e}_getLayerIndex(t){let i=this.layerIndexes[t];return i||(i=this.layerIndexes[t]=new e),i}_getWorkerSource(t,e,i){if(this.workerSources[t]||(this.workerSources[t]={}),this.workerSources[t][e]||(this.workerSources[t][e]={}),!this.workerSources[t][e][i]){const r={sendAsync:(e,i)=>(e.targetMapId=t,this.actor.sendAsync(e,i))};switch(e){case"vector":this.workerSources[t][e][i]=new o(r,this._getLayerIndex(t),this._getAvailableImages(t));break;case"geojson":this.workerSources[t][e][i]=new gt(r,this._getLayerIndex(t),this._getAvailableImages(t));break;default:this.workerSources[t][e][i]=new this.externalWorkerSourceTypes[e](r,this._getLayerIndex(t),this._getAvailableImages(t))}}return this.workerSources[t][e][i]}_getDEMWorkerSource(t,e){return this.demWorkerSources[t]||(this.demWorkerSources[t]={}),this.demWorkerSources[t][e]||(this.demWorkerSources[t][e]=new s),this.demWorkerSources[t][e]}}return t.i(self)&&(self.worker=new _t(self)),_t})),i("index",["exports","./shared"],(function(t,e){var i="4.7.0";let r,n;const o={now:"undefined"!=typeof performance&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:t=>new Promise(((i,r)=>{const n=requestAnimationFrame(i);t.signal.addEventListener("abort",(()=>{cancelAnimationFrame(n),r(e.c())}))})),getImageData(t,e=0){return this.getImageCanvasContext(t).getImageData(-e,-e,t.width+2*e,t.height+2*e)},getImageCanvasContext(t){const e=window.document.createElement("canvas"),i=e.getContext("2d",{willReadFrequently:!0});if(!i)throw new Error("failed to create canvas 2d context");return e.width=t.width,e.height=t.height,i.drawImage(t,0,0,t.width,t.height),i},resolveURL:t=>(r||(r=document.createElement("a")),r.href=t,r.href),hardwareConcurrency:"undefined"!=typeof navigator&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(null==n&&(n=matchMedia("(prefers-reduced-motion: reduce)")),n.matches)}};class s{static testProp(t){if(!s.docStyle)return t[0];for(let e=0;e<t.length;e++)if(t[e]in s.docStyle)return t[e];return t[0]}static create(t,e,i){const r=window.document.createElement(t);return void 0!==e&&(r.className=e),i&&i.appendChild(r),r}static createNS(t,e){return window.document.createElementNS(t,e)}static disableDrag(){s.docStyle&&s.selectProp&&(s.userSelect=s.docStyle[s.selectProp],s.docStyle[s.selectProp]="none")}static enableDrag(){s.docStyle&&s.selectProp&&(s.docStyle[s.selectProp]=s.userSelect)}static setTransform(t,e){t.style[s.transformProp]=e}static addEventListener(t,e,i,r={}){t.addEventListener(e,i,"passive"in r?r:r.capture)}static removeEventListener(t,e,i,r={}){t.removeEventListener(e,i,"passive"in r?r:r.capture)}static suppressClickInternal(t){t.preventDefault(),t.stopPropagation(),window.removeEventListener("click",s.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",s.suppressClickInternal,!0),window.setTimeout((()=>{window.removeEventListener("click",s.suppressClickInternal,!0)}),0)}static getScale(t){const e=t.getBoundingClientRect();return{x:e.width/t.offsetWidth||1,y:e.height/t.offsetHeight||1,boundingClientRect:e}}static getPoint(t,i,r){const n=i.boundingClientRect;return new e.P((r.clientX-n.left)/i.x-t.clientLeft,(r.clientY-n.top)/i.y-t.clientTop)}static mousePos(t,e){const i=s.getScale(t);return s.getPoint(t,i,e)}static touchPos(t,e){const i=[],r=s.getScale(t);for(let n=0;n<e.length;n++)i.push(s.getPoint(t,r,e[n]));return i}static mouseButton(t){return t.button}static remove(t){t.parentNode&&t.parentNode.removeChild(t)}}s.docStyle="undefined"!=typeof window&&window.document&&window.document.documentElement.style,s.selectProp=s.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),s.transformProp=s.testProp(["transform","WebkitTransform"]);const a={supported:!1,testSupport:function(t){!u&&c&&(h?d(t):l=t)}};let l,c,u=!1,h=!1;function d(t){const e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,c),t.isContextLost())return;a.supported=!0}catch(t){}t.deleteTexture(e),u=!0}var p;"undefined"!=typeof document&&(c=document.createElement("img"),c.onload=()=>{l&&d(l),l=null,h=!0},c.onerror=()=>{u=!0,l=null},c.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(t){let i,r,n,o;t.resetRequestQueue=()=>{i=[],r=0,n=0,o={}},t.addThrottleControl=t=>{const e=n++;return o[e]=t,e},t.removeThrottleControl=t=>{delete o[t],l()},t.getImage=(t,r,n=!0)=>new Promise(((o,s)=>{a.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),e.e(t,{type:"image"}),i.push({abortController:r,requestParameters:t,supportImageRefresh:n,state:"queued",onError:t=>{s(t)},onSuccess:t=>{o(t)}}),l()}));const s=t=>e._(this,void 0,void 0,(function*(){t.state="running";const{requestParameters:i,supportImageRefresh:n,onError:o,onSuccess:s,abortController:a}=t,u=!1===n&&!e.i(self)&&!e.g(i.url)&&(!i.headers||Object.keys(i.headers).reduce(((t,e)=>t&&"accept"===e),!0));r++;const h=u?c(i,a):e.m(i,a);try{const i=yield h;delete t.abortController,t.state="completed",i.data instanceof HTMLImageElement||e.b(i.data)?s(i):i.data&&s({data:yield(d=i.data,"function"==typeof createImageBitmap?e.d(d):e.f(d)),cacheControl:i.cacheControl,expires:i.expires})}catch(e){delete t.abortController,o(e)}finally{r--,l()}var d})),l=()=>{const t=(()=>{for(const t of Object.keys(o))if(o[t]())return!0;return!1})()?e.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:e.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let e=r;e<t&&i.length>0;e++){const t=i.shift();t.abortController.signal.aborted?e--:s(t)}},c=(t,i)=>new Promise(((r,n)=>{const o=new Image,s=t.url,a=t.credentials;a&&"include"===a?o.crossOrigin="use-credentials":(a&&"same-origin"===a||!e.s(s))&&(o.crossOrigin="anonymous"),i.signal.addEventListener("abort",(()=>{o.src="",n(e.c())})),o.fetchPriority="high",o.onload=()=>{o.onerror=o.onload=null,r({data:o})},o.onerror=()=>{o.onerror=o.onload=null,i.signal.aborted||n(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},o.src=s}))}(p||(p={})),p.resetRequestQueue();class f{constructor(t){this._transformRequestFn=t}transformRequest(t,e){return this._transformRequestFn&&this._transformRequestFn(t,e)||{url:t}}setTransformRequest(t){this._transformRequestFn=t}}function A(t){var i=new e.A(3);return i[0]=t[0],i[1]=t[1],i[2]=t[2],i}var m,g=function(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t};m=new e.A(3),e.A!=Float32Array&&(m[0]=0,m[1]=0,m[2]=0);var _=function(t){var e=t[0],i=t[1];return e*e+i*i};function y(t){const e=[];if("string"==typeof t)e.push({id:"default",url:t});else if(t&&t.length>0){const i=[];for(const{id:r,url:n}of t){const t=`${r}${n}`;-1===i.indexOf(t)&&(i.push(t),e.push({id:r,url:n}))}}return e}function v(t,e,i){const r=t.split("?");return r[0]+=`${e}${i}`,r.join("?")}!function(){var t=new e.A(2);e.A!=Float32Array&&(t[0]=0,t[1]=0)}();class x{constructor(t,e,i,r){this.context=t,this.format=i,this.texture=t.gl.createTexture(),this.update(e,r)}update(t,i,r){const{width:n,height:o}=t,s=!(this.size&&this.size[0]===n&&this.size[1]===o||r),{context:a}=this,{gl:l}=a;if(this.useMipmap=Boolean(i&&i.useMipmap),l.bindTexture(l.TEXTURE_2D,this.texture),a.pixelStoreUnpackFlipY.set(!1),a.pixelStoreUnpack.set(1),a.pixelStoreUnpackPremultiplyAlpha.set(this.format===l.RGBA&&(!i||!1!==i.premultiply)),s)this.size=[n,o],t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||e.b(t)?l.texImage2D(l.TEXTURE_2D,0,this.format,this.format,l.UNSIGNED_BYTE,t):l.texImage2D(l.TEXTURE_2D,0,this.format,n,o,0,this.format,l.UNSIGNED_BYTE,t.data);else{const{x:i,y:s}=r||{x:0,y:0};t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||e.b(t)?l.texSubImage2D(l.TEXTURE_2D,0,i,s,l.RGBA,l.UNSIGNED_BYTE,t):l.texSubImage2D(l.TEXTURE_2D,0,i,s,n,o,l.RGBA,l.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&l.generateMipmap(l.TEXTURE_2D)}bind(t,e,i){const{context:r}=this,{gl:n}=r;n.bindTexture(n.TEXTURE_2D,this.texture),i!==n.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(i=n.LINEAR),t!==this.filter&&(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,t),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,i||t),this.filter=t),e!==this.wrap&&(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,e),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,e),this.wrap=e)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}function b(t){const{userImage:e}=t;return!!(e&&e.render&&e.render())&&(t.data.replace(new Uint8Array(e.data.buffer)),!0)}class w extends e.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new e.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:t,promiseResolve:e}of this.requestors)e(this._getImagesForIds(t));this.requestors=[]}}getImage(t){const i=this.images[t];if(i&&!i.data&&i.spriteData){const t=i.spriteData;i.data=new e.R({width:t.width,height:t.height},t.context.getImageData(t.x,t.y,t.width,t.height).data),i.spriteData=null}return i}addImage(t,e){if(this.images[t])throw new Error(`Image id ${t} already exist, use updateImage instead`);this._validate(t,e)&&(this.images[t]=e)}_validate(t,i){let r=!0;const n=i.data||i.spriteData;return this._validateStretch(i.stretchX,n&&n.width)||(this.fire(new e.j(new Error(`Image "${t}" has invalid "stretchX" value`))),r=!1),this._validateStretch(i.stretchY,n&&n.height)||(this.fire(new e.j(new Error(`Image "${t}" has invalid "stretchY" value`))),r=!1),this._validateContent(i.content,i)||(this.fire(new e.j(new Error(`Image "${t}" has invalid "content" value`))),r=!1),r}_validateStretch(t,e){if(!t)return!0;let i=0;for(const r of t){if(r[0]<i||r[1]<r[0]||e<r[1])return!1;i=r[1]}return!0}_validateContent(t,e){if(!t)return!0;if(4!==t.length)return!1;const i=e.spriteData,r=i&&i.width||e.data.width,n=i&&i.height||e.data.height;return!(t[0]<0||r<t[0]||t[1]<0||n<t[1]||t[2]<0||r<t[2]||t[3]<0||n<t[3]||t[2]<t[0]||t[3]<t[1])}updateImage(t,e,i=!0){const r=this.getImage(t);if(i&&(r.data.width!==e.data.width||r.data.height!==e.data.height))throw new Error(`size mismatch between old image (${r.data.width}x${r.data.height}) and new image (${e.data.width}x${e.data.height}).`);e.version=r.version+1,this.images[t]=e,this.updatedImages[t]=!0}removeImage(t){const e=this.images[t];delete this.images[t],delete this.patterns[t],e.userImage&&e.userImage.onRemove&&e.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t){return new Promise(((e,i)=>{let r=!0;if(!this.isLoaded())for(const e of t)this.images[e]||(r=!1);this.isLoaded()||r?e(this._getImagesForIds(t)):this.requestors.push({ids:t,promiseResolve:e})}))}_getImagesForIds(t){const i={};for(const r of t){let t=this.getImage(r);t||(this.fire(new e.k("styleimagemissing",{id:r})),t=this.getImage(r)),t?i[r]={data:t.data.clone(),pixelRatio:t.pixelRatio,sdf:t.sdf,version:t.version,stretchX:t.stretchX,stretchY:t.stretchY,content:t.content,textFitWidth:t.textFitWidth,textFitHeight:t.textFitHeight,hasRenderCallback:Boolean(t.userImage&&t.userImage.render)}:e.w(`Image "${r}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return i}getPixelSize(){const{width:t,height:e}=this.atlasImage;return{width:t,height:e}}getPattern(t){const i=this.patterns[t],r=this.getImage(t);if(!r)return null;if(i&&i.position.version===r.version)return i.position;if(i)i.position.version=r.version;else{const i={w:r.data.width+2,h:r.data.height+2,x:0,y:0},n=new e.I(i,r);this.patterns[t]={bin:i,position:n}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const e=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new x(t,this.atlasImage,e.RGBA),this.atlasTexture.bind(e.LINEAR,e.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const e in this.patterns)t.push(this.patterns[e].bin);const{w:i,h:r}=e.p(t),n=this.atlasImage;n.resize({width:i||1,height:r||1});for(const t in this.patterns){const{bin:i}=this.patterns[t],r=i.x+1,o=i.y+1,s=this.getImage(t).data,a=s.width,l=s.height;e.R.copy(s,n,{x:0,y:0},{x:r,y:o},{width:a,height:l}),e.R.copy(s,n,{x:0,y:l-1},{x:r,y:o-1},{width:a,height:1}),e.R.copy(s,n,{x:0,y:0},{x:r,y:o+l},{width:a,height:1}),e.R.copy(s,n,{x:a-1,y:0},{x:r-1,y:o},{width:1,height:l}),e.R.copy(s,n,{x:0,y:0},{x:r+a,y:o},{width:1,height:l})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const i of t){if(this.callbackDispatchedThisFrame[i])continue;this.callbackDispatchedThisFrame[i]=!0;const t=this.getImage(i);t||e.w(`Image with ID: "${i}" was not found`),b(t)&&this.updateImage(i,t)}}}const T=1e20;function B(t,e,i,r,n,o,s,a,l){for(let c=e;c<e+r;c++)E(t,i*o+c,o,n,s,a,l);for(let c=i;c<i+n;c++)E(t,c*o+e,1,r,s,a,l)}function E(t,e,i,r,n,o,s){o[0]=0,s[0]=-T,s[1]=T,n[0]=t[e];for(let a=1,l=0,c=0;a<r;a++){n[a]=t[e+a*i];const r=a*a;do{const t=o[l];c=(n[a]-n[t]+r-t*t)/(a-t)/2}while(c<=s[l]&&--l>-1);l++,o[l]=a,s[l]=c,s[l+1]=T}for(let a=0,l=0;a<r;a++){for(;s[l+1]<a;)l++;const r=o[l],c=a-r;t[e+a*i]=n[r]+c*c}}class C{constructor(t,e){this.requestManager=t,this.localIdeographFontFamily=e,this.entries={}}setURL(t){this.url=t}getGlyphs(t){return e._(this,void 0,void 0,(function*(){const e=[];for(const i in t)for(const r of t[i])e.push(this._getAndCacheGlyphsPromise(i,r));const i=yield Promise.all(e),r={};for(const{stack:t,id:e,glyph:n}of i)r[t]||(r[t]={}),r[t][e]=n&&{id:n.id,bitmap:n.bitmap.clone(),metrics:n.metrics};return r}))}_getAndCacheGlyphsPromise(t,i){return e._(this,void 0,void 0,(function*(){let e=this.entries[t];e||(e=this.entries[t]={glyphs:{},requests:{},ranges:{}});let r=e.glyphs[i];if(void 0!==r)return{stack:t,id:i,glyph:r};if(r=this._tinySDF(e,t,i),r)return e.glyphs[i]=r,{stack:t,id:i,glyph:r};const n=Math.floor(i/256);if(256*n>65535)throw new Error("glyphs > 65535 not supported");if(e.ranges[n])return{stack:t,id:i,glyph:r};if(!this.url)throw new Error("glyphsUrl is not set");if(!e.requests[n]){const i=C.loadGlyphRange(t,n,this.url,this.requestManager);e.requests[n]=i}const o=yield e.requests[n];for(const t in o)this._doesCharSupportLocalGlyph(+t)||(e.glyphs[+t]=o[+t]);return e.ranges[n]=!0,{stack:t,id:i,glyph:o[i]||null}}))}_doesCharSupportLocalGlyph(t){return!!this.localIdeographFontFamily&&/\p{Ideo}|\p{sc=Hang}|\p{sc=Hira}|\p{sc=Kana}/u.test(String.fromCodePoint(t))}_tinySDF(t,i,r){const n=this.localIdeographFontFamily;if(!n)return;if(!this._doesCharSupportLocalGlyph(r))return;let o=t.tinySDF;if(!o){let e="400";/bold/i.test(i)?e="900":/medium/i.test(i)?e="500":/light/i.test(i)&&(e="200"),o=t.tinySDF=new C.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:n,fontWeight:e})}const s=o.draw(String.fromCharCode(r));return{id:r,bitmap:new e.o({width:s.width||60,height:s.height||60},s.data),metrics:{width:s.glyphWidth/2||24,height:s.glyphHeight/2||24,left:s.glyphLeft/2+.5||0,top:s.glyphTop/2-27.5||-8,advance:s.glyphAdvance/2||24,isDoubleResolution:!0}}}}C.loadGlyphRange=function(t,i,r,n){return e._(this,void 0,void 0,(function*(){const o=256*i,s=o+255,a=n.transformRequest(r.replace("{fontstack}",t).replace("{range}",`${o}-${s}`),"Glyphs"),l=yield e.l(a,new AbortController);if(!l||!l.data)throw new Error(`Could not load glyph range. range: ${i}, ${o}-${s}`);const c={};for(const t of e.n(l.data))c[t.id]=t;return c}))},C.TinySDF=class{constructor({fontSize:t=24,buffer:e=3,radius:i=8,cutoff:r=.25,fontFamily:n="sans-serif",fontWeight:o="normal",fontStyle:s="normal"}={}){this.buffer=e,this.cutoff=r,this.radius=i;const a=this.size=t+4*e,l=this._createCanvas(a),c=this.ctx=l.getContext("2d",{willReadFrequently:!0});c.font=`${s} ${o} ${t}px ${n}`,c.textBaseline="alphabetic",c.textAlign="left",c.fillStyle="black",this.gridOuter=new Float64Array(a*a),this.gridInner=new Float64Array(a*a),this.f=new Float64Array(a),this.z=new Float64Array(a+1),this.v=new Uint16Array(a)}_createCanvas(t){const e=document.createElement("canvas");return e.width=e.height=t,e}draw(t){const{width:e,actualBoundingBoxAscent:i,actualBoundingBoxDescent:r,actualBoundingBoxLeft:n,actualBoundingBoxRight:o}=this.ctx.measureText(t),s=Math.ceil(i),a=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(o-n))),l=Math.min(this.size-this.buffer,s+Math.ceil(r)),c=a+2*this.buffer,u=l+2*this.buffer,h=Math.max(c*u,0),d=new Uint8ClampedArray(h),p={data:d,width:c,height:u,glyphWidth:a,glyphHeight:l,glyphTop:s,glyphLeft:0,glyphAdvance:e};if(0===a||0===l)return p;const{ctx:f,buffer:A,gridInner:m,gridOuter:g}=this;f.clearRect(A,A,a,l),f.fillText(t,A,A+s);const _=f.getImageData(A,A,a,l);g.fill(T,0,h),m.fill(0,0,h);for(let t=0;t<l;t++)for(let e=0;e<a;e++){const i=_.data[4*(t*a+e)+3]/255;if(0===i)continue;const r=(t+A)*c+e+A;if(1===i)g[r]=0,m[r]=T;else{const t=.5-i;g[r]=t>0?t*t:0,m[r]=t<0?t*t:0}}B(g,0,0,c,u,c,this.f,this.v,this.z),B(m,A,A,a,l,c,this.f,this.v,this.z);for(let t=0;t<h;t++){const e=Math.sqrt(g[t])-Math.sqrt(m[t]);d[t]=Math.round(255-255*(e/this.radius+this.cutoff))}return p}};class S{constructor(){this.specification=e.v.light.position}possiblyEvaluate(t,i){return e.x(t.expression.evaluate(i))}interpolate(t,i,r){return{x:e.y.number(t.x,i.x,r),y:e.y.number(t.y,i.y,r),z:e.y.number(t.z,i.z,r)}}}let I;class M extends e.E{constructor(t){super(),I=I||new e.q({anchor:new e.D(e.v.light.anchor),position:new S,color:new e.D(e.v.light.color),intensity:new e.D(e.v.light.intensity)}),this._transitionable=new e.T(I),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,i={}){if(!this._validate(e.r,t,i))for(const e in t){const i=t[e];e.endsWith("-transition")?this._transitionable.setTransition(e.slice(0,-11),i):this._transitionable.setValue(e,i)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,i,r){return(!r||!1!==r.validate)&&e.t(this,t.call(e.u,{value:i,style:{glyphs:!0,sprite:!0},styleSpec:e.v}))}}const k=new e.q({"sky-color":new e.D(e.v.sky["sky-color"]),"horizon-color":new e.D(e.v.sky["horizon-color"]),"fog-color":new e.D(e.v.sky["fog-color"]),"fog-ground-blend":new e.D(e.v.sky["fog-ground-blend"]),"horizon-fog-blend":new e.D(e.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new e.D(e.v.sky["sky-horizon-blend"]),"atmosphere-blend":new e.D(e.v.sky["atmosphere-blend"])});class P extends e.E{constructor(t){super(),this._transitionable=new e.T(k),this.setSky(t),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new e.z(0))}setSky(t,i={}){if(!this._validate(e.B,t,i)){t||(t={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const e in t){const i=t[e];e.endsWith("-transition")?this._transitionable.setTransition(e.slice(0,-11),i):this._transitionable.setValue(e,i)}}}getSky(){return this._transitionable.serialize()}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,i,r={}){return!1!==(null==r?void 0:r.validate)&&e.t(this,t.call(e.u,e.e({value:i,style:{glyphs:!0,sprite:!0},styleSpec:e.v})))}calculateFogBlendOpacity(t){return t<60?0:t<70?(t-60)/10:1}}class L{constructor(t,e){this.width=t,this.height=e,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(t,e){const i=t.join(",")+String(e);return this.dashEntry[i]||(this.dashEntry[i]=this.addDash(t,e)),this.dashEntry[i]}getDashRanges(t,e,i){const r=[];let n=t.length%2==1?-t[t.length-1]*i:0,o=t[0]*i,s=!0;r.push({left:n,right:o,isDash:s,zeroLength:0===t[0]});let a=t[0];for(let e=1;e<t.length;e++){s=!s;const l=t[e];n=a*i,a+=l,o=a*i,r.push({left:n,right:o,isDash:s,zeroLength:0===l})}return r}addRoundDash(t,e,i){const r=e/2;for(let e=-i;e<=i;e++){const n=this.width*(this.nextRow+i+e);let o=0,s=t[o];for(let a=0;a<this.width;a++){a/s.right>1&&(s=t[++o]);const l=Math.abs(a-s.left),c=Math.abs(a-s.right),u=Math.min(l,c);let h;const d=e/i*(r+1);if(s.isDash){const t=r-Math.abs(d);h=Math.sqrt(u*u+t*t)}else h=r-Math.sqrt(u*u+d*d);this.data[n+a]=Math.max(0,Math.min(255,h+128))}}}addRegularDash(t){for(let e=t.length-1;e>=0;--e){const i=t[e],r=t[e+1];i.zeroLength?t.splice(e,1):r&&r.isDash===i.isDash&&(r.left=i.left,t.splice(e,1))}const e=t[0],i=t[t.length-1];e.isDash===i.isDash&&(e.left=i.left-this.width,i.right=e.right+this.width);const r=this.width*this.nextRow;let n=0,o=t[n];for(let e=0;e<this.width;e++){e/o.right>1&&(o=t[++n]);const i=Math.abs(e-o.left),s=Math.abs(e-o.right),a=Math.min(i,s);this.data[r+e]=Math.max(0,Math.min(255,(o.isDash?a:-a)+128))}}addDash(t,i){const r=i?7:0,n=2*r+1;if(this.nextRow+n>this.height)return e.w("LineAtlas out of space"),null;let o=0;for(let e=0;e<t.length;e++)o+=t[e];if(0!==o){const e=this.width/o,n=this.getDashRanges(t,this.width,e);i?this.addRoundDash(n,e,r):this.addRegularDash(n)}const s={y:(this.nextRow+r+.5)/this.height,height:2*r/this.height,width:o};return this.nextRow+=n,this.dirty=!0,s}bind(t){const e=t.gl;this.texture?(e.bindTexture(e.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,e.texSubImage2D(e.TEXTURE_2D,0,0,0,this.width,this.height,e.ALPHA,e.UNSIGNED_BYTE,this.data))):(this.texture=e.createTexture(),e.bindTexture(e.TEXTURE_2D,this.texture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texImage2D(e.TEXTURE_2D,0,e.ALPHA,this.width,this.height,0,e.ALPHA,e.UNSIGNED_BYTE,this.data))}}const z="maplibre_preloaded_worker_pool";class F{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<F.workerCount;)this.workers.push(new Worker(e.a.WORKER_URL));return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],0===this.numActive()&&(this.workers.forEach((t=>{t.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[z]}numActive(){return Object.keys(this.active).length}}const D=Math.floor(o.hardwareConcurrency/2);let R,U;function O(){return R||(R=new F),R}F.workerCount=e.C(globalThis)?Math.max(Math.min(D,3),1):1;class N{constructor(t,i){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=i;const r=this.workerPool.acquire(i);for(let t=0;t<r.length;t++){const n=new e.F(r[t],i);n.name=`Worker ${t}`,this.actors.push(n)}if(!this.actors.length)throw new Error("No actors found")}broadcast(t,e){const i=[];for(const r of this.actors)i.push(r.sendAsync({type:t,data:e}));return Promise.all(i)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(t=!0){this.actors.forEach((t=>{t.remove()})),this.actors=[],t&&this.workerPool.release(this.id)}registerMessageHandler(t,e){for(const i of this.actors)i.registerMessageHandler(t,e)}}function Q(){return U||(U=new N(O(),e.G),U.registerMessageHandler("GR",((t,i,r)=>e.m(i,r)))),U}function V(t,i){const r=e.H();return e.J(r,r,[1,1,0]),e.K(r,r,[.5*t.width,.5*t.height,1]),e.L(r,r,t.calculatePosMatrix(i.toUnwrapped()))}function j(t,e,i,r,n,o){const s=function(t,e,i){if(t)for(const r of t){const t=e[r];if(t&&t.source===i&&"fill-extrusion"===t.type)return!0}else for(const t in e){const r=e[t];if(r.source===i&&"fill-extrusion"===r.type)return!0}return!1}(n&&n.layers,e,t.id),a=o.maxPitchScaleFactor(),l=t.tilesIn(r,a,s);l.sort(H);const c=[];for(const r of l)c.push({wrappedTileID:r.tileID.wrapped().key,queryResults:r.tile.queryRenderedFeatures(e,i,t._state,r.queryGeometry,r.cameraQueryGeometry,r.scale,n,o,a,V(t.transform,r.tileID))});const u=function(t){const e={},i={};for(const r of t){const t=r.queryResults,n=r.wrappedTileID,o=i[n]=i[n]||{};for(const i in t){const r=t[i],n=o[i]=o[i]||{},s=e[i]=e[i]||[];for(const t of r)n[t.featureIndex]||(n[t.featureIndex]=!0,s.push(t))}}return e}(c);for(const e in u)u[e].forEach((e=>{const i=e.feature,r=t.getFeatureState(i.layer["source-layer"],i.id);i.source=i.layer.source,i.layer["source-layer"]&&(i.sourceLayer=i.layer["source-layer"]),i.state=r}));return u}function H(t,e){const i=t.tileID,r=e.tileID;return i.overscaledZ-r.overscaledZ||i.canonical.y-r.canonical.y||i.wrap-r.wrap||i.canonical.x-r.canonical.x}function G(t,i,r){return e._(this,void 0,void 0,(function*(){let n=t;if(t.url?n=(yield e.h(i.transformRequest(t.url,"Source"),r)).data:yield o.frameAsync(r),!n)return null;const s=e.M(e.e(n,t),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in n&&n.vector_layers&&(s.vectorLayerIds=n.vector_layers.map((t=>t.id))),s}))}class ${constructor(t,e){t&&(e?this.setSouthWest(t).setNorthEast(e):Array.isArray(t)&&(4===t.length?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1])))}setNorthEast(t){return this._ne=t instanceof e.N?new e.N(t.lng,t.lat):e.N.convert(t),this}setSouthWest(t){return this._sw=t instanceof e.N?new e.N(t.lng,t.lat):e.N.convert(t),this}extend(t){const i=this._sw,r=this._ne;let n,o;if(t instanceof e.N)n=t,o=t;else{if(!(t instanceof $))return Array.isArray(t)?4===t.length||t.every(Array.isArray)?this.extend($.convert(t)):this.extend(e.N.convert(t)):t&&("lng"in t||"lon"in t)&&"lat"in t?this.extend(e.N.convert(t)):this;if(n=t._sw,o=t._ne,!n||!o)return this}return i||r?(i.lng=Math.min(n.lng,i.lng),i.lat=Math.min(n.lat,i.lat),r.lng=Math.max(o.lng,r.lng),r.lat=Math.max(o.lat,r.lat)):(this._sw=new e.N(n.lng,n.lat),this._ne=new e.N(o.lng,o.lat)),this}getCenter(){return new e.N((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new e.N(this.getWest(),this.getNorth())}getSouthEast(){return new e.N(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:i,lat:r}=e.N.convert(t);let n=this._sw.lng<=i&&i<=this._ne.lng;return this._sw.lng>this._ne.lng&&(n=this._sw.lng>=i&&i>=this._ne.lng),this._sw.lat<=r&&r<=this._ne.lat&&n}static convert(t){return t instanceof $?t:t?new $(t):t}static fromLngLat(t,i=0){const r=360*i/40075017,n=r/Math.cos(Math.PI/180*t.lat);return new $(new e.N(t.lng-n,t.lat-r),new e.N(t.lng+n,t.lat+r))}adjustAntiMeridian(){const t=new e.N(this._sw.lng,this._sw.lat),i=new e.N(this._ne.lng,this._ne.lat);return new $(t,t.lng>i.lng?new e.N(i.lng+360,i.lat):i)}}class Z{constructor(t,e,i){this.bounds=$.convert(this.validateBounds(t)),this.minzoom=e||0,this.maxzoom=i||24}validateBounds(t){return Array.isArray(t)&&4===t.length?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const i=Math.pow(2,t.z),r=Math.floor(e.O(this.bounds.getWest())*i),n=Math.floor(e.Q(this.bounds.getNorth())*i),o=Math.ceil(e.O(this.bounds.getEast())*i),s=Math.ceil(e.Q(this.bounds.getSouth())*i);return t.x>=r&&t.x<o&&t.y>=n&&t.y<s}}class q extends e.E{constructor(t,i,r,n){if(super(),this.id=t,this.dispatcher=r,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,e.e(this,e.M(i,["url","scheme","tileSize","promoteId"])),this._options=e.e({type:"vector"},i),this._collectResourceTiming=i.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(n)}load(){return e._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new e.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const t=yield G(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),t&&(e.e(this,t),t.bounds&&(this.tileBounds=new Z(t.bounds,this.minzoom,this.maxzoom)),this.fire(new e.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new e.k("data",{dataType:"source",sourceDataType:"content"})))}catch(t){this._tileJSONRequest=null,this.fire(new e.j(t))}}))}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.abort(),t(),this.load()}setTiles(t){return this.setSourceProperty((()=>{this._options.tiles=t})),this}setUrl(t){return this.setSourceProperty((()=>{this.url=t,this._options.url=t})),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return e.e({},this._options)}loadTile(t){return e._(this,void 0,void 0,(function*(){const e=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),i={request:this.map._requestManager.transformRequest(e,"Tile"),uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};i.request.collectResourceTiming=this._collectResourceTiming;let r="RT";if(t.actor&&"expired"!==t.state){if("loading"===t.state)return new Promise(((e,i)=>{t.reloadPromise={resolve:e,reject:i}}))}else t.actor=this.dispatcher.getActor(),r="LT";t.abortController=new AbortController;try{const e=yield t.actor.sendAsync({type:r,data:i},t.abortController);if(delete t.abortController,t.aborted)return;this._afterTileLoadWorkerResponse(t,e)}catch(e){if(delete t.abortController,t.aborted)return;if(e&&404!==e.status)throw e;this._afterTileLoadWorkerResponse(t,null)}}))}_afterTileLoadWorkerResponse(t,e){if(e&&e.resourceTiming&&(t.resourceTiming=e.resourceTiming),e&&this.map._refreshExpiredTiles&&t.setExpiryData(e),t.loadVectorData(e,this.map.painter),t.reloadPromise){const e=t.reloadPromise;t.reloadPromise=null,this.loadTile(t).then(e.resolve).catch(e.reject)}}abortTile(t){return e._(this,void 0,void 0,(function*(){t.abortController&&(t.abortController.abort(),delete t.abortController),t.actor&&(yield t.actor.sendAsync({type:"AT",data:{uid:t.uid,type:this.type,source:this.id}}))}))}unloadTile(t){return e._(this,void 0,void 0,(function*(){t.unloadVectorData(),t.actor&&(yield t.actor.sendAsync({type:"RMT",data:{uid:t.uid,type:this.type,source:this.id}}))}))}hasTransition(){return!1}}class K extends e.E{constructor(t,i,r,n){super(),this.id=t,this.dispatcher=r,this.setEventedParent(n),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=e.e({type:"raster"},i),e.e(this,e.M(i,["url","scheme","tileSize"]))}load(){return e._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new e.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const t=yield G(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,t&&(e.e(this,t),t.bounds&&(this.tileBounds=new Z(t.bounds,this.minzoom,this.maxzoom)),this.fire(new e.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new e.k("data",{dataType:"source",sourceDataType:"content"})))}catch(t){this._tileJSONRequest=null,this.fire(new e.j(t))}}))}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(t){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),t(),this.load()}setTiles(t){return this.setSourceProperty((()=>{this._options.tiles=t})),this}setUrl(t){return this.setSourceProperty((()=>{this.url=t,this._options.url=t})),this}serialize(){return e.e({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t){return e._(this,void 0,void 0,(function*(){const e=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);t.abortController=new AbortController;try{const i=yield p.getImage(this.map._requestManager.transformRequest(e,"Tile"),t.abortController,this.map._refreshExpiredTiles);if(delete t.abortController,t.aborted)return void(t.state="unloaded");if(i&&i.data){this.map._refreshExpiredTiles&&i.cacheControl&&i.expires&&t.setExpiryData({cacheControl:i.cacheControl,expires:i.expires});const e=this.map.painter.context,r=e.gl,n=i.data;t.texture=this.map.painter.getTileTexture(n.width),t.texture?t.texture.update(n,{useMipmap:!0}):(t.texture=new x(e,n,r.RGBA,{useMipmap:!0}),t.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE,r.LINEAR_MIPMAP_NEAREST)),t.state="loaded"}}catch(e){if(delete t.abortController,t.aborted)t.state="unloaded";else if(e)throw t.state="errored",e}}))}abortTile(t){return e._(this,void 0,void 0,(function*(){t.abortController&&(t.abortController.abort(),delete t.abortController)}))}unloadTile(t){return e._(this,void 0,void 0,(function*(){t.texture&&this.map.painter.saveTileTexture(t.texture)}))}hasTransition(){return!1}}class W extends K{constructor(t,i,r,n){super(t,i,r,n),this.type="raster-dem",this.maxzoom=22,this._options=e.e({type:"raster-dem"},i),this.encoding=i.encoding||"mapbox",this.redFactor=i.redFactor,this.greenFactor=i.greenFactor,this.blueFactor=i.blueFactor,this.baseShift=i.baseShift}loadTile(t){return e._(this,void 0,void 0,(function*(){const i=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),r=this.map._requestManager.transformRequest(i,"Tile");t.neighboringTiles=this._getNeighboringTiles(t.tileID),t.abortController=new AbortController;try{const i=yield p.getImage(r,t.abortController,this.map._refreshExpiredTiles);if(delete t.abortController,t.aborted)return void(t.state="unloaded");if(i&&i.data){const r=i.data;this.map._refreshExpiredTiles&&i.cacheControl&&i.expires&&t.setExpiryData({cacheControl:i.cacheControl,expires:i.expires});const n=e.b(r)&&e.U()?r:yield this.readImageNow(r),o={type:this.type,uid:t.uid,source:this.id,rawImageData:n,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!t.actor||"expired"===t.state){t.actor=this.dispatcher.getActor();const e=yield t.actor.sendAsync({type:"LDT",data:o});t.dem=e,t.needsHillshadePrepare=!0,t.needsTerrainPrepare=!0,t.state="loaded"}}}catch(e){if(delete t.abortController,t.aborted)t.state="unloaded";else if(e)throw t.state="errored",e}}))}readImageNow(t){return e._(this,void 0,void 0,(function*(){if("undefined"!=typeof VideoFrame&&e.V()){const i=t.width+2,r=t.height+2;try{return new e.R({width:i,height:r},yield e.W(t,-1,-1,i,r))}catch(t){}}return o.getImageData(t,1)}))}_getNeighboringTiles(t){const i=t.canonical,r=Math.pow(2,i.z),n=(i.x-1+r)%r,o=0===i.x?t.wrap-1:t.wrap,s=(i.x+1+r)%r,a=i.x+1===r?t.wrap+1:t.wrap,l={};return l[new e.S(t.overscaledZ,o,i.z,n,i.y).key]={backfilled:!1},l[new e.S(t.overscaledZ,a,i.z,s,i.y).key]={backfilled:!1},i.y>0&&(l[new e.S(t.overscaledZ,o,i.z,n,i.y-1).key]={backfilled:!1},l[new e.S(t.overscaledZ,t.wrap,i.z,i.x,i.y-1).key]={backfilled:!1},l[new e.S(t.overscaledZ,a,i.z,s,i.y-1).key]={backfilled:!1}),i.y+1<r&&(l[new e.S(t.overscaledZ,o,i.z,n,i.y+1).key]={backfilled:!1},l[new e.S(t.overscaledZ,t.wrap,i.z,i.x,i.y+1).key]={backfilled:!1},l[new e.S(t.overscaledZ,a,i.z,s,i.y+1).key]={backfilled:!1}),l}unloadTile(t){return e._(this,void 0,void 0,(function*(){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",t.actor&&(yield t.actor.sendAsync({type:"RDT",data:{type:this.type,uid:t.uid,source:this.id}}))}))}}class X extends e.E{constructor(t,i,r,n){super(),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=r.getActor(),this.setEventedParent(n),this._data=i.data,this._options=e.e({},i),this._collectResourceTiming=i.collectResourceTiming,void 0!==i.maxzoom&&(this.maxzoom=i.maxzoom),i.type&&(this.type=i.type),i.attribution&&(this.attribution=i.attribution),this.promoteId=i.promoteId;const o=e.X/this.tileSize;void 0!==i.clusterMaxZoom&&this.maxzoom<=i.clusterMaxZoom&&e.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${i.clusterMaxZoom}".`),this.workerOptions=e.e({source:this.id,cluster:i.cluster||!1,geojsonVtOptions:{buffer:(void 0!==i.buffer?i.buffer:128)*o,tolerance:(void 0!==i.tolerance?i.tolerance:.375)*o,extent:e.X,maxZoom:this.maxzoom,lineMetrics:i.lineMetrics||!1,generateId:i.generateId||!1},superclusterOptions:{maxZoom:void 0!==i.clusterMaxZoom?i.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,i.clusterMinPoints||2),extent:e.X,radius:(i.clusterRadius||50)*o,log:!1,generateId:i.generateId||!1},clusterProperties:i.clusterProperties,filter:i.filter},i.workerOptions),"string"==typeof this.promoteId&&(this.workerOptions.promoteId=this.promoteId)}load(){return e._(this,void 0,void 0,(function*(){yield this._updateWorkerData()}))}onAdd(t){this.map=t,this.load()}setData(t){return this._data=t,this._updateWorkerData(),this}updateData(t){return this._updateWorkerData(t),this}getData(){return e._(this,void 0,void 0,(function*(){const t=e.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:t})}))}setClusterOptions(t){return this.workerOptions.cluster=t.cluster,t&&(void 0!==t.clusterRadius&&(this.workerOptions.superclusterOptions.radius=t.clusterRadius),void 0!==t.clusterMaxZoom&&(this.workerOptions.superclusterOptions.maxZoom=t.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(t){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:t,source:this.id}})}getClusterChildren(t){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:t,source:this.id}})}getClusterLeaves(t,e,i){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:t,limit:e,offset:i}})}_updateWorkerData(t){return e._(this,void 0,void 0,(function*(){const i=e.e({type:this.type},this.workerOptions);t?i.dataDiff=t:"string"==typeof this._data?(i.request=this.map._requestManager.transformRequest(o.resolveURL(this._data),"Source"),i.request.collectResourceTiming=this._collectResourceTiming):i.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new e.k("dataloading",{dataType:"source"}));try{const t=yield this.actor.sendAsync({type:"LD",data:i});if(this._pendingLoads--,this._removed||t.abandoned)return void this.fire(new e.k("dataabort",{dataType:"source"}));let r=null;t.resourceTiming&&t.resourceTiming[this.id]&&(r=t.resourceTiming[this.id].slice(0));const n={dataType:"source"};this._collectResourceTiming&&r&&r.length>0&&e.e(n,{resourceTiming:r}),this.fire(new e.k("data",Object.assign(Object.assign({},n),{sourceDataType:"metadata"}))),this.fire(new e.k("data",Object.assign(Object.assign({},n),{sourceDataType:"content"})))}catch(t){if(this._pendingLoads--,this._removed)return void this.fire(new e.k("dataabort",{dataType:"source"}));this.fire(new e.j(t))}}))}loaded(){return 0===this._pendingLoads}loadTile(t){return e._(this,void 0,void 0,(function*(){const e=t.actor?"RT":"LT";t.actor=this.actor;const i={type:this.type,uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};t.abortController=new AbortController;const r=yield this.actor.sendAsync({type:e,data:i},t.abortController);delete t.abortController,t.unloadVectorData(),t.aborted||t.loadVectorData(r,this.map.painter,"RT"===e)}))}abortTile(t){return e._(this,void 0,void 0,(function*(){t.abortController&&(t.abortController.abort(),delete t.abortController),t.aborted=!0}))}unloadTile(t){return e._(this,void 0,void 0,(function*(){t.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:t.uid,type:this.type,source:this.id}})}))}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return e.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var J=e.Y([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Y extends e.E{constructor(t,e,i,r){super(),this.id=t,this.dispatcher=i,this.coordinates=e.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(r),this.options=e}load(t){return e._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new e.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const e=yield p.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,e&&e.data&&(this.image=e.data,t&&(this.coordinates=t),this._finishLoading())}catch(t){this._request=null,this._loaded=!0,this.fire(new e.j(t))}}))}loaded(){return this._loaded}updateImage(t){return t.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=t.url,this.load(t.coordinates).finally((()=>{this.texture=null})),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new e.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(t){this.coordinates=t;const i=t.map(e.Z.fromLngLat);this.tileID=function(t){let i=1/0,r=1/0,n=-1/0,o=-1/0;for(const e of t)i=Math.min(i,e.x),r=Math.min(r,e.y),n=Math.max(n,e.x),o=Math.max(o,e.y);const s=Math.max(n-i,o-r),a=Math.max(0,Math.floor(-Math.log(s)/Math.LN2)),l=Math.pow(2,a);return new e.a1(a,Math.floor((i+n)/2*l),Math.floor((r+o)/2*l))}(i),this.minzoom=this.maxzoom=this.tileID.z;const r=i.map((t=>this.tileID.getTilePoint(t)._round()));return this._boundsArray=new e.$,this._boundsArray.emplaceBack(r[0].x,r[0].y,0,0),this._boundsArray.emplaceBack(r[1].x,r[1].y,e.X,0),this._boundsArray.emplaceBack(r[3].x,r[3].y,0,e.X),this._boundsArray.emplaceBack(r[2].x,r[2].y,e.X,e.X),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new e.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const t=this.map.painter.context,i=t.gl;this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,J.members)),this.boundsSegments||(this.boundsSegments=e.a0.simpleSegment(0,0,4,2)),this.texture||(this.texture=new x(t,this.image,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE));let r=!1;for(const t in this.tiles){const e=this.tiles[t];"loaded"!==e.state&&(e.state="loaded",e.texture=this.texture,r=!0)}r&&this.fire(new e.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(t){return e._(this,void 0,void 0,(function*(){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={}):t.state="errored"}))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class tt extends Y{constructor(t,e,i,r){super(t,e,i,r),this.roundZoom=!0,this.type="video",this.options=e}load(){return e._(this,void 0,void 0,(function*(){this._loaded=!1;const t=this.options;this.urls=[];for(const e of t.urls)this.urls.push(this.map._requestManager.transformRequest(e,"Source").url);try{const t=yield e.a3(this.urls);if(this._loaded=!0,!t)return;this.video=t,this.video.loop=!0,this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading()}catch(t){this.fire(new e.j(t))}}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const i=this.video.seekable;t<i.start(0)||t>i.end(0)?this.fire(new e.j(new e.a2(`sources.${this.id}`,null,`Playback for this video can be set only between the ${i.start(0)} and ${i.end(0)}-second mark.`))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const t=this.map.painter.context,i=t.gl;this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,J.members)),this.boundsSegments||(this.boundsSegments=e.a0.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),i.texSubImage2D(i.TEXTURE_2D,0,0,0,i.RGBA,i.UNSIGNED_BYTE,this.video)):(this.texture=new x(t,this.video,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE));let r=!1;for(const t in this.tiles){const e=this.tiles[t];"loaded"!==e.state&&(e.state="loaded",e.texture=this.texture,r=!0)}r&&this.fire(new e.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class et extends Y{constructor(t,i,r,n){super(t,i,r,n),i.coordinates?Array.isArray(i.coordinates)&&4===i.coordinates.length&&!i.coordinates.some((t=>!Array.isArray(t)||2!==t.length||t.some((t=>"number"!=typeof t))))||this.fire(new e.j(new e.a2(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new e.j(new e.a2(`sources.${t}`,null,'missing required property "coordinates"'))),i.animate&&"boolean"!=typeof i.animate&&this.fire(new e.j(new e.a2(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),i.canvas?"string"==typeof i.canvas||i.canvas instanceof HTMLCanvasElement||this.fire(new e.j(new e.a2(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new e.j(new e.a2(`sources.${t}`,null,'missing required property "canvas"'))),this.options=i,this.animate=void 0===i.animate||i.animate}load(){return e._(this,void 0,void 0,(function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new e.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}))}getCanvas(){return this.canvas}onAdd(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),this._hasInvalidDimensions())return;if(0===Object.keys(this.tiles).length)return;const i=this.map.painter.context,r=i.gl;this.boundsBuffer||(this.boundsBuffer=i.createVertexBuffer(this._boundsArray,J.members)),this.boundsSegments||(this.boundsSegments=e.a0.simpleSegment(0,0,4,2)),this.texture?(t||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new x(i,this.canvas,r.RGBA,{premultiply:!0});let n=!1;for(const t in this.tiles){const e=this.tiles[t];"loaded"!==e.state&&(e.state="loaded",e.texture=this.texture,n=!0)}n&&this.fire(new e.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const t of[this.canvas.width,this.canvas.height])if(isNaN(t)||t<=0)return!0;return!1}}const it={},rt=t=>{switch(t){case"geojson":return X;case"image":return Y;case"raster":return K;case"raster-dem":return W;case"vector":return q;case"video":return tt;case"canvas":return et}return it[t]},nt="RTLPluginLoaded";class ot extends e.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=Q()}_syncState(t){return this.status=t,this.dispatcher.broadcast("SRPS",{pluginStatus:t,pluginURL:this.url}).catch((t=>{throw this.status="error",t}))}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(t){return e._(this,arguments,void 0,(function*(t,e=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=o.resolveURL(t),!this.url)throw new Error(`requested url ${t} is invalid`);if("unavailable"===this.status){if(!e)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if("requested"===this.status)return this._requestImport()}))}_requestImport(){return e._(this,void 0,void 0,(function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new e.k(nt))}))}lazyLoad(){"unavailable"===this.status?this.status="requested":"deferred"===this.status&&this._requestImport()}}let st=null;function at(){return st||(st=new ot),st}class lt{constructor(t,i){this.timeAdded=0,this.fadeEndTime=0,this.tileID=t,this.uid=e.a4(),this.uses=0,this.tileSize=i,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(t){const e=t+this.timeAdded;e<this.fadeEndTime||(this.fadeEndTime=e)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}clearTextures(t){this.demTexture&&t.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(t,i,r){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(t,e){const i={};if(!e)return i;for(const r of t){const t=r.layerIds.map((t=>e.getLayer(t))).filter(Boolean);if(0!==t.length){r.layers=t,r.stateDependentLayerIds&&(r.stateDependentLayers=r.stateDependentLayerIds.map((e=>t.filter((t=>t.id===e))[0])));for(const e of t)i[e.id]=r}}return i}(t.buckets,i.style),this.hasSymbolBuckets=!1;for(const t in this.buckets){const i=this.buckets[t];if(i instanceof e.a6){if(this.hasSymbolBuckets=!0,!r)break;i.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const t in this.buckets){const i=this.buckets[t];if(i instanceof e.a6&&i.hasRTLText){this.hasRTLText=!0,at().lazyLoad();break}}this.queryPadding=0;for(const t in this.buckets){const e=this.buckets[t];this.queryPadding=Math.max(this.queryPadding,i.style.getLayer(t).queryRadius(e))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new e.a5}unloadVectorData(){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(t){return this.buckets[t.id]}upload(t){for(const e in this.buckets){const i=this.buckets[e];i.uploadPending()&&i.upload(t)}const e=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new x(t,this.imageAtlas.image,e.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new x(t,this.glyphAtlasImage,e.ALPHA),this.glyphAtlasImage=null)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,e,i,r,n,o,s,a,l,c){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:r,cameraQueryGeometry:n,scale:o,tileSize:this.tileSize,pixelPosMatrix:c,transform:a,params:s,queryPadding:this.queryPadding*l},t,e,i):{}}querySourceFeatures(t,i){const r=this.latestFeatureIndex;if(!r||!r.rawTileData)return;const n=r.loadVTLayers(),o=i&&i.sourceLayer?i.sourceLayer:"",s=n._geojsonTileLayer||n[o];if(!s)return;const a=e.a7(i&&i.filter),{z:l,x:c,y:u}=this.tileID.canonical,h={z:l,x:c,y:u};for(let i=0;i<s.length;i++){const n=s.feature(i);if(a.needGeometry){const t=e.a8(n,!0);if(!a.filter(new e.z(this.tileID.overscaledZ),t,this.tileID.canonical))continue}else if(!a.filter(new e.z(this.tileID.overscaledZ),n))continue;const d=r.getId(n,o),p=new e.a9(n,l,c,u,d);p.tile=h,t.push(p)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const i=this.expirationTime;if(t.cacheControl){const i=e.aa(t.cacheControl);i["max-age"]&&(this.expirationTime=Date.now()+1e3*i["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const t=Date.now();let e=!1;if(this.expirationTime>t)e=!1;else if(i)if(this.expirationTime<i)e=!0;else{const r=this.expirationTime-i;r?this.expirationTime=t+Math.max(r,3e4):e=!0}else e=!0;e?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(t,e){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(t).length)return;const i=this.latestFeatureIndex.loadVTLayers();for(const r in this.buckets){if(!e.style.hasLayer(r))continue;const n=this.buckets[r],o=n.layers[0].sourceLayer||"_geojsonTileLayer",s=i[o],a=t[o];if(!s||!a||0===Object.keys(a).length)continue;n.update(a,s,this.imageAtlas&&this.imageAtlas.patternPositions||{});const l=e&&e.style&&e.style.getLayer(r);l&&(this.queryPadding=Math.max(this.queryPadding,l.queryRadius(n)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<o.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=o.now()+t}setDependencies(t,e){const i={};for(const t of e)i[t]=!0;this.dependencies[t]=i}hasDependency(t,e){for(const i of t){const t=this.dependencies[i];if(t)for(const i of e)if(t[i])return!0}return!1}}class ct{constructor(t,e){this.max=t,this.onRemove=e,this.reset()}reset(){for(const t in this.data)for(const e of this.data[t])e.timeout&&clearTimeout(e.timeout),this.onRemove(e.value);return this.data={},this.order=[],this}add(t,e,i){const r=t.wrapped().key;void 0===this.data[r]&&(this.data[r]=[]);const n={value:e,timeout:void 0};if(void 0!==i&&(n.timeout=setTimeout((()=>{this.remove(t,n)}),i)),this.data[r].push(n),this.order.push(r),this.order.length>this.max){const t=this._getAndRemoveByKey(this.order[0]);t&&this.onRemove(t)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const e=this.data[t].shift();return e.timeout&&clearTimeout(e.timeout),0===this.data[t].length&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),e.value}getByKey(t){const e=this.data[t];return e?e[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,e){if(!this.has(t))return this;const i=t.wrapped().key,r=void 0===e?0:this.data[i].indexOf(e),n=this.data[i][r];return this.data[i].splice(r,1),n.timeout&&clearTimeout(n.timeout),0===this.data[i].length&&delete this.data[i],this.onRemove(n.value),this.order.splice(this.order.indexOf(i),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const t=this._getAndRemoveByKey(this.order[0]);t&&this.onRemove(t)}return this}filter(t){const e=[];for(const i in this.data)for(const r of this.data[i])t(r.value)||e.push(r);for(const t of e)this.remove(t.value.tileID,t)}}class ut{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,i,r){const n=String(i);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][n]=this.stateChanges[t][n]||{},e.e(this.stateChanges[t][n],r),null===this.deletedStates[t]){this.deletedStates[t]={};for(const e in this.state[t])e!==n&&(this.deletedStates[t][e]=null)}else if(this.deletedStates[t]&&null===this.deletedStates[t][n]){this.deletedStates[t][n]={};for(const e in this.state[t][n])r[e]||(this.deletedStates[t][n][e]=null)}else for(const e in r)this.deletedStates[t]&&this.deletedStates[t][n]&&null===this.deletedStates[t][n][e]&&delete this.deletedStates[t][n][e]}removeFeatureState(t,e,i){if(null===this.deletedStates[t])return;const r=String(e);if(this.deletedStates[t]=this.deletedStates[t]||{},i&&void 0!==e)null!==this.deletedStates[t][r]&&(this.deletedStates[t][r]=this.deletedStates[t][r]||{},this.deletedStates[t][r][i]=null);else if(void 0!==e)if(this.stateChanges[t]&&this.stateChanges[t][r])for(i in this.deletedStates[t][r]={},this.stateChanges[t][r])this.deletedStates[t][r][i]=null;else this.deletedStates[t][r]=null;else this.deletedStates[t]=null}getState(t,i){const r=String(i),n=e.e({},(this.state[t]||{})[r],(this.stateChanges[t]||{})[r]);if(null===this.deletedStates[t])return{};if(this.deletedStates[t]){const e=this.deletedStates[t][i];if(null===e)return{};for(const t in e)delete n[t]}return n}initializeTileState(t,e){t.setFeatureState(this.state,e)}coalesceChanges(t,i){const r={};for(const t in this.stateChanges){this.state[t]=this.state[t]||{};const i={};for(const r in this.stateChanges[t])this.state[t][r]||(this.state[t][r]={}),e.e(this.state[t][r],this.stateChanges[t][r]),i[r]=this.state[t][r];r[t]=i}for(const t in this.deletedStates){this.state[t]=this.state[t]||{};const i={};if(null===this.deletedStates[t])for(const e in this.state[t])i[e]={},this.state[t][e]={};else for(const e in this.deletedStates[t]){if(null===this.deletedStates[t][e])this.state[t][e]={};else for(const i of Object.keys(this.deletedStates[t][e]))delete this.state[t][e][i];i[e]=this.state[t][e]}r[t]=r[t]||{},e.e(r[t],i)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(r).length)for(const e in t)t[e].setFeatureState(r,i)}}class ht extends e.E{constructor(t,e,i){super(),this.id=t,this.dispatcher=i,this.on("data",(t=>this._dataHandler(t))),this.on("dataloading",(()=>{this._sourceErrored=!1})),this.on("error",(()=>{this._sourceErrored=this._source.loaded()})),this._source=((t,e,i,r)=>{const n=new(rt(e.type))(t,e,i,r);if(n.id!==t)throw new Error(`Expected Source id to be ${t} instead of ${n.id}`);return n})(t,e,i,this),this._tiles={},this._cache=new ct(0,(t=>this._unloadTile(t))),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new ut,this._didEmitContent=!1,this._updated=!1}onAdd(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._maxTileCacheZoomLevels=t?t._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(t)}onRemove(t){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(t)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded)return!1;if(!this._source.loaded())return!1;if(!(void 0===this.used&&void 0===this.usedForTerrain||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const t in this._tiles){const e=this._tiles[t];if("loaded"!==e.state&&"errored"!==e.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(t,i,r){return e._(this,void 0,void 0,(function*(){try{yield this._source.loadTile(t),this._tileLoaded(t,i,r)}catch(i){t.state="errored",404!==i.status?this._source.fire(new e.j(i,{tile:t})):this.update(this.transform,this.terrain)}}))}_unloadTile(t){this._source.unloadTile&&this._source.unloadTile(t)}_abortTile(t){this._source.abortTile&&this._source.abortTile(t),this._source.fire(new e.k("dataabort",{tile:t,coord:t.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const e in this._tiles){const i=this._tiles[e];i.upload(t),i.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map((t=>t.tileID)).sort(dt).map((t=>t.key))}getRenderableIds(t){const i=[];for(const e in this._tiles)this._isIdRenderable(e,t)&&i.push(this._tiles[e]);return t?i.sort(((t,i)=>{const r=t.tileID,n=i.tileID,o=new e.P(r.canonical.x,r.canonical.y)._rotate(this.transform.angle),s=new e.P(n.canonical.x,n.canonical.y)._rotate(this.transform.angle);return r.overscaledZ-n.overscaledZ||s.y-o.y||s.x-o.x})).map((t=>t.tileID.key)):i.map((t=>t.tileID)).sort(dt).map((t=>t.key))}hasRenderableParent(t){const e=this.findLoadedParent(t,0);return!!e&&this._isIdRenderable(e.tileID.key)}_isIdRenderable(t,e){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(e||!this._tiles[t].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)"errored"!==this._tiles[t].state&&this._reloadTile(t,"reloading")}}_reloadTile(t,i){return e._(this,void 0,void 0,(function*(){const e=this._tiles[t];e&&("loading"!==e.state&&(e.state=i),yield this._loadTile(e,t,i))}))}_tileLoaded(t,i,r){t.timeAdded=o.now(),"expired"===r&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(i,t),"raster-dem"===this.getSource().type&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),t.aborted||this._source.fire(new e.k("data",{dataType:"source",tile:t,coord:t.tileID}))}_backfillDEM(t){const e=this.getRenderableIds();for(let r=0;r<e.length;r++){const n=e[r];if(t.neighboringTiles&&t.neighboringTiles[n]){const e=this.getTileByID(n);i(t,e),i(e,t)}}function i(t,e){t.needsHillshadePrepare=!0,t.needsTerrainPrepare=!0;let i=e.tileID.canonical.x-t.tileID.canonical.x;const r=e.tileID.canonical.y-t.tileID.canonical.y,n=Math.pow(2,t.tileID.canonical.z),o=e.tileID.key;0===i&&0===r||Math.abs(r)>1||(Math.abs(i)>1&&(1===Math.abs(i+n)?i+=n:1===Math.abs(i-n)&&(i-=n)),e.dem&&t.dem&&(t.dem.backfillBorder(e.dem,i,r),t.neighboringTiles&&t.neighboringTiles[o]&&(t.neighboringTiles[o].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,e,i,r){for(const n in this._tiles){let o=this._tiles[n];if(r[n]||!o.hasData()||o.tileID.overscaledZ<=e||o.tileID.overscaledZ>i)continue;let s=o.tileID;for(;o&&o.tileID.overscaledZ>e+1;){const t=o.tileID.scaledTo(o.tileID.overscaledZ-1);o=this._tiles[t.key],o&&o.hasData()&&(s=t)}let a=s;for(;a.overscaledZ>e;)if(a=a.scaledTo(a.overscaledZ-1),t[a.key]){r[s.key]=s;break}}}findLoadedParent(t,e){if(t.key in this._loadedParentTiles){const i=this._loadedParentTiles[t.key];return i&&i.tileID.overscaledZ>=e?i:null}for(let i=t.overscaledZ-1;i>=e;i--){const e=t.scaledTo(i),r=this._getLoadedTile(e);if(r)return r}}findLoadedSibling(t){return this._getLoadedTile(t)}_getLoadedTile(t){const e=this._tiles[t.key];return e&&e.hasData()?e:this._cache.getByKey(t.wrapped().key)}updateCacheSize(t){const i=Math.ceil(t.width/this._source.tileSize)+1,r=Math.ceil(t.height/this._source.tileSize)+1,n=Math.floor(i*r*(null===this._maxTileCacheZoomLevels?e.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),o="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,n):n;this._cache.setMaxSize(o)}handleWrapJump(t){const e=Math.round((t-(void 0===this._prevLng?t:this._prevLng))/360);if(this._prevLng=t,e){const t={};for(const i in this._tiles){const r=this._tiles[i];r.tileID=r.tileID.unwrapTo(r.tileID.wrap+e),t[r.tileID.key]=r}this._tiles=t;for(const t in this._timers)clearTimeout(this._timers[t]),delete this._timers[t];for(const t in this._tiles)this._setTileReloadTimer(t,this._tiles[t])}}_updateCoveredAndRetainedTiles(t,e,i,r,n,s){const a={},l={},c=Object.keys(t),u=o.now();for(const i of c){const r=t[i],n=this._tiles[i];if(!n||0!==n.fadeEndTime&&n.fadeEndTime<=u)continue;const o=this.findLoadedParent(r,e),s=this.findLoadedSibling(r),c=o||s||null;c&&(this._addTile(c.tileID),a[c.tileID.key]=c.tileID),l[i]=r}this._retainLoadedChildren(l,r,i,t);for(const e in a)t[e]||(this._coveredTiles[e]=!0,t[e]=a[e]);if(s){const e={},i={};for(const t of n)this._tiles[t.key].hasData()?e[t.key]=t:i[t.key]=t;for(const r in i){const n=i[r].children(this._source.maxzoom);this._tiles[n[0].key]&&this._tiles[n[1].key]&&this._tiles[n[2].key]&&this._tiles[n[3].key]&&(e[n[0].key]=t[n[0].key]=n[0],e[n[1].key]=t[n[1].key]=n[1],e[n[2].key]=t[n[2].key]=n[2],e[n[3].key]=t[n[3].key]=n[3],delete i[r])}for(const r in i){const n=i[r],o=this.findLoadedParent(n,this._source.minzoom),s=this.findLoadedSibling(n),a=o||s||null;if(a){e[a.tileID.key]=t[a.tileID.key]=a.tileID;for(const t in e)e[t].isChildOf(a.tileID)&&delete e[t]}}for(const t in this._tiles)e[t]||(this._coveredTiles[t]=!0)}}update(t,i){if(!this._sourceLoaded||this._paused)return;let r;this.transform=t,this.terrain=i,this.updateCacheSize(t),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?r=t.getVisibleUnwrappedCoordinates(this._source.tileID).map((t=>new e.S(t.canonical.z,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y))):(r=t.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:i}),this._source.hasTile&&(r=r.filter((t=>this._source.hasTile(t))))):r=[];const n=t.coveringZoomLevel(this._source),o=Math.max(n-ht.maxOverzooming,this._source.minzoom),s=Math.max(n+ht.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const t={};for(const e of r)if(e.canonical.z>this._source.minzoom){const i=e.scaledTo(e.canonical.z-1);t[i.key]=i;const r=e.scaledTo(Math.max(this._source.minzoom,Math.min(e.canonical.z,5)));t[r.key]=r}r=r.concat(Object.values(t))}const a=0===r.length&&!this._updated&&this._didEmitContent;this._updated=!0,a&&this.fire(new e.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const l=this._updateRetainedTiles(r,n);pt(this._source.type)&&this._updateCoveredAndRetainedTiles(l,o,s,n,r,i);for(const t in l)this._tiles[t].clearFadeHold();const c=e.ab(this._tiles,l);for(const t of c){const e=this._tiles[t];e.hasSymbolBuckets&&!e.holdingForFade()?e.setHoldDuration(this.map._fadeDuration):e.hasSymbolBuckets&&!e.symbolFadeFinished()||this._removeTile(t)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(t)}_updateRetainedTiles(t,e){var i;const r={},n={},o=Math.max(e-ht.maxOverzooming,this._source.minzoom),s=Math.max(e+ht.maxUnderzooming,this._source.minzoom),a={};for(const i of t){const t=this._addTile(i);r[i.key]=i,t.hasData()||e<this._source.maxzoom&&(a[i.key]=i)}this._retainLoadedChildren(a,e,s,r);for(const s of t){let t=this._tiles[s.key];if(t.hasData())continue;if(e+1>this._source.maxzoom){const t=s.children(this._source.maxzoom)[0],e=this.getTile(t);if(e&&e.hasData()){r[t.key]=t;continue}}else{const t=s.children(this._source.maxzoom);if(r[t[0].key]&&r[t[1].key]&&r[t[2].key]&&r[t[3].key])continue}let a=t.wasRequested();for(let e=s.overscaledZ-1;e>=o;--e){const o=s.scaledTo(e);if(n[o.key])break;if(n[o.key]=!0,t=this.getTile(o),!t&&a&&(t=this._addTile(o)),t){const e=t.hasData();if((e||!(null===(i=this.map)||void 0===i?void 0:i.cancelPendingTileRequestsWhileZooming)||a)&&(r[o.key]=o),a=t.wasRequested(),e)break}}}return r}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const e=[];let i,r=this._tiles[t].tileID;for(;r.overscaledZ>0;){if(r.key in this._loadedParentTiles){i=this._loadedParentTiles[r.key];break}e.push(r.key);const t=r.scaledTo(r.overscaledZ-1);if(i=this._getLoadedTile(t),i)break;r=t}for(const t of e)this._loadedParentTiles[t]=i}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const t in this._tiles){const e=this._tiles[t].tileID,i=this._getLoadedTile(e);this._loadedSiblingTiles[e.key]=i}}_addTile(t){let i=this._tiles[t.key];if(i)return i;i=this._cache.getAndRemove(t),i&&(this._setTileReloadTimer(t.key,i),i.tileID=t,this._state.initializeTileState(i,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,i)));const r=i;return i||(i=new lt(t,this._source.tileSize*t.overscaleFactor()),this._loadTile(i,t.key,i.state)),i.uses++,this._tiles[t.key]=i,r||this._source.fire(new e.k("dataloading",{tile:i,coord:i.tileID,dataType:"source"})),i}_setTileReloadTimer(t,e){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const i=e.getExpiryTimeout();i&&(this._timers[t]=setTimeout((()=>{this._reloadTile(t,"expired"),delete this._timers[t]}),i))}_removeTile(t){const e=this._tiles[t];e&&(e.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),e.uses>0||(e.hasData()&&"reloading"!==e.state?this._cache.add(e.tileID,e,e.getExpiryTimeout()):(e.aborted=!0,this._abortTile(e),this._unloadTile(e))))}_dataHandler(t){const e=t.sourceDataType;"source"===t.dataType&&"metadata"===e&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===t.dataType&&"content"===e&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(t);this._cache.reset()}tilesIn(t,i,r){const n=[],o=this.transform;if(!o)return n;const s=r?o.getCameraQueryGeometry(t):t,a=t.map((t=>o.pointCoordinate(t,this.terrain))),l=s.map((t=>o.pointCoordinate(t,this.terrain))),c=this.getIds();let u=1/0,h=1/0,d=-1/0,p=-1/0;for(const t of l)u=Math.min(u,t.x),h=Math.min(h,t.y),d=Math.max(d,t.x),p=Math.max(p,t.y);for(let t=0;t<c.length;t++){const r=this._tiles[c[t]];if(r.holdingForFade())continue;const s=r.tileID,f=Math.pow(2,o.zoom-r.tileID.overscaledZ),A=i*r.queryPadding*e.X/r.tileSize/f,m=[s.getTilePoint(new e.Z(u,h)),s.getTilePoint(new e.Z(d,p))];if(m[0].x-A<e.X&&m[0].y-A<e.X&&m[1].x+A>=0&&m[1].y+A>=0){const t=a.map((t=>s.getTilePoint(t))),e=l.map((t=>s.getTilePoint(t)));n.push({tile:r,tileID:s,queryGeometry:t,cameraQueryGeometry:e,scale:f})}}return n}getVisibleCoordinates(t){const e=this.getRenderableIds(t).map((t=>this._tiles[t].tileID));for(const t of e)t.posMatrix=this.transform.calculatePosMatrix(t.toUnwrapped());return e}hasTransition(){if(this._source.hasTransition())return!0;if(pt(this._source.type)){const t=o.now();for(const e in this._tiles)if(this._tiles[e].fadeEndTime>=t)return!0}return!1}setFeatureState(t,e,i){this._state.updateState(t=t||"_geojsonTileLayer",e,i)}removeFeatureState(t,e,i){this._state.removeFeatureState(t=t||"_geojsonTileLayer",e,i)}getFeatureState(t,e){return this._state.getState(t=t||"_geojsonTileLayer",e)}setDependencies(t,e,i){const r=this._tiles[t];r&&r.setDependencies(e,i)}reloadTilesForDependencies(t,e){for(const i in this._tiles)this._tiles[i].hasDependency(t,e)&&this._reloadTile(i,"reloading");this._cache.filter((i=>!i.hasDependency(t,e)))}}function dt(t,e){const i=Math.abs(2*t.wrap)-+(t.wrap<0),r=Math.abs(2*e.wrap)-+(e.wrap<0);return t.overscaledZ-e.overscaledZ||r-i||e.canonical.y-t.canonical.y||e.canonical.x-t.canonical.x}function pt(t){return"raster"===t||"image"===t||"video"===t}ht.maxOverzooming=10,ht.maxUnderzooming=3;class ft{constructor(t,e){this.reset(t,e)}reset(t,e){this.points=t||[],this._distances=[0];for(let t=1;t<this.points.length;t++)this._distances[t]=this._distances[t-1]+this.points[t].dist(this.points[t-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(e||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(1===this.points.length)return this.points[0];t=e.ac(t,0,1);let i=1,r=this._distances[i];const n=t*this.paddedLength+this.padding;for(;r<n&&i<this._distances.length;)r=this._distances[++i];const o=i-1,s=this._distances[o],a=r-s,l=a>0?(n-s)/a:0;return this.points[o].mult(1-l).add(this.points[i].mult(l))}}function At(t,e){let i=!0;return"always"===t||"never"!==t&&"never"!==e||(i=!1),i}class mt{constructor(t,e,i){const r=this.boxCells=[],n=this.circleCells=[];this.xCellCount=Math.ceil(t/i),this.yCellCount=Math.ceil(e/i);for(let t=0;t<this.xCellCount*this.yCellCount;t++)r.push([]),n.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=e,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/e,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,e,i,r,n){this._forEachCell(e,i,r,n,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(e),this.bboxes.push(i),this.bboxes.push(r),this.bboxes.push(n)}insertCircle(t,e,i,r){this._forEachCell(e-r,i-r,e+r,i+r,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(e),this.circles.push(i),this.circles.push(r)}_insertBoxCell(t,e,i,r,n,o){this.boxCells[n].push(o)}_insertCircleCell(t,e,i,r,n,o){this.circleCells[n].push(o)}_query(t,e,i,r,n,o,s){if(i<0||t>this.width||r<0||e>this.height)return[];const a=[];if(t<=0&&e<=0&&this.width<=i&&this.height<=r){if(n)return[{key:null,x1:t,y1:e,x2:i,y2:r}];for(let t=0;t<this.boxKeys.length;t++)a.push({key:this.boxKeys[t],x1:this.bboxes[4*t],y1:this.bboxes[4*t+1],x2:this.bboxes[4*t+2],y2:this.bboxes[4*t+3]});for(let t=0;t<this.circleKeys.length;t++){const e=this.circles[3*t],i=this.circles[3*t+1],r=this.circles[3*t+2];a.push({key:this.circleKeys[t],x1:e-r,y1:i-r,x2:e+r,y2:i+r})}}else this._forEachCell(t,e,i,r,this._queryCell,a,{hitTest:n,overlapMode:o,seenUids:{box:{},circle:{}}},s);return a}query(t,e,i,r){return this._query(t,e,i,r,!1,null)}hitTest(t,e,i,r,n,o){return this._query(t,e,i,r,!0,n,o).length>0}hitTestCircle(t,e,i,r,n){const o=t-i,s=t+i,a=e-i,l=e+i;if(s<0||o>this.width||l<0||a>this.height)return!1;const c=[];return this._forEachCell(o,a,s,l,this._queryCellCircle,c,{hitTest:!0,overlapMode:r,circle:{x:t,y:e,radius:i},seenUids:{box:{},circle:{}}},n),c.length>0}_queryCell(t,e,i,r,n,o,s,a){const{seenUids:l,hitTest:c,overlapMode:u}=s,h=this.boxCells[n];if(null!==h){const n=this.bboxes;for(const s of h)if(!l.box[s]){l.box[s]=!0;const h=4*s,d=this.boxKeys[s];if(t<=n[h+2]&&e<=n[h+3]&&i>=n[h+0]&&r>=n[h+1]&&(!a||a(d))&&(!c||!At(u,d.overlapMode))&&(o.push({key:d,x1:n[h],y1:n[h+1],x2:n[h+2],y2:n[h+3]}),c))return!0}}const d=this.circleCells[n];if(null!==d){const n=this.circles;for(const s of d)if(!l.circle[s]){l.circle[s]=!0;const h=3*s,d=this.circleKeys[s];if(this._circleAndRectCollide(n[h],n[h+1],n[h+2],t,e,i,r)&&(!a||a(d))&&(!c||!At(u,d.overlapMode))){const t=n[h],e=n[h+1],i=n[h+2];if(o.push({key:d,x1:t-i,y1:e-i,x2:t+i,y2:e+i}),c)return!0}}}return!1}_queryCellCircle(t,e,i,r,n,o,s,a){const{circle:l,seenUids:c,overlapMode:u}=s,h=this.boxCells[n];if(null!==h){const t=this.bboxes;for(const e of h)if(!c.box[e]){c.box[e]=!0;const i=4*e,r=this.boxKeys[e];if(this._circleAndRectCollide(l.x,l.y,l.radius,t[i+0],t[i+1],t[i+2],t[i+3])&&(!a||a(r))&&!At(u,r.overlapMode))return o.push(!0),!0}}const d=this.circleCells[n];if(null!==d){const t=this.circles;for(const e of d)if(!c.circle[e]){c.circle[e]=!0;const i=3*e,r=this.circleKeys[e];if(this._circlesCollide(t[i],t[i+1],t[i+2],l.x,l.y,l.radius)&&(!a||a(r))&&!At(u,r.overlapMode))return o.push(!0),!0}}}_forEachCell(t,e,i,r,n,o,s,a){const l=this._convertToXCellCoord(t),c=this._convertToYCellCoord(e),u=this._convertToXCellCoord(i),h=this._convertToYCellCoord(r);for(let d=l;d<=u;d++)for(let l=c;l<=h;l++)if(n.call(this,t,e,i,r,this.xCellCount*l+d,o,s,a))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,e,i,r,n,o){const s=r-t,a=n-e,l=i+o;return l*l>s*s+a*a}_circleAndRectCollide(t,e,i,r,n,o,s){const a=(o-r)/2,l=Math.abs(t-(r+a));if(l>a+i)return!1;const c=(s-n)/2,u=Math.abs(e-(n+c));if(u>c+i)return!1;if(l<=a||u<=c)return!0;const h=l-a,d=u-c;return h*h+d*d<=i*i}}function gt(t,i,r,n,o){const s=e.H();return i?(e.K(s,s,[1/o,1/o,1]),r||e.ad(s,s,n.angle)):e.L(s,n.labelPlaneMatrix,t),s}function _t(t,i,r,n,o){if(i){const i=e.ae(t);return e.K(i,i,[o,o,1]),r||e.ad(i,i,-n.angle),i}return n.glCoordMatrix}function yt(t,i,r,n){let o;n?(o=[t,i,n(t,i),1],e.af(o,o,r)):(o=[t,i,0,1],zt(o,o,r));const s=o[3];return{point:new e.P(o[0]/s,o[1]/s),signedDistanceFromCamera:s,isOccluded:!1}}function vt(t,e){return.5+t/e*.5}function xt(t,e){return t.x>=-e[0]&&t.x<=e[0]&&t.y>=-e[1]&&t.y<=e[1]}function bt(t,i,r,n,o,s,a,l,c,u,h,d,p,f,A){const m=n?t.textSizeData:t.iconSizeData,g=e.ag(m,r.transform.zoom),_=[256/r.width*2+1,256/r.height*2+1],y=n?t.text.dynamicLayoutVertexArray:t.icon.dynamicLayoutVertexArray;y.clear();const v=t.lineVertexArray,x=n?t.text.placedSymbolArray:t.icon.placedSymbolArray,b=r.transform.width/r.transform.height;let w=!1;for(let n=0;n<x.length;n++){const T=x.get(n);if(T.hidden||T.writingMode===e.ah.vertical&&!w){Lt(T.numGlyphs,y);continue}w=!1;const B=yt(T.anchorX,T.anchorY,i,A);if(!xt(B.point,_)){Lt(T.numGlyphs,y);continue}const E=vt(r.transform.cameraToCenterDistance,B.signedDistanceFromCamera),C=e.ai(m,g,T),S=a?C/E:C*E,I={getElevation:A,labelPlaneMatrix:o,lineVertexArray:v,pitchWithMap:a,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:u,tileAnchorPoint:new e.P(T.anchorX,T.anchorY),unwrappedTileID:h,width:d,height:p,translation:f},M=Bt(I,T,S,!1,l,i,s,t.glyphOffsetArray,y,b,c);w=M.useVertical,(M.notEnoughRoom||w||M.needsFlipping&&Bt(I,T,S,!0,l,i,s,t.glyphOffsetArray,y,b,c).notEnoughRoom)&&Lt(T.numGlyphs,y)}n?t.text.dynamicLayoutVertexBuffer.updateData(y):t.icon.dynamicLayoutVertexBuffer.updateData(y)}function wt(t,e,i,r,n,o,s,a){const l=o.glyphStartIndex+o.numGlyphs,c=o.lineStartIndex,u=o.lineStartIndex+o.lineLength,h=e.getoffsetX(o.glyphStartIndex),d=e.getoffsetX(l-1),p=kt(t*h,i,r,n,o.segment,c,u,a,s);if(!p)return null;const f=kt(t*d,i,r,n,o.segment,c,u,a,s);return f?a.projectionCache.anyProjectionOccluded?null:{first:p,last:f}:null}function Tt(t,i,r,n){return t===e.ah.horizontal&&Math.abs(r.y-i.y)>Math.abs(r.x-i.x)*n?{useVertical:!0}:(t===e.ah.vertical?i.y<r.y:i.x>r.x)?{needsFlipping:!0}:null}function Bt(t,i,r,n,o,s,a,l,c,u,h){const d=r/24,p=i.lineOffsetX*d,f=i.lineOffsetY*d;let A;if(i.numGlyphs>1){const e=i.glyphStartIndex+i.numGlyphs,r=i.lineStartIndex,s=i.lineStartIndex+i.lineLength,c=wt(d,l,p,f,n,i,h,t);if(!c)return{notEnoughRoom:!0};const m=yt(c.first.point.x,c.first.point.y,a,t.getElevation).point,g=yt(c.last.point.x,c.last.point.y,a,t.getElevation).point;if(o&&!n){const t=Tt(i.writingMode,m,g,u);if(t)return t}A=[c.first];for(let o=i.glyphStartIndex+1;o<e-1;o++)A.push(kt(d*l.getoffsetX(o),p,f,n,i.segment,r,s,t,h));A.push(c.last)}else{if(o&&!n){const r=yt(t.tileAnchorPoint.x,t.tileAnchorPoint.y,s,t.getElevation).point,n=i.lineStartIndex+i.segment+1,o=new e.P(t.lineVertexArray.getx(n),t.lineVertexArray.gety(n)),a=yt(o.x,o.y,s,t.getElevation),l=a.signedDistanceFromCamera>0?a.point:function(t,e,i,r,n,o){return Et(t,e,i,1,n,o)}(t.tileAnchorPoint,o,r,0,s,t),c=Tt(i.writingMode,r,l,u);if(c)return c}const r=kt(d*l.getoffsetX(i.glyphStartIndex),p,f,n,i.segment,i.lineStartIndex,i.lineStartIndex+i.lineLength,t,h);if(!r||t.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};A=[r]}for(const t of A)e.aj(c,t.point,t.angle);return{}}function Et(t,e,i,r,n,o){const s=t.add(t.sub(e)._unit()),a=void 0!==n?yt(s.x,s.y,n,o.getElevation).point:St(s.x,s.y,o).point,l=i.sub(a);return i.add(l._mult(r/l.mag()))}function Ct(t,i,r){const n=i.projectionCache;if(n.projections[t])return n.projections[t];const o=new e.P(i.lineVertexArray.getx(t),i.lineVertexArray.gety(t)),s=St(o.x,o.y,i);if(s.signedDistanceFromCamera>0)return n.projections[t]=s.point,n.anyProjectionOccluded=n.anyProjectionOccluded||s.isOccluded,s.point;const a=t-r.direction;return function(t,e,i,r,n){return Et(t,e,i,r,void 0,n)}(0===r.distanceFromAnchor?i.tileAnchorPoint:new e.P(i.lineVertexArray.getx(a),i.lineVertexArray.gety(a)),o,r.previousVertex,r.absOffsetX-r.distanceFromAnchor+1,i)}function St(t,e,i){const r=t+i.translation[0],n=e+i.translation[1];let o;return!i.pitchWithMap&&i.projection.useSpecialProjectionForSymbols?(o=i.projection.projectTileCoordinates(r,n,i.unwrappedTileID,i.getElevation),o.point.x=(.5*o.point.x+.5)*i.width,o.point.y=(.5*-o.point.y+.5)*i.height):(o=yt(r,n,i.labelPlaneMatrix,i.getElevation),o.isOccluded=!1),o}function It(t,e,i){return t._unit()._perp()._mult(e*i)}function Mt(t,i,r,n,o,s,a,l,c){if(l.projectionCache.offsets[t])return l.projectionCache.offsets[t];const u=r.add(i);if(t+c.direction<n||t+c.direction>=o)return l.projectionCache.offsets[t]=u,u;const h=Ct(t+c.direction,l,c),d=It(h.sub(r),a,c.direction),p=r.add(d),f=h.add(d);return l.projectionCache.offsets[t]=e.ak(s,u,p,f)||u,l.projectionCache.offsets[t]}function kt(t,e,i,r,n,o,s,a,l){const c=r?t-e:t+e;let u=c>0?1:-1,h=0;r&&(u*=-1,h=Math.PI),u<0&&(h+=Math.PI);let d,p=u>0?o+n:o+n+1;a.projectionCache.cachedAnchorPoint?d=a.projectionCache.cachedAnchorPoint:(d=St(a.tileAnchorPoint.x,a.tileAnchorPoint.y,a).point,a.projectionCache.cachedAnchorPoint=d);let f,A,m=d,g=d,_=0,y=0;const v=Math.abs(c),x=[];let b;for(;_+y<=v;){if(p+=u,p<o||p>=s)return null;_+=y,g=m,A=f;const t={absOffsetX:v,direction:u,distanceFromAnchor:_,previousVertex:g};if(m=Ct(p,a,t),0===i)x.push(g),b=m.sub(g);else{let e;const r=m.sub(g);e=0===r.mag()?It(Ct(p+u,a,t).sub(m),i,u):It(r,i,u),A||(A=g.add(e)),f=Mt(p,e,m,o,s,A,i,a,t),x.push(A),b=f.sub(A)}y=b.mag()}const w=b._mult((v-_)/y)._add(A||g),T=h+Math.atan2(m.y-g.y,m.x-g.x);return x.push(w),{point:w,angle:l?T:0,path:x}}const Pt=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Lt(t,e){for(let i=0;i<t;i++){const t=e.length;e.resize(t+4),e.float32.set(Pt,3*t)}}function zt(t,e,i){const r=e[0],n=e[1];return t[0]=i[0]*r+i[4]*n+i[12],t[1]=i[1]*r+i[5]*n+i[13],t[3]=i[3]*r+i[7]*n+i[15],t}const Ft=100;class Dt{constructor(t,e,i=new mt(t.width+200,t.height+200,25),r=new mt(t.width+200,t.height+200,25)){this.transform=t,this.mapProjection=e,this.grid=i,this.ignoredGrid=r,this.pitchFactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+Ft,this.screenBottomBoundary=t.height+Ft,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(t,e,i,r,n,o,s,a,l,c,u){const h=t.anchorPointX+a[0],d=t.anchorPointY+a[1],p=this.projectAndGetPerspectiveRatio(r,h,d,n,c),f=i*p.perspectiveRatio;let A;if(o||s)A=this._projectCollisionBox(t,f,r,n,o,s,a,p,c,u);else{const e=p.point.x+(u?u.x*f:0),i=p.point.y+(u?u.y*f:0);A={allPointsOccluded:!1,box:[e+t.x1*f,i+t.y1*f,e+t.x2*f,i+t.y2*f]}}const[m,g,_,y]=A.box;return this.mapProjection.useSpecialProjectionForSymbols&&(o?A.allPointsOccluded:this.mapProjection.isOccluded(h,d,n))||p.perspectiveRatio<this.perspectiveRatioCutoff||!this.isInsideGrid(m,g,_,y)||"always"!==e&&this.grid.hitTest(m,g,_,y,e,l)?{box:[m,g,_,y],placeable:!1,offscreen:!1}:{box:[m,g,_,y],placeable:!0,offscreen:this.isOffscreen(m,g,_,y)}}placeCollisionCircles(t,i,r,n,o,s,a,l,c,u,h,d,p,f,A,m){const g=[],_=new e.P(i.anchorX,i.anchorY),y=this.getPerspectiveRatio(s,_.x,_.y,a,m),v=(h?o/y:o*y)/e.ap,x={getElevation:m,labelPlaneMatrix:l,lineVertexArray:r,pitchWithMap:h,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:this.mapProjection,tileAnchorPoint:_,unwrappedTileID:a,width:this.transform.width,height:this.transform.height,translation:A},b=wt(v,n,i.lineOffsetX*v,i.lineOffsetY*v,!1,i,!1,x);let w=!1,T=!1,B=!0;if(b){const i=.5*p*y+f,r=new e.P(-100,-100),n=new e.P(this.screenRightBoundary,this.screenBottomBoundary),o=new ft,s=b.first,a=b.last;let l=[];for(let t=s.path.length-1;t>=1;t--)l.push(s.path[t]);for(let t=1;t<a.path.length;t++)l.push(a.path[t]);const h=2.5*i;if(c){const t=this.projectPathToScreenSpace(l,x,c);l=t.some((t=>t.signedDistanceFromCamera<=0))?[]:t.map((t=>t.point))}let A=[];if(l.length>0){const t=l[0].clone(),i=l[0].clone();for(let e=1;e<l.length;e++)t.x=Math.min(t.x,l[e].x),t.y=Math.min(t.y,l[e].y),i.x=Math.max(i.x,l[e].x),i.y=Math.max(i.y,l[e].y);A=t.x>=r.x&&i.x<=n.x&&t.y>=r.y&&i.y<=n.y?[l]:i.x<r.x||t.x>n.x||i.y<r.y||t.y>n.y?[]:e.al([l],r.x,r.y,n.x,n.y)}for(const e of A){o.reset(e,.25*i);let r=0;r=o.length<=.5*i?1:Math.ceil(o.paddedLength/h)+1;for(let e=0;e<r;e++){const n=e/Math.max(r-1,1),s=o.lerp(n),a=s.x+Ft,l=s.y+Ft;g.push(a,l,i,0);const c=a-i,h=l-i,p=a+i,f=l+i;if(B=B&&this.isOffscreen(c,h,p,f),T=T||this.isInsideGrid(c,h,p,f),"always"!==t&&this.grid.hitTestCircle(a,l,i,t,d)&&(w=!0,!u))return{circles:[],offscreen:!1,collisionDetected:w}}}}return{circles:!u&&w||!T||y<this.perspectiveRatioCutoff?[]:g,offscreen:B,collisionDetected:w}}projectPathToScreenSpace(t,e,i){return t.map((t=>yt(t.x,t.y,i,e.getElevation)))}queryRenderedSymbols(t){if(0===t.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const i=[];let r=1/0,n=1/0,o=-1/0,s=-1/0;for(const a of t){const t=new e.P(a.x+Ft,a.y+Ft);r=Math.min(r,t.x),n=Math.min(n,t.y),o=Math.max(o,t.x),s=Math.max(s,t.y),i.push(t)}const a=this.grid.query(r,n,o,s).concat(this.ignoredGrid.query(r,n,o,s)),l={},c={};for(const t of a){const r=t.key;if(void 0===l[r.bucketInstanceId]&&(l[r.bucketInstanceId]={}),l[r.bucketInstanceId][r.featureIndex])continue;const n=[new e.P(t.x1,t.y1),new e.P(t.x2,t.y1),new e.P(t.x2,t.y2),new e.P(t.x1,t.y2)];e.am(i,n)&&(l[r.bucketInstanceId][r.featureIndex]=!0,void 0===c[r.bucketInstanceId]&&(c[r.bucketInstanceId]=[]),c[r.bucketInstanceId].push(r.featureIndex))}return c}insertCollisionBox(t,e,i,r,n,o){(i?this.ignoredGrid:this.grid).insert({bucketInstanceId:r,featureIndex:n,collisionGroupID:o,overlapMode:e},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,e,i,r,n,o){const s=i?this.ignoredGrid:this.grid,a={bucketInstanceId:r,featureIndex:n,collisionGroupID:o,overlapMode:e};for(let e=0;e<t.length;e+=4)s.insertCircle(a,t[e],t[e+1],t[e+2])}projectAndGetPerspectiveRatio(t,i,r,n,o){let s;o?(s=[i,r,o(i,r),1],e.af(s,s,t)):(s=[i,r,0,1],zt(s,s,t));const a=s[3];return{point:new e.P((s[0]/a+1)/2*this.transform.width+Ft,(-s[1]/a+1)/2*this.transform.height+Ft),perspectiveRatio:.5+this.transform.cameraToCenterDistance/a*.5,isOccluded:!1,signedDistanceFromCamera:a}}getPerspectiveRatio(t,e,i,r,n){const o=this.mapProjection.useSpecialProjectionForSymbols?this.mapProjection.projectTileCoordinates(e,i,r,n):yt(e,i,t,n);return.5+this.transform.cameraToCenterDistance/o.signedDistanceFromCamera*.5}isOffscreen(t,e,i,r){return i<Ft||t>=this.screenRightBoundary||r<Ft||e>this.screenBottomBoundary}isInsideGrid(t,e,i,r){return i>=0&&t<this.gridRightBoundary&&r>=0&&e<this.gridBottomBoundary}getViewportMatrix(){const t=e.an([]);return e.J(t,t,[-100,-100,0]),t}_projectCollisionBox(t,i,r,n,o,s,a,l,c,u){let h=new e.P(1,0),d=new e.P(0,1);const p=new e.P(t.anchorPointX+a[0],t.anchorPointY+a[1]);if(s&&!o){const t=this.projectAndGetPerspectiveRatio(r,p.x+1,p.y,n,c).point.sub(l.point).unit(),i=Math.atan(t.y/t.x)+(t.x<0?Math.PI:0),o=Math.sin(i),s=Math.cos(i);h=new e.P(s,o),d=new e.P(-o,s)}else if(!s&&o){const t=-this.transform.angle,i=Math.sin(t),r=Math.cos(t);h=new e.P(r,i),d=new e.P(-i,r)}let f=l.point,A=i;if(o){f=p;const t=this.transform.zoom-Math.floor(this.transform.zoom);A=Math.pow(2,-t),A*=this.mapProjection.getPitchedTextCorrection(this.transform,p,n),u||(A*=e.ac(.5+l.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))}u&&(f=f.add(h.mult(u.x*A)).add(d.mult(u.y*A)));const m=t.x1*A,g=t.x2*A,_=(m+g)/2,y=t.y1*A,v=t.y2*A,x=(y+v)/2,b=[{offsetX:m,offsetY:y},{offsetX:_,offsetY:y},{offsetX:g,offsetY:y},{offsetX:g,offsetY:x},{offsetX:g,offsetY:v},{offsetX:_,offsetY:v},{offsetX:m,offsetY:v},{offsetX:m,offsetY:x}];let w=[];for(const{offsetX:t,offsetY:i}of b)w.push(new e.P(f.x+h.x*t+d.x*i,f.y+h.y*t+d.y*i));let T=!1;if(o){const t=w.map((t=>this.projectAndGetPerspectiveRatio(r,t.x,t.y,n,c)));T=t.some((t=>!t.isOccluded)),w=t.map((t=>t.point))}else T=!0;return{box:e.ao(w),allPointsOccluded:!T}}}function Rt(t,i,r){return i*(e.X/(t.tileSize*Math.pow(2,r-t.tileID.overscaledZ)))}class Ut{constructor(t,e,i,r){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?e:-e))):r&&i?1:0,this.placed=i}isHidden(){return 0===this.opacity&&!this.placed}}class Ot{constructor(t,e,i,r,n){this.text=new Ut(t?t.text:null,e,i,n),this.icon=new Ut(t?t.icon:null,e,r,n)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Nt{constructor(t,e,i){this.text=t,this.icon=e,this.skipFade=i}}class Qt{constructor(){this.invProjMatrix=e.H(),this.viewportMatrix=e.H(),this.circles=[]}}class Vt{constructor(t,e,i,r,n){this.bucketInstanceId=t,this.featureIndex=e,this.sourceLayerIndex=i,this.bucketIndex=r,this.tileID=n}}class jt{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const e=++this.maxGroupID;this.collisionGroups[t]={ID:e,predicate:t=>t.collisionGroupID===e}}return this.collisionGroups[t]}}function Ht(t,i,r,n,o){const{horizontalAlign:s,verticalAlign:a}=e.au(t);return new e.P(-(s-.5)*i+n[0]*o,-(a-.5)*r+n[1]*o)}class Gt{constructor(t,e,i,r,n,o){this.transform=t.clone(),this.terrain=i,this.collisionIndex=new Dt(this.transform,e),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=r,this.retainedQueryData={},this.collisionGroups=new jt(n),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=o,o&&(o.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(t){const e=this.terrain;return e?(i,r)=>e.getElevation(t,i,r):null}getBucketParts(t,i,r,n){const o=r.getBucket(i),s=r.latestFeatureIndex;if(!o||!s||i.id!==o.layerIds[0])return;const a=r.collisionBoxArray,l=o.layers[0].layout,c=o.layers[0].paint,u=Math.pow(2,this.transform.zoom-r.tileID.overscaledZ),h=r.tileSize/e.X,d=r.tileID.toUnwrapped(),p=this.transform.calculatePosMatrix(d),f="map"===l.get("text-pitch-alignment"),A="map"===l.get("text-rotation-alignment"),m=Rt(r,1,this.transform.zoom),g=this.collisionIndex.mapProjection.translatePosition(this.transform,r,c.get("text-translate"),c.get("text-translate-anchor")),_=this.collisionIndex.mapProjection.translatePosition(this.transform,r,c.get("icon-translate"),c.get("icon-translate-anchor")),y=gt(p,f,A,this.transform,m);let v=null;if(f){const t=_t(p,f,A,this.transform,m);v=e.L([],this.transform.labelPlaneMatrix,t)}this.retainedQueryData[o.bucketInstanceId]=new Vt(o.bucketInstanceId,s,o.sourceLayerIndex,o.index,r.tileID);const x={bucket:o,layout:l,translationText:g,translationIcon:_,posMatrix:p,unwrappedTileID:d,textLabelPlaneMatrix:y,labelToScreenMatrix:v,scale:u,textPixelRatio:h,holdingForFade:r.holdingForFade(),collisionBoxArray:a,partiallyEvaluatedTextSize:e.ag(o.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(o.sourceID)};if(n)for(const e of o.sortKeyRanges){const{sortKey:i,symbolInstanceStart:r,symbolInstanceEnd:n}=e;t.push({sortKey:i,symbolInstanceStart:r,symbolInstanceEnd:n,parameters:x})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:o.symbolInstances.length,parameters:x})}attemptAnchorPlacement(t,i,r,n,o,s,a,l,c,u,h,d,p,f,A,m,g,_,y){const v=e.aq[t.textAnchor],x=[t.textOffset0,t.textOffset1],b=Ht(v,r,n,x,o),w=this.collisionIndex.placeCollisionBox(i,d,l,c,u,a,s,m,h.predicate,y,b);if((!_||this.collisionIndex.placeCollisionBox(_,d,l,c,u,a,s,g,h.predicate,y,b).placeable)&&w.placeable){let t;if(this.prevPlacement&&this.prevPlacement.variableOffsets[p.crossTileID]&&this.prevPlacement.placements[p.crossTileID]&&this.prevPlacement.placements[p.crossTileID].text&&(t=this.prevPlacement.variableOffsets[p.crossTileID].anchor),0===p.crossTileID)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[p.crossTileID]={textOffset:x,width:r,height:n,anchor:v,textBoxScale:o,prevAnchor:t},this.markUsedJustification(f,v,p,A),f.allowVerticalPlacement&&(this.markUsedOrientation(f,A,p),this.placedOrientations[p.crossTileID]=A),{shift:b,placedGlyphBoxes:w}}}placeLayerBucketPart(t,i,r){const{bucket:n,layout:o,translationText:s,translationIcon:a,posMatrix:l,unwrappedTileID:c,textLabelPlaneMatrix:u,labelToScreenMatrix:h,textPixelRatio:d,holdingForFade:p,collisionBoxArray:f,partiallyEvaluatedTextSize:A,collisionGroup:m}=t.parameters,g=o.get("text-optional"),_=o.get("icon-optional"),y=e.ar(o,"text-overlap","text-allow-overlap"),v="always"===y,x=e.ar(o,"icon-overlap","icon-allow-overlap"),b="always"===x,w="map"===o.get("text-rotation-alignment"),T="map"===o.get("text-pitch-alignment"),B="none"!==o.get("icon-text-fit"),E="viewport-y"===o.get("symbol-z-order"),C=v&&(b||!n.hasIconData()||_),S=b&&(v||!n.hasTextData()||g);!n.collisionArrays&&f&&n.deserializeCollisionBoxes(f);const I=this._getTerrainElevationFunc(this.retainedQueryData[n.bucketInstanceId].tileID),M=(t,f,b)=>{var E,M;if(i[t.crossTileID])return;if(p)return void(this.placements[t.crossTileID]=new Nt(!1,!1,!1));let k=!1,P=!1,L=!0,z=null,F={box:null,placeable:!1,offscreen:null},D={box:null,placeable:!1,offscreen:null},R=null,U=null,O=null,N=0,Q=0,V=0;f.textFeatureIndex?N=f.textFeatureIndex:t.useRuntimeCollisionCircles&&(N=t.featureIndex),f.verticalTextFeatureIndex&&(Q=f.verticalTextFeatureIndex);const j=f.textBox;if(j){const i=i=>{let r=e.ah.horizontal;if(n.allowVerticalPlacement&&!i&&this.prevPlacement){const e=this.prevPlacement.placedOrientations[t.crossTileID];e&&(this.placedOrientations[t.crossTileID]=e,r=e,this.markUsedOrientation(n,r,t))}return r},o=(i,r)=>{if(n.allowVerticalPlacement&&t.numVerticalGlyphVertices>0&&f.verticalTextBox){for(const t of n.writingModes)if(t===e.ah.vertical?(F=r(),D=F):F=i(),F&&F.placeable)break}else F=i()},u=t.textAnchorOffsetStartIndex,h=t.textAnchorOffsetEndIndex;if(h===u){const r=(e,i)=>{const r=this.collisionIndex.placeCollisionBox(e,y,d,l,c,T,w,s,m.predicate,I);return r&&r.placeable&&(this.markUsedOrientation(n,i,t),this.placedOrientations[t.crossTileID]=i),r};o((()=>r(j,e.ah.horizontal)),(()=>{const i=f.verticalTextBox;return n.allowVerticalPlacement&&t.numVerticalGlyphVertices>0&&i?r(i,e.ah.vertical):{box:null,offscreen:null}})),i(F&&F.placeable)}else{let p=e.aq[null===(M=null===(E=this.prevPlacement)||void 0===E?void 0:E.variableOffsets[t.crossTileID])||void 0===M?void 0:M.anchor];const A=(i,o,f)=>{const A=i.x2-i.x1,g=i.y2-i.y1,_=t.textBoxScale,v=B&&"never"===x?o:null;let b=null,E="never"===y?1:2,C="never";p&&E++;for(let e=0;e<E;e++){for(let e=u;e<h;e++){const r=n.textAnchorOffsets.get(e);if(p&&r.textAnchor!==p)continue;const o=this.attemptAnchorPlacement(r,i,A,g,_,w,T,d,l,c,m,C,t,n,f,s,a,v,I);if(o&&(b=o.placedGlyphBoxes,b&&b.placeable))return k=!0,z=o.shift,b}p?p=null:C=y}return r&&!b&&(b={box:this.collisionIndex.placeCollisionBox(j,"always",d,l,c,T,w,s,m.predicate,I,new e.P(0,0)).box,offscreen:!1,placeable:!1}),b};o((()=>A(j,f.iconBox,e.ah.horizontal)),(()=>{const i=f.verticalTextBox;return n.allowVerticalPlacement&&(!F||!F.placeable)&&t.numVerticalGlyphVertices>0&&i?A(i,f.verticalIconBox,e.ah.vertical):{box:null,occluded:!0,offscreen:null}})),F&&(k=F.placeable,L=F.offscreen);const g=i(F&&F.placeable);if(!k&&this.prevPlacement){const e=this.prevPlacement.variableOffsets[t.crossTileID];e&&(this.variableOffsets[t.crossTileID]=e,this.markUsedJustification(n,e.anchor,t,g))}}}if(R=F,k=R&&R.placeable,L=R&&R.offscreen,t.useRuntimeCollisionCircles){const i=n.text.placedSymbolArray.get(t.centerJustifiedTextSymbolIndex),a=e.ai(n.textSizeData,A,i),d=o.get("text-padding");U=this.collisionIndex.placeCollisionCircles(y,i,n.lineVertexArray,n.glyphOffsetArray,a,l,c,u,h,r,T,m.predicate,t.collisionCircleDiameter,d,s,I),U.circles.length&&U.collisionDetected&&!r&&e.w("Collisions detected, but collision boxes are not shown"),k=v||U.circles.length>0&&!U.collisionDetected,L=L&&U.offscreen}if(f.iconFeatureIndex&&(V=f.iconFeatureIndex),f.iconBox){const t=t=>this.collisionIndex.placeCollisionBox(t,x,d,l,c,T,w,a,m.predicate,I,B&&z?z:void 0);D&&D.placeable&&f.verticalIconBox?(O=t(f.verticalIconBox),P=O.placeable):(O=t(f.iconBox),P=O.placeable),L=L&&O.offscreen}const H=g||0===t.numHorizontalGlyphVertices&&0===t.numVerticalGlyphVertices,G=_||0===t.numIconVertices;H||G?G?H||(P=P&&k):k=P&&k:P=k=P&&k;const $=P&&O.placeable;if(k&&R.placeable&&this.collisionIndex.insertCollisionBox(R.box,y,o.get("text-ignore-placement"),n.bucketInstanceId,D&&D.placeable&&Q?Q:N,m.ID),$&&this.collisionIndex.insertCollisionBox(O.box,x,o.get("icon-ignore-placement"),n.bucketInstanceId,V,m.ID),U&&k&&this.collisionIndex.insertCollisionCircles(U.circles,y,o.get("text-ignore-placement"),n.bucketInstanceId,N,m.ID),r&&this.storeCollisionData(n.bucketInstanceId,b,f,R,O,U),0===t.crossTileID)throw new Error("symbolInstance.crossTileID can't be 0");if(0===n.bucketInstanceId)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[t.crossTileID]=new Nt(k||C,P||S,L||n.justReloaded),i[t.crossTileID]=!0};if(E){if(0!==t.symbolInstanceStart)throw new Error("bucket.bucketInstanceId should be 0");const e=n.getSortedSymbolIndexes(this.transform.angle);for(let t=e.length-1;t>=0;--t){const i=e[t];M(n.symbolInstances.get(i),n.collisionArrays[i],i)}}else for(let e=t.symbolInstanceStart;e<t.symbolInstanceEnd;e++)M(n.symbolInstances.get(e),n.collisionArrays[e],e);if(r&&n.bucketInstanceId in this.collisionCircleArrays){const t=this.collisionCircleArrays[n.bucketInstanceId];e.as(t.invProjMatrix,l),t.viewportMatrix=this.collisionIndex.getViewportMatrix()}n.justReloaded=!1}storeCollisionData(t,e,i,r,n,o){if(i.textBox||i.iconBox){let o,s;this.collisionBoxArrays.has(t)?o=this.collisionBoxArrays.get(t):(o=new Map,this.collisionBoxArrays.set(t,o)),o.has(e)?s=o.get(e):(s={text:null,icon:null},o.set(e,s)),i.textBox&&(s.text=r.box),i.iconBox&&(s.icon=n.box)}if(o){let e=this.collisionCircleArrays[t];void 0===e&&(e=this.collisionCircleArrays[t]=new Qt);for(let t=0;t<o.circles.length;t+=4)e.circles.push(o.circles[t+0]),e.circles.push(o.circles[t+1]),e.circles.push(o.circles[t+2]),e.circles.push(o.collisionDetected?1:0)}}markUsedJustification(t,i,r,n){let o;o=n===e.ah.vertical?r.verticalPlacedTextSymbolIndex:{left:r.leftJustifiedTextSymbolIndex,center:r.centerJustifiedTextSymbolIndex,right:r.rightJustifiedTextSymbolIndex}[e.at(i)];const s=[r.leftJustifiedTextSymbolIndex,r.centerJustifiedTextSymbolIndex,r.rightJustifiedTextSymbolIndex,r.verticalPlacedTextSymbolIndex];for(const e of s)e>=0&&(t.text.placedSymbolArray.get(e).crossTileID=o>=0&&e!==o?0:r.crossTileID)}markUsedOrientation(t,i,r){const n=i===e.ah.horizontal||i===e.ah.horizontalOnly?i:0,o=i===e.ah.vertical?i:0,s=[r.leftJustifiedTextSymbolIndex,r.centerJustifiedTextSymbolIndex,r.rightJustifiedTextSymbolIndex];for(const e of s)t.text.placedSymbolArray.get(e).placedOrientation=n;r.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(r.verticalPlacedTextSymbolIndex).placedOrientation=o)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const e=this.prevPlacement;let i=!1;this.prevZoomAdjustment=e?e.zoomAdjustment(this.transform.zoom):0;const r=e?e.symbolFadeChange(t):1,n=e?e.opacities:{},o=e?e.variableOffsets:{},s=e?e.placedOrientations:{};for(const t in this.placements){const e=this.placements[t],o=n[t];o?(this.opacities[t]=new Ot(o,r,e.text,e.icon),i=i||e.text!==o.text.placed||e.icon!==o.icon.placed):(this.opacities[t]=new Ot(null,r,e.text,e.icon,e.skipFade),i=i||e.text||e.icon)}for(const t in n){const e=n[t];if(!this.opacities[t]){const n=new Ot(e,r,!1,!1);n.isHidden()||(this.opacities[t]=n,i=i||e.text.placed||e.icon.placed)}}for(const t in o)this.variableOffsets[t]||!this.opacities[t]||this.opacities[t].isHidden()||(this.variableOffsets[t]=o[t]);for(const t in s)this.placedOrientations[t]||!this.opacities[t]||this.opacities[t].isHidden()||(this.placedOrientations[t]=s[t]);if(e&&void 0===e.lastPlacementChangeTime)throw new Error("Last placement time for previous placement is not defined");i?this.lastPlacementChangeTime=t:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=e?e.lastPlacementChangeTime:t)}updateLayerOpacities(t,e){const i={};for(const r of e){const e=r.getBucket(t);e&&r.latestFeatureIndex&&t.id===e.layerIds[0]&&this.updateBucketOpacities(e,r.tileID,i,r.collisionBoxArray)}}updateBucketOpacities(t,i,r,n){t.hasTextData()&&(t.text.opacityVertexArray.clear(),t.text.hasVisibleVertices=!1),t.hasIconData()&&(t.icon.opacityVertexArray.clear(),t.icon.hasVisibleVertices=!1),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const o=t.layers[0],s=o.layout,a=new Ot(null,0,!1,!1,!0),l=s.get("text-allow-overlap"),c=s.get("icon-allow-overlap"),u=o._unevaluatedLayout.hasValue("text-variable-anchor")||o._unevaluatedLayout.hasValue("text-variable-anchor-offset"),h="map"===s.get("text-rotation-alignment"),d="map"===s.get("text-pitch-alignment"),p="none"!==s.get("icon-text-fit"),f=new Ot(null,0,l&&(c||!t.hasIconData()||s.get("icon-optional")),c&&(l||!t.hasTextData()||s.get("text-optional")),!0);!t.collisionArrays&&n&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(n);const A=(t,e,i)=>{for(let r=0;r<e/4;r++)t.opacityVertexArray.emplaceBack(i);t.hasVisibleVertices=t.hasVisibleVertices||i!==ee},m=this.collisionBoxArrays.get(t.bucketInstanceId);for(let i=0;i<t.symbolInstances.length;i++){const n=t.symbolInstances.get(i),{numHorizontalGlyphVertices:o,numVerticalGlyphVertices:s,crossTileID:l}=n;let c=this.opacities[l];r[l]?c=a:c||(c=f,this.opacities[l]=c),r[l]=!0;const g=n.numIconVertices>0,_=this.placedOrientations[n.crossTileID],y=_===e.ah.vertical,v=_===e.ah.horizontal||_===e.ah.horizontalOnly;if(o>0||s>0){const e=te(c.text);A(t.text,o,y?ee:e),A(t.text,s,v?ee:e);const i=c.text.isHidden();[n.rightJustifiedTextSymbolIndex,n.centerJustifiedTextSymbolIndex,n.leftJustifiedTextSymbolIndex].forEach((e=>{e>=0&&(t.text.placedSymbolArray.get(e).hidden=i||y?1:0)})),n.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(n.verticalPlacedTextSymbolIndex).hidden=i||v?1:0);const r=this.variableOffsets[n.crossTileID];r&&this.markUsedJustification(t,r.anchor,n,_);const a=this.placedOrientations[n.crossTileID];a&&(this.markUsedJustification(t,"left",n,a),this.markUsedOrientation(t,a,n))}if(g){const e=te(c.icon),i=!(p&&n.verticalPlacedIconSymbolIndex&&y);n.placedIconSymbolIndex>=0&&(A(t.icon,n.numIconVertices,i?e:ee),t.icon.placedSymbolArray.get(n.placedIconSymbolIndex).hidden=c.icon.isHidden()),n.verticalPlacedIconSymbolIndex>=0&&(A(t.icon,n.numVerticalIconVertices,i?ee:e),t.icon.placedSymbolArray.get(n.verticalPlacedIconSymbolIndex).hidden=c.icon.isHidden())}const x=m&&m.has(i)?m.get(i):{text:null,icon:null};if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const r=t.collisionArrays[i];if(r){let i=new e.P(0,0);if(r.textBox||r.verticalTextBox){let e=!0;if(u){const t=this.variableOffsets[l];t?(i=Ht(t.anchor,t.width,t.height,t.textOffset,t.textBoxScale),h&&i._rotate(d?this.transform.angle:-this.transform.angle)):e=!1}if(r.textBox||r.verticalTextBox){let n;r.textBox&&(n=y),r.verticalTextBox&&(n=v),$t(t.textCollisionBox.collisionVertexArray,c.text.placed,!e||n,x.text,i.x,i.y)}}if(r.iconBox||r.verticalIconBox){const e=Boolean(!v&&r.verticalIconBox);let n;r.iconBox&&(n=e),r.verticalIconBox&&(n=!e),$t(t.iconCollisionBox.collisionVertexArray,c.icon.placed,n,x.icon,p?i.x:0,p?i.y:0)}}}}if(t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.text.opacityVertexArray.length!==t.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${t.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${t.text.layoutVertexArray.length}) / 4`);if(t.icon.opacityVertexArray.length!==t.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${t.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${t.icon.layoutVertexArray.length}) / 4`);if(t.bucketInstanceId in this.collisionCircleArrays){const e=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=e.invProjMatrix,t.placementViewportMatrix=e.viewportMatrix,t.collisionCircleArray=e.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return 0===this.fadeDuration?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,e){const i=this.zoomAtLastRecencyCheck===e?1-this.zoomAdjustment(e):1;return this.zoomAtLastRecencyCheck=e,this.commitTime+this.fadeDuration*i>t}setStale(){this.stale=!0}}function $t(t,e,i,r,n,o){r&&0!==r.length||(r=[0,0,0,0]);const s=r[0]-Ft,a=r[1]-Ft,l=r[2]-Ft,c=r[3]-Ft;t.emplaceBack(e?1:0,i?1:0,n||0,o||0,s,a),t.emplaceBack(e?1:0,i?1:0,n||0,o||0,l,a),t.emplaceBack(e?1:0,i?1:0,n||0,o||0,l,c),t.emplaceBack(e?1:0,i?1:0,n||0,o||0,s,c)}const Zt=Math.pow(2,25),qt=Math.pow(2,24),Kt=Math.pow(2,17),Wt=Math.pow(2,16),Xt=Math.pow(2,9),Jt=Math.pow(2,8),Yt=Math.pow(2,1);function te(t){if(0===t.opacity&&!t.placed)return 0;if(1===t.opacity&&t.placed)return 4294967295;const e=t.placed?1:0,i=Math.floor(127*t.opacity);return i*Zt+e*qt+i*Kt+e*Wt+i*Xt+e*Jt+i*Yt+e}const ee=0;function ie(){return{isOccluded:(t,e,i)=>!1,getPitchedTextCorrection:(t,e,i)=>1,get useSpecialProjectionForSymbols(){return!1},projectTileCoordinates(t,e,i,r){throw new Error("Not implemented.")},translatePosition:(t,e,i,r)=>function(t,e,i,r,n=!1){if(!i[0]&&!i[1])return[0,0];const o=n?"map"===r?t.angle:0:"viewport"===r?-t.angle:0;if(o){const t=Math.sin(o),e=Math.cos(o);i=[i[0]*e-i[1]*t,i[0]*t+i[1]*e]}return[n?i[0]:Rt(e,i[0],t.zoom),n?i[1]:Rt(e,i[1],t.zoom)]}(t,e,i,r),getCircleRadiusCorrection:t=>1}}class re{constructor(t){this._sortAcrossTiles="viewport-y"!==t.layout.get("symbol-z-order")&&!t.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,e,i,r,n){const o=this._bucketParts;for(;this._currentTileIndex<t.length;)if(e.getBucketParts(o,r,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,n())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,o.sort(((t,e)=>t.sortKey-e.sortKey)));this._currentPartIndex<o.length;)if(e.placeLayerBucketPart(o[this._currentPartIndex],this._seenCrossTileIDs,i),this._currentPartIndex++,n())return!0;return!1}}class ne{constructor(t,e,i,r,n,o,s,a){this.placement=new Gt(t,ie(),e,o,s,a),this._currentPlacementIndex=i.length-1,this._forceFullPlacement=r,this._showCollisionBoxes=n,this._done=!1}isDone(){return this._done}continuePlacement(t,e,i){const r=o.now(),n=()=>!this._forceFullPlacement&&o.now()-r>2;for(;this._currentPlacementIndex>=0;){const r=e[t[this._currentPlacementIndex]],o=this.placement.collisionIndex.transform.zoom;if("symbol"===r.type&&(!r.minzoom||r.minzoom<=o)&&(!r.maxzoom||r.maxzoom>o)){if(this._inProgressLayer||(this._inProgressLayer=new re(r)),this._inProgressLayer.continuePlacement(i[r.source],this.placement,this._showCollisionBoxes,r,n))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const oe=512/e.X/2;class se{constructor(t,i,r){this.tileID=t,this.bucketInstanceId=r,this._symbolsByKey={};const n=new Map;for(let t=0;t<i.length;t++){const e=i.get(t),r=e.key,o=n.get(r);o?o.push(e):n.set(r,[e])}for(const[t,i]of n){const r={positions:i.map((t=>({x:Math.floor(t.anchorX*oe),y:Math.floor(t.anchorY*oe)}))),crossTileIDs:i.map((t=>t.crossTileID))};if(r.positions.length>128){const t=new e.av(r.positions.length,16,Uint16Array);for(const{x:e,y:i}of r.positions)t.add(e,i);t.finish(),delete r.positions,r.index=t}this._symbolsByKey[t]=r}}getScaledCoordinates(t,i){const{x:r,y:n,z:o}=this.tileID.canonical,{x:s,y:a,z:l}=i.canonical,c=oe/Math.pow(2,l-o),u=(a*e.X+t.anchorY)*c,h=n*e.X*oe;return{x:Math.floor((s*e.X+t.anchorX)*c-r*e.X*oe),y:Math.floor(u-h)}}findMatches(t,e,i){const r=this.tileID.canonical.z<e.canonical.z?1:Math.pow(2,this.tileID.canonical.z-e.canonical.z);for(let n=0;n<t.length;n++){const o=t.get(n);if(o.crossTileID)continue;const s=this._symbolsByKey[o.key];if(!s)continue;const a=this.getScaledCoordinates(o,e);if(s.index){const t=s.index.range(a.x-r,a.y-r,a.x+r,a.y+r).sort();for(const e of t){const t=s.crossTileIDs[e];if(!i[t]){i[t]=!0,o.crossTileID=t;break}}}else if(s.positions)for(let t=0;t<s.positions.length;t++){const e=s.positions[t],n=s.crossTileIDs[t];if(Math.abs(e.x-a.x)<=r&&Math.abs(e.y-a.y)<=r&&!i[n]){i[n]=!0,o.crossTileID=n;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map((({crossTileIDs:t})=>t))}}class ae{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class le{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const e=Math.round((t-this.lng)/360);if(0!==e)for(const t in this.indexes){const i=this.indexes[t],r={};for(const t in i){const n=i[t];n.tileID=n.tileID.unwrapTo(n.tileID.wrap+e),r[n.tileID.key]=n}this.indexes[t]=r}this.lng=t}addBucket(t,e,i){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===e.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let t=0;t<e.symbolInstances.length;t++)e.symbolInstances.get(t).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const r=this.usedCrossTileIDs[t.overscaledZ];for(const i in this.indexes){const n=this.indexes[i];if(Number(i)>t.overscaledZ)for(const i in n){const o=n[i];o.tileID.isChildOf(t)&&o.findMatches(e.symbolInstances,t,r)}else{const o=n[t.scaledTo(Number(i)).key];o&&o.findMatches(e.symbolInstances,t,r)}}for(let t=0;t<e.symbolInstances.length;t++){const n=e.symbolInstances.get(t);n.crossTileID||(n.crossTileID=i.generate(),r[n.crossTileID]=!0)}return void 0===this.indexes[t.overscaledZ]&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new se(t,e.symbolInstances,e.bucketInstanceId),!0}removeBucketCrossTileIDs(t,e){for(const i of e.getCrossTileIDsLists())for(const e of i)delete this.usedCrossTileIDs[t][e]}removeStaleBuckets(t){let e=!1;for(const i in this.indexes){const r=this.indexes[i];for(const n in r)t[r[n].bucketInstanceId]||(this.removeBucketCrossTileIDs(i,r[n]),delete r[n],e=!0)}return e}}class ce{constructor(){this.layerIndexes={},this.crossTileIDs=new ae,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,e,i){let r=this.layerIndexes[t.id];void 0===r&&(r=this.layerIndexes[t.id]=new le);let n=!1;const o={};r.handleWrapJump(i);for(const i of e){const e=i.getBucket(t);e&&t.id===e.layerIds[0]&&(e.bucketInstanceId||(e.bucketInstanceId=++this.maxBucketInstanceId),r.addBucket(i.tileID,e,this.crossTileIDs)&&(n=!0),o[e.bucketInstanceId]=!0)}return r.removeStaleBuckets(o)&&(n=!0),n}pruneUnusedLayers(t){const e={};t.forEach((t=>{e[t]=!0}));for(const t in this.layerIndexes)e[t]||delete this.layerIndexes[t]}}const ue=(t,i)=>e.t(t,i&&i.filter((t=>"source.canvas"!==t.identifier))),he=e.aw();class de extends e.E{constructor(t,i={}){super(),this._rtlPluginLoaded=()=>{for(const t in this.sourceCaches){const e=this.sourceCaches[t].getSource().type;"vector"!==e&&"geojson"!==e||this.sourceCaches[t].reload()}},this.map=t,this.dispatcher=new N(O(),t._getMapId()),this.dispatcher.registerMessageHandler("GG",((t,e)=>this.getGlyphs(t,e))),this.dispatcher.registerMessageHandler("GI",((t,e)=>this.getImages(t,e))),this.imageManager=new w,this.imageManager.setEventedParent(this),this.glyphManager=new C(t._requestManager,i.localIdeographFontFamily),this.lineAtlas=new L(256,512),this.crossTileSymbolIndex=new ce,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new e.ax,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",e.ay()),at().on(nt,this._rtlPluginLoaded),this.on("data",(t=>{if("source"!==t.dataType||"metadata"!==t.sourceDataType)return;const e=this.sourceCaches[t.sourceId];if(!e)return;const i=e.getSource();if(i&&i.vectorLayerIds)for(const t in this._layers){const e=this._layers[t];e.source===i.id&&this._validateLayer(e)}}))}loadURL(t,i={},r){this.fire(new e.k("dataloading",{dataType:"style"})),i.validate="boolean"!=typeof i.validate||i.validate;const n=this.map._requestManager.transformRequest(t,"Style");this._loadStyleRequest=new AbortController;const o=this._loadStyleRequest;e.h(n,this._loadStyleRequest).then((t=>{this._loadStyleRequest=null,this._load(t.data,i,r)})).catch((t=>{this._loadStyleRequest=null,t&&!o.signal.aborted&&this.fire(new e.j(t))}))}loadJSON(t,i={},r){this.fire(new e.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,o.frameAsync(this._frameRequest).then((()=>{this._frameRequest=null,i.validate=!1!==i.validate,this._load(t,i,r)})).catch((()=>{}))}loadEmpty(){this.fire(new e.k("dataloading",{dataType:"style"})),this._load(he,{validate:!1})}_load(t,i,r){var n;const o=i.transformStyle?i.transformStyle(r,t):t;if(!i.validate||!ue(this,e.u(o))){this._loaded=!0,this.stylesheet=o;for(const t in o.sources)this.addSource(t,o.sources[t],{validate:!1});o.sprite?this._loadSprite(o.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(o.glyphs),this._createLayers(),this.light=new M(this.stylesheet.light),this.sky=new P(this.stylesheet.sky),this.map.setTerrain(null!==(n=this.stylesheet.terrain)&&void 0!==n?n:null),this.fire(new e.k("data",{dataType:"style"})),this.fire(new e.k("style.load"))}}_createLayers(){const t=e.az(this.stylesheet.layers);this.dispatcher.broadcast("SL",t),this._order=t.map((t=>t.id)),this._layers={},this._serializedLayers=null;for(const i of t){const t=e.aA(i);t.setEventedParent(this,{layer:{id:i.id}}),this._layers[i.id]=t}}_loadSprite(t,i=!1,r=void 0){let n;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(t,i,r,n){return e._(this,void 0,void 0,(function*(){const s=y(t),a=r>1?"@2x":"",l={},c={};for(const{id:t,url:r}of s){const o=i.transformRequest(v(r,a,".json"),"SpriteJSON");l[t]=e.h(o,n);const s=i.transformRequest(v(r,a,".png"),"SpriteImage");c[t]=p.getImage(s,n)}return yield Promise.all([...Object.values(l),...Object.values(c)]),function(t,i){return e._(this,void 0,void 0,(function*(){const e={};for(const r in t){e[r]={};const n=o.getImageCanvasContext((yield i[r]).data),s=(yield t[r]).data;for(const t in s){const{width:i,height:o,x:a,y:l,sdf:c,pixelRatio:u,stretchX:h,stretchY:d,content:p,textFitWidth:f,textFitHeight:A}=s[t];e[r][t]={data:null,pixelRatio:u,sdf:c,stretchX:h,stretchY:d,content:p,textFitWidth:f,textFitHeight:A,spriteData:{width:i,height:o,x:a,y:l,context:n}}}}return e}))}(l,c)}))}(t,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then((t=>{if(this._spriteRequest=null,t)for(const e in t){this._spritesImagesIds[e]=[];const r=this._spritesImagesIds[e]?this._spritesImagesIds[e].filter((e=>!(e in t))):[];for(const t of r)this.imageManager.removeImage(t),this._changedImages[t]=!0;for(const r in t[e]){const n="default"===e?r:`${e}:${r}`;this._spritesImagesIds[e].push(n),n in this.imageManager.images?this.imageManager.updateImage(n,t[e][r],!1):this.imageManager.addImage(n,t[e][r]),i&&(this._changedImages[n]=!0)}}})).catch((t=>{this._spriteRequest=null,n=t,this.fire(new e.j(n))})).finally((()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),i&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new e.k("data",{dataType:"style"})),r&&r(n)}))}_unloadSprite(){for(const t of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(t),this._changedImages[t]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new e.k("data",{dataType:"style"}))}_validateLayer(t){const i=this.sourceCaches[t.source];if(!i)return;const r=t.sourceLayer;if(!r)return;const n=i.getSource();("geojson"===n.type||n.vectorLayerIds&&-1===n.vectorLayerIds.indexOf(r))&&this.fire(new e.j(new Error(`Source layer "${r}" does not exist on source "${n.id}" as specified by style layer "${t.id}".`)))}loaded(){if(!this._loaded)return!1;if(Object.keys(this._updatedSources).length)return!1;for(const t in this.sourceCaches)if(!this.sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(t,i=!1){const r=this._serializedAllLayers();if(!t||0===t.length)return Object.values(i?e.aB(r):r);const n=[];for(const o of t)if(r[o]){const t=i?e.aB(r[o]):r[o];n.push(t)}return n}_serializedAllLayers(){let t=this._serializedLayers;if(t)return t;t=this._serializedLayers={};const e=Object.keys(this._layers);for(const i of e){const e=this._layers[i];"custom"!==e.type&&(t[i]=e.serialize())}return t}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;if(this.sky&&this.sky.hasTransition())return!0;for(const t in this.sourceCaches)if(this.sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(t){if(!this._loaded)return;const i=this._changed;if(i){const e=Object.keys(this._updatedLayers),i=Object.keys(this._removedLayers);(e.length||i.length)&&this._updateWorkerLayers(e,i);for(const t in this._updatedSources){const e=this._updatedSources[t];if("reload"===e)this._reloadSource(t);else{if("clear"!==e)throw new Error(`Invalid action ${e}`);this._clearSource(t)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const e in this._updatedPaintProps)this._layers[e].updateTransitions(t);this.light.updateTransitions(t),this.sky.updateTransitions(t),this._resetUpdates()}const r={};for(const t in this.sourceCaches){const e=this.sourceCaches[t];r[t]=e.used,e.used=!1}for(const e of this._order){const i=this._layers[e];i.recalculate(t,this._availableImages),!i.isHidden(t.zoom)&&i.source&&(this.sourceCaches[i.source].used=!0)}for(const t in r){const i=this.sourceCaches[t];!!r[t]!=!!i.used&&i.fire(new e.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:t}))}this.light.recalculate(t),this.sky.recalculate(t),this.z=t.zoom,i&&this.fire(new e.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const e in this.sourceCaches)this.sourceCaches[e].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const t in this.sourceCaches)this.sourceCaches[t].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(t,e){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(t,!1),removedIds:e})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(t,i={}){var r;this._checkLoaded();const n=this.serialize();if(t=i.transformStyle?i.transformStyle(n,t):t,(null===(r=i.validate)||void 0===r||r)&&ue(this,e.u(t)))return!1;(t=e.aB(t)).layers=e.az(t.layers);const o=e.aC(n,t),s=this._getOperationsToPerform(o);if(s.unimplemented.length>0)throw new Error(`Unimplemented: ${s.unimplemented.join(", ")}.`);if(0===s.operations.length)return!1;for(const t of s.operations)t();return this.stylesheet=t,this._serializedLayers=null,!0}_getOperationsToPerform(t){const e=[],i=[];for(const r of t)switch(r.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":e.push((()=>this.addLayer.apply(this,r.args)));break;case"removeLayer":e.push((()=>this.removeLayer.apply(this,r.args)));break;case"setPaintProperty":e.push((()=>this.setPaintProperty.apply(this,r.args)));break;case"setLayoutProperty":e.push((()=>this.setLayoutProperty.apply(this,r.args)));break;case"setFilter":e.push((()=>this.setFilter.apply(this,r.args)));break;case"addSource":e.push((()=>this.addSource.apply(this,r.args)));break;case"removeSource":e.push((()=>this.removeSource.apply(this,r.args)));break;case"setLayerZoomRange":e.push((()=>this.setLayerZoomRange.apply(this,r.args)));break;case"setLight":e.push((()=>this.setLight.apply(this,r.args)));break;case"setGeoJSONSourceData":e.push((()=>this.setGeoJSONSourceData.apply(this,r.args)));break;case"setGlyphs":e.push((()=>this.setGlyphs.apply(this,r.args)));break;case"setSprite":e.push((()=>this.setSprite.apply(this,r.args)));break;case"setSky":e.push((()=>this.setSky.apply(this,r.args)));break;case"setTerrain":e.push((()=>this.map.setTerrain.apply(this,r.args)));break;case"setTransition":e.push((()=>{}));break;default:i.push(r.command)}return{operations:e,unimplemented:i}}addImage(t,i){if(this.getImage(t))return this.fire(new e.j(new Error(`An image named "${t}" already exists.`)));this.imageManager.addImage(t,i),this._afterImageUpdated(t)}updateImage(t,e){this.imageManager.updateImage(t,e)}getImage(t){return this.imageManager.getImage(t)}removeImage(t){if(!this.getImage(t))return this.fire(new e.j(new Error(`An image named "${t}" does not exist.`)));this.imageManager.removeImage(t),this._afterImageUpdated(t)}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new e.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(t,i,r={}){if(this._checkLoaded(),void 0!==this.sourceCaches[t])throw new Error(`Source "${t}" already exists.`);if(!i.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(i).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(i.type)>=0&&this._validate(e.u.source,`sources.${t}`,i,null,r))return;this.map&&this.map._collectResourceTiming&&(i.collectResourceTiming=!0);const n=this.sourceCaches[t]=new ht(t,i,this.dispatcher);n.style=this,n.setEventedParent(this,(()=>({isSourceLoaded:n.loaded(),source:n.serialize(),sourceId:t}))),n.onAdd(this.map),this._changed=!0}removeSource(t){if(this._checkLoaded(),void 0===this.sourceCaches[t])throw new Error("There is no source with this ID");for(const i in this._layers)if(this._layers[i].source===t)return this.fire(new e.j(new Error(`Source "${t}" cannot be removed while layer "${i}" is using it.`)));const i=this.sourceCaches[t];delete this.sourceCaches[t],delete this._updatedSources[t],i.fire(new e.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:t})),i.setEventedParent(null),i.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(t,e){if(this._checkLoaded(),void 0===this.sourceCaches[t])throw new Error(`There is no source with this ID=${t}`);const i=this.sourceCaches[t].getSource();if("geojson"!==i.type)throw new Error(`geojsonSource.type is ${i.type}, which is !== 'geojson`);i.setData(e),this._changed=!0}getSource(t){return this.sourceCaches[t]&&this.sourceCaches[t].getSource()}addLayer(t,i,r={}){this._checkLoaded();const n=t.id;if(this.getLayer(n))return void this.fire(new e.j(new Error(`Layer "${n}" already exists on this map.`)));let o;if("custom"===t.type){if(ue(this,e.aD(t)))return;o=e.aA(t)}else{if("source"in t&&"object"==typeof t.source&&(this.addSource(n,t.source),t=e.aB(t),t=e.e(t,{source:n})),this._validate(e.u.layer,`layers.${n}`,t,{arrayIndex:-1},r))return;o=e.aA(t),this._validateLayer(o),o.setEventedParent(this,{layer:{id:n}})}const s=i?this._order.indexOf(i):this._order.length;if(i&&-1===s)this.fire(new e.j(new Error(`Cannot add layer "${n}" before non-existing layer "${i}".`)));else{if(this._order.splice(s,0,n),this._layerOrderChanged=!0,this._layers[n]=o,this._removedLayers[n]&&o.source&&"custom"!==o.type){const t=this._removedLayers[n];delete this._removedLayers[n],t.type!==o.type?this._updatedSources[o.source]="clear":(this._updatedSources[o.source]="reload",this.sourceCaches[o.source].pause())}this._updateLayer(o),o.onAdd&&o.onAdd(this.map)}}moveLayer(t,i){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new e.j(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===i)return;const r=this._order.indexOf(t);this._order.splice(r,1);const n=i?this._order.indexOf(i):this._order.length;i&&-1===n?this.fire(new e.j(new Error(`Cannot move layer "${t}" before non-existing layer "${i}".`))):(this._order.splice(n,0,t),this._layerOrderChanged=!0)}removeLayer(t){this._checkLoaded();const i=this._layers[t];if(!i)return void this.fire(new e.j(new Error(`Cannot remove non-existing layer "${t}".`)));i.setEventedParent(null);const r=this._order.indexOf(t);this._order.splice(r,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=i,delete this._layers[t],this._serializedLayers&&delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],i.onRemove&&i.onRemove(this.map)}getLayer(t){return this._layers[t]}getLayersOrder(){return[...this._order]}hasLayer(t){return t in this._layers}setLayerZoomRange(t,i,r){this._checkLoaded();const n=this.getLayer(t);n?n.minzoom===i&&n.maxzoom===r||(null!=i&&(n.minzoom=i),null!=r&&(n.maxzoom=r),this._updateLayer(n)):this.fire(new e.j(new Error(`Cannot set the zoom range of non-existing layer "${t}".`)))}setFilter(t,i,r={}){this._checkLoaded();const n=this.getLayer(t);if(n){if(!e.aE(n.filter,i))return null==i?(n.filter=void 0,void this._updateLayer(n)):void(this._validate(e.u.filter,`layers.${n.id}.filter`,i,null,r)||(n.filter=e.aB(i),this._updateLayer(n)))}else this.fire(new e.j(new Error(`Cannot filter non-existing layer "${t}".`)))}getFilter(t){return e.aB(this.getLayer(t).filter)}setLayoutProperty(t,i,r,n={}){this._checkLoaded();const o=this.getLayer(t);o?e.aE(o.getLayoutProperty(i),r)||(o.setLayoutProperty(i,r,n),this._updateLayer(o)):this.fire(new e.j(new Error(`Cannot style non-existing layer "${t}".`)))}getLayoutProperty(t,i){const r=this.getLayer(t);if(r)return r.getLayoutProperty(i);this.fire(new e.j(new Error(`Cannot get style of non-existing layer "${t}".`)))}setPaintProperty(t,i,r,n={}){this._checkLoaded();const o=this.getLayer(t);o?e.aE(o.getPaintProperty(i),r)||(o.setPaintProperty(i,r,n)&&this._updateLayer(o),this._changed=!0,this._updatedPaintProps[t]=!0,this._serializedLayers=null):this.fire(new e.j(new Error(`Cannot style non-existing layer "${t}".`)))}getPaintProperty(t,e){return this.getLayer(t).getPaintProperty(e)}setFeatureState(t,i){this._checkLoaded();const r=t.source,n=t.sourceLayer,o=this.sourceCaches[r];if(void 0===o)return void this.fire(new e.j(new Error(`The source '${r}' does not exist in the map's style.`)));const s=o.getSource().type;"geojson"===s&&n?this.fire(new e.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):"vector"!==s||n?(void 0===t.id&&this.fire(new e.j(new Error("The feature id parameter must be provided."))),o.setFeatureState(n,t.id,i)):this.fire(new e.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(t,i){this._checkLoaded();const r=t.source,n=this.sourceCaches[r];if(void 0===n)return void this.fire(new e.j(new Error(`The source '${r}' does not exist in the map's style.`)));const o=n.getSource().type,s="vector"===o?t.sourceLayer:void 0;"vector"!==o||s?i&&"string"!=typeof t.id&&"number"!=typeof t.id?this.fire(new e.j(new Error("A feature id is required to remove its specific state property."))):n.removeFeatureState(s,t.id,i):this.fire(new e.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(t){this._checkLoaded();const i=t.source,r=t.sourceLayer,n=this.sourceCaches[i];if(void 0!==n)return"vector"!==n.getSource().type||r?(void 0===t.id&&this.fire(new e.j(new Error("The feature id parameter must be provided."))),n.getFeatureState(r,t.id)):void this.fire(new e.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new e.j(new Error(`The source '${i}' does not exist in the map's style.`)))}getTransition(){return e.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const t=e.aF(this.sourceCaches,(t=>t.serialize())),i=this._serializeByIds(this._order,!0),r=this.map.getTerrain()||void 0,n=this.stylesheet;return e.aG({version:n.version,name:n.name,metadata:n.metadata,light:n.light,sky:n.sky,center:n.center,zoom:n.zoom,bearing:n.bearing,pitch:n.pitch,sprite:n.sprite,glyphs:n.glyphs,transition:n.transition,sources:t,layers:i,terrain:r},(t=>void 0!==t))}_updateLayer(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&"raster"!==this.sourceCaches[t.source].getSource().type&&(this._updatedSources[t.source]="reload",this.sourceCaches[t.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(t){const e=t=>"fill-extrusion"===this._layers[t].type,i={},r=[];for(let n=this._order.length-1;n>=0;n--){const o=this._order[n];if(e(o)){i[o]=n;for(const e of t){const t=e[o];if(t)for(const e of t)r.push(e)}}}r.sort(((t,e)=>e.intersectionZ-t.intersectionZ));const n=[];for(let o=this._order.length-1;o>=0;o--){const s=this._order[o];if(e(s))for(let t=r.length-1;t>=0;t--){const e=r[t].feature;if(i[e.layer.id]<o)break;n.push(e),r.pop()}else for(const e of t){const t=e[s];if(t)for(const e of t)n.push(e.feature)}}return n}queryRenderedFeatures(t,i,r){i&&i.filter&&this._validate(e.u.filter,"queryRenderedFeatures.filter",i.filter,null,i);const n={};if(i&&i.layers){if(!Array.isArray(i.layers))return this.fire(new e.j(new Error("parameters.layers must be an Array."))),[];for(const t of i.layers){const i=this._layers[t];if(!i)return this.fire(new e.j(new Error(`The layer '${t}' does not exist in the map's style and cannot be queried for features.`))),[];n[i.source]=!0}}const o=[];i.availableImages=this._availableImages;const s=this._serializedAllLayers();for(const e in this.sourceCaches)i.layers&&!n[e]||o.push(j(this.sourceCaches[e],this._layers,s,t,i,r));return this.placement&&o.push(function(t,e,i,r,n,o,s){const a={},l=o.queryRenderedSymbols(r),c=[];for(const t of Object.keys(l).map(Number))c.push(s[t]);c.sort(H);for(const i of c){const r=i.featureIndex.lookupSymbolFeatures(l[i.bucketInstanceId],e,i.bucketIndex,i.sourceLayerIndex,n.filter,n.layers,n.availableImages,t);for(const t in r){const e=a[t]=a[t]||[],n=r[t];n.sort(((t,e)=>{const r=i.featureSortOrder;if(r){const i=r.indexOf(t.featureIndex);return r.indexOf(e.featureIndex)-i}return e.featureIndex-t.featureIndex}));for(const t of n)e.push(t)}}for(const e in a)a[e].forEach((r=>{const n=r.feature,o=i[t[e].source].getFeatureState(n.layer["source-layer"],n.id);n.source=n.layer.source,n.layer["source-layer"]&&(n.sourceLayer=n.layer["source-layer"]),n.state=o}));return a}(this._layers,s,this.sourceCaches,t,i,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(o)}querySourceFeatures(t,i){i&&i.filter&&this._validate(e.u.filter,"querySourceFeatures.filter",i.filter,null,i);const r=this.sourceCaches[t];return r?function(t,e){const i=t.getRenderableIds().map((e=>t.getTileByID(e))),r=[],n={};for(let t=0;t<i.length;t++){const o=i[t],s=o.tileID.canonical.key;n[s]||(n[s]=!0,o.querySourceFeatures(r,e))}return r}(r,i):[]}getLight(){return this.light.getLight()}setLight(t,i={}){this._checkLoaded();const r=this.light.getLight();let n=!1;for(const i in t)if(!e.aE(t[i],r[i])){n=!0;break}if(!n)return;const s={now:o.now(),transition:e.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t,i),this.light.updateTransitions(s)}getSky(){var t;return null===(t=this.stylesheet)||void 0===t?void 0:t.sky}setSky(t,i={}){const r=this.getSky();let n=!1;if(!t&&!r)return;if(t&&!r)n=!0;else if(!t&&r)n=!0;else for(const i in t)if(!e.aE(t[i],r[i])){n=!0;break}if(!n)return;const s={now:o.now(),transition:e.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=t,this.sky.setSky(t,i),this.sky.updateTransitions(s)}_validate(t,i,r,n,o={}){return(!o||!1!==o.validate)&&ue(this,t.call(e.u,e.e({key:i,style:this.serialize(),value:r,styleSpec:e.v},n)))}_remove(t=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),at().off(nt,this._rtlPluginLoaded);for(const t in this._layers)this._layers[t].setEventedParent(null);for(const t in this.sourceCaches){const e=this.sourceCaches[t];e.setEventedParent(null),e.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),t&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(t)}_clearSource(t){this.sourceCaches[t].clearTiles()}_reloadSource(t){this.sourceCaches[t].resume(),this.sourceCaches[t].reload()}_updateSources(t){for(const e in this.sourceCaches)this.sourceCaches[e].update(t,this.map.terrain)}_generateCollisionBoxes(){for(const t in this.sourceCaches)this._reloadSource(t)}_updatePlacement(t,e,i,r,n=!1){let s=!1,a=!1;const l={};for(const e of this._order){const i=this._layers[e];if("symbol"!==i.type)continue;if(!l[i.source]){const t=this.sourceCaches[i.source];l[i.source]=t.getRenderableIds(!0).map((e=>t.getTileByID(e))).sort(((t,e)=>e.tileID.overscaledZ-t.tileID.overscaledZ||(t.tileID.isLessThan(e.tileID)?-1:1)))}const r=this.crossTileSymbolIndex.addLayer(i,l[i.source],t.center.lng);s=s||r}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((n=n||this._layerOrderChanged||0===i)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(o.now(),t.zoom))&&(this.pauseablePlacement=new ne(t,this.map.terrain,this._order,n,e,i,r,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,l),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(o.now()),a=!0),s&&this.pauseablePlacement.placement.setStale()),a||s)for(const t of this._order){const e=this._layers[t];"symbol"===e.type&&this.placement.updateLayerOpacities(e,l[e.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(o.now())}_releaseSymbolFadeTiles(){for(const t in this.sourceCaches)this.sourceCaches[t].releaseSymbolFadeTiles()}getImages(t,i){return e._(this,void 0,void 0,(function*(){const t=yield this.imageManager.getImages(i.icons);this._updateTilesForChangedImages();const e=this.sourceCaches[i.source];return e&&e.setDependencies(i.tileID.key,i.type,i.icons),t}))}getGlyphs(t,i){return e._(this,void 0,void 0,(function*(){const t=yield this.glyphManager.getGlyphs(i.stacks),e=this.sourceCaches[i.source];return e&&e.setDependencies(i.tileID.key,i.type,[""]),t}))}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(t,i={}){this._checkLoaded(),t&&this._validate(e.u.glyphs,"glyphs",t,null,i)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=t,this.glyphManager.entries={},this.glyphManager.setURL(t))}addSprite(t,i,r={},n){this._checkLoaded();const o=[{id:t,url:i}],s=[...y(this.stylesheet.sprite),...o];this._validate(e.u.sprite,"sprite",s,null,r)||(this.stylesheet.sprite=s,this._loadSprite(o,!0,n))}removeSprite(t){this._checkLoaded();const i=y(this.stylesheet.sprite);if(i.find((e=>e.id===t))){if(this._spritesImagesIds[t])for(const e of this._spritesImagesIds[t])this.imageManager.removeImage(e),this._changedImages[e]=!0;i.splice(i.findIndex((e=>e.id===t)),1),this.stylesheet.sprite=i.length>0?i:void 0,delete this._spritesImagesIds[t],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new e.k("data",{dataType:"style"}))}else this.fire(new e.j(new Error(`Sprite "${t}" doesn't exists on this map.`)))}getSprite(){return y(this.stylesheet.sprite)}setSprite(t,i={},r){this._checkLoaded(),t&&this._validate(e.u.sprite,"sprite",t,null,i)||(this.stylesheet.sprite=t,t?this._loadSprite(t,!0,r):(this._unloadSprite(),r&&r(null)))}}var pe=e.Y([{name:"a_pos",type:"Int16",components:2}]);const fe={prelude:Ae("#ifdef GL_ES\nprecision mediump float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif\n","#ifdef GL_ES\nprecision highp float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}\n#ifdef TERRAIN3D\nuniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;\n#endif\nconst highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {\n#ifdef TERRAIN3D\nhighp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));\n#else\nreturn 1.0;\n#endif\n}float calculate_visibility(vec4 pos) {\n#ifdef TERRAIN3D\nvec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;\n#else\nreturn 1.0;\n#endif\n}float ele(vec2 pos) {\n#ifdef TERRAIN3D\nvec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;\n#else\nreturn 0.0;\n#endif\n}float get_elevation(vec2 pos) {\n#ifdef TERRAIN3D\nvec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;\n#else\nreturn 0.0;\n#endif\n}"),background:Ae("uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:Ae("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Ae("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}"),clippingMask:Ae("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Ae("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,get_elevation(floor(a_pos*0.5)),1);gl_Position=u_matrix*pos;}"),heatmapTexture:Ae("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Ae("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_anchor_pos;attribute vec2 a_placed;attribute vec2 a_box_real;uniform mat4 u_matrix;uniform vec2 u_pixel_extrude_scale;varying float v_placed;varying float v_notUsed;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Ae("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Ae("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:Ae("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_FragColor=color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);}"),fillOutline:Ae("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}"),fillOutlinePattern:Ae("uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}"),fillPattern:Ae("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}"),fillExtrusion:Ae("varying vec4 v_color;void main() {gl_FragColor=v_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;\n#ifdef TERRAIN3D\nattribute vec2 a_centroid;\n#endif\nvarying vec4 v_color;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec3 normal=a_normal_ed.xyz;\n#ifdef TERRAIN3D\nfloat height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);\n#else\nfloat height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;\n#endif\nbase=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}"),fillExtrusionPattern:Ae("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;\n#ifdef TERRAIN3D\nattribute vec2 a_centroid;\n#endif\nvarying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;\n#ifdef TERRAIN3D\nfloat height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);\n#else\nfloat height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;\n#endif\nbase=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0\n? a_pos\n: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}"),hillshadePrepare:Ae("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Ae("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;\n#define PI 3.141592653589793\nvoid main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:Ae("uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;\n#ifdef TERRAIN3D\nv_gamma_scale=1.0;\n#else\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#endif\nv_width2=vec2(outset,inset);}"),lineGradient:Ae("uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;\n#ifdef TERRAIN3D\nv_gamma_scale=1.0;\n#else\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#endif\nv_width2=vec2(outset,inset);}"),linePattern:Ae("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\n#define LINE_DISTANCE_SCALE 2.0\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;\n#ifdef TERRAIN3D\nv_gamma_scale=1.0;\n#else\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}"),lineSDF:Ae("uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\n#define LINE_DISTANCE_SCALE 2.0\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;\n#ifdef TERRAIN3D\nv_gamma_scale=1.0;\n#else\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#endif\nv_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}"),raster:Ae("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:Ae("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_tex;varying float v_fade_opacity;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}"),symbolSDF:Ae("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_data0;varying vec3 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}"),symbolTextAndIcon:Ae("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec4 v_data0;varying vec4 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}"),terrain:Ae("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;varying vec2 v_texture_pos;varying float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture2D(u_texture,v_texture_pos);if (v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);gl_FragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {gl_FragColor=surface_color;}}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform mat4 u_fog_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:Ae("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:Ae("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);}"),sky:Ae("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform float u_horizon;uniform float u_sky_horizon_blend;void main() {float y=gl_FragCoord.y;if (y > u_horizon) {float blend=y-u_horizon;if (blend < u_sky_horizon_blend) {gl_FragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {gl_FragColor=u_sky_color;}}}","attribute vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function Ae(t,e){const i=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,r=e.match(/attribute ([\w]+) ([\w]+)/g),n=t.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),o=e.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),s=o?o.concat(n):n,a={};return{fragmentSource:t=t.replace(i,((t,e,i,r,n)=>(a[n]=!0,"define"===e?`\n#ifndef HAS_UNIFORM_u_${n}\nvarying ${i} ${r} ${n};\n#else\nuniform ${i} ${r} u_${n};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${n}\n    ${i} ${r} ${n} = u_${n};\n#endif\n`))),vertexSource:e=e.replace(i,((t,e,i,r,n)=>{const o="float"===r?"vec2":"vec4",s=n.match(/color/)?"color":o;return a[n]?"define"===e?`\n#ifndef HAS_UNIFORM_u_${n}\nuniform lowp float u_${n}_t;\nattribute ${i} ${o} a_${n};\nvarying ${i} ${r} ${n};\n#else\nuniform ${i} ${r} u_${n};\n#endif\n`:"vec4"===s?`\n#ifndef HAS_UNIFORM_u_${n}\n    ${n} = a_${n};\n#else\n    ${i} ${r} ${n} = u_${n};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${n}\n    ${n} = unpack_mix_${s}(a_${n}, u_${n}_t);\n#else\n    ${i} ${r} ${n} = u_${n};\n#endif\n`:"define"===e?`\n#ifndef HAS_UNIFORM_u_${n}\nuniform lowp float u_${n}_t;\nattribute ${i} ${o} a_${n};\n#else\nuniform ${i} ${r} u_${n};\n#endif\n`:"vec4"===s?`\n#ifndef HAS_UNIFORM_u_${n}\n    ${i} ${r} ${n} = a_${n};\n#else\n    ${i} ${r} ${n} = u_${n};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${n}\n    ${i} ${r} ${n} = unpack_mix_${s}(a_${n}, u_${n}_t);\n#else\n    ${i} ${r} ${n} = u_${n};\n#endif\n`})),staticAttributes:r,staticUniforms:s}}class me{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,e,i,r,n,o,s,a,l){this.context=t;let c=this.boundPaintVertexBuffers.length!==r.length;for(let t=0;!c&&t<r.length;t++)this.boundPaintVertexBuffers[t]!==r[t]&&(c=!0);!this.vao||this.boundProgram!==e||this.boundLayoutVertexBuffer!==i||c||this.boundIndexBuffer!==n||this.boundVertexOffset!==o||this.boundDynamicVertexBuffer!==s||this.boundDynamicVertexBuffer2!==a||this.boundDynamicVertexBuffer3!==l?this.freshBind(e,i,r,n,o,s,a,l):(t.bindVertexArray.set(this.vao),s&&s.bind(),n&&n.dynamicDraw&&n.bind(),a&&a.bind(),l&&l.bind())}freshBind(t,e,i,r,n,o,s,a){const l=t.numAttributes,c=this.context,u=c.gl;this.vao&&this.destroy(),this.vao=c.createVertexArray(),c.bindVertexArray.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=e,this.boundPaintVertexBuffers=i,this.boundIndexBuffer=r,this.boundVertexOffset=n,this.boundDynamicVertexBuffer=o,this.boundDynamicVertexBuffer2=s,this.boundDynamicVertexBuffer3=a,e.enableAttributes(u,t);for(const e of i)e.enableAttributes(u,t);o&&o.enableAttributes(u,t),s&&s.enableAttributes(u,t),a&&a.enableAttributes(u,t),e.bind(),e.setVertexAttribPointers(u,t,n);for(const e of i)e.bind(),e.setVertexAttribPointers(u,t,n);o&&(o.bind(),o.setVertexAttribPointers(u,t,n)),r&&r.bind(),s&&(s.bind(),s.setVertexAttribPointers(u,t,n)),a&&(a.bind(),a.setVertexAttribPointers(u,t,n)),c.currentNumAttributes=l}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const ge=(t,i,r,n,o)=>({u_matrix:t,u_texture:0,u_ele_delta:i,u_fog_matrix:r,u_fog_color:n?n.properties.get("fog-color"):e.aM.white,u_fog_ground_blend:n?n.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:n?n.calculateFogBlendOpacity(o):0,u_horizon_color:n?n.properties.get("horizon-color"):e.aM.white,u_horizon_fog_blend:n?n.properties.get("horizon-fog-blend"):1});function _e(t){const e=[];for(let i=0;i<t.length;i++){if(null===t[i])continue;const r=t[i].split(" ");e.push(r.pop())}return e}class ye{constructor(t,i,r,n,o,s){const a=t.gl;this.program=a.createProgram();const l=_e(i.staticAttributes),c=r?r.getBinderAttributes():[],u=l.concat(c),h=fe.prelude.staticUniforms?_e(fe.prelude.staticUniforms):[],d=i.staticUniforms?_e(i.staticUniforms):[],p=r?r.getBinderUniforms():[],f=h.concat(d).concat(p),A=[];for(const t of f)A.indexOf(t)<0&&A.push(t);const m=r?r.defines():[];o&&m.push("#define OVERDRAW_INSPECTOR;"),s&&m.push("#define TERRAIN3D;");const g=m.concat(fe.prelude.fragmentSource,i.fragmentSource).join("\n"),_=m.concat(fe.prelude.vertexSource,i.vertexSource).join("\n"),y=a.createShader(a.FRAGMENT_SHADER);if(a.isContextLost())return void(this.failedToCreate=!0);if(a.shaderSource(y,g),a.compileShader(y),!a.getShaderParameter(y,a.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${a.getShaderInfoLog(y)}`);a.attachShader(this.program,y);const v=a.createShader(a.VERTEX_SHADER);if(a.isContextLost())return void(this.failedToCreate=!0);if(a.shaderSource(v,_),a.compileShader(v),!a.getShaderParameter(v,a.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${a.getShaderInfoLog(v)}`);a.attachShader(this.program,v),this.attributes={};const x={};this.numAttributes=u.length;for(let t=0;t<this.numAttributes;t++)u[t]&&(a.bindAttribLocation(this.program,t,u[t]),this.attributes[u[t]]=t);if(a.linkProgram(this.program),!a.getProgramParameter(this.program,a.LINK_STATUS))throw new Error(`Program failed to link: ${a.getProgramInfoLog(this.program)}`);a.deleteShader(v),a.deleteShader(y);for(let t=0;t<A.length;t++){const e=A[t];if(e&&!x[e]){const t=a.getUniformLocation(this.program,e);t&&(x[e]=t)}}this.fixedUniforms=n(t,x),this.terrainUniforms=((t,i)=>({u_depth:new e.aH(t,i.u_depth),u_terrain:new e.aH(t,i.u_terrain),u_terrain_dim:new e.aI(t,i.u_terrain_dim),u_terrain_matrix:new e.aJ(t,i.u_terrain_matrix),u_terrain_unpack:new e.aK(t,i.u_terrain_unpack),u_terrain_exaggeration:new e.aI(t,i.u_terrain_exaggeration)}))(t,x),this.binderUniforms=r?r.getUniforms(t,x):[]}draw(t,e,i,r,n,o,s,a,l,c,u,h,d,p,f,A,m,g){const _=t.gl;if(this.failedToCreate)return;if(t.program.set(this.program),t.setDepthMode(i),t.setStencilMode(r),t.setColorMode(n),t.setCullFace(o),a){t.activeTexture.set(_.TEXTURE2),_.bindTexture(_.TEXTURE_2D,a.depthTexture),t.activeTexture.set(_.TEXTURE3),_.bindTexture(_.TEXTURE_2D,a.texture);for(const t in this.terrainUniforms)this.terrainUniforms[t].set(a[t])}for(const t in this.fixedUniforms)this.fixedUniforms[t].set(s[t]);f&&f.setUniforms(t,this.binderUniforms,d,{zoom:p});let y=0;switch(e){case _.LINES:y=2;break;case _.TRIANGLES:y=3;break;case _.LINE_STRIP:y=1}for(const i of h.get()){const r=i.vaos||(i.vaos={});(r[l]||(r[l]=new me)).bind(t,this,c,f?f.getPaintVertexBuffers():[],u,i.vertexOffset,A,m,g),_.drawElements(e,i.primitiveLength*y,_.UNSIGNED_SHORT,i.primitiveOffset*y*2)}}}function ve(t,e,i){const r=1/Rt(i,1,e.transform.tileZoom),n=Math.pow(2,i.tileID.overscaledZ),o=i.tileSize*Math.pow(2,e.transform.tileZoom)/n,s=o*(i.tileID.canonical.x+i.tileID.wrap*n),a=o*i.tileID.canonical.y;return{u_image:0,u_texsize:i.imageAtlasTexture.size,u_scale:[r,t.fromScale,t.toScale],u_fade:t.t,u_pixel_coord_upper:[s>>16,a>>16],u_pixel_coord_lower:[65535&s,65535&a]}}const xe=(t,i,r,n)=>{const o=i.style.light,s=o.properties.get("position"),a=[s.x,s.y,s.z],l=function(){var t=new e.A(9);return e.A!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}();"viewport"===o.properties.get("anchor")&&function(t,e){var i=Math.sin(e),r=Math.cos(e);t[0]=r,t[1]=i,t[2]=0,t[3]=-i,t[4]=r,t[5]=0,t[6]=0,t[7]=0,t[8]=1}(l,-i.transform.angle),function(t,e,i){var r=e[0],n=e[1],o=e[2];t[0]=r*i[0]+n*i[3]+o*i[6],t[1]=r*i[1]+n*i[4]+o*i[7],t[2]=r*i[2]+n*i[5]+o*i[8]}(a,a,l);const c=o.properties.get("color");return{u_matrix:t,u_lightpos:a,u_lightintensity:o.properties.get("intensity"),u_lightcolor:[c.r,c.g,c.b],u_vertical_gradient:+r,u_opacity:n}},be=(t,i,r,n,o,s,a)=>e.e(xe(t,i,r,n),ve(s,i,a),{u_height_factor:-Math.pow(2,o.overscaledZ)/a.tileSize/8}),we=t=>({u_matrix:t}),Te=(t,i,r,n)=>e.e(we(t),ve(r,i,n)),Be=(t,e)=>({u_matrix:t,u_world:e}),Ee=(t,i,r,n,o)=>e.e(Te(t,i,r,n),{u_world:o}),Ce=(t,e,i,r)=>{const n=t.transform;let o,s;if("map"===r.paint.get("circle-pitch-alignment")){const t=Rt(i,1,n.zoom);o=!0,s=[t,t]}else o=!1,s=n.pixelsToGLUnits;return{u_camera_to_center_distance:n.cameraToCenterDistance,u_scale_with_map:+("map"===r.paint.get("circle-pitch-scale")),u_matrix:t.translatePosMatrix(e.posMatrix,i,r.paint.get("circle-translate"),r.paint.get("circle-translate-anchor")),u_pitch_with_map:+o,u_device_pixel_ratio:t.pixelRatio,u_extrude_scale:s}},Se=(t,e,i)=>({u_matrix:t,u_inv_matrix:e,u_camera_to_center_distance:i.cameraToCenterDistance,u_viewport_size:[i.width,i.height]}),Ie=(t,e,i=1)=>({u_matrix:t,u_color:e,u_overlay:0,u_overlay_scale:i}),Me=t=>({u_matrix:t}),ke=(t,e,i,r)=>({u_matrix:t,u_extrude_scale:Rt(e,1,i),u_intensity:r}),Pe=(t,i,r,n)=>{const o=e.H();e.aP(o,0,t.width,t.height,0,0,1);const s=t.context.gl;return{u_matrix:o,u_world:[s.drawingBufferWidth,s.drawingBufferHeight],u_image:r,u_color_ramp:n,u_opacity:i.paint.get("heatmap-opacity")}};function Le(t,i){const r=Math.pow(2,i.canonical.z),n=i.canonical.y;return[new e.Z(0,n/r).toLngLat().lat,new e.Z(0,(n+1)/r).toLngLat().lat]}const ze=(t,e,i,r)=>{const n=t.transform;return{u_matrix:Oe(t,e,i,r),u_ratio:1/Rt(e,1,n.zoom),u_device_pixel_ratio:t.pixelRatio,u_units_to_pixels:[1/n.pixelsToGLUnits[0],1/n.pixelsToGLUnits[1]]}},Fe=(t,i,r,n,o)=>e.e(ze(t,i,r,o),{u_image:0,u_image_height:n}),De=(t,e,i,r,n)=>{const o=t.transform,s=Ue(e,o);return{u_matrix:Oe(t,e,i,n),u_texsize:e.imageAtlasTexture.size,u_ratio:1/Rt(e,1,o.zoom),u_device_pixel_ratio:t.pixelRatio,u_image:0,u_scale:[s,r.fromScale,r.toScale],u_fade:r.t,u_units_to_pixels:[1/o.pixelsToGLUnits[0],1/o.pixelsToGLUnits[1]]}},Re=(t,i,r,n,o,s)=>{const a=t.lineAtlas,l=Ue(i,t.transform),c="round"===r.layout.get("line-cap"),u=a.getDash(n.from,c),h=a.getDash(n.to,c),d=u.width*o.fromScale,p=h.width*o.toScale;return e.e(ze(t,i,r,s),{u_patternscale_a:[l/d,-u.height/2],u_patternscale_b:[l/p,-h.height/2],u_sdfgamma:a.width/(256*Math.min(d,p)*t.pixelRatio)/2,u_image:0,u_tex_y_a:u.y,u_tex_y_b:h.y,u_mix:o.t})};function Ue(t,e){return 1/Rt(t,1,e.tileZoom)}function Oe(t,e,i,r){return t.translatePosMatrix(r?r.posMatrix:e.tileID.posMatrix,e,i.paint.get("line-translate"),i.paint.get("line-translate-anchor"))}const Ne=(t,e,i,r,n)=>{return{u_matrix:t,u_tl_parent:e,u_scale_parent:i,u_buffer_scale:1,u_fade_t:r.mix,u_opacity:r.opacity*n.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:n.paint.get("raster-brightness-min"),u_brightness_high:n.paint.get("raster-brightness-max"),u_saturation_factor:(s=n.paint.get("raster-saturation"),s>0?1-1/(1.001-s):-s),u_contrast_factor:(o=n.paint.get("raster-contrast"),o>0?1/(1-o):1+o),u_spin_weights:Qe(n.paint.get("raster-hue-rotate"))};var o,s};function Qe(t){t*=Math.PI/180;const e=Math.sin(t),i=Math.cos(t);return[(2*i+1)/3,(-Math.sqrt(3)*e-i+1)/3,(Math.sqrt(3)*e-i+1)/3]}const Ve=(t,e,i,r,n,o,s,a,l,c,u,h,d,p)=>{const f=s.transform;return{u_is_size_zoom_constant:+("constant"===t||"source"===t),u_is_size_feature_constant:+("constant"===t||"camera"===t),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:f.cameraToCenterDistance,u_pitch:f.pitch/360*2*Math.PI,u_rotate_symbol:+i,u_aspect_ratio:f.width/f.height,u_fade_change:s.options.fadeDuration?s.symbolFadeChange:1,u_matrix:a,u_label_plane_matrix:l,u_coord_matrix:c,u_is_text:+h,u_pitch_with_map:+r,u_is_along_line:n,u_is_variable_anchor:o,u_texsize:d,u_texture:0,u_translation:u,u_pitched_scale:p}},je=(t,i,r,n,o,s,a,l,c,u,h,d,p,f,A)=>{const m=a.transform;return e.e(Ve(t,i,r,n,o,s,a,l,c,u,h,d,p,A),{u_gamma_scale:n?Math.cos(m._pitch)*m.cameraToCenterDistance:1,u_device_pixel_ratio:a.pixelRatio,u_is_halo:+f})},He=(t,i,r,n,o,s,a,l,c,u,h,d,p,f)=>e.e(je(t,i,r,n,o,s,a,l,c,u,h,!0,d,!0,f),{u_texsize_icon:p,u_texture_icon:1}),Ge=(t,e,i)=>({u_matrix:t,u_opacity:e,u_color:i}),$e=(t,i,r,n,o,s)=>e.e(function(t,e,i,r){const n=i.imageManager.getPattern(t.from.toString()),o=i.imageManager.getPattern(t.to.toString()),{width:s,height:a}=i.imageManager.getPixelSize(),l=Math.pow(2,r.tileID.overscaledZ),c=r.tileSize*Math.pow(2,i.transform.tileZoom)/l,u=c*(r.tileID.canonical.x+r.tileID.wrap*l),h=c*r.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:n.tl,u_pattern_br_a:n.br,u_pattern_tl_b:o.tl,u_pattern_br_b:o.br,u_texsize:[s,a],u_mix:e.t,u_pattern_size_a:n.displaySize,u_pattern_size_b:o.displaySize,u_scale_a:e.fromScale,u_scale_b:e.toScale,u_tile_units_to_pixels:1/Rt(r,1,i.transform.tileZoom),u_pixel_coord_upper:[u>>16,h>>16],u_pixel_coord_lower:[65535&u,65535&h]}}(n,s,r,o),{u_matrix:t,u_opacity:i}),Ze={fillExtrusion:(t,i)=>({u_matrix:new e.aJ(t,i.u_matrix),u_lightpos:new e.aN(t,i.u_lightpos),u_lightintensity:new e.aI(t,i.u_lightintensity),u_lightcolor:new e.aN(t,i.u_lightcolor),u_vertical_gradient:new e.aI(t,i.u_vertical_gradient),u_opacity:new e.aI(t,i.u_opacity)}),fillExtrusionPattern:(t,i)=>({u_matrix:new e.aJ(t,i.u_matrix),u_lightpos:new e.aN(t,i.u_lightpos),u_lightintensity:new e.aI(t,i.u_lightintensity),u_lightcolor:new e.aN(t,i.u_lightcolor),u_vertical_gradient:new e.aI(t,i.u_vertical_gradient),u_height_factor:new e.aI(t,i.u_height_factor),u_image:new e.aH(t,i.u_image),u_texsize:new e.aO(t,i.u_texsize),u_pixel_coord_upper:new e.aO(t,i.u_pixel_coord_upper),u_pixel_coord_lower:new e.aO(t,i.u_pixel_coord_lower),u_scale:new e.aN(t,i.u_scale),u_fade:new e.aI(t,i.u_fade),u_opacity:new e.aI(t,i.u_opacity)}),fill:(t,i)=>({u_matrix:new e.aJ(t,i.u_matrix)}),fillPattern:(t,i)=>({u_matrix:new e.aJ(t,i.u_matrix),u_image:new e.aH(t,i.u_image),u_texsize:new e.aO(t,i.u_texsize),u_pixel_coord_upper:new e.aO(t,i.u_pixel_coord_upper),u_pixel_coord_lower:new e.aO(t,i.u_pixel_coord_lower),u_scale:new e.aN(t,i.u_scale),u_fade:new e.aI(t,i.u_fade)}),fillOutline:(t,i)=>({u_matrix:new e.aJ(t,i.u_matrix),u_world:new e.aO(t,i.u_world)}),fillOutlinePattern:(t,i)=>({u_matrix:new e.aJ(t,i.u_matrix),u_world:new e.aO(t,i.u_world),u_image:new e.aH(t,i.u_image),u_texsize:new e.aO(t,i.u_texsize),u_pixel_coord_upper:new e.aO(t,i.u_pixel_coord_upper),u_pixel_coord_lower:new e.aO(t,i.u_pixel_coord_lower),u_scale:new e.aN(t,i.u_scale),u_fade:new e.aI(t,i.u_fade)}),circle:(t,i)=>({u_camera_to_center_distance:new e.aI(t,i.u_camera_to_center_distance),u_scale_with_map:new e.aH(t,i.u_scale_with_map),u_pitch_with_map:new e.aH(t,i.u_pitch_with_map),u_extrude_scale:new e.aO(t,i.u_extrude_scale),u_device_pixel_ratio:new e.aI(t,i.u_device_pixel_ratio),u_matrix:new e.aJ(t,i.u_matrix)}),collisionBox:(t,i)=>({u_matrix:new e.aJ(t,i.u_matrix),u_pixel_extrude_scale:new e.aO(t,i.u_pixel_extrude_scale)}),collisionCircle:(t,i)=>({u_matrix:new e.aJ(t,i.u_matrix),u_inv_matrix:new e.aJ(t,i.u_inv_matrix),u_camera_to_center_distance:new e.aI(t,i.u_camera_to_center_distance),u_viewport_size:new e.aO(t,i.u_viewport_size)}),debug:(t,i)=>({u_color:new e.aL(t,i.u_color),u_matrix:new e.aJ(t,i.u_matrix),u_overlay:new e.aH(t,i.u_overlay),u_overlay_scale:new e.aI(t,i.u_overlay_scale)}),clippingMask:(t,i)=>({u_matrix:new e.aJ(t,i.u_matrix)}),heatmap:(t,i)=>({u_extrude_scale:new e.aI(t,i.u_extrude_scale),u_intensity:new e.aI(t,i.u_intensity),u_matrix:new e.aJ(t,i.u_matrix)}),heatmapTexture:(t,i)=>({u_matrix:new e.aJ(t,i.u_matrix),u_world:new e.aO(t,i.u_world),u_image:new e.aH(t,i.u_image),u_color_ramp:new e.aH(t,i.u_color_ramp),u_opacity:new e.aI(t,i.u_opacity)}),hillshade:(t,i)=>({u_matrix:new e.aJ(t,i.u_matrix),u_image:new e.aH(t,i.u_image),u_latrange:new e.aO(t,i.u_latrange),u_light:new e.aO(t,i.u_light),u_shadow:new e.aL(t,i.u_shadow),u_highlight:new e.aL(t,i.u_highlight),u_accent:new e.aL(t,i.u_accent)}),hillshadePrepare:(t,i)=>({u_matrix:new e.aJ(t,i.u_matrix),u_image:new e.aH(t,i.u_image),u_dimension:new e.aO(t,i.u_dimension),u_zoom:new e.aI(t,i.u_zoom),u_unpack:new e.aK(t,i.u_unpack)}),line:(t,i)=>({u_matrix:new e.aJ(t,i.u_matrix),u_ratio:new e.aI(t,i.u_ratio),u_device_pixel_ratio:new e.aI(t,i.u_device_pixel_ratio),u_units_to_pixels:new e.aO(t,i.u_units_to_pixels)}),lineGradient:(t,i)=>({u_matrix:new e.aJ(t,i.u_matrix),u_ratio:new e.aI(t,i.u_ratio),u_device_pixel_ratio:new e.aI(t,i.u_device_pixel_ratio),u_units_to_pixels:new e.aO(t,i.u_units_to_pixels),u_image:new e.aH(t,i.u_image),u_image_height:new e.aI(t,i.u_image_height)}),linePattern:(t,i)=>({u_matrix:new e.aJ(t,i.u_matrix),u_texsize:new e.aO(t,i.u_texsize),u_ratio:new e.aI(t,i.u_ratio),u_device_pixel_ratio:new e.aI(t,i.u_device_pixel_ratio),u_image:new e.aH(t,i.u_image),u_units_to_pixels:new e.aO(t,i.u_units_to_pixels),u_scale:new e.aN(t,i.u_scale),u_fade:new e.aI(t,i.u_fade)}),lineSDF:(t,i)=>({u_matrix:new e.aJ(t,i.u_matrix),u_ratio:new e.aI(t,i.u_ratio),u_device_pixel_ratio:new e.aI(t,i.u_device_pixel_ratio),u_units_to_pixels:new e.aO(t,i.u_units_to_pixels),u_patternscale_a:new e.aO(t,i.u_patternscale_a),u_patternscale_b:new e.aO(t,i.u_patternscale_b),u_sdfgamma:new e.aI(t,i.u_sdfgamma),u_image:new e.aH(t,i.u_image),u_tex_y_a:new e.aI(t,i.u_tex_y_a),u_tex_y_b:new e.aI(t,i.u_tex_y_b),u_mix:new e.aI(t,i.u_mix)}),raster:(t,i)=>({u_matrix:new e.aJ(t,i.u_matrix),u_tl_parent:new e.aO(t,i.u_tl_parent),u_scale_parent:new e.aI(t,i.u_scale_parent),u_buffer_scale:new e.aI(t,i.u_buffer_scale),u_fade_t:new e.aI(t,i.u_fade_t),u_opacity:new e.aI(t,i.u_opacity),u_image0:new e.aH(t,i.u_image0),u_image1:new e.aH(t,i.u_image1),u_brightness_low:new e.aI(t,i.u_brightness_low),u_brightness_high:new e.aI(t,i.u_brightness_high),u_saturation_factor:new e.aI(t,i.u_saturation_factor),u_contrast_factor:new e.aI(t,i.u_contrast_factor),u_spin_weights:new e.aN(t,i.u_spin_weights)}),symbolIcon:(t,i)=>({u_is_size_zoom_constant:new e.aH(t,i.u_is_size_zoom_constant),u_is_size_feature_constant:new e.aH(t,i.u_is_size_feature_constant),u_size_t:new e.aI(t,i.u_size_t),u_size:new e.aI(t,i.u_size),u_camera_to_center_distance:new e.aI(t,i.u_camera_to_center_distance),u_pitch:new e.aI(t,i.u_pitch),u_rotate_symbol:new e.aH(t,i.u_rotate_symbol),u_aspect_ratio:new e.aI(t,i.u_aspect_ratio),u_fade_change:new e.aI(t,i.u_fade_change),u_matrix:new e.aJ(t,i.u_matrix),u_label_plane_matrix:new e.aJ(t,i.u_label_plane_matrix),u_coord_matrix:new e.aJ(t,i.u_coord_matrix),u_is_text:new e.aH(t,i.u_is_text),u_pitch_with_map:new e.aH(t,i.u_pitch_with_map),u_is_along_line:new e.aH(t,i.u_is_along_line),u_is_variable_anchor:new e.aH(t,i.u_is_variable_anchor),u_texsize:new e.aO(t,i.u_texsize),u_texture:new e.aH(t,i.u_texture),u_translation:new e.aO(t,i.u_translation),u_pitched_scale:new e.aI(t,i.u_pitched_scale)}),symbolSDF:(t,i)=>({u_is_size_zoom_constant:new e.aH(t,i.u_is_size_zoom_constant),u_is_size_feature_constant:new e.aH(t,i.u_is_size_feature_constant),u_size_t:new e.aI(t,i.u_size_t),u_size:new e.aI(t,i.u_size),u_camera_to_center_distance:new e.aI(t,i.u_camera_to_center_distance),u_pitch:new e.aI(t,i.u_pitch),u_rotate_symbol:new e.aH(t,i.u_rotate_symbol),u_aspect_ratio:new e.aI(t,i.u_aspect_ratio),u_fade_change:new e.aI(t,i.u_fade_change),u_matrix:new e.aJ(t,i.u_matrix),u_label_plane_matrix:new e.aJ(t,i.u_label_plane_matrix),u_coord_matrix:new e.aJ(t,i.u_coord_matrix),u_is_text:new e.aH(t,i.u_is_text),u_pitch_with_map:new e.aH(t,i.u_pitch_with_map),u_is_along_line:new e.aH(t,i.u_is_along_line),u_is_variable_anchor:new e.aH(t,i.u_is_variable_anchor),u_texsize:new e.aO(t,i.u_texsize),u_texture:new e.aH(t,i.u_texture),u_gamma_scale:new e.aI(t,i.u_gamma_scale),u_device_pixel_ratio:new e.aI(t,i.u_device_pixel_ratio),u_is_halo:new e.aH(t,i.u_is_halo),u_translation:new e.aO(t,i.u_translation),u_pitched_scale:new e.aI(t,i.u_pitched_scale)}),symbolTextAndIcon:(t,i)=>({u_is_size_zoom_constant:new e.aH(t,i.u_is_size_zoom_constant),u_is_size_feature_constant:new e.aH(t,i.u_is_size_feature_constant),u_size_t:new e.aI(t,i.u_size_t),u_size:new e.aI(t,i.u_size),u_camera_to_center_distance:new e.aI(t,i.u_camera_to_center_distance),u_pitch:new e.aI(t,i.u_pitch),u_rotate_symbol:new e.aH(t,i.u_rotate_symbol),u_aspect_ratio:new e.aI(t,i.u_aspect_ratio),u_fade_change:new e.aI(t,i.u_fade_change),u_matrix:new e.aJ(t,i.u_matrix),u_label_plane_matrix:new e.aJ(t,i.u_label_plane_matrix),u_coord_matrix:new e.aJ(t,i.u_coord_matrix),u_is_text:new e.aH(t,i.u_is_text),u_pitch_with_map:new e.aH(t,i.u_pitch_with_map),u_is_along_line:new e.aH(t,i.u_is_along_line),u_is_variable_anchor:new e.aH(t,i.u_is_variable_anchor),u_texsize:new e.aO(t,i.u_texsize),u_texsize_icon:new e.aO(t,i.u_texsize_icon),u_texture:new e.aH(t,i.u_texture),u_texture_icon:new e.aH(t,i.u_texture_icon),u_gamma_scale:new e.aI(t,i.u_gamma_scale),u_device_pixel_ratio:new e.aI(t,i.u_device_pixel_ratio),u_is_halo:new e.aH(t,i.u_is_halo),u_translation:new e.aO(t,i.u_translation),u_pitched_scale:new e.aI(t,i.u_pitched_scale)}),background:(t,i)=>({u_matrix:new e.aJ(t,i.u_matrix),u_opacity:new e.aI(t,i.u_opacity),u_color:new e.aL(t,i.u_color)}),backgroundPattern:(t,i)=>({u_matrix:new e.aJ(t,i.u_matrix),u_opacity:new e.aI(t,i.u_opacity),u_image:new e.aH(t,i.u_image),u_pattern_tl_a:new e.aO(t,i.u_pattern_tl_a),u_pattern_br_a:new e.aO(t,i.u_pattern_br_a),u_pattern_tl_b:new e.aO(t,i.u_pattern_tl_b),u_pattern_br_b:new e.aO(t,i.u_pattern_br_b),u_texsize:new e.aO(t,i.u_texsize),u_mix:new e.aI(t,i.u_mix),u_pattern_size_a:new e.aO(t,i.u_pattern_size_a),u_pattern_size_b:new e.aO(t,i.u_pattern_size_b),u_scale_a:new e.aI(t,i.u_scale_a),u_scale_b:new e.aI(t,i.u_scale_b),u_pixel_coord_upper:new e.aO(t,i.u_pixel_coord_upper),u_pixel_coord_lower:new e.aO(t,i.u_pixel_coord_lower),u_tile_units_to_pixels:new e.aI(t,i.u_tile_units_to_pixels)}),terrain:(t,i)=>({u_matrix:new e.aJ(t,i.u_matrix),u_texture:new e.aH(t,i.u_texture),u_ele_delta:new e.aI(t,i.u_ele_delta),u_fog_matrix:new e.aJ(t,i.u_fog_matrix),u_fog_color:new e.aL(t,i.u_fog_color),u_fog_ground_blend:new e.aI(t,i.u_fog_ground_blend),u_fog_ground_blend_opacity:new e.aI(t,i.u_fog_ground_blend_opacity),u_horizon_color:new e.aL(t,i.u_horizon_color),u_horizon_fog_blend:new e.aI(t,i.u_horizon_fog_blend)}),terrainDepth:(t,i)=>({u_matrix:new e.aJ(t,i.u_matrix),u_ele_delta:new e.aI(t,i.u_ele_delta)}),terrainCoords:(t,i)=>({u_matrix:new e.aJ(t,i.u_matrix),u_texture:new e.aH(t,i.u_texture),u_terrain_coords_id:new e.aI(t,i.u_terrain_coords_id),u_ele_delta:new e.aI(t,i.u_ele_delta)}),sky:(t,i)=>({u_sky_color:new e.aL(t,i.u_sky_color),u_horizon_color:new e.aL(t,i.u_horizon_color),u_horizon:new e.aI(t,i.u_horizon),u_sky_horizon_blend:new e.aI(t,i.u_sky_horizon_blend)})};class qe{constructor(t,e,i){this.context=t;const r=t.gl;this.buffer=r.createBuffer(),this.dynamicDraw=Boolean(i),this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),r.bufferData(r.ELEMENT_ARRAY_BUFFER,e.arrayBuffer,this.dynamicDraw?r.DYNAMIC_DRAW:r.STATIC_DRAW),this.dynamicDraw||delete e.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const e=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),e.bufferSubData(e.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Ke={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class We{constructor(t,e,i,r){this.length=e.length,this.attributes=i,this.itemSize=e.bytesPerElement,this.dynamicDraw=r,this.context=t;const n=t.gl;this.buffer=n.createBuffer(),t.bindVertexBuffer.set(this.buffer),n.bufferData(n.ARRAY_BUFFER,e.arrayBuffer,this.dynamicDraw?n.DYNAMIC_DRAW:n.STATIC_DRAW),this.dynamicDraw||delete e.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){if(t.length!==this.length)throw new Error(`Length of new data is ${t.length}, which doesn't match current length of ${this.length}`);const e=this.context.gl;this.bind(),e.bufferSubData(e.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,e){for(let i=0;i<this.attributes.length;i++){const r=e.attributes[this.attributes[i].name];void 0!==r&&t.enableVertexAttribArray(r)}}setVertexAttribPointers(t,e,i){for(let r=0;r<this.attributes.length;r++){const n=this.attributes[r],o=e.attributes[n.name];void 0!==o&&t.vertexAttribPointer(o,n.components,t[Ke[n.type]],!1,this.itemSize,n.offset+this.itemSize*(i||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Xe=new WeakMap;function Je(t){var e;if(Xe.has(t))return Xe.get(t);{const i=null===(e=t.getParameter(t.VERSION))||void 0===e?void 0:e.startsWith("WebGL 2.0");return Xe.set(t,i),i}}class Ye{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class ti extends Ye{getDefault(){return e.aM.transparent}set(t){const e=this.current;(t.r!==e.r||t.g!==e.g||t.b!==e.b||t.a!==e.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class ei extends Ye{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class ii extends Ye{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class ri extends Ye{getDefault(){return[!0,!0,!0,!0]}set(t){const e=this.current;(t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||t[3]!==e[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class ni extends Ye{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class oi extends Ye{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class si extends Ye{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const e=this.current;(t.func!==e.func||t.ref!==e.ref||t.mask!==e.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class ai extends Ye{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const e=this.current;(t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class li extends Ye{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;t?e.enable(e.STENCIL_TEST):e.disable(e.STENCIL_TEST),this.current=t,this.dirty=!1}}class ci extends Ye{getDefault(){return[0,1]}set(t){const e=this.current;(t[0]!==e[0]||t[1]!==e[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class ui extends Ye{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;t?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),this.current=t,this.dirty=!1}}class hi extends Ye{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class di extends Ye{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;t?e.enable(e.BLEND):e.disable(e.BLEND),this.current=t,this.dirty=!1}}class pi extends Ye{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const e=this.current;(t[0]!==e[0]||t[1]!==e[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class fi extends Ye{getDefault(){return e.aM.transparent}set(t){const e=this.current;(t.r!==e.r||t.g!==e.g||t.b!==e.b||t.a!==e.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Ai extends Ye{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class mi extends Ye{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;t?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),this.current=t,this.dirty=!1}}class gi extends Ye{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class _i extends Ye{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class yi extends Ye{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class vi extends Ye{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class xi extends Ye{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const e=this.current;(t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||t[3]!==e[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class bi extends Ye{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.bindFramebuffer(e.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class wi extends Ye{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.bindRenderbuffer(e.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Ti extends Ye{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.bindTexture(e.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class Bi extends Ye{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.bindBuffer(e.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Ei extends Ye{getDefault(){return null}set(t){const e=this.gl;e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Ci extends Ye{getDefault(){return null}set(t){var e;if(t===this.current&&!this.dirty)return;const i=this.gl;Je(i)?i.bindVertexArray(t):null===(e=i.getExtension("OES_vertex_array_object"))||void 0===e||e.bindVertexArrayOES(t),this.current=t,this.dirty=!1}}class Si extends Ye{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.pixelStorei(e.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class Ii extends Ye{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class Mi extends Ye{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class ki extends Ye{constructor(t,e){super(t),this.context=t,this.parent=e}getDefault(){return null}}class Pi extends ki{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const e=this.gl;e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Li extends ki{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const e=this.gl;e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class zi extends ki{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const e=this.gl;e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Fi{constructor(t,e,i,r,n){this.context=t,this.width=e,this.height=i;const o=t.gl,s=this.framebuffer=o.createFramebuffer();if(this.colorAttachment=new Pi(t,s),r)this.depthAttachment=n?new zi(t,s):new Li(t,s);else if(n)throw new Error("Stencil cannot be set without depth");if(o.checkFramebufferStatus(o.FRAMEBUFFER)!==o.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const t=this.context.gl,e=this.colorAttachment.get();if(e&&t.deleteTexture(e),this.depthAttachment){const e=this.depthAttachment.get();e&&t.deleteRenderbuffer(e)}t.deleteFramebuffer(this.framebuffer)}}class Di{constructor(t,e,i){this.blendFunction=t,this.blendColor=e,this.mask=i}}Di.Replace=[1,0],Di.disabled=new Di(Di.Replace,e.aM.transparent,[!1,!1,!1,!1]),Di.unblended=new Di(Di.Replace,e.aM.transparent,[!0,!0,!0,!0]),Di.alphaBlended=new Di([1,771],e.aM.transparent,[!0,!0,!0,!0]);class Ri{constructor(t){var e,i;if(this.gl=t,this.clearColor=new ti(this),this.clearDepth=new ei(this),this.clearStencil=new ii(this),this.colorMask=new ri(this),this.depthMask=new ni(this),this.stencilMask=new oi(this),this.stencilFunc=new si(this),this.stencilOp=new ai(this),this.stencilTest=new li(this),this.depthRange=new ci(this),this.depthTest=new ui(this),this.depthFunc=new hi(this),this.blend=new di(this),this.blendFunc=new pi(this),this.blendColor=new fi(this),this.blendEquation=new Ai(this),this.cullFace=new mi(this),this.cullFaceSide=new gi(this),this.frontFace=new _i(this),this.program=new yi(this),this.activeTexture=new vi(this),this.viewport=new xi(this),this.bindFramebuffer=new bi(this),this.bindRenderbuffer=new wi(this),this.bindTexture=new Ti(this),this.bindVertexBuffer=new Bi(this),this.bindElementBuffer=new Ei(this),this.bindVertexArray=new Ci(this),this.pixelStoreUnpack=new Si(this),this.pixelStoreUnpackPremultiplyAlpha=new Ii(this),this.pixelStoreUnpackFlipY=new Mi(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),Je(t)){this.HALF_FLOAT=t.HALF_FLOAT;const r=t.getExtension("EXT_color_buffer_half_float");this.RGBA16F=null!==(e=t.RGBA16F)&&void 0!==e?e:null==r?void 0:r.RGBA16F_EXT,this.RGB16F=null!==(i=t.RGB16F)&&void 0!==i?i:null==r?void 0:r.RGB16F_EXT,t.getExtension("EXT_color_buffer_float")}else{t.getExtension("EXT_color_buffer_half_float"),t.getExtension("OES_texture_half_float_linear");const e=t.getExtension("OES_texture_half_float");this.HALF_FLOAT=null==e?void 0:e.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,e){return new qe(this,t,e)}createVertexBuffer(t,e,i){return new We(this,t,e,i)}createRenderbuffer(t,e,i){const r=this.gl,n=r.createRenderbuffer();return this.bindRenderbuffer.set(n),r.renderbufferStorage(r.RENDERBUFFER,t,e,i),this.bindRenderbuffer.set(null),n}createFramebuffer(t,e,i,r){return new Fi(this,t,e,i,r)}clear({color:t,depth:e,stencil:i}){const r=this.gl;let n=0;t&&(n|=r.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),void 0!==e&&(n|=r.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(e),this.depthMask.set(!0)),void 0!==i&&(n|=r.STENCIL_BUFFER_BIT,this.clearStencil.set(i),this.stencilMask.set(255)),r.clear(n)}setCullFace(t){!1===t.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){e.aE(t.blendFunction,Di.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}createVertexArray(){var t;return Je(this.gl)?this.gl.createVertexArray():null===(t=this.gl.getExtension("OES_vertex_array_object"))||void 0===t?void 0:t.createVertexArrayOES()}deleteVertexArray(t){var e;return Je(this.gl)?this.gl.deleteVertexArray(t):null===(e=this.gl.getExtension("OES_vertex_array_object"))||void 0===e?void 0:e.deleteVertexArrayOES(t)}unbindVAO(){this.bindVertexArray.set(null)}}class Ui{constructor(t,e,i){this.func=t,this.mask=e,this.range=i}}Ui.ReadOnly=!1,Ui.ReadWrite=!0,Ui.disabled=new Ui(519,Ui.ReadOnly,[0,1]);const Oi=7680;class Ni{constructor(t,e,i,r,n,o){this.test=t,this.ref=e,this.mask=i,this.fail=r,this.depthFail=n,this.pass=o}}Ni.disabled=new Ni({func:519,mask:0},0,0,Oi,Oi,Oi);class Qi{constructor(t,e,i){this.enable=t,this.mode=e,this.frontFace=i}}let Vi;function ji(t,i,r,n,o){const s=t.context,a=s.gl,l=t.useProgram("collisionBox"),c=[];let u=0,h=0;for(let p=0;p<n.length;p++){const f=n[p],A=i.getTile(f).getBucket(r);if(!A)continue;const m=o?A.textCollisionBox:A.iconCollisionBox,g=A.collisionCircleArray;if(g.length>0){const i=e.H();e.aQ(i,A.placementInvProjMatrix,t.transform.glCoordMatrix),e.aQ(i,i,A.placementViewportMatrix),c.push({circleArray:g,circleOffset:h,transform:f.posMatrix,invTransform:i,coord:f}),u+=g.length/4,h=u}m&&l.draw(s,a.LINES,Ui.disabled,Ni.disabled,t.colorModeForRenderPass(),Qi.disabled,{u_matrix:f.posMatrix,u_pixel_extrude_scale:[1/(d=t.transform).width,1/d.height]},t.style.map.terrain&&t.style.map.terrain.getTerrainData(f),r.id,m.layoutVertexBuffer,m.indexBuffer,m.segments,null,t.transform.zoom,null,null,m.collisionVertexBuffer)}var d;if(!o||!c.length)return;const p=t.useProgram("collisionCircle"),f=new e.aR;f.resize(4*u),f._trim();let A=0;for(const t of c)for(let e=0;e<t.circleArray.length/4;e++){const i=4*e,r=t.circleArray[i+0],n=t.circleArray[i+1],o=t.circleArray[i+2],s=t.circleArray[i+3];f.emplace(A++,r,n,o,s,0),f.emplace(A++,r,n,o,s,1),f.emplace(A++,r,n,o,s,2),f.emplace(A++,r,n,o,s,3)}(!Vi||Vi.length<2*u)&&(Vi=function(t){const i=2*t,r=new e.aT;r.resize(i),r._trim();for(let t=0;t<i;t++){const e=6*t;r.uint16[e+0]=4*t+0,r.uint16[e+1]=4*t+1,r.uint16[e+2]=4*t+2,r.uint16[e+3]=4*t+2,r.uint16[e+4]=4*t+3,r.uint16[e+5]=4*t+0}return r}(u));const m=s.createIndexBuffer(Vi,!0),g=s.createVertexBuffer(f,e.aS.members,!0);for(const i of c){const n=Se(i.transform,i.invTransform,t.transform);p.draw(s,a.TRIANGLES,Ui.disabled,Ni.disabled,t.colorModeForRenderPass(),Qi.disabled,n,t.style.map.terrain&&t.style.map.terrain.getTerrainData(i.coord),r.id,g,m,e.a0.simpleSegment(0,2*i.circleOffset,i.circleArray.length,i.circleArray.length/2),null,t.transform.zoom,null,null,null)}g.destroy(),m.destroy()}Qi.disabled=new Qi(!1,1029,2305),Qi.backCCW=new Qi(!0,1029,2305);const Hi=e.an(new Float32Array(16));function Gi(t,i,r,n,o,s){const{horizontalAlign:a,verticalAlign:l}=e.au(t);return new e.P((-(a-.5)*i/o+n[0])*s,(-(l-.5)*r/o+n[1])*s)}function $i(t,i,r,n,o,s){const a=i.tileAnchorPoint.add(new e.P(i.translation[0],i.translation[1]));if(i.pitchWithMap){let t=n.mult(s);r||(t=t.rotate(-o));const e=a.add(t);return yt(e.x,e.y,i.labelPlaneMatrix,i.getElevation).point}if(r){const e=St(i.tileAnchorPoint.x+1,i.tileAnchorPoint.y,i).point.sub(t),r=Math.atan(e.y/e.x)+(e.x<0?Math.PI:0);return t.add(n.rotate(r))}return t.add(n)}function Zi(t,i,r,n,o,s,a,l,c,u,h,d,p,f){const A=t.text.placedSymbolArray,m=t.text.dynamicLayoutVertexArray,g=t.icon.dynamicLayoutVertexArray,_={};m.clear();for(let g=0;g<A.length;g++){const y=A.get(g),v=y.hidden||!y.crossTileID||t.allowVerticalPlacement&&!y.placedOrientation?null:n[y.crossTileID];if(v){const n=new e.P(y.anchorX,y.anchorY),A={getElevation:f,width:o.width,height:o.height,labelPlaneMatrix:s,lineVertexArray:null,pitchWithMap:r,projection:h,projectionCache:null,tileAnchorPoint:n,translation:d,unwrappedTileID:p},g=r?yt(n.x,n.y,a,f):St(n.x,n.y,A),x=vt(o.cameraToCenterDistance,g.signedDistanceFromCamera);let b=e.ai(t.textSizeData,c,y)*x/e.ap;r&&(b*=t.tilePixelRatio/l);const{width:w,height:T,anchor:B,textOffset:E,textBoxScale:C}=v,S=Gi(B,w,T,E,C,b),I=h.getPitchedTextCorrection(o,n.add(new e.P(d[0],d[1])),p),M=$i(g.point,A,i,S,o.angle,I),k=t.allowVerticalPlacement&&y.placedOrientation===e.ah.vertical?Math.PI/2:0;for(let t=0;t<y.numGlyphs;t++)e.aj(m,M,k);u&&y.associatedIconIndex>=0&&(_[y.associatedIconIndex]={shiftedAnchor:M,angle:k})}else Lt(y.numGlyphs,m)}if(u){g.clear();const i=t.icon.placedSymbolArray;for(let t=0;t<i.length;t++){const r=i.get(t);if(r.hidden)Lt(r.numGlyphs,g);else{const i=_[t];if(i)for(let t=0;t<r.numGlyphs;t++)e.aj(g,i.shiftedAnchor,i.angle);else Lt(r.numGlyphs,g)}}t.icon.dynamicLayoutVertexBuffer.updateData(g)}t.text.dynamicLayoutVertexBuffer.updateData(m)}function qi(t,e,i){return i.iconsInText&&e?"symbolTextAndIcon":t?"symbolSDF":"symbolIcon"}function Ki(t,i,r,n,o,s,a,l,c,u,h,d){const p=t.context,f=p.gl,A=t.transform,m=ie(),g="map"===l,_="map"===c,y="viewport"!==l&&"point"!==r.layout.get("symbol-placement"),v=g&&!_&&!y,x=!_&&y,b=!r.layout.get("symbol-sort-key").isConstant();let w=!1;const T=t.depthModeForSublayer(0,Ui.ReadOnly),B=r._unevaluatedLayout.hasValue("text-variable-anchor")||r._unevaluatedLayout.hasValue("text-variable-anchor-offset"),E=[],C=m.getCircleRadiusCorrection(A);for(const l of n){const n=i.getTile(l),c=n.getBucket(r);if(!c)continue;const h=o?c.text:c.icon;if(!h||!h.segments.get().length||!h.hasVisibleVertices)continue;const d=h.programConfigurations.get(r.id),p=o||c.sdfIcons,T=o?c.textSizeData:c.iconSizeData,S=_||0!==A.pitch,I=t.useProgram(qi(p,o,c),d),M=e.ag(T,A.zoom),k=t.style.map.terrain&&t.style.map.terrain.getTerrainData(l);let P,L,z,F,D=[0,0],R=null;if(o)L=n.glyphAtlasTexture,z=f.LINEAR,P=n.glyphAtlasTexture.size,c.iconsInText&&(D=n.imageAtlasTexture.size,R=n.imageAtlasTexture,F=S||t.options.rotating||t.options.zooming||"composite"===T.kind||"camera"===T.kind?f.LINEAR:f.NEAREST);else{const e=1!==r.layout.get("icon-size").constantOr(0)||c.iconsNeedLinear;L=n.imageAtlasTexture,z=p||t.options.rotating||t.options.zooming||e||S?f.LINEAR:f.NEAREST,P=n.imageAtlasTexture.size}const U=Rt(n,1,t.transform.zoom),O=x?l.posMatrix:Hi,N=gt(O,_,g,t.transform,U),Q=_t(O,_,g,t.transform,U),V=_t(l.posMatrix,_,g,t.transform,U),j=m.translatePosition(t.transform,n,s,a),H=B&&c.hasTextData(),G="none"!==r.layout.get("icon-text-fit")&&H&&c.hasIconData();if(y){const e=t.style.map.terrain?(e,i)=>t.style.map.terrain.getElevation(l,e,i):null,i="map"===r.layout.get("text-rotation-alignment");bt(c,l.posMatrix,t,o,N,V,_,u,i,m,l.toUnwrapped(),A.width,A.height,j,e)}const $=l.posMatrix,Z=o&&B||G,q=y||Z?Hi:N,K=Q,W=p&&0!==r.paint.get(o?"text-halo-width":"icon-halo-width").constantOr(1);let X;X=p?c.iconsInText?He(T.kind,M,v,_,y,Z,t,$,q,K,j,P,D,C):je(T.kind,M,v,_,y,Z,t,$,q,K,j,o,P,!0,C):Ve(T.kind,M,v,_,y,Z,t,$,q,K,j,o,P,C);const J={program:I,buffers:h,uniformValues:X,atlasTexture:L,atlasTextureIcon:R,atlasInterpolation:z,atlasInterpolationIcon:F,isSDF:p,hasHalo:W};if(b&&c.canOverlap){w=!0;const t=h.segments.get();for(const i of t)E.push({segments:new e.a0([i]),sortKey:i.sortKey,state:J,terrainData:k})}else E.push({segments:h.segments,sortKey:0,state:J,terrainData:k})}w&&E.sort(((t,e)=>t.sortKey-e.sortKey));for(const e of E){const i=e.state;if(p.activeTexture.set(f.TEXTURE0),i.atlasTexture.bind(i.atlasInterpolation,f.CLAMP_TO_EDGE),i.atlasTextureIcon&&(p.activeTexture.set(f.TEXTURE1),i.atlasTextureIcon&&i.atlasTextureIcon.bind(i.atlasInterpolationIcon,f.CLAMP_TO_EDGE)),i.isSDF){const n=i.uniformValues;i.hasHalo&&(n.u_is_halo=1,Wi(i.buffers,e.segments,r,t,i.program,T,h,d,n,e.terrainData)),n.u_is_halo=0}Wi(i.buffers,e.segments,r,t,i.program,T,h,d,i.uniformValues,e.terrainData)}}function Wi(t,e,i,r,n,o,s,a,l,c){const u=r.context;n.draw(u,u.gl.TRIANGLES,o,s,a,Qi.disabled,l,c,i.id,t.layoutVertexBuffer,t.indexBuffer,e,i.paint,r.transform.zoom,t.programConfigurations.get(i.id),t.dynamicLayoutVertexBuffer,t.opacityVertexBuffer)}function Xi(t,i,r,n){const o=t.context,s=o.gl,a=Ni.disabled,l=new Di([s.ONE,s.ONE],e.aM.transparent,[!0,!0,!0,!0]),c=i.getBucket(r);if(!c)return;const u=n.key;let h=r.heatmapFbos.get(u);h||(h=Yi(o,i.tileSize,i.tileSize),r.heatmapFbos.set(u,h)),o.bindFramebuffer.set(h.framebuffer),o.viewport.set([0,0,i.tileSize,i.tileSize]),o.clear({color:e.aM.transparent});const d=c.programConfigurations.get(r.id),p=t.useProgram("heatmap",d),f=t.style.map.terrain.getTerrainData(n);p.draw(o,s.TRIANGLES,Ui.disabled,a,l,Qi.disabled,ke(n.posMatrix,i,t.transform.zoom,r.paint.get("heatmap-intensity")),f,r.id,c.layoutVertexBuffer,c.indexBuffer,c.segments,r.paint,t.transform.zoom,d)}function Ji(t,e,i){const r=t.context,n=r.gl;r.setColorMode(t.colorModeForRenderPass());const o=tr(r,e),s=i.key,a=e.heatmapFbos.get(s);a&&(r.activeTexture.set(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,a.colorAttachment.get()),r.activeTexture.set(n.TEXTURE1),o.bind(n.LINEAR,n.CLAMP_TO_EDGE),t.useProgram("heatmapTexture").draw(r,n.TRIANGLES,Ui.disabled,Ni.disabled,t.colorModeForRenderPass(),Qi.disabled,Pe(t,e,0,1),null,e.id,t.rasterBoundsBuffer,t.quadTriangleIndexBuffer,t.rasterBoundsSegments,e.paint,t.transform.zoom),a.destroy(),e.heatmapFbos.delete(s))}function Yi(t,e,i){var r,n;const o=t.gl,s=o.createTexture();o.bindTexture(o.TEXTURE_2D,s),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,o.LINEAR);const a=null!==(r=t.HALF_FLOAT)&&void 0!==r?r:o.UNSIGNED_BYTE,l=null!==(n=t.RGBA16F)&&void 0!==n?n:o.RGBA;o.texImage2D(o.TEXTURE_2D,0,l,e,i,0,o.RGBA,a,null);const c=t.createFramebuffer(e,i,!1,!1);return c.colorAttachment.set(s),c}function tr(t,e){return e.colorRampTexture||(e.colorRampTexture=new x(t,e.colorRamp,t.gl.RGBA)),e.colorRampTexture}function er(t,e,i,r,n){if(!i||!r||!r.imageAtlas)return;const o=r.imageAtlas.patternPositions;let s=o[i.to.toString()],a=o[i.from.toString()];if(!s&&a&&(s=a),!a&&s&&(a=s),!s||!a){const t=n.getPaintProperty(e);s=o[t],a=o[t]}s&&a&&t.setConstantPatternPositions(s,a)}function ir(t,e,i,r,n,o,s){const a=t.context.gl,l="fill-pattern",c=i.paint.get(l),u=c&&c.constantOr(1),h=i.getCrossfadeParameters();let d,p,f,A,m;s?(p=u&&!i.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",d=a.LINES):(p=u?"fillPattern":"fill",d=a.TRIANGLES);const g=c.constantOr(null);for(const c of r){const r=e.getTile(c);if(u&&!r.patternsLoaded())continue;const _=r.getBucket(i);if(!_)continue;const y=_.programConfigurations.get(i.id),v=t.useProgram(p,y),x=t.style.map.terrain&&t.style.map.terrain.getTerrainData(c);u&&(t.context.activeTexture.set(a.TEXTURE0),r.imageAtlasTexture.bind(a.LINEAR,a.CLAMP_TO_EDGE),y.updatePaintBuffers(h)),er(y,l,g,r,i);const b=x?c:null,w=t.translatePosMatrix(b?b.posMatrix:c.posMatrix,r,i.paint.get("fill-translate"),i.paint.get("fill-translate-anchor"));if(s){A=_.indexBuffer2,m=_.segments2;const e=[a.drawingBufferWidth,a.drawingBufferHeight];f="fillOutlinePattern"===p&&u?Ee(w,t,h,r,e):Be(w,e)}else A=_.indexBuffer,m=_.segments,f=u?Te(w,t,h,r):we(w);v.draw(t.context,d,n,t.stencilModeForClipping(c),o,Qi.disabled,f,x,i.id,_.layoutVertexBuffer,A,m,i.paint,t.transform.zoom,y)}}function rr(t,e,i,r,n,o,s){const a=t.context,l=a.gl,c="fill-extrusion-pattern",u=i.paint.get(c),h=u.constantOr(1),d=i.getCrossfadeParameters(),p=i.paint.get("fill-extrusion-opacity"),f=u.constantOr(null);for(const u of r){const r=e.getTile(u),A=r.getBucket(i);if(!A)continue;const m=t.style.map.terrain&&t.style.map.terrain.getTerrainData(u),g=A.programConfigurations.get(i.id),_=t.useProgram(h?"fillExtrusionPattern":"fillExtrusion",g);h&&(t.context.activeTexture.set(l.TEXTURE0),r.imageAtlasTexture.bind(l.LINEAR,l.CLAMP_TO_EDGE),g.updatePaintBuffers(d)),er(g,c,f,r,i);const y=t.translatePosMatrix(u.posMatrix,r,i.paint.get("fill-extrusion-translate"),i.paint.get("fill-extrusion-translate-anchor")),v=i.paint.get("fill-extrusion-vertical-gradient"),x=h?be(y,t,v,p,u,d,r):xe(y,t,v,p);_.draw(a,a.gl.TRIANGLES,n,o,s,Qi.backCCW,x,m,i.id,A.layoutVertexBuffer,A.indexBuffer,A.segments,i.paint,t.transform.zoom,g,t.style.map.terrain&&A.centroidVertexBuffer)}}function nr(t,e,i,r,n,o,s){const a=t.context,l=a.gl,c=i.fbo;if(!c)return;const u=t.useProgram("hillshade"),h=t.style.map.terrain&&t.style.map.terrain.getTerrainData(e);a.activeTexture.set(l.TEXTURE0),l.bindTexture(l.TEXTURE_2D,c.colorAttachment.get()),u.draw(a,l.TRIANGLES,n,o,s,Qi.disabled,((t,e,i,r)=>{const n=i.paint.get("hillshade-shadow-color"),o=i.paint.get("hillshade-highlight-color"),s=i.paint.get("hillshade-accent-color");let a=i.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===i.paint.get("hillshade-illumination-anchor")&&(a-=t.transform.angle);const l=!t.options.moving;return{u_matrix:r?r.posMatrix:t.transform.calculatePosMatrix(e.tileID.toUnwrapped(),l),u_image:0,u_latrange:Le(0,e.tileID),u_light:[i.paint.get("hillshade-exaggeration"),a],u_shadow:n,u_highlight:o,u_accent:s}})(t,i,r,h?e:null),h,r.id,t.rasterBoundsBuffer,t.quadTriangleIndexBuffer,t.rasterBoundsSegments)}function or(t,i,r,n,o,s){const a=t.context,l=a.gl,c=i.dem;if(c&&c.data){const u=c.dim,h=c.stride,d=c.getPixels();if(a.activeTexture.set(l.TEXTURE1),a.pixelStoreUnpackPremultiplyAlpha.set(!1),i.demTexture=i.demTexture||t.getTileTexture(h),i.demTexture){const t=i.demTexture;t.update(d,{premultiply:!1}),t.bind(l.NEAREST,l.CLAMP_TO_EDGE)}else i.demTexture=new x(a,d,l.RGBA,{premultiply:!1}),i.demTexture.bind(l.NEAREST,l.CLAMP_TO_EDGE);a.activeTexture.set(l.TEXTURE0);let p=i.fbo;if(!p){const t=new x(a,{width:u,height:u,data:null},l.RGBA);t.bind(l.LINEAR,l.CLAMP_TO_EDGE),p=i.fbo=a.createFramebuffer(u,u,!0,!1),p.colorAttachment.set(t.texture)}a.bindFramebuffer.set(p.framebuffer),a.viewport.set([0,0,u,u]),t.useProgram("hillshadePrepare").draw(a,l.TRIANGLES,n,o,s,Qi.disabled,((t,i)=>{const r=i.stride,n=e.H();return e.aP(n,0,e.X,-e.X,0,0,1),e.J(n,n,[0,-e.X,0]),{u_matrix:n,u_image:1,u_dimension:[r,r],u_zoom:t.overscaledZ,u_unpack:i.getUnpackVector()}})(i.tileID,c),null,r.id,t.rasterBoundsBuffer,t.quadTriangleIndexBuffer,t.rasterBoundsSegments),i.needsHillshadePrepare=!1}}function sr(t,i,r,n,s,a){const l=n.paint.get("raster-fade-duration");if(!a&&l>0){const n=o.now(),a=(n-t.timeAdded)/l,c=i?(n-i.timeAdded)/l:-1,u=r.getSource(),h=s.coveringZoomLevel({tileSize:u.tileSize,roundZoom:u.roundZoom}),d=!i||Math.abs(i.tileID.overscaledZ-h)>Math.abs(t.tileID.overscaledZ-h),p=d&&t.refreshedUponExpiration?1:e.ac(d?a:1-c,0,1);return t.refreshedUponExpiration&&a>=1&&(t.refreshedUponExpiration=!1),i?{opacity:1,mix:1-p}:{opacity:p,mix:0}}return{opacity:1,mix:0}}const ar=new e.aM(1,0,0,1),lr=new e.aM(0,1,0,1),cr=new e.aM(0,0,1,1),ur=new e.aM(1,0,1,1),hr=new e.aM(0,1,1,1);function dr(t,e,i,r){fr(t,0,e+i/2,t.transform.width,i,r)}function pr(t,e,i,r){fr(t,e-i/2,0,i,t.transform.height,r)}function fr(t,e,i,r,n,o){const s=t.context,a=s.gl;a.enable(a.SCISSOR_TEST),a.scissor(e*t.pixelRatio,i*t.pixelRatio,r*t.pixelRatio,n*t.pixelRatio),s.clear({color:o}),a.disable(a.SCISSOR_TEST)}function Ar(t,i,r){const n=t.context,o=n.gl,s=r.posMatrix,a=t.useProgram("debug"),l=Ui.disabled,c=Ni.disabled,u=t.colorModeForRenderPass(),h="$debug",d=t.style.map.terrain&&t.style.map.terrain.getTerrainData(r);n.activeTexture.set(o.TEXTURE0);const p=i.getTileByID(r.key).latestRawTileData,f=Math.floor((p&&p.byteLength||0)/1024),A=i.getTile(r).tileSize,m=512/Math.min(A,512)*(r.overscaledZ/t.transform.zoom)*.5;let g=r.canonical.toString();r.overscaledZ!==r.canonical.z&&(g+=` => ${r.overscaledZ}`),function(t,e){t.initDebugOverlayCanvas();const i=t.debugOverlayCanvas,r=t.context.gl,n=t.debugOverlayCanvas.getContext("2d");n.clearRect(0,0,i.width,i.height),n.shadowColor="white",n.shadowBlur=2,n.lineWidth=1.5,n.strokeStyle="white",n.textBaseline="top",n.font="bold 36px Open Sans, sans-serif",n.fillText(e,5,5),n.strokeText(e,5,5),t.debugOverlayTexture.update(i),t.debugOverlayTexture.bind(r.LINEAR,r.CLAMP_TO_EDGE)}(t,`${g} ${f}kB`),a.draw(n,o.TRIANGLES,l,c,Di.alphaBlended,Qi.disabled,Ie(s,e.aM.transparent,m),null,h,t.debugBuffer,t.quadTriangleIndexBuffer,t.debugSegments),a.draw(n,o.LINE_STRIP,l,c,u,Qi.disabled,Ie(s,e.aM.red),d,h,t.debugBuffer,t.tileBorderIndexBuffer,t.debugSegments)}function mr(t,e,i){const r=t.context,n=r.gl,o=t.colorModeForRenderPass(),s=new Ui(n.LEQUAL,Ui.ReadWrite,t.depthRangeFor3D),a=t.useProgram("terrain"),l=e.getTerrainMesh();r.bindFramebuffer.set(null),r.viewport.set([0,0,t.width,t.height]);for(const c of i){const i=t.renderToTexture.getTexture(c),u=e.getTerrainData(c.tileID);r.activeTexture.set(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,i.texture);const h=t.transform.calculatePosMatrix(c.tileID.toUnwrapped()),d=e.getMeshFrameDelta(t.transform.zoom),p=t.transform.calculateFogMatrix(c.tileID.toUnwrapped()),f=ge(h,d,p,t.style.sky,t.transform.pitch);a.draw(r,n.TRIANGLES,s,Ni.disabled,o,Qi.backCCW,f,u,"terrain",l.vertexBuffer,l.indexBuffer,l.segments)}}class gr{constructor(t,e,i){this.vertexBuffer=t,this.indexBuffer=e,this.segments=i}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}class _r{constructor(t,i){this.context=new Ri(t),this.transform=i,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:e.an(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=ht.maxUnderzooming+ht.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new ce}resize(t,e,i){if(this.width=Math.floor(t*i),this.height=Math.floor(e*i),this.pixelRatio=i,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const t of this.style._order)this.style._layers[t].resize()}setup(){const t=this.context,i=new e.aX;i.emplaceBack(0,0),i.emplaceBack(e.X,0),i.emplaceBack(0,e.X),i.emplaceBack(e.X,e.X),this.tileExtentBuffer=t.createVertexBuffer(i,pe.members),this.tileExtentSegments=e.a0.simpleSegment(0,0,4,2);const r=new e.aX;r.emplaceBack(0,0),r.emplaceBack(e.X,0),r.emplaceBack(0,e.X),r.emplaceBack(e.X,e.X),this.debugBuffer=t.createVertexBuffer(r,pe.members),this.debugSegments=e.a0.simpleSegment(0,0,4,5);const n=new e.$;n.emplaceBack(0,0,0,0),n.emplaceBack(e.X,0,e.X,0),n.emplaceBack(0,e.X,0,e.X),n.emplaceBack(e.X,e.X,e.X,e.X),this.rasterBoundsBuffer=t.createVertexBuffer(n,J.members),this.rasterBoundsSegments=e.a0.simpleSegment(0,0,4,2);const o=new e.aX;o.emplaceBack(0,0),o.emplaceBack(1,0),o.emplaceBack(0,1),o.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(o,pe.members),this.viewportSegments=e.a0.simpleSegment(0,0,4,2);const s=new e.aZ;s.emplaceBack(0),s.emplaceBack(1),s.emplaceBack(3),s.emplaceBack(2),s.emplaceBack(0),this.tileBorderIndexBuffer=t.createIndexBuffer(s);const a=new e.aY;a.emplaceBack(0,1,2),a.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(a);const l=this.context.gl;this.stencilClearMode=new Ni({func:l.ALWAYS,mask:0},0,255,l.ZERO,l.ZERO,l.ZERO)}clearStencil(){const t=this.context,i=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const r=e.H();e.aP(r,0,this.width,this.height,0,0,1),e.K(r,r,[i.drawingBufferWidth,i.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(t,i.TRIANGLES,Ui.disabled,this.stencilClearMode,Di.disabled,Qi.disabled,Me(r),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(t,e){if(this.currentStencilSource===t.source||!t.isTileClipped()||!e||!e.length)return;this.currentStencilSource=t.source;const i=this.context,r=i.gl;this.nextStencilID+e.length>256&&this.clearStencil(),i.setColorMode(Di.disabled),i.setDepthMode(Ui.disabled);const n=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const t of e){const e=this._tileClippingMaskIDs[t.key]=this.nextStencilID++,o=this.style.map.terrain&&this.style.map.terrain.getTerrainData(t);n.draw(i,r.TRIANGLES,Ui.disabled,new Ni({func:r.ALWAYS,mask:0},e,255,r.KEEP,r.KEEP,r.REPLACE),Di.disabled,Qi.disabled,Me(t.posMatrix),o,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,e=this.context.gl;return new Ni({func:e.NOTEQUAL,mask:255},t,255,e.KEEP,e.KEEP,e.REPLACE)}stencilModeForClipping(t){const e=this.context.gl;return new Ni({func:e.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,e.KEEP,e.KEEP,e.REPLACE)}stencilConfigForOverlap(t){const e=this.context.gl,i=t.sort(((t,e)=>e.overscaledZ-t.overscaledZ)),r=i[i.length-1].overscaledZ,n=i[0].overscaledZ-r+1;if(n>1){this.currentStencilSource=void 0,this.nextStencilID+n>256&&this.clearStencil();const t={};for(let i=0;i<n;i++)t[i+r]=new Ni({func:e.GEQUAL,mask:255},i+this.nextStencilID,255,e.KEEP,e.KEEP,e.REPLACE);return this.nextStencilID+=n,[t,i]}return[{[r]:Ni.disabled},i]}colorModeForRenderPass(){const t=this.context.gl;if(this._showOverdrawInspector){const i=1/8;return new Di([t.CONSTANT_COLOR,t.ONE],new e.aM(i,i,i,0),[!0,!0,!0,!0])}return"opaque"===this.renderPass?Di.unblended:Di.alphaBlended}depthModeForSublayer(t,e,i){if(!this.opaquePassEnabledForLayer())return Ui.disabled;const r=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new Ui(i||this.context.gl.LEQUAL,e,[r,r])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,i){this.style=t,this.options=i,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(o.now()),this.imageManager.beginFrame();const r=this.style._order,n=this.style.sourceCaches,s={},a={},l={};for(const t in n){const e=n[t];e.used&&e.prepare(this.context),s[t]=e.getVisibleCoordinates(),a[t]=s[t].slice().reverse(),l[t]=e.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let t=0;t<r.length;t++)if(this.style._layers[r[t]].is3D()){this.opaquePassCutoff=t;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const t of r){const e=this.style._layers[t];if(!e.hasOffscreenPass()||e.isHidden(this.transform.zoom))continue;const i=a[e.source];("custom"===e.type||i.length)&&this.renderLayer(this,n[e.source],e,i)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:i.showOverdrawInspector?e.aM.black:e.aM.transparent,depth:1}),this.clearStencil(),this.style.sky&&function(t,i){const r=t.context,n=r.gl,o=((t,e,i)=>({u_sky_color:t.properties.get("sky-color"),u_horizon_color:t.properties.get("horizon-color"),u_horizon:(e.height/2+e.getHorizon())*i,u_sky_horizon_blend:t.properties.get("sky-horizon-blend")*e.height/2*i}))(i,t.style.map.transform,t.pixelRatio),s=new Ui(n.LEQUAL,Ui.ReadWrite,[0,1]),a=Ni.disabled,l=t.colorModeForRenderPass(),c=t.useProgram("sky");if(!i.mesh){const t=new e.aX;t.emplaceBack(-1,-1),t.emplaceBack(1,-1),t.emplaceBack(1,1),t.emplaceBack(-1,1);const n=new e.aY;n.emplaceBack(0,1,2),n.emplaceBack(0,2,3),i.mesh=new gr(r.createVertexBuffer(t,pe.members),r.createIndexBuffer(n),e.a0.simpleSegment(0,0,t.length,n.length))}c.draw(r,n.TRIANGLES,s,a,l,Qi.disabled,o,void 0,"sky",i.mesh.vertexBuffer,i.mesh.indexBuffer,i.mesh.segments)}(this,this.style.sky),this._showOverdrawInspector=i.showOverdrawInspector,this.depthRangeFor3D=[0,1-(t._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=r.length-1;this.currentLayer>=0;this.currentLayer--){const t=this.style._layers[r[this.currentLayer]],e=n[t.source],i=s[t.source];this._renderTileClippingMasks(t,i),this.renderLayer(this,e,t,i)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<r.length;this.currentLayer++){const t=this.style._layers[r[this.currentLayer]],e=n[t.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(t))continue;const i=("symbol"===t.type?l:a)[t.source];this._renderTileClippingMasks(t,s[t.source]),this.renderLayer(this,e,t,i)}if(this.options.showTileBoundaries){const t=function(t,e){let i=null;const r=Object.values(t._layers).flatMap((i=>i.source&&!i.isHidden(e)?[t.sourceCaches[i.source]]:[])),n=r.filter((t=>"vector"===t.getSource().type)),o=r.filter((t=>"vector"!==t.getSource().type)),s=t=>{(!i||i.getSource().maxzoom<t.getSource().maxzoom)&&(i=t)};return n.forEach((t=>s(t))),i||o.forEach((t=>s(t))),i}(this.style,this.transform.zoom);t&&function(t,e,i){for(let r=0;r<i.length;r++)Ar(t,e,i[r])}(this,t,t.getVisibleCoordinates())}this.options.showPadding&&function(t){const e=t.transform.padding;dr(t,t.transform.height-(e.top||0),3,ar),dr(t,e.bottom||0,3,lr),pr(t,e.left||0,3,cr),pr(t,t.transform.width-(e.right||0),3,ur);const i=t.transform.centerPoint;!function(t,e,i,r){fr(t,e-1,i-10,2,20,r),fr(t,e-10,i-1,20,2,r)}(t,i.x,t.transform.height-i.y,hr)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(t){if(!this.style||!this.style.map||!this.style.map.terrain)return;const i=this.terrainFacilitator.matrix,r=this.transform.modelViewProjectionMatrix;let n=this.terrainFacilitator.dirty;n||(n=t?!e.a_(i,r):!e.a$(i,r)),n||(n=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length>0),n&&(e.b0(i,r),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(t,i){const r=t.context,n=r.gl,o=Di.unblended,s=new Ui(n.LEQUAL,Ui.ReadWrite,[0,1]),a=i.getTerrainMesh(),l=i.sourceCache.getRenderableTiles(),c=t.useProgram("terrainDepth");r.bindFramebuffer.set(i.getFramebuffer("depth").framebuffer),r.viewport.set([0,0,t.width/devicePixelRatio,t.height/devicePixelRatio]),r.clear({color:e.aM.transparent,depth:1});for(const e of l){const l=i.getTerrainData(e.tileID),u={u_matrix:t.transform.calculatePosMatrix(e.tileID.toUnwrapped()),u_ele_delta:i.getMeshFrameDelta(t.transform.zoom)};c.draw(r,n.TRIANGLES,s,Ni.disabled,o,Qi.backCCW,u,l,"terrain",a.vertexBuffer,a.indexBuffer,a.segments)}r.bindFramebuffer.set(null),r.viewport.set([0,0,t.width,t.height])}(this,this.style.map.terrain),function(t,i){const r=t.context,n=r.gl,o=Di.unblended,s=new Ui(n.LEQUAL,Ui.ReadWrite,[0,1]),a=i.getTerrainMesh(),l=i.getCoordsTexture(),c=i.sourceCache.getRenderableTiles(),u=t.useProgram("terrainCoords");r.bindFramebuffer.set(i.getFramebuffer("coords").framebuffer),r.viewport.set([0,0,t.width/devicePixelRatio,t.height/devicePixelRatio]),r.clear({color:e.aM.transparent,depth:1}),i.coordsIndex=[];for(const e of c){const c=i.getTerrainData(e.tileID);r.activeTexture.set(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,l.texture);const h={u_matrix:t.transform.calculatePosMatrix(e.tileID.toUnwrapped()),u_terrain_coords_id:(255-i.coordsIndex.length)/255,u_texture:0,u_ele_delta:i.getMeshFrameDelta(t.transform.zoom)};u.draw(r,n.TRIANGLES,s,Ni.disabled,o,Qi.backCCW,h,c,"terrain",a.vertexBuffer,a.indexBuffer,a.segments),i.coordsIndex.push(e.tileID.key)}r.bindFramebuffer.set(null),r.viewport.set([0,0,t.width,t.height])}(this,this.style.map.terrain))}renderLayer(t,i,r,n){if(!r.isHidden(this.transform.zoom)&&("background"===r.type||"custom"===r.type||(n||[]).length))switch(this.id=r.id,r.type){case"symbol":!function(t,i,r,n,o){if("translucent"!==t.renderPass)return;const s=Ni.disabled,a=t.colorModeForRenderPass();(r._unevaluatedLayout.hasValue("text-variable-anchor")||r._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(t,i,r,n,o,s,a,l,c){const u=i.transform,h=ie(),d="map"===o,p="map"===s;for(const o of t){const t=n.getTile(o),s=t.getBucket(r);if(!s||!s.text||!s.text.segments.get().length)continue;const f=e.ag(s.textSizeData,u.zoom),A=Rt(t,1,i.transform.zoom),m=gt(o.posMatrix,p,d,i.transform,A),g="none"!==r.layout.get("icon-text-fit")&&s.hasIconData();if(f){const e=Math.pow(2,u.zoom-t.tileID.overscaledZ),r=i.style.map.terrain?(t,e)=>i.style.map.terrain.getElevation(o,t,e):null,n=h.translatePosition(u,t,a,l);Zi(s,d,p,c,u,m,o.posMatrix,e,f,g,h,n,o.toUnwrapped(),r)}}}(n,t,r,i,r.layout.get("text-rotation-alignment"),r.layout.get("text-pitch-alignment"),r.paint.get("text-translate"),r.paint.get("text-translate-anchor"),o),0!==r.paint.get("icon-opacity").constantOr(1)&&Ki(t,i,r,n,!1,r.paint.get("icon-translate"),r.paint.get("icon-translate-anchor"),r.layout.get("icon-rotation-alignment"),r.layout.get("icon-pitch-alignment"),r.layout.get("icon-keep-upright"),s,a),0!==r.paint.get("text-opacity").constantOr(1)&&Ki(t,i,r,n,!0,r.paint.get("text-translate"),r.paint.get("text-translate-anchor"),r.layout.get("text-rotation-alignment"),r.layout.get("text-pitch-alignment"),r.layout.get("text-keep-upright"),s,a),i.map.showCollisionBoxes&&(ji(t,i,r,n,!0),ji(t,i,r,n,!1))}(t,i,r,n,this.style.placement.variableOffsets);break;case"circle":!function(t,i,r,n){if("translucent"!==t.renderPass)return;const o=r.paint.get("circle-opacity"),s=r.paint.get("circle-stroke-width"),a=r.paint.get("circle-stroke-opacity"),l=!r.layout.get("circle-sort-key").isConstant();if(0===o.constantOr(1)&&(0===s.constantOr(1)||0===a.constantOr(1)))return;const c=t.context,u=c.gl,h=t.depthModeForSublayer(0,Ui.ReadOnly),d=Ni.disabled,p=t.colorModeForRenderPass(),f=[];for(let o=0;o<n.length;o++){const s=n[o],a=i.getTile(s),c=a.getBucket(r);if(!c)continue;const u=c.programConfigurations.get(r.id),h=t.useProgram("circle",u),d=c.layoutVertexBuffer,p=c.indexBuffer,A=t.style.map.terrain&&t.style.map.terrain.getTerrainData(s),m={programConfiguration:u,program:h,layoutVertexBuffer:d,indexBuffer:p,uniformValues:Ce(t,s,a,r),terrainData:A};if(l){const t=c.segments.get();for(const i of t)f.push({segments:new e.a0([i]),sortKey:i.sortKey,state:m})}else f.push({segments:c.segments,sortKey:0,state:m})}l&&f.sort(((t,e)=>t.sortKey-e.sortKey));for(const e of f){const{programConfiguration:i,program:n,layoutVertexBuffer:o,indexBuffer:s,uniformValues:a,terrainData:l}=e.state;n.draw(c,u.TRIANGLES,h,d,p,Qi.disabled,a,l,r.id,o,s,e.segments,r.paint,t.transform.zoom,i)}}(t,i,r,n);break;case"heatmap":!function(t,i,r,n){if(0===r.paint.get("heatmap-opacity"))return;const o=t.context;if(t.style.map.terrain){for(const e of n){const n=i.getTile(e);i.hasRenderableParent(e)||("offscreen"===t.renderPass?Xi(t,n,r,e):"translucent"===t.renderPass&&Ji(t,r,e))}o.viewport.set([0,0,t.width,t.height])}else"offscreen"===t.renderPass?function(t,i,r,n){const o=t.context,s=o.gl,a=Ni.disabled,l=new Di([s.ONE,s.ONE],e.aM.transparent,[!0,!0,!0,!0]);(function(t,i,r){const n=t.gl;t.activeTexture.set(n.TEXTURE1),t.viewport.set([0,0,i.width/4,i.height/4]);let o=r.heatmapFbos.get(e.aU);o?(n.bindTexture(n.TEXTURE_2D,o.colorAttachment.get()),t.bindFramebuffer.set(o.framebuffer)):(o=Yi(t,i.width/4,i.height/4),r.heatmapFbos.set(e.aU,o))})(o,t,r),o.clear({color:e.aM.transparent});for(let e=0;e<n.length;e++){const c=n[e];if(i.hasRenderableParent(c))continue;const u=i.getTile(c),h=u.getBucket(r);if(!h)continue;const d=h.programConfigurations.get(r.id),p=t.useProgram("heatmap",d),{zoom:f}=t.transform;p.draw(o,s.TRIANGLES,Ui.disabled,a,l,Qi.disabled,ke(c.posMatrix,u,f,r.paint.get("heatmap-intensity")),null,r.id,h.layoutVertexBuffer,h.indexBuffer,h.segments,r.paint,t.transform.zoom,d)}o.viewport.set([0,0,t.width,t.height])}(t,i,r,n):"translucent"===t.renderPass&&function(t,i){const r=t.context,n=r.gl;r.setColorMode(t.colorModeForRenderPass());const o=i.heatmapFbos.get(e.aU);o&&(r.activeTexture.set(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,o.colorAttachment.get()),r.activeTexture.set(n.TEXTURE1),tr(r,i).bind(n.LINEAR,n.CLAMP_TO_EDGE),t.useProgram("heatmapTexture").draw(r,n.TRIANGLES,Ui.disabled,Ni.disabled,t.colorModeForRenderPass(),Qi.disabled,Pe(t,i,0,1),null,i.id,t.viewportBuffer,t.quadTriangleIndexBuffer,t.viewportSegments,i.paint,t.transform.zoom))}(t,r)}(t,i,r,n);break;case"line":!function(t,i,r,n){if("translucent"!==t.renderPass)return;const o=r.paint.get("line-opacity"),s=r.paint.get("line-width");if(0===o.constantOr(1)||0===s.constantOr(1))return;const a=t.depthModeForSublayer(0,Ui.ReadOnly),l=t.colorModeForRenderPass(),c=r.paint.get("line-dasharray"),u=r.paint.get("line-pattern"),h=u.constantOr(1),d=r.paint.get("line-gradient"),p=r.getCrossfadeParameters(),f=h?"linePattern":c?"lineSDF":d?"lineGradient":"line",A=t.context,m=A.gl;let g=!0;for(const o of n){const n=i.getTile(o);if(h&&!n.patternsLoaded())continue;const s=n.getBucket(r);if(!s)continue;const _=s.programConfigurations.get(r.id),y=t.context.program.get(),v=t.useProgram(f,_),b=g||v.program!==y,w=t.style.map.terrain&&t.style.map.terrain.getTerrainData(o),T=u.constantOr(null);if(T&&n.imageAtlas){const t=n.imageAtlas,e=t.patternPositions[T.to.toString()],i=t.patternPositions[T.from.toString()];e&&i&&_.setConstantPatternPositions(e,i)}const B=w?o:null,E=h?De(t,n,r,p,B):c?Re(t,n,r,c,p,B):d?Fe(t,n,r,s.lineClipsArray.length,B):ze(t,n,r,B);if(h)A.activeTexture.set(m.TEXTURE0),n.imageAtlasTexture.bind(m.LINEAR,m.CLAMP_TO_EDGE),_.updatePaintBuffers(p);else if(c&&(b||t.lineAtlas.dirty))A.activeTexture.set(m.TEXTURE0),t.lineAtlas.bind(A);else if(d){const n=s.gradients[r.id];let a=n.texture;if(r.gradientVersion!==n.version){let l=256;if(r.stepInterpolant){const r=i.getSource().maxzoom,n=o.canonical.z===r?Math.ceil(1<<t.transform.maxZoom-o.canonical.z):1;l=e.ac(e.aV(s.maxLineLength/e.X*1024*n),256,A.maxTextureSize)}n.gradient=e.aW({expression:r.gradientExpression(),evaluationKey:"lineProgress",resolution:l,image:n.gradient||void 0,clips:s.lineClipsArray}),n.texture?n.texture.update(n.gradient):n.texture=new x(A,n.gradient,m.RGBA),n.version=r.gradientVersion,a=n.texture}A.activeTexture.set(m.TEXTURE0),a.bind(r.stepInterpolant?m.NEAREST:m.LINEAR,m.CLAMP_TO_EDGE)}v.draw(A,m.TRIANGLES,a,t.stencilModeForClipping(o),l,Qi.disabled,E,w,r.id,s.layoutVertexBuffer,s.indexBuffer,s.segments,r.paint,t.transform.zoom,_,s.layoutVertexBuffer2),g=!1}}(t,i,r,n);break;case"fill":!function(t,i,r,n){const o=r.paint.get("fill-color"),s=r.paint.get("fill-opacity");if(0===s.constantOr(1))return;const a=t.colorModeForRenderPass(),l=r.paint.get("fill-pattern"),c=t.opaquePassEnabledForLayer()&&!l.constantOr(1)&&1===o.constantOr(e.aM.transparent).a&&1===s.constantOr(0)?"opaque":"translucent";if(t.renderPass===c){const e=t.depthModeForSublayer(1,"opaque"===t.renderPass?Ui.ReadWrite:Ui.ReadOnly);ir(t,i,r,n,e,a,!1)}if("translucent"===t.renderPass&&r.paint.get("fill-antialias")){const e=t.depthModeForSublayer(r.getPaintProperty("fill-outline-color")?2:0,Ui.ReadOnly);ir(t,i,r,n,e,a,!0)}}(t,i,r,n);break;case"fill-extrusion":!function(t,e,i,r){const n=i.paint.get("fill-extrusion-opacity");if(0!==n&&"translucent"===t.renderPass){const o=new Ui(t.context.gl.LEQUAL,Ui.ReadWrite,t.depthRangeFor3D);if(1!==n||i.paint.get("fill-extrusion-pattern").constantOr(1))rr(t,e,i,r,o,Ni.disabled,Di.disabled),rr(t,e,i,r,o,t.stencilModeFor3D(),t.colorModeForRenderPass());else{const n=t.colorModeForRenderPass();rr(t,e,i,r,o,Ni.disabled,n)}}}(t,i,r,n);break;case"hillshade":!function(t,e,i,r){if("offscreen"!==t.renderPass&&"translucent"!==t.renderPass)return;const n=t.context,o=t.depthModeForSublayer(0,Ui.ReadOnly),s=t.colorModeForRenderPass(),[a,l]="translucent"===t.renderPass?t.stencilConfigForOverlap(r):[{},r];for(const r of l){const n=e.getTile(r);void 0!==n.needsHillshadePrepare&&n.needsHillshadePrepare&&"offscreen"===t.renderPass?or(t,n,i,o,Ni.disabled,s):"translucent"===t.renderPass&&nr(t,r,n,i,o,a[r.overscaledZ],s)}n.viewport.set([0,0,t.width,t.height])}(t,i,r,n);break;case"raster":!function(t,e,i,r){if("translucent"!==t.renderPass)return;if(0===i.paint.get("raster-opacity"))return;if(!r.length)return;const n=t.context,o=n.gl,s=e.getSource(),a=t.useProgram("raster"),l=t.colorModeForRenderPass(),[c,u]=s instanceof Y?[{},r]:t.stencilConfigForOverlap(r),h=u[u.length-1].overscaledZ,d=!t.options.moving;for(const r of u){const u=t.depthModeForSublayer(r.overscaledZ-h,1===i.paint.get("raster-opacity")?Ui.ReadWrite:Ui.ReadOnly,o.LESS),p=e.getTile(r);p.registerFadeDuration(i.paint.get("raster-fade-duration"));const f=e.findLoadedParent(r,0),A=e.findLoadedSibling(r),m=sr(p,f||A||null,e,i,t.transform,t.style.map.terrain);let g,_;const y="nearest"===i.paint.get("raster-resampling")?o.NEAREST:o.LINEAR;n.activeTexture.set(o.TEXTURE0),p.texture.bind(y,o.CLAMP_TO_EDGE,o.LINEAR_MIPMAP_NEAREST),n.activeTexture.set(o.TEXTURE1),f?(f.texture.bind(y,o.CLAMP_TO_EDGE,o.LINEAR_MIPMAP_NEAREST),g=Math.pow(2,f.tileID.overscaledZ-p.tileID.overscaledZ),_=[p.tileID.canonical.x*g%1,p.tileID.canonical.y*g%1]):p.texture.bind(y,o.CLAMP_TO_EDGE,o.LINEAR_MIPMAP_NEAREST),p.texture.useMipmap&&n.extTextureFilterAnisotropic&&t.transform.pitch>20&&o.texParameterf(o.TEXTURE_2D,n.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,n.extTextureFilterAnisotropicMax);const v=t.style.map.terrain&&t.style.map.terrain.getTerrainData(r),x=v?r:null,b=x?x.posMatrix:t.transform.calculatePosMatrix(r.toUnwrapped(),d),w=Ne(b,_||[0,0],g||1,m,i);s instanceof Y?a.draw(n,o.TRIANGLES,u,Ni.disabled,l,Qi.disabled,w,v,i.id,s.boundsBuffer,t.quadTriangleIndexBuffer,s.boundsSegments):a.draw(n,o.TRIANGLES,u,c[r.overscaledZ],l,Qi.disabled,w,v,i.id,t.rasterBoundsBuffer,t.quadTriangleIndexBuffer,t.rasterBoundsSegments)}}(t,i,r,n);break;case"background":!function(t,e,i,r){const n=i.paint.get("background-color"),o=i.paint.get("background-opacity");if(0===o)return;const s=t.context,a=s.gl,l=t.transform,c=l.tileSize,u=i.paint.get("background-pattern");if(t.isPatternMissing(u))return;const h=!u&&1===n.a&&1===o&&t.opaquePassEnabledForLayer()?"opaque":"translucent";if(t.renderPass!==h)return;const d=Ni.disabled,p=t.depthModeForSublayer(0,"opaque"===h?Ui.ReadWrite:Ui.ReadOnly),f=t.colorModeForRenderPass(),A=t.useProgram(u?"backgroundPattern":"background"),m=r||l.coveringTiles({tileSize:c,terrain:t.style.map.terrain});u&&(s.activeTexture.set(a.TEXTURE0),t.imageManager.bind(t.context));const g=i.getCrossfadeParameters();for(const e of m){const l=r?e.posMatrix:t.transform.calculatePosMatrix(e.toUnwrapped()),h=u?$e(l,o,t,u,{tileID:e,tileSize:c},g):Ge(l,o,n),m=t.style.map.terrain&&t.style.map.terrain.getTerrainData(e);A.draw(s,a.TRIANGLES,p,d,f,Qi.disabled,h,m,i.id,t.tileExtentBuffer,t.quadTriangleIndexBuffer,t.tileExtentSegments)}}(t,0,r,n);break;case"custom":!function(t,e,i){const r=t.context,n=i.implementation;if("offscreen"===t.renderPass){const e=n.prerender;e&&(t.setCustomLayerDefaults(),r.setColorMode(t.colorModeForRenderPass()),e.call(n,r.gl,t.transform.customLayerMatrix()),r.setDirty(),t.setBaseState())}else if("translucent"===t.renderPass){t.setCustomLayerDefaults(),r.setColorMode(t.colorModeForRenderPass()),r.setStencilMode(Ni.disabled);const e="3d"===n.renderingMode?new Ui(t.context.gl.LEQUAL,Ui.ReadWrite,t.depthRangeFor3D):t.depthModeForSublayer(0,Ui.ReadOnly);r.setDepthMode(e),n.render(r.gl,t.transform.customLayerMatrix(),{farZ:t.transform.farZ,nearZ:t.transform.nearZ,fov:t.transform._fov,modelViewProjectionMatrix:t.transform.modelViewProjectionMatrix,projectionMatrix:t.transform.projectionMatrix}),r.setDirty(),t.setBaseState(),r.bindFramebuffer.set(null)}}(t,0,r)}}translatePosMatrix(t,i,r,n,o){if(!r[0]&&!r[1])return t;const s=o?"map"===n?this.transform.angle:0:"viewport"===n?-this.transform.angle:0;if(s){const t=Math.sin(s),e=Math.cos(s);r=[r[0]*e-r[1]*t,r[0]*t+r[1]*e]}const a=[o?r[0]:Rt(i,r[0],this.transform.zoom),o?r[1]:Rt(i,r[1],this.transform.zoom),0],l=new Float32Array(16);return e.J(l,t,a),l}saveTileTexture(t){const e=this._tileTextures[t.size[0]];e?e.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const e=this._tileTextures[t];return e&&e.length>0?e.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;const e=this.imageManager.getPattern(t.from.toString()),i=this.imageManager.getPattern(t.to.toString());return!e||!i}useProgram(t,e){this.cache=this.cache||{};const i=t+(e?e.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[i]||(this.cache[i]=new ye(this.context,fe[t],e,Ze[t],this._showOverdrawInspector,this.style.map.terrain)),this.cache[i]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new x(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:t,drawingBufferHeight:e}=this.context.gl;return this.width!==t||this.height!==e}}class yr{constructor(t,e){this.points=t,this.planes=e}static fromInvProjectionMatrix(t,i,r){const n=Math.pow(2,r),o=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((r=>{const o=1/(r=e.af([],r,t))[3]/i*n;return e.b1(r,r,[o,o,1/r[3],o])})),s=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map((t=>{const e=function(t,e){var i=e[0],r=e[1],n=e[2],o=i*i+r*r+n*n;return o>0&&(o=1/Math.sqrt(o)),t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o,t}([],function(t,e,i){var r=e[0],n=e[1],o=e[2],s=i[0],a=i[1],l=i[2];return t[0]=n*l-o*a,t[1]=o*s-r*l,t[2]=r*a-n*s,t}([],g([],o[t[0]],o[t[1]]),g([],o[t[2]],o[t[1]]))),i=-((r=e)[0]*(n=o[t[1]])[0]+r[1]*n[1]+r[2]*n[2]);var r,n;return e.concat(i)}));return new yr(o,s)}}class vr{constructor(t,e){this.min=t,this.max=e,this.center=function(t,e,i){return t[0]=.5*e[0],t[1]=.5*e[1],t[2]=.5*e[2],t}([],function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t}([],this.min,this.max))}quadrant(t){const e=[t%2==0,t<2],i=A(this.min),r=A(this.max);for(let t=0;t<e.length;t++)i[t]=e[t]?this.min[t]:this.center[t],r[t]=e[t]?this.center[t]:this.max[t];return r[2]=this.max[2],new vr(i,r)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}intersects(t){const i=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let r=!0;for(let n=0;n<t.planes.length;n++){const o=t.planes[n];let s=0;for(let t=0;t<i.length;t++)e.b2(o,i[t])>=0&&s++;if(0===s)return 0;s!==i.length&&(r=!1)}if(r)return 2;for(let e=0;e<3;e++){let i=Number.MAX_VALUE,r=-Number.MAX_VALUE;for(let n=0;n<t.points.length;n++){const o=t.points[n][e]-this.min[e];i=Math.min(i,o),r=Math.max(r,o)}if(r<0||i>this.max[e]-this.min[e])return 0}return 1}}class xr{constructor(t=0,e=0,i=0,r=0){if(isNaN(t)||t<0||isNaN(e)||e<0||isNaN(i)||i<0||isNaN(r)||r<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=e,this.left=i,this.right=r}interpolate(t,i,r){return null!=i.top&&null!=t.top&&(this.top=e.y.number(t.top,i.top,r)),null!=i.bottom&&null!=t.bottom&&(this.bottom=e.y.number(t.bottom,i.bottom,r)),null!=i.left&&null!=t.left&&(this.left=e.y.number(t.left,i.left,r)),null!=i.right&&null!=t.right&&(this.right=e.y.number(t.right,i.right,r)),this}getCenter(t,i){const r=e.ac((this.left+t-this.right)/2,0,t),n=e.ac((this.top+i-this.bottom)/2,0,i);return new e.P(r,n)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new xr(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const br=85.051129;class wr{constructor(t,i,r,n,o){this.tileSize=512,this._renderWorldCopies=void 0===o||!!o,this._minZoom=t||0,this._maxZoom=i||22,this._minPitch=null==r?0:r,this._maxPitch=null==n?60:n,this.setMaxBounds(),this.width=0,this.height=0,this._center=new e.N(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new xr,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={},this.minElevationForCurrentTile=0}clone(){const t=new wr(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return t.apply(this),t}apply(t){this.tileSize=t.tileSize,this.latRange=t.latRange,this.lngRange=t.lngRange,this.width=t.width,this.height=t.height,this._center=t._center,this._elevation=t._elevation,this.minElevationForCurrentTile=t.minElevationForCurrentTile,this.zoom=t.zoom,this.angle=t.angle,this._fov=t._fov,this._pitch=t._pitch,this._unmodified=t._unmodified,this._edgeInsets=t._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(t){void 0===t?t=!0:null===t&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new e.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(t){const i=-e.b3(t,-180,180)*Math.PI/180;this.angle!==i&&(this._unmodified=!1,this.angle=i,this._calcMatrices(),this.rotationMatrix=function(){var t=new e.A(4);return e.A!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t}(),function(t,e,i){var r=e[0],n=e[1],o=e[2],s=e[3],a=Math.sin(i),l=Math.cos(i);t[0]=r*l+o*a,t[1]=n*l+s*a,t[2]=r*-a+o*l,t[3]=n*-a+s*l}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const i=e.ac(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==i&&(this._unmodified=!1,this._pitch=i,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=t/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(t){const e=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==e&&(this._unmodified=!1,this._zoom=e,this.tileZoom=Math.max(0,Math.floor(e)),this.scale=this.zoomScale(e),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(t){t!==this._elevation&&(this._elevation=t,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,e,i){this._unmodified=!1,this._edgeInsets.interpolate(t,e,i),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const e=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,e)}getVisibleUnwrappedCoordinates(t){const i=[new e.b4(0,t)];if(this._renderWorldCopies){const r=this.pointCoordinate(new e.P(0,0)),n=this.pointCoordinate(new e.P(this.width,0)),o=this.pointCoordinate(new e.P(this.width,this.height)),s=this.pointCoordinate(new e.P(0,this.height)),a=Math.floor(Math.min(r.x,n.x,o.x,s.x)),l=Math.floor(Math.max(r.x,n.x,o.x,s.x)),c=1;for(let r=a-c;r<=l+c;r++)0!==r&&i.push(new e.b4(r,t))}return i}coveringTiles(t){var i,r;let n=this.coveringZoomLevel(t);const o=n;if(void 0!==t.minzoom&&n<t.minzoom)return[];void 0!==t.maxzoom&&n>t.maxzoom&&(n=t.maxzoom);const s=this.pointCoordinate(this.getCameraPoint()),a=e.Z.fromLngLat(this.center),l=Math.pow(2,n),c=[l*s.x,l*s.y,0],u=[l*a.x,l*a.y,0],h=yr.fromInvProjectionMatrix(this.invModelViewProjectionMatrix,this.worldSize,n);let d=t.minzoom||0;!t.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(d=n);const p=t.terrain?2/Math.min(this.tileSize,t.tileSize)*this.tileSize:3,f=t=>({aabb:new vr([t*l,0,0],[(t+1)*l,l,0]),zoom:0,x:0,y:0,wrap:t,fullyVisible:!1}),A=[],m=[],g=n,y=t.reparseOverscaled?o:n;if(this._renderWorldCopies)for(let t=1;t<=3;t++)A.push(f(-t)),A.push(f(t));for(A.push(f(0));A.length>0;){const n=A.pop(),o=n.x,s=n.y;let a=n.fullyVisible;if(!a){const t=n.aabb.intersects(h);if(0===t)continue;a=2===t}const l=t.terrain?c:u,f=n.aabb.distanceX(l),v=n.aabb.distanceY(l),x=Math.max(Math.abs(f),Math.abs(v));if(n.zoom===g||x>p+(1<<g-n.zoom)-2&&n.zoom>=d){const t=g-n.zoom,i=c[0]-.5-(o<<t),r=c[1]-.5-(s<<t);m.push({tileID:new e.S(n.zoom===g?y:n.zoom,n.wrap,n.zoom,o,s),distanceSq:_([u[0]-.5-o,u[1]-.5-s]),tileDistanceToCamera:Math.sqrt(i*i+r*r)})}else for(let l=0;l<4;l++){const c=(o<<1)+l%2,u=(s<<1)+(l>>1),h=n.zoom+1;let d=n.aabb.quadrant(l);if(t.terrain){const o=new e.S(h,n.wrap,h,c,u),s=t.terrain.getMinMaxElevation(o),a=null!==(i=s.minElevation)&&void 0!==i?i:this.elevation,l=null!==(r=s.maxElevation)&&void 0!==r?r:this.elevation;d=new vr([d.min[0],d.min[1],a],[d.max[0],d.max[1],l])}A.push({aabb:d,zoom:h,x:c,y:u,wrap:n.wrap,fullyVisible:a})}}return m.sort(((t,e)=>t.distanceSq-e.distanceSq)).map((t=>t.tileID))}resize(t,e){this.width=t,this.height=e,this.pixelsToGLUnits=[2/t,-2/e],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){const i=e.ac(t.lat,-85.051129,br);return new e.P(e.O(t.lng)*this.worldSize,e.Q(i)*this.worldSize)}unproject(t){return new e.Z(t.x/this.worldSize,t.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(t){const i=this.elevation,r=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,n=this.pointLocation(this.centerPoint,t),o=t.getElevationForLngLatZoom(n,this.tileZoom);if(!(this.elevation-o))return;const s=r+i-o,a=Math.cos(this._pitch)*this.cameraToCenterDistance/s/e.b5(1,n.lat),l=this.scaleZoom(a/this.tileSize);this._elevation=o,this._center=n,this.zoom=l}setLocationAtPoint(t,i){const r=this.pointCoordinate(i),n=this.pointCoordinate(this.centerPoint),o=this.locationCoordinate(t),s=new e.Z(o.x-(r.x-n.x),o.y-(r.y-n.y));this.center=this.coordinateLocation(s),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(t,e){return e?this.coordinatePoint(this.locationCoordinate(t),e.getElevationForLngLatZoom(t,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(t))}pointLocation(t,e){return this.coordinateLocation(this.pointCoordinate(t,e))}locationCoordinate(t){return e.Z.fromLngLat(t)}coordinateLocation(t){return t&&t.toLngLat()}pointCoordinate(t,i){if(i){const e=i.pointCoordinate(t);if(null!=e)return e}const r=[t.x,t.y,0,1],n=[t.x,t.y,1,1];e.af(r,r,this.pixelMatrixInverse),e.af(n,n,this.pixelMatrixInverse);const o=r[3],s=n[3],a=r[1]/o,l=n[1]/s,c=r[2]/o,u=n[2]/s,h=c===u?0:(0-c)/(u-c);return new e.Z(e.y.number(r[0]/o,n[0]/s,h)/this.worldSize,e.y.number(a,l,h)/this.worldSize)}coordinatePoint(t,i=0,r=this.pixelMatrix){const n=[t.x*this.worldSize,t.y*this.worldSize,i,1];return e.af(n,n,r),new e.P(n[0]/n[3],n[1]/n[3])}getBounds(){const t=Math.max(0,this.height/2-this.getHorizon());return(new $).extend(this.pointLocation(new e.P(0,t))).extend(this.pointLocation(new e.P(this.width,t))).extend(this.pointLocation(new e.P(this.width,this.height))).extend(this.pointLocation(new e.P(0,this.height)))}getMaxBounds(){return this.latRange&&2===this.latRange.length&&this.lngRange&&2===this.lngRange.length?new $([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(t){t?(this.lngRange=[t.getWest(),t.getEast()],this.latRange=[t.getSouth(),t.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,br])}calculateTileMatrix(t){const i=t.canonical,r=this.worldSize/this.zoomScale(i.z),n=i.x+Math.pow(2,i.z)*t.wrap,o=e.an(new Float64Array(16));return e.J(o,o,[n*r,i.y*r,0]),e.K(o,o,[r/e.X,r/e.X,1]),o}calculatePosMatrix(t,i=!1){const r=t.key,n=i?this._alignedPosMatrixCache:this._posMatrixCache;if(n[r])return n[r];const o=this.calculateTileMatrix(t);return e.L(o,i?this.alignedModelViewProjectionMatrix:this.modelViewProjectionMatrix,o),n[r]=new Float32Array(o),n[r]}calculateFogMatrix(t){const i=t.key,r=this._fogMatrixCache;if(r[i])return r[i];const n=this.calculateTileMatrix(t);return e.L(n,this.fogMatrix,n),r[i]=new Float32Array(n),r[i]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(t,i){i=e.ac(+i,this.minZoom,this.maxZoom);const r={center:new e.N(t.lng,t.lat),zoom:i};let n=this.lngRange;if(!this._renderWorldCopies&&null===n){const t=180-1e-10;n=[-t,t]}const o=this.tileSize*this.zoomScale(r.zoom);let s=0,a=o,l=0,c=o,u=0,h=0;const{x:d,y:p}=this.size;if(this.latRange){const t=this.latRange;s=e.Q(t[1])*o,a=e.Q(t[0])*o,a-s<p&&(u=p/(a-s))}n&&(l=e.b3(e.O(n[0])*o,0,o),c=e.b3(e.O(n[1])*o,0,o),c<l&&(c+=o),c-l<d&&(h=d/(c-l)));const{x:f,y:A}=this.project.call({worldSize:o},t);let m,g;const _=Math.max(h||0,u||0);if(_){const t=new e.P(h?(c+l)/2:f,u?(a+s)/2:A);return r.center=this.unproject.call({worldSize:o},t).wrap(),r.zoom+=this.scaleZoom(_),r}if(this.latRange){const t=p/2;A-t<s&&(g=s+t),A+t>a&&(g=a-t)}if(n){const t=(l+c)/2;let i=f;this._renderWorldCopies&&(i=e.b3(f,t-o/2,t+o/2));const r=d/2;i-r<l&&(m=l+r),i+r>c&&(m=c-r)}if(void 0!==m||void 0!==g){const t=new e.P(null!=m?m:f,null!=g?g:A);r.center=this.unproject.call({worldSize:o},t).wrap()}return r}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const t=this._unmodified,{center:e,zoom:i}=this.getConstrained(this.center,this.zoom);this.center=e,this.zoom=i,this._unmodified=t,this._constraining=!1}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,i=this.point.x,r=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=e.b5(1,this.center.lat)*this.worldSize;let n=e.an(new Float64Array(16));e.K(n,n,[this.width/2,-this.height/2,1]),e.J(n,n,[1,-1,0]),this.labelPlaneMatrix=n,n=e.an(new Float64Array(16)),e.K(n,n,[1,-1,1]),e.J(n,n,[-1,-1,0]),e.K(n,n,[2/this.width,2/this.height,1]),this.glCoordMatrix=n;const o=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),s=Math.min(this.elevation,this.minElevationForCurrentTile),a=o-s*this._pixelPerMeter/Math.cos(this._pitch),l=s<0?a:o,c=Math.PI/2+this._pitch,u=this._fov*(.5+t.y/this.height),h=Math.sin(u)*l/Math.sin(e.ac(Math.PI-c-u,.01,Math.PI-.01)),d=this.getHorizon(),p=2*Math.atan(d/this.cameraToCenterDistance)*(.5+t.y/(2*d)),f=Math.sin(p)*l/Math.sin(e.ac(Math.PI-c-p,.01,Math.PI-.01)),A=Math.min(h,f);this.farZ=1.01*(Math.cos(Math.PI/2-this._pitch)*A+l),this.nearZ=this.height/50,n=new Float64Array(16),e.b6(n,this._fov,this.width/this.height,this.nearZ,this.farZ),n[8]=2*-t.x/this.width,n[9]=2*t.y/this.height,this.projectionMatrix=e.ae(n),e.K(n,n,[1,-1,1]),e.J(n,n,[0,0,-this.cameraToCenterDistance]),e.b7(n,n,this._pitch),e.ad(n,n,this.angle),e.J(n,n,[-i,-r,0]),this.mercatorMatrix=e.K([],n,[this.worldSize,this.worldSize,this.worldSize]),e.K(n,n,[1,1,this._pixelPerMeter]),this.pixelMatrix=e.L(new Float64Array(16),this.labelPlaneMatrix,n),e.J(n,n,[0,0,-this.elevation]),this.modelViewProjectionMatrix=n,this.invModelViewProjectionMatrix=e.as([],n),this.fogMatrix=new Float64Array(16),e.b6(this.fogMatrix,this._fov,this.width/this.height,o,this.farZ),this.fogMatrix[8]=2*-t.x/this.width,this.fogMatrix[9]=2*t.y/this.height,e.K(this.fogMatrix,this.fogMatrix,[1,-1,1]),e.J(this.fogMatrix,this.fogMatrix,[0,0,-this.cameraToCenterDistance]),e.b7(this.fogMatrix,this.fogMatrix,this._pitch),e.ad(this.fogMatrix,this.fogMatrix,this.angle),e.J(this.fogMatrix,this.fogMatrix,[-i,-r,0]),e.K(this.fogMatrix,this.fogMatrix,[1,1,this._pixelPerMeter]),e.J(this.fogMatrix,this.fogMatrix,[0,0,-this.elevation]),this.pixelMatrix3D=e.L(new Float64Array(16),this.labelPlaneMatrix,n);const m=this.width%2/2,g=this.height%2/2,_=Math.cos(this.angle),y=Math.sin(this.angle),v=i-Math.round(i)+_*m+y*g,x=r-Math.round(r)+_*g+y*m,b=new Float64Array(n);if(e.J(b,b,[v>.5?v-1:v,x>.5?x-1:x,0]),this.alignedModelViewProjectionMatrix=b,n=e.as(new Float64Array(16),this.pixelMatrix),!n)throw new Error("failed to invert matrix");this.pixelMatrixInverse=n,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const t=this.pointCoordinate(new e.P(0,0)),i=[t.x*this.worldSize,t.y*this.worldSize,0,1];return e.af(i,i,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new e.P(0,t))}getCameraQueryGeometry(t){const i=this.getCameraPoint();if(1===t.length)return[t[0],i];{let r=i.x,n=i.y,o=i.x,s=i.y;for(const e of t)r=Math.min(r,e.x),n=Math.min(n,e.y),o=Math.max(o,e.x),s=Math.max(s,e.y);return[new e.P(r,n),new e.P(o,n),new e.P(o,s),new e.P(r,s),new e.P(r,n)]}}lngLatToCameraDepth(t,i){const r=this.locationCoordinate(t),n=[r.x*this.worldSize,r.y*this.worldSize,i,1];return e.af(n,n,this.modelViewProjectionMatrix),n[2]/n[3]}}function Tr(t,e){let i,r=!1,n=null,o=null;const s=()=>{n=null,r&&(t.apply(o,i),n=setTimeout(s,e),r=!1)};return(...t)=>(r=!0,o=this,i=t,n||s(),n)}class Br{constructor(t){this._getCurrentHash=()=>{const t=window.location.hash.replace("#","");if(this._hashName){let e;return t.split("&").map((t=>t.split("="))).forEach((t=>{t[0]===this._hashName&&(e=t)})),(e&&e[1]||"").split("/")}return t.split("/")},this._onHashChange=()=>{const t=this._getCurrentHash();if(t.length>=3&&!t.some((t=>isNaN(t)))){const e=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(t[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+t[2],+t[1]],zoom:+t[0],bearing:e,pitch:+(t[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const t=window.location.href.replace(/(#.+)?$/,this.getHashString());window.history.replaceState(window.history.state,null,t)},this._removeHash=()=>{const t=this._getCurrentHash();if(0===t.length)return;const e=t.join("/");let i=e;i.split("&").length>0&&(i=i.split("&")[0]),this._hashName&&(i=`${this._hashName}=${e}`);let r=window.location.hash.replace(i,"");r.startsWith("#&")?r=r.slice(0,1)+r.slice(2):"#"===r&&(r="");let n=window.location.href.replace(/(#.+)?$/,r);n=n.replace("&&","&"),window.history.replaceState(window.history.state,null,n)},this._updateHash=Tr(this._updateHashUnthrottled,300),this._hashName=t&&encodeURIComponent(t)}addTo(t){return this._map=t,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(t){const e=this._map.getCenter(),i=Math.round(100*this._map.getZoom())/100,r=Math.ceil((i*Math.LN2+Math.log(512/360/.5))/Math.LN10),n=Math.pow(10,r),o=Math.round(e.lng*n)/n,s=Math.round(e.lat*n)/n,a=this._map.getBearing(),l=this._map.getPitch();let c="";if(c+=t?`/${o}/${s}/${i}`:`${i}/${s}/${o}`,(a||l)&&(c+="/"+Math.round(10*a)/10),l&&(c+=`/${Math.round(l)}`),this._hashName){const t=this._hashName;let e=!1;const i=window.location.hash.slice(1).split("&").map((i=>{const r=i.split("=")[0];return r===t?(e=!0,`${r}=${c}`):i})).filter((t=>t));return e||i.push(`${t}=${c}`),`#${i.join("&")}`}return`#${c}`}}const Er={linearity:.3,easing:e.b8(0,0,.3,1)},Cr=e.e({deceleration:2500,maxSpeed:1400},Er),Sr=e.e({deceleration:20,maxSpeed:1400},Er),Ir=e.e({deceleration:1e3,maxSpeed:360},Er),Mr=e.e({deceleration:1e3,maxSpeed:90},Er);class kr{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:o.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,e=o.now();for(;t.length>0&&e-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const i={zoom:0,bearing:0,pitch:0,pan:new e.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:t}of this._inertiaBuffer)i.zoom+=t.zoomDelta||0,i.bearing+=t.bearingDelta||0,i.pitch+=t.pitchDelta||0,t.panDelta&&i.pan._add(t.panDelta),t.around&&(i.around=t.around),t.pinchAround&&(i.pinchAround=t.pinchAround);const r=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,n={};if(i.pan.mag()){const o=Lr(i.pan.mag(),r,e.e({},Cr,t||{}));n.offset=i.pan.mult(o.amount/i.pan.mag()),n.center=this._map.transform.center,Pr(n,o)}if(i.zoom){const t=Lr(i.zoom,r,Sr);n.zoom=this._map.transform.zoom+t.amount,Pr(n,t)}if(i.bearing){const t=Lr(i.bearing,r,Ir);n.bearing=this._map.transform.bearing+e.ac(t.amount,-179,179),Pr(n,t)}if(i.pitch){const t=Lr(i.pitch,r,Mr);n.pitch=this._map.transform.pitch+t.amount,Pr(n,t)}if(n.zoom||n.bearing){const t=void 0===i.pinchAround?i.around:i.pinchAround;n.around=t?this._map.unproject(t):this._map.getCenter()}return this.clear(),e.e(n,{noMoveStart:!0})}}function Pr(t,e){(!t.duration||t.duration<e.duration)&&(t.duration=e.duration,t.easing=e.easing)}function Lr(t,i,r){const{maxSpeed:n,linearity:o,deceleration:s}=r,a=e.ac(t*o/(i/1e3),-n,n),l=Math.abs(a)/(s*o);return{easing:r.easing,duration:1e3*l,amount:a*(l/2)}}class zr extends e.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,i,r,n={}){const o=s.mousePos(i.getCanvas(),r),a=i.unproject(o);super(t,e.e({point:o,lngLat:a,originalEvent:r},n)),this._defaultPrevented=!1,this.target=i}}class Fr extends e.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,i,r){const n="touchend"===t?r.changedTouches:r.touches,o=s.touchPos(i.getCanvasContainer(),n),a=o.map((t=>i.unproject(t))),l=o.reduce(((t,e,i,r)=>t.add(e.div(r.length))),new e.P(0,0));super(t,{points:o,point:l,lngLats:a,lngLat:i.unproject(l),originalEvent:r}),this._defaultPrevented=!1}}class Dr extends e.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,e,i){super(t,{originalEvent:i}),this._defaultPrevented=!1}}class Rr{constructor(t,e){this._map=t,this._clickTolerance=e.clickTolerance}reset(){delete this._mousedownPos}wheel(t){return this._firePreventable(new Dr(t.type,this._map,t))}mousedown(t,e){return this._mousedownPos=e,this._firePreventable(new zr(t.type,this._map,t))}mouseup(t){this._map.fire(new zr(t.type,this._map,t))}click(t,e){this._mousedownPos&&this._mousedownPos.dist(e)>=this._clickTolerance||this._map.fire(new zr(t.type,this._map,t))}dblclick(t){return this._firePreventable(new zr(t.type,this._map,t))}mouseover(t){this._map.fire(new zr(t.type,this._map,t))}mouseout(t){this._map.fire(new zr(t.type,this._map,t))}touchstart(t){return this._firePreventable(new Fr(t.type,this._map,t))}touchmove(t){this._map.fire(new Fr(t.type,this._map,t))}touchend(t){this._map.fire(new Fr(t.type,this._map,t))}touchcancel(t){this._map.fire(new Fr(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ur{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(t){this._map.fire(new zr(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new zr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._ignoreContextMenu||this._map.fire(new zr(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Or{constructor(t){this._map=t}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(t){return this.transform.pointLocation(e.P.convert(t),this._map.terrain)}}class Nr{constructor(t,e){this._map=t,this._tr=new Or(t),this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=e.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,e){this.isEnabled()&&t.shiftKey&&0===t.button&&(s.disableDrag(),this._startPos=this._lastPos=e,this._active=!0)}mousemoveWindow(t,e){if(!this._active)return;const i=e;if(this._lastPos.equals(i)||!this._box&&i.dist(this._startPos)<this._clickTolerance)return;const r=this._startPos;this._lastPos=i,this._box||(this._box=s.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",t));const n=Math.min(r.x,i.x),o=Math.max(r.x,i.x),a=Math.min(r.y,i.y),l=Math.max(r.y,i.y);s.setTransform(this._box,`translate(${n}px,${a}px)`),this._box.style.width=o-n+"px",this._box.style.height=l-a+"px"}mouseupWindow(t,i){if(!this._active)return;if(0!==t.button)return;const r=this._startPos,n=i;if(this.reset(),s.suppressClick(),r.x!==n.x||r.y!==n.y)return this._map.fire(new e.k("boxzoomend",{originalEvent:t})),{cameraAnimation:t=>t.fitScreenCoordinates(r,n,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",t)}keydown(t){this._active&&27===t.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",t))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(s.remove(this._box),this._box=null),s.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(t,i){return this._map.fire(new e.k(t,{originalEvent:i}))}}function Qr(t,e){if(t.length!==e.length)throw new Error(`The number of touches and points are not equal - touches ${t.length}, points ${e.length}`);const i={};for(let r=0;r<t.length;r++)i[t[r].identifier]=e[r];return i}class Vr{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(t,i,r){(this.centroid||r.length>this.numTouches)&&(this.aborted=!0),this.aborted||(void 0===this.startTime&&(this.startTime=t.timeStamp),r.length===this.numTouches&&(this.centroid=function(t){const i=new e.P(0,0);for(const e of t)i._add(e);return i.div(t.length)}(i),this.touches=Qr(r,i)))}touchmove(t,e,i){if(this.aborted||!this.centroid)return;const r=Qr(i,e);for(const t in this.touches){const e=r[t];(!e||e.dist(this.touches[t])>30)&&(this.aborted=!0)}}touchend(t,e,i){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),0===i.length){const t=!this.aborted&&this.centroid;if(this.reset(),t)return t}}}class jr{constructor(t){this.singleTap=new Vr(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(t,e,i){this.singleTap.touchstart(t,e,i)}touchmove(t,e,i){this.singleTap.touchmove(t,e,i)}touchend(t,e,i){const r=this.singleTap.touchend(t,e,i);if(r){const e=t.timeStamp-this.lastTime<500,i=!this.lastTap||this.lastTap.dist(r)<30;if(e&&i||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=r,this.count===this.numTaps)return this.reset(),r}}}class Hr{constructor(t){this._tr=new Or(t),this._zoomIn=new jr({numTouches:1,numTaps:2}),this._zoomOut=new jr({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,e,i){this._zoomIn.touchstart(t,e,i),this._zoomOut.touchstart(t,e,i)}touchmove(t,e,i){this._zoomIn.touchmove(t,e,i),this._zoomOut.touchmove(t,e,i)}touchend(t,e,i){const r=this._zoomIn.touchend(t,e,i),n=this._zoomOut.touchend(t,e,i),o=this._tr;return r?(this._active=!0,t.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:e=>e.easeTo({duration:300,zoom:o.zoom+1,around:o.unproject(r)},{originalEvent:t})}):n?(this._active=!0,t.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:e=>e.easeTo({duration:300,zoom:o.zoom-1,around:o.unproject(n)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Gr{constructor(t){this._enabled=!!t.enable,this._moveStateManager=t.moveStateManager,this._clickTolerance=t.clickTolerance||1,this._moveFunction=t.move,this._activateOnStart=!!t.activateOnStart,t.assignEvents(this),this.reset()}reset(t){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(t)}_move(...t){const e=this._moveFunction(...t);if(e.bearingDelta||e.pitchDelta||e.around||e.panDelta)return this._active=!0,e}dragStart(t,e){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(t)&&(this._moveStateManager.startMove(t),this._lastPoint=e.length?e[0]:e,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(t,e){if(!this.isEnabled())return;const i=this._lastPoint;if(!i)return;if(t.preventDefault(),!this._moveStateManager.isValidMoveEvent(t))return void this.reset(t);const r=e.length?e[0]:e;return!this._moved&&r.dist(i)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=r,this._move(i,r))}dragEnd(t){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(t)&&(this._moved&&s.suppressClick(),this.reset(t))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const $r={0:1,2:2};class Zr{constructor(t){this._correctEvent=t.checkCorrectEvent}startMove(t){const e=s.mouseButton(t);this._eventButton=e}endMove(t){delete this._eventButton}isValidStartEvent(t){return this._correctEvent(t)}isValidMoveEvent(t){return!function(t,e){const i=$r[e];return void 0===t.buttons||(t.buttons&i)!==i}(t,this._eventButton)}isValidEndEvent(t){return s.mouseButton(t)===this._eventButton}}class qr{constructor(){this._firstTouch=void 0}_isOneFingerTouch(t){return 1===t.targetTouches.length}_isSameTouchEvent(t){return t.targetTouches[0].identifier===this._firstTouch}startMove(t){this._firstTouch=t.targetTouches[0].identifier}endMove(t){delete this._firstTouch}isValidStartEvent(t){return this._isOneFingerTouch(t)}isValidMoveEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}isValidEndEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}}const Kr=t=>{t.mousedown=t.dragStart,t.mousemoveWindow=t.dragMove,t.mouseup=t.dragEnd,t.contextmenu=t=>{t.preventDefault()}},Wr=({enable:t,clickTolerance:e,bearingDegreesPerPixelMoved:i=.8})=>{const r=new Zr({checkCorrectEvent:t=>0===s.mouseButton(t)&&t.ctrlKey||2===s.mouseButton(t)});return new Gr({clickTolerance:e,move:(t,e)=>({bearingDelta:(e.x-t.x)*i}),moveStateManager:r,enable:t,assignEvents:Kr})},Xr=({enable:t,clickTolerance:e,pitchDegreesPerPixelMoved:i=-.5})=>{const r=new Zr({checkCorrectEvent:t=>0===s.mouseButton(t)&&t.ctrlKey||2===s.mouseButton(t)});return new Gr({clickTolerance:e,move:(t,e)=>({pitchDelta:(e.y-t.y)*i}),moveStateManager:r,enable:t,assignEvents:Kr})};class Jr{constructor(t,e){this._clickTolerance=t.clickTolerance||1,this._map=e,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new e.P(0,0)}_shouldBePrevented(t){return t<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(t,e,i){return this._calculateTransform(t,e,i)}touchmove(t,e,i){if(this._active){if(!this._shouldBePrevented(i.length))return t.preventDefault(),this._calculateTransform(t,e,i);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",t)}}touchend(t,e,i){this._calculateTransform(t,e,i),this._active&&this._shouldBePrevented(i.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,i,r){r.length>0&&(this._active=!0);const n=Qr(r,i),o=new e.P(0,0),s=new e.P(0,0);let a=0;for(const t in n){const e=n[t],i=this._touches[t];i&&(o._add(e),s._add(e.sub(i)),a++,n[t]=e)}if(this._touches=n,this._shouldBePrevented(a)||!s.mag())return;const l=s.div(a);return this._sum._add(l),this._sum.mag()<this._clickTolerance?void 0:{around:o.div(a),panDelta:l}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Yr{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(t,e,i){this._firstTwoTouches||i.length<2||(this._firstTwoTouches=[i[0].identifier,i[1].identifier],this._start([e[0],e[1]]))}touchmove(t,e,i){if(!this._firstTwoTouches)return;t.preventDefault();const[r,n]=this._firstTwoTouches,o=tn(i,e,r),s=tn(i,e,n);if(!o||!s)return;const a=this._aroundCenter?null:o.add(s).div(2);return this._move([o,s],a,t)}touchend(t,e,i){if(!this._firstTwoTouches)return;const[r,n]=this._firstTwoTouches,o=tn(i,e,r),a=tn(i,e,n);o&&a||(this._active&&s.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&"center"===t.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function tn(t,e,i){for(let r=0;r<t.length;r++)if(t[r].identifier===i)return e[r]}function en(t,e){return Math.log(t/e)/Math.LN2}class rn extends Yr{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,e){const i=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(en(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:en(this._distance,i),pinchAround:e}}}function nn(t,e){return 180*t.angleWith(e)/Math.PI}class on extends Yr{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,e,i){const r=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:nn(this._vector,r),pinchAround:e}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const e=25/(Math.PI*this._minDiameter)*360,i=nn(t,this._startVector);return Math.abs(i)<e}}function sn(t){return Math.abs(t.y)>Math.abs(t.x)}class an extends Yr{constructor(t){super(),this._currentTouchCount=0,this._map=t}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(t,e,i){super.touchstart(t,e,i),this._currentTouchCount=i.length}_start(t){this._lastPoints=t,sn(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,e,i){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const r=t[0].sub(this._lastPoints[0]),n=t[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(r,n,i.timeStamp),this._valid?(this._lastPoints=t,this._active=!0,{pitchDelta:(r.y+n.y)/2*-.5}):void 0}gestureBeginsVertically(t,e,i){if(void 0!==this._valid)return this._valid;const r=t.mag()>=2,n=e.mag()>=2;if(!r&&!n)return;if(!r||!n)return void 0===this._firstMove&&(this._firstMove=i),i-this._firstMove<100&&void 0;const o=t.y>0==e.y>0;return sn(t)&&sn(e)&&o}}const ln={panStep:100,bearingStep:15,pitchStep:10};class cn{constructor(t){this._tr=new Or(t);const e=ln;this._panStep=e.panStep,this._bearingStep=e.bearingStep,this._pitchStep=e.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let e=0,i=0,r=0,n=0,o=0;switch(t.keyCode){case 61:case 107:case 171:case 187:e=1;break;case 189:case 109:case 173:e=-1;break;case 37:t.shiftKey?i=-1:(t.preventDefault(),n=-1);break;case 39:t.shiftKey?i=1:(t.preventDefault(),n=1);break;case 38:t.shiftKey?r=1:(t.preventDefault(),o=-1);break;case 40:t.shiftKey?r=-1:(t.preventDefault(),o=1);break;default:return}return this._rotationDisabled&&(i=0,r=0),{cameraAnimation:s=>{const a=this._tr;s.easeTo({duration:300,easeId:"keyboardHandler",easing:un,zoom:e?Math.round(a.zoom)+e*(t.shiftKey?2:1):a.zoom,bearing:a.bearing+i*this._bearingStep,pitch:a.pitch+r*this._pitchStep,offset:[-n*this._panStep,-o*this._panStep],center:a.center},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function un(t){return t*(2-t)}const hn=4.000244140625;class dn{constructor(t,e){this._onTimeout=t=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)},this._map=t,this._tr=new Or(t),this._triggerRenderFrame=e,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&"center"===t.around)}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(t){return!!this._map.cooperativeGestures.isEnabled()&&!(t.ctrlKey||this._map.cooperativeGestures.isBypassed(t))}wheel(t){if(!this.isEnabled())return;if(this._shouldBePrevented(t))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",t);let e=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const i=o.now(),r=i-(this._lastWheelEventTime||0);this._lastWheelEventTime=i,0!==e&&e%hn==0?this._type="wheel":0!==e&&Math.abs(e)<4?this._type="trackpad":r>400?(this._type=null,this._lastValue=e,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(r*e)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,e+=this._lastValue)),t.shiftKey&&e&&(e/=4),this._type&&(this._lastWheelEvent=t,this._delta-=e,this._active||this._start(t)),t.preventDefault()}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const i=s.mousePos(this._map.getCanvas(),t),r=this._tr;this._around=i.y>r.transform.height/2-r.transform.getHorizon()?e.N.convert(this._aroundCenter?r.center:r.unproject(i)):e.N.convert(r.center),this._aroundPoint=r.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId)return;if(this._frameId=null,!this.isActive())return;const t=this._tr.transform;if(0!==this._delta){const e="wheel"===this._type&&Math.abs(this._delta)>hn?this._wheelZoomRate:this._defaultZoomRate;let i=2/(1+Math.exp(-Math.abs(this._delta*e)));this._delta<0&&0!==i&&(i=1/i);const r="number"==typeof this._targetZoom?t.zoomScale(this._targetZoom):t.scale;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(r*i))),"wheel"===this._type&&(this._startZoom=t.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const i="number"==typeof this._targetZoom?this._targetZoom:t.zoom,r=this._startZoom,n=this._easing;let s,a=!1;const l=o.now()-this._lastWheelEventTime;if("wheel"===this._type&&r&&n&&l){const t=Math.min(l/200,1),o=n(t);s=e.y.number(r,i,o),t<1?this._frameId||(this._frameId=!0):a=!0}else s=i,a=!0;return this._active=!0,a&&(this._active=!1,this._finishTimeout=setTimeout((()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout}),200)),{noInertia:!0,needsRenderFrame:!a,zoomDelta:s-t.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let i=e.b9;if(this._prevEase){const t=this._prevEase,r=(o.now()-t.start)/t.duration,n=t.easing(r+.01)-t.easing(r),s=.27/Math.sqrt(n*n+1e-4)*.01,a=Math.sqrt(.0729-s*s);i=e.b8(s,a,.25,1)}return this._prevEase={start:o.now(),duration:t,easing:i},i}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class pn{constructor(t,e){this._clickZoom=t,this._tapZoom=e}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class fn{constructor(t){this._tr=new Or(t),this.reset()}reset(){this._active=!1}dblclick(t,e){return t.preventDefault(),{cameraAnimation:i=>{i.easeTo({duration:300,zoom:this._tr.zoom+(t.shiftKey?-1:1),around:this._tr.unproject(e)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class An{constructor(){this._tap=new jr({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(t,e,i){if(!this._swipePoint)if(this._tapTime){const r=e[0],n=t.timeStamp-this._tapTime<500,o=this._tapPoint.dist(r)<30;n&&o?i.length>0&&(this._swipePoint=r,this._swipeTouch=i[0].identifier):this.reset()}else this._tap.touchstart(t,e,i)}touchmove(t,e,i){if(this._tapTime){if(this._swipePoint){if(i[0].identifier!==this._swipeTouch)return;const r=e[0],n=r.y-this._swipePoint.y;return this._swipePoint=r,t.preventDefault(),this._active=!0,{zoomDelta:n/128}}}else this._tap.touchmove(t,e,i)}touchend(t,e,i){if(this._tapTime)this._swipePoint&&0===i.length&&this.reset();else{const r=this._tap.touchend(t,e,i);r&&(this._tapTime=t.timeStamp,this._tapPoint=r)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class mn{constructor(t,e,i){this._el=t,this._mousePan=e,this._touchPan=i}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class gn{constructor(t,e,i){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=e,this._mousePitch=i}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class _n{constructor(t,e,i,r){this._el=t,this._touchZoom=e,this._touchRotate=i,this._tapDragZoom=r,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class yn{constructor(t,e){this._bypassKey=-1!==navigator.userAgent.indexOf("Mac")?"metaKey":"ctrlKey",this._map=t,this._options=e,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const t=this._map.getCanvasContainer();t.classList.add("maplibregl-cooperative-gestures"),this._container=s.create("div","maplibregl-cooperative-gesture-screen",t);let e=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");"metaKey"===this._bypassKey&&(e=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const i=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),r=document.createElement("div");r.className="maplibregl-desktop-message",r.textContent=e,this._container.appendChild(r);const n=document.createElement("div");n.className="maplibregl-mobile-message",n.textContent=i,this._container.appendChild(n),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(s.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(t){return t[this._bypassKey]}notifyGestureBlocked(t,i){this._enabled&&(this._map.fire(new e.k("cooperativegestureprevented",{gestureType:t,originalEvent:i})),this._container.classList.add("maplibregl-show"),setTimeout((()=>{this._container.classList.remove("maplibregl-show")}),100))}}const vn=t=>t.zoom||t.drag||t.pitch||t.rotate;class xn extends e.k{}function bn(t){return t.panDelta&&t.panDelta.mag()||t.zoomDelta||t.bearingDelta||t.pitchDelta}class wn{constructor(t,e){this.handleWindowEvent=t=>{this.handleEvent(t,`${t.type}Window`)},this.handleEvent=(t,e)=>{if("blur"===t.type)return void this.stop(!0);this._updatingCamera=!0;const i="renderFrame"===t.type?void 0:t,r={needsRenderFrame:!1},n={},o={},a=t.touches,l=a?this._getMapTouches(a):void 0,c=l?s.touchPos(this._map.getCanvas(),l):s.mousePos(this._map.getCanvas(),t);for(const{handlerName:s,handler:a,allowed:u}of this._handlers){if(!a.isEnabled())continue;let h;this._blockedByActive(o,u,s)?a.reset():a[e||t.type]&&(h=a[e||t.type](t,c,l),this.mergeHandlerResult(r,n,h,s,i),h&&h.needsRenderFrame&&this._triggerRenderFrame()),(h||a.isActive())&&(o[s]=a)}const u={};for(const t in this._previousActiveHandlers)o[t]||(u[t]=i);this._previousActiveHandlers=o,(Object.keys(u).length||bn(r))&&(this._changes.push([r,n,u]),this._triggerRenderFrame()),(Object.keys(o).length||bn(r))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:h}=r;h&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],h(this._map))},this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new kr(t),this._bearingSnap=e.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(e);const i=this._el;this._listeners=[[i,"touchstart",{passive:!0}],[i,"touchmove",{passive:!1}],[i,"touchend",void 0],[i,"touchcancel",void 0],[i,"mousedown",void 0],[i,"mousemove",void 0],[i,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[i,"mouseover",void 0],[i,"mouseout",void 0],[i,"dblclick",void 0],[i,"click",void 0],[i,"keydown",{capture:!1}],[i,"keyup",void 0],[i,"wheel",{passive:!1}],[i,"contextmenu",void 0],[window,"blur",void 0]];for(const[t,e,i]of this._listeners)s.addEventListener(t,e,t===document?this.handleWindowEvent:this.handleEvent,i)}destroy(){for(const[t,e,i]of this._listeners)s.removeEventListener(t,e,t===document?this.handleWindowEvent:this.handleEvent,i)}_addDefaultHandlers(t){const e=this._map,i=e.getCanvasContainer();this._add("mapEvent",new Rr(e,t));const r=e.boxZoom=new Nr(e,t);this._add("boxZoom",r),t.interactive&&t.boxZoom&&r.enable();const n=e.cooperativeGestures=new yn(e,t.cooperativeGestures);this._add("cooperativeGestures",n),t.cooperativeGestures&&n.enable();const o=new Hr(e),a=new fn(e);e.doubleClickZoom=new pn(a,o),this._add("tapZoom",o),this._add("clickZoom",a),t.interactive&&t.doubleClickZoom&&e.doubleClickZoom.enable();const l=new An;this._add("tapDragZoom",l);const c=e.touchPitch=new an(e);this._add("touchPitch",c),t.interactive&&t.touchPitch&&e.touchPitch.enable(t.touchPitch);const u=Wr(t),h=Xr(t);e.dragRotate=new gn(t,u,h),this._add("mouseRotate",u,["mousePitch"]),this._add("mousePitch",h,["mouseRotate"]),t.interactive&&t.dragRotate&&e.dragRotate.enable();const d=(({enable:t,clickTolerance:e})=>{const i=new Zr({checkCorrectEvent:t=>0===s.mouseButton(t)&&!t.ctrlKey});return new Gr({clickTolerance:e,move:(t,e)=>({around:e,panDelta:e.sub(t)}),activateOnStart:!0,moveStateManager:i,enable:t,assignEvents:Kr})})(t),p=new Jr(t,e);e.dragPan=new mn(i,d,p),this._add("mousePan",d),this._add("touchPan",p,["touchZoom","touchRotate"]),t.interactive&&t.dragPan&&e.dragPan.enable(t.dragPan);const f=new on,A=new rn;e.touchZoomRotate=new _n(i,A,f,l),this._add("touchRotate",f,["touchPan","touchZoom"]),this._add("touchZoom",A,["touchPan","touchRotate"]),t.interactive&&t.touchZoomRotate&&e.touchZoomRotate.enable(t.touchZoomRotate);const m=e.scrollZoom=new dn(e,(()=>this._triggerRenderFrame()));this._add("scrollZoom",m,["mousePan"]),t.interactive&&t.scrollZoom&&e.scrollZoom.enable(t.scrollZoom);const g=e.keyboard=new cn(e);this._add("keyboard",g),t.interactive&&t.keyboard&&e.keyboard.enable(),this._add("blockableMapEvent",new Ur(e))}_add(t,e,i){this._handlers.push({handlerName:t,handler:e,allowed:i}),this._handlersById[t]=e}stop(t){if(!this._updatingCamera){for(const{handler:t}of this._handlers)t.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return Boolean(vn(this._eventsInProgress))||this.isZooming()}_blockedByActive(t,e,i){for(const r in t)if(r!==i&&(!e||e.indexOf(r)<0))return!0;return!1}_getMapTouches(t){const e=[];for(const i of t)this._el.contains(i.target)&&e.push(i);return e}mergeHandlerResult(t,i,r,n,o){if(!r)return;e.e(t,r);const s={handlerName:n,originalEvent:r.originalEvent||o};void 0!==r.zoomDelta&&(i.zoom=s),void 0!==r.panDelta&&(i.drag=s),void 0!==r.pitchDelta&&(i.pitch=s),void 0!==r.bearingDelta&&(i.rotate=s)}_applyChanges(){const t={},i={},r={};for(const[n,o,s]of this._changes)n.panDelta&&(t.panDelta=(t.panDelta||new e.P(0,0))._add(n.panDelta)),n.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+n.zoomDelta),n.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+n.bearingDelta),n.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+n.pitchDelta),void 0!==n.around&&(t.around=n.around),void 0!==n.pinchAround&&(t.pinchAround=n.pinchAround),n.noInertia&&(t.noInertia=n.noInertia),e.e(i,o),e.e(r,s);this._updateMapTransform(t,i,r),this._changes=[]}_updateMapTransform(t,e,i){const r=this._map,n=r._getTransformForUpdate(),o=r.terrain;if(!(bn(t)||o&&this._terrainMovement))return this._fireEvents(e,i,!0);let{panDelta:s,zoomDelta:a,bearingDelta:l,pitchDelta:c,around:u,pinchAround:h}=t;void 0!==h&&(u=h),r._stop(!0),u=u||r.transform.centerPoint;const d=n.pointLocation(s?u.sub(s):u);l&&(n.bearing+=l),c&&(n.pitch+=c),a&&(n.zoom+=a),o?this._terrainMovement||!e.drag&&!e.zoom?e.drag&&this._terrainMovement?n.center=n.pointLocation(n.centerPoint.sub(s)):n.setLocationAtPoint(d,u):(this._terrainMovement=!0,this._map._elevationFreeze=!0,n.setLocationAtPoint(d,u)):n.setLocationAtPoint(d,u),r._applyUpdatedTransform(n),this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(e,i,!0)}_fireEvents(t,i,r){const n=vn(this._eventsInProgress),s=vn(t),a={};for(const e in t){const{originalEvent:i}=t[e];this._eventsInProgress[e]||(a[`${e}start`]=i),this._eventsInProgress[e]=t[e]}!n&&s&&this._fireEvent("movestart",s.originalEvent);for(const t in a)this._fireEvent(t,a[t]);s&&this._fireEvent("move",s.originalEvent);for(const e in t){const{originalEvent:i}=t[e];this._fireEvent(e,i)}const l={};let c;for(const t in this._eventsInProgress){const{handlerName:e,originalEvent:r}=this._eventsInProgress[t];this._handlersById[e].isActive()||(delete this._eventsInProgress[t],c=i[e]||r,l[`${t}end`]=c)}for(const t in l)this._fireEvent(t,l[t]);const u=vn(this._eventsInProgress),h=(n||s)&&!u;if(h&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const t=this._map._getTransformForUpdate();t.recalculateZoom(this._map.terrain),this._map._applyUpdatedTransform(t)}if(r&&h){this._updatingCamera=!0;const t=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),i=t=>0!==t&&-this._bearingSnap<t&&t<this._bearingSnap;!t||!t.essential&&o.prefersReducedMotion?(this._map.fire(new e.k("moveend",{originalEvent:c})),i(this._map.getBearing())&&this._map.resetNorth()):(i(t.bearing||this._map.getBearing())&&(t.bearing=0),t.freezeElevation=!0,this._map.easeTo(t,{originalEvent:c})),this._updatingCamera=!1}}_fireEvent(t,i){this._map.fire(new e.k(t,i?{originalEvent:i}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((t=>{delete this._frameId,this.handleEvent(new xn("renderFrame",{timeStamp:t})),this._applyChanges()}))}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}class Tn extends e.E{constructor(t,e){super(),this._renderFrameCallback=()=>{const t=Math.min((o.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(t)),t<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=e.bearingSnap,this.on("moveend",(()=>{delete this._requestedCameraState}))}getCenter(){return new e.N(this.transform.center.lng,this.transform.center.lat)}setCenter(t,e){return this.jumpTo({center:t},e)}panBy(t,i,r){return t=e.P.convert(t).mult(-1),this.panTo(this.transform.center,e.e({offset:t},i),r)}panTo(t,i,r){return this.easeTo(e.e({center:t},i),r)}getZoom(){return this.transform.zoom}setZoom(t,e){return this.jumpTo({zoom:t},e),this}zoomTo(t,i,r){return this.easeTo(e.e({zoom:t},i),r)}zoomIn(t,e){return this.zoomTo(this.getZoom()+1,t,e),this}zoomOut(t,e){return this.zoomTo(this.getZoom()-1,t,e),this}getBearing(){return this.transform.bearing}setBearing(t,e){return this.jumpTo({bearing:t},e),this}getPadding(){return this.transform.padding}setPadding(t,e){return this.jumpTo({padding:t},e),this}rotateTo(t,i,r){return this.easeTo(e.e({bearing:t},i),r)}resetNorth(t,i){return this.rotateTo(0,e.e({duration:1e3},t),i),this}resetNorthPitch(t,i){return this.easeTo(e.e({bearing:0,pitch:0,duration:1e3},t),i),this}snapToNorth(t,e){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,e):this}getPitch(){return this.transform.pitch}setPitch(t,e){return this.jumpTo({pitch:t},e),this}cameraForBounds(t,e){t=$.convert(t).adjustAntiMeridian();const i=e&&e.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),i,e)}_cameraForBoxAndBearing(t,i,r,n){const o={top:0,bottom:0,right:0,left:0};if("number"==typeof(n=e.e({padding:o,offset:[0,0],maxZoom:this.transform.maxZoom},n)).padding){const t=n.padding;n.padding={top:t,bottom:t,right:t,left:t}}n.padding=e.e(o,n.padding);const s=this.transform,a=s.padding,l=new $(t,i),c=s.project(l.getNorthWest()),u=s.project(l.getNorthEast()),h=s.project(l.getSouthEast()),d=s.project(l.getSouthWest()),p=e.ba(-r),f=c.rotate(p),A=u.rotate(p),m=h.rotate(p),g=d.rotate(p),_=new e.P(Math.max(f.x,A.x,g.x,m.x),Math.max(f.y,A.y,g.y,m.y)),y=new e.P(Math.min(f.x,A.x,g.x,m.x),Math.min(f.y,A.y,g.y,m.y)),v=_.sub(y),x=(s.width-(a.left+a.right+n.padding.left+n.padding.right))/v.x,b=(s.height-(a.top+a.bottom+n.padding.top+n.padding.bottom))/v.y;if(b<0||x<0)return void e.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const w=Math.min(s.scaleZoom(s.scale*Math.min(x,b)),n.maxZoom),T=e.P.convert(n.offset),B=new e.P((n.padding.left-n.padding.right)/2,(n.padding.top-n.padding.bottom)/2).rotate(e.ba(r)),E=T.add(B).mult(s.scale/s.zoomScale(w));return{center:s.unproject(c.add(h).div(2).sub(E)),zoom:w,bearing:r}}fitBounds(t,e,i){return this._fitInternal(this.cameraForBounds(t,e),e,i)}fitScreenCoordinates(t,i,r,n,o){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(e.P.convert(t)),this.transform.pointLocation(e.P.convert(i)),r,n),n,o)}_fitInternal(t,i,r){return t?(delete(i=e.e(t,i)).padding,i.linear?this.easeTo(i,r):this.flyTo(i,r)):this}jumpTo(t,i){this.stop();const r=this._getTransformForUpdate();let n=!1,o=!1,s=!1;return"zoom"in t&&r.zoom!==+t.zoom&&(n=!0,r.zoom=+t.zoom),void 0!==t.center&&(r.center=e.N.convert(t.center)),"bearing"in t&&r.bearing!==+t.bearing&&(o=!0,r.bearing=+t.bearing),"pitch"in t&&r.pitch!==+t.pitch&&(s=!0,r.pitch=+t.pitch),null==t.padding||r.isPaddingEqual(t.padding)||(r.padding=t.padding),this._applyUpdatedTransform(r),this.fire(new e.k("movestart",i)).fire(new e.k("move",i)),n&&this.fire(new e.k("zoomstart",i)).fire(new e.k("zoom",i)).fire(new e.k("zoomend",i)),o&&this.fire(new e.k("rotatestart",i)).fire(new e.k("rotate",i)).fire(new e.k("rotateend",i)),s&&this.fire(new e.k("pitchstart",i)).fire(new e.k("pitch",i)).fire(new e.k("pitchend",i)),this.fire(new e.k("moveend",i))}calculateCameraOptionsFromTo(t,i,r,n=0){const o=e.Z.fromLngLat(t,i),s=e.Z.fromLngLat(r,n),a=s.x-o.x,l=s.y-o.y,c=s.z-o.z,u=Math.hypot(a,l,c);if(0===u)throw new Error("Can't calculate camera options with same From and To");const h=Math.hypot(a,l),d=this.transform.scaleZoom(this.transform.cameraToCenterDistance/u/this.transform.tileSize),p=180*Math.atan2(a,-l)/Math.PI;let f=180*Math.acos(h/u)/Math.PI;return f=c<0?90-f:90+f,{center:s.toLngLat(),zoom:d,pitch:f,bearing:p}}easeTo(t,i){var r;this._stop(!1,t.easeId),(!1===(t=e.e({offset:[0,0],duration:500,easing:e.b9},t)).animate||!t.essential&&o.prefersReducedMotion)&&(t.duration=0);const n=this._getTransformForUpdate(),s=n.zoom,a=n.bearing,l=n.pitch,c=n.padding,u="bearing"in t?this._normalizeBearing(t.bearing,a):a,h="pitch"in t?+t.pitch:l,d="padding"in t?t.padding:n.padding,p=e.P.convert(t.offset);let f=n.centerPoint.add(p);const A=n.pointLocation(f),{center:m,zoom:g}=n.getConstrained(e.N.convert(t.center||A),null!==(r=t.zoom)&&void 0!==r?r:s);this._normalizeCenter(m,n);const _=n.project(A),y=n.project(m).sub(_),v=n.zoomScale(g-s);let x,b;t.around&&(x=e.N.convert(t.around),b=n.locationPoint(x));const w={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||g!==s,this._rotating=this._rotating||a!==u,this._pitching=this._pitching||h!==l,this._padding=!n.isPaddingEqual(d),this._easeId=t.easeId,this._prepareEase(i,t.noMoveStart,w),this.terrain&&this._prepareElevation(m),this._ease((r=>{if(this._zooming&&(n.zoom=e.y.number(s,g,r)),this._rotating&&(n.bearing=e.y.number(a,u,r)),this._pitching&&(n.pitch=e.y.number(l,h,r)),this._padding&&(n.interpolatePadding(c,d,r),f=n.centerPoint.add(p)),this.terrain&&!t.freezeElevation&&this._updateElevation(r),x)n.setLocationAtPoint(x,b);else{const t=n.zoomScale(n.zoom-s),e=g>s?Math.min(2,v):Math.max(.5,v),i=Math.pow(e,1-r),o=n.unproject(_.add(y.mult(r*i)).mult(t));n.setLocationAtPoint(n.renderWorldCopies?o.wrap():o,f)}this._applyUpdatedTransform(n),this._fireMoveEvents(i)}),(e=>{this.terrain&&t.freezeElevation&&this._finalizeElevation(),this._afterEase(i,e)}),t),this}_prepareEase(t,i,r={}){this._moving=!0,i||r.moving||this.fire(new e.k("movestart",t)),this._zooming&&!r.zooming&&this.fire(new e.k("zoomstart",t)),this._rotating&&!r.rotating&&this.fire(new e.k("rotatestart",t)),this._pitching&&!r.pitching&&this.fire(new e.k("pitchstart",t))}_prepareElevation(t){this._elevationCenter=t,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(t,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(t){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const i=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(t<1&&i!==this._elevationTarget){const e=this._elevationTarget-this._elevationStart;this._elevationStart+=t*(e-(i-(e*t+this._elevationStart))/(1-t)),this._elevationTarget=i}this.transform.elevation=e.y.number(this._elevationStart,this._elevationTarget,t)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(t){const e=t.getCameraPosition(),i=this.terrain.getElevationForLngLatZoom(e.lngLat,t.zoom);if(e.altitude<i){const r=this.calculateCameraOptionsFromTo(e.lngLat,i,t.center,t.elevation);return{pitch:r.pitch,zoom:r.zoom}}return{}}_applyUpdatedTransform(t){const e=[];if(this.terrain&&e.push((t=>this._elevateCameraIfInsideTerrain(t))),this.transformCameraUpdate&&e.push((t=>this.transformCameraUpdate(t))),!e.length)return;const i=t.clone();for(const t of e){const e=i.clone(),{center:r,zoom:n,pitch:o,bearing:s,elevation:a}=t(e);r&&(e.center=r),void 0!==n&&(e.zoom=n),void 0!==o&&(e.pitch=o),void 0!==s&&(e.bearing=s),void 0!==a&&(e.elevation=a),i.apply(e)}this.transform.apply(i)}_fireMoveEvents(t){this.fire(new e.k("move",t)),this._zooming&&this.fire(new e.k("zoom",t)),this._rotating&&this.fire(new e.k("rotate",t)),this._pitching&&this.fire(new e.k("pitch",t))}_afterEase(t,i){if(this._easeId&&i&&this._easeId===i)return;delete this._easeId;const r=this._zooming,n=this._rotating,o=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,r&&this.fire(new e.k("zoomend",t)),n&&this.fire(new e.k("rotateend",t)),o&&this.fire(new e.k("pitchend",t)),this.fire(new e.k("moveend",t))}flyTo(t,i){var r;if(!t.essential&&o.prefersReducedMotion){const r=e.M(t,["center","zoom","bearing","pitch","around"]);return this.jumpTo(r,i)}this.stop(),t=e.e({offset:[0,0],speed:1.2,curve:1.42,easing:e.b9},t);const n=this._getTransformForUpdate(),s=n.zoom,a=n.bearing,l=n.pitch,c=n.padding,u="bearing"in t?this._normalizeBearing(t.bearing,a):a,h="pitch"in t?+t.pitch:l,d="padding"in t?t.padding:n.padding,p=e.P.convert(t.offset);let f=n.centerPoint.add(p);const A=n.pointLocation(f),{center:m,zoom:g}=n.getConstrained(e.N.convert(t.center||A),null!==(r=t.zoom)&&void 0!==r?r:s);this._normalizeCenter(m,n);const _=n.zoomScale(g-s),y=n.project(A),v=n.project(m).sub(y);let x=t.curve;const b=Math.max(n.width,n.height),w=b/_,T=v.mag();if("minZoom"in t){const i=e.ac(Math.min(t.minZoom,s,g),n.minZoom,n.maxZoom),r=b/n.zoomScale(i-s);x=Math.sqrt(r/T*2)}const B=x*x;function E(t){const e=(w*w-b*b+(t?-1:1)*B*B*T*T)/(2*(t?w:b)*B*T);return Math.log(Math.sqrt(e*e+1)-e)}function C(t){return(Math.exp(t)-Math.exp(-t))/2}function S(t){return(Math.exp(t)+Math.exp(-t))/2}const I=E(!1);let M=function(t){return S(I)/S(I+x*t)},k=function(t){return b*((S(I)*(C(e=I+x*t)/S(e))-C(I))/B)/T;var e},P=(E(!0)-I)/x;if(Math.abs(T)<1e-6||!isFinite(P)){if(Math.abs(b-w)<1e-6)return this.easeTo(t,i);const e=w<b?-1:1;P=Math.abs(Math.log(w/b))/x,k=()=>0,M=t=>Math.exp(e*x*t)}return t.duration="duration"in t?+t.duration:1e3*P/("screenSpeed"in t?+t.screenSpeed/x:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=a!==u,this._pitching=h!==l,this._padding=!n.isPaddingEqual(d),this._prepareEase(i,!1),this.terrain&&this._prepareElevation(m),this._ease((r=>{const o=r*P,A=1/M(o);n.zoom=1===r?g:s+n.scaleZoom(A),this._rotating&&(n.bearing=e.y.number(a,u,r)),this._pitching&&(n.pitch=e.y.number(l,h,r)),this._padding&&(n.interpolatePadding(c,d,r),f=n.centerPoint.add(p)),this.terrain&&!t.freezeElevation&&this._updateElevation(r);const _=1===r?m:n.unproject(y.add(v.mult(k(o))).mult(A));n.setLocationAtPoint(n.renderWorldCopies?_.wrap():_,f),this._applyUpdatedTransform(n),this._fireMoveEvents(i)}),(()=>{this.terrain&&t.freezeElevation&&this._finalizeElevation(),this._afterEase(i)}),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,e){var i;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const t=this._onEaseEnd;delete this._onEaseEnd,t.call(this,e)}return t||null===(i=this.handlers)||void 0===i||i.stop(!1),this}_ease(t,e,i){!1===i.animate||0===i.duration?(t(1),e()):(this._easeStart=o.now(),this._easeOptions=i,this._onEaseFrame=t,this._onEaseEnd=e,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(t,i){t=e.b3(t,-180,180);const r=Math.abs(t-i);return Math.abs(t-360-i)<r&&(t-=360),Math.abs(t+360-i)<r&&(t+=360),t}_normalizeCenter(t,e){if(!e.renderWorldCopies||e.lngRange)return;const i=t.lng-e.center.lng;t.lng+=i>180?-360:i<-180?360:0}queryTerrainElevation(t){return this.terrain?this.terrain.getElevationForLngLatZoom(e.N.convert(t),this.transform.tileZoom)-this.transform.elevation:null}}const Bn={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class En{constructor(t=Bn){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=t=>{!t||"metadata"!==t.sourceDataType&&"visibility"!==t.sourceDataType&&"style"!==t.dataType&&"terrain"!==t.type||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?!1===this._compact?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=t}getDefaultPosition(){return"bottom-right"}onAdd(t){return this._map=t,this._compact=this.options.compact,this._container=s.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=s.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=s.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){s.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(t,e){const i=this._map._getUIString(`AttributionControl.${e}`);t.title=i,t.setAttribute("aria-label",i)}_updateAttributions(){if(!this._map.style)return;let t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map((t=>"string"!=typeof t?"":t))):"string"==typeof this.options.customAttribution&&t.push(this.options.customAttribution)),this._map.style.stylesheet){const t=this._map.style.stylesheet;this.styleOwner=t.owner,this.styleId=t.id}const e=this._map.style.sourceCaches;for(const i in e){const r=e[i];if(r.used||r.usedForTerrain){const e=r.getSource();e.attribution&&t.indexOf(e.attribution)<0&&t.push(e.attribution)}}t=t.filter((t=>String(t).trim())),t.sort(((t,e)=>t.length-e.length)),t=t.filter(((e,i)=>{for(let r=i+1;r<t.length;r++)if(t[r].indexOf(e)>=0)return!1;return!0}));const i=t.join(" | ");i!==this._attribHTML&&(this._attribHTML=i,t.length?(this._innerContainer.innerHTML=i,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Cn{constructor(t={}){this._updateCompact=()=>{const t=this._container.children;if(t.length){const e=t[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?!1!==this._compact&&e.classList.add("maplibregl-compact"):e.classList.remove("maplibregl-compact")}},this.options=t}getDefaultPosition(){return"bottom-left"}onAdd(t){this._map=t,this._compact=this.options&&this.options.compact,this._container=s.create("div","maplibregl-ctrl");const e=s.create("a","maplibregl-ctrl-logo");return e.target="_blank",e.rel="noopener nofollow",e.href="https://maplibre.org/",e.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),e.setAttribute("rel","noopener nofollow"),this._container.appendChild(e),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){s.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Sn{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const e=++this._id;return this._queue.push({callback:t,id:e,cancelled:!1}),e}remove(t){const e=this._currentlyRunning,i=e?this._queue.concat(e):this._queue;for(const e of i)if(e.id===t)return void(e.cancelled=!0)}run(t=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const e=this._currentlyRunning=this._queue;this._queue=[];for(const i of e)if(!i.cancelled&&(i.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var In=e.Y([{name:"a_pos3d",type:"Int16",components:3}]);class Mn extends e.E{constructor(t){super(),this.sourceCache=t,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,t.usedForTerrain=!0,t.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(t,i){this.sourceCache.update(t,i),this._renderableTilesKeys=[];const r={};for(const n of t.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:i}))r[n.key]=!0,this._renderableTilesKeys.push(n.key),this._tiles[n.key]||(n.posMatrix=new Float64Array(16),e.aP(n.posMatrix,0,e.X,0,e.X,0,1),this._tiles[n.key]=new lt(n,this.tileSize));for(const t in this._tiles)r[t]||delete this._tiles[t]}freeRtt(t){for(const e in this._tiles){const i=this._tiles[e];(!t||i.tileID.equals(t)||i.tileID.isChildOf(t)||t.isChildOf(i.tileID))&&(i.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map((t=>this.getTileByID(t)))}getTileByID(t){return this._tiles[t]}getTerrainCoords(t){const i={};for(const r of this._renderableTilesKeys){const n=this._tiles[r].tileID;if(n.canonical.equals(t.canonical)){const n=t.clone();n.posMatrix=new Float64Array(16),e.aP(n.posMatrix,0,e.X,0,e.X,0,1),i[r]=n}else if(n.canonical.isChildOf(t.canonical)){const o=t.clone();o.posMatrix=new Float64Array(16);const s=n.canonical.z-t.canonical.z,a=n.canonical.x-(n.canonical.x>>s<<s),l=n.canonical.y-(n.canonical.y>>s<<s),c=e.X>>s;e.aP(o.posMatrix,0,c,0,c,0,1),e.J(o.posMatrix,o.posMatrix,[-a*c,-l*c,0]),i[r]=o}else if(t.canonical.isChildOf(n.canonical)){const o=t.clone();o.posMatrix=new Float64Array(16);const s=t.canonical.z-n.canonical.z,a=t.canonical.x-(t.canonical.x>>s<<s),l=t.canonical.y-(t.canonical.y>>s<<s),c=e.X>>s;e.aP(o.posMatrix,0,e.X,0,e.X,0,1),e.J(o.posMatrix,o.posMatrix,[a*c,l*c,0]),e.K(o.posMatrix,o.posMatrix,[1/2**s,1/2**s,0]),i[r]=o}}return i}getSourceTile(t,e){const i=this.sourceCache._source;let r=t.overscaledZ-this.deltaZoom;if(r>i.maxzoom&&(r=i.maxzoom),r<i.minzoom)return null;this._sourceTileCache[t.key]||(this._sourceTileCache[t.key]=t.scaledTo(r).key);let n=this.sourceCache.getTileByID(this._sourceTileCache[t.key]);if((!n||!n.dem)&&e)for(;r>=i.minzoom&&(!n||!n.dem);)n=this.sourceCache.getTileByID(t.scaledTo(r--).key);return n}tilesAfterTime(t=Date.now()){return Object.values(this._tiles).filter((e=>e.timeAdded>=t))}}class kn{constructor(t,e,i){this.painter=t,this.sourceCache=new Mn(e),this.options=i,this.exaggeration="number"==typeof i.exaggeration?i.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(t,i,r,n=e.X){var o;if(!(i>=0&&i<n&&r>=0&&r<n))return 0;const s=this.getTerrainData(t),a=null===(o=s.tile)||void 0===o?void 0:o.dem;if(!a)return 0;const l=function(t,e,i){var r=e[0],n=e[1];return t[0]=i[0]*r+i[4]*n+i[12],t[1]=i[1]*r+i[5]*n+i[13],t}([],[i/n*e.X,r/n*e.X],s.u_terrain_matrix),c=[l[0]*a.dim,l[1]*a.dim],u=Math.floor(c[0]),h=Math.floor(c[1]),d=c[0]-u,p=c[1]-h;return a.get(u,h)*(1-d)*(1-p)+a.get(u+1,h)*d*(1-p)+a.get(u,h+1)*(1-d)*p+a.get(u+1,h+1)*d*p}getElevationForLngLatZoom(t,i){if(!e.bb(i,t.wrap()))return 0;const{tileID:r,mercatorX:n,mercatorY:o}=this._getOverscaledTileIDFromLngLatZoom(t,i);return this.getElevation(r,n%e.X,o%e.X,e.X)}getElevation(t,i,r,n=e.X){return this.getDEMElevation(t,i,r,n)*this.exaggeration}getTerrainData(t){if(!this._emptyDemTexture){const t=this.painter.context,i=new e.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new x(t,i,t.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new x(t,new e.R({width:1,height:1}),t.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(t.gl.NEAREST,t.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=e.an([])}const i=this.sourceCache.getSourceTile(t,!0);if(i&&i.dem&&(!i.demTexture||i.needsTerrainPrepare)){const t=this.painter.context;i.demTexture=this.painter.getTileTexture(i.dem.stride),i.demTexture?i.demTexture.update(i.dem.getPixels(),{premultiply:!1}):i.demTexture=new x(t,i.dem.getPixels(),t.gl.RGBA,{premultiply:!1}),i.demTexture.bind(t.gl.NEAREST,t.gl.CLAMP_TO_EDGE),i.needsTerrainPrepare=!1}const r=i&&i+i.tileID.key+t.key;if(r&&!this._demMatrixCache[r]){const r=this.sourceCache.sourceCache._source.maxzoom;let n=t.canonical.z-i.tileID.canonical.z;t.overscaledZ>t.canonical.z&&(t.canonical.z>=r?n=t.canonical.z-r:e.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const o=t.canonical.x-(t.canonical.x>>n<<n),s=t.canonical.y-(t.canonical.y>>n<<n),a=e.bc(new Float64Array(16),[1/(e.X<<n),1/(e.X<<n),0]);e.J(a,a,[o*e.X,s*e.X,0]),this._demMatrixCache[t.key]={matrix:a,coord:t}}return{u_depth:2,u_terrain:3,u_terrain_dim:i&&i.dem&&i.dem.dim||1,u_terrain_matrix:r?this._demMatrixCache[t.key].matrix:this._emptyDemMatrix,u_terrain_unpack:i&&i.dem&&i.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(i&&i.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:i}}getFramebuffer(t){const e=this.painter,i=e.width/devicePixelRatio,r=e.height/devicePixelRatio;return!this._fbo||this._fbo.width===i&&this._fbo.height===r||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new x(e.context,{width:i,height:r,data:null},e.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(e.context.gl.NEAREST,e.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new x(e.context,{width:i,height:r,data:null},e.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(e.context.gl.NEAREST,e.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=e.context.createFramebuffer(i,r,!0,!1),this._fbo.depthAttachment.set(e.context.createRenderbuffer(e.context.gl.DEPTH_COMPONENT16,i,r))),this._fbo.colorAttachment.set("coords"===t?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const t=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const i=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let t=0,e=0;t<this._coordsTextureSize;t++)for(let r=0;r<this._coordsTextureSize;r++,e+=4)i[e+0]=255&r,i[e+1]=255&t,i[e+2]=r>>8<<4|t>>8,i[e+3]=0;const r=new e.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(i.buffer)),n=new x(t,r,t.gl.RGBA,{premultiply:!1});return n.bind(t.gl.NEAREST,t.gl.CLAMP_TO_EDGE),this._coordsTexture=n,n}pointCoordinate(t){this.painter.maybeDrawDepthAndCoords(!0);const i=new Uint8Array(4),r=this.painter.context,n=r.gl,o=Math.round(t.x*this.painter.pixelRatio/devicePixelRatio),s=Math.round(t.y*this.painter.pixelRatio/devicePixelRatio),a=Math.round(this.painter.height/devicePixelRatio);r.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),n.readPixels(o,a-s-1,1,1,n.RGBA,n.UNSIGNED_BYTE,i),r.bindFramebuffer.set(null);const l=i[0]+(i[2]>>4<<8),c=i[1]+((15&i[2])<<8),u=this.coordsIndex[255-i[3]],h=u&&this.sourceCache.getTileByID(u);if(!h)return null;const d=this._coordsTextureSize,p=(1<<h.tileID.canonical.z)*d;return new e.Z((h.tileID.canonical.x*d+l)/p+h.tileID.wrap,(h.tileID.canonical.y*d+c)/p,this.getElevation(h.tileID,l,c,d))}depthAtPoint(t){const e=new Uint8Array(4),i=this.painter.context,r=i.gl;return i.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),r.readPixels(t.x,this.painter.height/devicePixelRatio-t.y-1,1,1,r.RGBA,r.UNSIGNED_BYTE,e),i.bindFramebuffer.set(null),(e[0]/16777216+e[1]/65536+e[2]/256+e[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const t=this.painter.context,i=new e.bd,r=new e.aY,n=this.meshSize,o=e.X/n,s=n*n;for(let t=0;t<=n;t++)for(let e=0;e<=n;e++)i.emplaceBack(e*o,t*o,0);for(let t=0;t<s;t+=n+1)for(let e=0;e<n;e++)r.emplaceBack(e+t,n+e+t+1,n+e+t+2),r.emplaceBack(e+t,n+e+t+2,e+t+1);const a=i.length,l=a+2*(n+1);for(const t of[0,1])for(let r=0;r<=n;r++)for(const n of[0,1])i.emplaceBack(r*o,t*e.X,n);for(let t=0;t<2*n;t+=2)r.emplaceBack(l+t,l+t+1,l+t+3),r.emplaceBack(l+t,l+t+3,l+t+2),r.emplaceBack(a+t,a+t+3,a+t+1),r.emplaceBack(a+t,a+t+2,a+t+3);const c=i.length,u=c+2*(n+1);for(const t of[0,1])for(let r=0;r<=n;r++)for(const n of[0,1])i.emplaceBack(t*e.X,r*o,n);for(let t=0;t<2*n;t+=2)r.emplaceBack(c+t,c+t+1,c+t+3),r.emplaceBack(c+t,c+t+3,c+t+2),r.emplaceBack(u+t,u+t+3,u+t+1),r.emplaceBack(u+t,u+t+2,u+t+3);return this._mesh=new gr(t.createVertexBuffer(i,In.members),t.createIndexBuffer(r),e.a0.simpleSegment(0,0,i.length,r.length)),this._mesh}getMeshFrameDelta(t){return 2*Math.PI*e.be/Math.pow(2,t)/5}getMinTileElevationForLngLatZoom(t,e){var i;const{tileID:r}=this._getOverscaledTileIDFromLngLatZoom(t,e);return null!==(i=this.getMinMaxElevation(r).minElevation)&&void 0!==i?i:0}getMinMaxElevation(t){const e=this.getTerrainData(t).tile,i={minElevation:null,maxElevation:null};return e&&e.dem&&(i.minElevation=e.dem.min*this.exaggeration,i.maxElevation=e.dem.max*this.exaggeration),i}_getOverscaledTileIDFromLngLatZoom(t,i){const r=e.Z.fromLngLat(t.wrap()),n=(1<<i)*e.X,o=r.x*n,s=r.y*n,a=Math.floor(o/e.X),l=Math.floor(s/e.X);return{tileID:new e.S(i,0,i,a,l),mercatorX:o,mercatorY:s}}}class Pn{constructor(t,e,i){this._context=t,this._size=e,this._tileSize=i,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const t of this._objects)t.texture.destroy(),t.fbo.destroy()}_createObject(t){const e=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),i=new x(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return i.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),e.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),e.colorAttachment.set(i.texture),{id:t,fbo:e,texture:i,stamp:-1,inUse:!1}}getObjectForId(t){return this._objects[t]}useObject(t){t.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter((e=>t.id!==e)),this._recentlyUsed.push(t.id)}stampObject(t){t.stamp=++this._stamp}getOrCreateFreeObject(){for(const t of this._recentlyUsed)if(!this._objects[t].inUse)return this._objects[t];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const t=this._createObject(this._objects.length);return this._objects.push(t),t}freeObject(t){t.inUse=!1}freeAllObjects(){for(const t of this._objects)this.freeObject(t)}isFull(){return!(this._objects.length<this._size)&&!1===this._objects.some((t=>!t.inUse))}}const Ln={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class zn{constructor(t,e){this.painter=t,this.terrain=e,this.pool=new Pn(t.context,30,e.sourceCache.tileSize*e.qualityFactor)}destruct(){this.pool.destruct()}getTexture(t){return this.pool.getObjectForId(t.rtt[this._stacks.length-1].id).texture}prepareForRender(t,e){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=t._order.filter((i=>!t._layers[i].isHidden(e))),this._coordsDescendingInv={};for(const e in t.sourceCaches){this._coordsDescendingInv[e]={};const i=t.sourceCaches[e].getVisibleCoordinates();for(const t of i){const i=this.terrain.sourceCache.getTerrainCoords(t);for(const t in i)this._coordsDescendingInv[e][t]||(this._coordsDescendingInv[e][t]=[]),this._coordsDescendingInv[e][t].push(i[t])}}this._coordsDescendingInvStr={};for(const e of t._order){const i=t._layers[e],r=i.source;if(Ln[i.type]&&!this._coordsDescendingInvStr[r]){this._coordsDescendingInvStr[r]={};for(const t in this._coordsDescendingInv[r])this._coordsDescendingInvStr[r][t]=this._coordsDescendingInv[r][t].map((t=>t.key)).sort().join()}}for(const t of this._renderableTiles)for(const e in this._coordsDescendingInvStr){const i=this._coordsDescendingInvStr[e][t.tileID.key];i&&i!==t.rttCoords[e]&&(t.rtt=[])}}renderLayer(t){if(t.isHidden(this.painter.transform.zoom))return!1;const i=t.type,r=this.painter,n=this._renderableLayerIds[this._renderableLayerIds.length-1]===t.id;if(Ln[i]&&(this._prevType&&Ln[this._prevType]||this._stacks.push([]),this._prevType=i,this._stacks[this._stacks.length-1].push(t.id),!n))return!0;if(Ln[this._prevType]||Ln[i]&&n){this._prevType=i;const t=this._stacks.length-1,n=this._stacks[t]||[];for(const i of this._renderableTiles){if(this.pool.isFull()&&(mr(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(i),i.rtt[t]){const e=this.pool.getObjectForId(i.rtt[t].id);if(e.stamp===i.rtt[t].stamp){this.pool.useObject(e);continue}}const o=this.pool.getOrCreateFreeObject();this.pool.useObject(o),this.pool.stampObject(o),i.rtt[t]={id:o.id,stamp:o.stamp},r.context.bindFramebuffer.set(o.fbo.framebuffer),r.context.clear({color:e.aM.transparent,stencil:0}),r.currentStencilSource=void 0;for(let t=0;t<n.length;t++){const e=r.style._layers[n[t]],s=e.source?this._coordsDescendingInv[e.source][i.tileID.key]:[i.tileID];r.context.viewport.set([0,0,o.fbo.width,o.fbo.height]),r._renderTileClippingMasks(e,s),r.renderLayer(r,r.style.sourceCaches[e.source],e,s),e.source&&(i.rttCoords[e.source]=this._coordsDescendingInvStr[e.source][i.tileID.key])}}return mr(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),Ln[i]}return!1}}const Fn={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Dn=i,Rn={hash:!1,interactive:!0,bearingSnap:7,attributionControl:Bn,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,refreshExpiredTiles:!0,scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],zoom:0,bearing:0,pitch:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:e.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0},Un=t=>{t.touchstart=t.dragStart,t.touchmoveWindow=t.dragMove,t.touchend=t.dragEnd},On={showCompass:!0,showZoom:!0,visualizePitch:!1};class Nn{constructor(t,i,r=!1){this.mousedown=t=>{this.startMouse(e.e({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),s.mousePos(this.element,t)),s.addEventListener(window,"mousemove",this.mousemove),s.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=t=>{this.moveMouse(t,s.mousePos(this.element,t))},this.mouseup=t=>{this.mouseRotate.dragEnd(t),this.mousePitch&&this.mousePitch.dragEnd(t),this.offTemp()},this.touchstart=t=>{1!==t.targetTouches.length?this.reset():(this._startPos=this._lastPos=s.touchPos(this.element,t.targetTouches)[0],this.startTouch(t,this._startPos),s.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),s.addEventListener(window,"touchend",this.touchend))},this.touchmove=t=>{1!==t.targetTouches.length?this.reset():(this._lastPos=s.touchPos(this.element,t.targetTouches)[0],this.moveTouch(t,this._lastPos))},this.touchend=t=>{0===t.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const n=t.dragRotate._mouseRotate.getClickTolerance(),o=t.dragRotate._mousePitch.getClickTolerance();this.element=i,this.mouseRotate=Wr({clickTolerance:n,enable:!0}),this.touchRotate=(({enable:t,clickTolerance:e,bearingDegreesPerPixelMoved:i=.8})=>{const r=new qr;return new Gr({clickTolerance:e,move:(t,e)=>({bearingDelta:(e.x-t.x)*i}),moveStateManager:r,enable:t,assignEvents:Un})})({clickTolerance:n,enable:!0}),this.map=t,r&&(this.mousePitch=Xr({clickTolerance:o,enable:!0}),this.touchPitch=(({enable:t,clickTolerance:e,pitchDegreesPerPixelMoved:i=-.5})=>{const r=new qr;return new Gr({clickTolerance:e,move:(t,e)=>({pitchDelta:(e.y-t.y)*i}),moveStateManager:r,enable:t,assignEvents:Un})})({clickTolerance:o,enable:!0})),s.addEventListener(i,"mousedown",this.mousedown),s.addEventListener(i,"touchstart",this.touchstart,{passive:!1}),s.addEventListener(i,"touchcancel",this.reset)}startMouse(t,e){this.mouseRotate.dragStart(t,e),this.mousePitch&&this.mousePitch.dragStart(t,e),s.disableDrag()}startTouch(t,e){this.touchRotate.dragStart(t,e),this.touchPitch&&this.touchPitch.dragStart(t,e),s.disableDrag()}moveMouse(t,e){const i=this.map,{bearingDelta:r}=this.mouseRotate.dragMove(t,e)||{};if(r&&i.setBearing(i.getBearing()+r),this.mousePitch){const{pitchDelta:r}=this.mousePitch.dragMove(t,e)||{};r&&i.setPitch(i.getPitch()+r)}}moveTouch(t,e){const i=this.map,{bearingDelta:r}=this.touchRotate.dragMove(t,e)||{};if(r&&i.setBearing(i.getBearing()+r),this.touchPitch){const{pitchDelta:r}=this.touchPitch.dragMove(t,e)||{};r&&i.setPitch(i.getPitch()+r)}}off(){const t=this.element;s.removeEventListener(t,"mousedown",this.mousedown),s.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),s.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),s.removeEventListener(window,"touchend",this.touchend),s.removeEventListener(t,"touchcancel",this.reset),this.offTemp()}offTemp(){s.enableDrag(),s.removeEventListener(window,"mousemove",this.mousemove),s.removeEventListener(window,"mouseup",this.mouseup),s.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),s.removeEventListener(window,"touchend",this.touchend)}}let Qn;function Vn(t,i,r){const n=new e.N(t.lng,t.lat);if(t=new e.N(t.lng,t.lat),i){const n=new e.N(t.lng-360,t.lat),o=new e.N(t.lng+360,t.lat),s=r.locationPoint(t).distSqr(i);r.locationPoint(n).distSqr(i)<s?t=n:r.locationPoint(o).distSqr(i)<s&&(t=o)}for(;Math.abs(t.lng-r.center.lng)>180;){const e=r.locationPoint(t);if(e.x>=0&&e.y>=0&&e.x<=r.width&&e.y<=r.height)break;t.lng>r.center.lng?t.lng-=360:t.lng+=360}return t.lng!==n.lng&&r.locationPoint(t).y>r.height/2-r.getHorizon()?t:n}const jn={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Hn(t,e,i){const r=t.classList;for(const t in jn)r.remove(`maplibregl-${i}-anchor-${t}`);r.add(`maplibregl-${i}-anchor-${e}`)}class Gn extends e.E{constructor(t){if(super(),this._onKeyPress=t=>{const e=t.code,i=t.charCode||t.keyCode;"Space"!==e&&"Enter"!==e&&32!==i&&13!==i||this.togglePopup()},this._onMapClick=t=>{const e=t.originalEvent.target,i=this._element;this._popup&&(e===i||i.contains(e))&&this.togglePopup()},this._update=t=>{var e;if(!this._map)return;const i=this._map.loaded()&&!this._map.isMoving();("terrain"===(null==t?void 0:t.type)||"render"===(null==t?void 0:t.type)&&!i)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?Vn(this._lngLat,this._flatPos,this._map.transform):null===(e=this._lngLat)||void 0===e?void 0:e.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let r="";"viewport"===this._rotationAlignment||"auto"===this._rotationAlignment?r=`rotateZ(${this._rotation}deg)`:"map"===this._rotationAlignment&&(r=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let n="";"viewport"===this._pitchAlignment||"auto"===this._pitchAlignment?n="rotateX(0deg)":"map"===this._pitchAlignment&&(n=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||t&&"moveend"!==t.type||(this._pos=this._pos.round()),s.setTransform(this._element,`${jn[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${n} ${r}`),o.frameAsync(new AbortController).then((()=>{this._updateOpacity(t&&"moveend"===t.type)})).catch((()=>{}))},this._onMove=t=>{if(!this._isDragging){const e=this._clickTolerance||this._map._clickTolerance;this._isDragging=t.point.dist(this._pointerdownPos)>=e}this._isDragging&&(this._pos=t.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new e.k("dragstart"))),this.fire(new e.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),"active"===this._state&&this.fire(new e.k("dragend")),this._state="inactive"},this._addDragHandler=t=>{this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(this._pos).add(this._offset),this._pointerdownPos=t.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._subpixelPositioning=t&&t.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&"auto"!==t.pitchAlignment?t.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(null==t?void 0:t.opacity,null==t?void 0:t.opacityWhenCovered),t&&t.element)this._element=t.element,this._offset=e.P.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=s.create("div");const i=s.createNS("http://www.w3.org/2000/svg","svg"),r=41,n=27;i.setAttributeNS(null,"display","block"),i.setAttributeNS(null,"height",`${r}px`),i.setAttributeNS(null,"width",`${n}px`),i.setAttributeNS(null,"viewBox",`0 0 ${n} ${r}`);const o=s.createNS("http://www.w3.org/2000/svg","g");o.setAttributeNS(null,"stroke","none"),o.setAttributeNS(null,"stroke-width","1"),o.setAttributeNS(null,"fill","none"),o.setAttributeNS(null,"fill-rule","evenodd");const a=s.createNS("http://www.w3.org/2000/svg","g");a.setAttributeNS(null,"fill-rule","nonzero");const l=s.createNS("http://www.w3.org/2000/svg","g");l.setAttributeNS(null,"transform","translate(3.0, 29.0)"),l.setAttributeNS(null,"fill","#000000");const c=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const t of c){const e=s.createNS("http://www.w3.org/2000/svg","ellipse");e.setAttributeNS(null,"opacity","0.04"),e.setAttributeNS(null,"cx","10.5"),e.setAttributeNS(null,"cy","5.80029008"),e.setAttributeNS(null,"rx",t.rx),e.setAttributeNS(null,"ry",t.ry),l.appendChild(e)}const u=s.createNS("http://www.w3.org/2000/svg","g");u.setAttributeNS(null,"fill",this._color);const h=s.createNS("http://www.w3.org/2000/svg","path");h.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),u.appendChild(h);const d=s.createNS("http://www.w3.org/2000/svg","g");d.setAttributeNS(null,"opacity","0.25"),d.setAttributeNS(null,"fill","#000000");const p=s.createNS("http://www.w3.org/2000/svg","path");p.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),d.appendChild(p);const f=s.createNS("http://www.w3.org/2000/svg","g");f.setAttributeNS(null,"transform","translate(6.0, 7.0)"),f.setAttributeNS(null,"fill","#FFFFFF");const A=s.createNS("http://www.w3.org/2000/svg","g");A.setAttributeNS(null,"transform","translate(8.0, 8.0)");const m=s.createNS("http://www.w3.org/2000/svg","circle");m.setAttributeNS(null,"fill","#000000"),m.setAttributeNS(null,"opacity","0.25"),m.setAttributeNS(null,"cx","5.5"),m.setAttributeNS(null,"cy","5.5"),m.setAttributeNS(null,"r","5.4999962");const g=s.createNS("http://www.w3.org/2000/svg","circle");g.setAttributeNS(null,"fill","#FFFFFF"),g.setAttributeNS(null,"cx","5.5"),g.setAttributeNS(null,"cy","5.5"),g.setAttributeNS(null,"r","5.4999962"),A.appendChild(m),A.appendChild(g),a.appendChild(l),a.appendChild(u),a.appendChild(d),a.appendChild(f),a.appendChild(A),i.appendChild(a),i.setAttributeNS(null,"height",r*this._scale+"px"),i.setAttributeNS(null,"width",n*this._scale+"px"),this._element.appendChild(i),this._offset=e.P.convert(t&&t.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",(t=>{t.preventDefault()})),this._element.addEventListener("mousedown",(t=>{t.preventDefault()})),Hn(this._element,this._anchor,"marker"),t&&t.className)for(const e of t.className.split(" "))this._element.classList.add(e);this._popup=null}addTo(t){return this.remove(),this._map=t,this._element.setAttribute("aria-label",t._getUIString("Marker.Title")),t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),t.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),s.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=e.N.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const e=38.1,i=13.5,r=Math.abs(i)/Math.SQRT2;t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-e],"bottom-left":[r,-1*(e-i+r)],"bottom-right":[-r,-1*(e-i+r)],left:[i,-1*(e-i)],right:[-i,-1*(e-i)]}:this._offset}this._popup=t,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(t){return this._subpixelPositioning=t,this}getPopup(){return this._popup}togglePopup(){const t=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:t?(t.isOpen()?t.remove():(t.setLngLat(this._lngLat),t.addTo(this._map)),this):this}_updateOpacity(t=!1){var i,r;if(!(null===(i=this._map)||void 0===i?void 0:i.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(t)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout((()=>{this._opacityTimeout=null}),100)}const n=this._map,o=n.terrain.depthAtPoint(this._pos),s=n.terrain.getElevationForLngLatZoom(this._lngLat,n.transform.tileZoom);if(n.transform.lngLatToCameraDepth(this._lngLat,s)-o<.006)return void(this._element.style.opacity=this._opacity);const a=-this._offset.y/n.transform._pixelPerMeter,l=Math.sin(n.getPitch()*Math.PI/180)*a,c=n.terrain.depthAtPoint(new e.P(this._pos.x,this._pos.y-this._offset.y)),u=n.transform.lngLatToCameraDepth(this._lngLat,s+l)-c>.006;(null===(r=this._popup)||void 0===r?void 0:r.isOpen())&&u&&this._popup.remove(),this._element.style.opacity=u?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(t){return this._offset=e.P.convert(t),this._update(),this}addClassName(t){this._element.classList.add(t)}removeClassName(t){this._element.classList.remove(t)}toggleClassName(t){return this._element.classList.toggle(t)}setDraggable(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t&&"auto"!==t?t:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(t,e){return void 0===t&&void 0===e&&(this._opacity="1",this._opacityWhenCovered="0.2"),void 0!==t&&(this._opacity=t),void 0!==e&&(this._opacityWhenCovered=e),this._map&&this._updateOpacity(!0),this}}const $n={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Zn=0,qn=!1;const Kn={maxWidth:100,unit:"metric"};function Wn(t,e,i){const r=i&&i.maxWidth||100,n=t._container.clientHeight/2,o=t.unproject([0,n]),s=t.unproject([r,n]),a=o.distanceTo(s);if(i&&"imperial"===i.unit){const i=3.2808*a;i>5280?Xn(e,r,i/5280,t._getUIString("ScaleControl.Miles")):Xn(e,r,i,t._getUIString("ScaleControl.Feet"))}else i&&"nautical"===i.unit?Xn(e,r,a/1852,t._getUIString("ScaleControl.NauticalMiles")):a>=1e3?Xn(e,r,a/1e3,t._getUIString("ScaleControl.Kilometers")):Xn(e,r,a,t._getUIString("ScaleControl.Meters"))}function Xn(t,e,i,r){const n=function(t){const e=Math.pow(10,`${Math.floor(t)}`.length-1);let i=t/e;return i=i>=10?10:i>=5?5:i>=3?3:i>=2?2:i>=1?1:function(t){const e=Math.pow(10,Math.ceil(-Math.log(t)/Math.LN10));return Math.round(t*e)/e}(i),e*i}(i);t.style.width=e*(n/i)+"px",t.innerHTML=`${n}&nbsp;${r}`}const Jn={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},Yn=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function to(t){if(t){if("number"==typeof t){const i=Math.round(Math.abs(t)/Math.SQRT2);return{center:new e.P(0,0),top:new e.P(0,t),"top-left":new e.P(i,i),"top-right":new e.P(-i,i),bottom:new e.P(0,-t),"bottom-left":new e.P(i,-i),"bottom-right":new e.P(-i,-i),left:new e.P(t,0),right:new e.P(-t,0)}}if(t instanceof e.P||Array.isArray(t)){const i=e.P.convert(t);return{center:i,top:i,"top-left":i,"top-right":i,bottom:i,"bottom-left":i,"bottom-right":i,left:i,right:i}}return{center:e.P.convert(t.center||[0,0]),top:e.P.convert(t.top||[0,0]),"top-left":e.P.convert(t["top-left"]||[0,0]),"top-right":e.P.convert(t["top-right"]||[0,0]),bottom:e.P.convert(t.bottom||[0,0]),"bottom-left":e.P.convert(t["bottom-left"]||[0,0]),"bottom-right":e.P.convert(t["bottom-right"]||[0,0]),left:e.P.convert(t.left||[0,0]),right:e.P.convert(t.right||[0,0])}}return to(new e.P(0,0))}const eo=i;t.AJAXError=e.bh,t.Evented=e.E,t.LngLat=e.N,t.MercatorCoordinate=e.Z,t.Point=e.P,t.addProtocol=e.bi,t.config=e.a,t.removeProtocol=e.bj,t.AttributionControl=En,t.BoxZoomHandler=Nr,t.CanvasSource=et,t.CooperativeGesturesHandler=yn,t.DoubleClickZoomHandler=pn,t.DragPanHandler=mn,t.DragRotateHandler=gn,t.EdgeInsets=xr,t.FullscreenControl=class extends e.E{constructor(t={}){super(),this._onFullscreenChange=()=>{var t;let e=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;null===(t=null==e?void 0:e.shadowRoot)||void 0===t?void 0:t.fullscreenElement;)e=e.shadowRoot.fullscreenElement;e===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,t&&t.container&&(t.container instanceof HTMLElement?this._container=t.container:e.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(t){return this._map=t,this._container||(this._container=this._map.getContainer()),this._controlContainer=s.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){s.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const t=this._fullscreenButton=s.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);s.create("span","maplibregl-ctrl-icon",t).setAttribute("aria-hidden","true"),t.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const t=this._getTitle();this._fullscreenButton.setAttribute("aria-label",t),this._fullscreenButton.title=t}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new e.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new e.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},t.GeoJSONSource=X,t.GeolocateControl=class extends e.E{constructor(t){super(),this._onSuccess=t=>{if(this._map){if(this._isOutOfMapMaxBounds(t))return this._setErrorState(),this.fire(new e.k("outofmaxbounds",t)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(t),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(t),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new e.k("geolocate",t)),this._finish()}},this._updateCamera=t=>{const i=new e.N(t.coords.longitude,t.coords.latitude),r=t.coords.accuracy,n=this._map.getBearing(),o=e.e({bearing:n},this.options.fitBoundsOptions),s=$.fromLngLat(i,r);this._map.fitBounds(s,o,{geolocateSource:!0})},this._updateMarker=t=>{if(t){const i=new e.N(t.coords.longitude,t.coords.latitude);this._accuracyCircleMarker.setLngLat(i).addTo(this._map),this._userLocationDotMarker.setLngLat(i).addTo(this._map),this._accuracy=t.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=t=>{if(this._map){if(this.options.trackUserLocation)if(1===t.code){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=t,this._geolocateButton.setAttribute("aria-label",t),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===t.code&&qn)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new e.k("error",t)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",(t=>t.preventDefault())),this._geolocateButton=s.create("button","maplibregl-ctrl-geolocate",this._container),s.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=t=>{if(this._map){if(!1===t){e.w("Geolocation support is not available so the GeolocateControl will be disabled.");const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=t,this._geolocateButton.setAttribute("aria-label",t)}else{const t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=t,this._geolocateButton.setAttribute("aria-label",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=s.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Gn({element:this._dotElement}),this._circleElement=s.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Gn({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",(()=>this.trigger())),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(t=>{t.geolocateSource||"ACTIVE_LOCK"!==this._watchState||t.originalEvent&&"resize"===t.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new e.k("trackuserlocationend")),this.fire(new e.k("userlocationlostfocus")))}))}},this.options=e.e({},$n,t)}onAdd(t){return this._map=t,this._container=s.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),function(){return e._(this,arguments,void 0,(function*(t=!1){if(void 0!==Qn&&!t)return Qn;if(void 0===window.navigator.permissions)return Qn=!!window.navigator.geolocation,Qn;try{const t=yield window.navigator.permissions.query({name:"geolocation"});Qn="denied"!==t.state}catch(t){Qn=!!window.navigator.geolocation}return Qn}))}().then((t=>this._finishSetupUI(t))),this._container}onRemove(){void 0!==this._geolocationWatchID&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),s.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Zn=0,qn=!1}_isOutOfMapMaxBounds(t){const e=this._map.getMaxBounds(),i=t.coords;return e&&(i.longitude<e.getWest()||i.longitude>e.getEast()||i.latitude<e.getSouth()||i.latitude>e.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const t=this._map.getBounds(),e=t.getSouthEast(),i=t.getNorthEast(),r=e.distanceTo(i),n=Math.ceil(this._accuracy/(r/this._map._container.clientHeight)*2);this._circleElement.style.width=`${n}px`,this._circleElement.style.height=`${n}px`}trigger(){if(!this._setup)return e.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new e.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Zn--,qn=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new e.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new e.k("trackuserlocationstart")),this.fire(new e.k("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let t;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Zn++,Zn>1?(t={maximumAge:6e5,timeout:0},qn=!0):(t=this.options.positionOptions,qn=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,t)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},t.Hash=Br,t.ImageSource=Y,t.KeyboardHandler=cn,t.LngLatBounds=$,t.LogoControl=Cn,t.Map=class extends Tn{constructor(t){e.bf.mark(e.bg.create);const i=Object.assign(Object.assign({},Rn),t);if(null!=i.minZoom&&null!=i.maxZoom&&i.minZoom>i.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=i.minPitch&&null!=i.maxPitch&&i.minPitch>i.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=i.minPitch&&i.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=i.maxPitch&&i.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new wr(i.minZoom,i.maxZoom,i.minPitch,i.maxPitch,i.renderWorldCopies),{bearingSnap:i.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new Sn,this._controls=[],this._mapId=e.a4(),this._contextLost=t=>{t.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new e.k("webglcontextlost",{originalEvent:t}))},this._contextRestored=t=>{this._setupPainter(),this.resize(),this._update(),this.fire(new e.k("webglcontextrestored",{originalEvent:t}))},this._onMapScroll=t=>{if(t.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=i.interactive,this._maxTileCacheSize=i.maxTileCacheSize,this._maxTileCacheZoomLevels=i.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=!0===i.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=!0===i.preserveDrawingBuffer,this._antialias=!0===i.antialias,this._trackResize=!0===i.trackResize,this._bearingSnap=i.bearingSnap,this._refreshExpiredTiles=!0===i.refreshExpiredTiles,this._fadeDuration=i.fadeDuration,this._crossSourceCollisions=!0===i.crossSourceCollisions,this._collectResourceTiming=!0===i.collectResourceTiming,this._locale=Object.assign(Object.assign({},Fn),i.locale),this._clickTolerance=i.clickTolerance,this._overridePixelRatio=i.pixelRatio,this._maxCanvasSize=i.maxCanvasSize,this.transformCameraUpdate=i.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=!0===i.cancelPendingTileRequestsWhileZooming,this._imageQueueHandle=p.addThrottleControl((()=>this.isMoving())),this._requestManager=new f(i.transformRequest),"string"==typeof i.container){if(this._container=document.getElementById(i.container),!this._container)throw new Error(`Container '${i.container}' not found.`)}else{if(!(i.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=i.container}if(i.maxBounds&&this.setMaxBounds(i.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",(()=>this._update(!1))).on("moveend",(()=>this._update(!1))).on("zoom",(()=>this._update(!0))).on("terrain",(()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)})).once("idle",(()=>{this._idleTriggered=!0})),"undefined"!=typeof window){addEventListener("online",this._onWindowOnline,!1);let t=!1;const e=Tr((t=>{this._trackResize&&!this._removed&&(this.resize(t),this.redraw())}),50);this._resizeObserver=new ResizeObserver((i=>{t?e(i):t=!0})),this._resizeObserver.observe(this._container)}this.handlers=new wn(this,i),this._hash=i.hash&&new Br("string"==typeof i.hash&&i.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:i.center,zoom:i.zoom,bearing:i.bearing,pitch:i.pitch}),i.bounds&&(this.resize(),this.fitBounds(i.bounds,e.e({},i.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=i.localIdeographFontFamily,this._validateStyle=i.validateStyle,i.style&&this.setStyle(i.style,{localIdeographFontFamily:i.localIdeographFontFamily}),i.attributionControl&&this.addControl(new En("boolean"==typeof i.attributionControl?void 0:i.attributionControl)),i.maplibreLogo&&this.addControl(new Cn,i.logoPosition),this.on("style.load",(()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)})),this.on("data",(t=>{this._update("style"===t.dataType),this.fire(new e.k(`${t.dataType}data`,t))})),this.on("dataloading",(t=>{this.fire(new e.k(`${t.dataType}dataloading`,t))})),this.on("dataabort",(t=>{this.fire(new e.k("sourcedataabort",t))}))}_getMapId(){return this._mapId}addControl(t,i){if(void 0===i&&(i=t.getDefaultPosition?t.getDefaultPosition():"top-right"),!t||!t.onAdd)return this.fire(new e.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const r=t.onAdd(this);this._controls.push(t);const n=this._controlPositions[i];return-1!==i.indexOf("bottom")?n.insertBefore(r,n.firstChild):n.appendChild(r),this}removeControl(t){if(!t||!t.onRemove)return this.fire(new e.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const i=this._controls.indexOf(t);return i>-1&&this._controls.splice(i,1),t.onRemove(this),this}hasControl(t){return this._controls.indexOf(t)>-1}calculateCameraOptionsFromTo(t,e,i,r){return null==r&&this.terrain&&(r=this.terrain.getElevationForLngLatZoom(i,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(t,e,i,r)}resize(t){var i;const r=this._containerDimensions(),n=r[0],o=r[1],s=this._getClampedPixelRatio(n,o);if(this._resizeCanvas(n,o,s),this.painter.resize(n,o,s),this.painter.overLimit()){const t=this.painter.context.gl;this._maxCanvasSize=[t.drawingBufferWidth,t.drawingBufferHeight];const e=this._getClampedPixelRatio(n,o);this._resizeCanvas(n,o,e),this.painter.resize(n,o,e)}this.transform.resize(n,o),null===(i=this._requestedCameraState)||void 0===i||i.resize(n,o);const a=!this._moving;return a&&(this.stop(),this.fire(new e.k("movestart",t)).fire(new e.k("move",t))),this.fire(new e.k("resize",t)),a&&this.fire(new e.k("moveend",t)),this}_getClampedPixelRatio(t,e){const{0:i,1:r}=this._maxCanvasSize,n=this.getPixelRatio(),o=t*n,s=e*n;return Math.min(o>i?i/o:1,s>r?r/s:1)*n}getPixelRatio(){var t;return null!==(t=this._overridePixelRatio)&&void 0!==t?t:devicePixelRatio}setPixelRatio(t){this._overridePixelRatio=t,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(t){return this.transform.setMaxBounds($.convert(t)),this._update()}setMinZoom(t){if((t=null==t?-2:t)>=-2&&t<=this.transform.maxZoom)return this.transform.minZoom=t,this._update(),this.getZoom()<t&&this.setZoom(t),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(t){if((t=null==t?22:t)>=this.transform.minZoom)return this.transform.maxZoom=t,this._update(),this.getZoom()>t&&this.setZoom(t),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(t){if((t=null==t?0:t)<0)throw new Error("minPitch must be greater than or equal to 0");if(t>=0&&t<=this.transform.maxPitch)return this.transform.minPitch=t,this._update(),this.getPitch()<t&&this.setPitch(t),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(t){if((t=null==t?60:t)>85)throw new Error("maxPitch must be less than or equal to 85");if(t>=this.transform.minPitch)return this.transform.maxPitch=t,this._update(),this.getPitch()>t&&this.setPitch(t),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(t){return this.transform.renderWorldCopies=t,this._update()}project(t){return this.transform.locationPoint(e.N.convert(t),this.style&&this.terrain)}unproject(t){return this.transform.pointLocation(e.P.convert(t),this.terrain)}isMoving(){var t;return this._moving||(null===(t=this.handlers)||void 0===t?void 0:t.isMoving())}isZooming(){var t;return this._zooming||(null===(t=this.handlers)||void 0===t?void 0:t.isZooming())}isRotating(){var t;return this._rotating||(null===(t=this.handlers)||void 0===t?void 0:t.isRotating())}_createDelegatedListener(t,e,i){if("mouseenter"===t||"mouseover"===t){let r=!1;const n=n=>{const o=e.filter((t=>this.getLayer(t))),s=0!==o.length?this.queryRenderedFeatures(n.point,{layers:o}):[];s.length?r||(r=!0,i.call(this,new zr(t,this,n.originalEvent,{features:s}))):r=!1};return{layers:e,listener:i,delegates:{mousemove:n,mouseout:()=>{r=!1}}}}if("mouseleave"===t||"mouseout"===t){let r=!1;const n=n=>{const o=e.filter((t=>this.getLayer(t)));(0!==o.length?this.queryRenderedFeatures(n.point,{layers:o}):[]).length?r=!0:r&&(r=!1,i.call(this,new zr(t,this,n.originalEvent)))},o=e=>{r&&(r=!1,i.call(this,new zr(t,this,e.originalEvent)))};return{layers:e,listener:i,delegates:{mousemove:n,mouseout:o}}}{const r=t=>{const r=e.filter((t=>this.getLayer(t))),n=0!==r.length?this.queryRenderedFeatures(t.point,{layers:r}):[];n.length&&(t.features=n,i.call(this,t),delete t.features)};return{layers:e,listener:i,delegates:{[t]:r}}}}_saveDelegatedListener(t,e){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[t]=this._delegatedListeners[t]||[],this._delegatedListeners[t].push(e)}_removeDelegatedListener(t,e,i){if(!this._delegatedListeners||!this._delegatedListeners[t])return;const r=this._delegatedListeners[t];for(let t=0;t<r.length;t++){const n=r[t];if(n.listener===i&&n.layers.length===e.length&&n.layers.every((t=>e.includes(t)))){for(const t in n.delegates)this.off(t,n.delegates[t]);return void r.splice(t,1)}}}on(t,e,i){if(void 0===i)return super.on(t,e);const r=this._createDelegatedListener(t,"string"==typeof e?[e]:e,i);this._saveDelegatedListener(t,r);for(const t in r.delegates)this.on(t,r.delegates[t]);return this}once(t,e,i){if(void 0===i)return super.once(t,e);const r="string"==typeof e?[e]:e,n=this._createDelegatedListener(t,r,i);for(const e in n.delegates){const o=n.delegates[e];n.delegates[e]=(...e)=>{this._removeDelegatedListener(t,r,i),o(...e)}}this._saveDelegatedListener(t,n);for(const t in n.delegates)this.once(t,n.delegates[t]);return this}off(t,e,i){return void 0===i?super.off(t,e):(this._removeDelegatedListener(t,"string"==typeof e?[e]:e,i),this)}queryRenderedFeatures(t,i){if(!this.style)return[];let r;const n=t instanceof e.P||Array.isArray(t),o=n?t:[[0,0],[this.transform.width,this.transform.height]];if(i=i||(n?{}:t)||{},o instanceof e.P||"number"==typeof o[0])r=[e.P.convert(o)];else{const t=e.P.convert(o[0]),i=e.P.convert(o[1]);r=[t,new e.P(i.x,t.y),i,new e.P(t.x,i.y),t]}return this.style.queryRenderedFeatures(r,i,this.transform)}querySourceFeatures(t,e){return this.style.querySourceFeatures(t,e)}setStyle(t,i){return!1!==(i=e.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},i)).diff&&i.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&t?(this._diffStyle(t,i),this):(this._localIdeographFontFamily=i.localIdeographFontFamily,this._updateStyle(t,i))}setTransformRequest(t){return this._requestManager.setTransformRequest(t),this}_getUIString(t){const e=this._locale[t];if(null==e)throw new Error(`Missing UI string '${t}'`);return e}_updateStyle(t,e){if(e.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",(()=>this._updateStyle(t,e)));const i=this.style&&e.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!t)),t?(this.style=new de(this,e||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof t?this.style.loadURL(t,e,i):this.style.loadJSON(t,e,i),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new de(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(t,i){if("string"==typeof t){const r=this._requestManager.transformRequest(t,"Style");e.h(r,new AbortController).then((t=>{this._updateDiff(t.data,i)})).catch((t=>{t&&this.fire(new e.j(t))}))}else"object"==typeof t&&this._updateDiff(t,i)}_updateDiff(t,i){try{this.style.setState(t,i)&&this._update(!0)}catch(r){e.w(`Unable to perform style diff: ${r.message||r.error||r}.  Rebuilding the style from scratch.`),this._updateStyle(t,i)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():e.w("There is no style added to the map.")}addSource(t,e){return this._lazyInitEmptyStyle(),this.style.addSource(t,e),this._update(!0)}isSourceLoaded(t){const i=this.style&&this.style.sourceCaches[t];if(void 0!==i)return i.loaded();this.fire(new e.j(new Error(`There is no source with ID '${t}'`)))}setTerrain(t){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),t){const i=this.style.sourceCaches[t.source];if(!i)throw new Error(`cannot load terrain, because there exists no source with ID: ${t.source}`);null===this.terrain&&i.reload();for(const i in this.style._layers){const r=this.style._layers[i];"hillshade"===r.type&&r.source===t.source&&e.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new kn(this.painter,i,t),this.painter.renderToTexture=new zn(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=e=>{"style"===e.dataType?this.terrain.sourceCache.freeRtt():"source"===e.dataType&&e.tile&&(e.sourceId!==t.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(e.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new e.k("terrain",{terrain:t})),this}getTerrain(){var t,e;return null!==(e=null===(t=this.terrain)||void 0===t?void 0:t.options)&&void 0!==e?e:null}areTilesLoaded(){const t=this.style&&this.style.sourceCaches;for(const e in t){const i=t[e]._tiles;for(const t in i){const e=i[t];if("loaded"!==e.state&&"errored"!==e.state)return!1}}return!0}removeSource(t){return this.style.removeSource(t),this._update(!0)}getSource(t){return this.style.getSource(t)}addImage(t,i,r={}){const{pixelRatio:n=1,sdf:s=!1,stretchX:a,stretchY:l,content:c,textFitWidth:u,textFitHeight:h}=r;if(this._lazyInitEmptyStyle(),!(i instanceof HTMLImageElement||e.b(i))){if(void 0===i.width||void 0===i.height)return this.fire(new e.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:r,height:o,data:d}=i,p=i;return this.style.addImage(t,{data:new e.R({width:r,height:o},new Uint8Array(d)),pixelRatio:n,stretchX:a,stretchY:l,content:c,textFitWidth:u,textFitHeight:h,sdf:s,version:0,userImage:p}),p.onAdd&&p.onAdd(this,t),this}}{const{width:r,height:d,data:p}=o.getImageData(i);this.style.addImage(t,{data:new e.R({width:r,height:d},p),pixelRatio:n,stretchX:a,stretchY:l,content:c,textFitWidth:u,textFitHeight:h,sdf:s,version:0})}}updateImage(t,i){const r=this.style.getImage(t);if(!r)return this.fire(new e.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const n=i instanceof HTMLImageElement||e.b(i)?o.getImageData(i):i,{width:s,height:a,data:l}=n;if(void 0===s||void 0===a)return this.fire(new e.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(s!==r.data.width||a!==r.data.height)return this.fire(new e.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const c=!(i instanceof HTMLImageElement||e.b(i));return r.data.replace(l,c),this.style.updateImage(t,r),this}getImage(t){return this.style.getImage(t)}hasImage(t){return t?!!this.style.getImage(t):(this.fire(new e.j(new Error("Missing required image id"))),!1)}removeImage(t){this.style.removeImage(t)}loadImage(t){return p.getImage(this._requestManager.transformRequest(t,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(t,e){return this._lazyInitEmptyStyle(),this.style.addLayer(t,e),this._update(!0)}moveLayer(t,e){return this.style.moveLayer(t,e),this._update(!0)}removeLayer(t){return this.style.removeLayer(t),this._update(!0)}getLayer(t){return this.style.getLayer(t)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(t,e,i){return this.style.setLayerZoomRange(t,e,i),this._update(!0)}setFilter(t,e,i={}){return this.style.setFilter(t,e,i),this._update(!0)}getFilter(t){return this.style.getFilter(t)}setPaintProperty(t,e,i,r={}){return this.style.setPaintProperty(t,e,i,r),this._update(!0)}getPaintProperty(t,e){return this.style.getPaintProperty(t,e)}setLayoutProperty(t,e,i,r={}){return this.style.setLayoutProperty(t,e,i,r),this._update(!0)}getLayoutProperty(t,e){return this.style.getLayoutProperty(t,e)}setGlyphs(t,e={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(t,e),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(t,e,i={}){return this._lazyInitEmptyStyle(),this.style.addSprite(t,e,i,(t=>{t||this._update(!0)})),this}removeSprite(t){return this._lazyInitEmptyStyle(),this.style.removeSprite(t),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(t,e={}){return this._lazyInitEmptyStyle(),this.style.setSprite(t,e,(t=>{t||this._update(!0)})),this}setLight(t,e={}){return this._lazyInitEmptyStyle(),this.style.setLight(t,e),this._update(!0)}getLight(){return this.style.getLight()}setSky(t){return this._lazyInitEmptyStyle(),this.style.setSky(t),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(t,e){return this.style.setFeatureState(t,e),this._update()}removeFeatureState(t,e){return this.style.removeFeatureState(t,e),this._update()}getFeatureState(t){return this.style.getFeatureState(t)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let t=0,e=0;return this._container&&(t=this._container.clientWidth||400,e=this._container.clientHeight||300),[t,e]}_setupContainer(){const t=this._container;t.classList.add("maplibregl-map");const e=this._canvasContainer=s.create("div","maplibregl-canvas-container",t);this._interactive&&e.classList.add("maplibregl-interactive"),this._canvas=s.create("canvas","maplibregl-canvas",e),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const i=this._containerDimensions(),r=this._getClampedPixelRatio(i[0],i[1]);this._resizeCanvas(i[0],i[1],r);const n=this._controlContainer=s.create("div","maplibregl-control-container",t),o=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((t=>{o[t]=s.create("div",`maplibregl-ctrl-${t} `,n)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(t,e,i){this._canvas.width=Math.floor(i*t),this._canvas.height=Math.floor(i*e),this._canvas.style.width=`${t}px`,this._canvas.style.height=`${e}px`}_setupPainter(){const t={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let e=null;this._canvas.addEventListener("webglcontextcreationerror",(i=>{e={requestedAttributes:t},i&&(e.statusMessage=i.statusMessage,e.type=i.type)}),{once:!0});const i=this._canvas.getContext("webgl2",t)||this._canvas.getContext("webgl",t);if(!i){const t="Failed to initialize WebGL";throw e?(e.message=t,new Error(JSON.stringify(e))):new Error(t)}this.painter=new _r(i,this.transform),a.testSupport(i)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(t){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||t,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(t){return this._update(),this._renderTaskQueue.add(t)}_cancelRenderFrame(t){this._renderTaskQueue.remove(t)}_render(t){const i=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(t),this._removed)return;let r=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const t=this.transform.zoom,n=o.now();this.style.zoomHistory.update(t,n);const s=new e.z(t,{now:n,fadeDuration:i,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),a=s.crossFadingFactor();1===a&&a===this._crossFadingFactor||(r=!0,this._crossFadingFactor=a),this.style.update(s)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,i,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:i,showPadding:this.showPadding}),this.fire(new e.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,e.bf.mark(e.bg.load),this.fire(new e.k("load"))),this.style&&(this.style.hasTransitions()||r)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const n=this._sourcesDirty||this._styleDirty||this._placementDirty;return n||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new e.k("idle")),!this._loaded||this._fullyLoaded||n||(this._fullyLoaded=!0,e.bf.mark(e.bg.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var t;this._hash&&this._hash.remove();for(const t of this._controls)t.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),"undefined"!=typeof window&&removeEventListener("online",this._onWindowOnline,!1),p.removeThrottleControl(this._imageQueueHandle),null===(t=this._resizeObserver)||void 0===t||t.disconnect();const i=this.painter.context.gl.getExtension("WEBGL_lose_context");(null==i?void 0:i.loseContext)&&i.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),s.remove(this._canvasContainer),s.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),e.bf.clearMetrics(),this._removed=!0,this.fire(new e.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,o.frameAsync(this._frameRequest).then((t=>{e.bf.frame(t),this._frameRequest=null,this._render(t)})).catch((()=>{})))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(t){this._showTileBoundaries!==t&&(this._showTileBoundaries=t,this._update())}get showPadding(){return!!this._showPadding}set showPadding(t){this._showPadding!==t&&(this._showPadding=t,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(t){this._showCollisionBoxes!==t&&(this._showCollisionBoxes=t,t?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(t){this._showOverdrawInspector!==t&&(this._showOverdrawInspector=t,this._update())}get repaint(){return!!this._repaint}set repaint(t){this._repaint!==t&&(this._repaint=t,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(t){this._vertices=t,this._update()}get version(){return Dn}getCameraTargetElevation(){return this.transform.elevation}},t.MapMouseEvent=zr,t.MapTouchEvent=Fr,t.MapWheelEvent=Dr,t.Marker=Gn,t.NavigationControl=class{constructor(t){this._updateZoomButtons=()=>{const t=this._map.getZoom(),e=t===this._map.getMaxZoom(),i=t===this._map.getMinZoom();this._zoomInButton.disabled=e,this._zoomOutButton.disabled=i,this._zoomInButton.setAttribute("aria-disabled",e.toString()),this._zoomOutButton.setAttribute("aria-disabled",i.toString())},this._rotateCompassArrow=()=>{const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=t},this._setButtonTitle=(t,e)=>{const i=this._map._getUIString(`NavigationControl.${e}`);t.title=i,t.setAttribute("aria-label",i)},this.options=e.e({},On,t),this._container=s.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",(t=>t.preventDefault())),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",(t=>this._map.zoomIn({},{originalEvent:t}))),s.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",(t=>this._map.zoomOut({},{originalEvent:t}))),s.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",(t=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:t}):this._map.resetNorth({},{originalEvent:t})})),this._compassIcon=s.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(t){return this._map=t,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Nn(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){s.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(t,e){const i=s.create("button",t,this._container);return i.type="button",i.addEventListener("click",e),i}},t.Popup=class extends e.E{constructor(t){super(),this.remove=()=>(this._content&&s.remove(this._content),this._container&&(s.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new e.k("close"))),this),this._onMouseUp=t=>{this._update(t.point)},this._onMouseMove=t=>{this._update(t.point)},this._onDrag=t=>{this._update(t.point)},this._update=t=>{var e;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=s.create("div","maplibregl-popup",this._map.getContainer()),this._tip=s.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const t of this.options.className.split(" "))this._container.classList.add(t);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?Vn(this._lngLat,this._flatPos,this._map.transform):null===(e=this._lngLat)||void 0===e?void 0:e.wrap(),this._trackPointer&&!t)return;const i=this._flatPos=this._pos=this._trackPointer&&t?t:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&t?t:this._map.transform.locationPoint(this._lngLat));let r=this.options.anchor;const n=to(this.options.offset);if(!r){const t=this._container.offsetWidth,e=this._container.offsetHeight;let o;o=i.y+n.bottom.y<e?["top"]:i.y>this._map.transform.height-e?["bottom"]:[],i.x<t/2?o.push("left"):i.x>this._map.transform.width-t/2&&o.push("right"),r=0===o.length?"bottom":o.join("-")}let o=i.add(n[r]);this.options.subpixelPositioning||(o=o.round()),s.setTransform(this._container,`${jn[r]} translate(${o.x}px,${o.y}px)`),Hn(this._container,r,"popup")},this._onClose=()=>{this.remove()},this.options=e.e(Object.create(Jn),t)}addTo(t){return this._map&&this.remove(),this._map=t,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new e.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=e.N.convert(t),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(t){return this.setDOMContent(document.createTextNode(t))}setHTML(t){const e=document.createDocumentFragment(),i=document.createElement("body");let r;for(i.innerHTML=t;r=i.firstChild,r;)e.appendChild(r);return this.setDOMContent(e)}getMaxWidth(){var t;return null===(t=this._container)||void 0===t?void 0:t.style.maxWidth}setMaxWidth(t){return this.options.maxWidth=t,this._update(),this}setDOMContent(t){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=s.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(t),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(t){return this._container&&this._container.classList.add(t),this}removeClassName(t){return this._container&&this._container.classList.remove(t),this}setOffset(t){return this.options.offset=t,this._update(),this}toggleClassName(t){if(this._container)return this._container.classList.toggle(t)}setSubpixelPositioning(t){this.options.subpixelPositioning=t}_createCloseButton(){this.options.closeButton&&(this._closeButton=s.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const t=this._container.querySelector(Yn);t&&t.focus()}},t.RasterDEMTileSource=W,t.RasterTileSource=K,t.ScaleControl=class{constructor(t){this._onMove=()=>{Wn(this._map,this._container,this.options)},this.setUnit=t=>{this.options.unit=t,Wn(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},Kn),t)}getDefaultPosition(){return"bottom-left"}onAdd(t){return this._map=t,this._container=s.create("div","maplibregl-ctrl maplibregl-ctrl-scale",t.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){s.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},t.ScrollZoomHandler=dn,t.Style=de,t.TerrainControl=class{constructor(t){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=t}onAdd(t){return this._map=t,this._container=s.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=s.create("button","maplibregl-ctrl-terrain",this._container),s.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){s.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},t.TwoFingersTouchPitchHandler=an,t.TwoFingersTouchRotateHandler=on,t.TwoFingersTouchZoomHandler=rn,t.TwoFingersTouchZoomRotateHandler=_n,t.VectorTileSource=q,t.VideoSource=tt,t.addSourceType=(t,i)=>e._(void 0,void 0,void 0,(function*(){if(rt(t))throw new Error(`A source type called "${t}" already exists.`);((t,e)=>{it[t]=e})(t,i)})),t.clearPrewarmedResources=function(){const t=R;t&&(t.isPreloaded()&&1===t.numActive()?(t.release(z),R=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},t.getMaxParallelImageRequests=function(){return e.a.MAX_PARALLEL_IMAGE_REQUESTS},t.getRTLTextPluginStatus=function(){return at().getRTLTextPluginStatus()},t.getVersion=function(){return eo},t.getWorkerCount=function(){return F.workerCount},t.getWorkerUrl=function(){return e.a.WORKER_URL},t.importScriptInWorkers=function(t){return Q().broadcast("IS",t)},t.prewarm=function(){O().acquire(z)},t.setMaxParallelImageRequests=function(t){e.a.MAX_PARALLEL_IMAGE_REQUESTS=t},t.setRTLTextPlugin=function(t,e){return at().setRTLTextPlugin(t,e)},t.setWorkerCount=function(t){F.workerCount=t},t.setWorkerUrl=function(t){e.a.WORKER_URL=t}}));var r=t;return r}();var Ah=gt(fh.exports);class mh extends Map{#t=0;#e=new Map;#i=new Map;#r;#n;#o;constructor(t={}){if(super(),!(t.maxSize&&t.maxSize>0))throw new TypeError("`maxSize` must be a number greater than 0");if("number"==typeof t.maxAge&&0===t.maxAge)throw new TypeError("`maxAge` must be a number greater than 0");this.#r=t.maxSize,this.#n=t.maxAge||Number.POSITIVE_INFINITY,this.#o=t.onEviction}get __oldCache(){return this.#i}#s(t){if("function"==typeof this.#o)for(const[e,i]of t)this.#o(e,i.value)}#a(t,e){return"number"==typeof e.expiry&&e.expiry<=Date.now()&&("function"==typeof this.#o&&this.#o(t,e.value),this.delete(t))}#l(t,e){if(!1===this.#a(t,e))return e.value}#c(t,e){return e.expiry?this.#l(t,e):e.value}#u(t,e){const i=e.get(t);return this.#c(t,i)}#h(t,e){this.#e.set(t,e),this.#t++,this.#t>=this.#r&&(this.#t=0,this.#s(this.#i),this.#i=this.#e,this.#e=new Map)}#d(t,e){this.#i.delete(t),this.#h(t,e)}*#p(){for(const t of this.#i){const[e,i]=t;if(!this.#e.has(e)){!1===this.#a(e,i)&&(yield t)}}for(const t of this.#e){const[e,i]=t;!1===this.#a(e,i)&&(yield t)}}get(t){if(this.#e.has(t)){const e=this.#e.get(t);return this.#c(t,e)}if(this.#i.has(t)){const e=this.#i.get(t);if(!1===this.#a(t,e))return this.#d(t,e),e.value}}set(t,e,{maxAge:i=this.#n}={}){const r="number"==typeof i&&i!==Number.POSITIVE_INFINITY?Date.now()+i:void 0;return this.#e.has(t)?this.#e.set(t,{value:e,expiry:r}):this.#h(t,{value:e,expiry:r}),this}has(t){return this.#e.has(t)?!this.#a(t,this.#e.get(t)):!!this.#i.has(t)&&!this.#a(t,this.#i.get(t))}peek(t){return this.#e.has(t)?this.#u(t,this.#e):this.#i.has(t)?this.#u(t,this.#i):void 0}delete(t){const e=this.#e.delete(t);return e&&this.#t--,this.#i.delete(t)||e}clear(){this.#e.clear(),this.#i.clear(),this.#t=0}resize(t){if(!(t&&t>0))throw new TypeError("`maxSize` must be a number greater than 0");const e=[...this.#p()],i=e.length-t;i<0?(this.#e=new Map(e),this.#i=new Map,this.#t=e.length):(i>0&&this.#s(e.slice(0,i)),this.#i=new Map(e.slice(i)),this.#e=new Map,this.#t=0),this.#r=t}*keys(){for(const[t]of this)yield t}*values(){for(const[,t]of this)yield t}*[Symbol.iterator](){for(const t of this.#e){const[e,i]=t;!1===this.#a(e,i)&&(yield[e,i.value])}for(const t of this.#i){const[e,i]=t;if(!this.#e.has(e)){!1===this.#a(e,i)&&(yield[e,i.value])}}}*entriesDescending(){let t=[...this.#e];for(let e=t.length-1;e>=0;--e){const i=t[e],[r,n]=i;!1===this.#a(r,n)&&(yield[r,n.value])}t=[...this.#i];for(let e=t.length-1;e>=0;--e){const i=t[e],[r,n]=i;if(!this.#e.has(r)){!1===this.#a(r,n)&&(yield[r,n.value])}}}*entriesAscending(){for(const[t,e]of this.#p())yield[t,e.value]}get size(){if(!this.#t)return this.#i.size;let t=0;for(const e of this.#i.keys())this.#e.has(e)||t++;return Math.min(this.#t+t,this.#r)}get maxSize(){return this.#r}entries(){return this.entriesAscending()}forEach(t,e=this){for(const[i,r]of this.entriesAscending())t.call(e,r,i,this)}get[Symbol.toStringTag](){return JSON.stringify([...this.entriesAscending()])}}const gh=new class{constructor(){this._apiKey="",this._fetch="undefined"!=typeof self?fetch.bind(self):"undefined"!=typeof global&&global.fetch?global.fetch:null,this.tileCacheSize=200}set apiKey(t){this._apiKey=t}get apiKey(){return this._apiKey}set fetch(t){this._fetch=t}get fetch(){return this._fetch}},_h={AUTO:{code:null,flag:"auto",name:"Auto",latin:!1,isMode:!0,geocoding:!0},LATIN:{code:"latin",flag:"name:latin",name:"Latin",latin:!0,isMode:!1,geocoding:!1},NON_LATIN:{code:"nonlatin",flag:"name:nonlatin",name:"Non Latin",latin:!1,isMode:!1,geocoding:!1},LOCAL:{code:null,flag:"name",name:"Local",latin:!0,isMode:!1,geocoding:!1},AMHARIC:{code:"am",flag:"name:am",name:"Amharic",latin:!1,isMode:!1,geocoding:!1},ARABIC:{code:"ar",flag:"name:ar",name:"Arabic",latin:!1,isMode:!1,geocoding:!0},AZERBAIJANI:{code:"az",flag:"name:az",name:"Azerbaijani",latin:!0,isMode:!1,geocoding:!0},BELARUSIAN:{code:"be",flag:"name:be",name:"Belarusian",latin:!1,isMode:!1,geocoding:!0},BULGARIAN:{code:"bg",flag:"bg",name:"Bulgarian",latin:!1,isMode:!1,geocoding:!0},BENGALI:{code:"bn",flag:"name:bn",name:"Bengali",latin:!0,isMode:!1,geocoding:!1},BRETON:{code:"br",flag:"name:br",name:"Breton",latin:!0,isMode:!1,geocoding:!0},BOSNIAN:{code:"bs",flag:"name:bs",name:"Bosnian",latin:!0,isMode:!1,geocoding:!0},CATALAN:{code:"ca",flag:"name:ca",name:"Catalan",latin:!0,isMode:!1,geocoding:!0},CHINESE:{code:"zh",flag:"name:zh",name:"Chinese",latin:!1,isMode:!1,geocoding:!0},TRADITIONAL_CHINESE:{code:"zh-Hant",flag:"name:zh-Hant",name:"Chinese (traditional)",latin:!1,isMode:!1,geocoding:!1},SIMPLIFIED_CHINESE:{code:"zh-Hans",flag:"name:zh-Hans",name:"Chinese (simplified)",latin:!1,isMode:!1,geocoding:!1},CORSICAN:{code:"co",flag:"name:co",name:"Corsican",latin:!0,isMode:!1,geocoding:!1},CZECH:{code:"cs",flag:"name:cs",name:"Czech",latin:!0,isMode:!1,geocoding:!1},WELSH:{code:"cy",flag:"name:cy",name:"WELSH",latin:!0,isMode:!1,geocoding:!0},DANISH:{code:"da",flag:"name:da",name:"Danish",latin:!0,isMode:!1,geocoding:!0},GERMAN:{code:"de",flag:"name:de",name:"German",latin:!0,isMode:!1,geocoding:!0},GREEK:{code:"el",flag:"name:el",name:"Greek",latin:!1,isMode:!1,geocoding:!0},ENGLISH:{code:"en",flag:"name:en",name:"English",latin:!0,isMode:!1,geocoding:!0},ESPERANTO:{code:"eo",flag:"name:eo",name:"Esperanto",latin:!0,isMode:!1,geocoding:!0},SPANISH:{code:"es",flag:"name:es",name:"Spanish",latin:!0,isMode:!1,geocoding:!0},ESTONIAN:{code:"et",flag:"name:et",name:"Estonian",latin:!0,isMode:!1,geocoding:!0},BASQUE:{code:"eu",flag:"name:eu",name:"Basque",latin:!0,isMode:!1,geocoding:!1},FINNISH:{code:"fi",flag:"name:fi",name:"Finnish",latin:!0,isMode:!1,geocoding:!0},FRENCH:{code:"fr",flag:"name:fr",name:"French",latin:!0,isMode:!1,geocoding:!0},FRISIAN:{code:"fy",flag:"name:fy",name:"Frisian (West)",latin:!0,isMode:!1,geocoding:!0},IRISH:{code:"ga",flag:"name:ga",name:"Irish",latin:!0,isMode:!1,geocoding:!0},SCOTTISH_GAELIC:{code:"gd",flag:"name:gd",name:"Scottish Gaelic",latin:!0,isMode:!1,geocoding:!0},HEBREW:{code:"he",flag:"name:he",name:"Hebrew",latin:!1,isMode:!1,geocoding:!0},HINDI:{code:"hi",flag:"name:hi",name:"Hindi",latin:!1,isMode:!1,geocoding:!1},CROATIAN:{code:"hr",flag:"name:hr",name:"Croatian",latin:!0,isMode:!1,geocoding:!0},HUNGARIAN:{code:"hu",flag:"name:hu",name:"Hungarian",latin:!0,isMode:!1,geocoding:!0},ARMENIAN:{code:"hy",flag:"name:hy",name:"Armenian",latin:!1,isMode:!1,geocoding:!0},INDONESIAN:{code:"id",flag:"name:id",name:"Indonesian",latin:!0,isMode:!1,geocoding:!1},ICELANDIC:{code:"is",flag:"name:is",name:"Icelandic",latin:!0,isMode:!1,geocoding:!0},ITALIAN:{code:"it",flag:"name:it",name:"Italian",latin:!0,isMode:!1,geocoding:!0},JAPANESE:{code:"ja",flag:"name:ja",name:"Japanese",latin:!1,isMode:!1,geocoding:!0},JAPANESE_HIRAGANA:{code:"ja-Hira",flag:"name:ja-Hira",name:"Japanese Hiragana form",latin:!1,isMode:!1,geocoding:!1},JAPANESE_2018:{code:"ja-Latn",flag:"name:ja-Latn",name:"Japanese (Latin 2018)",latin:!0,isMode:!1,geocoding:!1},JAPANESE_KANA:{code:"ja_kana",flag:"name:ja_kana",name:"Japanese (Kana)",latin:!1,isMode:!1,geocoding:!1},JAPANESE_LATIN:{code:"ja_rm",flag:"name:ja_rm",name:"Japanese (Latin script)",latin:!0,isMode:!1,geocoding:!1},GEORGIAN:{code:"ka",flag:"name:ka",name:"Georgian",latin:!1,isMode:!1,geocoding:!0},KAZAKH:{code:"kk",flag:"name:kk",name:"Kazakh",latin:!1,isMode:!1,geocoding:!0},KANNADA:{code:"kn",flag:"name:kn",name:"Kannada",latin:!0,isMode:!1,geocoding:!0},KOREAN:{code:"ko",flag:"name:ko",name:"Korean",latin:!1,isMode:!1,geocoding:!0},KOREAN_LATIN:{code:"ko-Latn",flag:"name:ko-Latn",name:"Korean (Latin script)",latin:!0,isMode:!1,geocoding:!1},KURDISH:{code:"ku",flag:"name:ku",name:"Kurdish",latin:!0,isMode:!1,geocoding:!1},CLASSICAL_LATIN:{code:"la",flag:"name:la",name:"Latin",latin:!0,isMode:!1,geocoding:!0},LUXEMBOURGISH:{code:"lb",flag:"name:lb",name:"Luxembourgish",latin:!0,isMode:!1,geocoding:!0},LITHUANIAN:{code:"lt",flag:"name:lt",name:"Lithuanian",latin:!0,isMode:!1,geocoding:!0},LATVIAN:{code:"lv",flag:"name:lv",name:"Latvian",latin:!0,isMode:!1,geocoding:!0},MACEDONIAN:{code:"mk",flag:"name:mk",name:"Macedonian",latin:!1,isMode:!1,geocoding:!0},MALAYALAM:{code:"ml",flag:"name:ml",name:"Malayalam",latin:!1,isMode:!1,geocoding:!1},MALTESE:{code:"mt",flag:"name:mt",name:"Maltese",latin:!0,isMode:!1,geocoding:!0},DUTCH:{code:"nl",flag:"name:nl",name:"Dutch",latin:!0,isMode:!1,geocoding:!0},NORWEGIAN:{code:"no",flag:"name:no",name:"Norwegian",latin:!0,isMode:!1,geocoding:!0},OCCITAN:{code:"oc",flag:"name:oc",name:"Occitan",latin:!0,isMode:!1,geocoding:!1},POLISH:{code:"pl",flag:"name:pl",name:"Polish",latin:!0,isMode:!1,geocoding:!0},PERSIAN:{code:"fa",flag:"name:fa",name:"Persian",latin:!1,isMode:!1,geocoding:!1},PUNJABI:{code:"pa",flag:"name:pa",name:"Punjabi",latin:!1,isMode:!1,geocoding:!1},WESTERN_PUNJABI:{code:"pnb",flag:"name:pnb",name:"Western Punjabi",latin:!1,isMode:!1,geocoding:!1},PORTUGUESE:{code:"pt",flag:"name:pt",name:"Portuguese",latin:!0,isMode:!1,geocoding:!0},ROMANSH:{code:"rm",flag:"name:rm",name:"Romansh",latin:!0,isMode:!1,geocoding:!0},ROMANIAN:{code:"ro",flag:"name:ro",name:"Romanian",latin:!0,isMode:!1,geocoding:!0},RUSSIAN:{code:"ru",flag:"name:ru",name:"Russian",latin:!1,isMode:!1,geocoding:!0},SLOVAK:{code:"sk",flag:"name:sk",name:"Slovak",latin:!0,isMode:!1,geocoding:!0},SLOVENE:{code:"sl",flag:"name:sl",name:"Slovene",latin:!0,isMode:!1,geocoding:!0},ALBANIAN:{code:"sq",flag:"name:sq",name:"Albanian",latin:!0,isMode:!1,geocoding:!0},SERBIAN_CYRILLIC:{code:"sr",flag:"name:sr",name:"Serbian (Cyrillic script)",latin:!1,isMode:!1,geocoding:!0},SERBIAN_LATIN:{code:"sr-Latn",flag:"name:sr-Latn",name:"Serbian (Latin script)",latin:!0,isMode:!1,geocoding:!1},SWEDISH:{code:"sv",flag:"name:sv",name:"Swedish",latin:!0,isMode:!1,geocoding:!0},TAMIL:{code:"ta",flag:"name:ta",name:"Tamil",latin:!1,isMode:!1,geocoding:!1},TELUGU:{code:"te",flag:"name:te",name:"Telugu",latin:!1,isMode:!1,geocoding:!1},THAI:{code:"th",flag:"name:th",name:"Thai",latin:!1,isMode:!1,geocoding:!0},TURKISH:{code:"tr",flag:"name:tr",name:"Turkish",latin:!0,isMode:!1,geocoding:!0},UKRAINIAN:{code:"uk",flag:"name:uk",name:"Ukrainian",latin:!1,isMode:!1,geocoding:!0},VIETNAMESE:{code:"vi",flag:"name:vi",name:"Vietnamese (Latin script)",latin:!0,isMode:!1,geocoding:!1}};function yh(t,e=_h){return t in e?t[t]:null}function vh(t,e=_h){for(const i of Object.values(e))if(i.code===t)return i;return null}function xh(t,e=_h){for(const i of Object.values(e))if(i.flag===t)return i;return null}function bh(){if("undefined"==typeof navigator){return vh(Intl.DateTimeFormat().resolvedOptions().locale.split("-")[0])??_h.ENGLISH}return Array.from(new Set(navigator.languages.map((t=>t.split("-")[0])))).map((t=>vh(t))).filter((t=>t))[0]??_h.ENGLISH}function wh(t){return null!==t&&"object"==typeof t&&"code"in t&&"flag"in t&&"name"in t&&"latin"in t&&"isMode"in t&&"geocoding"in t&&("string"==typeof t.code||null===t.code)&&"string"==typeof t.flag&&"string"==typeof t.name&&"boolean"==typeof t.latin&&"boolean"==typeof t.isMode&&"boolean"==typeof t.geocoding}function Th(t,e=_h){return wh(t)?xh(t.flag,e):"string"!=typeof t?null:yh(t,e)||vh(t,e)||xh(t,e)||null}async function Bh(t,e={}){if(null===gh.fetch)throw new Error("The fetch function was not found. If on NodeJS < 18 please specify the fetch function with config.fetch");if(""===new URL(t).searchParams.get("key").trim())throw new Error("The MapTiler Cloud API key is missing. Set it in `config.apiKey` or get one for free at https://maptiler.com");return gh.fetch(t,e)}const Eh={maptilerApiURL:"https://api.maptiler.com/",mapStyle:"streets-v2"};Object.freeze(Eh);class Ch extends Error{constructor(t,e=""){super(`Call to enpoint ${t.url} failed with the status code ${t.status}. ${e}`),this.res=t}}const Sh={400:"Query too long / Invalid parameters",403:"Key is missing, invalid or restricted"};function Ih(t,e){const{language:i}=e;if(void 0===i)return;const r=(Array.isArray(i)?i:[i]).map((t=>function(t){let e=null;t===_h.AUTO.flag?e=bh():"string"==typeof t?e=vh(t):wh(t)&&(e=t.flag===_h.AUTO.flag?bh():xh(t.flag));return e&&e.geocoding?e.code:null}(t))).filter((t=>t)),n=Array.from(new Set(r)).join(",");t.set("language",n)}function Mh(t,e){const{apiKey:i,limit:r,types:n,excludeTypes:o}=e;t.set("key",i??gh.apiKey),void 0!==r&&t.set("limit",String(r)),void 0!==n&&t.set("types",n.join(",")),void 0!==o&&t.set("excludeTypes",String(o)),Ih(t,e)}function kh(t,e){Mh(t,e);const{bbox:i,proximity:r,country:n,fuzzyMatch:o,autocomplete:s}=e;void 0!==i&&t.set("bbox",i.join(",")),void 0!==r&&t.set("proximity","ip"===r?r:r.join(",")),void 0!==n&&t.set("country",n.join(",")),void 0!==o&&t.set("fuzzyMatch",o?"true":"false"),void 0!==s&&t.set("autocomplete",s?"true":"false")}const Ph={forward:async function(t,e={}){if("string"!=typeof t||0===t.trim().length)throw new Error("The query must be a non-empty string");const i=new URL(`geocoding/${encodeURIComponent(t)}.json`,Eh.maptilerApiURL),{searchParams:r}=i;kh(r,e);const n=i.toString(),o=await Bh(n);if(!o.ok)throw new Ch(o,Sh[o.status]??"");return await o.json()},reverse:async function(t,e={}){if(!Array.isArray(t)||t.length<2)throw new Error("The position must be an array of form [lng, lat].");const i=new URL(`geocoding/${t[0]},${t[1]}.json`,Eh.maptilerApiURL);Mh(i.searchParams,e);const r=i.toString(),n=await Bh(r);if(!n.ok)throw new Ch(n,Sh[n.status]??"");return await n.json()},byId:async function(t,e={}){const i=new URL(`geocoding/${t}.json`,Eh.maptilerApiURL);i.searchParams.set("key",e.apiKey??gh.apiKey),Ih(i.searchParams,e);const r=i.toString(),n=await Bh(r);if(!n.ok)throw new Ch(n,Sh[n.status]??"");return await n.json()},batch:async function(t,e={}){if(!t.length)return[];const i=t.map((t=>encodeURIComponent(t))).join(";"),r=new URL(`geocoding/${i}.json`,Eh.maptilerApiURL),{searchParams:n}=r;kh(n,e);const o=r.toString(),s=await Bh(o);if(!s.ok)throw new Ch(s,Sh[s.status]??"");const a=await s.json();return 1===t.length?[a]:a}},Lh={403:"Key is missing, invalid or restricted"};const zh={info:async function(t={}){const e=new URL("geolocation/ip.json",Eh.maptilerApiURL);e.searchParams.set("key",t.apiKey??gh.apiKey);const i=e.toString(),r=await Bh(i);if(!r.ok)throw new Ch(r,r.status in Lh?Lh[r.status]:"");return await r.json()}},Fh={403:"Key is missing, invalid or restricted"};const Dh={search:async function(t,e={}){if("string"!=typeof t||0===t.trim().length)throw new Error("The query must be a non-empty string");const i=new URL(`coordinates/search/${t}.json`,Eh.maptilerApiURL);i.searchParams.set("key",e.apiKey??gh.apiKey),"limit"in e&&i.searchParams.set("limit",e.limit.toString()),"transformations"in e&&i.searchParams.set("transformations",e.transformations.toString()),"exports"in e&&i.searchParams.set("exports",e.exports.toString());const r=i.toString(),n=await Bh(r);if(!n.ok)throw new Ch(n,n.status in Fh?Fh[n.status]:"");return await n.json()},transform:async function(t,e={}){const i=(Array.isArray(t[0])?t:[t]).map((t=>`${t[0]},${t[1]}`)).join(";"),r=new URL(`coordinates/transform/${i}.json`,Eh.maptilerApiURL);r.searchParams.set("key",e.apiKey??gh.apiKey),"sourceCrs"in e&&r.searchParams.set("s_srs",e.sourceCrs.toString()),"targetCrs"in e&&r.searchParams.set("t_srs",e.targetCrs.toString()),"operations"in e&&r.searchParams.set("ops",(Array.isArray(e.operations)?e.operations:[e.operations]).join("|"));const n=r.toString(),o=await Bh(n);if(!o.ok)throw new Ch(o,o.status in Fh?Fh[o.status]:"");return await o.json()}},Rh={403:"Key is missing, invalid or restricted"};const Uh={get:async function(t,e={}){if("string"!=typeof t||0===t.trim().length)throw new Error("The data ID must be a non-empty string");const i=new URL(`data/${encodeURIComponent(t)}/features.json`,Eh.maptilerApiURL);i.searchParams.set("key",e.apiKey??gh.apiKey);const r=i.toString(),n=await Bh(r);if(!n.ok)throw new Ch(n,n.status in Rh?Rh[n.status]:"");return await n.json()}};function Oh(t){let e;const i=t.trim();let r;return r=i.startsWith("http://")||i.startsWith("https://")?i:null!==(e=/^maptiler:\/\/(.*)/.exec(i))?`https://api.maptiler.com/maps/${e[1]}/style.json`:`https://api.maptiler.com/maps/${i}/style.json`,r}class Nh{constructor(t,e,i,r,n,o){this.name=t,this.variantType=e,this.id=i,this.referenceStyle=r,this.description=n,this.imageURL=o}getName(){return this.name}getFullName(){return`${this.referenceStyle.getName()} ${this.name}`}getType(){return this.variantType}getId(){return this.id}getDescription(){return this.description}getReferenceStyle(){return this.referenceStyle}hasVariant(t){return this.referenceStyle.hasVariant(t)}getVariant(t){return this.referenceStyle.getVariant(t)}getVariants(){return this.referenceStyle.getVariants().filter((t=>t!==this))}getImageURL(){return this.imageURL}getExpandedStyleURL(){return Oh(this.getId())}}class Qh{constructor(t,e){this.name=t,this.id=e,this.variants={},this.orderedVariants=[]}getName(){return this.name}getId(){return this.id}addVariant(t){this.variants[t.getType()]=t,this.orderedVariants.push(t)}hasVariant(t){return t in this.variants}getVariant(t){return t in this.variants?this.variants[t]:this.orderedVariants[0]}getVariants(){return Object.values(this.variants)}getDefaultVariant(){return this.orderedVariants[0]}}const Vh=[{referenceStyleID:"STREETS",name:"Streets",description:"",variants:[{id:"streets-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"streets-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"streets-v2-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""},{id:"streets-v2-night",name:"Night",variantType:"NIGHT",description:"",imageURL:""},{id:"streets-v2-pastel",name:"Pastel",variantType:"PASTEL",description:"",imageURL:""}]},{referenceStyleID:"OUTDOOR",name:"Outdoor",description:"",variants:[{id:"outdoor-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"outdoor-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""}]},{referenceStyleID:"WINTER",name:"Winter",description:"",variants:[{id:"winter-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"winter-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""}]},{referenceStyleID:"SATELLITE",name:"Satellite",description:"",variants:[{id:"satellite",name:"Default",variantType:"DEFAULT",description:"",imageURL:""}]},{referenceStyleID:"HYBRID",name:"Hybrid",description:"",variants:[{id:"hybrid",name:"Default",variantType:"DEFAULT",description:"",imageURL:""}]},{referenceStyleID:"BASIC",name:"Basic",description:"",variants:[{id:"basic-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"basic-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"basic-v2-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""}]},{referenceStyleID:"BRIGHT",name:"Bright",description:"",variants:[{id:"bright-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"bright-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"bright-v2-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""},{id:"bright-v2-pastel",name:"Pastel",variantType:"PASTEL",description:"",imageURL:""}]},{referenceStyleID:"OPENSTREETMAP",name:"OpenStreetMap",description:"",variants:[{id:"openstreetmap",name:"Default",variantType:"DEFAULT",description:"",imageURL:""}]},{referenceStyleID:"TOPO",name:"Topo",description:"",variants:[{id:"topo-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"topo-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"topo-v2-shiny",name:"Shiny",variantType:"SHINY",description:"",imageURL:""},{id:"topo-v2-pastel",name:"Pastel",variantType:"PASTEL",description:"",imageURL:""},{id:"topo-v2-topographique",name:"Topographique",variantType:"TOPOGRAPHIQUE",description:"",imageURL:""}]},{referenceStyleID:"VOYAGER",name:"Voyager",description:"",variants:[{id:"voyager-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"voyager-v2-darkmatter",name:"Darkmatter",variantType:"DARK",description:"",imageURL:""},{id:"voyager-v2-positron",name:"Positron",variantType:"LIGHT",description:"",imageURL:""},{id:"voyager-v2-vintage",name:"Vintage",variantType:"VINTAGE",description:"",imageURL:""}]},{referenceStyleID:"TONER",name:"Toner",description:"",variants:[{id:"toner-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"toner-v2-background",name:"Background",variantType:"BACKGROUND",description:"",imageURL:""},{id:"toner-v2-lite",name:"Lite",variantType:"LITE",description:"",imageURL:""},{id:"toner-v2-lines",name:"Lines",variantType:"LINES",description:"",imageURL:""}]},{referenceStyleID:"DATAVIZ",name:"Dataviz",description:"",variants:[{id:"dataviz",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"dataviz-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"dataviz-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""}]},{referenceStyleID:"BACKDROP",name:"Backdrop",description:"",variants:[{id:"backdrop",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"backdrop-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"backdrop-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""}]},{referenceStyleID:"OCEAN",name:"Ocean",description:"",variants:[{id:"ocean",name:"Default",variantType:"DEFAULT",description:"",imageURL:""}]}];function jh(t){return new Proxy(t,{get:(e,i,r)=>e.hasVariant(i)?e.getVariant(i):i.toString().toUpperCase()===i?t.getDefaultVariant():Reflect.get(e,i,r)})}function Hh(t){return t?"string"==typeof t||t instanceof String?t.trim().toLowerCase():t instanceof Nh?t.getId():t instanceof Qh?t.getDefaultVariant().getId():void 0:Gh[Vh[0].referenceStyleID].getDefaultVariant().getId()}const Gh=function(){const t={};for(let e=0;e<Vh.length;e+=1){const i=Vh[e],r=jh(new Qh(i.name,i.referenceStyleID));for(let t=0;t<i.variants.length;t+=1){const e=i.variants[t],n=new Nh(e.name,e.variantType,e.id,r,e.description,e.imageURL);r.addVariant(n)}t[i.referenceStyleID]=r}return t}();function $h(t,e,i){let r=e[0],n=e[1],o=i[0]-r,s=i[1]-n;if(0!==o||0!==s){const e=((t[0]-r)*o+(t[1]-n)*s)/(o*o+s*s);e>1?(r=i[0],n=i[1]):e>0&&(r+=o*e,n+=s*e)}return o=t[0]-r,s=t[1]-n,o*o+s*s}function Zh(t,e,i,r,n){let o,s=r;for(let r=e+1;r<i;r++){const n=$h(t[r],t[e],t[i]);n>s&&(o=r,s=n)}s>r&&(o-e>1&&Zh(t,e,o,r,n),n.push(t[o]),i-o>1&&Zh(t,o,i,r,n))}function qh(t,e){const i=t.length-1,r=[t[0]];return Zh(t,0,i,e,r),r.push(t[i]),r}const Kh={extractLineStrings:function(t){const e=[];function i(t){"LineString"!==t.type&&"MultiLineString"!==t.type||e.push(t)}function r(t){t.geometry&&i(t.geometry)}return"Feature"===t.type?r(t):"FeatureCollection"===t.type?function t(e){for(const i of e.features)"Feature"===i.type?r(i):"FeatureCollection"===i.type&&t(i)}(t):i(t),e},simplify:function(t,e){return t.length<=2?t:qh(t,void 0!==e?e*e:1)}};function Wh(t,e=!0){let i=`${t[0]},${t[1]}`;return 3===t.length&&e&&(i+=`,${t[2]}`),i}function Xh(t,e=3e3){let i=t.map((t=>t.join(","))).join("|"),r=5e-6;for(;i.length>e;){i=Kh.simplify(t,r).map((t=>`${t[0]},${t[1]}`)).join("|"),r+=1e-5}return i}const Jh={centered:function(t,e,i={}){const r=Hh(i.style),n=i.hiDPI?"@2x":"",o=i.format??"png";let s=~~(i.width??1024),a=~~(i.height??1024);i.hiDPI&&(s=~~(s/2),a=~~(a/2));const l=new URL(`maps/${encodeURIComponent(r)}/static/${t[0]},${t[1]},${e}/${s}x${a}${n}.${o}`,Eh.maptilerApiURL);if("attribution"in i&&l.searchParams.set("attribution",i.attribution.toString()),"markers"in i){let t="";const e="markerIcon"in i;e&&(t+=`icon:${i.markerIcon}|`),e&&"markerAnchor"in i&&(t+=`anchor:${i.markerAnchor}|`),e&&i.hiDPI&&(t+="scale:2|");t+=(Array.isArray(i.markers[0])?i.markers:[i.markers]).map((t=>Wh(t,!e))).join("|"),l.searchParams.set("markers",t)}if("path"in i){let t="";if(t+=`fill:${i.pathFillColor??"none"}|`,"pathStrokeColor"in i&&(t+=`stroke:${i.pathStrokeColor}|`),"pathWidth"in i){t+=`width:${(i.pathWidth/(i.hiDPI?2:1)).toString()}|`}t+=Xh(i.path),l.searchParams.set("path",t)}return l.searchParams.set("key",i.apiKey??gh.apiKey),l.toString()},bounded:function(t,e={}){const i=Hh(e.style),r=e.hiDPI?"@2x":"",n=e.format??"png";let o=~~(e.width??1024),s=~~(e.height??1024);e.hiDPI&&(o=~~(o/2),s=~~(s/2));const a=new URL(`maps/${encodeURIComponent(i)}/static/${t[0]},${t[1]},${t[2]},${t[3]}/${o}x${s}${r}.${n}`,Eh.maptilerApiURL);if("attribution"in e&&a.searchParams.set("attribution",e.attribution.toString()),"padding"in e&&a.searchParams.set("padding",e.padding.toString()),"markers"in e){let t="";const i="markerIcon"in e;i&&(t+=`icon:${e.markerIcon}|`),i&&"markerAnchor"in e&&(t+=`anchor:${e.markerAnchor}|`),i&&e.hiDPI&&(t+="scale:2|");t+=(Array.isArray(e.markers[0])?e.markers:[e.markers]).map((t=>Wh(t,!i))).join("|"),a.searchParams.set("markers",t)}if("path"in e){let t="";if(t+=`fill:${e.pathFillColor??"none"}|`,"pathStrokeColor"in e&&(t+=`stroke:${e.pathStrokeColor}|`),"pathWidth"in e){t+=`width:${(e.pathWidth/(e.hiDPI?2:1)).toString()}|`}t+=Xh(e.path),a.searchParams.set("path",t)}return a.searchParams.set("key",e.apiKey??gh.apiKey),a.toString()},automatic:function(t={}){if(!("markers"in t)&&!("path"in t))throw new Error("Automatic static maps require markers and/or path to be created.");const e=Hh(t.style),i=t.hiDPI?"@2x":"",r=t.format??"png";let n=~~(t.width??1024),o=~~(t.height??1024);t.hiDPI&&(n=~~(n/2),o=~~(o/2));const s=new URL(`maps/${encodeURIComponent(e)}/static/auto/${n}x${o}${i}.${r}`,Eh.maptilerApiURL);if("attribution"in t&&s.searchParams.set("attribution",t.attribution.toString()),"padding"in t&&s.searchParams.set("padding",t.padding.toString()),"markers"in t){let e="";const i="markerIcon"in t;i&&(e+=`icon:${t.markerIcon}|`),i&&"markerAnchor"in t&&(e+=`anchor:${t.markerAnchor}|`),i&&t.hiDPI&&(e+="scale:2|");e+=(Array.isArray(t.markers[0])?t.markers:[t.markers]).map((t=>Wh(t,!i))).join("|"),s.searchParams.set("markers",e)}if("path"in t){let e="";if(e+=`fill:${t.pathFillColor??"none"}|`,"pathStrokeColor"in t&&(e+=`stroke:${t.pathStrokeColor}|`),"pathWidth"in t){e+=`width:${(t.pathWidth/(t.hiDPI?2:1)).toString()}|`}e+=Xh(t.path),s.searchParams.set("path",e)}return s.searchParams.set("key",t.apiKey??gh.apiKey),s.toString()}},Yh=6371008.8,td=2*Math.PI*Yh;function ed(t){return(180+t)/360}function id(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function rd(t){const e=ad(t);return[ed(e[0]),id(e[1])]}function nd(t){return 360*t-180}function od(t){const e=180-360*t;return 360/Math.PI*Math.atan(Math.exp(e*Math.PI/180))-90}function sd(t,e){const i=Math.PI/180,r=t[1]*i,n=e[1]*i,o=Math.sin(r)*Math.sin(n)+Math.cos(r)*Math.cos(n)*Math.cos((e[0]-t[0])*i);return Yh*Math.acos(Math.min(o,1))}function ad(t){const e=((t[0]+180)%360+360)%360-180;return[-180===e?180:e,t[1]]}function ld(t){return td*Math.cos(t*Math.PI/180)}function cd(t,e,i=!0){const r=2**e,n=[t[0]*r,t[1]*r];return i?[~~n[0],~~n[1]]:n}function ud(t){return t*Math.PI/180}function hd(t){return 180*t/Math.PI}const dd={EARTH_RADIUS:Yh,EARTH_CIRCUMFERENCE:td,longitudeToMercatorX:ed,latitudeToMercatorY:id,wgs84ToMercator:rd,mercatorXToLongitude:nd,mercatorYToLatitude:od,mercatorToWgs84:function(t){return[nd(t[0]),od(t[1])]},haversineDistanceWgs84:sd,wrapWgs84:ad,circumferenceAtLatitude:ld,mercatorToTileIndex:cd,wgs84ToTileIndex:function(t,e,i=!0){return cd(rd(t),e,i)},toRadians:ud,toDegrees:hd,haversineIntermediateWgs84:function(t,e,i){const r=sd(t,e),n=ud(t[0]),o=ud(t[1]),s=ud(e[0]),a=ud(e[1]),l=r/Yh,c=Math.sin((1-i)*l)/Math.sin(l),u=Math.sin(i*l)/Math.sin(l),h=c*Math.cos(o)*Math.cos(n)+u*Math.cos(a)*Math.cos(s),d=c*Math.cos(o)*Math.sin(n)+u*Math.cos(a)*Math.sin(s),p=c*Math.sin(o)+u*Math.sin(a),f=Math.atan2(p,Math.sqrt(h*h+d*d));return[hd(Math.atan2(d,h)),hd(f)]},haversineCumulatedDistanceWgs84:function(t){const e=Array(t.length);e[0]=0;const i=e.length;for(let r=1;r<i;r++)e[r]=sd(t[r-1],t[r])+e[r-1];return e}};let pd=null;function fd(){return pd||(pd=new mh({maxSize:gh.tileCacheSize})),pd}async function Ad(t){const e=new Blob([t]),i=await createImageBitmap(e),r=document.createElement("canvas"),n=r.getContext("2d");r.width=i.width,r.height=i.height,n.drawImage(i,0,0);const o=n.getImageData(0,0,r.width,r.height);return{pixels:o.data,width:r.width,height:r.height,components:o.data.length/(r.width*r.height)}}function md(){if(gh.bufferToPixelData)return gh.bufferToPixelData;if("undefined"!=typeof window)return Ad;throw new Error("An image file buffer to pixel data parser is necessary. Specify it in `config.bufferToPixelData`")}const gd="tiles/terrain-rgb-v2/tiles.json";let _d=null;const yd={403:"Key is missing, invalid or restricted"};async function vd(t){const e=new URL(gd,Eh.maptilerApiURL);e.searchParams.set("key",t);const i=e.toString(),r=await Bh(i);if(r.ok)return _d=await r.json(),_d;if(!r.ok)throw new Ch(r,yd[r.status]??"")}async function xd(t,e={}){const i=e.apiKey??gh.apiKey;_d||await vd(i);const r=md(),n=_d.tiles[0],o=fd(),s=_d.maxzoom;let a=~~(e.zoom??s);(a>s||a<0)&&(a=s);const l=t.map((t=>dd.wgs84ToTileIndex(t,a,!1))),c=l.map((t=>[~~t[0],~~t[1]])).map((t=>`terrain_${a.toString()}_${t[0].toString()}_${t[1].toString()}`)),u=Array.from(new Set(c.filter((t=>!o.has(t))))).map((t=>t.split("_").slice(1))),h=u.map((t=>n.replace("{x}",t[1].toString()).replace("{y}",t[2].toString()).replace("{z}",t[0].toString()))).map((t=>Bh(t))),d=(await Promise.allSettled(h)).map((t=>"fulfilled"===t.status?t.value:null)).filter((t=>t)),p=d.filter((t=>!t.ok));if(d.length!==h.length)throw new Error("Some tiles could not be fetched.");if(p.length)throw new Ch(p[0],yd[p[0].status]??"");const f=await Promise.all(d.map((t=>t.arrayBuffer())));if(!f.every((t=>t.byteLength>0)))throw new Error("Some tiles are not available.");(await Promise.all(f.map((t=>r(t))))).forEach(((t,e)=>{const i=u[e],r=`terrain_${i[0].toString()}_${i[1].toString()}_${i[2].toString()}`;o.set(r,t)}));const A=t.map(((t,e)=>{const i=c[e],r=l[e],n=o.get(i),s=Math.min(Math.round(n.width*(r[0]%1)),n.width-1),a=(Math.min(Math.round(n.height*(r[1]%1)),n.height-1)*n.width+s)*n.components,u=.1*(256*n.pixels[a]*256+256*n.pixels[a+1]+n.pixels[a+2])-1e4;return[t[0],t[1],~~(1e3*u)/1e3]}));if(e.smoothingKernelSize){const t=2*~~(e.smoothingKernelSize/2)+1,i=A.map((t=>t[2])),r=~~(t/2);for(let e=r;e<i.length-r-1;e+=1){let n=0;for(let o=0;o<t;o+=1){n+=i[e-r+o]}n/=t,A[e][2]=n}}return A}const bd={at:async function(t,e={}){const i=e.apiKey??gh.apiKey;_d||await vd(i);const r=_d.maxzoom;let n=~~(e.zoom??r);(n>r||n<0)&&(n=r);const o=dd.wgs84ToTileIndex(t,n,!1),s=~~o[0],a=~~o[1];if(!_d.tiles.length)throw new Error("Terrain tileJSON tile list is empty.");const l=`terrain_${n.toString()}_${s.toString()}_${a.toString()}`;let c;const u=fd();if(u.has(l))c=u.get(l);else{const t=_d.tiles[0].replace("{x}",s.toString()).replace("{y}",a.toString()).replace("{z}",n.toString()),e=await Bh(t);if(!e.ok)throw new Ch(e,yd[e.status]??"");const i=await e.arrayBuffer(),r=md();c=await r(i),u.set(l,c)}const h=~~(c.width*(o[0]%1)),d=(~~(c.height*(o[1]%1))*c.width+h)*c.components,p=.1*(256*c.pixels[d]*256+256*c.pixels[d+1]+c.pixels[d+2])-1e4;return[t[0],t[1],p]},batch:xd,fromLineString:async function(t,e={}){if("LineString"!==t.type)throw new Error("The provided object is not a GeoJSON LineString");const i=structuredClone(t),r=await xd(i.coordinates,e);return i.coordinates=r,i},fromMultiLineString:async function(t,e={}){if("MultiLineString"!==t.type)throw new Error("The provided object is not a GeoJSON MultiLineString");const i=structuredClone(t),r=i.coordinates.map((t=>t.length)),n=i.coordinates.flat(),o=await xd(n,e),s=[];let a=0;for(const t of r)s.push(o.slice(a,a+t)),a+=t;return i.coordinates=s,i}};var wd,Td={exports:{}},Bd="object"==typeof Reflect?Reflect:null,Ed=Bd&&"function"==typeof Bd.apply?Bd.apply:function(t,e,i){return Function.prototype.apply.call(t,e,i)};wd=Bd&&"function"==typeof Bd.ownKeys?Bd.ownKeys:Object.getOwnPropertySymbols?function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:function(t){return Object.getOwnPropertyNames(t)};var Cd=Number.isNaN||function(t){return t!=t};function Sd(){Sd.init.call(this)}Td.exports=Sd,Td.exports.once=function(t,e){return new Promise((function(i,r){function n(i){t.removeListener(e,o),r(i)}function o(){"function"==typeof t.removeListener&&t.removeListener("error",n),i([].slice.call(arguments))}Ud(t,e,o,{once:!0}),"error"!==e&&function(t,e,i){"function"==typeof t.on&&Ud(t,"error",e,i)}(t,n,{once:!0})}))},Sd.EventEmitter=Sd,Sd.prototype._events=void 0,Sd.prototype._eventsCount=0,Sd.prototype._maxListeners=void 0;var Id=10;function Md(t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}function kd(t){return void 0===t._maxListeners?Sd.defaultMaxListeners:t._maxListeners}function Pd(t,e,i,r){var n,o,s,a;if(Md(i),void 0===(o=t._events)?(o=t._events=Object.create(null),t._eventsCount=0):(void 0!==o.newListener&&(t.emit("newListener",e,i.listener?i.listener:i),o=t._events),s=o[e]),void 0===s)s=o[e]=i,++t._eventsCount;else if("function"==typeof s?s=o[e]=r?[i,s]:[s,i]:r?s.unshift(i):s.push(i),(n=kd(t))>0&&s.length>n&&!s.warned){s.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",l.emitter=t,l.type=e,l.count=s.length,a=l,console&&console.warn&&console.warn(a)}return t}function Ld(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function zd(t,e,i){var r={fired:!1,wrapFn:void 0,target:t,type:e,listener:i},n=Ld.bind(r);return n.listener=i,r.wrapFn=n,n}function Fd(t,e,i){var r=t._events;if(void 0===r)return[];var n=r[e];return void 0===n?[]:"function"==typeof n?i?[n.listener||n]:[n]:i?function(t){for(var e=new Array(t.length),i=0;i<e.length;++i)e[i]=t[i].listener||t[i];return e}(n):Rd(n,n.length)}function Dd(t){var e=this._events;if(void 0!==e){var i=e[t];if("function"==typeof i)return 1;if(void 0!==i)return i.length}return 0}function Rd(t,e){for(var i=new Array(e),r=0;r<e;++r)i[r]=t[r];return i}function Ud(t,e,i,r){if("function"==typeof t.on)r.once?t.once(e,i):t.on(e,i);else{if("function"!=typeof t.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t);t.addEventListener(e,(function n(o){r.once&&t.removeEventListener(e,n),i(o)}))}}Object.defineProperty(Sd,"defaultMaxListeners",{enumerable:!0,get:function(){return Id},set:function(t){if("number"!=typeof t||t<0||Cd(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");Id=t}}),Sd.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},Sd.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||Cd(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this},Sd.prototype.getMaxListeners=function(){return kd(this)},Sd.prototype.emit=function(t){for(var e=[],i=1;i<arguments.length;i++)e.push(arguments[i]);var r="error"===t,n=this._events;if(void 0!==n)r=r&&void 0===n.error;else if(!r)return!1;if(r){var o;if(e.length>0&&(o=e[0]),o instanceof Error)throw o;var s=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw s.context=o,s}var a=n[t];if(void 0===a)return!1;if("function"==typeof a)Ed(a,this,e);else{var l=a.length,c=Rd(a,l);for(i=0;i<l;++i)Ed(c[i],this,e)}return!0},Sd.prototype.addListener=function(t,e){return Pd(this,t,e,!1)},Sd.prototype.on=Sd.prototype.addListener,Sd.prototype.prependListener=function(t,e){return Pd(this,t,e,!0)},Sd.prototype.once=function(t,e){return Md(e),this.on(t,zd(this,t,e)),this},Sd.prototype.prependOnceListener=function(t,e){return Md(e),this.prependListener(t,zd(this,t,e)),this},Sd.prototype.removeListener=function(t,e){var i,r,n,o,s;if(Md(e),void 0===(r=this._events))return this;if(void 0===(i=r[t]))return this;if(i===e||i.listener===e)0==--this._eventsCount?this._events=Object.create(null):(delete r[t],r.removeListener&&this.emit("removeListener",t,i.listener||e));else if("function"!=typeof i){for(n=-1,o=i.length-1;o>=0;o--)if(i[o]===e||i[o].listener===e){s=i[o].listener,n=o;break}if(n<0)return this;0===n?i.shift():function(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}(i,n),1===i.length&&(r[t]=i[0]),void 0!==r.removeListener&&this.emit("removeListener",t,s||e)}return this},Sd.prototype.off=Sd.prototype.removeListener,Sd.prototype.removeAllListeners=function(t){var e,i,r;if(void 0===(i=this._events))return this;if(void 0===i.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==i[t]&&(0==--this._eventsCount?this._events=Object.create(null):delete i[t]),this;if(0===arguments.length){var n,o=Object.keys(i);for(r=0;r<o.length;++r)"removeListener"!==(n=o[r])&&this.removeAllListeners(n);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(e=i[t]))this.removeListener(t,e);else if(void 0!==e)for(r=e.length-1;r>=0;r--)this.removeListener(t,e[r]);return this},Sd.prototype.listeners=function(t){return Fd(this,t,!0)},Sd.prototype.rawListeners=function(t){return Fd(this,t,!1)},Sd.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):Dd.call(t,e)},Sd.prototype.listenerCount=Dd,Sd.prototype.eventNames=function(){return this._eventsCount>0?wd(this._events):[]};var Od=Td.exports;let Nd;const Qd=new Uint8Array(16);function Vd(){if(!Nd&&(Nd="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Nd))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Nd(Qd)}const jd=[];for(let t=0;t<256;++t)jd.push((t+256).toString(16).slice(1));var Hd={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};const Gd="function"==typeof Buffer,$d=("function"==typeof TextDecoder&&new TextDecoder,"function"==typeof TextEncoder&&new TextEncoder,Array.prototype.slice.call("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=")),Zd=(t=>{let e={};return $d.forEach(((t,i)=>e[t]=i)),e})(),qd=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,Kd=String.fromCharCode.bind(String),Wd=("function"==typeof Uint8Array.from&&Uint8Array.from.bind(Uint8Array),t=>t.replace(/=/g,"").replace(/[+\/]/g,(t=>"+"==t?"-":"_"))),Xd=t=>t.replace(/[^A-Za-z0-9\+\/]/g,""),Jd=t=>{let e,i,r,n,o="";const s=t.length%3;for(let s=0;s<t.length;){if((i=t.charCodeAt(s++))>255||(r=t.charCodeAt(s++))>255||(n=t.charCodeAt(s++))>255)throw new TypeError("invalid character found");e=i<<16|r<<8|n,o+=$d[e>>18&63]+$d[e>>12&63]+$d[e>>6&63]+$d[63&e]}return s?o.slice(0,s-3)+"===".substring(s):o},Yd="function"==typeof btoa?t=>btoa(t):Gd?t=>Buffer.from(t,"binary").toString("base64"):Jd,tp=Gd?t=>Buffer.from(t).toString("base64"):t=>{let e=[];for(let i=0,r=t.length;i<r;i+=4096)e.push(Kd.apply(null,t.subarray(i,i+4096)));return Yd(e.join(""))},ep=(t,e=!1)=>e?Wd(tp(t)):tp(t),ip=t=>{if(t=t.replace(/\s+/g,""),!qd.test(t))throw new TypeError("malformed base64.");t+="==".slice(2-(3&t.length));let e,i,r,n="";for(let o=0;o<t.length;)e=Zd[t.charAt(o++)]<<18|Zd[t.charAt(o++)]<<12|(i=Zd[t.charAt(o++)])<<6|(r=Zd[t.charAt(o++)]),n+=64===i?Kd(e>>16&255):64===r?Kd(e>>16&255,e>>8&255):Kd(e>>16&255,e>>8&255,255&e);return n},rp=ep;var np=Object.defineProperty,op=t=>{throw TypeError(t)},sp=(t,e,i)=>((t,e,i)=>e in t?np(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i)(t,"symbol"!=typeof e?e+"":e,i),ap=(t,e,i)=>e.has(t)||op("Cannot "+i),lp=(t,e,i)=>(ap(t,e,"read from private field"),i?i.call(t):e.get(t)),cp=(t,e,i)=>e.has(t)?op("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,i),up=(t,e,i,r)=>(ap(t,e,"write to private field"),r?r.call(t,i):e.set(t,i),i),hp=(t,e,i)=>(ap(t,e,"access private method"),i);const dp="2.3.0",pp={VISITOR:{code:null,flag:"visitor",name:"Visitor",latin:!0,isMode:!0,geocoding:!1},VISITOR_ENGLISH:{code:null,flag:"visitor_en",name:"Visitor English",latin:!0,isMode:!0,geocoding:!1},STYLE:{code:null,flag:"style",name:"Style",latin:!1,isMode:!0,geocoding:!1},STYLE_LOCK:{code:null,flag:"style_lock",name:"Style Lock",latin:!1,isMode:!0,geocoding:!1},..._h};function fp(){if(typeof navigator>"u"){return vh(Intl.DateTimeFormat().resolvedOptions().locale.split("-")[0])||pp.ENGLISH}return Array.from(new Set(navigator.languages.map((t=>t.split("-")[0])))).map((t=>vh(t))).filter((t=>t))[0]??pp.LOCAL}const Ap={maptilerLogoURL:"https://api.maptiler.com/resources/logo.svg",maptilerURL:"https://www.maptiler.com/",maptilerApiHost:"api.maptiler.com",rtlPluginURL:"https://cdn.maptiler.com/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.min.js",primaryLanguage:pp.STYLE,secondaryLanguage:pp.LOCAL,terrainSourceURL:"https://api.maptiler.com/tiles/terrain-rgb-v2/tiles.json",terrainSourceId:"maptiler-terrain"};Object.freeze(Ap);const mp=function(t,e,i){if(Hd.randomUUID&&!e&&!t)return Hd.randomUUID();const r=(t=t||{}).random||(t.rng||Vd)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,e){i=i||0;for(let t=0;t<16;++t)e[i+t]=r[t];return e}return function(t,e=0){return jd[t[e+0]]+jd[t[e+1]]+jd[t[e+2]]+jd[t[e+3]]+"-"+jd[t[e+4]]+jd[t[e+5]]+"-"+jd[t[e+6]]+jd[t[e+7]]+"-"+jd[t[e+8]]+jd[t[e+9]]+"-"+jd[t[e+10]]+jd[t[e+11]]+jd[t[e+12]]+jd[t[e+13]]+jd[t[e+14]]+jd[t[e+15]]}(r)}();class gp extends Od{constructor(){super(...arguments),sp(this,"primaryLanguage",Ap.primaryLanguage),sp(this,"secondaryLanguage"),sp(this,"session",!0),sp(this,"caching",!0),sp(this,"_unit","metric"),sp(this,"_apiKey","")}set unit(t){this._unit=t,this.emit("unit",t)}get unit(){return this._unit}set apiKey(t){this._apiKey=t,gh.apiKey=t,this.emit("apiKey",t)}get apiKey(){return this._apiKey}set fetch(t){gh.fetch=t}get fetch(){return gh.fetch}}const _p=new gp,{addProtocol:yp}=Ah,vp="localcache_source",xp="localcache",bp="maptiler_sdk",wp=1e3,Tp=typeof caches<"u";function Bp(t,e){if(Tp&&_p.caching&&_p.session&&t.host===Ap.maptilerApiHost){if("Source"===e&&t.href.includes("tiles.json"))return t.href.replace("https://",`${vp}://`);if("Tile"===e||"Glyphs"===e)return t.href.replace("https://",`${xp}://`)}return t.href}let Ep;async function Cp(){return Ep||(Ep=await caches.open(bp)),Ep}let Sp=0;function Ip(){yp(vp,(async(t,e)=>{if(!t.url)throw new Error("");t.url=t.url.replace(`${vp}://`,"https://");const i=t;i.signal=e.signal;const r=await fetch(t.url,i),n=await r.json();return n.tiles&&n.tiles.length>0&&(n.tiles[0]+=`&last-modified=${r.headers.get("Last-Modified")}`),{data:n,cacheControl:r.headers.get("Cache-Control"),expires:r.headers.get("Expires")}})),yp(xp,(async(t,e)=>{if(!t.url)throw new Error("");t.url=t.url.replace(`${xp}://`,"https://");const i=new URL(t.url),r=new URL(i);r.searchParams.delete("mtsid"),r.searchParams.delete("key");const n=r.toString(),o=new URL(i);o.searchParams.delete("last-modified");const s=o.toString(),a=async t=>({data:await t.arrayBuffer(),cacheControl:t.headers.get("Cache-Control"),expires:t.headers.get("Expires")}),l=await Cp(),c=await l.match(n);if(c)return a(c);const u=t;u.signal=e.signal;const h=await fetch(s,u);return h.status>=200&&h.status<300&&(l.put(n,h.clone()).catch((()=>{})),++Sp>100&&(async function(){const t=await Cp(),e=await t.keys(),i=e.slice(0,Math.max(e.length-wp,0));for(const e of i)t.delete(e)}(),Sp=0)),a(h)}))}function Mp(t,e,i){const r=window.document.createElement(t);return void 0!==e&&(r.className=e),i&&i.appendChild(r),r}function kp(t){t.parentNode&&t.parentNode.removeChild(t)}function Pp(t,e){let i=null;try{i=new URL(t)}catch{return{url:t}}return i.host===Ap.maptilerApiHost&&(i.searchParams.has("key")||i.searchParams.append("key",_p.apiKey),_p.session&&i.searchParams.append("mtsid",mp)),{url:Bp(i,e)}}function Lp(t){return(e,i)=>{if(null!=t){const r=t(e,i),n=Pp((null==r?void 0:r.url)??"",i);return{...r,...n}}return Pp(e,i)}}function zp(){return Math.random().toString(36).substring(2)}function Fp(t){return/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/gi.test(t)}function Dp(t){const e=document.createElement("canvas").getContext("webgl2")?null:typeof WebGL2RenderingContext<"u"?"Graphic rendering with WebGL2 has been disabled or is not supported by your graphic card. The map cannot be displayed.":"Your browser does not support graphic rendering with WebGL2. The map cannot be displayed.";if(!e)return;let i=null;if("string"==typeof t?i=document.getElementById(t):t instanceof HTMLElement&&(i=t),!i)throw new Error("The Map container must be provided.");const r=document.createElement("div");throw r.innerHTML=e,r.classList.add("no-webgl-support-div"),i.appendChild(r),new Error(e)}let Rp=class extends Ah.Marker{addTo(t){return super.addTo(t)}};class Up extends Ah.Popup{addTo(t){return super.addTo(t)}}class Op extends Ah.Style{constructor(t,e={}){super(t,e)}}class Np extends Ah.CanvasSource{onAdd(t){super.onAdd(t)}}class Qp extends Ah.GeoJSONSource{onAdd(t){super.onAdd(t)}}class Vp extends Ah.ImageSource{onAdd(t){super.onAdd(t)}}class jp extends Ah.RasterTileSource{onAdd(t){super.onAdd(t)}}class Hp extends Ah.RasterDEMTileSource{onAdd(t){super.onAdd(t)}}class Gp extends Ah.VectorTileSource{onAdd(t){super.onAdd(t)}}class $p extends Ah.VideoSource{onAdd(t){super.onAdd(t)}}class Zp extends Ah.NavigationControl{onAdd(t){return super.onAdd(t)}}class qp extends Ah.GeolocateControl{onAdd(t){return super.onAdd(t)}}class Kp extends Ah.AttributionControl{onAdd(t){return super.onAdd(t)}}class Wp extends Ah.LogoControl{onAdd(t){return super.onAdd(t)}}class Xp extends Ah.ScaleControl{onAdd(t){return super.onAdd(t)}}class Jp extends Ah.FullscreenControl{onAdd(t){return super.onAdd(t)}}class Yp extends Ah.TerrainControl{onAdd(t){return super.onAdd(t)}}class tf extends Ah.BoxZoomHandler{constructor(t,e){super(t,e)}}class ef extends Ah.ScrollZoomHandler{constructor(t,e){super(t,e)}}class rf extends Ah.CooperativeGesturesHandler{constructor(t,e){super(t,e)}}class nf extends Ah.KeyboardHandler{constructor(t){super(t)}}class of extends Ah.TwoFingersTouchPitchHandler{constructor(t){super(t)}}class sf extends Ah.MapWheelEvent{constructor(t,e,i){super(t,e,i)}}class af extends Ah.MapTouchEvent{constructor(t,e,i){super(t,e,i)}}class lf extends Ah.MapMouseEvent{constructor(t,e,i,r={}){super(t,e,i,r)}}class cf extends Wp{constructor(t={}){super(t),sp(this,"logoURL",""),sp(this,"linkURL",""),this.logoURL=t.logoURL??Ap.maptilerLogoURL,this.linkURL=t.linkURL??Ap.maptilerURL}onAdd(t){this._map=t,this._compact=this.options.compact??!1,this._container=window.document.createElement("div"),this._container.className="maplibregl-ctrl";const e=window.document.createElement("a");return e.style.backgroundRepeat="no-repeat",e.style.cursor="pointer",e.style.display="block",e.style.height="23px",e.style.margin="0 0 -4px -4px",e.style.overflow="hidden",e.style.width="88px",e.style.backgroundImage=`url(${this.logoURL})`,e.style.backgroundSize="100px 30px",e.style.width="100px",e.style.height="30px",e.target="_blank",e.rel="noopener",e.href=this.linkURL,e.setAttribute("aria-label","MapTiler logo"),e.setAttribute("rel","noopener"),this._container.appendChild(e),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}}function uf(t){return t?"string"==typeof t||t instanceof String?!t.startsWith("http")&&t.toLowerCase().includes(".json")?t:Oh(t):t instanceof Nh?t.getExpandedStyleURL():t instanceof Qh?t.getDefaultVariant().getExpandedStyleURL():t:Gh[Vh[0].referenceStyleID].getDefaultVariant().getExpandedStyleURL()}class hf{constructor(){sp(this,"_map"),sp(this,"_container"),sp(this,"_terrainButton"),function(t,e){for(const i of t)"function"==typeof e[i]&&(e[i]=e[i].bind(e))}(["_toggleTerrain","_updateTerrainIcon"],this)}onAdd(t){return this._map=t,this._container=Mp("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=Mp("button","maplibregl-ctrl-terrain",this._container),Mp("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){kp(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}_toggleTerrain(){this._map.hasTerrain()?this._map.disableTerrain():this._map.enableTerrain(),this._updateTerrainIcon()}_updateTerrainIcon(){this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.hasTerrain()?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))}}class df extends Zp{constructor(t={}){super({showCompass:t.showCompass??!0,showZoom:t.showZoom??!0,visualizePitch:t.visualizePitch??!0}),sp(this,"_rotateCompassArrow",(()=>{const t=this.options.visualizePitch?`scale(${Math.min(1.5,1/Math.cos(this._map.transform.pitch*(Math.PI/180))**.5)}) rotateX(${Math.min(70,this._map.transform.pitch)}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=t})),this._compass&&(this._compass.removeEventListener("click",this._compass.clickFunction),this._compass.addEventListener("click",(t=>{0===this._map.getPitch()?this._map.easeTo({pitch:Math.min(this._map.getMaxPitch(),80)}):this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:t}):this._map.resetNorth({},{originalEvent:t})})))}_createButton(t,e){const i=super._createButton(t,e);return i.clickFunction=e,i}}const pf=Ah.Marker,ff=Ah.LngLat,Af=Ah.LngLatBounds;class mf extends qp{constructor(){super(...arguments),sp(this,"lastUpdatedCenter",new ff(0,0)),sp(this,"_updateCamera",(t=>{var e,i;const r=new ff(t.coords.longitude,t.coords.latitude),n=t.coords.accuracy,o={bearing:this._map.getBearing(),...this.options.fitBoundsOptions,linear:!0},s=this._map.getZoom();s>((null==(i=null==(e=this.options)?void 0:e.fitBoundsOptions)?void 0:i.maxZoom)??30)&&(o.zoom=s),this._map.fitBounds(Af.fromLngLat(r,n),o,{geolocateSource:!0});let a=!1;const l=()=>{a=!0};this._map.once("click",l),this._map.once("dblclick",l),this._map.once("dragstart",l),this._map.once("mousedown",l),this._map.once("touchstart",l),this._map.once("wheel",l),this._map.once("moveend",(()=>{this._map.off("click",l),this._map.off("dblclick",l),this._map.off("dragstart",l),this._map.off("mousedown",l),this._map.off("touchstart",l),this._map.off("wheel",l),!a&&(this.lastUpdatedCenter=this._map.getCenter())}))})),sp(this,"_finishSetupUI",(t=>{if(this._map){if(!1===t){const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=t,this._geolocateButton.setAttribute("aria-label",t)}else{const t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=t,this._geolocateButton.setAttribute("aria-label",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Mp("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new pf({element:this._dotElement}),this._circleElement=Mp("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new pf({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("move",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("moveend",(t=>{const e=t.originalEvent&&"resize"===t.originalEvent.type,i=this.lastUpdatedCenter.distanceTo(this._map.getCenter());!t.geolocateSource&&"ACTIVE_LOCK"===this._watchState&&!e&&i>1&&(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new Event("trackuserlocationend")))}))}})),sp(this,"_onZoom",(()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}))}_updateCircleRadius(){if("BACKGROUND"!==this._watchState&&"ACTIVE_LOCK"!==this._watchState)return;const t=[this._lastKnownPosition.coords.longitude,this._lastKnownPosition.coords.latitude],e=this._map.project(t),i=this._map.unproject([e.x,e.y]),r=this._map.unproject([e.x+20,e.y]),n=i.distanceTo(r)/20,o=Math.ceil(2*this._accuracy/n);this._circleElement.style.width=`${o}px`,this._circleElement.style.height=`${o}px`}}var gf,_f,yf,vf,xf,bf,wf,Tf,Bf,Ef;class Cf{constructor(t,e){cp(this,wf),cp(this,gf),sp(this,"map"),cp(this,_f),cp(this,yf),cp(this,vf),cp(this,xf,!1),cp(this,bf),void 0!==t.style&&up(this,xf,!0),up(this,gf,{zoomAdjust:-4,position:"top-right",...e,forceNoAttributionControl:!0,attributionControl:!1,navigationControl:!1,geolocateControl:!1,maptilerLogo:!1,minimap:!1,hash:!1,pitchAdjust:!1,...t,containerStyle:{border:"1px solid #000",width:"400px",height:"300px",...t.containerStyle??{}}}),void 0!==t.lockZoom&&(lp(this,gf).minZoom=t.lockZoom,lp(this,gf).maxZoom=t.lockZoom)}setStyle(t,e){lp(this,xf)||this.map.setStyle(t,e),hp(this,wf,Bf).call(this)}addLayer(t,e){return lp(this,xf)||this.map.addLayer(t,e),hp(this,wf,Bf).call(this),this.map}moveLayer(t,e){return lp(this,xf)||this.map.moveLayer(t,e),hp(this,wf,Bf).call(this),this.map}removeLayer(t){return lp(this,xf)||this.map.removeLayer(t),hp(this,wf,Bf).call(this),this}setLayerZoomRange(t,e,i){return lp(this,xf)||this.map.setLayerZoomRange(t,e,i),hp(this,wf,Bf).call(this),this}setFilter(t,e,i){return lp(this,xf)||this.map.setFilter(t,e,i),hp(this,wf,Bf).call(this),this}setPaintProperty(t,e,i,r){return lp(this,xf)||this.map.setPaintProperty(t,e,i,r),hp(this,wf,Bf).call(this),this}setLayoutProperty(t,e,i,r){return lp(this,xf)||this.map.setLayoutProperty(t,e,i,r),hp(this,wf,Bf).call(this),this}setGlyphs(t,e){return lp(this,xf)||this.map.setGlyphs(t,e),hp(this,wf,Bf).call(this),this}onAdd(t){up(this,_f,t),up(this,yf,Mp("div","maplibregl-ctrl maplibregl-ctrl-group"));for(const[t,e]of Object.entries(lp(this,gf).containerStyle))lp(this,yf).style.setProperty(t,e);return lp(this,gf).container=lp(this,yf),lp(this,gf).zoom=t.getZoom()+lp(this,gf).zoomAdjust,this.map=new If(lp(this,gf)),this.map.once("style.load",(()=>{this.map.resize()})),this.map.once("load",(()=>{hp(this,wf,Tf).call(this,lp(this,gf).parentRect),up(this,bf,hp(this,wf,Ef).call(this))})),lp(this,yf)}onRemove(){var t;null==(t=lp(this,bf))||t.call(this),kp(lp(this,yf))}}gf=new WeakMap,_f=new WeakMap,yf=new WeakMap,vf=new WeakMap,xf=new WeakMap,bf=new WeakMap,wf=new WeakSet,Tf=function(t){void 0===t||void 0===t.linePaint&&void 0===t.fillPaint||(up(this,vf,{type:"Feature",properties:{name:"parentRect"},geometry:{type:"Polygon",coordinates:[[[],[],[],[],[]]]}}),this.map.addSource("parentRect",{type:"geojson",data:lp(this,vf)}),(void 0!==t.lineLayout||void 0!==t.linePaint)&&this.map.addLayer({id:"parentRectOutline",type:"line",source:"parentRect",layout:{...t.lineLayout},paint:{"line-color":"#FFF","line-width":1,"line-opacity":.85,...t.linePaint}}),void 0!==t.fillPaint&&this.map.addLayer({id:"parentRectFill",type:"fill",source:"parentRect",layout:{},paint:{"fill-color":"#08F","fill-opacity":.135,...t.fillPaint}}),hp(this,wf,Bf).call(this))},Bf=function(){if(void 0===lp(this,vf))return;const{devicePixelRatio:t}=window,e=lp(this,_f).getCanvas(),i=e.width/t,r=e.height/t,n=lp(this,_f).unproject.bind(lp(this,_f)),o=n([0,0]),s=n([i,0]),a=n([0,r]),l=n([i,r]);lp(this,vf).geometry.coordinates=[[a.toArray(),l.toArray(),s.toArray(),o.toArray(),a.toArray()]],this.map.getSource("parentRect").setData(lp(this,vf))},Ef=function(){const{pitchAdjust:t}=lp(this,gf),e=()=>{o("parent")},i=()=>{o("minimap")},r=()=>{lp(this,_f).on("move",e),this.map.on("move",i)},n=()=>{lp(this,_f).off("move",e),this.map.off("move",i)},o=e=>{n();const i="parent"===e?lp(this,_f):this.map,o="parent"===e?this.map:lp(this,_f),s=i.getCenter(),a=i.getZoom()+lp(this,gf).zoomAdjust*("parent"===e?1:-1),l=i.getBearing(),c=i.getPitch();o.jumpTo({center:s,zoom:a,bearing:l,pitch:t?c:0}),hp(this,wf,Bf).call(this),r()};return r(),()=>{n()}};const Sf={POINT:"POINT",COUNTRY:"COUNTRY"};class If extends Ah.Map{constructor(t){Dp(t.container),t.apiKey&&(_p.apiKey=t.apiKey);const e=uf(t.style),i=location.hash;_p.apiKey||console.warn("MapTiler Cloud API key is not set. Visit https://maptiler.com and try Cloud for free!");let r={compact:!1};t.customAttribution?r.customAttribution=t.customAttribution:t.attributionControl&&"object"==typeof t.attributionControl&&(r={...r,...t.attributionControl}),super({...t,style:e,maplibreLogo:!1,transformRequest:Lp(t.transformRequest),attributionControl:!0!==t.forceNoAttributionControl&&r}),sp(this,"isTerrainEnabled",!1),sp(this,"terrainExaggeration",1),sp(this,"primaryLanguage"),sp(this,"terrainGrowing",!1),sp(this,"terrainFlattening",!1),sp(this,"minimap"),sp(this,"forceLanguageUpdate"),sp(this,"languageAlwaysBeenStyle"),sp(this,"isReady",!1),_p.caching&&!Tp&&console.warn("The cache API is only available in secure contexts. More info at https://developer.mozilla.org/en-US/docs/Web/API/Cache"),_p.caching&&Tp&&Ip(),this.primaryLanguage=t.language??_p.primaryLanguage,this.forceLanguageUpdate=!(this.primaryLanguage===pp.STYLE||this.primaryLanguage===pp.STYLE_LOCK),this.languageAlwaysBeenStyle=this.primaryLanguage===pp.STYLE,this.terrainExaggeration=t.terrainExaggeration??this.terrainExaggeration,this.once("styledata",(async()=>{if(!t.geolocate||t.center||t.hash&&i)return;try{if(t.geolocate===Sf.COUNTRY)return void await this.fitToIpBounds()}catch(t){console.warn(t.message)}let e;try{await this.centerOnIpPoint(t.zoom),e=this.getCameraHash()}catch(t){console.warn(t.message)}"granted"===(await navigator.permissions.query({name:"geolocation"})).state&&navigator.geolocation.getCurrentPosition((i=>{e===this.getCameraHash()&&(this.terrain?this.easeTo({center:[i.coords.longitude,i.coords.latitude],zoom:t.zoom||12,duration:2e3}):this.once("terrain",(()=>{this.easeTo({center:[i.coords.longitude,i.coords.latitude],zoom:t.zoom||12,duration:2e3})})))}),null,{maximumAge:864e5,timeout:5e3,enableHighAccuracy:!1})})),this.on("styledata",(()=>{this.setPrimaryLanguage(this.primaryLanguage)})),this.on("styledata",(()=>{null===this.getTerrain()&&this.isTerrainEnabled&&this.enableTerrain(this.terrainExaggeration)})),this.once("load",(async()=>{let e={logo:null};try{const t=Object.keys(this.style.sourceCaches).map((t=>this.getSource(t))).filter((t=>t&&"url"in t&&"string"==typeof t.url&&(null==t?void 0:t.url.includes("tiles.json")))),i=new URL(t[0].url);i.searchParams.has("key")||i.searchParams.append("key",_p.apiKey),e=await(await fetch(i.href)).json()}catch{}if(!0!==t.forceNoAttributionControl)if("logo"in e&&e.logo){const i=e.logo;this.addControl(new cf({logoURL:i}),t.logoPosition)}else t.maptilerLogo&&this.addControl(new cf,t.logoPosition);if(t.scaleControl){const e=!0===t.scaleControl||void 0===t.scaleControl?"bottom-right":t.scaleControl,i=new Xp({unit:_p.unit});this.addControl(i,e),_p.on("unit",(t=>{i.setUnit(t)}))}if(!1!==t.navigationControl){const e=!0===t.navigationControl||void 0===t.navigationControl?"top-right":t.navigationControl;this.addControl(new df,e)}if(!1!==t.geolocateControl){const e=!0===t.geolocateControl||void 0===t.geolocateControl?"top-right":t.geolocateControl;this.addControl(new mf({positionOptions:{enableHighAccuracy:!0,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!0,showAccuracyCircle:!0,showUserLocation:!0}),e)}if(t.terrainControl){const e=!0===t.terrainControl||void 0===t.terrainControl?"top-right":t.terrainControl;this.addControl(new hf,e)}if(t.fullscreenControl){const e=!0===t.fullscreenControl||void 0===t.fullscreenControl?"top-right":t.fullscreenControl;this.addControl(new Jp({}),e)}this.isReady=!0,this.fire("ready",{target:this})}));let n,o=!1,s=!1;this.once("ready",(()=>{o=!0,s&&this.fire("loadWithTerrain",n)})),this.once("style.load",(()=>{const{minimap:e}=t;if("object"==typeof e){const{zoom:i,center:r,style:n,language:o,apiKey:s,maptilerLogo:a,antialias:l,refreshExpiredTiles:c,maxBounds:u,scrollZoom:h,minZoom:d,maxZoom:p,boxZoom:f,locale:A,fadeDuration:m,crossSourceCollisions:g,clickTolerance:_,bounds:y,fitBoundsOptions:v,pixelRatio:x,validateStyle:b}=t;this.minimap=new Cf(e,{zoom:i,center:r,style:n,language:o,apiKey:s,container:"null",maptilerLogo:a,antialias:l,refreshExpiredTiles:c,maxBounds:u,scrollZoom:h,minZoom:d,maxZoom:p,boxZoom:f,locale:A,fadeDuration:m,crossSourceCollisions:g,clickTolerance:_,bounds:y,fitBoundsOptions:v,pixelRatio:x,validateStyle:b}),this.addControl(this.minimap,e.position??"bottom-left")}else!0===e?(this.minimap=new Cf({},t),this.addControl(this.minimap,"bottom-left")):void 0!==e&&!1!==e&&(this.minimap=new Cf({},t),this.addControl(this.minimap,e))}));const a=t=>{t.terrain&&(s=!0,n={type:"loadWithTerrain",target:this,terrain:t.terrain},this.off("terrain",a),o&&this.fire("loadWithTerrain",n))};this.on("terrain",a),t.terrain&&this.enableTerrain(t.terrainExaggeration??this.terrainExaggeration)}async onLoadAsync(){return new Promise((t=>{if(this.loaded())return t(this);this.once("load",(()=>{t(this)}))}))}async onReadyAsync(){return new Promise((t=>{if(this.isReady)return t(this);this.once("ready",(()=>{t(this)}))}))}async onLoadWithTerrainAsync(){return new Promise((t=>{if(this.isReady&&this.terrain)return t(this);this.once("loadWithTerrain",(()=>{t(this)}))}))}setStyle(t,e){var i;return null==(i=this.minimap)||i.setStyle(t),this.forceLanguageUpdate=!0,this.once("idle",(()=>{this.forceLanguageUpdate=!1})),super.setStyle(uf(t),e)}addLayer(t,e){var i;return null==(i=this.minimap)||i.addLayer(t,e),super.addLayer(t,e)}moveLayer(t,e){var i;return null==(i=this.minimap)||i.moveLayer(t,e),super.moveLayer(t,e)}removeLayer(t){var e;return null==(e=this.minimap)||e.removeLayer(t),super.removeLayer(t)}setLayerZoomRange(t,e,i){var r;return null==(r=this.minimap)||r.setLayerZoomRange(t,e,i),super.setLayerZoomRange(t,e,i)}setFilter(t,e,i){var r;return null==(r=this.minimap)||r.setFilter(t,e,i),super.setFilter(t,e,i)}setPaintProperty(t,e,i,r){var n;return null==(n=this.minimap)||n.setPaintProperty(t,e,i,r),super.setPaintProperty(t,e,i,r)}setLayoutProperty(t,e,i,r){var n;return null==(n=this.minimap)||n.setLayoutProperty(t,e,i,r),super.setLayoutProperty(t,e,i,r)}setGlyphs(t,e){var i;return null==(i=this.minimap)||i.setGlyphs(t,e),super.setGlyphs(t,e)}getStyleLanguage(){return this.style.stylesheet.metadata&&"object"==typeof this.style.stylesheet.metadata&&"maptiler:language"in this.style.stylesheet.metadata&&"string"==typeof this.style.stylesheet.metadata["maptiler:language"]?xh(this.style.stylesheet.metadata["maptiler:language"]):null}setLanguage(t){var e,i;null==(i=null==(e=this.minimap)?void 0:e.map)||i.setLanguage(t),this.onStyleReady((()=>{this.setPrimaryLanguage(t)}))}setPrimaryLanguage(t){const e=this.getStyleLanguage(),i=Th(t,pp);if(!i)return void console.warn(`The language "${i}" is not supported.`);if((i.flag!==pp.STYLE.flag||!e||e.flag!==pp.AUTO.flag&&e.flag!==pp.VISITOR.flag)&&(i.flag!==pp.STYLE.flag&&(this.languageAlwaysBeenStyle=!1),this.languageAlwaysBeenStyle||this.primaryLanguage===i&&!this.forceLanguageUpdate))return;if(this.primaryLanguage.flag===pp.STYLE_LOCK.flag)return void console.warn("The language cannot be changed because this map has been instantiated with the STYLE_LOCK language flag.");this.primaryLanguage=i;let r=i;if(i.flag===pp.STYLE.flag){if(!e)return void console.warn("The style has no default languages or has an invalid one.");r=e}let n=pp.LOCAL.flag,o=`{${n}}`;r.flag===pp.VISITOR.flag?(n=fp().flag,o=["case",["all",["has",n],["has",pp.LOCAL.flag]],["case",["==",["get",n],["get",pp.LOCAL.flag]],["get",pp.LOCAL.flag],["format",["get",n],{"font-scale":.8},"\n",["get",pp.LOCAL.flag],{"font-scale":1.1}]],["get",pp.LOCAL.flag]]):r.flag===pp.VISITOR_ENGLISH.flag?(n=pp.ENGLISH.flag,o=["case",["all",["has",n],["has",pp.LOCAL.flag]],["case",["==",["get",n],["get",pp.LOCAL.flag]],["get",pp.LOCAL.flag],["format",["get",n],{"font-scale":.8},"\n",["get",pp.LOCAL.flag],{"font-scale":1.1}]],["get",pp.LOCAL.flag]]):r.flag===pp.AUTO.flag?(n=fp().flag,o=["case",["has",n],["get",n],["get",pp.LOCAL.flag]]):r===pp.LOCAL?(n=pp.LOCAL.flag,o=`{${n}}`):(n=r.flag,o=["case",["has",n],["get",n],["get",pp.LOCAL.flag]]);const{layers:s}=this.getStyle();for(const t of s){if("symbol"!==t.type)continue;const e=t,i=this.getSource(e.source);if(!i||!("url"in i)||"string"!=typeof i.url||new URL(i.url).host!==Ap.maptilerApiHost)continue;const{id:r,layout:n}=e;if(!n||!("text-field"in n))continue;const s=this.getLayoutProperty(r,"text-field");"string"==typeof s&&(s.toLowerCase().includes("ref")||s.toLowerCase().includes("housenumber"))||this.setLayoutProperty(r,"text-field",o)}}getPrimaryLanguage(){return this.primaryLanguage}getTerrainExaggeration(){return this.terrainExaggeration}hasTerrain(){return this.isTerrainEnabled}growTerrain(t,e=1e3){if(!this.terrain)return;const i=performance.now(),r=this.terrain.exaggeration,n=t-r,o=()=>{if(!this.terrain||this.terrainFlattening)return;const s=(performance.now()-i)/e;if(s<.99){const t=r+(1-(1-s)**4)*n;this.terrain.exaggeration=t,requestAnimationFrame(o)}else this.terrainGrowing=!1,this.terrainFlattening=!1,this.terrain.exaggeration=t;this._elevationFreeze=!1,this.triggerRepaint()};this.terrainGrowing=!0,this.terrainFlattening=!1,requestAnimationFrame(o)}enableTerrain(t=this.terrainExaggeration){if(t<0)return void console.warn("Terrain exaggeration cannot be negative.");const e=async i=>{!this.terrain||"data"!==i.type||"source"!==i.dataType||!("source"in i)||"maptiler-terrain"!==i.sourceId||"raster-dem"!==i.source.type||i.isSourceLoaded&&(this.off("data",e),this.growTerrain(t))},i=()=>{this.isTerrainEnabled=!0,this.terrainExaggeration=t,this.on("data",e),this.addSource(Ap.terrainSourceId,{type:"raster-dem",url:Ap.terrainSourceURL}),this.setTerrain({source:Ap.terrainSourceId,exaggeration:0})};if(this.getTerrain())return this.isTerrainEnabled=!0,void this.growTerrain(t);this.loaded()||this.isTerrainEnabled?i():this.once("load",(()=>{this.getTerrain()&&this.getSource(Ap.terrainSourceId)||i()}))}disableTerrain(){if(!this.terrain)return;this.isTerrainEnabled=!1;const t=performance.now(),e=this.terrain.exaggeration,i=()=>{if(!this.terrain||this.terrainGrowing)return;const r=(performance.now()-t)/1e3;if(this._elevationFreeze=!1,r<.99){const t=e*(1-r)**4;this.terrain.exaggeration=t,requestAnimationFrame(i)}else this.terrain.exaggeration=0,this.terrainGrowing=!1,this.terrainFlattening=!1,this.setTerrain(),this.getSource(Ap.terrainSourceId)&&this.removeSource(Ap.terrainSourceId);this.triggerRepaint()};this.terrainGrowing=!1,this.terrainFlattening=!0,requestAnimationFrame(i)}setTerrainExaggeration(t,e=!0){!e&&this.terrain?(this.terrainExaggeration=t,this.terrain.exaggeration=t,this.triggerRepaint()):this.enableTerrain(t)}onStyleReady(t){this.isStyleLoaded()?t():this.once("styledata",(()=>{t()}))}async fitToIpBounds(){const t=await zh.info();this.fitBounds(t.country_bounds,{duration:0,padding:100})}async centerOnIpPoint(t){const e=await zh.info();this.jumpTo({center:[(null==e?void 0:e.longitude)??0,(null==e?void 0:e.latitude)??0],zoom:t||11})}getCameraHash(){const t=new Float32Array(5),e=this.getCenter();return t[0]=e.lng,t[1]=e.lat,t[2]=this.getZoom(),t[3]=this.getPitch(),t[4]=this.getBearing(),rp(new Uint8Array(t.buffer))}getSdkConfig(){return _p}getMaptilerSessionId(){return mp}setTransformRequest(t){return super.setTransformRequest(Lp(t)),this}}function Mf(t){if(typeof DOMParser<"u"){const e=(new DOMParser).parseFromString(t,"application/xml");if(e.querySelector("parsererror"))throw new Error("The provided string is not valid XML");return e}throw new Error("No XML parser found")}function kf(t,e){if(!t.hasChildNodes())return!1;for(const i of Array.from(t.childNodes)){const t=i.nodeName;if("string"==typeof t&&t.trim().toLowerCase()===e.toLowerCase())return!0}return!1}function Pf(t){if(typeof XMLSerializer<"u")return(new XMLSerializer).serializeToString(t);throw new Error("No XML serializer found")}function Lf(t){const e="string"==typeof t?Mf(t):t;if(!kf(e,"gpx"))throw new Error("The XML document is not valid GPX");const i=Zf(e,"trk"),r=Zf(e,"rte"),n=Zf(e,"wpt"),o={type:"FeatureCollection",features:[]};for(const t of Array.from(i)){const e=Qf(t);e&&o.features.push(e)}for(const t of Array.from(r)){const e=Vf(t);e&&o.features.push(e)}for(const t of Array.from(n))o.features.push(jf(t));return o}function zf(t,e){let i=t;if("string"==typeof i&&(i=Mf(i)),!kf(i,"kml"))throw new Error("The XML document is not valid KML");const r={type:"FeatureCollection",features:[]},n={},o={},s={},a=Zf(i,"Placemark"),l=Zf(i,"Style"),c=Zf(i,"StyleMap");for(const t of Array.from(l)){const i=$f(void 0!==e?e(t):Pf(t)).toString(16);n[`#${qf(t,"id")}`]=i,o[i]=t}for(const t of Array.from(c)){n[`#${qf(t,"id")}`]=$f(void 0!==e?e(t):Pf(t)).toString(16);const i=Zf(t,"Pair"),r={};for(const t of Array.from(i))r[Jf(Wf(t,"key"))??""]=Jf(Wf(t,"styleUrl"));s[`#${qf(t,"id")}`]=r}for(const t of Array.from(a))r.features=r.features.concat(Of(t,n,o,s));return r}function Ff(t){if(null===t)return["#000000",1];let e="",i=1,r=t;return"#"===r.substring(0,1)&&(r=r.substring(1)),(6===r.length||3===r.length)&&(e=r),8===r.length&&(i=Number.parseInt(r.substring(0,2),16)/255,e=`#${r.substring(6,8)}${r.substring(4,6)}${r.substring(2,4)}`),[e??"#000000",i??1]}function Df(t){return Xf(t.split(" "))}function Rf(t){let e=Zf(t,"coord");const i=[],r=[];0===e.length&&(e=Zf(t,"gx:coord"));for(const t of Array.from(e))i.push(Df(Jf(t)??""));const n=Zf(t,"when");for(const t of Array.from(n))r.push(Jf(t));return{coords:i,times:r}}function Uf(t){const e=["Polygon","LineString","Point","Track","gx:Track"];let i,r,n,o,s;const a=[],l=[];if(null!==Wf(t,"MultiGeometry"))return Uf(Wf(t,"MultiGeometry"));if(null!==Wf(t,"MultiTrack"))return Uf(Wf(t,"MultiTrack"));if(null!==Wf(t,"gx:MultiTrack"))return Uf(Wf(t,"gx:MultiTrack"));for(n=0;n<e.length;n++)if(r=Zf(t,e[n]),r)for(o=0;o<r.length;o++)if(i=r[o],"Point"===e[n])a.push({type:"Point",coordinates:tA(Jf(Wf(i,"coordinates"))??"")});else if("LineString"===e[n])a.push({type:"LineString",coordinates:eA(Jf(Wf(i,"coordinates"))??"")});else if("Polygon"===e[n]){const t=Zf(i,"LinearRing"),e=[];for(s=0;s<t.length;s++)e.push(eA(Jf(Wf(t[s],"coordinates"))??""));a.push({type:"Polygon",coordinates:e})}else if("Track"===e[n]||"gx:Track"===e[n]){const t=Rf(i);a.push({type:"LineString",coordinates:t.coords}),t.times.length&&l.push(t.times)}return{geoms:a,coordTimes:l}}function Of(t,e,i,r){const n=Uf(t),o={},s=Jf(Wf(t,"name")),a=Jf(Wf(t,"address")),l=Jf(Wf(t,"description")),c=Wf(t,"TimeSpan"),u=Wf(t,"TimeStamp"),h=Wf(t,"ExtendedData"),d=Wf(t,"visibility");let p,f=Jf(Wf(t,"styleUrl")),A=Wf(t,"LineStyle"),m=Wf(t,"PolyStyle");if(!n.geoms.length)return[];if(s&&(o.name=s),a&&(o.address=a),f){"#"!==f[0]&&(f=`#${f}`),o.styleUrl=f,e[f]&&(o.styleHash=e[f]),r[f]&&(o.styleMapHash=r[f],o.styleHash=e[r[f].normal??""]);const t=i[o.styleHash??""];if(t){A||(A=Wf(t,"LineStyle")),m||(m=Wf(t,"PolyStyle"));const e=Wf(t,"IconStyle");if(e){const t=Wf(e,"Icon");if(t){const e=Jf(Wf(t,"href"));e&&(o.icon=e)}}}}if(l&&(o.description=l),c){const t=Jf(Wf(c,"begin")),e=Jf(Wf(c,"end"));t&&e&&(o.timespan={begin:t,end:e})}if(null!==u&&(o.timestamp=Jf(Wf(u,"when"))??(new Date).toISOString()),null!==A){const t=Ff(Jf(Wf(A,"color"))),e=t[0],i=t[1],r=Number.parseFloat(Jf(Wf(A,"width"))??"");e&&(o.stroke=e),Number.isNaN(i)||(o["stroke-opacity"]=i),Number.isNaN(r)||(o["stroke-width"]=r)}if(m){const t=Ff(Jf(Wf(m,"color"))),e=t[0],i=t[1],r=Jf(Wf(m,"fill")),n=Jf(Wf(m,"outline"));e&&(o.fill=e),Number.isNaN(i)||(o["fill-opacity"]=i),r&&(o["fill-opacity"]="1"===r?o["fill-opacity"]||1:0),n&&(o["stroke-opacity"]="1"===n?o["stroke-opacity"]||1:0)}if(h){const t=Zf(h,"Data"),e=Zf(h,"SimpleData");for(p=0;p<t.length;p++)o[t[p].getAttribute("name")??""]=Jf(Wf(t[p],"value"))??"";for(p=0;p<e.length;p++)o[e[p].getAttribute("name")??""]=Jf(e[p])??""}null!==d&&(o.visibility=Jf(d)??""),0!==n.coordTimes.length&&(o.coordTimes=1===n.coordTimes.length?n.coordTimes[0]:n.coordTimes);const g={type:"Feature",geometry:1===n.geoms.length?n.geoms[0]:{type:"GeometryCollection",geometries:n.geoms},properties:o};return qf(t,"id")&&(g.id=qf(t,"id")??void 0),[g]}function Nf(t,e){const i=Zf(t,e),r=[],n=[];let o=[];const s=i.length;if(!(s<2)){for(let t=0;t<s;t++){const e=iA(i[t]);r.push(e.coordinates),e.time&&n.push(e.time),(e.heartRate||o.length)&&(0===o.length&&(o=new Array(t).fill(null)),o.push(e.heartRate))}return{line:r,times:n,heartRates:o}}}function Qf(t){const e=Zf(t,"trkseg"),i=[],r=[],n=[];let o;for(let t=0;t<e.length;t++)if(o=Nf(e[t],"trkpt"),void 0!==o&&(o.line&&i.push(o.line),o.times&&o.times.length&&r.push(o.times),n.length||o.heartRates&&o.heartRates.length)){if(!n.length)for(let e=0;e<t;e++)n.push(new Array(i[e].length).fill(null));o.heartRates&&o.heartRates.length?n.push(o.heartRates):n.push(new Array(o.line.length).fill(null))}if(0===i.length)return;const s={...Gf(t),...Hf(Wf(t,"extensions"))};return 0!==r.length&&(s.coordTimes=1===i.length?r[0]:r),0!==n.length&&(s.heartRates=1===i.length?n[0]:n),1===i.length?{type:"Feature",properties:s,geometry:{type:"LineString",coordinates:i[0]}}:{type:"Feature",properties:s,geometry:{type:"MultiLineString",coordinates:i}}}function Vf(t){const e=Nf(t,"rtept");return void 0===e?void 0:{type:"Feature",properties:{...Gf(t),...Hf(Wf(t,"extensions"))},geometry:{type:"LineString",coordinates:e.line}}}function jf(t){return{type:"Feature",properties:{...Gf(t),...Yf(t,["sym"])},geometry:{type:"Point",coordinates:iA(t).coordinates}}}function Hf(t){const e={};if(t){const i=Wf(t,"line");if(i){const t=Jf(Wf(i,"color")),r=Number.parseFloat(Jf(Wf(i,"opacity"))??"0"),n=Number.parseFloat(Jf(Wf(i,"width"))??"0");t&&(e.stroke=t),Number.isNaN(r)||(e["stroke-opacity"]=r),Number.isNaN(n)||(e["stroke-width"]=96*n/25.4)}}return e}function Gf(t){const e=Yf(t,["name","cmt","desc","type","time","keywords"]),i=Zf(t,"link");if(0!==i.length){e.links=[];for(const t of Array.from(i)){const i={href:qf(t,"href"),...Yf(t,["text","type"])};e.links.push(i)}}return e}function $f(t){let e=0;if(!t||!t.length)return e;for(let i=0;i<t.length;i++)e=(e<<5)-e+t.charCodeAt(i)|0;return e}function Zf(t,e){return t.getElementsByTagName(e)}function qf(t,e){return t.getAttribute(e)}function Kf(t,e){return Number.parseFloat(qf(t,e)??"0")}function Wf(t,e){const i=Zf(t,e);return i.length?i[0]:null}function Xf(t){return t.map(Number.parseFloat).map((t=>Number.isNaN(t)?null:t))}function Jf(t){return t&&function(t){t.normalize&&t.normalize()}(t),t&&t.textContent}function Yf(t,e){const i={};let r,n;for(n=0;n<e.length;n++)r=Wf(t,e[n]),r&&(i[e[n]]=Jf(r)??"");return i}function tA(t){return Xf(t.replace(/\s*/g,"").split(","))}function eA(t){const e=t.replace(/^\s*|\s*$/g,"").split(/\s+/),i=[];for(const t of e)i.push(tA(t));return i}function iA(t){const e=[Kf(t,"lon"),Kf(t,"lat")],i=Wf(t,"ele"),r=Wf(t,"gpxtpx:hr")||Wf(t,"hr"),n=Wf(t,"time");let o;return i&&(o=Number.parseFloat(Jf(i)??"0"),Number.isNaN(o)||e.push(o)),{coordinates:e,time:n?Jf(n):null,heartRate:null!==r?Number.parseFloat(Jf(r)??"0"):null}}function rA(t){let e=t;try{"string"==typeof e&&(e=Mf(e))}catch{return null}try{return Lf(e)}catch{}try{return zf(e)}catch{}return null}function nA(t){const e=t.toString(16);return 1===e.length?`0${e}`:e}class oA extends Array{constructor(t={}){super(),sp(this,"min",0),sp(this,"max",1),"min"in t&&(this.min=t.min),"max"in t&&(this.max=t.max),"stops"in t&&this.setStops(t.stops,{clone:!1})}static fromArrayDefinition(t){return new oA({stops:t.map((t=>({value:t[0],color:t[1]})))})}setStops(t,e={clone:!0}){const i=e.clone?this.clone():this;i.length=0;let r=Number.POSITIVE_INFINITY,n=Number.NEGATIVE_INFINITY;for(let e=0;e<t.length;e+=1)r=Math.min(r,t[e].value),n=Math.max(n,t[e].value),i.push({value:t[e].value,color:t[e].color.slice()});return i.sort(((t,e)=>t.value<e.value?-1:1)),this.min=r,this.max=n,i}scale(t,e,i={clone:!0}){const r=i.clone,n=this[0].value,o=this.at(-1).value-n,s=e-t,a=[];for(let e=0;e<this.length;e+=1){const i=(this[e].value-n)/o*s+t;r?a.push({value:i,color:this[e].color.slice()}):this[e].value=i}return r?new oA({stops:a}):this}at(t){return t<0?this[this.length+t]:this[t]}clone(){return new oA({stops:this.getRawColorStops()})}getRawColorStops(){const t=[];for(let e=0;e<this.length;e+=1)t.push({value:this[e].value,color:this[e].color});return t}reverse(t={clone:!0}){const e=t.clone?this.clone():this;for(let t=0;t<~~(e.length/2);t+=1){const i=e[t].color;e[t].color=e.at(-(t+1)).color,e.at(-(t+1)).color=i}return e}getBounds(){return{min:this.min,max:this.max}}getColor(t,e={smooth:!0}){if(t<=this[0].value)return this[0].color;if(t>=this.at(-1).value)return this.at(-1).color;for(let i=0;i<this.length-1;i+=1){if(t>this[i+1].value)continue;const r=this[i].color;if(!e.smooth)return r.slice();const n=this[i].value,o=this[i+1].value,s=this[i+1].color,a=(o-t)/(o-n);return r.map(((t,e)=>Math.round(t*a+s[e]*(1-a))))}return[0,0,0]}getColorHex(t,e={smooth:!0,withAlpha:!1}){return`#${nA((i=this.getColor(t,e))[0])}${nA(i[1])}${nA(i[2])}${4===i.length?nA(i[3]):""}`;var i}getColorRelative(t,e={smooth:!0}){const i=this.getBounds();return this.getColor(i.min+t*(i.max-i.min),e)}getCanvasStrip(t={horizontal:!0,size:512,smooth:!0}){const e=document.createElement("canvas");e.width=t.horizontal?t.size:1,e.height=t.horizontal?1:t.size;const i=e.getContext("2d");if(!i)throw new Error("Canvs context is missing");const r=i.getImageData(0,0,e.width,e.height),n=r.data,o=t.size,s=this[0].value,a=(this.at(-1).value-s)/o;for(let e=0;e<o;e+=1){const i=this.getColor(s+e*a,{smooth:t.smooth});n[4*e]=i[0],n[4*e+1]=i[1],n[4*e+2]=i[2],n[4*e+3]=i.length>3?i[3]:255}return i.putImageData(r,0,0),e}resample(t,e=15){const i=this.getBounds(),r=this.scale(0,1),n=1/(e-1);let o;if("ease-in-square"===t)o=Array.from({length:e},((t,e)=>{const i=e*n,o=i**2;return{value:i,color:r.getColor(o)}}));else if("ease-out-square"===t)o=Array.from({length:e},((t,e)=>{const i=e*n,o=1-(1-i)**2;return{value:i,color:r.getColor(o)}}));else if("ease-out-sqrt"===t)o=Array.from({length:e},((t,e)=>{const i=e*n,o=i**.5;return{value:i,color:r.getColor(o)}}));else if("ease-in-sqrt"===t)o=Array.from({length:e},((t,e)=>{const i=e*n,o=1-(1-i)**.5;return{value:i,color:r.getColor(o)}}));else if("ease-out-exp"===t)o=Array.from({length:e},((t,e)=>{const i=e*n,o=1-2**(-10*i);return{value:i,color:r.getColor(o)}}));else{if("ease-in-exp"!==t)throw new Error("Invalid ressampling method.");o=Array.from({length:e},((t,e)=>{const i=e*n,o=2**(10*i-10);return{value:i,color:r.getColor(o)}}))}return new oA({stops:o}).scale(i.min,i.max)}transparentStart(){const t=this.getRawColorStops();t.unshift({value:t[0].value,color:t[0].color.slice()}),t[1].value+=.001;for(const e of t)3===e.color.length&&e.color.push(255);return t[0].color[3]=0,new oA({stops:t})}hasTransparentStart(){return 4===this[0].color.length&&0===this[0].color[3]}}const sA={NULL:new oA({stops:[{value:0,color:[0,0,0,0]},{value:1,color:[0,0,0,0]}]}),GRAY:new oA({stops:[{value:0,color:[0,0,0]},{value:1,color:[255,255,255]}]}),JET:new oA({stops:[{value:0,color:[0,0,131]},{value:.125,color:[0,60,170]},{value:.375,color:[5,255,255]},{value:.625,color:[255,255,0]},{value:.875,color:[250,0,0]},{value:1,color:[128,0,0]}]}),HSV:new oA({stops:[{value:0,color:[255,0,0]},{value:.169,color:[253,255,2]},{value:.173,color:[247,255,2]},{value:.337,color:[0,252,4]},{value:.341,color:[0,252,10]},{value:.506,color:[1,249,255]},{value:.671,color:[2,0,253]},{value:.675,color:[8,0,253]},{value:.839,color:[255,0,251]},{value:.843,color:[255,0,245]},{value:1,color:[255,0,6]}]}),HOT:new oA({stops:[{value:0,color:[0,0,0]},{value:.3,color:[230,0,0]},{value:.6,color:[255,210,0]},{value:1,color:[255,255,255]}]}),SPRING:new oA({stops:[{value:0,color:[255,0,255]},{value:1,color:[255,255,0]}]}),SUMMER:new oA({stops:[{value:0,color:[0,128,102]},{value:1,color:[255,255,102]}]}),AUTOMN:new oA({stops:[{value:0,color:[255,0,0]},{value:1,color:[255,255,0]}]}),WINTER:new oA({stops:[{value:0,color:[0,0,255]},{value:1,color:[0,255,128]}]}),BONE:new oA({stops:[{value:0,color:[0,0,0]},{value:.376,color:[84,84,116]},{value:.753,color:[169,200,200]},{value:1,color:[255,255,255]}]}),COPPER:new oA({stops:[{value:0,color:[0,0,0]},{value:.804,color:[255,160,102]},{value:1,color:[255,199,127]}]}),GREYS:new oA({stops:[{value:0,color:[0,0,0]},{value:1,color:[255,255,255]}]}),YIGNBU:new oA({stops:[{value:0,color:[8,29,88]},{value:.125,color:[37,52,148]},{value:.25,color:[34,94,168]},{value:.375,color:[29,145,192]},{value:.5,color:[65,182,196]},{value:.625,color:[127,205,187]},{value:.75,color:[199,233,180]},{value:.875,color:[237,248,217]},{value:1,color:[255,255,217]}]}),GREENS:new oA({stops:[{value:0,color:[0,68,27]},{value:.125,color:[0,109,44]},{value:.25,color:[35,139,69]},{value:.375,color:[65,171,93]},{value:.5,color:[116,196,118]},{value:.625,color:[161,217,155]},{value:.75,color:[199,233,192]},{value:.875,color:[229,245,224]},{value:1,color:[247,252,245]}]}),YIORRD:new oA({stops:[{value:0,color:[128,0,38]},{value:.125,color:[189,0,38]},{value:.25,color:[227,26,28]},{value:.375,color:[252,78,42]},{value:.5,color:[253,141,60]},{value:.625,color:[254,178,76]},{value:.75,color:[254,217,118]},{value:.875,color:[255,237,160]},{value:1,color:[255,255,204]}]}),BLUERED:new oA({stops:[{value:0,color:[0,0,255]},{value:1,color:[255,0,0]}]}),RDBU:new oA({stops:[{value:0,color:[5,10,172]},{value:.35,color:[106,137,247]},{value:.5,color:[190,190,190]},{value:.6,color:[220,170,132]},{value:.7,color:[230,145,90]},{value:1,color:[178,10,28]}]}),PICNIC:new oA({stops:[{value:0,color:[0,0,255]},{value:.1,color:[51,153,255]},{value:.2,color:[102,204,255]},{value:.3,color:[153,204,255]},{value:.4,color:[204,204,255]},{value:.5,color:[255,255,255]},{value:.6,color:[255,204,255]},{value:.7,color:[255,153,255]},{value:.8,color:[255,102,204]},{value:.9,color:[255,102,102]},{value:1,color:[255,0,0]}]}),RAINBOW:new oA({stops:[{value:0,color:[150,0,90]},{value:.125,color:[0,0,200]},{value:.25,color:[0,25,255]},{value:.375,color:[0,152,255]},{value:.5,color:[44,255,150]},{value:.625,color:[151,255,0]},{value:.75,color:[255,234,0]},{value:.875,color:[255,111,0]},{value:1,color:[255,0,0]}]}),PORTLAND:new oA({stops:[{value:0,color:[12,51,131]},{value:.25,color:[10,136,186]},{value:.5,color:[242,211,56]},{value:.75,color:[242,143,56]},{value:1,color:[217,30,30]}]}),BLACKBODY:new oA({stops:[{value:0,color:[0,0,0]},{value:.2,color:[230,0,0]},{value:.4,color:[230,210,0]},{value:.7,color:[255,255,255]},{value:1,color:[160,200,255]}]}),EARTH:new oA({stops:[{value:0,color:[0,0,130]},{value:.1,color:[0,180,180]},{value:.2,color:[40,210,40]},{value:.4,color:[230,230,50]},{value:.6,color:[120,70,20]},{value:1,color:[255,255,255]}]}),ELECTRIC:new oA({stops:[{value:0,color:[0,0,0]},{value:.15,color:[30,0,100]},{value:.4,color:[120,0,100]},{value:.6,color:[160,90,0]},{value:.8,color:[230,200,0]},{value:1,color:[255,250,220]}]}),VIRIDIS:new oA({stops:[{value:0,color:[68,1,84]},{value:.13,color:[71,44,122]},{value:.25,color:[59,81,139]},{value:.38,color:[44,113,142]},{value:.5,color:[33,144,141]},{value:.63,color:[39,173,129]},{value:.75,color:[92,200,99]},{value:.88,color:[170,220,50]},{value:1,color:[253,231,37]}]}),INFERNO:new oA({stops:[{value:0,color:[0,0,4]},{value:.13,color:[31,12,72]},{value:.25,color:[85,15,109]},{value:.38,color:[136,34,106]},{value:.5,color:[186,54,85]},{value:.63,color:[227,89,51]},{value:.75,color:[249,140,10]},{value:.88,color:[249,201,50]},{value:1,color:[252,255,164]}]}),MAGMA:new oA({stops:[{value:0,color:[0,0,4]},{value:.13,color:[28,16,68]},{value:.25,color:[79,18,123]},{value:.38,color:[129,37,129]},{value:.5,color:[181,54,122]},{value:.63,color:[229,80,100]},{value:.75,color:[251,135,97]},{value:.88,color:[254,194,135]},{value:1,color:[252,253,191]}]}),PLASMA:new oA({stops:[{value:0,color:[13,8,135]},{value:.13,color:[75,3,161]},{value:.25,color:[125,3,168]},{value:.38,color:[168,34,150]},{value:.5,color:[203,70,121]},{value:.63,color:[229,107,93]},{value:.75,color:[248,148,65]},{value:.88,color:[253,195,40]},{value:1,color:[240,249,33]}]}),WARM:new oA({stops:[{value:0,color:[125,0,179]},{value:.13,color:[172,0,187]},{value:.25,color:[219,0,170]},{value:.38,color:[255,0,130]},{value:.5,color:[255,63,74]},{value:.63,color:[255,123,0]},{value:.75,color:[234,176,0]},{value:.88,color:[190,228,0]},{value:1,color:[147,255,0]}]}),COOL:new oA({stops:[{value:0,color:[125,0,179]},{value:.13,color:[116,0,218]},{value:.25,color:[98,74,237]},{value:.38,color:[68,146,231]},{value:.5,color:[0,204,197]},{value:.63,color:[0,247,146]},{value:.75,color:[0,255,88]},{value:.88,color:[40,255,8]},{value:1,color:[147,255,0]}]}),RAINBOW_SOFT:new oA({stops:[{value:0,color:[125,0,179]},{value:.1,color:[199,0,180]},{value:.2,color:[255,0,121]},{value:.3,color:[255,108,0]},{value:.4,color:[222,194,0]},{value:.5,color:[150,255,0]},{value:.6,color:[0,255,55]},{value:.7,color:[0,246,150]},{value:.8,color:[50,167,222]},{value:.9,color:[103,51,235]},{value:1,color:[124,0,186]}]}),BATHYMETRY:new oA({stops:[{value:0,color:[40,26,44]},{value:.13,color:[59,49,90]},{value:.25,color:[64,76,139]},{value:.38,color:[63,110,151]},{value:.5,color:[72,142,158]},{value:.63,color:[85,174,163]},{value:.75,color:[120,206,163]},{value:.88,color:[187,230,172]},{value:1,color:[253,254,204]}]}),CDOM:new oA({stops:[{value:0,color:[47,15,62]},{value:.13,color:[87,23,86]},{value:.25,color:[130,28,99]},{value:.38,color:[171,41,96]},{value:.5,color:[206,67,86]},{value:.63,color:[230,106,84]},{value:.75,color:[242,149,103]},{value:.88,color:[249,193,135]},{value:1,color:[254,237,176]}]}),CHLOROPHYLL:new oA({stops:[{value:0,color:[18,36,20]},{value:.13,color:[25,63,41]},{value:.25,color:[24,91,59]},{value:.38,color:[13,119,72]},{value:.5,color:[18,148,80]},{value:.63,color:[80,173,89]},{value:.75,color:[132,196,122]},{value:.88,color:[175,221,162]},{value:1,color:[215,249,208]}]}),DENSITY:new oA({stops:[{value:0,color:[54,14,36]},{value:.13,color:[89,23,80]},{value:.25,color:[110,45,132]},{value:.38,color:[120,77,178]},{value:.5,color:[120,113,213]},{value:.63,color:[115,151,228]},{value:.75,color:[134,185,227]},{value:.88,color:[177,214,227]},{value:1,color:[230,241,241]}]}),FREESURFACE_BLUE:new oA({stops:[{value:0,color:[30,4,110]},{value:.13,color:[47,14,176]},{value:.25,color:[41,45,236]},{value:.38,color:[25,99,212]},{value:.5,color:[68,131,200]},{value:.63,color:[114,156,197]},{value:.75,color:[157,181,203]},{value:.88,color:[200,208,216]},{value:1,color:[241,237,236]}]}),FREESURFACE_RED:new oA({stops:[{value:0,color:[60,9,18]},{value:.13,color:[100,17,27]},{value:.25,color:[142,20,29]},{value:.38,color:[177,43,27]},{value:.5,color:[192,87,63]},{value:.63,color:[205,125,105]},{value:.75,color:[216,162,148]},{value:.88,color:[227,199,193]},{value:1,color:[241,237,236]}]}),OXYGEN:new oA({stops:[{value:0,color:[64,5,5]},{value:.13,color:[106,6,15]},{value:.25,color:[144,26,7]},{value:.38,color:[168,64,3]},{value:.5,color:[188,100,4]},{value:.63,color:[206,136,11]},{value:.75,color:[220,174,25]},{value:.88,color:[231,215,44]},{value:1,color:[248,254,105]}]}),PAR:new oA({stops:[{value:0,color:[51,20,24]},{value:.13,color:[90,32,35]},{value:.25,color:[129,44,34]},{value:.38,color:[159,68,25]},{value:.5,color:[182,99,19]},{value:.63,color:[199,134,22]},{value:.75,color:[212,171,35]},{value:.88,color:[221,210,54]},{value:1,color:[225,253,75]}]}),PHASE:new oA({stops:[{value:0,color:[145,105,18]},{value:.13,color:[184,71,38]},{value:.25,color:[186,58,115]},{value:.38,color:[160,71,185]},{value:.5,color:[110,97,218]},{value:.63,color:[50,123,164]},{value:.75,color:[31,131,110]},{value:.88,color:[77,129,34]},{value:1,color:[145,105,18]}]}),SALINITY:new oA({stops:[{value:0,color:[42,24,108]},{value:.13,color:[33,50,162]},{value:.25,color:[15,90,145]},{value:.38,color:[40,118,137]},{value:.5,color:[59,146,135]},{value:.63,color:[79,175,126]},{value:.75,color:[120,203,104]},{value:.88,color:[193,221,100]},{value:1,color:[253,239,154]}]}),TEMPERATURE:new oA({stops:[{value:0,color:[4,35,51]},{value:.13,color:[23,51,122]},{value:.25,color:[85,59,157]},{value:.38,color:[129,79,143]},{value:.5,color:[175,95,130]},{value:.63,color:[222,112,101]},{value:.75,color:[249,146,66]},{value:.88,color:[249,196,65]},{value:1,color:[232,250,91]}]}),TURBIDITY:new oA({stops:[{value:0,color:[34,31,27]},{value:.13,color:[65,50,41]},{value:.25,color:[98,69,52]},{value:.38,color:[131,89,57]},{value:.5,color:[161,112,59]},{value:.63,color:[185,140,66]},{value:.75,color:[202,174,88]},{value:.88,color:[216,209,126]},{value:1,color:[233,246,171]}]}),VELOCITY_BLUE:new oA({stops:[{value:0,color:[17,32,64]},{value:.13,color:[35,52,116]},{value:.25,color:[29,81,156]},{value:.38,color:[31,113,162]},{value:.5,color:[50,144,169]},{value:.63,color:[87,173,176]},{value:.75,color:[149,196,189]},{value:.88,color:[203,221,211]},{value:1,color:[254,251,230]}]}),VELOCITY_GREEN:new oA({stops:[{value:0,color:[23,35,19]},{value:.13,color:[24,64,38]},{value:.25,color:[11,95,45]},{value:.38,color:[39,123,35]},{value:.5,color:[95,146,12]},{value:.63,color:[152,165,18]},{value:.75,color:[201,186,69]},{value:.88,color:[233,216,137]},{value:1,color:[255,253,205]}]}),CUBEHELIX:new oA({stops:[{value:0,color:[0,0,0]},{value:.07,color:[22,5,59]},{value:.13,color:[60,4,105]},{value:.2,color:[109,1,135]},{value:.27,color:[161,0,147]},{value:.33,color:[210,2,142]},{value:.4,color:[251,11,123]},{value:.47,color:[255,29,97]},{value:.53,color:[255,54,69]},{value:.6,color:[255,85,46]},{value:.67,color:[255,120,34]},{value:.73,color:[255,157,37]},{value:.8,color:[241,191,57]},{value:.87,color:[224,220,93]},{value:.93,color:[218,241,142]},{value:1,color:[227,253,198]}]}),CIVIDIS:new oA({stops:[{value:0,color:[0,32,77,255]},{value:.125,color:[5,54,110,255]},{value:.25,color:[65,77,108,255]},{value:.375,color:[97,100,111,255]},{value:.5,color:[125,124,121,255]},{value:.625,color:[156,149,120,255]},{value:.75,color:[190,175,111,255]},{value:.875,color:[225,204,94,255]},{value:1,color:[255,235,70,255]}]}),TURBO:new oA({stops:[{value:0,color:[48,18,59,255]},{value:.125,color:[70,107,227,255]},{value:.25,color:[40,187,236,255]},{value:.375,color:[49,242,153,255]},{value:.5,color:[162,252,60,255]},{value:.625,color:[237,208,58,255]},{value:.75,color:[251,128,34,255]},{value:.875,color:[210,49,5,255]},{value:1,color:[122,4,3,255]}]}),ROCKET:new oA({stops:[{value:0,color:[250,235,221,0]},{value:.133,color:[250,235,221,255]},{value:.266,color:[246,170,130,255]},{value:.4,color:[240,96,67,255]},{value:.533,color:[203,27,79,255]},{value:.666,color:[132,30,90,255]},{value:.8,color:[63,27,68,255]},{value:1,color:[3,5,26,255]}]}),MAKO:new oA({stops:[{value:0,color:[11,4,5,255]},{value:.125,color:[43,28,53,255]},{value:.25,color:[62,53,107,255]},{value:.375,color:[59,86,152,255]},{value:.5,color:[53,123,162,255]},{value:.625,color:[53,158,170,255]},{value:.75,color:[73,193,173,255]},{value:.875,color:[150,221,181,255]},{value:1,color:[222,245,229,255]}]})};const aA=[["#1D5B79","#468B97","#EF6262","#F3AA60"],["#614BC3","#33BBC5","#85E6C5","#C8FFE0"],["#461959","#7A316F","#CD6688","#AED8CC"],["#0079FF","#00DFA2","#F6FA70","#FF0060"],["#39B5E0","#A31ACB","#FF78F0","#F5EA5A"],["#37E2D5","#590696","#C70A80","#FBCB0A"],["#FFD36E","#FFF56D","#99FFCD","#9FB4FF"],["#00EAD3","#FFF5B7","#FF449F","#005F99"],["#10A19D","#540375","#FF7000","#FFBF00"]];function lA(){return aA[~~(Math.random()*aA.length)][~~(4*Math.random())]}function cA(){return`maptiler_source_${zp()}`}function uA(){return`maptiler_layer_${zp()}`}function hA(t,e){if(e<=t[0].zoom)return t[0].value;if(e>=t[t.length-1].zoom)return t[t.length-1].value;for(let i=0;i<t.length-1;i+=1)if(e>=t[i].zoom&&e<t[i+1].zoom){const r=t[i+1].zoom-t[i].zoom,n=(e-t[i].zoom)/r;return n*t[i+1].value+(1-n)*t[i].value}return 0}function dA(t){return["interpolate",["linear"],["zoom"],...t.flatMap((t=>[t.zoom,t.value]))]}function pA(t){return["interpolate",["linear"],["zoom"],...t.flatMap((t=>[t.zoom,t.value]))]}function fA(t,e){if("number"==typeof e&&"number"==typeof t)return 2*e+t;if("number"==typeof e&&Array.isArray(t))return["interpolate",["linear"],["zoom"],...t.flatMap((t=>[t.zoom,2*e+t.value]))];if("number"==typeof t&&Array.isArray(e))return["interpolate",["linear"],["zoom"],...e.flatMap((e=>[e.zoom,2*e.value+t]))];if(Array.isArray(t)&&Array.isArray(e)){return["interpolate",["linear"],["zoom"],...Array.from(new Set([...t.map((t=>t.zoom)),...e.map((t=>t.zoom))])).sort(((t,e)=>t<e?-1:1)).flatMap((i=>[i,2*hA(e,i)+hA(t,i)]))]}return 0}function AA(t){const e=t.trimStart(),i=`${e}${" ".repeat(t.length-e.length)}`,r=Array.from(i);if(!r.every((t=>" "===t||"_"===t)))throw new Error("A dash pattern must be composed only of whitespace and underscore characters.");if(!r.some((t=>"_"===t))||!r.some((t=>" "===t)))throw new Error("A dash pattern must contain at least one underscore and one whitespace character");const n=[1];for(let t=1;t<r.length;t+=1){r[t-1]===r[t]?n[n.length-1]+=1:n.push(1)}return n}function mA(t,e){return["interpolate",["linear"],["get",e],...t.flatMap((t=>[t.value,t.color]))]}function gA(t,e,i=!0){return i?["interpolate",["linear"],["zoom"],0,["interpolate",["linear"],["get",e],...t.flatMap((t=>[t.value,.025*t.pointRadius]))],2,["interpolate",["linear"],["get",e],...t.flatMap((t=>[t.value,.05*t.pointRadius]))],4,["interpolate",["linear"],["get",e],...t.flatMap((t=>[t.value,.1*t.pointRadius]))],8,["interpolate",["linear"],["get",e],...t.flatMap((t=>[t.value,.25*t.pointRadius]))],16,["interpolate",["linear"],["get",e],...t.flatMap((t=>[t.value,t.pointRadius]))]]:["interpolate",["linear"],["get",e],...t.flatMap((t=>[t.value,t.pointRadius]))]}function _A(t,e){return t.every((e=>e.color[3]===t[0].color[3]))?t[0].color[3]?t[0].color[3]/255:1:["interpolate",["linear"],["get",e],...t.getRawColorStops().flatMap((t=>{const e=t.value,i=t.color;return[e,4===i.length?i[3]/255:1]}))]}function yA(t,e=10){return["interpolate",["linear"],["heatmap-density"],...Array.from({length:e+1},((i,r)=>{const n=r/e;return[n,t.getColorHex(n)]})).flat()]}const vA={addPolyline:async function(t,e,i={}){var r,n;if(!e.sourceId&&!e.data)throw new Error("Creating a polyline layer requires an existing .sourceId or a valid .data property");let o=e.data;if("string"==typeof o){if(Fp(o))o=`https://api.maptiler.com/data/${e.data}/features.json?key=${_p.apiKey}`;else if("gpx"===(null==(r=o.split(".").pop())?void 0:r.toLowerCase().trim())){o=Lf(await(await fetch(o,i)).text())}else if("kml"===(null==(n=o.split(".").pop())?void 0:n.toLowerCase().trim())){o=zf(await(await fetch(o,i)).text())}else{const t=function(t){try{return JSON.parse(t)}catch{}return null}(o)??rA(o);t&&(o=t)}if(!o)throw new Error("Polyline data was provided as string but is incompatible with valid formats.")}return function(t,e){if(e.layerId&&t.getLayer(e.layerId))throw new Error(`A layer already exists with the layer id: ${e.layerId}`);const i=e.sourceId??cA(),r=e.layerId??uA(),n={polylineLayerId:r,polylineOutlineLayerId:"",polylineSourceId:i};e.data&&!t.getSource(i)&&t.addSource(i,{type:"geojson",data:e.data});const o=e.lineWidth??3,s=e.lineColor??lA(),a=e.lineOpacity??1,l=e.lineBlur??0,c=e.lineGapWidth??0;let u=e.lineDashArray??null;const h=e.outlineWidth??1,d=e.outlineColor??"#FFFFFF",p=e.outlineOpacity??1,f=e.outlineBlur??0;if("string"==typeof u&&(u=AA(u)),!0===e.outline){const s=`${r}_outline`;n.polylineOutlineLayerId=s,t.addLayer({id:s,type:"line",source:i,layout:{"line-join":e.lineJoin??"round","line-cap":e.lineCap??"round"},minzoom:e.minzoom??0,maxzoom:e.maxzoom??23,paint:{"line-opacity":"number"==typeof p?p:pA(p),"line-color":"string"==typeof d?d:dA(d),"line-width":fA(o,h),"line-blur":"number"==typeof f?f:pA(f)}},e.beforeId)}return t.addLayer({id:r,type:"line",source:i,layout:{"line-join":e.lineJoin??"round","line-cap":e.lineCap??"round"},minzoom:e.minzoom??0,maxzoom:e.maxzoom??23,paint:{"line-opacity":"number"==typeof a?a:pA(a),"line-color":"string"==typeof s?s:dA(s),"line-width":"number"==typeof o?o:pA(o),"line-blur":"number"==typeof l?l:pA(l),"line-gap-width":"number"==typeof c?c:pA(c),...u&&{"line-dasharray":u}}},e.beforeId),n}(t,{...e,data:o})},addPolygon:function(t,e){if(e.layerId&&t.getLayer(e.layerId))throw new Error(`A layer already exists with the layer id: ${e.layerId}`);const i=e.sourceId??cA(),r=e.layerId??uA(),n={polygonLayerId:r,polygonOutlineLayerId:e.outline?`${r}_outline`:"",polygonSourceId:i};if(e.data&&!t.getSource(i)){let r=e.data;"string"==typeof r&&Fp(r)&&(r=`https://api.maptiler.com/data/${r}/features.json?key=${_p.apiKey}`),t.addSource(i,{type:"geojson",data:r})}let o=e.outlineDashArray??null;const s=e.outlineWidth??1,a=e.outlineColor??"#FFFFFF",l=e.outlineOpacity??1,c=e.outlineBlur??0,u=e.fillColor??lA(),h=e.fillOpacity??1,d=e.outlinePosition??"center",p=e.pattern??null;"string"==typeof o&&(o=AA(o));const f=(p=null)=>{if(t.addLayer({id:r,type:"fill",source:i,minzoom:e.minzoom??0,maxzoom:e.maxzoom??23,paint:{"fill-color":"string"==typeof u?u:dA(u),"fill-opacity":"number"==typeof h?h:pA(h),...p&&{"fill-pattern":p}}},e.beforeId),!0===e.outline){let r;r="inside"===d?"number"==typeof s?.5*s:pA(s.map((({zoom:t,value:e})=>({zoom:t,value:.5*e})))):"outside"===d?"number"==typeof s?-.5*s:pA(s.map((t=>({zoom:t.zoom,value:-.5*t.value})))):0,t.addLayer({id:n.polygonOutlineLayerId,type:"line",source:i,layout:{"line-join":e.outlineJoin??"round","line-cap":e.outlineCap??"butt"},minzoom:e.minzoom??0,maxzoom:e.maxzoom??23,paint:{"line-opacity":"number"==typeof l?l:pA(l),"line-color":"string"==typeof a?a:dA(a),"line-width":"number"==typeof s?s:pA(s),"line-blur":"number"==typeof c?c:pA(c),"line-offset":r,...o&&{"line-dasharray":o}}},e.beforeId)}};return p?t.hasImage(p)?f(p):t.loadImage(p).then((e=>{t.addImage(p,e.data),f(p)})).catch((t=>(console.error("Could not load the pattern image.",t.message),f()))):f(),n},addPoint:function(t,e){if(e.layerId&&t.getLayer(e.layerId))throw new Error(`A layer already exists with the layer id: ${e.layerId}`);const i=e.minPointRadius??10,r=e.maxPointRadius??50,n=e.cluster??!1,o=20,s=Array.isArray(e.pointColor)?e.pointColor:sA.TURBO.scale(10,e.cluster?1e4:1e3).resample("ease-out-square"),a=s.getBounds(),l=e.sourceId??cA(),c=e.layerId??uA(),u=e.showLabel??n,h=e.alignOnViewport??!0,d=e.outline??!1,p=e.outlineOpacity??1,f=e.outlineWidth??1,A=e.outlineColor??"#FFFFFF";let m;const g=e.zoomCompensation??!0,_=e.minzoom??0,y=e.maxzoom??23;m="number"==typeof e.pointOpacity?e.pointOpacity:Array.isArray(e.pointOpacity)?pA(e.pointOpacity):e.cluster?_A(s,"point_count"):e.property?_A(s,e.property):pA([{zoom:_,value:0},{zoom:_+.25,value:1},{zoom:y-.25,value:1},{zoom:y,value:0}]);const v={pointLayerId:c,clusterLayerId:"",labelLayerId:"",pointSourceId:l};if(e.data&&!t.getSource(l)){let i=e.data;"string"==typeof i&&Fp(i)&&(i=`https://api.maptiler.com/data/${i}/features.json?key=${_p.apiKey}`),t.addSource(l,{type:"geojson",data:i,cluster:n})}if(n){v.clusterLayerId=`${c}_cluster`;const n=Array.from({length:o},((t,e)=>{const n=a.min+e*(a.max-a.min)/19;return{value:n,pointRadius:i+(r-i)*(e/19)**.5,color:s.getColorHex(n)}}));t.addLayer({id:v.clusterLayerId,type:"circle",source:l,filter:["has","point_count"],paint:{"circle-color":"string"==typeof e.pointColor?e.pointColor:mA(n,"point_count"),"circle-radius":"number"==typeof e.pointRadius?e.pointRadius:Array.isArray(e.pointRadius)?pA(e.pointRadius):gA(n,"point_count",!1),"circle-pitch-alignment":h?"viewport":"map","circle-pitch-scale":"map","circle-opacity":m,...d&&{"circle-stroke-opacity":"number"==typeof p?p:pA(p),"circle-stroke-width":"number"==typeof f?f:pA(f),"circle-stroke-color":"string"==typeof A?A:dA(A)}},minzoom:_,maxzoom:y},e.beforeId),t.addLayer({id:v.pointLayerId,type:"circle",source:l,filter:["!",["has","point_count"]],paint:{"circle-pitch-alignment":h?"viewport":"map","circle-pitch-scale":"map","circle-color":"string"==typeof e.pointColor?e.pointColor:s.getColorHex(s.getBounds().min),"circle-radius":"number"==typeof e.pointRadius?e.pointRadius:Array.isArray(e.pointRadius)?pA(e.pointRadius):.75*n[0].pointRadius,"circle-opacity":m,...d&&{"circle-stroke-opacity":"number"==typeof p?p:pA(p),"circle-stroke-width":"number"==typeof f?f:pA(f),"circle-stroke-color":"string"==typeof A?A:dA(A)}},minzoom:_,maxzoom:y},e.beforeId)}else{let n="string"==typeof e.pointColor?e.pointColor:Array.isArray(e.pointColor)?e.pointColor.getColorHex(e.pointColor.getBounds().min):lA(),c="number"==typeof e.pointRadius?g?pA([{zoom:0,value:.025*e.pointRadius},{zoom:2,value:.05*e.pointRadius},{zoom:4,value:.1*e.pointRadius},{zoom:8,value:.25*e.pointRadius},{zoom:16,value:1*e.pointRadius}]):e.pointRadius:Array.isArray(e.pointRadius)?pA(e.pointRadius):g?pA([{zoom:0,value:.05*i},{zoom:2,value:.1*i},{zoom:4,value:.2*i},{zoom:8,value:.5*i},{zoom:16,value:1*i}]):i;if(e.property&&Array.isArray(e.pointColor)){const t=Array.from({length:o},((t,n)=>{const o=a.min+n*(a.max-a.min)/19;return{value:o,pointRadius:"number"==typeof e.pointRadius?e.pointRadius:i+(r-i)*(n/19)**.5,color:"string"==typeof e.pointColor?e.pointColor:s.getColorHex(o)}}));n=mA(t,e.property),c=gA(t,e.property,g)}t.addLayer({id:v.pointLayerId,type:"circle",source:l,layout:{"circle-sort-key":e.property?["/",1,["get",e.property]]:0},paint:{"circle-pitch-alignment":h?"viewport":"map","circle-pitch-scale":"map","circle-color":n,"circle-opacity":m,"circle-radius":c,...d&&{"circle-stroke-opacity":"number"==typeof p?p:pA(p),"circle-stroke-width":"number"==typeof f?f:pA(f),"circle-stroke-color":"string"==typeof A?A:dA(A)}},minzoom:_,maxzoom:y},e.beforeId)}if(!1!==u&&(e.cluster||e.property)){v.labelLayerId=`${c}_label`;const i=e.labelColor??"#fff",r=e.labelSize??12;t.addLayer({id:v.labelLayerId,type:"symbol",source:l,filter:["has",e.cluster?"point_count":e.property],layout:{"text-field":e.cluster?"{point_count_abbreviated}":`{${e.property}}`,"text-font":["Noto Sans Regular"],"text-size":r,"text-pitch-alignment":h?"viewport":"map","symbol-sort-key":["/",1,["get",e.cluster?"point_count":e.property]]},paint:{"text-color":i,"text-opacity":m},minzoom:_,maxzoom:y},e.beforeId)}return v},addHeatmap:function(t,e){if(e.layerId&&t.getLayer(e.layerId))throw new Error(`A layer already exists with the layer id: ${e.layerId}`);const i=e.sourceId??cA(),r=e.layerId??uA(),n=e.minzoom??0,o=e.maxzoom??23,s=e.zoomCompensation??!0,a=e.opacity??[{zoom:n,value:0},{zoom:n+.25,value:1},{zoom:o-.25,value:1},{zoom:o,value:0}];let l=Array.isArray(e.colorRamp)?e.colorRamp:sA.TURBO.transparentStart();const c=l.getBounds();(0!==c.min||1!==c.max)&&(l=l.scale(0,1)),l.hasTransparentStart()||(l=l.transparentStart());const u=e.intensity??[{zoom:0,value:.01},{zoom:4,value:.2},{zoom:16,value:1}],h=e.property??null,d=e.weight??1;let p=1;h?"number"==typeof d?(p=d,"number"==typeof e.weight&&console.warn("The option `.property` is ignored when `.propertyValueWeights` is not of type `PropertyValueWeights`")):Array.isArray(d)?p=function(t,e){return["interpolate",["linear"],["get",e],...t.flatMap((t=>[t.propertyValue,t.value]))]}(d,h):console.warn("The option `.property` is ignored when `.propertyValueWeights` is not of type `PropertyValueWeights`"):"number"==typeof d?p=d:Array.isArray(d)&&console.warn("The options `.propertyValueWeights` can only be used when `.property` is provided.");const f=[{zoom:0,value:1.25},{zoom:2,value:2.5},{zoom:4,value:5},{zoom:8,value:12.5},{zoom:16,value:50}],A=e.radius??(s?f:10);let m=1;"number"==typeof A?m=A:Array.isArray(A)&&"zoom"in A[0]?m=pA(A):h&&Array.isArray(A)&&"propertyValue"in A[0]?m=function(t,e,i=!0){return i?["interpolate",["linear"],["zoom"],0,["interpolate",["linear"],["get",e],...t.flatMap((t=>[t.propertyValue,.025*t.value]))],2,["interpolate",["linear"],["get",e],...t.flatMap((t=>[t.propertyValue,.05*t.value]))],4,["interpolate",["linear"],["get",e],...t.flatMap((t=>[t.propertyValue,.1*t.value]))],8,["interpolate",["linear"],["get",e],...t.flatMap((t=>[t.propertyValue,.25*t.value]))],16,["interpolate",["linear"],["get",e],...t.flatMap((t=>[t.propertyValue,t.value]))]]:["interpolate",["linear"],["get",e],...t.flatMap((t=>[t.propertyValue,t.value]))]}(A,h,s):!h&&Array.isArray(A)&&"propertyValue"in A[0]?(m=pA(f),console.warn("The option `.radius` can only be property-driven if the option `.property` is provided.")):m=pA(f);const g={heatmapLayerId:r,heatmapSourceId:i};if(e.data&&!t.getSource(i)){let r=e.data;"string"==typeof r&&Fp(r)&&(r=`https://api.maptiler.com/data/${r}/features.json?key=${_p.apiKey}`),t.addSource(i,{type:"geojson",data:r})}return t.addLayer({id:r,type:"heatmap",source:i,minzoom:n,maxzoom:o,paint:{"heatmap-weight":p,"heatmap-intensity":"number"==typeof u?u:pA(u),"heatmap-color":yA(l),"heatmap-radius":m,"heatmap-opacity":"number"==typeof a?a:pA(a)}},e.beforeId),g},takeScreenshot:async function(t,e={}){const i=e.download??!1,r=await function(t){return new Promise(((e,i)=>{t.redraw(),t.once("idle",(()=>{t.getCanvas().toBlob((t=>{if(!t)return i(Error("Screenshot could not be created."));e(t)}),"image/png")}))}))}(t);if(i){const t=e.filename??"maptiler_screenshot.png",i=document.createElement("a");i.style.display="none",document.body.appendChild(i),i.href=URL.createObjectURL(r),i.download=t,i.click(),setTimeout((()=>{document.body.removeChild(i),URL.revokeObjectURL(i.href)}),0)}return r}};!function(){if(typeof window>"u")return;const t=Ah.getRTLTextPluginStatus();if("unavailable"===t||"requested"===t)try{Ah.setRTLTextPlugin(Ap.rtlPluginURL,!0)}catch{}}();const xA=Ah.Map,bA=Ah.Marker,wA=Ah.Popup,TA=Ah.Style,BA=Ah.CanvasSource,EA=Ah.GeoJSONSource,CA=Ah.ImageSource,SA=Ah.RasterTileSource,IA=Ah.RasterDEMTileSource,MA=Ah.VectorTileSource,kA=Ah.VideoSource,PA=Ah.NavigationControl,LA=Ah.GeolocateControl,zA=Ah.AttributionControl,FA=Ah.LogoControl,DA=Ah.ScaleControl,RA=Ah.FullscreenControl,UA=Ah.TerrainControl,OA=Ah.BoxZoomHandler,NA=Ah.ScrollZoomHandler,QA=Ah.CooperativeGesturesHandler,VA=Ah.KeyboardHandler,jA=Ah.TwoFingersTouchPitchHandler,HA=Ah.MapWheelEvent,GA=Ah.MapTouchEvent,$A=Ah.MapMouseEvent,ZA=Ah.config,qA=Ah.getVersion,{setRTLTextPlugin:KA,getRTLTextPluginStatus:WA,LngLat:XA,LngLatBounds:JA,MercatorCoordinate:YA,Evented:tm,AJAXError:em,prewarm:im,clearPrewarmedResources:rm,Hash:nm,Point:om,EdgeInsets:sm,DragRotateHandler:am,DragPanHandler:lm,TwoFingersTouchZoomRotateHandler:cm,DoubleClickZoomHandler:um,TwoFingersTouchZoomHandler:hm,TwoFingersTouchRotateHandler:dm,getWorkerCount:pm,setWorkerCount:fm,getMaxParallelImageRequests:Am,setMaxParallelImageRequests:mm,getWorkerUrl:gm,setWorkerUrl:_m,addSourceType:ym,importScriptInWorkers:vm,addProtocol:xm,removeProtocol:bm}=Ah;var wm=Object.freeze({__proto__:null,AJAXError:em,AttributionControl:Kp,AttributionControlMLGL:zA,BoxZoomHandler:tf,BoxZoomHandlerMLGL:OA,CanvasSource:Np,CanvasSourceMLGL:BA,ColorRamp:oA,ColorRampCollection:sA,CooperativeGesturesHandler:rf,CooperativeGesturesHandlerMLGL:QA,DoubleClickZoomHandler:um,DragPanHandler:lm,DragRotateHandler:am,EdgeInsets:sm,Evented:tm,FullscreenControl:Jp,FullscreenControlMLGL:RA,GeoJSONSource:Qp,GeoJSONSourceMLGL:EA,GeolocateControl:qp,GeolocateControlMLGL:LA,GeolocationType:Sf,Hash:nm,ImageSource:Vp,ImageSourceMLGL:CA,KeyboardHandler:nf,KeyboardHandlerMLGL:VA,Language:pp,LngLat:XA,LngLatBounds:JA,LogoControl:Wp,LogoControlMLGL:FA,Map:If,MapMLGL:xA,MapMouseEvent:lf,MapMouseEventMLGL:$A,MapStyle:Gh,MapStyleVariant:Nh,MapTouchEvent:af,MapTouchEventMLGL:GA,MapWheelEvent:sf,MapWheelEventMLGL:HA,MaptilerGeolocateControl:mf,MaptilerLogoControl:cf,MaptilerNavigationControl:df,MaptilerTerrainControl:hf,Marker:Rp,MarkerMLGL:bA,MercatorCoordinate:YA,NavigationControMLGL:PA,NavigationControl:Zp,Point:om,Popup:Up,PopupMLGL:wA,RasterDEMTileSource:Hp,RasterDEMTileSourceMLGL:IA,RasterTileSource:jp,RasterTileSourceMLGL:SA,ReferenceMapStyle:Qh,ScaleControl:Xp,ScaleControlMLGL:DA,ScrollZoomHandler:ef,ScrollZoomHandlerMLGL:NA,SdkConfig:gp,ServiceError:Ch,Style:Op,StyleMLGL:TA,TerrainControMLGL:UA,TerrainControl:Yp,TwoFingersTouchPitchHandler:of,TwoFingersTouchPitchHandlerMLGL:jA,TwoFingersTouchRotateHandler:dm,TwoFingersTouchZoomHandler:hm,TwoFingersTouchZoomRotateHandler:cm,VectorTileSource:Gp,VectorTileSourceMLGL:MA,VideoSource:$p,VideoSourceMLGL:kA,addProtocol:xm,addSourceType:ym,areSameLanguages:function(t,e,i=_h){const r=Th(t,i),n=Th(e,i);return r&&n&&r.flag===n.flag},bufferToPixelDataBrowser:Ad,circumferenceAtLatitude:ld,clearPrewarmedResources:rm,config:_p,configMLGL:ZA,coordinates:Dh,data:Uh,elevation:bd,expandMapStyle:Oh,geocoding:Ph,geolocation:zh,getAutoLanguage:bh,getBrowserLanguage:fp,getBufferToPixelDataParser:md,getLanguageInfoFromCode:vh,getLanguageInfoFromFlag:xh,getLanguageInfoFromKey:yh,getMapLibreVersion:qA,getMaxParallelImageRequests:Am,getRTLTextPluginStatus:WA,getTileCache:fd,getVersion:function(){return dp},getWorkerCount:pm,getWorkerUrl:gm,gpx:Lf,gpxOrKml:rA,hasChildNodeWithName:kf,helpers:vA,importScriptInWorkers:vm,isLanguageInfo:wh,kml:zf,mapStylePresetList:Vh,math:dd,misc:Kh,prewarm:im,removeProtocol:bm,setMaxParallelImageRequests:mm,setRTLTextPlugin:KA,setWorkerCount:fm,setWorkerUrl:_m,staticMaps:Jh,str2xml:Mf,styleToStyle:Hh,toLanguageInfo:Th,xml2str:Pf}),Tm=Object.freeze({__proto__:null,default:undefined});export{hh as startApp};
//# sourceMappingURL=bundle.js.map

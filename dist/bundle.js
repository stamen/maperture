function e(e,t){return t.forEach((function(t){t&&"string"!=typeof t&&!Array.isArray(t)&&Object.keys(t).forEach((function(i){if("default"!==i&&!(i in e)){var r=Object.getOwnPropertyDescriptor(t,i);Object.defineProperty(e,i,r.get?r:{enumerable:!0,get:function(){return t[i]}})}}))})),Object.freeze(e)}function t(){}function i(e,t){for(const i in t)e[i]=t[i];return e}function r(e){return e()}function n(){return Object.create(null)}function o(e){e.forEach(r)}function s(e){return"function"==typeof e}function a(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}function l(e,i,r){e.$$.on_destroy.push(function(e,...i){if(null==e)return t;const r=e.subscribe(...i);return r.unsubscribe?()=>r.unsubscribe():r}(i,r))}function c(e,t,i,r){if(e){const n=u(e,t,i,r);return e[0](n)}}function u(e,t,r,n){return e[1]&&n?i(r.ctx.slice(),e[1](n(t))):r.ctx}function h(e,t,i,r){if(e[2]&&r){const n=e[2](r(i));if(void 0===t.dirty)return n;if("object"==typeof n){const e=[],i=Math.max(t.dirty.length,n.length);for(let r=0;r<i;r+=1)e[r]=t.dirty[r]|n[r];return e}return t.dirty|n}return t.dirty}function d(e,t,i,r,n,o){if(n){const s=u(t,i,r,o);e.p(s,n)}}function p(e){if(e.ctx.length>32){const t=[],i=e.ctx.length/32;for(let e=0;e<i;e++)t[e]=-1;return t}return-1}function f(e){const t={};for(const i in e)"$"!==i[0]&&(t[i]=e[i]);return t}function A(e,t){const i={};t=new Set(t);for(const r in e)t.has(r)||"$"===r[0]||(i[r]=e[r]);return i}function m(e){return null==e?"":e}function g(e){return e&&s(e.destroy)?e.destroy:t}function _(e,t){e.appendChild(t)}function y(e,t,i){e.insertBefore(t,i||null)}function v(e){e.parentNode&&e.parentNode.removeChild(e)}function x(e,t){for(let i=0;i<e.length;i+=1)e[i]&&e[i].d(t)}function b(e){return document.createElement(e)}function w(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function T(e){return document.createTextNode(e)}function B(){return T(" ")}function C(){return T("")}function S(e,t,i,r){return e.addEventListener(t,i,r),()=>e.removeEventListener(t,i,r)}function E(e,t,i){null==i?e.removeAttribute(t):e.getAttribute(t)!==i&&e.setAttribute(t,i)}function M(e){return""===e?null:+e}function I(e,t){t=""+t,e.data!==t&&(e.data=t)}function P(e,t){e.value=null==t?"":t}function F(e,t,i,r){null==i?e.style.removeProperty(t):e.style.setProperty(t,i,r?"important":"")}function k(e,t,i){for(let i=0;i<e.options.length;i+=1){const r=e.options[i];if(r.__value===t)return void(r.selected=!0)}i&&void 0===t||(e.selectedIndex=-1)}let z,R;function D(){if(void 0===z){z=!1;try{"undefined"!=typeof window&&window.parent&&window.parent.document}catch(e){z=!0}}return z}function O(e,t,i){e.classList[i?"add":"remove"](t)}function U(e,t){return new e(t)}function N(e){R=e}function Q(){if(!R)throw new Error("Function called outside component initialization");return R}function j(e){Q().$$.on_mount.push(e)}function V(e){Q().$$.on_destroy.push(e)}function H(){const e=Q();return(t,i,{cancelable:r=!1}={})=>{const n=e.$$.callbacks[t];if(n){const o=function(e,t,{bubbles:i=!1,cancelable:r=!1}={}){const n=document.createEvent("CustomEvent");return n.initCustomEvent(e,i,r,t),n}(t,i,{cancelable:r});return n.slice().forEach((t=>{t.call(e,o)})),!o.defaultPrevented}return!0}}function G(e,t){const i=e.$$.callbacks[t.type];i&&i.slice().forEach((e=>e.call(this,t)))}const $=[],Z=[];let q=[];const K=[],W=Promise.resolve();let X=!1;function Y(){X||(X=!0,W.then(ie))}function J(e){q.push(e)}const ee=new Set;let te=0;function ie(){if(0!==te)return;const e=R;do{try{for(;te<$.length;){const e=$[te];te++,N(e),re(e.$$)}}catch(e){throw $.length=0,te=0,e}for(N(null),$.length=0,te=0;Z.length;)Z.pop()();for(let e=0;e<q.length;e+=1){const t=q[e];ee.has(t)||(ee.add(t),t())}q.length=0}while($.length);for(;K.length;)K.pop()();X=!1,ee.clear(),N(e)}function re(e){if(null!==e.fragment){e.update(),o(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(J)}}const ne=new Set;let oe;function se(){oe={r:0,c:[],p:oe}}function ae(){oe.r||o(oe.c),oe=oe.p}function le(e,t){e&&e.i&&(ne.delete(e),e.i(t))}function ce(e,t,i,r){if(e&&e.o){if(ne.has(e))return;ne.add(e),oe.c.push((()=>{ne.delete(e),r&&(i&&e.d(1),r())})),e.o(t)}else r&&r()}function ue(e,t){const i={},r={},n={$$scope:1};let o=e.length;for(;o--;){const s=e[o],a=t[o];if(a){for(const e in s)e in a||(r[e]=1);for(const e in a)n[e]||(i[e]=a[e],n[e]=1);e[o]=a}else for(const e in s)n[e]=1}for(const e in r)e in i||(i[e]=void 0);return i}function he(e){return"object"==typeof e&&null!==e?e:{}}function de(e){e&&e.c()}function pe(e,t,i,n){const{fragment:a,after_update:l}=e.$$;a&&a.m(t,i),n||J((()=>{const t=e.$$.on_mount.map(r).filter(s);e.$$.on_destroy?e.$$.on_destroy.push(...t):o(t),e.$$.on_mount=[]})),l.forEach(J)}function fe(e,t){const i=e.$$;null!==i.fragment&&(!function(e){const t=[],i=[];q.forEach((r=>-1===e.indexOf(r)?t.push(r):i.push(r))),i.forEach((e=>e())),q=t}(i.after_update),o(i.on_destroy),i.fragment&&i.fragment.d(t),i.on_destroy=i.fragment=null,i.ctx=[])}function Ae(e,i,r,s,a,l,c,u=[-1]){const h=R;N(e);const d=e.$$={fragment:null,ctx:[],props:l,update:t,not_equal:a,bound:n(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(i.context||(h?h.$$.context:[])),callbacks:n(),dirty:u,skip_bound:!1,root:i.target||h.$$.root};c&&c(d.root);let p=!1;if(d.ctx=r?r(e,i.props||{},((t,i,...r)=>{const n=r.length?r[0]:i;return d.ctx&&a(d.ctx[t],d.ctx[t]=n)&&(!d.skip_bound&&d.bound[t]&&d.bound[t](n),p&&function(e,t){-1===e.$$.dirty[0]&&($.push(e),Y(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}(e,t)),i})):[],d.update(),p=!0,o(d.before_update),d.fragment=!!s&&s(d.ctx),i.target){if(i.hydrate){const e=function(e){return Array.from(e.childNodes)}(i.target);d.fragment&&d.fragment.l(e),e.forEach(v)}else d.fragment&&d.fragment.c();i.intro&&le(e.$$.fragment),pe(e,i.target,i.anchor,i.customElement),ie()}N(h)}class me{$destroy(){fe(this,1),this.$destroy=t}$on(e,i){if(!s(i))return t;const r=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return r.push(i),()=>{const e=r.indexOf(i);-1!==e&&r.splice(e,1)}}$set(e){var t;this.$$set&&(t=e,0!==Object.keys(t).length)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const ge="[object RegExp]",_e="[object String]",ye="[object Number]",ve="[object Boolean]",xe="[object Arguments]",be="[object Symbol]",we="[object Date]",Te="[object Map]",Be="[object Set]",Ce="[object Array]",Se="[object ArrayBuffer]",Ee="[object Object]",Me="[object DataView]",Ie="[object Uint8Array]",Pe="[object Uint8ClampedArray]",Le="[object Uint16Array]",Fe="[object Uint32Array]",ke="[object Int8Array]",ze="[object Int16Array]",Re="[object Int32Array]",De="[object Float32Array]",Oe="[object Float64Array]";function Ue(e,t,i,r=new Map,n=void 0){const o=n?.(e,t,i,r);if(void 0!==o)return o;if(null==(s=e)||"object"!=typeof s&&"function"!=typeof s)return e;var s;if(r.has(e))return r.get(e);if(Array.isArray(e)){const t=new Array(e.length);r.set(e,t);for(let o=0;o<e.length;o++)t[o]=Ue(e[o],o,i,r,n);return Object.hasOwn(e,"index")&&(t.index=e.index),Object.hasOwn(e,"input")&&(t.input=e.input),t}if(e instanceof Date)return new Date(e.getTime());if(e instanceof RegExp){const t=new RegExp(e.source,e.flags);return t.lastIndex=e.lastIndex,t}if(e instanceof Map){const t=new Map;r.set(e,t);for(const[o,s]of e)t.set(o,Ue(s,o,i,r,n));return t}if(e instanceof Set){const t=new Set;r.set(e,t);for(const o of e)t.add(Ue(o,void 0,i,r,n));return t}if("undefined"!=typeof Buffer&&Buffer.isBuffer(e))return e.subarray();if(function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}(e)){const t=new(Object.getPrototypeOf(e).constructor)(e.length);r.set(e,t);for(let o=0;o<e.length;o++)t[o]=Ue(e[o],o,i,r,n);return t}if(e instanceof ArrayBuffer||"undefined"!=typeof SharedArrayBuffer&&e instanceof SharedArrayBuffer)return e.slice(0);if(e instanceof DataView){const t=new DataView(e.buffer.slice(0),e.byteOffset,e.byteLength);return r.set(e,t),Ne(t,e,i,r,n),t}if("undefined"!=typeof File&&e instanceof File){const t=new File([e],e.name,{type:e.type});return r.set(e,t),Ne(t,e,i,r,n),t}if("undefined"!=typeof Blob&&e instanceof Blob){const t=new Blob([e],{type:e.type});return r.set(e,t),Ne(t,e,i,r,n),t}if(e instanceof Error){const t=new e.constructor;return r.set(e,t),t.message=e.message,t.name=e.name,t.stack=e.stack,t.cause=e.cause,Ne(t,e,i,r,n),t}if(e instanceof Boolean){const t=new Boolean(e.valueOf());return r.set(e,t),Ne(t,e,i,r,n),t}if(e instanceof Number){const t=new Number(e.valueOf());return r.set(e,t),Ne(t,e,i,r,n),t}if(e instanceof String){const t=new String(e.valueOf());return r.set(e,t),Ne(t,e,i,r,n),t}if("object"==typeof e&&function(e){switch(function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":Object.prototype.toString.call(e)}(e)){case xe:case Ce:case Se:case Me:case ve:case we:case De:case Oe:case ke:case ze:case Re:case Te:case ye:case Ee:case ge:case Be:case _e:case be:case Ie:case Pe:case Le:case Fe:return!0;default:return!1}}(e)){const t=Object.create(Object.getPrototypeOf(e));return r.set(e,t),Ne(t,e,i,r,n),t}return e}function Ne(e,t,i=e,r,n){const o=[...Object.keys(t),...(s=t,Object.getOwnPropertySymbols(s).filter((e=>Object.prototype.propertyIsEnumerable.call(s,e))))];var s;for(let s=0;s<o.length;s++){const a=o[s],l=Object.getOwnPropertyDescriptor(e,a);(null==l||l.writable)&&(e[a]=Ue(t[a],a,i,r,n))}}function Qe(e,t){return function(e,t){return Ue(e,void 0,e,new Map,t)}(e,((i,r,n,o)=>{const s=t?.(i,r,n,o);if(void 0!==s)return s;if("object"==typeof e)switch(Object.prototype.toString.call(e)){case ye:case _e:case ve:{const t=new e.constructor(e?.valueOf());return Ne(t,e),t}case xe:{const t={};return Ne(t,e),t.length=e.length,t[Symbol.iterator]=e[Symbol.iterator],t}default:return}}))}function je(e){return Qe(e)}var Ve="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function He(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function Ge(e){if(e.__esModule)return e;var t=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(e).forEach((function(i){var r=Object.getOwnPropertyDescriptor(e,i);Object.defineProperty(t,i,r.get?r:{enumerable:!0,get:function(){return e[i]}})})),t}var $e={exports:{}};$e.exports=function(){var e,t,i;function r(r,n){if(e)if(t){var o="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+e+")(sharedChunk); ("+t+")(sharedChunk); self.onerror = null;",s={};e(s),i=n(s),"undefined"!=typeof window&&window&&window.URL&&window.URL.createObjectURL&&(i.workerUrl=window.URL.createObjectURL(new Blob([o],{type:"text/javascript"})))}else t=n;else e=n}r(["exports"],(function(e){function t(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var i,r={},n={};function o(){if(i)return n;i=1,Object.defineProperty(n,"__esModule",{value:!0}),n.setMatrixArrayType=function(e){n.ARRAY_TYPE=t=e},n.toRadian=function(e){return e*o},n.equals=function(t,i){return Math.abs(t-i)<=e*Math.max(1,Math.abs(t),Math.abs(i))},n.RANDOM=n.ARRAY_TYPE=n.EPSILON=void 0;var e=1e-6;n.EPSILON=e;var t="undefined"!=typeof Float32Array?Float32Array:Array;n.ARRAY_TYPE=t;var r=Math.random;n.RANDOM=r;var o=Math.PI/180;return Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)}),n}var s,a={};function l(){if(s)return a;function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}s=1,Object.defineProperty(a,"__esModule",{value:!0}),a.create=function(){var e=new t.ARRAY_TYPE(4);return t.ARRAY_TYPE!=Float32Array&&(e[1]=0,e[2]=0),e[0]=1,e[3]=1,e},a.clone=function(e){var i=new t.ARRAY_TYPE(4);return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i},a.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},a.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e},a.fromValues=function(e,i,r,n){var o=new t.ARRAY_TYPE(4);return o[0]=e,o[1]=i,o[2]=r,o[3]=n,o},a.set=function(e,t,i,r,n){return e[0]=t,e[1]=i,e[2]=r,e[3]=n,e},a.transpose=function(e,t){if(e===t){var i=t[1];e[1]=t[2],e[2]=i}else e[0]=t[0],e[1]=t[2],e[2]=t[1],e[3]=t[3];return e},a.invert=function(e,t){var i=t[0],r=t[1],n=t[2],o=t[3],s=i*o-n*r;return s?(e[0]=o*(s=1/s),e[1]=-r*s,e[2]=-n*s,e[3]=i*s,e):null},a.adjoint=function(e,t){var i=t[0];return e[0]=t[3],e[1]=-t[1],e[2]=-t[2],e[3]=i,e},a.determinant=function(e){return e[0]*e[3]-e[2]*e[1]},a.multiply=r,a.rotate=function(e,t,i){var r=t[0],n=t[1],o=t[2],s=t[3],a=Math.sin(i),l=Math.cos(i);return e[0]=r*l+o*a,e[1]=n*l+s*a,e[2]=r*-a+o*l,e[3]=n*-a+s*l,e},a.scale=function(e,t,i){var r=t[1],n=t[2],o=t[3],s=i[0],a=i[1];return e[0]=t[0]*s,e[1]=r*s,e[2]=n*a,e[3]=o*a,e},a.fromRotation=function(e,t){var i=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=i,e[2]=-i,e[3]=r,e},a.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e},a.str=function(e){return"mat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},a.frob=function(e){return Math.hypot(e[0],e[1],e[2],e[3])},a.LDU=function(e,t,i,r){return e[2]=r[2]/r[0],i[0]=r[0],i[1]=r[1],i[3]=r[3]-e[2]*i[1],[e,t,i]},a.add=function(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e},a.subtract=n,a.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},a.equals=function(e,i){var r=e[0],n=e[1],o=e[2],s=e[3],a=i[0],l=i[1],c=i[2],u=i[3];return Math.abs(r-a)<=t.EPSILON*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(n-l)<=t.EPSILON*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(o-c)<=t.EPSILON*Math.max(1,Math.abs(o),Math.abs(c))&&Math.abs(s-u)<=t.EPSILON*Math.max(1,Math.abs(s),Math.abs(u))},a.multiplyScalar=function(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e},a.multiplyScalarAndAdd=function(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e[3]=t[3]+i[3]*r,e},a.sub=a.mul=void 0;var t=function(t){if(t&&t.__esModule)return t;if(null===t||"object"!==e(t)&&"function"!=typeof t)return{default:t};var r=i(void 0);if(r&&r.has(t))return r.get(t);var n={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in t)if("default"!==s&&Object.prototype.hasOwnProperty.call(t,s)){var a=o?Object.getOwnPropertyDescriptor(t,s):null;a&&(a.get||a.set)?Object.defineProperty(n,s,a):n[s]=t[s]}return n.default=t,r&&r.set(t,n),n}(o());function i(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(i=function(e){return e?r:t})(e)}function r(e,t,i){var r=t[0],n=t[1],o=t[2],s=t[3],a=i[0],l=i[1],c=i[2],u=i[3];return e[0]=r*a+o*l,e[1]=n*a+s*l,e[2]=r*c+o*u,e[3]=n*c+s*u,e}function n(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e}return a.mul=r,a.sub=n,a}var c,u={};function h(){if(c)return u;function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}c=1,Object.defineProperty(u,"__esModule",{value:!0}),u.create=function(){var e=new t.ARRAY_TYPE(6);return t.ARRAY_TYPE!=Float32Array&&(e[1]=0,e[2]=0,e[4]=0,e[5]=0),e[0]=1,e[3]=1,e},u.clone=function(e){var i=new t.ARRAY_TYPE(6);return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i},u.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},u.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e},u.fromValues=function(e,i,r,n,o,s){var a=new t.ARRAY_TYPE(6);return a[0]=e,a[1]=i,a[2]=r,a[3]=n,a[4]=o,a[5]=s,a},u.set=function(e,t,i,r,n,o,s){return e[0]=t,e[1]=i,e[2]=r,e[3]=n,e[4]=o,e[5]=s,e},u.invert=function(e,t){var i=t[0],r=t[1],n=t[2],o=t[3],s=t[4],a=t[5],l=i*o-r*n;return l?(e[0]=o*(l=1/l),e[1]=-r*l,e[2]=-n*l,e[3]=i*l,e[4]=(n*a-o*s)*l,e[5]=(r*s-i*a)*l,e):null},u.determinant=function(e){return e[0]*e[3]-e[1]*e[2]},u.multiply=r,u.rotate=function(e,t,i){var r=t[0],n=t[1],o=t[2],s=t[3],a=t[4],l=t[5],c=Math.sin(i),u=Math.cos(i);return e[0]=r*u+o*c,e[1]=n*u+s*c,e[2]=r*-c+o*u,e[3]=n*-c+s*u,e[4]=a,e[5]=l,e},u.scale=function(e,t,i){var r=t[1],n=t[2],o=t[3],s=t[4],a=t[5],l=i[0],c=i[1];return e[0]=t[0]*l,e[1]=r*l,e[2]=n*c,e[3]=o*c,e[4]=s,e[5]=a,e},u.translate=function(e,t,i){var r=t[0],n=t[1],o=t[2],s=t[3],a=t[4],l=t[5],c=i[0],u=i[1];return e[0]=r,e[1]=n,e[2]=o,e[3]=s,e[4]=r*c+o*u+a,e[5]=n*c+s*u+l,e},u.fromRotation=function(e,t){var i=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=i,e[2]=-i,e[3]=r,e[4]=0,e[5]=0,e},u.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e[4]=0,e[5]=0,e},u.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=t[0],e[5]=t[1],e},u.str=function(e){return"mat2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"},u.frob=function(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],1)},u.add=function(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e[4]=t[4]+i[4],e[5]=t[5]+i[5],e},u.subtract=n,u.multiplyScalar=function(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*i,e[5]=t[5]*i,e},u.multiplyScalarAndAdd=function(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e[3]=t[3]+i[3]*r,e[4]=t[4]+i[4]*r,e[5]=t[5]+i[5]*r,e},u.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]},u.equals=function(e,i){var r=e[0],n=e[1],o=e[2],s=e[3],a=e[4],l=e[5],c=i[0],u=i[1],h=i[2],d=i[3],p=i[4],f=i[5];return Math.abs(r-c)<=t.EPSILON*Math.max(1,Math.abs(r),Math.abs(c))&&Math.abs(n-u)<=t.EPSILON*Math.max(1,Math.abs(n),Math.abs(u))&&Math.abs(o-h)<=t.EPSILON*Math.max(1,Math.abs(o),Math.abs(h))&&Math.abs(s-d)<=t.EPSILON*Math.max(1,Math.abs(s),Math.abs(d))&&Math.abs(a-p)<=t.EPSILON*Math.max(1,Math.abs(a),Math.abs(p))&&Math.abs(l-f)<=t.EPSILON*Math.max(1,Math.abs(l),Math.abs(f))},u.sub=u.mul=void 0;var t=function(t){if(t&&t.__esModule)return t;if(null===t||"object"!==e(t)&&"function"!=typeof t)return{default:t};var r=i(void 0);if(r&&r.has(t))return r.get(t);var n={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in t)if("default"!==s&&Object.prototype.hasOwnProperty.call(t,s)){var a=o?Object.getOwnPropertyDescriptor(t,s):null;a&&(a.get||a.set)?Object.defineProperty(n,s,a):n[s]=t[s]}return n.default=t,r&&r.set(t,n),n}(o());function i(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(i=function(e){return e?r:t})(e)}function r(e,t,i){var r=t[0],n=t[1],o=t[2],s=t[3],a=t[4],l=t[5],c=i[0],u=i[1],h=i[2],d=i[3],p=i[4],f=i[5];return e[0]=r*c+o*u,e[1]=n*c+s*u,e[2]=r*h+o*d,e[3]=n*h+s*d,e[4]=r*p+o*f+a,e[5]=n*p+s*f+l,e}function n(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e[4]=t[4]-i[4],e[5]=t[5]-i[5],e}return u.mul=r,u.sub=n,u}var d,p={};function f(){if(d)return p;function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}d=1,Object.defineProperty(p,"__esModule",{value:!0}),p.create=function(){var e=new t.ARRAY_TYPE(9);return t.ARRAY_TYPE!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e},p.fromMat4=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e},p.clone=function(e){var i=new t.ARRAY_TYPE(9);return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i},p.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},p.fromValues=function(e,i,r,n,o,s,a,l,c){var u=new t.ARRAY_TYPE(9);return u[0]=e,u[1]=i,u[2]=r,u[3]=n,u[4]=o,u[5]=s,u[6]=a,u[7]=l,u[8]=c,u},p.set=function(e,t,i,r,n,o,s,a,l,c){return e[0]=t,e[1]=i,e[2]=r,e[3]=n,e[4]=o,e[5]=s,e[6]=a,e[7]=l,e[8]=c,e},p.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},p.transpose=function(e,t){if(e===t){var i=t[1],r=t[2],n=t[5];e[1]=t[3],e[2]=t[6],e[3]=i,e[5]=t[7],e[6]=r,e[7]=n}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e},p.invert=function(e,t){var i=t[0],r=t[1],n=t[2],o=t[3],s=t[4],a=t[5],l=t[6],c=t[7],u=t[8],h=u*s-a*c,d=-u*o+a*l,p=c*o-s*l,f=i*h+r*d+n*p;return f?(e[0]=h*(f=1/f),e[1]=(-u*r+n*c)*f,e[2]=(a*r-n*s)*f,e[3]=d*f,e[4]=(u*i-n*l)*f,e[5]=(-a*i+n*o)*f,e[6]=p*f,e[7]=(-c*i+r*l)*f,e[8]=(s*i-r*o)*f,e):null},p.adjoint=function(e,t){var i=t[0],r=t[1],n=t[2],o=t[3],s=t[4],a=t[5],l=t[6],c=t[7],u=t[8];return e[0]=s*u-a*c,e[1]=n*c-r*u,e[2]=r*a-n*s,e[3]=a*l-o*u,e[4]=i*u-n*l,e[5]=n*o-i*a,e[6]=o*c-s*l,e[7]=r*l-i*c,e[8]=i*s-r*o,e},p.determinant=function(e){var t=e[3],i=e[4],r=e[5],n=e[6],o=e[7],s=e[8];return e[0]*(s*i-r*o)+e[1]*(-s*t+r*n)+e[2]*(o*t-i*n)},p.multiply=r,p.translate=function(e,t,i){var r=t[0],n=t[1],o=t[2],s=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=i[0],p=i[1];return e[0]=r,e[1]=n,e[2]=o,e[3]=s,e[4]=a,e[5]=l,e[6]=d*r+p*s+c,e[7]=d*n+p*a+u,e[8]=d*o+p*l+h,e},p.rotate=function(e,t,i){var r=t[0],n=t[1],o=t[2],s=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=Math.sin(i),p=Math.cos(i);return e[0]=p*r+d*s,e[1]=p*n+d*a,e[2]=p*o+d*l,e[3]=p*s-d*r,e[4]=p*a-d*n,e[5]=p*l-d*o,e[6]=c,e[7]=u,e[8]=h,e},p.scale=function(e,t,i){var r=i[0],n=i[1];return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=n*t[3],e[4]=n*t[4],e[5]=n*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},p.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=t[0],e[7]=t[1],e[8]=1,e},p.fromRotation=function(e,t){var i=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=i,e[2]=0,e[3]=-i,e[4]=r,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},p.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=t[1],e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},p.fromMat2d=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e},p.fromQuat=function(e,t){var i=t[0],r=t[1],n=t[2],o=t[3],s=i+i,a=r+r,l=n+n,c=i*s,u=r*s,h=r*a,d=n*s,p=n*a,f=n*l,A=o*s,m=o*a,g=o*l;return e[0]=1-h-f,e[3]=u-g,e[6]=d+m,e[1]=u+g,e[4]=1-c-f,e[7]=p-A,e[2]=d-m,e[5]=p+A,e[8]=1-c-h,e},p.normalFromMat4=function(e,t){var i=t[0],r=t[1],n=t[2],o=t[3],s=t[4],a=t[5],l=t[6],c=t[7],u=t[8],h=t[9],d=t[10],p=t[11],f=t[12],A=t[13],m=t[14],g=t[15],_=i*a-r*s,y=i*l-n*s,v=i*c-o*s,x=r*l-n*a,b=r*c-o*a,w=n*c-o*l,T=u*A-h*f,B=u*m-d*f,C=u*g-p*f,S=h*m-d*A,E=h*g-p*A,M=d*g-p*m,I=_*M-y*E+v*S+x*C-b*B+w*T;return I?(e[0]=(a*M-l*E+c*S)*(I=1/I),e[1]=(l*C-s*M-c*B)*I,e[2]=(s*E-a*C+c*T)*I,e[3]=(n*E-r*M-o*S)*I,e[4]=(i*M-n*C+o*B)*I,e[5]=(r*C-i*E-o*T)*I,e[6]=(A*w-m*b+g*x)*I,e[7]=(m*v-f*w-g*y)*I,e[8]=(f*b-A*v+g*_)*I,e):null},p.projection=function(e,t,i){return e[0]=2/t,e[1]=0,e[2]=0,e[3]=0,e[4]=-2/i,e[5]=0,e[6]=-1,e[7]=1,e[8]=1,e},p.str=function(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"},p.frob=function(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8])},p.add=function(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e[4]=t[4]+i[4],e[5]=t[5]+i[5],e[6]=t[6]+i[6],e[7]=t[7]+i[7],e[8]=t[8]+i[8],e},p.subtract=n,p.multiplyScalar=function(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*i,e},p.multiplyScalarAndAdd=function(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e[3]=t[3]+i[3]*r,e[4]=t[4]+i[4]*r,e[5]=t[5]+i[5]*r,e[6]=t[6]+i[6]*r,e[7]=t[7]+i[7]*r,e[8]=t[8]+i[8]*r,e},p.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]},p.equals=function(e,i){var r=e[0],n=e[1],o=e[2],s=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=e[8],d=i[0],p=i[1],f=i[2],A=i[3],m=i[4],g=i[5],_=i[6],y=i[7],v=i[8];return Math.abs(r-d)<=t.EPSILON*Math.max(1,Math.abs(r),Math.abs(d))&&Math.abs(n-p)<=t.EPSILON*Math.max(1,Math.abs(n),Math.abs(p))&&Math.abs(o-f)<=t.EPSILON*Math.max(1,Math.abs(o),Math.abs(f))&&Math.abs(s-A)<=t.EPSILON*Math.max(1,Math.abs(s),Math.abs(A))&&Math.abs(a-m)<=t.EPSILON*Math.max(1,Math.abs(a),Math.abs(m))&&Math.abs(l-g)<=t.EPSILON*Math.max(1,Math.abs(l),Math.abs(g))&&Math.abs(c-_)<=t.EPSILON*Math.max(1,Math.abs(c),Math.abs(_))&&Math.abs(u-y)<=t.EPSILON*Math.max(1,Math.abs(u),Math.abs(y))&&Math.abs(h-v)<=t.EPSILON*Math.max(1,Math.abs(h),Math.abs(v))},p.sub=p.mul=void 0;var t=function(t){if(t&&t.__esModule)return t;if(null===t||"object"!==e(t)&&"function"!=typeof t)return{default:t};var r=i(void 0);if(r&&r.has(t))return r.get(t);var n={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in t)if("default"!==s&&Object.prototype.hasOwnProperty.call(t,s)){var a=o?Object.getOwnPropertyDescriptor(t,s):null;a&&(a.get||a.set)?Object.defineProperty(n,s,a):n[s]=t[s]}return n.default=t,r&&r.set(t,n),n}(o());function i(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(i=function(e){return e?r:t})(e)}function r(e,t,i){var r=t[0],n=t[1],o=t[2],s=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=i[0],p=i[1],f=i[2],A=i[3],m=i[4],g=i[5],_=i[6],y=i[7],v=i[8];return e[0]=d*r+p*s+f*c,e[1]=d*n+p*a+f*u,e[2]=d*o+p*l+f*h,e[3]=A*r+m*s+g*c,e[4]=A*n+m*a+g*u,e[5]=A*o+m*l+g*h,e[6]=_*r+y*s+v*c,e[7]=_*n+y*a+v*u,e[8]=_*o+y*l+v*h,e}function n(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e[4]=t[4]-i[4],e[5]=t[5]-i[5],e[6]=t[6]-i[6],e[7]=t[7]-i[7],e[8]=t[8]-i[8],e}return p.mul=r,p.sub=n,p}var A,m={};function g(){if(A)return m;function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}A=1,Object.defineProperty(m,"__esModule",{value:!0}),m.create=function(){var e=new t.ARRAY_TYPE(16);return t.ARRAY_TYPE!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e},m.clone=function(e){var i=new t.ARRAY_TYPE(16);return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i},m.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},m.fromValues=function(e,i,r,n,o,s,a,l,c,u,h,d,p,f,A,m){var g=new t.ARRAY_TYPE(16);return g[0]=e,g[1]=i,g[2]=r,g[3]=n,g[4]=o,g[5]=s,g[6]=a,g[7]=l,g[8]=c,g[9]=u,g[10]=h,g[11]=d,g[12]=p,g[13]=f,g[14]=A,g[15]=m,g},m.set=function(e,t,i,r,n,o,s,a,l,c,u,h,d,p,f,A,m){return e[0]=t,e[1]=i,e[2]=r,e[3]=n,e[4]=o,e[5]=s,e[6]=a,e[7]=l,e[8]=c,e[9]=u,e[10]=h,e[11]=d,e[12]=p,e[13]=f,e[14]=A,e[15]=m,e},m.identity=r,m.transpose=function(e,t){if(e===t){var i=t[1],r=t[2],n=t[3],o=t[6],s=t[7],a=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=i,e[6]=t[9],e[7]=t[13],e[8]=r,e[9]=o,e[11]=t[14],e[12]=n,e[13]=s,e[14]=a}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e},m.invert=function(e,t){var i=t[0],r=t[1],n=t[2],o=t[3],s=t[4],a=t[5],l=t[6],c=t[7],u=t[8],h=t[9],d=t[10],p=t[11],f=t[12],A=t[13],m=t[14],g=t[15],_=i*a-r*s,y=i*l-n*s,v=i*c-o*s,x=r*l-n*a,b=r*c-o*a,w=n*c-o*l,T=u*A-h*f,B=u*m-d*f,C=u*g-p*f,S=h*m-d*A,E=h*g-p*A,M=d*g-p*m,I=_*M-y*E+v*S+x*C-b*B+w*T;return I?(e[0]=(a*M-l*E+c*S)*(I=1/I),e[1]=(n*E-r*M-o*S)*I,e[2]=(A*w-m*b+g*x)*I,e[3]=(d*b-h*w-p*x)*I,e[4]=(l*C-s*M-c*B)*I,e[5]=(i*M-n*C+o*B)*I,e[6]=(m*v-f*w-g*y)*I,e[7]=(u*w-d*v+p*y)*I,e[8]=(s*E-a*C+c*T)*I,e[9]=(r*C-i*E-o*T)*I,e[10]=(f*b-A*v+g*_)*I,e[11]=(h*v-u*b-p*_)*I,e[12]=(a*B-s*S-l*T)*I,e[13]=(i*S-r*B+n*T)*I,e[14]=(A*y-f*x-m*_)*I,e[15]=(u*x-h*y+d*_)*I,e):null},m.adjoint=function(e,t){var i=t[0],r=t[1],n=t[2],o=t[3],s=t[4],a=t[5],l=t[6],c=t[7],u=t[8],h=t[9],d=t[10],p=t[11],f=t[12],A=t[13],m=t[14],g=t[15];return e[0]=a*(d*g-p*m)-h*(l*g-c*m)+A*(l*p-c*d),e[1]=-(r*(d*g-p*m)-h*(n*g-o*m)+A*(n*p-o*d)),e[2]=r*(l*g-c*m)-a*(n*g-o*m)+A*(n*c-o*l),e[3]=-(r*(l*p-c*d)-a*(n*p-o*d)+h*(n*c-o*l)),e[4]=-(s*(d*g-p*m)-u*(l*g-c*m)+f*(l*p-c*d)),e[5]=i*(d*g-p*m)-u*(n*g-o*m)+f*(n*p-o*d),e[6]=-(i*(l*g-c*m)-s*(n*g-o*m)+f*(n*c-o*l)),e[7]=i*(l*p-c*d)-s*(n*p-o*d)+u*(n*c-o*l),e[8]=s*(h*g-p*A)-u*(a*g-c*A)+f*(a*p-c*h),e[9]=-(i*(h*g-p*A)-u*(r*g-o*A)+f*(r*p-o*h)),e[10]=i*(a*g-c*A)-s*(r*g-o*A)+f*(r*c-o*a),e[11]=-(i*(a*p-c*h)-s*(r*p-o*h)+u*(r*c-o*a)),e[12]=-(s*(h*m-d*A)-u*(a*m-l*A)+f*(a*d-l*h)),e[13]=i*(h*m-d*A)-u*(r*m-n*A)+f*(r*d-n*h),e[14]=-(i*(a*m-l*A)-s*(r*m-n*A)+f*(r*l-n*a)),e[15]=i*(a*d-l*h)-s*(r*d-n*h)+u*(r*l-n*a),e},m.determinant=function(e){var t=e[0],i=e[1],r=e[2],n=e[3],o=e[4],s=e[5],a=e[6],l=e[7],c=e[8],u=e[9],h=e[10],d=e[11],p=e[12],f=e[13],A=e[14],m=e[15];return(t*s-i*o)*(h*m-d*A)-(t*a-r*o)*(u*m-d*f)+(t*l-n*o)*(u*A-h*f)+(i*a-r*s)*(c*m-d*p)-(i*l-n*s)*(c*A-h*p)+(r*l-n*a)*(c*f-u*p)},m.multiply=n,m.translate=function(e,t,i){var r,n,o,s,a,l,c,u,h,d,p,f,A=i[0],m=i[1],g=i[2];return t===e?(e[12]=t[0]*A+t[4]*m+t[8]*g+t[12],e[13]=t[1]*A+t[5]*m+t[9]*g+t[13],e[14]=t[2]*A+t[6]*m+t[10]*g+t[14],e[15]=t[3]*A+t[7]*m+t[11]*g+t[15]):(n=t[1],o=t[2],s=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=t[9],p=t[10],f=t[11],e[0]=r=t[0],e[1]=n,e[2]=o,e[3]=s,e[4]=a,e[5]=l,e[6]=c,e[7]=u,e[8]=h,e[9]=d,e[10]=p,e[11]=f,e[12]=r*A+a*m+h*g+t[12],e[13]=n*A+l*m+d*g+t[13],e[14]=o*A+c*m+p*g+t[14],e[15]=s*A+u*m+f*g+t[15]),e},m.scale=function(e,t,i){var r=i[0],n=i[1],o=i[2];return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*o,e[9]=t[9]*o,e[10]=t[10]*o,e[11]=t[11]*o,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},m.rotate=function(e,i,r,n){var o,s,a,l,c,u,h,d,p,f,A,m,g,_,y,v,x,b,w,T,B,C,S,E,M=n[0],I=n[1],P=n[2],L=Math.hypot(M,I,P);return L<t.EPSILON?null:(M*=L=1/L,I*=L,P*=L,o=Math.sin(r),s=Math.cos(r),c=i[1],u=i[2],h=i[3],p=i[5],f=i[6],A=i[7],g=i[9],_=i[10],y=i[11],v=M*M*(a=1-s)+s,w=M*I*a-P*o,T=I*I*a+s,B=P*I*a+M*o,C=M*P*a+I*o,S=I*P*a-M*o,E=P*P*a+s,e[0]=(l=i[0])*v+(d=i[4])*(x=I*M*a+P*o)+(m=i[8])*(b=P*M*a-I*o),e[1]=c*v+p*x+g*b,e[2]=u*v+f*x+_*b,e[3]=h*v+A*x+y*b,e[4]=l*w+d*T+m*B,e[5]=c*w+p*T+g*B,e[6]=u*w+f*T+_*B,e[7]=h*w+A*T+y*B,e[8]=l*C+d*S+m*E,e[9]=c*C+p*S+g*E,e[10]=u*C+f*S+_*E,e[11]=h*C+A*S+y*E,i!==e&&(e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e)},m.rotateX=function(e,t,i){var r=Math.sin(i),n=Math.cos(i),o=t[4],s=t[5],a=t[6],l=t[7],c=t[8],u=t[9],h=t[10],d=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=o*n+c*r,e[5]=s*n+u*r,e[6]=a*n+h*r,e[7]=l*n+d*r,e[8]=c*n-o*r,e[9]=u*n-s*r,e[10]=h*n-a*r,e[11]=d*n-l*r,e},m.rotateY=function(e,t,i){var r=Math.sin(i),n=Math.cos(i),o=t[0],s=t[1],a=t[2],l=t[3],c=t[8],u=t[9],h=t[10],d=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*n-c*r,e[1]=s*n-u*r,e[2]=a*n-h*r,e[3]=l*n-d*r,e[8]=o*r+c*n,e[9]=s*r+u*n,e[10]=a*r+h*n,e[11]=l*r+d*n,e},m.rotateZ=function(e,t,i){var r=Math.sin(i),n=Math.cos(i),o=t[0],s=t[1],a=t[2],l=t[3],c=t[4],u=t[5],h=t[6],d=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*n+c*r,e[1]=s*n+u*r,e[2]=a*n+h*r,e[3]=l*n+d*r,e[4]=c*n-o*r,e[5]=u*n-s*r,e[6]=h*n-a*r,e[7]=d*n-l*r,e},m.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e},m.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},m.fromRotation=function(e,i,r){var n,o,s,a=r[0],l=r[1],c=r[2],u=Math.hypot(a,l,c);return u<t.EPSILON?null:(a*=u=1/u,l*=u,c*=u,n=Math.sin(i),o=Math.cos(i),e[0]=a*a*(s=1-o)+o,e[1]=l*a*s+c*n,e[2]=c*a*s-l*n,e[3]=0,e[4]=a*l*s-c*n,e[5]=l*l*s+o,e[6]=c*l*s+a*n,e[7]=0,e[8]=a*c*s+l*n,e[9]=l*c*s-a*n,e[10]=c*c*s+o,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)},m.fromXRotation=function(e,t){var i=Math.sin(t),r=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=r,e[6]=i,e[7]=0,e[8]=0,e[9]=-i,e[10]=r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},m.fromYRotation=function(e,t){var i=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=0,e[2]=-i,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=i,e[9]=0,e[10]=r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},m.fromZRotation=function(e,t){var i=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=i,e[2]=0,e[3]=0,e[4]=-i,e[5]=r,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},m.fromRotationTranslation=s,m.fromQuat2=function(e,i){var r=new t.ARRAY_TYPE(3),n=-i[0],o=-i[1],a=-i[2],l=i[3],c=i[4],u=i[5],h=i[6],d=i[7],p=n*n+o*o+a*a+l*l;return p>0?(r[0]=2*(c*l+d*n+u*a-h*o)/p,r[1]=2*(u*l+d*o+h*n-c*a)/p,r[2]=2*(h*l+d*a+c*o-u*n)/p):(r[0]=2*(c*l+d*n+u*a-h*o),r[1]=2*(u*l+d*o+h*n-c*a),r[2]=2*(h*l+d*a+c*o-u*n)),s(e,i,r),e},m.getTranslation=function(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e},m.getScaling=a,m.getRotation=function(e,i){var r=new t.ARRAY_TYPE(3);a(r,i);var n=1/r[0],o=1/r[1],s=1/r[2],l=i[0]*n,c=i[1]*o,u=i[2]*s,h=i[4]*n,d=i[5]*o,p=i[6]*s,f=i[8]*n,A=i[9]*o,m=i[10]*s,g=l+d+m,_=0;return g>0?(_=2*Math.sqrt(g+1),e[3]=.25*_,e[0]=(p-A)/_,e[1]=(f-u)/_,e[2]=(c-h)/_):l>d&&l>m?(_=2*Math.sqrt(1+l-d-m),e[3]=(p-A)/_,e[0]=.25*_,e[1]=(c+h)/_,e[2]=(f+u)/_):d>m?(_=2*Math.sqrt(1+d-l-m),e[3]=(f-u)/_,e[0]=(c+h)/_,e[1]=.25*_,e[2]=(p+A)/_):(_=2*Math.sqrt(1+m-l-d),e[3]=(c-h)/_,e[0]=(f+u)/_,e[1]=(p+A)/_,e[2]=.25*_),e},m.fromRotationTranslationScale=function(e,t,i,r){var n=t[0],o=t[1],s=t[2],a=t[3],l=n+n,c=o+o,u=s+s,h=n*l,d=n*c,p=n*u,f=o*c,A=o*u,m=s*u,g=a*l,_=a*c,y=a*u,v=r[0],x=r[1],b=r[2];return e[0]=(1-(f+m))*v,e[1]=(d+y)*v,e[2]=(p-_)*v,e[3]=0,e[4]=(d-y)*x,e[5]=(1-(h+m))*x,e[6]=(A+g)*x,e[7]=0,e[8]=(p+_)*b,e[9]=(A-g)*b,e[10]=(1-(h+f))*b,e[11]=0,e[12]=i[0],e[13]=i[1],e[14]=i[2],e[15]=1,e},m.fromRotationTranslationScaleOrigin=function(e,t,i,r,n){var o=t[0],s=t[1],a=t[2],l=t[3],c=o+o,u=s+s,h=a+a,d=o*c,p=o*u,f=o*h,A=s*u,m=s*h,g=a*h,_=l*c,y=l*u,v=l*h,x=r[0],b=r[1],w=r[2],T=n[0],B=n[1],C=n[2],S=(1-(A+g))*x,E=(p+v)*x,M=(f-y)*x,I=(p-v)*b,P=(1-(d+g))*b,L=(m+_)*b,F=(f+y)*w,k=(m-_)*w,z=(1-(d+A))*w;return e[0]=S,e[1]=E,e[2]=M,e[3]=0,e[4]=I,e[5]=P,e[6]=L,e[7]=0,e[8]=F,e[9]=k,e[10]=z,e[11]=0,e[12]=i[0]+T-(S*T+I*B+F*C),e[13]=i[1]+B-(E*T+P*B+k*C),e[14]=i[2]+C-(M*T+L*B+z*C),e[15]=1,e},m.fromQuat=function(e,t){var i=t[0],r=t[1],n=t[2],o=t[3],s=i+i,a=r+r,l=n+n,c=i*s,u=r*s,h=r*a,d=n*s,p=n*a,f=n*l,A=o*s,m=o*a,g=o*l;return e[0]=1-h-f,e[1]=u+g,e[2]=d-m,e[3]=0,e[4]=u-g,e[5]=1-c-f,e[6]=p+A,e[7]=0,e[8]=d+m,e[9]=p-A,e[10]=1-c-h,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},m.frustum=function(e,t,i,r,n,o,s){var a=1/(i-t),l=1/(n-r),c=1/(o-s);return e[0]=2*o*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*o*l,e[6]=0,e[7]=0,e[8]=(i+t)*a,e[9]=(n+r)*l,e[10]=(s+o)*c,e[11]=-1,e[12]=0,e[13]=0,e[14]=s*o*2*c,e[15]=0,e},m.perspectiveNO=l,m.perspectiveZO=function(e,t,i,r,n){var o,s=1/Math.tan(t/2);return e[0]=s/i,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=n&&n!==1/0?(e[10]=n*(o=1/(r-n)),e[14]=n*r*o):(e[10]=-1,e[14]=-r),e},m.perspectiveFromFieldOfView=function(e,t,i,r){var n=Math.tan(t.upDegrees*Math.PI/180),o=Math.tan(t.downDegrees*Math.PI/180),s=Math.tan(t.leftDegrees*Math.PI/180),a=Math.tan(t.rightDegrees*Math.PI/180),l=2/(s+a),c=2/(n+o);return e[0]=l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=c,e[6]=0,e[7]=0,e[8]=-(s-a)*l*.5,e[9]=(n-o)*c*.5,e[10]=r/(i-r),e[11]=-1,e[12]=0,e[13]=0,e[14]=r*i/(i-r),e[15]=0,e},m.orthoNO=c,m.orthoZO=function(e,t,i,r,n,o,s){var a=1/(t-i),l=1/(r-n),c=1/(o-s);return e[0]=-2*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=c,e[11]=0,e[12]=(t+i)*a,e[13]=(n+r)*l,e[14]=o*c,e[15]=1,e},m.lookAt=function(e,i,n,o){var s,a,l,c,u,h,d,p,f,A,m=i[0],g=i[1],_=i[2],y=o[0],v=o[1],x=o[2],b=n[0],w=n[1],T=n[2];return Math.abs(m-b)<t.EPSILON&&Math.abs(g-w)<t.EPSILON&&Math.abs(_-T)<t.EPSILON?r(e):(d=m-b,p=g-w,f=_-T,s=v*(f*=A=1/Math.hypot(d,p,f))-x*(p*=A),a=x*(d*=A)-y*f,l=y*p-v*d,(A=Math.hypot(s,a,l))?(s*=A=1/A,a*=A,l*=A):(s=0,a=0,l=0),c=p*l-f*a,u=f*s-d*l,h=d*a-p*s,(A=Math.hypot(c,u,h))?(c*=A=1/A,u*=A,h*=A):(c=0,u=0,h=0),e[0]=s,e[1]=c,e[2]=d,e[3]=0,e[4]=a,e[5]=u,e[6]=p,e[7]=0,e[8]=l,e[9]=h,e[10]=f,e[11]=0,e[12]=-(s*m+a*g+l*_),e[13]=-(c*m+u*g+h*_),e[14]=-(d*m+p*g+f*_),e[15]=1,e)},m.targetTo=function(e,t,i,r){var n=t[0],o=t[1],s=t[2],a=r[0],l=r[1],c=r[2],u=n-i[0],h=o-i[1],d=s-i[2],p=u*u+h*h+d*d;p>0&&(u*=p=1/Math.sqrt(p),h*=p,d*=p);var f=l*d-c*h,A=c*u-a*d,m=a*h-l*u;return(p=f*f+A*A+m*m)>0&&(f*=p=1/Math.sqrt(p),A*=p,m*=p),e[0]=f,e[1]=A,e[2]=m,e[3]=0,e[4]=h*m-d*A,e[5]=d*f-u*m,e[6]=u*A-h*f,e[7]=0,e[8]=u,e[9]=h,e[10]=d,e[11]=0,e[12]=n,e[13]=o,e[14]=s,e[15]=1,e},m.str=function(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"},m.frob=function(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])},m.add=function(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e[4]=t[4]+i[4],e[5]=t[5]+i[5],e[6]=t[6]+i[6],e[7]=t[7]+i[7],e[8]=t[8]+i[8],e[9]=t[9]+i[9],e[10]=t[10]+i[10],e[11]=t[11]+i[11],e[12]=t[12]+i[12],e[13]=t[13]+i[13],e[14]=t[14]+i[14],e[15]=t[15]+i[15],e},m.subtract=u,m.multiplyScalar=function(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*i,e[9]=t[9]*i,e[10]=t[10]*i,e[11]=t[11]*i,e[12]=t[12]*i,e[13]=t[13]*i,e[14]=t[14]*i,e[15]=t[15]*i,e},m.multiplyScalarAndAdd=function(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e[3]=t[3]+i[3]*r,e[4]=t[4]+i[4]*r,e[5]=t[5]+i[5]*r,e[6]=t[6]+i[6]*r,e[7]=t[7]+i[7]*r,e[8]=t[8]+i[8]*r,e[9]=t[9]+i[9]*r,e[10]=t[10]+i[10]*r,e[11]=t[11]+i[11]*r,e[12]=t[12]+i[12]*r,e[13]=t[13]+i[13]*r,e[14]=t[14]+i[14]*r,e[15]=t[15]+i[15]*r,e},m.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]},m.equals=function(e,i){var r=e[0],n=e[1],o=e[2],s=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=e[8],d=e[9],p=e[10],f=e[11],A=e[12],m=e[13],g=e[14],_=e[15],y=i[0],v=i[1],x=i[2],b=i[3],w=i[4],T=i[5],B=i[6],C=i[7],S=i[8],E=i[9],M=i[10],I=i[11],P=i[12],L=i[13],F=i[14],k=i[15];return Math.abs(r-y)<=t.EPSILON*Math.max(1,Math.abs(r),Math.abs(y))&&Math.abs(n-v)<=t.EPSILON*Math.max(1,Math.abs(n),Math.abs(v))&&Math.abs(o-x)<=t.EPSILON*Math.max(1,Math.abs(o),Math.abs(x))&&Math.abs(s-b)<=t.EPSILON*Math.max(1,Math.abs(s),Math.abs(b))&&Math.abs(a-w)<=t.EPSILON*Math.max(1,Math.abs(a),Math.abs(w))&&Math.abs(l-T)<=t.EPSILON*Math.max(1,Math.abs(l),Math.abs(T))&&Math.abs(c-B)<=t.EPSILON*Math.max(1,Math.abs(c),Math.abs(B))&&Math.abs(u-C)<=t.EPSILON*Math.max(1,Math.abs(u),Math.abs(C))&&Math.abs(h-S)<=t.EPSILON*Math.max(1,Math.abs(h),Math.abs(S))&&Math.abs(d-E)<=t.EPSILON*Math.max(1,Math.abs(d),Math.abs(E))&&Math.abs(p-M)<=t.EPSILON*Math.max(1,Math.abs(p),Math.abs(M))&&Math.abs(f-I)<=t.EPSILON*Math.max(1,Math.abs(f),Math.abs(I))&&Math.abs(A-P)<=t.EPSILON*Math.max(1,Math.abs(A),Math.abs(P))&&Math.abs(m-L)<=t.EPSILON*Math.max(1,Math.abs(m),Math.abs(L))&&Math.abs(g-F)<=t.EPSILON*Math.max(1,Math.abs(g),Math.abs(F))&&Math.abs(_-k)<=t.EPSILON*Math.max(1,Math.abs(_),Math.abs(k))},m.sub=m.mul=m.ortho=m.perspective=void 0;var t=function(t){if(t&&t.__esModule)return t;if(null===t||"object"!==e(t)&&"function"!=typeof t)return{default:t};var r=i(void 0);if(r&&r.has(t))return r.get(t);var n={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in t)if("default"!==s&&Object.prototype.hasOwnProperty.call(t,s)){var a=o?Object.getOwnPropertyDescriptor(t,s):null;a&&(a.get||a.set)?Object.defineProperty(n,s,a):n[s]=t[s]}return n.default=t,r&&r.set(t,n),n}(o());function i(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(i=function(e){return e?r:t})(e)}function r(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function n(e,t,i){var r=t[0],n=t[1],o=t[2],s=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=t[9],p=t[10],f=t[11],A=t[12],m=t[13],g=t[14],_=t[15],y=i[0],v=i[1],x=i[2],b=i[3];return e[0]=y*r+v*a+x*h+b*A,e[1]=y*n+v*l+x*d+b*m,e[2]=y*o+v*c+x*p+b*g,e[3]=y*s+v*u+x*f+b*_,e[4]=(y=i[4])*r+(v=i[5])*a+(x=i[6])*h+(b=i[7])*A,e[5]=y*n+v*l+x*d+b*m,e[6]=y*o+v*c+x*p+b*g,e[7]=y*s+v*u+x*f+b*_,e[8]=(y=i[8])*r+(v=i[9])*a+(x=i[10])*h+(b=i[11])*A,e[9]=y*n+v*l+x*d+b*m,e[10]=y*o+v*c+x*p+b*g,e[11]=y*s+v*u+x*f+b*_,e[12]=(y=i[12])*r+(v=i[13])*a+(x=i[14])*h+(b=i[15])*A,e[13]=y*n+v*l+x*d+b*m,e[14]=y*o+v*c+x*p+b*g,e[15]=y*s+v*u+x*f+b*_,e}function s(e,t,i){var r=t[0],n=t[1],o=t[2],s=t[3],a=r+r,l=n+n,c=o+o,u=r*a,h=r*l,d=r*c,p=n*l,f=n*c,A=o*c,m=s*a,g=s*l,_=s*c;return e[0]=1-(p+A),e[1]=h+_,e[2]=d-g,e[3]=0,e[4]=h-_,e[5]=1-(u+A),e[6]=f+m,e[7]=0,e[8]=d+g,e[9]=f-m,e[10]=1-(u+p),e[11]=0,e[12]=i[0],e[13]=i[1],e[14]=i[2],e[15]=1,e}function a(e,t){var i=t[4],r=t[5],n=t[6],o=t[8],s=t[9],a=t[10];return e[0]=Math.hypot(t[0],t[1],t[2]),e[1]=Math.hypot(i,r,n),e[2]=Math.hypot(o,s,a),e}function l(e,t,i,r,n){var o,s=1/Math.tan(t/2);return e[0]=s/i,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=n&&n!==1/0?(e[10]=(n+r)*(o=1/(r-n)),e[14]=2*n*r*o):(e[10]=-1,e[14]=-2*r),e}function c(e,t,i,r,n,o,s){var a=1/(t-i),l=1/(r-n),c=1/(o-s);return e[0]=-2*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*c,e[11]=0,e[12]=(t+i)*a,e[13]=(n+r)*l,e[14]=(s+o)*c,e[15]=1,e}function u(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e[4]=t[4]-i[4],e[5]=t[5]-i[5],e[6]=t[6]-i[6],e[7]=t[7]-i[7],e[8]=t[8]-i[8],e[9]=t[9]-i[9],e[10]=t[10]-i[10],e[11]=t[11]-i[11],e[12]=t[12]-i[12],e[13]=t[13]-i[13],e[14]=t[14]-i[14],e[15]=t[15]-i[15],e}return m.perspective=l,m.ortho=c,m.mul=n,m.sub=u,m}var _,y={},v={};function x(){if(_)return v;function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}_=1,Object.defineProperty(v,"__esModule",{value:!0}),v.create=r,v.clone=function(e){var i=new t.ARRAY_TYPE(3);return i[0]=e[0],i[1]=e[1],i[2]=e[2],i},v.length=n,v.fromValues=function(e,i,r){var n=new t.ARRAY_TYPE(3);return n[0]=e,n[1]=i,n[2]=r,n},v.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},v.set=function(e,t,i,r){return e[0]=t,e[1]=i,e[2]=r,e},v.add=function(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e},v.subtract=s,v.multiply=a,v.divide=l,v.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e},v.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e},v.min=function(e,t,i){return e[0]=Math.min(t[0],i[0]),e[1]=Math.min(t[1],i[1]),e[2]=Math.min(t[2],i[2]),e},v.max=function(e,t,i){return e[0]=Math.max(t[0],i[0]),e[1]=Math.max(t[1],i[1]),e[2]=Math.max(t[2],i[2]),e},v.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e},v.scale=function(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e},v.scaleAndAdd=function(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e},v.distance=c,v.squaredDistance=u,v.squaredLength=h,v.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e},v.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e},v.normalize=function(e,t){var i=t[0],r=t[1],n=t[2],o=i*i+r*r+n*n;return o>0&&(o=1/Math.sqrt(o)),e[0]=t[0]*o,e[1]=t[1]*o,e[2]=t[2]*o,e},v.dot=d,v.cross=function(e,t,i){var r=t[0],n=t[1],o=t[2],s=i[0],a=i[1],l=i[2];return e[0]=n*l-o*a,e[1]=o*s-r*l,e[2]=r*a-n*s,e},v.lerp=function(e,t,i,r){var n=t[0],o=t[1],s=t[2];return e[0]=n+r*(i[0]-n),e[1]=o+r*(i[1]-o),e[2]=s+r*(i[2]-s),e},v.hermite=function(e,t,i,r,n,o){var s=o*o,a=s*(2*o-3)+1,l=s*(o-2)+o,c=s*(o-1),u=s*(3-2*o);return e[0]=t[0]*a+i[0]*l+r[0]*c+n[0]*u,e[1]=t[1]*a+i[1]*l+r[1]*c+n[1]*u,e[2]=t[2]*a+i[2]*l+r[2]*c+n[2]*u,e},v.bezier=function(e,t,i,r,n,o){var s=1-o,a=s*s,l=o*o,c=a*s,u=3*o*a,h=3*l*s,d=l*o;return e[0]=t[0]*c+i[0]*u+r[0]*h+n[0]*d,e[1]=t[1]*c+i[1]*u+r[1]*h+n[1]*d,e[2]=t[2]*c+i[2]*u+r[2]*h+n[2]*d,e},v.random=function(e,i){i=i||1;var r=2*t.RANDOM()*Math.PI,n=2*t.RANDOM()-1,o=Math.sqrt(1-n*n)*i;return e[0]=Math.cos(r)*o,e[1]=Math.sin(r)*o,e[2]=n*i,e},v.transformMat4=function(e,t,i){var r=t[0],n=t[1],o=t[2],s=i[3]*r+i[7]*n+i[11]*o+i[15];return e[0]=(i[0]*r+i[4]*n+i[8]*o+i[12])/(s=s||1),e[1]=(i[1]*r+i[5]*n+i[9]*o+i[13])/s,e[2]=(i[2]*r+i[6]*n+i[10]*o+i[14])/s,e},v.transformMat3=function(e,t,i){var r=t[0],n=t[1],o=t[2];return e[0]=r*i[0]+n*i[3]+o*i[6],e[1]=r*i[1]+n*i[4]+o*i[7],e[2]=r*i[2]+n*i[5]+o*i[8],e},v.transformQuat=function(e,t,i){var r=i[0],n=i[1],o=i[2],s=t[0],a=t[1],l=t[2],c=n*l-o*a,u=o*s-r*l,h=r*a-n*s,d=n*h-o*u,p=o*c-r*h,f=r*u-n*c,A=2*i[3];return u*=A,h*=A,p*=2,f*=2,e[0]=s+(c*=A)+(d*=2),e[1]=a+u+p,e[2]=l+h+f,e},v.rotateX=function(e,t,i,r){var n=[],o=[];return n[0]=t[0]-i[0],n[1]=t[1]-i[1],n[2]=t[2]-i[2],o[0]=n[0],o[1]=n[1]*Math.cos(r)-n[2]*Math.sin(r),o[2]=n[1]*Math.sin(r)+n[2]*Math.cos(r),e[0]=o[0]+i[0],e[1]=o[1]+i[1],e[2]=o[2]+i[2],e},v.rotateY=function(e,t,i,r){var n=[],o=[];return n[0]=t[0]-i[0],n[1]=t[1]-i[1],n[2]=t[2]-i[2],o[0]=n[2]*Math.sin(r)+n[0]*Math.cos(r),o[1]=n[1],o[2]=n[2]*Math.cos(r)-n[0]*Math.sin(r),e[0]=o[0]+i[0],e[1]=o[1]+i[1],e[2]=o[2]+i[2],e},v.rotateZ=function(e,t,i,r){var n=[],o=[];return n[0]=t[0]-i[0],n[1]=t[1]-i[1],n[2]=t[2]-i[2],o[0]=n[0]*Math.cos(r)-n[1]*Math.sin(r),o[1]=n[0]*Math.sin(r)+n[1]*Math.cos(r),o[2]=n[2],e[0]=o[0]+i[0],e[1]=o[1]+i[1],e[2]=o[2]+i[2],e},v.angle=function(e,t){var i=e[0],r=e[1],n=e[2],o=t[0],s=t[1],a=t[2],l=Math.sqrt(i*i+r*r+n*n)*Math.sqrt(o*o+s*s+a*a),c=l&&d(e,t)/l;return Math.acos(Math.min(Math.max(c,-1),1))},v.zero=function(e){return e[0]=0,e[1]=0,e[2]=0,e},v.str=function(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"},v.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]},v.equals=function(e,i){var r=e[0],n=e[1],o=e[2],s=i[0],a=i[1],l=i[2];return Math.abs(r-s)<=t.EPSILON*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(n-a)<=t.EPSILON*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(o-l)<=t.EPSILON*Math.max(1,Math.abs(o),Math.abs(l))},v.forEach=v.sqrLen=v.len=v.sqrDist=v.dist=v.div=v.mul=v.sub=void 0;var t=function(t){if(t&&t.__esModule)return t;if(null===t||"object"!==e(t)&&"function"!=typeof t)return{default:t};var r=i(void 0);if(r&&r.has(t))return r.get(t);var n={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in t)if("default"!==s&&Object.prototype.hasOwnProperty.call(t,s)){var a=o?Object.getOwnPropertyDescriptor(t,s):null;a&&(a.get||a.set)?Object.defineProperty(n,s,a):n[s]=t[s]}return n.default=t,r&&r.set(t,n),n}(o());function i(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(i=function(e){return e?r:t})(e)}function r(){var e=new t.ARRAY_TYPE(3);return t.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function n(e){return Math.hypot(e[0],e[1],e[2])}function s(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e}function a(e,t,i){return e[0]=t[0]*i[0],e[1]=t[1]*i[1],e[2]=t[2]*i[2],e}function l(e,t,i){return e[0]=t[0]/i[0],e[1]=t[1]/i[1],e[2]=t[2]/i[2],e}function c(e,t){return Math.hypot(t[0]-e[0],t[1]-e[1],t[2]-e[2])}function u(e,t){var i=t[0]-e[0],r=t[1]-e[1],n=t[2]-e[2];return i*i+r*r+n*n}function h(e){var t=e[0],i=e[1],r=e[2];return t*t+i*i+r*r}function d(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}v.sub=s,v.mul=a,v.div=l,v.dist=c,v.sqrDist=u,v.len=n,v.sqrLen=h;var p,f=(p=r(),function(e,t,i,r,n,o){var s,a;for(t||(t=3),i||(i=0),a=r?Math.min(r*t+i,e.length):e.length,s=i;s<a;s+=t)p[0]=e[s],p[1]=e[s+1],p[2]=e[s+2],n(p,p,o),e[s]=p[0],e[s+1]=p[1],e[s+2]=p[2];return e});return v.forEach=f,v}var b,w,T={};function B(){if(b)return T;function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}b=1,Object.defineProperty(T,"__esModule",{value:!0}),T.create=r,T.clone=function(e){var i=new t.ARRAY_TYPE(4);return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i},T.fromValues=function(e,i,r,n){var o=new t.ARRAY_TYPE(4);return o[0]=e,o[1]=i,o[2]=r,o[3]=n,o},T.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},T.set=function(e,t,i,r,n){return e[0]=t,e[1]=i,e[2]=r,e[3]=n,e},T.add=function(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e},T.subtract=n,T.multiply=s,T.divide=a,T.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e},T.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e},T.min=function(e,t,i){return e[0]=Math.min(t[0],i[0]),e[1]=Math.min(t[1],i[1]),e[2]=Math.min(t[2],i[2]),e[3]=Math.min(t[3],i[3]),e},T.max=function(e,t,i){return e[0]=Math.max(t[0],i[0]),e[1]=Math.max(t[1],i[1]),e[2]=Math.max(t[2],i[2]),e[3]=Math.max(t[3],i[3]),e},T.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e[3]=Math.round(t[3]),e},T.scale=function(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e},T.scaleAndAdd=function(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e[3]=t[3]+i[3]*r,e},T.distance=l,T.squaredDistance=c,T.length=u,T.squaredLength=h,T.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e},T.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e},T.normalize=function(e,t){var i=t[0],r=t[1],n=t[2],o=t[3],s=i*i+r*r+n*n+o*o;return s>0&&(s=1/Math.sqrt(s)),e[0]=i*s,e[1]=r*s,e[2]=n*s,e[3]=o*s,e},T.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},T.cross=function(e,t,i,r){var n=i[0]*r[1]-i[1]*r[0],o=i[0]*r[2]-i[2]*r[0],s=i[0]*r[3]-i[3]*r[0],a=i[1]*r[2]-i[2]*r[1],l=i[1]*r[3]-i[3]*r[1],c=i[2]*r[3]-i[3]*r[2],u=t[0],h=t[1],d=t[2],p=t[3];return e[0]=h*c-d*l+p*a,e[1]=-u*c+d*s-p*o,e[2]=u*l-h*s+p*n,e[3]=-u*a+h*o-d*n,e},T.lerp=function(e,t,i,r){var n=t[0],o=t[1],s=t[2],a=t[3];return e[0]=n+r*(i[0]-n),e[1]=o+r*(i[1]-o),e[2]=s+r*(i[2]-s),e[3]=a+r*(i[3]-a),e},T.random=function(e,i){var r,n,o,s,a,l;i=i||1;do{a=(r=2*t.RANDOM()-1)*r+(n=2*t.RANDOM()-1)*n}while(a>=1);do{l=(o=2*t.RANDOM()-1)*o+(s=2*t.RANDOM()-1)*s}while(l>=1);var c=Math.sqrt((1-a)/l);return e[0]=i*r,e[1]=i*n,e[2]=i*o*c,e[3]=i*s*c,e},T.transformMat4=function(e,t,i){var r=t[0],n=t[1],o=t[2],s=t[3];return e[0]=i[0]*r+i[4]*n+i[8]*o+i[12]*s,e[1]=i[1]*r+i[5]*n+i[9]*o+i[13]*s,e[2]=i[2]*r+i[6]*n+i[10]*o+i[14]*s,e[3]=i[3]*r+i[7]*n+i[11]*o+i[15]*s,e},T.transformQuat=function(e,t,i){var r=t[0],n=t[1],o=t[2],s=i[0],a=i[1],l=i[2],c=i[3],u=c*r+a*o-l*n,h=c*n+l*r-s*o,d=c*o+s*n-a*r,p=-s*r-a*n-l*o;return e[0]=u*c+p*-s+h*-l-d*-a,e[1]=h*c+p*-a+d*-s-u*-l,e[2]=d*c+p*-l+u*-a-h*-s,e[3]=t[3],e},T.zero=function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e},T.str=function(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},T.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},T.equals=function(e,i){var r=e[0],n=e[1],o=e[2],s=e[3],a=i[0],l=i[1],c=i[2],u=i[3];return Math.abs(r-a)<=t.EPSILON*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(n-l)<=t.EPSILON*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(o-c)<=t.EPSILON*Math.max(1,Math.abs(o),Math.abs(c))&&Math.abs(s-u)<=t.EPSILON*Math.max(1,Math.abs(s),Math.abs(u))},T.forEach=T.sqrLen=T.len=T.sqrDist=T.dist=T.div=T.mul=T.sub=void 0;var t=function(t){if(t&&t.__esModule)return t;if(null===t||"object"!==e(t)&&"function"!=typeof t)return{default:t};var r=i(void 0);if(r&&r.has(t))return r.get(t);var n={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in t)if("default"!==s&&Object.prototype.hasOwnProperty.call(t,s)){var a=o?Object.getOwnPropertyDescriptor(t,s):null;a&&(a.get||a.set)?Object.defineProperty(n,s,a):n[s]=t[s]}return n.default=t,r&&r.set(t,n),n}(o());function i(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(i=function(e){return e?r:t})(e)}function r(){var e=new t.ARRAY_TYPE(4);return t.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function n(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e}function s(e,t,i){return e[0]=t[0]*i[0],e[1]=t[1]*i[1],e[2]=t[2]*i[2],e[3]=t[3]*i[3],e}function a(e,t,i){return e[0]=t[0]/i[0],e[1]=t[1]/i[1],e[2]=t[2]/i[2],e[3]=t[3]/i[3],e}function l(e,t){return Math.hypot(t[0]-e[0],t[1]-e[1],t[2]-e[2],t[3]-e[3])}function c(e,t){var i=t[0]-e[0],r=t[1]-e[1],n=t[2]-e[2],o=t[3]-e[3];return i*i+r*r+n*n+o*o}function u(e){return Math.hypot(e[0],e[1],e[2],e[3])}function h(e){var t=e[0],i=e[1],r=e[2],n=e[3];return t*t+i*i+r*r+n*n}T.sub=n,T.mul=s,T.div=a,T.dist=l,T.sqrDist=c,T.len=u,T.sqrLen=h;var d,p=(d=r(),function(e,t,i,r,n,o){var s,a;for(t||(t=4),i||(i=0),a=r?Math.min(r*t+i,e.length):e.length,s=i;s<a;s+=t)d[0]=e[s],d[1]=e[s+1],d[2]=e[s+2],d[3]=e[s+3],n(d,d,o),e[s]=d[0],e[s+1]=d[1],e[s+2]=d[2],e[s+3]=d[3];return e});return T.forEach=p,T}function C(){if(w)return y;function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}w=1,Object.defineProperty(y,"__esModule",{value:!0}),y.create=l,y.identity=function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},y.setAxisAngle=c,y.getAxisAngle=function(e,i){var r=2*Math.acos(i[3]),n=Math.sin(r/2);return n>t.EPSILON?(e[0]=i[0]/n,e[1]=i[1]/n,e[2]=i[2]/n):(e[0]=1,e[1]=0,e[2]=0),r},y.getAngle=function(e,t){var i=g(e,t);return Math.acos(2*i*i-1)},y.multiply=u,y.rotateX=function(e,t,i){i*=.5;var r=t[0],n=t[1],o=t[2],s=t[3],a=Math.sin(i),l=Math.cos(i);return e[0]=r*l+s*a,e[1]=n*l+o*a,e[2]=o*l-n*a,e[3]=s*l-r*a,e},y.rotateY=function(e,t,i){i*=.5;var r=t[0],n=t[1],o=t[2],s=t[3],a=Math.sin(i),l=Math.cos(i);return e[0]=r*l-o*a,e[1]=n*l+s*a,e[2]=o*l+r*a,e[3]=s*l-n*a,e},y.rotateZ=function(e,t,i){i*=.5;var r=t[0],n=t[1],o=t[2],s=t[3],a=Math.sin(i),l=Math.cos(i);return e[0]=r*l+n*a,e[1]=n*l-r*a,e[2]=o*l+s*a,e[3]=s*l-o*a,e},y.calculateW=function(e,t){var i=t[0],r=t[1],n=t[2];return e[0]=i,e[1]=r,e[2]=n,e[3]=Math.sqrt(Math.abs(1-i*i-r*r-n*n)),e},y.exp=h,y.ln=d,y.pow=function(e,t,i){return d(e,t),m(e,e,i),h(e,e),e},y.slerp=p,y.random=function(e){var i=t.RANDOM(),r=t.RANDOM(),n=t.RANDOM(),o=Math.sqrt(1-i),s=Math.sqrt(i);return e[0]=o*Math.sin(2*Math.PI*r),e[1]=o*Math.cos(2*Math.PI*r),e[2]=s*Math.sin(2*Math.PI*n),e[3]=s*Math.cos(2*Math.PI*n),e},y.invert=function(e,t){var i=t[0],r=t[1],n=t[2],o=t[3],s=i*i+r*r+n*n+o*o,a=s?1/s:0;return e[0]=-i*a,e[1]=-r*a,e[2]=-n*a,e[3]=o*a,e},y.conjugate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e},y.fromMat3=A,y.fromEuler=function(e,t,i,r){var n=.5*Math.PI/180;t*=n,i*=n,r*=n;var o=Math.sin(t),s=Math.cos(t),a=Math.sin(i),l=Math.cos(i),c=Math.sin(r),u=Math.cos(r);return e[0]=o*l*u-s*a*c,e[1]=s*a*u+o*l*c,e[2]=s*l*c-o*a*u,e[3]=s*l*u+o*a*c,e},y.str=function(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},y.setAxes=y.sqlerp=y.rotationTo=y.equals=y.exactEquals=y.normalize=y.sqrLen=y.squaredLength=y.len=y.length=y.lerp=y.dot=y.scale=y.mul=y.add=y.set=y.copy=y.fromValues=y.clone=void 0;var t=a(o()),i=a(f()),r=a(x()),n=a(B());function s(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,i=new WeakMap;return(s=function(e){return e?i:t})(e)}function a(t,i){if(t&&t.__esModule)return t;if(null===t||"object"!==e(t)&&"function"!=typeof t)return{default:t};var r=s(i);if(r&&r.has(t))return r.get(t);var n={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in t)if("default"!==a&&Object.prototype.hasOwnProperty.call(t,a)){var l=o?Object.getOwnPropertyDescriptor(t,a):null;l&&(l.get||l.set)?Object.defineProperty(n,a,l):n[a]=t[a]}return n.default=t,r&&r.set(t,n),n}function l(){var e=new t.ARRAY_TYPE(4);return t.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function c(e,t,i){i*=.5;var r=Math.sin(i);return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=Math.cos(i),e}function u(e,t,i){var r=t[0],n=t[1],o=t[2],s=t[3],a=i[0],l=i[1],c=i[2],u=i[3];return e[0]=r*u+s*a+n*c-o*l,e[1]=n*u+s*l+o*a-r*c,e[2]=o*u+s*c+r*l-n*a,e[3]=s*u-r*a-n*l-o*c,e}function h(e,t){var i=t[0],r=t[1],n=t[2],o=t[3],s=Math.sqrt(i*i+r*r+n*n),a=Math.exp(o),l=s>0?a*Math.sin(s)/s:0;return e[0]=i*l,e[1]=r*l,e[2]=n*l,e[3]=a*Math.cos(s),e}function d(e,t){var i=t[0],r=t[1],n=t[2],o=t[3],s=Math.sqrt(i*i+r*r+n*n),a=s>0?Math.atan2(s,o)/s:0;return e[0]=i*a,e[1]=r*a,e[2]=n*a,e[3]=.5*Math.log(i*i+r*r+n*n+o*o),e}function p(e,i,r,n){var o,s,a,l,c,u=i[0],h=i[1],d=i[2],p=i[3],f=r[0],A=r[1],m=r[2],g=r[3];return(s=u*f+h*A+d*m+p*g)<0&&(s=-s,f=-f,A=-A,m=-m,g=-g),1-s>t.EPSILON?(o=Math.acos(s),a=Math.sin(o),l=Math.sin((1-n)*o)/a,c=Math.sin(n*o)/a):(l=1-n,c=n),e[0]=l*u+c*f,e[1]=l*h+c*A,e[2]=l*d+c*m,e[3]=l*p+c*g,e}function A(e,t){var i,r=t[0]+t[4]+t[8];if(r>0)i=Math.sqrt(r+1),e[3]=.5*i,e[0]=(t[5]-t[7])*(i=.5/i),e[1]=(t[6]-t[2])*i,e[2]=(t[1]-t[3])*i;else{var n=0;t[4]>t[0]&&(n=1),t[8]>t[3*n+n]&&(n=2);var o=(n+1)%3,s=(n+2)%3;i=Math.sqrt(t[3*n+n]-t[3*o+o]-t[3*s+s]+1),e[n]=.5*i,e[3]=(t[3*o+s]-t[3*s+o])*(i=.5/i),e[o]=(t[3*o+n]+t[3*n+o])*i,e[s]=(t[3*s+n]+t[3*n+s])*i}return e}y.clone=n.clone,y.fromValues=n.fromValues,y.copy=n.copy,y.set=n.set,y.add=n.add,y.mul=u;var m=n.scale;y.scale=m;var g=n.dot;y.dot=g,y.lerp=n.lerp;var _=n.length;y.length=_,y.len=_;var v=n.squaredLength;y.squaredLength=v,y.sqrLen=v;var b=n.normalize;y.normalize=b,y.exactEquals=n.exactEquals,y.equals=n.equals;var T,C,S,E=(T=r.create(),C=r.fromValues(1,0,0),S=r.fromValues(0,1,0),function(e,t,i){var n=r.dot(t,i);return n<-.999999?(r.cross(T,C,t),r.len(T)<1e-6&&r.cross(T,S,t),r.normalize(T,T),c(e,T,Math.PI),e):n>.999999?(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e):(r.cross(T,t,i),e[0]=T[0],e[1]=T[1],e[2]=T[2],e[3]=1+n,b(e,e))});y.rotationTo=E;var M,I,P=(M=l(),I=l(),function(e,t,i,r,n,o){return p(M,t,n,o),p(I,i,r,o),p(e,M,I,2*o*(1-o)),e});y.sqlerp=P;var L,F=(L=i.create(),function(e,t,i,r){return L[0]=i[0],L[3]=i[1],L[6]=i[2],L[1]=r[0],L[4]=r[1],L[7]=r[2],L[2]=-t[0],L[5]=-t[1],L[8]=-t[2],b(e,A(e,L))});return y.setAxes=F,y}var S,E={};function M(){if(S)return E;function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}S=1,Object.defineProperty(E,"__esModule",{value:!0}),E.create=function(){var e=new t.ARRAY_TYPE(8);return t.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[4]=0,e[5]=0,e[6]=0,e[7]=0),e[3]=1,e},E.clone=function(e){var i=new t.ARRAY_TYPE(8);return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i},E.fromValues=function(e,i,r,n,o,s,a,l){var c=new t.ARRAY_TYPE(8);return c[0]=e,c[1]=i,c[2]=r,c[3]=n,c[4]=o,c[5]=s,c[6]=a,c[7]=l,c},E.fromRotationTranslationValues=function(e,i,r,n,o,s,a){var l=new t.ARRAY_TYPE(8);l[0]=e,l[1]=i,l[2]=r,l[3]=n;var c=.5*o,u=.5*s,h=.5*a;return l[4]=c*n+u*r-h*i,l[5]=u*n+h*e-c*r,l[6]=h*n+c*i-u*e,l[7]=-c*e-u*i-h*r,l},E.fromRotationTranslation=a,E.fromTranslation=function(e,t){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e[4]=.5*t[0],e[5]=.5*t[1],e[6]=.5*t[2],e[7]=0,e},E.fromRotation=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=0,e[5]=0,e[6]=0,e[7]=0,e},E.fromMat4=function(e,n){var o=i.create();r.getRotation(o,n);var s=new t.ARRAY_TYPE(3);return r.getTranslation(s,n),a(e,o,s),e},E.copy=l,E.identity=function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e[6]=0,e[7]=0,e},E.set=function(e,t,i,r,n,o,s,a,l){return e[0]=t,e[1]=i,e[2]=r,e[3]=n,e[4]=o,e[5]=s,e[6]=a,e[7]=l,e},E.getDual=function(e,t){return e[0]=t[4],e[1]=t[5],e[2]=t[6],e[3]=t[7],e},E.setDual=function(e,t){return e[4]=t[0],e[5]=t[1],e[6]=t[2],e[7]=t[3],e},E.getTranslation=function(e,t){var i=t[4],r=t[5],n=t[6],o=t[7],s=-t[0],a=-t[1],l=-t[2],c=t[3];return e[0]=2*(i*c+o*s+r*l-n*a),e[1]=2*(r*c+o*a+n*s-i*l),e[2]=2*(n*c+o*l+i*a-r*s),e},E.translate=function(e,t,i){var r=t[0],n=t[1],o=t[2],s=t[3],a=.5*i[0],l=.5*i[1],c=.5*i[2],u=t[4],h=t[5],d=t[6],p=t[7];return e[0]=r,e[1]=n,e[2]=o,e[3]=s,e[4]=s*a+n*c-o*l+u,e[5]=s*l+o*a-r*c+h,e[6]=s*c+r*l-n*a+d,e[7]=-r*a-n*l-o*c+p,e},E.rotateX=function(e,t,r){var n=-t[0],o=-t[1],s=-t[2],a=t[3],l=t[4],c=t[5],u=t[6],h=t[7],d=l*a+h*n+c*s-u*o,p=c*a+h*o+u*n-l*s,f=u*a+h*s+l*o-c*n,A=h*a-l*n-c*o-u*s;return i.rotateX(e,t,r),e[4]=d*(a=e[3])+A*(n=e[0])+p*(s=e[2])-f*(o=e[1]),e[5]=p*a+A*o+f*n-d*s,e[6]=f*a+A*s+d*o-p*n,e[7]=A*a-d*n-p*o-f*s,e},E.rotateY=function(e,t,r){var n=-t[0],o=-t[1],s=-t[2],a=t[3],l=t[4],c=t[5],u=t[6],h=t[7],d=l*a+h*n+c*s-u*o,p=c*a+h*o+u*n-l*s,f=u*a+h*s+l*o-c*n,A=h*a-l*n-c*o-u*s;return i.rotateY(e,t,r),e[4]=d*(a=e[3])+A*(n=e[0])+p*(s=e[2])-f*(o=e[1]),e[5]=p*a+A*o+f*n-d*s,e[6]=f*a+A*s+d*o-p*n,e[7]=A*a-d*n-p*o-f*s,e},E.rotateZ=function(e,t,r){var n=-t[0],o=-t[1],s=-t[2],a=t[3],l=t[4],c=t[5],u=t[6],h=t[7],d=l*a+h*n+c*s-u*o,p=c*a+h*o+u*n-l*s,f=u*a+h*s+l*o-c*n,A=h*a-l*n-c*o-u*s;return i.rotateZ(e,t,r),e[4]=d*(a=e[3])+A*(n=e[0])+p*(s=e[2])-f*(o=e[1]),e[5]=p*a+A*o+f*n-d*s,e[6]=f*a+A*s+d*o-p*n,e[7]=A*a-d*n-p*o-f*s,e},E.rotateByQuatAppend=function(e,t,i){var r=i[0],n=i[1],o=i[2],s=i[3],a=t[0],l=t[1],c=t[2],u=t[3];return e[0]=a*s+u*r+l*o-c*n,e[1]=l*s+u*n+c*r-a*o,e[2]=c*s+u*o+a*n-l*r,e[3]=u*s-a*r-l*n-c*o,e[4]=(a=t[4])*s+(u=t[7])*r+(l=t[5])*o-(c=t[6])*n,e[5]=l*s+u*n+c*r-a*o,e[6]=c*s+u*o+a*n-l*r,e[7]=u*s-a*r-l*n-c*o,e},E.rotateByQuatPrepend=function(e,t,i){var r=t[0],n=t[1],o=t[2],s=t[3],a=i[0],l=i[1],c=i[2],u=i[3];return e[0]=r*u+s*a+n*c-o*l,e[1]=n*u+s*l+o*a-r*c,e[2]=o*u+s*c+r*l-n*a,e[3]=s*u-r*a-n*l-o*c,e[4]=r*(u=i[7])+s*(a=i[4])+n*(c=i[6])-o*(l=i[5]),e[5]=n*u+s*l+o*a-r*c,e[6]=o*u+s*c+r*l-n*a,e[7]=s*u-r*a-n*l-o*c,e},E.rotateAroundAxis=function(e,i,r,n){if(Math.abs(n)<t.EPSILON)return l(e,i);var o=Math.hypot(r[0],r[1],r[2]);n*=.5;var s=Math.sin(n),a=s*r[0]/o,c=s*r[1]/o,u=s*r[2]/o,h=Math.cos(n),d=i[0],p=i[1],f=i[2],A=i[3];e[0]=d*h+A*a+p*u-f*c,e[1]=p*h+A*c+f*a-d*u,e[2]=f*h+A*u+d*c-p*a,e[3]=A*h-d*a-p*c-f*u;var m=i[4],g=i[5],_=i[6],y=i[7];return e[4]=m*h+y*a+g*u-_*c,e[5]=g*h+y*c+_*a-m*u,e[6]=_*h+y*u+m*c-g*a,e[7]=y*h-m*a-g*c-_*u,e},E.add=function(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e[4]=t[4]+i[4],e[5]=t[5]+i[5],e[6]=t[6]+i[6],e[7]=t[7]+i[7],e},E.multiply=c,E.scale=function(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e},E.lerp=function(e,t,i,r){var n=1-r;return u(t,i)<0&&(r=-r),e[0]=t[0]*n+i[0]*r,e[1]=t[1]*n+i[1]*r,e[2]=t[2]*n+i[2]*r,e[3]=t[3]*n+i[3]*r,e[4]=t[4]*n+i[4]*r,e[5]=t[5]*n+i[5]*r,e[6]=t[6]*n+i[6]*r,e[7]=t[7]*n+i[7]*r,e},E.invert=function(e,t){var i=d(t);return e[0]=-t[0]/i,e[1]=-t[1]/i,e[2]=-t[2]/i,e[3]=t[3]/i,e[4]=-t[4]/i,e[5]=-t[5]/i,e[6]=-t[6]/i,e[7]=t[7]/i,e},E.conjugate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e[4]=-t[4],e[5]=-t[5],e[6]=-t[6],e[7]=t[7],e},E.normalize=function(e,t){var i=d(t);if(i>0){i=Math.sqrt(i);var r=t[0]/i,n=t[1]/i,o=t[2]/i,s=t[3]/i,a=t[4],l=t[5],c=t[6],u=t[7],h=r*a+n*l+o*c+s*u;e[0]=r,e[1]=n,e[2]=o,e[3]=s,e[4]=(a-r*h)/i,e[5]=(l-n*h)/i,e[6]=(c-o*h)/i,e[7]=(u-s*h)/i}return e},E.str=function(e){return"quat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+")"},E.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]},E.equals=function(e,i){var r=e[0],n=e[1],o=e[2],s=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=i[0],d=i[1],p=i[2],f=i[3],A=i[4],m=i[5],g=i[6],_=i[7];return Math.abs(r-h)<=t.EPSILON*Math.max(1,Math.abs(r),Math.abs(h))&&Math.abs(n-d)<=t.EPSILON*Math.max(1,Math.abs(n),Math.abs(d))&&Math.abs(o-p)<=t.EPSILON*Math.max(1,Math.abs(o),Math.abs(p))&&Math.abs(s-f)<=t.EPSILON*Math.max(1,Math.abs(s),Math.abs(f))&&Math.abs(a-A)<=t.EPSILON*Math.max(1,Math.abs(a),Math.abs(A))&&Math.abs(l-m)<=t.EPSILON*Math.max(1,Math.abs(l),Math.abs(m))&&Math.abs(c-g)<=t.EPSILON*Math.max(1,Math.abs(c),Math.abs(g))&&Math.abs(u-_)<=t.EPSILON*Math.max(1,Math.abs(u),Math.abs(_))},E.sqrLen=E.squaredLength=E.len=E.length=E.dot=E.mul=E.setReal=E.getReal=void 0;var t=s(o()),i=s(C()),r=s(g());function n(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,i=new WeakMap;return(n=function(e){return e?i:t})(e)}function s(t,i){if(t&&t.__esModule)return t;if(null===t||"object"!==e(t)&&"function"!=typeof t)return{default:t};var r=n(i);if(r&&r.has(t))return r.get(t);var o={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in t)if("default"!==a&&Object.prototype.hasOwnProperty.call(t,a)){var l=s?Object.getOwnPropertyDescriptor(t,a):null;l&&(l.get||l.set)?Object.defineProperty(o,a,l):o[a]=t[a]}return o.default=t,r&&r.set(t,o),o}function a(e,t,i){var r=.5*i[0],n=.5*i[1],o=.5*i[2],s=t[0],a=t[1],l=t[2],c=t[3];return e[0]=s,e[1]=a,e[2]=l,e[3]=c,e[4]=r*c+n*l-o*a,e[5]=n*c+o*s-r*l,e[6]=o*c+r*a-n*s,e[7]=-r*s-n*a-o*l,e}function l(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e}function c(e,t,i){var r=t[0],n=t[1],o=t[2],s=t[3],a=i[4],l=i[5],c=i[6],u=i[7],h=t[4],d=t[5],p=t[6],f=t[7],A=i[0],m=i[1],g=i[2],_=i[3];return e[0]=r*_+s*A+n*g-o*m,e[1]=n*_+s*m+o*A-r*g,e[2]=o*_+s*g+r*m-n*A,e[3]=s*_-r*A-n*m-o*g,e[4]=r*u+s*a+n*c-o*l+h*_+f*A+d*g-p*m,e[5]=n*u+s*l+o*a-r*c+d*_+f*m+p*A-h*g,e[6]=o*u+s*c+r*l-n*a+p*_+f*g+h*m-d*A,e[7]=s*u-r*a-n*l-o*c+f*_-h*A-d*m-p*g,e}E.getReal=i.copy,E.setReal=i.copy,E.mul=c;var u=i.dot;E.dot=u;var h=i.length;E.length=h,E.len=h;var d=i.squaredLength;return E.squaredLength=d,E.sqrLen=d,E}var I,P,L={};function F(){if(I)return L;function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}I=1,Object.defineProperty(L,"__esModule",{value:!0}),L.create=r,L.clone=function(e){var i=new t.ARRAY_TYPE(2);return i[0]=e[0],i[1]=e[1],i},L.fromValues=function(e,i){var r=new t.ARRAY_TYPE(2);return r[0]=e,r[1]=i,r},L.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e},L.set=function(e,t,i){return e[0]=t,e[1]=i,e},L.add=function(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e},L.subtract=n,L.multiply=s,L.divide=a,L.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e},L.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e},L.min=function(e,t,i){return e[0]=Math.min(t[0],i[0]),e[1]=Math.min(t[1],i[1]),e},L.max=function(e,t,i){return e[0]=Math.max(t[0],i[0]),e[1]=Math.max(t[1],i[1]),e},L.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e},L.scale=function(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e},L.scaleAndAdd=function(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e},L.distance=l,L.squaredDistance=c,L.length=u,L.squaredLength=h,L.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e},L.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e},L.normalize=function(e,t){var i=t[0],r=t[1],n=i*i+r*r;return n>0&&(n=1/Math.sqrt(n)),e[0]=t[0]*n,e[1]=t[1]*n,e},L.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]},L.cross=function(e,t,i){var r=t[0]*i[1]-t[1]*i[0];return e[0]=e[1]=0,e[2]=r,e},L.lerp=function(e,t,i,r){var n=t[0],o=t[1];return e[0]=n+r*(i[0]-n),e[1]=o+r*(i[1]-o),e},L.random=function(e,i){i=i||1;var r=2*t.RANDOM()*Math.PI;return e[0]=Math.cos(r)*i,e[1]=Math.sin(r)*i,e},L.transformMat2=function(e,t,i){var r=t[0],n=t[1];return e[0]=i[0]*r+i[2]*n,e[1]=i[1]*r+i[3]*n,e},L.transformMat2d=function(e,t,i){var r=t[0],n=t[1];return e[0]=i[0]*r+i[2]*n+i[4],e[1]=i[1]*r+i[3]*n+i[5],e},L.transformMat3=function(e,t,i){var r=t[0],n=t[1];return e[0]=i[0]*r+i[3]*n+i[6],e[1]=i[1]*r+i[4]*n+i[7],e},L.transformMat4=function(e,t,i){var r=t[0],n=t[1];return e[0]=i[0]*r+i[4]*n+i[12],e[1]=i[1]*r+i[5]*n+i[13],e},L.rotate=function(e,t,i,r){var n=t[0]-i[0],o=t[1]-i[1],s=Math.sin(r),a=Math.cos(r);return e[0]=n*a-o*s+i[0],e[1]=n*s+o*a+i[1],e},L.angle=function(e,t){var i=e[0],r=e[1],n=t[0],o=t[1],s=Math.sqrt(i*i+r*r)*Math.sqrt(n*n+o*o);return Math.acos(Math.min(Math.max(s&&(i*n+r*o)/s,-1),1))},L.zero=function(e){return e[0]=0,e[1]=0,e},L.str=function(e){return"vec2("+e[0]+", "+e[1]+")"},L.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]},L.equals=function(e,i){var r=e[0],n=e[1],o=i[0],s=i[1];return Math.abs(r-o)<=t.EPSILON*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(n-s)<=t.EPSILON*Math.max(1,Math.abs(n),Math.abs(s))},L.forEach=L.sqrLen=L.sqrDist=L.dist=L.div=L.mul=L.sub=L.len=void 0;var t=function(t){if(t&&t.__esModule)return t;if(null===t||"object"!==e(t)&&"function"!=typeof t)return{default:t};var r=i(void 0);if(r&&r.has(t))return r.get(t);var n={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in t)if("default"!==s&&Object.prototype.hasOwnProperty.call(t,s)){var a=o?Object.getOwnPropertyDescriptor(t,s):null;a&&(a.get||a.set)?Object.defineProperty(n,s,a):n[s]=t[s]}return n.default=t,r&&r.set(t,n),n}(o());function i(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(i=function(e){return e?r:t})(e)}function r(){var e=new t.ARRAY_TYPE(2);return t.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0),e}function n(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e}function s(e,t,i){return e[0]=t[0]*i[0],e[1]=t[1]*i[1],e}function a(e,t,i){return e[0]=t[0]/i[0],e[1]=t[1]/i[1],e}function l(e,t){return Math.hypot(t[0]-e[0],t[1]-e[1])}function c(e,t){var i=t[0]-e[0],r=t[1]-e[1];return i*i+r*r}function u(e){return Math.hypot(e[0],e[1])}function h(e){var t=e[0],i=e[1];return t*t+i*i}L.len=u,L.sub=n,L.mul=s,L.div=a,L.dist=l,L.sqrDist=c,L.sqrLen=h;var d,p=(d=r(),function(e,t,i,r,n,o){var s,a;for(t||(t=2),i||(i=0),a=r?Math.min(r*t+i,e.length):e.length,s=i;s<a;s+=t)d[0]=e[s],d[1]=e[s+1],n(d,d,o),e[s]=d[0],e[s+1]=d[1];return e});return L.forEach=p,L}function k(){if(P)return r;function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}P=1,Object.defineProperty(r,"__esModule",{value:!0}),r.vec4=r.vec3=r.vec2=r.quat2=r.quat=r.mat4=r.mat3=r.mat2d=r.mat2=r.glMatrix=void 0;var t=_(o());r.glMatrix=t;var i=_(l());r.mat2=i;var n=_(h());r.mat2d=n;var s=_(f());r.mat3=s;var a=_(g());r.mat4=a;var c=_(C());r.quat=c;var u=_(M());r.quat2=u;var d=_(F());r.vec2=d;var p=_(x());r.vec3=p;var A=_(B());function m(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,i=new WeakMap;return(m=function(e){return e?i:t})(e)}function _(t,i){if(t&&t.__esModule)return t;if(null===t||"object"!==e(t)&&"function"!=typeof t)return{default:t};var r=m(i);if(r&&r.has(t))return r.get(t);var n={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in t)if("default"!==s&&Object.prototype.hasOwnProperty.call(t,s)){var a=o?Object.getOwnPropertyDescriptor(t,s):null;a&&(a.get||a.set)?Object.defineProperty(n,s,a):n[s]=t[s]}return n.default=t,r&&r.set(t,n),n}return r.vec4=A,r}var z,R,D,O,U=k(),N=function(){if(R)return z;function e(e,t,i,r){this.cx=3*e,this.bx=3*(i-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(r-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=t,this.p2x=i,this.p2y=r}return R=1,z=e,e.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,t){if(void 0===t&&(t=1e-6),e<0)return 0;if(e>1)return 1;for(var i=e,r=0;r<8;r++){var n=this.sampleCurveX(i)-e;if(Math.abs(n)<t)return i;var o=this.sampleCurveDerivativeX(i);if(Math.abs(o)<1e-6)break;i-=n/o}var s=0,a=1;for(i=e,r=0;r<20&&(n=this.sampleCurveX(i),!(Math.abs(n-e)<t));r++)e>n?s=i:a=i,i=.5*(a-s)+s;return i},solve:function(e,t){return this.sampleCurveY(this.solveCurveX(e,t))}},z}(),Q=t(N);function j(){if(O)return D;function e(e,t){this.x=e,this.y=t}return O=1,D=e,e.prototype={clone:function(){return new e(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,t){return this.clone()._rotateAround(e,t)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var t=e.x-this.x,i=e.y-this.y;return t*t+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult:function(e){var t=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=t,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var t=Math.cos(e),i=Math.sin(e),r=i*this.x+t*this.y;return this.x=t*this.x-i*this.y,this.y=r,this},_rotateAround:function(e,t){var i=Math.cos(e),r=Math.sin(e),n=t.y+r*(this.x-t.x)+i*(this.y-t.y);return this.x=t.x+i*(this.x-t.x)-r*(this.y-t.y),this.y=n,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},e.convert=function(t){return t instanceof e?t:Array.isArray(t)?new e(t[0],t[1]):t},D}var V=t(j());function H(e,t){if(Array.isArray(e)){if(!Array.isArray(t)||e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(!H(e[i],t[i]))return!1;return!0}if("object"==typeof e&&null!==e&&null!==t){if("object"!=typeof t)return!1;if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const i in e)if(!H(e[i],t[i]))return!1;return!0}return e===t}const G=Math.PI/180,$=180/Math.PI;function Z(e){return e*G}function q(e){return e*$}const K=[[0,0],[1,0],[1,1],[0,1]];function W(e){if(e<=0)return 0;if(e>=1)return 1;const t=e*e,i=t*e;return 4*(e<.5?i:3*(e-t)+i-.75)}function X(e,t,i,r){const n=new Q(e,t,i,r);return function(e){return n.solve(e)}}const Y=X(.25,.1,.25,1);function J(e,t,i){return Math.min(i,Math.max(t,e))}function ee(e,t,i){return(i=J((i-e)/(t-e),0,1))*i*(3-2*i)}function te(e,t,i){const r=i-t,n=((e-t)%r+r)%r+t;return n===t?i:n}function ie(e,t,i){if(!e.length)return i(null,[]);let r=e.length;const n=new Array(e.length);let o=null;e.forEach(((e,s)=>{t(e,((e,t)=>{e&&(o=e),n[s]=t,0==--r&&i(o,n)}))}))}function re(e,...t){for(const i of t)for(const t in i)e[t]=i[t];return e}let ne=1;function oe(){return ne++}function se(e){return e<=1?1:Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}function ae(e,t){e.forEach((e=>{t[e]&&(t[e]=t[e].bind(t))}))}function le(e,t,i){const r={};for(const i in e)r[i]=t.call(this,e[i],i,e);return r}function ce(e,t,i){const r={};for(const i in e)t.call(this,e[i],i,e)&&(r[i]=e[i]);return r}function ue(e){return Array.isArray(e)?e.map(ue):"object"==typeof e&&e?le(e,ue):e}const he={};function de(e){he[e]||("undefined"!=typeof console&&console.warn(e),he[e]=!0)}function pe(e,t,i){return(i.y-e.y)*(t.x-e.x)>(t.y-e.y)*(i.x-e.x)}function fe(e){let t=0;for(let i,r,n=0,o=e.length,s=o-1;n<o;s=n++)i=e[n],r=e[s],t+=(r.x-i.x)*(i.y+r.y);return t}function Ae([e,t,i]){const r=Z(t+90),n=Z(i);return{x:e*Math.cos(r)*Math.sin(n),y:e*Math.sin(r)*Math.sin(n),z:e*Math.cos(n),azimuthal:t,polar:i}}function me(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function ge(e){const t={};if(e.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((e,i,r,n)=>{const o=r||n;return t[i]=!o||o.toLowerCase(),""})),t["max-age"]){const e=parseInt(t["max-age"],10);isNaN(e)?delete t["max-age"]:t["max-age"]=e}return t}let _e=null;function ye(e,t){return[e[4*t],e[4*t+1],e[4*t+2],e[4*t+3]]}function ve(e,t,i,r){for(;t<i;){const n=t+i>>1;e[n]<r?t=n+1:i=n}return t}function xe(e,t,i,r){for(;t<i;){const n=t+i>>1;e[n]<=r?t=n+1:i=n}return t}function be(e){return e>0?1/(1.001-e):1+e}function we(e){return e>0?1-1/(1.001-e):-e}const Te={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!Te.API_URL)return null;try{const e=new URL(Te.API_URL);return"api.mapbox.cn"===e.hostname?"https://events.mapbox.cn/events/v2":"api.mapbox.com"===e.hostname?"https://events.mapbox.com/events/v2":null}catch(e){return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function Be(e){return Te.API_URL_REGEX.test(e)}function Ce(e){return Te.API_SPRITE_REGEX.test(e)}let Se,Ee,Me,Ie,Pe,Le;function Fe(){return null==Se&&(Se=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof self.createImageBitmap),Se}const ke={now:()=>void 0!==Ie?Ie:performance.now(),setNow(e){Ie=e},restoreNow(){Ie=void 0},frame(e){const t=requestAnimationFrame(e);return{cancel:()=>cancelAnimationFrame(t)}},getImageData(e,t=0){const{width:i,height:r}=e;Pe||(Pe=document.createElement("canvas"));const n=Pe.getContext("2d",{willReadFrequently:!0});if(!n)throw new Error("failed to create canvas 2d context");return(i>Pe.width||r>Pe.height)&&(Pe.width=i,Pe.height=r),n.clearRect(-t,-t,i+2*t,r+2*t),n.drawImage(e,0,0,i,r),n.getImageData(-t,-t,i+2*t,r+2*t)},resolveURL:e=>(Ee||(Ee=document.createElement("a")),Ee.href=e,Ee.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(null==Me&&(Me=window.matchMedia("(prefers-reduced-motion: reduce)")),Me.matches)},hasCanvasFingerprintNoise(){if(void 0!==Le)return Le;if(!Fe())return Le=!1,!1;const e=new OffscreenCanvas(85,1),t=e.getContext("2d",{willReadFrequently:!0});let i=0;for(let r=0;r<e.width;++r)t.fillStyle=`rgba(${i++},${i++},${i++}, 255)`,t.fillRect(r,0,1,1);const r=t.getImageData(0,0,e.width,e.height);i=0;for(let e=0;e<r.data.length;++e)if(e%4!=3&&i++!==r.data[e])return Le=!0,!0;return Le=!1,!1}};function ze(e,t){const i=e.indexOf("?");if(i<0)return`${e}?${new URLSearchParams(t).toString()}`;const r=new URLSearchParams(e.slice(i));for(const e in t)r.set(e,t[e]);return`${e.slice(0,i)}?${r.toString()}`}function Re(e,t={persistentParams:[]}){const i=e.indexOf("?");if(i<0)return e;const r=new URLSearchParams,n=new URLSearchParams(e.slice(i));for(const e of t.persistentParams){const t=n.get(e);t&&r.set(e,t)}const o=r.toString();return`${e.slice(0,i)}${o.length>0?`?${o}`:""}`}const De="mapbox-tiles";let Oe=500,Ue=50;const Ne=["language","worldview","jobid"];let Qe,je;function Ve(){try{return caches}catch(e){}}function He(){const e=Ve();e&&null==Qe&&(Qe=e.open(De))}let Ge=1/0;const $e={supported:!1,testSupport:function(e){!Ke&&qe&&(We?Ye(e):Ze=e)}};let Ze,qe,Ke=!1,We=!1;const Xe="undefined"!=typeof self?self:{};function Ye(e){const t=e.createTexture();e.bindTexture(e.TEXTURE_2D,t);try{if(e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,qe),e.isContextLost())return;$e.supported=!0}catch(e){}e.deleteTexture(t),Ke=!0}Xe.document&&(qe=Xe.document.createElement("img"),qe.onload=function(){Ze&&Ye(Ze),Ze=null,We=!0},qe.onerror=function(){Ke=!0,Ze=null},qe.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Je={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};"function"==typeof Object.freeze&&Object.freeze(Je);class et extends Error{constructor(e,t,i){401===t&&Be(i)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=t,this.url=i}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const tt=me()?()=>self.worker&&self.worker.referrer:()=>("blob:"===location.protocol?parent:self).location.href,it=function(e,t){if(!(/^file:/.test(i=e.url)||/^file:/.test(tt())&&!/^\w+:/.test(i))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(e,t){const i=new AbortController,r=new Request(e.url,{method:e.method||"GET",body:e.body,credentials:e.credentials,headers:e.headers,referrer:tt(),referrerPolicy:e.referrerPolicy,signal:i.signal});let n=!1,o=!1;const s=(a=r.url).indexOf("sku=")>0&&Be(a);var a;"json"===e.type&&r.headers.set("Accept","application/json");const l=(i,n,a)=>{if(o)return;if(i&&"SecurityError"!==i.message&&de(i.toString()),n&&a)return c(n);const l=Date.now();fetch(r).then((i=>{if(i.ok){const e=s?i.clone():null;return c(i,e,l)}return t(new et(i.statusText,i.status,e.url))})).catch((i=>{"AbortError"!==i.name&&t(new Error(`${i.message} ${e.url}`))}))},c=(i,s,a)=>{("arrayBuffer"===e.type?i.arrayBuffer():"json"===e.type?i.json():i.text()).then((e=>{o||(s&&a&&function(e,t,i){if(He(),null==Qe)return;const r=ge(t.headers.get("Cache-Control")||"");if(r["no-store"])return;const n={status:t.status,statusText:t.statusText,headers:new Headers};t.headers.forEach(((e,t)=>n.headers.set(t,e))),r["max-age"]&&n.headers.set("Expires",new Date(i+1e3*r["max-age"]).toUTCString());const o=n.headers.get("Expires");if(!o)return;if(new Date(o).getTime()-i<42e4)return;let s=Re(e.url,{persistentParams:Ne});if(206===t.status){const t=e.headers.get("Range");if(!t)return;n.status=200,s=ze(s,{range:t})}!function(e,t){if(void 0===je)try{new Response(new ReadableStream),je=!0}catch(e){je=!1}je?t(e.body):e.blob().then(t)}(t,(e=>{const i=new Response(200!==(r=t.status)&&404!==r&&[101,103,204,205,304].includes(r)?null:e,n);var r;He(),null!=Qe&&Qe.then((e=>e.put(s,i))).catch((e=>de(e.message)))}))}(r,s,a),n=!0,t(null,e,i.headers.get("Cache-Control"),i.headers.get("Expires")))})).catch((e=>{o||t(new Error(e.message))}))};return s?function(e,t){if(He(),null==Qe)return t(null);Qe.then((i=>{let r=Re(e.url,{persistentParams:Ne});const n=e.headers.get("Range");n&&(r=ze(r,{range:n})),i.match(r).then((e=>{const n=function(e){if(!e)return!1;const t=new Date(e.headers.get("Expires")||0),i=ge(e.headers.get("Cache-Control")||"");return t>Date.now()&&!i["no-cache"]}(e);i.delete(r),n&&i.put(r,e.clone()),t(null,e,n)})).catch(t)})).catch(t)}(r,l):l(null,null),{cancel:()=>{o=!0,n||i.abort()}}}(e,t);if(me()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",e,t,void 0,!0)}var i;return function(e,t){const i=new XMLHttpRequest;i.open(e.method||"GET",e.url,!0),"arrayBuffer"===e.type&&(i.responseType="arraybuffer");for(const t in e.headers)i.setRequestHeader(t,e.headers[t]);return"json"===e.type&&(i.responseType="text",i.setRequestHeader("Accept","application/json")),i.withCredentials="include"===e.credentials,i.onerror=()=>{t(new Error(i.statusText))},i.onload=()=>{if((i.status>=200&&i.status<300||0===i.status)&&null!==i.response){let r=i.response;if("json"===e.type)try{r=JSON.parse(i.response)}catch(e){return t(e)}t(null,r,i.getResponseHeader("Cache-Control"),i.getResponseHeader("Expires"))}else t(new et(i.statusText,i.status,e.url))},i.send(e.body),{cancel:()=>i.abort()}}(e,t)},rt=function(e,t){return it(re(e,{type:"arrayBuffer"}),t)};function nt(e){const t=document.createElement("a");return t.href=e,t.protocol===location.protocol&&t.host===location.host}const ot="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let st,at;st=[],at=0;const lt=function(e,t){if($e.supported&&(e.headers||(e.headers={}),e.headers.accept="image/webp,*/*"),at>=Te.MAX_PARALLEL_IMAGE_REQUESTS){const i={requestParameters:e,callback:t,cancelled:!1,cancel(){this.cancelled=!0}};return st.push(i),i}at++;let i=!1;const r=()=>{if(!i)for(i=!0,at--;st.length&&at<Te.MAX_PARALLEL_IMAGE_REQUESTS;){const e=st.shift(),{requestParameters:t,callback:i,cancelled:r}=e;r||(e.cancel=lt(t,i).cancel)}},n=rt(e,((e,i,n,o)=>{r(),e?t(e):i&&(self.createImageBitmap?function(e,t){const i=new Blob([new Uint8Array(e)],{type:"image/png"});createImageBitmap(i).then((e=>{t(null,e)})).catch((e=>{t(new Error(`Could not load image because of ${e.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))}))}(i,((e,i)=>t(e,i,n,o))):function(e,t){const i=new Image;i.onload=()=>{t(null,i),URL.revokeObjectURL(i.src),i.onload=null,requestAnimationFrame((()=>{i.src=ot}))},i.onerror=()=>t(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const r=new Blob([new Uint8Array(e)],{type:"image/png"});i.src=e.byteLength?URL.createObjectURL(r):ot}(i,((e,i)=>t(e,i,n,o))))}));return{cancel:()=>{n.cancel(),r()}}};var ct,ut,ht,dt={exports:{}},pt={exports:{}},ft={exports:{}},At=function(){if(ht)return dt.exports;ht=1;var e=(ct||(ct=1,pt.exports=function(e,t){var i,r,n,o,s,a,l,c;for(r=e.length-(i=3&e.length),n=t,s=3432918353,a=461845907,c=0;c<r;)l=255&e.charCodeAt(c)|(255&e.charCodeAt(++c))<<8|(255&e.charCodeAt(++c))<<16|(255&e.charCodeAt(++c))<<24,++c,n=27492+(65535&(o=5*(65535&(n=(n^=l=(65535&(l=(l=(65535&l)*s+(((l>>>16)*s&65535)<<16)&4294967295)<<15|l>>>17))*a+(((l>>>16)*a&65535)<<16)&4294967295)<<13|n>>>19))+((5*(n>>>16)&65535)<<16)&4294967295))+((58964+(o>>>16)&65535)<<16);switch(l=0,i){case 3:l^=(255&e.charCodeAt(c+2))<<16;case 2:l^=(255&e.charCodeAt(c+1))<<8;case 1:n^=l=(65535&(l=(l=(65535&(l^=255&e.charCodeAt(c)))*s+(((l>>>16)*s&65535)<<16)&4294967295)<<15|l>>>17))*a+(((l>>>16)*a&65535)<<16)&4294967295}return n^=e.length,n=2246822507*(65535&(n^=n>>>16))+((2246822507*(n>>>16)&65535)<<16)&4294967295,n=3266489909*(65535&(n^=n>>>13))+((3266489909*(n>>>16)&65535)<<16)&4294967295,(n^=n>>>16)>>>0}),pt.exports),t=(ut||(ut=1,ft.exports=function(e,t){for(var i,r=e.length,n=t^r,o=0;r>=4;)i=1540483477*(65535&(i=255&e.charCodeAt(o)|(255&e.charCodeAt(++o))<<8|(255&e.charCodeAt(++o))<<16|(255&e.charCodeAt(++o))<<24))+((1540483477*(i>>>16)&65535)<<16),n=1540483477*(65535&n)+((1540483477*(n>>>16)&65535)<<16)^(i=1540483477*(65535&(i^=i>>>24))+((1540483477*(i>>>16)&65535)<<16)),r-=4,++o;switch(r){case 3:n^=(255&e.charCodeAt(o+2))<<16;case 2:n^=(255&e.charCodeAt(o+1))<<8;case 1:n=1540483477*(65535&(n^=255&e.charCodeAt(o)))+((1540483477*(n>>>16)&65535)<<16)}return n=1540483477*(65535&(n^=n>>>13))+((1540483477*(n>>>16)&65535)<<16),(n^=n>>>15)>>>0}),ft.exports);return dt.exports=e,dt.exports.murmur3=e,dt.exports.murmur2=t,dt.exports}(),mt=t(At);class gt{constructor(e,...t){re(this,t[0]||{}),this.type=e}}class _t extends gt{constructor(e,t={}){super("error",re({error:e},t))}}function yt(e,t,i){i[e]&&-1!==i[e].indexOf(t)||(i[e]=i[e]||[],i[e].push(t))}function vt(e,t,i){if(i&&i[e]){const r=i[e].indexOf(t);-1!==r&&i[e].splice(r,1)}}class xt{on(e,t){return this._listeners=this._listeners||{},yt(e,t,this._listeners),this}off(e,t){return vt(e,t,this._listeners),vt(e,t,this._oneTimeListeners),this}once(e,t){return t?(this._oneTimeListeners=this._oneTimeListeners||{},yt(e,t,this._oneTimeListeners),this):new Promise((t=>{this.once(e,t)}))}fire(e,t){const i="string"==typeof e?new gt(e,t):e,r=i.type;if(this.listens(r)){i.target=this;const e=this._listeners&&this._listeners[r]?this._listeners[r].slice():[];for(const t of e)t.call(this,i);const t=this._oneTimeListeners&&this._oneTimeListeners[r]?this._oneTimeListeners[r].slice():[];for(const e of t)vt(r,e,this._oneTimeListeners),e.call(this,i);const n=this._eventedParent;n&&(re(i,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),n.fire(i))}else i instanceof _t&&console.error(i.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,t){return this._eventedParent=e,this._eventedParentData=t,this}}class bt{constructor(e){"string"==typeof e?this.name=e:(this.name=e.name,this.iconsetId=e.iconsetId)}static from(e){return new bt(e)}static toString(e){return e.iconsetId?`${e.name}${e.iconsetId}`:e.name}static parse(e){const[t,i]=e.split("");return new bt({name:t,iconsetId:i})}static isEqual(e,t){return e.name===t.name&&e.iconsetId===t.iconsetId}toString(){return bt.toString(this)}serialize(){return{name:this.name,iconsetId:this.iconsetId}}}var wt,Tt={},Bt=function(){if(wt)return Tt;wt=1;var e={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function t(e){return(e=Math.round(e))<0?0:e>255?255:e}function i(e){return t("%"===e[e.length-1]?parseFloat(e)/100*255:parseInt(e))}function r(e){return(t="%"===e[e.length-1]?parseFloat(e)/100:parseFloat(e))<0?0:t>1?1:t;var t}function n(e,t,i){return i<0?i+=1:i>1&&(i-=1),6*i<1?e+(t-e)*i*6:2*i<1?t:3*i<2?e+(t-e)*(2/3-i)*6:e}try{Tt.parseCSSColor=function(o){var s,a=o.replace(/ /g,"").toLowerCase();if(a in e)return e[a].slice();if("#"===a[0])return 4===a.length?(s=parseInt(a.substr(1),16))>=0&&s<=4095?[(3840&s)>>4|(3840&s)>>8,240&s|(240&s)>>4,15&s|(15&s)<<4,1]:null:7===a.length&&(s=parseInt(a.substr(1),16))>=0&&s<=16777215?[(16711680&s)>>16,(65280&s)>>8,255&s,1]:null;var l=a.indexOf("("),c=a.indexOf(")");if(-1!==l&&c+1===a.length){var u=a.substr(0,l),h=a.substr(l+1,c-(l+1)).split(","),d=1;switch(u){case"rgba":if(4!==h.length)return null;d=r(h.pop());case"rgb":return 3!==h.length?null:[i(h[0]),i(h[1]),i(h[2]),d];case"hsla":if(4!==h.length)return null;d=r(h.pop());case"hsl":if(3!==h.length)return null;var p=(parseFloat(h[0])%360+360)%360/360,f=r(h[1]),A=r(h[2]),m=A<=.5?A*(f+1):A+f-A*f,g=2*A-m;return[t(255*n(g,m,p+1/3)),t(255*n(g,m,p)),t(255*n(g,m,p-1/3)),d];default:return null}}return null}}catch(e){}return Tt}();class Ct{constructor(e,t,i,r=1){this.r=e,this.g=t,this.b=i,this.a=r}static parse(e){if(!e)return;if(e instanceof Ct)return e;if("string"!=typeof e)return;const t=Bt.parseCSSColor(e);return t?new Ct(t[0]/255*t[3],t[1]/255*t[3],t[2]/255*t[3],t[3]):void 0}toStringPremultipliedAlpha(){const[e,t,i,r]=0===this.a?[0,0,0,0]:[255*this.r/this.a,255*this.g/this.a,255*this.b/this.a,this.a];return`rgba(${Math.round(e)},${Math.round(t)},${Math.round(i)},${r})`}toString(){const[e,t,i,r]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*e)},${Math.round(255*t)},${Math.round(255*i)},${r})`}toRenderColor(e){const{r:t,g:i,b:r,a:n}=this;return new St(e,t,i,r,n)}clone(){return new Ct(this.r,this.g,this.b,this.a)}}class St{constructor(e,t,i,r,n){if(e){const o=e.image.height,s=o*o;t=0===n?0:t/n*(o-1),i=0===n?0:i/n*(o-1),r=0===n?0:r/n*(o-1);const a=Math.floor(t),l=Math.floor(i),c=Math.floor(r),u=Math.ceil(t),h=Math.ceil(i),d=Math.ceil(r),p=t-a,f=i-l,A=r-c,m=e.image.data,g=4*(a+l*s+c*o),_=4*(a+l*s+d*o),y=4*(a+h*s+c*o),v=4*(a+h*s+d*o),x=4*(u+l*s+c*o),b=4*(u+l*s+d*o),w=4*(u+h*s+c*o),T=4*(u+h*s+d*o);if(g<0||T>=m.length)throw new Error("out of range");this.r=Et(Et(Et(m[g],m[_],A),Et(m[y],m[v],A),f),Et(Et(m[x],m[b],A),Et(m[w],m[T],A),f),p)/255*n,this.g=Et(Et(Et(m[g+1],m[_+1],A),Et(m[y+1],m[v+1],A),f),Et(Et(m[x+1],m[b+1],A),Et(m[w+1],m[T+1],A),f),p)/255*n,this.b=Et(Et(Et(m[g+2],m[_+2],A),Et(m[y+2],m[v+2],A),f),Et(Et(m[x+2],m[b+2],A),Et(m[w+2],m[T+2],A),f),p)/255*n,this.a=n}else this.r=t,this.g=i,this.b=r,this.a=n}toArray(){const{r:e,g:t,b:i,a:r}=this;return 0===r?[0,0,0,0]:[255*e/r,255*t/r,255*i/r,r]}toHslaArray(){if(0===this.a)return[0,0,0,0];const{r:e,g:t,b:i,a:r}=this,n=Math.min(Math.max(e/r,0),1),o=Math.min(Math.max(t/r,0),1),s=Math.min(Math.max(i/r,0),1),a=Math.min(n,o,s),l=Math.max(n,o,s),c=(a+l)/2;if(a===l)return[0,0,100*c,r];const u=l-a,h=c>.5?u/(2-l-a):u/(l+a);let d=0;return l===n?d=(o-s)/u+(o<s?6:0):l===o?d=(s-n)/u+2:l===s&&(d=(n-o)/u+4),d*=60,[Math.min(Math.max(d,0),360),Math.min(Math.max(100*h,0),100),Math.min(Math.max(100*c,0),100),r]}toArray01(){const{r:e,g:t,b:i,a:r}=this;return 0===r?[0,0,0,0]:[e/r,t/r,i/r,r]}toArray01Scaled(e){const{r:t,g:i,b:r,a:n}=this;return 0===n?[0,0,0]:[t/n*e,i/n*e,r/n*e]}toArray01PremultipliedAlpha(){const{r:e,g:t,b:i,a:r}=this;return[e,t,i,r]}toArray01Linear(){const{r:e,g:t,b:i,a:r}=this;return 0===r?[0,0,0,0]:[Math.pow(e/r,2.2),Math.pow(t/r,2.2),Math.pow(i/r,2.2),r]}}function Et(e,t,i){return e*(1-i)+t*i}function Mt(e,t,i){return e.map(((e,r)=>Et(e,t[r],i)))}function It(e){return e*e*e*e*e}Ct.black=new Ct(0,0,0,1),Ct.white=new Ct(1,1,1,1),Ct.transparent=new Ct(0,0,0,0),Ct.red=new Ct(1,0,0,1),Ct.blue=new Ct(0,0,1,1);var Pt=Object.freeze({__proto__:null,array:Mt,color:function(e,t,i){return new Ct(Et(e.r,t.r,i),Et(e.g,t.g,i),Et(e.b,t.b,i),Et(e.a,t.a,i))},easeIn:It,number:Et});function Lt(e,...t){for(const i of t)for(const t in i)e[t]=i[t];return e}class Ft extends Error{constructor(e,t){super(t),this.message=t,this.key=e}}class kt{constructor(e,t=[]){this.parent=e,this.bindings={};for(const[e,i]of t)this.bindings[e]=i}concat(e){return new kt(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const zt={kind:"null"},Rt={kind:"number"},Dt={kind:"string"},Ot={kind:"boolean"},Ut={kind:"color"},Nt={kind:"object"},Qt={kind:"value"},jt={kind:"collator"},Vt={kind:"formatted"},Ht={kind:"resolvedImage"};function Gt(e,t){return{kind:"array",itemType:e,N:t}}function $t(e){if("array"===e.kind){const t=$t(e.itemType);return"number"==typeof e.N?`array<${t}, ${e.N}>`:"value"===e.itemType.kind?"array":`array<${t}>`}return e.kind}const Zt=[zt,Rt,Dt,Ot,Ut,Vt,Nt,Gt(Qt),Ht];function qt(e,t){if("error"===t.kind)return null;if("array"===e.kind){if("array"===t.kind&&(0===t.N&&"value"===t.itemType.kind||!qt(e.itemType,t.itemType))&&("number"!=typeof e.N||e.N===t.N))return null}else{if(e.kind===t.kind)return null;if("value"===e.kind)for(const e of Zt)if(!qt(e,t))return null}return`Expected ${$t(e)} but found ${$t(t)} instead.`}function Kt(e,t){return t.some((t=>t.kind===e.kind))}function Wt(e,t){return t.some((t=>"null"===t?null===e:"array"===t?Array.isArray(e):"object"===t?e&&!Array.isArray(e)&&"object"==typeof e:t===typeof e))}class Xt{constructor(e,t,i){this.sensitivity=e?t?"variant":"case":t?"accent":"base",this.locale=i,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,t){return this.collator.compare(e,t)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Yt{constructor(e,t,i,r,n){this.text=e.normalize?e.normalize():e,this.image=t,this.scale=i,this.fontStack=r,this.textColor=n}}class Jt{constructor(e){this.sections=e}static fromString(e){return new Jt([new Yt(e,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some((e=>0!==e.text.length||!!e.image&&e.image.hasPrimary()))}static factory(e){return e instanceof Jt?e:Jt.fromString(e)}toString(){return 0===this.sections.length?"":this.sections.map((e=>e.text)).join("")}serialize(){const e=["format"];for(const t of this.sections){if(t.image){const i=t.image.getPrimary().id.toString();e.push(["image",i]);continue}e.push(t.text);const i={};t.fontStack&&(i["text-font"]=["literal",t.fontStack.split(",")]),t.scale&&(i["font-scale"]=t.scale),t.textColor&&(i["text-color"]=["rgba"].concat(t.textColor.toRenderColor(null).toArray())),e.push(i)}return e}}class ei{constructor(e,t={}){if(this.id=bt.from(e),this.options=Object.assign({},t),t.transform){const{a:e,b:i,c:r,d:n,e:o,f:s}=t.transform;this.options.transform=new DOMMatrix([e,i,r,n,o,s])}else this.options.transform=new DOMMatrix([1,0,0,1,0,0])}toString(){const{a:e,b:t,c:i,d:r,e:n,f:o}=this.options.transform;return JSON.stringify({name:this.id.name,iconsetId:this.id.iconsetId,params:this.options.params,transform:{a:e,b:t,c:i,d:r,e:n,f:o}})}static parse(e){let t,i,r,n;try{({name:t,iconsetId:i,params:r,transform:n}=JSON.parse(e)||{})}catch(e){return null}if(!t)return null;const{a:o,b:s,c:a,d:l,e:c,f:u}=n||{};return new ei({name:t,iconsetId:i},{params:r,transform:new DOMMatrix([o,s,a,l,c,u])})}scaleSelf(e){return this.options.transform.scaleSelf(e),this}}class ti{constructor(e,t,i,r,n=!1){this.primaryId=bt.from(e),this.primaryOptions=t,i&&(this.secondaryId=bt.from(i)),this.secondaryOptions=r,this.available=n}toString(){return this.primaryId&&this.secondaryId?`[${this.primaryId.name},${this.secondaryId.name}]`:this.primaryId.name}hasPrimary(){return!!this.primaryId}getPrimary(){return new ei(this.primaryId,this.primaryOptions)}hasSecondary(){return!!this.secondaryId}getSecondary(){return this.secondaryId?new ei(this.secondaryId,this.secondaryOptions):null}static from(e){return"string"==typeof e?ti.build({name:e}):e}static build(e,t,i,r){return!e||"object"==typeof e&&!("name"in e)?null:new ti(e,i,t,r)}}function ii(e,t,i,r){return"number"==typeof e&&e>=0&&e<=255&&"number"==typeof t&&t>=0&&t<=255&&"number"==typeof i&&i>=0&&i<=255?void 0===r||"number"==typeof r&&r>=0&&r<=1?null:`Invalid rgba value [${[e,t,i,r].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof r?[e,t,i,r]:[e,t,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function ri(e){if(null===e)return!0;if("string"==typeof e)return!0;if("boolean"==typeof e)return!0;if("number"==typeof e)return!0;if(e instanceof Ct)return!0;if(e instanceof Xt)return!0;if(e instanceof Jt)return!0;if(e instanceof ti)return!0;if(Array.isArray(e)){for(const t of e)if(!ri(t))return!1;return!0}if("object"==typeof e){for(const t in e)if(!ri(e[t]))return!1;return!0}return!1}function ni(e){if(null===e)return zt;if("string"==typeof e)return Dt;if("boolean"==typeof e)return Ot;if("number"==typeof e)return Rt;if(e instanceof Ct)return Ut;if(e instanceof Xt)return jt;if(e instanceof Jt)return Vt;if(e instanceof ti)return Ht;if(Array.isArray(e)){const t=e.length;let i;for(const t of e){const e=ni(t);if(i){if(i===e)continue;i=Qt;break}i=e}return Gt(i||Qt,t)}return Nt}function oi(e){const t=typeof e;return null===e?"":"string"===t||"number"===t||"boolean"===t?String(e):e instanceof Ct?e.toStringPremultipliedAlpha():e instanceof Jt||e instanceof ti?e.toString():JSON.stringify(e)}class si{constructor(e,t){this.type=e,this.value=t}static parse(e,t){if(2!==e.length)return t.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!ri(e[1]))return t.error("invalid value");const i=e[1];let r=ni(i);const n=t.expectedType;return"array"!==r.kind||0!==r.N||!n||"array"!==n.kind||"number"==typeof n.N&&0!==n.N||(r=n),new si(r,i)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof Ct?["rgba"].concat(this.value.toRenderColor(null).toArray()):this.value instanceof Jt?this.value.serialize():this.value}}class ai{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const li={string:Dt,number:Rt,boolean:Ot,object:Nt};class ci{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");let i,r=1;const n=e[0];if("array"===n){let n,o;if(e.length>2){const i=e[1];if("string"!=typeof i||!(i in li)||"object"===i)return t.error('The item type argument of "array" must be one of string, number, boolean',1);n=li[i],r++}else n=Qt;if(e.length>3){if(null!==e[2]&&("number"!=typeof e[2]||e[2]<0||e[2]!==Math.floor(e[2])))return t.error('The length argument to "array" must be a positive integer literal',2);o=e[2],r++}i=Gt(n,o)}else i=li[n];const o=[];for(;r<e.length;r++){const i=t.parse(e[r],r,Qt);if(!i)return null;o.push(i)}return new ci(i,o)}evaluate(e){for(let t=0;t<this.args.length;t++){const i=this.args[t].evaluate(e);if(!qt(this.type,ni(i)))return i;if(t===this.args.length-1)throw new ai(`The expression ${JSON.stringify(this.args[t].serialize())} evaluated to ${$t(ni(i))} but was expected to be of type ${$t(this.type)}.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){const e=this.type,t=[e.kind];if("array"===e.kind){const i=e.itemType;if("string"===i.kind||"number"===i.kind||"boolean"===i.kind){t.push(i.kind);const r=e.N;("number"==typeof r||this.args.length>1)&&t.push(r)}}return t.concat(this.args.map((e=>e.serialize())))}}class ui{constructor(e){this.type=Vt,this.sections=e}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const i=e[1];if(!Array.isArray(i)&&"object"==typeof i)return t.error("First argument must be an image or text section.");const r=[];let n=!1;for(let i=1;i<=e.length-1;++i){const o=e[i];if(n&&"object"==typeof o&&!Array.isArray(o)){n=!1;let e=null;if(o["font-scale"]&&(e=t.parseObjectValue(o["font-scale"],i,"font-scale",Rt),!e))return null;let s=null;if(o["text-font"]&&(s=t.parseObjectValue(o["text-font"],i,"text-font",Gt(Dt)),!s))return null;let a=null;if(o["text-color"]&&(a=t.parseObjectValue(o["text-color"],i,"text-color",Ut),!a))return null;const l=r[r.length-1];l.scale=e,l.font=s,l.textColor=a}else{const o=t.parse(e[i],i,Qt);if(!o)return null;const s=o.type.kind;if("string"!==s&&"value"!==s&&"null"!==s&&"resolvedImage"!==s)return t.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");n=!0,r.push({content:o,scale:null,font:null,textColor:null})}}return new ui(r)}evaluate(e){return new Jt(this.sections.map((t=>{const i=t.content.evaluate(e);return ni(i)===Ht?new Yt("",i,null,null,null):new Yt(oi(i),null,t.scale?t.scale.evaluate(e):null,t.font?t.font.evaluate(e).join(","):null,t.textColor?t.textColor.evaluate(e):null)})))}eachChild(e){for(const t of this.sections)e(t.content),t.scale&&e(t.scale),t.font&&e(t.font),t.textColor&&e(t.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const t of this.sections){e.push(t.content.serialize());const i={};t.scale&&(i["font-scale"]=t.scale.serialize()),t.font&&(i["text-font"]=t.font.serialize()),t.textColor&&(i["text-color"]=t.textColor.serialize()),e.push(i)}return e}}class hi{constructor(e,t,i,r){this._imageWarnHistory={},this.type=Ht,this.namePrimary=e,this.nameSecondary=t,i&&(this.paramsPrimary=i.params,this.iconsetIdPrimary=i.iconset?i.iconset.id:void 0),r&&(this.paramsSecondary=r.params,this.iconsetIdSecondary=r.iconset?r.iconset.id:void 0)}static parse(e,t){if(e.length<2)return t.error("Expected two or more arguments.");let i=1;const r=[];function n(){if(i<e.length){const n=t.parse(e[i],i++,Dt);return n?(r.push({image:n,options:{}}),!0):(t.error(r.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function o(){if(i<e.length){const o=e[i];if(null===(n=o)||"object"!=typeof n||Array.isArray(n))return!0;const s=o.params,a=o.iconset,l=t.concat(i);if(!s&&!a)return i++,!0;if(s){if("object"!=typeof s||s.constructor!==Object)return l.error('Image options "params" should be an object'),!1;const e={},t=l.concat(void 0,"params");for(const i in s){if(!i)return t.error("Image parameter name should be non-empty"),!1;const r=t.concat(void 0,i).parse(s[i],void 0,Ut,void 0,{typeAnnotation:"coerce"});if(!r)return!1;e[i]=r}r[r.length-1].options.params=e}if(a){if("object"!=typeof a||a.constructor!==Object)return l.error('Image options "iconset" should be an object'),!1;if(!a.id)return l.error('Image options "iconset" should have an "id" property'),!1;r[r.length-1].options.iconset=a}return i++,!0}var n;return!0}for(let e=0;e<2;e++)if(!n()||!o())return;return new hi(r[0].image,r[1]?r[1].image:void 0,r[0].options,r[1]?r[1].options:void 0)}evaluateParams(e,t){const i={};if(t){for(const r in t)if(t[r])try{i[r]=t[r].evaluate(e)}catch(e){continue}if(0!==Object.keys(i).length)return{params:i}}}evaluate(e){const t={name:this.namePrimary.evaluate(e),iconsetId:this.iconsetIdPrimary},i=this.nameSecondary?{name:this.nameSecondary.evaluate(e),iconsetId:this.iconsetIdSecondary}:void 0,r=ti.build(t,i,this.paramsPrimary?this.evaluateParams(e,this.paramsPrimary):void 0,this.paramsSecondary?this.evaluateParams(e,this.paramsSecondary):void 0);if(r&&e.availableImages){const t=r.getPrimary().id;if(r.available=e.availableImages.some((e=>bt.isEqual(e,t))),r.available){const t=r.getSecondary()?r.getSecondary().id:null;t&&(r.available=e.availableImages.some((e=>bt.isEqual(e,t))))}}return r}eachChild(e){if(e(this.namePrimary),this.paramsPrimary)for(const t in this.paramsPrimary)this.paramsPrimary[t]&&e(this.paramsPrimary[t]);if(this.nameSecondary&&(e(this.nameSecondary),this.paramsSecondary))for(const t in this.paramsSecondary)this.paramsSecondary[t]&&e(this.paramsSecondary[t])}outputDefined(){return!1}serializeOptions(e,t){const i={};if(t&&(i.iconset={id:t}),e){i.params={};for(const t in e)e[t]&&(i.params[t]=e[t].serialize())}return Object.keys(i).length>0?i:void 0}serialize(){const e=["image",this.namePrimary.serialize()];if(this.paramsPrimary||this.iconsetIdPrimary){const t=this.serializeOptions(this.paramsPrimary,this.iconsetIdPrimary);t&&e.push(t)}if(this.nameSecondary&&(e.push(this.nameSecondary.serialize()),this.paramsSecondary||this.iconsetIdSecondary)){const t=this.serializeOptions(this.paramsSecondary,this.iconsetIdSecondary);t&&e.push(t)}return e}}function di(e){return e instanceof Number?"number":e instanceof String?"string":e instanceof Boolean?"boolean":Array.isArray(e)?"array":null===e?"null":typeof e}const pi={"to-boolean":Ot,"to-color":Ut,"to-number":Rt,"to-string":Dt};class fi{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const i=e[0],r=[];let n=zt;if("to-array"===i){if(!Array.isArray(e[1]))return null;const i=e[1].length;if(t.expectedType){if("array"!==t.expectedType.kind)return t.error(`Expected ${t.expectedType.kind} but found array.`);n=Gt(t.expectedType.itemType,i)}else{if(!(i>0&&ri(e[1][0])))return null;n=Gt(ni(e[1][0]),i)}for(let o=0;o<i;o++){const i=e[1][o];let s;if("array"===di(i))s=t.parse(i,void 0,n.itemType);else{const e=di(i);if(e!==n.itemType.kind)return t.error(`Expected ${n.itemType.kind} but found ${e}.`);s=t.registry.literal.parse(["literal",void 0===i?null:i],t)}if(!s)return null;r.push(s)}}else{if(("to-boolean"===i||"to-string"===i)&&2!==e.length)return t.error("Expected one argument.");n=pi[i];for(let i=1;i<e.length;i++){const n=t.parse(e[i],i,Qt);if(!n)return null;r.push(n)}}return new fi(n,r)}evaluate(e){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(e));if("color"===this.type.kind){let t,i;for(const r of this.args){if(t=r.evaluate(e),i=null,t instanceof Ct)return t;if("string"==typeof t){const i=e.parseColor(t);if(i)return i}else if(Array.isArray(t)&&(i=t.length<3||t.length>4?`Invalid rbga value ${JSON.stringify(t)}: expected an array containing either three or four numeric values.`:ii(t[0],t[1],t[2],t[3]),!i))return new Ct(t[0]/255,t[1]/255,t[2]/255,t[3])}throw new ai(i||`Could not parse color from value '${"string"==typeof t?t:String(JSON.stringify(t))}'`)}if("number"===this.type.kind){let t=null;for(const i of this.args){if(t=i.evaluate(e),null===t)return 0;const r=Number(t);if(!isNaN(r))return r}throw new ai(`Could not convert ${JSON.stringify(t)} to number.`)}return"formatted"===this.type.kind?Jt.fromString(oi(this.args[0].evaluate(e))):"resolvedImage"===this.type.kind?ti.build(oi(this.args[0].evaluate(e))):"array"===this.type.kind?this.args.map((t=>t.evaluate(e))):oi(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){if("formatted"===this.type.kind)return new ui([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new hi(this.args[0]).serialize();const e="array"===this.type.kind?[]:[`to-${this.type.kind}`];return this.eachChild((t=>{e.push(t.serialize())})),e}}const Ai=["Unknown","Point","LineString","Polygon"];class mi{constructor(e,t){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=e,this.options=t}id(){return this.feature&&void 0!==this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?Ai[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,t=this.featureDistanceData.scale,{x:i,y:r}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(i*t-e[0])+this.featureDistanceData.bearing[1]*(r*t-e[1])}return 0}parseColor(e){let t=this._parseColorCache[e];return t||(t=this._parseColorCache[e]=Ct.parse(e)),t}getConfig(e){return this.options?this.options.get(e):null}}class gi{constructor(e,t,i,r,n){this.name=e,this.type=t,this._evaluate=i,this.args=r,this._overloadIndex=n}evaluate(e){if(!this._evaluate){const e=gi.definitions[this.name];this._evaluate=Array.isArray(e)?e[2]:e.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map((e=>e.serialize())))}static parse(e,t){const i=e[0],r=gi.definitions[i];if(!r)return t.error(`Unknown expression "${i}". If you wanted a literal array, use ["literal", [...]].`,0);const n=Array.isArray(r)?r[0]:r.type,o=Array.isArray(r)?[[r[1],r[2]]]:r.overloads,s=[];let a=null,l=-1;for(const[r,c]of o){if(Array.isArray(r)&&r.length!==e.length-1)continue;s.push(r),l++,a=new Dr(t.registry,t.path,null,t.scope,void 0,t._scope,t.options);const o=[];let u=!1;for(let t=1;t<e.length;t++){const i=e[t],n=Array.isArray(r)?r[t-1]:r.type,s=a.parse(i,1+o.length,n);if(!s){u=!0;break}o.push(s)}if(!u)if(Array.isArray(r)&&r.length!==o.length)a.error(`Expected ${r.length} arguments, but found ${o.length} instead.`);else{for(let e=0;e<o.length;e++){const t=Array.isArray(r)?r[e]:r.type,i=o[e];a.concat(e+1).checkSubtype(t,i.type)}if(0===a.errors.length)return new gi(i,n,c,o,l)}}if(1===s.length)t.errors.push(...a.errors);else{const i=(s.length?s:o.map((([e])=>e))).map(_i).join(" | "),r=[];for(let i=1;i<e.length;i++){const n=t.parse(e[i],1+r.length);if(!n)return null;r.push($t(n.type))}t.error(`Expected arguments of type ${i}, but found (${r.join(", ")}) instead.`)}return null}static register(e,t){gi.definitions=t;for(const i in t)e[i]=gi}}function _i(e){return Array.isArray(e)?`(${e.map($t).join(", ")})`:`(${$t(e.type)}...)`}class yi{constructor(e,t,i){this.type=jt,this.locale=i,this.caseSensitive=e,this.diacriticSensitive=t}static parse(e,t){if(2!==e.length)return t.error("Expected one argument.");const i=e[1];if("object"!=typeof i||Array.isArray(i))return t.error("Collator options argument must be an object.");const r=void 0===i["case-sensitive"]?t.parse(!1,1,Ot):t.parseObjectValue(i["case-sensitive"],1,"case-sensitive",Ot);if(!r)return null;const n=void 0===i["diacritic-sensitive"]?t.parse(!1,1,Ot):t.parseObjectValue(i["diacritic-sensitive"],1,"diacritic-sensitive",Ot);if(!n)return null;let o=null;return i.locale&&(o=t.parseObjectValue(i.locale,1,"locale",Dt),!o)?null:new yi(r,n,o)}evaluate(e){return new Xt(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}function vi(e,t,i=0,r=e.length-1,n=bi){for(;r>i;){if(r-i>600){const o=r-i+1,s=t-i+1,a=Math.log(o),l=.5*Math.exp(2*a/3),c=.5*Math.sqrt(a*l*(o-l)/o)*(s-o/2<0?-1:1);vi(e,t,Math.max(i,Math.floor(t-s*l/o+c)),Math.min(r,Math.floor(t+(o-s)*l/o+c)),n)}const o=e[t];let s=i,a=r;for(xi(e,i,t),n(e[r],o)>0&&xi(e,i,r);s<a;){for(xi(e,s,a),s++,a--;n(e[s],o)<0;)s++;for(;n(e[a],o)>0;)a--}0===n(e[i],o)?xi(e,i,a):(a++,xi(e,a,r)),a<=t&&(i=a+1),t<=a&&(r=a-1)}}function xi(e,t,i){const r=e[t];e[t]=e[i],e[i]=r}function bi(e,t){return e<t?-1:e>t?1:0}function wi(e){let t=0;for(let i,r,n=0,o=e.length,s=o-1;n<o;s=n++)i=e[n],r=e[s],t+=(r.x-i.x)*(i.y+r.y);return t}function Ti(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.max(e[2],t[0]),e[3]=Math.max(e[3],t[1])}function Bi(e,t){return!(e[0]<=t[0]||e[2]>=t[2]||e[1]<=t[1]||e[3]>=t[3])}function Ci(e,t,i){const r=e[0]-t[0],n=e[1]-t[1],o=e[0]-i[0],s=e[1]-i[1];return r*s-o*n==0&&r*o<=0&&n*s<=0}function Si(e,t,i=!1){let r=!1;for(let a=0,l=t.length;a<l;a++){const l=t[a];for(let t=0,a=l.length,c=a-1;t<a;c=t++){const a=l[c],u=l[t];if(Ci(e,a,u))return i;(o=a)[1]>(n=e)[1]!=(s=u)[1]>n[1]&&n[0]<(s[0]-o[0])*(n[1]-o[1])/(s[1]-o[1])+o[0]&&(r=!r)}}var n,o,s;return r}function Ei(e,t,i,r){const n=r[0]-i[0],o=r[1]-i[1],s=(e[0]-i[0])*o-n*(e[1]-i[1]),a=(t[0]-i[0])*o-n*(t[1]-i[1]);return s>0&&a<0||s<0&&a>0}function Mi(e,t,i,r){return 0!=(n=[r[0]-i[0],r[1]-i[1]])[0]*(o=[t[0]-e[0],t[1]-e[1]])[1]-n[1]*o[0]&&!(!Ei(e,t,i,r)||!Ei(i,r,e,t));var n,o}const Ii=8192;function Pi(e,t){const i=(180+e[0])/360,r=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e[1]*Math.PI/360)))/360,n=Math.pow(2,t.z);return[Math.round(i*n*Ii),Math.round(r*n*Ii)]}function Li(e,t){for(let i=0;i<t.length;i++)if(Si(e,t[i]))return!0;return!1}function Fi(e,t,i){for(const r of i)for(let i=0,n=r.length,o=n-1;i<n;o=i++)if(Mi(e,t,r[o],r[i]))return!0;return!1}function ki(e,t){for(let i=0;i<e.length;++i)if(!Si(e[i],t))return!1;for(let i=0;i<e.length-1;++i)if(Fi(e[i],e[i+1],t))return!1;return!0}function zi(e,t){for(let i=0;i<t.length;i++)if(ki(e,t[i]))return!0;return!1}function Ri(e,t,i){const r=[];for(let n=0;n<e.length;n++){const o=[];for(let r=0;r<e[n].length;r++){const s=Pi(e[n][r],i);Ti(t,s),o.push(s)}r.push(o)}return r}function Di(e,t,i){const r=[];for(let n=0;n<e.length;n++){const o=Ri(e[n],t,i);r.push(o)}return r}function Oi(e,t,i,r){if(e[0]<i[0]||e[0]>i[2]){const t=.5*r;let n=e[0]-i[0]>t?-r:i[0]-e[0]>t?r:0;0===n&&(n=e[0]-i[2]>t?-r:i[2]-e[0]>t?r:0),e[0]+=n}Ti(t,e)}function Ui(e,t,i,r){const n=Math.pow(2,r.z)*Ii,o=[r.x*Ii,r.y*Ii],s=[];if(!e)return s;for(const r of e)for(const e of r){const r=[e.x+o[0],e.y+o[1]];Oi(r,t,i,n),s.push(r)}return s}function Ni(e,t,i,r){const n=Math.pow(2,r.z)*Ii,o=[r.x*Ii,r.y*Ii],s=[];if(!e)return s;for(const i of e){const e=[];for(const r of i){const i=[r.x+o[0],r.y+o[1]];Ti(t,i),e.push(i)}s.push(e)}if(t[2]-t[0]<=n/2){(a=t)[0]=a[1]=1/0,a[2]=a[3]=-1/0;for(const e of s)for(const r of e)Oi(r,t,i,n)}var a;return s}class Qi{constructor(e,t){this.type=Ot,this.geojson=e,this.geometries=t}static parse(e,t){if(2!==e.length)return t.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(ri(e[1])){const t=e[1];if("FeatureCollection"===t.type)for(let e=0;e<t.features.length;++e){const i=t.features[e].geometry.type;if("Polygon"===i||"MultiPolygon"===i)return new Qi(t,t.features[e].geometry)}else if("Feature"===t.type){const e=t.geometry.type;if("Polygon"===e||"MultiPolygon"===e)return new Qi(t,t.geometry)}else if("Polygon"===t.type||"MultiPolygon"===t.type)return new Qi(t,t)}return t.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(null!=e.geometry()&&null!=e.canonicalID()){if("Point"===e.geometryType())return function(e,t){const i=[1/0,1/0,-1/0,-1/0],r=[1/0,1/0,-1/0,-1/0],n=e.canonicalID();if(!n)return!1;if("Polygon"===t.type){const o=Ri(t.coordinates,r,n),s=Ui(e.geometry(),i,r,n);if(!Bi(i,r))return!1;for(const e of s)if(!Si(e,o))return!1}if("MultiPolygon"===t.type){const o=Di(t.coordinates,r,n),s=Ui(e.geometry(),i,r,n);if(!Bi(i,r))return!1;for(const e of s)if(!Li(e,o))return!1}return!0}(e,this.geometries);if("LineString"===e.geometryType())return function(e,t){const i=[1/0,1/0,-1/0,-1/0],r=[1/0,1/0,-1/0,-1/0],n=e.canonicalID();if(!n)return!1;if("Polygon"===t.type){const o=Ri(t.coordinates,r,n),s=Ni(e.geometry(),i,r,n);if(!Bi(i,r))return!1;for(const e of s)if(!ki(e,o))return!1}if("MultiPolygon"===t.type){const o=Di(t.coordinates,r,n),s=Ni(e.geometry(),i,r,n);if(!Bi(i,r))return!1;for(const e of s)if(!zi(e,o))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const ji={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},Vi=1/298.257223563,Hi=Vi*(2-Vi),Gi=Math.PI/180;class $i{static fromTile(e,t,i){const r=Math.PI*(1-2*(e+.5)/Math.pow(2,t)),n=Math.atan(.5*(Math.exp(r)-Math.exp(-r)))/Gi;return new $i(n,i)}static get units(){return ji}constructor(e,t){if(void 0===e)throw new Error("No latitude given.");if(t&&!ji[t])throw new Error(`Unknown unit ${t}. Use one of: ${Object.keys(ji).join(", ")}`);const i=6378.137*Gi*(t?ji[t]:1),r=Math.cos(e*Gi),n=1/(1-Hi*(1-r*r)),o=Math.sqrt(n);this.kx=i*o*r,this.ky=i*o*n*(1-Hi)}distance(e,t){const i=Ki(e[0]-t[0])*this.kx,r=(e[1]-t[1])*this.ky;return Math.sqrt(i*i+r*r)}bearing(e,t){const i=Ki(t[0]-e[0])*this.kx;return Math.atan2(i,(t[1]-e[1])*this.ky)/Gi}destination(e,t,i){const r=i*Gi;return this.offset(e,Math.sin(r)*t,Math.cos(r)*t)}offset(e,t,i){return[e[0]+t/this.kx,e[1]+i/this.ky]}lineDistance(e){let t=0;for(let i=0;i<e.length-1;i++)t+=this.distance(e[i],e[i+1]);return t}area(e){let t=0;for(let i=0;i<e.length;i++){const r=e[i];for(let e=0,n=r.length,o=n-1;e<n;o=e++)t+=Ki(r[e][0]-r[o][0])*(r[e][1]+r[o][1])*(i?-1:1)}return Math.abs(t)/2*this.kx*this.ky}along(e,t){let i=0;if(t<=0)return e[0];for(let r=0;r<e.length-1;r++){const n=e[r],o=e[r+1],s=this.distance(n,o);if(i+=s,i>t)return qi(n,o,(t-(i-s))/s)}return e[e.length-1]}pointToSegmentDistance(e,t,i){let[r,n]=t,o=Ki(i[0]-r)*this.kx,s=(i[1]-n)*this.ky;if(0!==o||0!==s){const t=(Ki(e[0]-r)*this.kx*o+(e[1]-n)*this.ky*s)/(o*o+s*s);t>1?(r=i[0],n=i[1]):t>0&&(r+=o/this.kx*t,n+=s/this.ky*t)}return o=Ki(e[0]-r)*this.kx,s=(e[1]-n)*this.ky,Math.sqrt(o*o+s*s)}pointOnLine(e,t){let i=1/0,r=e[0][0],n=e[0][1],o=0,s=0;for(let a=0;a<e.length-1;a++){let l=e[a][0],c=e[a][1],u=Ki(e[a+1][0]-l)*this.kx,h=(e[a+1][1]-c)*this.ky,d=0;0===u&&0===h||(d=(Ki(t[0]-l)*this.kx*u+(t[1]-c)*this.ky*h)/(u*u+h*h),d>1?(l=e[a+1][0],c=e[a+1][1]):d>0&&(l+=u/this.kx*d,c+=h/this.ky*d)),u=Ki(t[0]-l)*this.kx,h=(t[1]-c)*this.ky;const p=u*u+h*h;p<i&&(i=p,r=l,n=c,o=a,s=d)}return{point:[r,n],index:o,t:Math.max(0,Math.min(1,s))}}lineSlice(e,t,i){let r=this.pointOnLine(i,e),n=this.pointOnLine(i,t);if(r.index>n.index||r.index===n.index&&r.t>n.t){const e=r;r=n,n=e}const o=[r.point],s=r.index+1,a=n.index;!Zi(i[s],o[0])&&s<=a&&o.push(i[s]);for(let e=s+1;e<=a;e++)o.push(i[e]);return Zi(i[a],n.point)||o.push(n.point),o}lineSliceAlong(e,t,i){let r=0;const n=[];for(let o=0;o<i.length-1;o++){const s=i[o],a=i[o+1],l=this.distance(s,a);if(r+=l,r>e&&0===n.length&&n.push(qi(s,a,(e-(r-l))/l)),r>=t)return n.push(qi(s,a,(t-(r-l))/l)),n;r>e&&n.push(a)}return n}bufferPoint(e,t){const i=t/this.ky,r=t/this.kx;return[e[0]-r,e[1]-i,e[0]+r,e[1]+i]}bufferBBox(e,t){const i=t/this.ky,r=t/this.kx;return[e[0]-r,e[1]-i,e[2]+r,e[3]+i]}insideBBox(e,t){return Ki(e[0]-t[0])>=0&&Ki(e[0]-t[2])<=0&&e[1]>=t[1]&&e[1]<=t[3]}}function Zi(e,t){return e[0]===t[0]&&e[1]===t[1]}function qi(e,t,i){const r=Ki(t[0]-e[0]);return[e[0]+r*i,e[1]+(t[1]-e[1])*i]}function Ki(e){for(;e<-180;)e+=360;for(;e>180;)e-=360;return e}class Wi{constructor(e=[],t=(e,t)=>e<t?-1:e>t?1:0){if(this.data=e,this.length=this.data.length,this.compare=t,this.length>0)for(let e=(this.length>>1)-1;e>=0;e--)this._down(e)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(0===this.length)return;const e=this.data[0],t=this.data.pop();return--this.length>0&&(this.data[0]=t,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:t,compare:i}=this,r=t[e];for(;e>0;){const n=e-1>>1,o=t[n];if(i(r,o)>=0)break;t[e]=o,e=n}t[e]=r}_down(e){const{data:t,compare:i}=this,r=this.length>>1,n=t[e];for(;e<r;){let r=1+(e<<1);const o=r+1;if(o<this.length&&i(t[o],t[r])<0&&(r=o),i(t[r],n)>=0)break;t[e]=t[r],e=r}t[e]=n}}var Xi=8192;function Yi(e,t){return t.dist-e.dist}const Ji=100,er=50;function tr(e){const t=[1/0,1/0,-1/0,-1/0];if(t.length!==e.length)return!1;for(let i=0;i<t.length;i++)if(t[i]!==e[i])return!1;return!0}function ir(e){return e[1]-e[0]+1}function rr(e,t){const i=e[1]>=e[0]&&e[1]<t;return i||console.warn("Distance Expression: Index is out of range"),i}function nr(e,t){if(e[0]>e[1])return[null,null];const i=ir(e);if(t){if(2===i)return[e,null];const t=Math.floor(i/2);return[[e[0],e[0]+t],[e[0]+t,e[1]]]}{if(1===i)return[e,null];const t=Math.floor(i/2)-1;return[[e[0],e[0]+t],[e[0]+t+1,e[1]]]}}function or(e,t){const i=[1/0,1/0,-1/0,-1/0];if(!rr(t,e.length))return i;for(let r=t[0];r<=t[1];++r)Ti(i,e[r]);return i}function sr(e){const t=[1/0,1/0,-1/0,-1/0];for(let i=0;i<e.length;++i)for(let r=0;r<e[i].length;++r)Ti(t,e[i][r]);return t}function ar(e,t,i){if(tr(e)||tr(t))return NaN;let r=0,n=0;return e[2]<t[0]&&(r=t[0]-e[2]),e[0]>t[2]&&(r=e[0]-t[2]),e[1]>t[3]&&(n=e[1]-t[3]),e[3]<t[1]&&(n=t[1]-e[3]),i.distance([0,0],[r,n])}function lr(e){return 360*e-180}function cr(e){return 360/Math.PI*Math.atan(Math.exp((180-360*e)*Math.PI/180))-90}function ur(e,t){const i=Math.pow(2,t.z),r=(e.y/Xi+t.y)/i;return[lr((e.x/Xi+t.x)/i),cr(r)]}function hr(e,t){const i=[];for(let r=0;r<e.length;++r)i.push(ur(e[r],t));return i}function dr(e,t,i){const r=i.pointOnLine(t,e).point;return i.distance(e,r)}function pr(e,t,i,r,n){const o=i.slice(r[0],r[1]+1);let s=1/0;for(let i=t[0];i<=t[1];++i)if(0===(s=Math.min(s,dr(e[i],o,n))))return 0;return s}function fr(e,t,i,r,n){const o=Math.min(n.pointToSegmentDistance(e,i,r),n.pointToSegmentDistance(t,i,r)),s=Math.min(n.pointToSegmentDistance(i,e,t),n.pointToSegmentDistance(r,e,t));return Math.min(o,s)}function Ar(e,t,i,r,n){if(!rr(t,e.length)||!rr(r,i.length))return NaN;let o=1/0;for(let s=t[0];s<t[1];++s)for(let t=r[0];t<r[1];++t){if(Mi(e[s],e[s+1],i[t],i[t+1]))return 0;o=Math.min(o,fr(e[s],e[s+1],i[t],i[t+1],n))}return o}function mr(e,t,i,r,n){if(!rr(t,e.length)||!rr(r,i.length))return NaN;let o=1/0;for(let s=t[0];s<=t[1];++s)for(let t=r[0];t<=r[1];++t)if(0===(o=Math.min(o,n.distance(e[s],i[t]))))return o;return o}function gr(e,t,i){if(Si(e,t,!0))return 0;let r=1/0;for(const n of t){const t=n.length;if(t<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(n[0]!==n[t-1]&&0===(r=Math.min(r,i.pointToSegmentDistance(e,n[t-1],n[0]))))return r;if(0===(r=Math.min(r,dr(e,n,i))))return r}return r}function _r(e,t,i,r){if(!rr(t,e.length))return NaN;for(let r=t[0];r<=t[1];++r)if(Si(e[r],i,!0))return 0;let n=1/0;for(let o=t[0];o<t[1];++o)for(const t of i)for(let i=0,s=t.length,a=s-1;i<s;a=i++){if(Mi(e[o],e[o+1],t[a],t[i]))return 0;n=Math.min(n,fr(e[o],e[o+1],t[a],t[i],r))}return n}function yr(e,t){for(const i of e)for(let e=0;e<=i.length-1;++e)if(Si(i[e],t,!0))return!0;return!1}function vr(e,t,i,r=1/0){const n=sr(e),o=sr(t);if(r!==1/0&&ar(n,o,i)>=r)return r;if(Bi(n,o)){if(yr(e,t))return 0}else if(yr(t,e))return 0;let s=r;for(const r of e)for(let e=0,n=r.length,o=n-1;e<n;o=e++)for(const n of t)for(let t=0,a=n.length,l=a-1;t<a;l=t++){if(Mi(r[o],r[e],n[l],n[t]))return 0;s=Math.min(s,fr(r[o],r[e],n[l],n[t],i))}return s}function xr(e,t,i,r,n,o,s){if(null===o||null===s)return;const a=ar(or(r,o),or(n,s),i);a<t&&e.push({dist:a,range1:o,range2:s})}function br(e,t,i,r,n=1/0){let o=Math.min(r.distance(e[0],i[0][0]),n);if(0===o)return o;const s=new Wi([{dist:0,range1:[0,e.length-1],range2:[0,0]}],Yi),a=t?er:Ji,l=sr(i);for(;s.length;){const n=s.pop();if(n.dist>=o)continue;const c=n.range1;if(ir(c)<=a){if(!rr(c,e.length))return NaN;if(t){const t=_r(e,c,i,r);if(0===(o=Math.min(o,t)))return o}else for(let t=c[0];t<=c[1];++t){const n=gr(e[t],i,r);if(0===(o=Math.min(o,n)))return o}}else{const i=nr(c,t);if(null!==i[0]){const t=ar(or(e,i[0]),l,r);t<o&&s.push({dist:t,range1:i[0],range2:[0,0]})}if(null!==i[1]){const t=ar(or(e,i[1]),l,r);t<o&&s.push({dist:t,range1:i[1],range2:[0,0]})}}}return o}function wr(e,t,i,r,n,o=1/0){let s=Math.min(o,n.distance(e[0],i[0]));if(0===s)return s;const a=new Wi([{dist:0,range1:[0,e.length-1],range2:[0,i.length-1]}],Yi),l=t?er:Ji,c=r?er:Ji;for(;a.length;){const o=a.pop();if(o.dist>=s)continue;const u=o.range1,h=o.range2;if(ir(u)<=l&&ir(h)<=c){if(!rr(u,e.length)||!rr(h,i.length))return NaN;if(t&&r?s=Math.min(s,Ar(e,u,i,h,n)):t||r?t&&!r?s=Math.min(s,pr(i,h,e,u,n)):!t&&r&&(s=Math.min(s,pr(e,u,i,h,n))):s=Math.min(s,mr(e,u,i,h,n)),0===s)return s}else{const o=nr(u,t),l=nr(h,r);xr(a,s,n,e,i,o[0],l[0]),xr(a,s,n,e,i,o[0],l[1]),xr(a,s,n,e,i,o[1],l[0]),xr(a,s,n,e,i,o[1],l[1])}}return s}function Tr(e,t,i,r,n=1/0){let o=n;const s=or(e,[0,e.length-1]);for(const n of i)if(!(o!==1/0&&ar(s,or(n,[0,n.length-1]),r)>=o)&&(o=Math.min(o,wr(e,t,n,!0,r,o)),0===o))return o;return o}function Br(e,t,i,r,n=1/0){let o=n;const s=or(e,[0,e.length-1]);for(const n of i){if(o!==1/0&&ar(s,sr(n),r)>=o)continue;const i=br(e,t,n,r,o);if(isNaN(i))return i;if(0===(o=Math.min(o,i)))return o}return o}function Cr(e){return"Point"===e||"MultiPoint"===e||"LineString"===e||"MultiLineString"===e||"Polygon"===e||"MultiPolygon"===e}class Sr{constructor(e,t){this.type=Rt,this.geojson=e,this.geometries=t}static parse(e,t){if(2!==e.length)return t.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(ri(e[1])){const t=e[1];if("FeatureCollection"===t.type){for(let e=0;e<t.features.length;++e)if(Cr(t.features[e].geometry.type))return new Sr(t,t.features[e].geometry)}else if("Feature"===t.type){if(Cr(t.geometry.type))return new Sr(t,t.geometry)}else if(Cr(t.type))return new Sr(t,t)}return t.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){const t=e.geometry(),i=e.canonicalID();if(null!=t&&null!=i){if("Point"===e.geometryType())return function(e,t,i){const r=[];for(const i of e)for(const e of i)r.push(ur(e,t));const n=new $i(r[0][1],"meters");return"Point"===i.type||"MultiPoint"===i.type||"LineString"===i.type?wr(r,!1,"Point"===i.type?[i.coordinates]:i.coordinates,"LineString"===i.type,n):"MultiLineString"===i.type?Tr(r,!1,i.coordinates,n):"Polygon"===i.type||"MultiPolygon"===i.type?Br(r,!1,"Polygon"===i.type?[i.coordinates]:i.coordinates,n):null}(t,i,this.geometries);if("LineString"===e.geometryType())return function(e,t,i){const r=[];for(const i of e){const e=[];for(const r of i)e.push(ur(r,t));r.push(e)}const n=new $i(r[0][0][1],"meters");if("Point"===i.type||"MultiPoint"===i.type||"LineString"===i.type)return Tr("Point"===i.type?[i.coordinates]:i.coordinates,"LineString"===i.type,r,n);if("MultiLineString"===i.type){let e=1/0;for(let t=0;t<i.coordinates.length;t++){const o=Tr(i.coordinates[t],!0,r,n,e);if(isNaN(o))return o;if(0===(e=Math.min(e,o)))return e}return e}if("Polygon"===i.type||"MultiPolygon"===i.type){let e=1/0;for(let t=0;t<r.length;t++){const o=Br(r[t],!0,"Polygon"===i.type?[i.coordinates]:i.coordinates,n,e);if(isNaN(o))return o;if(0===(e=Math.min(e,o)))return e}return e}return null}(t,i,this.geometries);if("Polygon"===e.geometryType())return function(e,t,i){const r=[];for(const i of function(e){const t=e.length;if(t<=1)return[e];const i=[];let r,n;for(let o=0;o<t;o++){const t=wi(e[o]);0!==t&&(e[o].area=Math.abs(t),void 0===n&&(n=t<0),n===t<0?(r&&i.push(r),r=[e[o]]):r.push(e[o]))}return r&&i.push(r),i}(e)){const e=[];for(let r=0;r<i.length;++r)e.push(hr(i[r],t));r.push(e)}const n=new $i(r[0][0][0][1],"meters");if("Point"===i.type||"MultiPoint"===i.type||"LineString"===i.type)return Br("Point"===i.type?[i.coordinates]:i.coordinates,"LineString"===i.type,r,n);if("MultiLineString"===i.type){let e=1/0;for(let t=0;t<i.coordinates.length;t++){const o=Br(i.coordinates[t],!0,r,n,e);if(isNaN(o))return o;if(0===(e=Math.min(e,o)))return e}return e}return"Polygon"===i.type||"MultiPolygon"===i.type?function(e,t,i){let r=1/0;for(const n of e)for(const e of t){const t=vr(n,e,i,r);if(isNaN(t))return t;if(0===(r=Math.min(r,t)))return r}return r}("Polygon"===i.type?[i.coordinates]:i.coordinates,r,n):null}(t,i,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function Er(e,t){switch(e){case"string":return oi(t);case"number":return+t;case"boolean":return!!t;case"color":return Ct.parse(t);case"formatted":return Jt.fromString(oi(t));case"resolvedImage":return ti.build(oi(t))}return t}function Mr(e,t,i,r){return void 0!==r&&(e=r*Math.round(e/r)),void 0!==t&&e<t&&(e=t),void 0!==i&&e>i&&(e=i),e}class Ir{constructor(e,t,i){this.type=e,this.key=t,this.scope=i}static parse(e,t){let i=t.expectedType;if(null==i&&(i=Qt),e.length<2||e.length>3)return t.error("Invalid number of arguments for 'config' expression.");const r=t.parse(e[1],1);if(!(r instanceof si))return t.error("Key name of 'config' expression must be a string literal.");if(e.length>=3){const n=t.parse(e[2],2);return n instanceof si?new Ir(i,oi(r.value),oi(n.value)):t.error("Scope of 'config' expression must be a string literal.")}return new Ir(i,oi(r.value))}evaluate(e){const t=[this.key,this.scope,e.scope].filter(Boolean).join(""),i=e.getConfig(t);if(!i)return null;const{type:r,value:n,values:o,minValue:s,maxValue:a,stepValue:l}=i,c=i.default.evaluate(e);let u=c;if(n){const t=e.scope;e.scope=(t||"").split("").slice(1).join(""),u=n.evaluate(e),e.scope=t}return r&&(u=Er(r,u)),void 0===u||void 0===s&&void 0===a&&void 0===l||("number"==typeof u?u=Mr(u,s,a,l):Array.isArray(u)&&(u=u.map((e=>"number"==typeof e?Mr(e,s,a,l):e)))),void 0!==n&&void 0!==u&&o&&!o.includes(u)&&(u=c,r&&(u=Er(r,u))),(r&&r!==this.type||void 0!==u&&ni(u)!==this.type)&&(u=Er(this.type.kind,u)),u}eachChild(){}outputDefined(){return!1}serialize(){const e=["config",this.key];return this.scope&&e.concat(this.key),e}}function Pr(e){if(e instanceof gi){if("get"===e.name&&1===e.args.length)return!1;if("feature-state"===e.name)return!1;if("has"===e.name&&1===e.args.length)return!1;if("properties"===e.name||"geometry-type"===e.name||"id"===e.name)return!1;if(/^filter-/.test(e.name))return!1}if(e instanceof Qi)return!1;if(e instanceof Sr)return!1;let t=!0;return e.eachChild((e=>{t&&!Pr(e)&&(t=!1)})),t}function Lr(e){if(e instanceof gi&&"feature-state"===e.name)return!1;let t=!0;return e.eachChild((e=>{t&&!Lr(e)&&(t=!1)})),t}function Fr(e){if(e instanceof Ir)return new Set([e.key]);let t=new Set;return e.eachChild((e=>{t=new Set([...t,...Fr(e)])})),t}function kr(e,t){if(e instanceof gi&&t.indexOf(e.name)>=0)return!1;let i=!0;return e.eachChild((e=>{i&&!kr(e,t)&&(i=!1)})),i}class zr{constructor(e,t){this.type=t.type,this.name=e,this.boundExpression=t}static parse(e,t){if(2!==e.length||"string"!=typeof e[1])return t.error("'var' expression requires exactly one string literal argument.");const i=e[1];return t.scope.has(i)?new zr(i,t.scope.get(i)):t.error(`Unknown variable "${i}". Make sure "${i}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Rr{constructor(e,t=[],i,r=new kt,n=[],o,s){this.registry=e,this.path=t,this.key=t.map((e=>"string"==typeof e?`['${e}']`:`[${e}]`)).join(""),this.scope=r,this.errors=n,this.expectedType=i,this._scope=o,this.options=s}parse(e,t,i,r,n={}){return t||i?this.concat(t,null,i,r)._parse(e,n):this._parse(e,n)}parseObjectValue(e,t,i,r,n,o={}){return this.concat(t,i,r,n)._parse(e,o)}_parse(e,t){function i(e,t,i){return"assert"===i?new ci(t,[e]):"coerce"===i?new fi(t,[e]):e}if(null!==e&&"string"!=typeof e&&"boolean"!=typeof e&&"number"!=typeof e||(e=["literal",e]),Array.isArray(e)){if(0===e.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const r="string"==typeof e[0]?this.registry[e[0]]:void 0;if(r){let n=r.parse(e,this);if(!n)return null;if(this.expectedType){const e=this.expectedType,r=n.type;if("string"!==e.kind&&"number"!==e.kind&&"boolean"!==e.kind&&"object"!==e.kind&&"array"!==e.kind||"value"!==r.kind)if("color"!==e.kind&&"formatted"!==e.kind&&"resolvedImage"!==e.kind||"value"!==r.kind&&"string"!==r.kind){if(this.checkSubtype(e,r))return null}else n=i(n,e,t.typeAnnotation||"coerce");else n=i(n,e,t.typeAnnotation||"assert")}if(!(n instanceof si)&&"resolvedImage"!==n.type.kind&&Or(n)){const t=new mi(this._scope,this.options);try{n=new si(n.type,n.evaluate(t))}catch(e){return this.error(e.message),null}}return n}return fi.parse(["to-array",e],this)}return this.error(void 0===e?"'undefined' value invalid. Use null instead.":"object"==typeof e?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,t,i,r){let n="number"==typeof e?this.path.concat(e):this.path;n="string"==typeof t?n.concat(t):n;const o=r?this.scope.concat(r):this.scope;return new Rr(this.registry,n,i||null,o,this.errors,this._scope,this.options)}error(e,...t){const i=`${this.key}${t.map((e=>`[${e}]`)).join("")}`;this.errors.push(new Ft(i,e))}checkSubtype(e,t){const i=qt(e,t);return i&&this.error(i),i}}var Dr=Rr;function Or(e){if(e instanceof zr)return Or(e.boundExpression);if(e instanceof gi&&"error"===e.name)return!1;if(e instanceof yi)return!1;if(e instanceof Qi)return!1;if(e instanceof Sr)return!1;if(e instanceof Ir)return!1;const t=e instanceof fi||e instanceof ci;let i=!0;return e.eachChild((e=>{i=t?i&&Or(e):i&&e instanceof si})),!!i&&Pr(e)&&kr(e,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function Ur(e,t){const i=e.length-1;let r,n,o=0,s=i,a=0;for(;o<=s;)if(a=Math.floor((o+s)/2),r=e[a],n=e[a+1],r<=t){if(a===i||t<n)return a;o=a+1}else{if(!(r>t))throw new ai("Input is not a number.");s=a-1}return 0}class Nr{constructor(e,t,i){this.type=e,this.input=t,this.labels=[],this.outputs=[];for(const[e,t]of i)this.labels.push(e),this.outputs.push(t)}static parse(e,t){if(e.length-1<4)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");const i=t.parse(e[1],1,Rt);if(!i)return null;const r=[];let n=null;t.expectedType&&"value"!==t.expectedType.kind&&(n=t.expectedType);for(let i=1;i<e.length;i+=2){const o=1===i?-1/0:e[i],s=e[i+1],a=i,l=i+1;if("number"!=typeof o)return t.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',a);if(r.length&&r[r.length-1][0]>=o)return t.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',a);const c=t.parse(s,l,n);if(!c)return null;n=n||c.type,r.push([o,c])}return new Nr(n,i,r)}evaluate(e){const t=this.labels,i=this.outputs;if(1===t.length)return i[0].evaluate(e);const r=this.input.evaluate(e);if(r<=t[0])return i[0].evaluate(e);const n=t.length;return r>=t[n-1]?i[n-1].evaluate(e):i[Ur(t,r)].evaluate(e)}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}serialize(){const e=["step",this.input.serialize()];for(let t=0;t<this.labels.length;t++)t>0&&e.push(this.labels[t]),e.push(this.outputs[t].serialize());return e}}const Qr=.95047,jr=1.08883,Vr=4/29,Hr=6/29,Gr=3*Hr*Hr,$r=Hr*Hr*Hr,Zr=Math.PI/180,qr=180/Math.PI;function Kr(e){return e>$r?Math.pow(e,1/3):e/Gr+Vr}function Wr(e){return e>Hr?e*e*e:Gr*(e-Vr)}function Xr(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function Yr(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function Jr(e){const t=Yr(e.r),i=Yr(e.g),r=Yr(e.b),n=Kr((.4124564*t+.3575761*i+.1804375*r)/Qr),o=Kr((.2126729*t+.7151522*i+.072175*r)/1);return{l:116*o-16,a:500*(n-o),b:200*(o-Kr((.0193339*t+.119192*i+.9503041*r)/jr)),alpha:e.a}}function en(e){let t=(e.l+16)/116,i=isNaN(e.a)?t:t+e.a/500,r=isNaN(e.b)?t:t-e.b/200;return t=1*Wr(t),i=Qr*Wr(i),r=jr*Wr(r),new Ct(Xr(3.2404542*i-1.5371385*t-.4985314*r),Xr(-.969266*i+1.8760108*t+.041556*r),Xr(.0556434*i-.2040259*t+1.0572252*r),e.alpha)}function tn(e,t,i){const r=t-e;return e+i*(r>180||r<-180?r-360*Math.round(r/360):r)}const rn={forward:Jr,reverse:en,interpolate:function(e,t,i){return{l:Et(e.l,t.l,i),a:Et(e.a,t.a,i),b:Et(e.b,t.b,i),alpha:Et(e.alpha,t.alpha,i)}}},nn={forward:function(e){const{l:t,a:i,b:r}=Jr(e),n=Math.atan2(r,i)*qr;return{h:n<0?n+360:n,c:Math.sqrt(i*i+r*r),l:t,alpha:e.a}},reverse:function(e){const t=e.h*Zr,i=e.c;return en({l:e.l,a:Math.cos(t)*i,b:Math.sin(t)*i,alpha:e.alpha})},interpolate:function(e,t,i){return{h:tn(e.h,t.h,i),c:Et(e.c,t.c,i),l:Et(e.l,t.l,i),alpha:Et(e.alpha,t.alpha,i)}}};var on=Object.freeze({__proto__:null,hcl:nn,lab:rn});class sn{constructor(e,t,i,r,n){this.type=e,this.operator=t,this.interpolation=i,this.input=r,this.labels=[],this.outputs=[];for(const[e,t]of n)this.labels.push(e),this.outputs.push(t)}static interpolationFactor(e,t,i,r){let n=0;if("exponential"===e.name)n=an(t,e.base,i,r);else if("linear"===e.name)n=an(t,1,i,r);else if("cubic-bezier"===e.name){const o=e.controlPoints;n=new Q(o[0],o[1],o[2],o[3]).solve(an(t,1,i,r))}return n}static parse(e,t){let[i,r,n,...o]=e;if(!Array.isArray(r)||0===r.length)return t.error("Expected an interpolation type expression.",1);if("linear"===r[0])r={name:"linear"};else if("exponential"===r[0]){const e=r[1];if("number"!=typeof e)return t.error("Exponential interpolation requires a numeric base.",1,1);r={name:"exponential",base:e}}else{if("cubic-bezier"!==r[0])return t.error(`Unknown interpolation type ${String(r[0])}`,1,0);{const e=r.slice(1);if(4!==e.length||e.some((e=>"number"!=typeof e||e<0||e>1)))return t.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);r={name:"cubic-bezier",controlPoints:e}}}if(e.length-1<4)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length-1>3&&(e.length-1)%2!=0)return t.error("Expected an even number of arguments.");if(n=t.parse(n,2,Rt),!n)return null;const s=[];let a=null;"interpolate-hcl"===i||"interpolate-lab"===i?a=Ut:t.expectedType&&"value"!==t.expectedType.kind&&(a=t.expectedType);for(let e=0;e<o.length;e+=2){const i=o[e],r=o[e+1],n=e+3,l=e+4;if("number"!=typeof i)return t.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',n);if(s.length&&s[s.length-1][0]>=i)return t.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',n);const c=t.parse(r,l,a);if(!c)return null;a=a||c.type,s.push([i,c])}return"number"===a.kind||"color"===a.kind||"array"===a.kind&&"number"===a.itemType.kind&&"number"==typeof a.N?new sn(a,i,r,n,s):t.error(`Type ${$t(a)} is not interpolatable.`)}evaluate(e){const t=this.labels,i=this.outputs;if(1===t.length)return i[0].evaluate(e);const r=this.input.evaluate(e);if(r<=t[0])return i[0].evaluate(e);const n=t.length;if(r>=t[n-1])return i[n-1].evaluate(e);const o=Ur(t,r),s=sn.interpolationFactor(this.interpolation,r,t[o],t[o+1]),a=i[o].evaluate(e),l=i[o+1].evaluate(e);return"interpolate"===this.operator?Pt[this.type.kind.toLowerCase()](a,l,s):"interpolate-hcl"===this.operator?nn.reverse(nn.interpolate(nn.forward(a),nn.forward(l),s)):rn.reverse(rn.interpolate(rn.forward(a),rn.forward(l),s))}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}serialize(){let e;e="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier",...this.interpolation.controlPoints];const t=[this.operator,e,this.input.serialize()];for(let e=0;e<this.labels.length;e++)t.push(this.labels[e],this.outputs[e].serialize());return t}}function an(e,t,i,r){const n=r-i,o=e-i;return 0===n?0:1===t?o/n:(Math.pow(t,o)-1)/(Math.pow(t,n)-1)}class ln{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expectected at least one argument.");let i=null;const r=t.expectedType;r&&"value"!==r.kind&&(i=r);const n=[];for(const r of e.slice(1)){const e=t.parse(r,1+n.length,i,void 0,{typeAnnotation:"omit"});if(!e)return null;i=i||e.type,n.push(e)}const o=r&&n.some((e=>qt(r,e.type)));return new ln(o?Qt:i,n)}evaluate(e){let t,i=null,r=0;for(const n of this.args){if(r++,i=n.evaluate(e),i&&i instanceof ti&&!i.available&&(t||(t=i),i=null,r===this.args.length))return t;if(null!==i)break}return i}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){const e=["coalesce"];return this.eachChild((t=>{e.push(t.serialize())})),e}}class cn{constructor(e,t){this.type=t.type,this.bindings=[].concat(e),this.result=t}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const t of this.bindings)e(t[1]);e(this.result)}static parse(e,t){if(e.length<4)return t.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const i=[];for(let r=1;r<e.length-1;r+=2){const n=e[r];if("string"!=typeof n)return t.error(`Expected string, but found ${typeof n} instead.`,r);if(/[^a-zA-Z0-9_]/.test(n))return t.error("Variable names must contain only alphanumeric characters or '_'.",r);const o=t.parse(e[r+1],r+1);if(!o)return null;i.push([n,o])}const r=t.parse(e[e.length-1],e.length-1,t.expectedType,i);return r?new cn(i,r):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[t,i]of this.bindings)e.push(t,i.serialize());return e.push(this.result.serialize()),e}}class un{constructor(e,t,i){this.type=e,this.index=t,this.input=i}static parse(e,t){if(3!==e.length)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const i=t.parse(e[1],1,Rt),r=t.parse(e[2],2,Gt(t.expectedType||Qt));return i&&r?new un(r.type.itemType,i,r):null}evaluate(e){const t=this.index.evaluate(e),i=this.input.evaluate(e);if(t<0)throw new ai(`Array index out of bounds: ${t} < 0.`);if(t>=i.length)throw new ai(`Array index out of bounds: ${t} > ${i.length-1}.`);if(t!==Math.floor(t))throw new ai(`Array index must be an integer, but found ${t} instead. Use at-interpolated to retrieve interpolated result with a fractional index.`);return i[t]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class hn{constructor(e,t,i){this.type=e,this.index=t,this.input=i}static parse(e,t){if(3!==e.length)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const i=t.parse(e[1],1,Rt),r=t.parse(e[2],2,Gt(t.expectedType||Qt));return i&&r?new hn(r.type.itemType,i,r):null}evaluate(e){const t=this.index.evaluate(e),i=this.input.evaluate(e);if(t<0)throw new ai(`Array index out of bounds: ${t} < 0.`);if(t>i.length-1)throw new ai(`Array index out of bounds: ${t} > ${i.length-1}.`);if(t===Math.floor(t))return i[t];const r=Math.floor(t),n=Math.ceil(t),o=i[r],s=i[n];if("number"!=typeof o||"number"!=typeof s)throw new ai(`Cannot interpolate between non-number values at index ${t}.`);const a=t-r;return o*(1-a)+s*a}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at-interpolated",this.index.serialize(),this.input.serialize()]}}class dn{constructor(e,t){this.type=Ot,this.needle=e,this.haystack=t}static parse(e,t){if(3!==e.length)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const i=t.parse(e[1],1,Qt),r=t.parse(e[2],2,Qt);return i&&r?Kt(i.type,[Ot,Dt,Rt,zt,Qt])?new dn(i,r):t.error(`Expected first argument to be of type boolean, string, number or null, but found ${$t(i.type)} instead`):null}evaluate(e){const t=this.needle.evaluate(e),i=this.haystack.evaluate(e);if(null==i)return!1;if(!Wt(t,["boolean","string","number","null"]))throw new ai(`Expected first argument to be of type boolean, string, number or null, but found ${$t(ni(t))} instead.`);if(!Wt(i,["string","array"]))throw new ai(`Expected second argument to be of type array or string, but found ${$t(ni(i))} instead.`);return i.indexOf(t)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class pn{constructor(e,t,i){this.type=Rt,this.needle=e,this.haystack=t,this.fromIndex=i}static parse(e,t){if(e.length<=2||e.length>=5)return t.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const i=t.parse(e[1],1,Qt),r=t.parse(e[2],2,Qt);if(!i||!r)return null;if(!Kt(i.type,[Ot,Dt,Rt,zt,Qt]))return t.error(`Expected first argument to be of type boolean, string, number or null, but found ${$t(i.type)} instead`);if(4===e.length){const n=t.parse(e[3],3,Rt);return n?new pn(i,r,n):null}return new pn(i,r)}evaluate(e){const t=this.needle.evaluate(e),i=this.haystack.evaluate(e);if(!Wt(t,["boolean","string","number","null"]))throw new ai(`Expected first argument to be of type boolean, string, number or null, but found ${$t(ni(t))} instead.`);if(!Wt(i,["string","array"]))throw new ai(`Expected second argument to be of type array or string, but found ${$t(ni(i))} instead.`);if(this.fromIndex){const r=this.fromIndex.evaluate(e);return i.indexOf(t,r)}return i.indexOf(t)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class fn{constructor(e,t,i,r,n,o){this.inputType=e,this.type=t,this.input=i,this.cases=r,this.outputs=n,this.otherwise=o}static parse(e,t){if(e.length<5)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return t.error("Expected an even number of arguments.");let i,r;t.expectedType&&"value"!==t.expectedType.kind&&(r=t.expectedType);const n={},o=[];for(let s=2;s<e.length-1;s+=2){let a=e[s];const l=e[s+1];Array.isArray(a)||(a=[a]);const c=t.concat(s);if(0===a.length)return c.error("Expected at least one branch label.");for(const e of a){if("number"!=typeof e&&"string"!=typeof e)return c.error("Branch labels must be numbers or strings.");if("number"==typeof e&&Math.abs(e)>Number.MAX_SAFE_INTEGER)return c.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof e&&Math.floor(e)!==e)return c.error("Numeric branch labels must be integer values.");if(i){if(c.checkSubtype(i,ni(e)))return null}else i=ni(e);if(void 0!==n[String(e)])return c.error("Branch labels must be unique.");n[String(e)]=o.length}const u=t.parse(l,s,r);if(!u)return null;r=r||u.type,o.push(u)}const s=t.parse(e[1],1,Qt);if(!s)return null;const a=t.parse(e[e.length-1],e.length-1,r);return a?"value"!==s.type.kind&&t.concat(1).checkSubtype(i,s.type)?null:new fn(i,r,s,n,o,a):null}evaluate(e){const t=this.input.evaluate(e);return(ni(t)===this.inputType&&this.outputs[this.cases[t]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],t=Object.keys(this.cases).sort(),i=[],r={};for(const e of t){const t=r[this.cases[e]];void 0===t?(r[this.cases[e]]=i.length,i.push([this.cases[e],[e]])):i[t][1].push(e)}const n=e=>"number"===this.inputType.kind?Number(e):e;for(const[t,r]of i)e.push(1===r.length?n(r[0]):r.map(n)),e.push(this.outputs[t].serialize());return e.push(this.otherwise.serialize()),e}}class An{constructor(e,t,i){this.type=e,this.branches=t,this.otherwise=i}static parse(e,t){if(e.length<4)return t.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return t.error("Expected an odd number of arguments.");let i;t.expectedType&&"value"!==t.expectedType.kind&&(i=t.expectedType);const r=[];for(let n=1;n<e.length-1;n+=2){const o=t.parse(e[n],n,Ot);if(!o)return null;const s=t.parse(e[n+1],n+1,i);if(!s)return null;r.push([o,s]),i=i||s.type}const n=t.parse(e[e.length-1],e.length-1,i);return n?new An(i,r,n):null}evaluate(e){for(const[t,i]of this.branches)if(t.evaluate(e))return i.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[t,i]of this.branches)e(t),e(i);e(this.otherwise)}outputDefined(){return this.branches.every((([e,t])=>t.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild((t=>{e.push(t.serialize())})),e}}class mn{constructor(e,t,i,r){this.type=e,this.input=t,this.beginIndex=i,this.endIndex=r}static parse(e,t){if(e.length<=2||e.length>=5)return t.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const i=t.parse(e[1],1,Qt),r=t.parse(e[2],2,Rt);if(!i||!r)return null;if(!Kt(i.type,[Gt(Qt),Dt,Qt]))return t.error(`Expected first argument to be of type array or string, but found ${$t(i.type)} instead`);if(4===e.length){const n=t.parse(e[3],3,Rt);return n?new mn(i.type,i,r,n):null}return new mn(i.type,i,r)}evaluate(e){const t=this.input.evaluate(e),i=this.beginIndex.evaluate(e);if(!Wt(t,["string","array"]))throw new ai(`Expected first argument to be of type array or string, but found ${$t(ni(t))} instead.`);if(this.endIndex){const r=this.endIndex.evaluate(e);return t.slice(i,r)}return t.slice(i)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function gn(e,t){return"=="===e||"!="===e?"boolean"===t.kind||"string"===t.kind||"number"===t.kind||"null"===t.kind||"value"===t.kind:"string"===t.kind||"number"===t.kind||"value"===t.kind}function _n(e,t,i,r){return 0===r.compare(t,i)}function yn(e,t,i){const r="=="!==e&&"!="!==e;return class n{constructor(e,t,i){this.type=Ot,this.lhs=e,this.rhs=t,this.collator=i,this.hasUntypedArgument="value"===e.type.kind||"value"===t.type.kind}static parse(e,t){if(3!==e.length&&4!==e.length)return t.error("Expected two or three arguments.");const i=e[0];let o=t.parse(e[1],1,Qt);if(!o)return null;if(!gn(i,o.type))return t.concat(1).error(`"${i}" comparisons are not supported for type '${$t(o.type)}'.`);let s=t.parse(e[2],2,Qt);if(!s)return null;if(!gn(i,s.type))return t.concat(2).error(`"${i}" comparisons are not supported for type '${$t(s.type)}'.`);if(o.type.kind!==s.type.kind&&"value"!==o.type.kind&&"value"!==s.type.kind)return t.error(`Cannot compare types '${$t(o.type)}' and '${$t(s.type)}'.`);r&&("value"===o.type.kind&&"value"!==s.type.kind?o=new ci(s.type,[o]):"value"!==o.type.kind&&"value"===s.type.kind&&(s=new ci(o.type,[s])));let a=null;if(4===e.length){if("string"!==o.type.kind&&"string"!==s.type.kind&&"value"!==o.type.kind&&"value"!==s.type.kind)return t.error("Cannot use collator to compare non-string types.");if(a=t.parse(e[3],3,jt),!a)return null}return new n(o,s,a)}evaluate(n){const o=this.lhs.evaluate(n),s=this.rhs.evaluate(n);if(r&&this.hasUntypedArgument){const t=ni(o),i=ni(s);if(t.kind!==i.kind||"string"!==t.kind&&"number"!==t.kind)throw new ai(`Expected arguments for "${e}" to be (string, string) or (number, number), but found (${t.kind}, ${i.kind}) instead.`)}if(this.collator&&!r&&this.hasUntypedArgument){const e=ni(o),i=ni(s);if("string"!==e.kind||"string"!==i.kind)return t(n,o,s)}return this.collator?i(n,o,s,this.collator.evaluate(n)):t(n,o,s)}eachChild(e){e(this.lhs),e(this.rhs),this.collator&&e(this.collator)}outputDefined(){return!0}serialize(){const t=[e];return this.eachChild((e=>{t.push(e.serialize())})),t}}}const vn=yn("==",(function(e,t,i){return t===i}),_n),xn=yn("!=",(function(e,t,i){return t!==i}),(function(e,t,i,r){return!_n(0,t,i,r)})),bn=yn("<",(function(e,t,i){return t<i}),(function(e,t,i,r){return r.compare(t,i)<0})),wn=yn(">",(function(e,t,i){return t>i}),(function(e,t,i,r){return r.compare(t,i)>0})),Tn=yn("<=",(function(e,t,i){return t<=i}),(function(e,t,i,r){return r.compare(t,i)<=0})),Bn=yn(">=",(function(e,t,i){return t>=i}),(function(e,t,i,r){return r.compare(t,i)>=0}));class Cn{constructor(e,t,i,r,n,o){this.type=Dt,this.number=e,this.locale=t,this.currency=i,this.unit=r,this.minFractionDigits=n,this.maxFractionDigits=o}static parse(e,t){if(3!==e.length)return t.error("Expected two arguments.");const i=t.parse(e[1],1,Rt);if(!i)return null;const r=e[2];if("object"!=typeof r||Array.isArray(r))return t.error("NumberFormat options argument must be an object.");let n=null;if(r.locale&&(n=t.parseObjectValue(r.locale,2,"locale",Dt),!n))return null;let o=null;if(r.currency&&(o=t.parseObjectValue(r.currency,2,"currency",Dt),!o))return null;let s=null;if(r.unit&&(s=t.parseObjectValue(r.unit,2,"unit",Dt),!s))return null;let a=null;if(r["min-fraction-digits"]&&(a=t.parseObjectValue(r["min-fraction-digits"],2,"min-fraction-digits",Rt),!a))return null;let l=null;return r["max-fraction-digits"]&&(l=t.parseObjectValue(r["max-fraction-digits"],2,"max-fraction-digits",Rt),!l)?null:new Cn(i,n,o,s,a,l)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class Sn{constructor(e){this.type=Rt,this.input=e}static parse(e,t){if(2!==e.length)return t.error(`Expected 1 argument, but found ${e.length-1} instead.`);const i=t.parse(e[1],1);return i?"array"!==i.type.kind&&"string"!==i.type.kind&&"value"!==i.type.kind?t.error(`Expected argument of type string or array, but found ${$t(i.type)} instead.`):new Sn(i):null}evaluate(e){const t=this.input.evaluate(e);if("string"==typeof t)return t.length;if(Array.isArray(t))return t.length;throw new ai(`Expected value to be of type string or array, but found ${$t(ni(t))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild((t=>{e.push(t.serialize())})),e}}function En(e){return function(){e=1831565813+(e|=0)|0;let t=Math.imul(e^e>>>15,1|e);return t=t+Math.imul(t^t>>>7,61|t)^t,((t^t>>>14)>>>0)/4294967296}}const Mn={"==":vn,"!=":xn,">":wn,"<":bn,">=":Bn,"<=":Tn,array:ci,at:un,"at-interpolated":hn,boolean:ci,case:An,coalesce:ln,collator:yi,format:ui,image:hi,in:dn,"index-of":pn,interpolate:sn,"interpolate-hcl":sn,"interpolate-lab":sn,length:Sn,let:cn,literal:si,match:fn,number:ci,"number-format":Cn,object:ci,slice:mn,step:Nr,string:ci,"to-boolean":fi,"to-color":fi,"to-number":fi,"to-string":fi,var:zr,within:Qi,distance:Sr,config:Ir};function In(e,[t,i,r,n]){t=t.evaluate(e),i=i.evaluate(e),r=r.evaluate(e);const o=n?n.evaluate(e):1,s=ii(t,i,r,o);if(s)throw new ai(s);return new Ct(t/255*o,i/255*o,r/255*o,o)}function Pn(e,[t,i,r,n]){t=t.evaluate(e),i=i.evaluate(e),r=r.evaluate(e);const o=n?n.evaluate(e):1,s=function(e,t,i,r){return"number"==typeof e&&e>=0&&e<=360?"number"==typeof t&&t>=0&&t<=100&&"number"==typeof i&&i>=0&&i<=100?void 0===r||"number"==typeof r&&r>=0&&r<=1?null:`Invalid hsla value [${[e,t,i,r].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${("number"==typeof r?[e,t,i,r]:[e,t,i]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${("number"==typeof r?[e,t,i,r]:[e,t,i]).join(", ")}]: 'h' must be between 0 and 360.`}(t,i,r,o);if(s)throw new ai(s);const a=`hsla(${t}, ${i}%, ${r}%, ${o})`,l=Ct.parse(a);if(!l)throw new ai(`Failed to parse HSLA color: ${a}`);return l}function Ln(e,t){return e in t}function Fn(e,t){const i=t[e];return void 0===i?null:i}function kn(e){return{type:e}}function zn(e){return{result:"success",value:e}}function Rn(e){return{result:"error",value:e}}function Dn(e,t){return!!e&&!!e.parameters&&e.parameters.indexOf(t)>-1}function On(e){return"data-driven"===e["property-type"]}function Un(e){return Dn(e.expression,"measure-light")}function Nn(e){return Dn(e.expression,"zoom")}function Qn(e){return!!e.expression&&e.expression.interpolated}function jn(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)}function Vn(e){return e}function Hn(e,t){const i="color"===t.type,r=e.stops&&"object"==typeof e.stops[0][0],n=r||!(r||void 0!==e.property),o=e.type||(Qn(t)?"exponential":"interval");if(i&&((e=Lt({},e)).stops&&(e.stops=e.stops.map((e=>[e[0],Ct.parse(e[1])]))),e.default=Ct.parse(e.default?e.default:t.default)),e.colorSpace&&"rgb"!==e.colorSpace&&!on[e.colorSpace])throw new Error(`Unknown color space: ${e.colorSpace}`);let s,a,l;if("exponential"===o)s=qn;else if("interval"===o)s=Zn;else if("categorical"===o){s=$n,a=Object.create(null);for(const t of e.stops)a[t[0]]=t[1];l=typeof e.stops[0][0]}else{if("identity"!==o)throw new Error(`Unknown function type "${o}"`);s=Kn}if(r){const i={},r=[];for(let t=0;t<e.stops.length;t++){const n=e.stops[t],o=n[0].zoom;void 0===i[o]&&(i[o]={zoom:o,type:e.type,property:e.property,default:e.default,stops:[]},r.push(o)),i[o].stops.push([n[0].value,n[1]])}const n=[];for(const e of r)n.push([i[e].zoom,Hn(i[e],t)]);const o={name:"linear"};return{kind:"composite",interpolationType:o,interpolationFactor:sn.interpolationFactor.bind(void 0,o),zoomStops:n.map((e=>e[0])),evaluate:({zoom:i},r)=>qn({stops:n,base:e.base},t,i).evaluate(i,r)}}if(n){const i="exponential"===o?{name:"exponential",base:void 0!==e.base?e.base:1}:null;return{kind:"camera",interpolationType:i,interpolationFactor:sn.interpolationFactor.bind(void 0,i),zoomStops:e.stops.map((e=>e[0])),evaluate:({zoom:i})=>s(e,t,i,a,l)}}return{kind:"source",evaluate(i,r){const n=r&&r.properties?r.properties[e.property]:void 0;return void 0===n?Gn(e.default,t.default):s(e,t,n,a,l)}}}function Gn(e,t,i){return void 0!==e?e:void 0!==t?t:void 0!==i?i:void 0}function $n(e,t,i,r,n){return Gn(typeof i===n?r[i]:void 0,e.default,t.default)}function Zn(e,t,i){if("number"!==di(i))return Gn(e.default,t.default);const r=e.stops.length;if(1===r)return e.stops[0][1];if(i<=e.stops[0][0])return e.stops[0][1];if(i>=e.stops[r-1][0])return e.stops[r-1][1];const n=Ur(e.stops.map((e=>e[0])),i);return e.stops[n][1]}function qn(e,t,i){const r=void 0!==e.base?e.base:1;if("number"!==di(i))return Gn(e.default,t.default);const n=e.stops.length;if(1===n)return e.stops[0][1];if(i<=e.stops[0][0])return e.stops[0][1];if(i>=e.stops[n-1][0])return e.stops[n-1][1];const o=Ur(e.stops.map((e=>e[0])),i),s=function(e,t,i,r){const n=r-i,o=e-i;return 0===n?0:1===t?o/n:(Math.pow(t,o)-1)/(Math.pow(t,n)-1)}(i,r,e.stops[o][0],e.stops[o+1][0]),a=e.stops[o][1],l=e.stops[o+1][1];let c=Pt[t.type]||Vn;if(e.colorSpace&&"rgb"!==e.colorSpace){const t=on[e.colorSpace];c=(e,i)=>t.reverse(t.interpolate(t.forward(e),t.forward(i),s))}return"function"==typeof a.evaluate?{evaluate(...e){const t=a.evaluate.apply(void 0,e),i=l.evaluate.apply(void 0,e);if(void 0!==t&&void 0!==i)return c(t,i,s)}}:c(a,l,s)}function Kn(e,t,i){return"color"===t.type?i=Ct.parse(i):"formatted"===t.type?i=Jt.fromString(i.toString()):"resolvedImage"===t.type?i=ti.build(i.toString()):di(i)===t.type||"enum"===t.type&&t.values[i]||(i=void 0),Gn(i,e.default,t.default)}gi.register(Mn,{error:[{kind:"error"},[Dt],(e,[t])=>{throw new ai(t.evaluate(e))}],typeof:[Dt,[Qt],(e,[t])=>$t(ni(t.evaluate(e)))],"to-rgba":[Gt(Rt,4),[Ut],(e,[t])=>t.evaluate(e).toRenderColor(null).toArray()],"to-hsla":[Gt(Rt,4),[Ut],(e,[t])=>t.evaluate(e).toRenderColor(null).toHslaArray()],rgb:[Ut,[Rt,Rt,Rt],In],rgba:[Ut,[Rt,Rt,Rt,Rt],In],hsl:[Ut,[Rt,Rt,Rt],Pn],hsla:[Ut,[Rt,Rt,Rt,Rt],Pn],has:{type:Ot,overloads:[[[Dt],(e,[t])=>Ln(t.evaluate(e),e.properties())],[[Dt,Nt],(e,[t,i])=>Ln(t.evaluate(e),i.evaluate(e))]]},get:{type:Qt,overloads:[[[Dt],(e,[t])=>Fn(t.evaluate(e),e.properties())],[[Dt,Nt],(e,[t,i])=>Fn(t.evaluate(e),i.evaluate(e))]]},"feature-state":[Qt,[Dt],(e,[t])=>Fn(t.evaluate(e),e.featureState||{})],properties:[Nt,[],e=>e.properties()],"geometry-type":[Dt,[],e=>e.geometryType()],id:[Qt,[],e=>e.id()],zoom:[Rt,[],e=>e.globals.zoom],pitch:[Rt,[],e=>e.globals.pitch||0],"distance-from-center":[Rt,[],e=>e.distanceFromCenter()],"measure-light":[Rt,[Dt],(e,[t])=>e.measureLight(t.evaluate(e))],"heatmap-density":[Rt,[],e=>e.globals.heatmapDensity||0],"line-progress":[Rt,[],e=>e.globals.lineProgress||0],"raster-value":[Rt,[],e=>e.globals.rasterValue||0],"raster-particle-speed":[Rt,[],e=>e.globals.rasterParticleSpeed||0],"sky-radial-progress":[Rt,[],e=>e.globals.skyRadialProgress||0],accumulated:[Qt,[],e=>void 0===e.globals.accumulated?null:e.globals.accumulated],"+":[Rt,kn(Rt),(e,t)=>{let i=0;for(const r of t)i+=r.evaluate(e);return i}],"*":[Rt,kn(Rt),(e,t)=>{let i=1;for(const r of t)i*=r.evaluate(e);return i}],"-":{type:Rt,overloads:[[[Rt,Rt],(e,[t,i])=>t.evaluate(e)-i.evaluate(e)],[[Rt],(e,[t])=>-t.evaluate(e)]]},"/":[Rt,[Rt,Rt],(e,[t,i])=>t.evaluate(e)/i.evaluate(e)],"%":[Rt,[Rt,Rt],(e,[t,i])=>t.evaluate(e)%i.evaluate(e)],ln2:[Rt,[],()=>Math.LN2],pi:[Rt,[],()=>Math.PI],e:[Rt,[],()=>Math.E],"^":[Rt,[Rt,Rt],(e,[t,i])=>Math.pow(t.evaluate(e),i.evaluate(e))],sqrt:[Rt,[Rt],(e,[t])=>Math.sqrt(t.evaluate(e))],log10:[Rt,[Rt],(e,[t])=>Math.log(t.evaluate(e))/Math.LN10],ln:[Rt,[Rt],(e,[t])=>Math.log(t.evaluate(e))],log2:[Rt,[Rt],(e,[t])=>Math.log(t.evaluate(e))/Math.LN2],sin:[Rt,[Rt],(e,[t])=>Math.sin(t.evaluate(e))],cos:[Rt,[Rt],(e,[t])=>Math.cos(t.evaluate(e))],tan:[Rt,[Rt],(e,[t])=>Math.tan(t.evaluate(e))],asin:[Rt,[Rt],(e,[t])=>Math.asin(t.evaluate(e))],acos:[Rt,[Rt],(e,[t])=>Math.acos(t.evaluate(e))],atan:[Rt,[Rt],(e,[t])=>Math.atan(t.evaluate(e))],min:[Rt,kn(Rt),(e,t)=>Math.min(...t.map((t=>t.evaluate(e))))],max:[Rt,kn(Rt),(e,t)=>Math.max(...t.map((t=>t.evaluate(e))))],abs:[Rt,[Rt],(e,[t])=>Math.abs(t.evaluate(e))],round:[Rt,[Rt],(e,[t])=>{const i=t.evaluate(e);return i<0?-Math.round(-i):Math.round(i)}],floor:[Rt,[Rt],(e,[t])=>Math.floor(t.evaluate(e))],ceil:[Rt,[Rt],(e,[t])=>Math.ceil(t.evaluate(e))],"filter-==":[Ot,[Dt,Qt],(e,[t,i])=>e.properties()[t.value]===i.value],"filter-id-==":[Ot,[Qt],(e,[t])=>e.id()===t.value],"filter-type-==":[Ot,[Dt],(e,[t])=>e.geometryType()===t.value],"filter-<":[Ot,[Dt,Qt],(e,[t,i])=>{const r=e.properties()[t.value],n=i.value;return typeof r==typeof n&&r<n}],"filter-id-<":[Ot,[Qt],(e,[t])=>{const i=e.id(),r=t.value;return typeof i==typeof r&&i<r}],"filter->":[Ot,[Dt,Qt],(e,[t,i])=>{const r=e.properties()[t.value],n=i.value;return typeof r==typeof n&&r>n}],"filter-id->":[Ot,[Qt],(e,[t])=>{const i=e.id(),r=t.value;return typeof i==typeof r&&i>r}],"filter-<=":[Ot,[Dt,Qt],(e,[t,i])=>{const r=e.properties()[t.value],n=i.value;return typeof r==typeof n&&r<=n}],"filter-id-<=":[Ot,[Qt],(e,[t])=>{const i=e.id(),r=t.value;return typeof i==typeof r&&i<=r}],"filter->=":[Ot,[Dt,Qt],(e,[t,i])=>{const r=e.properties()[t.value],n=i.value;return typeof r==typeof n&&r>=n}],"filter-id->=":[Ot,[Qt],(e,[t])=>{const i=e.id(),r=t.value;return typeof i==typeof r&&i>=r}],"filter-has":[Ot,[Qt],(e,[t])=>t.value in e.properties()],"filter-has-id":[Ot,[],e=>null!==e.id()&&void 0!==e.id()],"filter-type-in":[Ot,[Gt(Dt)],(e,[t])=>t.value.indexOf(e.geometryType())>=0],"filter-id-in":[Ot,[Gt(Qt)],(e,[t])=>t.value.indexOf(e.id())>=0],"filter-in-small":[Ot,[Dt,Gt(Qt)],(e,[t,i])=>i.value.indexOf(e.properties()[t.value])>=0],"filter-in-large":[Ot,[Dt,Gt(Qt)],(e,[t,i])=>function(e,t,i,r){for(;i<=r;){const n=i+r>>1;if(t[n]===e)return!0;t[n]>e?r=n-1:i=n+1}return!1}(e.properties()[t.value],i.value,0,i.value.length-1)],all:{type:Ot,overloads:[[[Ot,Ot],(e,[t,i])=>t.evaluate(e)&&i.evaluate(e)],[kn(Ot),(e,t)=>{for(const i of t)if(!i.evaluate(e))return!1;return!0}]]},any:{type:Ot,overloads:[[[Ot,Ot],(e,[t,i])=>t.evaluate(e)||i.evaluate(e)],[kn(Ot),(e,t)=>{for(const i of t)if(i.evaluate(e))return!0;return!1}]]},"!":[Ot,[Ot],(e,[t])=>!t.evaluate(e)],"is-supported-script":[Ot,[Dt],(e,[t])=>{const i=e.globals&&e.globals.isSupportedScript;return!i||i(t.evaluate(e))}],upcase:[Dt,[Dt],(e,[t])=>t.evaluate(e).toUpperCase()],downcase:[Dt,[Dt],(e,[t])=>t.evaluate(e).toLowerCase()],concat:[Dt,kn(Qt),(e,t)=>t.map((t=>oi(t.evaluate(e)))).join("")],"resolved-locale":[Dt,[jt],(e,[t])=>t.evaluate(e).resolvedLocale()],random:[Rt,[Rt,Rt,Qt],(e,t)=>{const[i,r,n]=t.map((t=>t.evaluate(e)));if(i>r)return i;if(i===r)return i;let o;if("string"==typeof n)o=function(e){let t=0;if(0===e.length)return t;for(let i=0;i<e.length;i++)t=(t<<5)-t+e.charCodeAt(i),t|=0;return t}(n);else{if("number"!=typeof n)throw new ai(`Invalid seed input: ${n}`);o=n}return i+En(o)()*(r-i)}]});class Wn{constructor(e,t,i,r){this.expression=e,this._warningHistory={},this._evaluator=new mi(i,r),this._defaultValue=t?function(e){return"color"===e.type&&(jn(e.default)||Array.isArray(e.default))?new Ct(0,0,0,0):"color"===e.type?Ct.parse(e.default)||null:void 0===e.default?null:e.default}(t):null,this._enumValues=t&&"enum"===t.type?t.values:null,this.configDependencies=Fr(e)}evaluateWithoutErrorHandling(e,t,i,r,n,o,s,a){return this._evaluator.globals=e,this._evaluator.feature=t,this._evaluator.featureState=i,this._evaluator.canonical=r||null,this._evaluator.availableImages=n||null,this._evaluator.formattedSection=o,this._evaluator.featureTileCoord=s||null,this._evaluator.featureDistanceData=a||null,this.expression.evaluate(this._evaluator)}evaluate(e,t,i,r,n,o,s,a){this._evaluator.globals=e,this._evaluator.feature=t||null,this._evaluator.featureState=i||null,this._evaluator.canonical=r||null,this._evaluator.availableImages=n||null,this._evaluator.formattedSection=o||null,this._evaluator.featureTileCoord=s||null,this._evaluator.featureDistanceData=a||null;try{const e=this.expression.evaluate(this._evaluator);if(null==e||"number"==typeof e&&e!=e)return this._defaultValue;if(this._enumValues&&!(e in this._enumValues))throw new ai(`Expected value to be one of ${Object.keys(this._enumValues).map((e=>JSON.stringify(e))).join(", ")}, but found ${JSON.stringify(e)} instead.`);return e}catch(e){return this._warningHistory[e.message]||(this._warningHistory[e.message]=!0,"undefined"!=typeof console&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${e.message}`)),this._defaultValue}}}function Xn(e){return Array.isArray(e)&&e.length>0&&"string"==typeof e[0]&&e[0]in Mn}function Yn(e,t,i,r){const n=new Dr(Mn,[],t?function(e){const t={color:Ut,string:Dt,number:Rt,enum:Dt,boolean:Ot,formatted:Vt,resolvedImage:Ht};return"array"===e.type?Gt(t[e.value]||Qt,e.length):t[e.type]}(t):void 0,void 0,void 0,i,r),o=n.parse(e,void 0,void 0,void 0,t&&"string"===t.type?{typeAnnotation:"coerce"}:void 0);return o?zn(new Wn(o,t,i,r)):Rn(n.errors)}class Jn{constructor(e,t,i,r){this.kind=e,this._styleExpression=t,this.isLightConstant=i,this.isLineProgressConstant=r,this.isStateDependent="constant"!==e&&!Lr(t.expression),this.configDependencies=Fr(t.expression)}evaluateWithoutErrorHandling(e,t,i,r,n,o){return this._styleExpression.evaluateWithoutErrorHandling(e,t,i,r,n,o)}evaluate(e,t,i,r,n,o){return this._styleExpression.evaluate(e,t,i,r,n,o)}}class eo{constructor(e,t,i,r,n,o){this.kind=e,this.zoomStops=i,this._styleExpression=t,this.isStateDependent="camera"!==e&&!Lr(t.expression),this.isLightConstant=n,this.isLineProgressConstant=o,this.configDependencies=Fr(t.expression),this.interpolationType=r}evaluateWithoutErrorHandling(e,t,i,r,n,o){return this._styleExpression.evaluateWithoutErrorHandling(e,t,i,r,n,o)}evaluate(e,t,i,r,n,o){return this._styleExpression.evaluate(e,t,i,r,n,o)}interpolationFactor(e,t,i){return this.interpolationType?sn.interpolationFactor(this.interpolationType,e,t,i):0}}function to(e,t,i,r){if("error"===(e=Yn(e,t,i,r)).result)return e;const n=e.value.expression,o=Pr(n);if(!o&&!On(t))return Rn([new Ft("","data expressions not supported")]);const s=kr(n,["zoom","pitch","distance-from-center"]);if(!s&&!Nn(t))return Rn([new Ft("","zoom expressions not supported")]);const a=kr(n,["measure-light"]);if(!a&&!Un(t))return Rn([new Ft("","measure-light expression not supported")]);const l=kr(n,["line-progress"]);if(!l&&!function(e){return Dn(e.expression,"line-progress")}(t))return Rn([new Ft("","line-progress expression not supported")]);const c=t.expression&&t.expression.relaxZoomRestriction,u=ro(n);return u||s||c?u instanceof Ft?Rn([u]):u instanceof sn&&!Qn(t)?Rn([new Ft("",'"interpolate" expressions cannot be used with this property')]):zn(u?new eo(o&&l?"camera":"composite",e.value,u.labels,u instanceof sn?u.interpolation:void 0,a,l):new Jn(o&&l?"constant":"source",e.value,a,l)):Rn([new Ft("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class io{constructor(e,t){this._parameters=e,this._specification=t,Lt(this,Hn(this._parameters,this._specification))}static deserialize(e){return new io(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function ro(e){let t=null;if(e instanceof cn)t=ro(e.result);else if(e instanceof ln){for(const i of e.args)if(t=ro(i),t)break}else(e instanceof Nr||e instanceof sn)&&e.input instanceof gi&&"zoom"===e.input.name&&(t=e);return t instanceof Ft||e.eachChild((e=>{const i=ro(e);i instanceof Ft?t=i:t&&i&&t!==i&&(t=new Ft("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),t}var no,oo,so=function(){if(oo)return no;oo=1,no=t;var e=3;function t(t,i,r){var n=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var o=new Int32Array(this.arrayBuffer);t=o[0],this.d=(i=o[1])+2*(r=o[2]);for(var s=0;s<this.d*this.d;s++){var a=o[e+s],l=o[e+s+1];n.push(a===l?null:o.subarray(a,l))}var c=o[e+n.length+1];this.keys=o.subarray(o[e+n.length],c),this.bboxes=o.subarray(c),this.insert=this._insertReadonly}else{this.d=i+2*r;for(var u=0;u<this.d*this.d;u++)n.push([]);this.keys=[],this.bboxes=[]}this.n=i,this.extent=t,this.padding=r,this.scale=i/t,this.uid=0;var h=r/i*t;this.min=-h,this.max=t+h}return t.prototype.insert=function(e,t,i,r,n){this._forEachCell(t,i,r,n,this._insertCell,this.uid++),this.keys.push(e),this.bboxes.push(t),this.bboxes.push(i),this.bboxes.push(r),this.bboxes.push(n)},t.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},t.prototype._insertCell=function(e,t,i,r,n,o){this.cells[n].push(o)},t.prototype.query=function(e,t,i,r,n){var o=this.min,s=this.max;if(e<=o&&t<=o&&s<=i&&s<=r&&!n)return Array.prototype.slice.call(this.keys);var a=[];return this._forEachCell(e,t,i,r,this._queryCell,a,{},n),a},t.prototype._queryCell=function(e,t,i,r,n,o,s,a){var l=this.cells[n];if(null!==l)for(var c=this.keys,u=this.bboxes,h=0;h<l.length;h++){var d=l[h];if(void 0===s[d]){var p=4*d;(a?a(u[p+0],u[p+1],u[p+2],u[p+3]):e<=u[p+2]&&t<=u[p+3]&&i>=u[p+0]&&r>=u[p+1])?(s[d]=!0,o.push(c[d])):s[d]=!1}}},t.prototype._forEachCell=function(e,t,i,r,n,o,s,a){for(var l=this._convertToCellCoord(e),c=this._convertToCellCoord(t),u=this._convertToCellCoord(i),h=this._convertToCellCoord(r),d=l;d<=u;d++)for(var p=c;p<=h;p++){var f=this.d*p+d;if((!a||a(this._convertFromCellCoord(d),this._convertFromCellCoord(p),this._convertFromCellCoord(d+1),this._convertFromCellCoord(p+1)))&&n.call(this,e,t,i,r,f,o,s,a))return}},t.prototype._convertFromCellCoord=function(e){return(e-this.padding)/this.scale},t.prototype._convertToCellCoord=function(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))},t.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,i=e+this.cells.length+1+1,r=0,n=0;n<this.cells.length;n++)r+=this.cells[n].length;var o=new Int32Array(i+r+this.keys.length+this.bboxes.length);o[0]=this.extent,o[1]=this.n,o[2]=this.padding;for(var s=i,a=0;a<t.length;a++){var l=t[a];o[e+a]=s,o.set(l,s),s+=l.length}return o[e+t.length]=s,o.set(this.keys,s),o[e+t.length+1]=s+=this.keys.length,o.set(this.bboxes,s),s+=this.bboxes.length,o.buffer},no}(),ao=t(so);const lo={};function co(e,t,i={}){Object.defineProperty(e,"_classRegistryKey",{value:t,writable:!1}),lo[t]={klass:e,omit:i.omit||[]}}co(Object,"Object"),ao.serialize=function(e,t){const i=e.toArrayBuffer();return t&&t.add(i),{buffer:i}},ao.deserialize=function(e){return new ao(e.buffer)},Object.defineProperty(ao,"name",{value:"Grid"}),co(ao,"Grid"),"undefined"!=typeof DOMMatrix&&co(DOMMatrix,"DOMMatrix"),co(Ct,"Color"),co(Error,"Error"),co(Jt,"Formatted"),co(Yt,"FormattedSection"),co(et,"AJAXError"),co(ti,"ResolvedImage"),co(io,"StylePropertyFunction"),co(Wn,"StyleExpression",{omit:["_evaluator"]}),co(bt,"ImageId"),co(ei,"ImageVariant"),co(eo,"ZoomDependentExpression"),co(Jn,"ZoomConstantExpression"),co(gi,"CompoundExpression",{omit:["_evaluate"]});for(const e in Mn)lo[Mn[e]._classRegistryKey]||co(Mn[e],`Expression${e}`);function uo(e){return e&&"undefined"!=typeof ArrayBuffer&&(e instanceof ArrayBuffer||e.constructor&&"ArrayBuffer"===e.constructor.name)}function ho(e){return self.ImageBitmap&&e instanceof ImageBitmap}function po(e,t){if(null==e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp)return e;if(uo(e)||ho(e))return t&&t.add(e),e;if(ArrayBuffer.isView(e))return t&&t.add(e.buffer),e;if(e instanceof ImageData)return t&&t.add(e.data.buffer),e;if(Array.isArray(e)){const i=[];for(const r of e)i.push(po(r,t));return i}if(e instanceof Map){const t={$name:"Map",entries:[]};for(const[i,r]of e.entries())t.entries.push(po(i),po(r));return t}if(e instanceof Set){const t={$name:"Set"};let i=0;for(const r of e.values())t[++i]=po(r);return t}if(e instanceof DOMMatrix){const t={$name:"DOMMatrix"},i=["is2D","m11","m12","m13","m14","m21","m22","m23","m24","m31","m32","m33","m34","m41","m42","m43","m44","a","b","c","d","e","f"];for(const r of i)t[r]=e[r];return t}if("bigint"==typeof e)return{$name:"BigInt",value:e.toString()};if("object"==typeof e){const i=e.constructor,r=i._classRegistryKey;if(!r)throw new Error(`Can't serialize object of unregistered class "${i.name}".`);const n=i.serialize?i.serialize(e,t):{};if(!i.serialize){for(const i in e)e.hasOwnProperty(i)&&(lo[r].omit.indexOf(i)>=0||(n[i]=po(e[i],t)));e instanceof Error&&(n.message=e.message)}if(n.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==r&&(n.$name=r),n}throw new Error("can't serialize object of type "+typeof e)}function fo(e){if(null==e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp||uo(e)||ho(e)||ArrayBuffer.isView(e)||e instanceof ImageData)return e;if(Array.isArray(e))return e.map(fo);if("object"==typeof e){const t=e.$name||"Object";if("Map"===t){const t=e.entries||[],i=new Map;for(let e=0;e<t.length;e+=2)i.set(fo(t[e]),fo(t[e+1]));return i}if("Set"===t){const t=new Set;for(const i of Object.keys(e))"$name"!==i&&t.add(fo(e[i]));return t}if("DOMMatrix"===t){let t;return t=e.is2D?[e.a,e.b,e.c,e.d,e.e,e.f]:[e.m11,e.m12,e.m13,e.m14,e.m21,e.m22,e.m23,e.m24,e.m31,e.m32,e.m33,e.m34,e.m41,e.m42,e.m43,e.m44],new DOMMatrix(t)}if("BigInt"===t)return BigInt(e.value);const{klass:i}=lo[t];if(!i)throw new Error(`Can't deserialize unregistered class "${t}".`);if(i.deserialize)return i.deserialize(e);const r=Object.create(i.prototype);for(const t of Object.keys(e))"$name"!==t&&(r[t]=fo(e[t]));return r}throw new Error("can't deserialize object of type "+typeof e)}const Ao={"Latin-1 Supplement":e=>e>=128&&e<=255,Arabic:e=>e>=1536&&e<=1791,"Arabic Supplement":e=>e>=1872&&e<=1919,"Arabic Extended-A":e=>e>=2208&&e<=2303,"Hangul Jamo":e=>e>=4352&&e<=4607,"Unified Canadian Aboriginal Syllabics":e=>e>=5120&&e<=5759,Khmer:e=>e>=6016&&e<=6143,"Unified Canadian Aboriginal Syllabics Extended":e=>e>=6320&&e<=6399,"General Punctuation":e=>e>=8192&&e<=8303,"Letterlike Symbols":e=>e>=8448&&e<=8527,"Number Forms":e=>e>=8528&&e<=8591,"Miscellaneous Technical":e=>e>=8960&&e<=9215,"Control Pictures":e=>e>=9216&&e<=9279,"Optical Character Recognition":e=>e>=9280&&e<=9311,"Enclosed Alphanumerics":e=>e>=9312&&e<=9471,"Geometric Shapes":e=>e>=9632&&e<=9727,"Miscellaneous Symbols":e=>e>=9728&&e<=9983,"Miscellaneous Symbols and Arrows":e=>e>=11008&&e<=11263,"CJK Radicals Supplement":e=>e>=11904&&e<=12031,"Kangxi Radicals":e=>e>=12032&&e<=12255,"Ideographic Description Characters":e=>e>=12272&&e<=12287,"CJK Symbols and Punctuation":e=>e>=12288&&e<=12351,Hiragana:e=>e>=12352&&e<=12447,Katakana:e=>e>=12448&&e<=12543,Bopomofo:e=>e>=12544&&e<=12591,"Hangul Compatibility Jamo":e=>e>=12592&&e<=12687,Kanbun:e=>e>=12688&&e<=12703,"Bopomofo Extended":e=>e>=12704&&e<=12735,"CJK Strokes":e=>e>=12736&&e<=12783,"Katakana Phonetic Extensions":e=>e>=12784&&e<=12799,"Enclosed CJK Letters and Months":e=>e>=12800&&e<=13055,"CJK Compatibility":e=>e>=13056&&e<=13311,"CJK Unified Ideographs Extension A":e=>e>=13312&&e<=19903,"Yijing Hexagram Symbols":e=>e>=19904&&e<=19967,"CJK Unified Ideographs":e=>e>=19968&&e<=40959,"Yi Syllables":e=>e>=40960&&e<=42127,"Yi Radicals":e=>e>=42128&&e<=42191,"Hangul Jamo Extended-A":e=>e>=43360&&e<=43391,"Hangul Syllables":e=>e>=44032&&e<=55215,"Hangul Jamo Extended-B":e=>e>=55216&&e<=55295,"Private Use Area":e=>e>=57344&&e<=63743,"CJK Compatibility Ideographs":e=>e>=63744&&e<=64255,"Arabic Presentation Forms-A":e=>e>=64336&&e<=65023,"Vertical Forms":e=>e>=65040&&e<=65055,"CJK Compatibility Forms":e=>e>=65072&&e<=65103,"Small Form Variants":e=>e>=65104&&e<=65135,"Arabic Presentation Forms-B":e=>e>=65136&&e<=65279,"Halfwidth and Fullwidth Forms":e=>e>=65280&&e<=65519,Osage:e=>e>=66736&&e<=66815,"CJK Unified Ideographs Extension B":e=>e>=131072&&e<=173791};function mo(e){for(const t of e)if(yo(t.charCodeAt(0)))return!0;return!1}function go(e){for(const t of e)if(!_o(t.charCodeAt(0)))return!1;return!0}function _o(e){return!(Ao.Arabic(e)||Ao["Arabic Supplement"](e)||Ao["Arabic Extended-A"](e)||Ao["Arabic Presentation Forms-A"](e)||Ao["Arabic Presentation Forms-B"](e))}function yo(e){return!(746!==e&&747!==e&&(e<4352||!(Ao["Bopomofo Extended"](e)||Ao.Bopomofo(e)||Ao["CJK Compatibility Forms"](e)&&!(e>=65097&&e<=65103)||Ao["CJK Compatibility Ideographs"](e)||Ao["CJK Compatibility"](e)||Ao["CJK Radicals Supplement"](e)||Ao["CJK Strokes"](e)||!(!Ao["CJK Symbols and Punctuation"](e)||e>=12296&&e<=12305||e>=12308&&e<=12319||12336===e)||Ao["CJK Unified Ideographs Extension A"](e)||Ao["CJK Unified Ideographs"](e)||Ao["Enclosed CJK Letters and Months"](e)||Ao["Hangul Compatibility Jamo"](e)||Ao["Hangul Jamo Extended-A"](e)||Ao["Hangul Jamo Extended-B"](e)||Ao["Hangul Jamo"](e)||Ao["Hangul Syllables"](e)||Ao.Hiragana(e)||Ao["Ideographic Description Characters"](e)||Ao.Kanbun(e)||Ao["Kangxi Radicals"](e)||Ao["Katakana Phonetic Extensions"](e)||Ao.Katakana(e)&&12540!==e||!(!Ao["Halfwidth and Fullwidth Forms"](e)||65288===e||65289===e||65293===e||e>=65306&&e<=65310||65339===e||65341===e||65343===e||e>=65371&&e<=65503||65507===e||e>=65512&&e<=65519)||!(!Ao["Small Form Variants"](e)||e>=65112&&e<=65118||e>=65123&&e<=65126)||Ao["Unified Canadian Aboriginal Syllabics"](e)||Ao["Unified Canadian Aboriginal Syllabics Extended"](e)||Ao["Vertical Forms"](e)||Ao["Yijing Hexagram Symbols"](e)||Ao["Yi Syllables"](e)||Ao["Yi Radicals"](e))))}function vo(e){return!(yo(e)||function(e){return!!(Ao["Latin-1 Supplement"](e)&&(167===e||169===e||174===e||177===e||188===e||189===e||190===e||215===e||247===e)||Ao["General Punctuation"](e)&&(8214===e||8224===e||8225===e||8240===e||8241===e||8251===e||8252===e||8258===e||8263===e||8264===e||8265===e||8273===e)||Ao["Letterlike Symbols"](e)||Ao["Number Forms"](e)||Ao["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||9003===e||e>=9085&&e<=9114||e>=9150&&e<=9165||9167===e||e>=9169&&e<=9179||e>=9186&&e<=9215)||Ao["Control Pictures"](e)&&9251!==e||Ao["Optical Character Recognition"](e)||Ao["Enclosed Alphanumerics"](e)||Ao["Geometric Shapes"](e)||Ao["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||Ao["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Ao["CJK Symbols and Punctuation"](e)||Ao.Katakana(e)||Ao["Private Use Area"](e)||Ao["CJK Compatibility Forms"](e)||Ao["Small Form Variants"](e)||Ao["Halfwidth and Fullwidth Forms"](e)||8734===e||8756===e||8757===e||e>=9984&&e<=10087||e>=10102&&e<=10131||65532===e||65533===e)}(e))}function xo(e){return Ao.Arabic(e)||Ao["Arabic Supplement"](e)||Ao["Arabic Extended-A"](e)||Ao["Arabic Presentation Forms-A"](e)||Ao["Arabic Presentation Forms-B"](e)}function bo(e){return e>=1424&&e<=2303||Ao["Arabic Presentation Forms-A"](e)||Ao["Arabic Presentation Forms-B"](e)}function wo(e,t){return!(!t&&bo(e)||e>=2304&&e<=3583||e>=3840&&e<=4255||Ao.Khmer(e))}function To(e){for(const t of e)if(bo(t.charCodeAt(0)))return!0;return!1}const Bo="deferred",Co="loading",So="loaded";let Eo=null,Mo="unavailable",Io=null;const Po=function(e){e&&"string"==typeof e&&e.indexOf("NetworkError")>-1&&(Mo="error"),Eo&&Eo(e)};function Lo(){Fo.fire(new gt("pluginStateChange",{pluginStatus:Mo,pluginURL:Io}))}const Fo=new xt,ko=function(){return Mo},zo=function(){if(Mo!==Bo||!Io)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Mo=Co,Lo(),Io&&rt({url:Io},(e=>{e?Po(e):(Mo=So,Lo())}))},Ro={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Mo===So||null!=Ro.applyArabicShaping,isLoading:()=>Mo===Co,setState(e){Mo=e.pluginStatus,Io=e.pluginURL},isParsed:()=>null!=Ro.applyArabicShaping&&null!=Ro.processBidirectionalText&&null!=Ro.processStyledBidirectionalText,getPluginURL:()=>Io};class Do{constructor(e,t){this.zoom=e,t?(this.now=t.now,this.fadeDuration=t.fadeDuration,this.transition=t.transition,this.pitch=t.pitch,this.brightness=t.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return function(e,t){for(const i of e)if(!wo(i.charCodeAt(0),t))return!1;return!0}(e,Ro.isLoaded())}}class Oo{constructor(e,t,i,r){this.property=e,this.value=t,this.expression=function(e,t,i,r){if(jn(e))return new io(e,t);if(Xn(e)||Array.isArray(e)&&e.length>0){const n=to(e,t,i,r);if("error"===n.result)throw new Error(n.value.map((e=>`${e.key}: ${e.message}`)).join(", "));return n.value}{let i=e;return"string"==typeof e&&"color"===t.type&&(i=Ct.parse(e)),{kind:"constant",configDependencies:new Set,evaluate:()=>i}}}(void 0===t?e.specification.default:t,e.specification,i,r)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(e,t,i){return this.property.possiblyEvaluate(this,e,t,i)}}class Uo{constructor(e,t,i){this.property=e,this.value=new Oo(e,void 0,t,i)}transitioned(e,t){return new Qo(this.property,this.value,t,re({},e.transition,this.transition),e.now)}untransitioned(){return new Qo(this.property,this.value,null,{},0)}}class No{constructor(e,t,i){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=t,this._options=i,this.configDependencies=new Set}getValue(e){return ue(this._values[e].value.value)}setValue(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new Uo(this._values[e].property,this._scope,this._options)),this._values[e].value=new Oo(this._values[e].property,null===t?void 0:ue(t),this._scope,this._options),this._values[e].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].value.expression.configDependencies]))}setTransitionOrValue(e,t){t&&(this._options=t);const i=this._properties.properties;if(e)for(const t in e){const r=e[t];if(t.endsWith("-transition")){const e=t.slice(0,-11);i[e]&&this.setTransition(e,r)}else i.hasOwnProperty(t)&&this.setValue(t,r)}}getTransition(e){return ue(this._values[e].transition)}setTransition(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new Uo(this._values[e].property)),this._values[e].transition=ue(t)||void 0}serialize(){const e={};for(const t of Object.keys(this._values)){const i=this.getValue(t);void 0!==i&&(e[t]=i);const r=this.getTransition(t);void 0!==r&&(e[`${t}-transition`]=r)}return e}transitioned(e,t){const i=new jo(this._properties);for(const r of Object.keys(this._values))i._values[r]=this._values[r].transitioned(e,t._values[r]);return i}untransitioned(){const e=new jo(this._properties);for(const t of Object.keys(this._values))e._values[t]=this._values[t].untransitioned();return e}}class Qo{constructor(e,t,i,r,n){const o=r.delay||0,s=r.duration||0;n=n||0,this.property=e,this.value=t,this.begin=n+o,this.end=this.begin+s,e.specification.transition&&(r.delay||r.duration)&&(this.prior=i)}possiblyEvaluate(e,t,i){const r=e.now||0,n=this.value.possiblyEvaluate(e,t,i),o=this.prior;if(o){if(r>this.end)return this.prior=null,n;if(this.value.isDataDriven())return this.prior=null,n;if(r<this.begin)return o.possiblyEvaluate(e,t,i);{const s=(r-this.begin)/(this.end-this.begin);return this.property.interpolate(o.possiblyEvaluate(e,t,i),n,W(s))}}return n}}class jo{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,t,i){const r=new Go(this._properties);for(const n of Object.keys(this._values))r._values[n]=this._values[n].possiblyEvaluate(e,t,i);return r}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Vo{constructor(e,t,i){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=t,this._options=i,this.configDependencies=new Set}getValue(e){return ue(this._values[e].value)}setValue(e,t){this._values[e]=new Oo(this._values[e].property,null===t?void 0:ue(t),this._scope,this._options),this._values[e].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].expression.configDependencies]))}serialize(){const e={};for(const t of Object.keys(this._values)){const i=this.getValue(t);void 0!==i&&(e[t]=i)}return e}possiblyEvaluate(e,t,i){const r=new Go(this._properties);for(const n of Object.keys(this._values))r._values[n]=this._values[n].possiblyEvaluate(e,t,i);return r}}class Ho{constructor(e,t,i){this.property=e,this.value=t,this.parameters=i}isConstant(){return"constant"===this.value.kind}constantOr(e){return"constant"===this.value.kind?this.value.value:e}evaluate(e,t,i,r){return this.property.evaluate(this.value,this.parameters,e,t,i,r)}}class Go{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class $o{constructor(e){this.specification=e}possiblyEvaluate(e,t){return e.expression.evaluate(t)}interpolate(e,t,i){const r=Pt[this.specification.type];return r?r(e,t,i):e}}class Zo{constructor(e,t){this.specification=e,this.overrides=t}possiblyEvaluate(e,t,i,r){return new Ho(this,"constant"===e.expression.kind||"camera"===e.expression.kind?{kind:"constant",value:e.expression.evaluate(t,null,{},i,r)}:e.expression,t)}interpolate(e,t,i){if("constant"!==e.value.kind||"constant"!==t.value.kind)return e;if(void 0===e.value.value||void 0===t.value.value)return new Ho(this,{kind:"constant",value:void 0},e.parameters);const r=Pt[this.specification.type];return r?new Ho(this,{kind:"constant",value:r(e.value.value,t.value.value,i)},e.parameters):e}evaluate(e,t,i,r,n,o){return"constant"===e.kind?e.value:e.evaluate(t,i,r,n,o)}}class qo{constructor(e){this.specification=e}possiblyEvaluate(e,t,i,r){return!!e.expression.evaluate(t,null,{},i,r)}interpolate(){return!1}}class Ko{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const t=new Do(0,{});for(const i in e){const r=e[i];r.specification.overridable&&this.overridableProperties.push(i);const n=this.defaultPropertyValues[i]=new Oo(r,void 0),o=this.defaultTransitionablePropertyValues[i]=new Uo(r);this.defaultTransitioningPropertyValues[i]=o.untransitioned(),this.defaultPossiblyEvaluatedValues[i]=n.possiblyEvaluate(t)}}}co(Zo,"DataDrivenProperty"),co($o,"DataConstantProperty"),co(qo,"ColorRampProperty");var Wo=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow","experimental":true},"rain":{"type":"rain","experimental":true},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor","experimental":true},"imports":{"type":"array","value":"import"},"iconsets":{"experimental":true,"type":"iconsets"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"experimental":true,"type":"featuresets"}},"featuresets":{"experimental":true,"*":{"type":"featureset"}},"featureset":{"experimental":true,"metadata":{"experimental":true,"type":"*"},"selectors":{"experimental":true,"type":"array","value":"selector"}},"selector":{"experimental":true,"layer":{"experimental":true,"type":"string","required":true},"properties":{"experimental":true,"type":"selectorProperty","required":false},"featureNamespace":{"experimental":true,"type":"string","required":false},"_uniqueFeatureID":{"experimental":true,"type":"boolean","private":true,"required":false}},"selectorProperty":{"experimental":true,"*":{"experimental":true,"type":"*"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","property-type":"data-constant","expression":{},"required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"property-type":"data-constant"},"shadow-quality":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]},"experimental":true},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"iconsets":{"*":{"type":"iconset"}},"iconset":["iconset_sprite","iconset_source"],"iconset_sprite":{"type":{"required":true,"type":"enum","values":{"sprite":1}},"url":{"required":true,"type":"string"}},"iconset_source":{"type":{"required":true,"type":"enum","values":{"source":1}},"source":{"required":true,"type":"string"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"experimental":true,"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"raster-particle":{"experimental":true},"hillshade":{},"model":{"experimental":true},"background":{},"sky":{},"slot":{},"clip":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{},"property-type":"data-constant"},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{},"property-type":"data-constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","experimental":true,"private":true,"expression":{},"property-type":"data-constant"},"fill-construct-bridge-guard-rail":{"type":"boolean","default":"true","experimental":true,"private":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","experimental":true,"expression":{},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","experimental":true,"default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","experimental":true,"expression":{},"property-type":"data-constant"},"line-cross-slope":{"type":"number","experimental":true,"expression":{},"property-type":"constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","experimental":true,"private":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","experimental":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"experimental":true,"private":true,"expression":{},"property-type":"data-constant"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"experimental":true,"private":true,"expression":{},"property-type":"data-constant"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"opacity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","property-type":"data-constant","default":"#ffffff","experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"center-thinning":{"type":"number","property-type":"data-constant","default":0.4,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","property-type":"data-constant","transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","property-type":"data-constant","default":0.71,"minimum":0,"maximum":5,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"opacity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"center-thinning":{"type":"number","property-type":"data-constant","default":0.57,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","property-type":"data-constant","transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","property-type":"data-constant","transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","property-type":"data-constant","default":0.7,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"colorTheme":{"data":{"type":"string","property-type":"data-constant","expression":{}}},"indoor":{"floorplanFeaturesetId":{"type":"string","experimental":true,"property-type":"data-constant","expression":{}},"buildingFeaturesetId":{"type":"string","experimental":true,"property-type":"data-constant","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-bridge-guard-rail-color":{"type":"color","default":"rgba(241, 236, 225, 255)","experimental":true,"private":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"},"fill-tunnel-structure-color":{"type":"color","default":"rgba(241, 236, 225, 255)","transition":true,"experimental":true,"private":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","experimental":true,"values":{"terrain":1,"flat":1},"default":"flat","property-type":"data-constant"},"fill-extrusion-base-alignment":{"type":"enum","experimental":true,"values":{"terrain":1,"flat":1},"default":"terrain","property-type":"data-constant"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","experimental":true,"default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","experimental":true,"default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"experimental":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true,"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-trim-fade-range":{"type":"array","value":"number","experimental":true,"length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-trim-color":{"type":"color","experimental":true,"default":"transparent","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"property-type":"data-constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"experimental":true,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-particle-count":{"type":"number","default":512,"minimum":1,"property-type":"data-constant"},"raster-particle-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-particle-speed"]},"property-type":"color-ramp"},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1,"property-type":"data-constant"},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1,"property-type":"data-constant"},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]},"experimental":true,"property-type":"data-constant"},"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"model-front-cutoff":{"type":"array","private":true,"value":"number","property-type":"data-constant","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"*"}}}');function Xo(e){return e instanceof Number||e instanceof String||e instanceof Boolean?e.valueOf():e}function Yo(e){if(Array.isArray(e))return e.map(Yo);if(e instanceof Object&&!(e instanceof Number||e instanceof String||e instanceof Boolean)){const t={};for(const i in e)t[i]=Yo(e[i]);return t}return Xo(e)}function Jo(e){if(!0===e||!1===e)return!0;if(!Array.isArray(e)||0===e.length)return!1;switch(e[0]){case"has":return e.length>=2&&"$id"!==e[1]&&"$type"!==e[1];case"in":return e.length>=3&&("string"!=typeof e[1]||Array.isArray(e[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==e.length||Array.isArray(e[1])||Array.isArray(e[2]);case"any":case"all":for(const t of e.slice(1))if(!Jo(t)&&"boolean"!=typeof t)return!1;return!0;default:return!0}}function es(e,t="",i=null,r="fill"){if(null==e)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Jo(e)||(e=as(e));const n=e;let o=!0;try{o=function(e){if(!rs(e))return e;let t=Yo(e);return is(t),t=ts(t),t}(n)}catch(e){console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(n,null,2)}\n        `)}let s=null,a=null;if("background"!==r&&"sky"!==r&&"slot"!==r){a=Wo[`filter_${r}`];const e=Yn(o,a,t,i);if("error"===e.result)throw new Error(e.value.map((e=>`${e.key}: ${e.message}`)).join(", "));s=(t,i,r)=>e.value.evaluate(t,i,{},r)}let l=null,c=null;if(o!==n){const e=Yn(n,a,t,i);if("error"===e.result)throw new Error(e.value.map((e=>`${e.key}: ${e.message}`)).join(", "));l=(t,i,r,n,o)=>e.value.evaluate(t,i,{},r,void 0,void 0,n,o),c=!Pr(e.value.expression)}return{filter:s,dynamicFilter:l||void 0,needGeometry:ss(o),needFeature:!!c}}function ts(e){if(!Array.isArray(e))return e;const t=function(e){if(ns.has(e[0]))for(let t=1;t<e.length;t++)if(rs(e[t]))return!0;return e}(e);return!0===t?t:t.map((e=>ts(e)))}function is(e){let t=!1;const i=[];if("case"===e[0]){for(let r=1;r<e.length-1;r+=2)t=t||rs(e[r]),i.push(e[r+1]);i.push(e[e.length-1])}else if("match"===e[0]){t=t||rs(e[1]);for(let t=2;t<e.length-1;t+=2)i.push(e[t+1]);i.push(e[e.length-1])}else if("step"===e[0]){t=t||rs(e[1]);for(let t=1;t<e.length-1;t+=2)i.push(e[t+1])}t&&(e.length=0,e.push("any",...i));for(let t=1;t<e.length;t++)is(e[t])}function rs(e){if(!Array.isArray(e))return!1;if("pitch"===(t=e[0])||"distance-from-center"===t)return!0;var t;for(let t=1;t<e.length;t++)if(rs(e[t]))return!0;return!1}const ns=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function os(e,t){return e<t?-1:e>t?1:0}function ss(e){if(!Array.isArray(e))return!1;if("within"===e[0]||"distance"===e[0])return!0;for(let t=1;t<e.length;t++)if(ss(e[t]))return!0;return!1}function as(e){if(!e)return!0;const t=e[0];return e.length<=1?"any"!==t:"=="===t?ls(e[1],e[2],"=="):"!="===t?hs(ls(e[1],e[2],"==")):"<"===t||">"===t||"<="===t||">="===t?ls(e[1],e[2],t):"any"===t?(i=e.slice(1),["any"].concat(i.map(as))):"all"===t?["all"].concat(e.slice(1).map(as)):"none"===t?["all"].concat(e.slice(1).map(as).map(hs)):"in"===t?cs(e[1],e.slice(2)):"!in"===t?hs(cs(e[1],e.slice(2))):"has"===t?us(e[1]):"!has"!==t||hs(us(e[1]));var i}function ls(e,t,i){switch(e){case"$type":return[`filter-type-${i}`,t];case"$id":return[`filter-id-${i}`,t];default:return[`filter-${i}`,e,t]}}function cs(e,t){if(0===t.length)return!1;switch(e){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some((e=>typeof e!=typeof t[0]))?["filter-in-large",e,["literal",t.sort(os)]]:["filter-in-small",e,["literal",t]]}}function us(e){switch(e){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",e]}}function hs(e){return["!",e]}const ds="";function ps(e,t){return t?`${e}${ds}${t}`:e}const fs="-transition",As=new Set(["fill","line","background","hillshade","raster"]);class ms extends xt{constructor(e,t,i,r,n){if(super(),this.id=e.id,this.fqid=ps(this.id,i),this.type=e.type,this.scope=i,this.lut=r,this.options=n,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.configDependencies=new Set,"custom"!==e.type){if(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type&&"background"!==e.type&&"sky"!==e.type&&"slot"!==e.type){this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter;const t=Yn(this.filter,Wo[`filter_${e.type}`]);"error"!==t.result&&(this.configDependencies=new Set([...this.configDependencies,...t.value.configDependencies]))}if(e.slot&&(this.slot=e.slot),t.layout&&(this._unevaluatedLayout=new Vo(t.layout,this.scope,n),this.configDependencies=new Set([...this.configDependencies,...this._unevaluatedLayout.configDependencies])),t.paint){this._transitionablePaint=new No(t.paint,this.scope,n);for(const t in e.paint)this.setPaintProperty(t,e.paint[t]);for(const t in e.layout)this.setLayoutProperty(t,e.layout[t]);this.configDependencies=new Set([...this.configDependencies,...this._transitionablePaint.configDependencies]),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Go(t.paint)}}}onAdd(e){}onRemove(e){}isDraped(e){return!this.is3D(!0)&&As.has(this.type)}getLayoutProperty(e){return"visibility"===e?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,t){if("custom"===this.type&&"visibility"===e)return void(this.visibility=t);const i=this._unevaluatedLayout;i._properties.properties[e]&&(i.setValue(e,t),this.configDependencies=new Set([...this.configDependencies,...i.configDependencies]),"visibility"===e&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(e){return e.endsWith(fs)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,t){const i=this._transitionablePaint,r=i._properties.properties;if(e.endsWith(fs)){const n=e.slice(0,-11);return r[n]&&i.setTransition(n,t||void 0),!1}if(!r[e])return!1;const n=i._values[e],o=n.value.isDataDriven(),s=n.value;i.setValue(e,t),this.configDependencies=new Set([...this.configDependencies,...i.configDependencies]),this._handleSpecialPaintPropertyUpdate(e);const a=i._values[e].value,l=a.isDataDriven(),c=e.endsWith("pattern")||"line-dasharray"===e;return l||o||c||this._handleOverridablePaintPropertyUpdate(e,s,a)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,t,i){return null}_handleOverridablePaintPropertyUpdate(e,t,i){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||"none"===this.visibility}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,t){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,t)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,t)}serialize(){return ce({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},((e,t)=>!(void 0===e||"layout"===t&&!Object.keys(e).length||"paint"===t&&!Object.keys(e).length)))}is3D(e){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(const e in this.paint._values){const t=this.paint.get(e);if(t instanceof Ho&&On(t.property.specification)&&("source"===t.value.kind||"composite"===t.value.kind)&&t.value.isStateDependent)return!0}return!1}compileFilter(e){this._filterCompiled||(this._featureFilter=es(this.filter,this.scope,e),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(e){this._stats&&("shadow"===e.renderPass?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(e){}queryIntersectsFeature(e,t,i,r,n,o,s,a,l){}}const gs={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class _s{constructor(e,t){this._structArray=e,this._pos1=t*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class ys{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,t){return e._trim(),t&&(e.isTransferred=!0,t.add(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const t=Object.create(this.prototype);return t.arrayBuffer=e.arrayBuffer,t.length=e.length,t.capacity=e.arrayBuffer.byteLength/t.bytesPerElement,t._refreshViews(),t}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const t=this.uint8;this._refreshViews(),t&&this.uint8.set(t)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...e){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...e){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function vs(e,t=1){let i=0,r=0;return{members:e.map((e=>{const n=gs[e.type].BYTES_PER_ELEMENT,o=i=xs(i,Math.max(t,n)),s=e.components||1;return r=Math.max(r,n),i+=n*s,{name:e.name,type:e.type,components:s,offset:o}})),size:xs(i,Math.max(r,t)),alignment:t}}function xs(e,t){return Math.ceil(e/t)*t}class bs extends ys{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t){const i=this.length;return this.resize(i+1),this.emplace(i,e,t)}emplace(e,t,i){const r=2*e;return this.int16[r+0]=t,this.int16[r+1]=i,e}}bs.prototype.bytesPerElement=4,co(bs,"StructArrayLayout2i4");class ws extends ys{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,i){const r=this.length;return this.resize(r+1),this.emplace(r,e,t,i)}emplace(e,t,i,r){const n=3*e;return this.int16[n+0]=t,this.int16[n+1]=i,this.int16[n+2]=r,e}}ws.prototype.bytesPerElement=6,co(ws,"StructArrayLayout3i6");class Ts extends ys{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,i,r){const n=this.length;return this.resize(n+1),this.emplace(n,e,t,i,r)}emplace(e,t,i,r,n){const o=4*e;return this.int16[o+0]=t,this.int16[o+1]=i,this.int16[o+2]=r,this.int16[o+3]=n,e}}Ts.prototype.bytesPerElement=8,co(Ts,"StructArrayLayout4i8");class Bs extends ys{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.float32[1*e+0]=t,e}}Bs.prototype.bytesPerElement=4,co(Bs,"StructArrayLayout1f4");class Cs extends ys{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,i){const r=this.length;return this.resize(r+1),this.emplace(r,e,t,i)}emplace(e,t,i,r){const n=4*e,o=2*e;return this.int16[n+0]=t,this.int16[n+1]=i,this.float32[o+1]=r,e}}Cs.prototype.bytesPerElement=8,co(Cs,"StructArrayLayout2i1f8");class Ss extends ys{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,i){const r=this.length;return this.resize(r+1),this.emplace(r,e,t,i)}emplace(e,t,i,r){const n=4*e;return this.int16[n+0]=t,this.int16[n+1]=i,this.int16[n+2]=r,e}}Ss.prototype.bytesPerElement=8,co(Ss,"StructArrayLayout3i8");class Es extends ys{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,i,r,n){const o=this.length;return this.resize(o+1),this.emplace(o,e,t,i,r,n)}emplace(e,t,i,r,n,o){const s=5*e;return this.int16[s+0]=t,this.int16[s+1]=i,this.int16[s+2]=r,this.int16[s+3]=n,this.int16[s+4]=o,e}}Es.prototype.bytesPerElement=10,co(Es,"StructArrayLayout5i10");class Ms extends ys{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,i,r,n,o,s){const a=this.length;return this.resize(a+1),this.emplace(a,e,t,i,r,n,o,s)}emplace(e,t,i,r,n,o,s,a){const l=6*e,c=12*e,u=3*e;return this.int16[l+0]=t,this.int16[l+1]=i,this.uint8[c+4]=r,this.uint8[c+5]=n,this.uint8[c+6]=o,this.uint8[c+7]=s,this.float32[u+2]=a,e}}Ms.prototype.bytesPerElement=12,co(Ms,"StructArrayLayout2i4ub1f12");class Is extends ys{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,i){const r=this.length;return this.resize(r+1),this.emplace(r,e,t,i)}emplace(e,t,i,r){const n=3*e;return this.float32[n+0]=t,this.float32[n+1]=i,this.float32[n+2]=r,e}}Is.prototype.bytesPerElement=12,co(Is,"StructArrayLayout3f12");class Ps extends ys{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,i,r,n){const o=this.length;return this.resize(o+1),this.emplace(o,e,t,i,r,n)}emplace(e,t,i,r,n,o){const s=6*e,a=3*e;return this.uint16[s+0]=t,this.uint16[s+1]=i,this.uint16[s+2]=r,this.uint16[s+3]=n,this.float32[a+2]=o,e}}Ps.prototype.bytesPerElement=12,co(Ps,"StructArrayLayout4ui1f12");class Ls extends ys{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,i,r){const n=this.length;return this.resize(n+1),this.emplace(n,e,t,i,r)}emplace(e,t,i,r,n){const o=4*e;return this.uint16[o+0]=t,this.uint16[o+1]=i,this.uint16[o+2]=r,this.uint16[o+3]=n,e}}Ls.prototype.bytesPerElement=8,co(Ls,"StructArrayLayout4ui8");class Fs extends ys{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,i,r,n,o){const s=this.length;return this.resize(s+1),this.emplace(s,e,t,i,r,n,o)}emplace(e,t,i,r,n,o,s){const a=6*e;return this.int16[a+0]=t,this.int16[a+1]=i,this.int16[a+2]=r,this.int16[a+3]=n,this.int16[a+4]=o,this.int16[a+5]=s,e}}Fs.prototype.bytesPerElement=12,co(Fs,"StructArrayLayout6i12");class ks extends ys{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,i,r,n,o,s,a,l,c,u,h){const d=this.length;return this.resize(d+1),this.emplace(d,e,t,i,r,n,o,s,a,l,c,u,h)}emplace(e,t,i,r,n,o,s,a,l,c,u,h,d){const p=12*e;return this.int16[p+0]=t,this.int16[p+1]=i,this.int16[p+2]=r,this.int16[p+3]=n,this.uint16[p+4]=o,this.uint16[p+5]=s,this.uint16[p+6]=a,this.uint16[p+7]=l,this.int16[p+8]=c,this.int16[p+9]=u,this.int16[p+10]=h,this.int16[p+11]=d,e}}ks.prototype.bytesPerElement=24,co(ks,"StructArrayLayout4i4ui4i24");class zs extends ys{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,i,r,n,o){const s=this.length;return this.resize(s+1),this.emplace(s,e,t,i,r,n,o)}emplace(e,t,i,r,n,o,s){const a=10*e,l=5*e;return this.int16[a+0]=t,this.int16[a+1]=i,this.int16[a+2]=r,this.float32[l+2]=n,this.float32[l+3]=o,this.float32[l+4]=s,e}}zs.prototype.bytesPerElement=20,co(zs,"StructArrayLayout3i3f20");class Rs extends ys{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,i,r){const n=this.length;return this.resize(n+1),this.emplace(n,e,t,i,r)}emplace(e,t,i,r,n){const o=4*e;return this.float32[o+0]=t,this.float32[o+1]=i,this.float32[o+2]=r,this.float32[o+3]=n,e}}Rs.prototype.bytesPerElement=16,co(Rs,"StructArrayLayout4f16");class Ds extends ys{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.uint32[1*e+0]=t,e}}Ds.prototype.bytesPerElement=4,co(Ds,"StructArrayLayout1ul4");class Os extends ys{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t){const i=this.length;return this.resize(i+1),this.emplace(i,e,t)}emplace(e,t,i){const r=2*e;return this.uint16[r+0]=t,this.uint16[r+1]=i,e}}Os.prototype.bytesPerElement=4,co(Os,"StructArrayLayout2ui4");class Us extends ys{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,i,r,n,o,s,a,l,c,u,h,d){const p=this.length;return this.resize(p+1),this.emplace(p,e,t,i,r,n,o,s,a,l,c,u,h,d)}emplace(e,t,i,r,n,o,s,a,l,c,u,h,d,p){const f=20*e,A=10*e;return this.int16[f+0]=t,this.int16[f+1]=i,this.int16[f+2]=r,this.int16[f+3]=n,this.int16[f+4]=o,this.float32[A+3]=s,this.float32[A+4]=a,this.float32[A+5]=l,this.float32[A+6]=c,this.int16[f+14]=u,this.uint32[A+8]=h,this.uint16[f+18]=d,this.uint16[f+19]=p,e}}Us.prototype.bytesPerElement=40,co(Us,"StructArrayLayout5i4f1i1ul2ui40");class Ns extends ys{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,i,r,n,o,s){const a=this.length;return this.resize(a+1),this.emplace(a,e,t,i,r,n,o,s)}emplace(e,t,i,r,n,o,s,a){const l=8*e;return this.int16[l+0]=t,this.int16[l+1]=i,this.int16[l+2]=r,this.int16[l+4]=n,this.int16[l+5]=o,this.int16[l+6]=s,this.int16[l+7]=a,e}}Ns.prototype.bytesPerElement=16,co(Ns,"StructArrayLayout3i2i2i16");class Qs extends ys{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,i,r,n){const o=this.length;return this.resize(o+1),this.emplace(o,e,t,i,r,n)}emplace(e,t,i,r,n,o){const s=4*e,a=8*e;return this.float32[s+0]=t,this.float32[s+1]=i,this.float32[s+2]=r,this.int16[a+6]=n,this.int16[a+7]=o,e}}Qs.prototype.bytesPerElement=16,co(Qs,"StructArrayLayout2f1f2i16");class js extends ys{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,i,r,n,o){const s=this.length;return this.resize(s+1),this.emplace(s,e,t,i,r,n,o)}emplace(e,t,i,r,n,o,s){const a=20*e,l=5*e;return this.uint8[a+0]=t,this.uint8[a+1]=i,this.float32[l+1]=r,this.float32[l+2]=n,this.float32[l+3]=o,this.float32[l+4]=s,e}}js.prototype.bytesPerElement=20,co(js,"StructArrayLayout2ub4f20");class Vs extends ys{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,i){const r=this.length;return this.resize(r+1),this.emplace(r,e,t,i)}emplace(e,t,i,r){const n=3*e;return this.uint16[n+0]=t,this.uint16[n+1]=i,this.uint16[n+2]=r,e}}Vs.prototype.bytesPerElement=6,co(Vs,"StructArrayLayout3ui6");class Hs extends ys{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,t,i,r,n,o,s,a,l,c,u,h,d,p,f,A,m,g,_,y,v){const x=this.length;return this.resize(x+1),this.emplace(x,e,t,i,r,n,o,s,a,l,c,u,h,d,p,f,A,m,g,_,y,v)}emplace(e,t,i,r,n,o,s,a,l,c,u,h,d,p,f,A,m,g,_,y,v,x){const b=30*e,w=15*e,T=60*e;return this.int16[b+0]=t,this.int16[b+1]=i,this.int16[b+2]=r,this.float32[w+2]=n,this.float32[w+3]=o,this.uint16[b+8]=s,this.uint16[b+9]=a,this.uint32[w+5]=l,this.uint32[w+6]=c,this.uint32[w+7]=u,this.uint16[b+16]=h,this.uint16[b+17]=d,this.uint16[b+18]=p,this.float32[w+10]=f,this.float32[w+11]=A,this.uint8[T+48]=m,this.uint8[T+49]=g,this.uint8[T+50]=_,this.uint32[w+13]=y,this.int16[b+28]=v,this.uint8[T+58]=x,e}}Hs.prototype.bytesPerElement=60,co(Hs,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Gs extends ys{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,t,i,r,n,o,s,a,l,c,u,h,d,p,f,A,m,g,_,y,v,x,b,w,T,B,C,S,E,M,I,P,L){const F=this.length;return this.resize(F+1),this.emplace(F,e,t,i,r,n,o,s,a,l,c,u,h,d,p,f,A,m,g,_,y,v,x,b,w,T,B,C,S,E,M,I,P,L)}emplace(e,t,i,r,n,o,s,a,l,c,u,h,d,p,f,A,m,g,_,y,v,x,b,w,T,B,C,S,E,M,I,P,L,F){const k=20*e,z=40*e,R=80*e;return this.float32[k+0]=t,this.float32[k+1]=i,this.int16[z+4]=r,this.int16[z+5]=n,this.int16[z+6]=o,this.int16[z+7]=s,this.int16[z+8]=a,this.int16[z+9]=l,this.int16[z+10]=c,this.int16[z+11]=u,this.int16[z+12]=h,this.uint16[z+13]=d,this.uint16[z+14]=p,this.uint16[z+15]=f,this.uint16[z+16]=A,this.uint16[z+17]=m,this.uint16[z+18]=g,this.uint16[z+19]=_,this.uint16[z+20]=y,this.uint16[z+21]=v,this.uint16[z+22]=x,this.uint16[z+23]=b,this.uint16[z+24]=w,this.uint16[z+25]=T,this.uint16[z+26]=B,this.uint16[z+27]=C,this.uint32[k+14]=S,this.float32[k+15]=E,this.float32[k+16]=M,this.float32[k+17]=I,this.float32[k+18]=P,this.uint8[R+76]=L,this.uint16[z+39]=F,e}}Gs.prototype.bytesPerElement=80,co(Gs,"StructArrayLayout2f9i15ui1ul4f1ub1ui80");class $s extends ys{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,i,r,n){const o=this.length;return this.resize(o+1),this.emplace(o,e,t,i,r,n)}emplace(e,t,i,r,n,o){const s=5*e;return this.float32[s+0]=t,this.float32[s+1]=i,this.float32[s+2]=r,this.float32[s+3]=n,this.float32[s+4]=o,e}}$s.prototype.bytesPerElement=20,co($s,"StructArrayLayout5f20");class Zs extends ys{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,i,r,n,o,s){const a=this.length;return this.resize(a+1),this.emplace(a,e,t,i,r,n,o,s)}emplace(e,t,i,r,n,o,s,a){const l=7*e;return this.float32[l+0]=t,this.float32[l+1]=i,this.float32[l+2]=r,this.float32[l+3]=n,this.float32[l+4]=o,this.float32[l+5]=s,this.float32[l+6]=a,e}}Zs.prototype.bytesPerElement=28,co(Zs,"StructArrayLayout7f28");class qs extends ys{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,i,r,n,o,s,a,l,c,u){const h=this.length;return this.resize(h+1),this.emplace(h,e,t,i,r,n,o,s,a,l,c,u)}emplace(e,t,i,r,n,o,s,a,l,c,u,h){const d=11*e;return this.float32[d+0]=t,this.float32[d+1]=i,this.float32[d+2]=r,this.float32[d+3]=n,this.float32[d+4]=o,this.float32[d+5]=s,this.float32[d+6]=a,this.float32[d+7]=l,this.float32[d+8]=c,this.float32[d+9]=u,this.float32[d+10]=h,e}}qs.prototype.bytesPerElement=44,co(qs,"StructArrayLayout11f44");class Ks extends ys{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,i,r,n,o,s,a,l){const c=this.length;return this.resize(c+1),this.emplace(c,e,t,i,r,n,o,s,a,l)}emplace(e,t,i,r,n,o,s,a,l,c){const u=9*e;return this.float32[u+0]=t,this.float32[u+1]=i,this.float32[u+2]=r,this.float32[u+3]=n,this.float32[u+4]=o,this.float32[u+5]=s,this.float32[u+6]=a,this.float32[u+7]=l,this.float32[u+8]=c,e}}Ks.prototype.bytesPerElement=36,co(Ks,"StructArrayLayout9f36");class Ws extends ys{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t){const i=this.length;return this.resize(i+1),this.emplace(i,e,t)}emplace(e,t,i){const r=2*e;return this.float32[r+0]=t,this.float32[r+1]=i,e}}Ws.prototype.bytesPerElement=8,co(Ws,"StructArrayLayout2f8");class Xs extends ys{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,i,r){const n=this.length;return this.resize(n+1),this.emplace(n,e,t,i,r)}emplace(e,t,i,r,n){const o=6*e;return this.uint32[3*e+0]=t,this.uint16[o+2]=i,this.uint16[o+3]=r,this.uint16[o+4]=n,e}}Xs.prototype.bytesPerElement=12,co(Xs,"StructArrayLayout1ul3ui12");class Ys extends ys{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.uint16[1*e+0]=t,e}}Ys.prototype.bytesPerElement=2,co(Ys,"StructArrayLayout1ui2");class Js extends ys{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,i,r,n,o,s,a,l,c,u,h,d,p,f,A){const m=this.length;return this.resize(m+1),this.emplace(m,e,t,i,r,n,o,s,a,l,c,u,h,d,p,f,A)}emplace(e,t,i,r,n,o,s,a,l,c,u,h,d,p,f,A,m){const g=16*e;return this.float32[g+0]=t,this.float32[g+1]=i,this.float32[g+2]=r,this.float32[g+3]=n,this.float32[g+4]=o,this.float32[g+5]=s,this.float32[g+6]=a,this.float32[g+7]=l,this.float32[g+8]=c,this.float32[g+9]=u,this.float32[g+10]=h,this.float32[g+11]=d,this.float32[g+12]=p,this.float32[g+13]=f,this.float32[g+14]=A,this.float32[g+15]=m,e}}Js.prototype.bytesPerElement=64,co(Js,"StructArrayLayout16f64");class ea extends ys{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,i,r,n,o,s){const a=this.length;return this.resize(a+1),this.emplace(a,e,t,i,r,n,o,s)}emplace(e,t,i,r,n,o,s,a){const l=10*e,c=5*e;return this.uint16[l+0]=t,this.uint16[l+1]=i,this.uint16[l+2]=r,this.uint16[l+3]=n,this.float32[c+2]=o,this.float32[c+3]=s,this.float32[c+4]=a,e}}ea.prototype.bytesPerElement=20,co(ea,"StructArrayLayout4ui3f20");class ta extends ys{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.int16[1*e+0]=t,e}}ta.prototype.bytesPerElement=2,co(ta,"StructArrayLayout1i2");class ia extends ys{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.uint8[1*e+0]=t,e}}ia.prototype.bytesPerElement=1,co(ia,"StructArrayLayout1ub1");class ra extends _s{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}ra.prototype.size=40;class na extends Us{get(e){return new ra(this,e)}}co(na,"CollisionBoxArray");class oa extends _s{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}oa.prototype.size=60;class sa extends Hs{get(e){return new oa(this,e)}}co(sa,"PlacedSymbolArray");class aa extends _s{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}get elevationFeatureIndex(){return this._structArray.uint16[this._pos2+39]}}aa.prototype.size=80;class la extends Gs{get(e){return new aa(this,e)}}co(la,"SymbolInstanceArray");class ca extends Bs{getoffsetX(e){return this.float32[1*e+0]}}co(ca,"GlyphOffsetArray");class ua extends bs{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}co(ua,"SymbolLineVertexArray");class ha extends _s{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}ha.prototype.size=12;class da extends Xs{get(e){return new ha(this,e)}}co(da,"FeatureIndexArray");class pa extends Os{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}co(pa,"FillExtrusionCentroidArray");class fa extends _s{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}fa.prototype.size=6;class Aa extends ws{get(e){return new fa(this,e)}}co(Aa,"FillExtrusionWallArray");const ma=vs([{name:"a_pos",components:2,type:"Int16"}],4),ga=vs([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class _a{constructor(e=[]){this.segments=e}_prepareSegment(e,t,i,r){let n=this.segments[this.segments.length-1];return e>_a.MAX_VERTEX_ARRAY_LENGTH&&de(`Max vertices per segment is ${_a.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!n||n.vertexLength+e>_a.MAX_VERTEX_ARRAY_LENGTH||n.sortKey!==r)&&(n={vertexOffset:t,primitiveOffset:i,vertexLength:0,primitiveLength:0},void 0!==r&&(n.sortKey=r),this.segments.push(n)),n}prepareSegment(e,t,i,r){return this._prepareSegment(e,t.length,i.length,r)}get(){return this.segments}destroy(){for(const e of this.segments)for(const t in e.vaos)e.vaos[t].destroy()}static simpleSegment(e,t,i,r){return new _a([{vertexOffset:e,primitiveOffset:t,vertexLength:i,primitiveLength:r,vaos:{},sortKey:0}])}}function ya(e,t){return 256*(e=J(Math.floor(e),0,255))+J(Math.floor(t),0,255)}_a.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,co(_a,"SegmentVector");const va=vs([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),xa=vs([{name:"a_dash",components:4,type:"Uint16"}]);class ba{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,t,i,r){this.ids.push(wa(e)),this.positions.push(t,i,r)}eachPosition(e,t){const i=wa(e);let r=0,n=this.ids.length-1;for(;r<n;){const e=r+n>>1;this.ids[e]>=i?n=e:r=e+1}for(;this.ids[r]===i;)t(this.positions[3*r],this.positions[3*r+1],this.positions[3*r+2]),r++}static serialize(e,t){const i=new Float64Array(e.ids),r=new Uint32Array(e.positions);return Ta(i,r,0,i.length-1),t&&(t.add(i.buffer),t.add(r.buffer)),{ids:i,positions:r}}static deserialize(e){const t=new ba;let i;t.ids=e.ids,t.positions=e.positions;for(const e of t.ids)e!==i&&t.uniqueIds.push(e),i=e;return t.indexed=!0,t}}function wa(e){const t=+e;return!isNaN(t)&&Number.MIN_SAFE_INTEGER<=t&&t<=Number.MAX_SAFE_INTEGER?t:mt(String(e))}function Ta(e,t,i,r){for(;i<r;){const n=e[i+r>>1];let o=i-1,s=r+1;for(;;){do{o++}while(e[o]<n);do{s--}while(e[s]>n);if(o>=s)break;Ba(e,o,s),Ba(t,3*o,3*s),Ba(t,3*o+1,3*s+1),Ba(t,3*o+2,3*s+2)}s-i<r-s?(Ta(e,t,i,s),i=s+1):(Ta(e,t,s+1,r),r=s)}}function Ba(e,t,i){const r=e[t];e[t]=e[i],e[i]=r}co(ba,"FeaturePositionMap");class Ca{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,t){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,t),this.initialized=!0),!!this.location}set(e,t,i){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class Sa extends Ca{constructor(e){super(e),this.current=0}set(e,t,i){this.fetchUniformLocation(e,t)&&this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}}class Ea extends Ca{constructor(e){super(e),this.current=0}set(e,t,i){this.fetchUniformLocation(e,t)&&this.current!==i&&(this.current=i,this.gl.uniform1f(this.location,i))}}class Ma extends Ca{constructor(e){super(e),this.current=[0,0]}set(e,t,i){this.fetchUniformLocation(e,t)&&(i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1])))}}class Ia extends Ca{constructor(e){super(e),this.current=[0,0,0]}set(e,t,i){this.fetchUniformLocation(e,t)&&(i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2])))}}class Pa extends Ca{constructor(e){super(e),this.current=[0,0,0,0]}set(e,t,i){this.fetchUniformLocation(e,t)&&(i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]&&i[3]===this.current[3]||(this.current=i,this.gl.uniform4f(this.location,i[0],i[1],i[2],i[3])))}}class La extends Ca{constructor(e){super(e),this.current=Ct.transparent.toRenderColor(null)}set(e,t,i){this.fetchUniformLocation(e,t)&&(i.r===this.current.r&&i.g===this.current.g&&i.b===this.current.b&&i.a===this.current.a||(this.current=i,this.gl.uniform4f(this.location,i.r,i.g,i.b,i.a)))}}const Fa=new Float32Array(16);class ka extends Ca{constructor(e){super(e),this.current=Fa}set(e,t,i){if(this.fetchUniformLocation(e,t)){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let e=1;e<16;e++)if(i[e]!==this.current[e]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}}}const za=new Float32Array(9),Ra=new Float32Array(4);class Da extends Ca{constructor(e){super(e),this.current=Ra}set(e,t,i){if(this.fetchUniformLocation(e,t))for(let e=0;e<4;e++)if(i[e]!==this.current[e]){this.current=i,this.gl.uniformMatrix2fv(this.location,!1,i);break}}}function Oa(e){return[ya(255*e.r,255*e.g),ya(255*e.b,255*e.a)]}class Ua{constructor(e,t,i,r){this.value=e,this.uniformNames=t.map((e=>`u_${e}`)),this.type=i,this.context=r}setUniform(e,t,i,r,n){const o=r.constantOr(this.value);t.set(e,n,o instanceof Ct?o.toRenderColor(this.lutExpression&&"none"===this.lutExpression.value?null:this.context.lut):o)}getBinding(e,t){return"color"===this.type?new La(e):new Ea(e)}}class Na{constructor(e,t){this.uniformNames=t.map((e=>`u_${e}`)),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,t,i,r,n){const o="u_pattern"===n||"u_dash"===n?this.pattern:"u_pixel_ratio"===n?this.pixelRatio:null;o&&t.set(e,n,o)}getBinding(e,t){return"u_pattern"===t||"u_dash"===t?new Pa(e):new Ea(e)}}class Qa{constructor(e,t,i,r){this.expression=e,this.type=i,this.maxValue=0,this.paintVertexAttributes=t.map((e=>({name:`a_${e}`,type:"Float32",components:"color"===i?2:1,offset:0}))),this.paintVertexArray=new r}populatePaintArray(e,t,i,r,n,o,s){const a=this.paintVertexArray.length,l="composite"===this.expression.kind||"source"===this.expression.kind?this.expression.evaluate(new Do(0,{brightness:o}),t,{},n,r,s):"constant"===this.expression.kind&&this.expression.value,c=!!this.lutExpression&&"none"===("composite"===this.lutExpression.kind||"source"===this.lutExpression.kind?this.lutExpression.evaluate(new Do(0,{brightness:o}),t,{},n,r,s):this.lutExpression.value);this.paintVertexArray.resize(e),this._setPaintValue(a,e,l,c?null:this.context.lut)}updatePaintArray(e,t,i,r,n,o,s){const a="composite"===this.expression.kind||"source"===this.expression.kind?this.expression.evaluate({zoom:0,brightness:s},i,r,void 0,n):"constant"===this.expression.kind&&this.expression.value,l=!!this.lutExpression&&"none"===("composite"===this.lutExpression.kind||"source"===this.lutExpression.kind?this.lutExpression.evaluate(new Do(0,{brightness:s}),i,r,void 0,n):this.lutExpression.value);this._setPaintValue(e,t,a,l?null:this.context.lut)}_setPaintValue(e,t,i,r){if("color"===this.type){const n=Oa(i.toRenderColor(r));for(let i=e;i<t;i++)this.paintVertexArray.emplace(i,n[0],n[1])}else{for(let r=e;r<t;r++)this.paintVertexArray.emplace(r,i);this.maxValue=Math.max(this.maxValue,Math.abs(i))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&"constant"!==this.lutExpression.kind&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||"constant"!==this.expression.kind&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ja{constructor(e,t,i,r,n,o){this.expression=e,this.uniformNames=t.map((e=>`u_${e}_t`)),this.type=i,this.useIntegerZoom=r,this.context=n,this.maxValue=0,this.paintVertexAttributes=t.map((e=>({name:`a_${e}`,type:"Float32",components:"color"===i?4:2,offset:0}))),this.paintVertexArray=new o}populatePaintArray(e,t,i,r,n,o,s){const a=this.expression.evaluate(new Do(this.context.zoom,{brightness:o}),t,{},n,r,s),l=this.expression.evaluate(new Do(this.context.zoom+1,{brightness:o}),t,{},n,r,s),c=!!this.lutExpression&&"none"===("composite"===this.lutExpression.kind||"source"===this.lutExpression.kind?this.lutExpression.evaluate(new Do(0,{brightness:o}),t,{},n,r,s):this.lutExpression.value),u=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(u,e,a,l,c?null:this.context.lut)}updatePaintArray(e,t,i,r,n,o,s){const a=this.expression.evaluate({zoom:this.context.zoom,brightness:s},i,r,void 0,n),l=this.expression.evaluate({zoom:this.context.zoom+1,brightness:s},i,r,void 0,n),c=!!this.lutExpression&&"none"===("composite"===this.lutExpression.kind||"source"===this.lutExpression.kind?this.lutExpression.evaluate(new Do(0,{brightness:s}),i,r,void 0,n):this.lutExpression.value);this._setPaintValue(e,t,a,l,c?null:this.context.lut)}_setPaintValue(e,t,i,r,n){if("color"===this.type){const r=Oa(i.toRenderColor(n)),o=Oa(i.toRenderColor(n));for(let i=e;i<t;i++)this.paintVertexArray.emplace(i,r[0],r[1],o[0],o[1])}else{for(let n=e;n<t;n++)this.paintVertexArray.emplace(n,i,r);this.maxValue=Math.max(this.maxValue,Math.abs(i),Math.abs(r))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,t,i,r,n){const o=this.useIntegerZoom?Math.floor(i.zoom):i.zoom,s=J(this.expression.interpolationFactor(o,this.context.zoom,this.context.zoom+1),0,1);t.set(e,n,s)}getBinding(e,t){return new Ea(e)}}class Va{constructor(e,t,i,r,n){this.expression=e,this.layerId=n,this.paintVertexAttributes=("array"===i?xa:va).members;for(let e=0;e<t.length;++e);this.paintVertexArray=new r}populatePaintArray(e,t,i,r){const n=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(n,e,t.patterns&&t.patterns[this.layerId],i)}updatePaintArray(e,t,i,r,n,o,s){this._setPaintValues(e,t,i.patterns&&i.patterns[this.layerId],o)}_setPaintValues(e,t,i,r){if(!r||!i)return;const n=r[i];if(!n)return;const{tl:o,br:s,pixelRatio:a}=n;for(let i=e;i<t;i++)this.paintVertexArray.emplace(i,o[0],o[1],s[0],s[1],a)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Ha{constructor(e,t,i=()=>!0){this.binders={},this._buffers=[],this.context=t;const r=[];for(const n in e.paint._values){const o=e.paint.get(n);if(n.endsWith("-use-theme"))continue;if(!i(n))continue;if(!(o instanceof Ho&&On(o.property.specification)))continue;const s=Za(n,e.type),a=o.value,l=o.property.specification.type,c=!!o.property.useIntegerZoom,u="line-dasharray"===n||n.endsWith("pattern"),h=e.paint.get(`${n}-use-theme`),d="line-dasharray"===n&&"constant"!==e.layout.get("line-cap").value.kind||h&&"constant"!==h.value.kind;if("constant"!==a.kind||d)if("source"===a.kind||d||u){const t=Wa(n,l,"source");this.binders[n]=u?new Va(a,s,l,t,e.id):new Qa(a,s,l,t),r.push(`/a_${n}`)}else{const e=Wa(n,l,"composite");this.binders[n]=new ja(a,s,l,c,t,e),r.push(`/z_${n}`)}else this.binders[n]=u?new Na(a.value,s):new Ua(a.value,s,l,t),r.push(`/u_${n}`);h&&(this.binders[n].lutExpression=h.value)}this.cacheKey=r.sort().join("")}getMaxValue(e){const t=this.binders[e];return t instanceof Qa||t instanceof ja?t.maxValue:0}populatePaintArrays(e,t,i,r,n,o,s){for(const a in this.binders){const l=this.binders[a];l.context=this.context,(l instanceof Qa||l instanceof ja||l instanceof Va)&&l.populatePaintArray(e,t,i,r,n,o,s)}}setConstantPatternPositions(e){for(const t in this.binders){const i=this.binders[t];i instanceof Na&&i.setConstantPatternPositions(e)}}updatePaintArrays(e,t,i,r,n,o,s,a,l){let c=!1;const u=Object.keys(e),h=0!==u.length&&!a,d=h?u:t.uniqueIds;this.context.lut=n.lut;for(const a in this.binders){const u=this.binders[a];if(u.context=this.context,(u instanceof Qa||u instanceof ja||u instanceof Va)&&u.expression&&u.expression.kind&&"constant"!==u.expression.kind&&(!0===u.expression.isStateDependent||!1===u.expression.isLightConstant)){const p=n.paint.get(a);u.expression=p.value;for(const i of d){const n=e[i.toString()];t.eachPosition(i,((e,t,i)=>{const a=r.feature(e);u.updatePaintArray(t,i,a,n,o,s,l)}))}if(!h)for(const t of i.uniqueIds){const n=e[t.toString()];i.eachPosition(t,((e,t,i)=>{const a=r.feature(e);u.updatePaintArray(t,i,a,n,o,s,l)}))}c=!0}}return c}defines(){const e=[];for(const t in this.binders){const i=this.binders[t];(i instanceof Ua||i instanceof Na)&&e.push(...i.uniformNames.map((e=>`#define HAS_UNIFORM_${e}`)))}return e}getBinderAttributes(){const e=[];for(const t in this.binders){const i=this.binders[t];if(i instanceof Qa||i instanceof ja||i instanceof Va)for(let t=0;t<i.paintVertexAttributes.length;t++)e.push(i.paintVertexAttributes[t].name)}return e}getBinderUniforms(){const e=[];for(const t in this.binders){const i=this.binders[t];if(i instanceof Ua||i instanceof Na||i instanceof ja)for(const t of i.uniformNames)e.push(t)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const t=[];for(const i in this.binders){const r=this.binders[i];if(r instanceof Ua||r instanceof Na||r instanceof ja)for(const n of r.uniformNames)t.push({name:n,property:i,binding:r.getBinding(e,n)})}return t}setUniforms(e,t,i,r,n){for(const{name:t,property:o,binding:s}of i)this.binders[o].setUniform(e,s,n,r.get(o),t)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const t=this.binders[e];(t instanceof Qa||t instanceof ja||t instanceof Va)&&t.paintVertexBuffer&&this._buffers.push(t.paintVertexBuffer)}}upload(e){for(const t in this.binders){const i=this.binders[t];(i instanceof Qa||i instanceof ja||i instanceof Va)&&i.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const t=this.binders[e];(t instanceof Qa||t instanceof ja||t instanceof Va)&&t.destroy()}}}class Ga{constructor(e,t,i=()=>!0){this.programConfigurations={};for(const r of e)this.programConfigurations[r.id]=new Ha(r,t,i);this.needsUpload=!1,this._featureMap=new ba,this._featureMapWithoutIds=new ba,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,t,i,r,n,o,s,a){for(const i in this.programConfigurations)this.programConfigurations[i].populatePaintArrays(e,t,r,n,o,s,a);void 0!==t.id?this._featureMap.add(t.id,i,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,i,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,t,i,r,n,o,s){for(const a of i)this.needsUpload=this.programConfigurations[a.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,t,a,r,n,o,s||0)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const t in this.programConfigurations)this.programConfigurations[t].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const $a={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function Za(e,t){return $a[e]||[e.replace(`${t}-`,"").replace(/-/g,"_")]}const qa={"line-pattern":{source:Ps,composite:Ps},"fill-pattern":{source:Ps,composite:Ps},"fill-extrusion-pattern":{source:Ps,composite:Ps},"line-dasharray":{source:Ls,composite:Ls}},Ka={color:{source:Ws,composite:Rs},number:{source:Bs,composite:Ws}};function Wa(e,t,i){const r=qa[e];return r&&r[i]||Ka[t][i]}co(Ua,"ConstantBinder"),co(Na,"PatternConstantBinder"),co(Qa,"SourceExpressionBinder"),co(Va,"PatternCompositeBinder"),co(ja,"CompositeExpressionBinder"),co(Ha,"ProgramConfiguration",{omit:["_buffers"]}),co(Ga,"ProgramConfigurationSet");const Xa=Xi/Math.PI/2,Ya=5,Ja=6,el=16383,tl=64,il=[tl,32,16],rl=-Xa,nl=Xa;function ol(e,t,i,r=Xa){return i=Z(i),[e*Math.sin(i)*r,-t*r,e*Math.cos(i)*r]}function sl(e,t,i){return ol(Math.cos(Z(e)),Math.sin(Z(e)),t,i)}const al=6371008.8,ll=2*Math.PI*al;class cl{constructor(e,t){if(isNaN(e)||isNaN(t))throw new Error(`Invalid LngLat object: (${e}, ${t})`);if(this.lng=+e,this.lat=+t,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new cl(te(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const t=Math.PI/180,i=this.lat*t,r=e.lat*t,n=Math.sin(i)*Math.sin(r)+Math.cos(i)*Math.cos(r)*Math.cos((e.lng-this.lng)*t);return al*Math.acos(Math.min(n,1))}toBounds(e=0){const t=360*e/40075017,i=t/Math.cos(Math.PI/180*this.lat);return new ul({lng:this.lng-i,lat:this.lat-t},{lng:this.lng+i,lat:this.lat+t})}toEcef(e){return sl(this.lat,this.lng,Xa+e*Xa/al)}static convert(e){if(e instanceof cl)return e;if(Array.isArray(e)&&(2===e.length||3===e.length))return new cl(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&"object"==typeof e&&null!==e)return new cl(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class ul{constructor(e,t){if(e)if(t)this.setSouthWest(e).setNorthEast(t);else if(4===e.length){const t=e;this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]])}else{const t=e;this.setSouthWest(t[0]).setNorthEast(t[1])}}setNorthEast(e){return this._ne=e instanceof cl?new cl(e.lng,e.lat):cl.convert(e),this}setSouthWest(e){return this._sw=e instanceof cl?new cl(e.lng,e.lat):cl.convert(e),this}extend(e){const t=this._sw,i=this._ne;let r,n;if(e instanceof cl)r=e,n=e;else{if(!(e instanceof ul))return Array.isArray(e)?4===e.length||e.every(Array.isArray)?this.extend(ul.convert(e)):this.extend(cl.convert(e)):"object"==typeof e&&null!==e&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(cl.convert(e)):this;if(r=e._sw,n=e._ne,!r||!n)return this}return t||i?(t.lng=Math.min(r.lng,t.lng),t.lat=Math.min(r.lat,t.lat),i.lng=Math.max(n.lng,i.lng),i.lat=Math.max(n.lat,i.lat)):(this._sw=new cl(r.lng,r.lat),this._ne=new cl(n.lng,n.lat)),this}getCenter(){return new cl((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new cl(this.getWest(),this.getNorth())}getSouthEast(){return new cl(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:t,lat:i}=cl.convert(e);let r=this._sw.lng<=t&&t<=this._ne.lng;return this._sw.lng>this._ne.lng&&(r=this._sw.lng>=t&&t>=this._ne.lng),this._sw.lat<=i&&i<=this._ne.lat&&r}static convert(e){if(e)return e instanceof ul?e:new ul(e)}}const hl=0,dl=25.5;function pl(e){return ll*Math.cos(e*Math.PI/180)}function fl(e){return(180+e)/360}function Al(e){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e*Math.PI/360)))/360}function ml(e,t){return e/pl(t)}function gl(e){return 360*e-180}function _l(e){return 360/Math.PI*Math.atan(Math.exp((180-360*e)*Math.PI/180))-90}function yl(e,t){return e*pl(_l(t))}const vl=85.051129;function xl(e){return Math.cos(Z(J(e,-vl,vl)))}function bl(e,t){const i=J(t,hl,dl),r=Math.pow(2,i);return xl(e)*ll/(512*r)}function wl(e){return 1/Math.cos(e*Math.PI/180)}function Tl(e,t=0){const i=Math.exp(Math.PI*(1-(e.y+t/Xi)/(1<<e.z)*2));return 80150034*i/(i*i+1)/Xi/(1<<e.z)}class Bl{constructor(e,t,i=0){this.x=+e,this.y=+t,this.z=+i}static fromLngLat(e,t=0){const i=cl.convert(e);return new Bl(fl(i.lng),Al(i.lat),ml(t,i.lat))}toLngLat(){return new cl(gl(this.x),_l(this.y))}toAltitude(){return yl(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/ll*wl(_l(this.y))}}function Cl(e,t,i,r,n,o,s,a,l){const c=(t+r)/2,u=(i+n)/2,h=new V(c,u);a(h),function(e,t,i,r,n,o){const s=i-n,a=r-o;return Math.abs((r-t)*s-(i-e)*a)/Math.hypot(s,a)}(h.x,h.y,o.x,o.y,s.x,s.y)>=l?(Cl(e,t,i,c,u,o,h,a,l),Cl(e,c,u,r,n,h,s,a,l)):e.push(s)}function Sl(e,t,i){let r=e[0],n=r.x,o=r.y;t(r);const s=[r];for(let a=1;a<e.length;a++){const l=e[a],{x:c,y:u}=l;t(l),Cl(s,n,o,c,u,r,l,t,i),n=c,o=u,r=l}return s}function El(e,t,i,r){if(r(t,i)){const n=t.add(i)._mult(.5);El(e,t,n,r),El(e,n,i,r)}else e.push(i)}function Ml(e,t){let i=e[0];const r=[i];for(let n=1;n<e.length;n++){const o=e[n];El(r,i,o,t),i=o}return r}const Il=Math.pow(2,14)-1,Pl=-Il-1;function Ll(e,t){const i=Math.round(e.x*t),r=Math.round(e.y*t);return e.x=J(i,Pl,Il),e.y=J(r,Pl,Il),(i<e.x||i>e.x+1||r<e.y||r>e.y+1)&&de("Geometry exceeds allowed extent, reduce your vector tile buffer size"),e}function Fl(e,t,i){const r=e.loadGeometry(),n=e.extent,o=Xi/n;if(t&&i&&i.projection.isReprojectedInTileSpace){const o=1<<t.z,{scale:s,x:a,y:l,projection:c}=i,u=e=>{const i=gl((t.x+e.x/n)/o),r=_l((t.y+e.y/n)/o),u=c.project(i,r);e.x=(u.x*s-a)*n,e.y=(u.y*s-l)*n};for(let t=0;t<r.length;t++)if(1!==e.type)r[t]=Sl(r[t],u,1);else{const e=[];for(const i of r[t])i.x<0||i.x>=n||i.y<0||i.y>=n||(u(i),e.push(i));r[t]=e}}for(const e of r)for(const t of e)Ll(t,o);return r}function kl(e,t){return{type:e.type,id:e.id,properties:e.properties,geometry:t?Fl(e):[]}}function zl(e,t,i,r,n){e.emplaceBack(2*t+(r+1)/2,2*i+(n+1)/2)}function Rl(e,t,i){const r=16384;e.emplaceBack(t.x,t.y,t.z,i[0]*r,i[1]*r,i[2]*r)}class Dl{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.fqid)),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new bs,this.indexArray=new Vs,this.segments=new _a,this.programConfigurations=new Ga(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id))}updateFootprints(e,t){}populate(e,t,i,r){const n=this.layers[0],o=[];let s=null;"circle"===n.type&&(s=n.layout.get("circle-sort-key"));for(const{feature:t,id:n,index:a,sourceLayerIndex:l}of e){const e=this.layers[0]._featureFilter.needGeometry,c=kl(t,e);if(!this.layers[0]._featureFilter.filter(new Do(this.zoom),c,i))continue;const u=s?s.evaluate(c,{},i):void 0,h={id:n,properties:t.properties,type:t.type,sourceLayerIndex:l,index:a,geometry:e?c.geometry:Fl(t,i,r),patterns:{},sortKey:u};o.push(h)}s&&o.sort(((e,t)=>e.sortKey-t.sortKey));let a=null;"globe"===r.projection.name&&(this.globeExtVertexArray=new Fs,a=r.projection);for(const r of o){const{geometry:n,index:o,sourceLayerIndex:s}=r,l=e[o].feature;this.addFeature(r,n,o,t.availableImages,i,a,t.brightness),t.featureIndex.insert(l,n,o,s,this.index)}}update(e,t,i,r,n,o,s){this.programConfigurations.updatePaintArrays(e,t,n,i,r,o,s)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,ma.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,ga.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,t,i,r,n,o,s){for(const i of t)for(const t of i){const i=t.x,r=t.y;if(i<0||i>=Xi||r<0||r>=Xi)continue;if(o){const e=o.projectTilePoint(i,r,n),t=o.upVector(n,i,r),s=this.globeExtVertexArray;Rl(s,e,t),Rl(s,e,t),Rl(s,e,t),Rl(s,e,t)}const s=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),a=s.vertexLength;zl(this.layoutVertexArray,i,r,-1,-1),zl(this.layoutVertexArray,i,r,1,-1),zl(this.layoutVertexArray,i,r,1,1),zl(this.layoutVertexArray,i,r,-1,1),this.indexArray.emplaceBack(a,a+1,a+2),this.indexArray.emplaceBack(a,a+2,a+3),s.vertexLength+=4,s.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,{},r,n,s)}}function Ol(e,t){for(let i=0;i<e.length;i++)if(Zl(t,e[i]))return!0;for(let i=0;i<t.length;i++)if(Zl(e,t[i]))return!0;return!!jl(e,t)}function Ul(e,t,i){return!!Zl(e,t)||!!Hl(t,e,i)}function Nl(e,t){if(1===e.length)return $l(t,e[0]);for(let i=0;i<t.length;i++){const r=t[i];for(let t=0;t<r.length;t++)if(Zl(e,r[t]))return!0}for(let i=0;i<e.length;i++)if($l(t,e[i]))return!0;for(let i=0;i<t.length;i++)if(jl(e,t[i]))return!0;return!1}function Ql(e,t,i){if(e.length>1){if(jl(e,t))return!0;for(let r=0;r<t.length;r++)if(Hl(t[r],e,i))return!0}for(let r=0;r<e.length;r++)if(Hl(e[r],t,i))return!0;return!1}function jl(e,t){if(0===e.length||0===t.length)return!1;for(let i=0;i<e.length-1;i++){const r=e[i],n=e[i+1];for(let e=0;e<t.length-1;e++)if(Vl(r,n,t[e],t[e+1]))return!0}return!1}function Vl(e,t,i,r){return pe(e,i,r)!==pe(t,i,r)&&pe(e,t,i)!==pe(e,t,r)}function Hl(e,t,i){const r=i*i;if(1===t.length)return e.distSqr(t[0])<r;for(let i=1;i<t.length;i++)if(Gl(e,t[i-1],t[i])<r)return!0;return!1}function Gl(e,t,i){const r=t.distSqr(i);if(0===r)return e.distSqr(t);const n=((e.x-t.x)*(i.x-t.x)+(e.y-t.y)*(i.y-t.y))/r;return e.distSqr(n<0?t:n>1?i:i.sub(t)._mult(n)._add(t))}function $l(e,t){let i,r,n,o=!1;for(let s=0;s<e.length;s++){i=e[s];for(let e=0,s=i.length-1;e<i.length;s=e++)r=i[e],n=i[s],r.y>t.y!=n.y>t.y&&t.x<(n.x-r.x)*(t.y-r.y)/(n.y-r.y)+r.x&&(o=!o)}return o}function Zl(e,t){let i=!1;for(let r=0,n=e.length-1;r<e.length;n=r++){const o=e[r],s=e[n];o.y>t.y!=s.y>t.y&&t.x<(s.x-o.x)*(t.y-o.y)/(s.y-o.y)+o.x&&(i=!i)}return i}function ql(e,t,i,r,n){for(const o of e)if(t<=o.x&&i<=o.y&&r>=o.x&&n>=o.y)return!0;const o=[new V(t,i),new V(t,n),new V(r,n),new V(r,i)];if(e.length>2)for(const t of o)if(Zl(e,t))return!0;for(let t=0;t<e.length-1;t++)if(Kl(e[t],e[t+1],o))return!0;return!1}function Kl(e,t,i){const r=i[0],n=i[2];if(e.x<r.x&&t.x<r.x||e.x>n.x&&t.x>n.x||e.y<r.y&&t.y<r.y||e.y>n.y&&t.y>n.y)return!1;const o=pe(e,t,i[0]);return o!==pe(e,t,i[1])||o!==pe(e,t,i[2])||o!==pe(e,t,i[3])}function Wl(e,t,i,r,n,o){let s=t.y-e.y,a=e.x-t.x;if(o=o||0){const e=s*s+a*a;if(0===e)return!0;const t=Math.sqrt(e);s/=t,a/=t}return!((i.x-e.x)*s+(i.y-e.y)*a-o<0||(r.x-e.x)*s+(r.y-e.y)*a-o<0||(n.x-e.x)*s+(n.y-e.y)*a-o<0)}function Xl(e,t,i,r,n,o,s){return!(Wl(e,t,r,n,o,s)||Wl(t,i,r,n,o,s)||Wl(i,e,r,n,o,s)||Wl(r,n,e,t,i,s)||Wl(n,o,e,t,i,s)||Wl(o,r,e,t,i,s))}function Yl(e,t,i){const r=t.paint.get(e).value;return"constant"===r.kind?r.value:i.programConfigurations.get(t.id).getMaxValue(e)}function Jl(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function ec(e,t,i,r,n){if(!t[0]&&!t[1])return e;const o=V.convert(t)._mult(n);"viewport"===i&&o._rotate(-r);const s=[];for(let t=0;t<e.length;t++)s.push(e[t].sub(o));return s}function tc(e,t,i,r){const n=V.convert(e)._mult(r);return"viewport"===t&&n._rotate(-i),n}let ic,rc;co(Dl,"CircleBucket",{omit:["layers"]});var nc,oc={exports:{}},sc=(nc||(nc=1,function(e,t){!function(e){function t(e,t,r){var n=i(256*e,256*(t=Math.pow(2,r)-t-1),r),o=i(256*(e+1),256*(t+1),r);return n[0]+","+n[1]+","+o[0]+","+o[1]}function i(e,t,i){var r=2*Math.PI*6378137/256/Math.pow(2,i);return[e*r-2*Math.PI*6378137/2,t*r-2*Math.PI*6378137/2]}e.getURL=function(e,i,r,n,o,s){return s=s||{},e+"?"+["bbox="+t(r,n,o),"format="+(s.format||"image/png"),"service="+(s.service||"WMS"),"version="+(s.version||"1.1.1"),"request="+(s.request||"GetMap"),"srs="+(s.srs||"EPSG:3857"),"width="+(s.width||256),"height="+(s.height||256),"layers="+i].join("&")},e.getTileBBox=t,e.getMercCoords=i,Object.defineProperty(e,"__esModule",{value:!0})}(t)}(0,oc.exports)),oc.exports);class ac{constructor(e,t,i){this.z=e,this.x=t,this.y=i,this.key=uc(0,e,e,t,i)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,t){const i=sc.getTileBBox(this.x,this.y,this.z),r=function(e,t,i){let r,n="";for(let o=e;o>0;o--)r=1<<o-1,n+=(t&r?1:0)+(i&r?2:0);return n}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===t?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",r).replace("{bbox-epsg-3857}",i)}toString(){return`${this.z}/${this.x}/${this.y}`}}class lc{constructor(e,t){this.wrap=e,this.canonical=t,this.key=uc(e,t.z,t.z,t.x,t.y)}}class cc{constructor(e,t,i,r,n){this.overscaledZ=e,this.wrap=t,this.canonical=new ac(i,+r,+n),this.key=0===t&&e===i?this.canonical.key:uc(t,e,i,r,n)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const t=this.canonical.z-e;return e>this.canonical.z?new cc(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new cc(e,this.wrap,e,this.canonical.x>>t,this.canonical.y>>t)}calculateScaledKey(e,t=!0){if(this.overscaledZ===e&&t)return this.key;if(e>this.canonical.z)return uc(this.wrap*+t,e,this.canonical.z,this.canonical.x,this.canonical.y);{const i=this.canonical.z-e;return uc(this.wrap*+t,e,e,this.canonical.x>>i,this.canonical.y>>i)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const t=this.canonical.z-e.canonical.z;return 0===e.overscaledZ||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>t&&e.canonical.y===this.canonical.y>>t}children(e){if(this.overscaledZ>=e)return[new cc(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const t=this.canonical.z+1,i=2*this.canonical.x,r=2*this.canonical.y;return[new cc(t,this.wrap,t,i,r),new cc(t,this.wrap,t,i+1,r),new cc(t,this.wrap,t,i,r+1),new cc(t,this.wrap,t,i+1,r+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new cc(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new cc(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new lc(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function uc(e,t,i,r,n){const o=1<<Math.min(i,22);let s=o*(n%o)+r%o;return e&&i<22&&(s+=o*o*((e<0?-2*e-1:2*e)%(1<<2*(22-i)))),16*(32*s+i)+(t-i)}const hc=[e=>{let t=e.canonical.x-1,i=e.wrap;return t<0&&(t=(1<<e.canonical.z)-1,i--),new cc(e.overscaledZ,i,e.canonical.z,t,e.canonical.y)},e=>{let t=e.canonical.x+1,i=e.wrap;return t===1<<e.canonical.z&&(t=0,i++),new cc(e.overscaledZ,i,e.canonical.z,t,e.canonical.y)},e=>new cc(e.overscaledZ,e.wrap,e.canonical.z,e.canonical.x,(0===e.canonical.y?1<<e.canonical.z:e.canonical.y)-1),e=>new cc(e.overscaledZ,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y===(1<<e.canonical.z)-1?0:e.canonical.y+1)];co(ac,"CanonicalTileID"),co(cc,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const dc=vs([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:pc}=dc,fc=vs([{name:"a_pos_3",components:3,type:"Int16"}]);var Ac=vs([{name:"a_pos",type:"Int16",components:2}]);class mc{constructor(e,t){this.pos=e,this.dir=t}intersectsPlane(e,t,i){const r=U.vec2.dot(t,this.dir);if(Math.abs(r)<1e-6)return!1;const n=((e[0]-this.pos[0])*t[0]+(e[1]-this.pos[1])*t[1])/r;return i[0]=this.pos[0]+this.dir[0]*n,i[1]=this.pos[1]+this.dir[1]*n,!0}}class gc{constructor(e,t){this.pos=e,this.dir=t}intersectsPlane(e,t,i){const r=U.vec3.dot(t,this.dir);if(Math.abs(r)<1e-6)return!1;const n=((e[0]-this.pos[0])*t[0]+(e[1]-this.pos[1])*t[1]+(e[2]-this.pos[2])*t[2])/r;return i[0]=this.pos[0]+this.dir[0]*n,i[1]=this.pos[1]+this.dir[1]*n,i[2]=this.pos[2]+this.dir[2]*n,!0}closestPointOnSphere(e,t,i){if(U.vec3.equals(this.pos,e)||0===t)return i[0]=i[1]=i[2]=0,!1;const[r,n,o]=this.dir,s=this.pos[0]-e[0],a=this.pos[1]-e[1],l=this.pos[2]-e[2],c=r*r+n*n+o*o,u=2*(s*r+a*n+l*o),h=u*u-4*c*(s*s+a*a+l*l-t*t);if(h<0){const e=Math.max(-u/2,0),c=s+r*e,h=a+n*e,d=l+o*e,p=Math.hypot(c,h,d);return i[0]=c*t/p,i[1]=h*t/p,i[2]=d*t/p,!1}{const e=(-u-Math.sqrt(h))/(2*c);if(e<0){const e=Math.hypot(s,a,l);return i[0]=s*t/e,i[1]=a*t/e,i[2]=l*t/e,!1}return i[0]=s+r*e,i[1]=a+n*e,i[2]=l+o*e,!0}}}class _c{constructor(e,t,i,r,n){this.TL=e,this.TR=t,this.BR=i,this.BL=r,this.horizon=n}static fromInvProjectionMatrix(e,t,i){const r=[-1,1,1],n=[1,1,1],o=[1,-1,1],s=[-1,-1,1],a=U.vec3.transformMat4(r,r,e),l=U.vec3.transformMat4(n,n,e),c=U.vec3.transformMat4(o,o,e),u=U.vec3.transformMat4(s,s,e);return new _c(a,l,c,u,t/i)}}function yc(e,t,i){let r=1/0,n=-1/0;const o=[];for(const s of e){U.vec3.sub(o,s,t);const e=U.vec3.dot(o,i);r=Math.min(r,e),n=Math.max(n,e)}return[r,n]}function vc(e,t){let i=!0;for(let r=0;r<e.planes.length;r++){const n=e.planes[r];let o=0;for(let e=0;e<t.length;e++)o+=U.vec3.dot(n,t[e])+n[3]>=0;if(0===o)return 0;o!==t.length&&(i=!1)}return i?2:1}function xc(e,t){for(const i of e.projections){const r=yc(t,e.points[0],i.axis);if(i.projection[1]<r[0]||i.projection[0]>r[1])return 0}return 1}function bc(e,t){let i=0;const r=[0,0,0,0];for(let n=0;n<e.length;n++)r[0]=e[n][0],r[1]=e[n][1],r[2]=e[n][2],r[3]=1,U.vec4.dot(r,t)>=0&&i++;return i}class wc{constructor(e,t){this.points=e||new Array(8).fill([0,0,0]),this.planes=t||new Array(6).fill([0,0,0,0]),this.bounds=Tc.fromPoints(this.points),this.projections=[],this.frustumEdges=[U.vec3.sub([],this.points[2],this.points[3]),U.vec3.sub([],this.points[0],this.points[3]),U.vec3.sub([],this.points[4],this.points[0]),U.vec3.sub([],this.points[5],this.points[1]),U.vec3.sub([],this.points[6],this.points[2]),U.vec3.sub([],this.points[7],this.points[3])];for(const e of this.frustumEdges){const t=[0,-e[2],e[1]],i=[e[2],0,-e[0]];this.projections.push({axis:t,projection:yc(this.points,this.points[0],t)}),this.projections.push({axis:i,projection:yc(this.points,this.points[0],i)})}}static fromInvProjectionMatrix(e,t,i,r){const n=Math.pow(2,i),o=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((i=>{const o=U.vec4.transformMat4([],i,e),s=1/o[3]/t*n;return U.vec4.mul(o,o,[s,s,r?1/o[3]:s,s])})),s=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map((e=>{const t=U.vec3.sub([],o[e[0]],o[e[1]]),i=U.vec3.sub([],o[e[2]],o[e[1]]),r=U.vec3.normalize([],U.vec3.cross([],t,i)),n=-U.vec3.dot(r,o[e[1]]);return r.concat(n)})),a=[];for(let e=0;e<o.length;e++)a.push([o[e][0],o[e][1],o[e][2]]);return new wc(a,s)}intersectsPrecise(e,t,i){for(let i=0;i<t.length;i++)if(!bc(e,t[i]))return 0;for(let t=0;t<this.planes.length;t++)if(!bc(e,this.planes[t]))return 0;for(const t of i)for(const i of this.frustumEdges){const r=U.vec3.cross([],t,i),n=U.vec3.length(r);if(0===n)continue;U.vec3.scale(r,r,1/n);const o=yc(this.points,this.points[0],r),s=yc(e,this.points[0],r);if(o[0]>s[1]||s[0]>o[1])return 0}return 1}containsPoint(e){for(const t of this.planes){const i=t[3];if(U.vec3.dot([t[0],t[1],t[2]],e)+i<0)return!1}return!0}}class Tc{static fromPoints(e){const t=[1/0,1/0,1/0],i=[-1/0,-1/0,-1/0];for(const r of e)U.vec3.min(t,t,r),U.vec3.max(i,i,r);return new Tc(t,i)}static fromTileIdAndHeight(e,t,i){const r=1<<e.canonical.z,n=e.canonical.x,o=e.canonical.y;return new Tc([n/r,o/r,t],[(n+1)/r,(o+1)/r,i])}static applyTransform(e,t){const i=e.getCorners();for(let e=0;e<i.length;++e)U.vec3.transformMat4(i[e],i[e],t);return Tc.fromPoints(i)}static applyTransformFast(e,t){const i=[t[12],t[13],t[14]],r=[...i];for(let n=0;n<3;n++)for(let o=0;o<3;o++){const s=t[4*o+n],a=s*e.min[o],l=s*e.max[o];i[n]+=Math.min(a,l),r[n]+=Math.max(a,l)}return new Tc(i,r)}static projectAabbCorners(e,t){const i=e.getCorners();for(let e=0;e<i.length;++e)U.vec3.transformMat4(i[e],i[e],t);return i}constructor(e,t){this.min=e,this.max=t,this.center=U.vec3.scale([],U.vec3.add([],this.min,this.max),.5)}quadrant(e){const t=[e%2==0,e<2],i=U.vec3.clone(this.min),r=U.vec3.clone(this.max);for(let e=0;e<t.length;e++)i[e]=t[e]?this.min[e]:this.center[e],r[e]=t[e]?this.center[e]:this.max[e];return r[2]=this.max[2],new Tc(i,r)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,t=this.max;return[[e[0],e[1],e[2]],[t[0],e[1],e[2]],[t[0],t[1],e[2]],[e[0],t[1],e[2]],[e[0],e[1],t[2]],[t[0],e[1],t[2]],[t[0],t[1],t[2]],[e[0],t[1],t[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?vc(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?vc(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,t){return t||this.intersects(e)?xc(e,this.getCorners()):0}intersectsPreciseFlat(e,t){return t||this.intersectsFlat(e)?xc(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let t=0;t<3;++t)if(this.min[t]>e.max[t]||e.min[t]>this.max[t])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let t=0;t<3;t++)this.min[t]=Math.min(this.min[t],e.min[t]),this.max[t]=Math.max(this.max[t],e.max[t])}encapsulatePoint(e){for(let t=0;t<3;t++)this.min[t]=Math.min(this.min[t],e[t]),this.max[t]=Math.max(this.max[t],e[t])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}function Bc(e){return e*Xa/al}co(Tc,"Aabb");const Cc=[new Tc([rl,rl,rl],[nl,nl,nl]),new Tc([rl,rl,rl],[0,0,nl]),new Tc([0,rl,rl],[nl,0,nl]),new Tc([rl,0,rl],[0,nl,nl]),new Tc([0,0,rl],[nl,nl,nl])];function Sc(e,t,i,r=!0){const n=U.vec3.scale([],e._camera.position,e.worldSize),o=[t,i,1,1];U.vec4.transformMat4(o,o,e.pixelMatrixInverse),U.vec4.scale(o,o,1/o[3]);const s=U.vec3.sub([],o,n),a=U.vec3.normalize([],s),l=e.globeMatrix,c=[l[12],l[13],l[14]],u=U.vec3.sub([],c,n),h=U.vec3.length(u),d=U.vec3.normalize([],u),p=e.worldSize/(2*Math.PI),f=U.vec3.dot(d,a),A=Math.asin(p/h);if(A<Math.acos(f)){if(!r)return null;const e=[],t=[];U.vec3.scale(e,a,h/f),U.vec3.normalize(t,U.vec3.sub(t,e,u)),U.vec3.normalize(a,U.vec3.add(a,u,U.vec3.scale(a,t,Math.tan(A)*h)))}const m=[];new gc(n,a).closestPointOnSphere(c,p,m);const g=U.vec3.normalize([],ye(l,0)),_=U.vec3.normalize([],ye(l,1)),y=U.vec3.normalize([],ye(l,2)),v=U.vec3.dot(g,m),x=U.vec3.dot(_,m),b=U.vec3.dot(y,m),w=q(Math.asin(-x/p));let T=q(Math.atan2(v,b));T=e.center.lng+function(e,t){const i=(t-e+180)%360-180;return i<-180?i+360:i}(e.center.lng,T);const B=fl(T),C=J(Al(w),0,1);return new Bl(B,C)}class Ec{constructor(e,t,i){this.a=U.vec3.sub([],e,i),this.b=U.vec3.sub([],t,i),this.center=i;const r=U.vec3.normalize([],this.a),n=U.vec3.normalize([],this.b);this.angle=Math.acos(U.vec3.dot(r,n))}}function Mc(e,t){if(0===e.angle)return null;let i;return i=0===e.a[t]?1/e.angle*.5*Math.PI:1/e.angle*Math.atan(e.b[t]/e.a[t]/Math.sin(e.angle)-1/Math.tan(e.angle)),i<0||i>1?null:function(e,t,i,r){const n=Math.sin(i);return e*(Math.sin((1-r)*i)/n)+t*(Math.sin(r*i)/n)}(e.a[t],e.b[t],e.angle,J(i,0,1))+e.center[t]}function Ic(e){if(e.z<=1)return Cc[e.z+2*e.y+e.x];const t=zc(kc(e));return Tc.fromPoints(t)}function Pc(e,t,i){return U.vec3.scale(e,e,1-i),U.vec3.scaleAndAdd(e,e,t,i)}function Lc(e,t,i){for(const r of e)U.vec3.transformMat4(r,r,t),U.vec3.scale(r,r,i)}function Fc(e,t,i,r){const n=t/e.worldSize,o=e.globeMatrix;if(i.z<=1){const e=Ic(i).getCorners();return Lc(e,o,n),Tc.fromPoints(e)}const s=kc(i,r),a=zc(s,Xa+Bc(e._tileCoverLift));Lc(a,o,n);const l=Number.MAX_VALUE,c=[-l,-l,-l],u=[l,l,l];if(s.contains(e.center)){for(const e of a)U.vec3.min(u,u,e),U.vec3.max(c,c,e);c[2]=0;const t=e.point,i=[t.x*n,t.y*n,0];return U.vec3.min(u,u,i),U.vec3.max(c,c,i),new Tc(u,c)}if(e._tileCoverLift>0){for(const e of a)U.vec3.min(u,u,e),U.vec3.max(c,c,e);return new Tc(u,c)}const h=[o[12]*n,o[13]*n,o[14]*n],d=s.getCenter(),p=J(e.center.lat,-vl,vl),f=J(d.lat,-vl,vl),A=fl(e.center.lng),m=Al(p);let g=A-fl(d.lng);const _=m-Al(f);g>.5?g-=1:g<-.5&&(g+=1);let y=0;if(Math.abs(g)>Math.abs(_))y=g>=0?1:3;else{y=_>=0?0:2;const e=[o[4]*n,o[5]*n,o[6]*n],t=-Math.sin(Z(_>=0?s.getSouth():s.getNorth()))*Xa;U.vec3.scaleAndAdd(h,h,e,t)}const v=a[y],x=a[(y+1)%4],b=new Ec(v,x,h),w=[Mc(b,0)||v[0],Mc(b,1)||v[1],Mc(b,2)||v[2]],T=Hc(e.zoom);if(T>0){const r=function({x:e,y:t,z:i},r,n,o,s){const a=1/(1<<i);let l=e*a,c=l+a,u=t*a,h=u+a,d=0;const p=(l+c)/2-o;return p>.5?d=-1:p<-.5&&(d=1),l=((l+d)*r-(o*=r))*n+o,c=((c+d)*r-o)*n+o,u=(u*r-(s*=r))*n+s,h=(h*r-s)*n+s,[[l,h,0],[c,h,0],[c,u,0],[l,u,0]]}(i,t,e._pixelsPerMercatorPixel,A,m);for(let e=0;e<a.length;e++)Pc(a[e],r[e],T);const n=U.vec3.add([],r[y],r[(y+1)%4]);U.vec3.scale(n,n,.5),Pc(w,n,T)}for(const e of a)U.vec3.min(u,u,e),U.vec3.max(c,c,e);return u[2]=Math.min(v[2],x[2]),U.vec3.min(u,u,w),U.vec3.max(c,c,w),new Tc(u,c)}function kc({x:e,y:t,z:i},r=!1){const n=1/(1<<i),o=new cl(gl(e*n),t===(1<<i)-1&&r?-90:_l((t+1)*n)),s=new cl(gl((e+1)*n),0===t&&r?90:_l(t*n));return new ul(o,s)}function zc(e,t=Xa){const i=Z(e.getNorth()),r=Z(e.getSouth()),n=Math.cos(i),o=Math.cos(r),s=Math.sin(i),a=Math.sin(r),l=e.getWest(),c=e.getEast();return[ol(o,a,l,t),ol(o,a,c,t),ol(n,s,c,t),ol(n,s,l,t)]}function Rc(e,t,i,r){const n=1<<i.z,o=(e/Xi+i.x)/n;return sl(_l((t/Xi+i.y)/n),gl(o),r)}function Dc({min:e,max:t}){return el/Math.max(t[0]-e[0],t[1]-e[1],t[2]-e[2])}const Oc=new Float64Array(16);function Uc(e){const t=Dc(e),i=U.mat4.fromScaling(Oc,[t,t,t]);return U.mat4.translate(i,i,U.vec3.negate([],e.min))}function Nc(e){const t=U.mat4.fromTranslation(Oc,e.min),i=1/Dc(e);return U.mat4.scale(t,t,[i,i,i])}function Qc(e){const t=Xi/(2*Math.PI);return e/(2*Math.PI)/t}function jc(e,t){return Xi/(512*Math.pow(2,e))*Dc(Ic(t))}function Vc(e,t,i,r,n){const o=Qc(i),s=[e,t,-i/(2*Math.PI)],a=U.mat4.identity(new Float64Array(16));return U.mat4.translate(a,a,s),U.mat4.scale(a,a,[o,o,o]),U.mat4.rotateX(a,a,Z(-n)),U.mat4.rotateY(a,a,Z(-r)),a}function Hc(e){return ee(Ya,Ja,e)}function Gc(e,t){const i=sl(t.lat,t.lng),r=function(e){const t=sl(e._center.lat,e._center.lng),i=U.vec3.fromValues(0,1,0);let r=U.vec3.cross([],i,t);const n=U.mat4.fromRotation([],-e.angle,t);r=U.vec3.transformMat4(r,r,n),U.mat4.fromRotation(n,-e._pitch,r);const o=U.vec3.normalize([],t);return U.vec3.scale(o,o,Bc(e.cameraToCenterDistance/e.pixelsPerMeter)),U.vec3.transformMat4(o,o,n),U.vec3.add([],t,o)}(e),n=U.vec3.subtract([],r,i);return U.vec3.angle(n,i)}function $c(e,t){return Gc(e,t)>Math.PI/2*1.01}const Zc=Z(85),qc=Math.cos(Zc),Kc=Math.sin(Zc),Wc=U.mat4.create(),Xc=e=>{const t=[];return"map"===e.paint.get("circle-pitch-alignment")&&t.push("PITCH_WITH_MAP"),"map"===e.paint.get("circle-pitch-scale")&&t.push("SCALE_WITH_MAP"),t};function Yc(e,t,i,r,n,o,s,a,l){if(o&&e.queryGeometry.isAboveHorizon)return!1;o&&(l*=e.pixelToTileUnitsFactor);const c=e.tileID.canonical,u=i.projection.upVectorScale(c,i.center.lat,i.worldSize).metersToTile;for(const h of t)for(const t of h){const h=t.add(a),d=n&&i.elevation?i.elevation.exaggeration()*n.getElevationAt(h.x,h.y,!0):0,p=i.projection.projectTilePoint(h.x,h.y,c);if(d>0){const e=i.projection.upVector(c,h.x,h.y);p.x+=e[0]*u*d,p.y+=e[1]*u*d,p.z+=e[2]*u*d}const f=o?h:Jc(p.x,p.y,p.z,r),A=o?e.tilespaceRays.map((e=>iu(e,d))):e.queryGeometry.screenGeometry,m=U.vec4.transformMat4([],[p.x,p.y,p.z,1],r);if(!s&&o?l*=m[3]/i.cameraToCenterDistance:s&&!o&&(l*=i.cameraToCenterDistance/m[3]),o){const e=_l((t.y/Xi+c.y)/(1<<c.z));l/=i.projection.pixelsPerMeter(e,1)/ml(1,e)}if(Ul(A,f,l))return!0}return!1}function Jc(e,t,i,r){const n=U.vec4.transformMat4([],[e,t,i,1],r);return new V(n[0]/n[3],n[1]/n[3])}const eu=U.vec3.fromValues(0,0,0),tu=U.vec3.fromValues(0,0,1);function iu(e,t){const i=U.vec3.create();return eu[2]=t,e.intersectsPlane(eu,tu,i),new V(i[0],i[1])}class ru extends Dl{}let nu,ou,su,au;function lu(e,{width:t,height:i},r,n){if(n){if(n instanceof Uint8ClampedArray)n=new Uint8Array(n.buffer);else if(n.length!==t*i*r)throw new RangeError("mismatched image size")}else n=new Uint8Array(t*i*r);return e.width=t,e.height=i,e.data=n,e}function cu(e,t,i){const{width:r,height:n}=t;r===e.width&&n===e.height||(uu(e,t,{x:0,y:0},{x:0,y:0},{width:Math.min(e.width,r),height:Math.min(e.height,n)},i,null),e.width=r,e.height=n,e.data=t.data)}function uu(e,t,i,r,n,o,s,a){if(0===n.width||0===n.height)return t;if(n.width>e.width||n.height>e.height||i.x>e.width-n.width||i.y>e.height-n.height)throw new RangeError("out of range source coordinates for image copy");if(n.width>t.width||n.height>t.height||r.x>t.width-n.width||r.y>t.height-n.height)throw new RangeError("out of range destination coordinates for image copy");const l=e.data,c=t.data,u=4===o&&a;for(let a=0;a<n.height;a++){const h=((i.y+a)*e.width+i.x)*o,d=((r.y+a)*t.width+r.x)*o;if(u)for(let e=0;e<n.width;e++){const t=h+e*o+3,i=d+e*o;c[i+0]=255,c[i+1]=255,c[i+2]=255,c[i+3]=l[t]}else if(s)for(let e=0;e<n.width;e++){const t=h+e*o,i=d+e*o,r=l[t+3],n=new Ct(l[t+0]/255*r,l[t+1]/255*r,l[t+2]/255*r,r).toRenderColor(s).toArray();c[i+0]=n[0],c[i+1]=n[1],c[i+2]=n[2],c[i+3]=n[3]}else for(let e=0;e<n.width*o;e++)c[d+e]=l[h+e]}return t}co(ru,"HeatmapBucket",{omit:["layers"]});class hu{constructor(e,t){lu(this,e,1,t)}resize(e){cu(this,new hu(e),1)}clone(){return new hu({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,t,i,r,n){uu(e,t,i,r,n,1,null)}}class du{constructor(e,t){lu(this,e,4,t)}resize(e){cu(this,new du(e),4)}replace(e,t){t?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new du({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,t,i,r,n,o,s){uu(e,t,i,r,n,4,o,s)}}class pu{constructor(e,t){this.width=e.width,this.height=e.height,this.data=t instanceof Uint8Array?new Float32Array(t.buffer):t}}function fu(e){const t={},i=e.resolution||256,r=e.clips?e.clips.length:1,n=e.image||new du({width:i,height:r}),o=(i,r,o)=>{t[e.evaluationKey]=o;const s=e.expression.evaluate(t);s&&(n.data[i+r+0]=Math.floor(255*s.r/s.a),n.data[i+r+1]=Math.floor(255*s.g/s.a),n.data[i+r+2]=Math.floor(255*s.b/s.a),n.data[i+r+3]=Math.floor(255*s.a))};if(e.clips)for(let t=0,n=0;t<r;++t,n+=4*i)for(let r=0,s=0;r<i;r++,s+=4){const a=r/(i-1),{start:l,end:c}=e.clips[t];o(n,s,l*(1-a)+c*a)}else for(let e=0,t=0;e<i;e++,t+=4)o(0,t,e/(i-1));return n}co(hu,"AlphaImage"),co(du,"RGBAImage");const Au=vs([{name:"a_pos",components:2,type:"Int16"}],4),mu=vs([{name:"a_road_z_offset",components:1,type:"Float32"}],4),gu=vs([{name:"a_pos",components:2,type:"Int16"},{name:"a_height",components:1,type:"Float32"}],4),_u=vs([{name:"a_pos_normal_3",components:3,type:"Int16"}],4);function yu(e,t,i=2){const r=t&&t.length,n=r?t[0]*i:e.length;let o=vu(e,0,n,i,!0);const s=[];if(!o||o.next===o.prev)return s;let a,l,c;if(r&&(o=function(e,t,i,r){const n=[];for(let i=0,o=t.length;i<o;i++){const s=vu(e,t[i]*r,i<o-1?t[i+1]*r:e.length,r,!1);s===s.next&&(s.steiner=!0),n.push(Pu(s))}n.sort(Su);for(let e=0;e<n.length;e++)i=Eu(n[e],i);return i}(e,t,o,i)),e.length>80*i){a=1/0,l=1/0;let t=-1/0,r=-1/0;for(let o=i;o<n;o+=i){const i=e[o],n=e[o+1];i<a&&(a=i),n<l&&(l=n),i>t&&(t=i),n>r&&(r=n)}c=Math.max(t-a,r-l),c=0!==c?32767/c:0}return bu(o,s,i,a,l,c,0),s}function vu(e,t,i,r,n){let o;if(n===function(e,t,i,r){let n=0;for(let o=t,s=i-r;o<i;o+=r)n+=(e[s]-e[o])*(e[o+1]+e[s+1]),s=o;return n}(e,t,i,r)>0)for(let n=t;n<i;n+=r)o=Qu(n/r|0,e[n],e[n+1],o);else for(let n=i-r;n>=t;n-=r)o=Qu(n/r|0,e[n],e[n+1],o);return o&&zu(o,o.next)&&(ju(o),o=o.next),o}function xu(e,t){if(!e)return e;t||(t=e);let i,r=e;do{if(i=!1,r.steiner||!zu(r,r.next)&&0!==ku(r.prev,r,r.next))r=r.next;else{if(ju(r),r=t=r.prev,r===r.next)break;i=!0}}while(i||r!==t);return t}function bu(e,t,i,r,n,o,s){if(!e)return;!s&&o&&function(e,t,i,r){let n=e;do{0===n.z&&(n.z=Iu(n.x,n.y,t,i,r)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next}while(n!==e);n.prevZ.nextZ=null,n.prevZ=null,function(e){let t,i=1;do{let r,n=e;e=null;let o=null;for(t=0;n;){t++;let s=n,a=0;for(let e=0;e<i&&(a++,s=s.nextZ,s);e++);let l=i;for(;a>0||l>0&&s;)0!==a&&(0===l||!s||n.z<=s.z)?(r=n,n=n.nextZ,a--):(r=s,s=s.nextZ,l--),o?o.nextZ=r:e=r,r.prevZ=o,o=r;n=s}o.nextZ=null,i*=2}while(t>1)}(n)}(e,r,n,o);let a=e;for(;e.prev!==e.next;){const l=e.prev,c=e.next;if(o?Tu(e,r,n,o):wu(e))t.push(l.i,e.i,c.i),ju(e),e=c.next,a=c.next;else if((e=c)===a){s?1===s?bu(e=Bu(xu(e),t),t,i,r,n,o,2):2===s&&Cu(e,t,i,r,n,o):bu(xu(e),t,i,r,n,o,1);break}}}function wu(e){const t=e.prev,i=e,r=e.next;if(ku(t,i,r)>=0)return!1;const n=t.x,o=i.x,s=r.x,a=t.y,l=i.y,c=r.y,u=n<o?n<s?n:s:o<s?o:s,h=a<l?a<c?a:c:l<c?l:c,d=n>o?n>s?n:s:o>s?o:s,p=a>l?a>c?a:c:l>c?l:c;let f=r.next;for(;f!==t;){if(f.x>=u&&f.x<=d&&f.y>=h&&f.y<=p&&Lu(n,a,o,l,s,c,f.x,f.y)&&ku(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}function Tu(e,t,i,r){const n=e.prev,o=e,s=e.next;if(ku(n,o,s)>=0)return!1;const a=n.x,l=o.x,c=s.x,u=n.y,h=o.y,d=s.y,p=a<l?a<c?a:c:l<c?l:c,f=u<h?u<d?u:d:h<d?h:d,A=a>l?a>c?a:c:l>c?l:c,m=u>h?u>d?u:d:h>d?h:d,g=Iu(p,f,t,i,r),_=Iu(A,m,t,i,r);let y=e.prevZ,v=e.nextZ;for(;y&&y.z>=g&&v&&v.z<=_;){if(y.x>=p&&y.x<=A&&y.y>=f&&y.y<=m&&y!==n&&y!==s&&Lu(a,u,l,h,c,d,y.x,y.y)&&ku(y.prev,y,y.next)>=0)return!1;if(y=y.prevZ,v.x>=p&&v.x<=A&&v.y>=f&&v.y<=m&&v!==n&&v!==s&&Lu(a,u,l,h,c,d,v.x,v.y)&&ku(v.prev,v,v.next)>=0)return!1;v=v.nextZ}for(;y&&y.z>=g;){if(y.x>=p&&y.x<=A&&y.y>=f&&y.y<=m&&y!==n&&y!==s&&Lu(a,u,l,h,c,d,y.x,y.y)&&ku(y.prev,y,y.next)>=0)return!1;y=y.prevZ}for(;v&&v.z<=_;){if(v.x>=p&&v.x<=A&&v.y>=f&&v.y<=m&&v!==n&&v!==s&&Lu(a,u,l,h,c,d,v.x,v.y)&&ku(v.prev,v,v.next)>=0)return!1;v=v.nextZ}return!0}function Bu(e,t){let i=e;do{const r=i.prev,n=i.next.next;!zu(r,n)&&Ru(r,i,i.next,n)&&Uu(r,n)&&Uu(n,r)&&(t.push(r.i,i.i,n.i),ju(i),ju(i.next),i=e=n),i=i.next}while(i!==e);return xu(i)}function Cu(e,t,i,r,n,o){let s=e;do{let e=s.next.next;for(;e!==s.prev;){if(s.i!==e.i&&Fu(s,e)){let a=Nu(s,e);return s=xu(s,s.next),a=xu(a,a.next),bu(s,t,i,r,n,o,0),void bu(a,t,i,r,n,o,0)}e=e.next}s=s.next}while(s!==e)}function Su(e,t){return e.x-t.x}function Eu(e,t){const i=function(e,t){let i=t;const r=e.x,n=e.y;let o,s=-1/0;do{if(n<=i.y&&n>=i.next.y&&i.next.y!==i.y){const e=i.x+(n-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(e<=r&&e>s&&(s=e,o=i.x<i.next.x?i:i.next,e===r))return o}i=i.next}while(i!==t);if(!o)return null;const a=o,l=o.x,c=o.y;let u=1/0;i=o;do{if(r>=i.x&&i.x>=l&&r!==i.x&&Lu(n<c?r:s,n,l,c,n<c?s:r,n,i.x,i.y)){const t=Math.abs(n-i.y)/(r-i.x);Uu(i,e)&&(t<u||t===u&&(i.x>o.x||i.x===o.x&&Mu(o,i)))&&(o=i,u=t)}i=i.next}while(i!==a);return o}(e,t);if(!i)return t;const r=Nu(i,e);return xu(r,r.next),xu(i,i.next)}function Mu(e,t){return ku(e.prev,e,t.prev)<0&&ku(t.next,e,e.next)<0}function Iu(e,t,i,r,n){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-i)*n|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-r)*n|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Pu(e){let t=e,i=e;do{(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next}while(t!==e);return i}function Lu(e,t,i,r,n,o,s,a){return(n-s)*(t-a)>=(e-s)*(o-a)&&(e-s)*(r-a)>=(i-s)*(t-a)&&(i-s)*(o-a)>=(n-s)*(r-a)}function Fu(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){let i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==t.i&&i.next.i!==t.i&&Ru(i,i.next,e,t))return!0;i=i.next}while(i!==e);return!1}(e,t)&&(Uu(e,t)&&Uu(t,e)&&function(e,t){let i=e,r=!1;const n=(e.x+t.x)/2,o=(e.y+t.y)/2;do{i.y>o!=i.next.y>o&&i.next.y!==i.y&&n<(i.next.x-i.x)*(o-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next}while(i!==e);return r}(e,t)&&(ku(e.prev,e,t.prev)||ku(e,t.prev,t))||zu(e,t)&&ku(e.prev,e,e.next)>0&&ku(t.prev,t,t.next)>0)}function ku(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function zu(e,t){return e.x===t.x&&e.y===t.y}function Ru(e,t,i,r){const n=Ou(ku(e,t,i)),o=Ou(ku(e,t,r)),s=Ou(ku(i,r,e)),a=Ou(ku(i,r,t));return n!==o&&s!==a||!(0!==n||!Du(e,i,t))||!(0!==o||!Du(e,r,t))||!(0!==s||!Du(i,e,r))||!(0!==a||!Du(i,t,r))}function Du(e,t,i){return t.x<=Math.max(e.x,i.x)&&t.x>=Math.min(e.x,i.x)&&t.y<=Math.max(e.y,i.y)&&t.y>=Math.min(e.y,i.y)}function Ou(e){return e>0?1:e<0?-1:0}function Uu(e,t){return ku(e.prev,e,e.next)<0?ku(e,t,e.next)>=0&&ku(e,e.prev,t)>=0:ku(e,t,e.prev)<0||ku(e,e.next,t)<0}function Nu(e,t){const i=Vu(e.i,e.x,e.y),r=Vu(t.i,t.x,t.y),n=e.next,o=t.prev;return e.next=t,t.prev=e,i.next=n,n.prev=i,r.next=i,i.prev=r,o.next=r,r.prev=o,r}function Qu(e,t,i,r){const n=Vu(e,t,i);return r?(n.next=r.next,n.prev=r,r.next.prev=n,r.next=n):(n.prev=n,n.next=n),n}function ju(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Vu(e,t,i){return{i:e,x:t,y:i,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Hu(e,t){const i=e.length;if(i<=1)return[e];const r=[];let n,o;for(let t=0;t<i;t++){const i=fe(e[t]);0!==i&&(e[t].area=Math.abs(i),void 0===o&&(o=i<0),o===i<0?(n&&r.push(n),n=[e[t]]):n.push(e[t]))}if(n&&r.push(n),t>1)for(let e=0;e<r.length;e++)r[e].length<=t||(vi(r[e],t,1,r[e].length-1,Gu),r[e]=r[e].slice(0,t));return r}function Gu(e,t){return t.area-e.area}function $u(e,t,i=1){if(!e)return null;const r="string"==typeof e?ti.from(e).getPrimary():e.getPrimary(),n=r.id.toString();return t.has(n)||t.set(n,[]),r.scaleSelf(i),t.get(n).push(r),r.toString()}function Zu(e,t,i,r){const n=r.patternDependencies;let o=!1;for(const r of t){const t=r.paint.get(`${e}-pattern`);t.isConstant()||(o=!0),$u(t.constantOr(null),n,i)&&(o=!0)}return o}function qu(e,t,i,r,n,o){const s=o.patternDependencies;for(const a of t){const t=a.paint.get(`${e}-pattern`).value;if("constant"!==t.kind){let e=t.evaluate({zoom:r},i,{},o.availableImages);e=e&&e.name?e.name:e;const l=$u(e,s,n);l&&(i.patterns[a.id]=l)}}return i}var Ku,Wu,Xu,Yu,Ju,eh,th,ih={};function rh(){if(Wu)return Ku;Wu=1;var e=j();function t(e,t,r,n,o){this.properties={},this.extent=r,this.type=0,this._pbf=e,this._geometry=-1,this._keys=n,this._values=o,e.readFields(i,this,t)}function i(e,t,i){1==e?t.id=i.readVarint():2==e?function(e,t){for(var i=e.readVarint()+e.pos;e.pos<i;){var r=t._keys[e.readVarint()],n=t._values[e.readVarint()];t.properties[r]=n}}(i,t):3==e?t.type=i.readVarint():4==e&&(t._geometry=i.pos)}function r(e){for(var t,i,r=0,n=0,o=e.length,s=o-1;n<o;s=n++)r+=((i=e[s]).x-(t=e[n]).x)*(t.y+i.y);return r}return Ku=t,t.types=["Unknown","Point","LineString","Polygon"],t.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var i,r=t.readVarint()+t.pos,n=1,o=0,s=0,a=0,l=[];t.pos<r;){if(o<=0){var c=t.readVarint();n=7&c,o=c>>3}if(o--,1===n||2===n)s+=t.readSVarint(),a+=t.readSVarint(),1===n&&(i&&l.push(i),i=[]),i.push(new e(s,a));else{if(7!==n)throw new Error("unknown command "+n);i&&i.push(i[0].clone())}}return i&&l.push(i),l},t.prototype.bbox=function(){var e=this._pbf;e.pos=this._geometry;for(var t=e.readVarint()+e.pos,i=1,r=0,n=0,o=0,s=1/0,a=-1/0,l=1/0,c=-1/0;e.pos<t;){if(r<=0){var u=e.readVarint();i=7&u,r=u>>3}if(r--,1===i||2===i)(n+=e.readSVarint())<s&&(s=n),n>a&&(a=n),(o+=e.readSVarint())<l&&(l=o),o>c&&(c=o);else if(7!==i)throw new Error("unknown command "+i)}return[s,l,a,c]},t.prototype.toGeoJSON=function(e,i,n){var o,s,a=this.extent*Math.pow(2,n),l=this.extent*e,c=this.extent*i,u=this.loadGeometry(),h=t.types[this.type];function d(e){for(var t=0;t<e.length;t++){var i=e[t];e[t]=[360*(i.x+l)/a-180,360/Math.PI*Math.atan(Math.exp((180-360*(i.y+c)/a)*Math.PI/180))-90]}}switch(this.type){case 1:var p=[];for(o=0;o<u.length;o++)p[o]=u[o][0];d(u=p);break;case 2:for(o=0;o<u.length;o++)d(u[o]);break;case 3:for(u=function(e){var t=e.length;if(t<=1)return[e];for(var i,n,o=[],s=0;s<t;s++){var a=r(e[s]);0!==a&&(void 0===n&&(n=a<0),n===a<0?(i&&o.push(i),i=[e[s]]):i.push(e[s]))}return i&&o.push(i),o}(u),o=0;o<u.length;o++)for(s=0;s<u[o].length;s++)d(u[o][s])}1===u.length?u=u[0]:h="Multi"+h;var f={type:"Feature",geometry:{type:h,coordinates:u},properties:this.properties};return"id"in this&&(f.id=this.id),f},Ku}function nh(){if(Yu)return Xu;Yu=1;var e=rh();function t(e,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(i,this,t),this.length=this._features.length}function i(e,t,i){15===e?t.version=i.readVarint():1===e?t.name=i.readString():5===e?t.extent=i.readVarint():2===e?t._features.push(i.pos):3===e?t._keys.push(i.readString()):4===e&&t._values.push(function(e){for(var t=null,i=e.readVarint()+e.pos;e.pos<i;){var r=e.readVarint()>>3;t=1===r?e.readString():2===r?e.readFloat():3===r?e.readDouble():4===r?e.readVarint64():5===r?e.readVarint():6===r?e.readSVarint():7===r?e.readBoolean():null}return t}(i))}return Xu=t,t.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var i=this._pbf.readVarint()+this._pbf.pos;return new e(this._pbf,i,this.extent,this._keys,this._values)},Xu}function oh(){return th||(th=1,ih.VectorTile=function(){if(eh)return Ju;eh=1;var e=nh();function t(t,i,r){if(3===t){var n=new e(r,r.readVarint()+r.pos);n.length&&(i[n.name]=n)}}return Ju=function(e,i){this.layers=e.readFields(t,{},i)},Ju}(),ih.VectorTileFeature=rh(),ih.VectorTileLayer=nh()),ih}var sh=oh();const ah="3d_elevation_id",lh="level";class ch{constructor(){this._valid=!1}reset(e){return this.feature=e,this._valid=!0,this._geometry=e.loadGeometry(),0!==this._geometry.length&&0!==this._geometry[0].length||(this._valid=!1),this}geometry(e,t){return this._valid&&e(t(this._geometry)),this}require(e,t,i){return this.get(e,!0,t,i)}optional(e,t,i){return this.get(e,!1,t,i)}success(){return this._valid}get(e,t,i,r){const n=this.feature.properties.hasOwnProperty(e)?+this.feature.properties[e]:void 0;return this._valid&&void 0!==n?i(r?r(n):n):t&&(this._valid=!1),this}}class uh{constructor(e,t){this.featureFunc=e,this.vertexFunc=t}parseFeature(e,t,i){return this.featureFunc(e,t,i)}parseVertex(e,t,i){return this.vertexFunc(e,t,i)}}const hh=new uh(((e,t,i)=>e.reset(t).require(ah,(e=>{i.id=e})).optional("fixed_height_relative",(e=>{i.constantHeight=e}),ph.decodeRelativeHeight).geometry((e=>{i.bounds=e}),ph.computeBounds).success()),((e,t,i)=>e.reset(t).require(ah,(e=>{i.id=e})).require("elevation_idx",(e=>{i.idx=e})).require("extent",(e=>{i.extent=e})).require("height_relative",(e=>{i.height=e}),ph.decodeRelativeHeight).geometry((e=>{i.position=e}),ph.getPoint).success())),dh=new uh(((e,t,i)=>e.reset(t).require(ah,(e=>{i.id=e})).optional("fixed_height",(e=>{i.constantHeight=e}),ph.decodeMetricHeight).geometry((e=>{i.bounds=e}),ph.computeBounds).success()),((e,t,i)=>e.reset(t).require(ah,(e=>{i.id=e})).require("elevation_idx",(e=>{i.idx=e})).require("extent",(e=>{i.extent=e})).require("height",(e=>{i.height=e}),ph.decodeMetricHeight).geometry((e=>{i.position=e}),ph.getPoint).success()));class ph{static computeBounds(e){const t=new V(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),i=new V(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const r of e[0])t.x>r.x&&(t.x=r.x),t.y>r.y&&(t.y=r.y),i.x<r.x&&(i.x=r.x),i.y<r.y&&(i.y=r.y);return{min:t,max:i}}static getPoint(e){return U.vec2.fromValues(e[0][0].x,e[0][0].y)}static decodeRelativeHeight(e){return 1e-4*e*5}static decodeMetricHeight(e){return 1e-4*e}static parse(e){const t=[],i=[],r=e.length,n=new ch;for(let s=0;s<r;s++){const r=e.feature(s),a=r.properties.hasOwnProperty("version")?String(r.properties.version):void 0,l=(o=a)?"1.0.1"===o?dh:void 0:hh;if(void 0===l){de(`Unknown elevation feature version number ${a||"(unknown)"}`);continue}const c=r.properties.hasOwnProperty("type")?r.properties.type:void 0;if(c)if("Point"===sh.VectorTileFeature.types[r.type]&&"curve_point"===c){const e={};l.parseVertex(n,r,e)&&t.push(e)}else if("Polygon"===sh.VectorTileFeature.types[r.type]&&"curve_meta"===c){const e={};l.parseFeature(n,r,e)&&i.push(e)}}var o;return{vertices:t,features:i}}}class fh{constructor(e,t,i,r,n,o){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this.id=e,this.heightRange={min:i,max:i},this.safeArea=t,this.constantHeight=i,null==this.constantHeight&&(null!=this.constantHeight||0!==r.length)){this.vertices=r,this.edges=n,this.edges=this.edges.filter((e=>e.a<this.vertices.length&&e.b<this.vertices.length&&!U.vec2.exactEquals(this.vertices[e.a].position,this.vertices[e.b].position))),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const e of this.vertices)this.vertexProps.push({dir:U.vec2.fromValues(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,e.height),this.heightRange.max=Math.max(this.heightRange.max,e.height);for(const e of this.edges){const t=this.vertices[e.a].position,i=this.vertices[e.b].position,r=U.vec2.subtract(U.vec2.create(),i,t),n=U.vec2.length(r),o=U.vec2.scale(U.vec2.create(),r,1/n);this.edgeProps.push({vec:r,dir:o,len:n});const s=this.vertexProps[e.a].dir,a=this.vertexProps[e.b].dir;U.vec2.add(s,s,o),U.vec2.add(a,a,o)}for(const e of this.vertexProps)0===e.dir[0]&&0===e.dir[1]||U.vec2.normalize(e.dir,e.dir);this.tessellate(o)}}pointElevation(e){if(null!=this.constantHeight)return this.constantHeight;const t=this.getClosestEdge(e);if(null==t)return 0;const[i,r]=t;return((e,t,i)=>(1-i)*e+i*t)(this.vertices[this.edges[i].a].height,this.vertices[this.edges[i].b].height,r)}getSafeArea(){return this.safeArea}isTunnel(){return this.heightRange.max<=-5}getClosestEdge(e){if(0===this.edges.length)return;let t=0,i=Number.POSITIVE_INFINITY,r=0;const n=U.vec2.fromValues(e.x,e.y);for(let e=0;e<this.edges.length;e++){const o=this.edges[e],s=this.edgeProps[e].dir,a=new mc(n,this.edgeProps[e].dir),l=this.vertices[o.a].position,c=this.vertices[o.b].position,u=U.vec2.create(),h=U.vec2.create(),d=a.intersectsPlane(l,this.vertexProps[o.a].dir,u),p=a.intersectsPlane(c,this.vertexProps[o.b].dir,h);if(!d||!p)continue;const f=U.vec2.subtract(U.vec2.create(),h,u),A=U.vec2.subtract(U.vec2.create(),n,u),m=U.vec2.dot(f,f),g=m>0?U.vec2.dot(A,f)/m:0,_=J(g,0,1),y=Math.abs((g-_)*this.edgeProps[e].len),v=U.vec2.subtract(U.vec2.create(),n,l),x=y+Math.abs(U.vec2.dot(v,U.vec2.fromValues(s[1],-s[0])));x<i&&(t=e,i=x,r=_)}return[t,r]}tessellate(e){for(let t=this.edges.length-1;t>=0;--t){const i=this.edges[t].a,r=this.edges[t].b,{position:n,height:o,extent:s}=this.vertices[i],{position:a,height:l,extent:c}=this.vertices[r],u=this.vertexProps[i].dir,h=this.vertexProps[r].dir,d=U.vec3.fromValues(n[0]/e,n[1]/e,o),p=U.vec3.fromValues(a[0]/e,a[1]/e,l),f=U.vec3.fromValues(u[1],-u[0],0);U.vec3.scale(f,f,s);const A=U.vec3.fromValues(h[1],-h[0],0);if(U.vec3.scale(A,A,c),this.distSqLines(U.vec3.fromValues(d[0]+.5*f[0],d[1]+.5*f[1],d[2]+.5*f[2]),U.vec3.fromValues(p[0]-.5*A[0],p[1]-.5*A[1],p[2]-.5*A[2]),U.vec3.fromValues(d[0]-.5*f[0],d[1]-.5*f[1],d[2]-.5*f[2]),U.vec3.fromValues(p[0]+.5*A[0],p[1]+.5*A[1],p[2]+.5*A[2]))<=.05*.05)continue;const m=this.vertices.length,g=U.vec2.add(U.vec2.create(),n,a);this.vertices.push({position:U.vec2.scale(g,g,.5),height:.5*(o+l),extent:.5*(s+c)});const _=U.vec2.add(U.vec2.create(),u,h);this.vertexProps.push({dir:U.vec2.normalize(_,_)}),this.edges.splice(t,1),this.edgeProps.splice(t,1),this.edges.push({a:i,b:m}),this.edges.push({a:m,b:r});const y=U.vec2.subtract(U.vec2.create(),this.vertices[m].position,n),v=U.vec2.length(y),x={vec:y,dir:U.vec2.scale(U.vec2.create(),y,1/v),len:v};this.edgeProps.push(x),this.edgeProps.push(x)}}distSqLines(e,t,i,r){const n=U.vec3.subtract(U.vec3.create(),t,e),o=U.vec3.subtract(U.vec3.create(),r,i),s=U.vec3.subtract(U.vec3.create(),e,i),a=U.vec3.dot(n,n),l=U.vec3.dot(n,o),c=U.vec3.dot(n,s),u=U.vec3.dot(o,o),h=U.vec3.dot(o,s),d=a*u-l*l;if(0===d){const t=U.vec3.dot(s,o)/U.vec3.dot(o,o),n=U.vec3.lerp(U.vec3.create(),i,r,t);return U.vec3.squaredDistance(n,e)}const p=(l*h-c*u)/d,f=(a*h-l*c)/d,A=U.vec3.lerp(U.vec3.create(),e,t,p),m=U.vec3.lerp(U.vec3.create(),i,r,f);return U.vec3.squaredDistance(A,m)}}class Ah{constructor(e,t){this.zScale=1,this.xOffset=0,this.yOffset=0,e.equals(t)||(this.zScale=Math.pow(2,t.z-e.z),this.xOffset=(e.x*this.zScale-t.x)*Xi,this.yOffset=(e.y*this.zScale-t.y)*Xi)}constantElevation(e,t){if(null!=e.constantHeight)return this.computeBiasedHeight(e.constantHeight,t)}pointElevation(e,t,i){const r=this.constantElevation(t,i);return null!=r?r:(e.x=e.x*this.zScale+this.xOffset,e.y=e.y*this.zScale+this.yOffset,this.computeBiasedHeight(t.pointElevation(e),i))}computeBiasedHeight(e,t){return t<=0?e:e+t*ee(0,t,e>=0?e:Math.abs(.5*e))}}co(fh,"ElevationFeature");class mh{constructor(){this.polygons=new Map}add(e,...t){this.polygons.has(e)?this.polygons.get(e).push(...t):this.polygons.set(e,t)}merge(e){for(const[t,i]of e.polygons)this.add(t,...i)}}class gh{constructor(){this.portals=[]}static evaluate(e){if(0===e.length)return new gh;let t=[];for(const i of e)t.push(...i.portals);if(0===t.length)return new gh;const i=(e,t)=>e<=0&&t<=0||e>=Xi&&t>=Xi;for(const e of t){const t=e.va,r=e.vb;(i(t.x,r.x)||i(t.y,r.y))&&(e.type="border")}const r=t.filter((e=>"unevaluated"!==e.type)),n=t.filter((e=>"unevaluated"===e.type));if(0===n.length)return new gh;n.sort(((e,t)=>e.hash===t.hash?e.isTunnel===t.isTunnel?0:e.isTunnel?-1:1:e.hash<t.hash?1:-1)),t=r.concat(n);let o=r.length,s=o,a=o;do{if(s++,s===t.length||t[o].hash!==t[s].hash){if(s-o==2){a<o&&(t[a]=t[o],t[o]=null);const e=t[a],i=t[s-1];e.type=e.isTunnel!==i.isTunnel?"tunnel":"polygon",e.connection={a:e.connection.a,b:i.connection.a},a++}o=s}}while(o!==t.length);return t.splice(a),t.sort(((e,t)=>e.hash<t.hash?1:-1)),{portals:t}}}co(gh,"ElevationPortalGraph"),co(mh,"ElevationPolygons");class _h{constructor(e,t,i){this.outPositions=e,this.outNormals=t,this.outIndices=i,this.vertexLookup=new Map,this.buffer=new ArrayBuffer(4),this.view=new DataView(this.buffer)}addVertex(e,t,i){let r=e[2];null!=i&&(r*=i);const n=this.getVec3Bits(e)<<96n|this.getVec3Bits(t),o=this.vertexLookup.get(n);if(null!=o)return o;const s=this.outPositions.length;this.vertexLookup.set(n,s);const a=Math.trunc(16384*t[0]),l=Math.trunc(16384*t[1]),c=Math.trunc(16384*t[2]);return this.outPositions.emplaceBack(e[0],e[1],r),this.outNormals.emplaceBack(a,l,c),s}addVertices(e,t,...i){const r=[];for(const n of i){const i=this.addVertex(n,e,t);r.push(i)}return r}addTriangles(e,t,i){if(t&&i){const r=1===i.length,n=U.vec3.fromValues(0,0,0);for(let o=0;o<e.length;o+=3){const s=t[e[o+0]],a=t[e[o+1]],l=t[e[o+2]],c=r?i[0]:i[e[o+1]],u=r?i[0]:i[e[o+2]],h=this.addVertex(U.vec3.fromValues(s.x,s.y,r?i[0]:i[e[o+0]]),n),d=this.addVertex(U.vec3.fromValues(a.x,a.y,c),n),p=this.addVertex(U.vec3.fromValues(l.x,l.y,u),n);this.outIndices.emplaceBack(h,d,p)}}else for(let t=0;t<e.length;t+=3)this.outIndices.emplaceBack(e[t+0],e[t+1],e[t+2])}addQuad(e,t){const i=this.addVertices(t,void 0,...e.map((e=>U.vec3.fromValues(e.coord.x,e.coord.y,e.height)))),[r,n,o,s]=i;this.addTriangles([r,n,o,o,s,r])}getBits(e){return this.view.setFloat32(0,e),BigInt(this.view.getUint32(0))}getVec3Bits(e){return this.getBits(e[0])<<64n|this.getBits(e[1])<<32n|this.getBits(e[2])}}class yh{constructor(e){this.unevaluatedPortals=new gh,this.portalPolygons=new mh,this.vertexHashLookup=new Map,this.unevalVertices=[],this.unevalHeights=[],this.unevalTriangles=[],this.unevalTunnelTriangles=[],this.unevalEdges=[],this.vertexPositions=new Cs,this.vertexNormals=new Ss,this.indexArray=new Vs,this.tileToMeters=Tl(e)}addVertices(e,t){const i=this.unevalVertices.length;for(let i=0;i<e.length;i++)this.unevalVertices.push(e[i]),this.unevalHeights.push(t[i]);return i}addTriangles(e,t,i){const r=i?this.unevalTunnelTriangles:this.unevalTriangles;for(const i of e)r.push(i+t)}addRenderableRing(e,t,i,r,n){const o=[new V(n.min.x,n.min.y),new V(n.max.x,n.min.y),new V(n.max.x,n.max.y),new V(n.min.x,n.max.y)];for(let s=0;s<i-1;s++){const i=t+s,a=i+1,l=this.unevalVertices[i],c=this.unevalVertices[a];if(!(l.x>=n.min.x&&l.x<=n.max.x&&l.y>=n.min.y&&l.y<=n.max.y||c.x>=n.min.x&&c.x<=n.max.x&&c.y>=n.min.y&&c.y<=n.max.y||Kl(l,c,o)))continue;if(this.isOnBorder(l.x,c.x)||this.isOnBorder(l.y,c.y))continue;const u=yh.computeEdgeHash(this.unevalVertices[i],this.unevalVertices[a]);let h,d=this.vertexHashLookup.get(yh.computePosHash(l));null!=d?h=d.next:(d=this.vertexHashLookup.get(yh.computePosHash(c)),h=null!=d?d.prev:u),this.unevalEdges.push({polygonIdx:e,a:i,b:a,hash:u,portalHash:h,isTunnel:r,type:"unevaluated"})}}addPortalCandidates(e,t,i,r,n){if(0===t.length)return;this.portalPolygons.add(e,{geometry:t,zLevel:n});const o=t[0];this.vertexHashLookup.clear();let s=yh.computeEdgeHash(o[o.length-2],o[o.length-1]);for(let t=0;t<o.length-1;t++){const n=o[t+0],a=o[t+1],l=U.vec2.fromValues(a.x-n.x,a.y-n.y),c=U.vec2.length(l);if(0===c)continue;let u="unevaluated";const h=r.pointElevation(n),d=r.pointElevation(a);Math.abs(h)<.01&&Math.abs(d)<.01?u="entrance":(this.isOnBorder(n.x,a.x)||this.isOnBorder(n.y,a.y))&&(u="border");const p=yh.computeEdgeHash(n,a);this.unevaluatedPortals.portals.push({connection:{a:e,b:void 0},va:n,vb:a,vab:l,length:c,hash:p,isTunnel:i,type:u});const f=yh.computePosHash(n);this.vertexHashLookup.set(f,{prev:s,next:p}),s=p}}construct(e){if(0===this.unevalVertices.length)return;const t=()=>({vertexOffset:0,primitiveOffset:this.indexArray.length}),i=e=>{e.primitiveLength=this.indexArray.length-e.primitiveOffset},r=new _h(this.vertexPositions,this.vertexNormals,this.indexArray);this.prepareEdges(e.portals,this.unevalEdges);const n=t(),o=t(),s=t(),a=(e,t)=>{e.sort(((e,i)=>e.type===t&&i.type!==t?-1:e.type!==t&&i.type===t?1:0));const i=e.findIndex((e=>e.type!==t));return i>=0?i:e.length};let l=0;this.unevalEdges.length>0&&(l=a(this.unevalEdges,"none"),this.constructBridgeStructures(r,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:l},this.tileToMeters));const c=t();if(this.unevalEdges.length>0){const e=this.unevalEdges.splice(l),t=a(e,"tunnel")+l;this.unevalEdges.push(...e),this.constructTunnelStructures(r,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:l},{min:l,max:t})}i(s),r.addTriangles(this.unevalTriangles,this.unevalVertices,this.unevalHeights),i(c),r.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,this.unevalHeights),i(o),r.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,[-.1]),i(n),this.maskSegments=_a.simpleSegment(0,c.primitiveOffset,0,c.primitiveLength),this.depthSegments=_a.simpleSegment(0,o.primitiveOffset,0,o.primitiveLength),this.renderableSegments=_a.simpleSegment(0,s.primitiveOffset,0,s.primitiveLength),this.shadowCasterSegments=_a.simpleSegment(0,n.primitiveOffset,0,n.primitiveLength)}upload(e){this.vertexBuffer||0===this.vertexPositions.length||0===this.vertexNormals.length||0===this.indexArray.length||(this.vertexBuffer=e.createVertexBuffer(this.vertexPositions,gu.members),this.vertexBufferNormal=e.createVertexBuffer(this.vertexNormals,_u.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}destroy(){this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBufferNormal.destroy(),this.indexBuffer.destroy()),this.maskSegments&&(this.maskSegments.destroy(),this.depthSegments.destroy(),this.renderableSegments.destroy(),this.shadowCasterSegments.destroy())}computeVertexConnections(e,t,i,r){const n=new Map;for(let o=i;o<r;o++){const i=t[o],r=i.a,s=i.b;n.has(r)||n.set(r,{}),n.has(s)||n.set(s,{});const a=n.get(r),l=n.get(s);e[s]>0&&(a.to=s),e[r]>0&&(l.from=r)}return n}constructBridgeStructures(e,t,i,r,n,o){const s=this.computeVertexConnections(i,r,n.min,n.max),a=1/o,l=.5*a,c=e=>U.vec3.fromValues(t[e].x,t[e].y,i[e]*a),u=e=>{const t=s.get(e),i=t.from,r=t.to;if(!i||!r)return;const n=c(i),o=c(e),a=c(r),l=U.vec3.fromValues(0,0,0);if(!U.vec3.exactEquals(n,o)){const e=U.vec3.sub(U.vec3.create(),o,n);U.vec3.add(l,l,U.vec3.normalize(e,e))}if(!U.vec3.exactEquals(a,o)){const e=U.vec3.sub(U.vec3.create(),a,o);U.vec3.add(l,l,U.vec3.normalize(e,e))}const u=U.vec3.len(l);return u>0?U.vec3.scale(l,l,1/u):void 0};for(let s=n.min;s<n.max;s++){const n=r[s],c=this.prepareEdgePoints(t,i,n,((e,t)=>e>=t));if(null==c)continue;const h=c[0],d=c[1],p=U.vec3.fromValues(h.coord.x,h.coord.y,a*h.height),f=U.vec3.fromValues(d.coord.x,d.coord.y,a*d.height);if(U.vec3.exactEquals(p,f))continue;const A=U.vec3.sub(U.vec3.create(),f,p);U.vec3.normalize(A,A);const m=e=>U.vec3.normalize(e,e),g=u(n.a)||A,_=u(n.b)||A,y=m(U.vec3.fromValues(g[1],-g[0],0)),v=m(U.vec3.fromValues(_[1],-_[0],0)),x=m(U.vec3.cross(U.vec3.create(),y,g)),b=m(U.vec3.cross(U.vec3.create(),v,_)),w=U.vec3.create(),T=[U.vec3.add(U.vec3.create(),p,U.vec3.scale(w,U.vec3.sub(w,y,x),l)),U.vec3.add(U.vec3.create(),p,U.vec3.scale(w,U.vec3.add(w,y,x),l)),U.vec3.add(U.vec3.create(),p,U.vec3.scale(w,x,l)),p],B=[U.vec3.add(U.vec3.create(),f,U.vec3.scale(w,U.vec3.sub(w,v,b),l)),U.vec3.add(U.vec3.create(),f,U.vec3.scale(w,U.vec3.add(w,v,b),l)),U.vec3.add(U.vec3.create(),f,U.vec3.scale(w,b,l)),f],[C,S]=e.addVertices(y,o,T[0],T[1]),[E,M]=e.addVertices(v,o,B[0],B[1]);e.addTriangles([C,S,E,S,M,E]);const[I,P]=e.addVertices(x,o,T[1],T[2]),[L,F]=e.addVertices(b,o,B[1],B[2]);e.addTriangles([I,P,L,P,F,L]);const[k,z]=e.addVertices(U.vec3.negate(y,y),o,T[2],T[3]),[R,D]=e.addVertices(U.vec3.negate(v,v),o,B[2],B[3]);e.addTriangles([k,z,R,z,D,R])}}constructTunnelStructures(e,t,i,r,n,o){const s=e=>U.vec3.normalize(e,e);for(let o=n.min;o<n.max;o++){const n=this.prepareEdgePoints(t,i,r[o],((e,t)=>e<=t));if(null==n)continue;const[a,l]=n,c=s(U.vec3.fromValues(l.coord.y-a.coord.y,-(l.coord.x-a.coord.x),0));e.addQuad([a,l,{coord:l.coord,height:r[o].isTunnel?-.1:0},{coord:a.coord,height:r[o].isTunnel?-.1:0}],c)}for(let n=o.min;n<o.max;n++){const o=r[n],a=t[o.a],l=t[o.b],c=s(U.vec3.fromValues(l.y-a.y,-(l.x-a.x),0));e.addQuad([{coord:l,height:0},{coord:a,height:0},{coord:a,height:i[o.a]+4},{coord:l,height:i[o.b]+4}],c),e.addQuad([{coord:a,height:0},{coord:l,height:0},{coord:l,height:i[o.b]+4},{coord:a,height:i[o.a]+4}],c)}}prepareEdgePoints(e,t,i,r){const n=e[i.a],o=e[i.b];let s=t[i.a],a=t[i.b];if(!(0!==s&&r(s,0)||0!==a&&r(a,0)))return;const l=n.clone(),c=o.clone();if(r(s,0)){if(!r(a,0)){const e=a/(a-s);c.x=Et(c.x,l.x,e),c.y=Et(c.y,l.y,e),a=Et(a,s,e)}}else{const e=s/(s-a);l.x=Et(l.x,c.x,e),l.y=Et(l.y,c.y,e),s=Et(s,a,e)}return[{coord:l,height:s},{coord:c,height:a}]}prepareEdges(e,t){if(0===t.length)return;t.sort(((e,t)=>e.hash===t.hash?t.polygonIdx-e.polygonIdx:t.hash>e.hash?1:-1));let i=0,r=0,n=0,o=t[i].polygonIdx;do{r++,(r===t.length||t[i].hash!==t[r].hash)&&((1==r-i||t[r-1].polygonIdx!==o)&&(n<i&&(t[n]=t[i],t[i]=null),t[n].type="none",n++),i=r,i!==t.length&&(o=t[i].polygonIdx))}while(i!==t.length);if(t.splice(n),0!==t.length&&0!==e.length){t.sort(((e,t)=>e.hash<t.hash?1:-1));let i=0,r=0;for(;i!==t.length&&r!==e.length;){const n=t[i],o=e[r];n.portalHash>o.hash?i++:o.hash>n.portalHash?r++:(n.type=o.type,i++)}}}isOnBorder(e,t){return e<=0&&t<=0||e>=Xi&&t>=Xi}static computeEdgeHash(e,t){return(e.y===t.y&&e.x>t.x||e.y>t.y)&&([e,t]=[t,e]),BigInt(yh.computePosHash(e))<<32n|BigInt(yh.computePosHash(t))}static computePosHash(e){return((65535&e.x)<<16|65535&e.y)>>>0}}class vh{constructor(e,t){this.layoutVertexArray=new bs,this.indexArray=new Vs,this.lineIndexArray=new Os,this.triangleSegments=new _a,this.lineSegments=new _a,this.programConfigurations=new Ga(e.layers,{zoom:e.zoom,lut:e.lut}),this.uploaded=!1,t&&(this.elevatedLayoutVertexArray=new Bs)}update(e,t,i,r,n,o,s){this.programConfigurations.updatePaintArrays(e,t,n,i,r,o,s)}isEmpty(){return 0===this.layoutVertexArray.length}needsUpload(){return this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Au.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.lineIndexBuffer=e.createIndexBuffer(this.lineIndexArray),this.elevatedLayoutVertexArray&&this.elevatedLayoutVertexArray.length>0&&(this.elevatedLayoutVertexBuffer=e.createVertexBuffer(this.elevatedLayoutVertexArray,mu.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.lineIndexBuffer.destroy(),this.programConfigurations.destroy(),this.triangleSegments.destroy(),this.lineSegments.destroy())}populatePaintArrays(e,t,i,r,n,o){this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,t,i,r,n,o)}}class xh{constructor(e){this.zoom=e.zoom,this.pixelRatio=e.pixelRatio,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.fqid)),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.bufferData=new vh(e,!1),this.elevationBufferData=new vh(e,!0),this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id)),this.projection=e.projection,this.elevationMode=this.layers[0].layout.get("fill-elevation-reference")}updateFootprints(e,t){}populate(e,t,i,r){this.hasPattern=Zu("fill",this.layers,this.pixelRatio,t);const n=this.layers[0].layout.get("fill-sort-key"),o=[];for(const{feature:s,id:a,index:l,sourceLayerIndex:c}of e){const e=this.layers[0]._featureFilter.needGeometry,u=kl(s,e);if(!this.layers[0]._featureFilter.filter(new Do(this.zoom),u,i))continue;const h=n?n.evaluate(u,{},i,t.availableImages):void 0,d={id:a,properties:s.properties,type:s.type,sourceLayerIndex:c,index:l,geometry:e?u.geometry:Fl(s,i,r),patterns:{},sortKey:h};o.push(d)}n&&o.sort(((e,t)=>e.sortKey-t.sortKey));for(const r of o){const{geometry:n,index:o,sourceLayerIndex:s}=r;if(this.hasPattern){const e=qu("fill",this.layers,r,this.zoom,this.pixelRatio,t);this.patternFeatures.push(e)}else this.addFeature(r,n,o,i,{},t.availableImages,t.brightness,t.elevationFeatures);t.featureIndex.insert(e[o].feature,n,o,s,this.index)}}update(e,t,i,r,n,o,s){this.bufferData.update(e,t,i,r,n,o,s),this.elevationBufferData.update(e,t,i,r,n,o,s)}addFeatures(e,t,i,r,n,o){for(const n of this.patternFeatures)this.addFeature(n,n.geometry,n.index,t,i,r,o,e.elevationFeatures)}isEmpty(){return this.bufferData.isEmpty()&&this.elevationBufferData.isEmpty()}uploadPending(){return!this.uploaded||this.bufferData.needsUpload()||this.elevationBufferData.needsUpload()}upload(e){this.bufferData.upload(e),this.elevationBufferData.upload(e),this.elevatedStructures&&this.elevatedStructures.upload(e)}destroy(){this.bufferData.destroy(),this.elevationBufferData.destroy(),this.elevatedStructures&&this.elevatedStructures.destroy()}addFeature(e,t,i,r,n,o=[],s,a){const l=Hu(t,500);"none"!==this.elevationMode?this.addElevatedRoadFeature(e,l,r,i,a):this.addGeometry(l,this.bufferData),this.bufferData.populatePaintArrays(e,i,n,o,r,s),this.elevationBufferData.populatePaintArrays(e,i,n,o,r,s)}getUnevaluatedPortalGraph(){return this.elevatedStructures?this.elevatedStructures.unevaluatedPortals:void 0}getElevationPolygons(){return this.elevatedStructures?this.elevatedStructures.portalPolygons:void 0}setEvaluatedPortalGraph(e){this.elevatedStructures&&this.elevatedStructures.construct(e)}addElevatedRoadFeature(e,t,i,r,n){const o=new Array,s=this.getElevationFeature(e,n);if(s){o.push({polygons:t,elevationFeature:s,elevationTileID:i});for(const t of o)if(t.elevationFeature){if("hd-road-base"===this.elevationMode){this.elevatedStructures||(this.elevatedStructures=new yh(t.elevationTileID));const i=t.elevationFeature.isTunnel();let r=0;e.properties.hasOwnProperty(lh)&&(r=+e.properties[lh]);for(const e of t.polygons)this.elevatedStructures.addPortalCandidates(t.elevationFeature.id,e,i,t.elevationFeature,r)}const n=new Ah(i,t.elevationTileID);this.addElevatedGeometry(t.polygons,n,t.elevationFeature,"hd-road-base"===this.elevationMode?0:.05,r)}}else this.addGeometry(t,this.bufferData)}addElevatedGeometry(e,t,i,r,n){const o={elevation:i,elevationSampler:t,bias:r,index:n},[s,a]=this.addGeometry(e,this.elevationBufferData,o);null==this.elevationBufferData.heightRange?this.elevationBufferData.heightRange={min:s,max:a}:(this.elevationBufferData.heightRange.min=Math.min(this.elevationBufferData.heightRange.min,s),this.elevationBufferData.heightRange.max=Math.max(this.elevationBufferData.heightRange.max,a))}addGeometry(e,t,i){let r=Number.POSITIVE_INFINITY,n=Number.NEGATIVE_INFINITY,o=null;i&&(o=i.elevationSampler.constantElevation(i.elevation,i.bias),null!=o&&(r=o,n=o));const s=(e,s,a)=>{if(null!=i)if(s.push(e),null!=o)t.elevatedLayoutVertexArray.emplaceBack(o),a.push(o);else{const o=i.elevationSampler.pointElevation(e,i.elevation,i.bias);t.elevatedLayoutVertexArray.emplaceBack(o),a.push(o),r=Math.min(r,o),n=Math.max(n,o)}};for(const r of e){let e=0;for(const t of r)e+=t.length;const n=t.triangleSegments.prepareSegment(e,t.layoutVertexArray,t.indexArray),o=n.vertexLength,a=[],l=[],c=[],u=[],h=[],d=t.layoutVertexArray.length;for(const e of r){if(0===e.length)continue;e!==r[0]&&l.push(a.length/2);const n=t.lineSegments.prepareSegment(e.length,t.layoutVertexArray,t.lineIndexArray),o=n.vertexLength;i&&h.push(t.layoutVertexArray.length-d),s(e[0],c,u),t.layoutVertexArray.emplaceBack(e[0].x,e[0].y),t.lineIndexArray.emplaceBack(o+e.length-1,o),a.push(e[0].x),a.push(e[0].y);for(let i=1;i<e.length;i++)s(e[i],c,u),t.layoutVertexArray.emplaceBack(e[i].x,e[i].y),t.lineIndexArray.emplaceBack(o+i-1,o+i),a.push(e[i].x),a.push(e[i].y);n.vertexLength+=e.length,n.primitiveLength+=e.length}const p=yu(a,l);for(let e=0;e<p.length;e+=3)t.indexArray.emplaceBack(o+p[e],o+p[e+1],o+p[e+2]);if(i&&"hd-road-base"===this.elevationMode){const e=i.elevation.isTunnel(),t=i.elevation.safeArea,r=this.elevatedStructures.addVertices(c,u);this.elevatedStructures.addTriangles(p,r,e);const n=h.length;if(n>0){for(let o=0;o<n-1;o++)this.elevatedStructures.addRenderableRing(i.index,h[o]+r,h[o+1]-h[o],e,t);this.elevatedStructures.addRenderableRing(i.index,h[n-1]+r,c.length-h[n-1],e,t)}}n.vertexLength+=e,n.primitiveLength+=p.length/3}return[r,n]}getElevationFeature(e,t){if(!t)return;const i=+e.properties[ah];return null!=i?t.find((e=>e.id===i)):void 0}}let bh,wh,Th,Bh;co(xh,"FillBucket",{omit:["layers","patternFeatures"]}),co(vh,"FillBufferData"),co(yh,"ElevatedStructures");class Ch{constructor(e,t,i,r){if(this.triangleCount=t.length/3,this.min=new V(0,0),this.max=new V(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],0===this.triangleCount||0===e.length)return;const[n,o]=[e[0].clone(),e[0].clone()];for(let t=1;t<e.length;++t){const i=e[t];n.x=Math.min(n.x,i.x),n.y=Math.min(n.y,i.y),o.x=Math.max(o.x,i.x),o.y=Math.max(o.y,i.y)}if(r){const e=Math.ceil(Math.max(o.x-n.x,o.y-n.y)/r);i=Math.max(i,e)}if(0===i)return;this.min=n,this.max=o;const s=this.max.sub(this.min);s.x=Math.max(s.x,1),s.y=Math.max(s.y,1);const a=Math.max(s.x,s.y)/i;this.cellsX=Math.max(1,Math.ceil(s.x/a)),this.cellsY=Math.max(1,Math.ceil(s.y/a)),this.xScale=1/a,this.yScale=1/a;const l=[];for(let i=0;i<this.triangleCount;i++){const r=e[t[3*i+0]].sub(this.min),n=e[t[3*i+1]].sub(this.min),o=e[t[3*i+2]].sub(this.min),s=Sh(Math.floor(Math.min(r.x,n.x,o.x)),this.xScale,this.cellsX),c=Sh(Math.floor(Math.max(r.x,n.x,o.x)),this.xScale,this.cellsX),u=Sh(Math.floor(Math.min(r.y,n.y,o.y)),this.yScale,this.cellsY),h=Sh(Math.floor(Math.max(r.y,n.y,o.y)),this.yScale,this.cellsY),d=new V(0,0),p=new V(0,0),f=new V(0,0),A=new V(0,0);for(let e=u;e<=h;++e){d.y=p.y=e*a,f.y=A.y=(e+1)*a;for(let t=s;t<=c;++t)d.x=f.x=t*a,p.x=A.x=(t+1)*a,(Xl(r,n,o,d,p,A)||Xl(r,n,o,d,A,f))&&l.push({cellIdx:e*this.cellsX+t,triIdx:i})}}if(0===l.length)return;l.sort(((e,t)=>e.cellIdx-t.cellIdx||e.triIdx-t.triIdx));let c=0;for(;c<l.length;){const e=l[c].cellIdx,t={start:this.payload.length,len:0};for(;c<l.length&&l[c].cellIdx===e;)++t.len,this.payload.push(l[c++].triIdx);this.cells[e]=t}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(e,t){if(0===this.triangleCount||0===this.cells.length)return;if(e.x>this.max.x||this.min.x>e.x||e.y>this.max.y||this.min.y>e.y)return;const i=Sh(e.x-this.min.x,this.xScale,this.cellsX),r=Sh(e.y-this.min.y,this.yScale,this.cellsY),n=this.cells[r*this.cellsX+i];if(n){this._lazyInitLookup();for(let e=0;e<n.len;e++){const i=this.payload[n.start+e],r=Math.floor(i/8),o=1<<i%8;if(!(this.lookup[r]&o)&&(this.lookup[r]|=o,t.push(i),t.length===this.triangleCount))return}}}query(e,t,i){if(0===this.triangleCount||0===this.cells.length)return;if(e.x>this.max.x||this.min.x>t.x)return;if(e.y>this.max.y||this.min.y>t.y)return;this._lazyInitLookup();const r=Sh(e.x-this.min.x,this.xScale,this.cellsX),n=Sh(t.x-this.min.x,this.xScale,this.cellsX),o=Sh(e.y-this.min.y,this.yScale,this.cellsY),s=Sh(t.y-this.min.y,this.yScale,this.cellsY);for(let e=o;e<=s;e++)for(let t=r;t<=n;t++){const r=this.cells[e*this.cellsX+t];if(r)for(let e=0;e<r.len;e++){const t=this.payload[r.start+e],n=Math.floor(t/8),o=1<<t%8;if(!(this.lookup[n]&o)&&(this.lookup[n]|=o,i.push(t),i.length===this.triangleCount))return}}}}function Sh(e,t,i){return Math.max(0,Math.min(i-1,Math.floor(e*t)))}co(Ch,"TriangleGridIndex");class Eh{constructor(e){this.zoom=e.zoom,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.fqid)),this.index=e.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id)),this.footprints=[]}updateFootprints(e,t){for(const i of this.footprints)t.push({footprint:i,id:e})}populate(e,t,i,r){const n=[];for(const{feature:t,id:o,index:s,sourceLayerIndex:a}of e){const e=this.layers[0]._featureFilter.needGeometry,l=kl(t,e);if(!this.layers[0]._featureFilter.filter(new Do(this.zoom),l,i))continue;const c={id:o,properties:t.properties,type:t.type,sourceLayerIndex:a,index:s,geometry:e?l.geometry:Fl(t,i,r),patterns:{}};n.push(c)}for(const r of n){const{geometry:n,index:o,sourceLayerIndex:s}=r;this.addFeature(r,n,o,i,{},t.availableImages,t.brightness),t.featureIndex.insert(e[o].feature,n,o,s,this.index)}}isEmpty(){return 0===this.footprints.length}uploadPending(){return!1}upload(e){}update(e,t,i,r,n,o,s){}destroy(){}addFeature(e,t,i,r,n,o=[],s){for(const e of Hu(t,2)){const t=[],i=[],r=[],n=new V(1/0,1/0),o=new V(-1/0,-1/0);for(const s of e)if(0!==s.length){s!==e[0]&&r.push(i.length/2);for(let e=0;e<s.length;e++)i.push(s[e].x),i.push(s[e].y),t.push(s[e]),n.x=Math.min(n.x,s[e].x),n.y=Math.min(n.y,s[e].y),o.x=Math.max(o.x,s[e].x),o.y=Math.max(o.y,s[e].y)}const s=yu(i,r),a=new Ch(t,s,8,256);this.footprints.push({vertices:t,indices:s,grid:a,min:n,max:o})}}}co(Eh,"ClipBucket",{omit:["layers"]});const Mh=vs([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Ih=vs([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),Ph=vs([{name:"a_centroid_pos",components:2,type:"Uint16"}]),Lh=vs([{name:"a_join_normal_inside",components:3,type:"Int16"}]),Fh=vs([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),kh=vs([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:zh}=Mh;class Rh extends V{constructor(e,t,i){super(e,t),this.z=i}}class Dh extends Rh{constructor(e,t,i,r){super(e,t,i),this.w=r}}function Oh(e,t,i,r){const n=[],o=0===r?(e,t,i,r,n,o)=>{e.push(new V(o,i+(o-t)/(r-t)*(n-i)))}:(e,t,i,r,n,o)=>{e.push(new V(t+(o-i)/(n-i)*(r-t),o))};for(const s of e){const e=[];for(const n of s){if(n.length<=2)continue;const s=[];for(let e=0;e<n.length-1;e++){const a=n[e].x,l=n[e].y,c=n[e+1].x,u=n[e+1].y,h=0===r?a:l,d=0===r?c:u;h<t?d>t&&o(s,a,l,c,u,t):h>i?d<i&&o(s,a,l,c,u,i):s.push(n[e]),d<t&&h>=t&&o(s,a,l,c,u,t),d>i&&h<=i&&o(s,a,l,c,u,i)}let a=n[n.length-1];const l=0===r?a.x:a.y;l>=t&&l<=i&&s.push(a),s.length&&(a=s[s.length-1],s[0].x===a.x&&s[0].y===a.y||s.push(s[0]),e.push(s))}e.length&&n.push(e)}return n}function Uh(e,t,i,r){const n="x"===i?"y":"x",o=(r-e[i])/(t[i]-e[i]);e[n]=e[n]+(t[n]-e[n])*o,e[i]=r,e.hasOwnProperty("z")&&(e.z=Et(e.z,t.z,o)),e.hasOwnProperty("w")&&(e.w=Et(e.w,t.w,o))}function Nh(e,t,i,r){const n=i,o=r;for(const i of["x","y"]){let r=e,s=t;r[i]>=s[i]&&(r=t,s=e),r[i]<n&&s[i]>n&&Uh(r,s,i,n),r[i]<o&&s[i]>o&&Uh(s,r,i,o)}}const Qh=Number.MAX_SAFE_INTEGER;function jh(e,t,i,r){return e.order<t||e.order===Qh||!(e.clipMask&i)||function(e,t){return 0!==t.length&&void 0===t.find((t=>t===e))}(r,e.clipScope)}function Vh(e,t){return e.x-t.x||e.y-t.y}function Hh(e,t){return 0===Vh(e.min,t.min)&&0===Vh(e.max,t.max)}function Gh(e,t){return!(e.min.x>t.max.x||e.max.x<t.min.x||e.min.y>t.max.y||e.max.y<t.min.y)}function $h(e,t){if(e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(e[i].sourceId!==t[i].sourceId||!Hh(e[i],t[i])||e[i].order!==t[i].order||e[i].clipMask!==t[i].clipMask||!H(e[i].clipScope,t[i].clipScope))return!1;return!0}function Zh(e,t,i){const r=1/Xi,n=1/(1<<i.canonical.z),o=(t.x*r+i.canonical.x)*n+i.wrap,s=(t.y*r+i.canonical.y)*n;return{min:new V((e.x*r+i.canonical.x)*n+i.wrap,(e.y*r+i.canonical.y)*n),max:new V(o,s)}}function qh(e,t,i){const r=1<<i.canonical.z,n=((t.x-i.wrap)*r-i.canonical.x)*Xi,o=(t.y*r-i.canonical.y)*Xi;return{min:new V(((e.x-i.wrap)*r-i.canonical.x)*Xi,(e.y*r-i.canonical.y)*Xi),max:new V(n,o)}}function Kh(e,t,i,r,n,o,s){const a=e.indices,l=e.vertices,c=[];for(let u=r;u<r+n;u+=3){const r=t[i[u+0]+o],n=t[i[u+1]+o],h=t[i[u+2]+o],d=Math.min(r.x,n.x,h.x),p=Math.max(r.x,n.x,h.x),f=Math.min(r.y,n.y,h.y),A=Math.max(r.y,n.y,h.y);c.length=0,e.grid.query(new V(d,f),new V(p,A),c);for(let e=0;e<c.length;e++){const t=c[e];if(Xl(l[a[3*t+0]],l[a[3*t+1]],l[a[3*t+2]],r,n,h,s))return!0}}return!1}function Wh(e,t,i,r){if(!e||!i)return!1;let n=e.vertices;if(!t.canonical.equals(r.canonical)||t.wrap!==r.wrap){if(i.vertices.length<e.vertices.length)return Wh(i,r,e,t);const o=t.canonical,s=r.canonical,a=Math.pow(2,s.z-o.z);n=e.vertices.map((e=>new V((e.x+o.x*Xi)*a-s.x*Xi,(e.y+o.y*Xi)*a-s.y*Xi)))}return Kh(i,n,e.indices,0,e.indices.length,0,0)}function Xh(e,t,i,r){const n=Math.pow(2,r.z-i.z);return new V((e+i.x*Xi)*n-r.x*Xi,(t+i.y*Xi)*n-r.y*Xi)}function Yh(e,t){const i=[];t.grid.queryPoint(e,i);const r=t.indices,n=t.vertices;for(let t=0;t<i.length;t++){const o=i[t];if(Zl([n[r[3*o+0]],n[r[3*o+1]],n[r[3*o+2]]],e))return!0}return!1}const Jh=[new V(0,0),new V(Xi,0),new V(Xi,Xi),new V(0,Xi)];function ed(e,t){const i=[];let r=[];if(!t||e.length<2)return[e];if(2===e.length)return Kl(e[0],e[1],Jh)?[e]:[];for(let t=0;t<e.length+2;t++){const n=e[t%e.length],o=e[(t+1)%e.length],s=Kl(0===t?e[e.length-1]:e[(t-1)%e.length],n,Jh),a=Kl(n,o,Jh),l=s||a;l&&r.push(n),l&&a||r.length>0&&(r.length>1&&i.push(r),r=[])}return r.length>1&&i.push(r),i}const td=sh.VectorTileFeature.types,id=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],rd=["fill-extrusion-flood-light-ground-radius"],nd=Math.pow(2,13),od=Math.pow(2,15)-1,sd=new V(0,1),ad=2147483648;function ld(e,t,i,r,n,o,s,a){e.emplaceBack((t<<1)+s,(i<<1)+o,(Math.floor(r*nd)<<1)+n,Math.round(a))}function cd(e,t,i){e.emplaceBack(t.x*Xi,t.y*Xi,i?1:0)}function ud(e,t,i,r,n,o){e.emplaceBack(t.x,t.y,(i.x<<1)+r,(i.y<<1)+n,o)}function hd(e,t,i){const r=16384;e.emplaceBack(t.x,t.y,t.z,i[0]*r,i[1]*r,i[2]*r)}class dd{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class pd{constructor(){this.centroidXY=new V(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new V(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new V(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new V(this.max.x-this.min.x,this.max.y-this.min.y)}}class fd{constructor(){this.acc=new V(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,t){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=t.x,e.min.y=e.max.y=t.y)}appendEdge(e,t,i){this.accCount++,this.acc._add(t);let r=!!this.borders;t.x<e.min.x?(e.min.x=t.x,r=!0):t.x>e.max.x&&(e.max.x=t.x,r=!0),t.y<e.min.y?(e.min.y=t.y,r=!0):t.y>e.max.y&&(e.max.y=t.y,r=!0),((0===t.x||t.x===Xi)&&t.x===i.x)!=((0===t.y||t.y===Xi)&&t.y===i.y)&&this.processBorderOverlap(t,i),r&&this.checkBorderIntersection(t,i)}checkBorderIntersection(e,t){t.x<0!=e.x<0&&this.addBorderIntersection(0,Et(t.y,e.y,(0-t.x)/(e.x-t.x))),t.x>Xi!=e.x>Xi&&this.addBorderIntersection(1,Et(t.y,e.y,(Xi-t.x)/(e.x-t.x))),t.y<0!=e.y<0&&this.addBorderIntersection(2,Et(t.x,e.x,(0-t.y)/(e.y-t.y))),t.y>Xi!=e.y>Xi&&this.addBorderIntersection(3,Et(t.x,e.x,(Xi-t.y)/(e.y-t.y)))}addBorderIntersection(e,t){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const i=this.borders[e];t<i[0]&&(i[0]=t),t>i[1]&&(i[1]=t)}processBorderOverlap(e,t){if(e.x===t.x){if(e.y===t.y)return;const i=0===e.x?0:1;this.addBorderIntersection(i,t.y),this.addBorderIntersection(i,e.y)}else{const i=0===e.y?2:3;this.addBorderIntersection(i,t.x),this.addBorderIntersection(i,e.x)}}centroid(){return 0===this.accCount?new V(0,0):new V(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce(((e,t)=>e+ +(t[0]!==Number.MAX_VALUE)),0):0}}function Ad(e,t){const i=e.add(t)._unit(),r=J(e.x*i.x+e.y*i.y,-1,1);var n,o,s;return s=Math.acos(r),Math.min(4,Math.max(-4,Math.tan(s)))/4*od*((n=e).x*(o=t).y-n.y*o.x<0?-1:1)}const md=[e=>e.x<0,e=>e.x>Xi,e=>e.y<0,e=>e.y>Xi];function gd(e,t,i,r){const n=[4];if(0===r)return n;i._mult(r);const o=e.sub(i),s=t.sub(i),a=[e,t,o,s];for(let e=0;e<4;e++)for(const t of a)if(md[e](t)){n.push(e);break}return n}class _d{constructor(e){this.vertexArray=new Es,this.indexArray=new Vs,this.programConfigurations=new Ga(e.layers,{zoom:e.zoom,lut:e.lut},(e=>rd.includes(e))),this._segments=new _a,this.hiddenByLandmarkVertexArray=new ia,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new _a}getDefaultSegment(){return this.regionSegments[4]}hasData(){return 0!==this.vertexArray.length}addData(e,t,i,r=!1){const n=e.length;if(n>2){let o=Math.max(0,this._segments.get().length-1);const s=this._segments._prepareSegment(4*n,this.vertexArray.length,2*this._segmentToGroundQuads[o].length);let a;o!==this._segments.get().length-1&&(o++,this._segmentToGroundQuads[o]=[],this._segmentToRegionTriCounts[o]=[0,0,0,0,0]);{const t=e[0],i=e[1];a=Ad(t.sub(e[n-1])._perp()._unit(),i.sub(t)._perp()._unit())}for(let l=0;l<n;l++){const c=l===n-1?0:l+1,u=e[l],h=e[c],d=e[c===n-1?0:c+1],p=h.sub(u)._perp()._unit(),f=Ad(p,d.sub(h)._perp()._unit()),A=a,m=f;if(wd(u,h,t)||r&&Td(u,t)&&Td(h,t)){a=f;continue}const g=s.vertexLength;ud(this.vertexArray,u,h,1,1,A),ud(this.vertexArray,u,h,1,0,A),ud(this.vertexArray,u,h,0,1,m),ud(this.vertexArray,u,h,0,0,m),s.vertexLength+=4;const _=gd(u,h,p,i);for(const e of _)this._segmentToGroundQuads[o].push({id:g,region:e}),this._segmentToRegionTriCounts[o][e]+=2,s.primitiveLength+=2;a=f}}}prepareBorderSegments(){if(!this.hasData())return;const e=this._segments.get(),t=e.length;for(let e=0;e<t;e++)this._segmentToGroundQuads[e].sort(((e,t)=>e.region-t.region));for(let i=0;i<t;i++){const t=this._segmentToGroundQuads[i],r=e[i],n=this._segmentToRegionTriCounts[i];n.reduce(((e,t)=>e+t),0);let o=0;for(let e=0;e<=4;e++){const t=n[e];if(0!==t){let i=this.regionSegments[e];i||(i=this.regionSegments[e]=new _a);const n={vertexOffset:r.vertexOffset,primitiveOffset:r.primitiveOffset+o,vertexLength:r.vertexLength,primitiveLength:t};i.get().push(n)}o+=t}for(let e=0;e<t.length;e++){const i=t[e].id;this.indexArray.emplaceBack(i,i+1,i+3),this.indexArray.emplaceBack(i,i+3,i+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,t,i,r,n,o){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,t,i,r,n,o)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,Ih.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,t,i,r,n,o,s){this.hasData()&&this.programConfigurations.updatePaintArrays(e,t,i,r,n,o,s)}updateHiddenByLandmark(e){if(!this.hasData())return;const t=e.groundVertexCount+e.groundVertexArrayOffset;if(0===e.groundVertexCount)return;const i=e.flags&ad?1:0;for(let r=e.groundVertexArrayOffset;r<t;++r)this.hiddenByLandmarkVertexArray.emplace(r,i);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,Fh.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){const t=this.regionSegments[e];t&&t.destroy()}}}}class yd{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.pixelRatio=e.pixelRatio,this.layerIds=this.layers.map((e=>e.fqid)),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new Vs,this.footprintVertices=new bs,this.footprintSegments=[],this.layoutVertexArray=new Ts,this.centroidVertexArray=new pa,this.wallVertexArray=new Aa,this.indexArray=new Vs,this.programConfigurations=new Ga(e.layers,{zoom:e.zoom,lut:e.lut},(e=>id.includes(e))),this.segments=new _a,this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id)),this.groundEffect=new _d(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}updateFootprints(e,t){}populate(e,t,i,r){this.features=[],this.hasPattern=Zu("fill-extrusion",this.layers,this.pixelRatio,t),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=Tl(i),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=0!==this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1);for(const{feature:n,id:o,index:s,sourceLayerIndex:a}of e){const e=this.layers[0]._featureFilter.needGeometry,l=kl(n,e);if(!this.layers[0]._featureFilter.filter(new Do(this.zoom),l,i))continue;const c={id:o,sourceLayerIndex:a,index:s,geometry:e?l.geometry:Fl(n,i,r),properties:n.properties,type:n.type,patterns:{}},u=this.layoutVertexArray.length,h="Polygon"===td[c.type];if(this.hasPattern)this.features.push(qu("fill-extrusion",this.layers,c,this.zoom,this.pixelRatio,t));else if(this.wallMode)for(const e of c.geometry)for(const n of ed(e,h))this.addFeature(c,[n],s,i,{},t.availableImages,r,t.brightness);else this.addFeature(c,c.geometry,s,i,{},t.availableImages,r,t.brightness);t.featureIndex.insert(n,c.geometry,s,a,this.index,u)}this.sortBorders(),"mercator"===this.projection.name&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,t,i,r,n,o){for(const e of this.features){const s="Polygon"===td[e.type],{geometry:a}=e;if(this.wallMode)for(const l of a)for(const a of ed(l,s))this.addFeature(e,[a],e.index,t,i,r,n,o);else this.addFeature(e,a,e.index,t,i,r,n,o)}this.sortBorders(),"mercator"===this.projection.name&&this.splitToSubtiles()}update(e,t,i,r,n,o,s){this.programConfigurations.updatePaintArrays(e,t,n,i,r,o,s),this.groundEffect.update(e,t,n,i,r,o,s)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,zh),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.wallVertexBuffer=e.createVertexBuffer(this.wallVertexArray,Lh.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,kh.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,Ph.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,t,i,r,n,o,s,a){const l=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(e,{})/this.tileToMeter,c=[new V(0,0),new V(Xi,Xi)],u=s.projection,h="globe"===u.name,d=this.wallMode||"Polygon"===td[e.type],p=new fd;p.centroidDataIndex=this.centroidData.length;const f=new pd,A=this.layers[0].paint.get("fill-extrusion-base").evaluate(e,{},r)<=0,m=this.layers[0].paint.get("fill-extrusion-height").evaluate(e,{},r);let g;if(f.height=m,f.vertexArrayOffset=this.layoutVertexArray.length,f.groundVertexArrayOffset=this.groundEffect.vertexArray.length,h&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Fs),this.wallMode){if(h)return void de("Non zero fill-extrusion-line-width is not yet supported on globe.");if(1!==t.length)return;g=function(e){const t=e[0].x===e[e.length-1].x&&e[0].y===e[e.length-1].y,i=function(e){let t=0;const i=e.length;for(let r=0;r<i;r++)t+=(e[(r+1)%i].x-e[r].x)*(e[(r+1)%i].y+e[r].y);return t>=0}(e);i||(e=e.reverse());const r={geometry:[],joinNormals:[],indices:[]},n=[],o=[],s=[];let a=e.length;for(;a>=2&&e[a-1].equals(e[a-2]);)a--;if(a<(t?3:2))return r;let l,c,u,h,d,p=0;for(;p<a-1&&e[p].equals(e[p+1]);)p++;t&&(l=e[a-2],d=e[p].sub(l)._unit()._perp());for(let i=p;i<a;i++){if(u=i===a-1?t?e[p+1]:void 0:e[i+1],u&&e[i].equals(u))continue;d&&(h=d),l&&(c=l),l=e[i],d=u?u.sub(l)._unit()._perp():h,h=h||d;let r=h.add(d);0===r.x&&0===r.y||r._unit();const f=r.x*d.x+r.y*d.y,A=0!==f?1/f:1/0,m=h.x*d.y-h.y*d.x>0;let g="miter";const _=2;"miter"===g&&A>_&&(g="bevel"),"bevel"===g&&(A>100&&(g="flipbevel"),A<_&&(g="miter"));const y=(e,t,i,r)=>{const a=new V(e.x,e.y),l=new V(e.x,e.y);a.x+=t.x*r,a.y+=t.y*r,l.x-=t.x*Math.max(i,1),l.y-=t.y*Math.max(i,1),s.push(t),n.push(a),o.push(l)};if("miter"===g)r._mult(A),y(l,r,0,0);else if("flipbevel"===g)r=d.mult(-1),y(l,r,0,0),y(l,r.mult(-1),0,0);else{const e=-Math.sqrt(A*A-1),t=m?e:0,i=m?0:e;c&&y(l,h,t,i),u&&y(l,d,t,i)}}r.geometry=[...n,...o.reverse(),n[0]],r.joinNormals=[...s,...s.reverse(),s[s.length-1]];const f=r.geometry.length-1;for(let e=0;e<f/2;e++)if(e+1<f/2){let t=e,i=e+1,n=f-1-e,o=f-2-e;t=0===t?f-1:t-1,i=0===i?f-1:i-1,n=0===n?f-1:n-1,o=0===o?f-1:o-1,r.indices.push(n),r.indices.push(i),r.indices.push(t),r.indices.push(n),r.indices.push(o),r.indices.push(i)}return r}(t[0]),t=[g.geometry]}const _=(e,t)=>e<(t.length-1)/2||e===t.length-1,y=this.wallMode?[t]:Hu(t,500);for(let e=y.length-1;e>=0;e--){const t=y[e];(0===t.length||(v=t[0]).every((e=>e.x<=0))||v.every((e=>e.x>=Xi))||v.every((e=>e.y<=0))||v.every((e=>e.y>=Xi)))&&y.splice(e,1)}var v;let x;if(h)x=Ed(y,c,r);else{x=[];for(const e of y)x.push({polygon:e,bounds:c})}const b=d?this.edgeRadius:0,w=b>0&&this.zoom<17,T=(e,t)=>{if(0===e.length)return!1;const i=e[e.length-1];return t.x===i.x&&t.y===i.y};for(const{polygon:e,bounds:t}of x){let i=0,n=0;for(const t of e)d&&!t[0].equals(t[t.length-1])&&t.push(t[0]),n+=d?t.length-1:t.length;const o=this.segments.prepareSegment((d?5:4)*n,this.layoutVertexArray,this.indexArray);f.footprintSegIdx<0&&(f.footprintSegIdx=this.footprintSegments.length),f.polygonSegIdx<0&&(f.polygonSegIdx=this.polygonSegments.length);const s={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},a=new dd;if(a.vertexOffset=this.footprintVertices.length,a.indexOffset=3*this.footprintIndices.length,a.ringIndices=[],d){const n=[],s=[];i=o.vertexLength;for(let i=0;i<e.length;i++){const c=e[i];c.length&&0!==i&&s.push(n.length/2);const d=[];let p,f;p=c[1].sub(c[0])._perp()._unit(),a.ringIndices.push(c.length-1);for(let e=1;e<c.length;e++){const t=c[e],i=c[e===c.length-1?1:e+1],s=t.clone();if(b){f=i.sub(t)._perp()._unit();const e=p.add(f)._unit(),r=b*Math.min(4,1/(p.x*e.x+p.y*e.y));s.x+=r*e.x,s.y+=r*e.y,s.x=Math.round(s.x),s.y=Math.round(s.y),p=f}if(!A||0!==b&&!w||T(d,s)||d.push(s),ld(this.layoutVertexArray,s.x,s.y,0,0,1,1,0),this.wallMode){const t=_(e,c);cd(this.wallVertexArray,g.joinNormals[e],!t)}o.vertexLength++,this.footprintVertices.emplaceBack(t.x,t.y),n.push(t.x,t.y),h&&hd(this.layoutVertexExtArray,u.projectTilePoint(s.x,s.y,r),u.upVector(r,s.x,s.y))}A&&(0===b||w)&&(0!==d.length&&T(d,d[0])&&d.pop(),this.groundEffect.addData(d,t,l))}const c=this.wallMode?g.indices:yu(n,s);for(let e=0;e<c.length;e+=3)this.footprintIndices.emplaceBack(a.vertexOffset+c[e+0],a.vertexOffset+c[e+1],a.vertexOffset+c[e+2]),this.indexArray.emplaceBack(i+c[e],i+c[e+2],i+c[e+1]),o.primitiveLength++;a.indexCount+=c.length,a.vertexCount+=this.footprintVertices.length-a.vertexOffset}for(let n=0;n<e.length;n++){const s=e[n];p.startRing(f,s[0]);let a=s.length>4&&Bd(s[s.length-2],s[0],s[1]),c=b?xd(s[s.length-2],s[0],s[1],b):0;const m=[];let y,v,x;v=s[1].sub(s[0])._perp()._unit();let w=!0;for(let e=1,n=0;e<s.length;e++){let l=s[e-1],d=s[e];const B=s[e===s.length-1?1:e+1];if(p.appendEdge(f,d,l),wd(d,l,t)){b&&(v=B.sub(d)._perp()._unit(),w=!w);continue}const C=d.sub(l)._perp(),S=C.x/(Math.abs(C.x)+Math.abs(C.y)),E=C.y>0?1:0,M=l.dist(d);if(n+M>32768&&(n=0),b){x=B.sub(d)._perp()._unit();let e=bd(l,d,B,vd(v,x),b);isNaN(e)&&(e=0);const t=d.sub(l)._unit();l=l.add(t.mult(c))._round(),d=d.add(t.mult(-e))._round(),c=e,v=x,A&&this.zoom>=17&&(T(m,l)||m.push(l),T(m,d)||m.push(d))}const I=o.vertexLength,P=s.length>4&&Bd(l,d,B);let L=Cd(n,a,w);if(ld(this.layoutVertexArray,l.x,l.y,S,E,0,0,L),ld(this.layoutVertexArray,l.x,l.y,S,E,0,1,L),this.wallMode){const t=_(e-1,s),i=g.joinNormals[e-1];cd(this.wallVertexArray,i,t),cd(this.wallVertexArray,i,t)}if(n+=M,L=Cd(n,P,!w),a=P,ld(this.layoutVertexArray,d.x,d.y,S,E,0,0,L),ld(this.layoutVertexArray,d.x,d.y,S,E,0,1,L),this.wallMode){const t=_(e,s),i=g.joinNormals[e];cd(this.wallVertexArray,i,t),cd(this.wallVertexArray,i,t)}if(o.vertexLength+=4,this.indexArray.emplaceBack(I+0,I+1,I+2),this.indexArray.emplaceBack(I+1,I+3,I+2),o.primitiveLength+=2,b){const r=i+(1===e?s.length-2:e-2),n=1===e?i:r+1;if(this.indexArray.emplaceBack(I+1,r,I+3),this.indexArray.emplaceBack(r,n,I+3),o.primitiveLength+=2,void 0===y&&(y=I),!wd(B,s[e],t)){const t=e===s.length-1?y:o.vertexLength;this.indexArray.emplaceBack(I+2,I+3,t),this.indexArray.emplaceBack(I+3,t+1,t),this.indexArray.emplaceBack(I+3,n,t+1),o.primitiveLength+=3}w=!w}if(h){const e=this.layoutVertexExtArray,t=u.projectTilePoint(l.x,l.y,r),i=u.projectTilePoint(d.x,d.y,r),n=u.upVector(r,l.x,l.y),o=u.upVector(r,d.x,d.y);hd(e,t,n),hd(e,t,n),hd(e,i,o),hd(e,i,o)}}d&&(i+=s.length-1),A&&b&&this.zoom>=17&&(0!==m.length&&T(m,m[0])&&m.pop(),this.groundEffect.addData(m,t,l,b>0))}this.footprintSegments.push(a),s.triangleCount=this.indexArray.length-s.triangleArrayOffset,this.polygonSegments.push(s),++f.footprintSegLen,++f.polygonSegLen}if(f.vertexCount=this.layoutVertexArray.length-f.vertexArrayOffset,f.groundVertexCount=this.groundEffect.vertexArray.length-f.groundVertexArrayOffset,0!==f.vertexCount){if(f.centroidXY=p.borders?sd:this.encodeCentroid(p,f),this.centroidData.push(f),p.borders){this.featuresOnBorder.push(p);const e=this.featuresOnBorder.length-1;for(let t=0;t<p.borders.length;t++)p.borders[t][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[t].push(e)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,n,o,r,a),this.groundEffect.addPaintPropertiesData(e,i,n,o,r,a),this.maxHeight=Math.max(this.maxHeight,m)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort(((t,i)=>this.featuresOnBorder[t].borders[e][0]-this.featuresOnBorder[i].borders[e][0]))}splitToSubtiles(){const e=[];for(let t=0;t<this.centroidData.length;t++){const i=this.centroidData[t],r=+(i.min.y+i.max.y>Xi),n=2*r+(+(i.min.x+i.max.x>Xi)^r);for(let r=0;r<i.polygonSegLen;r++){const o=i.polygonSegIdx+r;e.push({centroidIdx:t,subtile:n,polygonSegmentIdx:o,triangleSegmentIdx:this.polygonSegments[o].triangleSegIdx})}}const t=new Vs;e.sort(((e,t)=>e.triangleSegmentIdx===t.triangleSegmentIdx?e.subtile-t.subtile:e.triangleSegmentIdx-t.triangleSegmentIdx));let i=0,r=0,n=0;for(const t of e){if(t.triangleSegmentIdx!==i)break;n++}const o=e.length;for(;r!==e.length;){i=e[r].triangleSegmentIdx;let s=0,a=r,l=r;for(let t=a;t<n&&e[t].subtile===s;t++)l++;for(;a!==n;){const r=e[a];s=r.subtile;const o=this.centroidData[r.centroidIdx].min.clone(),c=this.centroidData[r.centroidIdx].max.clone(),u={vertexOffset:this.segments.segments[i].vertexOffset,primitiveOffset:t.length,vertexLength:this.segments.segments[i].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let i=a;i<l;i++){const r=e[i],n=this.polygonSegments[r.polygonSegmentIdx],s=this.centroidData[r.centroidIdx].min,a=this.centroidData[r.centroidIdx].max,l=this.indexArray.uint16;for(let e=n.triangleArrayOffset;e<n.triangleArrayOffset+n.triangleCount;e++)t.emplaceBack(l[3*e],l[3*e+1],l[3*e+2]);u.primitiveLength+=n.triangleCount,o.x=Math.min(o.x,s.x),o.y=Math.min(o.y,s.y),c.x=Math.max(c.x,a.x),c.y=Math.max(c.y,a.y)}u.primitiveLength>0&&this.triangleSubSegments.push({segment:u,min:o,max:c}),a=l;for(let t=a;t<n&&e[t].subtile===e[a].subtile;t++)l++}r=n;for(let t=r;t<o&&e[t].triangleSegmentIdx===e[r].triangleSegmentIdx;t++)n++}t._trim(),this.indexArray=t}getVisibleSegments(e,t,i){const r=new _a;if(this.wallMode){for(const e of this.triangleSubSegments)r.segments.push(e.segment);return r}let n=0,o=0;const s=1<<e.canonical.z;if(t){const i=t.getMinMaxForTile(e);i&&(n=i.min,o=i.max)}o+=this.maxHeight;const a=e.toUnwrapped();let l;const c=[a.canonical.x/s+a.wrap,a.canonical.y/s],u=[(a.canonical.x+1)/s+a.wrap,(a.canonical.y+1)/s],h=(e,t,i)=>[e[0]*(1-i[0])+t[0]*i[0],e[1]*(1-i[1])+t[1]*i[1]],d=[],p=[];for(const e of this.triangleSubSegments){d[0]=e.min.x/Xi,d[1]=e.min.y/Xi,p[0]=e.max.x/Xi,p[1]=e.max.y/Xi;const t=h(c,u,d),s=h(c,u,p);if(0===new Tc([t[0],t[1],n],[s[0],s[1],o]).intersectsPrecise(i)){l&&(r.segments.push(l),l=void 0);continue}const a=e.segment;l&&l.vertexOffset!==a.vertexOffset&&(r.segments.push(l),l=void 0),l?(l.vertexLength+=a.vertexLength,l.primitiveLength+=a.primitiveLength):l={vertexOffset:a.vertexOffset,primitiveLength:a.primitiveLength,vertexLength:a.vertexLength,primitiveOffset:a.primitiveOffset,sortKey:void 0,vaos:{}}}return l&&r.segments.push(l),r}encodeCentroid(e,t){const i=e.centroid(),r=t.span(),n=Math.min(7,Math.round(r.x*this.tileToMeter/10)),o=Math.min(7,Math.round(r.y*this.tileToMeter/10));return new V(J(i.x,1,Xi-1)<<3|n,J(i.y,1,Xi-1)<<3|o)}encodeBorderCentroid(e){if(!e.borders)return new V(0,0);const t=e.borders,i=Number.MAX_VALUE;if(t[0][0]!==i||t[1][0]!==i){const e=t[0][0]!==i?0:1;return new V(6|(t[0][0]!==i?0:65528),(t[e][0]+t[e][1])/2<<3|6)}{const e=t[2][0]!==i?2:3;return new V((t[e][0]+t[e][1])/2<<3|6,6|(t[2][0]!==i?0:65528))}}showCentroid(e){const t=this.centroidData[e.centroidDataIndex];t.flags&=ad,t.centroidXY.x=0,t.centroidXY.y=0,this.writeCentroidToBuffer(t)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);const t=e.vertexArrayOffset,i=e.vertexCount+e.vertexArrayOffset,r=e.flags&ad?sd:e.centroidXY,n=this.centroidVertexArray.geta_centroid_pos0(t);if(this.centroidVertexArray.geta_centroid_pos1(t)!==r.y||n!==r.x){for(let e=t;e<i;++e)this.centroidVertexArray.emplace(e,r.x,r.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,t,i){if(t.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=t.updateTime;const r=t.getReplacementRegionsForTile(e.toUnwrapped());if($h(this.activeReplacements,r))return;if(this.activeReplacements=r,0===this.centroidVertexArray.length)this.createCentroidsBuffer();else for(const e of this.centroidData)e.flags&=2147483647;const n=[];for(const t of this.activeReplacements){if(t.order<i)continue;const r=Math.max(1,Math.pow(2,t.footprintTileId.canonical.z-e.canonical.z));for(const i of this.centroidData)if(!(i.flags&ad||t.min.x>i.max.x||i.min.x>t.max.x||t.min.y>i.max.y||i.min.y>t.max.y))for(let o=0;o<i.footprintSegLen;o++){const s=this.footprintSegments[i.footprintSegIdx+o];if(n.length=0,Md(this.footprintVertices,s.vertexOffset,s.vertexCount,t.footprintTileId.canonical,e.canonical,n),Kh(t.footprint,n,this.footprintIndices.uint16,s.indexOffset,s.indexCount,-s.vertexOffset,-r)){i.flags|=ad;break}}}for(const e of this.centroidData)this.writeCentroidToBuffer(e);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,t,i){let r=!1;for(let n=0;n<i.footprintSegLen;n++){const o=this.footprintSegments[i.footprintSegIdx+n];let s=0;for(const i of o.ringIndices){for(let n=s,a=i+s-1;n<i+s;a=n++){const i=this.footprintVertices.int16[2*(n+o.vertexOffset)+0],s=this.footprintVertices.int16[2*(n+o.vertexOffset)+1],l=this.footprintVertices.int16[2*(a+o.vertexOffset)+1];s>t!=l>t&&e<(this.footprintVertices.int16[2*(a+o.vertexOffset)+0]-i)*(t-s)/(l-s)+i&&(r=!r)}s=i}}return r}getHeightAtTileCoord(e,t){let i=Number.NEGATIVE_INFINITY,r=!0;const n=4*(e+Xi)*Xi+(t+Xi);if(this.partLookup.hasOwnProperty(n)){const e=this.partLookup[n];return e?{height:e.height,hidden:!!(e.flags&ad)}:void 0}for(const o of this.centroidData)e>o.max.x||o.min.x>e||t>o.max.y||o.min.y>t||this.footprintContainsPoint(e,t,o)&&o&&o.height>i&&(i=o.height,this.partLookup[n]=o,r=!!(o.flags&ad));if(i!==Number.NEGATIVE_INFINITY)return{height:i,hidden:r};this.partLookup[n]=void 0}}function vd(e,t){const i=e.add(t)._unit();return e.x*i.x+e.y*i.y}function xd(e,t,i,r){const n=t.sub(e)._perp()._unit(),o=i.sub(t)._perp()._unit();return bd(e,t,i,vd(n,o),r)}function bd(e,t,i,r,n){const o=Math.sqrt(1-r*r);return Math.min(e.dist(t)/3,t.dist(i)/3,n*o/r)}function wd(e,t,i){return e.x<i[0].x&&t.x<i[0].x||e.x>i[1].x&&t.x>i[1].x||e.y<i[0].y&&t.y<i[0].y||e.y>i[1].y&&t.y>i[1].y}function Td(e,t){return e.x<t[0].x||e.x>t[1].x||e.y<t[0].y||e.y>t[1].y}function Bd(e,t,i){if(e.x<0||e.x>=Xi||t.x<0||t.x>=Xi||i.x<0||i.x>=Xi)return!1;const r=i.sub(t),n=r.perp(),o=e.sub(t);return(r.x*o.x+r.y*o.y)/Math.sqrt((r.x*r.x+r.y*r.y)*(o.x*o.x+o.y*o.y))>-.866&&n.x*o.x+n.y*o.y<0}function Cd(e,t,i){const r=t?2|e:-3&e;return i?1|r:-2&r}function Sd(){const e=Math.PI/32,t=Math.tan(e),i=al;return i*Math.sqrt(1+2*t*t)-i}function Ed(e,t,i){const r=1<<i.z,n=gl(i.x/r),o=gl((i.x+1)/r),s=_l(i.y/r),a=_l((i.y+1)/r);return function(e,t,i,r,n=0,o){const s=[];if(!e.length||!i||!r)return s;const a=(e,t)=>{for(const i of e)s.push({polygon:i,bounds:t})},l=Math.ceil(Math.log2(i)),c=Math.ceil(Math.log2(r)),u=l-c,h=[];for(let e=0;e<Math.abs(u);e++)h.push(u>0?0:1);for(let e=0;e<Math.min(l,c);e++)h.push(0),h.push(1);let d=e;if(d=Oh(d,t[0].y-n,t[1].y+n,1),d=Oh(d,t[0].x-n,t[1].x+n,0),!d.length)return s;const p=[];for(h.length?p.push({polygons:d,bounds:t,depth:0}):a(d,t);p.length;){const e=p.pop(),t=e.depth,i=h[t],r=e.bounds[0],s=e.bounds[1],l=0===i?r.x:r.y,c=0===i?s.x:s.y,u=o?o(i,l,c):.5*(l+c),d=Oh(e.polygons,l-n,u+n,i),f=Oh(e.polygons,u-n,c+n,i);if(d.length){const e=[r,new V(0===i?u:s.x,1===i?u:s.y)];h.length>t+1?p.push({polygons:d,bounds:e,depth:t+1}):a(d,e)}if(f.length){const e=[new V(0===i?u:r.x,1===i?u:r.y),s];h.length>t+1?p.push({polygons:f,bounds:e,depth:t+1}):a(f,e)}}return s}(e,t,Math.ceil((o-n)/11.25),Math.ceil((s-a)/11.25),1,((e,t,n)=>{if(0===e)return.5*(t+n);{const e=_l((i.y+t/Xi)/r);return(Al(.5*(_l((i.y+n/Xi)/r)+e))*r-i.y)*Xi}}))}function Md(e,t,i,r,n,o){const s=Math.pow(2,r.z-n.z);for(let a=0;a<i;a++){let i=e.int16[2*(a+t)+0],l=e.int16[2*(a+t)+1];i=(i+n.x*Xi)*s-r.x*Xi,l=(l+n.y*Xi)*s-r.y*Xi,o.push(new V(i,l))}}let Id,Pd;function Ld(e,t){return e.x*t.x+e.y*t.y}function Fd(e,t){if(1===e.length){let i=0;const r=t[i++];let n;for(;!n||r.equals(n);)if(n=t[i++],!n)return 1/0;for(;i<t.length;i++){const o=t[i],s=e[0],a=n.sub(r),l=o.sub(r),c=s.sub(r),u=Ld(a,a),h=Ld(a,l),d=Ld(l,l),p=Ld(c,a),f=Ld(c,l),A=u*d-h*h,m=(d*p-h*f)/A,g=(u*f-h*p)/A,_=r.z*(1-m-g)+n.z*m+o.z*g;if(isFinite(_))return _}return 1/0}{let e=1/0;for(const i of t)e=Math.min(e,i.z);return e}}function kd(e,t,i,r,n,o,s,a){const l=s*n.getElevationAt(e,t,!0,!0),c=0!==o[0],u=c?0===o[1]?s*(o[0]/7-450):s*function(e,t,i){const r=Math.floor(t[0]/8),n=Math.floor(t[1]/8),o=10*(t[0]-8*r),s=10*(t[1]-8*n),a=e.getElevationAt(r,n,!0,!0),l=e.getMeterToDEM(i),c=Math.floor(.5*(o*l-1)),u=Math.floor(.5*(s*l-1)),h=e.tileCoordToPixel(r,n),d=2*c+1,p=2*u+1,f=function(e,t,i,r,n){return[e.getElevationAtPixel(t,i,!0),e.getElevationAtPixel(t+n,i,!0),e.getElevationAtPixel(t,i+n,!0),e.getElevationAtPixel(t+r,i+n,!0)]}(e,h.x-c,h.y-u,d,p),A=Math.abs(f[0]-f[1]),m=Math.abs(f[2]-f[3]),g=Math.abs(f[0]-f[2])+Math.abs(f[1]-f[3]),_=Math.min(.25,.5*l*(A+m)/d),y=Math.min(.25,.5*l*g/p);return a+Math.max(_*o,y*s)}(n,o,a):l;return{base:l+(0===i?-1:i),top:c?Math.max(u+r,l+i+2):l+r}}co(yd,"FillExtrusionBucket",{omit:["layers","features"]}),co(pd,"PartData"),co(dd,"FootprintSegment"),co(fd,"BorderCentroidData"),co(_d,"GroundEffect");const zd=vs([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),Rd=vs([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:Dd}=zd,Od=vs([{name:"a_packed",components:3,type:"Float32"}]),{members:Ud}=Od,Nd=vs([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:Qd}=Nd;class jd{constructor(e,t){this.width=e,this.height=t,this.nextRow=0,this.image=new hu({width:e,height:t}),this.positions={},this.uploaded=!1}getDash(e,t){const i=this.getKey(e,t);return this.positions[i]}trim(){const e=this.width,t=this.height=se(this.nextRow);this.image.resize({width:e,height:t})}getKey(e,t){return e.join(",")+t}getDashRanges(e,t,i){const r=[];let n=e.length%2==1?-e[e.length-1]*i:0,o=e[0]*i,s=!0;r.push({left:n,right:o,isDash:s,zeroLength:0===e[0]});let a=e[0];for(let t=1;t<e.length;t++){s=!s;const l=e[t];n=a*i,a+=l,o=a*i,r.push({left:n,right:o,isDash:s,zeroLength:0===l})}return r}addRoundDash(e,t,i){const r=t/2;for(let t=-i;t<=i;t++){const n=this.width*(this.nextRow+i+t);let o=0,s=e[o];for(let a=0;a<this.width;a++){a/s.right>1&&(s=e[++o]);const l=Math.abs(a-s.left),c=Math.abs(a-s.right),u=Math.min(l,c);let h;const d=t/i*(r+1);if(s.isDash){const e=r-Math.abs(d);h=Math.sqrt(u*u+e*e)}else h=r-Math.sqrt(u*u+d*d);this.image.data[n+a]=Math.max(0,Math.min(255,h+128))}}}addRegularDash(e,t){for(let t=e.length-1;t>=0;--t){const i=e[t],r=e[t+1];i.zeroLength?e.splice(t,1):r&&r.isDash===i.isDash&&(r.left=i.left,e.splice(t,1))}const i=e[0],r=e[e.length-1];i.isDash===r.isDash&&(i.left=r.left-this.width,r.right=i.right+this.width);const n=this.width*this.nextRow;let o=0,s=e[o];for(let i=0;i<this.width;i++){i/s.right>1&&(s=e[++o]);const r=Math.abs(i-s.left),a=Math.abs(i-s.right),l=Math.min(r,a);this.image.data[n+i]=Math.max(0,Math.min(255,(s.isDash?l:-l)+t+128))}}addDash(e,t){const i=this.getKey(e,t);if(this.positions[i])return this.positions[i];const r="round"===t,n=r?7:0,o=2*n+1;if(this.nextRow+o>this.height)return de("LineAtlas out of space"),null;0===e.length&&e.push(1);let s=0;for(let t=0;t<e.length;t++)e[t]<0&&(de("Negative value is found in line dasharray, replacing values with 0"),e[t]=0),s+=e[t];if(0!==s){const i=this.width/s,o=this.getDashRanges(e,this.width,i);r?this.addRoundDash(o,i,n):this.addRegularDash(o,"square"===t?.5*i:0)}const a=this.nextRow+n;this.nextRow+=o;const l={tl:[a,n],br:[s,0]};return this.positions[i]=l,l}}co(jd,"LineAtlas");const Vd=sh.VectorTileFeature.types,Hd=Math.cos(Math.PI/180*37.5),Gd=Math.cos(Math.PI/180*5);class $d{constructor(e){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.zoom=e.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=e.overscaling,this.pixelRatio=e.pixelRatio,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.fqid)),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.hasZOffset=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((e=>{this.gradients[e.id]={}})),this.layoutVertexArray=new Ms,this.layoutVertexArray2=new Is,this.patternVertexArray=new Is,this.indexArray=new Vs,this.programConfigurations=new Ga(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new _a,this.maxLineLength=0,this.zOffsetVertexArray=new Is,this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id)),this.tessellationStep=e.tessellationStep?e.tessellationStep:Xi/64}updateFootprints(e,t){}populate(e,t,i,r){this.hasPattern=Zu("line",this.layers,this.pixelRatio,t);const n=this.layers[0].layout.get("line-sort-key");this.tileToMeter=Tl(i);const o=this.layers[0].layout.get("line-z-offset"),s=o.isConstant()&&!o.constantOr(0),a=this.layers[0].layout.get("line-elevation-reference");this.hasZOffset="sea"===a||"ground"===a||!s&&"none"===a,this.hasZOffset&&"none"===a&&de(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`);const l=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.hasZOffset&&void 0!==l;const c=[];for(const{feature:t,id:o,index:s,sourceLayerIndex:a}of e){const e=this.layers[0]._featureFilter.needGeometry,l=kl(t,e);if(!this.layers[0]._featureFilter.filter(new Do(this.zoom),l,i))continue;const u=n?n.evaluate(l,{},i):void 0,h={id:o,properties:t.properties,type:t.type,sourceLayerIndex:a,index:s,geometry:e?l.geometry:Fl(t,i,r),patterns:{},sortKey:u};c.push(h)}n&&c.sort(((e,t)=>e.sortKey-t.sortKey));const{lineAtlas:u,featureIndex:h}=t,d=this.addConstantDashes(u);for(const r of c){const{geometry:n,index:o,sourceLayerIndex:s}=r;if(d&&this.addFeatureDashes(r,u),this.hasPattern){const e=qu("line",this.layers,r,this.zoom,this.pixelRatio,t);this.patternFeatures.push(e)}else this.addFeature(r,n,o,i,u.positions,t.availableImages,t.brightness);h.insert(e[o].feature,n,o,s,this.index)}}addConstantDashes(e){let t=!1;for(const i of this.layers){const r=i.paint.get("line-dasharray").value,n=i.layout.get("line-cap").value;if("constant"!==r.kind||"constant"!==n.kind)t=!0;else{const t=n.value,i=r.value;if(!i)continue;e.addDash(i,t)}}return t}addFeatureDashes(e,t){const i=this.zoom;for(const r of this.layers){const n=r.paint.get("line-dasharray").value,o=r.layout.get("line-cap").value;if("constant"===n.kind&&"constant"===o.kind)continue;let s,a;if("constant"===n.kind){if(s=n.value,!s)continue}else s=n.evaluate({zoom:i},e);a="constant"===o.kind?o.value:o.evaluate({zoom:i},e),t.addDash(s,a),e.patterns[r.id]=t.getKey(s,a)}}update(e,t,i,r,n,o,s){this.programConfigurations.updatePaintArrays(e,t,n,i,r,o,s)}addFeatures(e,t,i,r,n,o){for(const e of this.patternFeatures)this.addFeature(e,e.geometry,e.index,t,i,r,o)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,Ud)),0!==this.patternVertexArray.length&&(this.patternVertexBuffer=e.createVertexBuffer(this.patternVertexArray,Qd)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,Rd.members,!0)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Dd),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,t,i,r,n,o,s){const a=this.layers[0].layout,l=a.get("line-join").evaluate(e,{}),c=a.get("line-cap").evaluate(e,{}),u=a.get("line-miter-limit"),h=a.get("line-round-limit");this.lineClips=this.lineFeatureClips(e),this.lineFeature=e,this.zOffsetValue=a.get("line-z-offset").value;const d=this.layers[0].paint.get("line-width").value;"constant"!==d.kind&&!1===d.isLineProgressConstant&&(this.variableWidthValue=d);for(const i of t)this.addLine(i,e,r,l,c,u,h);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,n,o,r,s)}addLine(e,t,i,r,n,o,s){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0;const a="none"===r;if(this.patternJoinNone=this.hasPattern&&a,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[],this.lineClips){this.lineClipsArray.push(this.lineClips);for(let t=0;t<e.length-1;t++)this.totalDistance+=e[t].dist(e[t+1]);this.totalFeatureLength=this.totalDistance/(this.lineClips.end-this.lineClips.start),this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const l="Polygon"===Vd[t.type];let c=e.length;for(;c>=2&&e[c-1].equals(e[c-2]);)c--;let u=0;for(;u<c-1&&e[u].equals(e[u+1]);)u++;if(c<(l?3:2))return;"bevel"===r&&(o=1.05);const h=this.segments.prepareSegment(10*c,this.layoutVertexArray,this.indexArray);let d,p,f,A,m,g;this.e1=this.e2=-1,l&&(d=e[c-2],m=e[u].sub(d)._unit()._perp());for(let t=u;t<c;t++){if(f=t===c-1?l?e[u+1]:void 0:e[t+1],f&&e[t].equals(f))continue;m&&(A=m),d&&(p=d),d=e[t],g=this.evaluateLineProgressFeatures(p?p.dist(d):0),m=f?f.sub(d)._unit()._perp():A,A=A||m;const i=p&&f;let _=i?r:l||a?"butt":n;const y=A.x*m.x+A.y*m.y;if(a){const e=function(e){if(e.patternJoinNone){const t=e.segmentPoints.length/2,i=e.lineSoFar-e.segmentStart;for(let r=0;r<t;++r){const t=e.segmentPoints[2*r+1],n=Math.round(e.segmentPoints[2*r])+.5+.25*t;e.patternVertexArray.emplaceBack(n,i,e.segmentStart),e.patternVertexArray.emplaceBack(n,i,e.segmentStart)}e.segmentPoints.length=0}e.e1=e.e2=-1};if(i&&y<Gd){this.updateDistance(p,d),this.addCurrentVertex(d,A,1,1,h,g),e(this),this.addCurrentVertex(d,m,-1,-1,h,g);continue}if(p){if(!f){this.updateDistance(p,d),this.addCurrentVertex(d,A,1,1,h,g),e(this);continue}_="miter"}}let v=A.add(m);0===v.x&&0===v.y||v._unit();const x=v.x*m.x+v.y*m.y,b=0!==x?1/x:1/0,w=2*Math.sqrt(2-2*x),T=x<Hd&&p&&f,B=A.x*m.y-A.y*m.x>0,C=this.overscaling<=16?15*Xi/(512*this.overscaling):0;if(i&&"round"===_)if(b<s)_="miter";else if(b<=2){const e=Zd(d,-10,Xi+10);_=this.hasZOffset&&(e||this.hasCrossSlope)?"miter":"fakeround"}if("miter"===_&&b>o&&(_="bevel"),"bevel"===_&&(b>2&&(_="flipbevel"),b<o&&(_="miter")),p&&!("miter"===_&&T)&&this.updateDistance(p,d),"miter"===_)if(T){const e=d.dist(p);if(e>2*C){const t=d.sub(d.sub(p)._mult(C/e)._round());this.updateDistance(p,t),this.addCurrentVertex(t,A,0,0,h,g),p=t}this.updateDistance(p,d),v._mult(b),this.addCurrentVertex(d,v,0,0,h,g);const t=d.dist(f);if(t>2*C){const e=d.add(f.sub(d)._mult(C/t)._round());this.updateDistance(d,e),this.addCurrentVertex(e,m,0,0,h,g),d=e}}else v._mult(b),this.addCurrentVertex(d,v,0,0,h,g);else if("flipbevel"===_){if(b>100)v=m.mult(-1);else{const e=b*A.add(m).mag()/A.sub(m).mag();v._perp()._mult(e*(B?-1:1))}this.addCurrentVertex(d,v,0,0,h,g),this.addCurrentVertex(d,v.mult(-1),0,0,h,g)}else if("bevel"===_||"fakeround"===_){null!=g&&p&&this.addCurrentVertex(d,A,-1,-1,h,g);const e=d.dist(p)<=2*C&&"bevel"!==_,t=v.mult(B?1:-1);t._mult(b);const i=m.mult(B?-1:1),r=A.mult(B?-1:1),n=this.evaluateLineProgressFeatures(this.distance);if(null==g&&(this.addHalfVertex(d,t.x,t.y,!1,!B,0,h,n),e||this.addHalfVertex(d,t.x+2*r.x,t.y+2*r.y,!1,B,0,h,n)),"fakeround"===_){const e=Math.round(180*w/Math.PI/20);this.addHalfVertex(d,r.x,r.y,!1,B,0,h,n);for(let t=0;t<e;t++){let o=t/e;if(.5!==o){const e=o-.5;o+=o*e*(o-1)*((1.0904+y*(y*(3.55645-1.43519*y)-3.2452))*e*e+(.848013+y*(.215638*y-1.06021)))}const s=i.sub(r)._mult(o)._add(r)._unit();this.addHalfVertex(d,s.x,s.y,!1,B,0,h,n)}this.addHalfVertex(d,i.x,i.y,!1,B,0,h,n)}e||null!=g||this.addHalfVertex(d,t.x+2*i.x,t.y+2*i.y,!1,B,0,h,n),null!=g&&f&&this.addCurrentVertex(d,m,1,1,h,g)}else"butt"===_?this.addCurrentVertex(d,v,0,0,h,g):"square"===_?(p||this.addCurrentVertex(d,v,-1,-1,h,g),this.addCurrentVertex(d,v,0,0,h,g),p&&this.addCurrentVertex(d,v,1,1,h,g)):"round"===_&&(p&&(this.addCurrentVertex(d,A,0,0,h,g),this.addCurrentVertex(d,A,1,1,h,g,!0)),f&&(this.addCurrentVertex(d,m,-1,-1,h,g,!0),this.addCurrentVertex(d,m,0,0,h,g)))}}addVerticesTo(e,t,i,r,n,o,s,a,l,c){const u=(t.w-e.w)/this.tessellationStep|0;let h=0;const d=this.scaledDistance;if(u>1){this.lineSoFar=e.w;const d=(t.x-e.x)/u,p=(t.y-e.y)/u,f=(t.z-e.z)/u,A=(t.w-e.w)/u;for(let t=1;t<u;++t){e.x+=d,e.y+=p,e.z+=f,this.lineSoFar+=A,h+=A;const t=this.evaluateLineProgressFeatures(this.prevDistance+h);this.scaledDistance=(this.prevDistance+h)/this.totalDistance,this.addHalfVertex(e,i,r,c,!1,s,l,t),this.addHalfVertex(e,n,o,c,!0,-a,l,t)}}this.lineSoFar=t.w,this.scaledDistance=d;const p=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(t,i,r,c,!1,s,l,p),this.addHalfVertex(t,n,o,c,!0,-a,l,p)}evaluateLineProgressFeatures(e){if(!this.variableWidthValue&&!this.hasZOffset)return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+e)/this.totalFeatureLength):de(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let t=0;return this.variableWidthValue&&"constant"!==this.variableWidthValue.kind&&(t=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.hasZOffset?"constant"===this.zOffsetValue.kind?{zOffset:this.zOffsetValue.value,variableWidth:t}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:t}:{zOffset:0,variableWidth:t}}addCurrentVertex(e,t,i,r,n,o,s=!1){const a=t.x+t.y*i,l=t.y-t.x*i,c=t.y*r-t.x,u=-t.y-t.x*r;if(null!=o){const t=this.hasZOffset,h=-10,d=Xi+10,p=o.zOffset,f=new Dh(e.x,e.y,p,this.lineSoFar),A=!!t&&Zd(e,h,d),m=this.lineSoFar,g=this.distance;if(this.currentVertex)if(A){const t=this.currentVertexIsOutside,o=this.currentVertex,A=new Dh(e.x,e.y,p,this.lineSoFar);if(Nh(o,A,h,d),!Zd(A,h,d)){if(t){this.e1=this.e2=-1,this.distance-=o.dist(f),this.lineSoFar=o.w;const e=this.evaluateLineProgressFeatures(o.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(o,a,l,s,!1,i,n,e),this.addHalfVertex(o,c,u,s,!0,-r,n,e),this.prevDistance=this.distance}this.distance=this.prevDistance+o.dist(A),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(o,A,a,l,c,u,i,r,n,s),this.distance=g,this.scaledDistance=this.distance/this.totalDistance}}else{const e=this.currentVertex;if(this.currentVertexIsOutside){Nh(e,f,h,d),this.e1=this.e2=-1,this.distance-=e.dist(f),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e.w;const t=this.evaluateLineProgressFeatures(e.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(e,a,l,s,!1,i,n,t),this.addHalfVertex(e,c,u,s,!0,-r,n,t),this.prevDistance=this.distance,this.distance=g,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(e,f,a,l,c,u,i,r,n,s)}else A||(this.addHalfVertex(e,a,l,s,!1,i,n,o),this.addHalfVertex(e,c,u,s,!0,-r,n,o));this.currentVertex=f,this.currentVertexIsOutside=A,this.lineSoFar=m}else this.addHalfVertex(e,a,l,s,!1,i,n,o),this.addHalfVertex(e,c,u,s,!0,-r,n,o)}addHalfVertex({x:e,y:t},i,r,n,o,s,a,l){if(this.patternJoinNone&&(0===this.segmentPoints.length&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),o||this.segmentPoints.push(this.lineSoFar-this.segmentStart,s)),this.layoutVertexArray.emplaceBack((e<<1)+(n?1:0),(t<<1)+(o?1:0),Math.round(63*i)+128,Math.round(63*r)+128,1+(0===s?0:s<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const e=Et(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,e)}const c=a.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,c),a.primitiveLength++),o?this.e2=c:this.e1=c,null!=l&&this.zOffsetVertexArray.emplaceBack(l.zOffset,l.variableWidth,l.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(e,t){this.prevDistance=this.distance,this.distance+=e.dist(t),this.updateScaledDistance()}}function Zd(e,t,i){return e.x<t||e.x>i||e.y<t||e.y>i}let qd,Kd;function Wd(e,t,i){return t*(Xi/(e.tileSize*Math.pow(2,i-e.tileID.overscaledZ)))}co($d,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const Xd=(e,t,i)=>(1-i)*e+i*t;function Yd(e,t){return 1/Wd(e,1,t.tileZoom)}function Jd(e,t,i,r){return e.translatePosMatrix(r||t.tileID.projMatrix,t,i.paint.get("line-translate"),i.paint.get("line-translate-anchor"))}const ep=e=>{const t=[];tp(e)&&t.push("RENDER_LINE_DASH"),e.paint.get("line-gradient")&&t.push("RENDER_LINE_GRADIENT");const i=e.paint.get("line-trim-offset");0===i[0]&&0===i[1]||t.push("RENDER_LINE_TRIM_OFFSET"),0!==e.paint.get("line-border-width").constantOr(1)&&t.push("RENDER_LINE_BORDER");const r="none"===e.layout.get("line-join").constantOr("miter"),n=!!e.paint.get("line-pattern").constantOr(1);return r&&n&&t.push("LINE_JOIN_NONE"),t};function tp(e){const t=e.paint.get("line-dasharray").value;return t.value||"constant"!==t.kind}let ip;const rp=()=>ip||(ip={layout:qd||(qd=new Ko({"line-cap":new Zo(Wo.layout_line["line-cap"]),"line-join":new Zo(Wo.layout_line["line-join"]),"line-miter-limit":new $o(Wo.layout_line["line-miter-limit"]),"line-round-limit":new $o(Wo.layout_line["line-round-limit"]),"line-sort-key":new Zo(Wo.layout_line["line-sort-key"]),"line-z-offset":new Zo(Wo.layout_line["line-z-offset"]),"line-elevation-reference":new $o(Wo.layout_line["line-elevation-reference"]),"line-cross-slope":new $o(Wo.layout_line["line-cross-slope"]),visibility:new $o(Wo.layout_line.visibility),"line-width-unit":new $o(Wo.layout_line["line-width-unit"])})),paint:Kd||(Kd=new Ko({"line-opacity":new Zo(Wo.paint_line["line-opacity"]),"line-color":new Zo(Wo.paint_line["line-color"]),"line-translate":new $o(Wo.paint_line["line-translate"]),"line-translate-anchor":new $o(Wo.paint_line["line-translate-anchor"]),"line-width":new Zo(Wo.paint_line["line-width"]),"line-gap-width":new Zo(Wo.paint_line["line-gap-width"]),"line-offset":new Zo(Wo.paint_line["line-offset"]),"line-blur":new Zo(Wo.paint_line["line-blur"]),"line-dasharray":new Zo(Wo.paint_line["line-dasharray"]),"line-pattern":new Zo(Wo.paint_line["line-pattern"]),"line-gradient":new qo(Wo.paint_line["line-gradient"]),"line-trim-offset":new $o(Wo.paint_line["line-trim-offset"]),"line-trim-fade-range":new $o(Wo.paint_line["line-trim-fade-range"]),"line-trim-color":new $o(Wo.paint_line["line-trim-color"]),"line-emissive-strength":new $o(Wo.paint_line["line-emissive-strength"]),"line-border-width":new Zo(Wo.paint_line["line-border-width"]),"line-border-color":new Zo(Wo.paint_line["line-border-color"]),"line-occlusion-opacity":new $o(Wo.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new Zo({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new Zo({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new Zo({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new Zo({type:"string",default:"default","property-type":"data-driven"})}))},ip);class np extends Zo{possiblyEvaluate(e,t){return t=new Do(Math.floor(t.zoom),{now:t.now,fadeDuration:t.fadeDuration,transition:t.transition}),super.possiblyEvaluate(e,t)}evaluate(e,t,i,r){return t=re({},t,{zoom:Math.floor(t.zoom)}),super.evaluate(e,t,i,r)}}let op;function sp(e,t){return t>0?t+2*e:e}const ap=vs([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),lp=vs([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),cp=vs([{name:"a_projected_pos",components:4,type:"Float32"}],4);vs([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const up=vs([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),hp=vs([{name:"a_texb",components:2,type:"Uint16"}]),dp=vs([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),pp=vs([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);vs([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const fp=vs([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Ap=vs([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);vs([{name:"triangle",components:3,type:"Uint16"}]),vs([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),vs([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"},{type:"Uint16",name:"elevationFeatureIndex"}]),vs([{type:"Float32",name:"offsetX"}]),vs([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var mp=24;const gp=128;function _p(e,t,i,r,n){if("camera"===e.kind)return e.maxSize;if("composite"===e.kind){const r=t.possiblyEvaluate(new Do(e.maxZoom),i).evaluate(n,{},i),o=t.possiblyEvaluate(new Do(e.minZoom),i).evaluate(n,{},i);return Math.max(r,o)}return t.possiblyEvaluate(new Do(r)).evaluate(n,{},i)}function yp(e,t){const{expression:i}=t;if("constant"===i.kind)return{kind:"constant",layoutSize:i.evaluate(new Do(e+1))};if("source"===i.kind)return{kind:"source"};{const{zoomStops:t,interpolationType:r}=i;let n=0;for(;n<t.length&&t[n]<=e;)n++;n=Math.max(0,n-1);let o=n;for(;o<t.length&&t[o]<e+1;)o++;o=Math.min(t.length-1,o);const s=t[n],a=t[o];return"composite"===i.kind?{kind:"composite",minZoom:s,maxZoom:a,interpolationType:r}:{kind:"camera",minZoom:s,maxZoom:a,minSize:i.evaluate(new Do(s)),maxSize:i.evaluate(new Do(a)),interpolationType:r}}}function vp(e,{uSize:t,uSizeT:i},{lowerSize:r,upperSize:n}){return"source"===e.kind?r/gp:"composite"===e.kind?Et(r/gp,n/gp,i):t}function xp(e,t,i=1){let r=0,n=0;if("constant"===e.kind)n=e.layoutSize*i;else if("source"!==e.kind){const{interpolationType:o,minZoom:s,maxZoom:a}=e,l=o?J(sn.interpolationFactor(o,t,s,a),0,1):0;"camera"===e.kind?n=Et(e.minSize,e.maxSize,l)*i:r=l*i}return{uSizeT:r,uSize:n}}var bp=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:gp,evaluateSizeForFeature:vp,evaluateSizeForZoom:xp,getRasterizedIconSize:_p,getSizeData:yp});function wp(e,t,i){return e.sections.forEach((e=>{e.text=function(e,t,i){const r=t.layout.get("text-transform").evaluate(i,{});return"uppercase"===r?e=e.toLocaleUpperCase():"lowercase"===r&&(e=e.toLocaleLowerCase()),Ro.applyArabicShaping&&(e=Ro.applyArabicShaping(e)),e}(e.text,t,i)})),e}const Tp={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function Bp(e){return""===e||""===e||""===e||""===e||""===e||""===e||""===e||""===e||""===e||""===e||""===e||""===e||""===e||""===e||""===e||""===e||""===e}function Cp(e){return""===e||""===e||""===e||""===e||""===e||""===e||""===e||""===e||""===e||""===e}var Sp,Ep,Mp,Ip={};
/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function Pp(){return Sp||(Sp=1,Ip.read=function(e,t,i,r,n){var o,s,a=8*n-r-1,l=(1<<a)-1,c=l>>1,u=-7,h=i?n-1:0,d=i?-1:1,p=e[t+h];for(h+=d,o=p&(1<<-u)-1,p>>=-u,u+=a;u>0;o=256*o+e[t+h],h+=d,u-=8);for(s=o&(1<<-u)-1,o>>=-u,u+=r;u>0;s=256*s+e[t+h],h+=d,u-=8);if(0===o)o=1-c;else{if(o===l)return s?NaN:1/0*(p?-1:1);s+=Math.pow(2,r),o-=c}return(p?-1:1)*s*Math.pow(2,o-r)},Ip.write=function(e,t,i,r,n,o){var s,a,l,c=8*o-n-1,u=(1<<c)-1,h=u>>1,d=23===n?Math.pow(2,-24)-Math.pow(2,-77):0,p=r?0:o-1,f=r?1:-1,A=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,s=u):(s=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-s))<1&&(s--,l*=2),(t+=s+h>=1?d/l:d*Math.pow(2,1-h))*l>=2&&(s++,l/=2),s+h>=u?(a=0,s=u):s+h>=1?(a=(t*l-1)*Math.pow(2,n),s+=h):(a=t*Math.pow(2,h-1)*Math.pow(2,n),s=0));n>=8;e[i+p]=255&a,p+=f,a/=256,n-=8);for(s=s<<n|a,c+=n;c>0;e[i+p]=255&s,p+=f,s/=256,c-=8);e[i+p-f]|=128*A}),Ip}function Lp(){if(Mp)return Ep;Mp=1,Ep=t;var e=Pp();function t(e){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(e)?e:new Uint8Array(e||0),this.pos=0,this.type=0,this.length=this.buf.length}t.Varint=0,t.Fixed64=1,t.Bytes=2,t.Fixed32=5;var i=4294967296,r=1/i,n="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function o(e){return e.type===t.Bytes?e.readVarint()+e.pos:e.pos+1}function s(e,t,i){return i?4294967296*t+(e>>>0):4294967296*(t>>>0)+(e>>>0)}function a(e,t,i){var r=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));i.realloc(r);for(var n=i.pos-1;n>=e;n--)i.buf[n+r]=i.buf[n]}function l(e,t){for(var i=0;i<e.length;i++)t.writeVarint(e[i])}function c(e,t){for(var i=0;i<e.length;i++)t.writeSVarint(e[i])}function u(e,t){for(var i=0;i<e.length;i++)t.writeFloat(e[i])}function h(e,t){for(var i=0;i<e.length;i++)t.writeDouble(e[i])}function d(e,t){for(var i=0;i<e.length;i++)t.writeBoolean(e[i])}function p(e,t){for(var i=0;i<e.length;i++)t.writeFixed32(e[i])}function f(e,t){for(var i=0;i<e.length;i++)t.writeSFixed32(e[i])}function A(e,t){for(var i=0;i<e.length;i++)t.writeFixed64(e[i])}function m(e,t){for(var i=0;i<e.length;i++)t.writeSFixed64(e[i])}function g(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+16777216*e[t+3]}function _(e,t,i){e[i]=t,e[i+1]=t>>>8,e[i+2]=t>>>16,e[i+3]=t>>>24}function y(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+(e[t+3]<<24)}return t.prototype={destroy:function(){this.buf=null},readFields:function(e,t,i){for(i=i||this.length;this.pos<i;){var r=this.readVarint(),n=r>>3,o=this.pos;this.type=7&r,e(n,t,this),this.pos===o&&this.skip(r)}return t},readMessage:function(e,t){return this.readFields(e,t,this.readVarint()+this.pos)},readFixed32:function(){var e=g(this.buf,this.pos);return this.pos+=4,e},readSFixed32:function(){var e=y(this.buf,this.pos);return this.pos+=4,e},readFixed64:function(){var e=g(this.buf,this.pos)+g(this.buf,this.pos+4)*i;return this.pos+=8,e},readSFixed64:function(){var e=g(this.buf,this.pos)+y(this.buf,this.pos+4)*i;return this.pos+=8,e},readFloat:function(){var t=e.read(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=e.read(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(e){var t,i,r=this.buf;return t=127&(i=r[this.pos++]),i<128?t:(t|=(127&(i=r[this.pos++]))<<7,i<128?t:(t|=(127&(i=r[this.pos++]))<<14,i<128?t:(t|=(127&(i=r[this.pos++]))<<21,i<128?t:function(e,t,i){var r,n,o=i.buf;if(r=(112&(n=o[i.pos++]))>>4,n<128)return s(e,r,t);if(r|=(127&(n=o[i.pos++]))<<3,n<128)return s(e,r,t);if(r|=(127&(n=o[i.pos++]))<<10,n<128)return s(e,r,t);if(r|=(127&(n=o[i.pos++]))<<17,n<128)return s(e,r,t);if(r|=(127&(n=o[i.pos++]))<<24,n<128)return s(e,r,t);if(r|=(1&(n=o[i.pos++]))<<31,n<128)return s(e,r,t);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(i=r[this.pos]))<<28,e,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var e=this.readVarint();return e%2==1?(e+1)/-2:e/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var e=this.readVarint()+this.pos,t=this.pos;return this.pos=e,e-t>=12&&n?function(e,t,i){return n.decode(e.subarray(t,i))}(this.buf,t,e):function(e,t,i){for(var r="",n=t;n<i;){var o,s,a,l=e[n],c=null,u=l>239?4:l>223?3:l>191?2:1;if(n+u>i)break;1===u?l<128&&(c=l):2===u?128==(192&(o=e[n+1]))&&(c=(31&l)<<6|63&o)<=127&&(c=null):3===u?(s=e[n+2],128==(192&(o=e[n+1]))&&128==(192&s)&&((c=(15&l)<<12|(63&o)<<6|63&s)<=2047||c>=55296&&c<=57343)&&(c=null)):4===u&&(s=e[n+2],a=e[n+3],128==(192&(o=e[n+1]))&&128==(192&s)&&128==(192&a)&&((c=(15&l)<<18|(63&o)<<12|(63&s)<<6|63&a)<=65535||c>=1114112)&&(c=null)),null===c?(c=65533,u=1):c>65535&&(c-=65536,r+=String.fromCharCode(c>>>10&1023|55296),c=56320|1023&c),r+=String.fromCharCode(c),n+=u}return r}(this.buf,t,e)},readBytes:function(){var e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t},readPackedVarint:function(e,i){if(this.type!==t.Bytes)return e.push(this.readVarint(i));var r=o(this);for(e=e||[];this.pos<r;)e.push(this.readVarint(i));return e},readPackedSVarint:function(e){if(this.type!==t.Bytes)return e.push(this.readSVarint());var i=o(this);for(e=e||[];this.pos<i;)e.push(this.readSVarint());return e},readPackedBoolean:function(e){if(this.type!==t.Bytes)return e.push(this.readBoolean());var i=o(this);for(e=e||[];this.pos<i;)e.push(this.readBoolean());return e},readPackedFloat:function(e){if(this.type!==t.Bytes)return e.push(this.readFloat());var i=o(this);for(e=e||[];this.pos<i;)e.push(this.readFloat());return e},readPackedDouble:function(e){if(this.type!==t.Bytes)return e.push(this.readDouble());var i=o(this);for(e=e||[];this.pos<i;)e.push(this.readDouble());return e},readPackedFixed32:function(e){if(this.type!==t.Bytes)return e.push(this.readFixed32());var i=o(this);for(e=e||[];this.pos<i;)e.push(this.readFixed32());return e},readPackedSFixed32:function(e){if(this.type!==t.Bytes)return e.push(this.readSFixed32());var i=o(this);for(e=e||[];this.pos<i;)e.push(this.readSFixed32());return e},readPackedFixed64:function(e){if(this.type!==t.Bytes)return e.push(this.readFixed64());var i=o(this);for(e=e||[];this.pos<i;)e.push(this.readFixed64());return e},readPackedSFixed64:function(e){if(this.type!==t.Bytes)return e.push(this.readSFixed64());var i=o(this);for(e=e||[];this.pos<i;)e.push(this.readSFixed64());return e},skip:function(e){var i=7&e;if(i===t.Varint)for(;this.buf[this.pos++]>127;);else if(i===t.Bytes)this.pos=this.readVarint()+this.pos;else if(i===t.Fixed32)this.pos+=4;else{if(i!==t.Fixed64)throw new Error("Unimplemented type: "+i);this.pos+=8}},writeTag:function(e,t){this.writeVarint(e<<3|t)},realloc:function(e){for(var t=this.length||16;t<this.pos+e;)t*=2;if(t!==this.length){var i=new Uint8Array(t);i.set(this.buf),this.buf=i,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(e){this.realloc(4),_(this.buf,e,this.pos),this.pos+=4},writeSFixed32:function(e){this.realloc(4),_(this.buf,e,this.pos),this.pos+=4},writeFixed64:function(e){this.realloc(8),_(this.buf,-1&e,this.pos),_(this.buf,Math.floor(e*r),this.pos+4),this.pos+=8},writeSFixed64:function(e){this.realloc(8),_(this.buf,-1&e,this.pos),_(this.buf,Math.floor(e*r),this.pos+4),this.pos+=8},writeVarint:function(e){(e=+e||0)>268435455||e<0?function(e,t){var i,r;if(e>=0?(i=e%4294967296|0,r=e/4294967296|0):(r=~(-e/4294967296),4294967295^(i=~(-e%4294967296))?i=i+1|0:(i=0,r=r+1|0)),e>=0x10000000000000000||e<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");t.realloc(10),function(e,t,i){i.buf[i.pos++]=127&e|128,e>>>=7,i.buf[i.pos++]=127&e|128,e>>>=7,i.buf[i.pos++]=127&e|128,e>>>=7,i.buf[i.pos++]=127&e|128,i.buf[i.pos]=127&(e>>>=7)}(i,0,t),function(e,t){var i=(7&e)<<4;t.buf[t.pos++]|=i|((e>>>=3)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e)))))}(r,t)}(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))},writeSVarint:function(e){this.writeVarint(e<0?2*-e-1:2*e)},writeBoolean:function(e){this.writeVarint(Boolean(e))},writeString:function(e){e=String(e),this.realloc(4*e.length),this.pos++;var t=this.pos;this.pos=function(e,t,i){for(var r,n,o=0;o<t.length;o++){if((r=t.charCodeAt(o))>55295&&r<57344){if(!n){r>56319||o+1===t.length?(e[i++]=239,e[i++]=191,e[i++]=189):n=r;continue}if(r<56320){e[i++]=239,e[i++]=191,e[i++]=189,n=r;continue}r=n-55296<<10|r-56320|65536,n=null}else n&&(e[i++]=239,e[i++]=191,e[i++]=189,n=null);r<128?e[i++]=r:(r<2048?e[i++]=r>>6|192:(r<65536?e[i++]=r>>12|224:(e[i++]=r>>18|240,e[i++]=r>>12&63|128),e[i++]=r>>6&63|128),e[i++]=63&r|128)}return i}(this.buf,e,this.pos);var i=this.pos-t;i>=128&&a(t,i,this),this.pos=t-1,this.writeVarint(i),this.pos+=i},writeFloat:function(t){this.realloc(4),e.write(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),e.write(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(e){var t=e.length;this.writeVarint(t),this.realloc(t);for(var i=0;i<t;i++)this.buf[this.pos++]=e[i]},writeRawMessage:function(e,t){this.pos++;var i=this.pos;e(t,this);var r=this.pos-i;r>=128&&a(i,r,this),this.pos=i-1,this.writeVarint(r),this.pos+=r},writeMessage:function(e,i,r){this.writeTag(e,t.Bytes),this.writeRawMessage(i,r)},writePackedVarint:function(e,t){t.length&&this.writeMessage(e,l,t)},writePackedSVarint:function(e,t){t.length&&this.writeMessage(e,c,t)},writePackedBoolean:function(e,t){t.length&&this.writeMessage(e,d,t)},writePackedFloat:function(e,t){t.length&&this.writeMessage(e,u,t)},writePackedDouble:function(e,t){t.length&&this.writeMessage(e,h,t)},writePackedFixed32:function(e,t){t.length&&this.writeMessage(e,p,t)},writePackedSFixed32:function(e,t){t.length&&this.writeMessage(e,f,t)},writePackedFixed64:function(e,t){t.length&&this.writeMessage(e,A,t)},writePackedSFixed64:function(e,t){t.length&&this.writeMessage(e,m,t)},writeBytesField:function(e,i){this.writeTag(e,t.Bytes),this.writeBytes(i)},writeFixed32Field:function(e,i){this.writeTag(e,t.Fixed32),this.writeFixed32(i)},writeSFixed32Field:function(e,i){this.writeTag(e,t.Fixed32),this.writeSFixed32(i)},writeFixed64Field:function(e,i){this.writeTag(e,t.Fixed64),this.writeFixed64(i)},writeSFixed64Field:function(e,i){this.writeTag(e,t.Fixed64),this.writeSFixed64(i)},writeVarintField:function(e,i){this.writeTag(e,t.Varint),this.writeVarint(i)},writeSVarintField:function(e,i){this.writeTag(e,t.Varint),this.writeSVarint(i)},writeStringField:function(e,i){this.writeTag(e,t.Bytes),this.writeString(i)},writeFloatField:function(e,i){this.writeTag(e,t.Fixed32),this.writeFloat(i)},writeDoubleField:function(e,i){this.writeTag(e,t.Fixed64),this.writeDouble(i)},writeBooleanField:function(e,t){this.writeVarintField(e,Boolean(t))}},Ep}var Fp=t(Lp());const kp=3;function zp(e,t,i){t.glyphs=[],1===e&&i.readMessage(Rp,t)}function Rp(e,t,i){if(3===e){const{id:e,bitmap:r,width:n,height:o,left:s,top:a,advance:l}=i.readMessage(Dp,{});t.glyphs.push({id:e,bitmap:new hu({width:n+2*kp,height:o+2*kp},r),metrics:{width:n,height:o,left:s,top:a,advance:l}})}else 4===e?t.ascender=i.readSVarint():5===e&&(t.descender=i.readSVarint())}function Dp(e,t,i){1===e?t.id=i.readVarint():2===e?t.bitmap=i.readBytes():3===e?t.width=i.readVarint():4===e?t.height=i.readVarint():5===e?t.left=i.readSVarint():6===e?t.top=i.readSVarint():7===e&&(t.advance=i.readVarint())}const Op=kp,Up={horizontal:1,vertical:2,horizontalOnly:3};class Np{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(e,t){const i=new Np;return i.scale=e||1,i.fontStack=t,i}static forImage(e){const t=new Np;return t.image=e,t}}class Qp{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,t,i){const r=new Qp;for(let n=0;n<e.sections.length;n++){const o=e.sections[n];o.image?r.addImageSection(o,i):r.addTextSection(o,t)}return r}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=function(e,t){let i="";for(let r=0;r<e.length;r++){const n=e.charCodeAt(r+1)||null,o=e.charCodeAt(r-1)||null;i+=!t&&(n&&vo(n)&&!Tp[e[r+1]]||o&&vo(o)&&!Tp[e[r-1]])||!Tp[e[r]]?e[r]:Tp[e[r]]}return i}(this.text,e)}trim(){let e=0;for(let t=0;t<this.text.length&&Vp[this.text.charCodeAt(t)];t++)e++;let t=this.text.length;for(let i=this.text.length-1;i>=0&&i>=e&&Vp[this.text.charCodeAt(i)];i--)t--;this.text=this.text.substring(e,t),this.sectionIndex=this.sectionIndex.slice(e,t)}substring(e,t){const i=new Qp;return i.text=this.text.substring(e,t),i.sectionIndex=this.sectionIndex.slice(e,t),i.sections=this.sections,i}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((e,t)=>Math.max(e,this.sections[t].scale)),0)}addTextSection(e,t){this.text+=e.text,this.sections.push(Np.forText(e.scale,e.fontStack||t));const i=this.sections.length-1;for(let t=0;t<e.text.length;++t)this.sectionIndex.push(i)}addImageSection(e,t){const i=e.image?e.image.getPrimary():null;if(!i)return void de("Can't add FormattedSection with an empty image.");i.scaleSelf(t);const r=this.getNextImageSectionCharCode();r?(this.text+=String.fromCodePoint(r),this.sections.push(Np.forImage(i)),this.sectionIndex.push(this.sections.length-1)):de("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function jp(e,t,i,r,n,o,s,a,l,c,u,h,d,p,f,A=1){const m=Qp.fromFeature(e,n,A);h===Up.vertical&&m.verticalizePunctuation(d);let g=[];const _=function(e,t,i,r,n,o){if(!e)return[];const s=[],a=function(e,t,i,r,n,o){let s=0;for(let i=0;i<e.length();i++){const a=e.getSection(i);s+=Gp(e.getCodePoint(i),a,r,n,t,o)}return s/Math.max(1,Math.ceil(s/i))}(e,t,i,r,n,o),l=e.text.indexOf("")>=0;let c=0;for(let i=0;i<e.length();i++){const h=e.getSection(i),d=e.getCodePoint(i);if(Vp[d]||(c+=Gp(d,h,r,n,t,o)),i<e.length()-1){const t=!((u=d)<11904||!(Ao["Bopomofo Extended"](u)||Ao.Bopomofo(u)||Ao["CJK Compatibility Forms"](u)||Ao["CJK Compatibility Ideographs"](u)||Ao["CJK Compatibility"](u)||Ao["CJK Radicals Supplement"](u)||Ao["CJK Strokes"](u)||Ao["CJK Symbols and Punctuation"](u)||Ao["CJK Unified Ideographs Extension A"](u)||Ao["CJK Unified Ideographs"](u)||Ao["Enclosed CJK Letters and Months"](u)||Ao["Halfwidth and Fullwidth Forms"](u)||Ao.Hiragana(u)||Ao["Ideographic Description Characters"](u)||Ao["Kangxi Radicals"](u)||Ao["Katakana Phonetic Extensions"](u)||Ao.Katakana(u)||Ao["Vertical Forms"](u)||Ao["Yi Radicals"](u)||Ao["Yi Syllables"](u)));(Hp[d]||t||h.image)&&s.push(qp(i+1,c,a,s,Zp(d,e.getCodePoint(i+1),t&&l),!1))}}var u;return Kp(qp(e.length(),c,a,s,0,!0))}(m,c,o,t,r,p),{processBidirectionalText:y,processStyledBidirectionalText:v}=Ro;if(y&&1===m.sections.length){const e=y(m.toString(),_);for(const t of e){const e=new Qp;e.text=t,e.sections=m.sections;for(let i=0;i<t.length;i++)e.sectionIndex.push(0);g.push(e)}}else if(v){const e=v(m.text,m.sectionIndex,_);for(const t of e){const e=new Qp;e.text=t[0],e.sectionIndex=t[1],e.sections=m.sections,g.push(e)}}else g=function(e,t){const i=[],r=e.text;let n=0;for(const r of t)i.push(e.substring(n,r)),n=r;return n<r.length&&i.push(e.substring(n,r.length)),i}(m,_);const x=[],b={positionedLines:x,text:m.toString(),top:u[1],bottom:u[1],left:u[0],right:u[0],writingMode:h,iconsInText:!1,verticalizable:!1,hasBaseline:!1};if(function(e,t,i,r,n,o,s,a,l,c,u,h){let d=0,p=0,f=0;const A="right"===a?1:"left"===a?0:.5;let m=!1;for(const e of n){const i=e.getSections();for(const e of i){if(e.image)continue;const i=t[e.fontStack];if(i&&(m=void 0!==i.ascender&&void 0!==i.descender,!m))break}if(!m)break}let g=0;for(const s of n){s.trim();const n=s.getMaxScale(),a=(n-1)*mp,y={positionedGlyphs:[],lineOffset:0};e.positionedLines[g]=y;const v=y.positionedGlyphs;let x=0;if(!s.length()){p+=o,++g;continue}let b=0,w=0;for(let o=0;o<s.length();o++){const a=s.getSection(o),f=s.getSectionIndex(o),A=s.getCodePoint(o);let g=a.scale,y=null,T=null,B=null,C=mp,S=0;l===Up.vertical&&(12312===(_=A)||12313===_||12316===_||12540===_||12448===_)&&(l=Up.horizontal);const E=!(l===Up.horizontal||!u&&!yo(A)||u&&(Vp[A]||xo(A)));if(a.image){const t=r.get(a.image.toString());if(!t)continue;B=a.image,e.iconsInText=e.iconsInText||!0,T=t.paddedRect;const i=t.displaySize;g=g*mp/h,y={width:i[0],height:i[1],left:0,top:-Op,advance:E?i[1]:i[0],localGlyph:!1},S=m?-y.height*g:n*mp-17-i[1]*g,C=y.advance;const o=(E?i[0]:i[1])*g-mp*n;o>0&&o>x&&(x=o)}else{const e=i[a.fontStack];if(!e)continue;e[A]&&(T=e[A]);const r=t[a.fontStack];if(!r)continue;const o=r.glyphs[A];if(!o)continue;if(y=o.metrics,C=8203!==A?mp:0,m){const e=void 0!==r.ascender?Math.abs(r.ascender):0,t=void 0!==r.descender?Math.abs(r.descender):0,i=(e+t)*g;b<i&&(b=i,w=(e-t)/2*g),S=-e*g}else S=(n-g)*mp-17}E?(e.verticalizable=!0,v.push({glyph:A,image:B,x:d,y:p+S,vertical:E,scale:g,localGlyph:y.localGlyph,fontStack:a.fontStack,sectionIndex:f,metrics:y,rect:T}),d+=C*g+c):(v.push({glyph:A,image:B,x:d,y:p+S,vertical:E,scale:g,localGlyph:y.localGlyph,fontStack:a.fontStack,sectionIndex:f,metrics:y,rect:T}),d+=y.advance*g+c)}0!==v.length&&(f=Math.max(d-c,f),m?Xp(v,A,x,w,o*n/2):Xp(v,A,x,0,o/2)),d=0;const T=o*n+x;y.lineOffset=Math.max(x,a),p+=T,++g}var _;const y=p,{horizontalAlign:v,verticalAlign:x}=Wp(s);(function(e,t,i,r,n,o){const s=(t-i)*n,a=-o*r;for(const t of e)for(const e of t.positionedGlyphs)e.x+=s,e.y+=a})(e.positionedLines,A,v,x,f,y),e.top+=-x*y,e.bottom=e.top+y,e.left+=-v*f,e.right=e.left+f,e.hasBaseline=m}(b,t,i,r,g,s,a,l,h,c,d,f),!function(e){for(const t of e)if(0!==t.positionedGlyphs.length)return!1;return!0}(x))return b}const Vp={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Hp={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Gp(e,t,i,r,n,o){if(t.image){const e=r.get(t.image.toString());return e?e.displaySize[0]*t.scale*mp/o+n:0}{const r=i[t.fontStack],o=r&&r.glyphs[e];return o?o.metrics.advance*t.scale+n:0}}function $p(e,t,i,r){const n=Math.pow(e-t,2);return r?e<t?n/2:2*n:n+Math.abs(i)*i}function Zp(e,t,i){let r=0;return 10===e&&(r-=1e4),i&&(r+=150),40!==e&&65288!==e||(r+=50),41!==t&&65289!==t||(r+=50),r}function qp(e,t,i,r,n,o){let s=null,a=$p(t,i,n,o);for(const e of r){const r=$p(t-e.x,i,n,o)+e.badness;r<=a&&(s=e,a=r)}return{index:e,x:t,priorBreak:s,badness:a}}function Kp(e){return e?Kp(e.priorBreak).concat(e.index):[]}function Wp(e){let t=.5,i=.5;switch(e){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(e){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:t,verticalAlign:i}}function Xp(e,t,i,r,n){if(!(t||i||r||n))return;const o=e.length-1,s=e[o],a=(s.x+s.metrics.advance*s.scale)*t;for(let t=0;t<=o;t++)e[t].x-=a,e[t].y+=i+r+n}function Yp(e,t,i,r){const{horizontalAlign:n,verticalAlign:o}=Wp(r),s=i[0]-e.displaySize[0]*n,a=i[1]-e.displaySize[1]*o;return{imagePrimary:e,imageSecondary:t,top:a,bottom:a+e.displaySize[1],left:s,right:s+e.displaySize[0]}}function Jp(e,t,i,r,n,o){const s=e.imagePrimary;let a;if(s.content){const e=s.content,t=s.pixelRatio||1;a=[e[0]/t,e[1]/t,s.displaySize[0]-e[2]/t,s.displaySize[1]-e[3]/t]}const l=t.left*o,c=t.right*o;let u,h,d,p;"width"===i||"both"===i?(p=n[0]+l-r[3],h=n[0]+c+r[1]):(p=n[0]+(l+c-s.displaySize[0])/2,h=p+s.displaySize[0]);const f=t.top*o,A=t.bottom*o;return"height"===i||"both"===i?(u=n[1]+f-r[0],d=n[1]+A+r[2]):(u=n[1]+(f+A-s.displaySize[1])/2,d=u+s.displaySize[1]),{imagePrimary:s,imageSecondary:void 0,top:u,right:h,bottom:d,left:p,collisionPadding:a}}class ef extends V{constructor(e,t,i,r,n){super(e,t),this.angle=r,this.z=i,void 0!==n&&(this.segment=n)}clone(){return new ef(this.x,this.y,this.z,this.angle,this.segment)}}function tf(e,t,i,r,n){if(void 0===t.segment)return!0;let o=t,s=t.segment+1,a=0;for(;a>-i/2;){if(s--,s<0)return!1;a-=e[s].dist(o),o=e[s]}a+=e[s].dist(e[s+1]),s++;const l=[];let c=0;for(;a<i/2;){const t=e[s],i=e[s+1];if(!i)return!1;let o=e[s-1].angleTo(t)-t.angleTo(i);for(o=Math.abs((o+3*Math.PI)%(2*Math.PI)-Math.PI),l.push({distance:a,angleDelta:o}),c+=o;a-l[0].distance>r;)c-=l.shift().angleDelta;if(c>n)return!1;s++,a+=t.dist(i)}return!0}function rf(e){let t=0;for(let i=0;i<e.length-1;i++)t+=e[i].dist(e[i+1]);return t}function nf(e,t,i){return e?.6*t*i:0}function of(e,t){return Math.max(e?e.right-e.left:0,t?t.right-t.left:0)}function sf(e,t,i,r,n,o){const s=nf(i,n,o),a=of(i,r)*o;let l=0;const c=rf(e)/2;for(let i=0;i<e.length-1;i++){const r=e[i],n=e[i+1],o=r.dist(n);if(l+o>c){const u=(c-l)/o,h=Et(r.x,n.x,u),d=Et(r.y,n.y,u),p=new ef(h,d,0,n.angleTo(r),i);return!s||tf(e,p,a,s,t)?p:void 0}l+=o}}function af(e,t,i,r,n,o,s,a,l){const c=nf(r,o,s),u=of(r,n),h=u*s,d=0===e[0].x||e[0].x===l||0===e[0].y||e[0].y===l;return t-h<t/4&&(t=h+t/4),lf(e,d?t/2*a%t:(u/2+2*o)*s*a%t,t,c,i,h,d,!1,l)}function lf(e,t,i,r,n,o,s,a,l){const c=o/2,u=rf(e);let h=0,d=t-i,p=[];for(let t=0;t<e.length-1;t++){const s=e[t],a=e[t+1],f=s.dist(a),A=a.angleTo(s);for(;d+i<h+f;){d+=i;const m=(d-h)/f,g=Et(s.x,a.x,m),_=Et(s.y,a.y,m);if(g>=0&&g<l&&_>=0&&_<l&&d-c>=0&&d+c<=u){const i=new ef(g,_,0,A,t);r&&!tf(e,i,o,r,n)||p.push(i)}}h+=f}return a||p.length||s||(p=lf(e,h/2,i,r,n,o,s,!0,l)),p}function cf(e,t,i,r,n){const o=[];for(let s=0;s<e.length;s++){const a=e[s];let l;for(let e=0;e<a.length-1;e++){let s=a[e],c=a[e+1];s.x<t&&c.x<t||(s.x<t?s=new V(t,s.y+(t-s.x)/(c.x-s.x)*(c.y-s.y))._round():c.x<t&&(c=new V(t,s.y+(t-s.x)/(c.x-s.x)*(c.y-s.y))._round()),s.y<i&&c.y<i||(s.y<i?s=new V(s.x+(i-s.y)/(c.y-s.y)*(c.x-s.x),i)._round():c.y<i&&(c=new V(s.x+(i-s.y)/(c.y-s.y)*(c.x-s.x),i)._round()),s.x>=r&&c.x>=r||(s.x>=r?s=new V(r,s.y+(r-s.x)/(c.x-s.x)*(c.y-s.y))._round():c.x>=r&&(c=new V(r,s.y+(r-s.x)/(c.x-s.x)*(c.y-s.y))._round()),s.y>=n&&c.y>=n||(s.y>=n?s=new V(s.x+(n-s.y)/(c.y-s.y)*(c.x-s.x),n)._round():c.y>=n&&(c=new V(s.x+(n-s.y)/(c.y-s.y)*(c.x-s.x),n)._round()),l&&s.equals(l[l.length-1])||(l=[s],o.push(l)),l.push(c)))))}}return o}function uf(e){let t=0,i=0;for(const r of e)t+=r.w*r.h,i=Math.max(i,r.w);e.sort(((e,t)=>t.h-e.h));const r=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),i),h:1/0}];let n=0,o=0;for(const t of e)for(let e=r.length-1;e>=0;e--){const i=r[e];if(!(t.w>i.w||t.h>i.h)){if(t.x=i.x,t.y=i.y,o=Math.max(o,t.y+t.h),n=Math.max(n,t.x+t.w),t.w===i.w&&t.h===i.h){const t=r.pop();e<r.length&&(r[e]=t)}else t.h===i.h?(i.x+=t.w,i.w-=t.w):t.w===i.w?(i.y+=t.h,i.h-=t.h):(r.push({x:i.x+t.w,y:i.y,w:i.w-t.w,h:t.h}),i.y+=t.h,i.h-=t.h);break}}return{w:n,h:o,fill:t/(n*o)||0}}co(ef,"Anchor");const hf=1;class df{static getImagePositionScale(e,t,i){if(t&&e&&e.options&&e.options.transform){const t=e.options.transform;return{x:t.a,y:t.d}}return{x:i,y:i}}constructor(e,t,i,r){this.paddedRect=e;const{pixelRatio:n,version:o,stretchX:s,stretchY:a,content:l,sdf:c,usvg:u}=t;this.pixelRatio=n,this.stretchX=s,this.stretchY=a,this.content=l,this.version=o,this.padding=i,this.sdf=c,this.scale=df.getImagePositionScale(r,u,n)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}function pf(e,t,i){const r=ei.parse(e),n=function(e,t,i=[1,1]){return{x:0,y:0,w:(e.data?e.data.width:e.width*i[0])+2*t,h:(e.data?e.data.height:e.height*i[1])+2*t}}(t,i,[r.options.transform.a,r.options.transform.d]);return{bin:n,imagePosition:new df(n,t,i,r),imageVariant:r}}class ff{constructor(e,t,i){const r=new Map,n=new Map;this.haveRenderCallbacks=[];const o=[];this.addImages(e,r,hf,o),this.addImages(t,n,2,o);const{w:s,h:a}=uf(o),l=new du({width:s||1,height:a||1});for(const[t,n]of e.entries()){const e=r.get(t).paddedRect;du.copy(n.data,l,{x:0,y:0},{x:e.x+hf,y:e.y+hf},n.data,i,n.sdf)}for(const[e,r]of t.entries()){const t=n.get(e),o=t.paddedRect;let s=t.padding;const a=o.x+s,c=o.y+s,u=r.data.width,h=r.data.height;s=s>1?s-1:s,du.copy(r.data,l,{x:0,y:0},{x:a,y:c},r.data,i),du.copy(r.data,l,{x:0,y:h-s},{x:a,y:c-s},{width:u,height:s},i),du.copy(r.data,l,{x:0,y:0},{x:a,y:c+h},{width:u,height:s},i),du.copy(r.data,l,{x:u-s,y:0},{x:a-s,y:c},{width:s,height:h},i),du.copy(r.data,l,{x:0,y:0},{x:a+u,y:c},{width:s,height:h},i),du.copy(r.data,l,{x:u-s,y:h-s},{x:a-s,y:c-s},{width:s,height:s},i),du.copy(r.data,l,{x:0,y:h-s},{x:a+u,y:c-s},{width:s,height:s},i),du.copy(r.data,l,{x:0,y:0},{x:a+u,y:c+h},{width:s,height:s},i),du.copy(r.data,l,{x:u-s,y:0},{x:a-s,y:c+h},{width:s,height:s},i)}this.lut=i,this.image=l,this.iconPositions=r,this.patternPositions=n}addImages(e,t,i,r){for(const[n,o]of e.entries()){const{bin:e,imagePosition:s,imageVariant:a}=pf(n,o,i);t.set(n,s),r.push(e),o.hasRenderCallback&&this.haveRenderCallbacks.push(a.id)}}patchUpdatedImages(e,t,i){this.haveRenderCallbacks=this.haveRenderCallbacks.filter((t=>e.hasImage(t,i))),e.dispatchRenderCallbacks(this.haveRenderCallbacks,i);for(const r of e.getUpdatedImages(i)){for(const n of this.iconPositions.keys()){const o=ei.parse(n);if(bt.isEqual(o.id,r)){const o=e.getImage(r,i);this.patchUpdatedImage(this.iconPositions.get(n),o,t)}}for(const n of this.patternPositions.keys()){const o=ei.parse(n);if(bt.isEqual(o.id,r)){const o=e.getImage(r,i);this.patchUpdatedImage(this.patternPositions.get(n),o,t)}}}}patchUpdatedImage(e,t,i){if(!e||!t)return;if(e.version===t.version)return;e.version=t.version;const[r,n]=e.tl,o=e.sdf;if(this.lut||o){const e={width:t.data.width,height:t.data.height},s=new du(e);du.copy(t.data,s,{x:0,y:0},{x:0,y:0},e,this.lut,o),i.update(s,{position:{x:r,y:n}})}else i.update(t.data,{position:{x:r,y:n}})}}co(df,"ImagePosition"),co(ff,"ImageAtlas");const Af=1e20;function mf(e,t,i,r,n,o,s,a,l){for(let c=t;c<t+r;c++)gf(e,i*o+c,o,n,s,a,l);for(let c=i;c<i+n;c++)gf(e,c*o+t,1,r,s,a,l)}function gf(e,t,i,r,n,o,s){o[0]=0,s[0]=-Af,s[1]=Af,n[0]=e[t];for(let a=1,l=0,c=0;a<r;a++){n[a]=e[t+a*i];const r=a*a;do{const e=o[l];c=(n[a]-n[e]+r-e*e)/(a-e)/2}while(c<=s[l]&&--l>-1);l++,o[l]=a,s[l]=c,s[l+1]=Af}for(let a=0,l=0;a<r;a++){for(;s[l+1]<a;)l++;const r=o[l],c=a-r;e[t+a*i]=n[r]+c*c}}const _f=2,yf={none:0,ideographs:1,all:2};class vf{constructor(e,t,i){this.requestManager=e,this.localGlyphMode=t,this.localFontFamily=i,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e,t){this.urls[t]=e}getGlyphs(e,t,i){const r=[],n=this.urls[t]||Te.GLYPHS_URL;for(const t in e)for(const i of e[t])r.push({stack:t,id:i});ie(r,(({stack:e,id:t},i)=>{let r=this.entries[e];r||(r=this.entries[e]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let o=r.glyphs[t];if(void 0!==o)return void i(null,{stack:e,id:t,glyph:o});if(o=this._tinySDF(r,e,t),o)return r.glyphs[t]=o,void i(null,{stack:e,id:t,glyph:o});const s=Math.floor(t/256);if(256*s>65535)return de("glyphs > 65535 not supported"),void i(null,{stack:e,id:t,glyph:o});if(r.ranges[s])return void i(null,{stack:e,id:t,glyph:o});let a=r.requests[s];a||(a=r.requests[s]=[],vf.loadGlyphRange(e,s,n,this.requestManager,((e,t)=>{if(t){r.ascender=t.ascender,r.descender=t.descender;for(const e in t.glyphs)this._doesCharSupportLocalGlyph(+e)||(r.glyphs[+e]=t.glyphs[+e]);r.ranges[s]=!0}for(const i of a)i(e,t);delete r.requests[s]}))),a.push(((r,n)=>{r?i(r):n&&i(null,{stack:e,id:t,glyph:n.glyphs[t]||null})}))}),((e,t)=>{if(e)i(e);else if(t){const e={};for(const{stack:i,id:r,glyph:n}of t)void 0===e[i]&&(e[i]={}),void 0===e[i].glyphs&&(e[i].glyphs={}),e[i].glyphs[r]=n&&{id:n.id,bitmap:n.bitmap.clone(),metrics:n.metrics},e[i].ascender=this.entries[i].ascender,e[i].descender=this.entries[i].descender;i(null,e)}}))}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==yf.none&&(this.localGlyphMode===yf.all?!!this.localFontFamily:!!this.localFontFamily&&(Ao["CJK Unified Ideographs"](e)||Ao["Hangul Syllables"](e)||Ao.Hiragana(e)||Ao.Katakana(e)||Ao["CJK Symbols and Punctuation"](e)||Ao["CJK Unified Ideographs Extension A"](e)||Ao["CJK Unified Ideographs Extension B"](e)||Ao.Osage(e)))}_tinySDF(e,t,i){const r=this.localFontFamily;if(!r||!this._doesCharSupportLocalGlyph(i))return;let n=e.tinySDF;if(!n){let i="400";/bold/i.test(t)?i="900":/medium/i.test(t)?i="500":/light/i.test(t)&&(i="200"),n=e.tinySDF=new vf.TinySDF({fontFamily:r,fontWeight:i,fontSize:24*_f,buffer:3*_f,radius:8*_f}),n.fontWeight=i}if(this.localGlyphs[n.fontWeight][i])return this.localGlyphs[n.fontWeight][i];const o=String.fromCodePoint(i),{data:s,width:a,height:l,glyphWidth:c,glyphHeight:u,glyphLeft:h,glyphTop:d,glyphAdvance:p}=n.draw(o);return this.localGlyphs[n.fontWeight][i]={id:i,bitmap:new hu({width:a,height:l},s),metrics:{width:c/_f,height:u/_f,left:h/_f,top:d/_f-27,advance:p/_f,localGlyph:!0}}}}vf.loadGlyphRange=function(e,t,i,r,n){const o=256*t,s=o+255,a=r.transformRequest(r.normalizeGlyphsURL(i).replace("{fontstack}",e).replace("{range}",`${o}-${s}`),Je.Glyphs);rt(a,((e,t)=>{if(e)n(e);else if(t){const e={},i=function(e){return new Fp(e).readFields(zp,{})}(t);for(const t of i.glyphs)e[t.id]=t;n(null,{glyphs:e,ascender:i.ascender,descender:i.descender})}}))},vf.TinySDF=class{constructor({fontSize:e=24,buffer:t=3,radius:i=8,cutoff:r=.25,fontFamily:n="sans-serif",fontWeight:o="normal",fontStyle:s="normal"}={}){this.buffer=t,this.cutoff=r,this.radius=i;const a=this.size=e+4*t,l=this._createCanvas(a),c=this.ctx=l.getContext("2d",{willReadFrequently:!0});c.font=`${s} ${o} ${e}px ${n}`,c.textBaseline="alphabetic",c.textAlign="left",c.fillStyle="black",this.gridOuter=new Float64Array(a*a),this.gridInner=new Float64Array(a*a),this.f=new Float64Array(a),this.z=new Float64Array(a+1),this.v=new Uint16Array(a)}_createCanvas(e){const t=document.createElement("canvas");return t.width=t.height=e,t}draw(e){const{width:t,actualBoundingBoxAscent:i,actualBoundingBoxDescent:r,actualBoundingBoxLeft:n,actualBoundingBoxRight:o}=this.ctx.measureText(e),s=Math.ceil(i),a=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(o-n))),l=Math.min(this.size-this.buffer,s+Math.ceil(r)),c=a+2*this.buffer,u=l+2*this.buffer,h=Math.max(c*u,0),d=new Uint8ClampedArray(h),p={data:d,width:c,height:u,glyphWidth:a,glyphHeight:l,glyphTop:s,glyphLeft:0,glyphAdvance:t};if(0===a||0===l)return p;const{ctx:f,buffer:A,gridInner:m,gridOuter:g}=this;f.clearRect(A,A,a,l),f.fillText(e,A,A+s);const _=f.getImageData(A,A,a,l);g.fill(Af,0,h),m.fill(0,0,h);for(let e=0;e<l;e++)for(let t=0;t<a;t++){const i=_.data[4*(e*a+t)+3]/255;if(0===i)continue;const r=(e+A)*c+t+A;if(1===i)g[r]=0,m[r]=Af;else{const e=.5-i;g[r]=e>0?e*e:0,m[r]=e<0?e*e:0}}mf(g,0,0,c,u,c,this.f,this.v,this.z),mf(m,A,A,a,l,c,this.f,this.v,this.z);for(let e=0;e<h;e++){const t=Math.sqrt(g[e])-Math.sqrt(m[e]);d[e]=Math.round(255-255*(t/this.radius+this.cutoff))}return p}};const xf=hf;function bf(e,t){return e+t[1]-t[0]}function wf(e,t,i,r,n=1){const o=[],s=e.imagePrimary,a=s.pixelRatio,l=s.paddedRect.w-2*xf,c=s.paddedRect.h-2*xf,u=(e.right-e.left)*n,h=(e.bottom-e.top)*n,d=s.stretchX||[[0,l]],p=s.stretchY||[[0,c]],f=d.reduce(bf,0),A=p.reduce(bf,0),m=l-f,g=c-A;let _=0,y=f,v=0,x=A,b=0,w=m,T=0,B=g;if(s.content&&r){const e=s.content;_=Tf(d,0,e[0]),v=Tf(p,0,e[1]),y=Tf(d,e[0],e[2]),x=Tf(p,e[1],e[3]),b=e[0]-_,T=e[1]-v,w=e[2]-e[0]-y,B=e[3]-e[1]-x}const C=(r,o,l,c)=>{const d=Cf(r.stretch-_,y,u,e.left*n),p=Sf(r.fixed-b,w,r.stretch,f),m=Cf(o.stretch-v,x,h,e.top*n),g=Sf(o.fixed-T,B,o.stretch,A),C=Cf(l.stretch-_,y,u,e.left*n),S=Sf(l.fixed-b,w,l.stretch,f),E=Cf(c.stretch-v,x,h,e.top*n),M=Sf(c.fixed-T,B,c.stretch,A),I=new V(d,m),P=new V(C,m),L=new V(C,E),F=new V(d,E),k=new V(p/a,g/a),z=new V(S/a,M/a),R=t*Math.PI/180;if(R){const e=Math.sin(R),t=Math.cos(R),i=[t,-e,e,t];I._matMult(i),P._matMult(i),F._matMult(i),L._matMult(i)}const D=r.stretch+r.fixed,O=l.stretch+l.fixed,U=o.stretch+o.fixed,N=c.stretch+c.fixed,Q=e.imageSecondary;return{tl:I,tr:P,bl:F,br:L,texPrimary:{x:s.paddedRect.x+xf+D,y:s.paddedRect.y+xf+U,w:O-D,h:N-U},texSecondary:Q?{x:Q.paddedRect.x+xf+D,y:Q.paddedRect.y+xf+U,w:O-D,h:N-U}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:k,pixelOffsetBR:z,minFontScaleX:w/a/u,minFontScaleY:B/a/h,isSDF:i}};if(r&&(s.stretchX||s.stretchY)){const e=Bf(d,m,f),t=Bf(p,g,A);for(let i=0;i<e.length-1;i++){const r=e[i],n=e[i+1];for(let e=0;e<t.length-1;e++)o.push(C(r,t[e],n,t[e+1]))}}else o.push(C({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:l+1},{fixed:0,stretch:c+1}));return o}function Tf(e,t,i){let r=0;for(const n of e)r+=Math.max(t,Math.min(i,n[1]))-Math.max(t,Math.min(i,n[0]));return r}function Bf(e,t,i){const r=[{fixed:-xf,stretch:0}];for(const[t,i]of e){const e=r[r.length-1];r.push({fixed:t-e.stretch,stretch:e.stretch}),r.push({fixed:t-e.stretch,stretch:e.stretch+(i-t)})}return r.push({fixed:t+xf,stretch:i}),r}function Cf(e,t,i,r){return e/t*i+r}function Sf(e,t,i,r){return e-t*i/r}function Ef(e,t,i,r){const n=t+e.positionedLines[r].lineOffset;return 0===r?i+n/2:i+(n+(t+e.positionedLines[r-1].lineOffset))/2}function Mf(e,t=1,i=!1){let r=1/0,n=1/0,o=-1/0,s=-1/0;const a=e[0];for(let e=0;e<a.length;e++){const t=a[e];(!e||t.x<r)&&(r=t.x),(!e||t.y<n)&&(n=t.y),(!e||t.x>o)&&(o=t.x),(!e||t.y>s)&&(s=t.y)}const l=Math.min(o-r,s-n);let c=l/2;const u=new Wi([],If);if(0===l)return new V(r,n);for(let t=r;t<o;t+=l)for(let i=n;i<s;i+=l)u.push(new Pf(t+c,i+c,c,e));let h=function(e){let t=0,i=0,r=0;const n=e[0];for(let e=0,o=n.length,s=o-1;e<o;s=e++){const o=n[e],a=n[s],l=o.x*a.y-a.x*o.y;i+=(o.x+a.x)*l,r+=(o.y+a.y)*l,t+=3*l}return new Pf(i/t,r/t,0,e)}(e),d=u.length;for(;u.length;){const r=u.pop();(r.d>h.d||!h.d)&&(h=r,i&&console.log("found best %d after %d probes",Math.round(1e4*r.d)/1e4,d)),r.max-h.d<=t||(c=r.h/2,u.push(new Pf(r.p.x-c,r.p.y-c,c,e)),u.push(new Pf(r.p.x+c,r.p.y-c,c,e)),u.push(new Pf(r.p.x-c,r.p.y+c,c,e)),u.push(new Pf(r.p.x+c,r.p.y+c,c,e)),d+=4)}return i&&(console.log(`num probes: ${d}`),console.log(`best distance: ${h.d}`)),h.p}function If(e,t){return t.max-e.max}class Pf{constructor(e,t,i,r){this.p=new V(e,t),this.h=i,this.d=function(e,t){let i=!1,r=1/0;for(let n=0;n<t.length;n++){const o=t[n];for(let t=0,n=o.length,s=n-1;t<n;s=t++){const n=o[t],a=o[s];n.y>e.y!=a.y>e.y&&e.x<(a.x-n.x)*(e.y-n.y)/(a.y-n.y)+n.x&&(i=!i),r=Math.min(r,Gl(e,n,a))}}return(i?1:-1)*Math.sqrt(r)}(this.p,r),this.max=this.d+this.h*Math.SQRT2}}const Lf=Number.POSITIVE_INFINITY,Ff=Math.sqrt(2);function kf(e,[t,i]){let r=0,n=0;if(i===Lf){t<0&&(t=0);const i=t/Ff;switch(e){case"top-right":case"top-left":n=i-7;break;case"bottom-right":case"bottom-left":n=7-i;break;case"bottom":n=7-t;break;case"top":n=t-7}switch(e){case"top-right":case"bottom-right":r=-i;break;case"top-left":case"bottom-left":r=i;break;case"left":r=t;break;case"right":r=-t}}else{switch(t=Math.abs(t),i=Math.abs(i),e){case"top-right":case"top-left":case"top":n=i-7;break;case"bottom-right":case"bottom-left":case"bottom":n=7-i}switch(e){case"top-right":case"bottom-right":case"right":r=-t;break;case"top-left":case"bottom-left":case"left":r=t}}return[r,n]}function zf(e,t,i,r,n,o,s,a){if(!e)return;const l=_p(t,i,r,n,o);return e.scaleSelf(l*a*s)}function Rf(e,t,i,r,n,o,s,a){return{iconPrimary:zf(e.getPrimary(),t,i,r,n,o,s,a),iconSecondary:zf(e.getSecondary(),t,i,r,n,o,s,a)}}function Df(e,t,i,r){if(!e)return;const n=t.get(i.toString());if(e.imagePrimary=n,r){const i=t.get(r.toString());e.imageSecondary=i}}function Of(e,t){for(const i in e.horizontal)Uf(e.horizontal[i],t);Uf(e.vertical,t)}function Uf(e,t){if(e)for(const i of e.positionedLines)for(const e of i.positionedGlyphs)if(null!==e.image){const i=e.image.toString();e.rect=t.get(i).paddedRect}}function Nf(e){switch(e){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Qf(e,t,i,r,n,o,s,a,l){const c=$f(o.horizontal)||o.vertical,u=i.get("icon-text-fit-padding").evaluate(r,{},n);let h,d=t;return t&&"none"!==l&&(e.allowVerticalPlacement&&o.vertical&&(h=Jp(t,o.vertical,l,u,a,s)),c&&(d=Jp(t,c,l,u,a,s))),{defaultShapedIcon:d,verticallyShapedIcon:h}}function jf(e,t,i,r,n,o,s,a,l,c,u,h,d,p,f,A,m,g,_,y){let v=s.textMaxSize.evaluate(t,{},d);void 0===v?v=a*s.textScaleFactor:v*=s.textScaleFactor;const x=e.layers[0].layout,b=$f(i.horizontal)||i.vertical,w="globe"===p.name,T=mp,B=e.tilePixelRatio*v/T,C=(L=e.overscaling,e.zoom>18&&L>2&&(L>>=1),Math.max(Xi/(512*L),1)*x.get("symbol-spacing")),S=x.get("text-padding")*e.tilePixelRatio,E=x.get("icon-padding")*e.tilePixelRatio,M=Z(x.get("text-max-angle")),I="map"===x.get("icon-rotation-alignment")&&"point"!==y,P=C/2;var L;!1===e.hasAnyIconTextFit&&"none"!==m&&(e.hasAnyIconTextFit=!0);const F=t.properties?+t.properties[ah]:null,k=F&&e.elevationFeatureIdToIndex?e.elevationFeatureIdToIndex.get(F):65535,z=(a,l,y)=>{if(l.x<0||l.x>=Xi||l.y<0||l.y>=Xi)return;let v=null;if(w){const{x:e,y:t,z:i}=p.projectTilePoint(l.x,l.y,y);v={anchor:new ef(e,t,i,0,void 0),up:p.upVector(y,l.x,l.y)}}!function(e,t,i,r,n,o,s,a,l,c,u,h,d,p,f,A,m,g,_,y,v,x,b,w,T,B,C,S,E){const M=e.addToLineVertexArray(t,r);let I,P,L,F,k,z,R,D=0,O=0,U=0,N=0,Q=-1,j=-1;const V={};let H=mt("");const G=i?i.anchor:t,$="none"!==S;let Z=0,q=0;if(void 0===l._unevaluatedLayout.getValue("text-radial-offset")?[Z,q]=l.layout.get("text-offset").evaluate(v,{},T).map((e=>e*mp)):(Z=l.layout.get("text-radial-offset").evaluate(v,{},T)*mp,q=Lf),e.allowVerticalPlacement&&n.vertical){const e=n.vertical;if(f)z=qf(e),a&&(R=qf(a));else{const i=l.layout.get("text-rotate").evaluate(v,{},T)+90;L=Zf(c,G,t,u,h,d,e,p,i,A),a&&(F=Zf(c,G,t,u,h,d,a,g,i))}}if(o){const r=e.iconSizeData,n=l.layout.get("icon-rotate").evaluate(v,{},T),s=wf(o,n,b,$,x.iconScaleFactor),p=a?wf(a,n,b,$,x.iconScaleFactor):void 0;P=Zf(c,G,t,u,h,d,o,g,n,null),D=4*s.length;let f=null;"source"===r.kind?(f=[gp*l.layout.get("icon-size").evaluate(v,{},T)*x.iconScaleFactor],f[0]>Hf&&de(`${e.layerIds[0]}: Value for "icon-size" is >= ${Vf}. Reduce your "icon-size".`)):"composite"===r.kind&&(f=[gp*x.compositeIconSizes[0].evaluate(v,{},T)*x.iconScaleFactor,gp*x.compositeIconSizes[1].evaluate(v,{},T)*x.iconScaleFactor],(f[0]>Hf||f[1]>Hf)&&de(`${e.layerIds[0]}: Value for "icon-size" is >= ${Vf}. Reduce your "icon-size".`)),e.addSymbols(e.icon,s,f,y,_,v,!1,i,t,M.lineStartIndex,M.lineLength,-1,w,T,B,C),Q=e.icon.placedSymbolArray.length-1,p&&(O=4*p.length,e.addSymbols(e.icon,p,f,y,_,v,Up.vertical,i,t,M.lineStartIndex,M.lineLength,-1,w,T,B,C),j=e.icon.placedSymbolArray.length-1)}for(const r in n.horizontal){const o=n.horizontal[r];I||(H=mt(o.text),f?k=qf(o):I=Zf(c,G,t,u,h,d,o,p,l.layout.get("text-rotate").evaluate(v,{},T),A));const a=1===o.positionedLines.length;if(U+=Gf(e,i,t,o,s,l,f,v,A,M,n.vertical?Up.horizontal:Up.horizontalOnly,a?Object.keys(n.horizontal):[r],V,Q,x,w,T,B),a)break}n.vertical&&(N+=Gf(e,i,t,n.vertical,s,l,f,v,A,M,Up.vertical,["vertical"],V,j,x,w,T,B));let K=-1;const W=(e,t)=>e?Math.max(e,t):t;K=W(k,K),K=W(z,K),K=W(R,K);const X=K>-1?1:0;e.glyphOffsetArray.length>=65535&&de("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==v.sortKey&&e.addToSortKeyRanges(e.symbolInstances.length,v.sortKey),e.symbolInstances.emplaceBack(t.x,t.y,G.x,G.y,G.z,V.right>=0?V.right:-1,V.center>=0?V.center:-1,V.left>=0?V.left:-1,V.vertical>=0?V.vertical:-1,Q,j,H,void 0!==I?I:e.collisionBoxArray.length,void 0!==I?I+1:e.collisionBoxArray.length,void 0!==L?L:e.collisionBoxArray.length,void 0!==L?L+1:e.collisionBoxArray.length,void 0!==P?P:e.collisionBoxArray.length,void 0!==P?P+1:e.collisionBoxArray.length,F||e.collisionBoxArray.length,F?F+1:e.collisionBoxArray.length,u,U,N,D,O,X,0,Z,q,K,0,$?1:0,E)}(e,l,v,a,i,r,o,n,e.layers[0],e.collisionBoxArray,t.index,t.sourceLayerIndex,e.index,S,_,c,0,E,I,g,t,s,u,h,d,f,A,m,k)};if("line"===y)for(const n of cf(t.geometry,0,0,Xi,Xi)){const t=af(n,C,M,i.vertical||b,r,T,B,e.overscaling,Xi);for(const i of t)b&&Kf(e,b.text,P,i)||z(n,i,d)}else if("line-center"===y){for(const e of t.geometry)if(e.length>1){const t=sf(e,M,i.vertical||b,r,T,B);t&&z(e,t,d)}}else if("Polygon"===t.type)for(const e of Hu(t.geometry,0)){const t=Mf(e,16);z(e[0],new ef(t.x,t.y,0,0,void 0),d)}else if("LineString"===t.type)for(const e of t.geometry)z(e,new ef(e[0].x,e[0].y,0,0,void 0),d);else if("Point"===t.type)for(const e of t.geometry)for(const t of e)z([t],new ef(t.x,t.y,0,0,void 0),d)}const Vf=255,Hf=Vf*gp;function Gf(e,t,i,r,n,o,s,a,l,c,u,h,d,p,f,A,m,g){const _=function(e,t,i,r,n,o,s,a){const l=[];if(0===t.positionedLines.length)return l;const c=r.layout.get("text-rotate").evaluate(o,{})*Math.PI/180,u=function(e){const t=e[0],i=e[1],r=t*i;return r>0?[t,-i]:r<0?[-t,i]:0===t?[i,t]:[i,-t]}(i);let h=Math.abs(t.top-t.bottom);for(const e of t.positionedLines)h-=e.lineOffset;const d=t.positionedLines.length,p=h/d;let f=t.top-i[1];for(let e=0;e<d;++e){const r=t.positionedLines[e];f=Ef(t,p,f,e);for(const e of r.positionedGlyphs){if(!e.rect)continue;const r=e.rect||{};let o=Op+1,h=!0,d=1,p=0;if(e.image){const t=s.get(e.image.toString());if(!t)continue;if(t.sdf){de("SDF images are not supported in formatted text and will be ignored.");continue}h=!1,d=t.pixelRatio,o=hf/d}const A=(n||a)&&e.vertical,m=e.metrics.advance*e.scale/2,g=e.metrics,_=e.rect;if(null===_)continue;a&&t.verticalizable&&(p=e.image?m-e.metrics.width*e.scale/2:0);const y=n?[e.x+m,e.y]:[0,0];let v=[0,0],x=[0,0],b=!1;n||(A?(x=[e.x+m+u[0],e.y+u[1]-p],b=!0):v=[e.x+m+i[0],e.y+i[1]-p]);const w=_.w*e.scale/(d*(e.localGlyph?_f:1)),T=_.h*e.scale/(d*(e.localGlyph?_f:1));let B,C,S,E;if(A){const t=e.y-f,i=new V(-m,m-t),r=-Math.PI/2,n=new V(...x);B=new V(-m+v[0],v[1]),B._rotateAround(r,i)._add(n),B.x+=-t+m,B.y-=(g.left-o)*e.scale;const s=e.image?g.advance*e.scale:mp*e.scale,a=String.fromCodePoint(e.glyph);Bp(a)?B.x+=(1-o)*e.scale:Cp(a)?B.x+=s-g.height*e.scale+(-o-1)*e.scale:B.x+=e.image||g.width+2*o===_.w&&g.height+2*o===_.h?(s-T)/2:(s-(g.height+2*o)*e.scale)/2,C=new V(B.x,B.y-w),S=new V(B.x+T,B.y),E=new V(B.x+T,B.y-w)}else{const t=(g.left-o)*e.scale-m+v[0],i=(-g.top-o)*e.scale+v[1],r=t+w,n=i+T;B=new V(t,i),C=new V(r,i),S=new V(t,n),E=new V(r,n)}if(c){let e;e=n?new V(0,0):b?new V(u[0],u[1]):new V(i[0],i[1]),B._rotateAround(c,e),C._rotateAround(c,e),S._rotateAround(c,e),E._rotateAround(c,e)}const M=new V(0,0),I=new V(0,0);l.push({tl:B,tr:C,bl:S,br:E,texPrimary:r,texSecondary:void 0,writingMode:t.writingMode,glyphOffset:y,sectionIndex:e.sectionIndex,isSDF:h,pixelOffsetTL:M,pixelOffsetBR:I,minFontScaleX:0,minFontScaleY:0})}}return l}(0,r,l,o,s,a,n,e.allowVerticalPlacement),y=e.textSizeData;let v=null;"source"===y.kind?(v=[gp*o.layout.get("text-size").evaluate(a,{},m)*f.textScaleFactor],v[0]>Hf&&de(`${e.layerIds[0]}: Value for "text-size" is >= ${Vf}. Reduce your "text-size".`)):"composite"===y.kind&&(v=[gp*f.compositeTextSizes[0].evaluate(a,{},m)*f.textScaleFactor,gp*f.compositeTextSizes[1].evaluate(a,{},m)*f.textScaleFactor],(v[0]>Hf||v[1]>Hf)&&de(`${e.layerIds[0]}: Value for "text-size" is >= ${Vf}. Reduce your "text-size".`)),e.addSymbols(e.text,_,v,l,s,a,u,t,i,c.lineStartIndex,c.lineLength,p,A,m,g,!1);for(const t of h)d[t]=e.text.placedSymbolArray.length-1;return 4*_.length}function $f(e){for(const t in e)return e[t];return null}function Zf(e,t,i,r,n,o,s,a,l,c){let u=s.top,h=s.bottom,d=s.left,p=s.right;const f=s.collisionPadding;if(f&&(d-=f[0],u-=f[1],p+=f[2],h+=f[3]),l){const e=new V(d,u),t=new V(p,u),i=new V(d,h),r=new V(p,h),n=Z(l);let o=new V(0,0);c&&(o=new V(c[0],c[1])),e._rotateAround(n,o),t._rotateAround(n,o),i._rotateAround(n,o),r._rotateAround(n,o),d=Math.min(e.x,t.x,i.x,r.x),p=Math.max(e.x,t.x,i.x,r.x),u=Math.min(e.y,t.y,i.y,r.y),h=Math.max(e.y,t.y,i.y,r.y)}return e.emplaceBack(t.x,t.y,t.z,i.x,i.y,d,u,p,h,a,r,n,o),e.length-1}function qf(e){e.collisionPadding&&(e.top-=e.collisionPadding[1],e.bottom+=e.collisionPadding[3]);const t=e.bottom-e.top;return t>0?Math.max(10,t):null}function Kf(e,t,i,r){const n=e.compareText;if(t in n){const e=n[t];for(let t=e.length-1;t>=0;t--)if(r.dist(e[t])<i)return!0}else n[t]=[];return n[t].push(r),!1}function Wf(e,t){const i=e.fovAboveCenter,r=e.elevation?e.elevation.getMinElevationBelowMSL()*t:0,n=(e._camera.position[2]*e.worldSize-r)/Math.cos(e._pitch),o=Math.sin(i)*n/Math.sin(Math.max(Math.PI/2-e._pitch-i,.01));let s=Math.sin(e._pitch)*o+n;const a=n*(1/e._horizonShift);if(!e.elevation||0===e.elevation.exaggeration()){let t=Math.max(e.zoom-17,0);e.isOrthographic&&(t/=10),s*=1+t}return Math.min(1.01*s,a)}function Xf(e,t){if(!t.isReprojectedInTileSpace)return{scale:1<<e.z,x:e.x,y:e.y,x2:e.x+1,y2:e.y+1,projection:t};const i=Math.pow(2,-e.z),r=e.x*i,n=(e.x+1)*i,o=e.y*i,s=(e.y+1)*i,a=gl(r),l=gl(n),c=_l(o),u=_l(s),h=t.project(a,c),d=t.project(l,c),p=t.project(l,u),f=t.project(a,u);let A=Math.min(h.x,d.x,p.x,f.x),m=Math.min(h.y,d.y,p.y,f.y),g=Math.max(h.x,d.x,p.x,f.x),_=Math.max(h.y,d.y,p.y,f.y);const y=i/16;function v(e,i,r,n,o,s){const a=(r+o)/2,l=(n+s)/2,c=t.project(gl(a),_l(l)),u=Math.max(0,A-c.x,m-c.y,c.x-g,c.y-_);A=Math.min(A,c.x),g=Math.max(g,c.x),m=Math.min(m,c.y),_=Math.max(_,c.y),u>y&&(v(e,c,r,n,a,l),v(c,i,a,l,o,s))}v(h,d,r,o,n,o),v(d,p,n,o,n,s),v(p,f,n,s,r,s),v(f,h,r,s,r,o),A-=y,m-=y,g+=y,_+=y;const x=1/Math.max(g-A,_-m);return{scale:x,x:A*x,y:m*x,x2:g*x,y2:_*x,projection:t}}function Yf(e,{x:t,y:i},r=0){return new V(((t-r)*e.scale-e.x)*Xi,(i*e.scale-e.y)*Xi)}const Jf=U.mat4.identity(new Float32Array(16));class eA{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,t){return{x:0,y:0,z:0}}unproject(e,t){return new cl(0,0)}projectTilePoint(e,t,i){return{x:e,y:t,z:0}}locationPoint(e,t,i,r=!0){return e._coordinatePoint(e.locationCoordinate(t,i),r)}pixelsPerMeter(e,t){return ml(1,e)*t}pixelSpaceConversion(e,t,i){return 1}farthestPixelDistance(e){return Wf(e,e.pixelsPerMeter)}pointCoordinate(e,t,i,r){const n=e.horizonLineFromTop(!1),o=new V(t,Math.max(n,i));return e.rayIntersectionCoordinate(e.pointRayIntersection(o,r))}pointCoordinate3D(e,t,i){const r=new V(t,i);if(e.elevation)return e.elevation.pointCoordinate(r);{const t=this.pointCoordinate(e,r.x,r.y,0);return[t.x,t.y,t.z]}}isPointAboveHorizon(e,t){if(e.elevation&&e.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(e,t.x,t.y);const i=e.horizonLineFromTop();return t.y<i}createInversionMatrix(e,t){return Jf}createTileMatrix(e,t,i){let r,n,o;const s=i.canonical,a=U.mat4.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){const l=Xf(s,this);r=1,n=l.x+i.wrap*l.scale,o=l.y,U.mat4.scale(a,a,[r/l.scale,r/l.scale,e.pixelsPerMeter/t])}else r=t/e.zoomScale(s.z),n=(s.x+Math.pow(2,s.z)*i.wrap)*r,o=s.y*r;return U.mat4.translate(a,a,[n,o,0]),U.mat4.scale(a,a,[r/Xi,r/Xi,1]),a}upVector(e,t,i){return[0,0,1]}upVectorScale(e,t,i){return{metersToTile:1}}}class tA extends eA{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[t,i]=this.parallels=e.parallels||[29.5,45.5],r=Math.sin(Z(t));this.n=(r+Math.sin(Z(i)))/2,this.c=1+r*(2*this.n-r),this.r0=Math.sqrt(this.c)/this.n}project(e,t){const{n:i,c:r,r0:n}=this,o=Z(e-this.center[0]),s=Z(t),a=Math.sqrt(r-2*i*Math.sin(s))/i;return{x:a*Math.sin(o*i),y:a*Math.cos(o*i)-n,z:0}}unproject(e,t){const{n:i,c:r,r0:n}=this,o=n+t;let s=Math.atan2(e,Math.abs(o))*Math.sign(o);o*i<0&&(s-=Math.PI*Math.sign(e)*Math.sign(o));const a=Z(this.center[0])*i;s=te(s,-Math.PI-a,Math.PI-a);const l=J(q(s/i)+this.center[0],-180,180),c=Math.asin(J((r-(e*e+o*o)*i*i)/(2*i),-1,1)),u=J(q(c),-vl,vl);return new cl(l,u)}}const iA=1.340264,rA=-.081106,nA=893e-6,oA=.003796,sA=Math.sqrt(3)/2;class aA extends eA{project(e,t){t=t/180*Math.PI,e=e/180*Math.PI;const i=Math.asin(sA*Math.sin(t)),r=i*i,n=r*r*r;return{x:.5*(e*Math.cos(i)/(sA*(iA+3*rA*r+n*(7*nA+9*oA*r)))/Math.PI+.5),y:1-.5*(i*(iA+rA*r+n*(nA+oA*r))/Math.PI+1),z:0}}unproject(e,t){e=(2*e-.5)*Math.PI;let i=t=(2*(1-t)-1)*Math.PI,r=i*i,n=r*r*r;for(let e,o,s,a=0;a<12&&(o=i*(iA+rA*r+n*(nA+oA*r))-t,s=iA+3*rA*r+n*(7*nA+9*oA*r),e=o/s,i=J(i-e,-Math.PI/3,Math.PI/3),r=i*i,n=r*r*r,!(Math.abs(e)<1e-12));++a);const o=sA*e*(iA+3*rA*r+n*(7*nA+9*oA*r))/Math.cos(i),s=Math.asin(Math.sin(i)/sA),a=J(180*o/Math.PI,-180,180),l=J(180*s/Math.PI,-vl,vl);return new cl(a,l)}}class lA extends eA{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,t){return{x:.5+e/360,y:.5-t/360,z:0}}unproject(e,t){const i=360*(e-.5),r=J(360*(.5-t),-vl,vl);return new cl(i,r)}}const cA=Math.PI/2;function uA(e){return Math.tan((cA+e)/2)}class hA extends eA{constructor(e){super(e),this.center=e.center||[0,30];const[t,i]=this.parallels=e.parallels||[30,30];let r=Z(t),n=Z(i);this.southernCenter=r+n<0,this.southernCenter&&(r=-r,n=-n);const o=Math.cos(r),s=uA(r);this.n=r===n?Math.sin(r):Math.log(o/Math.cos(n))/Math.log(uA(n)/s),this.f=o*Math.pow(uA(r),this.n)/this.n}project(e,t){t=Z(t),this.southernCenter&&(t=-t),e=Z(e-this.center[0]);const i=1e-6,{n:r,f:n}=this;n>0?t<-cA+i&&(t=-cA+i):t>cA-i&&(t=cA-i);const o=n/Math.pow(uA(t),r);let s=o*Math.sin(r*e),a=n-o*Math.cos(r*e);return s=.5*(s/Math.PI+.5),a=.5*(a/Math.PI+.5),{x:s,y:this.southernCenter?a:1-a,z:0}}unproject(e,t){e=(2*e-.5)*Math.PI,this.southernCenter&&(t=1-t),t=(2*(1-t)-.5)*Math.PI;const{n:i,f:r}=this,n=r-t,o=Math.sign(n),s=Math.sign(i)*Math.sqrt(e*e+n*n);let a=Math.atan2(e,Math.abs(n))*o;n*i<0&&(a-=Math.PI*Math.sign(e)*o);const l=J(q(a/i)+this.center[0],-180,180),c=J(q(2*Math.atan(Math.pow(r/s,1/i))-cA),-vl,vl);return new cl(l,this.southernCenter?-c:c)}}class dA extends eA{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,t){return{x:fl(e),y:Al(t),z:0}}unproject(e,t){const i=gl(e),r=_l(t);return new cl(i,r)}}const pA=Z(vl);class fA extends eA{project(e,t){const i=(t=Z(t))*t,r=i*i;return{x:.5*((e=Z(e))*(.8707-.131979*i+r*(r*(.003971*i-.001529*r)-.013791))/Math.PI+.5),y:1-.5*(t*(1.007226+i*(.015085+r*(.028874*i-.044475-.005916*r)))/Math.PI+1),z:0}}unproject(e,t){e=(2*e-.5)*Math.PI;let i=t=(2*(1-t)-1)*Math.PI,r=25,n=0,o=i*i;do{o=i*i;const e=o*o;n=(i*(1.007226+o*(.015085+e*(.028874*o-.044475-.005916*e)))-t)/(1.007226+o*(.045255+e*(.259866*o-.311325-.005916*11*e))),i=J(i-n,-pA,pA)}while(Math.abs(n)>1e-6&&--r>0);o=i*i;const s=J(q(e/(.8707+o*(o*(o*o*o*(.003971-.001529*o)-.013791)-.131979))),-180,180),a=q(i);return new cl(s,a)}}const AA=Z(vl);class mA extends eA{project(e,t){t=Z(t),e=Z(e);const i=Math.cos(t),r=2/Math.PI,n=Math.acos(i*Math.cos(e/2)),o=Math.sin(n)/n,s=.5*(e*r+2*i*Math.sin(e/2)/o)||0,a=.5*(t+Math.sin(t)/o)||0;return{x:.5*(s/Math.PI+.5),y:1-.5*(a/Math.PI+1),z:0}}unproject(e,t){let i=e=(2*e-.5)*Math.PI,r=t=(2*(1-t)-1)*Math.PI,n=25;const o=1e-6;let s=0,a=0;do{const n=Math.cos(r),o=Math.sin(r),l=2*o*n,c=o*o,u=n*n,h=Math.cos(i/2),d=Math.sin(i/2),p=2*h*d,f=d*d,A=1-u*h*h,m=A?1/A:0,g=A?Math.acos(n*h)*Math.sqrt(1/A):0,_=.5*(2*g*n*d+2*i/Math.PI)-e,y=.5*(g*o+r)-t,v=.5*m*(u*f+g*n*h*c)+1/Math.PI,x=m*(p*l/4-g*o*d),b=.125*m*(l*d-g*o*u*p),w=.5*m*(c*h+g*f*n)+.5,T=x*b-w*v;s=(y*x-_*w)/T,a=(_*b-y*v)/T,i=J(i-s,-Math.PI,Math.PI),r=J(r-a,-AA,AA)}while((Math.abs(s)>o||Math.abs(a)>o)&&--n>0);return new cl(q(i),q(r))}}class gA extends eA{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Z(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,t){const{scale:i,cosPhi:r}=this;return{x:Z(e)*r*i+.5,y:-Math.sin(Z(t))/r*i+.5,z:0}}unproject(e,t){const{scale:i,cosPhi:r}=this,n=-(t-.5)/i,o=J(q((e-.5)/i)/r,-180,180),s=Math.asin(J(n*r,-1,1)),a=J(q(s),-vl,vl);return new cl(o,a)}}class _A extends dA{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,t,i){const r=Rc(e,t,i),n=Uc(Ic(i));return U.vec3.transformMat4(r,r,n),{x:r[0],y:r[1],z:r[2]}}locationPoint(e,t,i){const r=sl(t.lat,t.lng),n=U.vec3.normalize([],r),o=i?e._centerAltitude+i:e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(t),e._centerAltitude):e._centerAltitude,s=ml(1,0)*Xi*o;U.vec3.scaleAndAdd(r,r,n,s);const a=U.mat4.identity(new Float64Array(16));return U.mat4.multiply(a,e.pixelMatrix,e.globeMatrix),U.vec3.transformMat4(r,r,a),new V(r[0],r[1])}pixelsPerMeter(e,t){return ml(1,0)*t}pixelSpaceConversion(e,t,i){const r=ml(1,e)*t,n=Et(ml(1,45)*t,r,i);return this.pixelsPerMeter(e,t)/n}createTileMatrix(e,t,i){const r=Nc(Ic(i.canonical));return U.mat4.multiply(new Float64Array(16),e.globeMatrix,r)}createInversionMatrix(e,t){const{center:i}=e,r=Uc(Ic(t));return U.mat4.rotateY(r,r,Z(i.lng)),U.mat4.rotateX(r,r,Z(i.lat)),U.mat4.scale(r,r,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(r)}pointCoordinate(e,t,i,r){return Sc(e,t,i,!0)||new Bl(0,0)}pointCoordinate3D(e,t,i){const r=this.pointCoordinate(e,t,i,0);return[r.x,r.y,r.z]}isPointAboveHorizon(e,t){return!Sc(e,t.x,t.y,!1)}farthestPixelDistance(e){const t=function(e,t){const i=e.cameraToCenterDistance,r=e._centerAltitude*t,n=e._camera,o=e._camera.forward(),s=U.vec3.add([],U.vec3.scale([],o,-i),[0,0,r]),a=e.worldSize/(2*Math.PI),l=[0,0,-a],c=e.width/e.height,u=Math.tan(e.fovAboveCenter),h=U.vec3.scale([],n.up(),u),d=U.vec3.scale([],n.right(),u*c),p=U.vec3.normalize([],U.vec3.add([],U.vec3.add([],o,h),d)),f=[];let A;if(new gc(s,p).closestPointOnSphere(l,a,f)){const t=U.vec3.add([],f,l),i=U.vec3.sub([],t,s);A=Math.cos(e.fovAboveCenter)*U.vec3.length(i)}else{const e=U.vec3.sub([],s,l),t=U.vec3.sub([],l,s);U.vec3.normalize(t,t);const i=U.vec3.length(e)-a;A=Math.sqrt(i*(i+2*a));const r=Math.acos(A/(a+i))-Math.acos(U.vec3.dot(o,t));A*=Math.cos(r)}return 1.01*A}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),i=Hc(e.zoom);if(i>0){const r=Wf(e,ml(1,e.center.lat)*e.worldSize),n=e.worldSize/(2*Math.PI),o=Math.max(e.width,e.height)/e.worldSize*Math.PI;return Et(t,r+n*(1-Math.cos(o)),Math.pow(i,10))}return t}upVector(e,t,i){return Rc(t,i,e,1)}upVectorScale(e){return{metersToTile:Bc(Dc(Ic(e)))}}}function yA(e){const t=e.parallels,i=!!t&&Math.abs(t[0]+t[1])<.01;switch(e.name){case"mercator":return new dA(e);case"equirectangular":return new lA(e);case"naturalEarth":return new fA(e);case"equalEarth":return new aA(e);case"winkelTripel":return new mA(e);case"albers":return i?new gA(e):new tA(e);case"lambertConformalConic":return i?new gA(e):new hA(e);case"globe":return new _A(e)}throw new Error(`Invalid projection name: ${e.name}`)}const vA=sh.VectorTileFeature.types,xA=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function bA(e,t,i,r,n,o,s,a,l,c,u,h,d){const p=a?Math.min(Hf,Math.round(a[0])):0,f=a?Math.min(Hf,Math.round(a[1])):0;e.emplaceBack(t,i,Math.round(32*r),Math.round(32*n),o,s,(p<<1)+(l?1:0),f,16*c,16*u,256*h,256*d)}function wA(e,t,i){e.emplaceBack(t,i)}function TA(e,t,i,r,n,o,s){e.emplaceBack(t,i,r,n,o,s)}function BA(e,t,i,r,n){e.emplaceBack(t,i,r,n),e.emplaceBack(t,i,r,n),e.emplaceBack(t,i,r,n),e.emplaceBack(t,i,r,n)}function CA(e){for(const t of e.sections)if(To(t.text))return!0;return!1}class SA{constructor(e){this.layoutVertexArray=new ks,this.indexArray=new Vs,this.programConfigurations=e,this.segments=new _a,this.dynamicLayoutVertexArray=new Rs,this.opacityVertexArray=new Ds,this.placedSymbolArray=new sa,this.iconTransitioningVertexArray=new Os,this.globeExtVertexArray=new zs,this.zOffsetVertexArray=new Bs}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length&&0===this.iconTransitioningVertexArray.length}upload(e,t,i,r,n){this.isEmpty()||(i&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,ap.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,t),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,cp.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,xA,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,hp.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,lp.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||n)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,up.members,!0)),this.opacityVertexBuffer.itemSize=1),(i||r)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}co(SA,"SymbolBuffers");class EA{constructor(e,t,i){this.layoutVertexArray=new e,this.layoutAttributes=t,this.indexArray=new i,this.segments=new _a,this.collisionVertexArray=new js,this.collisionVertexArrayExt=new Rs}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,dp.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,pp.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}co(EA,"CollisionBuffers");class MA{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.lut=e.lut,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.fqid)),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=U.mat4.identity([]),this.placementViewportMatrix=U.mat4.identity([]);const t=this.layers[0]._unevaluatedLayout._values;this.textSizeData=yp(this.zoom,t["text-size"]),this.iconSizeData=yp(this.zoom,t["icon-size"]);const i=this.layers[0].layout,r=i.get("symbol-sort-key"),n=i.get("symbol-z-order");this.canOverlap=i.get("text-allow-overlap")||i.get("icon-allow-overlap")||i.get("text-ignore-placement")||i.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==n&&void 0!==r.constantOr(1),this.sortFeaturesByY=("viewport-y"===n||"auto"===n&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=i.get("text-writing-mode").map((e=>Up[e])),this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id)),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=!1,this.elevationType="none",this.elevationStateComplete=!1,this.activeReplacements=[],this.replacementUpdateTime=0}createArrays(){this.text=new SA(new Ga(this.layers,{zoom:this.zoom,lut:this.lut},(e=>e.startsWith("text")||e.startsWith("symbol")))),this.icon=new SA(new Ga(this.layers,{zoom:this.zoom,lut:this.lut},(e=>e.startsWith("icon")||e.startsWith("symbol")))),this.glyphOffsetArray=new ca,this.lineVertexArray=new ua,this.symbolInstances=new la}calculateGlyphDependencies(e,t,i,r,n){for(const i of e){const e=i.codePointAt(0);if(void 0===e)break;if(t[e]=!0,r&&n&&e<=65535){const e=Tp[i];e&&(t[e.charCodeAt(0)]=!0)}}}updateFootprints(e,t){}updateReplacement(e,t){if(t.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=t.updateTime;const i=t.getReplacementRegionsForTile(e.toUnwrapped(),!0);return!$h(this.activeReplacements,i)&&(this.activeReplacements=i,!0)}populate(e,t,i,r){const n=this.layers[0],o=n.layout,s="globe"===this.projection.name,a=o.get("text-font"),l=o.get("text-field"),c=o.get("icon-image"),[u,h]=o.get("icon-size-scale-range"),d=J(t.scaleFactor||1,u,h),p=("constant"!==l.value.kind||l.value.value instanceof Jt&&!l.value.value.isEmpty()||l.value.value.toString().length>0)&&("constant"!==a.value.kind||a.value.value.length>0),f="constant"!==c.value.kind||!!c.value.value||Object.keys(c.parameters).length>0,A=o.get("symbol-sort-key");if(this.features=[],!p&&!f)return;const m=t.iconDependencies,g=t.glyphDependencies,_=t.availableImages,y=new Do(this.zoom);for(const{feature:t,id:l,index:c,sourceLayerIndex:u}of e){const e=n._featureFilter.needGeometry,h=kl(t,e);if(!n._featureFilter.filter(y,h,i))continue;if(e||(h.geometry=Fl(t,i,r)),s&&1!==t.type&&i.z<=5){const e=h.geometry,t=.98078528056,r=(e,r)=>{const n=Rc(e.x,e.y,i,1),o=Rc(r.x,r.y,i,1);return U.vec3.dot(n,o)<t};for(let t=0;t<e.length;t++)e[t]=Ml(e[t],r)}let v,x;if(p){const e=n.getValueAndResolveTokens("text-field",h,i,_),t=Jt.factory(e);CA(t)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===ko()||this.hasRTLText&&Ro.isParsed())&&(v=wp(t,n,h))}if(f){const e=n.getValueAndResolveTokens("icon-image",h,i,_);x=e instanceof ti?e:ti.build(e)}if(!v&&!x)continue;const b=this.sortFeaturesByKey?A.evaluate(h,{},i):void 0,w={id:l,text:v,icon:x,index:c,sourceLayerIndex:u,geometry:h.geometry,properties:t.properties,type:vA[t.type],sortKey:b};if(this.features.push(w),x){const e=this.layers[0]._unevaluatedLayout._values,{iconPrimary:t,iconSecondary:r}=Rf(x,this.iconSizeData,e["icon-size"],i,this.zoom,w,this.pixelRatio,d),n=t.id.toString();if(m.has(n)?m.get(n).push(t):m.set(n,[t]),r){const e=r.id.toString();m.has(e)?m.get(e).push(r):m.set(e,[r])}}if(v){const e=a.evaluate(h,{},i).join(","),t="map"===o.get("text-rotation-alignment")&&"point"!==o.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Up.vertical)>=0;for(const i of v.sections)if(i.image){const e=i.image.getPrimary().scaleSelf(this.pixelRatio),t=e.id.toString(),r=m.get(t)||[];r.push(e),m.set(t,r)}else{const r=mo(v.toString()),n=i.fontStack||e,o=g[n]=g[n]||{};this.calculateGlyphDependencies(i.text,o,t,this.allowVerticalPlacement,r)}}}if("line"===o.get("symbol-placement")&&(this.features=function(e){const t={},i={},r=[];let n=0;function o(t){r.push(e[t]),n++}function s(e,t,n){const o=i[e];return delete i[e],i[t]=o,r[o].geometry[0].pop(),r[o].geometry[0]=r[o].geometry[0].concat(n[0]),o}function a(e,i,n){const o=t[i];return delete t[i],t[e]=o,r[o].geometry[0].shift(),r[o].geometry[0]=n[0].concat(r[o].geometry[0]),o}function l(e,t,i){const r=i?t[0][t[0].length-1]:t[0][0];return`${e}:${r.x}:${r.y}`}for(let c=0;c<e.length;c++){const u=e[c],h=u.geometry,d=u.text?u.text.toString():null;if(!d){o(c);continue}const p=l(d,h),f=l(d,h,!0);if(p in i&&f in t&&i[p]!==t[f]){const e=a(p,f,h),n=s(p,f,r[e].geometry);delete t[p],delete i[f],i[l(d,r[n].geometry,!0)]=n,r[e].geometry=null}else p in i?s(p,f,h):f in t?a(p,f,h):(o(c),t[p]=n-1,i[f]=n-1)}return r.filter((e=>e.geometry))}(this.features)),"hd-road-markup"===o.get("symbol-elevation-reference")){if(this.elevationType="road",t.elevationFeatures){!this.elevationFeatures&&t.elevationFeatures.length>0&&(this.elevationFeatures=[],this.elevationFeatureIdToIndex=new Map);for(const e of t.elevationFeatures)this.elevationFeatureIdToIndex.set(e.id,this.elevationFeatures.length),this.elevationFeatures.push(e)}}else o.get("symbol-z-elevate")&&(this.elevationType="offset");"none"!==this.elevationType&&(this.zOffsetBuffersNeedUpload=!0),this.sortFeaturesByKey&&this.features.sort(((e,t)=>e.sortKey-t.sortKey))}update(e,t,i,r,n,o,s){this.text.programConfigurations.updatePaintArrays(e,t,n,i,r,o,s),this.icon.programConfigurations.updatePaintArrays(e,t,n,i,r,o,s)}updateRoadElevation(){if("road"!==this.elevationType||!this.elevationFeatures)return;if(this.elevationStateComplete)return;this.elevationStateComplete=!0,this.hasAnyZOffset=!1;let e=!1;for(let t=0;t<this.symbolInstances.length;t++){const i=this.symbolInstances.get(t);if(65535===i.elevationFeatureIndex)continue;const r=this.elevationFeatures[i.elevationFeatureIndex];if(r){const t=.05+r.pointElevation(new V(i.tileAnchorX,i.tileAnchorY));i.zOffset!==t&&(e=!0,i.zOffset=t)}}e&&(this.zOffsetBuffersNeedUpload=!0,this.zOffsetSortDirty=!0)}updateZOffset(){const e=(e,t,r)=>{i+=t,i>e.length&&e.resize(i);for(let n=-t;n<0;n++)e.emplace(n+i,r)},t=(e,t,i)=>{r+=t,r>e.length&&e.resize(r);for(let n=-t;n<0;n++)e.emplace(n+r,i)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let i=0,r=0;for(let i=0;i<this.symbolInstances.length;i++){const r=this.symbolInstances.get(i),{numHorizontalGlyphVertices:n,numVerticalGlyphVertices:o,numIconVertices:s}=r,a=r.zOffset,l=s>0;if((n>0||o>0)&&(e(this.text.zOffsetVertexArray,n,a),e(this.text.zOffsetVertexArray,o,a)),l){const{placedIconSymbolIndex:e,verticalPlacedIconSymbolIndex:i}=r;e>=0&&t(this.icon.zOffsetVertexArray,s,a),i>=0&&t(this.icon.zOffsetVertexArray,r.numVerticalIconVertices,a)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=yA(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,t){const i=this.lineVertexArray.length;if(void 0!==e.segment)for(const{x:e,y:i}of t)this.lineVertexArray.emplaceBack(e,i);return{lineStartIndex:i,lineLength:this.lineVertexArray.length-i}}addSymbols(e,t,i,r,n,o,s,a,l,c,u,h,d,p,f,A){const m=e.indexArray,g=e.layoutVertexArray,_=e.globeExtVertexArray,y=e.segments.prepareSegment(4*t.length,g,m,this.canOverlap?o.sortKey:void 0),v=this.glyphOffsetArray.length,x=y.vertexLength,b=this.allowVerticalPlacement&&s===Up.vertical?Math.PI/2:0,w=o.text&&o.text.sections;for(let r=0;r<t.length;r++){const{tl:n,tr:s,bl:c,br:u,texPrimary:h,texSecondary:v,pixelOffsetTL:x,pixelOffsetBR:T,minFontScaleX:B,minFontScaleY:C,glyphOffset:S,isSDF:E,sectionIndex:M}=t[r],I=y.vertexLength,P=S[1];if(bA(g,l.x,l.y,n.x,P+n.y,h.x,h.y,i,E,x.x,x.y,B,C),bA(g,l.x,l.y,s.x,P+s.y,h.x+h.w,h.y,i,E,T.x,x.y,B,C),bA(g,l.x,l.y,c.x,P+c.y,h.x,h.y+h.h,i,E,x.x,T.y,B,C),bA(g,l.x,l.y,u.x,P+u.y,h.x+h.w,h.y+h.h,i,E,T.x,T.y,B,C),a){const{x:t,y:i,z:r}=a.anchor,[n,o,s]=a.up;TA(_,t,i,r,n,o,s),TA(_,t,i,r,n,o,s),TA(_,t,i,r,n,o,s),TA(_,t,i,r,n,o,s),BA(e.dynamicLayoutVertexArray,t,i,r,b)}else BA(e.dynamicLayoutVertexArray,l.x,l.y,l.z,b);if(A){const t=v||h;wA(e.iconTransitioningVertexArray,t.x,t.y),wA(e.iconTransitioningVertexArray,t.x+t.w,t.y),wA(e.iconTransitioningVertexArray,t.x,t.y+t.h),wA(e.iconTransitioningVertexArray,t.x+t.w,t.y+t.h)}m.emplaceBack(I,I+1,I+2),m.emplaceBack(I+1,I+2,I+3),y.vertexLength+=4,y.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(S[0]),r!==t.length-1&&M===t[r+1].sectionIndex||e.programConfigurations.populatePaintArrays(g.length,o,o.index,{},d,p,f,w&&w[M])}const T=a?a.anchor:l;e.placedSymbolArray.emplaceBack(T.x,T.y,T.z,l.x,l.y,v,this.glyphOffsetArray.length-v,x,c,u,l.segment,i?i[0]:0,i?i[1]:0,r[0],r[1],s,0,!1,0,h,0)}_commitLayoutVertex(e,t,i,r,n,o,s){e.emplaceBack(t,i,r,n,o,Math.round(s.x),Math.round(s.y))}_addCollisionDebugVertices(e,t,i,r,n,o,s){const a=i.segments.prepareSegment(4,i.layoutVertexArray,i.indexArray),l=a.vertexLength,c=s.tileAnchorX,u=s.tileAnchorY;for(let e=0;e<4;e++)i.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(i.collisionVertexArrayExt,t,e.padding,s.zOffset),this._commitLayoutVertex(i.layoutVertexArray,r,n,o,c,u,new V(e.x1,e.y1)),this._commitLayoutVertex(i.layoutVertexArray,r,n,o,c,u,new V(e.x2,e.y1)),this._commitLayoutVertex(i.layoutVertexArray,r,n,o,c,u,new V(e.x2,e.y2)),this._commitLayoutVertex(i.layoutVertexArray,r,n,o,c,u,new V(e.x1,e.y2)),a.vertexLength+=4;const h=i.indexArray;h.emplaceBack(l,l+1),h.emplaceBack(l+1,l+2),h.emplaceBack(l+2,l+3),h.emplaceBack(l+3,l),a.primitiveLength+=4}_addTextDebugCollisionBoxes(e,t,i,r,n,o){for(let s=r;s<n;s++){const r=i.get(s),n=this.getSymbolInstanceTextSize(e,o,t,s);this._addCollisionDebugVertices(r,n,this.textCollisionBox,r.projectedAnchorX,r.projectedAnchorY,r.projectedAnchorZ,o)}}_addIconDebugCollisionBoxes(e,t,i,r,n,o){for(let s=r;s<n;s++){const r=i.get(s),n=this.getSymbolInstanceIconSize(e,t,o.placedIconSymbolIndex);this._addCollisionDebugVertices(r,n,this.iconCollisionBox,r.projectedAnchorX,r.projectedAnchorY,r.projectedAnchorZ,o)}}generateCollisionDebugBuffers(e,t,i){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new EA(Ns,fp.members,Os),this.iconCollisionBox=new EA(Ns,fp.members,Os);const r=xp(this.iconSizeData,e),n=xp(this.textSizeData,e,i);for(let i=0;i<this.symbolInstances.length;i++){const o=this.symbolInstances.get(i);this._addTextDebugCollisionBoxes(n,e,t,o.textBoxStartIndex,o.textBoxEndIndex,o),this._addTextDebugCollisionBoxes(n,e,t,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o),this._addIconDebugCollisionBoxes(r,e,t,o.iconBoxStartIndex,o.iconBoxEndIndex,o),this._addIconDebugCollisionBoxes(r,e,t,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex,o)}}getSymbolInstanceTextSize(e,t,i,r){const n=this.text.placedSymbolArray.get(t.rightJustifiedTextSymbolIndex>=0?t.rightJustifiedTextSymbolIndex:t.centerJustifiedTextSymbolIndex>=0?t.centerJustifiedTextSymbolIndex:t.leftJustifiedTextSymbolIndex>=0?t.leftJustifiedTextSymbolIndex:t.verticalPlacedTextSymbolIndex>=0?t.verticalPlacedTextSymbolIndex:r),o=vp(this.textSizeData,e,n)/mp;return this.tilePixelRatio*o}getSymbolInstanceIconSize(e,t,i){const r=this.icon.placedSymbolArray.get(i),n=vp(this.iconSizeData,e,r);return this.tilePixelRatio*n}_commitDebugCollisionVertexUpdate(e,t,i,r){e.emplaceBack(t,-i,-i,r),e.emplaceBack(t,i,-i,r),e.emplaceBack(t,i,i,r),e.emplaceBack(t,-i,i,r)}_updateTextDebugCollisionBoxes(e,t,i,r,n,o,s){for(let s=r;s<n;s++){const r=i.get(s),n=this.getSymbolInstanceTextSize(e,o,t,s);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,n,r.padding,o.zOffset)}}_updateIconDebugCollisionBoxes(e,t,i,r,n,o,s){for(let s=r;s<n;s++){const r=i.get(s),n=this.getSymbolInstanceIconSize(e,t,o.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,n,r.padding,o.zOffset)}}updateCollisionDebugBuffers(e,t,i,r){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const n=xp(this.iconSizeData,e,r),o=xp(this.textSizeData,e,i);for(let s=0;s<this.symbolInstances.length;s++){const a=this.symbolInstances.get(s);this._updateTextDebugCollisionBoxes(o,e,t,a.textBoxStartIndex,a.textBoxEndIndex,a,i),this._updateTextDebugCollisionBoxes(o,e,t,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a,i),this._updateIconDebugCollisionBoxes(n,e,t,a.iconBoxStartIndex,a.iconBoxEndIndex,a,r),this._updateIconDebugCollisionBoxes(n,e,t,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex,a,r)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,t,i,r,n,o,s,a,l){const c={};if(t<i){const{x1:i,y1:r,x2:n,y2:o,padding:s,projectedAnchorX:a,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:d,featureIndex:p}=e.get(t);c.textBox={x1:i,y1:r,x2:n,y2:o,padding:s,projectedAnchorX:a,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:d},c.textFeatureIndex=p}if(r<n){const{x1:t,y1:i,x2:n,y2:o,padding:s,projectedAnchorX:a,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:d,featureIndex:p}=e.get(r);c.verticalTextBox={x1:t,y1:i,x2:n,y2:o,padding:s,projectedAnchorX:a,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:d},c.verticalTextFeatureIndex=p}if(o<s){const{x1:t,y1:i,x2:r,y2:n,padding:s,projectedAnchorX:a,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:d,featureIndex:p}=e.get(o);c.iconBox={x1:t,y1:i,x2:r,y2:n,padding:s,projectedAnchorX:a,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:d},c.iconFeatureIndex=p}if(a<l){const{x1:t,y1:i,x2:r,y2:n,padding:o,projectedAnchorX:s,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:d,featureIndex:p}=e.get(a);c.verticalIconBox={x1:t,y1:i,x2:r,y2:n,padding:o,projectedAnchorX:s,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:d},c.verticalIconFeatureIndex=p}return c}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let t=0;t<this.symbolInstances.length;t++){const i=this.symbolInstances.get(t);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,i.textBoxStartIndex,i.textBoxEndIndex,i.verticalTextBoxStartIndex,i.verticalTextBoxEndIndex,i.iconBoxStartIndex,i.iconBoxEndIndex,i.verticalIconBoxStartIndex,i.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,t){const i=e.placedSymbolArray.get(t),r=i.vertexStartIndex+4*i.numGlyphs;for(let t=i.vertexStartIndex;t<r;t+=4)e.indexArray.emplaceBack(t,t+1,t+2),e.indexArray.emplaceBack(t+1,t+2,t+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const t=Math.sin(e),i=Math.cos(e),r=[],n=[],o=[];for(let e=0;e<this.symbolInstances.length;++e){o.push(e);const s=this.symbolInstances.get(e);r.push(0|Math.round(t*s.tileAnchorX+i*s.tileAnchorY)),n.push(s.featureIndex)}return o.sort(((e,t)=>r[e]-r[t]||n[t]-n[e])),o}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort(((e,t)=>this.symbolInstances.get(t).zOffset-this.symbolInstances.get(e).zOffset))}addToSortKeyRanges(e,t){const i=this.sortKeyRanges[this.sortKeyRanges.length-1];i&&i.sortKey===t?i.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:t,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const e of this.symbolInstanceIndexes){const t=this.symbolInstances.get(e);this.featureSortOrder.push(t.featureIndex);const{rightJustifiedTextSymbolIndex:i,centerJustifiedTextSymbolIndex:r,leftJustifiedTextSymbolIndex:n,verticalPlacedTextSymbolIndex:o,placedIconSymbolIndex:s,verticalPlacedIconSymbolIndex:a}=t;i>=0&&this.addIndicesForPlacedSymbol(this.text,i),r>=0&&r!==i&&this.addIndicesForPlacedSymbol(this.text,r),n>=0&&n!==r&&n!==i&&this.addIndicesForPlacedSymbol(this.text,n),o>=0&&this.addIndicesForPlacedSymbol(this.text,o),s>=0&&this.addIndicesForPlacedSymbol(this.icon,s),a>=0&&this.addIndicesForPlacedSymbol(this.icon,a)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let IA,PA,LA;co(MA,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),MA.addDynamicAttributes=BA;class FA{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:zt,this.defaultValue=e}evaluate(e){if(e.formattedSection){const t=this.defaultValue.property.overrides;if(t&&t.hasOverride(e.formattedSection))return t.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}co(FA,"FormatSectionOverride",{omit:["defaultValue"]});const kA=()=>LA||(LA={layout:IA||(IA=new Ko({"symbol-placement":new $o(Wo.layout_symbol["symbol-placement"]),"symbol-spacing":new $o(Wo.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new $o(Wo.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Zo(Wo.layout_symbol["symbol-sort-key"]),"symbol-z-order":new $o(Wo.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new $o(Wo.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new $o(Wo.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new $o(Wo.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new $o(Wo.layout_symbol["icon-ignore-placement"]),"icon-optional":new $o(Wo.layout_symbol["icon-optional"]),"icon-rotation-alignment":new $o(Wo.layout_symbol["icon-rotation-alignment"]),"icon-size":new Zo(Wo.layout_symbol["icon-size"]),"icon-size-scale-range":new $o(Wo.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new Zo(Wo.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Zo(Wo.layout_symbol["icon-text-fit-padding"]),"icon-image":new Zo(Wo.layout_symbol["icon-image"]),"icon-rotate":new Zo(Wo.layout_symbol["icon-rotate"]),"icon-padding":new $o(Wo.layout_symbol["icon-padding"]),"icon-keep-upright":new $o(Wo.layout_symbol["icon-keep-upright"]),"icon-offset":new Zo(Wo.layout_symbol["icon-offset"]),"icon-anchor":new Zo(Wo.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new $o(Wo.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new $o(Wo.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new $o(Wo.layout_symbol["text-rotation-alignment"]),"text-field":new Zo(Wo.layout_symbol["text-field"]),"text-font":new Zo(Wo.layout_symbol["text-font"]),"text-size":new Zo(Wo.layout_symbol["text-size"]),"text-size-scale-range":new $o(Wo.layout_symbol["text-size-scale-range"]),"text-max-width":new Zo(Wo.layout_symbol["text-max-width"]),"text-line-height":new Zo(Wo.layout_symbol["text-line-height"]),"text-letter-spacing":new Zo(Wo.layout_symbol["text-letter-spacing"]),"text-justify":new Zo(Wo.layout_symbol["text-justify"]),"text-radial-offset":new Zo(Wo.layout_symbol["text-radial-offset"]),"text-variable-anchor":new $o(Wo.layout_symbol["text-variable-anchor"]),"text-anchor":new Zo(Wo.layout_symbol["text-anchor"]),"text-max-angle":new $o(Wo.layout_symbol["text-max-angle"]),"text-writing-mode":new $o(Wo.layout_symbol["text-writing-mode"]),"text-rotate":new Zo(Wo.layout_symbol["text-rotate"]),"text-padding":new $o(Wo.layout_symbol["text-padding"]),"text-keep-upright":new $o(Wo.layout_symbol["text-keep-upright"]),"text-transform":new Zo(Wo.layout_symbol["text-transform"]),"text-offset":new Zo(Wo.layout_symbol["text-offset"]),"text-allow-overlap":new $o(Wo.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new $o(Wo.layout_symbol["text-ignore-placement"]),"text-optional":new $o(Wo.layout_symbol["text-optional"]),visibility:new $o(Wo.layout_symbol.visibility)})),paint:PA||(PA=new Ko({"icon-opacity":new Zo(Wo.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new Zo(Wo.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new Zo(Wo.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new Zo(Wo.paint_symbol["text-emissive-strength"]),"icon-color":new Zo(Wo.paint_symbol["icon-color"]),"icon-halo-color":new Zo(Wo.paint_symbol["icon-halo-color"]),"icon-halo-width":new Zo(Wo.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Zo(Wo.paint_symbol["icon-halo-blur"]),"icon-translate":new $o(Wo.paint_symbol["icon-translate"]),"icon-translate-anchor":new $o(Wo.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new Zo(Wo.paint_symbol["icon-image-cross-fade"]),"text-opacity":new Zo(Wo.paint_symbol["text-opacity"]),"text-occlusion-opacity":new Zo(Wo.paint_symbol["text-occlusion-opacity"]),"text-color":new Zo(Wo.paint_symbol["text-color"],{runtimeType:Ut,getOverride:e=>e.textColor,hasOverride:e=>!!e.textColor}),"text-halo-color":new Zo(Wo.paint_symbol["text-halo-color"]),"text-halo-width":new Zo(Wo.paint_symbol["text-halo-width"]),"text-halo-blur":new Zo(Wo.paint_symbol["text-halo-blur"]),"text-translate":new $o(Wo.paint_symbol["text-translate"]),"text-translate-anchor":new $o(Wo.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new $o(Wo.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new $o(Wo.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new $o(Wo.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new $o(Wo.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new Zo(Wo.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new Zo({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new Zo({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new Zo({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new Zo({type:"string",default:"default","property-type":"data-driven"})}))},LA);class zA extends ms{constructor(e,t,i,r){super(e,kA(),t,i,r),this._colorAdjustmentMatrix=U.mat4.identity([]),this.hasInitialOcclusionOpacityProperties=void 0!==e.paint&&("icon-occlusion-opacity"in e.paint||"text-occlusion-opacity"in e.paint)}recalculate(e,t){super.recalculate(e,t),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const i=this.layout.get("text-writing-mode");if(i){const e=[];for(const t of i)e.indexOf(t)<0&&e.push(t);this.layout._values["text-writing-mode"]=e}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(e,t,i,r){return this._saturation===e&&this._contrast===t&&this._brightnessMin===i&&this._brightnessMax===r||(this._colorAdjustmentMatrix=function(e,t,i,r){e=we(e),t=be(t);const n=U.mat4.create(),o=e/3,s=1-2*o,a=[s,o,o,0,o,s,o,0,o,o,s,0,0,0,0,1],l=.5-.5*t,c=r-i;return U.mat4.multiply(n,[c,0,0,0,0,c,0,0,0,0,c,0,i,i,i,1],[t,0,0,0,0,t,0,0,0,0,t,0,l,l,l,1]),U.mat4.multiply(n,n,a),n}(e,t,i,r),this._saturation=e,this._contrast=t,this._brightnessMin=i,this._brightnessMax=r),this._colorAdjustmentMatrix}getValueAndResolveTokens(e,t,i,r){const n=this.layout.get(e).evaluate(t,{},i,r),o=this._unevaluatedLayout._values[e];return o.isDataDriven()||Xn(o.value)||!n?n:function(e,t){return t.replace(/{([^{}]+)}/g,((t,i)=>i in e?String(e[i]):""))}(t.properties,n)}createBucket(e){return new MA(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of kA().paint.overridableProperties){if(!zA.hasPaintOverride(this.layout,e))continue;const t=this.paint.get(e),i=new FA(t),r=new Wn(i,t.property.specification,this.scope,this.options);let n=null;n="constant"===t.value.kind||"source"===t.value.kind?new Jn("source",r):new eo("composite",r,t.value.zoomStops,t.value._interpolationType),this.paint._values[e]=new Ho(t.property,n,t.parameters)}}_handleOverridablePaintPropertyUpdate(e,t,i){return!(!this.layout||t.isDataDriven()||i.isDataDriven())&&zA.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,t){const i=e.get("text-field"),r=kA().paint.properties[t];let n=!1;const o=e=>{for(const t of e)if(r.overrides&&r.overrides.hasOverride(t))return void(n=!0)};if("constant"===i.value.kind&&i.value.value instanceof Jt)o(i.value.value.sections);else if("source"===i.value.kind){const e=t=>{n||(t instanceof si&&ni(t.value)===Vt?o(t.value.sections):t instanceof ui?o(t.sections):t.eachChild(e))},t=i.value;t._styleExpression&&e(t._styleExpression.expression)}return n}getProgramIds(){return["symbol"]}getDefaultProgramParams(e,t,i){return{config:new Ha(this,{zoom:t,lut:i}),overrideFog:!1}}}let RA,DA,OA,UA;var NA=vs([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function QA(e){switch(e){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function jA(e){switch(e){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class VA{constructor(e,t,i,r){this.context=e,this.format=i,this.useMipmap=r&&r.useMipmap,this.texture=e.gl.createTexture(),this.update(t,{premultiply:r&&r.premultiply})}update(e,t){const i=e&&e instanceof HTMLVideoElement&&0===e.width?e.videoWidth:e.width,r=e&&e instanceof HTMLVideoElement&&0===e.height?e.videoHeight:e.height,{context:n}=this,{gl:o}=n,{x:s,y:a}=t&&t.position?t.position:{x:0,y:0},l=s+i,c=a+r;!this.size||this.size[0]===l&&this.size[1]===c||(o.bindTexture(o.TEXTURE_2D,null),o.deleteTexture(this.texture),this.texture=o.createTexture(),this.size=null),o.bindTexture(o.TEXTURE_2D,this.texture),n.pixelStoreUnpackFlipY.set(!1),n.pixelStoreUnpack.set(1),n.pixelStoreUnpackPremultiplyAlpha.set(this.format===o.RGBA8&&(!t||!1!==t.premultiply));const u=e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap;if(!this.size&&l>0&&c>0){const e=this.useMipmap?Math.floor(Math.log2(Math.max(l,c)))+1:1;o.texStorage2D(o.TEXTURE_2D,e,this.format,l,c),this.size=[l,c]}if(this.size)if(u)o.texSubImage2D(o.TEXTURE_2D,0,s,a,QA(this.format),jA(this.format),e);else{const t=e.data;t&&o.texSubImage2D(o.TEXTURE_2D,0,s,a,i,r,QA(this.format),jA(this.format),t)}this.useMipmap&&o.generateMipmap(o.TEXTURE_2D)}bind(e,t,i=!1){const{context:r}=this,{gl:n}=r;n.bindTexture(n.TEXTURE_2D,this.texture),e!==this.minFilter&&(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,e),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,this.useMipmap&&!i?e===n.NEAREST?n.NEAREST_MIPMAP_NEAREST:n.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),t!==this.wrapS&&(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,t),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,t),this.wrapS=t)}bindExtraParam(e,t,i,r){const{context:n}=this,{gl:o}=n;o.bindTexture(o.TEXTURE_2D,this.texture),t!==this.magFilter&&(o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,t),this.magFilter=t),e!==this.minFilter&&(o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,this.useMipmap?e===o.NEAREST?o.NEAREST_MIPMAP_NEAREST:o.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),i!==this.wrapS&&(o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,i),this.wrapS=i),r!==this.wrapT&&(o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,r),this.wrapT=r)}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class HA{constructor(e,t){this.context=e,this.texture=t}bind(e,t){const{context:i}=this,{gl:r}=i;r.bindTexture(r.TEXTURE_2D,this.texture),e!==this.minFilter&&(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,e),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,e),this.minFilter=e),t!==this.wrapS&&(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,t),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,t),this.wrapS=t)}}function GA(e,t,i,r,n,o,s,a){const l=[e,t,1,i,r,1,n,o,1],c=[s,a,1],u=U.mat3.adjoint([],l),[h,d,p]=U.vec3.transformMat3(c,c,u);return U.mat3.multiply(l,l,[h,0,0,0,d,0,0,0,p])}function $A(e,t,i,r,n,o,s,a){const l=function(e,t,i,r,n,o,s,a){const l=GA(0,0,1,0,1,1,0,1),c=GA(e,t,i,r,n,o,s,a),u=U.mat3.adjoint([],l);return U.mat3.multiply(c,c,u)}(e,t,i,r,n,o,s,a);return[l[2]/l[8]/Xi,l[5]/l[8]/Xi]}function ZA(e){return[e[0],Math.min(Math.max(e[1],-vl),vl)]}class qA extends xt{constructor(e,t,i,r){super(),this.id=e,this.dispatcher=i,this.coordinates=t.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(r),this.options=t,this._dirty=!1}load(e,t){if(this._loaded=t||!1,this.fire(new gt("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=lt(this.map._requestManager.transformRequest(this.url,Je.Image),((t,i)=>{this._imageRequest=null,this._loaded=!0,t?this.fire(new _t(t)):i&&(this.image=i instanceof HTMLImageElement?ke.getImageData(i):i,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())}))}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new HA(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new gt("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(e){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof HA||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let t=e[0][1],i=e[0][1];for(const r of e)r[1]>i&&(i=r[1]),r[1]<t&&(t=r[1]);const r=(i+t)/2;if(r>vl?this.onNorthPole=!0:r<-vl&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const t=e.map(Bl.fromLngLat);this.tileID=function(e){let t=1/0,i=1/0,r=-1/0,n=-1/0;for(const o of e)t=Math.min(t,o.x),i=Math.min(i,o.y),r=Math.max(r,o.x),n=Math.max(n,o.y);const o=Math.max(r-t,n-i),s=Math.max(0,Math.floor(-Math.log(o)/Math.LN2)),a=Math.pow(2,s);let l=Math.floor((t+r)/2*a);return l>1&&(l-=1),new ac(s,l,Math.floor((i+n)/2*a))}(t),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new gt("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(e){for(const e in this.tiles){const t=this.tiles[e];"loaded"!==t.state&&(t.state="loaded",t.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const t=Xf(new ac(0,0,0),this.map.transform.projection),i=[t.projection.project(this.coordinates[0][0],this.coordinates[0][1]),t.projection.project(this.coordinates[1][0],this.coordinates[1][1]),t.projection.project(this.coordinates[2][0],this.coordinates[2][1]),t.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(e){const t=e[1].x-e[0].x,i=e[1].y-e[0].y,r=e[2].x-e[1].x,n=e[2].y-e[1].y,o=e[3].x-e[2].x,s=e[3].y-e[2].y,a=e[0].x-e[3].x,l=e[0].y-e[3].y,c=t*n-r*i,u=r*s-o*n,h=o*l-a*s,d=a*i-t*l;return c>0&&u>0&&h>0&&d>0||c<0&&u<0&&h<0&&d<0}(i))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const r=Xf(this.tileID,this.map.transform.projection),[n,o,s,a]=this.coordinates.map((e=>{const t=r.projection.project(e[0],e[1]);return Yf(r,t)._round()}));this.perspectiveTransform=$A(n.x,n.y,o.x,o.y,s.x,s.y,a.x,a.y);const l=this._boundsArray=new Ts;l.emplaceBack(n.x,n.y,0,0),l.emplaceBack(o.x,o.y,Xi,0),l.emplaceBack(a.x,a.y,0,Xi),l.emplaceBack(s.x,s.y,Xi,Xi),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=e.createVertexBuffer(l,NA.members),this.boundsSegments=_a.simpleSegment(0,0,4,2);const c=[],u=[ZA((h=this.coordinates)[0]),ZA(h[1]),ZA(h[2]),ZA(h[3])];var h;const[d,p,f,A]=function(e){let t=e[0][0],i=t,r=e[0][1],n=r;for(let o=1;o<e.length;o++)e[o][0]<t?t=e[o][0]:e[o][0]>i&&(i=e[o][0]),e[o][1]<r?r=e[o][1]:e[o][1]>n&&(n=e[o][1]);return[t,r,i-t,n-r]}(u);{const r=new Ts,[n,o,s,a]=function(e){let t=e[0].x,i=t,r=e[0].y,n=r;for(let o=1;o<e.length;o++)e[o].x<t?t=e[o].x:e[o].x>i&&(i=e[o].x),e[o].y<r?r=e[o].y:e[o].y>n&&(n=e[o].y);return[t,r,i-t,n-r]}(i),l=e=>[(e.x-n)/s,(e.y-o)/a],[u,h,m,g]=i.map(l),_=function(e,t,i,r,n,o,s,a){const l=GA(0,0,1,0,1,1,0,1),c=GA(e,t,i,r,n,o,s,a),u=U.mat3.adjoint([],c);return U.mat3.multiply(l,l,u)}(u[0],u[1],h[0],h[1],m[0],m[1],g[0],g[1]);this.elevatedGlobePerspectiveTransform=$A(u[0],u[1],h[0],h[1],m[0],m[1],g[0],g[1]);const y=(e,t)=>{c.push(e.lng);const i=Math.round((e.lng-d)/f*Xi),n=Math.round((e.lat-p)/A*Xi),o=l(t),s=U.vec3.transformMat3([],[o[0],o[1],1],_),a=Math.round(s[0]/s[2]*Xi),u=Math.round(s[1]/s[2]*Xi);r.emplaceBack(i,n,a,u)},v=i[3].x-i[0].x,x=i[3].y-i[0].y,b=i[2].x-i[1].x,w=i[2].y-i[1].y;for(let e=0;e<65;e++){const r=e/64,n=[i[0].x+r*v,i[0].y+r*x],o=[i[1].x+r*b,i[1].y+r*w],s=o[0]-n[0],a=o[1]-n[1];for(let e=0;e<65;e++){const i=e/64,r={x:n[0]+s*i,y:n[1]+a*i,z:0};y(t.projection.unproject(r.x,r.y),r)}}this.elevatedGlobeVertexBuffer=e.createVertexBuffer(r,NA.members)}{this.maxLongitudeTriangleSize=0;let t=[],i=new Vs;const r=(e,r,n)=>{i.emplaceBack(e,r,n);const o=c[e],s=c[r],a=c[n],l=Math.min(Math.min(o,s),a),u=Math.max(Math.max(o,s),a)-l;u>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=u),t.push(l+u/2)};for(let e=0;e<64;e++)for(let t=0;t<64;t++){const i=65*e+t,n=i+1,o=i+65,s=o+1;r(i,o,n),r(n,o,s)}[t,i]=function(e,t){const i=Array.from({length:e.length},((e,t)=>t));i.sort(((t,i)=>e[t]-e[i]));const r=[],n=new Vs;for(let o=0;o<i.length;o++){const s=i[o];r.push(e[s]);const a=3*s,l=a+1;n.emplaceBack(t.uint16[a],t.uint16[l],t.uint16[l+1])}return[r,n]}(t,i),this.elevatedGlobeTrianglesCenterLongitudes=t,this.elevatedGlobeIndexBuffer=e.createIndexBuffer(i)}this.elevatedGlobeSegments=_a.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,f/Xi,0,A/Xi,0,0,p,d,0])}prepare(){const e=0!==Object.keys(this.tiles).length;if(this.tileID&&!e)return;const t=this.map.painter.context,i=t.gl;!this._dirty||this.texture instanceof HA||(this.texture?this.texture.update(this.image):(this.texture=new VA(t,this.image,i.RGBA8),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(t)}loadTile(e,t){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},t(null)):(e.state="errored",t(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){const t=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!t)return null;const i=this.elevatedGlobeTrianglesCenterLongitudes;let r=(n=e+180)+360*Math.round((i[0]-n)/360);var n;const o=new _a,s=(e,i)=>{o.segments.push({vertexOffset:0,primitiveOffset:e,vertexLength:t.segments[0].vertexLength,primitiveLength:i,sortKey:void 0,vaos:{}})},a=.51*this.maxLongitudeTriangleSize;if(Math.abs(i[0]-r)<=a){const e=xe(i,0,i.length,r+a);return e===i.length||s(e,ve(i,e+1,i.length,r+360-a)-e),o}r<i[0]&&(r+=360);const l=ve(i,0,i.length,r-a);if(l===i.length)return s(0,i.length),o;s(0,l-0);const c=xe(i,l+1,i.length,r+a);return c!==i.length&&s(c,i.length-c),o}}const KA=(Math.pow(256,2)-1)/16907520;class WA extends ms{constructor(e,t,i,r){super(e,{layout:OA||(OA=new Ko({visibility:new $o(Wo.layout_raster.visibility)})),paint:UA||(UA=new Ko({"raster-opacity":new $o(Wo.paint_raster["raster-opacity"]),"raster-color":new qo(Wo.paint_raster["raster-color"]),"raster-color-mix":new $o(Wo.paint_raster["raster-color-mix"]),"raster-color-range":new $o(Wo.paint_raster["raster-color-range"]),"raster-hue-rotate":new $o(Wo.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new $o(Wo.paint_raster["raster-brightness-min"]),"raster-brightness-max":new $o(Wo.paint_raster["raster-brightness-max"]),"raster-saturation":new $o(Wo.paint_raster["raster-saturation"]),"raster-contrast":new $o(Wo.paint_raster["raster-contrast"]),"raster-resampling":new $o(Wo.paint_raster["raster-resampling"]),"raster-fade-duration":new $o(Wo.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new $o(Wo.paint_raster["raster-emissive-strength"]),"raster-array-band":new $o(Wo.paint_raster["raster-array-band"]),"raster-elevation":new $o(Wo.paint_raster["raster-elevation"]),"raster-color-use-theme":new Zo({type:"string",default:"default","property-type":"data-driven"})}))},t,i,r),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(e){return!(e&&e._source instanceof qA&&(e._source.onNorthPole||e._source.onSouthPole))&&0===this.paint.get("raster-elevation")}_handleSpecialPaintPropertyUpdate(e){"raster-color"!==e&&"raster-color-range"!==e||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(e){if(!this.hasColorMap())return;if(!this._curRampRange)return;const t=this._transitionablePaint._values["raster-color"].value.expression,[i,r]=e||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(i)&&isNaN(r)||i===this._curRampRange[0]&&r===this._curRampRange[1]||(this.colorRamp=fu({expression:t,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:i,end:r}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[i,r])}}let XA,YA,JA,em,tm;class im extends ms{constructor(e,t,i,r){super(e,{layout:XA||(XA=new Ko({visibility:new $o(Wo["layout_raster-particle"].visibility)})),paint:YA||(YA=new Ko({"raster-particle-array-band":new $o(Wo["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new $o(Wo["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new qo(Wo["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new $o(Wo["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new $o(Wo["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new $o(Wo["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new $o(Wo["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new $o(Wo["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new Zo({type:"string",default:"default","property-type":"data-driven"})}))},t,i,r),this._updateColorRamp(),this.lastInvalidatedAt=ke.now()}onRemove(e){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return"none"!==this.visibility}isDraped(e){return!1}_handleSpecialPaintPropertyUpdate(e){"raster-particle-color"!==e&&"raster-particle-max-speed"!==e||(this._updateColorRamp(),this._invalidateAnimationState()),"raster-particle-count"===e&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const e=this._transitionablePaint._values["raster-particle-color"].value.expression,t=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=fu({expression:e,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:t}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=ke.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class rm extends ms{constructor(e,t){super(e,{},t,null),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(e){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}isDraped(e){return void 0!==this.implementation.renderToTile}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}function nm(e,t,i){const r=[0,0,1],n=U.quat.identity([]);return U.quat.rotateY(n,n,i?-Z(e)+Math.PI:Z(e)),U.quat.rotateX(n,n,-Z(t)),U.vec3.transformQuat(r,r,n),U.vec3.normalize(r,r)}function om(e,t){const i=am(e.projection,e.zoom,e.width,e.height),r=function(e,t,i,r,n){const o=new cl(i.lng-180*lm,i.lat),s=new cl(i.lng+180*lm,i.lat),a=e.project(o.lng,o.lat),l=e.project(s.lng,s.lat),c=-Math.atan2(l.y-a.y,l.x-a.x),u=Bl.fromLngLat(i);u.y=J(u.y,-1+lm,1-lm);const h=u.toLngLat(),d=e.project(h.lng,h.lat),p=Bl.fromLngLat(h);p.x+=lm;const f=p.toLngLat(),A=e.project(f.lng,f.lat),m=um(A.x-d.x,A.y-d.y,c),g=Bl.fromLngLat(h);g.y+=lm;const _=g.toLngLat(),y=e.project(_.lng,_.lat),v=um(y.x-d.x,y.y-d.y,c),x=Math.abs(m.x)/Math.abs(v.y),b=U.mat4.identity([]);U.mat4.rotateZ(b,b,-c*(1-(n?0:r)));const w=U.mat4.identity([]);return U.mat4.scale(w,w,[1,1-(1-x)*r,1]),w[4]=-v.x/v.y*r,U.mat4.rotateZ(w,w,c),U.mat4.multiply(w,b,w),w}(e.projection,0,e.center,i,t),n=sm(e);return U.mat4.scale(r,r,[n,n,1]),r}function sm(e){const t=e.projection,i=am(e.projection,e.zoom,e.width,e.height),r=cm(t,e.center),n=cm(t,cl.convert(t.center));return Math.pow(2,r*i+(1-i)*n)}function am(e,t,i,r,n=1/0){const o=e.range;if(!o)return 0;const s=Math.min(n,Math.max(i,r)),a=Math.log(s/1024)/Math.LN2;return ee(o[0]+a,o[1]+a,t)}const lm=1/4e4;function cm(e,t){const i=J(t.lat,-vl,vl),r=new cl(t.lng-180*lm,i),n=new cl(t.lng+180*lm,i),o=e.project(r.lng,i),s=e.project(n.lng,i),a=Bl.fromLngLat(r),l=Bl.fromLngLat(n),c=s.x-o.x,u=s.y-o.y,h=l.x-a.x,d=l.y-a.y,p=Math.sqrt((h*h+d*d)/(c*c+u*u));return Math.log(p)/Math.LN2}function um(e,t,i){const r=Math.cos(i),n=Math.sin(i);return{x:e*r-t*n,y:e*n+t*r}}function hm(e,t,i){U.mat4.identity(e),U.mat4.rotateZ(e,e,Z(t[2])),U.mat4.rotateX(e,e,Z(t[0])),U.mat4.rotateY(e,e,Z(t[1])),U.mat4.scale(e,e,i),U.mat4.multiply(e,e,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function dm(e,t,i,r,n,o,s,a){const l=[i[0]-t[0],i[1]-t[1],0],c=[r[0]-t[0],r[1]-t[1],0];if(U.vec3.length(l)<1e-12||U.vec3.length(c)<1e-12)return U.quat.identity(e);const u=U.vec3.cross([],l,c);U.vec3.normalize(u,u),U.vec3.subtract(c,r,t),l[2]=(o-n)*a,c[2]=(s-n)*a;const h=l;return U.vec3.cross(h,l,c),U.vec3.normalize(h,h),U.quat.rotationTo(e,u,h)}function pm(e,t,i=!1){const r=Hc(t.zoom),n=function(e,t,i){const r=t.worldSize,n=[e[12],e[13],e[14]],o=_l(n[1]/r),s=gl(n[0]/r),a=U.mat4.identity([]),l=ml(1,o)*r,c=ml(1,0)*r*bl(o,t.zoom),u=1/Qc(r);let h=c*u;if(i){const e=am(t.projection,t.zoom,t.width,t.height,1024);h=u*t.projection.pixelSpaceConversion(t.center.lat,r,e)}const d=sl(o,s);U.vec3.add(d,d,U.vec3.scale([],U.vec3.normalize([],d),l*h*n[2]));const p=function(e){const t=[e[0],e[1],e[2]];let i=[0,1,0];const r=U.vec3.cross([],i,t);return U.vec3.cross(i,t,r),0===U.vec3.squaredLength(i)&&(i=[0,1,0],U.vec3.cross(r,t,i)),U.vec3.normalize(r,r),U.vec3.normalize(i,i),U.vec3.normalize(t,t),[r[0],r[1],r[2],0,i[0],i[1],i[2],0,t[0],t[1],t[2],0,e[0],e[1],e[2],1]}(d);U.mat4.scale(a,a,[h,h,h*l]),U.mat4.translate(a,a,[-n[0],-n[1],-n[2]]);const f=U.mat4.multiply([],t.globeMatrix,p);return U.mat4.multiply(f,f,a),U.mat4.multiply(f,f,e),f}(e,t,i);if(r>0){const i=function(e,t){const i=t.worldSize,r=ml(1,0)*i*bl(t.center.lat,t.zoom)/Qc(i),n=ml(1,t.center.lat)*i,o=U.mat4.identity([]);return U.mat4.rotateY(o,o,Z(t.center.lng)),U.mat4.rotateX(o,o,Z(t.center.lat)),U.mat4.translate(o,o,[0,0,Xa]),U.mat4.scale(o,o,[r,r,r*n]),U.mat4.translate(o,o,[t.point.x-.5*i,t.point.y-.5*i,0]),U.mat4.multiply(o,o,e),U.mat4.multiply(o,t.globeMatrix,o)}(e,t);return function(e,t,i){const r=(e,t,i)=>{const r=U.vec3.length(e),n=U.vec3.length(t),o=Pc(e,t,i);return U.vec3.scale(o,o,1/U.vec3.length(o)*Et(r,n,i))},n=r([e[0],e[1],e[2]],[t[0],t[1],t[2]],i),o=r([e[4],e[5],e[6]],[t[4],t[5],t[6]],i),s=r([e[8],e[9],e[10]],[t[8],t[9],t[10]],i),a=Pc([e[12],e[13],e[14]],[t[12],t[13],t[14]],i);return[n[0],n[1],n[2],0,o[0],o[1],o[2],0,s[0],s[1],s[2],0,a[0],a[1],a[2],1]}(n,i,r)}return n}function fm(e,t,i,r){const n=Tc.projectAabbCorners(r,i);let o=Number.MAX_VALUE,s=-1;for(let e=0;e<n.length;++e){const i=n[e];i[0]=(.5*i[0]+.5)*t.width,i[1]=(.5-.5*i[1])*t.height,i[2]<o&&(s=e,o=i[2])}const a=e=>new V(n[e][0],n[e][1]);let l;switch(s){case 0:case 6:l=[a(1),a(5),a(4),a(7),a(3),a(2),a(1)];break;case 1:case 7:l=[a(0),a(4),a(5),a(6),a(2),a(3),a(0)];break;case 3:case 5:l=[a(1),a(0),a(4),a(7),a(6),a(2),a(1)];break;default:l=[a(1),a(5),a(6),a(7),a(3),a(0),a(1)]}if(Ol(e,l))return o}const Am=vs([{name:"a_pos_3f",components:3,type:"Float32"}]),mm=vs([{name:"a_color_3f",components:3,type:"Float32"}]),gm=vs([{name:"a_color_4f",components:4,type:"Float32"}]),_m=vs([{name:"a_uv_2f",components:2,type:"Float32"}]),ym=vs([{name:"a_normal_3f",components:3,type:"Float32"}]),vm=vs([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),xm=vs([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]),bm={None:0,Model:1,Symbol:2,FillExtrusion:4,All:7};class wm{constructor(e,t,i,r){this.message=(e?`${e}: `:"")+i,r&&(this.identifier=r),null!=t&&t.__line__&&(this.line=t.__line__)}}function Tm(e,t){const i=-1===e.indexOf("://");try{return new URL(e,i&&t?"http://example.com":void 0),!0}catch(e){return!1}}class Bm{constructor(e,t){this.feature=e,this.instancedDataOffset=t,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class Cm{constructor(){this.instancedDataArray=new Js,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class Sm{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.fqid)),this.projection=e.projection,this.index=e.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id)),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0}updateFootprints(e,t){}populate(e,t,i,r){this.tileToMeter=Tl(i);const n=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:o,id:s,index:a,sourceLayerIndex:l}of e){const e=null!=s?s:o.properties&&o.properties.hasOwnProperty("id")?o.properties.id:void 0,c=kl(o,n);if(!this.layers[0]._featureFilter.filter(new Do(this.zoom),c,i))continue;const u={id:e,sourceLayerIndex:l,index:a,geometry:n?c.geometry:Fl(o,i,r),properties:o.properties,type:o.type,patterns:{}},h=this.addFeature(u,u.geometry,c);h&&t.featureIndex.insert(o,u.geometry,a,l,this.index,this.instancesPerModel[h].instancedDataArray.length,Xi/32)}this.lookup=null}update(e,t,i,r){for(const t in this.instancesPerModel){const i=this.instancesPerModel[t];for(const t in e)i.idToFeaturesIndex.hasOwnProperty(t)&&(this.evaluate(i.features[i.idToFeaturesIndex[t]],e[t],i,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(const t in this.instancesPerModel){const i=this.instancesPerModel[t];for(const t of i.features){const r=this.layers[0],n=t.feature,o=this.canonical,s=r.paint.get("model-rotation").evaluate(n,{},o),a=r.paint.get("model-scale").evaluate(n,{},o),l=r.paint.get("model-translation").evaluate(n,{},o);U.vec3.exactEquals(t.rotation,s)&&U.vec3.exactEquals(t.scale,a)&&U.vec3.exactEquals(t.translation,l)||(this.evaluate(t,t.featureStates,i,!0),e=!0)}}return e}updateReplacement(e,t,i,r){if(t.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=t.updateTime;const n=t.getReplacementRegionsForTile(e.toUnwrapped(),!0);if($h(this.activeReplacements,n))return!1;this.activeReplacements=n;let o=!1;for(const t in this.instancesPerModel){const n=this.instancesPerModel[t],s=n.instancedDataArray;for(const t of n.features){const n=t.instancedDataOffset,a=t.instancedDataCount;for(let t=0;t<a;t++){const a=16*(t+n);let l=s.float32[a+0];const c=l>Xi;l=c?l-Xi:l;const u=Math.floor(l),h=s.float32[a+1];let d=!1;for(const t of this.activeReplacements)if(!jh(t,i,bm.Model,r)&&!(t.min.x>u||u>t.max.x||t.min.y>h||h>t.max.y)&&(d=Yh(Xh(u,h,e.canonical,t.footprintTileId.canonical),t.footprint),d))break;s.float32[a]=d?l+Xi:l,o=o||d!==c}}}return o}isEmpty(){for(const e in this.instancesPerModel)if(0!==this.instancesPerModel[e].instancedDataArray.length)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(const t in this.instancesPerModel){const i=this.instancesPerModel[t];i.instancedDataArray.length<0||0===i.instancedDataArray.length||(i.instancedDataBuffer?i.instancedDataBuffer.updateData(i.instancedDataArray):i.instancedDataBuffer=e.createVertexBuffer(i.instancedDataArray,vm.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const e in this.instancesPerModel){const t=this.instancesPerModel[e];0!==t.instancedDataArray.length&&t.instancedDataBuffer&&t.instancedDataBuffer.destroy()}const e=this.layers[0].modelManager;if(e&&this.modelUris)for(const t of this.modelUris)e.removeModel(t,"")}addFeature(e,t,i){const r=this.layers[0],n=r.layout.get("model-id").evaluate(i,{},this.canonical);if(!n)return de(`modelId is not evaluated for layer ${r.id} and it is not going to get rendered.`),n;Tm(n,!1)&&(this.modelUris.includes(n)||this.modelUris.push(n)),this.instancesPerModel[n]||(this.instancesPerModel[n]=new Cm);const o=this.instancesPerModel[n],s=o.instancedDataArray,a=new Bm(i,s.length);for(const e of t)for(const t of e){if(t.x<0||t.x>=Xi||t.y<0||t.y>=Xi)continue;const e=(this.lookupDim-1)/Xi,i=this.lookupDim*(t.y*e|0)+t.x*e|0;if(this.lookup){if(0!==this.lookup[i])continue;this.lookup[i]=1}this.instanceCount++;const r=s.length;s.resize(r+1),o.instancesEvaluatedElevation.push(0),s.float32[16*r]=t.x,s.float32[16*r+1]=t.y}return a.instancedDataCount=o.instancedDataArray.length-a.instancedDataOffset,a.instancedDataCount>0&&(e.id&&(o.idToFeaturesIndex[e.id]=o.features.length),o.features.push(a),this.evaluate(a,{},o,!1)),n}getModelUris(){return this.modelUris}evaluate(e,t,i,r){const n=this.layers[0],o=e.feature,s=this.canonical,a=e.rotation=n.paint.get("model-rotation").evaluate(o,t,s),l=e.scale=n.paint.get("model-scale").evaluate(o,t,s),c=e.translation=n.paint.get("model-translation").evaluate(o,t,s),u=n.paint.get("model-color").evaluate(o,t,s);u.a=n.paint.get("model-color-mix-intensity").evaluate(o,t,s);const h=[];this.maxVerticalOffset<c[2]&&(this.maxVerticalOffset=c[2]),this.maxScale=Math.max(Math.max(this.maxScale,l[0]),Math.max(l[1],l[2])),hm(h,a,l);const d=Math.round(100*u.a)+u.b/1.05;for(let t=0;t<e.instancedDataCount;++t){const n=e.instancedDataOffset+t,o=16*n,a=i.instancedDataArray.float32;let l=0;r&&(l=a[o+6]-i.instancesEvaluatedElevation[n]);const p=0|a[o+1];a[o]=(0|a[o])+u.r/1.05,a[o+1]=p+u.g/1.05,a[o+2]=d,a[o+3]=1/(s.z>10?this.tileToMeter:Tl(s,p)),a[o+4]=c[0],a[o+5]=c[1],a[o+6]=c[2]+l,a[o+7]=h[0],a[o+8]=h[1],a[o+9]=h[2],a[o+10]=h[4],a[o+11]=h[5],a[o+12]=h[6],a[o+13]=h[8],a[o+14]=h[9],a[o+15]=h[10],i.instancesEvaluatedElevation[n]=c[2]}}}let Em,Mm;co(Sm,"ModelBucket",{omit:["layers"]}),co(Cm,"PerModelAttributes"),co(Bm,"ModelFeature");const Im=64,Pm={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function Lm(e,t,i,r,n,o,s,a,l,c=!1){const u=i.zoom,h=i.project(r),d=bl(r.lat,u),p=1/d;U.mat4.identity(e),U.mat4.translate(e,e,[h.x+s[0]*p,h.y+s[1]*p,s[2]]);let f=1,A=1;const m=i.worldSize;if(c){if("mercator"===i.projection.name){let e=0;i.elevation&&(e=i.elevation.getAtPointOrZero(new Bl(h.x/m,h.y/m),0));const t=U.vec4.transformMat4([],[h.x,h.y,e,1],i.projMatrix)[3]/i.cameraToCenterDistance;f=t,A=t*bl(i.center.lat,u)}else if("globe"===i.projection.name){const t=pm(e,i),n=U.mat4.multiply([],i.projMatrix,t),o=[0,0,0,1];U.vec4.transformMat4(o,o,n);const s=o[3]/i.cameraToCenterDistance,a=Hc(u),l=i.projection.pixelsPerMeter(r.lat,m)*bl(r.lat,u),c=i.projection.pixelsPerMeter(i.center.lat,m)*bl(i.center.lat,u);f=s/Et(l,xl(i.center.lat),a),A=s*d/l,f*=c,A*=c}}else f=p;U.mat4.scale(e,e,[f,f,A]);const g=[...e],_=t.orientation,y=[];if(hm(y,[_[0]+n[0],_[1]+n[1],_[2]+n[2]],o),U.mat4.multiply(e,g,y),a&&i.elevation){let n=0;const o=[];if(l&&i.elevation){n=function(e,t,i,r,n){const o=t.elevation;if(!o)return 0;const s=Tc.projectAabbCorners(i,r),a=ml(1,n.lat)*t.worldSize,l=function(e,t){const i=[0,0,1],r=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const n of r){const r=e[n.corners[0]],o=e[n.corners[1]],s=e[n.corners[2]],a=[o[0]-r[0],o[1]-r[1],t*(o[2]-r[2])],l=U.vec3.cross(a,a,[s[0]-r[0],s[1]-r[1],t*(s[2]-r[2])]);U.vec3.normalize(l,l),n.dotProductWithUp=U.vec3.dot(l,i)}return r.sort(((e,t)=>e.dotProductWithUp-t.dotProductWithUp)),r[0].corners}(s,a),c=s[l[0]],u=s[l[1]],h=s[l[2]],d=s[l[3]],p=o.getAtPointOrZero(new Bl(c[0]/t.worldSize,c[1]/t.worldSize),0),f=o.getAtPointOrZero(new Bl(u[0]/t.worldSize,u[1]/t.worldSize),0),A=o.getAtPointOrZero(new Bl(h[0]/t.worldSize,h[1]/t.worldSize),0),m=o.getAtPointOrZero(new Bl(d[0]/t.worldSize,d[1]/t.worldSize),0),g=(p+m)/2,_=(f+A)/2;return g>_?f<A?dm(e,u,d,c,f,m,p,a):dm(e,h,c,d,A,p,m,a):p<m?dm(e,c,u,h,p,f,A,a):dm(e,d,h,u,m,A,f,a),Math.max(g,_)}(o,i,t.aabb,e,r);const s=U.mat4.fromQuat([],o),a=U.mat4.multiply([],s,y);U.mat4.multiply(e,g,a)}else n=i.elevation.getAtPointOrZero(new Bl(h.x/m,h.y/m),0);0!==n&&(e[14]+=n)}}function Fm(e,t,i=!1){e.uploaded||(e.gfxTexture=new VA(t,e.image,i?t.gl.R8:t.gl.RGBA8,{useMipmap:e.sampler.minFilter>=t.gl.NEAREST_MIPMAP_NEAREST}),e.uploaded=!0,e.image=null)}function km(e,t,i){e.indexBuffer=t.createIndexBuffer(e.indexArray,!1,!0),e.vertexBuffer=t.createVertexBuffer(e.vertexArray,Am.members,!1,!0),e.normalArray&&(e.normalBuffer=t.createVertexBuffer(e.normalArray,ym.members,!1,!0)),e.texcoordArray&&(e.texcoordBuffer=t.createVertexBuffer(e.texcoordArray,_m.members,!1,!0)),e.colorArray&&(e.colorBuffer=t.createVertexBuffer(e.colorArray,(12===e.colorArray.bytesPerElement?mm:gm).members,!1,!0)),e.featureArray&&(e.pbrBuffer=t.createVertexBuffer(e.featureArray,xm.members,!0)),e.segments=_a.simpleSegment(0,0,e.vertexArray.length,e.indexArray.length);const r=e.material;r.pbrMetallicRoughness.baseColorTexture&&Fm(r.pbrMetallicRoughness.baseColorTexture,t),r.pbrMetallicRoughness.metallicRoughnessTexture&&Fm(r.pbrMetallicRoughness.metallicRoughnessTexture,t),r.normalTexture&&Fm(r.normalTexture,t),r.occlusionTexture&&Fm(r.occlusionTexture,t,i),r.emissionTexture&&Fm(r.emissionTexture,t)}function zm(e,t,i){if(e.meshes)for(const r of e.meshes)km(r,t,i);if(e.children)for(const r of e.children)zm(r,t,i)}function Rm(e){if(e.meshes)for(const t of e.meshes)t.indexArray.destroy(),t.vertexArray.destroy(),t.colorArray&&t.colorArray.destroy(),t.normalArray&&t.normalArray.destroy(),t.texcoordArray&&t.texcoordArray.destroy(),t.featureArray&&t.featureArray.destroy();if(e.children)for(const t of e.children)Rm(t)}function Dm(e){if(e.meshes)for(const i of e.meshes)i.vertexBuffer&&(i.vertexBuffer.destroy(),i.indexBuffer.destroy(),i.normalBuffer&&i.normalBuffer.destroy(),i.texcoordBuffer&&i.texcoordBuffer.destroy(),i.colorBuffer&&i.colorBuffer.destroy(),i.pbrBuffer&&i.pbrBuffer.destroy(),i.segments.destroy(),i.material&&((t=i.material).pbrMetallicRoughness.baseColorTexture&&t.pbrMetallicRoughness.baseColorTexture.gfxTexture&&t.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),t.pbrMetallicRoughness.metallicRoughnessTexture&&t.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&t.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),t.normalTexture&&t.normalTexture.gfxTexture&&t.normalTexture.gfxTexture.destroy(),t.emissionTexture&&t.emissionTexture.gfxTexture&&t.emissionTexture.gfxTexture.destroy(),t.occlusionTexture&&t.occlusionTexture.gfxTexture&&t.occlusionTexture.gfxTexture.destroy()));var t;if(e.children)for(const t of e.children)Dm(t)}class Om{constructor(e,t,i){this._demTile=e,this._dem=this._demTile.dem,this._scale=t,this._offset=i}static create(e,t,i){const r=i||e.findDEMTileFor(t);if(!r||!r.dem)return;const n=r.dem,o=r.tileID,s=1<<t.canonical.z-o.canonical.z;return new Om(r,n.dim/Xi/s,[(t.canonical.x/s-o.canonical.x)*n.dim,(t.canonical.y/s-o.canonical.y)*n.dim])}tileCoordToPixel(e,t){const i=t*this._scale+this._offset[1],r=Math.floor(e*this._scale+this._offset[0]),n=Math.floor(i);return new V(r,n)}getElevationAt(e,t,i,r){const n=e*this._scale+this._offset[0],o=t*this._scale+this._offset[1],s=Math.floor(n),a=Math.floor(o),l=this._dem;return r=!!r,i?Et(Et(l.get(s,a,r),l.get(s,a+1,r),o-a),Et(l.get(s+1,a,r),l.get(s+1,a+1,r),o-a),n-s):l.get(s,a,r)}getElevationAtPixel(e,t,i){return this._dem.get(e,t,!!i)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*ml(1,e)*this._dem.stride}}const Um=new Float32Array(262144),Nm=new Uint8Array(262144);function Qm(e){let t=0;if(e.meshes)for(const i of e.meshes)t=Math.max(t,i.aabb.max[2]);if(e.children)for(const i of e.children)t=Math.max(t,Qm(i));return t}function jm(e,t,i){if(e.meshes)for(const r of e.meshes){if(r.aabb.min[0]===1/0)continue;const n=Tc.applyTransform(r.aabb,e.matrix);i.insert(t,n.min[0],n.min[1],n.max[0],n.max[1])}if(e.children)for(const r of e.children)jm(r,t,i)}const Vm=["","wall","door","roof","window","lamp","logo"];class Hm{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:e.id,geometry:[],properties:{height:Qm(e)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new Tc([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let e=0;const t=new Tc([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const i of this.node.meshes)this.node.lightMeshIndex!==e&&(i.transformedAabb=Tc.applyTransformFast(i.aabb,this.node.matrix),t.encapsulate(i.transformedAabb)),e++;this.aabb=t}return this.aabb}}class Gm{constructor(e,t,i,r,n,o,s){this.id=i,this.layers=e,this.layerIds=this.layers.map((e=>e.fqid)),this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id)),this.modelTraits|=Pm.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,r&&(this.modelTraits|=Pm.HasMapboxMeshFeatures),n&&(this.modelTraits|=Pm.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=o,this.dirty=!0,this.needsUpload=!1,this.filter=null,this.nodesInfo=[];for(const e of t)this.nodesInfo.push(new Hm(e)),jm(e,s.featureIndexArray.length,s.grid),s.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,s.bucketLayerIDs.length-1,0);this.states={}}updateFootprints(e,t){for(const i of this.getNodesInfo()){const r=i.node;r.footprint&&t.push({footprint:r.footprint,id:e})}}update(e){const t=0!==Object.keys(e).length;if(t&&!this.stateDependentLayers.length)return;const i=t?this.stateDependentLayers:this.layers;if(!H(e,this.states))for(const t of i)this.evaluate(t,e);this.states=structuredClone(e)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;const t=this.getNodesInfo();for(const i of t){const t=i.node;this.uploaded?this.updatePbrBuffer(t):zm(t,e,!0)}for(const e of t)Rm(e.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let t=!1;if(!e.meshes)return t;for(const i of e.meshes)i.pbrBuffer&&(i.pbrBuffer.updateData(i.featureArray),t=!0);return t}needsReEvaluation(e,t,i){const r=e.transform.projectionOptions,n=e.style.getBrightness(),o=this.brightness!==n;if(!this.uploaded||this.dirty||r.name!==this.projection.name||$m(i.paint.get("model-color").value,o)||$m(i.paint.get("model-color-mix-intensity").value,o)||$m(i.paint.get("model-roughness").value,o)||$m(i.paint.get("model-emissive-strength").value,o)||$m(i.paint.get("model-height-based-emissive-strength-multiplier").value,o)){this.projection=r,this.brightness=n;const e=this.getNodesInfo();for(const t of e)t.state=null;return!0}return!1}evaluateScale(e,t){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;const i=this.getNodesInfo(),r=this.id.canonical;for(const e of i){const i=e.feature;e.evaluatedScale=t.paint.get("model-scale").evaluate(i,{},r)}}evaluate(e,t){const i=this.getNodesInfo();for(const r of i){if(!r.node.meshes)continue;const i=r.feature,n=t&&t[i.id];if(H(n,r.state))continue;r.state=structuredClone(n);const o=r.node.meshes&&r.node.meshes[0].featureData,s=r.evaluatedColor[2],a=r.evaluatedRMEA[2],l=this.id.canonical;if(r.hasTranslucentParts=!1,o){for(let t=0;t<Vm.length;t++){const o=Vm[t];o.length&&(i.properties.part=o);const s=e.paint.get("model-color").evaluate(i,n,l).toRenderColor(null),a=e.paint.get("model-color-mix-intensity").evaluate(i,n,l);r.evaluatedColor[t]=[s.r,s.g,s.b,a],r.evaluatedRMEA[t][0]=e.paint.get("model-roughness").evaluate(i,n,l),r.evaluatedRMEA[t][2]=e.paint.get("model-emissive-strength").evaluate(i,n,l),r.evaluatedRMEA[t][3]=s.a,r.emissionHeightBasedParams[t]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(i,n,l),!r.hasTranslucentParts&&s.a<1&&(r.hasTranslucentParts=!0)}delete i.properties.part,qm(r,s!==r.evaluatedColor[2]||a!==r.evaluatedRMEA[2],this.modelTraits)}else r.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(i,n,l);r.evaluatedScale=e.paint.get("model-scale").evaluate(i,n,l),this.updatePbrBuffer(r.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,t,i,r){const n=e.findDEMTileFor(i);if(n&&(n.tileID.canonical!==this.terrainTile||t!==this.terrainExaggeration)){if(n.dem&&n.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=n.tileID.overscaledZ;const t=Om.create(e,i,n);if(!t)return;this.modelTraits&Pm.HasMapboxMeshFeatures&&this.updateDEM(e,t,i,r);for(const e of this.getNodesInfo()){const i=e.node;if(!i.footprint||!i.footprint.vertices||!i.footprint.vertices.length)continue;const r=i.footprint.vertices;let n=t.getElevationAt(r[0].x,r[0].y,!0,!0);for(let e=1;e<r.length;e++)n=Math.min(n,t.getElevationAt(r[e].x,r[e].y,!0,!0));i.elevation=n}}this.terrainTile=n.tileID.canonical,this.terrainExaggeration=t}}updateDEM(e,t,i,r){let n=t._dem._modifiedForSources[r];if(void 0===n&&(t._dem._modifiedForSources[r]=[],n=t._dem._modifiedForSources[r]),n.includes(i.canonical))return;const o=t._dem.dim;n.push(i.canonical);let s=!1;for(const e of this.getNodesInfo()){const i=e.node;if(!i.footprint||!i.footprint.grid)continue;const r=i.footprint.grid,n=t.tileCoordToPixel(r.min.x,r.min.y),a=t.tileCoordToPixel(r.max.x,r.max.y),l=Math.min(Math.min(o-a.y,n.x),Math.min(n.y,o-a.x));if(l<0)continue;const c=J(l,2,5);let u=Math.max(0,n.x-c),h=Math.max(0,n.y-c),d=Math.min(a.x+c,o-1),p=Math.min(a.y+c,o-1);for(let e=h;e<=p;++e)for(let t=u;t<=d;++t)Nm[e*o+t]=255;let f=0,A=0;for(let e=0;e<r.cellsY;++e)for(let i=0;i<r.cellsX;++i){if(!r.cells[e*r.cellsX+i])continue;const n=t.tileCoordToPixel(r.min.x+i/r.xScale,r.min.y+e/r.yScale),s=t.tileCoordToPixel(r.min.x+(i+1)/r.xScale,r.min.y+(e+1)/r.yScale);for(let e=n.y;e<=Math.min(s.y+1,o-1);++e)for(let i=n.x;i<=Math.min(s.x+1,o-1);++i)255===Nm[e*o+i]&&(Nm[e*o+i]=0,f+=t.getElevationAtPixel(i,e),A++)}const m=f/A;u=Math.max(1,n.x-c),h=Math.max(1,n.y-c),d=Math.min(a.x+c,o-2),p=Math.min(a.y+c,o-2),s=!0;for(let e=h;e<=p;++e)for(let i=u;i<=d;++i)0===Nm[e*o+i]&&(Um[e*o+i]=t._dem.set(i,e,m));for(let e=1;e<c;++e){u=Math.max(1,n.x-e),h=Math.max(1,n.y-e),d=Math.min(a.x+e,o-2),p=Math.min(a.y+e,o-2);for(let i=h;i<=p;++i)for(let r=u;r<=d;++r){const n=i*o+r;if(255===Nm[n]){let s=0,a=0,l=-1,u=-1;for(let t=-1;t<=1;++t)for(let n=-1;n<=1;++n){const c=(i+t)*o+r+n;if(Nm[c]>=e)continue;const h=Um[c],d=Math.abs(h);d>a&&(s=h,a=d,l=n,u=t)}if(a>.1){const o=1-(e+.5*Math.abs(l*u))/c;let a=t._dem.get(r,i)+s*o;const h=t._dem.get(r+l,i+u),d=t._dem.get(r-l,i-u,!0);(a-h)*(a-d)>0&&(a=(h+d)/2),Um[n]=t._dem.set(r,i,a),Nm[n]=e}}}}}s&&(t._demTile.needsDEMTextureUpload=!0,t._dem._timestamp=ke.now())}setFilter(e){this.filter=e?es(e):null}getNodesInfo(){return this.filter?this.nodesInfo.filter((e=>this.filter.filter(new Do(this.id.overscaledZ),e.feature,this.id.canonical))):this.nodesInfo}destroy(){const e=this.getNodesInfo();for(const t of e)Rm(t.node),Dm(t.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(e,t){if(t.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=t.updateTime;const i=t.getReplacementRegionsForTile(e.toUnwrapped()),r=this.getNodesInfo();for(let e=0;e<this.nodesInfo.length;e++){const t=r[e].node;r[e].hiddenByReplacement=!!t.footprint&&!i.find((e=>e.footprint===t.footprint))}}getHeightAtTileCoord(e,t){const i=this.getNodesInfo(),r=[],n=[0,0,0],o=U.mat4.identity([]);for(let s=0;s<this.nodesInfo.length;s++){const a=i[s],l=a.node.meshes[0],c=l.transformedAabb;if(e<c.min[0]||t<c.min[1]||e>c.max[0]||t>c.max[1])continue;if(!0===a.node.hidden)return{height:1/0,maxHeight:a.feature.properties.height,hidden:!1,verticalScale:a.evaluatedScale[2]};U.mat4.invert(o,a.node.matrix),n[0]=e,n[1]=t,U.vec3.transformMat4(n,n,o);const u=(n[0]-l.aabb.min[0])/(l.aabb.max[0]-l.aabb.min[0])*Im|0,h=Math.min(63,(n[1]-l.aabb.min[1])/(l.aabb.max[1]-l.aabb.min[1])*Im|0)*Im+Math.min(63,u),d=l.heightmap[h];if(!(d<0&&a.node.footprint)){if(a.hiddenByReplacement)return;return{height:d,maxHeight:a.feature.properties.height,hidden:!1,verticalScale:a.evaluatedScale[2]}}if(a.node.footprint.grid.query(new V(e,t),new V(e,t),r),r.length>0)return{height:void 0,maxHeight:a.feature.properties.height,hidden:a.hiddenByReplacement,verticalScale:a.evaluatedScale[2]}}}}function $m(e,t){return!e.isLightConstant&&t}function Zm(e,t,i,r,n,o,s,a){let l=(61440&t|(61440&t)>>4)>>8,c=(3840&t|(3840&t)>>4)>>4,u=240&t|(240&t)>>4;i[3]>0&&(l=Et(l,255*i[0],i[3]),c=Et(c,255*i[1],i[3]),u=Et(u,255*i[2],i[3]));const h=l<<8|c,d=u<<8|Math.floor(255*r[3]),p=function(e){const t=J(e,0,2);return Math.min(Math.round(.5*t*255),255)}(r[2])<<8|15*r[0]<<4|15*r[1],f=J(n[0],0,1),A=J(n[1],0,1),m=J(n[2],0,1),g=J(n[3],0,1);let _,y,v,x;if(f!==A&&s!==o&&A!==f){const e=s-o;y=1/(e*(A-f)),v=-(o+e*f)/(e*(A-f));const t=J(n[4],-1,1);x=Math.pow(10,t),_=255*m<<8|255*g}else _=65535,y=0,v=1,x=1;if(e.emplaceBack(h,d,p,_,y,v,x),a){const e=a.length;a.clear();for(let t=0;t<e;t++)a.emplaceBack(h,d,p,_,y,v,x)}}function qm(e,t,i){const r=e.node;let n=0;const o=i&Pm.HasMeshoptCompression;for(const i of r.meshes){if(r.lights&&r.lightMeshIndex===n)continue;if(!i.featureData)continue;i.featureArray=new ea,i.featureArray.reserve(i.featureData.length);let s=t;for(const t of i.featureData){const n=o?65535&t:t>>16&65535,a=o?t>>16&65535:65535&t,l=(15&a)<8?15&a:0,c=e.evaluatedRMEA[l],u=e.evaluatedColor[l],h=e.emissionHeightBasedParams[l];let d;if(s&&2===l&&r.lights&&(d=new ea,d.resize(10*r.lights.length)),Zm(i.featureArray,n,u,c,h,i.aabb.min[2],i.aabb.max[2],d),d&&s){s=!1;const e=r.meshes[r.lightMeshIndex];e.featureArray=d,e.featureArray._trim()}}i.featureArray._trim(),n++}}function Km(e,t,i,r){const n=1<<e.z;t.lat=_l((r/Xi+e.y)/n),t.lng=gl((i/Xi+e.x)/n)}co(Gm,"Tiled3dModelBucket",{omit:["layers"]}),co(Hm,"Tiled3dModelFeature");const Wm={circle:class extends ms{constructor(e,t,i,r){super(e,{layout:ic||(ic=new Ko({"circle-sort-key":new Zo(Wo.layout_circle["circle-sort-key"]),"circle-elevation-reference":new $o(Wo.layout_circle["circle-elevation-reference"]),visibility:new $o(Wo.layout_circle.visibility)})),paint:rc||(rc=new Ko({"circle-radius":new Zo(Wo.paint_circle["circle-radius"]),"circle-color":new Zo(Wo.paint_circle["circle-color"]),"circle-blur":new Zo(Wo.paint_circle["circle-blur"]),"circle-opacity":new Zo(Wo.paint_circle["circle-opacity"]),"circle-translate":new $o(Wo.paint_circle["circle-translate"]),"circle-translate-anchor":new $o(Wo.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new $o(Wo.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new $o(Wo.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Zo(Wo.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Zo(Wo.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Zo(Wo.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new $o(Wo.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new Zo({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new Zo({type:"string",default:"default","property-type":"data-driven"})}))},t,i,r)}createBucket(e){return new Dl(e)}queryRadius(e){const t=e;return Yl("circle-radius",this,t)+Yl("circle-stroke-width",this,t)+Jl(this.paint.get("circle-translate"))}queryIntersectsFeature(e,t,i,r,n,o,s,a){const l=tc(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),o.angle,e.pixelToTileUnitsFactor),c=this.paint.get("circle-radius").evaluate(t,i)+this.paint.get("circle-stroke-width").evaluate(t,i);return Yc(e,r,o,s,a,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),l,c)}getProgramIds(){return["circle"]}getDefaultProgramParams(e,t,i){const r=Xc(this);return{config:new Ha(this,{zoom:t,lut:i}),defines:r,overrideFog:!1}}},heatmap:class extends ms{createBucket(e){return new ru(e)}constructor(e,t,i,r){super(e,{layout:nu||(nu=new Ko({visibility:new $o(Wo.layout_heatmap.visibility)})),paint:ou||(ou=new Ko({"heatmap-radius":new Zo(Wo.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Zo(Wo.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new $o(Wo.paint_heatmap["heatmap-intensity"]),"heatmap-color":new qo(Wo.paint_heatmap["heatmap-color"]),"heatmap-opacity":new $o(Wo.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new Zo({type:"string",default:"default","property-type":"data-driven"})}))},t,i,r),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){"heatmap-color"===e&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=fu({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(e){return Yl("heatmap-radius",this,e)}queryIntersectsFeature(e,t,i,r,n,o,s,a){const l=this.paint.get("heatmap-radius").evaluate(t,i);return Yc(e,r,o,s,a,!0,!0,new V(0,0),l)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(e,t,i){return"heatmap"===e?{config:new Ha(this,{zoom:t,lut:i}),overrideFog:!1}:{}}},hillshade:class extends ms{constructor(e,t,i,r){super(e,{layout:su||(su=new Ko({visibility:new $o(Wo.layout_hillshade.visibility)})),paint:au||(au=new Ko({"hillshade-illumination-direction":new $o(Wo.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new $o(Wo.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new $o(Wo.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new $o(Wo.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new $o(Wo.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new $o(Wo.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new $o(Wo.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new Zo({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new Zo({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new Zo({type:"string",default:"default","property-type":"data-driven"})}))},t,i,r)}shouldRedrape(){return this.hasOffscreenPass()&&"viewport"===this.paint.get("hillshade-illumination-anchor")}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(e,t,i){return{overrideFog:!1}}},fill:class extends ms{constructor(e,t,i,r){super(e,{layout:bh||(bh=new Ko({"fill-sort-key":new Zo(Wo.layout_fill["fill-sort-key"]),visibility:new $o(Wo.layout_fill.visibility),"fill-elevation-reference":new $o(Wo.layout_fill["fill-elevation-reference"]),"fill-construct-bridge-guard-rail":new Zo(Wo.layout_fill["fill-construct-bridge-guard-rail"])})),paint:wh||(wh=new Ko({"fill-antialias":new $o(Wo.paint_fill["fill-antialias"]),"fill-opacity":new Zo(Wo.paint_fill["fill-opacity"]),"fill-color":new Zo(Wo.paint_fill["fill-color"]),"fill-outline-color":new Zo(Wo.paint_fill["fill-outline-color"]),"fill-translate":new $o(Wo.paint_fill["fill-translate"]),"fill-translate-anchor":new $o(Wo.paint_fill["fill-translate-anchor"]),"fill-pattern":new Zo(Wo.paint_fill["fill-pattern"]),"fill-emissive-strength":new $o(Wo.paint_fill["fill-emissive-strength"]),"fill-z-offset":new Zo(Wo.paint_fill["fill-z-offset"]),"fill-bridge-guard-rail-color":new Zo(Wo.paint_fill["fill-bridge-guard-rail-color"]),"fill-tunnel-structure-color":new Zo(Wo.paint_fill["fill-tunnel-structure-color"]),"fill-color-use-theme":new Zo({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new Zo({type:"string",default:"default","property-type":"data-driven"}),"fill-bridge-guard-rail-color-use-theme":new Zo({type:"string",default:"default","property-type":"data-driven"}),"fill-tunnel-structure-color-use-theme":new Zo({type:"string",default:"default","property-type":"data-driven"})}))},t,i,r)}getProgramIds(){const e=this.paint.get("fill-pattern"),t=e&&e.constantOr(1),i=[t?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&i.push(t&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),i}getDefaultProgramParams(e,t,i){return{config:new Ha(this,{zoom:t,lut:i}),overrideFog:!1}}recalculate(e,t){super.recalculate(e,t);const i=this.paint._values["fill-outline-color"];"constant"===i.value.kind&&void 0===i.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new xh(e)}queryRadius(){return Jl(this.paint.get("fill-translate"))}queryIntersectsFeature(e,t,i,r,n,o){return!e.queryGeometry.isAboveHorizon&&Nl(ec(e.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),o.angle,e.pixelToTileUnitsFactor),r)}isTileClipped(){return 0===this.paint.get("fill-z-offset").constantOr(1)}is3D(e){if(0!==this.paint.get("fill-z-offset").constantOr(1))return!0;const t=this.layout&&"none"!==this.layout.get("fill-elevation-reference");return null!=e?t&&!e:t}},"fill-extrusion":class extends ms{constructor(e,t,i,r){super(e,{layout:Id||(Id=new Ko({visibility:new $o(Wo["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new $o(Wo["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:Pd||(Pd=new Ko({"fill-extrusion-opacity":new $o(Wo["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Zo(Wo["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new $o(Wo["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new $o(Wo["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Zo(Wo["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Zo(Wo["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Zo(Wo["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new $o(Wo["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new $o(Wo["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new $o(Wo["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new $o(Wo["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new $o(Wo["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new $o(Wo["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new $o(Wo["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new $o(Wo["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new $o(Wo["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new $o(Wo["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new Zo(Wo["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new Zo(Wo["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new $o(Wo["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new $o(Wo["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new $o(Wo["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new $o(Wo["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new Zo(Wo["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new Zo(Wo["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new $o(Wo["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new Zo({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new Zo({type:"string",default:"default","property-type":"data-driven"})}))},t,i,r),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(e){return new yd(e)}queryRadius(){return Jl(this.paint.get("fill-extrusion-translate"))}is3D(e){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(e,t,i,r,n,o,s,a,l){const c=tc(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),o.angle,e.pixelToTileUnitsFactor),u=this.paint.get("fill-extrusion-height").evaluate(t,i),h=this.paint.get("fill-extrusion-base").evaluate(t,i),d=[0,0],p=a&&o.elevation,f=o.elevation?o.elevation.exaggeration():1,A=e.tile.getBucket(this);if(p&&A instanceof yd){const e=A.centroidVertexArray,t=l+1;t<e.length&&(d[0]=e.geta_centroid_pos0(t),d[1]=e.geta_centroid_pos1(t))}if(0===d[0]&&1===d[1])return!1;"globe"===o.projection.name&&(r=Ed([r],[new V(0,0),new V(Xi,Xi)],e.tileID.canonical).map((e=>e.polygon)).flat());const m=p?a:null,[g,_]=function(e,t,i,r,n,o,s,a,l,c,u){return"globe"===e.projection.name?function(e,t,i,r,n,o,s,a,l,c,u){const h=[],d=[],p=e.projection.upVectorScale(u,e.center.lat,e.worldSize).metersToTile,f=[0,0,0,1],A=[0,0,0,1],m=(e,t,i,r)=>{e[0]=t,e[1]=i,e[2]=r,e[3]=1},g=Sd();i>0&&(i+=g),r+=g;for(const g of t){const t=[],_=[];for(const h of g){const d=h.x+n.x,g=h.y+n.y,y=e.projection.projectTilePoint(d,g,u),v=e.projection.upVector(u,h.x,h.y);let x=i,b=r;if(s){const e=kd(d,g,i,r,s,a,l,c);x+=e.base,b+=e.top}0!==i?m(f,y.x+v[0]*p*x,y.y+v[1]*p*x,y.z+v[2]*p*x):m(f,y.x,y.y,y.z),m(A,y.x+v[0]*p*b,y.y+v[1]*p*b,y.z+v[2]*p*b),U.vec3.transformMat4(f,f,o),U.vec3.transformMat4(A,A,o),t.push(new Rh(f[0],f[1],f[2])),_.push(new Rh(A[0],A[1],A[2]))}h.push(t),d.push(_)}return[h,d]}(e,t,i,r,n,o,s,a,l,c,u):s?function(e,t,i,r,n,o,s,a,l){const c=[],u=[],h=[0,0,0,1];for(const d of e){const e=[],p=[];for(const c of d){const u=c.x+r.x,d=c.y+r.y,f=kd(u,d,t,i,o,s,a,l);h[0]=u,h[1]=d,h[2]=f.base,h[3]=1,U.vec4.transformMat4(h,h,n),h[3]=Math.max(h[3],1e-5);const A=new Rh(h[0]/h[3],h[1]/h[3],h[2]/h[3]);h[0]=u,h[1]=d,h[2]=f.top,h[3]=1,U.vec4.transformMat4(h,h,n),h[3]=Math.max(h[3],1e-5);const m=new Rh(h[0]/h[3],h[1]/h[3],h[2]/h[3]);e.push(A),p.push(m)}c.push(e),u.push(p)}return[c,u]}(t,i,r,n,o,s,a,l,c):function(e,t,i,r,n){const o=[],s=[],a=n[8]*t,l=n[9]*t,c=n[10]*t,u=n[11]*t,h=n[8]*i,d=n[9]*i,p=n[10]*i,f=n[11]*i;for(const t of e){const e=[],i=[];for(const o of t){const t=o.x+r.x,s=o.y+r.y,A=n[0]*t+n[4]*s+n[12],m=n[1]*t+n[5]*s+n[13],g=n[2]*t+n[6]*s+n[14],_=n[3]*t+n[7]*s+n[15],y=A+a,v=m+l,x=g+c,b=Math.max(_+u,1e-5),w=A+h,T=m+d,B=g+p,C=Math.max(_+f,1e-5);e.push(new Rh(y/b,v/b,x/b)),i.push(new Rh(w/C,T/C,B/C))}o.push(e),s.push(i)}return[o,s]}(t,i,r,n,o)}(o,r,h,u,c,s,m,d,f,o.center.lat,e.tileID.canonical),y=e.queryGeometry;return function(e,t,i){let r=1/0;Nl(i,t)&&(r=Fd(i,t[0]));for(let n=0;n<t.length;n++){const o=t[n],s=e[n];for(let e=0;e<o.length-1;e++){const t=o[e],n=[t,o[e+1],s[e+1],s[e],t];Ol(i,n)&&(r=Math.min(r,Fd(i,n)))}}return r!==1/0&&r}(g,_,y.isPointQuery()?y.screenBounds:y.screenGeometry)}},line:class extends ms{constructor(e,t,i,r){const n=rp();super(e,n,t,i,r),n.layout&&(this.layout=new Go(n.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(e){if("line-gradient"===e){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Nr,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(e,t){super.recalculate(e,t),this.paint._values["line-floorwidth"]=(()=>{if(op)return op;const e=rp();return op=new np(e.paint.properties["line-width"].specification),op.useIntegerZoom=!0,op})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new $d(e)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(e,t,i){const r=ep(this);return{config:new Ha(this,{zoom:t,lut:i}),defines:r,overrideFog:!1}}queryRadius(e){const t=e,i=sp(Yl("line-width",this,t),Yl("line-gap-width",this,t)),r=Yl("line-offset",this,t);return i/2+Math.abs(r)+Jl(this.paint.get("line-translate"))}queryIntersectsFeature(e,t,i,r,n,o){if(e.queryGeometry.isAboveHorizon)return!1;const s=ec(e.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),o.angle,e.pixelToTileUnitsFactor),a=e.pixelToTileUnitsFactor/2*sp(this.paint.get("line-width").evaluate(t,i),this.paint.get("line-gap-width").evaluate(t,i)),l=this.paint.get("line-offset").evaluate(t,i);return l&&(r=function(e,t){const i=[],r=new V(0,0);for(let n=0;n<e.length;n++){const o=e[n],s=[];for(let e=0;e<o.length;e++){const i=o[e],n=o[e+1],a=0===e?r:i.sub(o[e-1])._unit()._perp(),l=e===o.length-1?r:n.sub(i)._unit()._perp(),c=a._add(l)._unit();c._mult(1/(c.x*l.x+c.y*l.y)),s.push(c._mult(t)._add(i))}i.push(s)}return i}(r,l*e.pixelToTileUnitsFactor)),function(e,t,i){for(let r=0;r<t.length;r++){const n=t[r];if(e.length>=3)for(let t=0;t<n.length;t++)if(Zl(e,n[t]))return!0;if(Ql(e,n,i))return!0}return!1}(s,r,a)}isTileClipped(){return this.hasNonElevatedBuckets}isDraped(e){return!this.hasElevatedBuckets}},symbol:zA,background:class extends ms{constructor(e,t,i,r){super(e,{layout:RA||(RA=new Ko({visibility:new $o(Wo.layout_background.visibility)})),paint:DA||(DA=new Ko({"background-pitch-alignment":new $o(Wo.paint_background["background-pitch-alignment"]),"background-color":new $o(Wo.paint_background["background-color"]),"background-pattern":new $o(Wo.paint_background["background-pattern"]),"background-opacity":new $o(Wo.paint_background["background-opacity"]),"background-emissive-strength":new $o(Wo.paint_background["background-emissive-strength"]),"background-color-use-theme":new Zo({type:"string",default:"default","property-type":"data-driven"})}))},t,i,r)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(e,t,i){return{overrideFog:!1}}is3D(e){return"viewport"===this.paint.get("background-pitch-alignment")}},raster:WA,"raster-particle":im,sky:class extends ms{constructor(e,t,i,r){super(e,{layout:JA||(JA=new Ko({visibility:new $o(Wo.layout_sky.visibility)})),paint:em||(em=new Ko({"sky-type":new $o(Wo.paint_sky["sky-type"]),"sky-atmosphere-sun":new $o(Wo.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new $o(Wo.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new $o(Wo.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new $o(Wo.paint_sky["sky-gradient-radius"]),"sky-gradient":new qo(Wo.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new $o(Wo.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new $o(Wo.paint_sky["sky-atmosphere-color"]),"sky-opacity":new $o(Wo.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new Zo({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new Zo({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new Zo({type:"string",default:"default","property-type":"data-driven"})}))},t,i,r),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){"sky-gradient"===e?this._updateColorRamp():"sky-atmosphere-sun"!==e&&"sky-atmosphere-halo-color"!==e&&"sky-atmosphere-color"!==e&&"sky-atmosphere-sun-intensity"!==e||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=fu({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(e){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const t=e.style.light.properties.get("position");return this._lightPosition.azimuthal!==t.azimuthal||this._lightPosition.polar!==t.polar}return!1}getCenter(e,t){if("atmosphere"===this.paint.get("sky-type")){const i=this.paint.get("sky-atmosphere-sun"),r=!i,n=e.style.light,o=n.properties.get("position");return r&&"viewport"===n.properties.get("anchor")&&de("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),r?nm(o.azimuthal,90-o.polar,t):nm(i[0],90-i[1],t)}const i=this.paint.get("sky-gradient-center");return nm(i[0],90-i[1],t)}isSky(){return!0}markSkyboxValid(e){this._skyboxInvalidated=!1,this._lightPosition=e.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const e=this.paint.get("sky-type");return"atmosphere"===e?["skyboxCapture","skybox"]:"gradient"===e?["skyboxGradient"]:null}},slot:class extends ms{constructor(e,t,i,r){super(e,{paint:tm||(tm=new Ko({}))},t,null)}},model:class extends ms{constructor(e,t,i,r){super(e,{layout:Em||(Em=new Ko({visibility:new $o(Wo.layout_model.visibility),"model-id":new Zo(Wo.layout_model["model-id"])})),paint:Mm||(Mm=new Ko({"model-opacity":new Zo(Wo.paint_model["model-opacity"]),"model-rotation":new Zo(Wo.paint_model["model-rotation"]),"model-scale":new Zo(Wo.paint_model["model-scale"]),"model-translation":new Zo(Wo.paint_model["model-translation"]),"model-color":new Zo(Wo.paint_model["model-color"]),"model-color-mix-intensity":new Zo(Wo.paint_model["model-color-mix-intensity"]),"model-type":new $o(Wo.paint_model["model-type"]),"model-cast-shadows":new $o(Wo.paint_model["model-cast-shadows"]),"model-receive-shadows":new $o(Wo.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new $o(Wo.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new Zo(Wo.paint_model["model-emissive-strength"]),"model-roughness":new Zo(Wo.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new Zo(Wo.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new $o(Wo.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new $o(Wo.paint_model["model-front-cutoff"]),"model-color-use-theme":new Zo({type:"string",default:"default","property-type":"data-driven"})}))},t,i,r),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(e){return new Sm(e)}getProgramIds(){return["model"]}is3D(e){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(e){return e instanceof Gm?Xi-1:0}queryIntersectsFeature(e,t,i,r,n,o){if(!this.modelManager)return!1;const s=this.modelManager,a=e.tile.getBucket(this);if(!(a&&a instanceof Sm))return!1;for(const i in a.instancesPerModel){const r=a.instancesPerModel[i],n=void 0!==t.id?t.id:t.properties&&t.properties.hasOwnProperty("id")?t.properties.id:void 0;if(r.idToFeaturesIndex.hasOwnProperty(n)){const t=r.features[r.idToFeaturesIndex[n]],l=s.getModel(i,this.scope);if(!l)return!1;let c=U.mat4.create();const u=new cl(0,0),h=a.canonical;let d=Number.MAX_VALUE;for(let i=0;i<t.instancedDataCount;++i){const n=16*(t.instancedDataOffset+i),s=r.instancedDataArray.float32,a=[s[n+4],s[n+5],s[n+6]];Km(h,u,s[n],0|s[n+1]),Lm(c,l,o,u,t.rotation,t.scale,a,!1,!1,!1),"globe"===o.projection.name&&(c=pm(c,o));const p=U.mat4.multiply([],o.projMatrix,c),f=e.queryGeometry,A=fm(f.isPointQuery()?f.screenBounds:f.screenGeometry,o,p,l.aabb);null!=A&&(d=Math.min(A,d))}return d!==Number.MAX_VALUE&&d}}return!1}_handleOverridablePaintPropertyUpdate(e,t,i){return!(!this.layout||t.isDataDriven()||i.isDataDriven()||"model-color"!==e&&"model-color-mix-intensity"!==e&&"model-rotation"!==e&&"model-scale"!==e&&"model-translation"!==e&&"model-emissive-strength"!==e)}_isPropertyZoomDependent(e){const t=this._transitionablePaint._values[e];return null!=t&&null!=t.value&&null!=t.value.expression&&t.value.expression instanceof eo}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends ms{constructor(e,t,i,r){super(e,{layout:Th||(Th=new Ko({"clip-layer-types":new $o(Wo.layout_clip["clip-layer-types"]),"clip-layer-scope":new $o(Wo.layout_clip["clip-layer-scope"])})),paint:Bh||(Bh=new Ko({}))},t,i,r)}recalculate(e,t){super.recalculate(e,t)}createBucket(e){return new Eh(e)}is3D(e){return!0}}};class Xm{constructor(e){this._callback=e,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._callback()}),0))}remove(){this._channel=void 0,this._callback=()=>{}}}class Ym{constructor(){this.tasks={},this.taskQueue=[],ae(["process"],this),this.invoker=new Xm(this.process),this.nextId=0}add(e,t){const i=this.nextId++,r=function({type:e,isSymbolTile:t,zoom:i}){return i=i||0,"message"===e?0:"maybePrepare"!==e||t?"parseTile"!==e||t?"parseTile"===e&&t?300-i:"maybePrepare"===e&&t?400-i:500:200-i:100-i}(t);if(0===r){try{e()}finally{}return null}return this.tasks[i]={fn:e,metadata:t,priority:r,id:i},this.taskQueue.push(i),this.invoker.trigger(),{cancel:()=>{delete this.tasks[i]}}}process(){try{if(this.taskQueue=this.taskQueue.filter((e=>!!this.tasks[e])),!this.taskQueue.length)return;const e=this.pick();if(null===e)return;const t=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!t)return;t.fn()}finally{}}pick(){let e=null,t=1/0;for(let i=0;i<this.taskQueue.length;i++){const r=this.tasks[this.taskQueue[i]];r.priority<t&&(t=r.priority,e=i)}if(null===e)return null;const i=this.taskQueue[e];return this.taskQueue.splice(e,1),i}remove(){this.invoker.remove()}}class Jm{constructor(e,t,i){this.target=e,this.parent=t,this.mapId=i,this.callbacks={},this.cancelCallbacks={},ae(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new Ym}send(e,t,i,r,n=!1,o){const s=Math.round(1e18*Math.random()).toString(36).substring(0,10);i&&(i.metadata=o,this.callbacks[s]=i);const a=new Set;return this.target.postMessage({id:s,type:e,hasCallback:!!i,targetMapId:r,mustQueue:n,sourceMapId:this.mapId,data:po(t,a)},a),{cancel:()=>{i&&delete this.callbacks[s],this.target.postMessage({id:s,type:"<cancel>",targetMapId:r,sourceMapId:this.mapId})}}}receive(e){const t=e.data;if(!t)return;const i=t.id;if(i&&(!t.targetMapId||this.mapId===t.targetMapId))if("<cancel>"===t.type){const e=this.cancelCallbacks[i];delete this.cancelCallbacks[i],e&&e.cancel()}else if(t.mustQueue||me()){const e=this.callbacks[i],r=this.scheduler.add((()=>this.processTask(i,t)),e&&e.metadata||{type:"message"});r&&(this.cancelCallbacks[i]=r)}else this.processTask(i,t)}processTask(e,t){if(delete this.cancelCallbacks[e],"<response>"===t.type){const i=this.callbacks[e];delete this.callbacks[e],i&&(t.error?i(fo(t.error)):i(null,fo(t.data)))}else{const i=new Set,r=t.hasCallback?(t,r)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:t?po(t):null,data:po(r,i)},i)}:()=>{},n=fo(t.data);if(this.parent[t.type])this.parent[t.type](t.sourceMapId,n,r);else if(this.parent.getWorkerSource){const e=t.type.split(".");this.parent.getWorkerSource(t.sourceMapId,e[0],n.source,n.scope)[e[1]](n,r)}else r(new Error(`Could not find function ${t.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var eg={workerUrl:"",workerClass:null,workerParams:void 0};const tg="mapboxgl_preloaded_worker_pool";class ig{constructor(){this.active={}}acquire(e,t=ig.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<t;)this.workers.push(null!=eg.workerClass?new eg.workerClass:new self.Worker(eg.workerUrl,eg.workerParams));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&0===this.numActive()&&(this.workers.forEach((e=>{e.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[tg]}numActive(){return Object.keys(this.active).length}}ig.workerCount=2;class rg{constructor(e,t,i="Worker",r=ig.workerCount){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=oe();const n=this.workerPool.acquire(this.id,r);for(let e=0;e<n.length;e++){const r=new rg.Actor(n[e],t,this.id);r.name=`${i} ${e}`,this.actors.push(r)}this.ready=!1,this.broadcast("checkIfReady",null,(()=>{this.ready=!0}))}broadcast(e,t,i){ie(this.actors,((i,r)=>{i.send(e,t,r)}),i=i||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach((e=>{e.remove()})),this.actors=[],this.workerPool.release(this.id)}}let ng,og;function sg(){return ng||(ng=new ig),ng}rg.Actor=Jm;const ag=new Ct(0,0,0);var lg=(e=>(e[e.PATH_RULE_UNSPECIFIED=0]="PATH_RULE_UNSPECIFIED",e[e.PATH_RULE_NON_ZERO=1]="PATH_RULE_NON_ZERO",e[e.PATH_RULE_EVEN_ODD=2]="PATH_RULE_EVEN_ODD",e))(lg||{}),cg=(e=>(e[e.LINE_CAP_UNSPECIFIED=0]="LINE_CAP_UNSPECIFIED",e[e.LINE_CAP_BUTT=1]="LINE_CAP_BUTT",e[e.LINE_CAP_ROUND=2]="LINE_CAP_ROUND",e[e.LINE_CAP_SQUARE=3]="LINE_CAP_SQUARE",e))(cg||{}),ug=(e=>(e[e.LINE_JOIN_UNSPECIFIED=0]="LINE_JOIN_UNSPECIFIED",e[e.LINE_JOIN_MITER=1]="LINE_JOIN_MITER",e[e.LINE_JOIN_MITER_CLIP=2]="LINE_JOIN_MITER_CLIP",e[e.LINE_JOIN_ROUND=3]="LINE_JOIN_ROUND",e[e.LINE_JOIN_BEVEL=4]="LINE_JOIN_BEVEL",e))(ug||{}),hg=(e=>(e[e.PAINT_ORDER_UNSPECIFIED=0]="PAINT_ORDER_UNSPECIFIED",e[e.PAINT_ORDER_FILL_AND_STROKE=1]="PAINT_ORDER_FILL_AND_STROKE",e[e.PAINT_ORDER_STROKE_AND_FILL=2]="PAINT_ORDER_STROKE_AND_FILL",e))(hg||{}),dg=(e=>(e[e.PATH_COMMAND_UNSPECIFIED=0]="PATH_COMMAND_UNSPECIFIED",e[e.PATH_COMMAND_MOVE=1]="PATH_COMMAND_MOVE",e[e.PATH_COMMAND_LINE=2]="PATH_COMMAND_LINE",e[e.PATH_COMMAND_QUAD=3]="PATH_COMMAND_QUAD",e[e.PATH_COMMAND_CUBIC=4]="PATH_COMMAND_CUBIC",e[e.PATH_COMMAND_CLOSE=5]="PATH_COMMAND_CLOSE",e))(dg||{}),pg=(e=>(e[e.MASK_TYPE_UNSPECIFIED=0]="MASK_TYPE_UNSPECIFIED",e[e.MASK_TYPE_LUMINANCE=1]="MASK_TYPE_LUMINANCE",e[e.MASK_TYPE_ALPHA=2]="MASK_TYPE_ALPHA",e))(pg||{});function fg(e,t,i){1===e&&t.icons.push(function(e,t){return function(e){if(e.usvg_tree.height||(e.usvg_tree.height=e.usvg_tree.width),!e.metadata)return e;const{metadata:t}=e;if(t.content_area){const{content_area:i}=t;null==i.top&&(i.top=i.left),null==i.width&&(i.width=e.usvg_tree.width),null==i.height&&(i.height=i.width)}return t.stretch_x&&t.stretch_x.length&&Ag(t,"x"),t.stretch_y&&t.stretch_y.length&&Ag(t,"y"),e}(e.readFields(mg,{name:void 0},t))}(i,i.readVarint()+i.pos))}function Ag(e,t){const i=[],r=e[`stretch_${t}`];let n=null;for(let e=0;e<r.length;e++)null===n?n=0===i.length?r[0]:i[i.length-1][1]+r[e]:(i.push([n,n+r[e]]),n=null);e[`stretch_${t}_areas`]=i}function mg(e,t,i){1===e?t.name=i.readString():2===e?t.metadata=function(e,t){return e.readFields(gg,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},t)}(i,i.readVarint()+i.pos):3===e&&(t.usvg_tree=function(e,t){return e.readFields(vg,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},t)}(i,i.readVarint()+i.pos),t.data="usvg_tree")}function gg(e,t,i){1===e?t.stretch_x=i.readPackedVarint():2===e?t.stretch_y=i.readPackedVarint():3===e?t.content_area=function(e,t){return e.readFields(_g,{left:0},t)}(i,i.readVarint()+i.pos):4===e&&t.variables.push(function(e,t){return e.readFields(yg,{name:void 0},t)}(i,i.readVarint()+i.pos))}function _g(e,t,i){1===e?t.left=i.readVarint():2===e?t.width=i.readVarint():3===e?t.top=i.readVarint():4===e&&(t.height=i.readVarint())}function yg(e,t,i){1===e?t.name=i.readString():2===e&&(t.rgb_color=Eg(i.readVarint()),t.value="rgb_color")}function vg(e,t,i){1===e?t.width=t.height=i.readVarint():2===e?t.height=i.readVarint():3===e?t.children.push(xg(i,i.readVarint()+i.pos)):4===e?t.linear_gradients.push(function(e,t){return e.readFields(Ig,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},t)}(i,i.readVarint()+i.pos)):5===e?t.radial_gradients.push(function(e,t){return e.readFields(Fg,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},t)}(i,i.readVarint()+i.pos)):7===e?t.clip_paths.push(function(e,t){return e.readFields(kg,{children:[]},t)}(i,i.readVarint()+i.pos)):8===e&&t.masks.push(function(e,t){const i=e.readFields(zg,{left:0,width:20,mask_type:1,children:[]},t);return null==i.height&&(i.height=i.width),null==i.top&&(i.top=i.left),i}(i,i.readVarint()+i.pos))}function xg(e,t){return e.readFields(bg,{},t)}function bg(e,t,i){1===e?(t.group=function(e,t){return e.readFields(wg,{opacity:255,children:[]},t)}(i,i.readVarint()+i.pos),t.node="group"):2===e&&(t.path=function(e,t){return e.readFields(Cg,{paint_order:1,commands:[],step:1,diffs:[],rule:1},t)}(i,i.readVarint()+i.pos),t.node="path")}function wg(e,t,i){1===e?t.transform=Tg(i,i.readVarint()+i.pos):2===e?t.opacity=i.readVarint():5===e?t.clip_path_idx=i.readVarint():6===e?t.mask_idx=i.readVarint():7===e&&t.children.push(xg(i,i.readVarint()+i.pos))}function Tg(e,t){return e.readFields(Bg,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},t)}function Bg(e,t,i){1===e?t.sx=i.readFloat():2===e?t.ky=i.readFloat():3===e?t.kx=i.readFloat():4===e?t.sy=i.readFloat():5===e?t.tx=i.readFloat():6===e&&(t.ty=i.readFloat())}function Cg(e,t,i){1===e?t.fill=function(e,t){return e.readFields(Sg,{rgb_color:ag,paint:"rgb_color",opacity:255},t)}(i,i.readVarint()+i.pos):2===e?t.stroke=function(e,t){return e.readFields(Mg,{rgb_color:ag,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},t)}(i,i.readVarint()+i.pos):3===e?t.paint_order=i.readVarint():5===e?i.readPackedVarint(t.commands):6===e?t.step=i.readFloat():7===e?i.readPackedSVarint(t.diffs):8===e&&(t.rule=i.readVarint())}function Sg(e,t,i){1===e?(t.rgb_color=Eg(i.readVarint()),t.paint="rgb_color"):2===e?(t.linear_gradient_idx=i.readVarint(),t.paint="linear_gradient_idx"):3===e?(t.radial_gradient_idx=i.readVarint(),t.paint="radial_gradient_idx"):5===e&&(t.opacity=i.readVarint())}function Eg(e){return new Ct((e>>16&255)/255,(e>>8&255)/255,(255&e)/255,1)}function Mg(e,t,i){1===e?(t.rgb_color=Eg(i.readVarint()),t.paint="rgb_color"):2===e?(t.linear_gradient_idx=i.readVarint(),t.paint="linear_gradient_idx"):3===e?(t.radial_gradient_idx=i.readVarint(),t.paint="radial_gradient_idx"):5===e?i.readPackedFloat(t.dasharray):6===e?t.dashoffset=i.readFloat():7===e?t.miterlimit=i.readFloat():8===e?t.opacity=i.readVarint():9===e?t.width=i.readFloat():10===e?t.linecap=i.readVarint():11===e&&(t.linejoin=i.readVarint())}function Ig(e,t,i){1===e?t.transform=Tg(i,i.readVarint()+i.pos):2===e?t.spread_method=i.readVarint():3===e?t.stops.push(Pg(i,i.readVarint()+i.pos)):4===e?t.x1=i.readFloat():5===e?t.y1=i.readFloat():6===e?t.x2=i.readFloat():7===e&&(t.y2=i.readFloat())}function Pg(e,t){return e.readFields(Lg,{offset:0,opacity:255,rgb_color:ag},t)}function Lg(e,t,i){1===e?t.offset=i.readFloat():2===e?t.opacity=i.readVarint():3===e&&(t.rgb_color=Eg(i.readVarint()))}function Fg(e,t,i){1===e?t.transform=Tg(i,i.readVarint()+i.pos):2===e?t.spread_method=i.readVarint():3===e?t.stops.push(Pg(i,i.readVarint()+i.pos)):4===e?t.cx=i.readFloat():5===e?t.cy=i.readFloat():6===e?t.r=i.readFloat():7===e?t.fx=i.readFloat():8===e?t.fy=i.readFloat():9===e&&(t.fr=i.readFloat())}function kg(e,t,i){1===e?t.transform=Tg(i,i.readVarint()+i.pos):2===e?t.clip_path_idx=i.readVarint():3===e&&t.children.push(xg(i,i.readVarint()+i.pos))}function zg(e,t,i){1===e?t.left=t.top=i.readFloat():2===e?t.width=t.height=i.readFloat():3===e?t.top=i.readFloat():4===e?t.height=i.readFloat():5===e?t.mask_type=i.readVarint():6===e?t.mask_idx=i.readVarint():7===e&&t.children.push(xg(i,i.readVarint()+i.pos))}class Rg{static calculate(e={},t=[]){const i=new Map,r=new Map;if(0===Object.keys(e).length)return i;t.forEach((e=>{r.set(e.name,e.rgb_color||new Ct(0,0,0))}));for(const[t,n]of Object.entries(e))r.has(t)?i.set(r.get(t).toStringPremultipliedAlpha(),n):console.warn(`Ignoring unknown image variable "${t}"`);return i}}function Dg(e,t=255,i){const r=t/255,n=e.toStringPremultipliedAlpha(),o=i.has(n)?i.get(n).clone():e.clone();return o.a*=r,o.toString()}function Og(e,t){if(!Fe()){const i=document.createElement("canvas");return i.width=e,i.height=t,i}return new OffscreenCanvas(e,t)}function Ug(e,t){const i=Rg.calculate(t.params,e.metadata?e.metadata.variables:[]),r=e.usvg_tree,n=r.width,o=r.height,s=t.transform?t.transform:new DOMMatrix,a=Math.max(1,Math.round(n*s.a)),l=Math.max(1,Math.round(o*s.d)),c=new DOMMatrix([a/n,0,0,l/o,0,0]),u=Og(a,l).getContext("2d");return Ng(u,c,r,r,i),u.getImageData(0,0,a,l)}function Ng(e,t,i,r,n){for(const o of r.children)Qg(e,t,i,o,n)}function Qg(e,t,i,r,n){r.group?(e.save(),function(e,t,i,r,n){const o=null!=r.mask_idx?i.masks[r.mask_idx]:null,s=null!=r.clip_path_idx?i.clip_paths[r.clip_path_idx]:null;if(r.transform&&(t=Wg(r.transform).preMultiplySelf(t)),!function(e,t,i){return 255!==e.opacity||t||i}(r,null!=s,null!=o))return void Ng(e,t,i,r,n);const a=Og(e.canvas.width,e.canvas.height),l=a.getContext("2d");Ng(l,t,i,r,n),s&&qg(l,t,i,s),o&&Kg(l,t,i,o,n),e.globalAlpha=r.opacity/255,e.drawImage(a,0,0)}(e,t,i,r.group,n),e.restore()):r.path&&(e.save(),function(e,t,i,r,n){const o=Xg(r);e.setTransform(t),r.paint_order===hg.PAINT_ORDER_FILL_AND_STROKE?(jg(e,i,r,o,n),Hg(e,i,r,o,n)):(Hg(e,i,r,o,n),jg(e,i,r,o,n))}(e,t,i,r.path,n),e.restore())}function jg(e,t,i,r,n){const o=i.fill;if(!o)return;const s=o.opacity/255;switch(o.paint){case"rgb_color":e.fillStyle=Dg(o.rgb_color,o.opacity,n);break;case"linear_gradient_idx":e.fillStyle=Gg(e,t.linear_gradients[o.linear_gradient_idx],s,n);break;case"radial_gradient_idx":e.fillStyle=$g(e,t.radial_gradients[o.radial_gradient_idx],s,n)}e.fill(r,Vg(i))}function Vg(e){return e.rule===lg.PATH_RULE_NON_ZERO?"nonzero":e.rule===lg.PATH_RULE_EVEN_ODD?"evenodd":void 0}function Hg(e,t,i,r,n){const o=i.stroke;if(!o)return;e.lineWidth=o.width,e.miterLimit=o.miterlimit,e.setLineDash(o.dasharray),e.lineDashOffset=o.dashoffset;const s=o.opacity/255;switch(o.paint){case"rgb_color":e.strokeStyle=Dg(o.rgb_color,o.opacity,n);break;case"linear_gradient_idx":e.strokeStyle=Gg(e,t.linear_gradients[o.linear_gradient_idx],s,n);break;case"radial_gradient_idx":e.strokeStyle=$g(e,t.radial_gradients[o.radial_gradient_idx],s,n)}switch(o.linejoin){case ug.LINE_JOIN_MITER_CLIP:case ug.LINE_JOIN_MITER:e.lineJoin="miter";break;case ug.LINE_JOIN_ROUND:e.lineJoin="round";break;case ug.LINE_JOIN_BEVEL:e.lineJoin="bevel"}switch(o.linecap){case cg.LINE_CAP_BUTT:e.lineCap="butt";break;case cg.LINE_CAP_ROUND:e.lineCap="round";break;case cg.LINE_CAP_SQUARE:e.lineCap="square"}e.stroke(r)}function Gg(e,t,i,r){if(1===t.stops.length){const e=t.stops[0];return Dg(e.rgb_color,e.opacity*i,r)}const n=Wg(t.transform),{x1:o,y1:s,x2:a,y2:l}=t,c=n.transformPoint(new DOMPoint(o,s)),u=n.transformPoint(new DOMPoint(a,l)),h=e.createLinearGradient(c.x,c.y,u.x,u.y);for(const e of t.stops)h.addColorStop(e.offset,Dg(e.rgb_color,e.opacity*i,r));return h}function $g(e,t,i,r){if(1===t.stops.length){const e=t.stops[0];return Dg(e.rgb_color,e.opacity*i,r)}const n=Wg(t.transform),{fx:o,fy:s,cx:a,cy:l}=t,c=n.transformPoint(new DOMPoint(o,s)),u=n.transformPoint(new DOMPoint(a,l)),h=e.createRadialGradient(c.x,c.y,0,u.x,u.y,t.r*((n.a+n.d)/2));for(const e of t.stops)h.addColorStop(e.offset,Dg(e.rgb_color,e.opacity*i,r));return h}function Zg(e,t,i,r){const n=r.transform?Wg(r.transform).preMultiplySelf(t):t,o=Og(e.canvas.width,e.canvas.height),s=o.getContext("2d");for(const e of r.children)if(e.group)Zg(s,n,i,e.group);else if(e.path){const t=e.path,i=new Path2D;i.addPath(Xg(t),n),s.fill(i,Vg(t))}const a=null!=r.clip_path_idx?i.clip_paths[r.clip_path_idx]:null;a&&qg(s,n,i,a),e.globalCompositeOperation="source-over",e.drawImage(o,0,0)}function qg(e,t,i,r){const n=Og(e.canvas.width,e.canvas.height);Zg(n.getContext("2d"),t,i,r),e.globalCompositeOperation="destination-in",e.drawImage(n,0,0)}function Kg(e,t,i,r,n){if(0===r.children.length)return;const o=null!=r.mask_idx?i.masks[r.mask_idx]:null;o&&Kg(e,t,i,o,n);const s=e.canvas.width,a=e.canvas.height,l=Og(s,a),c=l.getContext("2d"),u=r.width,h=r.height,d=r.left,p=r.top,f=new Path2D,A=new Path2D;A.rect(d,p,u,h),f.addPath(A,t),c.clip(f);for(const e of r.children)Qg(c,t,i,e,n);const m=c.getImageData(0,0,s,a),g=m.data;if(r.mask_type===pg.MASK_TYPE_LUMINANCE)for(let e=0;e<g.length;e+=4)g[e+3]=g[e+3]/255*(.2126*g[e]+.7152*g[e+1]+.0722*g[e+2]);c.putImageData(m,0,0),e.globalCompositeOperation="destination-in",e.drawImage(l,0,0)}function Wg(e){return e?new DOMMatrix([e.sx,e.ky,e.kx,e.sy,e.tx,e.ty]):new DOMMatrix}function Xg(e){const t=new Path2D,i=e.step;let r=e.diffs[0]*i,n=e.diffs[1]*i;t.moveTo(r,n);for(let o=0,s=2;o<e.commands.length;o++)switch(e.commands[o]){case dg.PATH_COMMAND_MOVE:r+=e.diffs[s++]*i,n+=e.diffs[s++]*i,t.moveTo(r,n);break;case dg.PATH_COMMAND_LINE:r+=e.diffs[s++]*i,n+=e.diffs[s++]*i,t.lineTo(r,n);break;case dg.PATH_COMMAND_QUAD:{const o=r+e.diffs[s++]*i,a=n+e.diffs[s++]*i;r=o+e.diffs[s++]*i,n=a+e.diffs[s++]*i,t.quadraticCurveTo(o,a,r,n);break}case dg.PATH_COMMAND_CUBIC:{const o=r+e.diffs[s++]*i,a=n+e.diffs[s++]*i,l=o+e.diffs[s++]*i,c=a+e.diffs[s++]*i;r=l+e.diffs[s++]*i,n=c+e.diffs[s++]*i,t.bezierCurveTo(o,a,l,c,r,n);break}case dg.PATH_COMMAND_CLOSE:t.closePath()}return t}class Yg{constructor(e){this.capacity=e,this.cache=new Map}get(e){if(!this.cache.has(e))return;const t=this.cache.get(e);return this.cache.delete(e),this.cache.set(e,t),t}put(e,t){this.cache.has(e)?this.cache.delete(e):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(e,t)}delete(e){this.cache.delete(e)}}co(Yg,"LRUCache");class Jg{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(e){return new du(e,e.data)}getFromCache(e,t,i){return this.cacheMap.has(i)||this.cacheMap.set(i,new Yg(150)),this.cacheMap.get(i).get(ps(e.toString(),t))}setInCache(e,t,i,r){this.cacheDependenciesMap.has(r)||this.cacheDependenciesMap.set(r,new Map),this.cacheMap.has(r)||this.cacheMap.set(r,new Yg(150));const n=this.cacheDependenciesMap.get(r),o=ps(e.id.toString(),i);n.get(o)||n.set(o,new Set);const s=this.cacheMap.get(r),a=e.toString();n.get(o).add(a),s.put(ps(e.toString(),i),t)}removeImagesFromCacheByIds(e,t,i=0){if(!this.cacheMap.has(i)||!this.cacheDependenciesMap.has(i))return;const r=this.cacheMap.get(i),n=this.cacheDependenciesMap.get(i);for(const i of e){const e=ps(i.toString(),t);if(n.has(e)){for(const t of n.get(e))r.delete(t);n.delete(e)}}}rasterize(e,t,i,r,n=Ug){const o=this.getFromCache(e,i,r);if(o)return o.clone();const s=n(t.icon,e.options),a=Jg._getImage(s);return this.setInCache(e,a,i,r),a.clone()}}class e_{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,t){const i=this.toIdx(e,t);return{min:this.minimums[i],max:this.maximums[i]}}isLeaf(e,t){return this.leaves[this.toIdx(e,t)]}toIdx(e,t){return t*this.size+e}}function t_(e,t,i,r){let n=0,o=Number.MAX_VALUE;for(let s=0;s<3;s++)if(Math.abs(r[s])<1e-15){if(i[s]<e[s]||i[s]>t[s])return null}else{const a=1/r[s];let l=(e[s]-i[s])*a,c=(t[s]-i[s])*a;if(l>c){const e=l;l=c,c=e}if(l>n&&(n=l),c<o&&(o=c),n>o)return null}return n}function i_(e,t,i,r,n,o,s,a,l,c,u){const h=r-e,d=n-t,p=o-i,f=s-e,A=a-t,m=l-i,g=u[1]*m-u[2]*A,_=u[2]*f-u[0]*m,y=u[0]*A-u[1]*f,v=h*g+d*_+p*y;if(Math.abs(v)<1e-15)return null;const x=1/v,b=c[0]-e,w=c[1]-t,T=c[2]-i,B=(b*g+w*_+T*y)*x;if(B<0||B>1)return null;const C=w*p-T*d,S=T*h-b*p,E=b*d-w*h,M=(u[0]*C+u[1]*S+u[2]*E)*x;return M<0||B+M>1?null:(f*C+A*S+m*E)*x}function r_(e,t,i){return(e-t)/(i-t)}function n_(e,t,i,r,n,o,s,a,l){const c=1<<i,u=o-r,h=s-n,d=(e+1)/c*u+r,p=(t+0)/c*h+n,f=(t+1)/c*h+n;a[0]=(e+0)/c*u+r,a[1]=p,l[0]=d,l[1]=f}class o_{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const t=function(e){const t=Math.ceil(Math.log2(e.dim/8)),i=[];let r=Math.ceil(Math.pow(2,t));const n=1/r,o=(e,t,i,r,n)=>{const o=r?1:0,s=(e+1)*i-o,a=t*i,l=(t+1)*i-o;n[0]=e*i,n[1]=a,n[2]=s,n[3]=l};let s=new e_(r);const a=[];for(let t=0;t<r*r;t++){o(t%r,Math.floor(t/r),n,!1,a);const i=a_(a[0],a[1],e),l=a_(a[2],a[1],e),c=a_(a[2],a[3],e),u=a_(a[0],a[3],e);s.minimums.push(Math.min(i,l,c,u)),s.maximums.push(Math.max(i,l,c,u)),s.leaves.push(1)}for(i.push(s),r/=2;r>=1;r/=2){const e=i[i.length-1];s=new e_(r);for(let t=0;t<r*r;t++){o(t%r,Math.floor(t/r),2,!0,a);const i=e.getElevation(a[0],a[1]),n=e.getElevation(a[2],a[1]),l=e.getElevation(a[2],a[3]),c=e.getElevation(a[0],a[3]),u=e.isLeaf(a[0],a[1]),h=e.isLeaf(a[2],a[1]),d=e.isLeaf(a[2],a[3]),p=e.isLeaf(a[0],a[3]),f=Math.min(i.min,n.min,l.min,c.min),A=Math.max(i.max,n.max,l.max,c.max),m=u&&h&&d&&p;s.maximums.push(A),s.minimums.push(f),s.leaves.push(A-f<=5&&m?1:0)}i.push(s)}return i}(this.dem),i=t.length-1,r=t[i];this._addNode(r.minimums[0],r.maximums[0],r.leaves[0]),this._construct(t,0,0,i,0)}raycastRoot(e,t,i,r,n,o,s=1){return t_([e,t,-100],[i,r,this.maximums[0]*s],n,o)}raycast(e,t,i,r,n,o,s=1){if(!this.nodeCount)return null;const a=this.raycastRoot(e,t,i,r,n,o,s);if(null==a)return null;const l=[],c=[],u=[],h=[],d=[{idx:0,t:a,nodex:0,nodey:0,depth:0}];for(;d.length>0;){const{idx:a,t:p,nodex:f,nodey:A,depth:m}=d.pop();if(this.leaves[a]){n_(f,A,m,e,t,i,r,u,h);const a=1<<m,l=(f+0)/a,c=(f+1)/a,d=(A+0)/a,g=(A+1)/a,_=a_(l,d,this.dem)*s,y=a_(c,d,this.dem)*s,v=a_(c,g,this.dem)*s,x=a_(l,g,this.dem)*s,b=i_(u[0],u[1],_,h[0],u[1],y,h[0],h[1],v,n,o),w=i_(h[0],h[1],v,u[0],h[1],x,u[0],u[1],_,n,o),T=Math.min(null!==b?b:Number.MAX_VALUE,null!==w?w:Number.MAX_VALUE);if(T!==Number.MAX_VALUE)return T;{const e=U.vec3.scaleAndAdd([],n,o,p);if(s_(_,y,x,v,r_(e[0],u[0],h[0]),r_(e[1],u[1],h[1]))>=e[2])return p}continue}let g=0;for(let d=0;d<this._siblingOffset.length;d++){n_((f<<1)+this._siblingOffset[d][0],(A<<1)+this._siblingOffset[d][1],m+1,e,t,i,r,u,h),u[2]=-100,h[2]=this.maximums[this.childOffsets[a]+d]*s;const p=t_(u,h,n,o);if(null!=p){const e=p;l[d]=e;let t=!1;for(let i=0;i<g&&!t;i++)e>=l[c[i]]&&(c.splice(i,0,d),t=!0);t||(c[g]=d),g++}}for(let e=0;e<g;e++){const t=c[e];d.push({idx:this.childOffsets[a]+t,t:l[t],nodex:(f<<1)+this._siblingOffset[t][0],nodey:(A<<1)+this._siblingOffset[t][1],depth:m+1})}}return null}_addNode(e,t,i){return this.minimums.push(e),this.maximums.push(t),this.leaves.push(i),this.childOffsets.push(0),this.nodeCount++}_construct(e,t,i,r,n){if(1===e[r].isLeaf(t,i))return;this.childOffsets[n]||(this.childOffsets[n]=this.nodeCount);const o=r-1,s=e[o];let a=0,l=0;for(let e=0;e<this._siblingOffset.length;e++){const r=2*t+this._siblingOffset[e][0],n=2*i+this._siblingOffset[e][1],o=s.getElevation(r,n),c=s.isLeaf(r,n),u=this._addNode(o.min,o.max,c);c&&(a|=1<<e),l||(l=u)}for(let r=0;r<this._siblingOffset.length;r++)a&1<<r||this._construct(e,2*t+this._siblingOffset[r][0],2*i+this._siblingOffset[r][1],o,l+r)}}function s_(e,t,i,r,n,o){return Et(Et(e,i,o),Et(t,r,o),n)}function a_(e,t,i){const r=i.dim,n=J(e*r-.5,0,r-1),o=J(t*r-.5,0,r-1),s=Math.floor(n),a=Math.floor(o),l=Math.min(s+1,r-1),c=Math.min(a+1,r-1);return s_(i.get(s,a),i.get(l,a),i.get(s,c),i.get(l,c),n-s,o-a)}const l_={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function c_(e,t,i){return(256*e*256+256*t+i)/10-1e4}function u_(e,t,i){return 256*e+t+i/256-32768}class h_{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,t,i,r=!1){if(this.uid=e,t.height!==t.width)throw new RangeError("DEM tiles must be square");if(i&&"mapbox"!==i&&"terrarium"!==i)return void de(`"${i}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=t.height;const n=this.dim=t.height-2,o=new Uint32Array(t.data.buffer);if(this.pixels=new Uint8Array(t.data.buffer),this.floatView=new Float32Array(t.data.buffer),this.borderReady=r,this._modifiedForSources={},!r){for(let e=0;e<n;e++)o[this._idx(-1,e)]=o[this._idx(0,e)],o[this._idx(n,e)]=o[this._idx(n-1,e)],o[this._idx(e,-1)]=o[this._idx(e,0)],o[this._idx(e,n)]=o[this._idx(e,n-1)];o[this._idx(-1,-1)]=o[this._idx(0,0)],o[this._idx(n,-1)]=o[this._idx(n-1,0)],o[this._idx(-1,n)]=o[this._idx(0,n-1)],o[this._idx(n,n)]=o[this._idx(n-1,n-1)]}const s="terrarium"===i?u_:c_;for(let e=0;e<o.length;++e){const t=4*e;this.floatView[e]=s(this.pixels[t],this.pixels[t+1],this.pixels[t+2])}this._timestamp=ke.now()}_buildQuadTree(){this._tree=new o_(this)}get(e,t,i=!1){i&&(e=J(e,-1,this.dim),t=J(t,-1,this.dim));const r=this._idx(e,t);return this.floatView[r]}set(e,t,i){const r=this._idx(e,t),n=this.floatView[r];return this.floatView[r]=i,i-n}static getUnpackVector(e){return l_[e]}_idx(e,t){if(e<-1||e>=this.dim+1||t<-1||t>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(t+1)*this.stride+(e+1)}static pack(e,t){const i=[0,0,0,0],r=h_.getUnpackVector(t);let n=Math.floor((e+r[3])/r[2]);return i[2]=n%256,n=Math.floor(n/256),i[1]=n%256,n=Math.floor(n/256),i[0]=n,i}getPixels(){return new pu({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,t,i){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let r=t*this.dim,n=t*this.dim+this.dim,o=i*this.dim,s=i*this.dim+this.dim;switch(t){case-1:r=n-1;break;case 1:n=r+1}switch(i){case-1:o=s-1;break;case 1:s=o+1}const a=-t*this.dim,l=-i*this.dim;for(let t=o;t<s;t++)for(let i=r;i<n;i++){const r=4*this._idx(i,t),n=4*this._idx(i+a,t+l);this.pixels[r+0]=e.pixels[n+0],this.pixels[r+1]=e.pixels[n+1],this.pixels[r+2]=e.pixels[n+2],this.pixels[r+3]=e.pixels[n+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function d_(e,t,i){1===e?t.headerLength=i.readFixed32():2===e?t.x=i.readVarint():3===e?t.y=i.readVarint():4===e?t.z=i.readVarint():5===e&&t.layers.push(function(e,t){return e.readFields(g_,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},t)}(i,i.readVarint()+i.pos))}function p_(e,t,i){1===e?(t.delta_filter=function(e,t){return e.readFields(f_,{blockSize:0},t)}(i,i.readVarint()+i.pos),t.filter="delta_filter"):2===e?(i.readVarint(),t.filter="zigzag_filter"):3===e?(i.readVarint(),t.filter="bitshuffle_filter"):4===e&&(i.readVarint(),t.filter="byteshuffle_filter")}function f_(e,t,i){1===e&&(t.blockSize=i.readVarint())}function A_(e,t,i){1===e?(i.readVarint(),t.codec="gzip_data"):2===e?(i.readVarint(),t.codec="jpeg_image"):3===e?(i.readVarint(),t.codec="webp_image"):4===e&&(i.readVarint(),t.codec="png_image")}function m_(e,t,i){let r=0,n=0;1===e?t.firstByte=i.readFixed64():2===e?t.lastByte=i.readFixed64():3===e?t.filters.push(function(e,t){return e.readFields(p_,{},t)}(i,i.readVarint()+i.pos)):4===e?t.codec=function(e,t){return e.readFields(A_,{},t)}(i,i.readVarint()+i.pos):5===e?n=i.readFloat():6===e?r=i.readFloat():7===e?t.bands.push(i.readString()):8===e?t.offset=i.readDouble():9===e&&(t.scale=i.readDouble()),0===t.offset&&(t.offset=n),0===t.scale&&(t.scale=r)}function g_(e,t,i){1===e?t.version=i.readVarint():2===e?t.name=i.readString():3===e?t.units=i.readString():4===e?t.tileSize=i.readVarint():5===e?t.buffer=i.readVarint():6===e?t.pixelFormat=i.readVarint():7===e&&t.dataIndex.push(function(e,t){return e.readFields(m_,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},t)}(i,i.readVarint()+i.pos))}function __(e,t,i){if(2===e)!function(e,t,i){e.readFields(y_,i,t)}(i,i.readVarint()+i.pos,t);else if(3===e)throw new Error("Not implemented")}function y_(e,t,i){if(1===e){let e=0;const r=i.readVarint()+i.pos;for(;i.pos<r;)t[e++]=i.readVarint()}}function v_(e,t){if(4!==t.length)throw new Error(`Expected data of dimension 4 but got ${t.length}.`);let i=t[3];for(let r=2;r>=1;r--){const n=1===r?1:0,o=2===r?1:0;for(let r=0;r<t[0];r++){const s=t[1]*r;for(let r=n;r<t[1];r++){const n=t[2]*(r+s);for(let r=o;r<t[2];r++){const o=t[3]*(r+n);for(let r=0;r<t[3];r++){const t=o+r;e[t]+=e[t-i]}}}}i*=t[r]}return e}function x_(e){for(let t=0,i=e.length;t<i;t++)e[t]=e[t]>>>1^-(1&e[t]);return e}function b_(e,t){switch(t){case"uint32":return e;case"uint16":for(let t=0;t<e.length;t+=2){const i=e[t],r=e[t+1];e[t]=(240&i)>>4|(61440&i)>>8|(240&r)<<4|61440&r,e[t+1]=15&i|(3840&i)>>4|(15&r)<<8|(3840&r)<<4}return e;case"uint8":for(let t=0;t<e.length;t+=4){const i=e[t],r=e[t+1],n=e[t+2],o=e[t+3];e[t+0]=(192&i)>>6|(192&r)>>4|(192&n)>>2|192&o,e[t+1]=(48&i)>>4|(48&r)>>2|48&n|(48&o)<<2,e[t+2]=(12&i)>>2|12&r|(12&n)<<2|(12&o)<<4,e[t+3]=3&i|(3&r)<<2|(3&n)<<4|(3&o)<<6}return e;default:throw new Error(`Invalid pixel format, "${t}"`)}}co(h_,"DEMData"),co(o_,"DemMinMaxQuadTree",{omit:["dem"]});var w_=Uint8Array,T_=Uint16Array,B_=Int32Array,C_=new w_([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),S_=new w_([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),E_=new w_([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),M_=function(e,t){for(var i=new T_(31),r=0;r<31;++r)i[r]=t+=1<<e[r-1];var n=new B_(i[30]);for(r=1;r<30;++r)for(var o=i[r];o<i[r+1];++o)n[o]=o-i[r]<<5|r;return{b:i,r:n}},I_=M_(C_,2),P_=I_.b,L_=I_.r;P_[28]=258,L_[258]=28;for(var F_=M_(S_,0).b,k_=new T_(32768),z_=0;z_<32768;++z_){var R_=(43690&z_)>>1|(21845&z_)<<1;k_[z_]=((65280&(R_=(61680&(R_=(52428&R_)>>2|(13107&R_)<<2))>>4|(3855&R_)<<4))>>8|(255&R_)<<8)>>1}var D_=function(e,t,i){for(var r=e.length,n=0,o=new T_(t);n<r;++n)e[n]&&++o[e[n]-1];var s,a=new T_(t);for(n=1;n<t;++n)a[n]=a[n-1]+o[n-1]<<1;s=new T_(1<<t);var l=15-t;for(n=0;n<r;++n)if(e[n])for(var c=n<<4|e[n],u=t-e[n],h=a[e[n]-1]++<<u,d=h|(1<<u)-1;h<=d;++h)s[k_[h]>>l]=c;return s},O_=new w_(288);for(z_=0;z_<144;++z_)O_[z_]=8;for(z_=144;z_<256;++z_)O_[z_]=9;for(z_=256;z_<280;++z_)O_[z_]=7;for(z_=280;z_<288;++z_)O_[z_]=8;var U_=new w_(32);for(z_=0;z_<32;++z_)U_[z_]=5;var N_=D_(O_,9),Q_=D_(U_,5),j_=function(e){for(var t=e[0],i=1;i<e.length;++i)e[i]>t&&(t=e[i]);return t},V_=function(e,t,i){var r=t/8|0;return(e[r]|e[r+1]<<8)>>(7&t)&i},H_=function(e,t){var i=t/8|0;return(e[i]|e[i+1]<<8|e[i+2]<<16)>>(7&t)},G_=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],$_=function(e,t,i){var r=new Error(t||G_[e]);if(r.code=e,Error.captureStackTrace&&Error.captureStackTrace(r,$_),!i)throw r;return r},Z_=new w_(0),q_="undefined"!=typeof TextDecoder&&new TextDecoder;try{q_.decode(Z_,{stream:!0})}catch(e){}const K_={gzip_data:"gzip"};class W_ extends Error{constructor(e){super(e),this.name="MRTError"}}const X_={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},Y_={uint32:1,uint16:2,uint8:4},J_={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let ey;class ty{constructor(e=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=e}getLayer(e){const t=this.layers[e];if(!t)throw new W_(`Layer '${e}' not found`);return t}getHeaderLength(e){const t=new Uint8Array(e),i=new DataView(e);if(13!==t[0])throw new W_("File is not a valid MRT.");return i.getUint32(1,!0)}parseHeader(e){const t=new Uint8Array(e),i=this.getHeaderLength(e);if(t.length<i)throw new W_(`Expected header with length >= ${i} but got buffer of length ${t.length}`);const r=function(e){return e.readFields(d_,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0)}(new ey(t.subarray(0,i)));if(!isNaN(this.x)&&(this.x!==r.x||this.y!==r.y||this.z!==r.z))throw new W_(`Invalid attempt to parse header ${r.z}/${r.x}/${r.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=r.x,this.y=r.y,this.z=r.z;for(const e of r.layers)this.layers[e.name]=new iy(e,{cacheSize:this._cacheSize});return this}createDecodingTask(e){const t=[],i=this.getLayer(e.layerName);for(let r of e.blockIndices){const n=i.dataIndex[r],o=n.firstByte-e.firstByte,s=n.lastByte-e.firstByte;if(i._blocksInProgress.has(r))continue;const a={layerName:i.name,firstByte:o,lastByte:s,pixelFormat:i.pixelFormat,blockIndex:r,blockShape:[n.bands.length].concat(i.bandShape),buffer:i.buffer,codec:n.codec.codec,filters:n.filters.map((e=>e.filter))};i._blocksInProgress.add(r),t.push(a)}return new ry(t,(()=>{t.forEach((e=>i._blocksInProgress.delete(e.blockIndex)))}),((e,r)=>{if(t.forEach((e=>i._blocksInProgress.delete(e.blockIndex))),e)throw e;r.forEach((e=>{this.getLayer(e.layerName).processDecodedData(e)}))}))}}class iy{constructor({version:e,name:t,units:i,tileSize:r,pixelFormat:n,buffer:o,dataIndex:s},a){if(this.version=e,1!==this.version)throw new W_(`Cannot parse raster layer encoded with MRT version ${e}`);this.name=t,this.units=i,this.tileSize=r,this.buffer=o,this.pixelFormat=X_[n],this.dataIndex=s,this.bandShape=[r+2*o,r+2*o,Y_[this.pixelFormat]],this._decodedBlocks=new Yg(a?a.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return Y_[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map((({bands:e})=>e)).flat()}processDecodedData(e){const t=e.blockIndex.toString();this._decodedBlocks.get(t)||this._decodedBlocks.put(t,e.data)}getBlockForBand(e){let t=0;switch(typeof e){case"string":for(const[i,r]of this.dataIndex.entries()){for(const[n,o]of r.bands.entries())if(o===e)return{bandIndex:t+n,blockIndex:i,blockBandIndex:n};t+=r.bands.length}break;case"number":for(const[i,r]of this.dataIndex.entries()){if(e>=t&&e<t+r.bands.length)return{bandIndex:e,blockIndex:i,blockBandIndex:e-t};t+=r.bands.length}break;default:throw new W_(`Invalid band \`${JSON.stringify(e)}\`. Expected string or integer.`)}return{blockIndex:-1,blockBandIndex:-1}}getDataRange(e){let t=1/0,i=-1/0;const r=[],n=new Set;for(const o of e){const{blockIndex:e}=this.getBlockForBand(o);if(e<0)throw new W_(`Invalid band: ${JSON.stringify(o)}`);const s=this.dataIndex[e];r.includes(e)||r.push(e),n.add(e),t=Math.min(t,s.firstByte),i=Math.max(i,s.lastByte)}if(n.size>this.cacheSize)throw new W_(`Number of blocks to decode (${n.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:t,lastByte:i,blockIndices:r}}hasBand(e){const{blockIndex:t}=this.getBlockForBand(e);return t>=0}hasDataForBand(e){const{blockIndex:t}=this.getBlockForBand(e);return t>=0&&!!this._decodedBlocks.get(t.toString())}getBandView(e){const{blockIndex:t,blockBandIndex:i}=this.getBlockForBand(e);if(t<0)throw new W_(`Band not found: ${JSON.stringify(e)}`);const r=this._decodedBlocks.get(t.toString());if(!r)throw new W_(`Data for band ${JSON.stringify(e)} of layer "${this.name}" not decoded.`);const n=this.dataIndex[t],o=this.bandShape.reduce(((e,t)=>e*t),1),s=i*o,a=r.subarray(s,s+o);return{data:a,bytes:new Uint8Array(a.buffer).subarray(a.byteOffset,a.byteOffset+a.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:n.offset,scale:n.scale}}}ty.setPbf=function(e){ey=e};class ry{constructor(e,t,i){this.tasks=e,this._onCancel=t,this._onComplete=i,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(e,t){this._finalized||(this._onComplete(e,t),this._finalized=!0)}}ty.performDecoding=function(e,t){const i=new Uint8Array(e);return Promise.all(t.tasks.map((e=>{const{layerName:t,firstByte:r,lastByte:n,pixelFormat:o,blockShape:s,blockIndex:a,filters:l,codec:c}=e,u=i.subarray(r,n+1),h=new Uint32Array(s[0]*s[1]*s[2]);let d;if("gzip_data"!==c)throw new W_(`Unhandled codec: ${c}`);return d=function(e,t){if(!globalThis.DecompressionStream&&"gzip_data"===t)return Promise.resolve(((o=function(e){31==e[0]&&139==e[1]&&8==e[2]||$_(6,"invalid gzip data");var t=e[3],i=10;4&t&&(i+=2+(e[10]|e[11]<<8));for(var r=(t>>3&1)+(t>>4&1);r>0;r-=!e[i++]);return i+(2&t)}(n=e))+8>n.length&&$_(6,"invalid gzip data"),function(e,t,i){var r=e.length;if(!r||t.f&&!t.l)return i||new w_(0);var n=!i,o=n||2!=t.i,s=t.i;n&&(i=new w_(3*r));var a,l,c=function(e){var t=i.length;if(e>t){var r=new w_(Math.max(2*t,e));r.set(i),i=r}},u=t.f||0,h=t.p||0,d=t.b||0,p=t.l,f=t.d,A=t.m,m=t.n,g=8*r;do{if(!p){u=V_(e,h,1);var _=V_(e,h+1,3);if(h+=3,!_){var y=e[(I=4+((h+7)/8|0))-4]|e[I-3]<<8,v=I+y;if(v>r){s&&$_(0);break}o&&c(d+y),i.set(e.subarray(I,v),d),t.b=d+=y,t.p=h=8*v,t.f=u;continue}if(1==_)p=N_,f=Q_,A=9,m=5;else if(2==_){var x=V_(e,h,31)+257,b=V_(e,h+10,15)+4,w=x+V_(e,h+5,31)+1;h+=14;for(var T=new w_(w),B=new w_(19),C=0;C<b;++C)B[E_[C]]=V_(e,h+3*C,7);h+=3*b;var S=j_(B),E=(1<<S)-1,M=D_(B,S);for(C=0;C<w;){var I,P=M[V_(e,h,E)];if(h+=15&P,(I=P>>4)<16)T[C++]=I;else{var L=0,F=0;for(16==I?(F=3+V_(e,h,3),h+=2,L=T[C-1]):17==I?(F=3+V_(e,h,7),h+=3):18==I&&(F=11+V_(e,h,127),h+=7);F--;)T[C++]=L}}var k=T.subarray(0,x),z=T.subarray(x);A=j_(k),m=j_(z),p=D_(k,A),f=D_(z,m)}else $_(1);if(h>g){s&&$_(0);break}}o&&c(d+131072);for(var R=(1<<A)-1,D=(1<<m)-1,O=h;;O=h){var U=(L=p[H_(e,h)&R])>>4;if((h+=15&L)>g){s&&$_(0);break}if(L||$_(2),U<256)i[d++]=U;else{if(256==U){O=h,p=null;break}var N=U-254;U>264&&(N=V_(e,h,(1<<(V=C_[C=U-257]))-1)+P_[C],h+=V);var Q=f[H_(e,h)&D],j=Q>>4;if(Q||$_(3),h+=15&Q,z=F_[j],j>3){var V=S_[j];z+=H_(e,h)&(1<<V)-1,h+=V}if(h>g){s&&$_(0);break}o&&c(d+131072);var H=d+N;if(d<z){var G=0-z,$=Math.min(z,H);for(G+d<0&&$_(3);d<$;++d)i[d]=(void 0)[G+d]}for(;d<H;++d)i[d]=i[d-z]}}t.l=p,t.p=O,t.b=d,t.f=u,p&&(u=1,t.m=A,t.d=f,t.n=m)}while(!u);return d!=i.length&&n?(a=i,(null==(l=d)||l>a.length)&&(l=a.length),new w_(a.subarray(0,l))):i.subarray(0,d)}(n.subarray(o,-8),{i:2},new w_(((i=n)[(r=i.length)-4]|i[r-3]<<8|i[r-2]<<16|i[r-1]<<24)>>>0))));var i,r,n,o;const s=K_[t];if(!s)throw new Error(`Unhandled codec: ${t}`);const a=new globalThis.DecompressionStream(s);return new Response(new Blob([e]).stream().pipeThrough(a)).arrayBuffer().then((e=>new Uint8Array(e)))}(u,c).then((e=>(function(e,t){e.readFields(__,t)}(new ey(e),h),new J_[o](h.buffer)))),d.then((e=>{for(let t=l.length-1;t>=0;t--)switch(l[t]){case"delta_filter":v_(e,s);break;case"zigzag_filter":x_(e);break;case"bitshuffle_filter":b_(e,o);break;default:throw new W_(`Unhandled filter "${l[t]}"`)}return{layerName:t,blockIndex:a,data:e}})).catch((e=>{throw e}))})))},co(ry,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]}),co(ty,"MapboxRasterTile"),co(iy,"MapboxRasterLayer",{omit:["_blocksInProgress"]});let ny,oy,sy,ay,ly,cy=null;function uy(){return me()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:oy||Te.DRACO_URL}function hy(){if(me()&&self.worker&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(ay)return ay;const e=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if("object"!=typeof WebAssembly)throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return ay=WebAssembly.validate(e)?Te.MESHOPT_SIMD_URL:Te.MESHOPT_URL,ay}const dy={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},py={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},fy={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function Ay(e,t,i){const r=i.json.bufferViews.length,n=i.buffers.length;t.bufferView=r,i.json.bufferViews[r]={buffer:n,byteLength:e.byteLength},i.buffers[n]=e}const my="KHR_draco_mesh_compression";function gy(e,t){const i=e.extensions&&e.extensions[my];if(!i)return;const r=new sy.Decoder,n=Ty(t,i.bufferView),o=new sy.Mesh;if(!r.DecodeArrayToMesh(n,n.byteLength,o))throw new Error("Failed to decode Draco mesh");const s=t.json.accessors[e.indices],a=dy[s.componentType],l=s.count*a.BYTES_PER_ELEMENT,c=sy._malloc(l);a===Uint16Array?r.GetTrianglesUInt16Array(o,l,c):r.GetTrianglesUInt32Array(o,l,c),Ay(sy.memory.buffer.slice(c,c+l),s,t),sy._free(c);for(const n of Object.keys(i.attributes)){const s=r.GetAttributeByUniqueId(o,i.attributes[n]),a=t.json.accessors[e.attributes[n]],l=py[a.componentType],c=a.count*fy[a.type]*dy[a.componentType].BYTES_PER_ELEMENT,u=sy._malloc(c);r.GetAttributeDataArrayForAllPoints(o,s,sy[l],c,u),Ay(sy.memory.buffer.slice(u,u+c),a,t),sy._free(u)}r.destroy(),o.destroy(),delete e.extensions[my]}const _y="EXT_meshopt_compression";function yy(e,t){if(!e.extensions||!e.extensions[_y])return;const i=e.extensions[_y],r=new Uint8Array(t.buffers[i.buffer],i.byteOffset||0,i.byteLength||0),n=new Uint8Array(i.count*i.byteStride);ly.decodeGltfBuffer(n,i.count,i.byteStride,r,i.mode,i.filter),e.buffer=t.buffers.length,e.byteOffset=0,t.buffers[e.buffer]=n.buffer,delete e.extensions[_y]}const vy=1179937895,xy=new TextDecoder("utf8");function by(e,t){return new URL(e,t).href}function wy(e,t,i,r){return fetch(by(e.uri,r)).then((e=>e.arrayBuffer())).then((e=>{t.buffers[i]=e}))}function Ty(e,t){const i=e.json.bufferViews[t];return new Uint8Array(e.buffers[i.buffer],i.byteOffset||0,i.byteLength)}function By(e,t,i,r){if(e.uri){const n=by(e.uri,r);return fetch(n).then((e=>e.blob())).then((e=>createImageBitmap(e))).then((e=>{t.images[i]=e}))}if(void 0!==e.bufferView){const r=Ty(t,e.bufferView),n=new Blob([r],{type:e.mimeType});return createImageBitmap(n).then((e=>{t.images[i]=e}))}}function Cy(e,t=0,i){const r={json:null,images:[],buffers:[]};if(new Uint32Array(e,t,1)[0]===vy){const i=new Uint32Array(e,t);let n=2;const o=(i[n++]>>2)-3,s=i[n++]>>2;if(n++,r.json=JSON.parse(xy.decode(i.subarray(n,n+s))),n+=s,n<o){const o=i[n++];n++;const s=t+(n<<2);r.buffers[0]=e.slice(s,s+o)}}else r.json=JSON.parse(xy.decode(new Uint8Array(e,t)));const{buffers:n,images:o,meshes:s,extensionsUsed:a,bufferViews:l}=r.json;let c=Promise.resolve();if(n){const e=[];for(let t=0;t<n.length;t++){const o=n[t];o.uri?e.push(wy(o,r,t,i)):r.buffers[t]||(r.buffers[t]=null)}c=Promise.all(e)}return c.then((()=>{const e=[],t=a&&a.includes(my),n=a&&a.includes(_y);if(t&&e.push(function(){if(!sy)return null!=ny?ny:(ny=function(e){let t,i=null;function r(){t=new Uint8Array(i.buffer)}function n(){throw new Error("Unexpected Draco error.")}const o={a:{a:n,d:function(e,i,r){return t.copyWithin(e,i,i+r)},c:function(e){const n=t.length,o=Math.max(e>>>0,Math.ceil(1.2*n)),s=Math.ceil((o-n)/65536);try{return i.grow(s),r(),!0}catch(e){return!1}},b:n}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(e,o):e.then((e=>e.arrayBuffer())).then((e=>WebAssembly.instantiate(e,o)))).then((e=>{const{Rb:n,Qb:o,P:s,T:a,X:l,Ja:c,La:u,Qa:h,Va:d,Wa:p,eb:f,jb:A,f:m,e:g,yb:_,zb:y,Ab:v,Bb:x,Db:b,Gb:w}=e.instance.exports;i=g;const T=(()=>{let e=0,i=0,r=0,s=0;return a=>{r&&(n(s),n(e),i+=r,r=e=0),e||(i+=128,e=o(i));const l=a.length+7&-8;let c=e;l>=i&&(r=l,c=s=o(l));for(let e=0;e<a.length;e++)t[c+e]=a[e];return c}})();return r(),m(),{memory:g,_free:n,_malloc:o,Mesh:class{constructor(){this.ptr=s()}destroy(){a(this.ptr)}},Decoder:class{constructor(){this.ptr=c()}destroy(){A(this.ptr)}DecodeArrayToMesh(e,t,i){const r=T(e),n=u(this.ptr,r,t,i.ptr);return!!l(n)}GetAttributeByUniqueId(e,t){return{ptr:h(this.ptr,e.ptr,t)}}GetTrianglesUInt16Array(e,t,i){d(this.ptr,e.ptr,t,i)}GetTrianglesUInt32Array(e,t,i){p(this.ptr,e.ptr,t,i)}GetAttributeDataArrayForAllPoints(e,t,i,r,n){f(this.ptr,e.ptr,t.ptr,i,r,n)}},DT_INT8:_(),DT_UINT8:y(),DT_INT16:v(),DT_UINT16:x(),DT_UINT32:b(),DT_FLOAT32:w()}}))}(fetch(uy())),ny.then((e=>{sy=e,ny=void 0})))}()),n&&e.push(function(){if(ly)return;const e=function(e){let t;const i=WebAssembly.instantiateStreaming(e,{}).then((e=>{t=e.instance,t.exports.__wasm_call_ctors()})),r={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},n={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:i,supported:!0,decodeGltfBuffer(e,i,o,s,a,l){!function(e,t,i,r,n,o,s){const a=e.exports.sbrk,l=r+3&-4,c=a(l*n),u=a(o.length),h=new Uint8Array(e.exports.memory.buffer);h.set(o,u);const d=t(c,r,n,u,o.length);if(0===d&&s&&s(c,l,n),i.set(h.subarray(c,c+r*n)),a(c-a(0)),0!==d)throw new Error(`Malformed buffer data: ${d}`)}(t,t.exports[n[a]],e,i,o,s,t.exports[r[l]])}}}(fetch(hy()));return e.ready.then((()=>{ly=e}))}()),o)for(let t=0;t<o.length;t++)e.push(By(o[t],r,t,i));return(e.length?Promise.all(e):Promise.resolve()).then((()=>{if(t&&s)for(const{primitives:e}of s)for(const t of e)gy(t,r);if(n&&s&&l)for(const e of l)yy(e,r);return r}))}))}function Sy(e,t){const i=e.json.bufferViews[t.bufferView],r=dy[t.componentType];return new r(e.buffers[i.buffer],(t.byteOffset||0)+(i.byteOffset||0),t.count*(i.byteStride&&i.byteStride!==fy[t.type]*r.BYTES_PER_ELEMENT?i.byteStride/r.BYTES_PER_ELEMENT:fy[t.type]))}function Ey(e,t,i,r){const n=dy[t.componentType],o=function(e){switch(e){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(n),s=e.json.bufferViews[t.bufferView],a=s.byteStride?s.byteStride/n.BYTES_PER_ELEMENT:fy[t.type],l=i.float32,c=l.length/i.capacity;for(let e=0,i=0;e<t.count*a;e+=a,i+=c)for(let t=0;t<c;t++)l[i+t]=r[e+t]*o;i._trim()}function My(e,t,i){const r=e.indices,n=e.attributes,o={};o.indexArray=new Vs;const s=t.json.accessors[r],a=s.count/3;o.indexArray.reserve(a);const l=Sy(t,s);for(let e=0;e<a;e++)o.indexArray.emplaceBack(l[3*e],l[3*e+1],l[3*e+2]);o.indexArray._trim(),o.vertexArray=new Is;const c=t.json.accessors[n.POSITION];o.vertexArray.reserve(c.count);const u=Sy(t,c);for(let e=0;e<c.count;e++)o.vertexArray.emplaceBack(u[3*e],u[3*e+1],u[3*e+2]);if(o.vertexArray._trim(),o.aabb=new Tc(c.min,c.max),o.centroid=function(e,t){const i=[0,0,0],r=e.length;if(r>0){for(let n=0;n<r;n++){const r=3*e[n];i[0]+=t[r],i[1]+=t[r+1],i[2]+=t[r+2]}i[0]/=r,i[1]/=r,i[2]/=r}return i}(l,u),void 0!==n.COLOR_0){const e=t.json.accessors[n.COLOR_0],i=fy[e.type],r=Sy(t,e);o.colorArray=3===i?new Is:new Rs,o.colorArray.resize(e.count),Ey(t,e,o.colorArray,r)}if(void 0!==n.NORMAL){o.normalArray=new Is;const e=t.json.accessors[n.NORMAL];o.normalArray.resize(e.count);const i=Sy(t,e);Ey(t,e,o.normalArray,i)}if(void 0!==n.TEXCOORD_0&&i.length>0){o.texcoordArray=new Ws;const e=t.json.accessors[n.TEXCOORD_0];o.texcoordArray.resize(e.count);const i=Sy(t,e);Ey(t,e,o.texcoordArray,i)}if(void 0!==n._FEATURE_ID_RGBA4444){const e=t.json.accessors[n._FEATURE_ID_RGBA4444];t.json.extensionsUsed&&t.json.extensionsUsed.includes("EXT_meshopt_compression")&&(o.featureData=Sy(t,e))}void 0!==n._FEATURE_RGBA4444&&(o.featureData=new Uint32Array(Sy(t,t.json.accessors[n._FEATURE_RGBA4444]).buffer));const h=e.material;return o.material=function(e,t){const{emissiveFactor:i=[0,0,0],alphaMode:r="OPAQUE",alphaCutoff:n=.5,normalTexture:o,occlusionTexture:s,emissiveTexture:a,doubleSided:l}=e,{baseColorFactor:c=[1,1,1,1],metallicFactor:u=1,roughnessFactor:h=1,baseColorTexture:d,metallicRoughnessTexture:p}=e.pbrMetallicRoughness||{},f=s?t[s.index]:void 0;if(s&&s.extensions&&s.extensions.KHR_texture_transform&&f){const e=s.extensions.KHR_texture_transform;f.offsetScale=[e.offset[0],e.offset[1],e.scale[0],e.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new Ct(...c),metallicFactor:u,roughnessFactor:h,baseColorTexture:d?t[d.index]:void 0,metallicRoughnessTexture:p?t[p.index]:void 0},doubleSided:l,emissiveFactor:i,alphaMode:r,alphaCutoff:n,normalTexture:o?t[o.index]:void 0,occlusionTexture:f,emissionTexture:a?t[a.index]:void 0,defined:void 0===e.defined}}(void 0!==h?t.json.materials[h]:{defined:!1},i),o}function Iy(e,t,i){const{matrix:r,rotation:n,translation:o,scale:s,mesh:a,extras:l,children:c}=e,u={};if(u.matrix=r||U.mat4.fromRotationTranslationScale([],n||[0,0,0,1],o||[0,0,0],s||[1,1,1]),void 0!==a){u.meshes=i[a];const e=u.anchor=[0,0];for(const t of u.meshes){const{min:i,max:r}=t.aabb;e[0]+=i[0]+r[0],e[1]+=i[1]+r[1]}e[0]=Math.floor(e[0]/u.meshes.length/2),e[1]=Math.floor(e[1]/u.meshes.length/2)}if(l&&(l.id&&(u.id=l.id),l.lights&&(u.lights=function(e){if(!e.length)return[];const t=function(e){const t=atob(e),i=new Uint8Array(t.length);for(let e=0;e<t.length;e++)i[e]=t.codePointAt(e);return i}(e),i=[],r=t.length/24,n=new Uint16Array(t.buffer),o=new Float32Array(t.buffer);for(let e=0;e<r;e++){const t=n[2*e*6]/30,r=n[2*e*6+1]/30,s=n[2*e*6+10]/100,a=o[6*e+1],l=o[6*e+2],c=o[6*e+3],u=o[6*e+4],h=c-a,d=u-l,p=Math.hypot(h,d);i.push({pos:[a+.5*h,l+.5*d,r],normal:[d/p,-h/p,0],width:p,height:t,depth:s,points:[a,l,c,u]})}return i}(l.lights))),c){const e=[];for(const r of c)e.push(Iy(t.json.nodes[r],t,i));u.children=e}return u}function Py(e){if(0===e.vertices.length||0===e.indices.length)return null;const t=new Ch(e.vertices,e.indices,8,256),[i,r]=[t.min.clone(),t.max.clone()];return{vertices:e.vertices,indices:e.indices,grid:t,min:i,max:r}}function Ly(e){if(!e.extras||!e.extras.ground)return null;const t=e.extras.ground;if(!t||!Array.isArray(t)||0===t.length)return null;const i=t[0];if(!i||!Array.isArray(i)||0===i.length)return null;const r=[];for(const e of i){if(!Array.isArray(e)||2!==e.length)continue;const t=e[0],i=e[1];"number"==typeof t&&"number"==typeof i&&r.push(new V(t,i))}if(r.length<3)return null;r.length>1&&r[r.length-1].equals(r[0])&&r.pop();let n=0;for(let e=0;e<r.length;e++){const t=r[e],i=r[(e+1)%r.length],o=r[(e+2)%r.length];n+=(t.x-i.x)*(o.y-i.y)-(o.x-i.x)*(t.y-i.y)}n>0&&r.reverse();const o=yu(r.flatMap((e=>[e.x,e.y])),[]);return 0===o.length?null:{vertices:r,indices:o}}function Fy(e,t){const i=[],r=[];let n=0;const o=[];for(const s of e){n=i.length;const e=s.vertexArray.float32,a=s.indexArray.uint16;for(let r=0;r<s.vertexArray.length;r++)o[0]=e[3*r+0],o[1]=e[3*r+1],o[2]=e[3*r+2],U.vec3.transformMat4(o,o,t),i.push(new V(o[0],o[1]));for(let e=0;e<3*s.indexArray.length;e++)r.push(a[e]+n)}if(r.length%3!=0)return null;for(let e=0;e<r.length;e+=3){const t=i[r[e+0]],n=i[r[e+1]],o=i[r[e+2]];(t.x-n.x)*(o.y-n.y)-(o.x-n.x)*(t.y-n.y)>0&&([r[e+1],r[e+2]]=[r[e+2],r[e+1]])}return{vertices:i,indices:r}}function ky(e){const t=function(e,t){const i=[],r=WebGL2RenderingContext;if(e.json.textures)for(const n of e.json.textures){const o={magFilter:r.LINEAR,minFilter:r.NEAREST,wrapS:r.REPEAT,wrapT:r.REPEAT};void 0!==n.sampler&&Object.assign(o,e.json.samplers[n.sampler]),i.push({image:t[n.source],sampler:o,uploaded:!1})}return i}(e,e.images),i=function(e,t){const i=[];for(const r of e.json.meshes){const n=[];for(const i of r.primitives)n.push(My(i,e,t));i.push(n)}return i}(e,t),{scenes:r,scene:n,nodes:o}=e.json,s=r?r[n||0].nodes:o,a=[];for(const t of s)a.push(Iy(o[t],e,i));return function(e,t,i){const r={},n=new Set;for(let o=0;o<e.length;o++){const e=i[t[o]];if(!e.extras)continue;const s=e.extras["mapbox:footprint:version"],a=e.extras["mapbox:footprint:id"];(s||a)&&n.add(o),"1.0.0"===s&&a&&(r[a]=o)}for(let o=0;o<e.length;o++){if(n.has(o))continue;const s=e[o],a=i[t[o]];if(!a.extras)continue;let l=null;s.id in r&&(l=Fy(e[r[s.id]].meshes,s.matrix)),l||(l=Ly(a)),l&&(s.footprint=Py(l))}if(n.size>0){const t=Array.from(n.values()).sort(((e,t)=>e-t));for(let i=t.length-1;i>=0;i--)e.splice(t[i],1)}}(a,s,e.json.nodes),a}function zy(e){e.heightmap=new Float32Array(4096),e.heightmap.fill(-1);const t=e.vertexArray.float32,i=e.aabb.min[0]-1,r=e.aabb.min[1]-1,n=Im/(e.aabb.max[0]-i+2),o=Im/(e.aabb.max[1]-r+2);for(let s=0;s<t.length;s+=3){const a=t[s+2],l=(t[s+0]-i)*n|0,c=(t[s+1]-r)*o|0;a>e.heightmap[c*Im+l]&&(e.heightmap[c*Im+l]=a)}}function Ry(e,t){const i={};i.indexArray=new Vs,i.indexArray.reserve(4*e.length),i.vertexArray=new Is,i.vertexArray.reserve(10*e.length),i.colorArray=new Rs,i.vertexArray.reserve(10*e.length);let r=0;for(const n of e){const e=Math.min(10,Math.max(4,1.3*n.height))*t,o=[-n.normal[1],n.normal[0],0],s=Math.min(.29,.1*n.width/n.depth),a=n.width-2*n.depth*t*(s+.01),l=U.vec3.scaleAndAdd([],n.pos,o,a/2),c=U.vec3.scaleAndAdd([],n.pos,o,-a/2),u=[l[0],l[1],l[2]+n.height],h=[c[0],c[1],c[2]+n.height],d=U.vec3.scaleAndAdd([],n.normal,o,s);U.vec3.scale(d,d,e);const p=U.vec3.scaleAndAdd([],n.normal,o,-s);U.vec3.scale(p,p,e),U.vec3.add(d,l,d),U.vec3.add(p,c,p),l[2]+=.1,c[2]+=.1,i.vertexArray.emplaceBack(d[0],d[1],d[2]),i.vertexArray.emplaceBack(p[0],p[1],p[2]),i.vertexArray.emplaceBack(l[0],l[1],l[2]),i.vertexArray.emplaceBack(c[0],c[1],c[2]),i.vertexArray.emplaceBack(u[0],u[1],u[2]),i.vertexArray.emplaceBack(h[0],h[1],h[2]),i.vertexArray.emplaceBack(l[0],l[1],l[2]),i.vertexArray.emplaceBack(c[0],c[1],c[2]),i.vertexArray.emplaceBack(d[0],d[1],d[2]),i.vertexArray.emplaceBack(p[0],p[1],p[2]);const f=a/e/2;i.colorArray.emplaceBack(-f-s,-1,f,.8),i.colorArray.emplaceBack(f+s,-1,f,.8),i.colorArray.emplaceBack(-f,0,f,1.3),i.colorArray.emplaceBack(f,0,f,1.3),i.colorArray.emplaceBack(f+s,-.8,f,.7),i.colorArray.emplaceBack(f+s,-.8,f,.7),i.colorArray.emplaceBack(0,0,f,1.3),i.colorArray.emplaceBack(0,0,f,1.3),i.colorArray.emplaceBack(f+s,-1.2,f,.8),i.colorArray.emplaceBack(f+s,-1.2,f,.8),i.indexArray.emplaceBack(6+r,4+r,8+r),i.indexArray.emplaceBack(7+r,9+r,5+r),i.indexArray.emplaceBack(0+r,1+r,2+r),i.indexArray.emplaceBack(1+r,3+r,2+r),r+=10}const n={defined:!0,emissiveFactor:[0,0,0]},o={};return o.baseColorFactor=Ct.white,n.pbrMetallicRoughness=o,i.material=n,i.aabb=new Tc([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),i}class Dy{constructor(e){this._stringToNumber={},this._numberToString=[];for(let t=0;t<e.length;t++){const i=e[t];this._stringToNumber[i]=t,this._numberToString[t]=i}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const Oy=["id","tile","layer","source","sourceLayer","state"];class Uy{constructor(e,t,i,r,n){this.type="Feature",this._vectorTileFeature=e,this._z=t,this._x=i,this._y=r,this.properties=e.properties,this.id=n}clone(){const e=new Uy(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(e.state=Object.assign({},this.state)),this.layer&&(e.layer=Object.assign({},this.layer)),this.source&&(e.source=this.source),this.sourceLayer&&(e.sourceLayer=this.sourceLayer),e}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const t of Oy)void 0!==this[t]&&(e[t]=this[t]);return e}}class Ny{constructor(e,t){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new ao(Xi,16,0),this.featureIndexArray=new da,this.promoteId=t,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(e,t,i,r,n,o=0,s=0){const a=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(i,r,n,o);const l=this.grid;for(let e=0;e<t.length;e++){const i=t[e],r=[1/0,1/0,-1/0,-1/0];for(let e=0;e<i.length;e++){const t=i[e];r[0]=Math.min(r[0],t.x),r[1]=Math.min(r[1],t.y),r[2]=Math.max(r[2],t.x),r[3]=Math.max(r[3],t.y)}0!==s&&(r[0]-=s,r[1]-=s,r[2]+=s,r[3]+=s),r[0]<Xi&&r[1]<Xi&&r[2]>=0&&r[3]>=0&&l.insert(a,r[0],r[1],r[2],r[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new sh.VectorTile(new Fp(this.rawTileData)).layers,this.sourceLayerCoder=new Dy(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,t){const{tilespaceGeometry:i,transform:r,tileTransform:n,pixelPosMatrix:o,availableImages:s}=t;this.loadVTLayers(),this.serializedLayersCache.clear();const a=i.bufferedTilespaceBounds,l=this.grid.query(a.min.x,a.min.y,a.max.x,a.max.y,((e,t,r,n)=>ql(i.bufferedTilespaceGeometry,e,t,r,n)));l.sort(jy);let c=null;r.elevation&&l.length>0&&(c=Om.create(r.elevation,this.tileID));const u={};let h;for(let t=0;t<l.length;t++){const a=l[t];if(a===h)continue;h=a;const d=this.featureIndexArray.get(a);let p=null;this.is3DTile?this.loadMatchingModelFeature(u,d,e,i,r):this.loadMatchingFeature(u,d,e,s,((e,t,s,a=0)=>(p||(p=Fl(e,this.tileID.canonical,n)),t.queryIntersectsFeature(i,e,s,p,this.z,r,o,c,a))))}return u}loadMatchingFeature(e,t,i,r,n){const{featureIndex:o,bucketIndex:s,sourceLayerIndex:a,layoutVertexArrayOffset:l}=t,c=this.bucketLayerIDs[s],u=i.layers,h=Object.keys(u);if(h.length&&!function(e,t){for(let i=0;i<e.length;i++)if(t.indexOf(e[i])>=0)return!0;return!1}(h,c))return;const d=i.sourceCache,p=this.sourceLayerCoder.decode(a),f=this.vtLayers[p].feature(o),A=this.getId(f,p);for(let t=0;t<c.length;t++){const i=c[t];if(!u[i])continue;const{styleLayer:s,targets:a}=u[i];let h={};void 0!==A&&(h=d.getFeatureState(s.sourceLayer,A));const p=!n||n(f,s,h,l);if(!p)continue;const m=new Uy(f,this.z,this.x,this.y,A);m.tile=this.tileID.canonical,m.state=h;let g=this.serializedLayersCache.get(i);g||(g=s.serialize(),g.id=i,this.serializedLayersCache.set(i,g)),m.source=g.source,m.sourceLayer=g["source-layer"],m.layer=re({},g),m.layer.paint=Qy(g.paint,s.paint,f,h,r),m.layer.layout=Qy(g.layout,s.layout,f,h,r);let _=!1;for(const e of a){this.updateFeatureProperties(m,e);const{filter:t}=e;if(t)if(f.properties=m.properties,t.needGeometry){const e=kl(f,!0);if(!t.filter(new Do(this.tileID.overscaledZ),e,this.tileID.canonical))continue}else if(!t.filter(new Do(this.tileID.overscaledZ),f))continue;_=!0,e.targetId&&this.addFeatureVariant(m,e)}_&&this.appendToResult(e,i,o,m,p)}}loadMatchingModelFeature(e,t,i,r,n){const o=this.bucketLayerIDs[0][0],s=i.layers;if(!s[o])return;const{styleLayer:a,targets:l}=s[o];if("model"!==a.type)return;const c=r.tile,u=t.featureIndex,h=c.getBucket(a);if(!(h&&h instanceof Gm))return;const d=function(e,t,i,r){const n=e.getNodesInfo()[t];if(n.hiddenByReplacement||!n.node.meshes)return;let o=Number.MAX_VALUE;const s=n.node,a=i.tile,l=r.calculatePosMatrix(a.tileID.toUnwrapped(),r.worldSize),c=n.evaluatedScale;let u=0;r.elevation&&s.elevation&&(u=s.elevation*r.elevation.exaggeration()),U.mat4.translate(l,l,[(s.anchor?s.anchor[0]:0)*(c[0]-1),(s.anchor?s.anchor[1]:0)*(c[1]-1),u]),U.mat4.scale(l,l,c);const h=i.queryGeometry,d=h.isPointQuery()?h.screenBounds:h.screenGeometry,p=function(e){const t=U.mat4.multiply([],l,e.matrix);U.mat4.multiply(t,r.expandedFarZProjMatrix,t);for(let i=0;i<e.meshes.length;++i){const n=e.meshes[i];if(i===e.lightMeshIndex)continue;const s=fm(d,r,t,n.aabb);null!=s&&(o=Math.min(s,o))}if(e.children)for(const t of e.children)p(t)};if(p(s),o===Number.MAX_VALUE)return;const f=new cl(0,0);return Km(a.tileID.canonical,f,n.node.anchor[0],n.node.anchor[1]),{intersectionZ:o,position:f,feature:n.feature}}(h,u,r,n);if(!d)return;const{z:p,x:f,y:A}=c.tileID.canonical,{feature:m,intersectionZ:g,position:_}=d;let y={};void 0!==m.id&&(y=i.sourceCache.getFeatureState(a.sourceLayer,m.id));const v=new Uy({},p,f,A,m.id);v.tile=this.tileID.canonical,v.state=y,v.properties=m.properties,v.geometry={type:"Point",coordinates:[_.lng,_.lat]};let x=this.serializedLayersCache.get(o);x||(x=a.serialize(),x.id=o,this.serializedLayersCache.set(o,x)),v.source=x.source,v.sourceLayer=x["source-layer"],v.layer=re({},x);let b=!1;for(const e of l){this.updateFeatureProperties(v,e);const{filter:t}=e;if(t)if(m.properties=v.properties,t.needGeometry){if(!t.filter(new Do(this.tileID.overscaledZ),m,this.tileID.canonical))continue}else if(!t.filter(new Do(this.tileID.overscaledZ),m))continue;b=!0,e.targetId&&this.addFeatureVariant(v,e)}b&&this.appendToResult(e,o,u,v,g)}updateFeatureProperties(e,t,i){if(t.properties){const r={};for(const n in t.properties){const o=t.properties[n].evaluate({zoom:this.z},e._vectorTileFeature,e.state,e.tile,i);null!=o&&(r[n]=o)}e.properties=r}}addFeatureVariant(e,t,i){const r={target:t.target,namespace:t.namespace,uniqueFeatureID:t.uniqueFeatureID};t.properties&&(r.properties=e.properties),e.variants=e.variants||{},e.variants[t.targetId]=e.variants[t.targetId]||[],e.variants[t.targetId].push(r)}appendToResult(e,t,i,r,n){let o=e[t];void 0===o&&(o=e[t]=[]),o.push({featureIndex:i,feature:r,intersectionZ:n})}lookupSymbolFeatures(e,t,i,r,n){const o={};this.loadVTLayers();for(const s of e)this.loadMatchingFeature(o,{bucketIndex:t,sourceLayerIndex:i,featureIndex:s,layoutVertexArrayOffset:0},r,n);return o}loadFeature(e){const{featureIndex:t,sourceLayerIndex:i}=e;this.loadVTLayers();const r=this.sourceLayerCoder.decode(i),n=this.vtFeatures[r];if(n[t])return n[t];const o=this.vtLayers[r].feature(t);return n[t]=o,o}hasLayer(e){for(const t of this.bucketLayerIDs)for(const i of t)if(e===i)return!0;return!1}getId(e,t){let i=e.id;if(this.promoteId){const r=Array.isArray(this.promoteId)||"object"!=typeof this.promoteId?this.promoteId:this.promoteId[t];if(null!=r)if(Array.isArray(r)){if(!this.promoteIdExpression){const e=Yn(r);if("success"!==e.result)return void de(`Failed to create expression for promoteId: ${e.value.map((e=>`${e.key}: ${e.message}`)).join(", ")}`);this.promoteIdExpression=e.value}this.promoteIdExpression._evaluator||(this.promoteIdExpression._evaluator=new mi),i=this.promoteIdExpression.evaluate({zoom:0},e)}else i=e.properties[r];"boolean"==typeof i&&(i=Number(i))}return i}}function Qy(e,t,i,r,n){return le(e,((e,o)=>{const s=t instanceof Go?t.get(o):null;return s&&s.evaluate?s.evaluate(i,r,n):s}))}function jy(e,t){return t-e}co(Ny,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const Vy=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Hy{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[t,i]=new Uint8Array(e,0,2);if(219!==t)throw new Error("Data does not appear to be in a KDBush format.");const r=i>>4;if(1!==r)throw new Error(`Got v${r} data when expected v1.`);const n=Vy[15&i];if(!n)throw new Error("Unrecognized array type.");const[o]=new Uint16Array(e,2,1),[s]=new Uint32Array(e,4,1);return new Hy(s,o,n,e)}constructor(e,t=64,i=Float64Array,r){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+t,2),65535),this.ArrayType=i,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const n=Vy.indexOf(this.ArrayType),o=2*e*this.ArrayType.BYTES_PER_ELEMENT,s=e*this.IndexArrayType.BYTES_PER_ELEMENT,a=(8-s%8)%8;if(n<0)throw new Error(`Unexpected typed array class: ${i}.`);r&&r instanceof ArrayBuffer?(this.data=r,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+s+a,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+o+s+a),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+s+a,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+n]),new Uint16Array(this.data,2,1)[0]=t,new Uint32Array(this.data,4,1)[0]=e)}add(e,t){const i=this._pos>>1;return this.ids[i]=i,this.coords[this._pos++]=e,this.coords[this._pos++]=t,i}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return Gy(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,t,i,r){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:n,coords:o,nodeSize:s}=this,a=[0,n.length-1,0],l=[];for(;a.length;){const c=a.pop()||0,u=a.pop()||0,h=a.pop()||0;if(u-h<=s){for(let s=h;s<=u;s++){const a=o[2*s],c=o[2*s+1];a>=e&&a<=i&&c>=t&&c<=r&&l.push(n[s])}continue}const d=h+u>>1,p=o[2*d],f=o[2*d+1];p>=e&&p<=i&&f>=t&&f<=r&&l.push(n[d]),(0===c?e<=p:t<=f)&&(a.push(h),a.push(d-1),a.push(1-c)),(0===c?i>=p:r>=f)&&(a.push(d+1),a.push(u),a.push(1-c))}return l}within(e,t,i){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:r,coords:n,nodeSize:o}=this,s=[0,r.length-1,0],a=[],l=i*i;for(;s.length;){const c=s.pop()||0,u=s.pop()||0,h=s.pop()||0;if(u-h<=o){for(let i=h;i<=u;i++)Ky(n[2*i],n[2*i+1],e,t)<=l&&a.push(r[i]);continue}const d=h+u>>1,p=n[2*d],f=n[2*d+1];Ky(p,f,e,t)<=l&&a.push(r[d]),(0===c?e-i<=p:t-i<=f)&&(s.push(h),s.push(d-1),s.push(1-c)),(0===c?e+i>=p:t+i>=f)&&(s.push(d+1),s.push(u),s.push(1-c))}return a}}function Gy(e,t,i,r,n,o){if(n-r<=i)return;const s=r+n>>1;$y(e,t,s,r,n,o),Gy(e,t,i,r,s-1,1-o),Gy(e,t,i,s+1,n,1-o)}function $y(e,t,i,r,n,o){for(;n>r;){if(n-r>600){const s=n-r+1,a=i-r+1,l=Math.log(s),c=.5*Math.exp(2*l/3),u=.5*Math.sqrt(l*c*(s-c)/s)*(a-s/2<0?-1:1);$y(e,t,i,Math.max(r,Math.floor(i-a*c/s+u)),Math.min(n,Math.floor(i+(s-a)*c/s+u)),o)}const s=t[2*i+o];let a=r,l=n;for(Zy(e,t,r,i),t[2*n+o]>s&&Zy(e,t,r,n);a<l;){for(Zy(e,t,a,l),a++,l--;t[2*a+o]<s;)a++;for(;t[2*l+o]>s;)l--}t[2*r+o]===s?Zy(e,t,r,l):(l++,Zy(e,t,l,n)),l<=i&&(r=l+1),i<=l&&(n=l-1)}}function Zy(e,t,i,r){qy(e,i,r),qy(t,2*i,2*r),qy(t,2*i+1,2*r+1)}function qy(e,t,i){const r=e[t];e[t]=e[i],e[i]=r}function Ky(e,t,i,r){const n=e-i,o=t-r;return n*n+o*o}e.$=gi,e.A=gt,e.B=ei,e.C=ps,e.D=rg,e.E=xt,e.F=2,e.G=df,e.H=uf,e.I=bt,e.J=class extends wm{},e.K=di,e.L=Lt,e.M=Xo,e.N=Qn,e.O=On,e.P=V,e.Q=Nn,e.R=Je,e.S=Xn,e.T=VA,e.U=Yo,e.V=wm,e.W=to,e.X=Yn,e.Y=Lr,e.Z=kr,e._=Pr,e.a=function(e){return Te.API_CDN_URL_REGEX.test(e)},e.a$=kl,e.a0=Bt,e.a1=Jo,e.a2=jn,e.a3=Un,e.a4=function(e){const t=e.value;let i=[];if(!t)return i;const r=di(t);return"string"!==r?(i=i.concat([new wm(e.key,t,`string expected, "${r}" found`)]),i):(Tm(t,!0)||(i=i.concat([new wm(e.key,t,`invalid url "${t}"`)])),i)},e.a5=Wo,e.a6=No,e.a7=Ko,e.a8=$o,e.a9=class{constructor(e){this.specification=e}possiblyEvaluate(e,t){return Ae(e.expression.evaluate(t))}interpolate(e,t,i){return{x:Et(e.x,t.x,i),y:Et(e.y,t.y,i),z:Et(e.z,t.z,i),azimuthal:Et(e.azimuthal,t.azimuthal,i),polar:Et(e.polar,t.polar,i)}}},e.aA=function(e,t){const i={};for(let r=0;r<t.length;r++){const n=t[r];n in e&&(i[n]=e[n])}return i},e.aB=ul,e.aC=Al,e.aD=class{constructor(e){this.entries={},this.scheduler=e}request(e,t,i,r){const n=this.entries[e]=this.entries[e]||{callbacks:[]};if(n.result){const[e,i]=n.result;return this.scheduler?this.scheduler.add((()=>{r(e,i)}),t):r(e,i),()=>{}}return n.callbacks.push(r),n.cancel||(n.cancel=i(((i,r)=>{n.result=[i,r];for(const e of n.callbacks)this.scheduler?this.scheduler.add((()=>{e(i,r)}),t):e(i,r);setTimeout((()=>delete this.entries[e]),3e3)}))),()=>{n.result||(n.callbacks=n.callbacks.filter((e=>e!==r)),n.callbacks.length||(n.cancel(),delete this.entries[e]))}}},e.aE=function(e,t,i){const r=JSON.stringify(e.request);return e.data&&(this.deduped.entries[r]={result:[null,e.data]}),this.deduped.request(r,{type:"parseTile",isSymbolTile:e.isSymbolTile,zoom:e.tileZoom},(t=>{const r=rt(e.request,((e,r,n,o)=>{e?t(e):r&&t(null,{vectorTile:i?void 0:new sh.VectorTile(new Fp(r)),rawData:r,cacheControl:n,expires:o})}));return()=>{r.cancel(),t()}}),t)},e.aF=function(e){Ge++,Ge>Ue&&(e.getActor().send("enforceCacheSizeLimit",Oe),Ge=0)},e.aG=function(e){return e<=1?1:Math.pow(2,Math.floor(Math.log(e)/Math.LN2))},e.aH=cc,e.aI=WA,e.aJ=im,e.aK=qA,e.aL=function(e,t){const i=document.createElement("video");i.muted=!0,i.onloadstart=function(){t(null,i)};for(let t=0;t<e.length;t++){const r=document.createElement("source");nt(e[t])||(i.crossOrigin="Anonymous"),r.src=e[t],i.appendChild(r)}return{cancel:()=>{}}},e.aM=HA,e.aN=function(e){return fetch(e).then((e=>e.arrayBuffer())).then((t=>Cy(t,0,e)))},e.aO=ky,e.aP=class{constructor(e,t,i,r){this.id=e,this.position=null!=t?new cl(t[0],t[1]):new cl(0,0),this.orientation=null!=i?i:[0,0,0],this.nodes=r,this.uploaded=!1,this.aabb=new Tc([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(e,t){if(U.mat4.multiply(e.matrix,t,e.matrix),e.meshes)for(const t of e.meshes){const i=Tc.applyTransformFast(t.aabb,e.matrix);this.aabb.encapsulate(i)}if(e.children)for(const t of e.children)this._applyTransformations(t,e.matrix)}computeBoundsAndApplyParent(){const e=U.mat4.identity([]);for(const t of this.nodes)this._applyTransformations(t,e)}computeModelMatrix(e,t,i,r,n,o,s=!1){Lm(this.matrix,this,e.transform,this.position,t,i,r,n,o,s)}upload(e){if(!this.uploaded){for(const t of this.nodes)zm(t,e);for(const e of this.nodes)Rm(e);this.uploaded=!0}}destroy(){for(const e of this.nodes)Dm(e)}},e.aQ=ae,e.aR=Xf,e.aS=gl,e.aT=_l,e.aU=Ts,e.aV=Vs,e.aW=oe,e.aX=na,e.aY=MA,e.aZ=function(){Ro.isLoading()||Ro.isLoaded()||"deferred"!==ko()||zo()},e.a_=es,e.aa=Do,e.ab=eo,e.ac=Bl,e.ad=U,e.ae=ee,e.af=Go,e.ag=Hc,e.ah=Et,e.ai=Xi,e.aj=Mt,e.ak=Z,e.al=Ct,e.am=class{constructor(e){this.specification=e}possiblyEvaluate(e,t){return function([e,t]){const i=Ae([1,e,t]);return{x:i.x,y:i.y,z:i.z}}(e.expression.evaluate(t))}interpolate(e,t,i){return{x:Et(e.x,t.x,i),y:Et(e.y,t.y,i),z:Et(e.z,t.z,i)}}},e.an=function(e,t,i=0,r=!0){const n=new V(i,i),o=e.sub(n),s=t.add(n),a=[o,new V(s.x,o.y),s,new V(o.x,s.y)];return r&&a.push(o.clone()),a},e.ao=function(e,t){const i=[];for(let r=0;r<e.length;r++){const n=te(r-1,-1,e.length-1),o=te(r+1,-1,e.length-1),s=e[r],a=e[o],l=e[n].sub(s).unit(),c=a.sub(s).unit(),u=c.angleWithSep(l.x,l.y),h=l.add(c).unit().mult(-1*t/Math.sin(u/2));i.push(s.add(h))}return i},e.ap=Yf,e.aq=ql,e.ar=function(e,t,i=0){return U.vec3.fromValues(((t.x-i)*e.scale-e.x)*Xi,(t.y*e.scale-e.y)*Xi,yl(t.z,t.y))},e.as=gc,e.at=Wd,e.au=function(e){let t=1/0,i=1/0,r=-1/0,n=-1/0;for(const o of e)t=Math.min(t,o.x),i=Math.min(i,o.y),r=Math.max(r,o.x),n=Math.max(n,o.y);return{min:new V(t,i),max:new V(r,n)}},e.av=fl,e.aw=Zl,e.ax=Sl,e.ay=J,e.az=Xa,e.b=function(e){return Te.API_FONTS_REGEX.test(e)},e.b$=am,e.b0=Uy,e.b1=ge,e.b2=$d,e.b3=xh,e.b4=Fl,e.b5=bs,e.b6=Ys,e.b7=Ac,e.b8=_a,e.b9=yu,e.bA=Yh,e.bB=Nf,e.bC=kf,e.bD=Wp,e.bE=Hy,e.bF=te,e.bG=ye,e.bH=ml,e.bI=function(e,t,i){e[4*t+0]=i[0],e[4*t+1]=i[1],e[4*t+2]=i[2],e[4*t+3]=i[3]},e.bJ=ka,e.bK=Ma,e.bL=Ia,e.bM=Ea,e.bN=Sa,e.bO=cl,e.bP=yA,e.bQ=lc,e.bR=wc,e.bS=sm,e.bT=ac,e.bU=Fc,e.bV=function(e,t,i,r,n,o,s,a,l){if("globe"===l.name)return Fc(e,t,new ac(i,r,n),!1);const c=Xf({z:i,x:r,y:n},l);return new Tc([(o+c.x/c.scale)*t,t*(c.y/c.scale),s],[(o+c.x2/c.scale)*t,t*(c.y2/c.scale),a])},e.bW=function(e,t,i){let r=0;for(let i=0;i<2;++i){const n=0;e[i]>n&&(r+=(e[i]-n)*(e[i]-n)),t[i]<n&&(r+=(n-t[i])*(n-t[i]))}return r},e.bX=vl,e.bY=Ja,e.bZ=function(e){const t=U.mat4.identity(new Float64Array(16));U.mat4.multiply(t,e.pixelMatrix,e.globeMatrix);const i=[0,rl,0],r=[0,nl,0];return U.vec3.transformMat4(i,i,t),U.vec3.transformMat4(r,r,t),[i[0]>0&&i[0]<=e.width&&i[1]>0&&i[1]<=e.height&&!$c(e,new cl(e.center.lat,90)),r[0]>0&&r[0]<=e.width&&r[1]>0&&r[1]<=e.height&&!$c(e,new cl(e.center.lat,-90))]},e.b_=function(e,t){const{scale:i}=e.tileTransform,r=i*Xi/(e.tileSize*Math.pow(2,t.zoom-e.tileID.overscaledZ+e.tileID.canonical.z));return U.mat2.scale(new Float32Array(4),t.inverseAdjustmentMatrix,[r,r])},e.ba=NA,e.bb=function(e,t){const i=Hc(t.zoom);if(0===i)return Ic(e);const r=kc(e),n=zc(r),o=fl(r.getWest())*t.worldSize,s=fl(r.getEast())*t.worldSize,a=Al(r.getNorth())*t.worldSize,l=Al(r.getSouth())*t.worldSize,c=[o,a,0],u=[s,a,0],h=[o,l,0],d=[s,l,0],p=U.mat4.invert([],t.globeMatrix);return U.vec3.transformMat4(c,c,p),U.vec3.transformMat4(u,u,p),U.vec3.transformMat4(h,h,p),U.vec3.transformMat4(d,d,p),n[0]=Pc(n[0],h,i),n[1]=Pc(n[1],d,i),n[2]=Pc(n[2],u,i),n[3]=Pc(n[3],c,i),Tc.fromPoints(n)},e.bc=Uc,e.bd=Rc,e.be=Pc,e.bf=ws,e.bg=fc,e.bh=ty,e.bi=Fp,e.bj=rt,e.bk=function(e,t){const i=[];for(const r in e)r in t||i.push(r);return i},e.bl=ie,e.bm=["type","source","source-layer","minzoom","maxzoom","filter","layout"],e.bn=H,e.bo=function(e,t){const{x:i,y:r}=e.point,n=Vc(i,r,e.worldSize/e._pixelsPerMercatorPixel,0,0);return U.mat4.multiply(n,n,Nc(Ic(t)))},e.bp=xp,e.bq=Up,e.br=vp,e.bs=function(e,t,i,r,n){const o=5*t+2;e.float32[o+0]=i,e.float32[o+1]=r,e.float32[o+2]=n},e.bt=BA,e.bu=cf,e.bv=Ol,e.bw=mp,e.bx=jh,e.by=bm,e.bz=Xh,e.c=Ce,e.c$=ep,e.c0=om,e.c1=function(e){const t=om(e,!0);return U.mat2.invert([],[t[0],t[1],t[4],t[5]])},e.c2=_c,e.c3=function(e){const{x:t,y:i}=e.point,{lng:r,lat:n}=e._center;return Vc(t,i,e.worldSize,r,n)},e.c4=q,e.c5=uc,e.c6=Ya,e.c7=function(e){const t=Math.round((e+45+360)%360/90)%4;return K[t]},e.c8=45,e.c9=It,e.cA=La,e.cB=class extends Ca{constructor(e){super(e),this.current=za}set(e,t,i){if(this.fetchUniformLocation(e,t))for(let e=0;e<9;e++)if(i[e]!==this.current[e]){this.current=i,this.gl.uniformMatrix3fv(this.location,!1,i);break}}},e.cC=W,e.cD=function(e,t,i){const r=Hc(i.zoom),n=e.style.map._antialias,o=e.terrain&&e.terrain.exaggeration()>0;return 0===r&&!n&&!o},e.cE=function(e){const t=e.pixelsPerMeter,i=t/ml(1,e.center.lat),r=U.mat4.identity(new Float64Array(16));return U.mat4.translate(r,r,[e.point.x,e.point.y,0]),U.mat4.scale(r,r,[i,i,t]),Float32Array.from(r)},e.cF=kc,e.cG=function(e){const t=vl-5;e=J(e,-t,t)/t*90;const i=Math.pow(Math.abs(Math.sin(Z(e))),3);return Math.round(i*(il.length-1))},e.cH=function(e,t,i,r){const n=t.getNorth(),o=t.getSouth(),s=t.getWest(),a=t.getEast(),l=1<<e.z,c=a-s,u=n-o,h=c/tl,d=-u/il[i],p=[0,h,0,d,0,0,n,s,0];if(e.z>0){const e=180/r;U.mat3.multiply(p,p,[e/c+1,0,0,0,e/u+1,0,-.5*e/h,.5*e/d,1])}return p[2]=l,p[5]=e.x,p[8]=e.y,p},e.cI=Ic,e.cJ=function(e,t,i){const r=U.mat4.identity(new Float64Array(16)),n=(t/(1<<e)-.5)*Math.PI*2;return U.mat4.rotateY(r,i.globeMatrix,n),Float32Array.from(r)},e.cK=class{isDataAvailableAtPoint(e){const t=this._source();if(this.isUsingMockSource()||!t||e.y<0||e.y>1)return!1;const i=t.getSource().maxzoom,r=1<<i,n=Math.floor(e.x),o=Math.floor((e.x-n)*r),s=Math.floor(e.y*r),a=this.findDEMTileFor(new cc(i,n,i,o,s));return!(!a||!a.dem)}getAtPointOrZero(e,t=0){return this.getAtPoint(e,t)||0}getAtPoint(e,t,i=!0){if(this.isUsingMockSource())return null;null==t&&(t=null);const r=this._source();if(!r)return t;if(e.y<0||e.y>1)return t;const n=r.getSource().maxzoom,o=1<<n,s=Math.floor(e.x),a=e.x-s,l=new cc(n,s,n,Math.floor(a*o),Math.floor(e.y*o)),c=this.findDEMTileFor(l);if(!c||!c.dem)return t;const u=c.dem,h=1<<c.tileID.canonical.z,d=(a*h-c.tileID.canonical.x)*u.dim,p=(e.y*h-c.tileID.canonical.y)*u.dim,f=Math.floor(d),A=Math.floor(p);return(i?this.exaggeration():1)*Et(Et(u.get(f,A),u.get(f,A+1),p-A),Et(u.get(f+1,A),u.get(f+1,A+1),p-A),d-f)}getAtTileOffset(e,t,i){const r=1<<e.canonical.z;return this.getAtPointOrZero(new Bl(e.wrap+(e.canonical.x+t/Xi)/r,(e.canonical.y+i/Xi)/r))}getAtTileOffsetFunc(e,t,i,r){return n=>{const o=this.getAtTileOffset(e,n.x,n.y),s=r.upVector(e.canonical,n.x,n.y),a=r.upVectorScale(e.canonical,t,i).metersToTile;return U.vec3.scale(s,s,o*a),s}}getForTilePoints(e,t,i,r){if(this.isUsingMockSource())return!1;const n=Om.create(this,e,r);return!!n&&(t.forEach((e=>{e[2]=this.exaggeration()*n.getElevationAt(e[0],e[1],i)})),!0)}getMinMaxForTile(e){if(this.isUsingMockSource())return null;const t=this.findDEMTileFor(e);if(!t||!t.dem)return null;const i=t.dem.tree,r=t.tileID,n=1<<e.canonical.z-r.canonical.z;let o=e.canonical.x/n-r.canonical.x,s=e.canonical.y/n-r.canonical.y,a=0;for(let t=0;t<e.canonical.z-r.canonical.z&&!i.leaves[a];t++){o*=2,s*=2;const e=2*Math.floor(s)+Math.floor(o);a=i.childOffsets[a]+e,o%=1,s%=1}return{min:this.exaggeration()*i.minimums[a],max:this.exaggeration()*i.maximums[a]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(e,t,i){throw new Error("Pure virtual method called.")}pointCoordinate(e){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(e){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const e=this.visibleDemTiles;if(0===e.length)return null;let t=!1,i=Number.MAX_VALUE,r=Number.MIN_VALUE;for(const n of e){const e=this.getMinMaxForTile(n.tileID);e&&(i=Math.min(i,e.min),r=Math.max(r,e.max),t=!0)}return t?{min:i,max:r}:null}},e.cL=pu,e.cM=Bc,e.cN=function(e,t){return[Math.pow(e[0],2.2)*t,Math.pow(e[1],2.2)*t,Math.pow(e[2],2.2)*t]},e.cO=jc,e.cP=we,e.cQ=be,e.cR=256,e.cS=function(e,t){const i=[0,0,0],r=Uc(Ic(t.canonical));return U.vec3.transformMat4(i,i,r),U.vec3.transformMat4(i,i,e),i},e.cT=e=>({u_camera_to_center_distance:new Ea(e),u_extrude_scale:new Da(e),u_device_pixel_ratio:new Ea(e),u_matrix:new ka(e),u_inv_rot_matrix:new ka(e),u_merc_center:new Ma(e),u_tile_id:new Ia(e),u_zoom_transition:new Ea(e),u_up_dir:new Ia(e),u_emissive_strength:new Ea(e)}),e.cU=e=>({u_matrix:new ka(e),u_pixels_to_tile_units:new Da(e),u_device_pixel_ratio:new Ea(e),u_width_scale:new Ea(e),u_floor_width_scale:new Ea(e),u_units_to_pixels:new Ma(e),u_dash_image:new Sa(e),u_gradient_image:new Sa(e),u_image_height:new Ea(e),u_texsize:new Ma(e),u_tile_units_to_pixels:new Ea(e),u_alpha_discard_threshold:new Ea(e),u_trim_offset:new Ma(e),u_trim_fade_range:new Ma(e),u_trim_color:new Pa(e),u_emissive_strength:new Ea(e),u_zbias_factor:new Ea(e),u_tile_to_meter:new Ea(e)}),e.cV=e=>({u_matrix:new ka(e),u_texsize:new Ma(e),u_pixels_to_tile_units:new Da(e),u_device_pixel_ratio:new Ea(e),u_width_scale:new Ea(e),u_floor_width_scale:new Ea(e),u_image:new Sa(e),u_units_to_pixels:new Ma(e),u_tile_units_to_pixels:new Ea(e),u_alpha_discard_threshold:new Ea(e),u_trim_offset:new Ma(e),u_trim_fade_range:new Ma(e),u_trim_color:new Pa(e),u_emissive_strength:new Ea(e),u_zbias_factor:new Ea(e),u_tile_to_meter:new Ea(e)}),e.cW=Qs,e.cX=Ap,e.cY=bp,e.cZ=Xc,e.c_=(e,t,i,r,n,o)=>{const s=e.transform,a="globe"===s.projection.name;let l;if("map"===o.paint.get("circle-pitch-alignment"))if(a){const e=jc(s.zoom,t.canonical)*s._pixelsPerMercatorPixel;l=Float32Array.from([e,0,0,e])}else l=s.calculatePixelsToTileUnitsMatrix(i);else l=new Float32Array([s.pixelsToGLUnits[0],0,0,s.pixelsToGLUnits[1]]);const c={u_camera_to_center_distance:e.transform.getCameraToCenterDistance(s.projection),u_matrix:e.translatePosMatrix(t.projMatrix,i,o.paint.get("circle-translate"),o.paint.get("circle-translate-anchor")),u_device_pixel_ratio:ke.devicePixelRatio,u_extrude_scale:l,u_inv_rot_matrix:Wc,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:o.paint.get("circle-emissive-strength")};if(a){c.u_inv_rot_matrix=r,c.u_merc_center=n,c.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],c.u_zoom_transition=Hc(s.zoom);const e=n[0]*Xi,i=n[1]*Xi;c.u_up_dir=s.projection.upVector(new ac(0,0,0),e,i)}return c},e.ca=pl,e.cb=Pa,e.cc=function(e,t,i){const r=Math.sqrt(e*e+t*t+i*i),n=r>0?Math.acos(i/r)*$:0;let o=0!==e||0!==t?Math.atan2(-t,-e)*$+90:0;return o<0&&(o+=360),[r,o,n]},e.cd=Tl,e.ce=Tc,e.cf=Ae,e.cg=function(e){return[Math.pow(e[0],1/2.2),Math.pow(e[1],1/2.2),Math.pow(e[2],1/2.2)]},e.ch=function(e,t){return e.readFields(fg,{icons:[]},t)},e.ci=function(e){return e({pluginStatus:Mo,pluginURL:Io}),Fo.on("pluginStateChange",e),e},e.cj=sg,e.ck=vf,e.cl=yf,e.cm=tt,e.cn=Po,e.co=Re,e.cp=mt,e.cq=ue,e.cr=function(e){const t=e.indexOf(ds);return t>=0?e.slice(0,t):e},e.cs=function(e){return e.indexOf(ds)>=0},e.ct=function(e){const t=e.indexOf(ds);return t>=0?e.slice(t+1):""},e.cu=function(e){const t=[],i=e.id;return void 0===i&&t.push({message:`layers.${i}: missing required property "id"`}),void 0===e.render&&t.push({message:`layers.${i}: missing required method "render"`}),e.renderingMode&&"2d"!==e.renderingMode&&"3d"!==e.renderingMode&&t.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),t},e.cv=function(e,t,i,r){return"custom"===e.type?new rm(e,t):new Wm[e.type](e,t,i,r)},e.cw=ce,e.cx=class extends Uy{constructor(e,t){super(e._vectorTileFeature,e._z,e._x,e._y,e.id),e.state&&(this.state=Object.assign({},e.state)),this.target=t.target,this.namespace=t.namespace,t.properties&&(this.properties=t.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=e.source,this.sourceLayer=e.sourceLayer,this.layer=e.layer)}toJSON(){const e=super.toJSON();return e.target=this.target,e.namespace=this.namespace,e}},e.cy=Fo,e.cz=it,e.d=function(e){return Te.API_TILEJSON_REGEX.test(e)},e.d$=Dy,e.d0=ti,e.d1=(e,t,i,r,n,o,s,a)=>{const l=e.transform,c=l.pitch<15?Xd(.07,.7,J((14-l.zoom)/5,0,1)):.07,u="none"===i.paint.get("line-trim-color-use-theme").constantOr("default");return{u_matrix:Jd(e,t,i,r),u_texsize:t.imageAtlasTexture?t.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:l.calculatePixelsToTileUnitsMatrix(t),u_device_pixel_ratio:n,u_width_scale:o,u_floor_width_scale:s,u_image:0,u_tile_units_to_pixels:Yd(t,l),u_units_to_pixels:[1/l.pixelsToGLUnits[0],1/l.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:a,u_trim_fade_range:i.paint.get("line-trim-fade-range"),u_trim_color:i.paint.get("line-trim-color").toRenderColor(u?null:i.lut).toArray01(),u_emissive_strength:i.paint.get("line-emissive-strength"),u_zbias_factor:c,u_tile_to_meter:Tl(t.tileID.canonical,0)}},e.d2=(e,t,i,r,n,o,s,a,l)=>{const c=e.transform,u=c.calculatePixelsToTileUnitsMatrix(t),h="none"===i.paint.get("line-trim-color-use-theme").constantOr("default"),d=c.pitch<15?Xd(.07,.7,J((14-c.zoom)/5,0,1)):.07;return{u_matrix:Jd(e,t,i,r),u_pixels_to_tile_units:u,u_device_pixel_ratio:o,u_width_scale:s,u_floor_width_scale:a,u_units_to_pixels:[1/c.pixelsToGLUnits[0],1/c.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:n,u_texsize:tp(i)&&t.lineAtlasTexture?t.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:Yd(t,e.transform),u_alpha_discard_threshold:0,u_trim_offset:l,u_trim_fade_range:i.paint.get("line-trim-fade-range"),u_trim_color:i.paint.get("line-trim-color").toRenderColor(h?null:i.lut).toArray01(),u_emissive_strength:i.paint.get("line-emissive-strength"),u_zbias_factor:d,u_tile_to_meter:Tl(t.tileID.canonical,0)}},e.d3=se,e.d4=fu,e.d5=yl,e.d6=Sd,e.d7=hc,e.d8=yd,e.d9=ad,e.dA=Qh,e.dB=X,e.dC=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},e.dD=Y,e.dE=wl,e.dF=sl,e.dG=function([e,t,i]){const r=Math.hypot(e,t,i),n=Math.atan2(e,i),o=.5*Math.PI-Math.acos(-t/r);return new cl(q(n),q(o))},e.dH=cm,e.dI=function(e){const t=e.navigator?e.navigator.userAgent:null;return!!function(e){if(null==_e){const t=e.navigator?e.navigator.userAgent:null;_e=!!e.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return _e}(e)&&t&&(t.match("Version/15.4")||t.match("Version/15.5")||t.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},e.dJ=function(e,t){Oe=e,Ue=t},e.dK=$c,e.dL=Gc,e.dM=function(e){const t=[0,0,0],i=U.mat4.identity(new Float64Array(16));return U.mat4.multiply(i,e.pixelMatrix,e.globeMatrix),U.vec3.transformMat4(t,t,i),new V(t[0],t[1])},e.dN=function(e,t,i=!1){if(Mo===Bo||Mo===Co||Mo===So)throw new Error("setRTLTextPlugin cannot be called multiple times.");Io=ke.resolveURL(e),Mo=Bo,Eo=t,Lo(),i||zo()},e.dO=ko,e.dP=function(){sg().acquire(tg)},e.dQ=function(){const e=ng;e&&(e.isPreloaded()&&1===e.numActive()?(e.release(tg),ng=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},e.dR=ig,e.dS=function(e){const t=Ve();if(!t)return;const i=t.delete(De);e&&i.catch(e).then((()=>e()))},e.dT=eg,e.dU=uy,e.dV=function(e){oy=ke.resolveURL(e),cy||(cy=new rg(sg(),new xt)),cy.broadcast("setDracoUrl",oy)},e.dW=hy,e.dX=function(e){ay=ke.resolveURL(e),cy||(cy=new rg(sg(),new xt)),cy.broadcast("setMeshoptUrl",ay)},e.dY=co,e.dZ=hu,e.d_=_f,e.da=450,e.db=7,e.dc=KA,e.dd=vs,e.de=ta,e.df=256,e.dg=Nc,e.dh=Is,e.di=$s,e.dj=Zs,e.dk=function(e,t,i,r,n){return J((e-t)/(i-t)*(n-r)+r,r,n)},e.dl=En,e.dm=bl,e.dn=class{constructor(e,t,i,r){this.context=e,this.format=r,this.size=i,this.texture=e.gl.createTexture();const[n,o,s]=this.size,{gl:a}=e;a.bindTexture(a.TEXTURE_3D,this.texture),e.pixelStoreUnpackFlipY.set(!1),e.pixelStoreUnpack.set(1),e.pixelStoreUnpackPremultiplyAlpha.set(!1),a.texImage3D(a.TEXTURE_3D,0,this.format,n,o,s,0,QA(this.format),jA(this.format),t.data)}bind(e,t){const{context:i}=this,{gl:r}=i;r.bindTexture(r.TEXTURE_3D,this.texture),e!==this.minFilter&&(r.texParameteri(r.TEXTURE_3D,r.TEXTURE_MAG_FILTER,e),r.texParameteri(r.TEXTURE_3D,r.TEXTURE_MIN_FILTER,e),this.minFilter=e),t!==this.wrapS&&(r.texParameteri(r.TEXTURE_3D,r.TEXTURE_WRAP_S,t),r.texParameteri(r.TEXTURE_3D,r.TEXTURE_WRAP_T,t),this.wrapS=t)}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}},e.dp=pm,e.dq=[1,1,1],e.dr=Om,e.ds=Pm,e.dt=Os,e.du=Ws,e.dv=al,e.dw=Ks,e.dx=qs,e.dy=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new V(1/0,1/0),max:new V(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(e,t=!1){const i=Zh(new V(0,0),new V(Xi,Xi),e),r=[];if(t&&!Gh(i,this._globalClipBounds))return r;for(const t of this._activeRegions){if(t.hiddenByOverlap)continue;if(!Gh(i,t))continue;const n=qh(t.min,t.max,e);r.push({min:n.min,max:n.max,sourceId:this._sourceIds[t.priority],footprint:t.footprint,footprintTileId:t.tileId,order:t.order,clipMask:t.clipMask,clipScope:t.clipScope})}return r}setSources(e){this._setSources(e.map((e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{const t=[];for(const i of e.cache.getVisibleCoordinates()){const r=e.cache.getTile(i).buckets[e.layer];r&&r.updateFootprints(i.toUnwrapped(),t)}return t},getOrder:()=>e.order,getClipMask:()=>e.clipMask,getClipScope:()=>e.clipScope}))))}_addSource(e){const t=e.getFootprints();if(0===t.length)return;const i=e.getOrder(),r=e.getClipMask(),n=e.getClipScope();for(const e of t){if(!e.footprint)continue;const t=Zh(e.footprint.min,e.footprint.max,e.id);this._activeRegions.push({min:t.min,max:t.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:e.id,footprint:e.footprint,order:i,clipMask:r,clipScope:n})}this._sourceIds.push(e.getSourceId())}_computeReplacement(){this._activeRegions.sort(((e,t)=>e.priority-t.priority||Vh(e.min,t.min)||Vh(e.max,t.max)||e.order-t.order||e.clipMask-t.clipMask||function(e,t){const i=(e,t)=>e+t;return e.length-t.length||e.reduce(i,"").localeCompare(t.reduce(i,""))}(e.clipScope,t.clipScope)));let e=this._activeRegions.length!==this._prevRegions.length;if(!e){let t=0;for(;!e&&t!==this._activeRegions.length;){const i=this._activeRegions[t],r=this._prevRegions[t];e=i.priority!==r.priority||!Hh(i,r)||i.order!==r.order||i.clipMask!==r.clipMask||!H(i.clipScope,r.clipScope),++t}}if(e){++this._updateTime;for(const e of this._activeRegions)e.order!==Qh&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,e.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,e.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,e.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,e.max.y));const e=e=>{const t=this._activeRegions;if(e>=t.length)return e;const i=t[e].priority;for(;e<t.length&&t[e].priority===i;)++e;return e};if(this._sourceIds.length>1){let t=0,i=e(t);for(;t!==i;){let r=t;const n=t;for(;r!==i;){const e=this._activeRegions[r];e.hiddenByOverlap=!1;for(let t=0;t<n;t++){const i=this._activeRegions[t];if(!i.hiddenByOverlap&&e.order===Qh&&Gh(e,i)&&(e.hiddenByOverlap=Wh(e.footprint,e.tileId,i.footprint,i.tileId),e.hiddenByOverlap))break}++r}t=i,i=e(t)}}}}_setSources(e){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let t=e.length-1;t>=0;t--)this._addSource(e[t]);this._computeReplacement()}},e.dz=class{constructor(e){this._createGrid(e),this._createPoles(e)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const e of this._poleSegments)e.destroy();for(const e of this._gridSegments)e.withSkirts.destroy(),e.withoutSkirts.destroy()}_fillGridMeshWithLods(e,t){const i=new bs,r=new Vs,n=[],o=e+1+2,s=t[0]+1,a=t[0]+1+(1+t.length),l=(e,t,i)=>{let r=e===o-1?e-2:0===e?e:e-1;return r+=i?24575:0,[r,t]};for(let e=0;e<o;++e)i.emplaceBack(...l(e,0,!0));for(let e=0;e<s;++e)for(let t=0;t<o;++t)i.emplaceBack(...l(t,e,(0===t||t===o-1)&&!0));for(let e=0;e<t.length;++e){const r=t[e];for(let e=0;e<o;++e)i.emplaceBack(...l(e,r,!0))}for(let e=0;e<t.length;++e){const s=r.length,l=t[e]+1+2,c=new Vs;for(let i=0;i<l-1;i++){const n=i===l-2,s=n?o*(a-t.length+e-i):o;for(let e=0;e<o-1;e++){const t=i*o+e;0===i||n||0===e||e===o-2?(c.emplaceBack(t+1,t,t+s),c.emplaceBack(t+s,t+s+1,t+1)):(r.emplaceBack(t+1,t,t+s),r.emplaceBack(t+s,t+s+1,t+1))}}const u=_a.simpleSegment(0,s,i.length,r.length-s);for(let e=0;e<c.uint16.length;e+=3)r.emplaceBack(c.uint16[e],c.uint16[e+1],c.uint16[e+2]);const h=_a.simpleSegment(0,s,i.length,r.length-s);n.push({withoutSkirts:u,withSkirts:h})}return{vertices:i,indices:r,segments:n}}_createGrid(e){const t=this._fillGridMeshWithLods(tl,il);this._gridSegments=t.segments,this._gridBuffer=e.createVertexBuffer(t.vertices,Ac.members),this._gridIndexBuffer=e.createIndexBuffer(t.indices,!0)}_createPoles(e){const t=new Vs;for(let e=0;e<=tl;e++)t.emplaceBack(0,e+1,e+2);this._poleIndexBuffer=e.createIndexBuffer(t,!0);const i=new $s,r=new $s,n=new $s,o=new $s;this._poleSegments=[];for(let e=0,t=0;e<Ya;e++){const s=360/(1<<e);i.emplaceBack(0,-Xa,0,.5,0),r.emplaceBack(0,-Xa,0,.5,1),n.emplaceBack(0,-Xa,0,.5,.5),o.emplaceBack(0,-Xa,0,.5,.5);for(let e=0;e<=tl;e++){let t=e/tl,a=0;const l=Et(0,s,t),[c,u,h]=ol(qc,Kc,l,Xa);i.emplaceBack(c,u,h,t,a),r.emplaceBack(c,u,h,t,1-a);const d=Z(l);t=.5+.5*Math.sin(d),a=.5+.5*Math.cos(d),n.emplaceBack(c,u,h,t,a),o.emplaceBack(c,u,h,t,1-a)}this._poleSegments.push(_a.simpleSegment(t,0,66,64)),t+=66}this._poleNorthVertexBuffer=e.createVertexBuffer(i,pc,!1),this._poleSouthVertexBuffer=e.createVertexBuffer(r,pc,!1),this._texturedPoleNorthVertexBuffer=e.createVertexBuffer(n,pc,!1),this._texturedPoleSouthVertexBuffer=e.createVertexBuffer(o,pc,!1)}getGridBuffers(e,t){return[this._gridBuffer,this._gridIndexBuffer,t?this._gridSegments[e].withSkirts:this._gridSegments[e].withoutSkirts]}getPoleBuffers(e,t){return[t?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,t?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[e]]}},e.e=Te,e.e0=Ny,e.e1=jd,e.e2=ah,e.e3="hd_road_elevation",e.e4=class{static parseFrom(e,t){const i=ph.parse(e);if(!i)return[];let{vertices:r,features:n}=i;const o=1/Tl(t);n.sort(((e,t)=>e.id-t.id)),r.sort(((e,t)=>e.id-t.id||e.idx-t.idx)),r=r.filter(((e,t,i)=>t===i.findIndex((t=>t.id===e.id&&t.idx===e.idx))));const s=new Array;let a=0;const l=r.length;for(const e of n){if(e.constantHeight){s.push(new fh(e.id,e.bounds,e.constantHeight));continue}for(;a!==l&&r[a].id<e.id;)a++;if(a===l||r[a].id!==e.id)continue;const t=new Array,i=new Array,n=a;for(;a!==l&&r[a].id===e.id;){const e=r[a];if(t.push({position:e.position,height:e.height,extent:e.extent}),a!==n&&r[a-1].idx===e.idx-1){const e=a-n;i.push({a:e-1,b:e})}a++}s.push(new fh(e.id,e.bounds,void 0,t,i,o))}return s}},e.e5=le,e.e6=gh,e.e7=pf,e.e8=hf,e.e9=function(e,t,i,r,n,o,s,a=1,l){e.createArrays(),e.tilePixelRatio=Xi/(512*e.overscaling),e.compareText={},e.iconsNeedLinear=!1;const c=e.layers[0].layout,u=e.layers[0]._unevaluatedLayout._values,h={};h.scaleFactor=a,h.textSizeScaleRange=c.get("text-size-scale-range"),h.iconSizeScaleRange=c.get("icon-size-scale-range");const[d,p]=h.textSizeScaleRange,[f,A]=h.iconSizeScaleRange;h.textScaleFactor=J(h.scaleFactor,d,p),h.iconScaleFactor=J(h.scaleFactor,f,A);const m=u["text-size"],g=u["icon-size"];if("composite"===e.textSizeData.kind){const{minZoom:t,maxZoom:i}=e.textSizeData;h.compositeTextSizes=[m.possiblyEvaluate(new Do(t),o),m.possiblyEvaluate(new Do(i),o)]}if("composite"===e.iconSizeData.kind){const{minZoom:t,maxZoom:i}=e.iconSizeData;h.compositeIconSizes=[g.possiblyEvaluate(new Do(t),o),g.possiblyEvaluate(new Do(i),o)]}h.layoutTextSize=m.possiblyEvaluate(new Do(s+1),o),h.layoutIconSize=g.possiblyEvaluate(new Do(s+1),o),h.textMaxSize=m.possiblyEvaluate(new Do(18),o);const _=c.get("symbol-placement"),y="map"===c.get("text-rotation-alignment")&&"point"!==_,v=c.get("text-size");let x=!1;const b=[];for(const s of e.features){const a=c.get("text-font").evaluate(s,{},o).join(","),d=v.evaluate(s,{},o)*h.textScaleFactor,p=h.layoutTextSize.evaluate(s,{},o)*h.textScaleFactor,f=h.layoutIconSize.evaluate(s,{},o)*h.iconScaleFactor,A={horizontal:{},vertical:void 0},m=s.text;let g,w=[0,0];if(m){const r=m.toString(),u=c.get("text-letter-spacing").evaluate(s,{},o)*mp,h=c.get("text-line-height").evaluate(s,{},o)*mp,f=go(r)?u:0,g=c.get("text-anchor").evaluate(s,{},o),v=c.get("text-variable-anchor");if(!v){const e=c.get("text-radial-offset").evaluate(s,{},o);w=e?kf(g,[e*mp,Lf]):c.get("text-offset").evaluate(s,{},o).map((e=>e*mp))}let x=y?"center":c.get("text-justify").evaluate(s,{},o);const b="point"===_,T=b?c.get("text-max-width").evaluate(s,{},o)*mp:1/0,B=o=>{e.allowVerticalPlacement&&mo(r)&&(A.vertical=jp(m,t,i,n,a,T,h,g,o,f,w,Up.vertical,!0,p,d,l))};if(!y&&v){const e="auto"===x?v.map((e=>Nf(e))):[x];let r=!1;for(let o=0;o<e.length;o++){const s=e[o];if(!A.horizontal[s])if(r)A.horizontal[s]=A.horizontal[0];else{const e=jp(m,t,i,n,a,T,h,"center",s,f,w,Up.horizontal,!1,p,d,l);e&&(A.horizontal[s]=e,r=1===e.positionedLines.length)}}B("left")}else{if("auto"===x&&(x=Nf(g)),b||c.get("text-writing-mode").indexOf("horizontal")>=0||!mo(r)){const e=jp(m,t,i,n,a,T,h,g,x,f,w,Up.horizontal,!1,p,d,l);e&&(A.horizontal[x]=e)}B(b?"left":x)}}let T,B,C,S,E,M=!1;if(s.icon&&s.icon.hasPrimary()){const t=Rf(s.icon,e.iconSizeData,u["icon-size"],o,e.zoom,s,l,h.iconScaleFactor);T=t.iconPrimary,B=t.iconSecondary;const i=T.toString(),a=r.get(i);a&&(C=c.get("icon-offset").evaluate(s,{},o),S=c.get("icon-anchor").evaluate(s,{},o),E=c.get("icon-text-fit").evaluate(s,{},o),g=Yp(n.get(i),B?n.get(B.toString()):void 0,C,S),M=a.sdf,void 0===e.sdfIcons?e.sdfIcons=a.sdf:e.sdfIcons!==a.sdf&&de("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(a.pixelRatio!==e.pixelRatio||0!==c.get("icon-rotate").constantOr(1))&&(e.iconsNeedLinear=!0))}x=x||!(!s.icon||!s.icon.hasSecondary());const I=$f(A.horizontal)||A.vertical;e.iconsInText||(e.iconsInText=!!I&&I.iconsInText);const P=p*h.textScaleFactor/mp,{defaultShapedIcon:L,verticallyShapedIcon:F}=Qf(e,g,c,s,o,A,P,C,E);g=L,b.push({feature:s,shapedTextOrientations:A,shapedText:I,shapedIcon:g,iconPrimary:T,iconSecondary:B,iconOffset:C,iconAnchor:S,verticallyShapedIcon:F,layoutTextSize:p,layoutIconSize:f,textOffset:w,isSDFIcon:M,iconTextFit:E})}return{featureData:b,sizes:h,hasAnySecondaryIcon:x,textAlongLine:y,symbolPlacement:_}},e.ea=ff,e.eb=function(e,t,i,r,n,o,s,a,l,c){const{featureData:u,hasAnySecondaryIcon:h,sizes:d,textAlongLine:p,symbolPlacement:f}=t;for(const t of u){const{shapedIcon:i,verticallyShapedIcon:o,feature:u,shapedTextOrientations:A,shapedText:m,layoutTextSize:g,textOffset:_,isSDFIcon:y,iconPrimary:v,iconSecondary:x,iconTextFit:b,iconOffset:w}=t;Df(i,c.iconPositions,v,x),Df(o,c.iconPositions,v,x),Of(A,c.iconPositions),(m||i)&&jf(e,u,A,i,o,l,d,g,0,_,y,r,n,s,a,h,b,w,p,f)}i&&e.generateCollisionDebugBuffers(o,e.collisionBoxArray,d.textScaleFactor)},e.ec=sh,e.ed=h_,e.ee=j,e.ef=oh,e.eg=Lp,e.eh=t,e.ei=function(e){let t=0;if(new Uint32Array(e,0,1)[0]!==vy){const i=new Uint32Array(e,0,7),[,,r,n,o,s]=i;t=i.byteLength+n+o+s+o,(r!==e.byteLength||t>=e.byteLength)&&de("Invalid b3dm header information.")}return Cy(e,t)},e.ej=function(e,t){const i=ky(e);for(const e of i){for(const t of e.meshes)zy(t);e.lights&&(e.lightMeshIndex=e.meshes.length,e.meshes.push(Ry(e.lights,t)))}return i},e.ek=Gm,e.el=Jm,e.em=Ro,e.en=function(e){He(),null!=Qe&&Qe.then((t=>{t.keys().then((i=>{for(let r=0;r<i.length-e;r++)t.delete(i[r])}))}))},e.f=function(e){return 0===e.indexOf("mapbox:")},e.g=function(e,t){return it(re(e,{method:"GET"}),t)},e.h=Be,e.i=function(e){return Te.API_STYLE_REGEX.test(e)&&!Ce(e)},e.j=function(e){return decodeURIComponent(atob(e).split("").map((e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2))).join(""))},e.k=function(e){return btoa(encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,((e,t)=>String.fromCharCode(Number("0x"+t)))))},e.l=re,e.m=$e,e.n=function(e,t){return it(re(e,{type:"json"}),t)},e.o=lt,e.p=function(e,t){return it(re(e,{method:"POST"}),t)},e.q=ke,e.r=du,e.s=function(e){try{const t=self[e];return t.setItem("_mapbox_test_",1),t.removeItem("_mapbox_test_"),!0}catch(e){return!1}},e.t=Fe,e.u=function(){return function e(t){return t?(t^Math.random()*(16>>t/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,e)}()},e.v=function(e){return!!e&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e)},e.w=de,e.x=function(){return og||(og=new ig),og},e.y=Jg,e.z=_t})),r(["./shared"],(function(e){function t(e){const t=e?e.url.toString():void 0;return t?performance.getEntriesByName(t):[]}function i(e){if("number"==typeof e||"boolean"==typeof e||"string"==typeof e||null==e)return JSON.stringify(e);if(Array.isArray(e)){let t="[";for(const r of e)t+=`${i(r)},`;return`${t}]`}let t="{";for(const r of Object.keys(e).sort())t+=`${r}:${i(e[r])},`;return`${t}}`}function r(t){let r="";for(const n of e.bm)("model"!==t.type||"minzoom"!==n&&"maxzoom"!==n)&&(r+=`/${i(t[n])}`);return r}class n{constructor(e){this.keyCache={},this._layers={},this._layerConfigs={},e&&this.replace(e)}replace(e,t){this._layerConfigs={},this._layers={},this.update(e,[],t)}update(t,n,o){this._options=o;for(const i of t)this._layerConfigs[i.id]=i,(this._layers[i.id]=e.cv(i,this.scope,null,this._options)).compileFilter(o),this.keyCache[i.id]&&delete this.keyCache[i.id];for(const e of n)delete this.keyCache[e],delete this._layerConfigs[e],delete this._layers[e];this.familiesBySource={};const s=function(e,t){const n={};for(let o=0;o<e.length;o++){const s=e[o];let a=t&&t[s.id];!a&&(a=r(s),"line"===s.type&&s.paint)&&function e(t){return"string"==typeof t&&"line-progress"===t||(Array.isArray(t)?t.some(e):!(!t||"object"!=typeof t)&&Object.values(t).some(e))}(s.paint["line-width"])&&(a+=`/${i(s.paint["line-width"])}`),t&&(t[s.id]=a);let l=n[a];l||(l=n[a]=[]),l.push(s)}const o=[];for(const e in n)o.push(n[e]);return o}(Object.values(this._layerConfigs),this.keyCache);for(const e of s){const t=e.map((e=>this._layers[e.id])),i=t[0];if("none"===i.visibility)continue;const r=i.source||"";let n=this.familiesBySource[r];n||(n=this.familiesBySource[r]={});const o=i.sourceLayer||"_geojsonTileLayer";let s=n[o];s||(s=n[o]=[]),s.push(t)}}}const o=1*e.d_;class s{constructor(t){const i={},r=[];for(const e in t){const n=t[e],s=i[e]={};for(const e in n.glyphs){const t=n.glyphs[+e];if(!t||0===t.bitmap.width||0===t.bitmap.height)continue;const i=t.metrics.localGlyph?o:1,a={x:0,y:0,w:t.bitmap.width+2*i,h:t.bitmap.height+2*i};r.push(a),s[e]=a}}const{w:n,h:s}=e.H(r),a=new e.dZ({width:n||1,height:s||1});for(const r in t){const n=t[r];for(const t in n.glyphs){const s=n.glyphs[+t];if(!s||0===s.bitmap.width||0===s.bitmap.height)continue;const l=i[r][t],c=s.metrics.localGlyph?o:1;e.dZ.copy(s.bitmap,a,{x:0,y:0},{x:l.x+c,y:l.y+c},s.bitmap)}}this.image=a,this.positions=i}}e.dY(s,"GlyphAtlas");class a{constructor(t){this.tileID=new e.aH(t.tileID.overscaledZ,t.tileID.wrap,t.tileID.canonical.z,t.tileID.canonical.x,t.tileID.canonical.y),this.tileZoom=t.tileZoom,this.uid=t.uid,this.zoom=t.zoom,this.lut=t.lut,this.canonical=t.tileID.canonical,this.pixelRatio=t.pixelRatio,this.tileSize=t.tileSize,this.source=t.source,this.scope=t.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=t.showCollisionBoxes,this.collectResourceTiming=!!t.request&&t.request.collectResourceTiming,this.promoteId=t.promoteId,this.isSymbolTile=t.isSymbolTile,this.tileTransform=e.aR(t.tileID.canonical,t.projection),this.projection=t.projection,this.worldview=t.worldview,this.localizableLayerIds=t.localizableLayerIds,this.brightness=t.brightness,this.extraShadowCaster=!!t.extraShadowCaster,this.tessellationStep=t.tessellationStep,this.scaleFactor=t.scaleFactor}parse(t,i,r,n,o){this.status="parsing",this.data=t,this.collisionBoxArray=new e.aX;const a=new e.d$(Object.keys(t.layers).sort()),c=new e.e0(this.tileID,this.promoteId);c.bucketLayerIDs=[];const u={},h=new e.e1(256,256),d={featureIndex:c,iconDependencies:new Map,patternDependencies:new Map,glyphDependencies:{},lineAtlas:h,availableImages:r,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0},p=i.familiesBySource[this.source];for(const i in p){const n=t.layers[i];if(!n)continue;let o=!1,s=!1,h=!1;for(const e of p[i])"symbol"===e[0].type?o=!0:s=!0,e[0].is3D()&&"model"!==e[0].type&&(h=!0);if(this.extraShadowCaster&&!h)continue;if(!0===this.isSymbolTile&&!o)continue;if(!1===this.isSymbolTile&&!s)continue;1===n.version&&e.w(`Vector tile source "${this.source}" layer "${i}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const f=a.encode(i),A=[];let m=!1;for(let t=0,r=0;t<n.length;t++){const o=n.feature(t),s=c.getId(o,i);if(this.localizableLayerIds&&this.localizableLayerIds.has(i)){const e=o.properties?o.properties.worldview:null;if(this.worldview&&"string"==typeof e)if("all"===e)o.properties.$localized=!0;else{if(!e.split(",").includes(this.worldview))continue;o.properties.$localized=!0,o.properties.worldview=this.worldview}}!m&&o.properties&&o.properties.hasOwnProperty(e.e2)&&(m=!0),A.push({feature:o,id:s,index:r,sourceLayerIndex:f}),r++}m&&!d.elevationFeatures&&t.layers.hasOwnProperty(e.e3)&&(d.elevationFeatures=e.e4.parseFrom(t.layers[e.e3],this.canonical));for(const t of p[i]){const i=t[0];(!this.extraShadowCaster||i.is3D()&&"model"!==i.type)&&(void 0!==this.isSymbolTile&&"symbol"===i.type!==this.isSymbolTile||i.minzoom&&this.zoom<Math.floor(i.minzoom)||i.maxzoom&&this.zoom>=i.maxzoom||"none"!==i.visibility&&(l(t,this.zoom,d.brightness,r),(u[i.id]=i.createBucket({index:c.bucketLayerIDs.length,layers:t,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:f,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep})).populate(A,d,this.tileID.canonical,this.tileTransform),c.bucketLayerIDs.push(t.map((t=>e.C(t.id,t.scope))))))}}let f,A,m,g,_,y;h.trim();const v={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},x=()=>{if(f)return this.status="done",o(f);if(this.extraShadowCaster)this.status="done",o(null,{buckets:Object.values(u).filter((e=>!e.isEmpty())),featureIndex:c,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:d.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(A&&m&&g){const t=new s(A),i=new Map;for(const[t,r]of m.entries()){const{imagePosition:n}=e.e7(t,r,e.e8);i.set(t,n)}const o={};for(const n in u){const s=u[n];s instanceof e.aY&&(l(s.layers,this.zoom,d.brightness,r),o[n]=e.e9(s,A,t.positions,m,i,this.tileID.canonical,this.tileZoom,this.scaleFactor,this.pixelRatio))}const a={iconsPending:!0,patternsPending:!0};this.rasterizeIfNeeded(n,m,_,(()=>{a.iconsPending=!1,b(o,t,a)})),this.rasterizeIfNeeded(n,g,y,(()=>{a.patternsPending=!1,b(o,t,a)}))}},b=(t,i,n,s)=>{if(n.iconsPending||n.patternsPending)return;const a=new e.ea(m,g,this.lut);for(const i in u){const n=u[i];if(i in t)e.eb(n,t[i],this.showCollisionBoxes,r,this.tileID.canonical,this.tileZoom,this.projection,this.brightness,m,a);else if(n.hasPattern&&(n instanceof e.b2||n instanceof e.b3||n instanceof e.d8)){l(n.layers,this.zoom,d.brightness,r);const e=Object.fromEntries(a.patternPositions);n.addFeatures(d,this.tileID.canonical,e,r,this.tileTransform,this.brightness)}}this.status="done",o(null,{buckets:Object.values(u).filter((e=>!e.isEmpty())),featureIndex:c,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:i.image,lineAtlas:h,imageAtlas:a,brightness:d.brightness})};if(!this.extraShadowCaster){const t=e.e5(d.glyphDependencies,(e=>Object.keys(e).map(Number)));Object.keys(t).length?n.send("getGlyphs",{uid:this.uid,stacks:t,scope:this.scope},((e,t)=>{f||(f=e,A=t,x())}),void 0,!1,v):A={};const i=Array.from(d.iconDependencies.keys()).map((t=>e.I.parse(t)));i.length?n.send("getImages",{images:i,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},((e,t)=>{f||(f=e,m=new Map,_=this.updateImageMapAndGetImageTaskQueue(m,t,d.iconDependencies),x())}),void 0,!1,v):(m=new Map,_=new Map);const r=Array.from(d.patternDependencies.keys()).map((t=>e.I.parse(t)));r.length?n.send("getImages",{images:r,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},((e,t)=>{f||(f=e,g=new Map,y=this.updateImageMapAndGetImageTaskQueue(g,t,d.patternDependencies),x())}),void 0,!1,v):(g=new Map,y=new Map)}if(d.elevationFeatures&&d.elevationFeatures.length>0){const t=[];for(const i of Object.values(u))if(i instanceof e.b3){const e=i.getUnevaluatedPortalGraph();e&&t.push(e)}const i=e.e6.evaluate(t);for(const t of Object.values(u))t instanceof e.b3&&t.setEvaluatedPortalGraph(i)}x()}rasterizeIfNeeded(e,t,i,r){Array.from(t.values()).some((e=>e.usvg))?this.rasterize(e,t,i,r):r()}updateImageMapAndGetImageTaskQueue(e,t,i){const r=new Map;for(const n of t.keys()){const o=i.get(n)||[];for(const i of o){const n=i.toString(),o=t.get(i.id.toString());o.usvg?r.has(n)||(r.set(n,i),e.set(n,Object.assign({},o))):e.set(n,o)}}return r}rasterize(e,t,i,r){this.rasterizeTask=e.send("rasterizeImages",{scope:this.scope,tasks:i},((e,i)=>{if(!e)for(const[e,r]of i.entries()){const i=Object.assign(t.get(e),{data:r});t.set(e,i)}r()}))}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function l(t,i,r,n){const o=new e.aa(i,{brightness:r});for(const e of t)e.recalculate(o,n)}class c extends e.E{constructor(t,i,r,n,o,s){super(),this.actor=t,this.layerIndex=i,this.availableImages=r,this.loadVectorData=o||e.aE,this.loading={},this.loaded={},this.deduped=new e.aD(t.scheduler),this.isSpriteLoaded=n,this.scheduler=t.scheduler,this.brightness=s}loadTile(i,r){const n=i.uid,o=i&&i.request,s=o&&o.collectResourceTiming,l=this.loading[n]=new a(i);l.abort=this.loadVectorData(i,((a,c)=>{const u=!this.loading[n];if(delete this.loading[n],l.cancelRasterize(),u||a||!c)return l.status="done",u||(this.loaded[n]=l),r(a);const h=c.rawData,d={};c.expires&&(d.expires=c.expires),c.cacheControl&&(d.cacheControl=c.cacheControl),l.vectorTile=c.vectorTile||new e.ec.VectorTile(new e.bi(h));const p=()=>{l.parse(l.vectorTile,this.layerIndex,this.availableImages,this.actor,((i,n)=>{if(i||!n)return r(i);const a={};if(s){const e=t(o);e.length>0&&(a.resourceTiming=JSON.parse(JSON.stringify(e)))}r(null,e.l({rawTileData:h.slice(0)},n,d,a))}))};this.isSpriteLoaded?p():this.once("isSpriteLoaded",(()=>{this.scheduler?this.scheduler.add(p,{type:"parseTile",isSymbolTile:i.isSymbolTile,zoom:i.tileZoom}):p()})),this.loaded=this.loaded||{},this.loaded[n]=l}))}reloadTile(t,i){const r=this.loaded,n=t.uid;if(r&&r[n]){const o=r[n];o.scaleFactor=t.scaleFactor,o.showCollisionBoxes=t.showCollisionBoxes,o.projection=t.projection,o.brightness=t.brightness,o.tileTransform=e.aR(t.tileID.canonical,t.projection),o.extraShadowCaster=t.extraShadowCaster,o.lut=t.lut;const s=(e,t)=>{const r=o.reloadCallback;r&&(delete o.reloadCallback,o.parse(o.vectorTile,this.layerIndex,this.availableImages,this.actor,r)),i(e,t)};"parsing"===o.status?o.reloadCallback=s:"done"===o.status&&(o.vectorTile?o.parse(o.vectorTile,this.layerIndex,this.availableImages,this.actor,s):s())}else i(null,void 0)}abortTile(e,t){const i=e.uid,r=this.loading[i];r&&(r.abort&&r.abort(),delete this.loading[i]),t()}removeTile(e,t){const i=this.loaded,r=e.uid;i&&i[r]&&delete i[r],t()}}class u{loadTile(t,i){const{uid:r,encoding:n,rawImageData:o,padding:s}=t,a=ImageBitmap&&o instanceof ImageBitmap?this.getImageData(o,s):o;i(null,new e.ed(r,a,n,s<1))}reloadTile(e,t){t(null,null)}abortTile(e,t){t()}removeTile(e,t){t()}getImageData(e,t){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(e.width,e.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=e.width,this.offscreenCanvas.height=e.height,this.offscreenCanvasContext.drawImage(e,0,0,e.width,e.height);const i=this.offscreenCanvasContext.getImageData(-t,-t,e.width+2*t,e.height+2*t);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),i}}e.bh.setPbf(e.bi);class h{constructor(t){this._mrt=new e.bh(t.partial?30:1/0),this._isHeaderLoaded=!1,this.uid=t.uid,this.tileID=t.tileID,this.source=t.source}parse(t,i){const r=this._mrt;this.status="parsing",this._entireBuffer=t;try{r.parseHeader(t),this._isHeaderLoaded=!0;const n=[];for(const i in r.layers){const o=r.getLayer(i),s=o.getDataRange(o.getBandList()),a=r.createDecodingTask(s),l=t.slice(s.firstByte,s.lastByte+1),c=e.bh.performDecoding(l,a).then((e=>a.complete(null,e))).catch((e=>a.complete(e,null)));n.push(c)}Promise.allSettled(n).then((()=>i(null,r)))}catch(e){i(e)}}}class d{constructor(e){this.actor=e,this.loading={},this.loaded={}}loadTile(t,i){const r=t.uid,n=t.request,o=this.loading[r]=new h(t),{cancel:s}=e.bj(n,((e,t,n,s)=>{const a=!this.loading[r];if(delete this.loading[r],a||e||!t)return o.status="done",a||(this.loaded[r]=o),i(e);o.parse(t,((e,t)=>{if(e||!t)return i(e);i(null,t,n,s)})),this.loaded[r]=o}));o.abort=s}reloadTile(e,t){t(null,void 0)}abortTile(e,t){const i=e.uid,r=this.loading[i];r&&(r.abort&&r.abort(),delete this.loading[i]),t()}removeTile(e,t){const i=e.uid;this.loaded[i]&&delete this.loaded[i],t()}decodeRasterArray({task:t,buffer:i},r){e.bh.performDecoding(i,t).then((e=>r(null,e))).catch((e=>r(e)))}}const p=e.ec.VectorTileFeature.prototype.toGeoJSON;class f{constructor(t){this._feature=t,this.extent=e.ai,this.type=t.type,this.properties=t.tags,"id"in t&&!isNaN(t.id)&&(this.id=parseInt(t.id,10))}loadGeometry(){if(1===this._feature.type){const t=[];for(const i of this._feature.geometry)t.push([new e.P(i[0],i[1])]);return t}{const t=[];for(const i of this._feature.geometry){const r=[];for(const t of i)r.push(new e.P(t[0],t[1]));t.push(r)}return t}}toGeoJSON(e,t,i){return p.call(this,e,t,i)}}class A{constructor(t){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=e.ai,this.length=t.length,this._features=t}feature(e){return new f(this._features[e])}}const m=64/4096,g=128;class _{constructor(){this.features=new Map}clear(){this.features.clear()}load(e=[],t){for(const i of e){const e=i.id;if(null==e)continue;let r=this.features.get(e);r&&this.updateCache(r,t),i.geometry?(r=v(i),this.updateCache(r,t),this.features.set(e,r)):this.features.delete(e),this.updateCache(r,t)}}updateCache(e,t){for(const{canonical:i,uid:r}of Object.values(t)){const{z:n,x:o,y:s}=i;y(e,Math.pow(2,n),o,s)&&delete t[r]}}getTile(e,t,i){const r=Math.pow(2,e),n=[];for(const e of this.features.values())y(e,r,t,i)&&n.push(T(e,r,t,i));return{features:n}}getFeatures(){return[...this.features.values()]}}function y({minX:e,minY:t,maxX:i,maxY:r},n,o,s){return e<(o+1+m)/n&&t<(s+1+m)/n&&i>(o-m)/n&&r>(s-m)/n}function v(e){const{id:t,geometry:i,properties:r}=e;if(!i)return;if("GeometryCollection"===i.type)throw new Error("GeometryCollection not supported in dynamic mode.");const{type:n,coordinates:o}=i,s={id:t,type:1,geometry:[],tags:r,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},a=s.geometry;if("Point"===n)x(o,a,s);else if("MultiPoint"===n)for(const e of o)x(e,a,s);else if("LineString"===n)s.type=2,b(o,a,s);else if("MultiLineString"===n)s.type=2,w(o,a,s);else if("Polygon"===n)s.type=3,w(o,a,s,!0);else{if("MultiPolygon"!==n)throw new Error("Input data is not a valid GeoJSON object.");s.type=3;for(const e of o)w(e,a,s,!0)}return s}function x([t,i],r,n){const o=e.av(t);let s=e.aC(i);s=s<0?0:s>1?1:s,r.push(o,s),n.minX=Math.min(n.minX,o),n.minY=Math.min(n.minY,s),n.maxX=Math.max(n.maxX,o),n.maxY=Math.max(n.maxY,s)}function b(e,t,i,r=!1,n=!1){const o=[];for(const t of e)x(t,o,i);t.push(o),r&&function(e,t){let i=0;for(let t=0,r=e.length,n=r-2;t<r;n=t,t+=2)i+=(e[t]-e[n])*(e[t+1]+e[n+1]);if(i>0===t)for(let t=0,i=e.length;t<i/2;t+=2){const r=e[t],n=e[t+1];e[t]=e[i-2-t],e[t+1]=e[i-1-t],e[i-2-t]=r,e[i-1-t]=n}}(o,n)}function w(e,t,i,r=!1){for(let n=0;n<e.length;n++)b(e[n],t,i,r,0===n)}function T(t,i,r,n){const{id:o,type:s,geometry:a,tags:l}=t,c=[];if(1===s)!function(t,i,r,n,o){for(let s=0;s<t.length;s+=2){const a=Math.round(e.ai*(t[s+0]*i-r)),l=Math.round(e.ai*(t[s+1]*i-n));o.push([a,l])}}(a,i,r,n,c);else for(const e of a)B(e,i,r,n,c);return{id:o,type:s,geometry:c,tags:l}}function B(t,i,r,n,o){const s=-g,a=e.ai+g;let l;for(let c=0;c<t.length-2;c+=2){let u=Math.round(e.ai*(t[c+0]*i-r)),h=Math.round(e.ai*(t[c+1]*i-n)),d=Math.round(e.ai*(t[c+2]*i-r)),p=Math.round(e.ai*(t[c+3]*i-n));const f=d-u,A=p-h;u<s&&d<s||(u<s?(h+=Math.round(A*((s-u)/f)),u=s):d<s&&(p=h+Math.round(A*((s-u)/f)),d=s),h<s&&p<s||(h<s?(u+=Math.round(f*((s-h)/A)),h=s):p<s&&(d=u+Math.round(f*((s-h)/A)),p=s),u>=a&&d>=a||(u>=a?(h+=Math.round(A*((a-u)/f)),u=a):d>=a&&(p=h+Math.round(A*((a-u)/f)),d=a),h>=a&&p>=a||(h>=a?(u+=Math.round(f*((a-h)/A)),h=a):p>=a&&(d=u+Math.round(f*((a-h)/A)),p=a),l&&u===l[l.length-1][0]&&h===l[l.length-1][1]||(l=[[u,h]],o.push(l)),l.push([d,p])))))}}var C,S,E,M={exports:{}},I=function(){if(E)return M.exports;E=1;var t=e.eg(),i=function(){if(S)return C;S=1;var t=e.ee(),i=e.ef().VectorTileFeature;function r(e,t){this.options=t||{},this.features=e,this.length=e.length}function n(e,t){this.id="number"==typeof e.id?e.id:void 0,this.type=e.type,this.rawGeometry=1===e.type?[e.geometry]:e.geometry,this.properties=e.tags,this.extent=t||4096}return C=r,r.prototype.feature=function(e){return new n(this.features[e],this.options.extent)},n.prototype.loadGeometry=function(){var e=this.rawGeometry;this.geometry=[];for(var i=0;i<e.length;i++){for(var r=e[i],n=[],o=0;o<r.length;o++)n.push(new t(r[o][0],r[o][1]));this.geometry.push(n)}return this.geometry},n.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var e=this.geometry,t=1/0,i=-1/0,r=1/0,n=-1/0,o=0;o<e.length;o++)for(var s=e[o],a=0;a<s.length;a++){var l=s[a];t=Math.min(t,l.x),i=Math.max(i,l.x),r=Math.min(r,l.y),n=Math.max(n,l.y)}return[t,r,i,n]},n.prototype.toGeoJSON=i.prototype.toGeoJSON,C}();function r(e){var i=new t;return function(e,t){for(var i in e.layers)t.writeMessage(3,n,e.layers[i])}(e,i),i.finish()}function n(e,t){var i;t.writeVarintField(15,e.version||1),t.writeStringField(1,e.name||""),t.writeVarintField(5,e.extent||4096);var r={keys:[],values:[],keycache:{},valuecache:{}};for(i=0;i<e.length;i++)r.feature=e.feature(i),t.writeMessage(2,o,r);var n=r.keys;for(i=0;i<n.length;i++)t.writeStringField(3,n[i]);var s=r.values;for(i=0;i<s.length;i++)t.writeMessage(4,u,s[i])}function o(e,t){var i=e.feature;void 0!==i.id&&t.writeVarintField(1,i.id),t.writeMessage(2,s,e),t.writeVarintField(3,i.type),t.writeMessage(4,c,i)}function s(e,t){var i=e.feature,r=e.keys,n=e.values,o=e.keycache,s=e.valuecache;for(var a in i.properties){var l=i.properties[a],c=o[a];if(null!==l){void 0===c&&(r.push(a),o[a]=c=r.length-1),t.writeVarint(c);var u=typeof l;"string"!==u&&"boolean"!==u&&"number"!==u&&(l=JSON.stringify(l));var h=u+":"+l,d=s[h];void 0===d&&(n.push(l),s[h]=d=n.length-1),t.writeVarint(d)}}}function a(e,t){return(t<<3)+(7&e)}function l(e){return e<<1^e>>31}function c(e,t){for(var i=e.loadGeometry(),r=e.type,n=0,o=0,s=i.length,c=0;c<s;c++){var u=i[c],h=1;1===r&&(h=u.length),t.writeVarint(a(1,h));for(var d=3===r?u.length-1:u.length,p=0;p<d;p++){1===p&&1!==r&&t.writeVarint(a(2,d-1));var f=u[p].x-n,A=u[p].y-o;t.writeVarint(l(f)),t.writeVarint(l(A)),n+=f,o+=A}3===r&&t.writeVarint(a(7,1))}}function u(e,t){var i=typeof e;"string"===i?t.writeStringField(1,e):"boolean"===i?t.writeBooleanField(7,e):"number"===i&&(e%1!=0?t.writeDoubleField(3,e):e<0?t.writeSVarintField(6,e):t.writeVarintField(5,e))}return M.exports=r,M.exports.fromVectorTileJs=r,M.exports.fromGeojsonVt=function(e,t){t=t||{};var n={};for(var o in e)n[o]=new i(e[o].features,t),n[o].name=o,n[o].version=t.version,n[o].extent=t.extent;return r({layers:n})},M.exports.GeoJSONWrapper=i,M.exports}(),P=e.eh(I);const L={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:e=>e},F=Math.fround||(k=new Float32Array(1),e=>(k[0]=+e,k[0]));var k;const z=3,R=5,D=6;class O{constructor(e){this.options=Object.assign(Object.create(L),e),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(e){const{log:t,minZoom:i,maxZoom:r}=this.options;t&&console.time("total time");const n=`prepare ${e.length} points`;t&&console.time(n),this.points=e;const o=[];for(let t=0;t<e.length;t++){const i=e[t];if(!i.geometry)continue;const[r,n]=i.geometry.coordinates,s=F(Q(r)),a=F(j(n));o.push(s,a,1/0,t,-1,1),this.options.reduce&&o.push(0)}let s=this.trees[r+1]=this._createTree(o);t&&console.timeEnd(n);for(let e=r;e>=i;e--){const i=+Date.now();s=this.trees[e]=this._createTree(this._cluster(s,e)),t&&console.log("z%d: %d clusters in %dms",e,s.numItems,+Date.now()-i)}return t&&console.timeEnd("total time"),this}getClusters(e,t){let i=((e[0]+180)%360+360)%360-180;const r=Math.max(-90,Math.min(90,e[1]));let n=180===e[2]?180:((e[2]+180)%360+360)%360-180;const o=Math.max(-90,Math.min(90,e[3]));if(e[2]-e[0]>=360)i=-180,n=180;else if(i>n){const e=this.getClusters([i,r,180,o],t),s=this.getClusters([-180,r,n,o],t);return e.concat(s)}const s=this.trees[this._limitZoom(t)],a=s.range(Q(i),j(o),Q(n),j(r)),l=s.data,c=[];for(const e of a){const t=this.stride*e;c.push(l[t+R]>1?U(l,t,this.clusterProps):this.points[l[t+z]])}return c}getChildren(e){const t=this._getOriginId(e),i=this._getOriginZoom(e),r="No cluster with the specified id.",n=this.trees[i];if(!n)throw new Error(r);const o=n.data;if(t*this.stride>=o.length)throw new Error(r);const s=this.options.radius/(this.options.extent*Math.pow(2,i-1)),a=n.within(o[t*this.stride],o[t*this.stride+1],s),l=[];for(const t of a){const i=t*this.stride;o[i+4]===e&&l.push(o[i+R]>1?U(o,i,this.clusterProps):this.points[o[i+z]])}if(0===l.length)throw new Error(r);return l}getLeaves(e,t,i){const r=[];return this._appendLeaves(r,e,t=t||10,i=i||0,0),r}getTile(e,t,i){const r=this.trees[this._limitZoom(e)],n=Math.pow(2,e),{extent:o,radius:s}=this.options,a=s/o,l=(i-a)/n,c=(i+1+a)/n,u={features:[]};return this._addTileFeatures(r.range((t-a)/n,l,(t+1+a)/n,c),r.data,t,i,n,u),0===t&&this._addTileFeatures(r.range(1-a/n,l,1,c),r.data,n,i,n,u),t===n-1&&this._addTileFeatures(r.range(0,l,a/n,c),r.data,-1,i,n,u),u.features.length?u:null}getClusterExpansionZoom(e){let t=this._getOriginZoom(e)-1;for(;t<=this.options.maxZoom;){const i=this.getChildren(e);if(t++,1!==i.length)break;e=i[0].properties.cluster_id}return t}_appendLeaves(e,t,i,r,n){const o=this.getChildren(t);for(const t of o){const o=t.properties;if(o&&o.cluster?n+o.point_count<=r?n+=o.point_count:n=this._appendLeaves(e,o.cluster_id,i,r,n):n<r?n++:e.push(t),e.length===i)break}return n}_createTree(t){const i=new e.bE(t.length/this.stride|0,this.options.nodeSize,Float32Array);for(let e=0;e<t.length;e+=this.stride)i.add(t[e],t[e+1]);return i.finish(),i.data=t,i}_addTileFeatures(e,t,i,r,n,o){for(const s of e){const e=s*this.stride,a=t[e+R]>1;let l,c,u;if(a)l=N(t,e,this.clusterProps),c=t[e],u=t[e+1];else{const i=this.points[t[e+z]];l=i.properties;const[r,n]=i.geometry.coordinates;c=Q(r),u=j(n)}const h={type:1,geometry:[[Math.round(this.options.extent*(c*n-i)),Math.round(this.options.extent*(u*n-r))]],tags:l};let d;d=a||this.options.generateId?t[e+z]:this.points[t[e+z]].id,void 0!==d&&(h.id=d),o.features.push(h)}}_limitZoom(e){return Math.max(this.options.minZoom,Math.min(Math.floor(+e),this.options.maxZoom+1))}_cluster(e,t){const{radius:i,extent:r,reduce:n,minPoints:o}=this.options,s=i/(r*Math.pow(2,t)),a=e.data,l=[],c=this.stride;for(let i=0;i<a.length;i+=c){if(a[i+2]<=t)continue;a[i+2]=t;const r=a[i],u=a[i+1],h=e.within(a[i],a[i+1],s),d=a[i+R];let p=d;for(const e of h){const i=e*c;a[i+2]>t&&(p+=a[i+R])}if(p>d&&p>=o){let e,o=r*d,s=u*d,f=-1;const A=(i/c<<5)+(t+1)+this.points.length;for(const r of h){const l=r*c;if(a[l+2]<=t)continue;a[l+2]=t;const u=a[l+R];o+=a[l]*u,s+=a[l+1]*u,a[l+4]=A,n&&(e||(e=this._map(a,i,!0),f=this.clusterProps.length,this.clusterProps.push(e)),n(e,this._map(a,l)))}a[i+4]=A,l.push(o/p,s/p,1/0,A,-1,p),n&&l.push(f)}else{for(let e=0;e<c;e++)l.push(a[i+e]);if(p>1)for(const e of h){const i=e*c;if(!(a[i+2]<=t)){a[i+2]=t;for(let e=0;e<c;e++)l.push(a[i+e])}}}}return l}_getOriginId(e){return e-this.points.length>>5}_getOriginZoom(e){return(e-this.points.length)%32}_map(e,t,i){if(e[t+R]>1){const r=this.clusterProps[e[t+D]];return i?Object.assign({},r):r}const r=this.points[e[t+z]].properties,n=this.options.map(r);return i&&n===r?Object.assign({},n):n}}function U(e,t,i){return{type:"Feature",id:e[t+z],properties:N(e,t,i),geometry:{type:"Point",coordinates:[(r=e[t],360*(r-.5)),V(e[t+1])]}};var r}function N(e,t,i){const r=e[t+R],n=r>=1e4?`${Math.round(r/1e3)}k`:r>=1e3?Math.round(r/100)/10+"k":r,o=e[t+D],s=-1===o?{}:Object.assign({},i[o]);return Object.assign(s,{cluster:!0,cluster_id:e[t+z],point_count:r,point_count_abbreviated:n})}function Q(e){return e/360+.5}function j(e){const t=Math.sin(e*Math.PI/180),i=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return i<0?0:i>1?1:i}function V(e){const t=(180-360*e)*Math.PI/180;return 360*Math.atan(Math.exp(t))/Math.PI-90}function H(e,t,i,r){let n=r;const o=t+(i-t>>1);let s,a=i-t;const l=e[t],c=e[t+1],u=e[i],h=e[i+1];for(let r=t+3;r<i;r+=3){const t=G(e[r],e[r+1],l,c,u,h);if(t>n)s=r,n=t;else if(t===n){const e=Math.abs(r-o);e<a&&(s=r,a=e)}}n>r&&(s-t>3&&H(e,t,s,r),e[s+2]=n,i-s>3&&H(e,s,i,r))}function G(e,t,i,r,n,o){let s=n-i,a=o-r;if(0!==s||0!==a){const l=((e-i)*s+(t-r)*a)/(s*s+a*a);l>1?(i=n,r=o):l>0&&(i+=s*l,r+=a*l)}return s=e-i,a=t-r,s*s+a*a}function $(e,t,i,r){const n={id:e??null,type:t,geometry:i,tags:r,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if("Point"===t||"MultiPoint"===t||"LineString"===t)Z(n,i);else if("Polygon"===t)Z(n,i[0]);else if("MultiLineString"===t)for(const e of i)Z(n,e);else if("MultiPolygon"===t)for(const e of i)Z(n,e[0]);return n}function Z(e,t){for(let i=0;i<t.length;i+=3)e.minX=Math.min(e.minX,t[i]),e.minY=Math.min(e.minY,t[i+1]),e.maxX=Math.max(e.maxX,t[i]),e.maxY=Math.max(e.maxY,t[i+1])}function q(e,t,i,r){if(!t.geometry)return;const n=t.geometry.coordinates;if(n&&0===n.length)return;const o=t.geometry.type,s=Math.pow(i.tolerance/((1<<i.maxZoom)*i.extent),2);let a=[],l=t.id;if(i.promoteId?l=t.properties[i.promoteId]:i.generateId&&(l=r||0),"Point"===o)K(n,a);else if("MultiPoint"===o)for(const e of n)K(e,a);else if("LineString"===o)W(n,a,s,!1);else if("MultiLineString"===o){if(i.lineMetrics){for(const i of n)a=[],W(i,a,s,!1),e.push($(l,"LineString",a,t.properties));return}X(n,a,s,!1)}else if("Polygon"===o)X(n,a,s,!0);else{if("MultiPolygon"!==o){if("GeometryCollection"===o){for(const n of t.geometry.geometries)q(e,{id:l,geometry:n,properties:t.properties},i,r);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const e of n){const t=[];X(e,t,s,!0),a.push(t)}}e.push($(l,o,a,t.properties))}function K(e,t){t.push(Y(e[0]),J(e[1]),0)}function W(e,t,i,r){let n,o,s=0;for(let i=0;i<e.length;i++){const a=Y(e[i][0]),l=J(e[i][1]);t.push(a,l,0),i>0&&(s+=r?(n*l-a*o)/2:Math.sqrt(Math.pow(a-n,2)+Math.pow(l-o,2))),n=a,o=l}const a=t.length-3;t[2]=1,H(t,0,a,i),t[a+2]=1,t.size=Math.abs(s),t.start=0,t.end=t.size}function X(e,t,i,r){for(let n=0;n<e.length;n++){const o=[];W(e[n],o,i,r),t.push(o)}}function Y(e){return e/360+.5}function J(e){const t=Math.sin(e*Math.PI/180),i=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return i<0?0:i>1?1:i}function ee(e,t,i,r,n,o,s,a){if(r/=t,o>=(i/=t)&&s<r)return e;if(s<i||o>=r)return null;const l=[];for(const t of e){const e=t.geometry;let o=t.type;const s=0===n?t.minX:t.minY,c=0===n?t.maxX:t.maxY;if(s>=i&&c<r){l.push(t);continue}if(c<i||s>=r)continue;let u=[];if("Point"===o||"MultiPoint"===o)te(e,u,i,r,n);else if("LineString"===o)ie(e,u,i,r,n,!1,a.lineMetrics);else if("MultiLineString"===o)ne(e,u,i,r,n,!1);else if("Polygon"===o)ne(e,u,i,r,n,!0);else if("MultiPolygon"===o)for(const t of e){const e=[];ne(t,e,i,r,n,!0),e.length&&u.push(e)}if(u.length){if(a.lineMetrics&&"LineString"===o){for(const e of u)l.push($(t.id,o,e,t.tags));continue}"LineString"!==o&&"MultiLineString"!==o||(1===u.length?(o="LineString",u=u[0]):o="MultiLineString"),"Point"!==o&&"MultiPoint"!==o||(o=3===u.length?"Point":"MultiPoint"),l.push($(t.id,o,u,t.tags))}}return l.length?l:null}function te(e,t,i,r,n){for(let o=0;o<e.length;o+=3){const s=e[o+n];s>=i&&s<=r&&oe(t,e[o],e[o+1],e[o+2])}}function ie(e,t,i,r,n,o,s){let a=re(e);const l=0===n?se:ae;let c,u,h=e.start;for(let d=0;d<e.length-3;d+=3){const p=e[d],f=e[d+1],A=e[d+2],m=e[d+3],g=e[d+4],_=0===n?p:f,y=0===n?m:g;let v=!1;s&&(c=Math.sqrt(Math.pow(p-m,2)+Math.pow(f-g,2))),_<i?y>i&&(u=l(a,p,f,m,g,i),s&&(a.start=h+c*u)):_>r?y<r&&(u=l(a,p,f,m,g,r),s&&(a.start=h+c*u)):oe(a,p,f,A),y<i&&_>=i&&(u=l(a,p,f,m,g,i),v=!0),y>r&&_<=r&&(u=l(a,p,f,m,g,r),v=!0),!o&&v&&(s&&(a.end=h+c*u),t.push(a),a=re(e)),s&&(h+=c)}let d=e.length-3;const p=e[d],f=e[d+1],A=0===n?p:f;A>=i&&A<=r&&oe(a,p,f,e[d+2]),d=a.length-3,o&&d>=3&&(a[d]!==a[0]||a[d+1]!==a[1])&&oe(a,a[0],a[1],a[2]),a.length&&t.push(a)}function re(e){const t=[];return t.size=e.size,t.start=e.start,t.end=e.end,t}function ne(e,t,i,r,n,o){for(const s of e)ie(s,t,i,r,n,o,!1)}function oe(e,t,i,r){e.push(t,i,r)}function se(e,t,i,r,n,o){const s=(o-t)/(r-t);return oe(e,o,i+(n-i)*s,1),s}function ae(e,t,i,r,n,o){const s=(o-i)/(n-i);return oe(e,t+(r-t)*s,o,1),s}function le(e,t){const i=[];for(let r=0;r<e.length;r++){const n=e[r],o=n.type;let s;if("Point"===o||"MultiPoint"===o||"LineString"===o)s=ce(n.geometry,t);else if("MultiLineString"===o||"Polygon"===o){s=[];for(const e of n.geometry)s.push(ce(e,t))}else if("MultiPolygon"===o){s=[];for(const e of n.geometry){const i=[];for(const r of e)i.push(ce(r,t));s.push(i)}}i.push($(n.id,o,s,n.tags))}return i}function ce(e,t){const i=[];i.size=e.size,void 0!==e.start&&(i.start=e.start,i.end=e.end);for(let r=0;r<e.length;r+=3)i.push(e[r]+t,e[r+1],e[r+2]);return i}function ue(e,t){if(e.transformed)return e;const i=1<<e.z,r=e.x,n=e.y;for(const o of e.features){const e=o.geometry,s=o.type;if(o.geometry=[],1===s)for(let s=0;s<e.length;s+=2)o.geometry.push(he(e[s],e[s+1],t,i,r,n));else for(let s=0;s<e.length;s++){const a=[];for(let o=0;o<e[s].length;o+=2)a.push(he(e[s][o],e[s][o+1],t,i,r,n));o.geometry.push(a)}}return e.transformed=!0,e}function he(e,t,i,r,n,o){return[Math.round(i*(e*r-n)),Math.round(i*(t*r-o))]}function de(e,t,i,r,n){const o=t===n.maxZoom?0:n.tolerance/((1<<t)*n.extent),s={features:[],numPoints:0,numSimplified:0,numFeatures:e.length,source:null,x:i,y:r,z:t,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const t of e)pe(s,t,o,n);return s}function pe(e,t,i,r){const n=t.geometry,o=t.type,s=[];if(e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY),"Point"===o||"MultiPoint"===o)for(let t=0;t<n.length;t+=3)s.push(n[t],n[t+1]),e.numPoints++,e.numSimplified++;else if("LineString"===o)fe(s,n,e,i,!1,!1);else if("MultiLineString"===o||"Polygon"===o)for(let t=0;t<n.length;t++)fe(s,n[t],e,i,"Polygon"===o,0===t);else if("MultiPolygon"===o)for(let t=0;t<n.length;t++){const r=n[t];for(let t=0;t<r.length;t++)fe(s,r[t],e,i,!0,0===t)}if(s.length){let i=t.tags||null;if("LineString"===o&&r.lineMetrics){i={};for(const e in t.tags)i[e]=t.tags[e];i.mapbox_clip_start=n.start/n.size,i.mapbox_clip_end=n.end/n.size}const a={geometry:s,type:"Polygon"===o||"MultiPolygon"===o?3:"LineString"===o||"MultiLineString"===o?2:1,tags:i};null!==t.id&&(a.id=t.id),e.features.push(a)}}function fe(e,t,i,r,n,o){const s=r*r;if(r>0&&t.size<(n?s:r))return void(i.numPoints+=t.length/3);const a=[];for(let e=0;e<t.length;e+=3)(0===r||t[e+2]>s)&&(i.numSimplified++,a.push(t[e],t[e+1])),i.numPoints++;n&&function(e,t){let i=0;for(let t=0,r=e.length,n=r-2;t<r;n=t,t+=2)i+=(e[t]-e[n])*(e[t+1]+e[n+1]);if(i>0===t)for(let t=0,i=e.length;t<i/2;t+=2){const r=e[t],n=e[t+1];e[t]=e[i-2-t],e[t+1]=e[i-1-t],e[i-2-t]=r,e[i-1-t]=n}}(a,o),e.push(a)}const Ae={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class me{constructor(e,t){const i=(t=this.options=function(e,t){for(const i in t)e[i]=t[i];return e}(Object.create(Ae),t)).debug;if(i&&console.time("preprocess data"),t.maxZoom<0||t.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(t.promoteId&&t.generateId)throw new Error("promoteId and generateId cannot be used together.");let r=function(e,t){const i=[];if("FeatureCollection"===e.type)for(let r=0;r<e.features.length;r++)q(i,e.features[r],t,r);else q(i,"Feature"===e.type?e:{geometry:e},t);return i}(e,t);this.tiles={},this.tileCoords=[],i&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",t.indexMaxZoom,t.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),r=function(e,t){const i=t.buffer/t.extent;let r=e;const n=ee(e,1,-1-i,i,0,-1,2,t),o=ee(e,1,1-i,2+i,0,-1,2,t);return(n||o)&&(r=ee(e,1,-i,1+i,0,-1,2,t)||[],n&&(r=le(n,1).concat(r)),o&&(r=r.concat(le(o,-1)))),r}(r,t),r.length&&this.splitTile(r,0,0,0),i&&(r.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(e,t,i,r,n,o,s){const a=[e,t,i,r],l=this.options,c=l.debug;for(;a.length;){r=a.pop(),i=a.pop(),t=a.pop(),e=a.pop();const u=1<<t,h=ge(t,i,r);let d=this.tiles[h];if(!d&&(c>1&&console.time("creation"),d=this.tiles[h]=de(e,t,i,r,l),this.tileCoords.push({z:t,x:i,y:r}),c)){c>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",t,i,r,d.numFeatures,d.numPoints,d.numSimplified),console.timeEnd("creation"));const e=`z${t}`;this.stats[e]=(this.stats[e]||0)+1,this.total++}if(d.source=e,null==n){if(t===l.indexMaxZoom||d.numPoints<=l.indexMaxPoints)continue}else{if(t===l.maxZoom||t===n)continue;if(null!=n){const e=n-t;if(i!==o>>e||r!==s>>e)continue}}if(d.source=null,0===e.length)continue;c>1&&console.time("clipping");const p=.5*l.buffer/l.extent,f=.5-p,A=.5+p,m=1+p;let g=null,_=null,y=null,v=null,x=ee(e,u,i-p,i+A,0,d.minX,d.maxX,l),b=ee(e,u,i+f,i+m,0,d.minX,d.maxX,l);e=null,x&&(g=ee(x,u,r-p,r+A,1,d.minY,d.maxY,l),_=ee(x,u,r+f,r+m,1,d.minY,d.maxY,l),x=null),b&&(y=ee(b,u,r-p,r+A,1,d.minY,d.maxY,l),v=ee(b,u,r+f,r+m,1,d.minY,d.maxY,l),b=null),c>1&&console.timeEnd("clipping"),a.push(g||[],t+1,2*i,2*r),a.push(_||[],t+1,2*i,2*r+1),a.push(y||[],t+1,2*i+1,2*r),a.push(v||[],t+1,2*i+1,2*r+1)}}getTile(e,t,i){e=+e,t=+t,i=+i;const r=this.options,{extent:n,debug:o}=r;if(e<0||e>24)return null;const s=1<<e,a=ge(e,t=t+s&s-1,i);if(this.tiles[a])return ue(this.tiles[a],n);o>1&&console.log("drilling down to z%d-%d-%d",e,t,i);let l,c=e,u=t,h=i;for(;!l&&c>0;)c--,u>>=1,h>>=1,l=this.tiles[ge(c,u,h)];return l&&l.source?(o>1&&(console.log("found parent tile z%d-%d-%d",c,u,h),console.time("drilling down")),this.splitTile(l.source,c,u,h,e,t,i),o>1&&console.timeEnd("drilling down"),this.tiles[a]?ue(this.tiles[a],n):null):null}}function ge(e,t,i){return 32*((1<<e)*i+t)+e}function _e(e,t){const i=e.tileID.canonical;if(!this._geoJSONIndex)return void t(null,null);const r=this._geoJSONIndex.getTile(i.z,i.x,i.y);if(!r)return void t(null,null);const n=new A(r.features);let o=P(n);0===o.byteOffset&&o.byteLength===o.buffer.byteLength||(o=new Uint8Array(o)),t(null,{vectorTile:n,rawData:o.buffer})}class ye extends c{constructor(e,t,i,r,n,o){super(e,t,i,r,_e,o),n&&(this.loadGeoJSON=n),this._dynamicIndex=new _}loadData(i,r){const n=i&&i.request,o=n&&n.collectResourceTiming;this.loadGeoJSON(i,((s,a)=>{if(s||!a)return r(s);if("object"!=typeof a)return r(new Error(`Input data given to '${i.source}' is not a valid GeoJSON object.`));{try{if(i.filter){const t=e.X(i.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===t.result)throw new Error(t.value.map((e=>`${e.key}: ${e.message}`)).join(", "));a.features=a.features.filter((e=>t.value.evaluate({zoom:0},e)))}i.dynamic?("Feature"===a.type&&(a={type:"FeatureCollection",features:[a]}),i.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(a.features,this.loaded),i.cluster&&(a.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=i.cluster?new O(function({superclusterOptions:t,clusterProperties:i}){if(!i||!t)return t;const r={},n={},o={accumulated:null,zoom:0},s={properties:null},a=Object.keys(i);for(const t of a){const[o,s]=i[t],a=e.X(s),l=e.X("string"==typeof o?[o,["accumulated"],["get",t]]:o);r[t]=a.value,n[t]=l.value}return t.map=e=>{s.properties=e;const t={};for(const e of a)t[e]=r[e].evaluate(o,s);return t},t.reduce=(e,t)=>{s.properties=t;for(const t of a)o.accumulated=e[t],e[t]=n[t].evaluate(o,s)},t}(i)).load(a.features):i.dynamic?this._dynamicIndex:function(e,t){return new me(e,t)}(a,i.geojsonVtOptions)}catch(e){return r(e)}const s={};if(o){const e=t(n);e&&(s.resourceTiming={},s.resourceTiming[i.source]=JSON.parse(JSON.stringify(e)))}r(null,s)}}))}reloadTile(e,t){const i=this.loaded;return i&&i[e.uid]?e.partial?t(null,void 0):super.reloadTile(e,t):this.loadTile(e,t)}loadGeoJSON(t,i){if(t.request)e.n(t.request,i);else{if("string"!=typeof t.data)return i(new Error(`Input data given to '${t.source}' is not a valid GeoJSON object.`));try{return i(null,JSON.parse(t.data))}catch(e){return i(new Error(`Input data given to '${t.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(e,t){try{t(null,this._geoJSONIndex.getClusterExpansionZoom(e.clusterId))}catch(e){t(e)}}getClusterChildren(e,t){try{t(null,this._geoJSONIndex.getChildren(e.clusterId))}catch(e){t(e)}}getClusterLeaves(e,t){try{t(null,this._geoJSONIndex.getLeaves(e.clusterId,e.limit,e.offset))}catch(e){t(e)}}}class ve{constructor(t,i){this.tileID=new e.aH(t.tileID.overscaledZ,t.tileID.wrap,t.tileID.canonical.z,t.tileID.canonical.x,t.tileID.canonical.y),this.tileZoom=t.tileZoom,this.uid=t.uid,this.zoom=t.zoom,this.canonical=t.tileID.canonical,this.pixelRatio=t.pixelRatio,this.tileSize=t.tileSize,this.source=t.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=t.projection,this.brightness=i}parse(t,i,r,n){this.status="parsing";const o=new e.aH(r.tileID.overscaledZ,r.tileID.wrap,r.tileID.canonical.z,r.tileID.canonical.x,r.tileID.canonical.y),s=[],a=i.familiesBySource[r.source],l=new e.e0(o,r.promoteId);return l.bucketLayerIDs=[],l.is3DTile=!0,e.ei(t).then((t=>{if(!t)return n(new Error("Could not parse tile"));const i=e.ej(t,1/e.cd(r.tileID.canonical)),c=t.json.extensionsUsed&&t.json.extensionsUsed.includes("MAPBOX_mesh_features")||t.json.asset.extras&&t.json.asset.extras.MAPBOX_mesh_features,u=t.json.extensionsUsed&&t.json.extensionsUsed.includes("EXT_meshopt_compression"),h=new e.aa(this.zoom,{brightness:this.brightness});for(const t in a)for(const r of a[t]){const t=r[0];l.bucketLayerIDs.push(r.map((t=>e.C(t.id,t.scope)))),t.recalculate(h,[]);const n=new e.ek(r,i,o,c,u,this.brightness,l);c||(n.needsUpload=!0),s.push(n),n.evaluate(t)}this.status="done",n(null,{buckets:s,featureIndex:l,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})})).catch((e=>n(new Error(e.message))))}}class xe{constructor(e,t,i,r,n,o){this.actor=e,this.layerIndex=t,this.availableImages=i,this.brightness=o,this.loading={},this.loaded={}}loadTile(t,i){const r=t.uid,n=this.loading[r]=new ve(t,this.brightness);e.bj(t.request,((e,o)=>{const s=!this.loading[r];return delete this.loading[r],s||e?(n.status="done",s||(this.loaded[r]=n),i(e)):o&&0!==o.byteLength?void n.parse(o,this.layerIndex,t,((e,t)=>{n.status="done",this.loaded=this.loaded||{},this.loaded[r]=n,e||!t?i(e):i(null,t)})):(n.status="done",this.loaded[r]=n,i())}))}reloadTile(e,t){const i=this.loaded,r=e.uid;if(i&&i[r]){const n=i[r];n.projection=e.projection,n.brightness=e.brightness;const o=(i,r)=>{n.reloadCallback&&(delete n.reloadCallback,this.loadTile(e,t)),t(i,r)};"parsing"===n.status?n.reloadCallback=o:"done"===n.status&&this.loadTile(e,t)}}abortTile(e,t){const i=e.uid;this.loading[i]&&delete this.loading[i],t()}removeTile(e,t){const i=this.loaded,r=e.uid;i&&i[r]&&delete i[r],t()}}class be{constructor(t){this.self=t,this.actor=new e.el(t,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.imageRasterizer=new e.y,this.projections={},this.defaultProjection=e.bP({name:"mercator"}),this.workerSourceTypes={vector:c,geojson:ye,"raster-dem":u,"raster-array":d,"batched-model":xe},this.workerSources={},this.self.registerWorkerSource=(e,t)=>{if(this.workerSourceTypes[e])throw new Error(`Worker source with name "${e}" already registered.`);this.workerSourceTypes[e]=t},this.self.registerRTLTextPlugin=t=>{if(e.em.isParsed())throw new Error("RTL text plugin already registered.");e.em.applyArabicShaping=t.applyArabicShaping,e.em.processBidirectionalText=t.processBidirectionalText,e.em.processStyledBidirectionalText=t.processStyledBidirectionalText}}clearCaches(e,t,i){delete this.layerIndexes[e],delete this.availableImages[e],delete this.workerSources[e],i()}checkIfReady(e,t,i){i()}setReferrer(e,t){this.referrer=t}spriteLoaded(t,{scope:i,isLoaded:r}){if(this.isSpriteLoaded[t]||(this.isSpriteLoaded[t]={}),this.isSpriteLoaded[t][i]=r,this.workerSources[t]&&this.workerSources[t][i])for(const n in this.workerSources[t][i]){const o=this.workerSources[t][i][n];for(const t in o){const i=o[t];i instanceof c&&(i.isSpriteLoaded=r,i.fire(new e.A("isSpriteLoaded")))}}}setImages(e,{scope:t,images:i},r){if(this.availableImages[e]||(this.availableImages[e]={}),this.availableImages[e][t]=i,this.workerSources[e]&&this.workerSources[e][t]){for(const r in this.workerSources[e][t]){const n=this.workerSources[e][t][r];for(const e in n)n[e].availableImages=i}r()}else r()}setProjection(t,i){this.projections[t]=e.bP(i)}setBrightness(e,t,i){this.brightness=t,i()}setLayers(e,t,i){this.getLayerIndex(e,t.scope).replace(t.layers,t.options),i()}updateLayers(e,t,i){this.getLayerIndex(e,t.scope).update(t.layers,t.removedIds,t.options),i()}loadTile(e,t,i){t.projection=this.projections[e]||this.defaultProjection,this.getWorkerSource(e,t.type,t.source,t.scope).loadTile(t,i)}decodeRasterArray(e,t,i){this.getWorkerSource(e,t.type,t.source,t.scope).decodeRasterArray(t,i)}reloadTile(e,t,i){t.projection=this.projections[e]||this.defaultProjection,this.getWorkerSource(e,t.type,t.source,t.scope).reloadTile(t,i)}abortTile(e,t,i){this.getWorkerSource(e,t.type,t.source,t.scope).abortTile(t,i)}removeTile(e,t,i){this.getWorkerSource(e,t.type,t.source,t.scope).removeTile(t,i)}removeSource(e,t,i){if(!(this.workerSources[e]&&this.workerSources[e][t.scope]&&this.workerSources[e][t.scope][t.type]&&this.workerSources[e][t.scope][t.type][t.source]))return;const r=this.workerSources[e][t.scope][t.type][t.source];delete this.workerSources[e][t.scope][t.type][t.source],void 0!==r.removeSource?r.removeSource(t,i):i()}loadWorkerSource(e,t,i){try{this.self.importScripts(t.url),i()}catch(e){i(e.toString())}}syncRTLPluginState(t,i,r){try{e.em.setState(i);const t=e.em.getPluginURL();if(e.em.isLoaded()&&!e.em.isParsed()&&null!=t){this.self.importScripts(t);const i=e.em.isParsed();r(i?void 0:new Error(`RTL Text Plugin failed to import scripts from ${t}`),i)}}catch(e){r(e.toString())}}setDracoUrl(e,t){this.dracoUrl=t}getAvailableImages(e,t){this.availableImages[e]||(this.availableImages[e]={});let i=this.availableImages[e][t];return i||(i=[]),i}getLayerIndex(e,t){this.layerIndexes[e]||(this.layerIndexes[e]={});let i=this.layerIndexes[e][t];return i||(i=this.layerIndexes[e][t]=new n,i.scope=t),i}getWorkerSource(e,t,i,r){const n=this.workerSources;return n[e]||(n[e]={}),n[e][r]||(n[e][r]={}),n[e][r][t]||(n[e][r][t]={}),this.isSpriteLoaded[e]||(this.isSpriteLoaded[e]={}),n[e][r][t][i]||(n[e][r][t][i]=new this.workerSourceTypes[t]({send:(t,i,r,n,o,s)=>{this.actor.send(t,i,r,e,o,s)},scheduler:this.actor.scheduler},this.getLayerIndex(e,r),this.getAvailableImages(e,r),this.isSpriteLoaded[e][r],void 0,this.brightness)),n[e][r][t][i]}rasterizeImages(e,t,i){const r=new Map;for(const[i,{image:n,imageVariant:o}]of t.tasks.entries()){const s=this.imageRasterizer.rasterize(o,n,t.scope,e);r.set(i,s)}i(void 0,r)}removeRasterizedImages(e,t,i){this.imageRasterizer.removeImagesFromCacheByIds(t.imageIds,t.scope,e),i()}enforceCacheSizeLimit(t,i){e.en(i)}getWorkerPerformanceMetrics(e,t,i){i(void 0,void 0)}}return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope&&(self.worker=new be(self)),be})),r(["./shared"],(function(e){var t="3.11.1";const i={create:"create",load:"load",fullLoad:"fullLoad"},r={mark(e){performance.mark(e)},measure(e,t,i){performance.measure(e,t,i)}};function n(t){const i=t.name.split("?")[0];return e.a(i)&&i.includes("mapbox-gl.js")?"javascript":e.a(i)&&i.includes("mapbox-gl.css")?"css":e.b(i)?"fontRange":e.c(i)?"sprite":e.i(i)?"style":e.d(i)?"tilejson":"other"}var o,s={},a=function(){if(o)return s;function e(e){return!t(e)}function t(t){return"undefined"==typeof window||"undefined"==typeof document?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var e,t,i=new Blob([""],{type:"text/javascript"}),r=URL.createObjectURL(i);try{t=new Worker(r),e=!0}catch(t){e=!1}return t&&t.terminate(),URL.revokeObjectURL(r),e}()?function(){var e=document.createElement("canvas");e.width=e.height=1;var t=e.getContext("2d");if(!t)return!1;var i=t.getImageData(0,0,1,1);return i&&i.width===e.width}()?(void 0===i[r=t&&t.failIfMajorPerformanceCaveat]&&(i[r]=function(t){var i,r=function(t){var i=document.createElement("canvas"),r=Object.create(e.webGLContextAttributes);return r.failIfMajorPerformanceCaveat=t,i.getContext("webgl2",r)}(t);if(!r)return!1;try{i=r.createShader(r.VERTEX_SHADER)}catch(e){return!1}return!(!i||r.isContextLost())&&(r.shaderSource(i,"void main() {}"),r.compileShader(i),!0===r.getShaderParameter(i,r.COMPILE_STATUS))}(r)),i[r]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var r}o=1,s.supported=e,s.notSupportedReason=t;var i={};return e.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},s}();function l(e,t,i){const r=document.createElement(e);return null!=t&&(r.className=t),i&&i.appendChild(r),r}function c(e,t,i){const r=document.createElementNS("http://www.w3.org/2000/svg",e);for(const e of Object.keys(t))r.setAttributeNS(null,e,String(t[e]));return i&&i.appendChild(r),r}const u="undefined"!=typeof document?document.documentElement&&document.documentElement.style:null,h=u&&void 0!==u.userSelect?"userSelect":"WebkitUserSelect";let d;function p(){u&&h&&(d=u[h],u[h]="none")}function f(){u&&h&&(u[h]=d)}function A(e){e.preventDefault(),e.stopPropagation(),window.removeEventListener("click",A,!0)}function m(){window.addEventListener("click",A,!0),window.setTimeout((()=>{window.removeEventListener("click",A,!0)}),0)}function g(e,t){const i=e.getBoundingClientRect();return v(e,i,t)}function _(e,t){const i=e.getBoundingClientRect(),r=[];for(let n=0;n<t.length;n++)r.push(v(e,i,t[n]));return r}function y(e){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&2===e.button&&e.ctrlKey?0:e.button}function v(t,i,r){const n=t.offsetWidth===i.width?1:t.offsetWidth/i.width;return new e.P((r.clientX-i.left)*n,(r.clientY-i.top)*n)}const x="01",b="NO_ACCESS_TOKEN";class w{constructor(e,t,i){this._transformRequestFn=e,this._customAccessToken=t,this._silenceAuthErrors=!!i,this._createSkuToken()}_createSkuToken(){const e=function(){let e="";for(let t=0;t<10;t++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",x,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=e.token,this._skuTokenExpiresAt=e.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(e,t){return this._transformRequestFn&&this._transformRequestFn(e,t)||{url:e}}normalizeStyleURL(i,r){if(!e.f(i))return i;const n=B(i);return n.params.push(`sdk=js-${t}`),n.path=`/styles/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||r)}normalizeGlyphsURL(t,i){if(!e.f(t))return t;const r=B(t);return r.path=`/fonts/v1${r.path}`,this._makeAPIURL(r,this._customAccessToken||i)}normalizeModelURL(t,i){if(!e.f(t))return t;const r=B(t);return r.path=`/models/v1${r.path}`,this._makeAPIURL(r,this._customAccessToken||i)}normalizeSourceURL(t,i,r,n){if(!e.f(t))return t;const o=B(t);return o.path=`/v4/${o.authority}.json`,o.params.push("secure"),r&&o.params.push(`language=${r}`),n&&o.params.push(`worldview=${n}`),this._makeAPIURL(o,this._customAccessToken||i)}normalizeIconsetURL(t,i){const r=B(t);return e.f(t)?(r.path=`/styles/v1${r.path}/iconset.pbf`,this._makeAPIURL(r,this._customAccessToken||i)):C(r)}normalizeSpriteURL(t,i,r,n){const o=B(t);return e.f(t)?(o.path=`/styles/v1${o.path}/sprite${i}${r}`,this._makeAPIURL(o,this._customAccessToken||n)):(o.path+=`${i}${r}`,C(o))}normalizeTileURL(t,i,r){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!e.f(t))return t;const n=B(t);n.path=n.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${i||r&&"raster"!==n.authority&&512===r?"@2x":""}${e.m.supported?".webp":"$1"}`),"raster"===n.authority?n.path=`/${e.e.RASTER_URL_PREFIX}${n.path}`:"rasterarrays"===n.authority?n.path=`/${e.e.RASTERARRAYS_URL_PREFIX}${n.path}`:"3dtiles"===n.authority?n.path=`/${e.e.TILES3D_URL_PREFIX}${n.path}`:(n.path=n.path.replace(/^.+\/v4\//,"/"),n.path=`/${e.e.TILE_URL_VERSION}${n.path}`);const o=this._customAccessToken||function(e){for(const t of e){const e=t.match(/^access_token=(.*)$/);if(e)return e[1]}return null}(n.params)||e.e.ACCESS_TOKEN;return e.e.REQUIRE_ACCESS_TOKEN&&o&&this._skuToken&&n.params.push(`sku=${this._skuToken}`),this._makeAPIURL(n,o)}canonicalizeTileURL(t,i){const r=B(t);if(!r.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!r.path.match(/\.[\w]+$/))return t;let n="mapbox://";r.path.match(/^\/raster\/v1\//)?n+=`raster/${r.path.replace(`/${e.e.RASTER_URL_PREFIX}/`,"")}`:r.path.match(/^\/rasterarrays\/v1\//)?n+=`rasterarrays/${r.path.replace(`/${e.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:n+=`tiles/${r.path.replace(`/${e.e.TILE_URL_VERSION}/`,"")}`;let o=r.params;return i&&(o=o.filter((e=>!e.match(/^access_token=/)))),o.length&&(n+=`?${o.join("&")}`),n}canonicalizeTileset(t,i){const r=!!i&&e.f(i),n=[];for(const i of t.tiles||[])e.h(i)?n.push(this.canonicalizeTileURL(i,r)):n.push(i);return n}_makeAPIURL(t,i){const r="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",n=B(e.e.API_URL);if(t.protocol=n.protocol,t.authority=n.authority,"http"===t.protocol){const e=t.params.indexOf("secure");e>=0&&t.params.splice(e,1)}if("/"!==n.path&&(t.path=`${n.path}${t.path}`),!e.e.REQUIRE_ACCESS_TOKEN)return C(t);if(i=i||e.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!i)throw new Error(`An API access token is required to use Mapbox GL. ${r}`);if("s"===i[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${r}`)}return t.params=t.params.filter((e=>-1===e.indexOf("access_token"))),t.params.push(`access_token=${i||""}`),C(t)}}const T=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function B(e){const t=e.match(T);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function C(e){const t=e.params.length?`?${e.params.join("&")}`:"";return`${e.protocol}://${e.authority}${e.path}${t}`}const S="mapbox.eventData";function E(t){if(!t)return null;const i=t.split(".");if(!i||3!==i.length)return null;try{return JSON.parse(e.j(i[1]))}catch(e){return null}}class M{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(t){const i=E(e.e.ACCESS_TOKEN);let r="";return r=i&&i.u?e.k(i.u):e.e.ACCESS_TOKEN||"",t?`${S}.${t}:${r}`:`${S}:${r}`}fetchEventData(){const t=e.s("localStorage"),i=this.getStorageKey(),r=this.getStorageKey("uuid");if(t)try{const e=localStorage.getItem(i);e&&(this.eventData=JSON.parse(e));const t=localStorage.getItem(r);t&&(this.anonId=t)}catch(t){e.w("Unable to read from LocalStorage")}}saveEventData(){const t=e.s("localStorage"),i=this.getStorageKey(),r=this.getStorageKey("uuid"),n=this.anonId;if(t&&n)try{localStorage.setItem(r,n),Object.keys(this.eventData).length>=1&&localStorage.setItem(i,JSON.stringify(this.eventData))}catch(t){e.w("Unable to write to LocalStorage")}}processRequests(e){}postEvent(t,i,r,n){if(!e.e.EVENTS_URL)return;const o=B(e.e.EVENTS_URL);o.params.push(`access_token=${n||e.e.ACCESS_TOKEN||""}`);const s={event:this.type,created:new Date(t).toISOString()},a=i?e.l(s,i):s,l={url:C(o),headers:{"Content-Type":"text/plain"},body:JSON.stringify([a])};this.pendingRequest=e.p(l,(e=>{this.pendingRequest=null,r(e),this.saveEventData(),this.processRequests(n)}))}queueRequest(e,t){this.queue.push(e),this.processRequests(t)}}const I=new class extends M{constructor(e){super("appUserTurnstile"),this._customAccessToken=e}postTurnstileEvent(t,i){e.e.EVENTS_URL&&e.e.ACCESS_TOKEN&&Array.isArray(t)&&t.some((t=>e.f(t)||e.h(t)))&&this.queueRequest(Date.now(),i)}processRequests(i){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const r=E(e.e.ACCESS_TOKEN),n=r?r.u:e.e.ACCESS_TOKEN;let o=n!==this.eventData.tokenU;e.v(this.anonId)||(this.anonId=e.u(),o=!0);const s=this.queue.shift();if(this.eventData.lastSuccess){const e=new Date(this.eventData.lastSuccess),t=new Date(s),i=(s-this.eventData.lastSuccess)/864e5;o=o||i>=1||i<-1||e.getDate()!==t.getDate()}else o=!0;o?this.postEvent(s,{sdkIdentifier:"mapbox-gl-js",sdkVersion:t,skuId:x,"enabled.telemetry":!1,userId:this.anonId},(e=>{e||(this.eventData.lastSuccess=s,this.eventData.tokenU=n)}),i):this.processRequests()}},P=I.postTurnstileEvent.bind(I),L=new class extends M{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(t,i,r,n){this.skuToken=i,this.errorCb=n,e.e.EVENTS_URL&&(r||e.e.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},r):this.errorCb(new Error(b)))}processRequests(i){if(this.pendingRequest||0===this.queue.length)return;const{id:r,timestamp:n}=this.queue.shift();r&&this.success[r]||(this.anonId||this.fetchEventData(),e.v(this.anonId)||(this.anonId=e.u()),this.postEvent(n,{sdkIdentifier:"mapbox-gl-js",sdkVersion:t,skuId:x,skuToken:this.skuToken,userId:this.anonId},(e=>{e?this.errorCb(e):r&&(this.success[r]=!0)}),i))}remove(){this.errorCb=null}},F=L.postMapLoadEvent.bind(L),k=new class extends M{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(t){let i=this.mapInstanceIdMap.get(t);return i||(i=e.u(),this.mapInstanceIdMap.set(t,i)),i}getEventId(e){const t=this.eventIdPerMapInstanceMap.get(e)||0;return this.eventIdPerMapInstanceMap.set(e,t+1),t}postStyleLoadEvent(t,i){const{map:r,style:n,importedStyles:o}=i;if(!e.e.EVENTS_URL||!t&&!e.e.ACCESS_TOKEN)return;const s=this.getMapInstanceId(r),a={mapInstanceId:s,eventId:this.getEventId(s),style:n};o.length&&(a.importedStyles=o),this.queueRequest({timestamp:Date.now(),payload:a},t)}processRequests(e){if(this.pendingRequest||0===this.queue.length)return;const{timestamp:t,payload:i}=this.queue.shift();this.postEvent(t,i,(()=>{}),e)}},z=k.postStyleLoadEvent.bind(k),R=new class extends M{constructor(){super("gljs.performance")}postPerformanceEvent(t,i){e.e.EVENTS_URL&&(t||e.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:i},t)}processRequests(r){if(this.pendingRequest||0===this.queue.length)return;const{timestamp:o,performanceData:s}=this.queue.shift(),a=function(r){const o=performance.getEntriesByType("resource"),s=performance.getEntriesByType("mark"),a=function(e){const t={};if(e)for(const i in e)if("other"!==i)for(const r of e[i]){const e=`${i}ResolveRangeMin`,n=`${i}ResolveRangeMax`,o=`${i}RequestCount`,s=`${i}RequestCachedCount`;t[e]=Math.min(t[e]||1/0,r.startTime),t[n]=Math.max(t[n]||-1/0,r.responseEnd);const a=e=>{void 0===t[e]&&(t[e]=0),++t[e]};void 0!==r.transferSize&&0===r.transferSize&&a(s),a(o)}return t}(function(e,t){const i={};if(e)for(const r of e){const e=t(r);void 0===i[e]&&(i[e]=[]),i[e].push(r)}return i}(o,n)),l=window.devicePixelRatio,c=navigator.connection||navigator.mozConnection||navigator.webkitConnection,u=c?c.effectiveType:void 0,h={counters:[],metadata:[],attributes:[]},d=(e,t,i)=>{null!=i&&e.push({name:t,value:i.toString()})};for(const e in a)d(h.counters,e,a[e]);if(r.interactionRange[0]!==1/0&&r.interactionRange[1]!==-1/0&&(d(h.counters,"interactionRangeMin",r.interactionRange[0]),d(h.counters,"interactionRangeMax",r.interactionRange[1])),s)for(const e of Object.keys(i)){const t=i[e],r=s.find((e=>e.name===t));r&&d(h.counters,t,r.startTime)}return d(h.counters,"visibilityHidden",r.visibilityHidden),d(h.attributes,"style",function(t){if(t)for(const i of t){const t=i.name.split("?")[0];if(e.i(t)){const e=t.split("/").slice(-2);if(2===e.length)return`mapbox://styles/${e[0]}/${e[1]}`}}}(o)),d(h.attributes,"terrainEnabled",r.terrainEnabled?"true":"false"),d(h.attributes,"fogEnabled",r.fogEnabled?"true":"false"),d(h.attributes,"projection",r.projection),d(h.attributes,"zoom",r.zoom),d(h.metadata,"devicePixelRatio",l),d(h.metadata,"connectionEffectiveType",u),d(h.metadata,"navigatorUserAgent",navigator.userAgent),d(h.metadata,"screenWidth",window.screen.width),d(h.metadata,"screenHeight",window.screen.height),d(h.metadata,"windowWidth",window.innerWidth),d(h.metadata,"windowHeight",window.innerHeight),d(h.metadata,"mapWidth",r.width/l),d(h.metadata,"mapHeight",r.height/l),d(h.metadata,"webglRenderer",r.renderer),d(h.metadata,"webglVendor",r.vendor),d(h.metadata,"sdkVersion",t),d(h.metadata,"sdkIdentifier","mapbox-gl-js"),h}(s);for(const e of a.metadata);for(const e of a.counters);for(const e of a.attributes);this.postEvent(o,a,(()=>{}),r)}},D=R.postPerformanceEvent.bind(R),O=new class extends M{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(t,i,r,n){if(!e.e.API_URL||!e.e.SESSION_PATH)return;const o=B(e.e.API_URL+e.e.SESSION_PATH);o.params.push(`sku=${i||""}`),o.params.push(`access_token=${n||e.e.ACCESS_TOKEN||""}`);const s={url:C(o),headers:{"Content-Type":"text/plain"}};this.pendingRequest=e.g(s,(e=>{this.pendingRequest=null,r(e),this.saveEventData(),this.processRequests(n)}))}getSessionAPI(t,i,r,n){this.skuToken=i,this.errorCb=n,e.e.SESSION_PATH&&e.e.API_URL&&(r||e.e.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},r):this.errorCb(new Error(b)))}processRequests(e){if(this.pendingRequest||0===this.queue.length)return;const{id:t,timestamp:i}=this.queue.shift();t&&this.success[t]||this.getSession(i,this.skuToken,(e=>{e?this.errorCb(e):t&&(this.success[t]=!0)}),e)}remove(){this.errorCb=null}},U=O.getSessionAPI.bind(O),N=new Set;function Q(e,t){t?N.add(e):N.delete(e)}class j{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages={}}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(e,t){this._updatedSourceCaches[e]=t,this.setDirty()}discardSourceCacheUpdate(e){delete this._updatedSourceCaches[e]}updateLayer(e){const t=e.scope;this._updatedLayers[t]=this._updatedLayers[t]||new Set,this._updatedLayers[t].add(e.id),this.setDirty()}removeLayer(e){const t=e.scope;this._removedLayers[t]=this._removedLayers[t]||{},this._updatedLayers[t]=this._updatedLayers[t]||new Set,this._removedLayers[t][e.id]=e,this._updatedLayers[t].delete(e.id),this._updatedPaintProps.delete(e.fqid),this.setDirty()}getRemovedLayer(e){return this._removedLayers[e.scope]?this._removedLayers[e.scope][e.id]:null}discardLayerRemoval(e){this._removedLayers[e.scope]&&delete this._removedLayers[e.scope][e.id]}getLayerUpdatesByScope(){const e={};for(const t in this._updatedLayers)e[t]=e[t]||{},e[t].updatedIds=Array.from(this._updatedLayers[t].values());for(const t in this._removedLayers)e[t]=e[t]||{},e[t].removedIds=Object.keys(this._removedLayers[t]);return e}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(e){this._updatedPaintProps.add(e.fqid),this.setDirty()}getUpdatedImages(e){return this._updatedImages[e]?Array.from(this._updatedImages[e].values()):[]}updateImage(t,i){this._updatedImages[i]=this._updatedImages[i]||new Set,this._updatedImages[i].add(e.I.toString(t)),this.setDirty()}resetUpdatedImages(e){this._updatedImages[e]&&this._updatedImages[e].clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages={}}}function V(e){const{userImage:t}=e;return!!(t&&t.render&&t.render())&&(e.data.replace(new Uint8Array(t.data.buffer)),!0)}class H extends e.E{constructor(t){super(),this.imageProviders=new Map,this.images=new Map,this.updatedImages=new Map,this.callbackDispatchedThisFrame=new Map,this.loaded=new Map,this.requestors=[],this.patterns=new Map,this.patternsInFlight=new Set,this.atlasImage=new Map,this.atlasTexture=new Map,this.dirty=!0,this.spriteFormat=t,"raster"!==t&&e.t()&&(this.imageRasterizerDispatcher=new e.D(e.x(),this,"Image Rasterizer Worker",1))}addScope(t){this.loaded.set(t,!1),this.imageProviders.set(t,new Map),this.images.set(t,new Map),this.updatedImages.set(t,new Set),this.callbackDispatchedThisFrame.set(t,new Set),this.patterns.set(t,new Map),this.atlasImage.set(t,new e.r({width:1,height:1}))}removeScope(e){this.loaded.delete(e),this.imageProviders.delete(e),this.images.delete(e),this.updatedImages.delete(e),this.callbackDispatchedThisFrame.delete(e),this.patterns.delete(e),this.atlasImage.delete(e);const t=this.atlasTexture.get(e);t&&(t.destroy(),this.atlasTexture.delete(e))}addImageProvider(e,t){this.imageProviders.has(t)||this.imageProviders.set(t,new Map),this.imageProviders.get(t).set(e.id,e)}removeImageProvider(e,t){this.imageProviders.has(t)&&this.imageProviders.get(t).delete(e)}getPendingImageProviders(){const e=[];for(const t of this.imageProviders.values())for(const i of t.values())i.hasPendingRequests()&&e.push(i);return e}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new e.y),this._imageRasterizer}isLoaded(){for(const e of this.loaded.keys())if(!this.loaded.get(e))return!1;return!0}setLoaded(e,t){if(this.loaded.get(t)!==e&&(this.loaded.set(t,e),e)){for(const{ids:e,callback:i}of this.requestors)this._notify(e,t,i);this.requestors=[]}}hasImage(e,t){return!!this.getImage(e,t)}getImage(e,t){return this.images.get(t).get(e.toString())}addImage(e,t,i){this._validate(e,i)&&this.images.get(t).set(e.toString(),i)}_validate(t,i){let r=!0;return this._validateStretch(i.stretchX,i.data&&i.data.width)||(this.fire(new e.z(new Error(`Image "${t.name}" has invalid "stretchX" value`))),r=!1),this._validateStretch(i.stretchY,i.data&&i.data.height)||(this.fire(new e.z(new Error(`Image "${t.name}" has invalid "stretchY" value`))),r=!1),this._validateContent(i.content,i)||(this.fire(new e.z(new Error(`Image "${t.name}" has invalid "content" value`))),r=!1),r}_validateStretch(e,t){if(!e)return!0;let i=0;for(const r of e){if(r[0]<i||r[1]<r[0]||t<r[1])return!1;i=r[1]}return!0}_validateContent(e,t){if(!e)return!0;if(4!==e.length)return!1;if(!t.usvg){if(e[0]<0||t.data.width<e[0])return!1;if(e[1]<0||t.data.height<e[1])return!1;if(e[2]<0||t.data.width<e[2])return!1;if(e[3]<0||t.data.height<e[3])return!1}return!(e[2]<e[0]||e[3]<e[1])}updateImage(e,t,i){const r=this.images.get(t).get(e.toString());i.version=r.version+1,this.images.get(t).set(e.toString(),i),this.updatedImages.get(t).add(e),this.removeFromImageRasterizerCache(e,t)}clearUpdatedImages(e){this.updatedImages.get(e).clear()}removeFromImageRasterizerCache(t,i){if("raster"!==this.spriteFormat)if(e.t()){const e={imageIds:[t],scope:i};this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",e)}else this.imageRasterizer.removeImagesFromCacheByIds([t],i)}removeImage(e,t){const i=this.images.get(t),r=i.get(e.toString());i.delete(e.toString()),this.patterns.get(t).delete(e.toString()),this.removeFromImageRasterizerCache(e,t),r.userImage&&r.userImage.onRemove&&r.userImage.onRemove()}listImages(t){return Array.from(this.images.get(t).keys()).map((t=>e.I.from(t)))}getImages(e,t,i){const r=[],n=[],o=this.imageProviders.get(t);for(const i of e){if(!i.iconsetId){r.push(i);continue}const e=o.get(i.iconsetId);e&&(this.getImage(i,t)?n.push(i):e.addPendingRequest(i))}if(0===r.length)return void this._notify(n,t,i);let s=!0;const a=!!this.loaded.get(t),l=this.images.get(t);if(!a)for(const e of r)l.has(e.toString())||(s=!1);a||s?this._notify(r,t,i):this.requestors.push({ids:r,scope:t,callback:i})}rasterizeImages({scope:e,tasks:t},i){const r=new Map;for(const[i,n]of t.entries()){const t=this.getImage(n.id,e);t&&r.set(i,{image:t,imageVariant:n})}this._rasterizeImages(e,r,i)}_rasterizeImages(t,i,r){if(e.t())this.imageRasterizerDispatcher.getActor().send("rasterizeImages",{tasks:i,scope:t},r);else{const e=new Map;for(const[r,{image:n,imageVariant:o}]of i.entries())e.set(r,this.imageRasterizer.rasterize(o,n,t,0));r(void 0,e)}}getUpdatedImages(e){return this.updatedImages.get(e)||new Set}_notify(t,i,r){const n=this.images.get(i),o=new Map;for(const i of t){const t=n.get(i.toString());if(!t){if(i.iconsetId)continue;e.w(`Image "${i.name}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`),this.fire(new e.A("styleimagemissing",{id:i.name}));continue}const r={data:t.usvg?null:t.data.clone(),pixelRatio:t.pixelRatio,sdf:t.sdf,usvg:t.usvg,version:t.version,stretchX:t.stretchX,stretchY:t.stretchY,content:t.content,hasRenderCallback:Boolean(t.userImage&&t.userImage.render)};t.usvg&&Object.assign(r,{width:t.icon.usvg_tree.width,height:t.icon.usvg_tree.height}),o.set(e.I.toString(i),r)}r(null,o)}getPixelSize(e){const{width:t,height:i}=this.atlasImage.get(e);return{width:t,height:i}}getPattern(t,i,r){const n=t.toString(),o=this.patterns.get(i),s=o.get(n),a=this.getImage(t,i);if(!a)return null;if(s){if(s.position.version===a.version)return s.position;s.position.version=a.version}else{if(a.usvg&&!a.data){const o=this.getPatternInFlightId(n,i);if(this.patternsInFlight.has(o))return null;this.patternsInFlight.add(o);const s=new e.B(t).scaleSelf(e.q.devicePixelRatio),l=new Map([[s.toString(),{image:a,imageVariant:s}]]);return this._rasterizeImages(i,l,((e,t)=>this.storePatternImage(s,i,a,r,t))),null}this.storePattern(t,i,a)}return this._updatePatternAtlas(i,r),o.get(n).position}getPatternInFlightId(t,i){return e.C(t,i)}hasPatternsInFlight(){return 0!==this.patternsInFlight.size}storePatternImage(e,t,i,r,n){const o=e.toString(),s=n?n.get(o):void 0;s&&(i.data=s,this.storePattern(e.id,t,i),this._updatePatternAtlas(t,r),this.patternsInFlight.delete(this.getPatternInFlightId(e.id.toString(),t)))}storePattern(t,i,r){const n={w:r.data.width+2*e.F,h:r.data.height+2*e.F,x:0,y:0},o=new e.G(n,r,e.F);this.patterns.get(i).set(t.toString(),{bin:n,position:o})}bind(t,i){const r=t.gl;let n=this.atlasTexture.get(i);n?this.dirty&&(n.update(this.atlasImage.get(i)),this.dirty=!1):(n=new e.T(t,this.atlasImage.get(i),r.RGBA8),this.atlasTexture.set(i,n)),n.bind(r.LINEAR,r.CLAMP_TO_EDGE)}_updatePatternAtlas(t,i){const r=this.patterns.get(t),n=Array.from(r.values()).map((({bin:e})=>e)),{w:o,h:s}=e.H(n),a=this.atlasImage.get(t);a.resize({width:o||1,height:s||1});const l=this.images.get(t);for(const[t,{bin:n,position:o}]of r.entries()){let r=o.padding;const s=n.x+r,c=n.y+r,u=l.get(t).data,h=u.width,d=u.height;r=r>1?r-1:r,e.r.copy(u,a,{x:0,y:0},{x:s,y:c},{width:h,height:d},i),e.r.copy(u,a,{x:0,y:d-r},{x:s,y:c-r},{width:h,height:r},i),e.r.copy(u,a,{x:0,y:0},{x:s,y:c+d},{width:h,height:r},i),e.r.copy(u,a,{x:h-r,y:0},{x:s-r,y:c},{width:r,height:d},i),e.r.copy(u,a,{x:0,y:0},{x:s+h,y:c},{width:r,height:d},i),e.r.copy(u,a,{x:h-r,y:d-r},{x:s-r,y:c-r},{width:r,height:r},i),e.r.copy(u,a,{x:0,y:d-r},{x:s+h,y:c-r},{width:r,height:r},i),e.r.copy(u,a,{x:0,y:0},{x:s+h,y:c+d},{width:r,height:r},i),e.r.copy(u,a,{x:h-r,y:0},{x:s-r,y:c+d},{width:r,height:r},i)}this.dirty=!0}beginFrame(){for(const e of this.images.keys())this.callbackDispatchedThisFrame.set(e,new Set)}dispatchRenderCallbacks(e,t){const i=this.images.get(t);for(const r of e){if(this.callbackDispatchedThisFrame.get(t).has(r.toString()))continue;this.callbackDispatchedThisFrame.get(t).add(r.toString());const e=i.get(r.toString());V(e)&&this.updateImage(r,t,e)}}}function G(t){const i=t.key,r=t.value,n=t.valueSpec||{},o=t.objectElementValidators||{},s=t.style,a=t.styleSpec;let l=[];const c=e.K(r);if("object"!==c)return[new e.V(i,r,`object expected, ${c} found`)];for(const t in r){const c=t.split(".")[0];let u;o[c]?u=o[c]:n[c]?u=pe:o["*"]?u=o["*"]:n["*"]&&(u=pe),u?l=l.concat(u({key:(i?`${i}.`:i)+t,value:r[t],valueSpec:n[c]||n["*"],style:s,styleSpec:a,object:r,objectKey:t},r)):l.push(new e.J(i,r[t],`unknown property "${t}"`))}for(const t in n)o[t]||n[t].required&&void 0===n[t].default&&void 0===r[t]&&l.push(new e.V(i,r,`missing required property "${t}"`));return l}function $(t){const i=t.value,r=t.valueSpec,n=t.style,o=t.styleSpec,s=t.key,a=t.arrayElementValidator||pe;if("array"!==e.K(i))return[new e.V(s,i,`array expected, ${e.K(i)} found`)];if(r.length&&i.length!==r.length)return[new e.V(s,i,`array length ${r.length} expected, length ${i.length} found`)];if(r["min-length"]&&i.length<r["min-length"])return[new e.V(s,i,`array length at least ${r["min-length"]} expected, length ${i.length} found`)];let l={type:r.value,values:r.values,minimum:r.minimum,maximum:r.maximum,function:void 0};o.$version<7&&(l.function=r.function),"object"===e.K(r.value)&&(l=r.value);let c=[];for(let e=0;e<i.length;e++)c=c.concat(a({array:i,arrayIndex:e,value:i[e],valueSpec:l,style:n,styleSpec:o,key:`${s}[${e}]`},!0));return c}function Z(t){const i=t.key,r=t.value,n=t.valueSpec;let o=e.K(r);if("number"===o&&r!=r&&(o="NaN"),"number"!==o)return[new e.V(i,r,`number expected, ${o} found`)];if("minimum"in n){let o=n.minimum;if("array"===e.K(n.minimum)&&(o=n.minimum[t.arrayIndex]),r<o)return[new e.V(i,r,`${r} is less than the minimum value ${o}`)]}if("maximum"in n){let o=n.maximum;if("array"===e.K(n.maximum)&&(o=n.maximum[t.arrayIndex]),r>o)return[new e.V(i,r,`${r} is greater than the maximum value ${o}`)]}return[]}function q(t){const i=t.valueSpec,r=e.M(t.value.type);let n,o,s,a={};const l="categorical"!==r&&void 0===t.value.property,c=!l,u="array"===e.K(t.value.stops)&&"array"===e.K(t.value.stops[0])&&"object"===e.K(t.value.stops[0][0]),h=G({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(t){if("identity"===r)return[new e.V(t.key,t.value,'identity function may not have a "stops" property')];let i=[];const n=t.value;return i=i.concat($({key:t.key,value:n,valueSpec:t.valueSpec,style:t.style,styleSpec:t.styleSpec,arrayElementValidator:d})),"array"===e.K(n)&&0===n.length&&i.push(new e.V(t.key,n,"array must have at least one stop")),i},default:function(e){return pe({key:e.key,value:e.value,valueSpec:i,style:e.style,styleSpec:e.styleSpec})}}});return"identity"===r&&l&&h.push(new e.V(t.key,t.value,'missing required property "property"')),"identity"===r||t.value.stops||h.push(new e.V(t.key,t.value,'missing required property "stops"')),"exponential"===r&&t.valueSpec.expression&&!e.N(t.valueSpec)&&h.push(new e.V(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(c&&!e.O(t.valueSpec)?h.push(new e.V(t.key,t.value,"property functions not supported")):l&&!e.Q(t.valueSpec)&&h.push(new e.V(t.key,t.value,"zoom functions not supported"))),"categorical"!==r&&!u||void 0!==t.value.property||h.push(new e.V(t.key,t.value,'"property" property is required')),h;function d(t){let r=[];const n=t.value,l=t.key;if("array"!==e.K(n))return[new e.V(l,n,`array expected, ${e.K(n)} found`)];if(2!==n.length)return[new e.V(l,n,`array length 2 expected, length ${n.length} found`)];if(u){if("object"!==e.K(n[0]))return[new e.V(l,n,`object expected, ${e.K(n[0])} found`)];if(void 0===n[0].zoom)return[new e.V(l,n,"object stop key must have zoom")];if(void 0===n[0].value)return[new e.V(l,n,"object stop key must have value")];const i=e.M(n[0].zoom);if("number"!=typeof i)return[new e.V(l,n[0].zoom,"stop zoom values must be numbers")];if(s&&s>i)return[new e.V(l,n[0].zoom,"stop zoom values must appear in ascending order")];i!==s&&(s=i,o=void 0,a={}),r=r.concat(G({key:`${l}[0]`,value:n[0],valueSpec:{zoom:{}},style:t.style,styleSpec:t.styleSpec,objectElementValidators:{zoom:Z,value:p}}))}else r=r.concat(p({key:`${l}[0]`,value:n[0],valueSpec:{},style:t.style,styleSpec:t.styleSpec},n));return e.S(e.U(n[1]))?r.concat([new e.V(`${l}[1]`,n[1],"expressions are not allowed in function stops.")]):r.concat(pe({key:`${l}[1]`,value:n[1],valueSpec:i,style:t.style,styleSpec:t.styleSpec}))}function p(t,s){const l=e.K(t.value),c=e.M(t.value),u=null!==t.value?t.value:s;if(n){if(l!==n)return[new e.V(t.key,u,`${l} stop domain type must match previous stop domain type ${n}`)]}else n=l;if("number"!==l&&"string"!==l&&"boolean"!==l&&"number"!=typeof c&&"string"!=typeof c&&"boolean"!=typeof c)return[new e.V(t.key,u,"stop domain value must be a number, string, or boolean")];if("number"!==l&&"categorical"!==r){let n=`number expected, ${l} found`;return e.O(i)&&void 0===r&&(n+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new e.V(t.key,u,n)]}return"categorical"!==r||"number"!==l||"number"==typeof c&&isFinite(c)&&Math.floor(c)===c?"categorical"!==r&&"number"===l&&"number"==typeof c&&"number"==typeof o&&void 0!==o&&c<o?[new e.V(t.key,u,"stop domain values must appear in ascending order")]:(o=c,"categorical"===r&&c in a?[new e.V(t.key,u,"stop domain values must be unique")]:(a[c]=!0,[])):[new e.V(t.key,u,`integer expected, found ${String(c)}`)]}}function K(t){const i=("property"===t.expressionContext?e.W:e.X)(e.U(t.value),t.valueSpec);if("error"===i.result)return i.value.map((i=>new e.V(`${t.key}${i.key}`,t.value,i.message)));const r=i.value.expression||i.value._styleExpression.expression;if("property"===t.expressionContext&&"text-font"===t.propertyKey&&!r.outputDefined())return[new e.V(t.key,t.value,`Invalid data expression for "${t.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===t.expressionContext&&"layout"===t.propertyType&&!e.Y(r))return[new e.V(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===t.expressionContext)return W(r,t);if(t.expressionContext&&0===t.expressionContext.indexOf("cluster")){if(!e.Z(r,["zoom","feature-state"]))return[new e.V(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===t.expressionContext&&!e._(r))return[new e.V(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function W(t,i){const r=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(i.valueSpec&&i.valueSpec.expression)for(const e of i.valueSpec.expression.parameters)r.delete(e);if(0===r.size)return[];const n=[];return t instanceof e.$&&r.has(t.name)?[new e.V(i.key,i.value,`["${t.name}"] expression is not supported in a filter for a ${i.object.type} layer with id: ${i.object.id}`)]:(t.eachChild((e=>{n.push(...W(e,i))})),n)}function X(t){const i=t.key,r=t.value,n=t.valueSpec,o=[];return Array.isArray(n.values)?-1===n.values.indexOf(e.M(r))&&o.push(new e.V(i,r,`expected one of [${n.values.join(", ")}], ${JSON.stringify(r)} found`)):-1===Object.keys(n.values).indexOf(e.M(r))&&o.push(new e.V(i,r,`expected one of [${Object.keys(n.values).join(", ")}], ${JSON.stringify(r)} found`)),o}function Y(t){return e.a1(e.U(t.value))?K(e.L({},t,{expressionContext:"filter",valueSpec:t.styleSpec[`filter_${t.layerType||"fill"}`]})):J(t)}function J(t){const i=t.value,r=t.key;if("array"!==e.K(i))return[new e.V(r,i,`array expected, ${e.K(i)} found`)];const n=t.styleSpec;let o,s=[];if(i.length<1)return[new e.V(r,i,"filter array must have at least 1 element")];switch(s=s.concat(X({key:`${r}[0]`,value:i[0],valueSpec:n.filter_operator,style:t.style,styleSpec:t.styleSpec})),e.M(i[0])){case"<":case"<=":case">":case">=":i.length>=2&&"$type"===e.M(i[1])&&s.push(new e.V(r,i,`"$type" cannot be use with operator "${i[0]}"`));case"==":case"!=":3!==i.length&&s.push(new e.V(r,i,`filter array for operator "${i[0]}" must have 3 elements`));case"in":case"!in":i.length>=2&&(o=e.K(i[1]),"string"!==o&&s.push(new e.V(`${r}[1]`,i[1],`string expected, ${o} found`)));for(let a=2;a<i.length;a++)o=e.K(i[a]),"$type"===e.M(i[1])?s=s.concat(X({key:`${r}[${a}]`,value:i[a],valueSpec:n.geometry_type,style:t.style,styleSpec:t.styleSpec})):"string"!==o&&"number"!==o&&"boolean"!==o&&s.push(new e.V(`${r}[${a}]`,i[a],`string, number, or boolean expected, ${o} found`));break;case"any":case"all":case"none":for(let e=1;e<i.length;e++)s=s.concat(J({key:`${r}[${e}]`,value:i[e],style:t.style,styleSpec:t.styleSpec}));break;case"has":case"!has":o=e.K(i[1]),2!==i.length?s.push(new e.V(r,i,`filter array for "${i[0]}" operator must have 2 elements`)):"string"!==o&&s.push(new e.V(`${r}[1]`,i[1],`string expected, ${o} found`))}return s}function ee(t,i){const r=t.key,n=t.style,o=t.layer,s=t.styleSpec,a=t.value,l=t.objectKey,c=s[`${i}_${t.layerType}`];if(!c)return[];const u=l.match(/^(.*)-use-theme$/);if("paint"===i&&u&&c[u[1]])return e.S(a)?[].concat(pe({key:t.key,value:a,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:n,styleSpec:s,expressionContext:"property",propertyType:i,propertyKey:l})):pe({key:r,value:a,valueSpec:{type:"string"},style:n,styleSpec:s});const h=l.match(/^(.*)-transition$/);if("paint"===i&&h&&c[h[1]]&&c[h[1]].transition)return pe({key:r,value:a,valueSpec:s.transition,style:n,styleSpec:s});const d=t.valueSpec||c[l];if(!d)return[new e.J(r,a,`unknown property "${l}"`)];let p;if("string"===e.K(a)&&e.O(d)&&!d.tokens&&(p=/^{([^}]+)}$/.exec(a))){const t=`\`{ "type": "identity", "property": ${p?JSON.stringify(p[1]):'"_"'} }\``;return[new e.V(r,a,`"${l}" does not support interpolation syntax\nUse an identity property function instead: ${t}.`)]}const f=[];if("symbol"===t.layerType)"text-field"!==l||!n||n.glyphs||n.imports||f.push(new e.V(r,a,'use of "text-field" requires a style "glyphs" property')),"text-font"===l&&e.a2(e.U(a))&&"identity"===e.M(a.type)&&f.push(new e.V(r,a,'"text-font" does not support identity functions'));else if("model"===t.layerType&&"paint"===i&&o&&o.layout&&o.layout.hasOwnProperty("model-id")&&e.O(d)&&(e.a3(d)||e.Q(d))){const t=e.W(e.U(a),d),i=t.value.expression||t.value._styleExpression.expression;i&&!e.Z(i,["measure-light"])&&("model-emissive-strength"===l&&e._(i)&&e.Y(i)||f.push(new e.V(r,a,`${l} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return f.concat(pe({key:t.key,value:a,valueSpec:d,style:n,styleSpec:s,expressionContext:"property",propertyType:i,propertyKey:l}))}function te(e){return ee(e,"paint")}function ie(e){return ee(e,"layout")}function re(t){let i=[];const r=t.value,n=t.key,o=t.style,s=t.styleSpec;r.type||r.ref||i.push(new e.V(n,r,'either "type" or "ref" is required'));let a=e.M(r.type);const l=e.M(r.ref);if(r.id){const s=e.M(r.id);for(let a=0;a<t.arrayIndex;a++){const t=o.layers[a];e.M(t.id)===s&&i.push(new e.V(n,r.id,`duplicate layer id "${r.id}", previously used at line ${t.id.__line__}`))}}if("ref"in r){let t;["type","source","source-layer","filter","layout"].forEach((t=>{t in r&&i.push(new e.V(n,r[t],`"${t}" is prohibited for ref layers`))})),o.layers.forEach((i=>{e.M(i.id)===l&&(t=i)})),t?t.ref?i.push(new e.V(n,r.ref,"ref cannot reference another ref layer")):a=e.M(t.type):"string"==typeof l&&i.push(new e.V(n,r.ref,`ref layer "${l}" not found`))}else if("background"!==a&&"sky"!==a&&"slot"!==a)if(r.source){const t=o.sources&&o.sources[r.source],s=t&&e.M(t.type);t?"vector"===s&&"raster"===a?i.push(new e.V(n,r.source,`layer "${r.id}" requires a raster source`)):"raster"===s&&"raster"!==a?i.push(new e.V(n,r.source,`layer "${r.id}" requires a vector source`)):"vector"!==s||r["source-layer"]?"raster-dem"===s&&"hillshade"!==a?i.push(new e.V(n,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):"raster-array"!==s||["raster","raster-particle"].includes(a)?"line"!==a||!r.paint||!r.paint["line-gradient"]&&!r.paint["line-trim-offset"]||"geojson"===s&&t.lineMetrics?"raster-particle"===a&&"raster-array"!==s&&i.push(new e.V(n,r.source,`layer "${r.id}" requires a 'raster-array' source.`)):i.push(new e.V(n,r,`layer "${r.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):i.push(new e.V(n,r.source,"raster-array source can only be used with layer type 'raster'.")):i.push(new e.V(n,r,`layer "${r.id}" must specify a "source-layer"`)):i.push(new e.V(n,r.source,`source "${r.source}" not found`))}else i.push(new e.V(n,r,'missing required property "source"'));return i=i.concat(G({key:n,value:r,valueSpec:s.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":()=>[],type:()=>pe({key:`${n}.type`,value:r.type,valueSpec:s.layer.type,style:t.style,styleSpec:t.styleSpec,object:r,objectKey:"type"}),filter:t=>Y(e.L({layerType:a},t)),layout:t=>G({layer:r,key:t.key,value:t.value,valueSpec:{},style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":t=>ie(e.L({layerType:a},t))}}),paint:t=>G({layer:r,key:t.key,value:t.value,valueSpec:{},style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":t=>te(e.L({layerType:a,layer:r},t))}})}})),i}function ne(t){const i=t.value,r=t.key,n=e.K(i);return"string"!==n?[new e.V(r,i,`string expected, ${n} found`)]:[]}const oe={promoteId:function t({key:i,value:r}){if("string"===e.K(r))return ne({key:i,value:r});if(Array.isArray(r)){const t=[],n=e.U(r),o=e.X(n);return"error"===o.result&&o.value.forEach((r=>{t.push(new e.V(`${i}${r.key}`,null,`${r.message}`))})),e.Z(o.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||t.push(new e.V(`${i}`,null,"promoteId expression should be only feature dependent")),t}{const e=[];for(const n in r)e.push(...t({key:`${i}.${n}`,value:r[n]}));return e}}};function se(t){const i=t.value,r=t.key,n=t.styleSpec,o=t.style;if(!i.type)return[new e.V(r,i,'"type" is required')];const s=e.M(i.type);let a=[];switch(["vector","raster","raster-dem","raster-array"].includes(s)&&(i.url||i.tiles||a.push(new e.J(r,i,'Either "url" or "tiles" is required.'))),s){case"vector":case"raster":case"raster-dem":case"raster-array":return a=a.concat(G({key:r,value:i,valueSpec:n[`source_${s.replace("-","_")}`],style:t.style,styleSpec:n,objectElementValidators:oe})),a;case"geojson":if(a=G({key:r,value:i,valueSpec:n.source_geojson,style:o,styleSpec:n,objectElementValidators:oe}),i.cluster)for(const e in i.clusterProperties){const[t,n]=i.clusterProperties[e],o="string"==typeof t?[t,["accumulated"],["get",e]]:t;a.push(...K({key:`${r}.${e}.map`,value:n,expressionContext:"cluster-map"})),a.push(...K({key:`${r}.${e}.reduce`,value:o,expressionContext:"cluster-reduce"}))}return a;case"video":return G({key:r,value:i,valueSpec:n.source_video,style:o,styleSpec:n});case"image":return G({key:r,value:i,valueSpec:n.source_image,style:o,styleSpec:n});case"canvas":return[new e.V(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return X({key:`${r}.type`,value:i.type,valueSpec:{values:ae(n)},style:o,styleSpec:n})}}function ae(e){return e.source.reduce(((t,i)=>{const r=e[i];return"enum"===r.type.type&&(t=t.concat(Object.keys(r.type.values))),t}),[])}function le(t){const i=t.value,r=t.styleSpec,n=r.light,o=t.style;let s=[];const a=e.K(i);if(void 0===i)return s;if("object"!==a)return s=s.concat([new e.V("light",i,`object expected, ${a} found`)]),s;for(const t in i){const a=t.match(/^(.*)-transition$/),l=t.match(/^(.*)-use-theme$/);s=s.concat(l&&n[l[1]]?pe({key:t,value:i[t],valueSpec:{type:"string"},style:o,styleSpec:r}):a&&n[a[1]]&&n[a[1]].transition?pe({key:t,value:i[t],valueSpec:r.transition,style:o,styleSpec:r}):n[t]?pe({key:t,value:i[t],valueSpec:n[t],style:o,styleSpec:r}):[new e.V(t,i[t],`unknown property "${t}"`)])}return s}function ce(t){const i=t.value;let r=[];if(!i)return r;const n=e.K(i);if("object"!==n)return r=r.concat([new e.V("light-3d",i,`object expected, ${n} found`)]),r;const o=t.styleSpec,s=o["light-3d"],a=t.key,l=t.style,c=t.style.lights;for(const t of["type","id"])if(!(t in i))return r=r.concat([new e.V("light-3d",i,`missing property ${t} on light`)]),r;if(i.type&&c)for(let n=0;n<t.arrayIndex;n++){const t=e.M(i.type),o=c[n];e.M(o.type)===t&&r.push(new e.V(a,i.id,`duplicate light type "${i.type}", previously defined at line ${o.id.__line__}`))}const u=`properties_light_${i.type}`;if(!(u in o))return r=r.concat([new e.V("light-3d",i,`Invalid light type ${i.type}`)]),r;const h=o[u];for(const n in i)if("properties"===n){const s=i[n],a=e.K(s);if("object"!==a)return r=r.concat([new e.V("properties",s,`object expected, ${a} found`)]),r;for(const i in s)r=r.concat(h[i]?pe({key:i,value:s[i],valueSpec:h[i],style:l,styleSpec:o}):[new e.J(t.key,s[i],`unknown property "${i}"`)])}else{const t=n.match(/^(.*)-transition$/),a=n.match(/^(.*)-use-theme$/);r=r.concat(a&&s[a[1]]?pe({key:n,value:i[n],valueSpec:{type:"string"},style:l,styleSpec:o}):t&&s[t[1]]&&s[t[1]].transition?pe({key:n,value:i[n],valueSpec:o.transition,style:l,styleSpec:o}):s[n]?pe({key:n,value:i[n],valueSpec:s[n],style:l,styleSpec:o}):[new e.J(n,i[n],`unknown property "${n}"`)])}return r}function ue(t){const i=t.value,r=t.key,n=t.style,o=t.styleSpec,s=o.terrain;let a=[];const l=e.K(i);if(void 0===i)return a;if("null"===l)return a;if("object"!==l)return a=a.concat([new e.V("terrain",i,`object expected, ${l} found`)]),a;for(const t in i){const r=t.match(/^(.*)-transition$/),l=t.match(/^(.*)-use-theme$/);a=a.concat(l&&s[l[1]]?pe({key:t,value:i[t],valueSpec:{type:"string"},style:n,styleSpec:o}):r&&s[r[1]]&&s[r[1]].transition?pe({key:t,value:i[t],valueSpec:o.transition,style:n,styleSpec:o}):s[t]?pe({key:t,value:i[t],valueSpec:s[t],style:n,styleSpec:o}):[new e.J(t,i[t],`unknown property "${t}"`)])}if(i.source){const t=n.sources&&n.sources[i.source],o=t&&e.M(t.type);t?"raster-dem"!==o&&a.push(new e.V(r,i.source,`terrain cannot be used with a source of type ${String(o)}, it only be used with a "raster-dem" source type`)):a.push(new e.V(r,i.source,`source "${i.source}" not found`))}else a.push(new e.V(r,i,'terrain is missing required property "source"'));return a}function he(t){const i=t.value,r=t.style,n=t.styleSpec,o=n.fog;let s=[];const a=e.K(i);if(void 0===i)return s;if("object"!==a)return s=s.concat([new e.V("fog",i,`object expected, ${a} found`)]),s;for(const t in i){const a=t.match(/^(.*)-transition$/),l=t.match(/^(.*)-use-theme$/);s=s.concat(l&&o[l[1]]?pe({key:t,value:i[t],valueSpec:{type:"string"},style:r,styleSpec:n}):a&&o[a[1]]&&o[a[1]].transition?pe({key:t,value:i[t],valueSpec:n.transition,style:r,styleSpec:n}):o[t]?pe({key:t,value:i[t],valueSpec:o[t],style:r,styleSpec:n}):[new e.J(t,i[t],`unknown property "${t}"`)])}return s}const de={"*":()=>[],array:$,boolean:function(t){const i=t.value,r=t.key,n=e.K(i);return"boolean"!==n?[new e.V(r,i,`boolean expected, ${n} found`)]:[]},number:Z,color:function(t){const i=t.key,r=t.value,n=e.K(r);return"string"!==n?[new e.V(i,r,`color expected, ${n} found`)]:null===e.a0.parseCSSColor(r)?[new e.V(i,r,`color expected, "${r}" found`)]:[]},enum:X,filter:Y,function:q,layer:re,object:G,source:se,model:e.a4,light:le,"light-3d":ce,terrain:ue,fog:he,string:ne,formatted:function(e){return 0===ne(e).length?[]:K(e)},resolvedImage:function(e){return 0===ne(e).length?[]:K(e)},projection:function(t){const i=t.value,r=t.styleSpec,n=r.projection,o=t.style;let s=[];const a=e.K(i);if("object"===a)for(const e in i)s=s.concat(pe({key:e,value:i[e],valueSpec:n[e],style:o,styleSpec:r}));else"string"!==a&&(s=s.concat([new e.V("projection",i,`object or string expected, ${a} found`)]));return s},import:function(t){const{value:i,styleSpec:r}=t,{data:n,...o}=i;Object.defineProperty(o,"__line__",{value:i.__line__,enumerable:!1});let s=G(e.L({},t,{value:o,valueSpec:r.import}));return""===e.M(o.id)&&s.push(new e.V(`${t.key}.id`,o,"import id can't be an empty string")),n&&(s=s.concat(Ae(n,r,{key:`${t.key}.data`}))),s},iconset:function(t){const i=t.value,r=t.key,n=t.styleSpec,o=t.style;if(!i.type)return[new e.V(r,i,'"type" is required')];const s=e.M(i.type);let a=[];if(a=a.concat(G({key:r,value:i,valueSpec:n[`iconset_${s}`],style:o,styleSpec:n})),"source"===s&&i.source){const t=o.sources&&o.sources[i.source],n=t&&e.M(t.type);t?"raster-array"!==n&&a.push(new e.V(r,i.source,`iconset cannot be used with a source of type ${String(n)}, it only be used with a "raster-array" source type`)):a.push(new e.V(r,i.source,`source "${i.source}" not found`))}return a}};function pe(t,i=!1){const r=t.value,n=t.valueSpec,o=t.styleSpec;if(n.expression&&e.a2(e.M(r)))return q(t);if(n.expression&&e.S(e.U(r)))return K(t);if(n.type&&de[n.type]){const r=de[n.type](t);return!0===i&&r.length>0&&"array"===e.K(t.value)?K(t):r}return G(e.L({},t,{valueSpec:n.type?o[n.type]:n}))}function fe(t){const i=t.value,r=t.key,n=ne(t);return n.length||(-1===i.indexOf("{fontstack}")&&n.push(new e.V(r,i,'"glyphs" url must include a "{fontstack}" token')),-1===i.indexOf("{range}")&&n.push(new e.V(r,i,'"glyphs" url must include a "{range}" token'))),n}function Ae(t,i=e.a5,r={}){return pe({key:r.key||"",value:t,valueSpec:i.$root,styleSpec:i,style:t,objectElementValidators:{glyphs:fe,"*":()=>[]}})}function me(t,i=e.a5){return Me(Ae(t,i))}const ge=e=>Me(se(e)),_e=e=>Me(le(e)),ye=e=>Me(ce(e)),ve=e=>Me(ue(e)),xe=e=>Me(he(e)),be=t=>Me(function(t){const i=t.value,r=t.style,n=t.styleSpec,o=n.snow;let s=[];const a=e.K(i);if(void 0===i)return s;if("object"!==a)return s=s.concat([new e.V("snow",i,`object expected, ${a} found`)]),s;for(const t in i){const a=t.match(/^(.*)-transition$/);s=s.concat(a&&o[a[1]]&&o[a[1]].transition?pe({key:t,value:i[t],valueSpec:n.transition,style:r,styleSpec:n}):o[t]?pe({key:t,value:i[t],valueSpec:o[t],style:r,styleSpec:n}):[new e.J(t,i[t],`unknown property "${t}"`)])}return s}(t)),we=t=>Me(function(t){const i=t.value,r=t.style,n=t.styleSpec,o=n.rain;let s=[];const a=e.K(i);if(void 0===i)return s;if("object"!==a)return s=s.concat([new e.V("rain",i,`object expected, ${a} found`)]),s;for(const t in i){const a=t.match(/^(.*)-transition$/);s=s.concat(a&&o[a[1]]&&o[a[1]].transition?pe({key:t,value:i[t],valueSpec:n.transition,style:r,styleSpec:n}):o[t]?pe({key:t,value:i[t],valueSpec:o[t],style:r,styleSpec:n}):[new e.J(t,i[t],`unknown property "${t}"`)])}return s}(t)),Te=e=>Me(re(e)),Be=e=>Me(Y(e)),Ce=e=>Me(te(e)),Se=e=>Me(ie(e)),Ee=t=>Me(e.a4(t));function Me(e){return e.slice().sort(((e,t)=>e.line&&t.line?e.line-t.line:0))}function Ie(t,i){let r=!1;if(i&&i.length)for(const n of i)n instanceof e.J?e.w(n.message):(t.fire(new e.z(new Error(n.message))),r=!0);return r}let Pe;class Le extends e.E{constructor(t,i="flat"){super(),this._transitionable=new e.a6(Pe||(Pe=new e.a7({anchor:new e.a8(e.a5.light.anchor),position:new e.a9(e.a5.light.position),color:new e.a8(e.a5.light.color),intensity:new e.a8(e.a5.light.intensity)}))),this.setLight(t,i),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,t,i={}){this._validate(_e,e,i)||(this._transitionable.setTransitionOrValue(e),this.id=t)}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(t,i,r){return(!r||!1!==r.validate)&&Ie(this,t.call(me,e.l({value:i,style:{glyphs:!0,sprite:!0},styleSpec:e.a5})))}}let Fe=class extends e.E{constructor(t,i,r,n){super(),this.scope=r,this._transitionable=new e.a6(new e.a7({source:new e.a8(e.a5.terrain.source),exaggeration:new e.a8(e.a5.terrain.exaggeration)}),r,n),this._transitionable.setTransitionOrValue(t,n),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=i}get(){return this._transitionable.serialize()}set(e,t){this._transitionable.setTransitionOrValue(e,t)}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}getExaggeration(t){return this._transitioning.possiblyEvaluate(new e.aa(t)).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const t=this._transitionable._values.exaggeration;if(!t)return null;const i=t.value.expression;if(!i)return null;let r=-1,n=-1,o=1;for(const t of i.zoomStops)o=i.evaluate(new e.aa(t)),o>.01?(r=t,n=-1):n=t;return o<.01&&r>0&&n>r?[r,n]:null}isZoomDependent(){const t=this._transitionable._values.exaggeration;return null!=t&&null!=t.value&&null!=t.value.expression&&t.value.expression instanceof e.ab}};const ke=45,ze=65,Re=.05;function De(t,i,r,n){const o=e.ae(ke,ze,r),[s,a]=Oe(t,n);let l=1-Math.min(1,Math.exp((i-s)/(a-s)*-6));return l*=l*l,l=Math.min(1,1.00747*l),l*o*t.alpha}function Oe(e,t){const i=.5/Math.tan(.5*t);return[e.range[0]+i,e.range[1]+i]}function Ue(t,i,r,n,o){const s=e.ad.vec3.transformMat4([],[i,r,n],o.mercatorFogMatrix);return De(t,e.ad.vec3.length(s),o.pitch,o._fov)}function Ne(t,i,r,n,o,s,a){const l=[[r,n,0],[o,n,0],[o,s,0],[r,s,0]];let c=Number.MAX_VALUE,u=-Number.MAX_VALUE;for(const t of l){const r=e.ad.vec3.transformMat4([],t,i),n=e.ad.vec3.length(r);c=Math.min(c,n),u=Math.max(u,n)}return[De(t,c,a.pitch,a._fov),De(t,u,a.pitch,a._fov)]}class Qe extends e.E{constructor(t,i,r,n){super();const o=new e.a7({range:new e.a8(e.a5.fog.range),color:new e.a8(e.a5.fog.color),"color-use-theme":new e.a8({type:"string","property-type":"data-constant",default:"default"}),"high-color":new e.a8(e.a5.fog["high-color"]),"high-color-use-theme":new e.a8({type:"string","property-type":"data-constant",default:"default"}),"space-color":new e.a8(e.a5.fog["space-color"]),"space-color-use-theme":new e.a8({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new e.a8(e.a5.fog["horizon-blend"]),"star-intensity":new e.a8(e.a5.fog["star-intensity"]),"vertical-range":new e.a8(e.a5.fog["vertical-range"])});this._transitionable=new e.a6(o,r,new Map(n)),this.set(t,n),this._transitioning=this._transitionable.untransitioned(),this._transform=i,this.properties=new e.af(o),this.scope=r}get state(){const t=this._transform,i="globe"===t.projection.name,r=e.ag(t.zoom),n=this.properties.get("range"),o=[.5,3];return{range:i?[e.ah(o[0],n[0],r),e.ah(o[1],n[1],r)]:n,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(t,i,r={}){if(this._validate(xe,t,r))return;const n=e.l({},t);for(const t of Object.keys(e.a5.fog))void 0===n[t]&&(n[t]=e.a5.fog[t].default);this._options=n,this._transitionable.setTransitionOrValue(this._options,i)}getOpacity(t){if(!this._transform.projection.supportsFog)return 0;const i=this.properties&&this.properties.get("color")||1;return("globe"===this._transform.projection.name?1:e.ae(ke,ze,t))*i.a}getOpacityAtLatLng(t,i){return this._transform.projection.supportsFog?function(t,i,r){const n=e.ac.fromLngLat(i),o=r.elevation?r.elevation.getAtPointOrZero(n):0;return Ue(t,n.x,n.y,o,r)}(this.state,t,i):0}getOpacityForTile(t){if(!this._transform.projection.supportsFog)return[1,1];const i=this._transform.calculateFogTileMatrix(t.toUnwrapped());return Ne(this.state,i,0,0,e.ai,e.ai,this._transform)}getOpacityForBounds(e,t,i,r,n){return this._transform.projection.supportsFog?Ne(this.state,e,t,i,r,n,this._transform):[1,1]}getFovAdjustedRange(e){return this._transform.projection.supportsFog?Oe(this.state,e):[0,1]}isVisibleOnFrustum(t){if(!this._transform.projection.supportsFog)return!1;const i=[4,5,6,7];for(const r of i){const i=t.points[r];let n;if(i[2]>=0)n=i;else{const o=t.points[r-4];n=e.aj(o,i,o[2]/(o[2]-i[2]))}if(Ue(this.state,n[0],n[1],0,this._transform)>=Re)return!0}return!1}updateConfig(e){this._transitionable.setTransitionOrValue(this._options,new Map(e))}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(t,i,r){return(!r||!1!==r.validate)&&Ie(this,t.call(me,e.l({value:i,style:{glyphs:!0,sprite:!0},styleSpec:e.a5})))}}let je,Ve,He,Ge,$e=class extends e.E{constructor(t,i,r,n){super();const o=je||(je=new e.a7({density:new e.a8(e.a5.snow.density),intensity:new e.a8(e.a5.snow.intensity),color:new e.a8(e.a5.snow.color),opacity:new e.a8(e.a5.snow.opacity),vignette:new e.a8(e.a5.snow.vignette),"vignette-color":new e.a8(e.a5.snow["vignette-color"]),"center-thinning":new e.a8(e.a5.snow["center-thinning"]),direction:new e.a8(e.a5.snow.direction),"flake-size":new e.a8(e.a5.snow["flake-size"])}));this._transitionable=new e.a6(o,r,new Map(n)),this.set(t,n),this._transitioning=this._transitionable.untransitioned(),this.properties=new e.af(o),this.scope=r}get state(){const t=this.properties.get("opacity"),i=this.properties.get("color"),r=this.properties.get("direction"),n=e.ak(r[0]),o=-Math.max(e.ak(r[1]),.01),s=[Math.cos(n)*Math.cos(o),Math.sin(n)*Math.cos(o),Math.sin(o)],a=this.properties.get("vignette"),l=this.properties.get("vignette-color");return l.a=a,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new e.al(i.r,i.g,i.b,i.a*t),direction:s,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:l}}get(){return this._transitionable.serialize()}set(t,i,r={}){if(this._validate(be,t,r))return;const n=e.l({},t);for(const t of Object.keys(e.a5.snow))void 0===n[t]&&(n[t]=e.a5.snow[t].default);this._options=n,this._transitionable.setTransitionOrValue(this._options,i)}updateConfig(e){this._transitionable.setTransitionOrValue(this._options,new Map(e))}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(t,i,r){return(!r||!1!==r.validate)&&Ie(this,t.call(me,e.l({value:i,style:{glyphs:!0,sprite:!0},styleSpec:e.a5})))}},Ze=class extends e.E{constructor(t,i,r,n){super();const o=Ve||(Ve=new e.a7({density:new e.a8(e.a5.rain.density),intensity:new e.a8(e.a5.rain.intensity),color:new e.a8(e.a5.rain.color),opacity:new e.a8(e.a5.rain.opacity),vignette:new e.a8(e.a5.rain.vignette),"vignette-color":new e.a8(e.a5.rain["vignette-color"]),"center-thinning":new e.a8(e.a5.rain["center-thinning"]),direction:new e.a8(e.a5.rain.direction),"droplet-size":new e.a8(e.a5.rain["droplet-size"]),"distortion-strength":new e.a8(e.a5.rain["distortion-strength"])}));this._transitionable=new e.a6(o,r,new Map(n)),this.set(t,n),this._transitioning=this._transitionable.untransitioned(),this.properties=new e.af(o),this.scope=r}get state(){const t=this.properties.get("opacity"),i=this.properties.get("color"),r=this.properties.get("direction"),n=e.ak(r[0]),o=-Math.max(e.ak(r[1]),.01),s=[Math.cos(n)*Math.cos(o),Math.sin(n)*Math.cos(o),Math.sin(o)],a=this.properties.get("vignette-color");return a.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new e.al(i.r,i.g,i.b,i.a*t),direction:s,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:a}}get(){return this._transitionable.serialize()}set(t,i,r={}){if(this._validate(we,t,r))return;const n=e.l({},t);for(const t of Object.keys(e.a5.rain))void 0===n[t]&&(n[t]=e.a5.rain[t].default);this._options=n,this._transitionable.setTransitionOrValue(this._options,i)}updateConfig(e){this._transitionable.setTransitionOrValue(this._options,new Map(e))}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(t,i,r){return(!r||!1!==r.validate)&&Ie(this,t.call(me,e.l({value:i,style:{glyphs:!0,sprite:!0},styleSpec:e.a5})))}};class qe extends e.E{constructor(t,i,r,n){super(),this.scope=r,this._options=t,this.properties=new e.af(i),this._transitionable=new e.a6(i,r,new Map(n)),this._transitionable.setTransitionOrValue(t.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(e){this._transitionable.setTransitionOrValue(this._options.properties,new Map(e))}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(e,t){this._options=e,this._transitionable.setTransitionOrValue(e.properties,t)}shadowsEnabled(){return!!this.properties&&!0===this.properties.get("cast-shadows")}}class Ke{constructor(e,t,i,r){this.screenBounds=e,this.cameraPoint=t,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=i,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,r)}static createFromScreenPoints(t,i){let r,n;if(t instanceof e.P||"number"==typeof t[0]){const o=e.P.convert(t);r=[o],n=i.isPointAboveHorizon(o)}else{const o=e.P.convert(t[0]),s=e.P.convert(t[1]);r=[o,s],n=e.an(o,s).every((e=>i.isPointAboveHorizon(e)))}return new Ke(r,i.getCameraPoint(),n,i)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(t){return e.an(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],t)}bufferedCameraGeometry(t){const i=this.screenBounds[0],r=1===this.screenBounds.length?this.screenBounds[0].add(new e.P(1,1)):this.screenBounds[1],n=e.an(i,r,0,!1);return this.cameraPoint.y>r.y&&(this.cameraPoint.x>i.x&&this.cameraPoint.x<r.x?n.splice(3,0,this.cameraPoint):this.cameraPoint.x>=r.x?n[2]=this.cameraPoint:this.cameraPoint.x<=i.x&&(n[3]=this.cameraPoint)),e.ao(n,t)}bufferedCameraGeometryGlobe(t){const i=this.screenBounds[0],r=1===this.screenBounds.length?this.screenBounds[0].add(new e.P(1,1)):this.screenBounds[1],n=e.an(i,r,t),o=this.cameraPoint.clone();switch(3*((o.y>i.y)+(o.y>r.y))+((o.x>i.x)+(o.x>r.x))){case 0:n[0]=o,n[4]=o.clone();break;case 1:n.splice(1,0,o);break;case 2:n[1]=o;break;case 3:n.splice(4,0,o);break;case 5:n.splice(2,0,o);break;case 6:n[3]=o;break;case 7:n.splice(3,0,o);break;case 8:n[2]=o}return n}containsTile(t,i,r,n=0){const o=t.queryPadding/i._pixelsPerMercatorPixel+1,s=r?this._bufferedCameraMercator(o,i):this._bufferedScreenMercator(o,i);let a=t.tileID.wrap+(s.unwrapped?n:0);const l=s.polygon.map((i=>e.ap(t.tileTransform,i,a)));if(!e.aq(l,0,0,e.ai,e.ai))return;a=t.tileID.wrap+(this.screenGeometryMercator.unwrapped?n:0);const c=this.screenGeometryMercator.polygon.map((i=>e.ar(t.tileTransform,i,a))),u=c.map((t=>new e.P(t[0],t[1]))),h=i.getFreeCameraOptions().position||new e.ac(0,0,0),d=e.ar(t.tileTransform,h,a),p=c.map((t=>{const i=e.ad.vec3.sub(t,t,d);return e.ad.vec3.normalize(i,i),new e.as(d,i)})),f=e.at(t,1,i.zoom)*i._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:u,tilespaceRays:p,bufferedTilespaceGeometry:l,bufferedTilespaceBounds:(A=e.au(l),A.min.x=e.ay(A.min.x,0,e.ai),A.min.y=e.ay(A.min.y,0,e.ai),A.max.x=e.ay(A.max.x,0,e.ai),A.max.y=e.ay(A.max.y,0,e.ai),A),tile:t,tileID:t.tileID,pixelToTileUnitsFactor:f};var A}_bufferedScreenMercator(e,t){const i=Ye(e);if(this._screenRaycastCache[i])return this._screenRaycastCache[i];{let r;return r="globe"===t.projection.name?this._projectAndResample(this.bufferedScreenGeometry(e),t):{polygon:this.bufferedScreenGeometry(e).map((e=>t.pointCoordinate3D(e))),unwrapped:!0},this._screenRaycastCache[i]=r,r}}_bufferedCameraMercator(e,t){const i=Ye(e);if(this._cameraRaycastCache[i])return this._cameraRaycastCache[i];{let r;return r="globe"===t.projection.name?this._projectAndResample(this.bufferedCameraGeometryGlobe(e),t):{polygon:this.bufferedCameraGeometry(e).map((e=>t.pointCoordinate3D(e))),unwrapped:!0},this._cameraRaycastCache[i]=r,r}}_projectAndResample(t,i){const r=function(t,i){const r=e.ad.mat4.multiply([],i.pixelMatrix,i.globeMatrix),n=[0,-e.az,0,1],o=[0,e.az,0,1],s=[0,0,0,1];e.ad.vec4.transformMat4(n,n,r),e.ad.vec4.transformMat4(o,o,r),e.ad.vec4.transformMat4(s,s,r);const a=new e.P(n[0]/n[3],n[1]/n[3]),l=new e.P(o[0]/o[3],o[1]/o[3]),c=e.aw(t,a)&&n[3]<s[3],u=e.aw(t,l)&&o[3]<s[3];if(!c&&!u)return null;const h=function(e,t,i){for(let r=1;r<e.length;r++){const n=Xe(t.pointCoordinate3D(e[r-1]).x),o=Xe(t.pointCoordinate3D(e[r]).x);if(i<0){if(n<o)return{idx:r,t:-n/(o-1-n)}}else if(o<n)return{idx:r,t:(1-n)/(o+1-n)}}return null}(t,i,c?-1:1);if(!h)return null;const{idx:d,t:p}=h;let f=d>1?We(t.slice(0,d),i):[],A=d<t.length?We(t.slice(d),i):[];f=f.map((t=>new e.P(Xe(t.x),t.y))),A=A.map((t=>new e.P(Xe(t.x),t.y)));const m=[...f];0===m.length&&m.push(A[A.length-1]);const g=e.ah(m[m.length-1].y,(0===A.length?f[0]:A[0]).y,p);let _;return _=c?[new e.P(0,g),new e.P(0,0),new e.P(1,0),new e.P(1,g)]:[new e.P(1,g),new e.P(1,1),new e.P(0,1),new e.P(0,g)],m.push(..._),0===A.length?m.push(f[0]):m.push(...A),{polygon:m.map((t=>new e.ac(t.x,t.y))),unwrapped:!1}}(t,i);if(r)return r;const n=function(t,i){let r=!1,n=-1/0,o=0;for(let e=0;e<t.length-1;e++)t[e].x>n&&(n=t[e].x,o=e);for(let e=0;e<t.length-1;e++){const i=(o+e)%(t.length-1),n=t[i],s=t[i+1];Math.abs(n.x-s.x)>.5&&(n.x<s.x?(n.x+=1,0===i&&(t[t.length-1].x+=1)):(s.x+=1,i+1===t.length-1&&(t[0].x+=1)),r=!0)}const s=e.av(i.center.lng);return r&&s<Math.abs(s-1)&&t.forEach((e=>{e.x-=1})),{polygon:t,unwrapped:r}}(We(t,i).map((t=>new e.P(Xe(t.x),t.y))),i);return{polygon:n.polygon.map((t=>new e.ac(t.x,t.y))),unwrapped:n.unwrapped}}}function We(t,i){return e.ax(t,(e=>{const t=i.pointCoordinate3D(e);e.x=t.x,e.y=t.y}),1/256)}function Xe(e){return e<0?1+e%1:e%1}function Ye(e){return 100*e|0}function Je(t,i,r,n,o){const s=function(r,n){if(r)return o(r);if(n){if(t.url&&n.tiles&&t.tiles&&delete t.tiles,n.variants){if(!Array.isArray(n.variants))return o(new Error("variants must be an array"));for(const t of n.variants){if(null==t||"object"!=typeof t||t.constructor!==Object)return o(new Error("variant must be an object"));if(!Array.isArray(t.capabilities))return o(new Error("capabilities must be an array"));if(1===t.capabilities.length&&"meshopt"===t.capabilities[0]){n=e.l(n,t);break}}}const r=e.aA(e.l({},n,t),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);r.tiles=i.canonicalizeTileset(r,t.url),o(null,r)}},a=function(e,t,i){if(!e)return null;if(!t&&!i)return e;i=i||e.worldview_default;const r=Object.values(e.language||{});if(0===r.length)return null;const n=Object.values(e.worldview||{});if(0===n.length)return null;const o=r.every((e=>e===t)),s=n.every((e=>e===i));return o&&s?e:t in(e.language_options||{})||i in(e.worldview_options||{})?null:e.language_options&&e.worldview_options?e:null}(t.data,r,n);return a?e.q.frame((()=>s(null,a))):t.url?e.n(i.transformRequest(i.normalizeSourceURL(t.url,null,r,n),e.R.Source),s):e.q.frame((()=>{const{data:e,...i}=t;s(null,i)}))}class et{constructor(t,i,r){this.bounds=e.aB.convert(this.validateBounds(t)),this.minzoom=i||0,this.maxzoom=r||24}validateBounds(e){return Array.isArray(e)&&4===e.length?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(t){const i=Math.pow(2,t.z),r=Math.floor(e.av(this.bounds.getWest())*i),n=Math.floor(e.aC(this.bounds.getNorth())*i),o=Math.ceil(e.av(this.bounds.getEast())*i),s=Math.ceil(e.aC(this.bounds.getSouth())*i);return t.x>=r&&t.x<o&&t.y>=n&&t.y<s}}class tt extends e.E{constructor(t,i,r,n){if(super(),this.id=t,this.dispatcher=r,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,e.l(this,e.aA(i,["url","scheme","tileSize","promoteId"])),this._options=e.l({type:"vector"},i),this._collectResourceTiming=!!i.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(n),this._tileWorkers={},this._deduped=new e.aD}load(t){this._loaded=!1,this.fire(new e.A("dataloading",{dataType:"source"}));const i=Array.isArray(this.map._language)?this.map._language.join():this.map._language,r=this.map.getWorldview();this._tileJSONRequest=Je(this._options,this.map._requestManager,i,r,((n,o)=>{if(this._tileJSONRequest=null,this._loaded=!0,n)i&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${i}`),r&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${r}`),this.fire(new e.z(n));else if(o){if(e.l(this,o),this.hasWorldviews=!!o.worldview_options,o.worldview_default&&(this.worldviewDefault=o.worldview_default),o.vector_layers){this.vectorLayers=o.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const e of o.vector_layers)this.vectorLayerIds.push(e.id),o.worldview&&o.worldview[e.source]&&this.localizableLayerIds.add(e.id)}o.bounds&&(this.tileBounds=new et(o.bounds,this.minzoom,this.maxzoom)),P(o.tiles,this.map._requestManager._customAccessToken),this.fire(new e.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new e.A("data",{dataType:"source",sourceDataType:"content"}))}t&&t(n)}))}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}reload(){this.cancelTileJSONRequest();const t=e.C(this.id,this.scope);this.load((()=>this.map.style.clearSource(t)))}setTiles(e){return this._options.tiles=e,this.reload(),this}setUrl(e){return this.url=e,this._options.url=e,this.reload(),this}onRemove(e){this.cancelTileJSONRequest()}serialize(){return e.l({},this._options)}loadTile(t,i){const r=t.tileID.canonical.url(this.tiles,this.scheme),n=this.map._requestManager.normalizeTileURL(r),o=this.map._requestManager.transformRequest(n,e.R.Tile),s=this.map.style?this.map.style.getLut(this.scope):null,a=s?{image:s.image.clone()}:null,l={request:o,data:void 0,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,lut:a,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:e.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:t.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:t.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor()};if(this.hasWorldviews&&e.f(r)&&(l.worldview=this.map.getWorldview()||this.worldviewDefault,l.localizableLayerIds=this.localizableLayerIds),l.request.collectResourceTiming=this._collectResourceTiming,t.actor&&"expired"!==t.state)"loading"===t.state?t.reloadCallback=i:t.request=t.actor.send("reloadTile",l,c.bind(this));else if(t.actor=this._tileWorkers[n]=this._tileWorkers[n]||this.dispatcher.getActor(),this.dispatcher.ready)t.request=t.actor.send("loadTile",l,c.bind(this),void 0,!0);else{const i=e.aE.call({deduped:this._deduped},l,((e,i)=>{e||!i?c.call(this,e):(l.data={cacheControl:i.cacheControl,expires:i.expires,rawData:i.rawData.slice(0)},t.actor&&t.actor.send("loadTile",l,c.bind(this),void 0,!0))}),!0);t.request={cancel:i}}function c(r,n){return delete t.request,t.aborted?i(null):r&&404!==r.status?i(r):(n&&n.resourceTiming&&(t.resourceTiming=n.resourceTiming),this.map._refreshExpiredTiles&&n&&t.setExpiryData(n),t.loadVectorData(n,this.map.painter),e.aF(this.dispatcher),i(null),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}}abortTile(e){e.request&&(e.request.cancel(),delete e.request),e.actor&&e.actor.send("abortTile",{uid:e.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(e,t){e.actor&&e.actor.send("removeTile",{uid:e.uid,type:this.type,source:this.id,scope:this.scope}),e.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class it extends e.E{constructor(t,i,r,n){super(),this.id=t,this.dispatcher=r,this.setEventedParent(n),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=e.l({type:"raster"},i),e.l(this,e.aA(i,["url","scheme","tileSize"]))}load(t){this._loaded=!1,this.fire(new e.A("dataloading",{dataType:"source"})),this._tileJSONRequest=Je(this._options,this.map._requestManager,null,null,((i,r)=>{this._tileJSONRequest=null,this._loaded=!0,i?this.fire(new e.z(i)):r&&(e.l(this,r),r.raster_layers&&(this.rasterLayers=r.raster_layers,this.rasterLayerIds=this.rasterLayers.map((e=>e.id))),r.bounds&&(this.tileBounds=new et(r.bounds,this.minzoom,this.maxzoom)),P(r.tiles),this.fire(new e.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new e.A("data",{dataType:"source",sourceDataType:"content"}))),t&&t(i)}))}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}reload(){this.cancelTileJSONRequest();const t=e.C(this.id,this.scope);this.load((()=>this.map.style.clearSource(t)))}setTiles(e){return this._options.tiles=e,this.reload(),this}setUrl(e){return this.url=e,this._options.url=e,this.reload(),this}onRemove(e){this.cancelTileJSONRequest()}serialize(){return e.l({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(t,i){const r=e.q.devicePixelRatio>=2,n=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),r,this.tileSize);t.request=e.o(this.map._requestManager.transformRequest(n,e.R.Tile),((r,n,o,s)=>(delete t.request,t.aborted?(t.state="unloaded",i(null)):r?(t.state="errored",i(r)):n?(this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:o,expires:s}),t.setTexture(n,this.map.painter),t.state="loaded",e.aF(this.dispatcher),void i(null)):i(null))))}abortTile(e,t){e.request&&(e.request.cancel(),delete e.request),t&&t()}unloadTile(t,i){t.texture&&t.texture instanceof e.T?(t.destroy(!0),t.texture&&t.texture instanceof e.T&&this.map.painter.saveTileTexture(t.texture)):t.destroy(),i&&i()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class rt extends it{constructor(t,i,r,n){super(t,i,r,n),this.type="raster-array",this.maxzoom=22,this.partial=!0,this._options=e.l({type:"raster-array"},i)}triggerRepaint(e){const t=this.map.painter._terrain,i=this.map.style.getSourceCache(this.id);t&&t.enabled&&i&&t._clearRenderCacheForTile(i.id,e.tileID),this.map.triggerRepaint()}loadTile(t,i){const r=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),n=this.map._requestManager.transformRequest(r,e.R.Tile),o={request:n,uid:t.uid,tileID:t.tileID,type:this.type,source:this.id,scope:this.scope,partial:this.partial};t.source=this.id,t.scope=this.scope,t.requestParams=n,t.actor||(t.actor=this.dispatcher.getActor());const s=(e,r,n,o)=>{if(delete t.request,t.aborted)return t.state="unloaded",i(null);if(e){if("AbortError"===e.name)return;return t.state="errored",i(e)}if(this.map._refreshExpiredTiles&&r&&t.setExpiryData({cacheControl:n,expires:o}),this.partial)t.state="empty";else{if(!r)return i(null);t.state="loaded",t._isHeaderLoaded=!0,t._mrt=r}i(null)};t.request=this.partial?t.fetchHeader(void 0,s.bind(this)):t.actor.send("loadTile",o,s.bind(this),void 0,!0)}abortTile(e){e.request&&(e.request.cancel(),delete e.request),e.actor&&e.actor.send("abortTile",{uid:e.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(t,i){const r=t.texture;r&&r instanceof e.T?(t.destroy(!0),this.map.painter.saveTileTexture(r)):(t.destroy(),t.flushQueues(),t._isHeaderLoaded=!1,delete t._mrt,delete t.textureDescriptor),t.fbo&&(t.fbo.destroy(),delete t.fbo),delete t.request,delete t.requestParams,delete t.neighboringTiles,t.state="unloaded"}prepareTile(t,i,r){t._isHeaderLoaded&&("empty"!==t.state&&(t.state="reloading"),t.fetchBand(i,r,((i,r)=>{if(i)return t.state="errored",this.fire(new e.z(i)),void this.triggerRepaint(t);r&&(t._isHeaderLoaded=!0,t.setTexture(r,this.map.painter),t.state="loaded",this.triggerRepaint(t))})))}getInitialBand(e){if(!this.rasterLayers)return 0;const t=this.rasterLayers.find((({id:t})=>t===e)),i=t&&t.fields,r=i&&i.bands&&i.bands;return r?r[0]:0}getTextureDescriptor(t,i,r){if(!t)return;const n=i.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!n)return;let o=null;i instanceof e.aI?o=i.paint.get("raster-array-band"):i instanceof e.aJ&&(o=i.paint.get("raster-particle-array-band"));const s=o||this.getInitialBand(n);if(null!=s)if(t.textureDescriptor){if(!t.updateNeeded(n,s)||r)return Object.assign({},t.textureDescriptor,{texture:t.texture})}else this.prepareTile(t,n,s)}getImages(t,i){const r=new Map;for(const n of t)for(const t of i){const[i,o]=t.split("/"),s=n.getLayer(i);if(!s)continue;if(!s.hasBand(o)||!s.hasDataForBand(o))continue;const{bytes:a,tileSize:l,buffer:c}=s.getBandView(o),u=l+2*c,h={data:new e.r({width:u,height:u},a),pixelRatio:2,sdf:!1,usvg:!1,version:0};r.set(t,h)}return r}}const nt={vector:tt,raster:it,"raster-dem":class extends it{constructor(t,i,r,n){super(t,i,r,n),this.type="raster-dem",this.maxzoom=22,this._options=e.l({type:"raster-dem"},i),this.encoding=i.encoding||"mapbox"}loadTile(t,i){const r=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function n(e,r){e&&(t.state="errored",i(e)),r&&(t.dem=r,t.dem.onDeserialize(),t.needsHillshadePrepare=!0,t.needsDEMTextureUpload=!0,t.state="loaded",i(null))}t.request=e.o(this.map._requestManager.transformRequest(r,e.R.Tile),function(r,o,s,a){if(delete t.request,t.aborted)t.state="unloaded",i(null);else if(r)t.state="errored",i(r);else if(o){this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:s,expires:a});const i=ImageBitmap&&o instanceof ImageBitmap&&e.t(),r=1-(o.width-e.aG(o.width))/2;r<1||t.neighboringTiles||(t.neighboringTiles=this._getNeighboringTiles(t.tileID));const l=i?o:e.q.getImageData(o,r),c={uid:t.uid,tileID:t.tileID,source:this.id,type:this.type,scope:this.scope,rawImageData:l,encoding:this.encoding,padding:r};t.actor&&"expired"!==t.state||(t.actor=this.dispatcher.getActor(),t.actor.send("loadTile",c,n.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(t){const i=t.canonical,r=Math.pow(2,i.z),n=(i.x-1+r)%r,o=0===i.x?t.wrap-1:t.wrap,s=(i.x+1+r)%r,a=i.x+1===r?t.wrap+1:t.wrap,l={};return l[new e.aH(t.overscaledZ,o,i.z,n,i.y).key]={backfilled:!1},l[new e.aH(t.overscaledZ,a,i.z,s,i.y).key]={backfilled:!1},i.y>0&&(l[new e.aH(t.overscaledZ,o,i.z,n,i.y-1).key]={backfilled:!1},l[new e.aH(t.overscaledZ,t.wrap,i.z,i.x,i.y-1).key]={backfilled:!1},l[new e.aH(t.overscaledZ,a,i.z,s,i.y-1).key]={backfilled:!1}),i.y+1<r&&(l[new e.aH(t.overscaledZ,o,i.z,n,i.y+1).key]={backfilled:!1},l[new e.aH(t.overscaledZ,t.wrap,i.z,i.x,i.y+1).key]={backfilled:!1},l[new e.aH(t.overscaledZ,a,i.z,s,i.y+1).key]={backfilled:!1}),l}},"raster-array":rt,geojson:class extends e.E{constructor(t,i,r,n){super(),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=r.getActor(),this.setEventedParent(n),this._data=i.data,this._options=e.l({},i),this._collectResourceTiming=i.collectResourceTiming,void 0!==i.maxzoom&&(this.maxzoom=i.maxzoom),void 0!==i.minzoom&&(this.minzoom=i.minzoom),i.type&&(this.type=i.type),i.attribution&&(this.attribution=i.attribution),this.promoteId=i.promoteId;const o=e.ai/this.tileSize;this.workerOptions=e.l({source:this.id,scope:this.scope,cluster:i.cluster||!1,geojsonVtOptions:{buffer:(void 0!==i.buffer?i.buffer:128)*o,tolerance:(void 0!==i.tolerance?i.tolerance:.375)*o,extent:e.ai,maxZoom:this.maxzoom,lineMetrics:i.lineMetrics||!1,generateId:i.generateId||!1},superclusterOptions:{maxZoom:void 0!==i.clusterMaxZoom?i.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,i.clusterMinPoints||2),extent:e.ai,radius:(void 0!==i.clusterRadius?i.clusterRadius:50)*o,log:!1,generateId:i.generateId||!1},clusterProperties:i.clusterProperties,filter:i.filter,dynamic:i.dynamic},i.workerOptions)}onAdd(e){this.map=e,this.setData(this._data)}setData(e){return this._data=e,this._updateWorkerData(),this}updateData(t){if(!this._options.dynamic)return this.fire(new e.z(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if("string"!=typeof t&&("Feature"===t.type&&(t={type:"FeatureCollection",features:[t]}),"FeatureCollection"!==t.type))return this.fire(new e.z(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&"string"!=typeof t&&"string"!=typeof this._data&&"FeatureCollection"===this._data.type){const e=new Map;for(const t of this._data.features)e.set(t.id,t);for(const i of t.features)e.set(i.id,i);this._data.features=[...e.values()]}else this._data=t;return this._updateWorkerData(!0),this}getClusterExpansionZoom(e,t){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:e,source:this.id,scope:this.scope},t),this}getClusterChildren(e,t){return this.actor.send("geojson.getClusterChildren",{clusterId:e,source:this.id,scope:this.scope},t),this}getClusterLeaves(e,t,i,r){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:e,limit:t,offset:i},r),this}_updateWorkerData(t=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new e.A("dataloading",{dataType:"source"})),this._loaded=!1;const i=e.l({append:t},this.workerOptions);i.scope=this.scope;const r=this._data;"string"==typeof r?(i.request=this.map._requestManager.transformRequest(e.q.resolveURL(r),e.R.Source),i.request.collectResourceTiming=this._collectResourceTiming):i.data=JSON.stringify(r),this._pendingLoad=this.actor.send(`${this.type}.loadData`,i,((i,r)=>{if(this._loaded=!0,this._pendingLoad=null,i)this.fire(new e.z(i));else{const i={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&r&&r.resourceTiming&&r.resourceTiming[this.id]&&(i.resourceTiming=r.resourceTiming[this.id]),t&&(this._partialReload=!0),this.fire(new e.A("data",i)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(t),this._coalesce=!1)}))}loaded(){return this._loaded}reload(){const t=e.C(this.id,this.scope);this.map.style.clearSource(t),this._updateWorkerData()}loadTile(t,i){const r=t.actor?"reloadTile":"loadTile";t.actor=this.actor;const n=this.map.style?this.map.style.getLut(this.scope):null,o=n?{image:n.image.clone()}:null,s=this._partialReload,a={type:this.type,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:o,scope:this.scope,pixelRatio:e.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,scaleFactor:this.map.getScaleFactor(),partial:s};t.request=this.actor.send(r,a,((e,n)=>s&&!n?(t.state="loaded",i(null)):(delete t.request,t.destroy(),t.aborted?i(null):e?i(e):(t.loadVectorData(n,this.map.painter,"reloadTile"===r),i(null)))),void 0,"loadTile"===r)}abortTile(e){e.request&&(e.request.cancel(),delete e.request),e.aborted=!0}unloadTile(e,t){this.actor.send("removeTile",{uid:e.uid,type:this.type,source:this.id,scope:this.scope}),e.destroy()}onRemove(e){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return e.l({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends e.aK{constructor(e,t,i,r){super(e,t,i,r),this.roundZoom=!0,this.type="video",this.options=t}load(){this._loaded=!1;const t=this.options;this.urls=[];for(const i of t.urls)this.urls.push(this.map._requestManager.transformRequest(i,e.R.Source).url);e.aL(this.urls,((t,i)=>{this._loaded=!0,t?this.fire(new e.z(t)):i&&(this.video=i,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading())}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const i=this.video.seekable;t<i.start(0)||t>i.end(0)?this.fire(new e.z(new e.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${i.start(0)} and ${i.end(0)}-second mark.`))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const t=this.map.painter.context,i=t.gl;this.texture?this.video.paused||(this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),i.texSubImage2D(i.TEXTURE_2D,0,0,0,i.RGBA,i.UNSIGNED_BYTE,this.video)):(this.texture=new e.T(t,this.video,i.RGBA8),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(t)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:e.aK,model:class extends e.E{constructor(e,t,i,r){super(),this.id=e,this.type="model",this.models=[],this._loaded=!1,this._options=t}load(){const t=[];for(const i in this._options.models){const r=this._options.models[i],n=e.aN(this.map._requestManager.transformRequest(r.uri,e.R.Model).url).then((t=>{if(!t)return;const n=e.aO(t),o=new e.aP(i,r.position,r.orientation,n);o.computeBoundsAndApplyParent(),this.models.push(o)})).catch((t=>{this.fire(new e.z(new Error(`Could not load model ${i} from ${r.uri}: ${t.message}`)))}));t.push(n)}return Promise.allSettled(t).then((()=>{this._loaded=!0,this.fire(new e.A("data",{dataType:"source",sourceDataType:"metadata"}))})).catch((t=>{this.fire(new e.z(new Error(`Could not load models: ${t.message}`)))}))}onAdd(e){this.map=e,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(e,t){}serialize(){return{type:"model"}}},"batched-model":class extends e.E{constructor(e,t,i,r){super(),this.type="batched-model",this.id=e,this.tileSize=512,this._options=t,this.tiles=this._options.tiles,this.maxzoom=t.maxzoom||19,this.minzoom=t.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=i,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(r)}onAdd(e){this.map=e,this.load()}reload(){this.cancelTileJSONRequest();const t=e.C(this.id,this.scope);this.load((()=>this.map.style.clearSource(t)))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(t){this._loaded=!1,this.fire(new e.A("dataloading",{dataType:"source"}));const i=Array.isArray(this.map._language)?this.map._language.join():this.map._language,r=this.map.getWorldview();this._tileJSONRequest=Je(this._options,this.map._requestManager,i,r,((n,o)=>{this._tileJSONRequest=null,this._loaded=!0,n?(i&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${i}`),r&&2!==r.length&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${r}`),this.fire(new e.z(n))):o&&(e.l(this,o),o.bounds&&(this.tileBounds=new et(o.bounds,this.minzoom,this.maxzoom)),P(o.tiles,this.map._requestManager._customAccessToken),this.fire(new e.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new e.A("data",{dataType:"source",sourceDataType:"content"}))),t&&t(n)}))}hasTransition(){return!1}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loaded(){return this._loaded}loadTile(t,i){const r=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme)),n={request:this.map._requestManager.transformRequest(r,e.R.Tile),data:void 0,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:t.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,pixelRatio:e.q.devicePixelRatio,promoteId:this.promoteId};if(t.actor&&"expired"!==t.state)if("loading"===t.state)t.reloadCallback=i;else{if(t.buckets){const e=Object.values(t.buckets);for(const t of e)t.dirty=!0;return void(t.state="loaded")}t.request=t.actor.send("reloadTile",n,o.bind(this))}else t.actor=this.dispatcher.getActor(),t.request=t.actor.send("loadTile",n,o.bind(this),void 0,!0);function o(e,r){return t.aborted?i(null):e&&404!==e.status?i(e):(this.map._refreshExpiredTiles&&r&&t.setExpiryData(r),t.loadModelData(r,this.map.painter),t.state="loaded",void i(null))}}serialize(){return e.l({},this._options)}},canvas:class extends e.aK{constructor(t,i,r,n){super(t,i,r,n),i.coordinates?Array.isArray(i.coordinates)&&4===i.coordinates.length&&!i.coordinates.some((e=>!Array.isArray(e)||2!==e.length||e.some((e=>"number"!=typeof e))))||this.fire(new e.z(new e.V(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new e.z(new e.V(`sources.${t}`,null,'missing required property "coordinates"'))),i.animate&&"boolean"!=typeof i.animate&&this.fire(new e.z(new e.V(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),i.canvas?"string"==typeof i.canvas||i.canvas instanceof HTMLCanvasElement||this.fire(new e.z(new e.V(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new e.z(new e.V(`sources.${t}`,null,'missing required property "canvas"'))),this.options=i,this.animate=void 0===i.animate||i.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new e.z(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(e){this.pause()}prepare(){let t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),this._hasInvalidDimensions())return;if(0===Object.keys(this.tiles).length)return;const i=this.map.painter.context;this.texture?!t&&!this._playing||this.texture instanceof e.aM||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new e.T(i,this.canvas,i.gl.RGBA8,{premultiply:!0}),this._prepareData(i)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}},custom:class extends e.E{constructor(t,i,r,n){super(),this.id=t,this.type="custom",this._dataType="raster",this._dispatcher=r,this._implementation=i,this.setEventedParent(n),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new e.z(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new e.z(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new et(this._implementation.bounds,this.minzoom,this.maxzoom)),i.update=this._update.bind(this),i.clearTiles=this._clearTiles.bind(this),i.coveringTiles=this._coveringTiles.bind(this),e.l(this,e.aA(i,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return e.aA(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new e.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new e.A("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(t){this.map=t,this._loaded=!1,this.fire(new e.A("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(t),this.load()}onRemove(e){this._implementation.onRemove&&this._implementation.onRemove(e)}hasTile(e){if(this._implementation.hasTile){const{x:t,y:i,z:r}=e.canonical;return this._implementation.hasTile({x:t,y:i,z:r})}return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e,t){const{x:i,y:r,z:n}=e.tileID.canonical,o=new AbortController;e.request=Promise.resolve(this._implementation.loadTile({x:i,y:r,z:n},{signal:o.signal})).then(function(i){return delete e.request,e.aborted?(e.state="unloaded",t(null)):void 0===i?(e.state="errored",t(null)):null===i?(this.loadTileData(e,{width:this.tileSize,height:this.tileSize,data:null}),e.state="loaded",t(null)):function(e){return e instanceof ImageData||e instanceof HTMLCanvasElement||e instanceof ImageBitmap||e instanceof HTMLImageElement}(i)?(this.loadTileData(e,i),e.state="loaded",void t(null)):(e.state="errored",t(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}.bind(this)).catch((i=>{"AbortError"!==i.name&&(e.state="errored",t(i))})),e.request.cancel=()=>o.abort()}loadTileData(e,t){e.setTexture(t,this.map.painter)}unloadTile(t,i){if(t.texture&&t.texture instanceof e.T?(t.destroy(!0),t.texture&&t.texture instanceof e.T&&this.map.painter.saveTileTexture(t.texture)):t.destroy(),this._implementation.unloadTile){const{x:e,y:i,z:r}=t.tileID.canonical;this._implementation.unloadTile({x:e,y:i,z:r})}i&&i()}abortTile(e,t){e.request&&e.request.cancel&&(e.request.cancel(),delete e.request),t&&t()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map((e=>({x:e.canonical.x,y:e.canonical.y,z:e.canonical.z})))}_clearTiles(){const t=e.C(this.id,this.scope);this.map.style.clearSource(t)}_update(){this.fire(new e.A("data",{dataType:"source",sourceDataType:"content"}))}}},ot=function(t,i,r,n){const o=new nt[i.type](t,i,r,n);if(o.id!==t)throw new Error(`Expected Source id to be ${t} instead of ${o.id}`);return e.aQ(["load","abort","unload","serialize","prepare"],o),o};function st(e,t,i=""){return`${i}:${t.id||""}:${t.layer.id}:${function(e){if("layerId"in e)return`layer:${e.layerId}`;{const{featuresetId:t,importId:i}=e;return`featureset:${t}${i?`:import:${i}`:""}`}}(e.target)}`}function at(e,t,i,r=""){if(e.uniqueFeatureID){const n=st(e,t,r);if(i.has(n))return!0;i.add(n)}return!1}function lt(e,t,i,r,n=!1){const o=t.sourceCache.transform,s=t.sourceCache.tilesIn(e,t.has3DLayers,n);s.sort(ht);const a=[];for(const e of s){const s=e.tile.queryRenderedFeatures(t,e,i,r,o,n);Object.keys(s).length&&a.push({wrappedTileID:e.tile.tileID.wrapped().key,queryResults:s})}return 0===a.length?{}:function(e){const t={},i={};for(const r of e){const e=r.queryResults,n=r.wrappedTileID,o=i[n]=i[n]||{};for(const i in e){const r=e[i],n=o[i]=o[i]||{},s=t[i]=t[i]||[];for(const e of r)n[e.featureIndex]||(n[e.featureIndex]=!0,s.push(e))}}return t}(a)}function ct(e,t,i,r,n){const o={},s=r.queryRenderedSymbols(e),a=[];for(const e of Object.keys(s).map(Number))a.push(n[e]);a.sort(ht);for(const e of a){const r=e.featureIndex.lookupSymbolFeatures(s[e.bucketInstanceId],e.bucketIndex,e.sourceLayerIndex,t,i);for(const t in r){const i=o[t]=o[t]||[],n=r[t];n.sort(((t,i)=>{const r=e.featureSortOrder;if(r){const e=r.indexOf(t.featureIndex);return r.indexOf(i.featureIndex)-e}return i.featureIndex-t.featureIndex}));for(const e of n)i.push(e)}}return o}function ut(e,t){const i=e.getRenderableIds().map((t=>e.getTileByID(t))),r=[],n={};for(let e=0;e<i.length;e++){const o=i[e],s=o.tileID.canonical.key;n[s]||(n[s]=!0,o.querySourceFeatures(r,t))}return r}function ht(e,t){const i=e.tileID,r=t.tileID;return i.overscaledZ-r.overscaledZ||i.canonical.y-r.canonical.y||i.wrap-r.wrap||i.canonical.x-r.canonical.x}function dt(e,t){const i={};if(!t)return i;for(const r of e){const e=r.layerIds.map((e=>t.getLayer(e))).filter(Boolean);if(0!==e.length){r.layers=e,r.stateDependentLayerIds&&(r.stateDependentLayers=r.stateDependentLayerIds.map((t=>e.filter((e=>e.id===t))[0])));for(const t of e)i[t.fqid]=r}}return i}const pt=32,ft=33,At=new Uint16Array(8184);for(let e=0;e<2046;e++){let t=e+2,i=0,r=0,n=0,o=0,s=0,a=0;for(1&t?n=o=s=pt:i=r=a=pt;(t>>=1)>1;){const e=i+n>>1,l=r+o>>1;1&t?(n=i,o=r,i=s,r=a):(i=n,r=o,n=s,o=a),s=e,a=l}const l=4*e;At[l+0]=i,At[l+1]=r,At[l+2]=n,At[l+3]=o}const mt=new Uint16Array(2178),gt=new Uint8Array(1089),_t=new Uint16Array(1089);function yt(e){return 0===e?-.03125:32===e?.03125:0}const vt={type:2,extent:e.ai,loadGeometry:()=>[[new e.P(0,0),new e.P(e.ai+1,0),new e.P(e.ai+1,e.ai+1),new e.P(0,e.ai+1),new e.P(0,0)]]};class xt{constructor(t,i,r,n,o){this.tileID=t,this.uid=e.aW(),this.uses=0,this.tileSize=i,this.tileZoom=r,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=o,n&&n.style&&(this._lastUpdatedBrightness=n.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",n&&n.transform&&(this.projection=n.transform.projection)}registerFadeDuration(t){const i=t+this.timeAdded;i<e.q.now()||this.fadeEndTime&&i<this.fadeEndTime||(this.fadeEndTime=i)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=e.aR(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(t,i,r){if(this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=dt(t.buckets,i.style),this.hasSymbolBuckets=!1;for(const t in this.buckets){const i=this.buckets[t];if(i instanceof e.aY){if(this.hasSymbolBuckets=!0,!r)break;i.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const t in this.buckets){const i=this.buckets[t];if(i instanceof e.aY&&i.hasRTLText){this.hasRTLText=!0,e.aZ();break}}this.queryPadding=0;for(const e in this.buckets){const t=this.buckets[e],r=i.style.getOwnLayer(e);if(!r)continue;const n=r.queryRadius(t);this.queryPadding=Math.max(this.queryPadding,n)}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),t.lineAtlas&&(this.lineAtlas=t.lineAtlas),this._lastUpdatedBrightness=t.brightness}else this.collisionBoxArray=new e.aX}unloadVectorData(){if(this.hasData()){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(e,t,i){e&&(e.resourceTiming&&(this.resourceTiming=e.resourceTiming),this.buckets=Object.assign({},this.buckets,dt(e.buckets,t.style)),e.featureIndex&&(this.latestFeatureIndex=e.featureIndex))}getBucket(e){return this.buckets[e.fqid]}upload(t){for(const e in this.buckets){const i=this.buckets[e];i.uploadPending()&&i.upload(t)}const i=t.gl,r=this.imageAtlas;r&&!r.uploaded&&(this.imageAtlasTexture=new e.T(t,r.image,i.RGBA8,{useMipmap:!!r.patternPositions.size}),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new e.T(t,this.glyphAtlasImage,i.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new e.T(t,this.lineAtlas.image,i.R8),this.lineAtlas.uploaded=!0)}prepare(e,t,i){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture,i),!t||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const r=t.style.getBrightness();(this._lastUpdatedBrightness||r)&&(this._lastUpdatedBrightness&&r&&Math.abs(this._lastUpdatedBrightness-r)<.001||(this.updateBuckets(t,this._lastUpdatedBrightness!==r),this._lastUpdatedBrightness=r))}queryRenderedFeatures(t,i,r,n,o,s){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const a=function(t,i){const r=e.ad.mat4.fromScaling([],[.5*t.width,.5*-t.height,1]);return e.ad.mat4.translate(r,r,[1,-1,0]),e.ad.mat4.multiply(r,r,t.calculateProjMatrix(i.toUnwrapped())),Float32Array.from(r)}(o,this.tileID);return this.latestFeatureIndex.query(t,{tilespaceGeometry:i,pixelPosMatrix:a,transform:n,availableImages:r,tileTransform:this.tileTransform})}querySourceFeatures(t,i){const r=this.latestFeatureIndex;if(!r||!r.rawTileData)return;const n=r.loadVTLayers(),o=i?i.sourceLayer:"",s=n._geojsonTileLayer||n[o];if(!s)return;const a=e.a_(i&&i.filter),{z:l,x:c,y:u}=this.tileID.canonical,h={z:l,x:c,y:u};for(let i=0;i<s.length;i++){const n=s.feature(i);if(a.needGeometry){const t=e.a$(n,!0);if(!a.filter(new e.aa(this.tileID.overscaledZ),t,this.tileID.canonical))continue}else if(!a.filter(new e.aa(this.tileID.overscaledZ),n))continue;const d=r.getId(n,o),p=new e.b0(n,l,c,u,d);p.tile=h,t.push(p)}}loaded(){return"loaded"===this.state||"errored"===this.state}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return!!this.imageAtlas&&!!this.imageAtlas.patternPositions.size}setExpiryData(t){const i=this.expirationTime;if(t.cacheControl){const i=e.b1(t.cacheControl);i["max-age"]&&(this.expirationTime=Date.now()+1e3*i["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const e=Date.now();let t=!1;if(this.expirationTime>e)t=!1;else if(i)if(this.expirationTime<i)t=!0;else{const r=this.expirationTime-i;r?this.expirationTime=e+Math.max(r,3e4):t=!0}else t=!0;t?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}refreshFeatureState(e){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&e&&this.updateBuckets(e)}updateBuckets(t,i){if(!this.latestFeatureIndex)return;if(!t.style)return;const r=this.latestFeatureIndex.loadVTLayers(),n=t.style.listImages(),o=t.style.getBrightness();for(const s in this.buckets){if(!t.style.hasLayer(s))continue;const a=this.buckets[s],l=a.layers[0],c=l.sourceLayer||"_geojsonTileLayer",u=r[c],h=t.style.getLayerSourceCache(l);let d={};h&&(d=h._state.getState(c,void 0));const p=this.imageAtlas?Object.fromEntries(this.imageAtlas.patternPositions):{},f=Object.keys(d).length>0&&!i;f&&!a.stateDependentLayers.length&&!i||a.update(d,u,n,p,f?a.stateDependentLayers:a.layers,i,o),(a instanceof e.b2||a instanceof e.b3)&&t._terrain&&t._terrain.enabled&&h&&a.uploadPending()&&t._terrain._clearRenderCacheForTile(h.id,this.tileID);const A=t&&t.style&&t.style.getOwnLayer(s);A&&(this.queryPadding=Math.max(this.queryPadding,A.queryRadius(a)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<e.q.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=e.q.now()+t}setTexture(t,i){const r=i.context,n=r.gl;this.texture=this.texture||i.getTileTexture(t.width),this.texture&&this.texture instanceof e.T?this.texture.update(t):(this.texture=new e.T(r,t,n.RGBA8,{useMipmap:!0}),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE))}setDependencies(e,t){const i={};for(const e of t)i[e]=!0;this.dependencies[e]=i}hasDependency(e,t){for(const i of e){const e=this.dependencies[i];if(e)for(const i of t)if(e[i])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(t,i){if(!i||"mercator"===i.name||this._tileDebugBuffer)return;const r=e.b4(vt,this.tileID.canonical,this.tileTransform)[0],n=new e.b5,o=new e.b6;for(let e=0;e<r.length;e++){const{x:t,y:i}=r[e];n.emplaceBack(t,i),o.emplaceBack(e)}o.emplaceBack(0),this._tileDebugIndexBuffer=t.createIndexBuffer(o),this._tileDebugBuffer=t.createVertexBuffer(n,e.b7.members),this._tileDebugSegments=e.b8.simpleSegment(0,0,n.length,o.length)}_makeTileBoundsBuffers(t,i){if(this._tileBoundsBuffer||!i||"mercator"===i.name)return;const r=e.b4(vt,this.tileID.canonical,this.tileTransform)[0];let n,o;if(this.isRaster){const t=function(t,i){const r=e.aR(t,i),n=Math.pow(2,t.z);for(let o=0;o<ft;o++)for(let s=0;s<ft;s++){const a=e.aS((t.x+(s+yt(s))/pt)/n),l=e.aT((t.y+(o+yt(o))/pt)/n),c=i.project(a,l),u=o*ft+s;mt[2*u+0]=Math.round((c.x*r.scale-r.x)*e.ai),mt[2*u+1]=Math.round((c.y*r.scale-r.y)*e.ai)}gt.fill(0),_t.fill(0);for(let e=2045;e>=0;e--){const t=4*e,i=At[t+0],r=At[t+1],n=At[t+2],o=At[t+3],s=i+n>>1,a=r+o>>1,l=s+a-r,c=a+i-s,u=r*ft+i,h=o*ft+n,d=a*ft+s,p=Math.hypot((mt[2*u+0]+mt[2*h+0])/2-mt[2*d+0],(mt[2*u+1]+mt[2*h+1])/2-mt[2*d+1])>=16;gt[d]=gt[d]||(p?1:0),e<1022&&(gt[d]=gt[d]||gt[(r+c>>1)*ft+(i+l>>1)]||gt[(o+c>>1)*ft+(n+l>>1)])}const o=new e.aU,s=new e.aV;let a=0;function l(t,i){const r=i*ft+t;return 0===_t[r]&&(o.emplaceBack(mt[2*r+0],mt[2*r+1],t*e.ai/pt,i*e.ai/pt),_t[r]=++a),_t[r]-1}function c(e,t,i,r,n,o){const a=e+i>>1,u=t+r>>1;if(Math.abs(e-n)+Math.abs(t-o)>1&&gt[u*ft+a])c(n,o,e,t,a,u),c(i,r,n,o,a,u);else{const a=l(e,t),c=l(i,r),u=l(n,o);s.emplaceBack(a,c,u)}}return c(0,0,pt,pt,pt,0),c(pt,pt,0,0,0,pt),{vertices:o,indices:s}}(this.tileID.canonical,i);n=t.vertices,o=t.indices}else{n=new e.aU,o=new e.aV;for(const{x:e,y:t}of r)n.emplaceBack(e,t,0,0);const t=e.b9(n.int16,void 0,4);for(let e=0;e<t.length;e+=3)o.emplaceBack(t[e],t[e+1],t[e+2])}this._tileBoundsBuffer=t.createVertexBuffer(n,e.ba.members),this._tileBoundsIndexBuffer=t.createIndexBuffer(o),this._tileBoundsSegments=e.b8.simpleSegment(0,0,n.length,o.length)}_makeGlobeTileDebugBuffers(t,i){const r=i.projection;if(!r||"globe"!==r.name||i.freezeTileCoverage)return;const n=this.tileID.canonical,o=e.bb(n,i),s=e.bc(o),a=e.ag(i.zoom);let l;a>0&&(l=e.ad.mat4.invert(new Float64Array(16),i.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(t,n,i,s,l,a),this._makeGlobeTileDebugTextBuffer(t,n,i,s,l,a)}_globePoint(t,i,r,n,o,s,a){let l=e.bd(t,i,r);if(s){const o=1<<r.z,c=e.av(n.center.lng),u=e.aC(n.center.lat),h=(r.x+.5)/o-c;let d=0;h>.5?d=-1:h<-.5&&(d=1);let p=(t/e.ai+r.x)/o+d,f=(i/e.ai+r.y)/o;p=(p-c)*n._pixelsPerMercatorPixel+c,f=(f-u)*n._pixelsPerMercatorPixel+u;const A=[p*n.worldSize,f*n.worldSize,0];e.ad.vec3.transformMat4(A,A,s),l=e.be(l,A,a)}return e.ad.vec3.transformMat4(l,l,o)}_makeGlobeTileDebugBorderBuffer(t,i,r,n,o,s){const a=new e.b5,l=new e.b6,c=new e.bf,u=(e,t,u,h,d)=>{const p=(u-e)/(d-1),f=(h-t)/(d-1),A=a.length;for(let u=0;u<d;u++){const h=e+u*p,d=t+u*f;a.emplaceBack(h,d);const m=this._globePoint(h,d,i,r,n,o,s);c.emplaceBack(m[0],m[1],m[2]),l.emplaceBack(A+u)}},h=e.ai;u(0,0,h,0,16),u(h,0,h,h,16),u(h,h,0,h,16),u(0,h,0,0,16),this._tileDebugIndexBuffer=t.createIndexBuffer(l),this._tileDebugBuffer=t.createVertexBuffer(a,e.b7.members),this._globeTileDebugBorderBuffer=t.createVertexBuffer(c,e.bg.members),this._tileDebugSegments=e.b8.simpleSegment(0,0,a.length,l.length)}_makeGlobeTileDebugTextBuffer(t,i,r,n,o,s){const a=e.ai/4,l=new e.b5,c=new e.aV,u=new e.bf,h=25;c.reserve(32),l.reserve(h),u.reserve(h);const d=(e,t)=>h*e+t;for(let e=0;e<h;e++){const t=e*a;for(let e=0;e<h;e++){const c=e*a;l.emplaceBack(c,t);const h=this._globePoint(c,t,i,r,n,o,s);u.emplaceBack(h[0],h[1],h[2])}}for(let e=0;e<4;e++)for(let t=0;t<4;t++){const i=d(e,t),r=d(e,t+1),n=d(e+1,t),o=d(e+1,t+1);c.emplaceBack(i,r,n),c.emplaceBack(n,r,o)}this._tileDebugTextIndexBuffer=t.createIndexBuffer(c),this._tileDebugTextBuffer=t.createVertexBuffer(l,e.b7.members),this._globeTileDebugTextBuffer=t.createVertexBuffer(u,e.bg.members),this._tileDebugTextSegments=e.b8.simpleSegment(0,0,h,32)}destroy(t=!1){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!t&&this.texture&&this.texture instanceof e.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}e.bh.setPbf(e.bi);class bt extends xt{constructor(e,t,i,r,n){super(e,t,i,r,n),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}getLayers(){return this._mrt?Object.values(this._mrt.layers):[]}getLayer(e){return this._mrt&&this._mrt.getLayer(e)}setTexture(t,i){const r=i.context,n=r.gl;this.texture=this.texture||i.getTileTexture(t.width),this.texture&&this.texture instanceof e.T?this.texture.update(t,{premultiply:!1}):this.texture=new e.T(r,t,n.RGBA8,{premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(t=16384,i){const r=this._mrt=new e.bh(30),n=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(t-1)}});return this.entireBuffer=null,this.request=e.bj(n,((e,n,o,s)=>{if(e)i(e);else try{const e=r.getHeaderLength(n);if(e>t)return void(this.request=this.fetchHeader(e,i));r.parseHeader(n),this._isHeaderLoaded=!0;let a=0;for(const e of Object.values(r.layers))a=Math.max(a,e.dataIndex[e.dataIndex.length-1].lastByte);n.byteLength>=a&&(this.entireBuffer=n),i(null,this.entireBuffer||n,o,s)}catch(e){i(e)}})),this.request}fetchBand(t,i,r){const n=this._mrt;if(!this._isHeaderLoaded||!n)return void r(new Error("Tile header is not ready"));const o=this.actor;if(!o)return void r(new Error("Can't fetch tile band without an actor"));let s;const a=(e,n)=>{s.complete(e,n),e?r(e):(this.updateTextureDescriptor(t,i),r(null,this.textureDescriptor&&this.textureDescriptor.img))},l=(e,t)=>{if(e)return r(e);const i=o.send("decodeRasterArray",{type:"raster-array",source:this.source,scope:this.scope,tileID:this.tileID,uid:this.uid,buffer:t,task:s},a,void 0,!0);this._workQueue.push((()=>{i&&i.cancel(),s.cancel()}))},c=n.getLayer(t);if(!c)return void r(new Error(`Unknown sourceLayer "${t}"`));if(c.hasDataForBand(i))return this.updateTextureDescriptor(t,i),void r(null,this.textureDescriptor?this.textureDescriptor.img:null);const u=c.getDataRange([i]);if(s=n.createDecodingTask(u),!s||s.tasks.length)if(this.flushQueues(),this.entireBuffer)l(null,this.entireBuffer.slice(u.firstByte,u.lastByte+1));else{const t=Object.assign({},this.requestParams,{headers:{Range:`bytes=${u.firstByte}-${u.lastByte}`}}),i=e.bj(t,l);this._fetchQueue.push((()=>{i.cancel(),s.cancel()}))}else r(null)}updateNeeded(e,t){return(!this.textureDescriptor||this.textureDescriptor.band!==t||this.textureDescriptor.layer!==e)&&"errored"!==this.state}updateTextureDescriptor(t,i){if(!this._mrt)return;const r=this._mrt.getLayer(t);if(!r||!r.hasBand(i)||!r.hasDataForBand(i))return;const{bytes:n,tileSize:o,buffer:s,offset:a,scale:l}=r.getBandView(i),c=o+2*s,u=new e.r({width:c,height:c},n),h=this.texture;h&&h instanceof e.T&&h.update(u,{premultiply:!1}),this.textureDescriptor={layer:t,band:i,img:u,buffer:s,offset:a,tileSize:o,format:r.pixelFormat,mix:[l,256*l,65536*l,16777216*l]}}}class wt{constructor(e,t){this.max=e,this.onRemove=t,this.reset()}reset(){for(const e in this.data)for(const t of this.data[e])t.timeout&&clearTimeout(t.timeout),this.onRemove(t.value);return this.data={},this.order=[],this}add(e,t,i){const r=e.wrapped().key;void 0===this.data[r]&&(this.data[r]=[]);const n={value:t,timeout:void 0};if(void 0!==i&&(n.timeout=setTimeout((()=>{this.remove(e,n)}),i)),this.data[r].push(n),this.order.push(r),this.order.length>this.max){const e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const t=this.data[e].shift();return t.timeout&&clearTimeout(t.timeout),0===this.data[e].length&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),t.value}getByKey(e){const t=this.data[e];return t?t[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,t){if(!this.has(e))return this;const i=e.wrapped().key,r=void 0===t?0:this.data[i].indexOf(t),n=this.data[i][r];return this.data[i].splice(r,1),n.timeout&&clearTimeout(n.timeout),0===this.data[i].length&&delete this.data[i],this.onRemove(n.value),this.order.splice(this.order.indexOf(i),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e)}return this}filter(e){const t=[];for(const i in this.data)for(const r of this.data[i])e(r.value)||t.push(r);for(const e of t)this.remove(e.value.tileID,e)}}class Tt{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,i,r){const n=String(i);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][n]=this.stateChanges[t][n]||{},e.l(this.stateChanges[t][n],r),null===this.deletedStates[t]){this.deletedStates[t]={};for(const e in this.state[t])e!==n&&(this.deletedStates[t][e]=null)}else if(this.deletedStates[t]&&null===this.deletedStates[t][n]){this.deletedStates[t][n]={};for(const e in this.state[t][n])r[e]||(this.deletedStates[t][n][e]=null)}else for(const e in r)this.deletedStates[t]&&this.deletedStates[t][n]&&null===this.deletedStates[t][n][e]&&delete this.deletedStates[t][n][e]}removeFeatureState(e,t,i){if(null===this.deletedStates[e])return;const r=String(t);if(this.deletedStates[e]=this.deletedStates[e]||{},i&&void 0!==t)null!==this.deletedStates[e][r]&&(this.deletedStates[e][r]=this.deletedStates[e][r]||{},this.deletedStates[e][r][i]=null);else if(void 0!==t)if(this.stateChanges[e]&&this.stateChanges[e][r])for(i in this.deletedStates[e][r]={},this.stateChanges[e][r])this.deletedStates[e][r][i]=null;else this.deletedStates[e][r]=null;else this.deletedStates[e]=null}getState(t,i){const r=this.state[t]||{},n=this.stateChanges[t]||{},o=this.deletedStates[t];if(null===o)return{};if(void 0!==i){const t=String(i),s=e.l({},r[t],n[t]);if(o){const e=o[i];if(null===e)return{};for(const t in e)delete s[t]}return s}const s=e.l({},r,n);if(o)for(const e in o)delete s[e];return s}initializeTileState(e,t){e.refreshFeatureState(t)}coalesceChanges(t,i){const r={};for(const t in this.stateChanges){this.state[t]=this.state[t]||{};const i={};for(const r in this.stateChanges[t])this.state[t][r]||(this.state[t][r]={}),e.l(this.state[t][r],this.stateChanges[t][r]),i[r]=this.state[t][r];r[t]=i}for(const t in this.deletedStates){this.state[t]=this.state[t]||{};const i={};if(null===this.deletedStates[t])for(const e in this.state[t])i[e]={},this.state[t][e]={};else for(const e in this.deletedStates[t]){if(null===this.deletedStates[t][e])this.state[t][e]={};else if(this.state[t][e])for(const i of Object.keys(this.deletedStates[t][e]))delete this.state[t][e][i];i[e]=this.state[t][e]}r[t]=r[t]||{},e.l(r[t],i)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(r).length)for(const e in t)t[e].refreshFeatureState(i)}}class Bt extends e.E{constructor(e,t,i){super(),this.id=e,this._onlySymbols=i,t.on("data",(e=>{"source"===e.dataType&&"metadata"===e.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===e.dataType&&"content"===e.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))})),t.on("error",(()=>{this._sourceErrored=!0})),this._source=t,this._tiles={},this._cache=new wt(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=t.minTileCacheSize,this._maxTileCacheSize=t.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new Tt,this._isRaster="raster"===this._source.type||"raster-dem"===this._source.type||"raster-array"===this._source.type||"custom"===this._source.type&&"raster"===this._source._dataType}onAdd(e){this.map=e,this._minTileCacheSize=void 0===this._minTileCacheSize&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=void 0===this._maxTileCacheSize&&e?e._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded)return!1;if(!this._source.loaded())return!1;for(const e in this._tiles)if(!this._tiles[e].loaded())return!1;return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,t){return e.isSymbolTile=this._onlySymbols,e.isExtraShadowCaster=this._shadowCasterTiles[e.tileID.key],this._source.loadTile(e,t)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e)}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e)}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const t in this._tiles){const i=this._tiles[t];i.upload(e),i.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Object.values(this._tiles).map((e=>e.tileID)).sort(Ct).map((e=>e.key))}getRenderableIds(t,i){const r=[];for(const e in this._tiles)this._isIdRenderable(+e,t,i)&&r.push(this._tiles[e]);return t?r.sort(((t,i)=>{const r=t.tileID,n=i.tileID,o=new e.P(r.canonical.x,r.canonical.y)._rotate(this.transform.angle),s=new e.P(n.canonical.x,n.canonical.y)._rotate(this.transform.angle);return r.overscaledZ-n.overscaledZ||s.y-o.y||s.x-o.x})).map((e=>e.tileID.key)):r.map((e=>e.tileID)).sort(Ct).map((e=>e.key))}hasRenderableParent(e){const t=this.findLoadedParent(e,0);return!!t&&this._isIdRenderable(t.tileID.key)}_isIdRenderable(e,t,i){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(t||!this._tiles[e].holdingForFade())&&(i||!this._shadowCasterTiles[e])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)"errored"!==this._tiles[e].state&&this._reloadTile(+e,"reloading")}}_reloadTile(e,t){const i=this._tiles[e];i&&("loading"!==i.state&&(i.state=t),this._loadTile(i,this._tileLoaded.bind(this,i,e,t)))}_tileLoaded(t,i,r,n){if(n)if(t.state="errored",404!==n.status)this._source.fire(new e.z(n,{tile:t}));else{if(this._source.fire(new e.A("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:t})),!(t.tileID.key in this._loadedParentTiles))return;if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const e=this.map.painter.terrain;this.update(this.transform,e.getScaledDemTileSize(),!0),e.resetTileLookupCache(this.id)}else this.update(this.transform)}else t.timeAdded=e.q.now(),"expired"===r&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(i,t),"raster-dem"===this._source.type&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),this._source.fire(new e.A("data",{dataType:"source",tile:t,coord:t.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const t=this.getRenderableIds();for(let r=0;r<t.length;r++){const n=t[r];if(e.neighboringTiles&&e.neighboringTiles[n]){const t=this.getTileByID(n);i(e,t),i(t,e)}}function i(e,t){if(!e.dem||e.dem.borderReady)return;e.needsHillshadePrepare=!0,e.needsDEMTextureUpload=!0;let i=t.tileID.canonical.x-e.tileID.canonical.x;const r=t.tileID.canonical.y-e.tileID.canonical.y,n=Math.pow(2,e.tileID.canonical.z),o=t.tileID.key;0===i&&0===r||Math.abs(r)>1||(Math.abs(i)>1&&(1===Math.abs(i+n)?i+=n:1===Math.abs(i-n)&&(i-=n)),t.dem&&e.dem&&(e.dem.backfillBorder(t.dem,i,r),e.neighboringTiles&&e.neighboringTiles[o]&&(e.neighboringTiles[o].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,t,i,r){for(const n in this._tiles){let o=this._tiles[n];if(r[n]||!o.hasData()||o.tileID.overscaledZ<=t||o.tileID.overscaledZ>i)continue;let s=o.tileID;for(;o&&o.tileID.overscaledZ>t+1;){const e=o.tileID.scaledTo(o.tileID.overscaledZ-1);o=this._tiles[e.key],o&&o.hasData()&&(s=e)}let a=s;for(;a.overscaledZ>t;)if(a=a.scaledTo(a.overscaledZ-1),e[a.key]){r[s.key]=s;break}}}findLoadedParent(e,t){if(e.key in this._loadedParentTiles){const i=this._loadedParentTiles[e.key];return i&&i.tileID.overscaledZ>=t?i:null}for(let i=e.overscaledZ-1;i>=t;i--){const t=e.scaledTo(i),r=this._getLoadedTile(t);if(r)return r}}_getLoadedTile(e){const t=this._tiles[e.key];return t&&t.hasData()?t:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,t){t=t||this._source.tileSize;const i=Math.ceil(e.width/t)+1,r=Math.ceil(e.height/t)+1,n=Math.floor(i*r*5),o="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,n):n,s="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,o):o;this._cache.setMaxSize(s)}handleWrapJump(e){const t=Math.round((e-(void 0===this._prevLng?e:this._prevLng))/360);if(this._prevLng=e,t){const e={};for(const i in this._tiles){const r=this._tiles[i];r.tileID=r.tileID.unwrapTo(r.tileID.wrap+t),e[r.tileID.key]=r}this._tiles=e;for(const e in this._timers)clearTimeout(this._timers[e]),delete this._timers[e];for(const e in this._tiles)this._setTileReloadTimer(+e,this._tiles[e])}}update(t,i,r,n){if(this.transform=t,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage)return;if(this.usedForTerrain&&!r)return;this.updateCacheSize(t,i),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const o="batched-model"===this._source.type;let s,a=this._source.maxzoom;const l=this.map&&this.map.painter?this.map.painter._terrain:null;if(l&&l.sourceCache===this&&l.attenuationRange()){const e=l.attenuationRange()[0],t=Math.floor(e)-Math.log2(l.getDemUpscale());a>t&&(a=t)}if(this.used||this.usedForTerrain){if(this._source.tileID)s=t.getVisibleUnwrappedCoordinates(this._source.tileID).map((t=>new e.aH(t.canonical.z,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y)));else if(0!==this.tileCoverLift){const n=t.clone();n.tileCoverLift=this.tileCoverLift,s=n.coveringTiles({tileSize:i||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:a,roundZoom:this._source.roundZoom&&!r,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:o}),this._source.minzoom<=1&&"globe"===t.projection.name&&(s.push(new e.aH(1,0,1,0,0)),s.push(new e.aH(1,0,1,1,0)),s.push(new e.aH(1,0,1,0,1)),s.push(new e.aH(1,0,1,1,1)))}else if(s=t.coveringTiles({tileSize:i||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:a,roundZoom:this._source.roundZoom&&!r,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:o}),this._source.hasTile){const e=this._source.hasTile.bind(this._source);s=s.filter((t=>e(t)))}}else s=[];if(s.length>0&&this.castsShadows&&n&&"globe"!==this.transform.projection.name&&!this.usedForTerrain&&!St(this._source.type)){const e=t.coveringZoomLevel({tileSize:i||this._source.tileSize,roundZoom:this._source.roundZoom&&!r}),a=Math.min(e,this._source.maxzoom);if(o){const e=t.extendTileCover(s,a);for(const t of e)s.push(t)}else{const e=t.extendTileCover(s,a,n);for(const t of e)this._shadowCasterTiles[t.key]=!0,s.push(t)}}const c=this._updateRetainedTiles(s);if(St(this._source.type)&&0!==s.length){const t={},i={},r=Object.keys(c);for(const n of r){const r=c[n],o=this._tiles[n];if(!o||o.fadeEndTime&&o.fadeEndTime<=e.q.now())continue;const s=this.findLoadedParent(r,Math.max(r.overscaledZ-Bt.maxOverzooming,this._source.minzoom));s&&(this._addTile(s.tileID),t[s.tileID.key]=s.tileID),i[n]=r}const n=s[s.length-1].overscaledZ;for(const e in this._tiles){const t=this._tiles[e];if(c[e]||!t.hasData())continue;let r=t.tileID;for(;r.overscaledZ>n;){r=r.scaledTo(r.overscaledZ-1);const n=this._tiles[r.key];if(n&&n.hasData()&&i[r.key]){c[e]=t.tileID;break}}}for(const e in t)c[e]||(this._coveredTiles[e]=!0,c[e]=t[e])}for(const e in c)this._tiles[e].clearFadeHold();const u=e.bk(this._tiles,c);for(const e of u){const t=this._tiles[e];t.hasSymbolBuckets&&!t.holdingForFade()?t.setHoldDuration(this.map._fadeDuration):t.hasSymbolBuckets&&!t.symbolFadeFinished()||this._removeTile(+e)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const t={};if(0===e.length)return t;const i={},r=e.reduce(((e,t)=>Math.min(e,t.overscaledZ)),1/0),n=e[0].overscaledZ,o=Math.max(n-Bt.maxOverzooming,this._source.minzoom),s=Math.max(n+Bt.maxUnderzooming,this._source.minzoom),a={};for(const i of e){const e=this._addTile(i);t[i.key]=i,e.hasData()||r<this._source.maxzoom&&(a[i.key]=i)}this._retainLoadedChildren(a,r,s,t);for(const r of e){let e=this._tiles[r.key];if(e.hasData())continue;if(r.canonical.z>=this._source.maxzoom){const e=r.children(this._source.maxzoom)[0],i=this.getTile(e);if(i&&i.hasData()){t[e.key]=e;continue}}else{const e=r.children(this._source.maxzoom);if(t[e[0].key]&&t[e[1].key]&&t[e[2].key]&&t[e[3].key])continue}let n=e.wasRequested();for(let s=r.overscaledZ-1;s>=o;--s){const o=r.scaledTo(s);if(i[o.key])break;if(i[o.key]=!0,e=this.getTile(o),!e&&n&&(e=this._addTile(o)),e&&(t[o.key]=o,n=e.wasRequested(),e.hasData()))break}}return t}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const t=[];let i,r=this._tiles[e].tileID;for(;r.overscaledZ>0;){if(r.key in this._loadedParentTiles){i=this._loadedParentTiles[r.key];break}t.push(r.key);const e=r.scaledTo(r.overscaledZ-1);if(i=this._getLoadedTile(e),i)break;r=e}for(const e of t)this._loadedParentTiles[e]=i}}_addTile(t){let i=this._tiles[t.key];if(i)return!0!==i.isExtraShadowCaster||!!this._shadowCasterTiles[t.key]||this._reloadTile(t.key,"reloading"),i;i=this._cache.getAndRemove(t),i&&(this._setTileReloadTimer(t.key,i),i.tileID=t,this._state.initializeTileState(i,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,i)));const r=Boolean(i);if(!r){const e=this.map?this.map.painter:null,r=this._source.tileSize*t.overscaleFactor();i="raster-array"===this._source.type?new bt(t,r,this.transform.tileZoom,e,this._isRaster):new xt(t,r,this.transform.tileZoom,e,this._isRaster),this._loadTile(i,this._tileLoaded.bind(this,i,t.key,i.state))}return i?(i.uses++,this._tiles[t.key]=i,r||this._source.fire(new e.A("dataloading",{tile:i,coord:i.tileID,dataType:"source"})),i):null}_setTileReloadTimer(e,t){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const i=t.getExpiryTimeout();i&&(this._timers[e]=setTimeout((()=>{this._reloadTile(e,"expired"),delete this._timers[e]}),i))}_removeTile(e){const t=this._tiles[e];t&&(t.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),t.uses>0||(t.hasData()&&"reloading"!==t.state||"empty"===t.state?this._cache.add(t.tileID,t,t.getExpiryTimeout()):(t.aborted=!0,this._abortTile(t),this._unloadTile(t))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(t,i,r){const n=[],o=this.transform;if(!o)return n;const s="globe"===o.projection.name,a=e.av(o.center.lng);for(const l in this._tiles){const c=this._tiles[l];if(r&&c.clearQueryDebugViz(),c.holdingForFade())continue;let u;if(s){const t=c.tileID.canonical;if(0===t.z){const i=[Math.abs(e.ay(a,...Et(t,-1))-a),Math.abs(e.ay(a,...Et(t,1))-a)];u=[0,2*i.indexOf(Math.min(...i))-1]}else{const i=[Math.abs(e.ay(a,...Et(t,-1))-a),Math.abs(e.ay(a,...Et(t,0))-a),Math.abs(e.ay(a,...Et(t,1))-a)];u=[i.indexOf(Math.min(...i))-1]}}else u=[0];for(const e of u){const r=t.containsTile(c,o,i,e);r&&n.push(r)}}return n}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(e){return this._getRenderableCoordinates(e)}_getRenderableCoordinates(e,t){const i=this.getRenderableIds(e,t).map((e=>this._tiles[e].tileID)),r="globe"===this.transform.projection.name;for(const e of i)e.projMatrix=this.transform.calculateProjMatrix(e.toUnwrapped()),e.expandedProjMatrix=r?this.transform.calculateProjMatrix(e.toUnwrapped(),!1,!0):e.projMatrix;return i}sortCoordinatesByDistance(e){const t=e.slice(),i=this.transform._camera.position,r=this.transform._camera.forward(),n={};for(const e of t){const t=1/(1<<e.canonical.z);n[e.key]=((e.canonical.x+.5)*t+e.wrap-i[0])*r[0]+((e.canonical.y+.5)*t-i[1])*r[1]-i[2]*r[2]}return t.sort(((e,t)=>n[e.key]-n[t.key])),t}hasTransition(){if(this._source.hasTransition())return!0;if(St(this._source.type))for(const t in this._tiles){const i=this._tiles[t];if(void 0!==i.fadeEndTime&&i.fadeEndTime>=e.q.now())return!0}return!1}setFeatureState(e,t,i){this._state.updateState(e=e||"_geojsonTileLayer",t,i)}removeFeatureState(e,t,i){this._state.removeFeatureState(e=e||"_geojsonTileLayer",t,i)}getFeatureState(e,t){return this._state.getState(e=e||"_geojsonTileLayer",t)}setDependencies(e,t,i){const r=this._tiles[e];r&&r.setDependencies(t,i)}reloadTilesForDependencies(e,t){for(const i in this._tiles)this._tiles[i].hasDependency(e,t)&&this._reloadTile(+i,"reloading");this._cache.filter((i=>!i.hasDependency(e,t)))}_preloadTiles(t,i){if(!this._sourceLoaded){const e=()=>{this._sourceLoaded&&(this._source.off("data",e),this._preloadTiles(t,i))};return void this._source.on("data",e)}const r=new Map,n=Array.isArray(t)?t:[t],o=this.map.painter.terrain,s=this.usedForTerrain&&o?o.getScaledDemTileSize():this._source.tileSize;for(const e of n){const t=e.coveringTiles({tileSize:s,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const e of t)r.set(e.key,e);this.usedForTerrain&&e.updateElevation(!1)}const a=Array.from(r.values());e.bl(a,((e,t)=>{const i=new xt(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(i,(e=>{"raster-dem"===this._source.type&&i.dem&&this._backfillDEM(i),t(e,i)}))}),i)}}function Ct(e,t){const i=Math.abs(2*e.wrap)-+(e.wrap<0),r=Math.abs(2*t.wrap)-+(t.wrap<0);return e.overscaledZ-t.overscaledZ||r-i||t.canonical.y-e.canonical.y||t.canonical.x-e.canonical.x}function St(e){return"raster"===e||"image"===e||"video"===e||"custom"===e}function Et(e,t){const i=1<<e.z;return[e.x/i+t,(e.x+1)/i+t]}Bt.maxOverzooming=10,Bt.maxUnderzooming=3;class Mt{constructor(e){this.style=e,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const e=!1,t=!1;for(const i in this.style._mergedLayers){const r=this.style._mergedLayers[i];if("fill-extrusion"===r.type)this.layers.push({layer:r,visible:e,visibilityChanged:t});else if("model"===r.type){const i=this.style.getLayerSource(r);i&&"batched-model"===i.type&&this.layers.push({layer:r,visible:e,visibilityChanged:t})}}}onNewFrame(e){this.layersGotHidden=!1;for(const t of this.layers){const i=t.layer;let r=!1;"fill-extrusion"===i.type?r=!i.isHidden(e)&&i.paint.get("fill-extrusion-opacity")>0:"model"===i.type&&(r=!i.isHidden(e)&&i.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!r&&t.visible,t.visible=r}}updateZOffset(e,t){this.currentBuildingBuckets=[];for(const e of this.layers){const i=e.layer,r=this.style.getLayerSourceCache(i);let n=1;"fill-extrusion"===i.type&&(n=e.visible?i.paint.get("fill-extrusion-vertical-scale"):0);let o=r?r.getTile(t):null;if(!o&&r&&t.canonical.z>r.getSource().minzoom){let e=t.scaledTo(Math.min(r.getSource().maxzoom,t.overscaledZ-1));for(;e.overscaledZ>=r.getSource().minzoom&&(o=r.getTile(e),!o&&0!==e.overscaledZ);)e=e.scaledTo(e.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:o?o.getBucket(i):null,tileID:o?o.tileID:t,verticalScale:n})}e.hasAnyZOffset=!1;let i=!1;for(let r=0;r<e.symbolInstances.length;r++){const n=e.symbolInstances.get(r),o=n.zOffset,s=this._getHeightAtTileOffset(t,n.tileAnchorX,n.tileAnchorY);n.zOffset=s!==Number.NEGATIVE_INFINITY?s:o,i||o===n.zOffset||(i=!0),e.hasAnyZOffset||0===n.zOffset||(e.hasAnyZOffset=!0)}i&&(e.zOffsetBuffersNeedUpload=!0,e.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(t,i,r,n){let o=i,s=r;if(t.canonical.z!==n.canonical.z){const a=n.canonical,l=1/(1<<t.canonical.z-a.z);o=(i+t.canonical.x*e.ai)*l-a.x*e.ai|0,s=(r+t.canonical.y*e.ai)*l-a.y*e.ai|0}return{tileX:o,tileY:s}}_getHeightAtTileOffset(e,t,i){let r,n;for(let o=0;o<this.layers.length;++o){if("fill-extrusion"!==this.layers[o].layer.type)continue;const{bucket:s,tileID:a,verticalScale:l}=this.currentBuildingBuckets[o];if(!s)continue;const{tileX:c,tileY:u}=this._mapCoordToOverlappingTile(e,t,i,a),h=s.getHeightAtTileCoord(c,u);h&&void 0!==h.height&&(h.hidden?r=h.height:n=Math.max(h.height*l,n||0))}if(void 0!==n)return n;for(let n=0;n<this.layers.length;++n){const o=this.layers[n];if("model"!==o.layer.type||!o.visible)continue;const{bucket:s,tileID:a}=this.currentBuildingBuckets[n];if(!s)continue;const{tileX:l,tileY:c}=this._mapCoordToOverlappingTile(e,t,i,a),u=s.getHeightAtTileCoord(l,c);if(u&&!u.hidden)return void 0===u.height&&void 0!==r?Math.min(u.maxHeight,r)*u.verticalScale:u.height?u.height*u.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function It(t,i){const r={};for(const e in t)"ref"!==e&&(r[e]=t[e]);return e.bm.forEach((e=>{e in i&&(r[e]=i[e])})),r}function Pt(e){e=e.slice();const t=Object.create(null);for(let i=0;i<e.length;i++)t[e[i].id]=e[i];for(let i=0;i<e.length;i++)"ref"in e[i]&&(e[i]=It(e[i],t[e[i].ref]));return e}const Lt={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport",addIconset:"addIconset",removeIconset:"removeIconset"};function Ft(e,t,i){i.push({command:Lt.addSource,args:[e,t[e]]})}function kt(e,t,i){t.push({command:Lt.removeSource,args:[e]}),i[e]=!0}function zt(e,t,i,r){kt(e,i,r),Ft(e,t,i)}function Rt(t,i,r){let n;for(n in t[r])if(t[r].hasOwnProperty(n)&&"data"!==n&&!e.bn(t[r][n],i[r][n]))return!1;for(n in i[r])if(i[r].hasOwnProperty(n)&&"data"!==n&&!e.bn(t[r][n],i[r][n]))return!1;return!0}function Dt(t,i,r,n,o,s){let a;for(a in i=i||{},t=t||{})t.hasOwnProperty(a)&&(e.bn(t[a],i[a])||r.push({command:s,args:[n,a,i[a],o]}));for(a in i)i.hasOwnProperty(a)&&!t.hasOwnProperty(a)&&(e.bn(t[a],i[a])||r.push({command:s,args:[n,a,i[a],o]}))}function Ot(e){return e.id}function Ut(e,t){return e[t.id]=t,e}class Nt{constructor(e,t){this.reset(e,t)}reset(e,t){this.points=e||[],this._distances=[0];for(let e=1;e<this.points.length;e++)this._distances[e]=this._distances[e-1]+this.points[e].dist(this.points[e-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(t||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(1===this.points.length)return this.points[0];t=e.ay(t,0,1);let i=1,r=this._distances[i];const n=t*this.paddedLength+this.padding;for(;r<n&&i<this._distances.length;)r=this._distances[++i];const o=i-1,s=this._distances[o],a=r-s,l=a>0?(n-s)/a:0;return this.points[o].mult(1-l).add(this.points[i].mult(l))}}class Qt{constructor(e,t,i){const r=this.boxCells=[],n=this.circleCells=[];this.xCellCount=Math.ceil(e/i),this.yCellCount=Math.ceil(t/i);for(let e=0;e<this.xCellCount*this.yCellCount;e++)r.push([]),n.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=t,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/t,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,t,i,r,n){this._forEachCell(t,i,r,n,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(t),this.bboxes.push(i),this.bboxes.push(r),this.bboxes.push(n)}insertCircle(e,t,i,r){this._forEachCell(t-r,i-r,t+r,i+r,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(t),this.circles.push(i),this.circles.push(r)}_insertBoxCell(e,t,i,r,n,o){this.boxCells[n].push(o)}_insertCircleCell(e,t,i,r,n,o){this.circleCells[n].push(o)}_query(e,t,i,r,n,o){if(i<0||e>this.width||r<0||t>this.height)return!n&&[];const s=[];if(e<=0&&t<=0&&this.width<=i&&this.height<=r){if(n)return!0;for(let e=0;e<this.boxKeys.length;e++)s.push({key:this.boxKeys[e],x1:this.bboxes[4*e],y1:this.bboxes[4*e+1],x2:this.bboxes[4*e+2],y2:this.bboxes[4*e+3]});for(let e=0;e<this.circleKeys.length;e++){const t=this.circles[3*e],i=this.circles[3*e+1],r=this.circles[3*e+2];s.push({key:this.circleKeys[e],x1:t-r,y1:i-r,x2:t+r,y2:i+r})}return o?s.filter(o):s}return this._forEachCell(e,t,i,r,this._queryCell,s,{hitTest:n,seenUids:{box:{},circle:{}}},o),n?s.length>0:s}_queryCircle(e,t,i,r,n){const o=e-i,s=e+i,a=t-i,l=t+i;if(s<0||o>this.width||l<0||a>this.height)return!r&&[];const c=[];return this._forEachCell(o,a,s,l,this._queryCellCircle,c,{hitTest:r,circle:{x:e,y:t,radius:i},seenUids:{box:{},circle:{}}},n),r?c.length>0:c}query(e,t,i,r,n){return this._query(e,t,i,r,!1,n)}hitTest(e,t,i,r,n){return this._query(e,t,i,r,!0,n)}hitTestCircle(e,t,i,r){return this._queryCircle(e,t,i,!0,r)}_queryCell(e,t,i,r,n,o,s,a){const l=s.seenUids,c=this.boxCells[n];if(null!==c){const n=this.bboxes;for(const u of c)if(!l.box[u]){l.box[u]=!0;const c=4*u;if(e<=n[c+2]&&t<=n[c+3]&&i>=n[c+0]&&r>=n[c+1]&&(!a||a(this.boxKeys[u]))){if(s.hitTest)return o.push(!0),!0;o.push({key:this.boxKeys[u],x1:n[c],y1:n[c+1],x2:n[c+2],y2:n[c+3]})}}}const u=this.circleCells[n];if(null!==u){const n=this.circles;for(const c of u)if(!l.circle[c]){l.circle[c]=!0;const u=3*c;if(this._circleAndRectCollide(n[u],n[u+1],n[u+2],e,t,i,r)&&(!a||a(this.circleKeys[c]))){if(s.hitTest)return o.push(!0),!0;{const e=n[u],t=n[u+1],i=n[u+2];o.push({key:this.circleKeys[c],x1:e-i,y1:t-i,x2:e+i,y2:t+i})}}}}}_queryCellCircle(e,t,i,r,n,o,s,a){const l=s.circle,c=s.seenUids,u=this.boxCells[n];if(null!==u){const e=this.bboxes;for(const t of u)if(!c.box[t]){c.box[t]=!0;const i=4*t;if(this._circleAndRectCollide(l.x,l.y,l.radius,e[i+0],e[i+1],e[i+2],e[i+3])&&(!a||a(this.boxKeys[t])))return o.push(!0),!0}}const h=this.circleCells[n];if(null!==h){const e=this.circles;for(const t of h)if(!c.circle[t]){c.circle[t]=!0;const i=3*t;if(this._circlesCollide(e[i],e[i+1],e[i+2],l.x,l.y,l.radius)&&(!a||a(this.circleKeys[t])))return o.push(!0),!0}}}_forEachCell(e,t,i,r,n,o,s,a){const l=this._convertToXCellCoord(e),c=this._convertToYCellCoord(t),u=this._convertToXCellCoord(i),h=this._convertToYCellCoord(r);for(let d=l;d<=u;d++)for(let l=c;l<=h;l++)if(n.call(this,e,t,i,r,this.xCellCount*l+d,o,s,a))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,t,i,r,n,o){const s=r-e,a=n-t,l=i+o;return l*l>s*s+a*a}_circleAndRectCollide(e,t,i,r,n,o,s){const a=(o-r)/2,l=Math.abs(e-(r+a));if(l>a+i)return!1;const c=(s-n)/2,u=Math.abs(t-(n+c));if(u>c+i)return!1;if(l<=a||u<=c)return!0;const h=l-a,d=u-c;return h*h+d*d<=i*i}}const jt={unknown:0,flipRequired:1,flipNotRequired:2},Vt=Math.tan(85*Math.PI/180);function Ht(t,i,r,n,o,s,a){const l=e.ad.mat4.create();if(r)if("globe"===s.name){const t=e.bo(o,i);e.ad.mat4.multiply(l,l,t)}else{const t=e.ad.mat2.invert([],a);l[0]=t[0],l[1]=t[1],l[4]=t[2],l[5]=t[3],n||e.ad.mat4.rotateZ(l,l,o.angle)}else e.ad.mat4.multiply(l,o.labelPlaneMatrix,t);return l}function Gt(e,t,i,r,n,o,s){const a=Ht(e,t,i,r,n,o,s);return"globe"===o.name&&i||(a[2]=a[6]=a[10]=a[14]=0),a}function $t(t,i,r,n,o,s,a){if(r){if("globe"===s.name){const l=Ht(t,i,r,n,o,s,a);return e.ad.mat4.invert(l,l),e.ad.mat4.multiply(l,t,l),l}{const i=e.ad.mat4.clone(t),r=e.ad.mat4.identity([]);return r[0]=a[0],r[1]=a[1],r[4]=a[2],r[5]=a[3],e.ad.mat4.multiply(i,i,r),n||e.ad.mat4.rotateZ(i,i,-o.angle),i}}return o.glCoordMatrix}function Zt(t,i,r,n){const o=[t,i,r,1];r?e.ad.vec4.transformMat4(o,o,n):ni(o,o,n);const s=o[3];return o[0]/=s,o[1]/=s,o[2]/=s,o}function qt(e,t){return Math.min(.5+e/t*.5,1.5)}function Kt(e,t){const i=e[0]/e[3],r=e[1]/e[3];return i>=-t[0]&&i<=t[0]&&r>=-t[1]&&r<=t[1]}function Wt(t,i,r,n,o,s,a,l,c,u){const h=r.transform,d=n?t.textSizeData:t.iconSizeData,p=e.bp(d,r.transform.zoom),f="globe"===h.projection.name,A=[256/r.width*2+1,256/r.height*2+1],m=n?t.text.dynamicLayoutVertexArray:t.icon.dynamicLayoutVertexArray;m.clear();let g=null;f&&(g=n?t.text.globeExtVertexArray:t.icon.globeExtVertexArray);const _=t.lineVertexArray,y=n?t.text.placedSymbolArray:t.icon.placedSymbolArray,v=r.transform.width/r.transform.height;let x,b=!1;for(let n=0;n<y.length;n++){const f=y.get(n),{numGlyphs:w,writingMode:T}=f;if(T!==e.bq.vertical||b||x===e.bq.horizontal||(b=!0),x=T,(f.hidden||T===e.bq.vertical)&&!b){ri(w,m);continue}b=!1;const B=new e.P(f.tileAnchorX,f.tileAnchorY);let{x:C,y:S,z:E}=h.projection.projectTilePoint(B.x,B.y,u.canonical);if(c){const[e,t,i]=c(B);C+=e,S+=t,E+=i}const M=[C,S,E,1];if(e.ad.vec4.transformMat4(M,M,i),!Kt(M,A)){ri(w,m);continue}const I=M[3],P=qt(r.transform.getCameraToCenterDistance(h.projection),I),L=e.br(d,p,f),F=a?L/P:L*P,k=Zt(C,S,E,o);if(k[3]<=0){ri(w,m);continue}let z={};const R=e.ak(t.layers[0].layout.get("text-max-angle")),D=Math.cos(R),O=a?null:c,U=Jt(f,F,!1,l,i,o,s,t.glyphOffsetArray,_,m,g,k,B,z,v,O,h.projection,u,a,D);b=U.useVertical,O&&U.needsFlipping&&(z={}),(U.notEnoughRoom||b||U.needsFlipping&&Jt(f,F,!0,l,i,o,s,t.glyphOffsetArray,_,m,g,k,B,z,v,O,h.projection,u,a,D).notEnoughRoom)&&ri(w,m)}n?(t.text.dynamicLayoutVertexBuffer.updateData(m),g&&t.text.globeExtVertexBuffer&&t.text.globeExtVertexBuffer.updateData(g)):(t.icon.dynamicLayoutVertexBuffer.updateData(m),g&&t.icon.globeExtVertexBuffer&&t.icon.globeExtVertexBuffer.updateData(g))}function Xt(e,t,i,r,n,o,s,a,l,c,u,h,d,p,f,A,m){const{lineStartIndex:g,glyphStartIndex:_,segment:y}=a,v=_+a.numGlyphs,x=g+a.lineLength,b=t.getoffsetX(_),w=t.getoffsetX(v-1),T=ii(e*b,i,r,n,o,s,y,g,x,l,c,u,h,d,!0,p,f,A,m);if(!T)return null;const B=ii(e*w,i,r,n,o,s,y,g,x,l,c,u,h,d,!0,p,f,A,m);return B?{first:T,last:B}:null}function Yt(t,i,r,n){return t===e.bq.horizontal&&Math.abs(n)>Math.abs(r)?{useVertical:!0}:t===e.bq.vertical?n>0?{needsFlipping:!0}:null:i!==jt.unknown&&function(e,t){return 0===e||Math.abs(t/e)>Vt}(r,n)?i===jt.flipRequired?{needsFlipping:!0}:null:r<0?{needsFlipping:!0}:null}function Jt(t,i,r,n,o,s,a,l,c,u,h,d,p,f,A,m,g,_,y,v){const x=i/24,b=t.lineOffsetX*x,w=t.lineOffsetY*x,{lineStartIndex:T,glyphStartIndex:B,numGlyphs:C,segment:S,writingMode:E,flipState:M}=t,I=T+t.lineLength,P=t=>{if(h){const[i,r,n]=t.up,o=u.length;e.bs(h,o+0,i,r,n),e.bs(h,o+1,i,r,n),e.bs(h,o+2,i,r,n),e.bs(h,o+3,i,r,n)}const[i,r,n]=t.point;e.bt(u,i,r,n,t.angle)};if(C>1){const e=Xt(x,l,b,w,r,d,p,t,c,s,f,m,!1,g,_,y,v);if(!e)return{notEnoughRoom:!0};if(n&&!r){let[i,r,n]=e.first.point,[o,s,l]=e.last.point;[i,r]=Zt(i,r,n,a),[o,s]=Zt(o,s,l,a);const c=Yt(E,M,(o-i)*A,s-r);if(t.flipState=c&&c.needsFlipping?jt.flipRequired:jt.flipNotRequired,c)return c}P(e.first);for(let e=B+1;e<B+C-1;e++){const t=ii(x*l.getoffsetX(e),b,w,r,d,p,S,T,I,c,s,f,m,!1,!1,g,_,y,v);if(!t)return u.length-=4*(e-B),{notEnoughRoom:!0};P(t)}P(e.last)}else{if(n&&!r){const i=Zt(p.x,p.y,0,o),r=T+S+1,n=new e.P(c.getx(r),c.gety(r)),s=Zt(n.x,n.y,0,o),a=s[3]>0?s:ti(p,n,i,1,o,void 0,g,_.canonical),l=Yt(E,M,(a[0]-i[0])*A,a[1]-i[1]);if(t.flipState=l&&l.needsFlipping?jt.flipRequired:jt.flipNotRequired,l)return l}const i=ii(x*l.getoffsetX(B),b,w,r,d,p,S,T,I,c,s,f,m,!1,!1,g,_,y,v);if(!i)return{notEnoughRoom:!0};P(i)}return{}}function ei(e,t,i,r,n){const{x:o,y:s,z:a}=r.projectTilePoint(e.x,e.y,t);if(!n)return Zt(o,s,a,i);const[l,c,u]=n(e);return Zt(o+l,s+c,a+u,i)}function ti(t,i,r,n,o,s,a,l){const c=ei(t.sub(i)._unit()._add(t),l,o,a,s);return e.ad.vec3.sub(c,r,c),e.ad.vec3.normalize(c,c),e.ad.vec3.scaleAndAdd(c,r,c,n)}function ii(t,i,r,n,o,s,a,l,c,u,h,d,p,f,A,m,g,_,y){const v=n?t-i:t+i;let x=v>0?1:-1,b=0;n&&(x*=-1,b=Math.PI),x<0&&(b+=Math.PI);let w=l+a+(x>0?0:1)|0,T=o,B=o,C=0,S=0;const E=Math.abs(v),M=[],I=[];let P=s,L=P,F=e.ad.vec3.zero([]);const k=()=>ti(L,P,B,E-C+1,h,p,m,g.canonical);for(;C+S<=E;){if(w+=x,w<l||w>=c)return null;if(B=T,L=P,M.push(B),f&&I.push(L),P=new e.P(u.getx(w),u.gety(w)),T=d[w],!T){const e=ei(P,g.canonical,h,m,p);T=e[3]>0?d[w]=e:k()}C+=S;const t=e.ad.vec3.sub([],T,B),i=e.ad.vec3.distance(B,T);if(r&&i>0&&S>0&&e.ad.vec3.dot(F,t)/(S*i)<y)return null;S=i,F=t}A&&p&&(d[w]&&(T=k(),S=e.ad.vec3.distance(B,T),F=e.ad.vec3.sub([],T,B)),d[w]=T);const z=(E-C)/S,R=P.sub(L)._mult(z)._add(L),D=e.ad.vec3.scaleAndAdd([],B,F,z);let O=[0,0,1],U=F[0],N=F[1];if(_&&(O=m.upVector(g.canonical,R.x,R.y),0!==O[0]||0!==O[1]||1!==O[2])){const t=[O[2],0,-O[0]],i=e.ad.vec3.cross([],O,t);e.ad.vec3.normalize(t,t),e.ad.vec3.normalize(i,i),U=e.ad.vec3.dot(F,t),N=e.ad.vec3.dot(F,i)}if(r){const t=e.ad.vec3.cross([],O,F);e.ad.vec3.normalize(t,t),e.ad.vec3.scaleAndAdd(D,D,t,r*x)}const Q=b+Math.atan2(N,U);return M.push(D),f&&I.push(R),{point:D,angle:Q,path:M,tilePath:I,up:O}}function ri(e,t){const i=t.length,r=i+4*e;t.resize(r),t.float32.fill(-1/0,4*i,4*r)}function ni(e,t,i){const r=t[0],n=t[1];return e[0]=i[0]*r+i[4]*n+i[12],e[1]=i[1]*r+i[5]*n+i[13],e[3]=i[3]*r+i[7]*n+i[15],e}const oi=100;class si{constructor(e,t,i=new Qt(e.width+200,e.height+200,25),r=new Qt(e.width+200,e.height+200,25)){this.transform=e,this.grid=i,this.ignoredGrid=r,this.pitchfactor=Math.cos(e._pitch)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+oi,this.screenBottomBoundary=e.height+oi,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.fogState=t}placeCollisionBox(e,t,i,r,n,o,s,a){let l=i.projectedAnchorX,c=i.projectedAnchorY,u=i.projectedAnchorZ;const h=i.elevation,d=i.tileID,p=e.getProjection();if(h&&d){const[e,t,r]=p.upVector(d.canonical,i.tileAnchorX,i.tileAnchorY),n=p.upVectorScale(d.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;l+=e*h*n,c+=t*h*n,u+=r*h*n}const f=this.projectAndGetPerspectiveRatio(s,l,c,u,i.tileID,"globe"===p.name||!!h||this.transform.pitch>0,p),A=o*f.perspectiveRatio,m=(i.x1*t+r.x-i.padding)*A+f.point.x,g=(i.y1*t+r.y-i.padding)*A+f.point.y,_=(i.x2*t+r.x+i.padding)*A+f.point.x,y=(i.y2*t+r.y+i.padding)*A+f.point.y,v=f.perspectiveRatio<=.55||f.occluded;return!this.isInsideGrid(m,g,_,y)||!n&&this.grid.hitTest(m,g,_,y,a)||v?{box:[],offscreen:!1,occluded:f.occluded}:{box:[m,g,_,y],offscreen:this.isOffscreen(m,g,_,y),occluded:!1}}placeCollisionCircles(t,i,r,n,o,s,a,l,c,u,h,d,p,f,A){const m=[],g=this.transform.elevation,_=t.getProjection(),y=g?g.getAtTileOffsetFunc(A,this.transform.center.lat,this.transform.worldSize,_):null,v=new e.P(r.tileAnchorX,r.tileAnchorY);let{x:x,y:b,z:w}=_.projectTilePoint(v.x,v.y,A.canonical);if(y){const[e,t,i]=y(v);x+=e,b+=t,w+=i}const T="globe"===_.name,B=this.projectAndGetPerspectiveRatio(a,x,b,w,A,T||!!g||this.transform.pitch>0,_),{perspectiveRatio:C}=B,S=(h?s/C:s*C)/e.bw,E=Zt(x,b,w,l),M=r.lineOffsetX*S,I=r.lineOffsetY*S,P=e.ak(t.layers[0].layout.get("text-max-angle")),L=Math.cos(P),F=B.signedDistanceFromCamera>0?Xt(S,o,M,I,!1,E,v,r,n,l,{},g&&!h?y:null,h&&!!g,_,A,h,L):null;let k=!1,z=!1,R=!0;if(F&&!B.occluded){const t=.5*p*C+f,r=new e.P(-100,-100),n=new e.P(this.screenRightBoundary,this.screenBottomBoundary),o=new Nt,{first:s,last:a}=F,l=s.path.length;let h=[];for(let e=l-1;e>=1;e--)h.push(s.path[e]);for(let e=1;e<a.path.length;e++)h.push(a.path[e]);const A=2.5*t;c&&(h=h.map((([e,t,i],r)=>(y&&!T&&(i=y(r<l-1?s.tilePath[l-1-r]:a.tilePath[r-l+2])[2]),Zt(e,t,i,c)))),h.some((e=>e[3]<=0))&&(h=[]));let g=[];if(h.length>0){let t=1/0,i=-1/0,o=1/0,s=-1/0;for(const e of h)t=Math.min(t,e[0]),o=Math.min(o,e[1]),i=Math.max(i,e[0]),s=Math.max(s,e[1]);i>=r.x&&t<=n.x&&s>=r.y&&o<=n.y&&(g=[h.map((t=>new e.P(t[0],t[1])))],(t<r.x||i>n.x||o<r.y||s>n.y)&&(g=e.bu(g,r.x,r.y,n.x,n.y)))}for(const e of g){o.reset(e,.25*t);let r=0;r=o.length<=.5*t?1:Math.ceil(o.paddedLength/A)+1;for(let e=0;e<r;e++){const n=e/Math.max(r-1,1),s=o.lerp(n),a=s.x+oi,l=s.y+oi;m.push(a,l,t,0);const c=a-t,h=l-t,p=a+t,f=l+t;if(R=R&&this.isOffscreen(c,h,p,f),z=z||this.isInsideGrid(c,h,p,f),!i&&this.grid.hitTestCircle(a,l,t,d)&&(k=!0,!u))return{circles:[],offscreen:!1,collisionDetected:k,occluded:!1}}}}return{circles:!u&&k||!z?[]:m,offscreen:R,collisionDetected:k,occluded:B.occluded}}queryRenderedSymbols(t){if(0===t.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const i=[];let r=1/0,n=1/0,o=-1/0,s=-1/0;for(const a of t){const t=new e.P(a.x+oi,a.y+oi);r=Math.min(r,t.x),n=Math.min(n,t.y),o=Math.max(o,t.x),s=Math.max(s,t.y),i.push(t)}const a=this.grid.query(r,n,o,s).concat(this.ignoredGrid.query(r,n,o,s)),l={},c={};for(const t of a){const r=t.key;if(void 0===l[r.bucketInstanceId]&&(l[r.bucketInstanceId]={}),l[r.bucketInstanceId][r.featureIndex])continue;const n=[new e.P(t.x1,t.y1),new e.P(t.x2,t.y1),new e.P(t.x2,t.y2),new e.P(t.x1,t.y2)];e.bv(i,n)&&(l[r.bucketInstanceId][r.featureIndex]=!0,void 0===c[r.bucketInstanceId]&&(c[r.bucketInstanceId]=[]),c[r.bucketInstanceId].push(r.featureIndex))}return c}insertCollisionBox(e,t,i,r,n){(t?this.ignoredGrid:this.grid).insert({bucketInstanceId:i,featureIndex:r,collisionGroupID:n},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,t,i,r,n){const o=t?this.ignoredGrid:this.grid,s={bucketInstanceId:i,featureIndex:r,collisionGroupID:n};for(let t=0;t<e.length;t+=4)o.insertCircle(s,e[t],e[t+1],e[t+2])}projectAndGetPerspectiveRatio(t,i,r,n,o,s,a){const l=[i,r,n,1];let c=!1;if(n||this.transform.pitch>0){if(e.ad.vec4.transformMat4(l,l,t),this.fogState&&o&&"globe"!==a.name){const t=function(t,i,r,n,o,s){const a=s.calculateFogTileMatrix(o),l=[i,r,n];return e.ad.vec3.transformMat4(l,l,a),De(t,e.ad.vec3.length(l),s.pitch,s._fov)}(this.fogState,i,r,n,o.toUnwrapped(),this.transform);c=t>.9}}else ni(l,l,t);const u=l[3];return{point:new e.P((l[0]/u+1)/2*this.transform.width+oi,(-l[1]/u+1)/2*this.transform.height+oi),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(a)/u*.5,1.5),signedDistanceFromCamera:u,occluded:s&&l[2]>u||c}}isOffscreen(e,t,i,r){return i<oi||e>=this.screenRightBoundary||r<oi||t>this.screenBottomBoundary}isInsideGrid(e,t,i,r){return i>=0&&e<this.gridRightBoundary&&r>=0&&t<this.gridBottomBoundary}getViewportMatrix(){const t=e.ad.mat4.identity([]);return e.ad.mat4.translate(t,t,[-100,-100,0]),t}}function ai(t,i,r){const n=i.createTileMatrix(t,t.worldSize,r.toUnwrapped());return e.ad.mat4.multiply(new Float32Array(16),t.projMatrix,n)}function li(e,t,i){if(t.projection.name===i.projection.name)return e.projMatrix;const r=i.clone();return r.setProjection(t.projection),ai(r,t.getProjection(),e)}function ci(e,t,i){return t.name===i.projection.name?e.projMatrix:ai(i,t,e)}class ui{constructor(e,t,i,r){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?t:-t))):r&&i?1:0,this.placed=i}isHidden(){return 0===this.opacity&&!this.placed}}class hi{constructor(e,t,i,r,n,o=!1){this.text=new ui(e?e.text:null,t,i,n),this.icon=new ui(e?e.icon:null,t,r,n),this.clipped=o}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class di{constructor(e,t,i,r=!1){this.text=e,this.icon=t,this.skipFade=i,this.clipped=r}}class pi{constructor(){this.invProjMatrix=e.ad.mat4.create(),this.viewportMatrix=e.ad.mat4.create(),this.circles=[]}}class fi{constructor(e,t,i,r,n){this.bucketInstanceId=e,this.featureIndex=t,this.sourceLayerIndex=i,this.bucketIndex=r,this.tileID=n}}class Ai{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){const t=++this.maxGroupID;this.collisionGroups[e]={ID:t,predicate:e=>e.collisionGroupID===t}}return this.collisionGroups[e]}}function mi(t,i,r,n,o){const{horizontalAlign:s,verticalAlign:a}=e.bD(t),l=-(s-.5)*i,c=-(a-.5)*r,u=e.bC(t,n);return new e.P(l+u[0]*o,c+u[1]*o)}function gi(t,i,r,n,o){const s=new e.P(t,i);return r&&s._rotate(n?o:-o),s}class _i{constructor(e,t,i,r,n,o){this.transform=e.clone(),this.projection=e.projection.name,this.collisionIndex=new si(this.transform,n),this.buildingIndex=o,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=t,this.retainedQueryData={},this.collisionGroups=new Ai(i),this.collisionCircleArrays={},this.prevPlacement=r,r&&(r.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,i,r,n,o=1){const s=r.getBucket(i),a=r.latestFeatureIndex;if(!s||!a||i.fqid!==s.layerIds[0])return;const l=s.layers[0].layout,c=s.layers[0].paint,u=r.collisionBoxArray,h=Math.pow(2,this.transform.zoom-r.tileID.overscaledZ),d=r.tileSize/e.ai,p=r.tileID.toUnwrapped();this.transform.setProjection(s.projection);const f=(A=r.tileID,m=s.getProjection(),g=this.transform,m.name===this.projection?g.calculateProjMatrix(A.toUnwrapped()):ai(g,m,A));var A,m,g;const _="map"===l.get("text-pitch-alignment"),y="map"===l.get("text-rotation-alignment");i.compileFilter(i.options);const v=i.dynamicFilter(),x=i.dynamicFilterNeedsFeature(),b=this.transform.calculatePixelsToTileUnitsMatrix(r),w=Gt(f,r.tileID.canonical,_,y,this.transform,s.getProjection(),b);let T=null;if(_){const t=$t(f,r.tileID.canonical,_,y,this.transform,s.getProjection(),b);T=e.ad.mat4.multiply([],this.transform.labelPlaneMatrix,t)}let B=null;v&&r.latestFeatureIndex&&(B={unwrappedTileID:p,dynamicFilter:v,dynamicFilterNeedsFeature:x}),this.retainedQueryData[s.bucketInstanceId]=new fi(s.bucketInstanceId,a,s.sourceLayerIndex,s.index,r.tileID);const[C,S]=s.layers[0].layout.get("text-size-scale-range"),E=e.ay(o,C,S),[M,I]=l.get("icon-size-scale-range"),P=e.ay(o,M,I),L={bucket:s,layout:l,paint:c,posMatrix:f,textLabelPlaneMatrix:w,labelToScreenMatrix:T,clippingData:B,scale:h,textPixelRatio:d,holdingForFade:r.holdingForFade(),collisionBoxArray:u,partiallyEvaluatedTextSize:e.bp(s.textSizeData,this.transform.zoom,E),partiallyEvaluatedIconSize:e.bp(s.iconSizeData,this.transform.zoom,P),collisionGroup:this.collisionGroups.get(s.sourceID),latestFeatureIndex:r.latestFeatureIndex};if(n)for(const e of s.sortKeyRanges){const{sortKey:i,symbolInstanceStart:r,symbolInstanceEnd:n}=e;t.push({sortKey:i,symbolInstanceStart:r,symbolInstanceEnd:n,parameters:L})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:s.symbolInstances.length,parameters:L})}attemptAnchorPlacement(e,t,i,r,n,o,s,a,l,c,u,h,d,p,f,A,m,g){const{textOffset0:_,textOffset1:y,crossTileID:v}=h,x=[_,y],b=mi(e,i,r,x,n),w=this.collisionIndex.placeCollisionBox(p,n,t,gi(b.x,b.y,o,s,this.transform.angle),u,a,l,c.predicate);if(A){const e=p.getSymbolInstanceIconSize(g,this.transform.zoom,h.placedIconSymbolIndex);if(0===this.collisionIndex.placeCollisionBox(p,e,A,gi(b.x,b.y,o,s,this.transform.angle),u,a,l,c.predicate).box.length)return}if(w.box.length>0){let t;return this.prevPlacement&&this.prevPlacement.variableOffsets[v]&&this.prevPlacement.placements[v]&&this.prevPlacement.placements[v].text&&(t=this.prevPlacement.variableOffsets[v].anchor),this.variableOffsets[v]={textOffset:x,width:i,height:r,anchor:e,textScale:n,prevAnchor:t},this.markUsedJustification(p,e,h,f),p.allowVerticalPlacement&&(this.markUsedOrientation(p,f,h),this.placedOrientations[v]=f),{shift:b,placedGlyphBoxes:w}}}placeLayerBucketPart(t,i,r,n,o=1){const{bucket:s,layout:a,paint:l,posMatrix:c,textLabelPlaneMatrix:u,labelToScreenMatrix:h,clippingData:d,textPixelRatio:p,holdingForFade:f,collisionBoxArray:A,partiallyEvaluatedTextSize:m,partiallyEvaluatedIconSize:g,collisionGroup:_,latestFeatureIndex:y}=t.parameters,v=a.get("text-optional"),x=a.get("icon-optional"),b=a.get("text-allow-overlap"),w=a.get("icon-allow-overlap"),T="map"===a.get("text-rotation-alignment"),B="map"===a.get("text-pitch-alignment"),C=l.get("symbol-z-offset"),S="sea"===a.get("symbol-elevation-reference"),[E,M]=a.get("text-size-scale-range"),[I,P]=a.get("icon-size-scale-range"),L=e.ay(o,E,M),F=e.ay(o,I,P);this.transform.setProjection(s.projection);let k=b&&(w||!s.hasIconData()||x),z=w&&(b||!s.hasTextData()||v);const R=!C.isConstant();!s.collisionArrays&&A&&s.deserializeCollisionBoxes(A),r&&n&&s.updateCollisionDebugBuffers(this.transform.zoom,A,L,F);const D=(t,n,l)=>{const{crossTileID:A,numVerticalGlyphVertices:E}=t;let M=null;if(d&&d.dynamicFilterNeedsFeature||R){const e=this.retainedQueryData[s.bucketInstanceId];M=y.loadFeature({featureIndex:t.featureIndex,bucketIndex:e.bucketIndex,sourceLayerIndex:e.sourceLayerIndex,layoutVertexArrayOffset:0})}if(d&&!(0,d.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch},M,this.retainedQueryData[s.bucketInstanceId].tileID.canonical,new e.P(t.tileAnchorX,t.tileAnchorY),this.transform.calculateDistanceTileData(d.unwrappedTileID)))return this.placements[A]=new di(!1,!1,!1,!0),void i.add(A);const I=C.evaluate(M,{});if(i.has(A))return;if(f)return void(this.placements[A]=new di(!1,!1,!1));let P=!1,L=!1,F=!0,D=!1,O=!1,U=null,N={box:null,offscreen:null,occluded:null},Q={box:null,offscreen:null,occluded:null},j=null,V=null,H=null,G=0,$=0,Z=0;l.textFeatureIndex?G=l.textFeatureIndex:t.useRuntimeCollisionCircles&&(G=t.featureIndex),l.verticalTextFeatureIndex&&($=l.verticalTextFeatureIndex);const q=e=>{e.tileID=this.retainedQueryData[s.bucketInstanceId].tileID;const i=this.transform.elevation;e.elevation=S?I:I+(i?i.getAtTileOffset(e.tileID,e.tileAnchorX,e.tileAnchorY):0),e.elevation+=t.zOffset},K=l.textBox;if(K){q(K);const i=i=>{let r=e.bq.horizontal;if(s.allowVerticalPlacement&&!i&&this.prevPlacement){const e=this.prevPlacement.placedOrientations[A];e&&(this.placedOrientations[A]=e,r=e,this.markUsedOrientation(s,r,t))}return r},r=(t,i)=>{if(s.allowVerticalPlacement&&E>0&&l.verticalTextBox){for(const r of s.writingModes)if(r===e.bq.vertical?(N=i(),Q=N):N=t(),N&&N.box&&N.box.length)break}else N=t()};if(a.get("text-variable-anchor")){let o=a.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[A]){const e=this.prevPlacement.variableOffsets[A];o.indexOf(e.anchor)>0&&(o=o.filter((t=>t!==e.anchor)),o.unshift(e.anchor))}const u=(e,i,r)=>{const a=s.getSymbolInstanceTextSize(m,t,this.transform.zoom,n),l=(e.x2-e.x1)*a+2*e.padding,u=(e.y2-e.y1)*a+2*e.padding,h=t.hasIconTextFit&&!w?i:null;h&&q(h);let d={box:[],offscreen:!1,occluded:!1};const f=b?2*o.length:o.length;for(let i=0;i<f;++i){const f=this.attemptAnchorPlacement(o[i%o.length],e,l,u,a,T,B,p,c,_,i>=o.length,t,n,s,r,h,m,g);if(f&&(d=f.placedGlyphBoxes,d&&d.box&&d.box.length)){P=!0,U=f.shift;break}}return d};r((()=>u(K,l.iconBox,e.bq.horizontal)),(()=>{const t=l.verticalTextBox;return t&&q(t),s.allowVerticalPlacement&&!(N&&N.box&&N.box.length)&&E>0&&t?u(t,l.verticalIconBox,e.bq.vertical):{box:null,offscreen:null,occluded:null}})),N&&(P=N.box,F=N.offscreen,D=N.occluded);const h=i(!(!N||!N.box));if(!P&&this.prevPlacement){const e=this.prevPlacement.variableOffsets[A];e&&(this.variableOffsets[A]=e,this.markUsedJustification(s,e.anchor,t,h))}}else{const a=(i,r)=>{const a=s.getSymbolInstanceTextSize(m,t,this.transform.zoom,n,o),l=this.collisionIndex.placeCollisionBox(s,a,i,new e.P(0,0),b,p,c,_.predicate);return l&&l.box&&l.box.length&&(this.markUsedOrientation(s,r,t),this.placedOrientations[A]=r),l};r((()=>a(K,e.bq.horizontal)),(()=>{const t=l.verticalTextBox;return s.allowVerticalPlacement&&E>0&&t?(q(t),a(t,e.bq.vertical)):{box:null,offscreen:null,occluded:null}})),i(!!(N&&N.box&&N.box.length))}}if(j=N,P=j&&j.box&&j.box.length>0,F=j&&j.offscreen,D=j&&j.occluded,t.useRuntimeCollisionCircles){const i=s.text.placedSymbolArray.get(t.centerJustifiedTextSymbolIndex>=0?t.centerJustifiedTextSymbolIndex:t.verticalPlacedTextSymbolIndex),n=e.br(s.textSizeData,m,i),o=a.get("text-padding");V=this.collisionIndex.placeCollisionCircles(s,b,i,s.lineVertexArray,s.glyphOffsetArray,n,c,u,h,r,B,_.predicate,t.collisionCircleDiameter*n/e.bw,o,this.retainedQueryData[s.bucketInstanceId].tileID),P=b||V.circles.length>0&&!V.collisionDetected,F=F&&V.offscreen,D=V.occluded}if(l.iconFeatureIndex&&(Z=l.iconFeatureIndex),l.iconBox){const i=i=>{q(i);const r=t.hasIconTextFit&&U?gi(U.x,U.y,T,B,this.transform.angle):new e.P(0,0),n=s.getSymbolInstanceIconSize(g,this.transform.zoom,t.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(s,n,i,r,w,p,c,_.predicate)};Q&&Q.box&&Q.box.length&&l.verticalIconBox?(H=i(l.verticalIconBox),L=H.box.length>0):(H=i(l.iconBox),L=H.box.length>0),F=F&&H.offscreen,O=H.occluded}const W=v||0===t.numHorizontalGlyphVertices&&0===E,X=x||0===t.numIconVertices;if(W||X?X?W||(L=L&&P):P=L&&P:L=P=L&&P,P&&j&&j.box&&this.collisionIndex.insertCollisionBox(j.box,a.get("text-ignore-placement"),s.bucketInstanceId,Q&&Q.box&&$?$:G,_.ID),L&&H&&this.collisionIndex.insertCollisionBox(H.box,a.get("icon-ignore-placement"),s.bucketInstanceId,Z,_.ID),V&&(P&&this.collisionIndex.insertCollisionCircles(V.circles,a.get("text-ignore-placement"),s.bucketInstanceId,G,_.ID),r)){const e=s.bucketInstanceId;let t=this.collisionCircleArrays[e];void 0===t&&(t=this.collisionCircleArrays[e]=new pi);for(let e=0;e<V.circles.length;e+=4)t.circles.push(V.circles[e+0]),t.circles.push(V.circles[e+1]),t.circles.push(V.circles[e+2]),t.circles.push(V.collisionDetected?1:0)}const Y="globe"!==s.projection.name;k=k&&(Y||!D),z=z&&(Y||!O),this.placements[A]=new di(P||k,L||z,F||s.justReloaded),i.add(A)};if("offset"===s.elevationType&&this.buildingIndex&&this.buildingIndex.updateZOffset(s,this.retainedQueryData[s.bucketInstanceId].tileID),"road"===s.elevationType&&s.updateRoadElevation(),s.updateZOffset(),s.sortFeaturesByY){const t=s.getSortedSymbolIndexes(this.transform.angle);for(let e=t.length-1;e>=0;--e){const i=t[e];D(s.symbolInstances.get(i),i,s.collisionArrays[i])}s.hasAnyZOffset&&e.w(`${s.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(s.hasAnyZOffset){const e=s.getSortedIndexesByZOffset();for(let t=0;t<e.length;++t){const i=e[t];D(s.symbolInstances.get(i),i,s.collisionArrays[i])}}else for(let e=t.symbolInstanceStart;e<t.symbolInstanceEnd;e++)D(s.symbolInstances.get(e),e,s.collisionArrays[e]);if(r&&s.bucketInstanceId in this.collisionCircleArrays){const t=this.collisionCircleArrays[s.bucketInstanceId];e.ad.mat4.invert(t.invProjMatrix,c),t.viewportMatrix=this.collisionIndex.getViewportMatrix()}s.justReloaded=!1}markUsedJustification(t,i,r,n){const{leftJustifiedTextSymbolIndex:o,centerJustifiedTextSymbolIndex:s,rightJustifiedTextSymbolIndex:a,verticalPlacedTextSymbolIndex:l,crossTileID:c}=r,u=e.bB(i),h=n===e.bq.vertical?l:"left"===u?o:"center"===u?s:"right"===u?a:-1;o>=0&&(t.text.placedSymbolArray.get(o).crossTileID=h>=0&&o!==h?0:c),s>=0&&(t.text.placedSymbolArray.get(s).crossTileID=h>=0&&s!==h?0:c),a>=0&&(t.text.placedSymbolArray.get(a).crossTileID=h>=0&&a!==h?0:c),l>=0&&(t.text.placedSymbolArray.get(l).crossTileID=h>=0&&l!==h?0:c)}markUsedOrientation(t,i,r){const n=i===e.bq.horizontal||i===e.bq.horizontalOnly?i:0,o=i===e.bq.vertical?i:0,{leftJustifiedTextSymbolIndex:s,centerJustifiedTextSymbolIndex:a,rightJustifiedTextSymbolIndex:l,verticalPlacedTextSymbolIndex:c}=r,u=t.text.placedSymbolArray;s>=0&&(u.get(s).placedOrientation=n),a>=0&&(u.get(a).placedOrientation=n),l>=0&&(u.get(l).placedOrientation=n),c>=0&&(u.get(c).placedOrientation=o)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;const t=this.prevPlacement;let i=!1;this.prevZoomAdjustment=t?t.zoomAdjustment(this.transform.zoom):0;const r=t?t.symbolFadeChange(e):1,n=t?t.opacities:{},o=t?t.variableOffsets:{},s=t?t.placedOrientations:{};for(const e in this.placements){const t=this.placements[e],o=n[e];o?(this.opacities[e]=new hi(o,r,t.text,t.icon,null,t.clipped),i=i||t.text!==o.text.placed||t.icon!==o.icon.placed):(this.opacities[e]=new hi(null,r,t.text,t.icon,t.skipFade,t.clipped),i=i||t.text||t.icon)}for(const e in n){const t=n[e];if(!this.opacities[e]){const n=new hi(t,r,!1,!1);n.isHidden()||(this.opacities[e]=n,i=i||t.text.placed||t.icon.placed)}}for(const e in o)this.variableOffsets[e]||!this.opacities[e]||this.opacities[e].isHidden()||(this.variableOffsets[e]=o[e]);for(const e in s)this.placedOrientations[e]||!this.opacities[e]||this.opacities[e].isHidden()||(this.placedOrientations[e]=s[e]);i?this.lastPlacementChangeTime=e:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=t?t.lastPlacementChangeTime:e)}updateLayerOpacities(e,t,i,r){const n=new Set;for(const o of t){const t=o.getBucket(e);t&&o.latestFeatureIndex&&e.fqid===t.layerIds[0]&&(this.updateBucketOpacities(t,n,o,o.collisionBoxArray,i,r,o.tileID,e.scope),"offset"===t.elevationType&&this.buildingIndex&&this.buildingIndex.updateZOffset(t,o.tileID),"road"===t.elevationType&&t.updateRoadElevation(),t.updateZOffset())}}updateBucketOpacities(t,i,r,n,o,s,a,l){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const c=t.layers[0].layout,u=t.layers[0].paint,h=!!t.layers[0].dynamicFilter(),d=new hi(null,0,!1,!1,!0),p=c.get("text-allow-overlap"),f=c.get("icon-allow-overlap"),A=c.get("text-variable-anchor"),m="map"===c.get("text-rotation-alignment"),g="map"===c.get("text-pitch-alignment"),_=u.get("symbol-z-offset"),y="sea"===c.get("symbol-elevation-reference"),v=!_.isConstant(),x=new hi(null,0,p&&(f||!t.hasIconData()||c.get("icon-optional")),f&&(p||!t.hasTextData()||c.get("text-optional")),!0);!t.collisionArrays&&n&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(n);const b=(e,t,i)=>{for(let r=0;r<t/4;r++)e.opacityVertexArray.emplaceBack(i)};let w=0;s&&t.updateReplacement(a,s);for(let n=0;n<t.symbolInstances.length;n++){const c=t.symbolInstances.get(n),{numHorizontalGlyphVertices:u,numVerticalGlyphVertices:p,crossTileID:f,numIconVertices:T,tileAnchorX:B,tileAnchorY:C}=c;let S=null;const E=this.retainedQueryData[t.bucketInstanceId];v&&c&&E&&(S=r.latestFeatureIndex.loadFeature({featureIndex:c.featureIndex,bucketIndex:E.bucketIndex,sourceLayerIndex:E.sourceLayerIndex,layoutVertexArrayOffset:0}));const M=_.evaluate(S,{}),I=i.has(f);let P=this.opacities[f];I?P=d:P||(P=x,this.opacities[f]=P),i.add(f);const L=u>0||p>0,F=T>0,k=this.placedOrientations[f],z=k===e.bq.vertical,R=k===e.bq.horizontal||k===e.bq.horizontalOnly;!L&&!F||P.isHidden()||w++;let D=!1;if((L||F)&&s)for(const i of t.activeReplacements){if(e.bx(i,o,e.by.Symbol,l))continue;if(i.min.x>B||B>i.max.x||i.min.y>C||C>i.max.y)continue;const t=e.bz(B,C,a.canonical,i.footprintTileId.canonical);if(D=e.bA(t,i.footprint),D)break}if(L){const e=D?Ei:Si(P.text);b(t.text,u,z?Ei:e),b(t.text,p,R?Ei:e);const i=P.text.isHidden(),{leftJustifiedTextSymbolIndex:r,centerJustifiedTextSymbolIndex:n,rightJustifiedTextSymbolIndex:o,verticalPlacedTextSymbolIndex:s}=c,a=t.text.placedSymbolArray,l=i||z?1:0;r>=0&&(a.get(r).hidden=l),n>=0&&(a.get(n).hidden=l),o>=0&&(a.get(o).hidden=l),s>=0&&(a.get(s).hidden=i||R?1:0);const h=this.variableOffsets[f];h&&this.markUsedJustification(t,h.anchor,c,k);const d=this.placedOrientations[f];d&&(this.markUsedJustification(t,"left",c,d),this.markUsedOrientation(t,d,c))}if(F){const e=D?Ei:Si(P.icon),{placedIconSymbolIndex:i,verticalPlacedIconSymbolIndex:r}=c,n=t.icon.placedSymbolArray,o=P.icon.isHidden()?1:0;i>=0&&(b(t.icon,T,z?Ei:e),n.get(i).hidden=o),r>=0&&(b(t.icon,c.numVerticalIconVertices,R?Ei:e),n.get(r).hidden=o)}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const i=t.collisionArrays[n];if(i){let r=new e.P(0,0),n=!0;if(i.textBox||i.verticalTextBox){if(A){const e=this.variableOffsets[f];e?(r=mi(e.anchor,e.width,e.height,e.textOffset,e.textScale),m&&r._rotate(g?this.transform.angle:-this.transform.angle)):n=!1}h&&(n=!P.clipped),i.textBox&&yi(t.textCollisionBox.collisionVertexArray,P.text.placed,!n||z,M,y,r.x,r.y),i.verticalTextBox&&yi(t.textCollisionBox.collisionVertexArray,P.text.placed,!n||R,M,y,r.x,r.y)}const o=n&&Boolean(!R&&i.verticalIconBox);i.iconBox&&yi(t.iconCollisionBox.collisionVertexArray,P.icon.placed,o,M,y,c.hasIconTextFit?r.x:0,c.hasIconTextFit?r.y:0),i.verticalIconBox&&yi(t.iconCollisionBox.collisionVertexArray,P.icon.placed,!o,M,y,c.hasIconTextFit?r.x:0,c.hasIconTextFit?r.y:0)}}}if(t.fullyClipped=0===w,t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.bucketInstanceId in this.collisionCircleArrays){const e=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=e.invProjMatrix,t.placementViewportMatrix=e.viewportMatrix,t.collisionCircleArray=e.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(e){return 0===this.fadeDuration?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,t){const i=this.zoomAtLastRecencyCheck===t?1-this.zoomAdjustment(t):1;return this.zoomAtLastRecencyCheck=t,this.commitTime+this.fadeDuration*i>e}setStale(){this.stale=!0}}function yi(e,t,i,r,n,o,s){e.emplaceBack(t?1:0,i?1:0,o||0,s||0,r,n?1:0),e.emplaceBack(t?1:0,i?1:0,o||0,s||0,r,n?1:0),e.emplaceBack(t?1:0,i?1:0,o||0,s||0,r,n?1:0),e.emplaceBack(t?1:0,i?1:0,o||0,s||0,r,n?1:0)}const vi=Math.pow(2,25),xi=Math.pow(2,24),bi=Math.pow(2,17),wi=Math.pow(2,16),Ti=Math.pow(2,9),Bi=Math.pow(2,8),Ci=Math.pow(2,1);function Si(e){if(0===e.opacity&&!e.placed)return 0;if(1===e.opacity&&e.placed)return 4294967295;const t=e.placed?1:0,i=Math.floor(127*e.opacity);return i*vi+t*xi+i*bi+t*wi+i*Ti+t*Bi+i*Ci+t}const Ei=0;class Mi{constructor(e){this._sortAcrossTiles="viewport-y"!==e.layout.get("symbol-z-order")&&void 0!==e.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(e,t,i,r,n,o){const s=this._bucketParts;for(;this._currentTileIndex<e.length;)if(t.getBucketParts(s,r,e[this._currentTileIndex],this._sortAcrossTiles,o),this._currentTileIndex++,n())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,s.sort(((e,t)=>e.sortKey-t.sortKey)));this._currentPartIndex<s.length;){const e=s[this._currentPartIndex];if(t.placeLayerBucketPart(e,this._seenCrossTileIDs,i,0===e.symbolInstanceStart,o),this._currentPartIndex++,n())return!0}return!1}}class Ii{constructor(e,t,i,r,n,o,s,a,l){this.placement=new _i(e,n,o,s,a,l),this._currentPlacementIndex=t.length-1,this._forceFullPlacement=i,this._showCollisionBoxes=r,this._done=!1}isDone(){return this._done}continuePlacement(t,i,r,n,o){const s=e.q.now(),a=()=>{const t=e.q.now()-s;return!this._forceFullPlacement&&t>2};for(;this._currentPlacementIndex>=0;){const s=i[t[this._currentPlacementIndex]],l=this.placement.collisionIndex.transform.zoom;if("symbol"===s.type&&(!s.minzoom||s.minzoom<=l)&&(!s.maxzoom||s.maxzoom>l)){const t=s,i=t.layout.get("symbol-z-elevate"),l=void 0!==t.layout.get("symbol-sort-key").constantOr(1),c=t.layout.get("symbol-z-order"),u="viewport-y"===c||"auto"===c&&!("viewport-y"!==c&&l),h=t.layout.get("text-allow-overlap")||t.layout.get("icon-allow-overlap")||t.layout.get("text-ignore-placement")||t.layout.get("icon-ignore-placement"),d=u&&h,p=this._inProgressLayer=this._inProgressLayer||new Mi(t),f=e.C(s.source,s.scope);if(p.continuePlacement(i||d?n[f]:r[f],this.placement,this._showCollisionBoxes,s,a,o))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}const Pi=512/e.ai/2;class Li{constructor(t,i,r){this.tileID=t,this.bucketInstanceId=r,this.index=new e.bE(i.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const n=t.canonical.x*e.ai,o=t.canonical.y*e.ai;for(let e=0;e<i.length;e++){const{key:t,crossTileID:r,tileAnchorX:s,tileAnchorY:a}=i.get(e),l=Math.floor((n+s)*Pi),c=Math.floor((o+a)*Pi);this.index.add(l,c),this.keys.push(t),this.crossTileIDs.push(r)}this.index.finish()}findMatches(t,i,r){const n=this.tileID.canonical.z<i.canonical.z?1:Math.pow(2,this.tileID.canonical.z-i.canonical.z),o=Pi/Math.pow(2,i.canonical.z-this.tileID.canonical.z),s=i.canonical.x*e.ai,a=i.canonical.y*e.ai;for(let e=0;e<t.length;e++){const i=t.get(e);if(i.crossTileID)continue;const{key:l,tileAnchorX:c,tileAnchorY:u}=i,h=Math.floor((s+c)*o),d=Math.floor((a+u)*o),p=this.index.range(h-n,d-n,h+n,d+n);for(const e of p){const t=this.crossTileIDs[e];if(this.keys[e]===l&&!r.has(t)){r.add(t),i.crossTileID=t;break}}}}}class Fi{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class ki{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){const t=Math.round((e-this.lng)/360);if(0!==t)for(const e in this.indexes){const i=this.indexes[e],r={};for(const e in i){const n=i[e];n.tileID=n.tileID.unwrapTo(n.tileID.wrap+t),r[n.tileID.key]=n}this.indexes[e]=r}this.lng=e}addBucket(e,t,i){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===t.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let e=0;e<t.symbolInstances.length;e++)t.symbolInstances.get(e).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]=new Set);const r=this.usedCrossTileIDs[e.overscaledZ];for(const i in this.indexes){const n=this.indexes[i];if(Number(i)>e.overscaledZ)for(const i in n){const o=n[i];o.tileID.isChildOf(e)&&o.findMatches(t.symbolInstances,e,r)}else{const o=n[e.scaledTo(Number(i)).key];o&&o.findMatches(t.symbolInstances,e,r)}}for(let e=0;e<t.symbolInstances.length;e++){const n=t.symbolInstances.get(e);n.crossTileID||(n.crossTileID=i.generate(),r.add(n.crossTileID))}return void 0===this.indexes[e.overscaledZ]&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new Li(e,t.symbolInstances,t.bucketInstanceId),!0}removeBucketCrossTileIDs(e,t){for(const i of t.crossTileIDs)this.usedCrossTileIDs[e].delete(i)}removeStaleBuckets(e){let t=!1;for(const i in this.indexes){const r=this.indexes[i];for(const n in r)e[r[n].bucketInstanceId]||(this.removeBucketCrossTileIDs(i,r[n]),delete r[n],t=!0)}return t}}class zi{constructor(){this.layerIndexes={},this.crossTileIDs=new Fi,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,t,i,r){let n=this.layerIndexes[e.fqid];void 0===n&&(n=this.layerIndexes[e.fqid]=new ki);let o=!1;const s={};"globe"!==r.name&&n.handleWrapJump(i);for(const i of t){const t=i.getBucket(e);t&&e.fqid===t.layerIds[0]&&(t.bucketInstanceId||(t.bucketInstanceId=++this.maxBucketInstanceId),n.addBucket(i.tileID,t,this.crossTileIDs)&&(o=!0),s[t.bucketInstanceId]=!0)}return n.removeStaleBuckets(s)&&(o=!0),o}pruneUnusedLayers(e){const t={};e.forEach((e=>{t[e]=!0}));for(const e in this.layerIndexes)t[e]||delete this.layerIndexes[e]}}const Ri=771;class Di{constructor(e,t,i,r){this.blendFunction=e,this.blendColor=t,this.mask=i,this.blendEquation=r}}Di.Replace=[1,0,1,0],Di.disabled=new Di(Di.Replace,e.al.transparent,[!1,!1,!1,!1]),Di.unblended=new Di(Di.Replace,e.al.transparent,[!0,!0,!0,!0]),Di.alphaBlended=new Di([1,Ri,1,Ri],e.al.transparent,[!0,!0,!0,!0]),Di.alphaBlendedNonPremultiplied=new Di([770,Ri,770,Ri],e.al.transparent,[!0,!0,!0,!0]),Di.multiply=new Di([774,0,774,0],e.al.transparent,[!0,!0,!0,!0]);class Oi{constructor(e,t,i){this.func=e,this.mask=t,this.range=i}}Oi.ReadOnly=!1,Oi.ReadWrite=!0,Oi.disabled=new Oi(519,Oi.ReadOnly,[0,1]);const Ui=7680;class Ni{constructor(e,t,i,r,n,o){this.test=e,this.ref=t,this.mask=i,this.fail=r,this.depthFail=n,this.pass=o}}Ni.disabled=new Ni({func:519,mask:0},0,0,Ui,Ui,Ui);const Qi=1029,ji=2305;class Vi{constructor(e,t,i){this.enable=e,this.mode=t,this.frontFace=i}}function Hi(t,i){const r=e.bG(t,3);e.ad.mat4.fromQuat(t,i),e.bI(t,3,r)}function Gi(t,i){const r=e.ad.quat.identity([]);return e.ad.quat.rotateZ(r,r,-i),e.ad.quat.rotateX(r,r,-t),r}function $i(t,i){const r=[t[0],t[1],0],n=[i[0],i[1],0];if(e.ad.vec3.length(r)>=1e-15){const t=e.ad.vec3.normalize([],r);e.ad.vec3.scale(n,t,e.ad.vec3.dot(n,t)),i[0]=n[0],i[1]=n[1]}const o=e.ad.vec3.cross([],i,t);if(e.ad.vec3.len(o)<1e-15)return null;const s=Math.atan2(-o[1],o[0]);return Gi(Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2]),s)}Vi.disabled=new Vi(!1,Qi,ji),Vi.backCCW=new Vi(!0,Qi,ji),Vi.backCW=new Vi(!0,Qi,2304),Vi.frontCW=new Vi(!0,1028,2304),Vi.frontCCW=new Vi(!0,1028,ji);class Zi{constructor(e,t){this.position=e,this.orientation=t}get position(){return this._position}set position(t){if(t){const i=t instanceof e.ac?t:new e.ac(t[0],t[1],t[2]);this._renderWorldCopies&&(i.x=e.bF(i.x,0,1)),this._position=i}else this._position=null}lookAtPoint(t,i){if(this.orientation=null,!this.position)return;const r=this.position,n=this._elevation?this._elevation.getAtPointOrZero(e.ac.fromLngLat(t)):0,o=e.ac.fromLngLat(t,n),s=[o.x-r.x,o.y-r.y,o.z-r.z];i||(i=[0,0,1]),i[2]=Math.abs(i[2]),this.orientation=$i(s,i)}setPitchBearing(t,i){this.orientation=Gi(e.ak(t),e.ak(-i))}}class qi{constructor(t,i){this._transform=e.ad.mat4.identity([]),this.orientation=i,this.position=t}get mercatorPosition(){const t=this.position;return new e.ac(t[0],t[1],t[2])}get position(){const t=e.bG(this._transform,3);return[t[0],t[1],t[2]]}set position(t){var i;t&&e.bI(this._transform,3,[(i=t)[0],i[1],i[2],1])}get orientation(){return this._orientation}set orientation(t){this._orientation=t||e.ad.quat.identity([]),t&&Hi(this._transform,this._orientation)}getPitchBearing(){const e=this.forward(),t=this.right();return{bearing:Math.atan2(-t[1],t[0]),pitch:Math.atan2(Math.sqrt(e[0]*e[0]+e[1]*e[1]),-e[2])}}setPitchBearing(e,t){this._orientation=Gi(e,t),Hi(this._transform,this._orientation)}forward(){const t=e.bG(this._transform,2);return[-t[0],-t[1],-t[2]]}up(){const t=e.bG(this._transform,1);return[-t[0],-t[1],-t[2]]}right(){const t=e.bG(this._transform,0);return[t[0],t[1],t[2]]}getCameraToWorld(t,i){const r=new Float64Array(16);return e.ad.mat4.invert(r,this.getWorldToCamera(t,i)),r}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(t,i,r){const n=this.position;e.ad.vec3.scale(n,n,-t);const o=new Float64Array(16);return e.ad.mat4.fromScaling(o,[r,r,r]),e.ad.mat4.translate(o,o,n),o[10]*=i,o}getWorldToCamera(t,i){const r=new Float64Array(16),n=new Float64Array(4),o=this.position;return e.ad.quat.conjugate(n,this._orientation),e.ad.vec3.scale(o,o,-t),e.ad.mat4.fromQuat(r,n),e.ad.mat4.translate(r,r,o),r[1]*=-1,r[5]*=-1,r[9]*=-1,r[13]*=-1,r[8]*=i,r[9]*=i,r[10]*=i,r[11]*=i,r}getCameraToClipPerspective(t,i,r,n){const o=new Float64Array(16);return e.ad.mat4.perspective(o,t,i,r,n),o}getCameraToClipOrthographic(t,i,r,n,o,s){const a=new Float64Array(16);return e.ad.mat4.ortho(a,t,i,r,n,o,s),a}getDistanceToElevation(t,i=!1){const r=0===t?0:e.bH(t,i?e.aT(this.position[1]):this.position[1]),n=this.forward();return(r-this.position[2])/n[2]}clone(){return new qi([...this.position],[...this.orientation])}}const Ki={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class Wi{constructor(e=0,t=0,i=0,r=0){if(isNaN(e)||e<0||isNaN(t)||t<0||isNaN(i)||i<0||isNaN(r)||r<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=t,this.left=i,this.right=r}interpolate(t,i,r){return null!=i.top&&null!=t.top&&(this.top=e.ah(t.top,i.top,r)),null!=i.bottom&&null!=t.bottom&&(this.bottom=e.ah(t.bottom,i.bottom,r)),null!=i.left&&null!=t.left&&(this.left=e.ah(t.left,i.left,r)),null!=i.right&&null!=t.right&&(this.right=e.ah(t.right,i.right,r)),this}getCenter(t,i){const r=e.ay((this.left+t-this.right)/2,0,t),n=e.ay((this.top+i-this.bottom)/2,0,i);return new e.P(r,n)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new Wi(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const Xi=15;class Yi{constructor(t,i,r,n,o,s,a){this.tileSize=512,this._renderWorldCopies=void 0===o||o,this._minZoom=t||0,this._maxZoom=i||22,this._minPitch=r??0,this._maxPitch=n??60,this.setProjection(s),this.setMaxBounds(a),this.width=0,this.height=0,this._center=new e.bO(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Wi,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new qi,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1,this._allowWorldUnderZoom=!1}clone(){const e=new Yi(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection(),this.maxBounds);return e._elevation=this._elevation,e._centerAltitude=this._centerAltitude,e._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,e.tileSize=this.tileSize,e.mercatorFromTransition=this.mercatorFromTransition,e.width=this.width,e.height=this.height,e.cameraElevationReference=this.cameraElevationReference,e._center=this._center,e._setZoom(this.zoom),e._seaLevelZoom=this._seaLevelZoom,e.angle=this.angle,e._fov=this._fov,e._pitch=this._pitch,e._nearZ=this._nearZ,e._farZ=this._farZ,e._averageElevation=this._averageElevation,e._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,e._unmodified=this._unmodified,e._edgeInsets=this._edgeInsets.clone(),e._camera=this._camera.clone(),e._calcMatrices(),e.freezeTileCoverage=this.freezeTileCoverage,e.frustumCorners=this.frustumCorners,e._allowWorldUnderZoom=this._allowWorldUnderZoom,e}get isOrthographic(){return"globe"!==this.projection.name&&this._orthographicProjectionAtLowPitch&&this.pitch<Xi}get elevation(){return this._elevation}set elevation(e){this._elevation!==e&&(this._elevation=e,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return"globe"!==this.projection.name&&!this.isOrthographic}updateElevation(e,t=!1){const i=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(null==this._seaLevelZoom||i)&&this._updateCameraOnTerrain(),(e||i)&&this._constrainCamera(t),this._calcMatrices()}getProjection(){return e.aA(this.projection,["name","center","parallels"])}setProjection(t){this.projectionOptions=t||{name:"mercator"};const i=this.projection?this.getProjection():void 0;this.projection=e.bP(this.projectionOptions);const r=this.getProjection(),n=!e.bn(i,r);return n&&this._calcMatrices(),this.mercatorFromTransition=!1,n}setOrthographicProjectionAtLowPitch(e){return this._orthographicProjectionAtLowPitch!==e&&(this._orthographicProjectionAtLowPitch=e,this._calcMatrices(),!0)}setMercatorFromTransition(){const t=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=e.bP({name:"mercator"});const i=t!==this.projection.name;return i&&this._calcMatrices(),i}get minZoom(){return this._minZoom}set minZoom(e){this._minZoom!==e&&(this._minZoom=e,this.zoom=Math.max(this.zoom,e))}get maxZoom(){return this._maxZoom}set maxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.zoom=Math.min(this.zoom,e))}get minPitch(){return this._minPitch}set minPitch(e){this._minPitch!==e&&(this._minPitch=e,this.pitch=Math.max(this.pitch,e))}get maxPitch(){return this._maxPitch}set maxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.pitch=Math.min(this.pitch,e))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(e){void 0===e?e=!0:null===e&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const e=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(e))}get cameraWorldSize(){const e=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(e))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return e.bH(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new e.P(this.width,this.height)}get bearing(){return e.bF(this.rotation,-180,180)}set bearing(e){this.rotation=e}get rotation(){return-this.angle/Math.PI*180}set rotation(t){const i=-t*Math.PI/180;this.angle!==i&&(this._unmodified=!1,this.angle=i,this._calcMatrices(),this.rotationMatrix=e.ad.mat2.create(),e.ad.mat2.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const i=e.ay(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==i&&(this._unmodified=!1,this._pitch=i,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=e.ak(t),this._calcMatrices())}get fovX(){return this._fov}get fovY(){const e=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/e)}get averageElevation(){return this._averageElevation}set averageElevation(e){this._averageElevation=e,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(e){const t=Math.min(Math.max(e,this.minZoom),this.maxZoom);this._zoom!==t&&(this._unmodified=!1,this._setZoom(t),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(e){this._zoom=e,this.scale=this.zoomScale(e),this.tileZoom=Math.floor(e),this.zoomFraction=e-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(e){this._tileCoverLift!==e&&(this._tileCoverLift=e)}_updateCameraOnTerrain(){const e=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,t=this.elevation&&e===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||e===Number.NEGATIVE_INFINITY&&(!t||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const i=this._elevation;t||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&i.exaggeration()&&this._centerAltitudeValidForExaggeration!==i.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*i.exaggeration(),this._centerAltitudeValidForExaggeration=i.exaggeration()):(this._centerAltitude=e||0,this._centerAltitudeValidForExaggeration=i.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){void 0!==this._centerAltitudeValidForExaggeration&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const t=this._elevation,i=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],r=this.horizonLineFromTop();let n=0,o=0;for(let s=0;s<i.length;s++){const a=new e.P(i[s][0]*this.width,r+i[s][1]*(this.height-r)),l=t.pointCoordinate(a);if(!l)continue;const c=1/Math.hypot(l[0]-this._camera.position[0],l[1]-this._camera.position[1]);n+=l[3]*c,o+=c}return 0===o?NaN:n/o}get center(){return this._center}set center(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._seaLevelZoom||!this._elevation)return;const e=this._seaLevelZoom,t=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),i=this.pixelsPerMeter/this.worldSize*t,r=this._mercatorZfromZoom(e),n=this._mercatorZfromZoom(this._maxZoom),o=Math.max(r-i,n);this._setZoom(this._zoomFromMercatorZ(o))}get padding(){return this._edgeInsets.toJSON()}set padding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}computeZoomRelativeTo(t){const i=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,t.toAltitude()));let r;r=t.z<this._camera.position[2]?[i.x,i.y,i.z]:[t.x,t.y,t.z];const n=e.ad.vec3.length(e.ad.vec3.sub([],this._camera.position,r));return e.ay(this._zoomFromMercatorZ(n),this._minZoom,this._maxZoom)}setFreeCameraOptions(t){if(!this.height)return;if(!t.position&&!t.orientation)return;this._updateCameraState();let i=!1;if(t.orientation&&!e.ad.quat.exactEquals(t.orientation,this._camera.orientation)&&(i=this._setCameraOrientation(t.orientation)),t.position){const r=[t.position.x,t.position.y,t.position.z];e.ad.vec3.exactEquals(r,this._camera.position)||(this._setCameraPosition(r),i=!0)}i&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const t=this._camera.position,i=new Zi;return i.position=new e.ac(t[0],t[1],t[2]),i.orientation=this._camera.orientation,i._elevation=this.elevation,i._renderWorldCopies=this.renderWorldCopies,i}_setCameraOrientation(t){if(!e.ad.quat.length(t))return!1;e.ad.quat.normalize(t,t);const i=e.ad.vec3.transformQuat([],[0,0,-1],t),r=e.ad.vec3.transformQuat([],[0,-1,0],t);if(r[2]<0)return!1;const n=$i(i,r);return!!n&&(this._camera.orientation=n,!0)}_setCameraPosition(t){const i=this.zoomScale(this.minZoom)*this.tileSize,r=this.zoomScale(this.maxZoom)*this.tileSize,n=this.cameraToCenterDistance;t[2]=e.ay(t[2],n/r,n/i),this._camera.position=t}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,t,i){this._unmodified=!1,this._edgeInsets.interpolate(e,t,i),this._constrain(),this._calcMatrices()}coveringZoomLevel(e){const t=(e.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/e.tileSize));return Math.max(0,t)}getVisibleUnwrappedCoordinates(t){const i=[new e.bQ(0,t)];if(this.renderWorldCopies){const r=this.pointCoordinate(new e.P(0,0)),n=this.pointCoordinate(new e.P(this.width,0)),o=this.pointCoordinate(new e.P(this.width,this.height)),s=this.pointCoordinate(new e.P(0,this.height)),a=Math.floor(Math.min(r.x,n.x,o.x,s.x)),l=Math.floor(Math.max(r.x,n.x,o.x,s.x)),c=1;for(let r=a-c;r<=l+c;r++)0!==r&&i.push(new e.bQ(r,t))}return i}isLODDisabled(e){return(!e||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(t,i,r){let n=[];const o=void 0!==r,s=!o;if(s&&this.zoom<i)return n;if(o&&0===r[0]&&0===r[1])return n;const a=new Set,l=(t,i,r,o,s)=>{const l=e.c5(i,t,r,o,s);a.has(l)||(n.push(new e.aH(t,i,r,o,s)),a.add(l))};for(let e=0;e<t.length;e++){const n=t[e];if(s&&n.canonical.z!==i)continue;const a=n.canonical,c=n.overscaledZ,u=n.wrap,h=1<<a.z,d=a.x+1<h,p=a.x>0,f=a.y+1<h,A=a.y>0,m=n.wrap-(p?0:1),g=n.wrap+(d?0:1),_=p?a.x-1:h-1,y=d?a.x+1:0;if(o)r[0]<0?(l(c,g,a.z,y,a.y),r[1]<0&&f&&(l(c,u,a.z,a.x,a.y+1),l(c,g,a.z,y,a.y+1)),r[1]>0&&A&&(l(c,u,a.z,a.x,a.y-1),l(c,g,a.z,y,a.y-1))):r[0]>0?(l(c,m,a.z,_,a.y),r[1]<0&&f&&(l(c,u,a.z,a.x,a.y+1),l(c,m,a.z,_,a.y+1)),r[1]>0&&A&&(l(c,u,a.z,a.x,a.y-1),l(c,m,a.z,_,a.y-1))):r[1]<0&&f?l(c,u,a.z,a.x,a.y+1):A&&l(c,u,a.z,a.x,a.y-1);else{const e=n.visibleQuadrants;1&e&&(l(c,m,a.z,_,a.y),A&&(l(c,u,a.z,a.x,a.y-1),l(c,m,a.z,_,a.y-1))),2&e&&(l(c,g,a.z,y,a.y),A&&(l(c,u,a.z,a.x,a.y-1),l(c,g,a.z,y,a.y-1))),4&e&&(l(c,m,a.z,_,a.y),f&&(l(c,u,a.z,a.x,a.y+1),l(c,m,a.z,_,a.y+1))),8&e&&(l(c,g,a.z,y,a.y),f&&(l(c,u,a.z,a.x,a.y+1),l(c,g,a.z,y,a.y+1)))}}const c=[];for(const e of n)n.some((t=>e.isChildOf(t)))||c.push(e);if(n=c.filter((e=>!t.some((t=>!!(e.overscaledZ<i&&t.isChildOf(e))||e.equals(t)||e.isChildOf(t))))),s){const e=1<<i,t="globe"===this.projection.name?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),r=[e*t.x,e*t.y],o=4,s=o*o;n=n.filter((e=>{const t=e.canonical.x+.5-r[0],i=e.canonical.y+.5-r[1];return t*t+i*i<s}))}return n}coveringTiles(t){let i=this.coveringZoomLevel(t);const r=i,n=this.elevation&&this.elevation.exaggeration(),o=n&&!t.isTerrainDEM,s="mercator"===this.projection.name;if(void 0!==t.minzoom&&i<t.minzoom)return[];void 0!==t.maxzoom&&i>t.maxzoom&&(i=t.maxzoom);const a=this.locationCoordinate(this.center),l=this.center.lat,c=1<<i,u=[c*a.x,c*a.y,0],h="globe"===this.projection.name,d=!h,p=e.bR.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,i,d),f=h?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),A=c*e.bH(1,this.center.lat),m=this._camera.position[2]/e.bH(1,this.center.lat),g=[c*f.x,c*f.y,m*(d?1:A)],_=h||n,y=this.cameraToCenterDistance/t.tileSize*(t.roundZoom?1:.502),v=this.isLODDisabled(!0)?i:0;let x;if(this._elevation&&t.isTerrainDEM)x=1e4*this._elevation.exaggeration();else if(this._elevation){const e=this._elevation.getMinMaxForVisibleTiles();x=e?e.max:this._centerAltitude}else x=this._centerAltitude;const b=t.isTerrainDEM?-x:this._elevation?this._elevation.getMinElevationBelowMSL():0,w=this.projection.isReprojectedInTileSpace?e.bS(this):1,T=t=>{const i=1/4e4,r=new e.ac(t.x+i,t.y,t.z),n=new e.ac(t.x,t.y+i,t.z),o=t.toLngLat(),s=r.toLngLat(),a=n.toLngLat(),l=this.locationCoordinate(o),c=this.locationCoordinate(s),u=this.locationCoordinate(a),h=Math.hypot(c.x-l.x,c.y-l.y),d=Math.hypot(u.x-l.x,u.y-l.y);return Math.sqrt(h*d)*w/i},B=t=>{const i=x,r=b;return{aabb:e.bV(this,c,0,0,0,t,r,i,this.projection),zoom:0,x:0,y:0,minZ:r,maxZ:i,wrap:t,fullyVisible:!1}},C=[];let S=[];const E=i,M=t.reparseOverscaled?r:i,I=(m-this._centerAltitude)*A,P=e=>{if(!this._elevation||!e.tileID||!s)return;const t=this._elevation.getMinMaxForTile(e.tileID),i=e.aabb;t?(i.min[2]=t.min,i.max[2]=t.max,i.center[2]=(i.min[2]+i.max[2])/2):(e.shouldSplit=F(e),e.shouldSplit||(i.min[2]=i.max[2]=i.center[2]=this._centerAltitude))},L=(e,t)=>{if(.707*t<e)return 1;const i=t/e;return i/(1.4144271570014144+(Math.pow(1.1,i-1.4144271570014144+1)-1)/(1.1-1)-1)},F=t=>{if(t.zoom<v)return!0;if(t.zoom===E)return!1;if(null!=t.shouldSplit)return t.shouldSplit;const i=t.aabb.distanceX(g),n=t.aabb.distanceY(g);let a=I,c=1;if(h){a=t.aabb.distanceZ(g);const i=Math.pow(2,t.zoom),r=e.aT((t.y+1)/i),n=e.aT(t.y/i),o=Math.min(Math.max(l,r),n),s=e.ca(o)/e.ca(l);if(c=o===l?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,s/this._mercatorScaleRatio),this.zoom<=e.c6&&t.zoom===E-1&&s>=.9)return!0}else if(o&&(a=t.aabb.distanceZ(g)*A),this.projection.isReprojectedInTileSpace&&r<=5){const i=Math.pow(2,t.zoom),r=T(new e.ac((t.x+.5)/i,(t.y+.5)/i));c=r>.85?1:r}if(!s){const e=Math.sqrt(i*i+n*n+a*a);let r=(1<<E-t.zoom)*y*c;return r*=L(Math.max(a,I),e),e<r}let d=Number.MAX_VALUE,p=0;const f=t.aabb.getCorners(),m=[];for(const t of f){e.ad.vec3.sub(m,t,g),h||(o?m[2]*=A:m[2]=I);const i=e.ad.vec3.dot(m,this._camera.forward());i<d&&(d=i,p=Math.abs(m[2]))}let _=(1<<E-t.zoom)*y*c;if(_*=L(Math.max(p,I),d),d<_)return!0;const x=t.aabb.closestPoint(u);return x[0]===u[0]&&x[1]===u[1]};if(this.renderWorldCopies)for(let e=1;e<=3;e++)C.push(B(-e)),C.push(B(e));for(C.push(B(0));C.length>0;){const r=C.pop(),n=r.x,a=r.y;let l=r.fullyVisible;const d=()=>"globe"===this.projection.name&&(0===r.y||r.y===(1<<r.zoom)-1);if(!l){let t=_?r.aabb.intersects(p):r.aabb.intersectsFlat(p);if(0===t&&d()){const i=new e.bT(r.zoom,n,a);t=e.bU(this,c,i,!0).intersects(p)}if(0===t)continue;l=2===t}if(r.zoom!==E&&F(r))for(let t=0;t<4;t++){const i=(n<<1)+t%2,u=(a<<1)+(t>>1),d={aabb:s?r.aabb.quadrant(t):e.bV(this,c,r.zoom+1,i,u,r.wrap,r.minZ,r.maxZ,this.projection),zoom:r.zoom+1,x:i,y:u,wrap:r.wrap,fullyVisible:l,tileID:void 0,shouldSplit:void 0,minZ:r.minZ,maxZ:r.maxZ};o&&!h&&(d.tileID=new e.aH(r.zoom+1===E?M:r.zoom+1,r.wrap,r.zoom+1,i,u),P(d)),C.push(d)}else{const o=r.zoom===E?M:r.zoom;if(t.minzoom&&t.minzoom>o)continue;let s=0;if(!l){let i=_?r.aabb.intersectsPrecise(p):r.aabb.intersectsPreciseFlat(p);if(0===i&&d()){const t=new e.bT(r.zoom,n,a);i=e.bU(this,c,t,!0).intersectsPrecise(p)}if(0===i)continue;if(t.calculateQuadrantVisibility)if(p.containsPoint(r.aabb.center))s=15;else for(let e=0;e<4;e++)0!==r.aabb.quadrant(e).intersects(p)&&(s|=1<<e)}const h=u[0]-(.5+n+(r.wrap<<r.zoom))*(1<<i-r.zoom),f=u[1]-.5-a,A=r.tileID?r.tileID:new e.aH(o,r.wrap,r.zoom,n,a);t.calculateQuadrantVisibility&&(A.visibleQuadrants=s),S.push({tileID:A,distanceSq:h*h+f*f})}}if(this.fogCullDistSq){const i=this.fogCullDistSq,r=this.horizonLineFromTop();S=S.filter((n=>{const o=[0,0,0,1],s=[e.ai,e.ai,0,1],a=this.calculateFogTileMatrix(n.tileID.toUnwrapped());e.ad.vec4.transformMat4(o,o,a),e.ad.vec4.transformMat4(s,s,a);const l=e.ad.vec4.min([],o,s),c=e.ad.vec4.max([],o,s),u=e.bW(l,c);if(0===u)return!0;let h=!1;const d=this._elevation;if(d&&u>i&&0!==r){const i=this.calculateProjMatrix(n.tileID.toUnwrapped());let o;t.isTerrainDEM||(o=d.getMinMaxForTile(n.tileID)),o||(o={min:b,max:x});const s=e.c7(this.rotation),a=[s[0]*e.ai,s[1]*e.ai,o.max];e.ad.vec3.transformMat4(a,a,i),h=(1-a[1])*this.height*.5<r}return u<i||h}))}return S.sort(((e,t)=>e.distanceSq-t.distanceSq)).map((e=>e.tileID))}resize(e,t){this.width=e,this.height=t,this.pixelsToGLUnits=[2/e,-2/t],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(e){return Math.pow(2,e)}scaleZoom(e){return Math.log(e)/Math.LN2}project(t){const i=e.ay(t.lat,-e.bX,e.bX),r=this.projection.project(t.lng,i);return new e.P(r.x*this.worldSize,r.y*this.worldSize)}unproject(e){return this.projection.unproject(e.x/this.worldSize,e.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/e.bH(1,this.center.lat)/this.worldSize}setLocationAtPoint(t,i){let r,n;const o=this.centerPoint;if("globe"===this.projection.name){const e=this.worldSize;r=(i.x-o.x)/e,n=(i.y-o.y)/e}else{const e=this.pointCoordinate(i),t=this.pointCoordinate(o);r=e.x-t.x,n=e.y-t.y}const s=this.locationCoordinate(t);this.setLocation(new e.ac(s.x-r,s.y-n))}setLocation(e){this.center=this.coordinateLocation(e),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(e,t){return this.projection.locationPoint(this,e,t)}locationPoint3D(e,t){return this.projection.locationPoint(this,e,t,!0)}pointLocation(e){return this.coordinateLocation(this.pointCoordinate(e))}pointLocation3D(e,t){return this.coordinateLocation(this.pointCoordinate3D(e,t))}locationCoordinate(t,i){const r=i?e.bH(i,t.lat):void 0,n=this.projection.project(t.lng,t.lat);return new e.ac(n.x,n.y,r)}coordinateLocation(e){return this.projection.unproject(e.x,e.y)}pointRayIntersection(t,i){const r=null!=i?i:this._centerAltitude,n=[t.x,t.y,0,1],o=[t.x,t.y,1,1];e.ad.vec4.transformMat4(n,n,this.pixelMatrixInverse),e.ad.vec4.transformMat4(o,o,this.pixelMatrixInverse);const s=o[3];e.ad.vec4.scale(n,n,1/n[3]),e.ad.vec4.scale(o,o,1/s);const a=n[2],l=o[2];return{p0:n,p1:o,t:a===l?0:(r-a)/(l-a)}}screenPointToMercatorRay(t){const i=[t.x,t.y,0,1],r=[t.x,t.y,1,1];return e.ad.vec4.transformMat4(i,i,this.pixelMatrixInverse),e.ad.vec4.transformMat4(r,r,this.pixelMatrixInverse),e.ad.vec4.scale(i,i,1/i[3]),e.ad.vec4.scale(r,r,1/r[3]),i[2]=e.bH(i[2],this._center.lat)*this.worldSize,r[2]=e.bH(r[2],this._center.lat)*this.worldSize,e.ad.vec4.scale(i,i,1/this.worldSize),e.ad.vec4.scale(r,r,1/this.worldSize),new e.as([i[0],i[1],i[2]],e.ad.vec3.normalize([],e.ad.vec3.sub([],r,i)))}rayIntersectionCoordinate(t){const{p0:i,p1:r,t:n}=t,o=e.bH(i[2],this._center.lat),s=e.bH(r[2],this._center.lat);return new e.ac(e.ah(i[0],r[0],n)/this.worldSize,e.ah(i[1],r[1],n)/this.worldSize,e.ah(o,s,n))}pointCoordinate(e,t=this._centerAltitude){return this.projection.pointCoordinate(this,e.x,e.y,t)}pointCoordinate3D(t,i){if(!this.elevation)return this.pointCoordinate(t,i);let r=this.projection.pointCoordinate3D(this,t.x,t.y);if(r)return new e.ac(r[0],r[1],r[2]);let n=0,o=this.horizonLineFromTop();if(t.y>o)return this.pointCoordinate(t,i);const s=.02*o,a=t.clone();for(let t=0;t<10&&o-n>s;t++){a.y=e.ah(n,o,.66);const t=this.projection.pointCoordinate3D(this,a.x,a.y);t?(o=a.y,r=t):n=a.y}return r?new e.ac(r[0],r[1],r[2]):this.pointCoordinate(t)}isPointAboveHorizon(e){return this.projection.isPointAboveHorizon(this,e)}isPointOnSurface(t){if(t.y<0||t.y>this.height||t.x<0||t.x>this.width)return!1;if(this.elevation||this.zoom>=e.bY)return!this.isPointAboveHorizon(t);const i=this.pointCoordinate(t);return i.y>=0&&i.y<=1}_coordinatePoint(t,i){const r=i&&this.elevation?this.elevation.getAtPointOrZero(t,this._centerAltitude):this._centerAltitude,n=[t.x*this.worldSize,t.y*this.worldSize,r+t.toAltitude(),1];return e.ad.vec4.transformMat4(n,n,this.pixelMatrix),n[3]>0?new e.P(n[0]/n[3],n[1]/n[3]):new e.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:t,left:i}=this._edgeInsets,r=this.height-this._edgeInsets.bottom,n=this.width-this._edgeInsets.right,o=this.pointLocation3D(new e.P(i,t)),s=this.pointLocation3D(new e.P(n,t)),a=this.pointLocation3D(new e.P(n,r)),l=this.pointLocation3D(new e.P(i,r));let c=Math.min(o.lng,s.lng,a.lng,l.lng),u=Math.max(o.lng,s.lng,a.lng,l.lng),h=Math.min(o.lat,s.lat,a.lat,l.lat),d=Math.max(o.lat,s.lat,a.lat,l.lat);const p=Math.pow(2,-this.zoom)/16*270,f="globe"===this.projection.name?1:4,A=(t,i,r,n,o)=>{const s=(t+r)/2,a=(i+n)/2,l=new e.P(s,a),{lng:m,lat:g}=this.pointLocation3D(l),_=Math.max(0,c-m,h-g,m-u,g-d);c=Math.min(c,m),u=Math.max(u,m),h=Math.min(h,g),d=Math.max(d,g),(o<f||_>p)&&(A(t,i,s,a,o+1),A(s,a,r,n,o+1))};if(A(i,t,n,t,1),A(n,t,n,r,1),A(n,r,i,r,1),A(i,r,i,t,1),"globe"===this.projection.name){const[t,i]=e.bZ(this);t?(d=90,u=180,c=-180):i&&(h=-90,u=180,c=-180)}return new e.aB(new e.bO(c,h),new e.bO(u,d))}_getBoundsRectangular(t,i){const{top:r,left:n}=this._edgeInsets,o=this.height-this._edgeInsets.bottom,s=this.width-this._edgeInsets.right,a=new e.P(n,r),l=new e.P(s,r),c=new e.P(s,o),u=new e.P(n,o);let h=this.pointCoordinate(a,t),d=this.pointCoordinate(l,t);const p=this.pointCoordinate(c,i),f=this.pointCoordinate(u,i),A=(e,t)=>(t.y-e.y)/(t.x-e.x);return h.y>1&&d.y>=0?h=new e.ac((1-f.y)/A(f,h)+f.x,1):h.y<0&&d.y<=1&&(h=new e.ac(-f.y/A(f,h)+f.x,0)),d.y>1&&h.y>=0?d=new e.ac((1-p.y)/A(p,d)+p.x,1):d.y<0&&h.y<=1&&(d=new e.ac(-p.y/A(p,d)+p.x,0)),(new e.aB).extend(this.coordinateLocation(h)).extend(this.coordinateLocation(d)).extend(this.coordinateLocation(f)).extend(this.coordinateLocation(p))}_getBoundsRectangularTerrain(){const e=this.elevation;if(!e.visibleDemTiles.length||e.isUsingMockSource())return this._getBoundsRectangular(0,0);const t=e.visibleDemTiles.reduce(((e,t)=>{if(t.dem){const i=t.dem.tree;e.min=Math.min(e.min,i.minimums[0]),e.max=Math.max(e.max,i.maximums[0])}return e}),{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(t.min*e.exaggeration(),t.max*e.exaggeration())}getBounds(){return"mercator"===this.projection.name||"equirectangular"===this.projection.name?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(e=!0){const t=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,i=this.height/2-t*(1-this._horizonShift);return e?Math.max(0,i):i}getMaxBounds(){return this.maxBounds}setMaxBounds(t){this.maxBounds=t,this.minLat=-e.bX,this.maxLat=e.bX,this.minLng=-180,this.maxLng=180,t&&(this.minLat=t.getSouth(),this.maxLat=t.getNorth(),this.minLng=t.getWest(),this.maxLng=t.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=e.av(this.minLng)*this.tileSize,this.worldMaxX=e.av(this.maxLng)*this.tileSize,this.worldMinY=e.aC(this.maxLat)*this.tileSize,this.worldMaxY=e.aC(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(e,t){return this.projection.createTileMatrix(this,t,e)}calculateDistanceTileData(t){const i=t.key,r=this._distanceTileDataCache;if(r[i])return r[i];const n=t.canonical,o=1/this.height,s=this.cameraWorldSize,a=s/this.zoomScale(n.z),l=(n.x+Math.pow(2,n.z)*t.wrap)*a,c=n.y*a,u=this.point;u.x*=s/this.worldSize,u.y*=s/this.worldSize;const h=this.angle,d=Math.sin(-h),p=-Math.cos(-h);return r[i]={bearing:[d,p],center:[(u.x-l)*o,(u.y-c)*o],scale:a/e.ai*o},r[i]}calculateFogTileMatrix(t){const i=t.key,r=this._fogTileMatrixCache;if(r[i])return r[i];const n=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,t);return e.ad.mat4.multiply(n,this.worldToFogMatrix,n),r[i]=new Float32Array(n),r[i]}calculateProjMatrix(t,i=!1,r=!1){const n=t.key;let o;if(o=r?this._expandedProjMatrixCache:i?this._alignedProjMatrixCache:this._projMatrixCache,o[n])return o[n];const s=this.calculatePosMatrix(t,this.worldSize);let a;return a=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:r?this.expandedFarZProjMatrix:i?this.alignedProjMatrix:this.projMatrix,e.ad.mat4.multiply(s,a,s),o[n]=new Float32Array(s),o[n]}calculatePixelsToTileUnitsMatrix(t){const i=t.tileID.key,r=this._pixelsToTileUnitsCache;if(r[i])return r[i];const n=e.b_(t,this);return r[i]=n,r[i]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if("globe"===this.projection.name){const t=1/this.worldSize,i=e.ad.mat4.fromScaling([],[t,t,t]);return e.ad.mat4.multiply(i,i,this.globeMatrix),i}}recenterOnTerrain(){if(!this._elevation||"globe"===this.projection.name)return;const t=this._elevation;this._updateCameraState();const i=e.bH(1,this._center.lat)*this.worldSize,r=this._computeCameraPosition(i),n=this._camera.forward(),o=e.bH(1,this._center.lat);r[2]/=o,n[2]/=o,e.ad.vec3.normalize(n,n);const s=t.raycast(r,n,t.exaggeration());if(s){const t=e.ad.vec3.scaleAndAdd([],r,n,s),i=new e.ac(t[0],t[1],e.bH(t[2],e.aT(t[1]))),a=(i.z+e.ad.vec3.length([i.x-r[0],i.y-r[1],i.z-r[2]*o]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(a),this._centerAltitude=i.toAltitude(),this._center=this.coordinateLocation(i),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(t=!1){if(!this._elevation)return;const i=this._elevation,r=e.bH(1,this._center.lat)*this.worldSize,n=this._computeCameraPosition(r),o=i.getAtPointOrZero(new e.ac(...n)),s=this.pixelsPerMeter/this.worldSize*o,a=this._minimumHeightOverTerrain(),l=n[2]-s;if(l<=a)if(l<0||t){const t=this.locationCoordinate(this._center,this._centerAltitude),i=[n[0],n[1],t.z-n[2]],r=e.ad.vec3.length(i);i[2]-=(a-l)/this._pixelsPerMercatorPixel;const o=e.ad.vec3.length(i);if(0===o)return;e.ad.vec3.scale(i,i,r/o*this._pixelsPerMercatorPixel),this._camera.position=[n[0],n[1],t.z*this._pixelsPerMercatorPixel-i[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const t="globe"===this.projection.name||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||t){const i=this.center;return i.lat=e.ay(i.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!t)&&(i.lng=e.ay(i.lng,this.minLng,this.maxLng)),this.center=i,void(this._constraining=!1)}const i=this._unmodified,{x:r,y:n}=this.point;let o=0,s=r,a=n;const l=this.width/2,c=this.height/2,u=this.worldMinY*this.scale,h=this.worldMaxY*this.scale;if(n-c<u&&(a=u+c),n+c>h&&(a=h-c),h-u<this.height&&(o=Math.max(o,this.height/(h-u)),a=(h+u)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const e=this.worldMinX*this.scale,t=this.worldMaxX*this.scale,i=this.worldSize/2-(e+t)/2;s=(r+i+this.worldSize)%this.worldSize-i,s-l<e&&(s=e+l),s+l>t&&(s=t-l),t-e<this.width&&(o=Math.max(o,this.width/(t-e)),s=(t+e)/2)}s===r&&a===n||this._allowWorldUnderZoom||(this.center=this.unproject(new e.P(s,a))),o&&!this._allowWorldUnderZoom&&(this.zoom+=this.scaleZoom(o)),this._constrainCamera(),this._unmodified=i,this._constraining=!1}_minZoomForBounds(){let e=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(e=Math.max(e,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),e}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,i="globe"===this.projection.name,r=this.pixelsPerMeter;"globe"===this.projection.name&&(this._mercatorScaleRatio=e.bH(1,this.center.lat)/e.bH(1,e.c8));const n=e.b$(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,n),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const o="meters"===this.projection.zAxisUnit?r:1,s=this._camera.getWorldToCamera(this.worldSize,o);let a;const l=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(l[8]=2*-t.x/this.width,l[9]=2*t.y/this.height,this.isOrthographic){let i=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),r=i*this.aspect,n=-r,o=-i;r-=t.x,n-=t.x,i+=t.y,o+=t.y,a=this._camera.getCameraToClipOrthographic(n,r,o,i,this._nearZ,this._farZ),((t,i,r,n)=>{for(let o=0;o<16;o++)t[o]=e.ah(i[o],r[o],n)})(a,a,l,e.c9(this.pitch>=Xi?1:this.pitch/Xi))}else a=l;const c=e.ad.mat4.mul([],l,s);let u=e.ad.mat4.mul([],a,s);if(this.projection.isReprojectedInTileSpace){const t=this.locationCoordinate(this.center),i=e.ad.mat4.identity([]);e.ad.mat4.translate(i,i,[t.x*this.worldSize,t.y*this.worldSize,0]),e.ad.mat4.multiply(i,i,e.c0(this)),e.ad.mat4.translate(i,i,[-t.x*this.worldSize,-t.y*this.worldSize,0]),e.ad.mat4.multiply(u,u,i),e.ad.mat4.multiply(c,c,i),this.inverseAdjustmentMatrix=e.c1(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=e.ad.mat4.scale([],u,[this.worldSize,this.worldSize,this.worldSize/o,1]),this.projMatrix=u,this.invProjMatrix=e.ad.mat4.invert(new Float64Array(16),this.projMatrix),i){const i=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);i[8]=2*-t.x/this.width,i[9]=2*t.y/this.height,this.expandedFarZProjMatrix=e.ad.mat4.mul([],i,s)}else this.expandedFarZProjMatrix=this.projMatrix;const h=e.ad.mat4.invert([],a);this.frustumCorners=e.c2.fromInvProjectionMatrix(h,this.horizonLineFromTop(),this.height),this.cameraFrustum=e.bR.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!i);const d=new Float32Array(16);e.ad.mat4.identity(d),e.ad.mat4.scale(d,d,[1,-1,1]),e.ad.mat4.rotateX(d,d,this._pitch),e.ad.mat4.rotateZ(d,d,this.angle);const p=e.ad.mat4.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=e.ad.mat4.clone(p);const f=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;p[8]=2*-t.x/this.width,p[9]=2*(t.y+f)/this.height,this.skyboxMatrix=e.ad.mat4.multiply(d,p,d);const A=this.point,m=A.x,g=A.y,_=this.width%2/2,y=this.height%2/2,v=Math.cos(this.angle),x=Math.sin(this.angle),b=m-Math.round(m)+v*_+x*y,w=g-Math.round(g)+v*y+x*_,T=new Float64Array(u);if(e.ad.mat4.translate(T,T,[b>.5?b-1:b,w>.5?w-1:w,0]),this.alignedProjMatrix=T,u=e.ad.mat4.create(),e.ad.mat4.scale(u,u,[this.width/2,-this.height/2,1]),e.ad.mat4.translate(u,u,[1,-1,0]),this.labelPlaneMatrix=u,u=e.ad.mat4.create(),e.ad.mat4.scale(u,u,[1,-1,1]),e.ad.mat4.translate(u,u,[-1,-1,0]),e.ad.mat4.scale(u,u,[2/this.width,2/this.height,1]),this.glCoordMatrix=u,this.pixelMatrix=e.ad.mat4.multiply(new Float64Array(16),this.labelPlaneMatrix,c),this._calcFogMatrices(),this._distanceTileDataCache={},u=e.ad.mat4.invert(new Float64Array(16),this.pixelMatrix),!u)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=u,"globe"===this.projection.name||this.mercatorFromTransition){this.globeMatrix=e.c3(this);const t=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=e.ad.vec3.transformMat4(t,t,s),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=u;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const t=this.cameraWorldSizeForFog,i=this.cameraPixelsPerMeter,r=this._camera.position,n=1/this.height/this._pixelsPerMercatorPixel,o=[t,t,i];e.ad.vec3.scale(o,o,n),e.ad.vec3.scale(r,r,-1),e.ad.vec3.multiply(r,r,o);const s=e.ad.mat4.create();e.ad.mat4.translate(s,s,r),e.ad.mat4.scale(s,s,o),this.mercatorFogMatrix=s,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(t,i,n)}_computeCameraPosition(e){const t=(e=e||this.pixelsPerMeter)/this.pixelsPerMeter,i=this._camera.forward(),r=this.point,n=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*t-e/this.worldSize*this._centerAltitude;return[r.x/this.worldSize-i[0]*n,r.y/this.worldSize-i[1]*n,e/this.worldSize*this._centerAltitude-i[2]*n]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(t){const i=this._maxCameraBoundsDistance()*Math.cos(this._pitch),r=this._camera.position[2],n=t[2];let o=1;this.projection.wrap&&(this.center=this.center.wrap()),n>0&&(o=Math.min((i-r)/n,1)),this._camera.position=e.ad.vec3.scaleAndAdd([],this._camera.position,t,o),this._updateStateFromCamera()}_updateStateFromCamera(){const t=this._camera.position,i=this._camera.forward(),{pitch:r,bearing:n}=this._camera.getPitchBearing(),o=e.bH(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,s=this._mercatorZfromZoom(this._maxZoom)*Math.cos(e.ak(this._maxPitch)),a=Math.max((t[2]-o)/Math.cos(r),s),l=this._zoomFromMercatorZ(a);e.ad.vec3.scaleAndAdd(t,t,i,a),this._pitch=e.ay(r,e.ak(this.minPitch),e.ak(this.maxPitch)),this.angle=e.bF(n,-Math.PI,Math.PI),this._setZoom(e.ay(l,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new e.ac(t[0],t[1],t[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(e){return Math.pow(2,e)*this.tileSize}_mercatorZfromZoom(e){return this.cameraToCenterDistance/this._worldSizeFromZoom(e)}_minimumHeightOverTerrain(){const e=Math.min(null!=this._seaLevelZoom?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(e)}_zoomFromMercatorZ(e){return this.scaleZoom(this.cameraToCenterDistance/(e*this.tileSize))}zoomFromMercatorZAdjusted(t){let i=0,r=e.bY,n=0,o=1/0;for(;r-i>1e-6&&r>i;){const e=i+.5*(r-i),s=this.tileSize*Math.pow(2,e),a=this.getCameraToCenterDistance(this.projection,e,s),l=this.scaleZoom(a/(t*this.tileSize)),c=Math.abs(e-l);c<o&&(o=c,n=e),e<l?i=e:r=e}return n}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(e.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(t,i){const r=Math.min(t.x,i.x),n=Math.max(t.x,i.x),o=Math.min(t.y,i.y),s=Math.max(t.y,i.y);if(o<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const a=[new e.P(r,o),new e.P(n,s),new e.P(r,s),new e.P(n,o)],l=this.renderWorldCopies?-3:0,c=this.renderWorldCopies?4:1;for(const e of a){const t=this.pointRayIntersection(e);if(t.t<0)return!0;const i=this.rayIntersectionCoordinate(t);if(i.x<l||i.y<0||i.x>c||i.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+e.c4(this.fovAboveCenter)>88||this.anyCornerOffEdge(new e.P(0,0),new e.P(this.width,this.height))}zoomDeltaToMovement(t,i){const r=e.ad.vec3.length(e.ad.vec3.sub([],this._camera.position,t)),n=this._zoomFromMercatorZ(r)+i;return r-this._mercatorZfromZoom(n)}getCameraPoint(){if("globe"===this.projection.name){const t=function([t,i,r],n){const o=[t,i,r,1];e.ad.vec4.transformMat4(o,o,n);const s=o[3]=Math.max(o[3],1e-6);return o[0]/=s,o[1]/=s,o[2]/=s,o}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new e.P(t[0],t[1])}{const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new e.P(0,t))}}getCameraToCenterDistance(t,i=this.zoom,r=this.worldSize){const n=e.b$(t,i,this.width,this.height,1024),o=t.pixelSpaceConversion(this.center.lat,r,n);let s=.5/Math.tan(.5*this._fov)*this.height*o;return this.isOrthographic&&(s=e.ah(1,s,e.c9(this.pitch>=Xi?1:this.pitch/Xi))),s}getWorldToCameraMatrix(){const t=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?this.pixelsPerMeter:1);return"globe"===this.projection.name&&e.ad.mat4.multiply(t,t,this.globeMatrix),t}getFrustum(t){return e.bR.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,t,"meters"===this.projection.zAxisUnit)}}const Ji=(t,i)=>{if(i>0&&t.terrain&&e.w("Cutoff is currently disabled on terrain"),i<=0||t.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const r=t.transform,n=Math.max(Math.abs(r._zoom-(t.minCutoffZoom-1)),1),o=r.isLODDisabled(!1)?e.ae(60,45,r.pitch):e.ae(30,15,r.pitch),s=r._farZ-r._nearZ,a=i*r.height,l=((1-(c=o))*r.cameraToCenterDistance+c*(r._farZ+a))*n;var c;return{shouldRenderCutoff:o<1,uniformValues:{u_cutoff_params:[r._nearZ,r._farZ,(l-r._nearZ)/s,(l-a-r._nearZ)/s]}}},er={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class tr{constructor(e,t){this.aabb=e,this.lastCascade=t}}class ir{add(e,t){const i=this.receivers[e.key];void 0!==i?(i.aabb.min[0]=Math.min(i.aabb.min[0],t.min[0]),i.aabb.min[1]=Math.min(i.aabb.min[1],t.min[1]),i.aabb.min[2]=Math.min(i.aabb.min[2],t.min[2]),i.aabb.max[0]=Math.max(i.aabb.max[0],t.max[0]),i.aabb.max[1]=Math.max(i.aabb.max[1],t.max[1]),i.aabb.max[2]=Math.max(i.aabb.max[2],t.max[2])):this.receivers[e.key]=new tr(t,null)}clear(){this.receivers={}}get(e){return this.receivers[e.key]}computeRequiredCascades(t,i,r){const n=e.ce.fromPoints(t.points);let o=0;for(const t in this.receivers){const s=this.receivers[t];if(!s)continue;if(!n.intersectsAabb(s.aabb))continue;s.aabb.min=n.closestPoint(s.aabb.min),s.aabb.max=n.closestPoint(s.aabb.max);const a=s.aabb.getCorners();for(let t=0;t<r.length;t++){let n=!0;for(const o of a){const s=[o[0]*i,o[1]*i,o[2]];if(e.ad.vec3.transformMat4(s,s,r[t].matrix),s[0]<-1||s[0]>1||s[1]<-1||s[1]>1){n=!1;break}}if(s.lastCascade=t,o=Math.max(o,t),n)break}}return o+1}}class rr{constructor(e){this.painter=e,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new ir,this._depthMode=new Oi(e.context.gl.LEQUAL,Oi.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,e.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},(()=>{this.painter.style.map.triggerRepaint()})),e.tp.registerParameter(er,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),e.tp.registerParameter(er,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),e.tp.registerParameter(er,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),e.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const e of this._cascades)e.texture.destroy(),e.framebuffer.destroy();this._cascades=[]}updateShadowParameters(t,i){const r=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!i||!i.properties)return;const n=i.properties.get("shadow-intensity");if(!i.shadowsEnabled()||n<=0)return;if(this._shadowLayerCount=r.style.order.reduce(((e,i)=>{const n=r.style._mergedLayers[i];return e+(n.hasShadowPass()&&!n.isHidden(t.zoom)?1:0)}),0),this._enabled=this._shadowLayerCount>0,!this.enabled)return;const o=r.context,s=er.shadowMapResolution,a=er.shadowMapResolution;if(0===this._cascades.length||er.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let t=0;t<er.cascadeCount;++t){const t=r._shadowMapDebug,i=o.gl,n=o.createFramebuffer(s,a,t,"texture"),l=new e.T(o,{width:s,height:a,data:null},i.DEPTH_COMPONENT16);if(n.depthAttachment.set(l.texture),t){const t=new e.T(o,{width:s,height:a,data:null},i.RGBA8);n.colorAttachment.set(t.texture)}this._cascades.push({framebuffer:n,texture:l,matrix:[],far:0,boundingSphereRadius:0,frustum:new e.bR,scale:0})}}this.shadowDirection=or(i);let l=0;if(t.elevation){const e=t.elevation,i=[1e4,-1e4];e.visibleDemTiles.filter((e=>e.dem)).forEach((e=>{const t=e.dem.tree;i[0]=Math.min(i[0],t.minimums[0]),i[1]=Math.max(i[1],t.maximums[0])})),1e4!==i[0]&&(l=(i[1]-i[0])*e.exaggeration())}const c=1.5*t.cameraToCenterDistance,u=3*c,h=new Float64Array(16);for(let i=0;i<this._cascades.length;++i){const r=this._cascades[i];let n=t.height/50,o=1;1===er.cascadeCount?o=u:0===i?o=c:(n=c,o=u);const[s,a]=ar(t,this.shadowDirection,n,o,er.shadowMapResolution,l);r.scale=t.scale,r.matrix=s,r.boundingSphereRadius=a,e.ad.mat4.invert(h,r.matrix),r.frustum=e.bR.fromInvProjectionMatrix(h,1,0,!0),r.far=o}const d=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[d].far,this._cascades[d].far],this._uniformValues.u_shadow_intensity=n,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/er.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=er.shadowMapResolution,this._uniformValues.u_shadowmap_0=Ki.ShadowMap0,this._uniformValues.u_shadowmap_1=Ki.ShadowMap0+1,this._groundShadowTiles=r.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const p=r.transform.elevation;for(const e of this._groundShadowTiles){let t={min:0,max:0};if(p){const i=p.getMinMaxForTile(e);i&&(t=i)}this.addShadowReceiver(e.toUnwrapped(),t.min,t.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(e){this._enabled=e}drawShadowPass(t,i){if(!this.enabled)return;const r=this.painter,n=r.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(r.transform.getFrustum(0),r.transform.worldSize,this._cascades),n.viewport.set([0,0,er.shadowMapResolution,er.shadowMapResolution]);for(let o=0;o<this._numCascadesToRender;++o){r.currentShadowCascade=o,n.bindFramebuffer.set(this._cascades[o].framebuffer.framebuffer),n.clear({color:e.al.white,depth:1});for(const e of t.order){const n=t._mergedLayers[e];if(!n.hasShadowPass()||n.isHidden(r.transform.zoom))continue;const o=t.getLayerSourceCache(n),s=o?i[o.id]:void 0;("model"===n.type||s&&s.length)&&r.renderLayer(r,o,n,s)}}r.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const e=this.painter,t=e.style,i=e.context,r=t.directionalLight,n=t.ambientLight;if(!r||!n)return;const o=[],s=Ji(e,e.longestCutoffRange);s.shouldRenderCutoff&&o.push("RENDER_CUTOFF"),o.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&o.push("NORMAL_OFFSET");const a=sr(t,r,n),l=new Oi(i.gl.LEQUAL,Oi.ReadOnly,e.depthRangeFor3D);for(const t of this._groundShadowTiles){const r=t.toUnwrapped(),n=e.isTileAffectedByFog(t),c=e.getOrCreateProgram("groundShadow",{defines:o,overrideFog:n});this.setupShadows(r,c),e.uploadCommonUniforms(i,c,r,null,s);const u={u_matrix:e.transform.calculateProjMatrix(r),u_ground_shadow_factor:a};c.draw(e,i.gl.TRIANGLES,l,Ni.disabled,Di.multiply,Vi.disabled,u,"ground_shadow",e.tileExtentBuffer,e.quadTriangleIndexBuffer,e.tileExtentSegments,null,e.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?Di.unblended:Di.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(t){const i=this.painter.transform,r=i.calculatePosMatrix(t,i.worldSize);return e.ad.mat4.multiply(r,this._cascades[this.painter.currentShadowCascade].matrix,r),Float32Array.from(r)}calculateShadowPassMatrixFromMatrix(t){return e.ad.mat4.multiply(t,this._cascades[this.painter.currentShadowCascade].matrix,t),Float32Array.from(t)}setupShadows(t,i,r,n=0){if(!this.enabled)return;const o=this.painter.transform,s=this.painter.context,a=s.gl,l=this._uniformValues,c=new Float64Array(16),u=o.calculatePosMatrix(t,o.worldSize);for(let t=0;t<this._cascades.length;t++)e.ad.mat4.multiply(c,this._cascades[t].matrix,u),l[0===t?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(c),s.activeTexture.set(a.TEXTURE0+Ki.ShadowMap0+t),this._cascades[t].texture.bind(a.NEAREST,a.CLAMP_TO_EDGE);if(this.useNormalOffset=!!r,this.useNormalOffset){const i=e.cd(t.canonical),s=2/o.tileSize*e.ai/er.shadowMapResolution,a=s*this._cascades[0].boundingSphereRadius,c=s*this._cascades[this._cascades.length-1].boundingSphereRadius,u=("vector-tile"===r?1:3)/Math.pow(2,n-t.canonical.z-(1-o.zoom+Math.floor(o.zoom)));l.u_shadow_normal_offset=[i,a*u,c*u],l.u_shadow_bias=[6e-5,.0012,.012]}else l.u_shadow_bias=[36e-5,.0012,.012];i.setShadowUniformValues(s,l)}setupShadowsFromMatrix(t,i,r=!1){if(!this.enabled)return;const n=this.painter.context,o=n.gl,s=this._uniformValues,a=new Float64Array(16);for(let i=0;i<er.cascadeCount;i++)e.ad.mat4.multiply(a,this._cascades[i].matrix,t),s[0===i?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(a),n.activeTexture.set(o.TEXTURE0+Ki.ShadowMap0+i),this._cascades[i].texture.bind(o.NEAREST,o.CLAMP_TO_EDGE);if(this.useNormalOffset=r,r){const e=er.normalOffset;s.u_shadow_normal_offset=[1,e,e],s.u_shadow_bias=[6e-5,.0012,.012]}else s.u_shadow_bias=[36e-5,.0012,.012];i.setShadowUniformValues(n,s)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(t,i,r,n){if(n[2]>=0)return{};const o=function(t,i,r){const n=r/(1<<t.canonical.z);return new e.ce([t.canonical.x*n+t.wrap*r,t.canonical.y*n+t.wrap*r,0],[(t.canonical.x+1)*n+t.wrap*r,(t.canonical.y+1)*n+t.wrap*r,i])}(t,i,r).getCorners(),s=i/-n[2];n[0]<0?(e.ad.vec3.add(o[0],o[0],[n[0]*s,0,0]),e.ad.vec3.add(o[3],o[3],[n[0]*s,0,0])):n[0]>0&&(e.ad.vec3.add(o[1],o[1],[n[0]*s,0,0]),e.ad.vec3.add(o[2],o[2],[n[0]*s,0,0])),n[1]<0?(e.ad.vec3.add(o[0],o[0],[0,n[1]*s,0]),e.ad.vec3.add(o[1],o[1],[0,n[1]*s,0])):n[1]>0&&(e.ad.vec3.add(o[2],o[2],[0,n[1]*s,0]),e.ad.vec3.add(o[3],o[3],[0,n[1]*s,0]));const a={};return a.vertices=o,a.planes=[nr(o[1],o[0],o[4]),nr(o[2],o[1],o[5]),nr(o[3],o[2],o[6]),nr(o[0],o[3],o[7])],a}addShadowReceiver(t,i,r){this._receivers.add(t,e.ce.fromTileIdAndHeight(t,i,r))}getMaxCascadeForTile(e){const t=this._receivers.get(e);return t&&t.lastCascade?t.lastCascade:0}}function nr(t,i,r){const n=e.ad.vec3.sub([],r,i),o=e.ad.vec3.sub([],t,i),s=e.ad.vec3.cross([],n,o),a=e.ad.vec3.length(s);return 0===a?[0,0,1,0]:(e.ad.vec3.scale(s,s,1/a),[s[0],s[1],s[2],-e.ad.vec3.dot(s,i)])}function or(t){const i=t.properties.get("direction"),r=e.cc(i.x,i.y,i.z);r[2]=e.ay(r[2],0,75);const n=e.cf([r[0],r[1],r[2]]);return e.ad.vec3.fromValues(n.x,n.y,n.z)}function sr(t,i,r){const n="none"===i.properties.get("color-use-theme"),o=i.properties.get("color"),s=i.properties.get("intensity"),a=i.properties.get("direction"),l=[a.x,a.y,a.z],c="none"===r.properties.get("color-use-theme"),u=r.properties.get("color"),h=r.properties.get("intensity"),d=Math.max(e.ad.vec3.dot([0,0,1],l),0),p=[0,0,0];e.ad.vec3.scale(p,u.toRenderColor(c?null:t.getLut(i.scope)).toArray01Linear().slice(0,3),h);const f=[0,0,0];return e.ad.vec3.scale(f,o.toRenderColor(n?null:t.getLut(r.scope)).toArray01Linear().slice(0,3),d*s),e.cg([p[0]>0?p[0]/(p[0]+f[0]):0,p[1]>0?p[1]/(p[1]+f[1]):0,p[2]>0?p[2]/(p[2]+f[2]):0])}function ar(t,i,r,n,o,s){const a=t.zoom,l=t.scale,c=t.worldSize,u=1/c,h=t.aspect,d=Math.sqrt(1+h*h)*Math.tan(.5*t.fovX),p=d*d,f=n-r,A=n+r;let m,g;p>f/A?(m=n,g=n*d):(m=.5*A*(1+p),g=.5*Math.sqrt(f*f+2*(n*n+r*r)*p+A*A*p*p));const _=t.projection.pixelsPerMeter(t.center.lat,c),y=t._camera.getCameraToWorldMercator(),v=[0,0,-m*u];e.ad.vec3.transformMat4(v,v,y);let x=g*u;const b=t._edgeInsets;if(!(0===b.left&&0===b.top&&0===b.right&&0===b.bottom||b.left===b.right&&b.top===b.bottom)){const i=t._camera.getWorldToCamera(t.worldSize,"meters"===t.projection.zAxisUnit?_:1),o=t._camera.getCameraToClipPerspective(t._fov,t.width/t.height,r,n);o[8]=2*-t.centerOffset.x/t.width,o[9]=2*t.centerOffset.y/t.height;const s=new Float64Array(16);e.ad.mat4.mul(s,o,i);const u=new Float64Array(16);e.ad.mat4.invert(u,s);const h=e.bR.fromInvProjectionMatrix(u,c,a,!0);for(const i of h.points){const r=((w=i)[0]/=l,w[1]/=l,w[2]=e.bH(w[2],t._center.lat),w);x=Math.max(x,e.ad.vec3.len(e.ad.vec3.subtract([],v,r)))}}var w;x*=o/(o-1);const T=Math.acos(i[2]),B=Math.atan2(-i[0],-i[1]),C=new qi;C.position=v,C.setPitchBearing(T,B);const S=C.getWorldToCamera(c,_),E=x*c,M=Math.min(t._mercatorZfromZoom(17)*c*-2,-2*E),I=C.getCameraToClipOrthographic(-E,E,-E,E,M,(E+s*_)/i[2]),P=new Float64Array(16);e.ad.mat4.multiply(P,I,S);const L=e.ad.vec3.fromValues(Math.floor(1e6*v[0])/1e6*c,Math.floor(1e6*v[1])/1e6*c,0),F=.5*o,k=[0,0,0];e.ad.vec3.transformMat4(k,L,P),e.ad.vec3.scale(k,k,F);const z=[Math.floor(k[0]),Math.floor(k[1]),Math.floor(k[2])],R=[0,0,0];e.ad.vec3.sub(R,k,z),e.ad.vec3.scale(R,R,-1/F);const D=new Float64Array(16);return e.ad.mat4.identity(D),e.ad.mat4.translate(D,D,R),e.ad.mat4.multiply(P,D,P),[P,E]}class lr extends e.E{constructor(e){super(),this.requestManager=e,this.models={"":{}},this.modelUris={"":{}},this.numModelsLoading={}}loadModel(t,i){return e.aN(this.requestManager.transformRequest(i,e.R.Model).url).then((i=>{if(!i)return;const r=e.aO(i),n=new e.aP(t,void 0,void 0,r);return n.computeBoundsAndApplyParent(),n})).catch((r=>{if(r&&404===r.status)return null;this.fire(new e.z(new Error(`Could not load model ${t} from ${i}: ${r.message}`)))}))}load(t,i,r={keepNumReferences:!1}){this.models[i]||(this.models[i]={});const n=Object.keys(t);this.numModelsLoading[i]=(this.numModelsLoading[i]||0)+n.length;const o=[];for(const e of n)o.push(this.loadModel(e,t[e]));Promise.allSettled(o).then((t=>{for(let e=0;e<t.length;e++){const{status:o,value:s}=t[e];if("fulfilled"===o&&s){const t=this.models[i][n[e]];this.models[i][n[e]]={model:s,numReferences:r.keepNumReferences&&t?t.numReferences:1}}}this.numModelsLoading[i]-=n.length,this.fire(new e.A("data",{dataType:"style"}))})).catch((t=>{this.fire(new e.z(new Error(`Could not load models: ${t.message}`)))}))}isLoaded(){for(const e in this.numModelsLoading)if(this.numModelsLoading[e]>0)return!1;return!0}hasModel(e,t){return!!this.getModel(e,t)}getModel(e,t){return this.models[t]||(this.models[t]={}),this.models[t][e]?this.models[t][e].model:void 0}addModel(e,t,i){this.models[i]||(this.models[i]={}),this.modelUris[i]||(this.modelUris[i]={}),this.hasModel(e,i)&&this.models[i][e].numReferences++,this.modelUris[i][e]=this.requestManager.normalizeModelURL(t),this.load({[e]:this.modelUris[i][e]},i)}addModels(e,t){this.models[t]||(this.models[t]={}),this.modelUris[t]||(this.modelUris[t]={});const i=this.modelUris[t];for(const r in e)this.models[t][r]={},i[r]=this.requestManager.normalizeModelURL(e[r]);this.load(i,t,{keepNumReferences:!0})}reloadModels(e){this.load(this.modelUris[e],e)}addModelsFromBucket(e,t){this.models[t]||(this.models[t]={}),this.modelUris[t]||(this.modelUris[t]={});const i={};for(const r of e)this.hasModel(r,t)?this.models[t][r].numReferences++:(this.modelUris[t][r]=this.requestManager.normalizeModelURL(r),i[r]=this.modelUris[t][r]);this.load(i,t)}removeModel(e,t){if(this.models[t]&&this.models[t][e]&&(this.models[t][e].numReferences--,0===this.models[t][e].numReferences)){const i=this.models[t][e].model;delete this.models[t][e],delete this.modelUris[t][e],i.destroy()}}listModels(e){return this.models[e]||(this.models[e]={}),Object.keys(this.models[e])}upload(e,t){this.models[t]||(this.models[t]={});for(const i in this.models[t])this.models[t][i].model&&this.models[t][i].model.upload(e.context)}}const cr=new e.a7({data:new e.a8(e.a5.colorTheme.data)}),ur={"mbx-indoor-active-floorplans":{default:["literal",[]]},"mbx-indoor-underground":{default:["literal",!1]},"mbx-indoor-loaded-levels":{default:["literal",[]]},"mbx-indoor-level-height":{default:["literal",{}]},"mbx-indoor-level-base":{default:["literal",{}]},"mbx-indoor-level-selected":{default:["literal",{}]},"mbx-indoor-level-overlapped":{default:["literal",{}]}};function hr(e){return e=e||{},Object.assign(e,ur)}class dr extends e.E{constructor(t){super(),this.mergeFloors=!0,this._scope=void 0,this._queryFeatureSetId=void 0,this._buildingEntryFeatureSetId=void 0,this._selectedFloorplan=void 0,this._indoorData=void 0,this._selectedLevel=void 0,this._floorplanStates={},e.aQ(["_onLoad","_onMove","_checkFloorplanVisible"],this),this._map=t,this._checkFloorplanVisible(!0),this._map.on("load",this._onLoad),this._map.on("move",this._onMove)}destroy(){this._map.indoor.off("load",this._onLoad),this._map.indoor.off("move",this._onMove),this._map=void 0}_onLoad(){this._map.style.forEachFragmentStyle((t=>{t.stylesheet.indoor&&(this._queryFeatureSetId?this.fire(new e.z(new Error("Multiple indoor map styles detected, simultaneous usage is not allowed currently."))):(this._queryFeatureSetId=t.stylesheet.indoor.floorplanFeaturesetId,this._buildingEntryFeatureSetId=t.stylesheet.indoor.buildingFeaturesetId,this._scope=t.scope))})),this._queryFeatureSetId&&this._buildingEntryFeatureSetId&&this._map.addInteraction("mbx-indoor-buildingclick",{type:"click",target:{featuresetId:this._buildingEntryFeatureSetId,importId:this._scope},handler:e=>(e.feature&&e.feature.properties.floorplan&&this.selectFloorplan(e.feature.properties.floorplan),!0)}),this._checkFloorplanVisible(!0)}_onMove(){this._checkFloorplanVisible(!1)}_checkFloorplanVisible(t){if(!this._queryFeatureSetId)return;if(!this._map.isStyleLoaded())return;if(this._map.transform.zoom<13)return;this._indoorData&&!function(e,t){const[i,r]=e,{center:n,radius:o}=t,[s,a]=n,l=Math.abs(i-s);return Math.sqrt((l>180?360-l:l)**2+(r-a)**2)<=o}([this._map.getCenter().lng,this._map.getCenter().lat],this._indoorData.circumCircle)&&(this._indoorData=void 0,this._selectedFloorplan=void 0,this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!1),this._map.setConfigProperty(this._scope,"mbx-indoor-active-floorplans",["literal",[]]),this.fire(new e.A("floorplangone")));const i={target:{featuresetId:this._queryFeatureSetId,importId:this._scope}},r=new e.P(this._map.transform.width/2,this._map.transform.height/2),n=[new e.P(0,0),new e.P(this._map.transform.width,this._map.transform.height)],o=this._map.queryRenderedFeatures(t?n:r,i);o.length>0&&(this._selectedFloorplan&&o[0].properties.id===this._selectedFloorplan.properties.id||(this._selectedFloorplan=o[0],this._floorplanSelected(!1)))}_floorplanSelected(t){this._indoorData=JSON.parse(this._selectedFloorplan.properties["indoor-data"]),this._indoorData.id=this._selectedFloorplan.properties.id,this._indoorData.circumCircle=function(e){const[[t,i],[r,n]]=e,o=(r-t+360)%360,s=o>180?360-o:o;return{center:[(t+s/2+360)%360,(i+n)/2],radius:Math.sqrt(s**2+(n-i)**2)/2}}(this._indoorData.extent),this._floorplanStates[this._indoorData.id]||(this._floorplanStates[this._indoorData.id]={});const i=this._floorplanStates[this._indoorData.id].selectedBuilding,r=this._floorplanStates[this._indoorData.id].selectedLevel;let n;if(this._map.setConfigProperty(this._scope,"mbx-indoor-active-floorplans",this._indoorData.floorplanIDs),this._selectedLevel)for(const e of this._indoorData.levels)e.id===this._selectedLevel.id&&(n=e.id);if(this.fire(new e.A("floorplanselected",{buildings:this._indoorData.buildings,levels:this._indoorData.levels,selectedLevelId:n})),i){const e=this._indoorData.buildings.find((e=>e.id===i));this._buildingSelected(e,!1)}else this._indoorData.buildings.length>0&&this._buildingSelected(this._indoorData.buildings[0],!1);if(r){const e=this._indoorData.levels.find((e=>e.id===r));this._updateLevels(e,t)}else t&&this._indoorData["default-levels"].length>0&&this.selectLevel(this._indoorData["default-levels"][0])}_buildingSelected(t,i){i&&t&&t.extent&&this._map.fitBounds(t.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}),this._floorplanStates[this._indoorData.id].selectedBuilding=t?t.id:void 0;const r=this._indoorData.levels.filter((e=>t.levels.includes(e.id)));this.fire(new e.A("buildingselected",{buildingId:t.id,levels:r}))}_levelSelected(t){if("overview"===t)this._updateLevels(void 0,!0);else{const e=this._indoorData.levels.find((e=>e.id===t));this._updateLevels(e,!0)}this.fire(new e.A("levelselected",{levelId:"overview"===t?void 0:t}))}_updateLevels(e,t){if(!e)return this._map.setConfigProperty(this._scope,"mbx-indoor-loaded-levels",["literal",[]]),this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!1),this._floorplanStates[this._indoorData.id].selectedLevel=void 0,void(t&&this._indoorData.extent&&this._map.fitBounds(this._indoorData.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}));function i(e){const t=e.indexOf("/floor/");if(-1===t)return e;const i=t+7,r=e.indexOf("/",i);return-1===r?e.slice(i):e.slice(i,r)}this._selectedLevel=e,this._floorplanStates[this._indoorData.id].selectedLevel=e?e.id:void 0;const r=[],n={},o={},s={},a={};for(const t of this._indoorData.levels)if(r.push(t.id),n[t.id]=t.height,o[t.id]=t.base,e){if(this.mergeFloors){const r=i(e.id),n=i(t.id);s[t.id]=n===r?"true":"false"}else s[t.id]=t.id===e.id?"true":"false";a[t.id]=t.base<e.base?"true":"false"}else a[t.id]=!0;if(this._map.setConfigProperty(this._scope,"mbx-indoor-loaded-levels",["literal",r]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-height",["literal",n]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-base",["literal",o]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-selected",["literal",s]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-overlapped",["literal",a]),e&&(this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!!e.isUnderground),t&&e.extent)){const t=this._map.cameraForBounds(e.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}),i=this._map.getZoom(),r=t.zoom?Math.abs(i-t.zoom):0;this._map.fitBounds(e.extent,r>=1?{pitch:this._map.getPitch(),bearing:this._map.getBearing()}:{pitch:this._map.getPitch(),bearing:this._map.getBearing(),zoom:i})}}selectFloorplan(t){const i={target:{featuresetId:this._queryFeatureSetId,importId:this._scope}},r=[new e.P(0,0),new e.P(this._map.transform.width,this._map.transform.height)],n=this._map.queryRenderedFeatures(r,i);if(n.length>0)for(const e of n)if(JSON.parse(e.properties["indoor-data"]).floorplanIDs.includes(t)){this._selectedFloorplan=e,this._floorplanSelected(!0);break}}selectBuilding(e){const t=this._indoorData.buildings.find((t=>t.id===e));this._buildingSelected(t,!0)}selectLevel(e){this._levelSelected(e)}}function pr(t){if(!t.metadata||!t.metadata.content_area)return;const i=e.q.devicePixelRatio,{left:r,top:n,width:o,height:s}=t.metadata.content_area,a=r*i,l=n*i;return[a,l,a+o*i,l+s*i]}function fr(t){if(t)return t.map((([t,i])=>[t*e.q.devicePixelRatio,i*e.q.devicePixelRatio]))}class Ar{constructor(e,t,i){this.id=e,this.scope=t,this.sourceCache=i,this.pendingRequests=new Set,this.missingRequests=new Set}addPendingRequest(e){this.missingRequests.has(e.name)||this.pendingRequests.has(e.name)||this.pendingRequests.add(e.name)}hasPendingRequests(){return this.pendingRequests.size>0}resolvePendingRequests(){const t=new Map;if(!this.sourceCache.loaded())return t;const i=this.sourceCache.getVisibleCoordinates();if(0===i.length)return t;const r=this.sourceCache.getSource();if(!(r instanceof rt))return t;const n=i.map((e=>this.sourceCache.getTile(e))),o=r.getImages(n,Array.from(this.pendingRequests));for(const[i,r]of o)t.set(e.I.from({name:i,iconsetId:this.id}),r),this.pendingRequests.delete(i);for(const e of this.pendingRequests)this.missingRequests.add(e);return this.pendingRequests.clear(),t}}const mr=(e,t)=>Ie(e,t&&t.filter((e=>"source.canvas"!==e.identifier))),gr=e.aA(Lt,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport","addIconset","removeIconset"]),_r=e.aA(Lt,["setCenter","setZoom","setBearing","setPitch"]),yr=new Set(["background","sky","slot","custom"]),vr={version:8,layers:[],sources:{}},xr={duration:300,delay:0};class br extends e.E{constructor(t,i={}){super(),this.map=t,this.scope=i.scope||"",this.globalId=null,this.fragments=[],this.importDepth=i.importDepth||0,this.importsCache=i.importsCache||new Map,this.resolvedImports=i.resolvedImports||new Set,this.transition=e.l({},xr),this._buildingIndex=new Mt(this),this.crossTileSymbolIndex=new zi,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=i.styleChanges||new j,this.dispatcher=i.dispatcher?i.dispatcher:new e.D(e.cj(),this),i.imageManager?this.imageManager=i.imageManager:(this.imageManager=new H(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.addScope(this.scope),this.glyphManager=i.glyphManager?i.glyphManager:new e.ck(t._requestManager,i.localFontFamily?e.cl.all:i.localIdeographFontFamily?e.cl.ideographs:e.cl.none,i.localFontFamily||i.localIdeographFontFamily),i.modelManager?this.modelManager=i.modelManager:(this.modelManager=new lr(t._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this.options=i.configOptions?i.configOptions:new Map,this._configDependentLayers=i.configDependentLayers?i.configDependentLayers:new Set,this._config=i.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:i.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=i.initialConfig,this.dispatcher.broadcast("setReferrer",e.cm());const r=this;this._rtlTextPluginCallback=br.registerForPluginStateChange((t=>{r.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:t.pluginStatus,pluginURL:t.pluginURL},((t,i)=>{if(e.cn(t),i&&i.every((e=>e)))for(const e in r._sourceCaches){const t=r._sourceCaches[e],i=t.getSource().type;"vector"!==i&&"geojson"!==i||t.reload()}}))})),this.on("data",(e=>{if("source"!==e.dataType||"metadata"!==e.sourceDataType)return;const t=this.getOwnSource(e.sourceId);if(t&&t.vectorLayerIds)for(const e in this._layers){const i=this._layers[e];i.source===t.id&&this._validateLayer(i)}}))}load(e){return e?("string"==typeof e?this.loadURL(e):this.loadJSON(e),this):this}_getGlobalId(t){if(!t)return null;if("string"==typeof t){if(e.f(t))return t;const i=e.co(t);if(!i.startsWith("http"))try{return new URL(i,location.href).toString()}catch(e){return i}return i}return`json://${e.cp(JSON.stringify(t))}`}_diffStyle(t,i,r){this.globalId=this._getGlobalId(t);const n=(e,t)=>{try{t(null,this.setState(e,r))}catch(e){t(e,!1)}};if("string"==typeof t){const r=this.map._requestManager.normalizeStyleURL(t),o=this.map._requestManager.transformRequest(r,e.R.Style);e.n(o,((t,r)=>{t?this.fire(new e.z(t)):r&&n(r,i)}))}else"object"==typeof t&&n(t,i)}loadURL(t,i={}){this.fire(new e.A("dataloading",{dataType:"style"}));const r="boolean"==typeof i.validate?i.validate:!e.f(t);this.globalId=this._getGlobalId(t),t=this.map._requestManager.normalizeStyleURL(t,i.accessToken),this.resolvedImports.add(t);const n=this.importsCache.get(t);if(n)return this._load(n,r);const o=this.map._requestManager.transformRequest(t,e.R.Style);this._request=e.n(o,((i,n)=>{if(this._request=null,i)this.fire(new e.z(i));else if(n)return this.importsCache.set(t,n),this._load(n,r)}))}loadJSON(t,i={}){this.fire(new e.A("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(t),this._request=e.q.frame((()=>{this._request=null,this._load(t,!1!==i.validate)}))}loadEmpty(){this.fire(new e.A("dataloading",{dataType:"style"})),this._load(vr,!1)}_loadImports(t,i,r){if(this.importDepth>=4)return e.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const n=[];for(const e of t){const t=this._createFragmentStyle(e),o=new Promise((e=>{t.once("style.import.load",e),t.once("error",e)})).then((()=>this.mergeAll()));if(n.push(o),this.resolvedImports.has(e.url)){t.loadEmpty();continue}const s=e.data||this.importsCache.get(e.url);s?(t.loadJSON(s,{validate:i}),this._isInternalStyle(s)&&(t.globalId=null)):e.url?t.loadURL(e.url,{validate:i}):t.loadEmpty();const a={style:t,id:e.id,config:e.config};if(r){const e=this.fragments.findIndex((({id:e})=>e===r));this.fragments=this.fragments.slice(0,e).concat(a).concat(this.fragments.slice(e))}else this.fragments.push(a)}return Promise.allSettled(n)}getImportGlobalIds(e=this,t=new Set){for(const i of e.fragments)i.style.globalId&&t.add(i.style.globalId),this.getImportGlobalIds(i.style,t);return[...t.values()]}_createFragmentStyle(t){const i=this.scope?e.C(t.id,this.scope):t.id;let r;const n=this._initialConfig&&this._initialConfig[i];(t.config||n)&&(r=e.l({},t.config,n));const o=new br(this.map,{scope:i,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:r,configOptions:this.options,colorThemeOverride:t["color-theme"],configDependentLayers:this._configDependentLayers});return o.setEventedParent(this.map,{style:o}),o}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(e){return this.isRootStyle()&&(e.fragment||!!e.schema&&!1!==e.fragment)}_load(t,i){const r=t.indoor?hr(t.schema):t.schema;if(this._isInternalStyle(t)){const r=e.l({},vr,{imports:[{id:"basemap",data:t,url:""}]});return void this._load(r,i)}if(this.updateConfig(this._config,r),i&&mr(this,me(t)))return;this._loaded=!0,this.stylesheet=e.cq(t);const n=()=>{for(const e in t.sources)this.addSource(e,t.sources[e],{validate:!1,isInitialLoad:!0});if(t.iconsets)for(const e in t.iconsets)this.addIconset(e,t.iconsets[e]);t.sprite?this._loadIconset(t.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.setGlyphsUrl(t.glyphs);const r=Pt(this.stylesheet.layers);if(this._order=r.map((e=>e.id)),this.stylesheet.light&&e.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(1===this.stylesheet.lights.length&&"flat"===this.stylesheet.lights[0].type){const e=this.stylesheet.lights[0];this.light=new Le(e.properties,e.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new Le(this.stylesheet.light)),this._layers={};for(const t of r){const i=e.cv(t,this.scope,this._styleColorTheme.lut,this.options);0!==i.configDependencies.size&&this._configDependentLayers.add(i.fqid),i.setEventedParent(this,{layer:{id:i.id}}),this._layers[i.id]=i;const r=this.getOwnLayerSourceCache(i),n=!!this.directionalLight&&this.directionalLight.shadowsEnabled();r&&i.canCastShadows()&&n&&(r.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);const n=this.stylesheet.terrain;n&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(n,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new e.A("data",{dataType:"style"}));const o=this.isRootStyle();t.imports?this._loadImports(t.imports,i).then((()=>{this._reloadImports(),this.fire(new e.A(o?"style.load":"style.import.load"))})):(this._reloadImports(),this.fire(new e.A(o?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const o=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(o){const t=this._evaluateColorThemeData(o);this._loadColorTheme(t).then((()=>{n()})).catch((t=>{e.w(`Couldn't load color theme from the stylesheet: ${t}`),n()}))}else this._styleColorTheme.lut=null,n()}isRootStyle(){return 0===this.importDepth}mergeAll(){let t,i,r,n,o,s,a,l,c,u;const h={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle((e=>{if(e.stylesheet){if(null!=e.light&&(t=e.light),e.stylesheet.lights)for(const t of e.stylesheet.lights)"ambient"===t.type&&null!=e.ambientLight&&(i=e.ambientLight),"directional"===t.type&&null!=e.directionalLight&&(r=e.directionalLight);n=this._prioritizeTerrain(n,e.terrain,e.stylesheet.terrain),e.stylesheet.fog&&null!=e.fog&&(o=e.fog),e.stylesheet.snow&&null!=e.snow&&(s=e.snow),e.stylesheet.rain&&null!=e.rain&&(a=e.rain),null!=e.stylesheet.camera&&(u=e.stylesheet.camera),null!=e.stylesheet.projection&&(l=e.stylesheet.projection),null!=e.stylesheet.transition&&(c=e.stylesheet.transition),h[e.scope]=e._styleColorTheme}})),this.light=t,this.ambientLight=i,this.directionalLight=r,this.fog=o,this.snow=s,this.rain=a,this._styleColorThemeForScope=h,null===n?delete this.terrain:this.terrain=n,this.camera=u||{"camera-projection":"perspective"},this.projection=l||{name:"mercator"},this.transition=e.l({},xr,c),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(e){const t=i=>{for(const e of i.fragments)t(e.style);e(i)};t(this)}_prioritizeTerrain(e,t,i){const r=e&&0===e.drapeRenderMode;return null===i?t&&0===t.drapeRenderMode?t:r?e:null:null!=t&&(!e||r||t&&1===t.drapeRenderMode)?t:e}mergeTerrain(){let e;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle((t=>{e=this._prioritizeTerrain(e,t.terrain,t.stylesheet.terrain)})),null===e?delete this.terrain:this.terrain=e}mergeProjection(){let e;this.forEachFragmentStyle((t=>{null!=t.stylesheet.projection&&(e=t.stylesheet.projection)})),this.projection=e||{name:"mercator"}}mergeSources(){const t={},i={},r={};this.forEachFragmentStyle((n=>{for(const i in n._sourceCaches){const r=e.C(i,n.scope);t[r]=n._sourceCaches[i]}for(const t in n._otherSourceCaches){const r=e.C(t,n.scope);i[r]=n._otherSourceCaches[t]}for(const t in n._symbolSourceCaches){const i=e.C(t,n.scope);r[i]=n._symbolSourceCaches[t]}})),this._mergedSourceCaches=t,this._mergedOtherSourceCaches=i,this._mergedSymbolSourceCaches=r}mergeLayers(){const t={},i=[],r={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle((r=>{for(const n of r._order){const o=r._layers[n];if("slot"===o.type){const i=e.cr(n);if(t[i])continue;t[i]=[]}o.slot&&t[o.slot]?t[o.slot].push(o):i.push(o)}})),this._mergedOrder=[];const n=(i=[])=>{for(const o of i)if("slot"===o.type){const i=e.cr(o.id);t[i]&&n(t[i]),this._mergedSlots.push(i)}else{const t=e.C(o.id,o.scope);this._mergedOrder.push(t),r[t]=o,o.is3D(!!this.terrain)&&(this._has3DLayers=!0),"circle"===o.type&&(this._hasCircleLayers=!0),"symbol"===o.type&&(this._hasSymbolLayers=!0),"clip"===o.type&&(this._clipLayerPresent=!0)}};n(i),this._mergedOrder.sort(((e,t)=>{const i=r[e],n=r[t];return i.hasInitialOcclusionOpacityProperties?n.is3D(!!this.terrain)?1:0:i.is3D(!!this.terrain)&&n.hasInitialOcclusionOpacityProperties?-1:0})),this._mergedLayers=r,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&0===this.terrain.drapeRenderMode}getCamera(){return this.stylesheet.camera}setCamera(t){return this.stylesheet.camera=e.l({},this.stylesheet.camera,t),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(t){return t.data?function(t,i,r){const n=e.l({},i);for(const t of Object.keys(e.a5.colorTheme))void 0===n[t]&&(n[t]=e.a5.colorTheme[t].default);const o=new e.a6(cr,t,new Map(r));return o.setTransitionOrValue(n,r),o.untransitioned().possiblyEvaluate(new e.aa(0))}(this.scope,t,this.options).get("data"):null}_loadColorTheme(t){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const i=this._styleColorTheme.lutLoadingCorrelationID;return new Promise(((r,n)=>{const o="data:image/png;base64,";if(!t||0===t.length)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void r();let s=t;s.startsWith(o)||(s=o+s);const a=e.I.from("mapbox-reserved-lut"),l=new Image;l.src=s,l.onerror=()=>{this._styleColorTheme.lutLoading=!1,n(new Error("Failed to load image data"))},l.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==i)return void r();this._styleColorTheme.lutLoading=!1;const{width:o,height:s,data:c}=e.q.getImageData(l);if(s>32)return void n(new Error("The height of the image must be less than or equal to 32 pixels."));if(o!==s*s)return void n(new Error("The width of the image must be equal to the height squared."));this.getImage(a,this.scope)&&this.removeImage(a,this.scope),this.addImage(a,this.scope,{data:new e.r({width:o,height:s},c),pixelRatio:1,sdf:!1,usvg:!1,version:0});const u=this.imageManager.getImage(a,this.scope);u?(this._styleColorTheme.lut={image:u.data,data:t},r()):n(new Error("Missing LUT image."))}}))}getLut(e){const t=this._styleColorThemeForScope[e];return t?t.lut:null}setProjection(e){e?this.stylesheet.projection=e:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(t){this._spriteRequest=function(t,i,r){let n,o,s;const a=e.q.devicePixelRatio>1?"@2x":"";let l=e.n(i.transformRequest(i.normalizeSpriteURL(t,a,".json"),e.R.SpriteJSON),((e,t)=>{l=null,s||(s=e,n=t,u())})),c=e.o(i.transformRequest(i.normalizeSpriteURL(t,a,".png"),e.R.SpriteImage),((e,t)=>{c=null,s||(s=e,o=t,u())}));function u(){if(s)r(s);else if(n&&o){const t=e.q.getImageData(o),i={};for(const r in n){const{width:o,height:s,x:a,y:l,sdf:c,pixelRatio:u,stretchX:h,stretchY:d,content:p}=n[r],f=new e.r({width:o,height:s});e.r.copy(t,f,{x:a,y:l},{x:0,y:0},{width:o,height:s},null),i[r]={data:f,pixelRatio:u,sdf:c,stretchX:h,stretchY:d,content:p,usvg:!1}}r(null,i)}}return{cancel(){l&&(l.cancel(),l=null),c&&(c.cancel(),c=null)}}}(t,this.map._requestManager,((t,i)=>{if(this._spriteRequest=null,t)this.fire(new e.z(t));else if(i){const t=new Map;for(const r in i)t.set(e.I.from(r),i[r]);this.addImages(t,this.scope)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new e.A("data",{dataType:"style"}))}))}addIconset(t,i){if("sprite"===i.type)return void this._loadSprite(i.url);const r=this.getOwnSourceCache(i.source);if(!r)return void this.fire(new e.z(new Error(`Source "${i.source}" as specified by iconset "${t}" does not exist and cannot be used as an iconset source`)));const n=r.getSource();if("raster-array"!==n.type)return void this.fire(new e.z(new Error(`Source "${i.source}" as specified by iconset "${t}" is not a "raster-array" source and cannot be used as an iconset source`)));n.partial=!1;const o=new Ar(t,this.scope,r);this.imageManager.addImageProvider(o,this.scope)}removeIconset(e){this.imageManager.removeImageProvider(e,this.scope)}_loadIconset(t){if(!e.f(t)&&"icon_set"!==this.map._spriteFormat||"raster"===this.map._spriteFormat)return void this._loadSprite(t);const i="auto"===this.map._spriteFormat;var r,n;this._spriteRequest=(n=(r,n)=>{if(this._spriteRequest=null,r)i?this._loadSprite(t):this.fire(new e.z(r));else if(n){const t=new Map;for(const i in n)t.set(e.I.from(i),n[i]);this.addImages(t,this.scope)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new e.A("data",{dataType:"style"}))},e.bj((r=this.map._requestManager).transformRequest(r.normalizeIconsetURL(t),e.R.Iconset),((t,i)=>{if(t)return void n(t);const r={},o=e.ch(new e.bi(i));for(const t of o.icons){const i={version:1,pixelRatio:e.q.devicePixelRatio,content:pr(t),stretchX:t.metadata?fr(t.metadata.stretch_x_areas):void 0,stretchY:t.metadata?fr(t.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:t};r[t.name]=i}n(null,r)})))}_validateLayer(t){const i=this.getOwnSource(t.source);if(!i)return;const r=t.sourceLayer;r&&("geojson"===i.type||i.vectorLayerIds&&-1===i.vectorLayerIds.indexOf(r))&&this.fire(new e.z(new Error(`Source layer "${r}" does not exist on source "${i.id}" as specified by style layer "${t.id}"`)))}loaded(){if(!this._loaded)return!1;if(Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const e in this._sourceCaches)if(!this._sourceCaches[e].loaded())return!1;if(!this.imageManager.isLoaded())return!1;if(this.imageManager.hasPatternsInFlight())return!1;if(!this.modelManager.isLoaded())return!1;if(this._styleColorTheme.lutLoading)return!1;for(const{style:e}of this.fragments)if(!e.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map(((e,t)=>{const i=this.fragments[t];return i&&i.style&&(e.data=i.style.serialize()),e}))}_serializeSources(){const e={};for(const t in this._sourceCaches){const i=this._sourceCaches[t].getSource();e[i.id]||(e[i.id]=i.serialize())}return e}_serializeLayers(e){const t=[];for(const i of e){const e=this._layers[i];e&&"custom"!==e.type&&t.push(e.serialize())}return t}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions())return!0;if(this.hasFogTransition())return!0;if(this.hasSnowTransition())return!0;if(this.hasRainTransition())return!0;for(const e in this._sourceCaches)if(this._sourceCaches[e].hasTransition())return!0;for(const e in this._layers)if(this._layers[e].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(e){return e?this.order:this._mergedOrder}isLayerDraped(e){return!!this.terrain&&e.isDraped(this.getLayerSourceCache(e))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(t){const i=this.getOwnLayer(t);if(i)return i;this.fire(new e.z(new Error(`The layer '${t}' does not exist in the map's style.`)))}_checkSource(t){const i=this.getOwnSource(t);if(i)return i;this.fire(new e.z(new Error(`The source '${t}' does not exist in the map's style.`)))}precompilePrograms(e,t){const i=this.map.painter;if(i)for(let r=e.minzoom||0;r<(e.maxzoom||25.5);r++){const r=e.getProgramIds();if(r)for(const n of r){const r=e.getDefaultProgramParams(n,t.zoom,this._styleColorTheme.lut);r&&(i.style=this,this.fog&&(i._fogVisible=!0,r.overrideFog=!0,i.getOrCreateProgram(n,r)),i._fogVisible=!1,r.overrideFog=!1,i.getOrCreateProgram(n,r),(this.stylesheet.terrain||this.stylesheet.projection&&"globe"===this.stylesheet.projection.name)&&(r.overrideRtt=!0,i.getOrCreateProgram(n,r)))}}}update(t){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(t),this.directionalLight&&this.directionalLight.recalculate(t);const i=this.calculateLightsBrightness();t.brightness=i||0,i!==this._brightness&&(this._brightness=i,this.dispatcher.broadcast("setBrightness",i));const r=this._changes.isDirty();let n=!1;if(this._changes.isDirty()){const e=this._changes.getLayerUpdatesByScope();for(const t in e){const{updatedIds:i,removedIds:r}=e[t];(i||r)&&(this._updateWorkerLayers(t,i,r),n=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(t),this.light&&this.light.updateTransitions(t),this.ambientLight&&this.ambientLight.updateTransitions(t),this.directionalLight&&this.directionalLight.updateTransitions(t),this.fog&&this.fog.updateTransitions(t),this.snow&&this.snow.updateTransitions(t),this.rain&&this.rain.updateTransitions(t),this._changes.reset()}const o={};for(const e in this._mergedSourceCaches){const t=this._mergedSourceCaches[e];o[e]=t.used,t.used=!1,t.tileCoverLift=0}for(const e of this._mergedOrder){const i=this._mergedLayers[e];if(i.recalculate(t,this._availableImages),!i.isHidden(t.zoom)){const e=this.getLayerSourceCache(i);e&&(e.used=!0,e.tileCoverLift=Math.max(e.tileCoverLift,i.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback((()=>{this.precompilePrograms(i,t)})):this.precompilePrograms(i,t))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&n&&this.mergeLayers();const s=this.imageManager.getPendingImageProviders();for(const e of s)e.sourceCache.used=!0;for(const t in o){const i=this._mergedSourceCaches[t];o[t]!==i.used&&i.getSource().fire(new e.A("data",{sourceDataType:"visibility",dataType:"source",sourceId:i.getSource().id}))}this.light&&this.light.recalculate(t),this.terrain&&this.terrain.recalculate(t),this.fog&&this.fog.recalculate(t),this.snow&&this.snow.recalculate(t),this.rain&&this.rain.recalculate(t),this.z=t.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),this.imageManager.clearUpdatedImages(this.scope),r&&this.fire(new e.A("data",{dataType:"style"}))}updateImageProviders(){const e=this.imageManager.getPendingImageProviders();for(const t of e){const e=t.resolvePendingRequests();this.addImages(e,t.scope)}}_updateTilesForChangedImages(){const e={};for(const t in this._mergedSourceCaches){const i=this._mergedSourceCaches[t].getSource().scope;e[i]=e[i]||this._changes.getUpdatedImages(i),0!==e[i].length&&this._mergedSourceCaches[t].reloadTilesForDependencies(["icons","patterns"],e[i])}for(const t in e)this._changes.resetUpdatedImages(t)}_updateWorkerLayers(e,t,i){const r=this.getFragmentStyle(e);r&&this.dispatcher.broadcast("updateLayers",{layers:t?r._serializeLayers(t):[],scope:e,removedIds:i||[],options:r.options})}setState(t,i){if(this._checkLoaded(),mr(this,me(t)))return!1;(t=e.cq(t)).layers=Pt(t.layers);const r=function(t,i){if(!t)return[{command:Lt.setStyle,args:[i]}];let r=[];try{if(!e.bn(t.version,i.version))return[{command:Lt.setStyle,args:[i]}];if(e.bn(t.center,i.center)||r.push({command:Lt.setCenter,args:[i.center]}),e.bn(t.zoom,i.zoom)||r.push({command:Lt.setZoom,args:[i.zoom]}),e.bn(t.bearing,i.bearing)||r.push({command:Lt.setBearing,args:[i.bearing]}),e.bn(t.pitch,i.pitch)||r.push({command:Lt.setPitch,args:[i.pitch]}),e.bn(t.sprite,i.sprite)||r.push({command:Lt.setSprite,args:[i.sprite]}),e.bn(t.glyphs,i.glyphs)||r.push({command:Lt.setGlyphs,args:[i.glyphs]}),e.bn(t.imports,i.imports)||function(t=[],i=[],r){i=i||[];const n=(t=t||[]).map(Ot),o=i.map(Ot),s=t.reduce(Ut,{}),a=i.reduce(Ut,{}),l=n.slice();let c,u,h,d;for(c=0,u=0;c<n.length;c++)h=n[c],a.hasOwnProperty(h)?u++:(r.push({command:Lt.removeImport,args:[h]}),l.splice(l.indexOf(h,u),1));for(c=0,u=0;c<o.length;c++)h=o[o.length-1-c],l[l.length-1-c]!==h&&(s.hasOwnProperty(h)?(r.push({command:Lt.removeImport,args:[h]}),l.splice(l.lastIndexOf(h,l.length-u),1)):u++,d=l[l.length-c],r.push({command:Lt.addImport,args:[a[h],d]}),l.splice(l.length-c,0,h));for(const t of i){const i=s[t.id];i&&!e.bn(i,t)&&r.push({command:Lt.updateImport,args:[t.id,t]})}}(t.imports,i.imports,r),e.bn(t.transition,i.transition)||r.push({command:Lt.setTransition,args:[i.transition]}),e.bn(t.light,i.light)||r.push({command:Lt.setLight,args:[i.light]}),e.bn(t.fog,i.fog)||r.push({command:Lt.setFog,args:[i.fog]}),e.bn(t.snow,i.snow)||r.push({command:Lt.setSnow,args:[i.snow]}),e.bn(t.rain,i.rain)||r.push({command:Lt.setRain,args:[i.rain]}),e.bn(t.projection,i.projection)||r.push({command:Lt.setProjection,args:[i.projection]}),e.bn(t.lights,i.lights)||r.push({command:Lt.setLights,args:[i.lights]}),e.bn(t.camera,i.camera)||r.push({command:Lt.setCamera,args:[i.camera]}),e.bn(t.iconsets,i.iconsets)||function(t,i,r){let n;for(n in i=i||{},t=t||{})t.hasOwnProperty(n)&&(i.hasOwnProperty(n)||r.push({command:Lt.removeIconset,args:[n]}));for(n in i){if(!i.hasOwnProperty(n))continue;const o=i[n];t.hasOwnProperty(n)?e.bn(t[n],o)||(r.push({command:Lt.removeIconset,args:[n]}),r.push({command:Lt.addIconset,args:[n,o]})):r.push({command:Lt.addIconset,args:[n,o]})}}(t.iconsets,i.iconsets,r),!e.bn(t["color-theme"],i["color-theme"]))return[{command:Lt.setStyle,args:[i]}];const n={},o=[];!function(t,i,r,n){let o;for(o in i=i||{},t=t||{})t.hasOwnProperty(o)&&(i.hasOwnProperty(o)||kt(o,r,n));for(o in i){if(!i.hasOwnProperty(o))continue;const s=i[o];t.hasOwnProperty(o)?e.bn(t[o],s)||("geojson"===t[o].type&&"geojson"===s.type&&Rt(t,i,o)?r.push({command:Lt.setGeoJSONSourceData,args:[o,s.data]}):zt(o,i,r,n)):Ft(o,i,r)}}(t.sources,i.sources,o,n);const s=[];t.layers&&t.layers.forEach((e=>{e.source&&n[e.source]?r.push({command:Lt.removeLayer,args:[e.id]}):s.push(e)}));let a=t.terrain;a&&n[a.source]&&(r.push({command:Lt.setTerrain,args:[void 0]}),a=void 0),r=r.concat(o),e.bn(a,i.terrain)||r.push({command:Lt.setTerrain,args:[i.terrain]}),function(t,i,r){i=i||[];const n=(t=t||[]).map(Ot),o=i.map(Ot),s=t.reduce(Ut,{}),a=i.reduce(Ut,{}),l=n.slice(),c=Object.create(null);let u,h,d,p,f,A,m;for(u=0,h=0;u<n.length;u++)d=n[u],a.hasOwnProperty(d)?h++:(r.push({command:Lt.removeLayer,args:[d]}),l.splice(l.indexOf(d,h),1));for(u=0,h=0;u<o.length;u++)d=o[o.length-1-u],l[l.length-1-u]!==d&&(s.hasOwnProperty(d)?(r.push({command:Lt.removeLayer,args:[d]}),l.splice(l.lastIndexOf(d,l.length-h),1)):h++,A=l[l.length-u],r.push({command:Lt.addLayer,args:[a[d],A]}),l.splice(l.length-u,0,d),c[d]=!0);for(u=0;u<o.length;u++)if(d=o[u],p=s[d],f=a[d],!c[d]&&!e.bn(p,f))if(e.bn(p.source,f.source)&&e.bn(p["source-layer"],f["source-layer"])&&e.bn(p.type,f.type)){for(m in Dt(p.layout,f.layout,r,d,null,Lt.setLayoutProperty),Dt(p.paint,f.paint,r,d,null,Lt.setPaintProperty),e.bn(p.slot,f.slot)||r.push({command:Lt.setSlot,args:[d,f.slot]}),e.bn(p.filter,f.filter)||r.push({command:Lt.setFilter,args:[d,f.filter]}),e.bn(p.minzoom,f.minzoom)&&e.bn(p.maxzoom,f.maxzoom)||r.push({command:Lt.setLayerZoomRange,args:[d,f.minzoom,f.maxzoom]}),p)p.hasOwnProperty(m)&&"layout"!==m&&"paint"!==m&&"filter"!==m&&"metadata"!==m&&"minzoom"!==m&&"maxzoom"!==m&&"slot"!==m&&(0===m.indexOf("paint.")?Dt(p[m],f[m],r,d,m.slice(6),Lt.setPaintProperty):e.bn(p[m],f[m])||r.push({command:Lt.setLayerProperty,args:[d,m,f[m]]}));for(m in f)f.hasOwnProperty(m)&&!p.hasOwnProperty(m)&&"layout"!==m&&"paint"!==m&&"filter"!==m&&"metadata"!==m&&"minzoom"!==m&&"maxzoom"!==m&&"slot"!==m&&(0===m.indexOf("paint.")?Dt(p[m],f[m],r,d,m.slice(6),Lt.setPaintProperty):e.bn(p[m],f[m])||r.push({command:Lt.setLayerProperty,args:[d,m,f[m]]}))}else r.push({command:Lt.removeLayer,args:[d]}),A=l[l.lastIndexOf(d)+1],r.push({command:Lt.addLayer,args:[f,A]})}(s,i.layers,r)}catch(e){console.warn("Unable to compute style diff:",e),r=[{command:Lt.setStyle,args:[i]}]}return r}(this.serialize(),t).filter((e=>!(e.command in _r)));if(0===r.length)return!1;const n=r.filter((e=>!(e.command in gr)));if(n.length>0)throw new Error(`Unimplemented: ${n.map((e=>e.command)).join(", ")}.`);const o=[];return r.forEach((e=>{o.push(this[e.command].apply(this,e.args))})),i&&Promise.all(o).then(i),this.stylesheet=t,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}_updateWorkerImages(e){const t=this.getFragmentStyle(e);t&&(t._availableImages=t.imageManager.listImages(e),t.dispatcher.broadcast("setImages",{scope:e,images:t._availableImages}))}addImages(t,i){for(const[r,n]of t.entries()){if(this.getImage(r,i))return this.fire(new e.z(new Error(`An image with the name "${r.name}" already exists.`)));this.imageManager.addImage(r,i,n),this._changes.updateImage(r,i)}return this._updateWorkerImages(i),this.fire(new e.A("data",{dataType:"style"})),this}addImage(t,i,r){return this.getImage(t,i)?this.fire(new e.z(new Error(`An image with the name "${t.name}" already exists.`))):(this.imageManager.addImage(t,i,r),this._changes.updateImage(t,i),this._updateWorkerImages(i),this.fire(new e.A("data",{dataType:"style"})),this)}updateImage(t,i,r,n=!1){this.imageManager.updateImage(t,i,r),n&&(this._changes.updateImage(t,i),this._updateWorkerImages(i),this.fire(new e.A("data",{dataType:"style"})))}getImage(e,t){return this.imageManager.getImage(e,t)}removeImage(t,i){return this.getImage(t,i)?(this.imageManager.removeImage(t,i),this._changes.updateImage(t,i),this._updateWorkerImages(i),this.fire(new e.A("data",{dataType:"style"})),this):this.fire(new e.z(new Error("No image with this name exists.")))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(e,t,i={}){return this._checkLoaded(),this._validate(Ee,`models.${e}`,t,null,i)||(this.modelManager.addModel(e,t,this.scope),this._changes.setDirty()),this}hasModel(e){return this.modelManager.hasModel(e,this.scope)}removeModel(t){return this.hasModel(t)?(this.modelManager.removeModel(t,this.scope),this):this.fire(new e.z(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(t,i,r={}){if(this._checkLoaded(),void 0!==this.getOwnSource(t))throw new Error(`There is already a source with ID "${t}".`);if(!i.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(i).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(i.type)>=0&&this._validate(ge,`sources.${t}`,i,null,r))return;this.map&&this.map._collectResourceTiming&&(i.collectResourceTiming=!0);const n=ot(t,i,this.dispatcher,this);n.scope=this.scope,n.setEventedParent(this,(()=>({isSourceLoaded:this._isSourceCacheLoaded(n.id),source:n.serialize(),sourceId:n.id})));const o=t=>{const i=(t?"symbol:":"other:")+n.id,r=e.C(i,this.scope),o=this._sourceCaches[i]=new Bt(r,n,t);(t?this._symbolSourceCaches:this._otherSourceCaches)[n.id]=o,o.onAdd(this.map)};o(!1),"vector"!==i.type&&"geojson"!==i.type||o(!0),n.onAdd&&n.onAdd(this.map),r.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(t){this._checkLoaded();const i=this.getOwnSource(t);if(!i)throw new Error("There is no source with this ID");for(const i in this._layers)if(this._layers[i].source===t)return this.fire(new e.z(new Error(`Source "${t}" cannot be removed while layer "${i}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===t)return this.fire(new e.z(new Error(`Source "${t}" cannot be removed while terrain is using it.`)));if(this.stylesheet.iconsets){const i=Object.entries(this.stylesheet.iconsets).find((([e,i])=>"source"===i.type&&i.source===t));if(i)return this.fire(new e.z(new Error(`Source "${t}" cannot be removed while iconset "${i[0]}" is using it.`)))}const r=this.getOwnSourceCaches(t);for(const t of r){const i=e.cr(t.id);delete this._sourceCaches[i],this._changes.discardSourceCacheUpdate(t.id),t.fire(new e.A("data",{sourceDataType:"metadata",dataType:"source",sourceId:t.getSource().id})),t.setEventedParent(null),t.clearTiles()}return delete this._otherSourceCaches[t],delete this._symbolSourceCaches[t],this.mergeSources(),i.setEventedParent(null),i.onRemove&&i.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(e,t){this._checkLoaded(),this.getOwnSource(e).setData(t),this._changes.setDirty()}getOwnSource(e){const t=this.getOwnSourceCache(e);return t&&t.getSource()}getOwnSources(){const e=[];for(const t in this._otherSourceCaches){const i=this.getOwnSourceCache(t);i&&e.push(i.getSource())}return e}areTilesLoaded(){const e=this._mergedSourceCaches;for(const t in e){const i=e[t]._tiles;for(const e in i){const t=i[e];if("loaded"!==t.state&&"errored"!==t.state)return!1}}return!0}setLights(t){if(this._checkLoaded(),!t)return delete this.ambientLight,void delete this.directionalLight;const i=this._getTransitionParameters();for(const r of t){if(this._validate(ye,"lights",r))return;switch(r.type){case"ambient":if(this.ambientLight){const e=this.ambientLight;e.set(r),e.updateTransitions(i)}else this.ambientLight=new qe(r,He||(He=new e.a7({color:new e.a8(e.a5.properties_light_ambient.color),"color-use-theme":new e.a8({type:"string",default:"default","property-type":"data-constant"}),intensity:new e.a8(e.a5.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const e=this.directionalLight;e.set(r),e.updateTransitions(i)}else this.directionalLight=new qe(r,Ge||(Ge=new e.a7({direction:new e.am(e.a5.properties_light_directional.direction),color:new e.a8(e.a5.properties_light_directional.color),"color-use-theme":new e.a8({type:"string",default:"default","property-type":"data-constant"}),intensity:new e.a8(e.a5.properties_light_directional.intensity),"cast-shadows":new e.a8(e.a5.properties_light_directional["cast-shadows"]),"shadow-quality":new e.a8(e.a5.properties_light_directional["shadow-quality"]),"shadow-intensity":new e.a8(e.a5.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const r=new e.aa(this.z||0,i);this.ambientLight&&this.ambientLight.recalculate(r),this.directionalLight&&this.directionalLight.recalculate(r),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const t=this.directionalLight,i=this.ambientLight;if(!t||!i)return;const r=e=>.2126*(e[0]<=.03928?e[0]/12.92:Math.pow((e[0]+.055)/1.055,2.4))+.7152*(e[1]<=.03928?e[1]/12.92:Math.pow((e[1]+.055)/1.055,2.4))+.0722*(e[2]<=.03928?e[2]/12.92:Math.pow((e[2]+.055)/1.055,2.4)),n=t.properties.get("color").toRenderColor(null).toArray01(),o=t.properties.get("intensity"),s=t.properties.get("direction"),a=1-e.cc(s.x,s.y,s.z)[2]/90,l=r(n)*o*a,c=i.properties.get("color").toRenderColor(null).toArray01(),u=i.properties.get("intensity"),h=r(c)*u;return Number(((l+h)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const e=[];return this.directionalLight&&e.push(this.directionalLight.get()),this.ambientLight&&e.push(this.ambientLight.get()),e}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(t){if(!t)return this;if(e.cs(t)){const i=e.ct(t),r=this.fragments.find((({id:e})=>e===i));if(!r)throw new Error(`Style import '${t}' not found`);const n=e.cr(t);return r.style.getFragmentStyle(n)}{const e=this.fragments.find((({id:e})=>e===t));return e?e.style:void 0}}setFeaturesetSelectors(t){if(!t)return;const i={},r=(e,t="")=>`${e}::${t}`;this._featuresetSelectors={};for(const n in t){const o=this._featuresetSelectors[n]=[];for(const s of t[n].selectors){if(s.featureNamespace){const t=this.getOwnLayer(s.layer);if(!t){e.w(`Layer is undefined for selector: ${s.layer}`);continue}const o=r(t.source,t.sourceLayer);if(o in i&&i[o]!==s.featureNamespace){e.w(`"featureNamespace ${s.featureNamespace} of featureset ${n}'s selector is not associated to the same source, skip this selector`);continue}i[o]=s.featureNamespace}let t;if(s.properties)for(const i in s.properties){const r=e.X(s.properties[i]);"success"===r.result&&(t=t||{},t[i]=r.value)}o.push({layerId:s.layer,namespace:s.featureNamespace,properties:t,uniqueFeatureID:s._uniqueFeatureID})}}}getFeaturesetDescriptors(e){const t=this.getFragmentStyle(e);if(!t||!t.stylesheet.featuresets)return[];const i=[];for(const e in t.stylesheet.featuresets)i.push({featuresetId:e,importId:t.scope?t.scope:void 0});return i}getFeaturesetLayers(t,i){const r=this.getFragmentStyle(i),n=r.stylesheet.featuresets;if(!n||!n[t])return this.fire(new e.z(new Error(`The featureset '${t}' does not exist in the map's style and cannot be queried.`))),[];const o=[];for(const e of n[t].selectors){const t=r.getOwnLayer(e.layer);t&&o.push(t)}return o}getConfigProperty(t,i){const r=this.getFragmentStyle(t);if(!r)return null;const n=e.C(i,r.scope),o=r.options.get(n),s=o?o.value||o.default:null;return s?s.serialize():null}setConfigProperty(t,i,r){const n=this.getFragmentStyle(t);if(!n)return;const o=n.stylesheet.indoor?hr(n.stylesheet.schema):n.stylesheet.schema;if(!o||!o[i])return;const s=e.X(r);if("success"!==s.result)return void mr(this,s.value);const a=s.value.expression,l=e.C(i,n.scope),c=n.options.get(l);if(!c)return;let u;const{minValue:h,maxValue:d,stepValue:p,type:f,values:A}=o[i],m=e.X(o[i].default);"success"===m.result&&(u=m.value.expression),u?(this.options.set(l,Object.assign({},c,{value:a,default:u,minValue:h,maxValue:d,stepValue:p,type:f,values:A})),this.updateConfigDependencies(i)):this.fire(new e.z(new Error(`No schema defined for the config option "${i}" in the "${t}" fragment.`)))}getConfig(t){const i=this.getFragmentStyle(t);if(!i)return null;const r=i.stylesheet.schema;if(!r)return null;const n={};for(const t in r){const r=e.C(t,i.scope),o=i.options.get(r),s=o?o.value||o.default:null;n[t]=s?s.serialize():null}return n}setConfig(e,t){const i=this.getFragmentStyle(e);i&&(i.updateConfig(t,i.stylesheet.schema),this.updateConfigDependencies())}getSchema(e){const t=this.getFragmentStyle(e);return t?t.stylesheet.schema:null}setSchema(e,t){const i=this.getFragmentStyle(e);i&&(i.stylesheet.schema=t,i.updateConfig(i._config,t),this.updateConfigDependencies())}updateConfig(t,i){if(this._config=t,t||i)if(i)for(const r in i){let n,o;const s=e.X(i[r].default);if("success"===s.result&&(n=s.value.expression),t&&void 0!==t[r]){const i=e.X(t[r]);"success"===i.result&&(o=i.value.expression)}const{minValue:a,maxValue:l,stepValue:c,type:u,values:h}=i[r];if(n){const t=e.C(r,this.scope);this.options.set(t,{default:n,value:o,minValue:a,maxValue:l,stepValue:c,type:u,values:h})}else this.fire(new e.z(new Error(`No schema defined for config option "${r}".`)))}else this.fire(new e.z(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(e){for(const t of this._configDependentLayers){const i=this.getLayer(t);if(i){if(e&&!i.configDependencies.has(e))continue;i.possiblyEvaluateVisibility(),this._updateLayer(i)}}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle((e=>{const t=e._styleColorTheme.colorThemeOverride?e._styleColorTheme.colorThemeOverride:e._styleColorTheme.colorTheme;if(t){const i=e._evaluateColorThemeData(t);(!e._styleColorTheme.lut&&""!==i||e._styleColorTheme.lut&&i!==e._styleColorTheme.lut.data)&&e.setColorTheme(t)}})),this._changes.setDirty()}addLayer(t,i,r={}){this._checkLoaded();const n=t.id;if(this._layers[n])return void this.fire(new e.z(new Error(`Layer with id "${n}" already exists on this map`)));let o;if("custom"===t.type){if(mr(this,e.cu(t)))return;o=e.cv(t,this.scope,this._styleColorTheme.lut,this.options)}else{if("object"==typeof t.source&&(this.addSource(n,t.source),t=e.cq(t),t=e.l(t,{source:n})),this._validate(Te,`layers.${n}`,t,{arrayIndex:-1},r))return;o=e.cv(t,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(o),o.setEventedParent(this,{layer:{id:n}})}0!==o.configDependencies.size&&this._configDependentLayers.add(o.fqid);let s=this._order.length;if(i){const t=this._order.indexOf(i);if(-1===t)return void this.fire(new e.z(new Error(`Layer with id "${i}" does not exist on this map.`)));o.slot===this._layers[i].slot?s=t:e.w(`Layer with id "${i}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(s,0,n),this._layerOrderChanged=!0,this._layers[n]=o;const a=this.getOwnLayerSourceCache(o),l=!!this.directionalLight&&this.directionalLight.shadowsEnabled();a&&o.canCastShadows()&&l&&(a.castsShadows=!0);const c=this._changes.getRemovedLayer(o);if(c&&o.source&&a&&"custom"!==o.type){this._changes.discardLayerRemoval(o);const t=e.C(o.source,o.scope);c.type!==o.type?this._changes.updateSourceCache(t,"clear"):(this._changes.updateSourceCache(t,"reload"),a.pause())}this._updateLayer(o),o.onAdd&&o.onAdd(this.map),o.scope=this.scope,this.mergeLayers()}moveLayer(t,i){this._checkLoaded();const r=this._checkLayer(t);if(!r)return;if(t===i)return;const n=this._order.indexOf(t);this._order.splice(n,1);let o=this._order.length;if(i){const t=this._order.indexOf(i);if(-1===t)return void this.fire(new e.z(new Error(`Layer with id "${i}" does not exist on this map.`)));r.slot===this._layers[i].slot?o=t:e.w(`Layer with id "${i}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(o,0,t),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(e){this._checkLoaded();const t=this._checkLayer(e);if(!t)return;t.setEventedParent(null);const i=this._order.indexOf(e);this._order.splice(i,1),delete this._layers[e],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(t.fqid),this._changes.removeLayer(t);const r=this.getOwnLayerSourceCache(t);if(r&&r.castsShadows){let e=!1;for(const i in this._layers)if(this._layers[i].source===t.source&&this._layers[i].canCastShadows()){e=!0;break}r.castsShadows=e}t.onRemove&&t.onRemove(this.map),this.mergeLayers()}getOwnLayer(e){return this._layers[e]}hasLayer(e){return e in this._mergedLayers}hasLayerType(e){for(const t in this._layers)if(this._layers[t].type===e)return!0;return!1}setLayerZoomRange(e,t,i){this._checkLoaded();const r=this._checkLayer(e);r&&(r.minzoom===t&&r.maxzoom===i||(null!=t&&(r.minzoom=t),null!=i&&(r.maxzoom=i),this._updateLayer(r)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(e,t){this._checkLoaded();const i=this._checkLayer(e);i&&i.slot!==t&&(i.slot=t,this._updateLayer(i))}setFilter(t,i,r={}){this._checkLoaded();const n=this._checkLayer(t);if(n&&!e.bn(n.filter,i))return null==i?(n.filter=void 0,void this._updateLayer(n)):void(this._validate(Be,`layers.${n.id}.filter`,i,{layerType:n.type},r)||(n.filter=e.cq(i),this._updateLayer(n)))}getFilter(t){const i=this._checkLayer(t);if(i)return e.cq(i.filter)}setLayoutProperty(t,i,r,n={}){this._checkLoaded();const o=this._checkLayer(t);if(o&&!e.bn(o.getLayoutProperty(i),r)){if(null!=r&&(!n||!1!==n.validate)&&mr(o,Se.call(me,{key:`layers.${t}.layout.${i}`,layerType:o.type,objectKey:i,value:r,styleSpec:e.a5,style:{glyphs:!0,sprite:!0}})))return;o.setLayoutProperty(i,r),0!==o.configDependencies.size&&this._configDependentLayers.add(o.fqid),this._updateLayer(o)}}getLayoutProperty(e,t){const i=this._checkLayer(e);if(i)return i.getLayoutProperty(t)}setPaintProperty(t,i,r,n={}){this._checkLoaded();const o=this._checkLayer(t);if(!o)return;if(e.bn(o.getPaintProperty(i),r))return;if(null!=r&&(!n||!1!==n.validate)&&mr(o,Ce.call(me,{key:`layers.${t}.paint.${i}`,layerType:o.type,objectKey:i,value:r,styleSpec:e.a5})))return;const s=o.setPaintProperty(i,r);0!==o.configDependencies.size&&this._configDependentLayers.add(o.fqid),s&&this._updateLayer(o),this._changes.updatePaintProperties(o)}getPaintProperty(e,t){const i=this._checkLayer(e);if(i)return i.getPaintProperty(t)}setFeatureState(t,i){if(this._checkLoaded(),"target"in t){if("featuresetId"in t.target){const{featuresetId:e,importId:r}=t.target,n=this.getFragmentStyle(r),o=n.getFeaturesetLayers(e);for(const{source:e,sourceLayer:r}of o)n.setFeatureState({id:t.id,source:e,sourceLayer:r},i)}else if("layerId"in t.target){const{layerId:e}=t.target,r=this.getLayer(e);this.setFeatureState({id:t.id,source:r.source,sourceLayer:r.sourceLayer},i)}return}const r=t.source,n=t.sourceLayer,o=this._checkSource(r);if(!o)return;const s=o.type;if("geojson"===s&&n)return void this.fire(new e.z(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===s&&!n)return void this.fire(new e.z(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===t.id&&this.fire(new e.z(new Error("The feature id parameter must be provided.")));const a=this.getOwnSourceCaches(r);for(const e of a)e.setFeatureState(n,t.id,i)}removeFeatureState(t,i){if(this._checkLoaded(),"target"in t){if("featuresetId"in t.target){const{featuresetId:e,importId:r}=t.target,n=this.getFragmentStyle(r),o=n.getFeaturesetLayers(e);for(const{source:e,sourceLayer:r}of o)n.removeFeatureState({id:t.id,source:e,sourceLayer:r},i)}else if("layerId"in t.target){const{layerId:e}=t.target,r=this.getLayer(e);this.removeFeatureState({id:t.id,source:r.source,sourceLayer:r.sourceLayer},i)}return}const r=t.source,n=this._checkSource(r);if(!n)return;const o=n.type,s="vector"===o?t.sourceLayer:void 0;if("vector"===o&&!s)return void this.fire(new e.z(new Error("The sourceLayer parameter must be provided for vector source types.")));if(i&&"string"!=typeof t.id&&"number"!=typeof t.id)return void this.fire(new e.z(new Error("A feature id is required to remove its specific state property.")));const a=this.getOwnSourceCaches(r);for(const e of a)e.removeFeatureState(s,t.id,i)}getFeatureState(t){if(this._checkLoaded(),"target"in t){let i;if("featuresetId"in t.target){const{featuresetId:r,importId:n}=t.target,o=this.getFragmentStyle(n),s=o.getFeaturesetLayers(r);for(const{source:r,sourceLayer:n}of s){const s=o.getFeatureState({id:t.id,source:r,sourceLayer:n});if(s&&!i)i=s;else if(!e.bn(i,s))return void this.fire(new e.z(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in t.target){const{layerId:e}=t.target,r=this.getLayer(e);i=this.getFeatureState({id:t.id,source:r.source,sourceLayer:r.sourceLayer})}return i}const i=t.source,r=t.sourceLayer,n=this._checkSource(i);if(n){if("vector"!==n.type||r)return void 0===t.id&&this.fire(new e.z(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(i)[0].getFeatureState(r,t.id);this.fire(new e.z(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(t){return this.stylesheet.transition=e.l({},this.stylesheet.transition,t),this.transition=this.stylesheet.transition,this}getTransition(){return e.l({},this.stylesheet.transition)}serialize(){this._checkLoaded();const t=this.getTerrain(),i=t&&this.terrain&&this.terrain.scope===this.scope?t:this.stylesheet.terrain;return e.cw({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,iconsets:this.stylesheet.iconsets,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:i,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},(e=>void 0!==e))}_updateFilteredLayers(e){for(const t of Object.values(this._mergedLayers))e(t)&&this._updateLayer(t)}_updateLayer(t){this._changes.updateLayer(t);const i=this.getLayerSourceCache(t),r=e.C(t.source,t.scope),n=this._changes.getUpdatedSourceCaches();t.source&&!n[r]&&i&&"raster"!==i.getSource().type&&(this._changes.updateSourceCache(r,"reload"),i.pause()),t.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(e){const t=e=>this._mergedLayers[e].is3D(!!this.terrain),i=this.order,r={},n=[];for(let o=i.length-1;o>=0;o--){const s=i[o];if(t(s)){r[s]=o;for(const t of e){const e=t[s];if(e)for(const t of e)n.push(t)}}}n.sort(((e,t)=>t.intersectionZ-e.intersectionZ));const o=[];for(let s=i.length-1;s>=0;s--){const a=i[s];if(t(a))for(let e=n.length-1;e>=0;e--){const t=n[e].feature;if(t.layer&&r[t.layer.id]<s)break;o.push(t),n.pop()}else for(const t of e){const e=t[a];if(e)for(const t of e)o.push(t.feature)}}return o}queryRenderedFeatures(t,i,r){let n;i&&!Array.isArray(i)&&i.filter&&(this._validate(Be,"queryRenderedFeatures.filter",i.filter,null,i),n=e.a_(i.filter));const o={},s=e=>{if(yr.has(e.type))return;const t=this.getOwnLayerSourceCache(e),i=o[t.id]=o[t.id]||{sourceCache:t,layers:{},has3DLayers:!1};e.is3D(!!this.terrain)&&(i.has3DLayers=!0),i.layers[e.fqid]=i.layers[e.fqid]||{styleLayer:e,targets:[]},i.layers[e.fqid].targets.push({filter:n})};if(i&&i.layers){if(!Array.isArray(i.layers))return this.fire(new e.z(new Error("parameters.layers must be an Array."))),[];for(const t of i.layers){const i=this._layers[t];if(!i)return this.fire(new e.z(new Error(`The layer '${t}' does not exist in the map's style and cannot be queried for features.`))),[];s(i)}}else for(const e in this._layers)s(this._layers[e]);const a=this._queryRenderedFeatures(t,o,r),l=this._flattenAndSortRenderedFeatures(a),c=[];for(const t of l)e.ct(t.layer.id)===this.scope&&c.push(t);return c}queryRenderedFeatureset(t,i,r){let n;i&&!Array.isArray(i)&&i.filter&&(this._validate(Be,"queryRenderedFeatures.filter",i.filter,null,i),n=e.a_(i.filter));const o="mock",s=[];if(i&&i.target)s.push(Object.assign({},i,{targetId:o,filter:n}));else{const e=this.getFeaturesetDescriptors();for(const t of e)s.push({targetId:o,filter:n,target:t});for(const{style:e}of this.fragments){const t=e.getFeaturesetDescriptors();for(const e of t)s.push({targetId:o,filter:n,target:e})}}const a=this.queryRenderedTargets(t,s,r),l=[],c=new Set;for(const t of a)for(const i of t.variants[o])at(i,t,c)||l.push(new e.cx(t,i));return l}queryRenderedTargets(t,i,r){const n={},o=(e,t,i,r)=>{const o=n[t.id]=n[t.id]||{sourceCache:t,layers:{},has3DLayers:!1};if(o.layers[e.fqid]=o.layers[e.fqid]||{styleLayer:e,targets:[]},e.is3D(!!this.terrain)&&(o.has3DLayers=!0),!r)return i.uniqueFeatureID=!1,void o.layers[e.fqid].targets.push(i);o.layers[e.fqid].targets.push(Object.assign({},i,{namespace:r.namespace,properties:r.properties,uniqueFeatureID:r.uniqueFeatureID}))};for(const t of i)if("featuresetId"in t.target){const{featuresetId:i,importId:r}=t.target,n=this.getFragmentStyle(r);if(!n||!n._featuresetSelectors)continue;const s=n._featuresetSelectors[i];if(!s){this.fire(new e.z(new Error(`The featureset '${i}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const e of s){const i=n.getOwnLayer(e.layerId);i&&!yr.has(i.type)&&o(i,n.getOwnLayerSourceCache(i),t,e)}}else if("layerId"in t.target){const{layerId:e}=t.target,i=this.getLayer(e);if(!i||yr.has(i.type))continue;o(i,this.getLayerSourceCache(i),t)}const s=this._queryRenderedFeatures(t,n,r);return this._flattenAndSortRenderedFeatures(s)}_queryRenderedFeatures(e,t,i){const r=[],n=!!this.map._showQueryGeometry,o=Ke.createFromScreenPoints(e,i);for(const e in t){const s=lt(o,t[e],this._availableImages,i,n);Object.keys(s).length&&r.push(s)}if(this.placement)for(const e in t){if(!t[e].sourceCache._onlySymbols)continue;const i=ct(o.screenGeometry,t[e],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData);Object.keys(i).length&&r.push(i)}return r}querySourceFeatures(e,t){const i=t&&t.filter;i&&this._validate(Be,"querySourceFeatures.filter",i,null,t);let r=[];const n=this.getOwnSourceCaches(e);for(const e of n)r=r.concat(ut(e,t));return r}addSourceType(e,t,i){return br.getSourceType(e)?i(new Error(`A source type called "${e}" already exists.`)):(br.setSourceType(e,t),t.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:e,url:t.workerSourceURL},i):i(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(t,i,r={}){this._checkLoaded();const n=this.light.getLight();let o=!1;for(const i in t)if(!e.bn(t[i],n[i])){o=!0;break}if(!o)return;const s=this._getTransitionParameters();this.light.setLight(t,i,r),this.light.updateTransitions(s)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){void 0===this.disableElevatedTerrain&&(this.disableElevatedTerrain=e.q.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&e.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(t,i=1){if(this._checkLoaded(),!t)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),0===i&&delete this.terrain,null===t?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let r=t;const n=null==t.source;if(1===i){if(this.disableElevatedTerrain)return;if("object"==typeof r.source){const t="terrain-dem-src";this.addSource(t,r.source),r=e.cq(r),r=e.l(r,{source:t})}const t=e.l({},r),i={};if(this.terrain&&n){t.source=this.terrain.get().source;const e=this.terrain?this.getFragmentStyle(this.terrain.scope):null;e&&(i.style=e.serialize())}if(this._validate(ve,"terrain",t,i))return}if(!this.terrain||this.terrain.scope!==this.scope&&!n||this.terrain&&i!==this.terrain.drapeRenderMode){if(!r)return;this._createTerrain(r,i),this.fire(new e.A("data",{dataType:"style"}))}else{const i=this.terrain,n=i.get();for(const t of Object.keys(e.a5.terrain))!r.hasOwnProperty(t)&&e.a5.terrain[t].default&&(r[t]=e.a5.terrain[t].default);for(const r in t)if(!e.bn(t[r],n[r])){i.set(t,this.options),this.stylesheet.terrain=t;const r=this._getTransitionParameters({duration:0});i.updateTransitions(r),this.fire(new e.A("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(e){const t=this.fog=new Qe(e,this.map.transform,this.scope,this.options);this.stylesheet.fog=t.get();const i=this._getTransitionParameters({duration:0});t.updateTransitions(i)}_createSnow(e){const t=this.snow=new $e(e,this.map.transform,this.scope,this.options);this.stylesheet.snow=t.get();const i=this._getTransitionParameters({duration:0});t.updateTransitions(i)}_createRain(e){const t=this.rain=new Ze(e,this.map.transform,this.scope,this.options);this.stylesheet.rain=t.get();const i=this._getTransitionParameters({duration:0});t.updateTransitions(i)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask((()=>{for(const e of this.map._markers)e._evaluateOpacity()}))}getFog(){return this.fog?this.fog.get():null}setFog(t){if(this._checkLoaded(),!t)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const i=this.fog;if(!e.bn(i.get(),t)){i.set(t,this.options),this.stylesheet.fog=i.get();const e=this._getTransitionParameters({duration:0});i.updateTransitions(e)}}else this._createFog(t);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(t){if(this._checkLoaded(),!t)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const i=this.snow;if(!e.bn(i.get(),t)){i.set(t,this.options),this.stylesheet.snow=i.get();const e=this._getTransitionParameters({duration:0});i.updateTransitions(e)}}else this._createSnow(t);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(t){if(this._checkLoaded(),!t)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const i=this.rain;if(!e.bn(i.get(),t)){i.set(t,this.options),this.stylesheet.rain=i.get();const e=this._getTransitionParameters({duration:0});i.updateTransitions(e)}}else this._createRain(t);this._markersNeedUpdate=!0}_reloadColorTheme(){const t=()=>{for(const e in this._layers)this._layers[e].lut=this._styleColorTheme.lut;for(const e in this._sourceCaches)this._sourceCaches[e].clearTiles()},i=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!i)return this._styleColorTheme.lut=null,void t();const r=this._evaluateColorThemeData(i);this._loadColorTheme(r).then((()=>{this.fire(new e.A("colorthemeset")),t()})).catch((t=>{e.w(`Couldn't set color theme: ${t}`)}))}setColorTheme(t){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&e.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=t,this._reloadColorTheme()}setImportColorTheme(e,t){const i=this.getFragmentStyle(e);i&&(i._styleColorTheme.colorThemeOverride=t,i._reloadColorTheme())}_getTransitionParameters(t){return{now:e.q.now(),transition:e.l(this.transition,t)}}updateDrapeFirstLayers(){if(!this.terrain)return;const e=[],t=[];for(const i of this._mergedOrder)this.isLayerDraped(this._mergedLayers[i])?e.push(i):t.push(i);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...e),this._drapedFirstOrder.push(...t)}_createTerrain(e,t){const i=this.terrain=new Fe(e,t,this.scope,this.options);1===t&&(this.stylesheet.terrain=e),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const r=this._getTransitionParameters({duration:0});i.updateTransitions(r)}_force3DLayerUpdate(){for(const e in this._layers){const t=this._layers[e];"fill-extrusion"===t.type&&this._updateLayer(t)}}_forceSymbolLayerUpdate(){for(const e in this._layers){const t=this._layers[e];"symbol"===t.type&&this._updateLayer(t)}}_validate(t,i,r,n,o={}){if(o&&!1===o.validate)return!1;const s=e.l({},this.serialize());return mr(this,t.call(me,e.l({key:i,style:s,value:r,styleSpec:e.a5},n)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),e.cy.off("pluginStateChange",this._rtlTextPluginCallback);for(const e in this._mergedLayers)this._mergedLayers[e].setEventedParent(null);for(const e in this._mergedSourceCaches)this._mergedSourceCaches[e].clearTiles(),this._mergedSourceCaches[e].setEventedParent(null);this.imageManager.removeScope(this.scope),this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(e){const t=this.getSourceCaches(e);for(const e of t)e.clearTiles()}clearSources(){for(const e in this._mergedSourceCaches)this._mergedSourceCaches[e].clearTiles()}reloadSource(e){const t=this.getSourceCaches(e);for(const e of t)e.resume(),e.reload()}reloadSources(){for(const e of this.getSources())e.reload&&e.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle((e=>{e.modelManager.reloadModels(e.scope)}))}updateSources(e){let t;this.directionalLight&&(t=or(this.directionalLight));for(const i in this._mergedSourceCaches)this._mergedSourceCaches[i].update(e,void 0,void 0,t)}_generateCollisionBoxes(){for(const e in this._sourceCaches){const t=this._sourceCaches[e];t.resume(),t.reload()}}_updatePlacement(t,i,r,n,o,s,a=!1){let l=!1,c=!1;const u={},h={};for(const t of this._mergedOrder){const r=this._mergedLayers[t];if("symbol"!==r.type)continue;const n=e.C(r.source,r.scope);let o=u[n];if(!o){const e=this.getLayerSourceCache(r);if(!e)continue;const t=e.getRenderableIds(!0).map((t=>e.getTileByID(t)));h[n]=t.slice(),o=u[n]=t.sort(((e,t)=>t.tileID.overscaledZ-e.tileID.overscaledZ||(e.tileID.isLessThan(t.tileID)?-1:1)))}const s=this.crossTileSymbolIndex.addLayer(r,o,i.center.lng,i.projection);l=l||s}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),a=a||this._layerOrderChanged||0===n,this._layerOrderChanged&&this.fire(new e.A("neworder")),(a||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(e.q.now(),i.zoom))&&(this.pauseablePlacement=new Ii(i,this._mergedOrder,a,r,n,o,this.placement,this.fog&&i.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,u,h,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(e.q.now()),c=!0),l&&this.pauseablePlacement.placement.setStale()),c||l){this._buildingIndex.onNewFrame(i.zoom);for(let t=0;t<this._mergedOrder.length;t++){const i=this._mergedLayers[this._mergedOrder[t]];if("symbol"!==i.type)continue;const r=this.isLayerClipped(i);this.placement.updateLayerOpacities(i,u[e.C(i.source,i.scope)],t,r?s:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(e.q.now())}}_releaseSymbolFadeTiles(){for(const e in this._sourceCaches)this._sourceCaches[e].releaseSymbolFadeTiles()}addImport(t,i){this._checkLoaded();const r=this.stylesheet.imports=this.stylesheet.imports||[];if(-1!==r.findIndex((({id:e})=>e===t.id)))return void this.fire(new e.z(new Error(`Import with id '${t.id}' already exists in the map's style.`)));if(!i)return r.push(t),this._loadImports([t],!0);const n=r.findIndex((({id:e})=>e===i));return-1===n&&this.fire(new e.z(new Error(`Import with id "${i}" does not exist on this map.`))),this.stylesheet.imports=r.slice(0,n).concat(t).concat(r.slice(n)),this._loadImports([t],!0,i)}updateImport(t,i){this._checkLoaded();const r=this.stylesheet.imports||[],n=this.getImportIndex(t);return-1===n?this:"string"==typeof i?(this.setImportUrl(t,i),this):(i.url&&i.url!==r[n].url&&this.setImportUrl(t,i.url),e.bn(i.config,r[n].config)||this.setImportConfig(t,i.config,i.data.schema),e.bn(i.data,r[n].data)||this.setImportData(t,i.data),this)}moveImport(e,t){this._checkLoaded();let i=this.stylesheet.imports||[];const r=this.getImportIndex(e);if(-1===r)return this;const n=this.getImportIndex(t);if(-1===n)return this;const o=i[r],s=this.fragments[r];return i=i.filter((({id:t})=>t!==e)),this.fragments=this.fragments.filter((({id:t})=>t!==e)),this.stylesheet.imports=i.slice(0,n).concat(o).concat(i.slice(n)),this.fragments=this.fragments.slice(0,n).concat(s).concat(this.fragments.slice(n)),this.mergeLayers(),this}setImportUrl(e,t){this._checkLoaded();const i=this.stylesheet.imports||[],r=this.getImportIndex(e);if(-1===r)return this;i[r].url=t;const n=this.fragments[r];return n.style=this._createFragmentStyle(i[r]),n.style.on("style.import.load",(()=>this.mergeAll())),n.style.loadURL(t),this}setImportData(e,t){this._checkLoaded();const i=this.getImportIndex(e),r=this.stylesheet.imports||[];return-1===i?this:t?(this.fragments[i].style.setState(t),this._reloadImports(),this):(delete r[i].data,this.setImportUrl(e,r[i].url))}setImportConfig(e,t,i){this._checkLoaded();const r=this.getImportIndex(e),n=this.stylesheet.imports||[];if(-1===r)return this;t?n[r].config=t:delete n[r].config;const o=this.fragments[r];i&&o.style.stylesheet&&(o.style.stylesheet.schema=i);const s=o.style.stylesheet&&o.style.stylesheet.schema;return o.config=t,o.style.updateConfig(t,s),this.updateConfigDependencies(),this}removeImport(e){this._checkLoaded();const t=this.stylesheet.imports||[],i=this.getImportIndex(e);-1!==i&&(t.splice(i,1),this.fragments[i].style._remove(),this.fragments.splice(i,1),this._reloadImports())}getImportIndex(t){const i=(this.stylesheet.imports||[]).findIndex((e=>e.id===t));return-1===i&&this.fire(new e.z(new Error(`Import '${t}' does not exist in the map's style and cannot be updated.`))),i}getLayer(e){return this._mergedLayers[e]}getSources(){const e=[];for(const t in this._mergedOtherSourceCaches){const i=this._mergedOtherSourceCaches[t];i&&e.push(i.getSource())}return e}getSource(e,t){const i=this.getSourceCache(e,t);return i&&i.getSource()}getLayerSource(e){const t=this.getLayerSourceCache(e);return t&&t.getSource()}getSourceCache(t,i){const r=e.C(t,i);return this._mergedOtherSourceCaches[r]}getLayerSourceCache(t){const i=e.C(t.source,t.scope);return"symbol"===t.type?this._mergedSymbolSourceCaches[i]:this._mergedOtherSourceCaches[i]}getSourceCaches(e){if(null==e)return Object.values(this._mergedSourceCaches);const t=[];return this._mergedOtherSourceCaches[e]&&t.push(this._mergedOtherSourceCaches[e]),this._mergedSymbolSourceCaches[e]&&t.push(this._mergedSymbolSourceCaches[e]),t}updateSourceCaches(){const e=this._changes.getUpdatedSourceCaches();for(const t in e){const i=e[t];"reload"===i?this.reloadSource(t):"clear"===i&&this.clearSource(t)}}updateLayers(e){const t=this._changes.getUpdatedPaintProperties();for(const i of t){const t=this.getLayer(i);t&&t.updateTransitions(e)}}getGlyphsUrl(){return this.stylesheet.glyphs}setGlyphsUrl(e){this.stylesheet.glyphs=e,this.glyphManager.setURL(e,this.scope)}getImages(t,i,r){this.imageManager.getImages(i.images,i.scope,r),this._updateTilesForChangedImages();const n=t=>{if(t){const r=i.images.map((t=>e.I.toString(t)));t.setDependencies(i.tileID.key,i.type,r)}},o=e.C(i.source,i.scope);n(this._mergedOtherSourceCaches[o]),n(this._mergedSymbolSourceCaches[o])}rasterizeImages(e,t,i){this.imageManager.rasterizeImages(t,i)}getGlyphs(e,t,i){this.glyphManager.getGlyphs(t.stacks,t.scope,i)}getResource(t,i,r){return e.cz(i,r)}getOwnSourceCache(e){return this._otherSourceCaches[e]}getOwnLayerSourceCache(e){return"symbol"===e.type?this._symbolSourceCaches[e.source]:this._otherSourceCaches[e.source]}getOwnSourceCaches(e){const t=[];return this._otherSourceCaches[e]&&t.push(this._otherSourceCaches[e]),this._symbolSourceCaches[e]&&t.push(this._symbolSourceCaches[e]),t}_isSourceCacheLoaded(t){const i=this.getOwnSourceCaches(t);return 0===i.length?(this.fire(new e.z(new Error(`There is no source with ID '${t}'`))),!1):i.every((e=>e.loaded()))}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(e,t){if(!this._clipLayerPresent&&"fill-extrusion"!==e.type)return!1;const i="fill-extrusion"===e.type&&"building"===e.sourceLayer;if(e.is3D(!!this.terrain)){if(i||t&&"batched-model"===t.type)return!0;if("model"===e.type)return!0}else if("symbol"===e.type)return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach((e=>{e.style._remove()})),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}br.getSourceType=function(e){return nt[e]},br.setSourceType=function(e,t){nt[e]=t},br.registerForPluginStateChange=e.ci;var wr="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#ifdef RENDER_CUTOFF\nfloat cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}\n#endif",Tr="\nout vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}\n#ifdef INDICATOR_CUTOUT\nuniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;\n#endif\nvec4 applyCutout(vec4 color,float height) {\n#ifdef INDICATOR_CUTOUT\nfloat verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);\n#else\nreturn color;\n#endif\n}\n#ifdef DEBUG_WIREFRAME\n#define HANDLE_WIREFRAME_DEBUG \\\nglFragColor=vec4(0.7,0.0,0.0,0.7); \\\ngl_FragDepth=gl_FragCoord.z-0.0001;\n#else\n#define HANDLE_WIREFRAME_DEBUG\n#endif\n#ifdef RENDER_CUTOFF\nuniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;\n#endif\nvec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}",Br="\n#define EXTENT 8192.0\n#define RAD_TO_DEG 180.0/PI\n#define DEG_TO_RAD PI/180.0\n#define GLOBE_RADIUS EXTENT/PI/2.0\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#ifndef PROJECTED_POS_ON_VIEWPORT\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}\n#ifdef RENDER_CUTOFF\nuniform vec4 u_cutoff_params;out float v_cutoff_opacity;\n#endif\nconst vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)\n{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}",Cr="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Sr="\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\n#ifdef TERRAIN\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nfloat nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nreturn currentElevation(apos);}\n#endif\nvec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }\n#endif\n#ifdef DEPTH_OCCLUSION\nuniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;\n#ifdef DEPTH_D24\nfloat unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}\n#else\nhighp float unpack_depth_rgba(vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}\n#endif\nbool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;\n#ifdef DEPTH_D24\nfloat depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);\n#else\nfloat depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));\n#endif\nreturn coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;\n#ifdef DEPTH_D24\nhighp vec4 depth=vec4(\ntexture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r\n);depth=unpack_depth4(depth);\n#else\nhighp vec4 depth=vec4(\nunpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))\n);\n#endif\nreturn depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {\n#ifdef DEPTH_D24\nhighp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);\n#else\nhighp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));\n#endif\nres+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}\n#else\nbool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }\n#endif//DEPTH_OCCLUSION",Er="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",Mr="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif",Ir="#ifdef RASTER_ARRAY\nuniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)\n);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)\n);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}\n#endif",Pr="#ifdef RASTER_ARRAY\nuniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}\n#endif\nuniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}",Lr="#ifdef RENDER_SHADOWS\nuniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}\n#endif//RENDER_SHADOWS",Fr="#ifdef RENDER_SHADOWS\n#ifdef DEPTH_TEXTURE\nuniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;\n#else\nuniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;\n#endif\nuniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;\n#ifdef DEPTH_TEXTURE\nshadow_depth=texture(u_shadowmap_1,uv).r;\n#else\nshadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;\n#endif\nreturn step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;\n#ifdef DEPTH_TEXTURE\nshadow_depth=texture(u_shadowmap_0,uv).r;\n#else\nshadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;\n#endif\nreturn step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;\n#ifdef TEXTURE_GATHER\nhighp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));\n#else\nhighp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(\nshadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)\n);\n#endif\nvec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return clamp(mix(lerpx.x,lerpx.y,f.y),0.0,1.0);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {\n#ifdef SHADOWS_SINGLE_CASCADE\nlight_view_pos0.xyz/=light_view_pos0.w;vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);\n#else\nlight_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return clamp(mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth)),0.0,1.0);\n#endif\n}highp float calculate_shadow_bias(float NDotL) {\n#ifdef NORMAL_OFFSET\nreturn 0.5*u_shadow_bias.x;\n#else\nreturn 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));\n#endif\n}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)\n{highp vec2 biasUV=vec2(\npos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}\n#endif";const kr=[];Nr(wr,kr),Nr(Br,kr),Nr(Tr,kr);const zr={"_prelude_fog.vertex.glsl":Er,"_prelude_terrain.vertex.glsl":Sr,"_prelude_shadow.vertex.glsl":Lr,"_prelude_fog.fragment.glsl":Mr,"_prelude_shadow.fragment.glsl":Fr,"_prelude_lighting.glsl":"\n#ifdef LIGHTING_3D_MODE\nuniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}\n#endif//LIGHTING_3D_MODE","_prelude_raster_array.glsl":Ir,"_prelude_raster_particle.glsl":Pr},Rr={};Qr("",Sr),Qr(Mr,Er),Qr(Fr,Lr),Qr(Ir,""),Qr(Pr,"");const Dr=Qr(Tr,Br),Or=wr;var Ur={background:Qr('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec4 u_color;uniform float u_opacity;\n#ifdef LIGHTING_3D_MODE\nin vec4 v_color;\n#endif\nvoid main() {vec4 out_color;\n#ifdef LIGHTING_3D_MODE\nout_color=v_color;\n#else\nout_color=u_color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_lighting.glsl"\nin vec2 a_pos;uniform mat4 u_matrix;\n#ifdef LIGHTING_3D_MODE\nuniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),backgroundPattern:Qr('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),circle:Qr('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nin vec3 v_data;in float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nuniform float u_emissive_strength;void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? \nsmoothstep(0.0,-antialiased_blur,1.0-extrude_length) : \nsmoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\nglFragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\n}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\n#ifdef ELEVATED_ROADS\nin float a_circle_z_offset;\n#endif\nout vec3 v_data;out float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);\n#else \nsurface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);\n#endif\n#ifdef ELEVATED_ROADS\nworld_center.z+=a_circle_z_offset+ELEVATION_BIAS;\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nocclusion_world_center=world_center;occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}'),clippingMask:Qr("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Qr('#include "_prelude_fog.fragment.glsl"\nuniform highp float u_intensity;in vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\nif (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nout vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\npos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),heatmapTexture:Qr("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(0.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}","in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Qr("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",'#include "_prelude_terrain.vertex.glsl"\nin vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}'),collisionCircle:Qr("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}","in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Qr("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",'#include "_prelude_terrain.vertex.glsl"\nin vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;\n#endif\nout vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}'),elevatedStructuresDepth:Qr("void main() {\n#ifndef DEPTH_TEXTURE\nglFragColor=vec4(0.);\n#endif\n}","in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform float u_depth_bias;void main() {gl_Position=u_matrix*vec4(a_pos,a_height,1);gl_Position.z=gl_Position.z+u_depth_bias;}"),elevatedStructuresDepthReconstruct:Qr("#ifdef DEPTH_RECONSTRUCTION\nin float v_height;\n#endif\nvoid main() {\n#ifdef DEPTH_RECONSTRUCTION\nif (v_height >=0.0)\ndiscard;\n#endif\nglFragColor=vec4(1.0,0.0,0.0,1.0);}","in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform vec3 u_camera_pos;uniform highp float u_depth_bias;uniform lowp float u_height_scale;uniform lowp float u_reset_depth;\n#ifdef DEPTH_RECONSTRUCTION\nout float v_height;\n#endif\nvoid main() {vec3 vpos=vec3(a_pos,a_height*u_height_scale);\n#ifdef DEPTH_RECONSTRUCTION\nif (u_camera_pos.z > vpos.z) {vpos-=(u_camera_pos-vpos)*(vpos.z/(u_camera_pos.z-vpos.z));}v_height=a_height;\n#endif\ngl_Position=u_matrix*vec4(vpos,1);gl_Position.z=u_reset_depth==1.0 ? gl_Position.w : gl_Position.z+u_depth_bias;}"),elevatedStructures:Qr('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_shadow.fragment.glsl"\nin vec3 v_normal;in float v_height;\n#ifdef RENDER_SHADOWS\nin highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;\n#endif\nvoid main() {vec3 color=vec3(241.0/255.0,236.0/255.0,225.0/255.0);\n#ifdef LIGHTING_3D_MODE\nvec3 normal=normalize(v_normal);\n#ifdef RENDER_SHADOWS\nfloat shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);\n#else\ncolor=apply_lighting(color,normal);\n#endif\nif (v_height < 0.0) {float penetration=max(v_height+7.5,0.0);float occlusion=1.0-1.0/PI*acos(1.0-penetration/4.0);color=color*(1.0-pow(occlusion,2.0)*0.3);}\n#endif\n#ifdef FOG\ncolor=fog_apply(color,v_fog_pos);\n#endif\nvec4 out_color=vec4(color,1.0);\n#ifdef INDICATOR_CUTOUT\nout_color=applyCutout(out_color,v_height);\n#endif\nglFragColor=out_color;HANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nin vec2 a_pos;in float a_height;in vec3 a_pos_normal_3;uniform mat4 u_matrix;out vec3 v_normal;out float v_height;\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;\n#endif\nvoid main() {v_normal=a_pos_normal_3/16384.0;v_height=a_height;vec3 pos=vec3(a_pos,a_height);gl_Position=u_matrix*vec4(pos,1);\n#ifdef RENDER_SHADOWS\nvec3 shd_pos0=pos;vec3 shd_pos1=pos;\n#ifdef NORMAL_OFFSET\nvec3 offset=shadow_normal_offset(v_normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fill:Qr('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nuniform float u_emissive_strength;\n#ifdef RENDER_SHADOWS\nuniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;\n#endif\n#ifdef INDICATOR_CUTOUT\nin highp float v_z_offset;\n#endif\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#ifdef RENDER_SHADOWS\nfloat light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);\n#endif\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nout_color*=opacity;\n#ifdef INDICATOR_CUTOUT\nif (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nin vec2 a_pos;\n#ifdef ELEVATED_ROADS\nin float a_road_z_offset;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;\n#endif\n#ifdef INDICATOR_CUTOUT\nout highp float v_z_offset;\n#endif\nuniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp float z_offset\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp float z_offset\n#ifdef ELEVATED_ROADS\nz_offset+=a_road_z_offset;\n#endif\nfloat hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);\n#ifdef RENDER_SHADOWS\nvec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);\n#ifdef NORMAL_OFFSET\nvec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n#ifdef INDICATOR_CUTOUT\nv_z_offset=z_offset;\n#endif\n}'),fillOutline:Qr('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_shadow.fragment.glsl"\nin highp vec2 v_pos;uniform float u_emissive_strength;\n#ifdef RENDER_SHADOWS\nuniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;\n#endif\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#ifdef RENDER_SHADOWS\nfloat light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);\n#endif\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nin vec2 a_pos;\n#ifdef ELEVATED_ROADS\nin float a_road_z_offset;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;\n#endif\nuniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp float z_offset\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp float z_offset\n#ifdef ELEVATED_ROADS\nz_offset+=a_road_z_offset;\n#endif\nfloat hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef RENDER_SHADOWS\nvec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);\n#ifdef NORMAL_OFFSET\nvec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillOutlinePattern:Qr('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_shadow.fragment.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;\n#ifdef RENDER_SHADOWS\nuniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;\n#endif\nin highp vec2 v_pos;in highp vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#ifdef RENDER_SHADOWS\nfloat light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);\n#endif\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;\n#ifdef ELEVATED_ROADS\nin float a_road_z_offset;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;\n#endif\nout highp vec2 v_pos;out highp vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\n#pragma mapbox: define highp float z_offset\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\n#pragma mapbox: initialize highp float z_offset\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;\n#ifdef ELEVATED_ROADS\nz_offset+=a_road_z_offset;\n#endif\nfloat hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef RENDER_SHADOWS\nvec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);\n#ifdef NORMAL_OFFSET\nvec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillPattern:Qr('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_shadow.fragment.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;in highp vec2 v_pos;uniform float u_emissive_strength;\n#ifdef RENDER_SHADOWS\nuniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;\n#endif\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#ifdef RENDER_SHADOWS\nfloat light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);\n#endif\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;\n#ifdef ELEVATED_ROADS\nin float a_road_z_offset;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;\n#endif\nout highp vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\n#pragma mapbox: define highp float z_offset\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\n#pragma mapbox: initialize highp float z_offset\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;\n#ifdef ELEVATED_ROADS\nz_offset+=a_road_z_offset;\n#endif\nfloat hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);\n#ifdef RENDER_SHADOWS\nvec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);\n#ifdef NORMAL_OFFSET\nvec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillExtrusion:Qr('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nin vec4 v_color;in vec4 v_flat;\n#ifdef RENDER_SHADOWS\nin highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;\n#endif\nuniform lowp float u_opacity;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;in vec2 v_ao;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nin vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nin highp vec3 v_normal;\n#endif\nuniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;\n#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)\nin float v_flood_radius;in float v_has_floodlight;\n#endif\nin float v_height;\n#pragma mapbox: define highp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp float emissive_strength\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nvec3 normal=normalize(v_normal);\n#endif\nfloat z;vec4 color=v_color;\n#ifdef ZERO_ROOF_RADIUS\nz=float(normal.z > 0.00001);\n#ifdef LIGHTING_3D_MODE\nnormal=mix(normal,vec3(0.0,0.0,1.0),z);\n#else\ncolor=mix(v_color,v_roof_color,z);\n#endif\n#endif\nfloat h=max(0.0,v_height);float ao_shade=1.0;\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;\n#ifdef ZERO_ROOF_RADIUS\nconcave*=(1.0-z);\n#endif\nfloat x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);\n#ifdef LIGHTING_3D_MODE\n#ifdef FLOOD_LIGHT\ncolor.rgb*=mix(ao_shade,1.0,v_has_floodlight);\n#else\ncolor.rgb*=ao_shade;\n#endif\n#else\ncolor.rgb*=ao_shade;\n#endif\n#endif\n#ifdef LIGHTING_3D_MODE\nfloat flood_radiance=0.0;\n#ifdef FLOOD_LIGHT\nflood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;\n#endif\n#ifdef RENDER_SHADOWS\n#ifdef FLOOD_LIGHT\nfloat ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);\n#else\nfloat shadowed_lighting_factor;\n#ifdef RENDER_CUTOFF\nshadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}\n#else\nshadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);\n#endif\ncolor.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);\n#endif\n#else\ncolor.rgb=apply_lighting(color.rgb,normal);\n#ifdef FLOOD_LIGHT\ncolor.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);\n#endif\n#endif\ncolor.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));\n#endif\n#ifdef INDICATOR_CUTOUT\ncolor=applyCutout(color,h);\n#endif\nglFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\n#include "_prelude_lighting.glsl"\nuniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;\n#ifdef RENDER_WALL_MODE\nin vec3 a_join_normal_inside;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\n#ifdef TERRAIN\nuniform int u_height_type;uniform int u_base_type;\n#endif\nuniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nout vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nout highp vec3 v_normal;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;out vec2 v_ao;\n#endif\n#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)\nout float v_flood_radius;out float v_has_floodlight;\n#endif\nout float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define highp float flood_light_wall_radius\n#pragma mapbox: define highp float line_width\n#pragma mapbox: define highp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize highp float flood_light_wall_radius\n#pragma mapbox: initialize highp float line_width\n#pragma mapbox: initialize highp float emissive_strength\nbase*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nv_normal=normal;\n#endif\nbase=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;\n#ifdef TERRAIN\nbool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);\n#else\nh=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat cutoff=1.0;vec3 scaled_pos=pos;\n#ifdef RENDER_CUTOFF\nvec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=cutoff_opacity(u_cutoff_params,ground.z);if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);\n#endif\nfloat hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));\n#ifdef RENDER_WALL_MODE\nvec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;\n#endif\ngl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;\n#ifdef RENDER_SHADOWS\nvec3 shd_pos0=pos;vec3 shd_pos1=pos;\n#ifdef NORMAL_OFFSET\nvec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);\n#endif\nfloat NdotL=0.0;float colorvalue=0.0;\n#ifndef LIGHTING_3D_MODE\ncolorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#endif\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\n#ifdef FLOOD_LIGHT\nfloat is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;\n#endif\nv_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);\n#else\nv_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nfloat roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),fillExtrusionDepth:Qr("in highp float v_depth;void main() {\n#ifndef DEPTH_TEXTURE\nglFragColor=pack_depth(v_depth);\n#endif\n}",'#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;\n#ifdef TERRAIN\nuniform int u_height_type;uniform int u_base_type;\n#endif\nin vec4 a_pos_normal_ed;in vec2 a_centroid_pos;\n#ifdef RENDER_WALL_MODE\nin vec3 a_join_normal_inside;\n#endif\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp float line_width\n#pragma mapbox: define highp vec4 color\nout highp float v_depth;void main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp float line_width\n#pragma mapbox: initialize highp vec4 color\nbase*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nvec3 pos;\n#ifdef TERRAIN\nbool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);\n#else\npos=vec3(pos_nx.xy,t > 0.0 ? height : base);\n#endif\n#ifdef RENDER_WALL_MODE\nvec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;\n#endif\nfloat hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}'),fillExtrusionPattern:Qr('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;in vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nin vec3 v_normal;\n#endif\nin highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define mediump vec4 pattern\n#pragma mapbox: define highp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize highp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;\n#else\nout_color=out_color*v_lighting;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef INDICATOR_CUTOUT\nout_color=applyCutout(out_color,height);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_lighting.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;\n#ifdef RENDER_WALL_MODE\nin vec3 a_join_normal_inside;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\n#ifdef TERRAIN\nuniform int u_height_type;uniform int u_base_type;\n#endif\nout highp vec2 v_pos;out vec4 v_lighting;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;out vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nout vec3 v_normal;\n#endif\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump vec4 pattern\n#pragma mapbox: define highp float pixel_ratio\n#pragma mapbox: define highp float line_width\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize highp float pixel_ratio\n#pragma mapbox: initialize highp float line_width\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=z;vec3 p;float c_ele;\n#ifdef TERRAIN\nbool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);\n#else\np=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\n#ifdef RENDER_WALL_MODE\nvec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;\n#endif\nfloat hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\nNdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_normal=normal;\n#else\nv_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#endif \n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}'),groundShadow:Qr('#include "_prelude_shadow.fragment.glsl"\nprecision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;\n#ifdef FOG\nin float v_fog_opacity;\n#endif\nvoid main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);\n#ifdef RENDER_CUTOFF\nshadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));\n#endif\n#ifdef FOG\nshadow=mix(shadow,vec3(1.0),v_fog_opacity);\n#endif\n#ifdef INDICATOR_CUTOUT\nshadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);\n#endif\nglFragColor=vec4(shadow,1.0);}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;\n#ifdef FOG\nout float v_fog_opacity;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);\n#endif\n}'),fillExtrusionGroundEffect:Qr("uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;\n#ifdef SDF_SUBPASS\nin highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}\n#ifdef FOG\nin highp float v_fog;\n#endif\n#endif\nvoid main() {\n#ifdef CLEAR_SUBPASS\nvec4 color=vec4(1.0);\n#ifdef CLEAR_FROM_TEXTURE\ncolor=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));\n#endif\nglFragColor=color;\n#else\n#ifdef SDF_SUBPASS\nhighp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;\n#ifdef FOG\nfog=v_fog;\n#endif\n#ifdef RENDER_CUTOFF\nfog*=v_cutoff_opacity;\n#endif\nglFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));\n#else\nvec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);\n#ifdef OVERDRAW_INSPECTOR\ncolor=vec4(1.0);\n#endif\nglFragColor=color;\n#endif\nHANDLE_WIREFRAME_DEBUG;\n#endif\n}",'#include "_prelude_fog.vertex.glsl"\nin highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;\n#ifdef SDF_SUBPASS\nout highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;\n#ifdef FOG\nout highp float v_fog;\n#endif\n#endif\nuniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;\n#pragma mapbox: define highp float flood_light_ground_radius\nconst float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {\n#pragma mapbox: initialize highp float flood_light_ground_radius\nvec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;\n#ifdef SDF_SUBPASS\nv_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);\n#ifdef FOG\nv_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);\n#endif\n#endif\nfloat hidden_by_landmark=0.0;\n#ifdef HAS_CENTROID\nhidden_by_landmark=a_hidden_by_landmark;\n#endif\nfloat isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));\n#ifdef RENDER_CUTOFF\nv_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);\n#endif\n}'),hillshadePrepare:Qr("precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}","uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Qr('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef LIGHTING_3D_MODE\nglFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);\n#endif\n#ifdef FOG\nglFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),line:Qr('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_shadow.fragment.glsl"\nuniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;\n#ifdef ELEVATED_ROADS\nin highp float v_road_z_offset;\n#endif\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;in vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;\n#endif\n#ifdef INDICATOR_CUTOUT\nin highp float v_z_offset;\n#endif\n#ifdef RENDER_SHADOWS\nuniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;\n#endif\nfloat luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float border_width\n#pragma mapbox: define lowp vec4 border_color\nfloat linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float border_width\n#pragma mapbox: initialize lowp vec4 border_color\nfloat dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);\n#endif\nhighp vec4 out_color;\n#ifdef RENDER_LINE_GRADIENT\nout_color=texture(u_gradient_image,v_uv.xy);\n#else\nout_color=color;\n#endif\nfloat trim_alpha=1.0;\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=1.0-transition_factor;}\n#endif\nif (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}\n#ifdef RENDER_LINE_BORDER\nfloat edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#ifdef RENDER_SHADOWS\nfloat light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#ifdef ELEVATED_ROADS\nout_color.rgb*=mix(v_road_z_offset > 0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);\n#else\nout_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);\n#endif\n#endif\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nout_color*=(alpha*opacity);\n#ifdef INDICATOR_CUTOUT\nout_color=applyCutout(out_color,v_z_offset);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#define EXTRUDE_SCALE 0.015873016\nin vec2 a_pos_normal;in vec4 a_data;\n#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)\nin vec3 a_z_offset_width;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nin highp vec3 a_packed;\n#endif\n#ifdef RENDER_LINE_DASH\nin float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;\n#ifdef ELEVATED\nuniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {\n#ifdef ELEVATION_REFERENCE_SEA\nreturn 0.0;\n#else\nreturn elevation(apos);\n#endif\n}\n#endif\nout vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;\n#ifdef ELEVATED_ROADS\nout highp float v_road_z_offset;\n#endif\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;\n#endif\n#ifdef INDICATOR_CUTOUT\nout highp float v_z_offset;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float border_width\n#pragma mapbox: define lowp vec4 border_color\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float border_width\n#pragma mapbox: initialize lowp vec4 border_color\nfloat a_z_offset;\n#if defined(ELEVATED) || defined(ELEVATED_ROADS)\na_z_offset=a_z_offset_width.x;\n#endif\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth;\n#ifdef VARIABLE_LINE_WIDTH\nfloat left=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);halfwidth=(u_width_scale*(left==1.0 ? a_z_offset_width.y : a_z_offset_width.z))/2.0;\n#else\nhalfwidth=(u_width_scale*width)/2.0;\n#endif\noffset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;\n#ifdef ELEVATED_ROADS\nv_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;\n#else\n#ifdef ELEVATED\nvec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;\n#ifdef CROSS_SLOPE_VERTICAL\nfloat top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);\n#else\n#ifdef CROSS_SLOPE_HORIZONTAL\nfloat ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;\n#else\nfloat ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;\n#endif\n#endif\ngl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);\n#else\ngl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);\n#endif\n#endif\n#ifdef ELEVATED_ROADS\n#ifdef RENDER_SHADOWS\nvec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;\n#ifdef NORMAL_OFFSET\nvec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;\n#endif\n#endif\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=max(length(projected_extrude_xy/gl_Position.w*u_units_to_pixels),0.001);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));\n#else\nv_gamma_scale=1.0;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nhighp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];\n#ifdef RENDER_LINE_GRADIENT\nhighp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);\n#else\nv_uv=vec3(a_uv_x,0.0,line_progress);\n#endif\n#endif\n#ifdef RENDER_LINE_DASH\nfloat scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n#ifdef INDICATOR_CUTOUT\nv_z_offset=a_z_offset;\n#endif\n}'),linePattern:Qr('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_shadow.fragment.glsl"\nuniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;\n#ifdef RENDER_LINE_TRIM_OFFSET\nin highp vec3 v_uv;\n#endif\n#ifdef ELEVATED_ROADS\nin highp float v_road_z_offset;\n#endif\n#ifdef LINE_JOIN_NONE\nin vec2 v_pattern_data;\n#endif\n#ifdef INDICATOR_CUTOUT\nin highp float v_z_offset;\n#endif\n#ifdef RENDER_SHADOWS\nuniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;\n#endif\nuniform float u_emissive_strength;\n#pragma mapbox: define mediump vec4 pattern\n#pragma mapbox: define mediump float pixel_ratio\n#pragma mapbox: define mediump float blur\n#pragma mapbox: define mediump float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize mediump float pixel_ratio\n#pragma mapbox: initialize mediump float blur\n#pragma mapbox: initialize mediump float opacity\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}\n#endif\n#ifdef LINE_JOIN_NONE\nhighp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}\n#endif\n#ifdef LIGHTING_3D_MODE\ncolor=apply_lighting_with_emission_ground(color,u_emissive_strength);\n#ifdef RENDER_SHADOWS\nfloat light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#ifdef ELEVATED_ROADS\ncolor.rgb*=mix(v_road_z_offset > 0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);\n#else\ncolor.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);\n#endif\n#endif\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ncolor*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}\n#ifdef INDICATOR_CUTOUT\ncolor=applyCutout(color,v_z_offset);\n#endif\nglFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#define scale 0.015873016\nin vec2 a_pos_normal;in vec4 a_data;\n#if defined(ELEVATED) || defined(ELEVATED_ROADS)\nin vec3 a_z_offset_width;\n#endif\n#ifdef RENDER_LINE_TRIM_OFFSET\nin highp vec3 a_packed;\n#endif\nin highp float a_linesofar;\n#ifdef LINE_JOIN_NONE\nin highp vec3 a_pattern_data;out vec2 v_pattern_data;\n#endif\n#ifdef INDICATOR_CUTOUT\nout highp float v_z_offset;\n#endif\nuniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;\n#ifdef ELEVATED\nuniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {\n#ifdef ELEVATION_REFERENCE_SEA\nreturn 0.0;\n#else\nreturn elevation(apos);\n#endif\n}\n#endif\nout vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;\n#ifdef RENDER_LINE_TRIM_OFFSET\nout highp vec3 v_uv;\n#endif\n#ifdef ELEVATED_ROADS\nout highp float v_road_z_offset;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;\n#endif\n#pragma mapbox: define mediump float blur\n#pragma mapbox: define mediump float opacity\n#pragma mapbox: define mediump float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define mediump float floorwidth\n#pragma mapbox: define mediump vec4 pattern\n#pragma mapbox: define mediump float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize mediump float blur\n#pragma mapbox: initialize mediump float opacity\n#pragma mapbox: initialize mediump float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize mediump float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize mediump float pixel_ratio\nfloat a_z_offset;\n#if defined(ELEVATED) || defined(ELEVATED_ROADS)\na_z_offset=a_z_offset_width.x;\n#endif\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;\n#ifdef ELEVATED_ROADS\nv_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;\n#else\n#ifdef ELEVATED\nvec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;\n#ifdef CROSS_SLOPE_VERTICAL\nfloat top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);\n#else\n#ifdef CROSS_SLOPE_HORIZONTAL\nfloat ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;\n#else\nfloat ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;\n#endif\n#endif\ngl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);\n#else\ngl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);\n#endif\n#endif\n#ifdef ELEVATED_ROADS\n#ifdef RENDER_SHADOWS\nvec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;\n#ifdef NORMAL_OFFSET\nvec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;\n#endif\n#endif\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));\n#else\nv_gamma_scale=1.0;\n#endif\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);\n#ifdef LINE_JOIN_NONE\nv_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n#ifdef INDICATOR_CUTOUT\nv_z_offset=a_z_offset;\n#endif\n}'),raster:Qr('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_raster_array.glsl"\nuniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;\n#ifdef PROJECTION_GLOBE_VIEW\nin float v_split_fade;\n#endif\nuniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;\n#ifndef RASTER_ARRAY\nuniform highp sampler2D u_image0;uniform sampler2D u_image1;\n#endif\n#ifdef RASTER_COLOR\nuniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;\n#endif\nvoid main() {vec4 color0,color1,color;vec2 value;\n#ifdef RASTER_COLOR\n#ifdef RASTER_ARRAY\n#ifdef RASTER_ARRAY_LINEAR\nvalue=mix(\nraTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t\n);\n#else\nvalue=mix(\nraTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t\n);\n#endif\nif (value.y > 0.0) value.x/=value.y;\n#else\ncolor=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);\n#endif\ncolor=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;\n#else\ncolor0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);\n#endif\ncolor.a*=u_opacity;\n#ifdef GLOBE_POLES\ncolor.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);\n#endif\nvec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;\n#endif\n#ifdef FOG\nhighp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));\n#endif\nglFragColor=vec4(out_color*color.a,color.a);\n#ifdef PROJECTION_GLOBE_VIEW\nglFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));\n#endif\n#ifdef RENDER_CUTOFF\nglFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;\n#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8\n#ifdef GLOBE_POLES\nin vec3 a_globe_pos;in vec2 a_uv;\n#else\nin vec2 a_pos;in vec2 a_texture_pos;\n#endif\nout vec2 v_pos0;out vec2 v_pos1;out float v_depth;\n#ifdef PROJECTION_GLOBE_VIEW\nout float v_split_fade;\n#endif\nvoid main() {vec2 uv;\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);\n#endif\n#else\nfloat w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    \nv_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n#else\ngl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n#endif\n#endif\nv_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;\n#ifdef RENDER_CUTOFF\nv_depth=gl_Position.z;\n#endif\n}'),rasterParticle:Qr('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;\n#endif\n#ifdef FOG\nhighp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));\n#endif\nglFragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;\n#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8\nin vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n#else\nuv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n#endif\nv_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}'),rasterParticleDraw:Qr("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",'#include "_prelude_raster_particle.glsl"\nin float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(\nmod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}'),rasterParticleTexture:Qr("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:Qr('#include "_prelude_raster_particle.glsl"\nuniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(\nlinearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)\n);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}',"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:Qr('#include "_prelude_lighting.glsl"\n#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;\n#ifdef ICON_TRANSITION\nuniform float u_icon_transition;\n#endif\n#ifdef COLOR_ADJUSTMENT\nuniform mat4 u_color_adj_mat;\n#endif\n#ifdef INDICATOR_CUTOUT\nin highp float v_z_offset;\n#endif\nin vec2 v_tex_a;\n#ifdef ICON_TRANSITION\nin vec2 v_tex_b;\n#endif\nin float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;\n#ifdef RENDER_TEXT_AND_SYMBOL\nin float is_sdf;in vec2 v_tex_a_icon;\n#endif\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nvec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];\n#ifdef RENDER_TEXT_AND_SYMBOL\nif (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nreturn;}\n#endif\n#ifdef RENDER_SDF\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;\n#else\n#ifdef ICON_TRANSITION\nvec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);\n#else\nout_color=texture(u_texture,v_tex_a);\n#endif\n#ifdef COLOR_ADJUSTMENT\nout_color=u_color_adj_mat*out_color;\n#endif\n#endif\nout_color*=opacity*fade_opacity;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,emissive_strength);\n#endif\n#ifdef INDICATOR_CUTOUT\nout_color=applyCutout(out_color,v_z_offset);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\nin vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;\n#ifdef Z_OFFSET\nin float a_auto_z_offset;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_globe_anchor;in vec3 a_globe_normal;\n#endif\n#ifdef ICON_TRANSITION\nin vec2 a_texb;\n#endif\n#ifdef OCCLUSION_QUERIES\nin float a_occlusion_query_opacity;\n#endif\n#ifdef INDICATOR_CUTOUT\nout highp float v_z_offset;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nout vec2 v_tex_a;\n#ifdef ICON_TRANSITION\nout vec2 v_tex_b;\n#endif\nout float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;\n#ifdef RENDER_TEXT_AND_SYMBOL\nout float is_sdf;out vec2 v_tex_a_icon;\n#endif\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\n#pragma mapbox: define lowp float occlusion_opacity\n#pragma mapbox: define lowp float z_offset\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\n#pragma mapbox: initialize lowp float occlusion_opacity\n#pragma mapbox: initialize lowp float z_offset\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);\n#ifdef Z_OFFSET\ne+=a_auto_z_offset;\n#endif\nvec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;\n#else\noffsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;\n#endif\nvec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\n#ifdef PROJECTED_POS_ON_VIEWPORT\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);\n#else\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    \n#endif\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\n#ifdef Z_OFFSET\nz+=u_pitch_with_map ? a_auto_z_offset+(u_elevation_from_sea ? z_offset : z_offset) : 0.0;\n#else\nz+=u_pitch_with_map ? (u_elevation_from_sea ? z_offset : z_offset) : 0.0;\n#endif\nfloat occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));\n#ifdef DEPTH_OCCLUSION\nfloat depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;\n#endif\n#ifdef OCCLUSION_QUERIES\nfloat occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;\n#endif\nfloat alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);\n#endif\nfloat gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;\n#ifdef RENDER_TEXT_AND_SYMBOL\nis_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;\n#endif\n#ifdef ICON_TRANSITION\nv_tex_b=a_texb/u_texsize;\n#endif\n#ifdef INDICATOR_CUTOUT\nv_z_offset=e;\n#endif\n}'),terrainRaster:Qr('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image0;in vec2 v_pos0;\n#ifdef FOG\nin float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nin vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;\n#endif\nuniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;\n#ifdef LIGHTING_3D_MODE\nconst vec3 normal=vec3(0.0,0.0,1.0);\n#ifdef RENDER_SHADOWS\nfloat cutoffOpacity=1.0;\n#ifdef RENDER_CUTOFF\ncutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);\n#endif\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\nvec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;\n#else\nfloat lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));\n#endif\n#else\nfloat lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\ncolor.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;\n#endif\n#endif\n#else\ncolor=image_color;\n#endif\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#else\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\n#endif\nglFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;\n#ifdef FOG\nout float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;\n#endif\nvoid main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\nv_fog_pos=fog_position(decodedPos);\n#else\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);\n#endif\n}'),terrainDepth:Qr("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",'#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}'),skybox:Qr('#include "_prelude_fog.fragment.glsl"\nin lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\n}',Cr),skyboxGradient:Qr('#include "_prelude_fog.fragment.glsl"\nin highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;glFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\n}',Cr),skyboxCapture:Qr("\nin highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}","in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Qr('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;\n#ifndef FOG\nuniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;\n#endif\nvoid main() {vec4 color;\n#ifdef CUSTOM_ANTIALIASING\nhighp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);\n#ifdef LIGHTING_3D_MODE\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\nraster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);\n#else\nraster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);\n#endif\n#else\ncolor=vec4(raster.rgb*antialias,raster.a*antialias);\n#endif\n#else\ncolor=texture(u_image0,v_pos0);\n#ifdef LIGHTING_3D_MODE\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\ncolor=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;\n#else\ncolor=apply_lighting_ground(color);\n#endif\n#endif\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ncolor*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;\n#ifdef GLOBE_POLES\nin vec3 a_globe_pos;in vec2 a_uv;\n#else\nin vec2 a_pos;\n#endif\nout vec2 v_pos0;void main() {\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;vec2 uv=a_uv;\n#else\nfloat tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);\n#endif\nv_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;\n#ifdef GLOBE_POLES\nvec3 up_vector=globe_derived_up_vector;\n#else\nvec3 up_vector=elevationVector(tile_pos);\n#endif\nfloat height=elevation(tile_pos);globe_pos+=up_vector*height;\n#ifndef GLOBE_POLES\nglobe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;\n#endif\n#ifdef GLOBE_POLES\nvec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);\n#else\nvec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);\n#endif\ngl_Position=u_proj_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n}'),globeAtmosphere:Qr('#include "_prelude_fog.fragment.glsl"\nuniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;\n#ifdef PROJECTION_GLOBE_VIEW\nglobe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {\n#ifdef ALPHA_PASS\nglFragColor=vec4(0,0,0,0);return;\n#else\n#ifdef NATIVE\nglFragColor=vec4(1,1,1,1);\n#else\nglFragColor=vec4(0,0,0,1);\n#endif\nreturn;\n#endif\n}\n#endif\nhighp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?\n0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;\n#ifdef PROJECTION_GLOBE_VIEW\nhighp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?\nPI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);\n#else\nhorizon_angle=horizon_angle_mercator;\n#endif\nhorizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;\n#ifdef ALPHA_PASS\nfloat a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);\n#else\nvec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);\n#endif\n}',"in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(\nmix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}"),model:Qr('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;\n#ifdef RENDER_SHADOWS\nin highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;\n#endif\n#ifdef OCCLUSION_TEXTURE_TRANSFORM\nuniform vec4 u_occlusionTextureTransform;\n#endif\n#pragma mapbox: define-attribute highp vec3 normal_3f\n#pragma mapbox: define-attribute highp vec3 color_3f\n#pragma mapbox: define-attribute highp vec4 color_4f\n#pragma mapbox: define-attribute highp vec2 uv_2f\n#pragma mapbox: initialize-attribute highp vec3 normal_3f\n#pragma mapbox: initialize-attribute highp vec3 color_3f\n#pragma mapbox: initialize-attribute highp vec4 color_4f\n#pragma mapbox: initialize-attribute highp vec2 uv_2f\n#ifdef HAS_ATTRIBUTE_a_pbr\nin lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;\n#endif\n#ifdef HAS_TEXTURE_u_baseColorTexture\nuniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;\n#endif\n#ifdef HAS_TEXTURE_u_metallicRoughnessTexture\nuniform sampler2D u_metallicRoughnessTexture;\n#endif\n#ifdef HAS_TEXTURE_u_occlusionTexture\nuniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;\n#endif\n#ifdef HAS_TEXTURE_u_normalTexture\nuniform sampler2D u_normalTexture;\n#endif\n#ifdef HAS_TEXTURE_u_emissionTexture\nuniform sampler2D u_emissionTexture;\n#endif\n#ifdef APPLY_LUT_ON_GPU\nuniform highp sampler3D u_lutTexture;\n#endif\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nin highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;\n#ifdef DEPTH_D24\nhighp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}\n#else\nhighp float unpack_depth_rgba(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}\n#endif\nbool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;\n#ifdef DEPTH_D24\nhighp float depth=unpack_depth(texture(u_depthTexture,coord).r);\n#else\nhighp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));\n#endif\nreturn v_depth > depth+0.0005;}\n#endif\n#define saturate(_x) clamp(_x,0.,1.)\nvec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)\n{\n#ifdef LIGHTING_3D_MODE\nvec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;\n#ifdef RENDER_SHADOWS\nlighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);\n#else\nlighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));\n#endif\nreturn apply_lighting(albedo,transformed_normal,lighting_factor);\n#else\nvec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;\n#endif\n}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;\n#ifdef HAS_ATTRIBUTE_a_color_3f\nalbedo*=vec4(color_3f,1.0);\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\n#else\n#ifdef HAS_ATTRIBUTE_a_color_4f\nalbedo*=color_4f;\n#endif\n#endif\n#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)\nvec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}\n#ifdef UNPREMULT_TEXTURE_IN_SHADER\nif(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;\n#endif\nif(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}\n#endif\nvec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);\n#ifdef APPLY_LUT_ON_GPU\ncolor=applyLUT(u_lutTexture,color);\n#endif\nreturn color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {\n#ifdef HAS_TEXTURE_u_normalTexture\nhighp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;\n#else\nreturn mat3(1.0);\n#endif\n}highp vec3 getNormal(){highp vec3 n;\n#ifdef HAS_ATTRIBUTE_a_normal_3f\nn=normalize(normal_3f);\n#else\nhighp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;\n#endif\n#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\nvec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);\n#endif\nreturn n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;\n#ifdef HAS_ATTRIBUTE_a_pbr\nmat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;\n#endif\n#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) \nvec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;\n#endif\nconst float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)\n{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)\n{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)\n{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)\n{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)\n{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)\n{\n#ifdef LIGHTING_3D_MODE\nreturn mat.diffuseColor;\n#else\nreturn mat.diffuseColor/PI;\n#endif\n}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)\n{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)\n{vec3 env_light=vec3(0.65,0.65,0.65);\n#ifdef LIGHTING_3D_MODE\nfloat ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;\n#endif\nvec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)\n{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;\n#ifdef RENDER_SHADOWS\nlighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);\n#else\nlighting_factor=NdotL;\n#endif\nvec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;\n#if !defined(LIGHTING_3D_MODE)\nconst vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);\n#endif\ncolor*=intensityFactor;return color;}void main() {\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nif (isOccluded()) {discard;}\n#endif\nvec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;\n#ifdef LIGHTING_3D_MODE\nlightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;\n#endif\nvec4 finalColor;\n#ifdef DIFFUSE_SHADED\nvec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);\n#ifdef HAS_TEXTURE_u_occlusionTexture\nfloat ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;\n#endif\nfinalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;\n#else\nMaterial mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;\n#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\n#ifdef OCCLUSION_TEXTURE_TRANSFORM\nvec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;\n#else\nvec2 uv=uv_2f;\n#endif\nao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;\n#endif\nvec4 emissive=u_emissiveFactor;\n#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\nemissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);\n#endif\n#ifdef APPLY_LUT_ON_GPU\nfloat emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;\n#endif\ncolor+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;\n#ifdef HAS_ATTRIBUTE_a_pbr\nfloat resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;\n#ifdef APPLY_LUT_ON_GPU\ncolor_mix=applyLUT(u_lutTexture,color_mix);\n#endif\ncolor=mix(color,color_mix,min(1.0,resEmission));\n#ifdef HAS_ATTRIBUTE_a_color_4f\nfloat distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);\n#endif\n#endif\nvec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);\n#endif\n#ifdef FOG\nfinalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));\n#endif\n#ifdef RENDER_CUTOFF\nfinalColor*=v_cutoff_opacity;\n#endif\n#ifdef INDICATOR_CUTOUT\nfinalColor=applyCutout(finalColor,v_position_height.w);\n#endif\nglFragColor=finalColor;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nin vec3 a_pos_3f;\n#pragma mapbox: define-attribute highp vec3 normal_3f\n#pragma mapbox: define-attribute highp vec2 uv_2f\n#pragma mapbox: define-attribute highp vec3 color_3f\n#pragma mapbox: define-attribute highp vec4 color_4f\n#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr\n#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength\nuniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;\n#ifdef INSTANCED_ARRAYS\nin vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;\n#else\nuniform highp mat4 u_normal_matrix;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;\n#endif\nout vec4 v_position_height;out lowp vec4 v_color_mix;\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nout highp float v_depth;\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\nout lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;\n#endif\nvec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {\n#pragma mapbox: initialize-attribute highp vec3 normal_3f\n#pragma mapbox: initialize-attribute highp vec2 uv_2f\n#pragma mapbox: initialize-attribute highp vec3 color_3f\n#pragma mapbox: initialize-attribute highp vec4 color_4f\n#pragma mapbox: initialize-attribute-custom highp vec4 pbr\n#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength\nhighp mat4 normal_matrix;\n#ifdef INSTANCED_ARRAYS\nnormal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);\n#else\nnormal_matrix=u_normal_matrix;\n#endif\nvec3 local_pos;mat3 rs;\n#ifdef MODEL_POSITION_ON_GPU\nvec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;\n#else\nlocal_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);\n#endif\nv_position_height.w=a_pos_3f.z;\n#ifdef HAS_ATTRIBUTE_a_pbr\nvec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(local_pos);\n#endif\n#ifdef RENDER_CUTOFF\nv_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);\n#endif\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nv_depth=gl_Position.z/gl_Position.w;\n#endif\n#ifdef HAS_ATTRIBUTE_a_normal_3f\n#ifdef MODEL_POSITION_ON_GPU\nfloat x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);\n#else\nnormal_3f=vec3(normal_matrix*vec4(normal_3f,0));\n#endif\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\n#ifdef HAS_ATTRIBUTE_a_color_4f\nv_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);\n#ifdef NORMAL_OFFSET\n#ifdef HAS_ATTRIBUTE_a_normal_3f\n#ifdef MODEL_POSITION_ON_GPU\nvec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();\n#else\nvec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();\n#endif\n#endif\n#endif\nv_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;\n#endif\n}'),modelDepth:Qr("in highp float v_depth;void main() {\n#ifndef DEPTH_TEXTURE\nglFragColor=pack_depth(v_depth);\n#endif\n}","in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;\n#ifdef MODEL_POSITION_ON_GPU\n#ifdef INSTANCED_ARRAYS\nin vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;\n#else\nuniform highp mat4 u_instance;\n#endif\nuniform highp mat4 u_node_matrix;\n#endif\nvoid main() {\n#ifdef MODEL_POSITION_ON_GPU\nhighp mat4 instance;\n#ifdef INSTANCED_ARRAYS\ninstance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);\n#else\ninstance=u_instance;\n#endif\nvec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);\n#else\ngl_Position=u_matrix*vec4(a_pos_3f,1);\n#endif\nv_depth=gl_Position.z/gl_Position.w;}"),stars:Qr("in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)\n{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}","\nin vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}"),snowParticle:Qr("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}","\nin highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; \nuniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; \nuniform float u_horizontalOscillationRate; \nuniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+\nlocalY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}"),rainParticle:Qr("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}","\nin highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; \nuniform float u_velocity; \nuniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; \npos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+\nlocalY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}"),vignette:Qr("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:Qr("uniform vec4 u_color;void main() {glFragColor=u_color;}",'#include "_prelude_terrain.vertex.glsl"\nin highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;\n#ifdef TERRAIN\nfloat e=elevation(world_pos.xy);world_pos.z+=e;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}')};function Nr(e,t){const i=e.replace(/\s*\/\/[^\n]*\n/g,"\n").split("\n");for(let e of i)if(e=e.trim(),"#"===e[0]&&e.includes("if")&&!e.includes("endif")){e=e.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const i=e.split(" ");for(const e of i)t.includes(e)||t.push(e)}}function Qr(e,t){const i=/#include\s+"([^"]+)"/g,r=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let n=t.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);n&&(n=n.map((e=>{const t=e.split(" ");return t[t.length-1]})),n=[...new Set(n)]);const o={},s=[],a=[];if(e=e.replace(i,((e,t)=>(a.push(t),""))),(t=t.replace(i,((e,t)=>(s.push(t),"")))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let l=[...kr];Nr(e,l),Nr(t,l);for(const e of[...s,...a])zr[e]||console.error(`Undefined include: ${e}`),Rr[e]||(Rr[e]=[],Nr(zr[e],Rr[e])),l=[...l,...Rr[e]];return{fragmentSource:e=e.replace(r,((e,t,i,r,n)=>(o[n]=!0,"define"===t?`\n#ifndef HAS_UNIFORM_u_${n}\nin ${i} ${r} ${n};\n#else\nuniform ${i} ${r} u_${n};\n#endif\n`:"initialize"===t?`\n#ifdef HAS_UNIFORM_u_${n}\n    ${i} ${r} ${n} = u_${n};\n#endif\n`:"define-attribute"===t?`\n#ifdef HAS_ATTRIBUTE_a_${n}\n    in ${i} ${r} ${n};\n#endif\n`:"initialize-attribute"===t?"":void 0))),vertexSource:t=t.replace(r,((e,t,i,r,n)=>{const s="float"===r?"vec2":r,a=n.match(/color/)?"color":s;return"define-attribute-vertex-shader-only"===t?`\n#ifdef HAS_ATTRIBUTE_a_${n}\nin ${i} ${r} a_${n};\n#endif\n`:o[n]?"define"===t?`\n#ifndef HAS_UNIFORM_u_${n}\nuniform lowp float u_${n}_t;\nin ${i} ${s} a_${n};\nout ${i} ${r} ${n};\n#else\nuniform ${i} ${r} u_${n};\n#endif\n`:"initialize"===t?"vec4"===a?`\n#ifndef HAS_UNIFORM_u_${n}\n    ${n} = a_${n};\n#else\n    ${i} ${r} ${n} = u_${n};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${n}\n    ${n} = unpack_mix_${a}(a_${n}, u_${n}_t);\n#else\n    ${i} ${r} ${n} = u_${n};\n#endif\n`:"define-attribute"===t?`\n#ifdef HAS_ATTRIBUTE_a_${n}\n    in ${i} ${r} a_${n};\n    out ${i} ${r} ${n};\n#endif\n`:"initialize-attribute"===t?`\n#ifdef HAS_ATTRIBUTE_a_${n}\n    ${n} = a_${n};\n#endif\n`:void 0:"define"===t?`\n#ifndef HAS_UNIFORM_u_${n}\nuniform lowp float u_${n}_t;\nin ${i} ${s} a_${n};\n#else\nuniform ${i} ${r} u_${n};\n#endif\n`:"define-instanced"===t?"mat4"===a?`\n#ifdef INSTANCED_ARRAYS\nin vec4 a_${n}0;\nin vec4 a_${n}1;\nin vec4 a_${n}2;\nin vec4 a_${n}3;\n#else\nuniform ${i} ${r} u_${n};\n#endif\n`:`\n#ifdef INSTANCED_ARRAYS\nin ${i} ${s} a_${n};\n#else\nuniform ${i} ${r} u_${n};\n#endif\n`:"initialize-attribute-custom"===t?`\n#ifdef HAS_ATTRIBUTE_a_${n}\n    ${i} ${r} ${n} = a_${n};\n#endif\n`:"vec4"===a?`\n#ifndef HAS_UNIFORM_u_${n}\n    ${i} ${r} ${n} = a_${n};\n#else\n    ${i} ${r} ${n} = u_${n};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${n}\n    ${i} ${r} ${n} = unpack_mix_${a}(a_${n}, u_${n}_t);\n#else\n    ${i} ${r} ${n} = u_${n};\n#endif\n`})),staticAttributes:n,usedDefines:l,vertexIncludes:s,fragmentIncludes:a}}class jr{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(e,t,i,r,n,o,s,a){this.context=e;let l=this.boundPaintVertexBuffers.length!==r.length;for(let e=0;!l&&e<r.length;e++)this.boundPaintVertexBuffers[e]!==r[e]&&(l=!0);let c=this.boundDynamicVertexBuffers.length!==s.length;for(let e=0;!c&&e<s.length;e++)this.boundDynamicVertexBuffers[e]!==s[e]&&(c=!0);if(!this.vao||this.boundProgram!==t||this.boundLayoutVertexBuffer!==i||l||c||this.boundIndexBuffer!==n||this.boundVertexOffset!==o)this.freshBind(t,i,r,n,o,s,a);else{e.bindVertexArrayOES.set(this.vao);for(const i of s)i&&(i.bind(),a&&i.instanceCount&&i.setVertexAttribDivisor(e.gl,t,a));n&&n.dynamicDraw&&n.bind()}}freshBind(e,t,i,r,n,o,s){const a=e.numAttributes,l=this.context,c=l.gl;this.vao&&this.destroy(),this.vao=l.gl.createVertexArray(),l.bindVertexArrayOES.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=t,this.boundPaintVertexBuffers=i,this.boundIndexBuffer=r,this.boundVertexOffset=n,this.boundDynamicVertexBuffers=o,t.enableAttributes(c,e),t.bind(),t.setVertexAttribPointers(c,e,n);for(const t of i)t.enableAttributes(c,e),t.bind(),t.setVertexAttribPointers(c,e,n);for(const t of o)t&&(t.enableAttributes(c,e),t.bind(),t.setVertexAttribPointers(c,e,n),s&&t.instanceCount&&t.setVertexAttribDivisor(c,e,s));r&&r.bind(),l.currentNumAttributes=a}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function Vr(t,i){const r=Math.pow(2,i.canonical.z),n=i.canonical.y;return[new e.ac(0,n/r).toLngLat().lat,new e.ac(0,(n+1)/r).toLngLat().lat]}function Hr(t,i,r,n,o,s,a){const l=t.context,c=l.gl,u=r.hillshadeFBO;if(!u)return;t.prepareDrawTile();const h=t.isTileAffectedByFog(i),d=t.getOrCreateProgram("hillshade",{overrideFog:h});l.activeTexture.set(c.TEXTURE0),c.bindTexture(c.TEXTURE_2D,u.colorAttachment.get());const p=((t,i,r,n)=>{const o=r.paint.get("hillshade-shadow-color"),s="none"===r.paint.get("hillshade-shadow-color-use-theme").constantOr("default"),a=r.paint.get("hillshade-highlight-color"),l="none"===r.paint.get("hillshade-highlight-color-use-theme").constantOr("default"),c=r.paint.get("hillshade-accent-color"),u="none"===r.paint.get("hillshade-accent-color-use-theme").constantOr("default"),h=r.paint.get("hillshade-emissive-strength");let d=e.ak(r.paint.get("hillshade-illumination-direction"));if("viewport"===r.paint.get("hillshade-illumination-anchor"))d-=t.transform.angle;else if(t.style&&t.style.enable3dLights()&&t.style.directionalLight){const i=t.style.directionalLight.properties.get("direction"),r=e.cc(i.x,i.y,i.z);d=e.ak(r[1])}const p=!t.options.moving;return{u_matrix:n||t.transform.calculateProjMatrix(i.tileID.toUnwrapped(),p),u_image:0,u_latrange:Vr(0,i.tileID),u_light:[r.paint.get("hillshade-exaggeration"),d],u_shadow:o.toRenderColor(s?null:r.lut),u_highlight:a.toRenderColor(l?null:r.lut),u_emissive_strength:h,u_accent:c.toRenderColor(u?null:r.lut)}})(t,r,n,t.terrain?i.projMatrix:null);t.uploadCommonUniforms(l,d,i.toUnwrapped());const{tileBoundsBuffer:f,tileBoundsIndexBuffer:A,tileBoundsSegments:m}=t.getTileBoundsBuffers(r);d.draw(t,c.TRIANGLES,o,s,a,Vi.disabled,p,n.id,f,A,m)}function Gr(t,i,r){if(!i.needsDEMTextureUpload)return;const n=t.context,o=n.gl;n.pixelStoreUnpackPremultiplyAlpha.set(!1),i.demTexture=i.demTexture||t.getTileTexture(r.stride);const s=r.getPixels();i.demTexture?i.demTexture.update(s,{premultiply:!1}):i.demTexture=new e.T(n,s,o.R32F,{premultiply:!1}),i.needsDEMTextureUpload=!1}function $r(t,i,r){const n=t.context,o=n.gl;if(!i.dem)return;const s=i.dem;if(n.activeTexture.set(o.TEXTURE1),Gr(t,i,s),!i.demTexture)return;i.demTexture.bind(o.NEAREST,o.CLAMP_TO_EDGE);const a=s.dim;n.activeTexture.set(o.TEXTURE0);let l=i.hillshadeFBO;if(!l){const t=new e.T(n,{width:a,height:a,data:null},o.RGBA8);t.bind(o.LINEAR,o.CLAMP_TO_EDGE),l=i.hillshadeFBO=n.createFramebuffer(a,a,!0,"renderbuffer"),l.colorAttachment.set(t.texture)}n.bindFramebuffer.set(l.framebuffer),n.viewport.set([0,0,a,a]);const{tileBoundsBuffer:c,tileBoundsIndexBuffer:u,tileBoundsSegments:h}=t.getMercatorTileBoundsBuffers(),d=[];t.linearFloatFilteringSupported()&&d.push("TERRAIN_DEM_FLOAT_FORMAT"),t.getOrCreateProgram("hillshadePrepare",{defines:d}).draw(t,o.TRIANGLES,Oi.disabled,Ni.disabled,Di.unblended,Vi.disabled,((t,i)=>{const r=i.stride,n=e.ad.mat4.create();return e.ad.mat4.ortho(n,0,e.ai,-e.ai,0,0,1),e.ad.mat4.translate(n,n,[0,-e.ai,0]),{u_matrix:n,u_image:1,u_dimension:[r,r],u_zoom:t.overscaledZ}})(i.tileID,s),r.id,c,u,h),i.needsHillshadePrepare=!1}class Zr{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class qr extends Zr{getDefault(){return e.al.transparent}set(e){const t=this.current;(e.r!==t.r||e.g!==t.g||e.b!==t.b||e.a!==t.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class Kr extends Zr{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class Wr extends Zr{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class Xr extends Zr{getDefault(){return[!0,!0,!0,!0]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||e[3]!==t[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class Yr extends Zr{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class Jr extends Zr{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class en extends Zr{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){const t=this.current;(e.func!==t.func||e.ref!==t.ref||e.mask!==t.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class tn extends Zr{getDefault(){const e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class rn extends Zr{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;e?t.enable(t.STENCIL_TEST):t.disable(t.STENCIL_TEST),this.current=e,this.dirty=!1}}class nn extends Zr{getDefault(){return[0,1]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class on extends Zr{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;e?t.enable(t.DEPTH_TEST):t.disable(t.DEPTH_TEST),this.current=e,this.dirty=!1}}class sn extends Zr{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class an extends Zr{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;e?t.enable(t.BLEND):t.disable(t.BLEND),this.current=e,this.dirty=!1}}class ln extends Zr{getDefault(){const e=this.gl;return[e.ONE,e.ZERO,e.ONE,e.ZERO]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||e[3]!==t[3]||this.dirty)&&(this.gl.blendFuncSeparate(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class cn extends Zr{getDefault(){return e.al.transparent}set(e){const t=this.current;(e.r!==t.r||e.g!==t.g||e.b!==t.b||e.a!==t.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class un extends Zr{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(e,e),this.current=e,this.dirty=!1)}}class hn extends Zr{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;e?t.enable(t.CULL_FACE):t.disable(t.CULL_FACE),this.current=e,this.dirty=!1}}class dn extends Zr{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class pn extends Zr{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}let fn=class extends Zr{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}};class An extends Zr{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class mn extends Zr{getDefault(){const e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||e[3]!==t[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class gn extends Zr{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.bindFramebuffer(t.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class _n extends Zr{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.bindRenderbuffer(t.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class yn extends Zr{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.bindTexture(t.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class vn extends Zr{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.bindBuffer(t.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class xn extends Zr{getDefault(){return null}set(e){const t=this.gl;t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class bn extends Zr{getDefault(){return null}set(e){this.gl&&(e!==this.current||this.dirty)&&(this.gl.bindVertexArray(e),this.current=e,this.dirty=!1)}}class wn extends Zr{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.pixelStorei(t.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class Tn extends Zr{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class Bn extends Zr{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class Cn extends Zr{constructor(e,t){super(e),this.context=e,this.parent=t}getDefault(){return null}}class Sn extends Cn{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const t=this.gl;t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class En extends Cn{attachment(){return this.gl.DEPTH_ATTACHMENT}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const t=this.gl;t.framebufferRenderbuffer(t.FRAMEBUFFER,this.attachment(),t.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class Mn extends Cn{attachment(){return this.gl.DEPTH_ATTACHMENT}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const t=this.gl;t.framebufferTexture2D(t.FRAMEBUFFER,this.attachment(),t.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class In extends En{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const Pn=(e,t,i)=>({u_matrix:e,u_image0:0,u_skirt_height:t,u_ground_shadow_factor:i}),Ln=(e,t,i,r,n,o,s,a,l,c,u,h,d,p,f,A)=>({u_proj_matrix:Float32Array.from(e),u_globe_matrix:t,u_normalize_matrix:Float32Array.from(r),u_merc_matrix:i,u_zoom_transition:n,u_merc_center:o,u_image0:0,u_frustum_tl:s,u_frustum_tr:a,u_frustum_br:l,u_frustum_bl:c,u_globe_pos:u,u_globe_radius:h,u_viewport:d,u_grid_matrix:A?Float32Array.from(A):new Float32Array(9),u_skirt_height:p,u_far_z_cutoff:f});function Fn(e,t){return null!=e&&null!=t&&!(!e.hasData()||!t.hasData())&&null!=e.demTexture&&null!=t.demTexture&&e.tileID.key!==t.tileID.key}const kn=new class{constructor(){this.operations={}}newMorphing(e,t,i,r,n){if(e in this.operations){const t=this.operations[e];t.to.tileID.key!==i.tileID.key&&(t.queued=i)}else this.operations[e]={startTime:r,phase:0,duration:n,from:t,to:i,queued:null}}getMorphValuesForProxy(e){if(!(e in this.operations))return null;const t=this.operations[e];return{from:t.from,to:t.to,phase:t.phase}}update(e){for(const t in this.operations){const i=this.operations[t];for(i.phase=(e-i.startTime)/i.duration;i.phase>=1||!this._validOp(i);)if(!this._nextOp(i,e)){delete this.operations[t];break}}}_nextOp(e,t){return!!e.queued&&(e.from=e.to,e.to=e.queued,e.queued=null,e.phase=0,e.startTime=t,!0)}_validOp(e){return e.from.hasData()&&e.to.hasData()}},zn={0:null,1:"TERRAIN_VERTEX_MORPHING"};function Rn(e,t,i){if(0===t)return 0;const r=t<1&&514===i?.25/t:1;return 6*Math.pow(1.5,22-e)*Math.max(t,1)*r}function Dn(e,t){const i=1<<e.z;return!t&&(0===e.x||e.x===i-1)||0===e.y||e.y===i-1}const On=e=>({u_matrix:e});function Un(t,i,r,n,o){if(o>0){const s=e.q.now(),a=(s-t.timeAdded)/o,l=i?(s-i.timeAdded)/o:-1,c=r.getSource(),u=n.coveringZoomLevel({tileSize:c.tileSize,roundZoom:c.roundZoom}),h=!i||Math.abs(i.tileID.overscaledZ-u)>Math.abs(t.tileID.overscaledZ-u),d=h&&t.refreshedUponExpiration?1:e.ay(h?a:1-l,0,1);return t.refreshedUponExpiration&&a>=1&&(t.refreshedUponExpiration=!1),i?{opacity:1,mix:1-d}:{opacity:d,mix:0}}return{opacity:1,mix:0}}class Nn extends Bt{constructor(t){const i={type:"raster-dem",maxzoom:t.transform.maxZoom},r=new e.D(e.cj(),null),n=ot("mock-dem",i,r,t.style);super("mock-dem",n,!1),n.setEventedParent(this),this._sourceLoaded=!0}_loadTile(e,t){e.state="loaded",t(null)}}class Qn extends Bt{constructor(t){const i=ot("proxy",{type:"geojson",maxzoom:t.transform.maxZoom},new e.D(e.cj(),null),t.style);super("proxy",i,!1),i.setEventedParent(this),this.map=this.getSource().map=t,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(e,t,i){if(e.freezeTileCoverage)return;this.transform=e;const r=e.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce(((t,i)=>{if(t[i.key]="",!this._tiles[i.key]){const t=new xt(i,this._source.tileSize*i.overscaleFactor(),e.tileZoom);t.state="loaded",this._tiles[i.key]=t}return t}),{});for(const e in this._tiles)e in r||(this.freeFBO(e),this._tiles[e].unloadVectorData(),delete this._tiles[e])}freeFBO(e){const t=this.proxyCachedFBO[e];if(void 0!==t){const i=Object.values(t);this.renderCachePool.push(...i),delete this.proxyCachedFBO[e]}}deallocRenderCache(){this.renderCache.forEach((e=>e.fb.destroy())),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class jn extends e.aH{constructor(e,t,i){super(e.overscaledZ,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y),this.proxyTileKey=t,this.projMatrix=i}}class Vn extends e.cK{constructor(t,i){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},t.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},(()=>{this._style.map.triggerRepaint()})),t.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},(()=>{this._style.map.triggerRepaint()})),t.tp.registerButton(["Terrain"],"Invalidate Render Cache",(()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()})),this.painter=t,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[r,n,o]=function(){const t=new e.b5,i=new e.aV,r=131;t.reserve(17161),i.reserve(33800);const n=e.ai/128,o=e.ai+n/2,s=o+n;for(let i=-n;i<s;i+=n)for(let r=-n;r<s;r+=n){const n=r<0||r>o||i<0||i>o?24575:0,s=e.ay(Math.round(r),0,e.ai),a=e.ay(Math.round(i),0,e.ai);t.emplaceBack(s+n,a)}const a=(e,t)=>{const n=t*r+e;i.emplaceBack(n+1,n,n+r),i.emplaceBack(n+r,n+r+1,n+1)};for(let e=1;e<129;e++)for(let t=1;t<129;t++)a(t,e);return[0,129].forEach((e=>{for(let t=0;t<130;t++)a(t,e),a(e,t)})),[t,i,32768]}(),s=t.context;this.gridBuffer=s.createVertexBuffer(r,e.b7.members),this.gridIndexBuffer=s.createIndexBuffer(n),this.gridSegments=e.b8.simpleSegment(0,0,r.length,n.length),this.gridNoSkirtSegments=e.b8.simpleSegment(0,0,r.length,o),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Qn(i.map),this.orthoMatrix=e.ad.mat4.create(),e.ad.mat4.ortho(this.orthoMatrix,"globe"===this.painter.transform.projection.name?.015:0,e.ai,0,e.ai,0,1);const a=s.gl;this._overlapStencilMode=new Ni({func:a.GEQUAL,mask:255},0,255,a.KEEP,a.KEEP,a.REPLACE),this._previousZoom=t.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=i,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Nn(i.map),this._pendingGroundEffectLayers=[]}set style(e){e.on("data",this._onStyleDataEvent.bind(this)),this._style=e,this._style.map.on("moveend",(()=>{this._clearLineLayersFromRenderCache()}))}update(t,i,r){if(t&&t.terrain){this._style!==t&&(this.style=t,this._evaluationZoom=void 0);const n=t.terrain.properties,o=0===t.terrain.drapeRenderMode,s=t.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=e.q.now();const a=t.terrain&&t.terrain.scope,l=n.get("source"),c=o?this._mockSourceCache:t.getSourceCache(l,a);if(!c)return void e.w(`Couldn't find terrain source "${l}".`);if(this.sourceCache=c,this._attenuationRange=t.terrain.getAttenuationRange(),this._exaggeration=s?this.calculateExaggeration(i):n.get("exaggeration"),!i.projection.requiresDraping&&s&&0===this._exaggeration)return void this._disable();this.enabled=!0;const u=()=>{this.sourceCache.used&&e.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const t=this.getScaledDemTileSize();this.sourceCache.update(i,t,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,u(),this._initializing=!0),u(),i.updateElevation(!0,r),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(i),this._emptyDEMTextureDirty=!0,this._previousZoom=i.zoom}else this._disable()}calculateExaggeration(t){if(this._attenuationRange&&t.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(t.zoom);const i=this._previousCameraAltitude,r=t.getFreeCameraOptions().position.z/t.pixelsPerMeter*t.worldSize;this._previousCameraAltitude=r;const n=null!=i?r-i:Number.MAX_VALUE;if(Math.abs(n)<2)return this._exaggeration;const o=t.zoom,s=this._style.terrain;if(!this._previousUpdateTimestamp)return s.getExaggeration(o);let a=o-this._previousZoom;const l=this._previousUpdateTimestamp;let c=o;null!=this._evaluationZoom&&(c=this._evaluationZoom,Math.abs(o-c)>.5&&(a=.5*(o-c+a)),a*n<0&&(c+=a)),this._evaluationZoom=c;const u=s.getExaggeration(c),h=u===s.getExaggeration(Math.max(0,c-.1));if(h&&Math.abs(u-this._exaggeration)<.01)return u;let d=Math.min(.1,.00375*(this._updateTimestamp-l));return(h||u<.1||Math.abs(a)<1e-4)&&(d=Math.min(.2,4*d)),e.ah(this._exaggeration,u,d)}resetTileLookupCache(e){this._findCoveringTileCache[e]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(e){e.coord&&"source"===e.dataType?this._clearRenderCacheForTile(e.sourceCacheId,e.coord):"style"===e.dataType&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const e in this._style._mergedSourceCaches)this._style._mergedSourceCaches[e].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach((e=>e.fb.destroy())),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const e=2*this.proxySourceCache.getSource().tileSize;return[e,e]}set useVertexMorphing(e){this._useVertexMorphing=e}updateTileBinding(t){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const i=this.proxySourceCache,r=this.painter.transform;this._initializing&&(this._initializing=0===r._centerAltitude&&-1===this.getAtPointOrZero(e.ac.fromLngLat(r.center),-1),this._emptyDEMTextureDirty=!this._initializing);const n=this.proxyCoords=i.getIds().map((e=>{const t=i.getTileByID(e).tileID;return t.projMatrix=r.calculateProjMatrix(t.toUnwrapped()),t}));!function(t,i){const r=i.transform.pointCoordinate(i.transform.getCameraPoint()),n=new e.P(r.x,r.y);t.sort(((t,i)=>{if(i.overscaledZ-t.overscaledZ)return i.overscaledZ-t.overscaledZ;const r=new e.P(t.canonical.x+(1<<t.canonical.z)*t.wrap,t.canonical.y),o=new e.P(i.canonical.x+(1<<i.canonical.z)*i.wrap,i.canonical.y),s=n.mult(1<<t.canonical.z);return s.x-=.5,s.y-=.5,s.distSqr(r)-s.distSqr(o)}))}(n,this.painter);const o=this.proxyToSource||{};this.proxyToSource={},n.forEach((e=>{this.proxyToSource[e.key]={}})),this.terrainTileForTile={};const s=this._style._mergedSourceCaches;for(const e in s){const i=s[e];if(!i.used)continue;if(i!==this.sourceCache&&this.resetTileLookupCache(i.id),this._setupProxiedCoordsForOrtho(i,t[e],o),i.usedForTerrain)continue;const r=t[e];i.getSource().reparseOverscaled&&this._assignTerrainTiles(r)}this.proxiedCoords[i.id]=n.map((e=>new jn(e,e.key,this.orthoMatrix))),this._assignTerrainTiles(n),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(o),this.renderingToTexture=!1;const a={};this._visibleDemTiles=[];for(const e of this.proxyCoords){const t=this.terrainTileForTile[e.key];if(!t)continue;const i=t.tileID.key;i in a||(this._visibleDemTiles.push(t),a[i]=i)}}_assignTerrainTiles(e){this._initializing||e.forEach((e=>{if(this.terrainTileForTile[e.key])return;const t=this._findTileCoveringTileID(e,this.sourceCache);t&&(this.terrainTileForTile[e.key]=t)}))}_prepareDEMTextures(){const e=this.painter.context,t=e.gl;for(const i in this.terrainTileForTile){const r=this.terrainTileForTile[i],n=r.dem;!n||r.demTexture&&!r.needsDEMTextureUpload||(e.activeTexture.set(t.TEXTURE1),Gr(this.painter,r,n))}}_prepareDemTileUniforms(e,t,i,r){if(!t||null==t.demTexture)return!1;const n=e.tileID.canonical,o=Math.pow(2,t.tileID.canonical.z-n.z),s=r||"";return i[`u_dem_tl${s}`]=[n.x*o%1,n.y*o%1],i[`u_dem_scale${s}`]=o,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let e=0;const t=this._visibleDemTiles.reduce(((t,i)=>{if(!i.dem)return t;const r=i.dem.tree.minimums[0];return r>0&&e++,t+r}),0);return e?t/e:0}_updateEmptyDEMTexture(){const t=this.painter.context,i=t.gl;t.activeTexture.set(i.TEXTURE2);const r=this._getLoadedAreaMinimum(),n=new e.cL({width:1,height:1},new Float32Array([r]));this._emptyDEMTextureDirty=!1;let o=this._emptyDEMTexture;return o?o.update(n,{premultiply:!1}):o=this._emptyDEMTexture=new e.T(t,n,i.R32F,{premultiply:!1}),o}setupElevationDraw(t,i,r){const n=this.painter.context,o=n.gl,s={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};s.u_exaggeration=this.exaggeration();let a=null,l=null,c=1;if(r&&r.morphing&&this._useVertexMorphing){const e=r.morphing.srcDemTile,i=r.morphing.dstDemTile;c=r.morphing.phase,e&&i&&(this._prepareDemTileUniforms(t,e,s,"_prev")&&(l=e),this._prepareDemTileUniforms(t,i,s)&&(a=i))}const u=e=>e&&e.demTexture&&this.painter.linearFloatFilteringSupported()?o.LINEAR:o.NEAREST;let h=null;var d;if(this.enabled?l&&a?(h=a.demTexture,n.activeTexture.set(o.TEXTURE4),l.demTexture.bind(u(l),o.CLAMP_TO_EDGE),s.u_dem_lerp=c):(a=this.terrainTileForTile[t.tileID.key],h=this._prepareDemTileUniforms(t,a,s)?a.demTexture:this.emptyDEMTexture):h=this.emptyDEMTexture,n.activeTexture.set(o.TEXTURE2),h&&(s.u_dem_size=1===(d=h).size[0]?1:d.size[0]-2,h.bind(u(a),o.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(r&&r.useDepthForOcclusion,i,s),r&&r.useMeterToDem&&a){const t=(1<<a.tileID.canonical.z)*e.bH(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;s.u_meter_to_dem=t}if(r&&r.labelPlaneMatrixInv&&(s.u_label_plane_matrix_inv=r.labelPlaneMatrixInv),i.setTerrainUniformValues(n,s),"globe"===this.painter.transform.projection.name){const e=this.globeUniformValues(this.painter.transform,t.tileID.canonical,r&&r.useDenormalizedUpVectorScale);i.setGlobeUniformValues(n,e)}}globeUniformValues(t,i,r){const n=t.projection;return{u_tile_tl_up:n.upVector(i,0,0),u_tile_tr_up:n.upVector(i,e.ai,0),u_tile_br_up:n.upVector(i,e.ai,e.ai),u_tile_bl_up:n.upVector(i,0,e.ai),u_tile_up_scale:r?e.cM(1):n.upVectorScale(i,t.center.lat,t.worldSize).metersToTile}}renderToBackBuffer(t){const i=this.painter,r=this.painter.context;0!==t.length&&(r.bindFramebuffer.set(null),r.viewport.set([0,0,i.width,i.height]),i.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(t,i,r,n,o){if("globe"===t.transform.projection.name)!function(t,i,r,n,o){const s=t.context,a=s.gl;let l,c;const u=t.transform,h=e.cD(t,s,u),d=(e,i)=>{if(c===i)return;const r=[zn[i],"PROJECTION_GLOBE_VIEW"];h&&r.push("CUSTOM_ANTIALIASING");const n=t.isTileAffectedByFog(e);l=t.getOrCreateProgram("globeRaster",{defines:r,overrideFog:n}),c=i},p=t.colorModeForRenderPass(),f=new Oi(a.LEQUAL,Oi.ReadWrite,t.depthRangeFor3D);kn.update(o);const A=e.cE(u),m=[e.av(u.center.lng),e.aC(u.center.lat)],g=t.globeSharedBuffers,_=[u.width*e.q.devicePixelRatio,u.height*e.q.devicePixelRatio],y=Float32Array.from(u.globeMatrix),v={useDenormalizedUpVectorScale:!0};{const u=t.transform,h=Rn(u.zoom,i.exaggeration(),i.sourceCache._source.tileSize);c=-1;const x=a.TRIANGLES;for(const c of n){const n=r.getTile(c),b=Ni.disabled,w=i.prevTerrainTileForTile[c.key],T=i.terrainTileForTile[c.key];Fn(w,T)&&kn.newMorphing(c.key,w,T,o,250),s.activeTexture.set(a.TEXTURE0),n.texture&&n.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE);const B=kn.getMorphValuesForProxy(c.key),C=B?1:0;B&&e.L(v,{morphing:{srcDemTile:B.from,dstDemTile:B.to,phase:e.cC(B.phase)}});const S=e.cF(c.canonical),E=e.cG(S.getCenter().lat),M=e.cH(c.canonical,S,E,u.worldSize/u._pixelsPerMercatorPixel),I=e.bc(e.cI(c.canonical)),P=Ln(u.expandedFarZProjMatrix,y,A,I,e.ag(u.zoom),m,u.frustumCorners.TL,u.frustumCorners.TR,u.frustumCorners.BR,u.frustumCorners.BL,u.globeCenterInViewSpace,u.globeRadius,_,h,u._farZ,M);if(d(c,C),l&&(i.setupElevationDraw(n,l,v),t.uploadCommonUniforms(s,l,c.toUnwrapped()),g)){const[e,i,r]=g.getGridBuffers(E,0!==h);l.draw(t,x,f,b,p,Vi.backCCW,P,"globe_raster",e,i,r)}}}if(g&&(t.renderDefaultNorthPole||t.renderDefaultSouthPole)){const o=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];h&&o.push("CUSTOM_ANTIALIASING"),l=t.getOrCreateProgram("globeRaster",{defines:o});for(const o of n){const{x:n,y:c,z:h}=o.canonical,d=0===c,A=c===(1<<h)-1,[y,x,b,w]=g.getPoleBuffers(h,!1);if(w&&(d||A)){const c=r.getTile(o);s.activeTexture.set(a.TEXTURE0),c.texture&&c.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE);let g=e.cJ(h,n,u);const T=e.bc(e.cI(o.canonical)),B=(e,i)=>e.draw(t,a.TRIANGLES,f,Ni.disabled,p,Vi.disabled,Ln(u.expandedFarZProjMatrix,g,g,T,0,m,u.frustumCorners.TL,u.frustumCorners.TR,u.frustumCorners.BR,u.frustumCorners.BL,u.globeCenterInViewSpace,u.globeRadius,_,0,u._farZ),"globe_pole_raster",i,b,w);i.setupElevationDraw(c,l,v),t.uploadCommonUniforms(s,l,o.toUnwrapped()),d&&t.renderDefaultNorthPole&&B(l,y),A&&t.renderDefaultSouthPole&&(g=e.ad.mat4.scale(e.ad.mat4.create(),g,[1,-1,1]),B(l,x))}}}}(t,i,r,n,o);else{const s=t.context,a=s.gl;let l,c;const u=t.shadowRenderer,h=Ji(t,t.longestCutoffRange),d=e=>{if(c===e)return;const i=[];i.push(zn[e]),h.shouldRenderCutoff&&i.push("RENDER_CUTOFF"),u&&(i.push("RENDER_SHADOWS","DEPTH_TEXTURE"),u.useNormalOffset&&i.push("NORMAL_OFFSET")),l=t.getOrCreateProgram("terrainRaster",{defines:i}),c=e},p=t.colorModeForRenderPass(),f=new Oi(a.LEQUAL,Oi.ReadWrite,t.depthRangeFor3D);kn.update(o);const A=t.transform,m=Rn(A.zoom,i.exaggeration(),i.sourceCache._source.tileSize);let g=[0,0,0];if(u){const e=t.style.directionalLight,i=t.style.ambientLight;e&&i&&(g=sr(t.style,e,i))}{c=-1;const _=a.TRIANGLES,[y,v]=[i.gridIndexBuffer,i.gridSegments];for(const c of n){const n=r.getTile(c),x=Ni.disabled,b=i.prevTerrainTileForTile[c.key],w=i.terrainTileForTile[c.key];Fn(b,w)&&kn.newMorphing(c.key,b,w,o,250),s.activeTexture.set(a.TEXTURE0),n.texture&&n.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE);const T=kn.getMorphValuesForProxy(c.key),B=T?1:0;let C;T&&(C={morphing:{srcDemTile:T.from,dstDemTile:T.to,phase:e.cC(T.phase)}});const S=Pn(c.projMatrix,Dn(c.canonical,A.renderWorldCopies)?m/10:m,g);if(d(B),!l)continue;i.setupElevationDraw(n,l,C);const E=c.toUnwrapped();u&&u.setupShadows(E,l),t.uploadCommonUniforms(s,l,E,null,h),l.draw(t,_,f,x,p,Vi.backCCW,S,"terrain_raster",i.gridBuffer,y,v)}}}}(i,this,this.proxySourceCache,t,this._updateTimestamp),this.renderingToTexture=!0,i.gpuTimingDeferredRenderEnd(),t.splice(0,t.length))}renderBatch(t){if(0===this._drapedRenderBatches.length)return t+1;this.renderingToTexture=!0;const i=this.painter,r=this.painter.context,n=this.proxySourceCache,o=this.proxiedCoords[n.id],s=this._drapedRenderBatches.shift(),a=i.style.order,l=[];let c=0;for(const u of o){const o=n.getTileByID(u.proxyTileKey),h=n.proxyCachedFBO[u.key]?n.proxyCachedFBO[u.key][t]:void 0,d=void 0!==h?n.renderCache[h]:this.pool[c++],p=void 0!==h;if(o.texture=d.tex,p&&!d.dirty){l.push(o.tileID);continue}let f;r.bindFramebuffer.set(d.fb.framebuffer),this.renderedToTile=!1,d.dirty&&(r.clear({color:e.al.transparent,stencil:0}),d.dirty=!1);for(let e=s.start;e<=s.end;++e){const t=i.style._mergedLayers[a[e]];if(t.isHidden(i.transform.zoom))continue;const n=i.style.getLayerSourceCache(t),o=n?this.proxyToSource[u.key][n.id]:[u];if(!o)continue;const s=o;r.viewport.set([0,0,d.fb.width,d.fb.height]),f!==(n?n.id:null)&&(this._setupStencil(d,o,t,n),f=n?n.id:null),i.renderLayer(i,n,t,s)}if(0===this._drapedRenderBatches.length)for(const e of this._pendingGroundEffectLayers){const t=i.style._mergedLayers[a[e]];if(t.isHidden(i.transform.zoom))continue;const n=i.style.getLayerSourceCache(t),o=n?this.proxyToSource[u.key][n.id]:[u];if(!o)continue;const s=o;r.viewport.set([0,0,d.fb.width,d.fb.height]),f!==(n?n.id:null)&&(this._setupStencil(d,o,t,n),f=n?n.id:null),i.renderLayer(i,n,t,s)}this.renderedToTile?(d.dirty=!0,l.push(o.tileID)):p||--c,5===c&&(c=0,this.renderToBackBuffer(l))}return this.renderToBackBuffer(l),this.renderingToTexture=!1,r.bindFramebuffer.set(null),r.viewport.set([0,0,i.width,i.height]),s.end+1}postRender(){}isLayerOrderingCorrect(e){const t=e.order.length;let i=-1,r=t;for(let n=0;n<t;++n)this._style.isLayerDraped(e._mergedLayers[e.order[n]])?i=Math.max(i,n):r=Math.min(r,n);return r>i}getMinElevationBelowMSL(){let e=0;return this._visibleDemTiles.filter((e=>e.dem)).forEach((t=>{e=Math.min(e,t.dem.tree.minimums[0])})),0===e?e:(e-30)*this._exaggeration}raycast(e,t,i){if(!this._visibleDemTiles)return null;const r=this._visibleDemTiles.filter((e=>e.dem)).map((r=>{const n=r.tileID,o=1<<n.overscaledZ,{x:s,y:a}=n.canonical,l=s/o,c=(s+1)/o,u=a/o,h=(a+1)/o;return{minx:l,miny:u,maxx:c,maxy:h,t:r.dem.tree.raycastRoot(l,u,c,h,e,t,i),tile:r}}));r.sort(((e,t)=>(null!==e.t?e.t:Number.MAX_VALUE)-(null!==t.t?t.t:Number.MAX_VALUE)));for(const n of r){if(null==n.t)return null;const r=n.tile.dem.tree.raycast(n.minx,n.miny,n.maxx,n.maxy,e,t,i);if(null!=r)return r}return null}_createFBO(){const t=this.painter.context,i=t.gl,r=this.drapeBufferSize;t.activeTexture.set(i.TEXTURE0);const n=new e.T(t,{width:r[0],height:r[1],data:null},i.RGBA8);n.bind(i.LINEAR,i.CLAMP_TO_EDGE);const o=t.createFramebuffer(r[0],r[1],!0,null);return o.colorAttachment.set(n.texture),o.depthAttachment=new In(t,o.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=t.createRenderbuffer(t.gl.DEPTH_STENCIL,r[0],r[1]),this._stencilRef=0,o.depthAttachment.set(this._sharedDepthStencil),t.clear({stencil:0})):o.depthAttachment.set(this._sharedDepthStencil),t.extTextureFilterAnisotropic&&i.texParameterf(i.TEXTURE_2D,t.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,t.extTextureFilterAnisotropicMax),{fb:o,tex:n,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache)return!0;if(this._style.hasLightTransitions())return!0;for(const e in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[e].hasTransition())return!0;return this._style.order.some((e=>{const t=this._style._mergedLayers[e],i=t.isHidden(this.painter.transform.zoom);return"hillshade"===t.type||"custom"===t.type?!i&&t.shouldRedrape():!i&&t.hasTransition()}))}_clearLineLayersFromRenderCache(){let t=!1;for(const e of this._style.getSources())if(e instanceof tt){t=!0;break}if(!t)return;const i={};for(let t=0;t<this._style.order.length;++t){const r=this._style._mergedLayers[this._style.order[t]],n=this._style.getLayerSourceCache(r);if(n&&!i[n.id]&&!r.isHidden(this.painter.transform.zoom)&&"line"===r.type&&r.widthExpression()instanceof e.ab){i[n.id]=!0;for(const e of this.proxyCoords){const t=this.proxyToSource[e.key][n.id];if(t)for(const e of t)this._clearRenderCacheForTile(n.id,e)}}}}_clearRasterLayersFromRenderCache(){let e=!1;for(const t in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[t]._source instanceof it){e=!0;break}if(!e)return;const t={};for(let e=0;e<this._style.order.length;++e){const i=this._style._mergedLayers[this._style.order[e]],r=this._style.getLayerSourceCache(i);if(!r||t[r.id])continue;if(i.isHidden(this.painter.transform.zoom)||"raster"!==i.type)continue;const n=i.paint.get("raster-fade-duration");for(const e of this.proxyCoords){const t=this.proxyToSource[e.key][r.id];if(t)for(const e of t){const t=Un(r.getTile(e),r.findLoadedParent(e,0),r,this.painter.transform,n);(1!==t.opacity||0!==t.mix)&&this._clearRenderCacheForTile(r.id,e)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const t=this._style.order,i=t.length;if(0===i)return;const r=[];this._pendingGroundEffectLayers=[];let n,o=0,s=this._style._mergedLayers[t[o]];for(;!this._style.isLayerDraped(s)&&s.isHidden(this.painter.transform.zoom)&&++o<i;)s=this._style._mergedLayers[t[o]];for(;o<i;++o){const e=this._style._mergedLayers[t[o]];e.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(e)?void 0===n&&(n=o):("fill-extrusion"===e.type&&this._pendingGroundEffectLayers.push(o),void 0!==n&&(r.push({start:n,end:o-1}),n=void 0)))}if(void 0!==n&&r.push({start:n,end:o-1}),0!==r.length){const t=r[r.length-1];this._pendingGroundEffectLayers.every((e=>e>t.end))||e.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=r}_setupRenderCache(e){const t=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,t.renderCache.length>t.renderCachePool.length){const e=Object.values(t.proxyCachedFBO);t.proxyCachedFBO={};for(let i=0;i<e.length;++i){const r=Object.values(e[i]);t.renderCachePool.push(...r)}}return}this._clearRasterLayersFromRenderCache();const i=this.proxyCoords,r=this._tilesDirty;for(let n=i.length-1;n>=0;n--){const o=i[n];if(t.getTileByID(o.key),void 0!==t.proxyCachedFBO[o.key]){const i=e[o.key],n=this.proxyToSource[o.key];let s=0;for(const e in n){const t=n[e],o=i[e];if(!o||o.length!==t.length||t.some(((t,i)=>t!==o[i]||r[e]&&r[e].hasOwnProperty(t.key)))){s=-1;break}++s}for(const e in t.proxyCachedFBO[o.key])t.renderCache[t.proxyCachedFBO[o.key][e]].dirty=s<0||s!==Object.values(i).length}}const n=[...this._drapedRenderBatches];n.sort(((e,t)=>t.end-t.start-(e.end-e.start)));for(const e of n)for(const r of i){if(t.proxyCachedFBO[r.key])continue;let i=t.renderCachePool.pop();void 0===i&&t.renderCache.length<50&&(i=t.renderCache.length,t.renderCache.push(this._createFBO())),void 0!==i&&(t.proxyCachedFBO[r.key]={},t.proxyCachedFBO[r.key][e.start]=i,t.renderCache[i].dirty=!0)}this._tilesDirty={}}_setupStencil(e,t,i,r){if(!r||!this._sourceTilesOverlap[r.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const n=this.painter.context,o=n.gl;if(t.length<=1)return void(this._overlapStencilType=!1);let s;if(i.isTileClipped())s=t.length,this._overlapStencilMode.test={func:o.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(t[0].overscaledZ>t[t.length-1].overscaledZ))return void(this._overlapStencilType=!1);s=1,this._overlapStencilMode.test={func:o.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+s>255&&(n.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=s,this._overlapStencilMode.ref=this._stencilRef,i.isTileClipped()&&this._renderTileClippingMasks(t,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(e){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[e.key]),this._overlapStencilMode):Ni.disabled}_renderTileClippingMasks(e,t){const i=this.painter,r=this.painter.context,n=r.gl;i._tileClippingMaskIDs={},r.setColorMode(Di.disabled),r.setDepthMode(Oi.disabled);const o=i.getOrCreateProgram("clippingMask");for(const r of e){const e=i._tileClippingMaskIDs[r.key]=--t;o.draw(i,n.TRIANGLES,Oi.disabled,new Ni({func:n.ALWAYS,mask:0},e,255,n.KEEP,n.KEEP,n.REPLACE),Di.disabled,Vi.disabled,On(r.projMatrix),"$clipping",i.tileExtentBuffer,i.quadTriangleIndexBuffer,i.tileExtentSegments)}}pointCoordinate(t){const i=this.painter.transform;if(t.x<0||t.x>i.width||t.y<0||t.y>i.height)return null;const r=[t.x,t.y,1,1];e.ad.vec4.transformMat4(r,r,i.pixelMatrixInverse),e.ad.vec4.scale(r,r,1/r[3]),r[0]/=i.worldSize,r[1]/=i.worldSize;const n=i._camera.position,o=e.bH(1,i.center.lat),s=[n[0],n[1],n[2]/o,0],a=e.ad.vec3.subtract([],r.slice(0,3),s);e.ad.vec3.normalize(a,a);const l=this.raycast(s,a,this._exaggeration);return null!==l&&l?(e.ad.vec3.scaleAndAdd(s,s,a,l),s[3]=s[2],s[2]*=o,s):null}_setupProxiedCoordsForOrtho(t,i,r){if(t.getSource()instanceof e.aK)return this._setupProxiedCoordsForImageSource(t,i,r);this._findCoveringTileCache[t.id]=this._findCoveringTileCache[t.id]||{};const n=this.proxiedCoords[t.id]=[],o=this.proxyCoords;for(let e=0;e<o.length;e++){const i=o[e],s=this._findTileCoveringTileID(i,t);if(s){const e=this._createProxiedId(i,s,r[i.key]&&r[i.key][t.id]);n.push(e),this.proxyToSource[i.key][t.id]=[e]}}let s=!1;const a=new Set;for(let e=0;e<i.length;e++){const o=t.getTile(i[e]);if(!o||!o.hasData())continue;const l=this._findTileCoveringTileID(o.tileID,this.proxySourceCache);if(l&&l.tileID.canonical.z!==o.tileID.canonical.z){const e=this.proxyToSource[l.tileID.key][t.id],i=this._createProxiedId(l.tileID,o,r[l.tileID.key]&&r[l.tileID.key][t.id]);e?e.splice(e.length-1,0,i):this.proxyToSource[l.tileID.key][t.id]=[i];const c=this.proxyToSource[l.tileID.key][t.id];a.has(c)||a.add(c),n.push(i),s=!0}}if(this._sourceTilesOverlap[t.id]=s,s&&this._debugParams.sortTilesHiZFirst)for(const e of a)e.sort(((e,t)=>t.overscaledZ-e.overscaledZ))}_setupProxiedCoordsForImageSource(t,i,r){if(!t.getSource().loaded())return;const n=this.proxiedCoords[t.id]=[],o=this.proxyCoords,s=t.getSource(),a=s.tileID;if(!a)return;const l=new e.P(a.x,a.y)._div(1<<a.z),c=s.coordinates.map(e.ac.fromLngLat).reduce(((e,t)=>(e.min.x=Math.min(e.min.x,t.x-l.x),e.min.y=Math.min(e.min.y,t.y-l.y),e.max.x=Math.max(e.max.x,t.x-l.x),e.max.y=Math.max(e.max.y,t.y-l.y),e)),{min:new e.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new e.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),u=(t,i)=>{const r=t.wrap+t.canonical.x/(1<<t.canonical.z),n=t.canonical.y/(1<<t.canonical.z),o=e.ai/(1<<t.canonical.z),s=i.wrap+i.canonical.x/(1<<i.canonical.z),a=i.canonical.y/(1<<i.canonical.z);return r+o<s+c.min.x||r>s+c.max.x||n+o<a+c.min.y||n>a+c.max.y};for(let e=0;e<o.length;e++){const s=o[e];for(let e=0;e<i.length;e++){const o=t.getTile(i[e]);if(!o||!o.hasData())continue;if(u(s,o.tileID))continue;const a=this._createProxiedId(s,o,r[s.key]&&r[s.key][t.id]),l=this.proxyToSource[s.key][t.id];l?l.push(a):this.proxyToSource[s.key][t.id]=[a],n.push(a)}}}_createProxiedId(t,i,r){let n=this.orthoMatrix;if(r){const e=r.find((e=>e.key===i.tileID.key));if(e)return e}if(i.tileID.key!==t.key){const r=t.canonical.z-i.tileID.canonical.z;let o,s,a;n=e.ad.mat4.create();const l=i.tileID.wrap-t.wrap<<t.overscaledZ;r>0?(o=e.ai>>r,s=o*((i.tileID.canonical.x<<r)-t.canonical.x+l),a=o*((i.tileID.canonical.y<<r)-t.canonical.y)):(o=e.ai<<-r,s=e.ai*(i.tileID.canonical.x-(t.canonical.x+l<<-r)),a=e.ai*(i.tileID.canonical.y-(t.canonical.y<<-r))),e.ad.mat4.ortho(n,0,o,0,o,0,1),e.ad.mat4.translate(n,n,[s,a,0])}return new jn(i.tileID,t.key,n)}_findTileCoveringTileID(t,i){let r=i.getTile(t);if(r&&r.hasData())return r;const n=this._findCoveringTileCache[i.id],o=n[t.key];if(r=o?i.getTileByID(o):null,r&&r.hasData()||null===o)return r;let s=r?r.tileID:t,a=s.overscaledZ;const l=i.getSource().minzoom,c=[];if(!o){const n=i.getSource().maxzoom;if(t.canonical.z>=n){const r=t.canonical.z-n;i.getSource().reparseOverscaled?(a=Math.max(t.canonical.z+2,i.transform.tileZoom),s=new e.aH(a,t.wrap,n,t.canonical.x>>r,t.canonical.y>>r)):0!==r&&(a=n,s=new e.aH(a,t.wrap,n,t.canonical.x>>r,t.canonical.y>>r))}s.key!==t.key&&(c.push(s.key),r=i.getTile(s))}const u=e=>{c.forEach((t=>{n[t]=e})),c.length=0};for(a-=1;a>=l&&(!r||!r.hasData());a--){r&&u(r.tileID.key);const e=s.calculateScaledKey(a);if(r=i.getTileByID(e),r&&r.hasData())break;const t=n[e];if(null===t)break;void 0===t?c.push(e):r=i.getTileByID(t)}return u(r?r.tileID.key:null),r&&r.hasData()?r:null}findDEMTileFor(e){return this.enabled?this._findTileCoveringTileID(e,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(e,t){let i=this._tilesDirty[e];i||(i=this._tilesDirty[e]={}),i[t.key]=!0}}function Hn(t,i,r){const n=function(t,i,r){const n=e.ad.vec3.dot(i,t),o=e.ad.vec3.dot(r,[.2126,.7152,.0722]),s=(e,t,i)=>(1-i)*e+i*t,a=s(1-.3*Math.min(o,1),1,Math.min(n+1,1));return s(.92,1,Math.asin(e.ay(i[2],-1,1))/Math.PI+.5)*a}(t,[0,0,1],i),o=[0,0,0];e.ad.vec3.scale(o,r.slice(0,3),n);const s=[0,0,0];e.ad.vec3.scale(s,i.slice(0,3),t[2]);const a=[0,0,0];return e.ad.vec3.add(a,o,s),e.cg(a)}const Gn=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],$n=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","elevatedStructures","model","symbol"];class Zn{static cacheKey(e,t,i,r){let n=`${t}${r?r.cacheKey:""}`;for(const t of i)e.usedDefines.includes(t)&&(n+=`/${t}`);return n}constructor(t,i,r,n,o,s){const a=t.gl;this.program=a.createProgram(),this.configuration=n,this.name=i,this.fixedDefines=[...s];const l=n?n.getBinderAttributes():[],c=(r.staticAttributes||[]).concat(l);let u=n?n.defines():[];u=u.concat(s.map((e=>`#define ${e}`)));const h="#version 300 es\n";let d=h+u.concat("precision mediump float;",Or,Dr.fragmentSource).join("\n");for(const e of r.fragmentIncludes)d+=`\n${zr[e]}`;d+=`\n${r.fragmentSource}`;let p=h+u.concat("precision highp float;",Or,Dr.vertexSource).join("\n");for(const e of r.vertexIncludes)p+=`\n${zr[e]}`;this.forceManualRenderingForInstanceIDShaders=t.forceManualRenderingForInstanceIDShaders&&-1!==r.vertexSource.indexOf("gl_InstanceID"),this.forceManualRenderingForInstanceIDShaders&&(p+="\nuniform int u_instanceID;\n"),p+=`\n${r.vertexSource}`,this.forceManualRenderingForInstanceIDShaders&&(p=p.replaceAll("gl_InstanceID","u_instanceID"));const f=a.createShader(a.FRAGMENT_SHADER);if(a.isContextLost())return void(this.failedToCreate=!0);a.shaderSource(f,d),a.compileShader(f),a.attachShader(this.program,f);const A=a.createShader(a.VERTEX_SHADER);if(a.isContextLost())this.failedToCreate=!0;else{a.shaderSource(A,p),a.compileShader(A),a.attachShader(this.program,A),this.attributes={},this.numAttributes=c.length;for(let e=0;e<this.numAttributes;e++)if(c[e]){const t=c[e].startsWith("a_")?c[e]:`a_${c[e]}`;a.bindAttribLocation(this.program,e,t),this.attributes[t]=e}a.linkProgram(this.program),a.deleteShader(A),a.deleteShader(f),this.fixedUniforms=o(t),this.binderUniforms=n?n.getUniforms(t):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(t=>({u_instanceID:new e.bN(t)}))(t)),(s.includes("TERRAIN")||-1!==i.indexOf("symbol")||-1!==i.indexOf("circle"))&&(this.terrainUniforms=(t=>({u_dem:new e.bN(t),u_dem_prev:new e.bN(t),u_dem_tl:new e.bK(t),u_dem_scale:new e.bM(t),u_dem_tl_prev:new e.bK(t),u_dem_scale_prev:new e.bM(t),u_dem_size:new e.bM(t),u_dem_lerp:new e.bM(t),u_exaggeration:new e.bM(t),u_depth:new e.bN(t),u_depth_size_inv:new e.bK(t),u_depth_range_unpack:new e.bK(t),u_occluder_half_size:new e.bM(t),u_occlusion_depth_offset:new e.bM(t),u_meter_to_dem:new e.bM(t),u_label_plane_matrix_inv:new e.bJ(t)}))(t)),s.includes("GLOBE")&&(this.globeUniforms=(t=>({u_tile_tl_up:new e.bL(t),u_tile_tr_up:new e.bL(t),u_tile_br_up:new e.bL(t),u_tile_bl_up:new e.bL(t),u_tile_up_scale:new e.bM(t)}))(t)),s.includes("FOG")&&(this.fogUniforms=(t=>({u_fog_matrix:new e.bJ(t),u_fog_range:new e.bK(t),u_fog_color:new e.cb(t),u_fog_horizon_blend:new e.bM(t),u_fog_vertical_limit:new e.bK(t),u_fog_temporal_offset:new e.bM(t),u_frustum_tl:new e.bL(t),u_frustum_tr:new e.bL(t),u_frustum_br:new e.bL(t),u_frustum_bl:new e.bL(t),u_globe_pos:new e.bL(t),u_globe_radius:new e.bM(t),u_globe_transition:new e.bM(t),u_is_globe:new e.bN(t),u_viewport:new e.bK(t)}))(t)),s.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(t=>({u_cutoff_params:new e.cb(t)}))(t)),s.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(t=>({u_lighting_ambient_color:new e.bL(t),u_lighting_directional_dir:new e.bL(t),u_lighting_directional_color:new e.bL(t),u_ground_radiance:new e.bL(t)}))(t)),s.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(t=>({u_light_matrix_0:new e.bJ(t),u_light_matrix_1:new e.bJ(t),u_fade_range:new e.bK(t),u_shadow_normal_offset:new e.bL(t),u_shadow_intensity:new e.bM(t),u_shadow_texel_size:new e.bM(t),u_shadow_map_resolution:new e.bM(t),u_shadow_direction:new e.bL(t),u_shadow_bias:new e.bL(t),u_shadowmap_0:new e.bN(t),u_shadowmap_1:new e.bN(t)}))(t))}}setTerrainUniformValues(e,t){if(!this.terrainUniforms)return;const i=this.terrainUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const e in t)i[e]&&i[e].set(this.program,e,t[e])}}setGlobeUniformValues(e,t){if(!this.globeUniforms)return;const i=this.globeUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const e in t)i[e]&&i[e].set(this.program,e,t[e])}}setFogUniformValues(e,t){if(!this.fogUniforms)return;const i=this.fogUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const e in t)i[e].set(this.program,e,t[e])}}setCutoffUniformValues(e,t){if(!this.cutoffUniforms)return;const i=this.cutoffUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const e in t)i[e].set(this.program,e,t[e])}}setLightsUniformValues(e,t){if(!this.lightsUniforms)return;const i=this.lightsUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const e in t)i[e].set(this.program,e,t[e])}}setShadowUniformValues(e,t){if(this.failedToCreate||!this.shadowUniforms)return;const i=this.shadowUniforms;e.program.set(this.program);for(const e in t)i[e].set(this.program,e,t[e])}_drawDebugWireframe(t,i,r,n,o,s,a,l,c,u){const h=t.options.wireframe;if(!1===h.terrain&&!1===h.layers2D&&!1===h.layers3D)return;const d=t.context;if(!(()=>!(!h.terrain||"terrainRaster"!==this.name&&"globeRaster"!==this.name)||!(!h.layers2D||t._terrain&&t._terrain.renderingToTexture||!Gn.includes(this.name))||!(!h.layers3D||!$n.includes(this.name)))())return;const p=d.gl,f=t.wireframeDebugCache.getLinesFromTrianglesBuffer(t.frameCounter,o,d);if(!f)return;const A=[...this.fixedDefines];A.push("DEBUG_WIREFRAME");const m=t.getOrCreateProgram(this.name,{config:this.configuration,defines:A});d.program.set(m.program);const g=(e,t,i)=>{if(t[e]&&i[e])for(const r in t[e])i[e][r]&&i[e][r].set(i.program,r,t[e][r].current)};c&&c.setUniforms(m.program,d,m.binderUniforms,a,{zoom:l}),g("fixedUniforms",this,m),g("terrainUniforms",this,m),g("globeUniforms",this,m),g("fogUniforms",this,m),g("lightsUniforms",this,m),g("shadowUniforms",this,m),f.bind(),d.setColorMode(new Di([p.ONE,p.ONE_MINUS_SRC_ALPHA,p.ZERO,p.ONE],e.al.transparent,[!0,!0,!0,!1])),d.setDepthMode(new Oi(i.func===p.LESS?p.LEQUAL:i.func,Oi.ReadOnly,i.range)),d.setStencilMode(Ni.disabled);const _=3*s.primitiveLength*2,y=3*s.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const e=u||1;for(let t=0;t<e;++t)m.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",t),p.drawElements(p.LINES,_,p.UNSIGNED_SHORT,y)}else u&&u>1?p.drawElementsInstanced(p.LINES,_,p.UNSIGNED_SHORT,y,u):p.drawElements(p.LINES,_,p.UNSIGNED_SHORT,y);o.bind(),d.program.set(this.program),d.setDepthMode(i),d.setStencilMode(r),d.setColorMode(n)}checkUniforms(e,t,i){if(this.fixedDefines.includes(t))for(const r of Object.keys(i))if(!i[r].initialized)throw new Error(`Program '${this.name}', from draw '${e}': uniform ${r} not set but required by ${t} being defined`)}draw(e,t,i,r,n,o,s,a,l,c,u,h,d,p,f,A){const m=e.context,g=m.gl;if(this.failedToCreate)return;m.program.set(this.program),m.setDepthMode(i),m.setStencilMode(r),m.setColorMode(n),m.setCullFace(o);for(const e of Object.keys(this.fixedUniforms))this.fixedUniforms[e].set(this.program,e,s[e]);p&&p.setUniforms(this.program,m,this.binderUniforms,h,{zoom:d});const _={[g.POINTS]:1,[g.LINES]:2,[g.TRIANGLES]:3,[g.LINE_STRIP]:1}[t];this.checkUniforms(a,"RENDER_SHADOWS",this.shadowUniforms);const y=A&&A>0?1:void 0;for(const o of u.get()){const s=o.vaos||(o.vaos={});if((s[a]||(s[a]=new jr)).bind(m,this,l,p?p.getPaintVertexBuffers():[],c,o.vertexOffset,f||[],y),this.forceManualRenderingForInstanceIDShaders){const e=A||1;for(let i=0;i<e;++i)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",i),c?g.drawElements(t,o.primitiveLength*_,g.UNSIGNED_SHORT,o.primitiveOffset*_*2):g.drawArrays(t,o.vertexOffset,o.vertexLength)}else A&&A>1?g.drawElementsInstanced(t,o.primitiveLength*_,g.UNSIGNED_SHORT,o.primitiveOffset*_*2,A):c?g.drawElements(t,o.primitiveLength*_,g.UNSIGNED_SHORT,o.primitiveOffset*_*2):g.drawArrays(t,o.vertexOffset,o.vertexLength);t===g.TRIANGLES&&c&&this._drawDebugWireframe(e,i,r,n,c,o,h,d,p,A)}}}function qn(t,i){const r=Math.pow(2,i.tileID.overscaledZ),n=i.tileSize*Math.pow(2,t.transform.tileZoom)/r,o=n*(i.tileID.canonical.x+i.tileID.wrap*r),s=n*i.tileID.canonical.y;return{u_image:0,u_texsize:i.imageAtlasTexture?i.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/e.at(i,1,t.transform.tileZoom),u_pixel_coord_upper:[o>>16,s>>16],u_pixel_coord_lower:[65535&o,65535&s]}}const Kn={terrain:0,flat:1},Wn=e.ad.mat4.create(),Xn=(t,i,r,n,o,s,a,l,c,u,h,d,p,f,A,m,g,_)=>{const y=i.style.light,v=y.properties.get("position"),x=[v.x,v.y,v.z],b=e.ad.mat3.create();"viewport"===y.properties.get("anchor")&&(e.ad.mat3.fromRotation(b,-i.transform.angle),e.ad.vec3.transformMat3(x,x,b));const w=y.properties.get("color"),T=i.transform,B={u_matrix:t,u_lightpos:x,u_lightintensity:y.properties.get("intensity"),u_lightcolor:[w.r,w.g,w.b],u_vertical_gradient:+r,u_opacity:n,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Wn,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:Kn[u],u_base_type:Kn[h],u_ao:o,u_edge_radius:s,u_width_scale:a,u_flood_light_color:A,u_vertical_scale:m,u_flood_light_intensity:g,u_ground_shadow_factor:_};return"globe"===T.projection.name&&(B.u_tile_id=[l.canonical.x,l.canonical.y,1<<l.canonical.z],B.u_zoom_transition=d,B.u_inv_rot_matrix=f,B.u_merc_center=p,B.u_up_dir=T.projection.upVector(new e.bT(0,0,0),p[0]*e.ai,p[1]*e.ai),B.u_height_lift=c),B},Yn=(e,t,i,r,n,o)=>({u_matrix:e,u_edge_radius:t,u_width_scale:i,u_vertical_scale:r,u_height_type:Kn[n],u_base_type:Kn[o]}),Jn=(t,i,r,n,o,s,a,l,c,u,h,d,p,f,A,m,g)=>{const _=Xn(t,i,r,n,o,s,a,l,u,h,d,p,f,A,m,g,1,[0,0,0]),y={u_height_factor:-Math.pow(2,l.overscaledZ)/c.tileSize/8};return e.l(_,qn(i,c),y)},eo=(e,t)=>({u_matrix:e,u_emissive_strength:t}),to=(t,i,r,n)=>e.l(eo(t,i),qn(r,n)),io=(e,t,i)=>({u_matrix:e,u_world:i,u_emissive_strength:t}),ro=(t,i,r,n,o)=>e.l(to(t,i,r,n),{u_world:o}),no=(e,t,i,r,n)=>({u_matrix:e,u_camera_pos:[t[0],t[1],t[2]],u_depth_bias:i,u_height_scale:r,u_reset_depth:n}),oo=(t,i,r,n)=>{const o=e.ai/r.tileSize;return{u_matrix:t,u_camera_to_center_distance:i.getCameraToCenterDistance(n),u_extrude_scale:[i.pixelsToGLUnits[0]/o,i.pixelsToGLUnits[1]/o]}},so=(e,t,i=1)=>({u_matrix:e,u_color:t.toRenderColor(null),u_overlay:0,u_overlay_scale:i}),ao=e.ad.mat4.create(),lo=(t,i,r,n,o,s,a)=>{const l=t.transform,c="globe"===l.projection.name,u=c?e.cO(l.zoom,i.canonical)*l._pixelsPerMercatorPixel:e.at(r,1,s),h={u_matrix:i.projMatrix,u_extrude_scale:u,u_intensity:a,u_inv_rot_matrix:ao,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(c){h.u_inv_rot_matrix=n,h.u_merc_center=o,h.u_tile_id=[i.canonical.x,i.canonical.y,1<<i.canonical.z],h.u_zoom_transition=e.ag(l.zoom);const t=o[0]*e.ai,r=o[1]*e.ai;h.u_up_dir=l.projection.upVector(new e.bT(0,0,0),t,r)}return h};function co(e,[t,i,r,n],[o,s]){if(o===s)return[0,0,0,0];const a=255*(e-1)/(e*(s-o));return[t*a,i*a,r*a,n*a]}function uo(e,t,[i,r]){return i===r?0:.5/e+(t-i)*(e-1)/(e*(r-i))}const ho=(t,i,r,n,o,s,a,l,c,u,h,d,p,f,A,m,g,_,y,v,x)=>({u_matrix:t,u_normalize_matrix:i,u_globe_matrix:r,u_merc_matrix:n,u_grid_matrix:o,u_tl_parent:s,u_scale_parent:u,u_fade_t:h.mix,u_opacity:h.opacity*d.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:d.paint.get("raster-brightness-min"),u_brightness_high:d.paint.get("raster-brightness-max"),u_saturation_factor:e.cP(d.paint.get("raster-saturation")),u_contrast_factor:e.cQ(d.paint.get("raster-contrast")),u_spin_weights:po(d.paint.get("raster-hue-rotate")),u_perspective_transform:p,u_raster_elevation:f,u_zoom_transition:a,u_merc_center:l,u_cutoff_params:c,u_colorization_mix:co(e.cR,m,_),u_colorization_offset:uo(e.cR,g,_),u_color_ramp:A,u_texture_offset:[v/(y+2*v),y/(y+2*v)],u_texture_res:[y+2*v,y+2*v],u_emissive_strength:x});function po(e){e*=Math.PI/180;const t=Math.sin(e),i=Math.cos(e);return[(2*i+1)/3,(-Math.sqrt(3)*t-i+1)/3,(Math.sqrt(3)*t-i+1)/3]}const fo=.05,Ao=(e,t,i,r,n,o,s,a,l,c,u,h)=>({u_matrix:e,u_normalize_matrix:t,u_globe_matrix:i,u_merc_matrix:r,u_grid_matrix:n,u_tl_parent:o,u_scale_parent:c,u_fade_t:u.mix,u_opacity:u.opacity,u_image0:0,u_image1:1,u_raster_elevation:h,u_zoom_transition:s,u_merc_center:a,u_cutoff_params:l}),mo=(e,t,i,r,n,o,s,a,l,c)=>({u_particle_texture:e,u_particle_texture_side_len:t,u_tile_offset:i,u_velocity:r,u_color_ramp:o,u_velocity_res:n,u_max_speed:s,u_uv_offset:a,u_data_scale:[255*l[0],255*l[1]],u_data_offset:c,u_particle_pos_scale:1.1,u_particle_pos_offset:[fo,fo]}),go=(e,t,i,r,n,o,s,a,l,c)=>({u_particle_texture:e,u_particle_texture_side_len:t,u_velocity:i,u_velocity_res:r,u_max_speed:n,u_speed_factor:o,u_reset_rate:s,u_rand_seed:Math.random(),u_uv_offset:a,u_data_scale:[255*l[0],255*l[1]],u_data_offset:c,u_particle_pos_scale:1.1,u_particle_pos_offset:[fo,fo]}),_o=e.ad.mat4.create(),yo=(t,i,r,n,o,s,a,l,c,u,h,d,p,f,A,m,g,_,y,v,x,b)=>{const w=o.transform,T={u_is_size_zoom_constant:+("constant"===t||"source"===t),u_is_size_feature_constant:+("constant"===t||"camera"===t),u_size_t:i?i.uSizeT:0,u_size:i?i.uSize:0,u_camera_to_center_distance:w.getCameraToCenterDistance(y),u_rotate_symbol:+r,u_aspect_ratio:w.width/w.height,u_fade_change:o.options.fadeDuration?o.symbolFadeChange:1,u_matrix:s,u_label_plane_matrix:a,u_coord_matrix:l,u_is_text:+u,u_elevation_from_sea:c?1:0,u_pitch_with_map:+n,u_texsize:h,u_texsize_icon:d,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:_o,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:_o,u_up_vector:[0,-1,0],u_color_adj_mat:v,u_icon_transition:x||0,u_gamma_scale:n?o.transform.getCameraToCenterDistance(y)*Math.cos(o.terrain?0:o.transform._pitch):1,u_device_pixel_ratio:e.q.devicePixelRatio,u_is_halo:+p,u_scale_factor:b||1};return"globe"===y.name&&(T.u_tile_id=[f.canonical.x,f.canonical.y,1<<f.canonical.z],T.u_zoom_transition=A,T.u_inv_rot_matrix=g,T.u_merc_center=m,T.u_camera_forward=w._camera.forward(),T.u_ecef_origin=e.cS(w.globeMatrix,f.toUnwrapped()),T.u_tile_matrix=Float32Array.from(w.globeMatrix),T.u_up_vector=_),T},vo=(e,t,i,r)=>({u_matrix:e,u_emissive_strength:t,u_opacity:i,u_color:r}),xo=(t,i,r,n,o,s,a,l,c)=>e.l(function(t,i,r,n,o,s){const{width:a,height:l}=n.imageManager.getPixelSize(i),c=Math.pow(2,s.tileID.overscaledZ),u=s.tileSize*Math.pow(2,n.transform.tileZoom)/c,h=u*(s.tileID.canonical.x+s.tileID.wrap*c),d=u*s.tileID.canonical.y;return{u_image:0,u_pattern_tl:r.tl,u_pattern_br:r.br,u_texsize:[a,l],u_pattern_size:r.displaySize,u_pattern_units_to_pixels:o?[n.transform.width,-1*n.transform.height]:[1/e.at(s,1,n.transform.tileZoom),1/e.at(s,1,n.transform.tileZoom)],u_pixel_coord_upper:[h>>16,d>>16],u_pixel_coord_lower:[65535&h,65535&d]}}(0,s,a,n,l,c),{u_matrix:t,u_emissive_strength:i,u_opacity:r}),bo=new Float32Array(e.ad.mat4.identity([])),wo=(t,i,r,n,o,s,a,l,c,u,h,d,p,f=[0,0,0],A)=>{const m=o.style.light,g=m.properties.get("position"),_=[-g.x,-g.y,g.z],y=e.ad.mat3.create();"viewport"===m.properties.get("anchor")&&(e.ad.mat3.fromRotation(y,-o.transform.angle),e.ad.vec3.transformMat3(_,_,y));const v="MASK"===h.alphaMode,x=m.properties.get("color").toRenderColor(null),b=p.paint.get("model-ambient-occlusion-intensity"),w=p.paint.get("model-color").constantOr(e.al.white).toRenderColor(null),T=p.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:t,u_lighting_matrix:i,u_normal_matrix:r,u_node_matrix:n||bo,u_lightpos:_,u_lightintensity:m.properties.get("intensity"),u_lightcolor:[x.r,x.g,x.b],u_camera_pos:f,u_opacity:s,u_baseTextureIsAlpha:0,u_alphaMask:+v,u_alphaCutoff:h.alphaCutoff,u_baseColorFactor:[a.r,a.g,a.b,a.a],u_emissiveFactor:[l[0],l[1],l[2],1],u_metallicFactor:c,u_roughnessFactor:u,u_baseColorTexture:Ki.BaseColor,u_metallicRoughnessTexture:Ki.MetallicRoughness,u_normalTexture:Ki.Normal,u_occlusionTexture:Ki.Occlusion,u_emissionTexture:Ki.Emission,u_lutTexture:Ki.LUT,u_color_mix:[w.r,w.g,w.b,T],u_aoIntensity:b,u_emissive_strength:d,u_occlusionTextureTransform:A||[0,0,0,0]}},To=(e,t=bo,i=bo)=>({u_matrix:e,u_instance:t,u_node_matrix:i}),Bo={fillExtrusion:t=>({u_matrix:new e.bJ(t),u_lightpos:new e.bL(t),u_lightintensity:new e.bM(t),u_lightcolor:new e.bL(t),u_vertical_gradient:new e.bM(t),u_opacity:new e.bM(t),u_edge_radius:new e.bM(t),u_width_scale:new e.bM(t),u_ao:new e.bK(t),u_height_type:new e.bN(t),u_base_type:new e.bN(t),u_tile_id:new e.bL(t),u_zoom_transition:new e.bM(t),u_inv_rot_matrix:new e.bJ(t),u_merc_center:new e.bK(t),u_up_dir:new e.bL(t),u_height_lift:new e.bM(t),u_flood_light_color:new e.bL(t),u_vertical_scale:new e.bM(t),u_flood_light_intensity:new e.bM(t),u_ground_shadow_factor:new e.bL(t)}),fillExtrusionDepth:t=>({u_matrix:new e.bJ(t),u_edge_radius:new e.bM(t),u_width_scale:new e.bM(t),u_vertical_scale:new e.bM(t),u_height_type:new e.bN(t),u_base_type:new e.bN(t)}),fillExtrusionPattern:t=>({u_matrix:new e.bJ(t),u_lightpos:new e.bL(t),u_lightintensity:new e.bM(t),u_lightcolor:new e.bL(t),u_vertical_gradient:new e.bM(t),u_height_factor:new e.bM(t),u_edge_radius:new e.bM(t),u_width_scale:new e.bM(t),u_ao:new e.bK(t),u_height_type:new e.bN(t),u_base_type:new e.bN(t),u_tile_id:new e.bL(t),u_zoom_transition:new e.bM(t),u_inv_rot_matrix:new e.bJ(t),u_merc_center:new e.bK(t),u_up_dir:new e.bL(t),u_height_lift:new e.bM(t),u_image:new e.bN(t),u_texsize:new e.bK(t),u_pixel_coord_upper:new e.bK(t),u_pixel_coord_lower:new e.bK(t),u_tile_units_to_pixels:new e.bM(t),u_opacity:new e.bM(t)}),fillExtrusionGroundEffect:t=>({u_matrix:new e.bJ(t),u_opacity:new e.bM(t),u_ao_pass:new e.bM(t),u_meter_to_tile:new e.bM(t),u_ao:new e.bK(t),u_flood_light_intensity:new e.bM(t),u_flood_light_color:new e.bL(t),u_attenuation:new e.bM(t),u_edge_radius:new e.bM(t),u_fb:new e.bN(t),u_fb_size:new e.bM(t),u_dynamic_offset:new e.bM(t)}),fill:t=>({u_matrix:new e.bJ(t),u_emissive_strength:new e.bM(t)}),fillPattern:t=>({u_matrix:new e.bJ(t),u_emissive_strength:new e.bM(t),u_image:new e.bN(t),u_texsize:new e.bK(t),u_pixel_coord_upper:new e.bK(t),u_pixel_coord_lower:new e.bK(t),u_tile_units_to_pixels:new e.bM(t)}),fillOutline:t=>({u_matrix:new e.bJ(t),u_emissive_strength:new e.bM(t),u_world:new e.bK(t)}),fillOutlinePattern:t=>({u_matrix:new e.bJ(t),u_emissive_strength:new e.bM(t),u_world:new e.bK(t),u_image:new e.bN(t),u_texsize:new e.bK(t),u_pixel_coord_upper:new e.bK(t),u_pixel_coord_lower:new e.bK(t),u_tile_units_to_pixels:new e.bM(t)}),elevatedStructures:t=>({u_matrix:new e.bJ(t)}),elevatedStructuresDepthReconstruct:t=>({u_matrix:new e.bJ(t),u_camera_pos:new e.bL(t),u_depth_bias:new e.bM(t),u_height_scale:new e.bM(t),u_reset_depth:new e.bM(t)}),circle:e.cT,collisionBox:t=>({u_matrix:new e.bJ(t),u_camera_to_center_distance:new e.bM(t),u_extrude_scale:new e.bK(t)}),collisionCircle:t=>({u_matrix:new e.bJ(t),u_inv_matrix:new e.bJ(t),u_camera_to_center_distance:new e.bM(t),u_viewport_size:new e.bK(t)}),debug:t=>({u_color:new e.cA(t),u_matrix:new e.bJ(t),u_overlay:new e.bN(t),u_overlay_scale:new e.bM(t)}),clippingMask:t=>({u_matrix:new e.bJ(t)}),heatmap:t=>({u_extrude_scale:new e.bM(t),u_intensity:new e.bM(t),u_matrix:new e.bJ(t),u_inv_rot_matrix:new e.bJ(t),u_merc_center:new e.bK(t),u_tile_id:new e.bL(t),u_zoom_transition:new e.bM(t),u_up_dir:new e.bL(t)}),heatmapTexture:t=>({u_image:new e.bN(t),u_color_ramp:new e.bN(t),u_opacity:new e.bM(t)}),hillshade:t=>({u_matrix:new e.bJ(t),u_image:new e.bN(t),u_latrange:new e.bK(t),u_light:new e.bK(t),u_shadow:new e.cA(t),u_highlight:new e.cA(t),u_emissive_strength:new e.bM(t),u_accent:new e.cA(t)}),hillshadePrepare:t=>({u_matrix:new e.bJ(t),u_image:new e.bN(t),u_dimension:new e.bK(t),u_zoom:new e.bM(t)}),line:e.cU,linePattern:e.cV,raster:t=>({u_matrix:new e.bJ(t),u_normalize_matrix:new e.bJ(t),u_globe_matrix:new e.bJ(t),u_merc_matrix:new e.bJ(t),u_grid_matrix:new e.cB(t),u_tl_parent:new e.bK(t),u_scale_parent:new e.bM(t),u_fade_t:new e.bM(t),u_opacity:new e.bM(t),u_image0:new e.bN(t),u_image1:new e.bN(t),u_brightness_low:new e.bM(t),u_brightness_high:new e.bM(t),u_saturation_factor:new e.bM(t),u_contrast_factor:new e.bM(t),u_spin_weights:new e.bL(t),u_perspective_transform:new e.bK(t),u_raster_elevation:new e.bM(t),u_zoom_transition:new e.bM(t),u_merc_center:new e.bK(t),u_cutoff_params:new e.cb(t),u_colorization_mix:new e.cb(t),u_colorization_offset:new e.bM(t),u_color_ramp:new e.bN(t),u_texture_offset:new e.bK(t),u_texture_res:new e.bK(t),u_emissive_strength:new e.bM(t)}),rasterParticle:t=>({u_matrix:new e.bJ(t),u_normalize_matrix:new e.bJ(t),u_globe_matrix:new e.bJ(t),u_merc_matrix:new e.bJ(t),u_grid_matrix:new e.cB(t),u_tl_parent:new e.bK(t),u_scale_parent:new e.bM(t),u_fade_t:new e.bM(t),u_opacity:new e.bM(t),u_image0:new e.bN(t),u_image1:new e.bN(t),u_raster_elevation:new e.bM(t),u_zoom_transition:new e.bM(t),u_merc_center:new e.bK(t),u_cutoff_params:new e.cb(t)}),rasterParticleTexture:t=>({u_texture:new e.bN(t),u_opacity:new e.bM(t)}),rasterParticleDraw:t=>({u_particle_texture:new e.bN(t),u_particle_texture_side_len:new e.bM(t),u_tile_offset:new e.bK(t),u_velocity:new e.bN(t),u_color_ramp:new e.bN(t),u_velocity_res:new e.bK(t),u_max_speed:new e.bM(t),u_uv_offset:new e.bK(t),u_data_scale:new e.bK(t),u_data_offset:new e.bM(t),u_particle_pos_scale:new e.bM(t),u_particle_pos_offset:new e.bK(t)}),rasterParticleUpdate:t=>({u_particle_texture:new e.bN(t),u_particle_texture_side_len:new e.bM(t),u_velocity:new e.bN(t),u_velocity_res:new e.bK(t),u_max_speed:new e.bM(t),u_speed_factor:new e.bM(t),u_reset_rate:new e.bM(t),u_rand_seed:new e.bM(t),u_uv_offset:new e.bK(t),u_data_scale:new e.bK(t),u_data_offset:new e.bM(t),u_particle_pos_scale:new e.bM(t),u_particle_pos_offset:new e.bK(t)}),symbol:t=>({u_is_size_zoom_constant:new e.bN(t),u_is_size_feature_constant:new e.bN(t),u_size_t:new e.bM(t),u_size:new e.bM(t),u_camera_to_center_distance:new e.bM(t),u_rotate_symbol:new e.bN(t),u_aspect_ratio:new e.bM(t),u_fade_change:new e.bM(t),u_matrix:new e.bJ(t),u_label_plane_matrix:new e.bJ(t),u_coord_matrix:new e.bJ(t),u_is_text:new e.bN(t),u_elevation_from_sea:new e.bN(t),u_pitch_with_map:new e.bN(t),u_texsize:new e.bK(t),u_texsize_icon:new e.bK(t),u_texture:new e.bN(t),u_texture_icon:new e.bN(t),u_gamma_scale:new e.bM(t),u_device_pixel_ratio:new e.bM(t),u_tile_id:new e.bL(t),u_zoom_transition:new e.bM(t),u_inv_rot_matrix:new e.bJ(t),u_merc_center:new e.bK(t),u_camera_forward:new e.bL(t),u_tile_matrix:new e.bJ(t),u_up_vector:new e.bL(t),u_ecef_origin:new e.bL(t),u_is_halo:new e.bN(t),u_icon_transition:new e.bM(t),u_color_adj_mat:new e.bJ(t),u_scale_factor:new e.bM(t)}),background:t=>({u_matrix:new e.bJ(t),u_emissive_strength:new e.bM(t),u_opacity:new e.bM(t),u_color:new e.cA(t)}),backgroundPattern:t=>({u_matrix:new e.bJ(t),u_emissive_strength:new e.bM(t),u_opacity:new e.bM(t),u_image:new e.bN(t),u_pattern_tl:new e.bK(t),u_pattern_br:new e.bK(t),u_texsize:new e.bK(t),u_pattern_size:new e.bK(t),u_pixel_coord_upper:new e.bK(t),u_pixel_coord_lower:new e.bK(t),u_pattern_units_to_pixels:new e.bK(t)}),terrainRaster:t=>({u_matrix:new e.bJ(t),u_image0:new e.bN(t),u_skirt_height:new e.bM(t),u_ground_shadow_factor:new e.bL(t)}),skybox:t=>({u_matrix:new e.bJ(t),u_sun_direction:new e.bL(t),u_cubemap:new e.bN(t),u_opacity:new e.bM(t),u_temporal_offset:new e.bM(t)}),skyboxGradient:t=>({u_matrix:new e.bJ(t),u_color_ramp:new e.bN(t),u_center_direction:new e.bL(t),u_radius:new e.bM(t),u_opacity:new e.bM(t),u_temporal_offset:new e.bM(t)}),skyboxCapture:t=>({u_matrix_3f:new e.cB(t),u_sun_direction:new e.bL(t),u_sun_intensity:new e.bM(t),u_color_tint_r:new e.cb(t),u_color_tint_m:new e.cb(t),u_luminance:new e.bM(t)}),globeRaster:t=>({u_proj_matrix:new e.bJ(t),u_globe_matrix:new e.bJ(t),u_normalize_matrix:new e.bJ(t),u_merc_matrix:new e.bJ(t),u_zoom_transition:new e.bM(t),u_merc_center:new e.bK(t),u_image0:new e.bN(t),u_grid_matrix:new e.cB(t),u_skirt_height:new e.bM(t),u_far_z_cutoff:new e.bM(t),u_frustum_tl:new e.bL(t),u_frustum_tr:new e.bL(t),u_frustum_br:new e.bL(t),u_frustum_bl:new e.bL(t),u_globe_pos:new e.bL(t),u_globe_radius:new e.bM(t),u_viewport:new e.bK(t)}),globeAtmosphere:t=>({u_frustum_tl:new e.bL(t),u_frustum_tr:new e.bL(t),u_frustum_br:new e.bL(t),u_frustum_bl:new e.bL(t),u_horizon:new e.bM(t),u_transition:new e.bM(t),u_fadeout_range:new e.bM(t),u_color:new e.cb(t),u_high_color:new e.cb(t),u_space_color:new e.cb(t),u_temporal_offset:new e.bM(t),u_horizon_angle:new e.bM(t)}),model:t=>({u_matrix:new e.bJ(t),u_lighting_matrix:new e.bJ(t),u_normal_matrix:new e.bJ(t),u_node_matrix:new e.bJ(t),u_lightpos:new e.bL(t),u_lightintensity:new e.bM(t),u_lightcolor:new e.bL(t),u_camera_pos:new e.bL(t),u_opacity:new e.bM(t),u_baseColorFactor:new e.cb(t),u_emissiveFactor:new e.cb(t),u_metallicFactor:new e.bM(t),u_roughnessFactor:new e.bM(t),u_baseTextureIsAlpha:new e.bN(t),u_alphaMask:new e.bN(t),u_alphaCutoff:new e.bM(t),u_baseColorTexture:new e.bN(t),u_metallicRoughnessTexture:new e.bN(t),u_normalTexture:new e.bN(t),u_occlusionTexture:new e.bN(t),u_emissionTexture:new e.bN(t),u_lutTexture:new e.bN(t),u_color_mix:new e.cb(t),u_aoIntensity:new e.bM(t),u_emissive_strength:new e.bM(t),u_occlusionTextureTransform:new e.cb(t)}),modelDepth:t=>({u_matrix:new e.bJ(t),u_instance:new e.bJ(t),u_node_matrix:new e.bJ(t)}),groundShadow:t=>({u_matrix:new e.bJ(t),u_ground_shadow_factor:new e.bL(t)}),stars:t=>({u_matrix:new e.bJ(t),u_up:new e.bL(t),u_right:new e.bL(t),u_intensity_multiplier:new e.bM(t)}),snowParticle:t=>({u_modelview:new e.bJ(t),u_projection:new e.bJ(t),u_time:new e.bM(t),u_cam_pos:new e.bL(t),u_velocityConeAperture:new e.bM(t),u_velocity:new e.bM(t),u_horizontalOscillationRadius:new e.bM(t),u_horizontalOscillationRate:new e.bM(t),u_boxSize:new e.bM(t),u_billboardSize:new e.bM(t),u_simpleShapeParameters:new e.bK(t),u_screenSize:new e.bK(t),u_thinningCenterPos:new e.bK(t),u_thinningShape:new e.bL(t),u_thinningAffectedRatio:new e.bM(t),u_thinningParticleOffset:new e.bM(t),u_particleColor:new e.cb(t),u_direction:new e.bL(t)}),rainParticle:t=>({u_modelview:new e.bJ(t),u_projection:new e.bJ(t),u_time:new e.bM(t),u_cam_pos:new e.bL(t),u_texScreen:new e.bN(t),u_velocityConeAperture:new e.bM(t),u_velocity:new e.bM(t),u_boxSize:new e.bM(t),u_rainDropletSize:new e.bK(t),u_distortionStrength:new e.bM(t),u_rainDirection:new e.bL(t),u_color:new e.cb(t),u_screenSize:new e.bK(t),u_thinningCenterPos:new e.bK(t),u_thinningShape:new e.bL(t),u_thinningAffectedRatio:new e.bM(t),u_thinningParticleOffset:new e.bM(t),u_shapeDirectionalPower:new e.bM(t),u_shapeNormalPower:new e.bM(t),u_mode:new e.bM(t)}),vignette:t=>({u_vignetteShape:new e.bL(t),u_vignetteColor:new e.cb(t)}),occlusion:t=>({u_matrix:new e.bJ(t),u_anchorPos:new e.bL(t),u_screenSizePx:new e.bK(t),u_occluderSizePx:new e.bK(t),u_color:new e.cb(t)})};class Co{constructor(e,t,i,r){this.id=Co.uniqueIdxCounter,Co.uniqueIdxCounter++,this.context=e;const n=e.gl;this.buffer=n.createBuffer(),this.dynamicDraw=Boolean(i),this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),n.bufferData(n.ELEMENT_ARRAY_BUFFER,t.arrayBuffer,this.dynamicDraw?n.DYNAMIC_DRAW:n.STATIC_DRAW),this.dynamicDraw||r||t.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){this.id=Co.uniqueIdxCounter,Co.uniqueIdxCounter++;const t=this.context.gl;this.context.unbindVAO(),this.bind(),t.bufferSubData(t.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}Co.uniqueIdxCounter=0;const So={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Eo{constructor(e,t,i,r,n,o){this.length=t.length,this.attributes=i,this.itemSize=t.bytesPerElement,this.dynamicDraw=r,this.instanceCount=o,this.context=e;const s=e.gl;this.buffer=s.createBuffer(),e.bindVertexBuffer.set(this.buffer),s.bufferData(s.ARRAY_BUFFER,t.arrayBuffer,this.dynamicDraw?s.DYNAMIC_DRAW:s.STATIC_DRAW),this.dynamicDraw||n||t.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){const t=this.context.gl;this.bind(),t.bufferSubData(t.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,t){for(let i=0;i<this.attributes.length;i++){const r=t.attributes[this.attributes[i].name];void 0!==r&&e.enableVertexAttribArray(r)}}setVertexAttribPointers(e,t,i){for(let r=0;r<this.attributes.length;r++){const n=this.attributes[r],o=t.attributes[n.name];void 0!==o&&e.vertexAttribPointer(o,n.components,e[So[n.type]],!1,this.itemSize,n.offset+this.itemSize*(i||0))}}setVertexAttribDivisor(e,t,i){for(let r=0;r<this.attributes.length;r++){const n=t.attributes[this.attributes[r].name];void 0!==n&&this.instanceCount&&this.instanceCount>0&&e.vertexAttribDivisor(n,i)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Mo{constructor(e,t,i,r,n){this.context=e,this.width=t,this.height=i;const o=this.framebuffer=e.gl.createFramebuffer();r&&(this.colorAttachment=new Sn(e,o)),n&&(this.depthAttachmentType=n,this.depthAttachment="renderbuffer"===n?new En(e,o):new Mn(e,o))}destroy(){const e=this.context.gl;if(this.colorAttachment){const t=this.colorAttachment.get();t&&e.deleteTexture(t)}if(this.depthAttachment&&this.depthAttachmentType)if("renderbuffer"===this.depthAttachmentType){const t=this.depthAttachment.get();t&&e.deleteRenderbuffer(t)}else{const t=this.depthAttachment.get();t&&e.deleteTexture(t)}e.deleteFramebuffer(this.framebuffer)}}class Io{constructor(e,t){this.gl=e,this.clearColor=new qr(this),this.clearDepth=new Kr(this),this.clearStencil=new Wr(this),this.colorMask=new Xr(this),this.depthMask=new Yr(this),this.stencilMask=new Jr(this),this.stencilFunc=new en(this),this.stencilOp=new tn(this),this.stencilTest=new rn(this),this.depthRange=new nn(this),this.depthTest=new on(this),this.depthFunc=new sn(this),this.blend=new an(this),this.blendFunc=new ln(this),this.blendColor=new cn(this),this.blendEquation=new un(this),this.cullFace=new hn(this),this.cullFaceSide=new dn(this),this.frontFace=new pn(this),this.program=new fn(this),this.activeTexture=new An(this),this.viewport=new mn(this),this.bindFramebuffer=new gn(this),this.bindRenderbuffer=new _n(this),this.bindTexture=new yn(this),this.bindVertexBuffer=new vn(this),this.bindElementBuffer=new xn(this),this.bindVertexArrayOES=new bn(this),this.pixelStoreUnpack=new wn(this),this.pixelStoreUnpackPremultiplyAlpha=new Tn(this),this.pixelStoreUnpackFlipY=new Bn(this),this.options=t?Object.assign({},t):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=e.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=e.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=e.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=t&&!!t.forceManualRenderingForInstanceIDShaders||this.renderer&&-1!==this.renderer.indexOf("PowerVR"),this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=e.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=e.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=e.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),this.maxPointSize=e.getParameter(e.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,t,i){return new Co(this,e,t,i)}createVertexBuffer(e,t,i,r,n){return new Eo(this,e,t,i,r,n)}createRenderbuffer(e,t,i){const r=this.gl,n=r.createRenderbuffer();return this.bindRenderbuffer.set(n),r.renderbufferStorage(r.RENDERBUFFER,e,t,i),this.bindRenderbuffer.set(null),n}createFramebuffer(e,t,i,r){return new Mo(this,e,t,i,r)}clear({color:e,depth:t,stencil:i,colorMask:r}){const n=this.gl;let o=0;e&&(o|=n.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set(r||[!0,!0,!0,!0])),void 0!==t&&(o|=n.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(t),this.depthMask.set(!0)),void 0!==i&&(o|=n.STENCIL_BUFFER_BIT,this.clearStencil.set(i),this.stencilMask.set(255)),n.clear(o)}setCullFace(e){!1===e.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(t){e.bn(t.blendFunction,Di.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor),t.blendEquation?this.blendEquation.set(t.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(t.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let Po;function Lo(t,i,r,n,o,s,a){const l=t.context,c=l.gl,u=t.transform,h=t.getOrCreateProgram("collisionBox"),d=[];let p=0,f=0;for(let l=0;l<n.length;l++){const A=n[l],m=i.getTile(A),g=m.getBucket(r);if(!g)continue;const _=li(A,g,u);let y=_;0===o[0]&&0===o[1]||(y=t.translatePosMatrix(_,m,o,s));const v=a?g.textCollisionBox:g.iconCollisionBox,x=g.collisionCircleArray;if(x.length>0){const t=e.ad.mat4.create(),i=y;e.ad.mat4.mul(t,g.placementInvProjMatrix,u.glCoordMatrix),e.ad.mat4.mul(t,t,g.placementViewportMatrix),d.push({circleArray:x,circleOffset:f,transform:i,invTransform:t,projection:g.getProjection()}),p+=x.length/4,f=p}v&&(t.terrain&&t.terrain.setupElevationDraw(m,h),h.draw(t,c.LINES,Oi.disabled,Ni.disabled,t.colorModeForRenderPass(),Vi.disabled,oo(y,u,m,g.getProjection()),r.id,v.layoutVertexBuffer,v.indexBuffer,v.segments,null,u.zoom,null,[v.collisionVertexBuffer,v.collisionVertexBufferExt]))}if(!a||!d.length)return;const A=t.getOrCreateProgram("collisionCircle"),m=new e.cW;m.resize(4*p),m._trim();let g=0;for(const e of d)for(let t=0;t<e.circleArray.length/4;t++){const i=4*t,r=e.circleArray[i+0],n=e.circleArray[i+1],o=e.circleArray[i+2],s=e.circleArray[i+3];m.emplace(g++,r,n,o,s,0),m.emplace(g++,r,n,o,s,1),m.emplace(g++,r,n,o,s,2),m.emplace(g++,r,n,o,s,3)}(!Po||Po.length<2*p)&&(Po=function(t){const i=2*t,r=new e.aV;r.resize(i),r._trim();for(let e=0;e<i;e++){const t=6*e;r.uint16[t+0]=4*e+0,r.uint16[t+1]=4*e+1,r.uint16[t+2]=4*e+2,r.uint16[t+3]=4*e+2,r.uint16[t+4]=4*e+3,r.uint16[t+5]=4*e+0}return r}(p));const _=l.createIndexBuffer(Po,!0),y=l.createVertexBuffer(m,e.cX.members,!0);for(const i of d){const n={u_matrix:i.transform,u_inv_matrix:i.invTransform,u_camera_to_center_distance:(v=u).getCameraToCenterDistance(i.projection),u_viewport_size:[v.width,v.height]};A.draw(t,c.TRIANGLES,Oi.disabled,Ni.disabled,t.colorModeForRenderPass(),Vi.disabled,n,r.id,y,_,e.b8.simpleSegment(0,2*i.circleOffset,i.circleArray.length,i.circleArray.length/2),null,u.zoom)}var v;y.destroy(),_.destroy()}const Fo=e.ad.mat4.create();function ko(t){const i=t._camera.getWorldToCamera(t.worldSize,1),r=e.ad.mat4.multiply([],i,t.globeMatrix);e.ad.mat4.invert(r,r);const n=[0,0,0],o=[0,1,0,0];return e.ad.vec4.transformMat4(o,o,r),n[0]=o[0],n[1]=o[1],n[2]=o[2],e.ad.vec3.normalize(n,n),n}function zo({width:t,height:i,anchor:r,textOffset:n,textScale:o},s){const{horizontalAlign:a,verticalAlign:l}=e.bD(r),c=-(a-.5)*t,u=-(l-.5)*i,h=e.bC(r,n);return new e.P((c/o+h[0])*s,(u/o+h[1])*s)}function Ro(t,i,r,n,o,s,a,l,c,u,h){const d=t.text.placedSymbolArray,p=t.text.dynamicLayoutVertexArray,f=t.icon.dynamicLayoutVertexArray,A={},m=t.getProjection(),g=ci(l,m,s),_=s.elevation,y=m.upVectorScale(l.canonical,s.center.lat,s.worldSize).metersToTile;p.clear();for(let f=0;f<d.length;f++){const v=d.get(f),{tileAnchorX:x,tileAnchorY:b,numGlyphs:w}=v,T=v.hidden||!v.crossTileID||t.allowVerticalPlacement&&!v.placedOrientation?null:n[v.crossTileID];if(T){let n=0,d=0,f=0;if(_){const e=_?_.getAtTileOffset(l,x,b):0,[t,i,r]=m.upVector(l.canonical,x,b);n=e*t*y,d=e*i*y,f=e*r*y}let[B,C,S,E]=Zt(v.projectedAnchorX+n,v.projectedAnchorY+d,v.projectedAnchorZ+f,r?g:a);const M=qt(s.getCameraToCenterDistance(m),E);let I=o.evaluateSizeForFeature(t.textSizeData,u,v)*M/e.bw;r&&(I*=t.tilePixelRatio/c);const P=zo(T,I);r?(({x:B,y:C,z:S}=m.projectTilePoint(x+P.x,b+P.y,l.canonical)),[B,C,S]=Zt(B+n,C+d,S+f,a)):(i&&P._rotate(-s.angle),B+=P.x,C+=P.y,S=0);const L=t.allowVerticalPlacement&&v.placedOrientation===e.bq.vertical?Math.PI/2:0;for(let t=0;t<w;t++)e.bt(p,B,C,S,L);h&&v.associatedIconIndex>=0&&(A[v.associatedIconIndex]={x:B,y:C,z:S,angle:L})}else ri(w,p)}if(h){f.clear();const i=t.icon.placedSymbolArray;for(let t=0;t<i.length;t++){const r=i.get(t),{numGlyphs:n}=r,o=A[t];if(r.hidden||!o)ri(n,f);else{const{x:t,y:i,z:r,angle:s}=o;for(let o=0;o<n;o++)e.bt(f,t,i,r,s)}}t.icon.dynamicLayoutVertexBuffer.updateData(f)}t.text.dynamicLayoutVertexBuffer.updateData(p)}function Do(t,i,r,n,o,s,a={}){const l=r.paint.get("icon-translate"),c=r.paint.get("text-translate"),u=r.paint.get("icon-translate-anchor"),h=r.paint.get("text-translate-anchor"),d=r.layout.get("icon-rotation-alignment"),p=r.layout.get("text-rotation-alignment"),f=r.layout.get("icon-pitch-alignment"),A=r.layout.get("text-pitch-alignment"),m=r.layout.get("icon-keep-upright"),g=r.layout.get("text-keep-upright"),_=r.paint.get("icon-color-saturation"),y=r.paint.get("icon-color-contrast"),v=r.paint.get("icon-color-brightness-min"),x=r.paint.get("icon-color-brightness-max"),b="sea"===r.layout.get("symbol-elevation-reference"),w=t.context,T=w.gl,B=t.transform,C="map"===d,S="map"===p,E="map"===f,M="map"===A,I=void 0!==r.layout.get("symbol-sort-key").constantOr(1);let P=!1;const L=t.depthModeForSublayer(0,Oi.ReadOnly),F=[e.av(B.center.lng),e.aC(B.center.lat)],k=r.layout.get("text-variable-anchor"),z="globe"===B.projection.name,R=[],D=[0,-1,0];for(const o of n){const n=i.getTile(o),s=n.getBucket(r);if(!s)continue;if("mercator"===s.projection.name&&z)continue;if(s.fullyClipped)continue;const d="globe"===s.projection.name,p=d?e.ag(B.zoom):0,f=ci(o,s.getProjection(),B),A=B.calculatePixelsToTileUnitsMatrix(n),w=k&&s.hasTextData(),L=s.hasIconTextFit()&&w&&s.hasIconData(),O=s.getProjection().createInversionMatrix(B,o.canonical),U=e=>{B.depthOcclusionForSymbolsAndCircles&&(r.hasInitialOcclusionOpacityProperties||t.terrain)&&(e.push("DEPTH_D24"),e.push("DEPTH_OCCLUSION"))},N=()=>{const i=C&&"point"!==r.layout.get("symbol-placement"),a=[];U(a);const c=i||L,h=r.paint.get("icon-image-cross-fade").constantOr(0);t.terrainRenderModeElevated()&&E&&a.push("PITCH_WITH_MAP_TERRAIN"),d&&(a.push("PROJECTION_GLOBE_VIEW"),c&&a.push("PROJECTED_POS_ON_VIEWPORT")),h>0&&a.push("ICON_TRANSITION"),s.icon.zOffsetVertexBuffer&&a.push("Z_OFFSET"),0===_&&0===y&&0===v&&1===x||a.push("COLOR_ADJUSTMENT"),s.sdfIcons&&a.push("RENDER_SDF");const g=s.icon.programConfigurations.get(r.id),w=t.getOrCreateProgram("symbol",{config:g,defines:a}),S=n.imageAtlasTexture?n.imageAtlasTexture.size:[0,0],M=s.iconSizeData,I=e.bp(M,B.zoom),P=E||0!==B.pitch,k=Ht(f,n.tileID.canonical,E,C,B,s.getProjection(),A),R=$t(f,n.tileID.canonical,E,C,B,s.getProjection(),A),N=t.translatePosMatrix(R,n,l,u,!0),Q=t.translatePosMatrix(f,n,l,u),j=c?Fo:k,V=C&&!E&&!i;let H=D;!z&&!B.mercatorFromTransition||C||(H=ko(B));const G=d?H:D,$=r.getColorAdjustmentMatrix(_,y,v,x),Z=yo(M.kind,I,V,E,t,Q,j,N,b,!1,S,[0,0],!0,o,p,F,O,G,s.getProjection(),$,h),q=n.imageAtlasTexture?n.imageAtlasTexture:null,K=1!==r.layout.get("icon-size").constantOr(0)||s.iconsNeedLinear,W=s.sdfIcons||t.options.rotating||t.options.zooming||K||P?T.LINEAR:T.NEAREST,X=s.sdfIcons&&0!==r.paint.get("icon-halo-width").constantOr(1),Y=t.terrain&&E&&i?e.ad.mat4.invert(e.ad.mat4.create(),k):Fo;if(i&&s.icon){const e=B.elevation,i=e?e.getAtTileOffsetFunc(o,B.center.lat,B.worldSize,s.getProjection()):null,r=Gt(f,n.tileID.canonical,E,C,B,s.getProjection(),A);Wt(s,f,t,!1,r,R,E,m,i,o)}return{program:w,buffers:s.icon,uniformValues:Z,atlasTexture:q,atlasTextureIcon:null,atlasInterpolation:W,atlasInterpolationIcon:null,isSDF:s.sdfIcons,hasHalo:X,tile:n,labelPlaneMatrixInv:Y}},Q=()=>{const i=S&&"point"!==r.layout.get("symbol-placement"),a=[],l=i||k||L;t.terrainRenderModeElevated()&&M&&a.push("PITCH_WITH_MAP_TERRAIN"),d&&(a.push("PROJECTION_GLOBE_VIEW"),l&&a.push("PROJECTED_POS_ON_VIEWPORT")),s.text.zOffsetVertexBuffer&&a.push("Z_OFFSET"),s.iconsInText&&a.push("RENDER_TEXT_AND_SYMBOL"),a.push("RENDER_SDF"),U(a);const u=s.text.programConfigurations.get(r.id),m=t.getOrCreateProgram("symbol",{config:u,defines:a});let _,y=[0,0],v=null;const x=s.textSizeData;s.iconsInText&&(y=n.imageAtlasTexture?n.imageAtlasTexture.size:[0,0],v=n.imageAtlasTexture?n.imageAtlasTexture:null,_=M||0!==B.pitch||t.options.rotating||t.options.zooming||"composite"===x.kind||"camera"===x.kind?T.LINEAR:T.NEAREST);const w=n.glyphAtlasTexture?n.glyphAtlasTexture.size:[0,0],C=r.layout.get("text-size-scale-range"),E=e.ay(t.scaleFactor,C[0],C[1]),I=e.bp(x,B.zoom,E),P=Ht(f,n.tileID.canonical,M,S,B,s.getProjection(),A),R=$t(f,n.tileID.canonical,M,S,B,s.getProjection(),A),N=t.translatePosMatrix(R,n,c,h,!0),Q=t.translatePosMatrix(f,n,c,h),j=l?Fo:P,V=S&&!M&&!i;let H=D;!z&&!B.mercatorFromTransition||S||(H=ko(B));const G=yo(x.kind,I,V,M,t,Q,j,N,b,!0,w,y,!0,o,p,F,O,d?H:D,s.getProjection(),null,null,E),$=n.glyphAtlasTexture?n.glyphAtlasTexture:null,Z=T.LINEAR,q=0!==r.paint.get("text-halo-width").constantOr(1),K=t.terrain&&M&&i?e.ad.mat4.invert(e.ad.mat4.create(),P):Fo;if(i&&s.text){const e=B.elevation,i=e?e.getAtTileOffsetFunc(o,B.center.lat,B.worldSize,s.getProjection()):null,r=Gt(f,n.tileID.canonical,M,S,B,s.getProjection(),A);Wt(s,f,t,!0,r,R,M,g,i,o)}return{program:m,buffers:s.text,uniformValues:G,atlasTexture:$,atlasTextureIcon:v,atlasInterpolation:Z,atlasInterpolationIcon:_,isSDF:!0,hasHalo:q,tile:n,labelPlaneMatrixInv:K}},j=s.icon.segments.get().length,V=s.text.segments.get().length,H=j&&!a.onlyText?N():null,G=V&&!a.onlyIcons?Q():null,$=r.paint.get("icon-opacity").constantOr(1),Z=r.paint.get("text-opacity").constantOr(1);if(I&&s.canOverlap){P=!0;const t=$&&!a.onlyText?s.icon.segments.get():[],i=Z&&!a.onlyIcons?s.text.segments.get():[];for(const i of t)R.push({segments:new e.b8([i]),sortKey:i.sortKey,state:H});for(const t of i)R.push({segments:new e.b8([t]),sortKey:t.sortKey,state:G})}else a.onlyText||R.push({segments:$?s.icon.segments:new e.b8([]),sortKey:0,state:H}),a.onlyIcons||R.push({segments:Z?s.text.segments:new e.b8([]),sortKey:0,state:G})}P&&R.sort(((e,t)=>e.sortKey-t.sortKey));for(const e of R){const i=e.state;if(i)if(t.terrain?t.terrain.setupElevationDraw(i.tile,i.program,{useDepthForOcclusion:B.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:i.labelPlaneMatrixInv}):t.setupDepthForOcclusion(B.depthOcclusionForSymbolsAndCircles,i.program),w.activeTexture.set(T.TEXTURE0),i.atlasTexture&&i.atlasTexture.bind(i.atlasInterpolation,T.CLAMP_TO_EDGE,!0),i.atlasTextureIcon&&(w.activeTexture.set(T.TEXTURE1),i.atlasTextureIcon&&i.atlasTextureIcon.bind(i.atlasInterpolationIcon,T.CLAMP_TO_EDGE,!0)),t.uploadCommonLightUniforms(t.context,i.program),i.hasHalo){const n=i.uniformValues;n.u_is_halo=1,Oo(i.buffers,e.segments,r,t,i.program,L,o,s,n,2),n.u_is_halo=0}else{if(i.isSDF){const n=i.uniformValues;i.hasHalo&&(n.u_is_halo=1,Oo(i.buffers,e.segments,r,t,i.program,L,o,s,n,1)),n.u_is_halo=0}Oo(i.buffers,e.segments,r,t,i.program,L,o,s,i.uniformValues,1)}}}function Oo(e,t,i,r,n,o,s,a,l,c){const u=[e.dynamicLayoutVertexBuffer,e.opacityVertexBuffer,e.iconTransitioningVertexBuffer,e.globeExtVertexBuffer,e.zOffsetVertexBuffer];n.draw(r,r.context.gl.TRIANGLES,o,s,a,Vi.disabled,l,i.id,e.layoutVertexBuffer,e.indexBuffer,t,i.paint,r.transform.zoom,e.programConfigurations.get(i.id),u,c)}function Uo(t,i){const r=1<<t.canonical.z,n=(i.x*r-t.canonical.x-t.wrap*r)*e.ai,o=(i.y*r-t.canonical.y)*e.ai,s=e.d5(i.z,i.y);return e.ad.vec3.fromValues(n,o,s)}function No(t,i,r,n,o){if(!r.layout||"none"===r.layout.get("fill-elevation-reference"))return;const s=t.context.gl,a=new Oi(t.context.gl.LEQUAL,Oi.ReadWrite,t.depthRangeFor3D),l=new Oi(t.context.gl.GREATER,Oi.ReadWrite,t.depthRangeFor3D),c=function(t){const i=e.c4(t.pitch);let r=.01;return t.isOrthographic&&(r=e.ah(1e-4,r,e.c9(i>=Xi?1:i/Xi))),2*r}(t.transform),u=t.transform.getFreeCameraOptions().position,h="elevatedStructuresDepthReconstruct",d=t.getOrCreateProgram(h,{defines:["DEPTH_RECONSTRUCTION"]}),p=t.getOrCreateProgram(h);for(const e of n){const n=i.getTile(e),h=n.getBucket(r);if(!h)continue;const f=h.elevatedStructures;if(!f)continue;const A=h.elevationBufferData.heightRange,m=Uo(e.toUnwrapped(),u),g=t.translatePosMatrix(e.projMatrix,n,r.paint.get("fill-translate"),r.paint.get("fill-translate-anchor"));let _,y,v,x;if("initialize"===o){if(!A||A.min>=1||0===f.depthSegments.segments[0].primitiveLength)continue;_=no(g,m,c,1,0),y=a,v=f.depthSegments,x=d}else if("reset"===o){if(!A||A.min>=0||0===f.maskSegments.segments[0].primitiveLength)continue;_=no(g,m,0,0,1),y=l,v=f.maskSegments,x=d}else if("geometry"===o){if(0===f.depthSegments.segments[0].primitiveLength)continue;_=no(g,m,c,1,0),y=a,v=f.depthSegments,x=p}x.draw(t,s.TRIANGLES,y,Ni.disabled,Di.disabled,Vi.disabled,_,r.id,f.vertexBuffer,f.indexBuffer,v,r.paint,t.transform.zoom)}}function Qo(t,i,r){const{painter:n,sourceCache:o,layer:s,coords:a,colorMode:l,elevationType:c,terrainEnabled:u,pass:h}=t,d=n.context.gl,p=s.paint.get("fill-pattern");let f=c;"road"!==c||i&&!u||(f="none");const A="road"===f,m=new Oi(n.context.gl.LEQUAL,Oi.ReadWrite,n.depthRangeFor3D),g=p&&p.constantOr(1),_=(t,c)=>{let u,h,_,y,v;c?(h=g&&!s.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",u=d.LINES):(h=g?"fillPattern":"fill",u=d.TRIANGLES);for(const x of a){const a=o.getTile(x);if(g&&!a.patternsLoaded())continue;const b=a.getBucket(s);if(!b)continue;const w=i?b.elevationBufferData:b.bufferData;if(w.isEmpty())continue;n.prepareDrawTile();const T=w.programConfigurations.get(s.id),B=n.isTileAffectedByFog(x),C=[],S=[];A&&(C.push("ELEVATED_ROADS"),S.push(w.elevatedLayoutVertexBuffer));const E=n.getOrCreateProgram(h,{config:T,overrideFog:B,defines:C});g&&(n.context.activeTexture.set(d.TEXTURE0),a.imageAtlasTexture&&a.imageAtlasTexture.bind(d.LINEAR,d.CLAMP_TO_EDGE),T.updatePaintBuffers());const M=p.constantOr(null);if(M&&a.imageAtlas){const t=a.imageAtlas,i=e.d0.from(M).getPrimary().scaleSelf(e.q.devicePixelRatio).toString(),r=t.patternPositions.get(i);r&&T.setConstantPatternPositions(r)}const I=n.translatePosMatrix(x.projMatrix,a,s.paint.get("fill-translate"),s.paint.get("fill-translate-anchor")),P=s.paint.get("fill-emissive-strength");if(c){y=w.lineIndexBuffer,v=w.lineSegments;const e=n.terrain&&n.terrain.renderingToTexture?n.terrain.drapeBufferSize:[d.drawingBufferWidth,d.drawingBufferHeight];_="fillOutlinePattern"===h&&g?ro(I,P,n,a,e):io(I,P,e)}else y=w.indexBuffer,v=w.triangleSegments,_=g?to(I,P,n,a):eo(I,P);n.uploadCommonUniforms(n.context,E,x.toUnwrapped()),E.draw(n,u,"none"!==f?m:t,r||n.stencilModeForClipping(x),l,Vi.disabled,_,s.id,w.layoutVertexBuffer,y,v,s.paint,n.transform.zoom,T,S)}};n.renderPass===h&&_(n.depthModeForSublayer(1,"opaque"===n.renderPass?Oi.ReadWrite:Oi.ReadOnly),!1),"none"===f&&"translucent"===n.renderPass&&s.paint.get("fill-antialias")&&_(n.depthModeForSublayer(s.getPaintProperty("fill-outline-color")?2:0,Oi.ReadOnly),!0)}function jo(t,i,r,n,o,s,a,l){r.resetLayerRenderingStats(t);const c=t.context,u=c.gl,h=t.transform,d=r.paint.get("fill-extrusion-pattern"),p=d.constantOr(1),f=r.paint.get("fill-extrusion-opacity"),A=t.style.enable3dLights(),m=r.paint.get(A&&!p?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),g=[r.paint.get("fill-extrusion-ambient-occlusion-intensity"),m],_=r.layout.get("fill-extrusion-edge-radius"),y=_>0&&!r.paint.get("fill-extrusion-rounded-roof"),v=y?0:_,x="globe"===h.projection.name?e.d6():0,b="globe"===h.projection.name,w=b?e.ag(h.zoom):0,T=[e.av(h.center.lng),e.aC(h.center.lat)],B="none"===r.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default"),C=r.paint.get("fill-extrusion-flood-light-color").toRenderColor(B?null:r.lut).toArray01().slice(0,3),S=r.paint.get("fill-extrusion-flood-light-intensity"),E=r.paint.get("fill-extrusion-vertical-scale"),M=0!==r.paint.get("fill-extrusion-line-width").constantOr(1),I=r.paint.get("fill-extrusion-height-alignment"),P=r.paint.get("fill-extrusion-base-alignment"),L=Ji(t,r.paint.get("fill-extrusion-cutoff-fade-range")),F=[];let k;b&&F.push("PROJECTION_GLOBE_VIEW"),g[0]>0&&F.push("FAUX_AO"),y&&F.push("ZERO_ROOF_RADIUS"),l&&F.push("HAS_CENTROID"),S>0&&F.push("FLOOD_LIGHT"),L.shouldRenderCutoff&&F.push("RENDER_CUTOFF"),M&&F.push("RENDER_WALL_MODE");const z="shadow"===t.renderPass,R=t.shadowRenderer,D=z&&!!R;t.shadowRenderer&&(t.shadowRenderer.useNormalOffset=!0);let O=[0,0,0];if(R){const e=t.style.directionalLight,i=t.style.ambientLight;e&&i&&(O=sr(t.style,e,i)),z||(F.push("RENDER_SHADOWS","DEPTH_TEXTURE"),R.useNormalOffset&&F.push("NORMAL_OFFSET")),k=F.concat(["SHADOWS_SINGLE_CASCADE"])}const U=D?"fillExtrusionDepth":p?"fillExtrusionPattern":"fillExtrusion",N=r.getLayerRenderingStats();for(const A of n){const n=i.getTile(A),m=n.getBucket(r);if(!m||m.projection.name!==h.projection.name)continue;let _=!1;R&&(_=0===R.getMaxCascadeForTile(A.toUnwrapped()));const y=t.isTileAffectedByFog(A),B=m.programConfigurations.get(r.id),D=t.getOrCreateProgram(U,{config:B,defines:_?k:F,overrideFog:y});if(t.terrain&&t.terrain.setupElevationDraw(n,D,{useMeterToDem:!0}),!m.centroidVertexBuffer){const e=D.attributes.a_centroid_pos;void 0!==e&&u.vertexAttrib2f(e,0,0)}!z&&R&&R.setupShadows(n.tileID.toUnwrapped(),D,"vector-tile",n.tileID.overscaledZ),p&&(t.context.activeTexture.set(u.TEXTURE0),n.imageAtlasTexture&&n.imageAtlasTexture.bind(u.LINEAR,u.CLAMP_TO_EDGE),B.updatePaintBuffers());const Q=d.constantOr(null);if(Q&&n.imageAtlas){const t=n.imageAtlas,i=e.d0.from(Q).getPrimary().scaleSelf(e.q.devicePixelRatio),r=t.patternPositions.get(i.toString());r&&B.setConstantPatternPositions(r)}const j=r.paint.get("fill-extrusion-vertical-gradient"),V=1/m.tileToMeter;let H;if(z&&R){if(qo(n.tileID,m,t))continue;const e=R.calculateShadowPassMatrixFromTile(n.tileID.toUnwrapped());H=Yn(e,v,V,E,I,P)}else{const e=t.translatePosMatrix(A.expandedProjMatrix,n,r.paint.get("fill-extrusion-translate"),r.paint.get("fill-extrusion-translate-anchor")),i=h.projection.createInversionMatrix(h,A.canonical);H=p?Jn(e,t,j,f,g,v,V,A,n,x,I,P,w,T,i,C,E):Xn(e,t,j,f,g,v,V,A,x,I,P,w,T,i,C,E,S,O)}t.uploadCommonUniforms(c,D,A.toUnwrapped(),null,L);let G=m.segments;if("mercator"===h.projection.name&&!z&&(G=m.getVisibleSegments(n.tileID,t.terrain,t.transform.getFrustum(0)),!G.get().length))continue;if(N)if(z)for(const e of G.get())N.numRenderedVerticesInShadowPass+=e.primitiveLength;else for(const e of G.get())N.numRenderedVerticesInTransparentPass+=e.primitiveLength;const $=[];(t.terrain||l)&&$.push(m.centroidVertexBuffer),b&&$.push(m.layoutVertexExtBuffer),M&&$.push(m.wallVertexBuffer),D.draw(t,c.gl.TRIANGLES,o,s,a,Vi.backCCW,H,r.id,m.layoutVertexBuffer,m.indexBuffer,G,r.paint,t.transform.zoom,B,$)}t.shadowRenderer&&(t.shadowRenderer.useNormalOffset=!1)}function Vo(t,i,r,n,o,s,a,l,c,u,h,d,p,f,A,m,g,_,y){const v=t.context,x=v.gl,b=t.transform,w=t.transform.zoom,T=[],B=Ji(t,r.paint.get("fill-extrusion-cutoff-fade-range"));"clear"===u?(T.push("CLEAR_SUBPASS"),y&&(T.push("CLEAR_FROM_TEXTURE"),v.activeTexture.set(x.TEXTURE0),y.bind(x.LINEAR,x.CLAMP_TO_EDGE))):"sdf"===u&&T.push("SDF_SUBPASS"),g&&T.push("HAS_CENTROID"),B.shouldRenderCutoff&&T.push("RENDER_CUTOFF");const C=r.layout.get("fill-extrusion-edge-radius"),S=(e,i,n,u,_)=>{const x=i.programConfigurations.get(r.id),b=t.isTileAffectedByFog(e),S=t.getOrCreateProgram("fillExtrusionGroundEffect",{config:x,defines:T,overrideFog:b}),E=((e,t,i,r,n,o,s,a,l,c,u)=>({u_matrix:t,u_opacity:i,u_ao_pass:r?1:0,u_meter_to_tile:n,u_ao:o,u_flood_light_intensity:s,u_flood_light_color:a,u_attenuation:l,u_edge_radius:c,u_fb:0,u_fb_size:u,u_dynamic_offset:1}))(0,u,h,c,_,[d,p*_],f,A,m,w>=17?0:C*_,y?y.size[0]:0),M=[];g&&M.push(i.hiddenByLandmarkVertexBuffer),t.uploadCommonUniforms(v,S,e.toUnwrapped(),null,B),S.draw(t,v.gl.TRIANGLES,o,s,a,l,E,r.id,i.vertexBuffer,i.indexBuffer,n,r.paint,w,x,M)};for(const o of n){const n=i.getTile(o),s=n.getBucket(r);if(!s||s.projection.name!==b.projection.name||!s.groundEffect||s.groundEffect&&!s.groundEffect.hasData())continue;const a=s.groundEffect,l=1/s.tileToMeter;{const e=t.translatePosMatrix(o.projMatrix,n,r.paint.get("fill-extrusion-translate"),r.paint.get("fill-extrusion-translate-anchor")),i=a.getDefaultSegment();S(o,a,i,e,l)}if(_)for(let s=0;s<4;s++){const a=e.d7[s](o),c=i.getTile(a);if(!c)continue;const u=c.getBucket(r);if(!u||u.projection.name!==b.projection.name||!u.groundEffect||u.groundEffect&&!u.groundEffect.hasData())continue;const h=u.groundEffect;let d,p;0===s?(d=[-e.ai,0,0],p=1):1===s?(d=[e.ai,0,0],p=0):2===s?(d=[0,-e.ai,0],p=3):(d=[0,e.ai,0],p=2);const f=h.regionSegments[p];if(!f)continue;const A=new Float32Array(16);e.ad.mat4.translate(A,o.projMatrix,d),S(o,h,f,t.translatePosMatrix(A,n,r.paint.get("fill-extrusion-translate"),r.paint.get("fill-extrusion-translate-anchor")),l)}}}function Ho(t,i,r,n,o,s,a){0===n.centroidVertexArray.length&&n.createCentroidsBuffer();const l=s?s.findDEMTileFor(r):null;if(!(l&&l.dem||a))return;s&&l&&l.dem&&n.selfDEMTileTimestamp!==l.dem._timestamp&&(n.borderDoneWithNeighborZ=[-1,-1,-1,-1],n.selfDEMTileTimestamp=l.dem._timestamp);const c=t=>new e.P(Math.ceil((t+e.da)*e.db),0),u=e=>{const t=i.getSource().minzoom,r=e=>{const t=i.getTileByID(e);if(t&&t.hasData())return t.getBucket(o)},n=[0,-1,1];for(const i of n){if(e.overscaledZ+i<t)continue;const n=r(e.calculateScaledKey(e.overscaledZ+i));if(n)return n}},h=[0,0,0],d=(t,i)=>(h[0]=Math.min(t.min.y,i.min.y),h[1]=Math.max(t.max.y,i.max.y),h[2]=e.ai-i.min.x>t.max.x?i.min.x-e.ai:t.max.x,h),p=(t,i)=>(h[0]=Math.min(t.min.x,i.min.x),h[1]=Math.max(t.max.x,i.max.x),h[2]=e.ai-i.min.y>t.max.y?i.min.y-e.ai:t.max.y,h),f=[(e,t)=>d(e,t),(e,t)=>d(t,e),(e,t)=>p(e,t),(e,t)=>p(t,e)],A=(t,i,n,o,a,c,u)=>{if(!s)return 0;const h=[[c?n:t,c?t:n,0],[c?n:i,c?i:n,0]],d=u<0?e.ai+u:u,p=[c?d:(t+i)/2,c?(t+i)/2:d,0];return 0===n&&u<0||0!==n&&u>0?s.getForTilePoints(a,[p],!0,o):h.push(p),s.getForTilePoints(r,h,!0,l),Math.max(h[0][2],h[1][2],p[2])/s.exaggeration()};for(let t=0;t<4;t++){const i=n.borderFeatureIndices[t];if(0===i.length)continue;const o=e.d7[t](r),l=u(o);if(!(l&&l instanceof e.d8))continue;const h=s?s.findDEMTileFor(o):null;if(!(h&&h.dem||a))continue;if(s&&h&&h.dem&&n.borderDEMTileTimestamp[t]!==h.dem._timestamp&&(n.borderDoneWithNeighborZ[t]=-1,n.borderDEMTileTimestamp[t]=h.dem._timestamp),n.borderDoneWithNeighborZ[t]===l.canonical.z)continue;0===l.centroidVertexArray.length&&l.createCentroidsBuffer();const d=(t<2?1:5)-t,p=l.borderDoneWithNeighborZ[d]!==n.canonical.z,_=l.borderFeatureIndices[d];let y=0;if(n.canonical.z!==l.canonical.z){for(const e of i)n.showCentroid(n.featuresOnBorder[e]);if(p)for(const e of _)l.showCentroid(l.featuresOnBorder[e]);n.borderDoneWithNeighborZ[t]=l.canonical.z,l.borderDoneWithNeighborZ[d]=n.canonical.z}for(const r of i){const i=n.featuresOnBorder[r],s=n.centroidData[i.centroidDataIndex],u=i.borders[t];let p;for(;y<_.length;){p=l.featuresOnBorder[_[y]];const e=p.borders[d];if(e[1]>u[0]+3||e[0]>u[0]-3)break;l.showCentroid(p),y++}if(p&&y<_.length){const r=y;let v=0;for(;!(p.borders[d][0]>u[1]-3)&&(v++,++y!==_.length);)p=l.featuresOnBorder[_[y]];p=l.featuresOnBorder[_[r]];let x=!1;if(v>=1){const e=p.borders[d];Math.abs(u[0]-e[0])<3&&Math.abs(u[1]-e[1])<3&&(v=1,x=!0,y=r+1)}else if(0===v){n.showCentroid(i);continue}const b=l.centroidData[p.centroidDataIndex];a&&x&&(((m=s).flags|(g=b).flags)&e.d9?(m.flags|=e.d9,g.flags|=e.d9):(m.flags&=~e.d9,g.flags&=~e.d9));const w=i.intersectsCount()>1||p.intersectsCount()>1;if(v>1)y=r,s.centroidXY=b.centroidXY=new e.P(0,0);else if(h&&h.dem&&!w){const i=f[t](s,b),r=t%2?e.ai-1:0,n=A(i[0],Math.min(e.ai-1,i[1]),r,h,o,t<2,i[2]);s.centroidXY=b.centroidXY=c(n)}else w?s.centroidXY=b.centroidXY=new e.P(0,0):(s.centroidXY=n.encodeBorderCentroid(i),b.centroidXY=l.encodeBorderCentroid(p));n.writeCentroidToBuffer(s),l.writeCentroidToBuffer(b)}else n.showCentroid(i)}n.borderDoneWithNeighborZ[t]=l.canonical.z,l.borderDoneWithNeighborZ[d]=n.canonical.z}var m,g;(n.needsCentroidUpdate||!n.centroidVertexBuffer&&0!==n.centroidVertexArray.length)&&n.uploadCentroid(t)}const Go=[1,0,0],$o=[0,1,0],Zo=[0,0,1];function qo(t,i,r){const n=r.transform,o=r.shadowRenderer;if(!o)return!0;const s=t.toUnwrapped(),a=n.tileSize*o._cascades[r.currentShadowCascade].scale;let l=i.maxHeight;if(n.elevation){const e=n.elevation.getMinMaxForTile(t);e&&(l+=e.max)}const c=[...o.shadowDirection];c[2]=-c[2];const u=o.computeSimplifiedTileShadowVolume(s,l,a,c);if(!u)return!1;const h=[Go,$o,Zo,c,[c[0],0,c[2]],[0,c[1],c[2]]],d="globe"===n.projection.name,p=n.scaleZoom(a),f=e.bR.fromInvProjectionMatrix(n.invProjMatrix,n.worldSize,p,!d),A=o.getCurrentCascadeFrustum();return 0===f.intersectsPrecise(u.vertices,u.planes,h)||0===A.intersectsPrecise(u.vertices,u.planes,h)}function Ko(t){return[t[0]*e.dc,t[1]*e.dc,t[2]*e.dc,0]}function Wo(t,i,r,n,o,s,a,l,c){const u=n.getSource(),h=r.globeSharedBuffers;if(!h)return;let d,p,f;if(i&&(d=n.getTile(i)),u instanceof e.aK?(p=u.texture,f=e.cJ(0,0,r.transform)):d&&i&&(p=d.texture,f=e.cJ(i.canonical.z,i.canonical.x,r.transform)),!p||!f)return;t||(f=e.ad.mat4.scale(e.ad.mat4.create(),f,[1,-1,1]));const A=r.context,m=A.gl,g="nearest"===o.paint.get("raster-resampling")?m.NEAREST:m.LINEAR,_=r.colorModeForDrapableLayerRenderPass(s),y=a.defines;y.push("GLOBE_POLES");const v=new Oi(m.LEQUAL,Oi.ReadWrite,r.depthRangeFor3D),x=Float32Array.from(r.transform.expandedFarZProjMatrix),b=Float32Array.from(e.bc(e.cI(new e.bT(0,0,0))));r.terrain&&r.terrain.prepareDrawTile(),A.activeTexture.set(m.TEXTURE0),p.bind(g,m.CLAMP_TO_EDGE),A.activeTexture.set(m.TEXTURE1),p.bind(g,m.CLAMP_TO_EDGE),"useMipmap"in p&&A.extTextureFilterAnisotropic&&r.transform.pitch>20&&m.texParameterf(m.TEXTURE_2D,A.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,A.extTextureFilterAnisotropicMax);const[w,T,B,C]=i?h.getPoleBuffers(i.canonical.z,!1):h.getPoleBuffers(0,!0),S=o.paint.get("raster-elevation");let E;t?(E=w,r.renderDefaultNorthPole=0!==S):(E=T,r.renderDefaultSouthPole=0!==S);const M=Ko(a.mix),I=((e,t,i,r,n,o,s,a,l,c,u,h,d)=>ho(e,t,i,new Float32Array(16),new Float32Array(9),[0,0],r,[0,0],[0,0,0,0],1,{opacity:1,mix:0},o,[0,0]||[0,0],a,2,c,u,h,1,0,d))(x,b,f,e.ag(r.transform.zoom),0,o,0,S,0,M,a.offset,a.range,s),P=r.getOrCreateProgram("raster",{defines:y});r.uploadCommonUniforms(A,P,null),P.draw(r,m.TRIANGLES,v,c,_,l,I,o.id,E,B,C)}function Xo(e){const t=e._nearZ,i=e.projection.farthestPixelDistance(e),r=i-t,n=.2*e.height,o=t+n;return[t,i,(o-n-t)/r,(o-t)/r]}function Yo(e,t,i,r){if(e)return t instanceof rt&&e instanceof bt?t.getTextureDescriptor(e,i,!0):{texture:e.texture,mix:Ko(r.mix),offset:r.offset,buffer:0,tileSize:1}}var Jo=e.dd([{name:"a_index",type:"Int16",components:1}]);class es{constructor(t,i,r,n){const o={width:r[0],height:r[1],data:null},s=t.gl;this.targetColorTexture=new e.T(t,o,s.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new e.T(t,o,s.RGBA8,{useMipmap:!1}),this.context=t,this.updateParticleTexture(i,n),this.lastInvalidatedAt=0}updateParticleTexture(t,i){if(this.particleTextureDimension===i.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const r=this.context.gl,n=i.width*i.height;this.particleTexture0=new e.T(this.context,i,r.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new e.T(this.context,i,r.RGBA8,{premultiply:!1,useMipmap:!1});const o=new e.de;o.reserve(n);for(let e=0;e<n;e++)o.emplaceBack(e);this.particleIndexBuffer=this.context.createVertexBuffer(o,Jo.members,!0),this.particleSegment=e.b8.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=i.width}update(t){return!(this.lastInvalidatedAt<t&&(this.lastInvalidatedAt=e.q.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function ts(t,i,r){if(!t)return null;const n=i.getTextureDescriptor(t,r,!0);if(!n)return null;let{texture:o,mix:s,offset:a,tileSize:l,buffer:c,format:u}=n;if(!o||!u)return null;let h=!1;return"uint32"===u&&(h=!0,s[3]=0,s=co(e.df,s,[0,r.paint.get("raster-particle-max-speed")]),a=uo(e.df,a,[0,r.paint.get("raster-particle-max-speed")])),{texture:o,textureOffset:[c/(l+2*c),l/(l+2*c)],tileSize:l,scalarData:h,scale:s,offset:a,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[u]]}}function is(e){const t=e._nearZ,i=e.projection.farthestPixelDistance(e),r=i-t,n=.2*e.height,o=t+n;return[t,i,(o-n-t)/r,(o-t)/r]}const rs=new e.al(1,0,0,1),ns=new e.al(0,1,0,1),os=new e.al(0,0,1,1),ss=new e.al(1,0,1,1),as=new e.al(0,1,1,1);function ls(t,i,r,n,o,s,a){const l=t.context,c=t.transform,u=l.gl,h="globe"===c.projection.name,d=h?["PROJECTION_GLOBE_VIEW"]:[];let p=e.ad.mat4.clone(r.projMatrix);if(h&&e.ag(c.zoom)>0){const t=e.bb(r.canonical,c),i=e.dg(t);p=e.ad.mat4.multiply(new Float32Array(16),c.globeMatrix,i),e.ad.mat4.multiply(p,c.projMatrix,p)}const f=e.ad.mat4.create();f[12]+=2*o/(e.q.devicePixelRatio*c.width),f[13]+=2*s/(e.q.devicePixelRatio*c.height),e.ad.mat4.multiply(p,f,p);const A=t.getOrCreateProgram("debug",{defines:d}),m=i.getTileByID(r.key);t.terrain&&t.terrain.setupElevationDraw(m,A);const g=Oi.disabled,_=Ni.disabled,y=t.colorModeForRenderPass(),v="$debug";l.activeTexture.set(u.TEXTURE0),t.emptyTexture.bind(u.LINEAR,u.CLAMP_TO_EDGE),h?m._makeGlobeTileDebugBuffers(t.context,c):m._makeDebugTileBoundsBuffers(t.context,c.projection);const x=m._tileDebugBuffer||t.debugBuffer,b=m._tileDebugIndexBuffer||t.debugIndexBuffer,w=m._tileDebugSegments||t.debugSegments;if(A.draw(t,u.LINE_STRIP,g,_,y,Vi.disabled,so(p,n),v,x,b,w,null,null,null,[m._globeTileDebugBorderBuffer]),a){const e=m.latestRawTileData,i=Math.floor((e&&e.byteLength||0)/1024);let n=r.canonical.toString();r.overscaledZ!==r.canonical.z&&(n+=` => ${r.overscaledZ}`),n+=` ${m.state}`,n+=` ${i}kb`,function(e,t){e.initDebugOverlayCanvas();const i=e.debugOverlayCanvas,r=e.context.gl,n=e.debugOverlayCanvas.getContext("2d");n.clearRect(0,0,i.width,i.height),n.shadowColor="white",n.shadowBlur=2,n.lineWidth=1.5,n.strokeStyle="white",n.textBaseline="top",n.font="bold 36px Open Sans, sans-serif",n.fillText(t,5,5),n.strokeText(t,5,5),e.debugOverlayTexture.update(i),e.debugOverlayTexture.bind(r.LINEAR,r.CLAMP_TO_EDGE)}(t,n)}const T=i.getTile(r).tileSize,B=512/Math.min(T,512)*(r.overscaledZ/c.zoom)*.5,C=m._tileDebugTextBuffer||t.debugBuffer,S=m._tileDebugTextIndexBuffer||t.quadTriangleIndexBuffer,E=m._tileDebugTextSegments||t.debugSegments;A.draw(t,u.TRIANGLES,g,_,Di.alphaBlended,Vi.disabled,so(p,e.al.transparent,B),v,C,S,E,null,null,null,[m._globeTileDebugTextBuffer])}function cs(e,t,i,r){hs(e,0,t+i/2,e.transform.width,i,r)}function us(e,t,i,r){hs(e,t-i/2,0,i,e.transform.height,r)}function hs(t,i,r,n,o,s){const a=t.context,l=a.gl;l.enable(l.SCISSOR_TEST),l.scissor(i*e.q.devicePixelRatio,r*e.q.devicePixelRatio,n*e.q.devicePixelRatio,o*e.q.devicePixelRatio),a.clear({color:s}),l.disable(l.SCISSOR_TEST)}const ds=e.dd([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:ps}=ds;function fs(e,t,i,r){e.emplaceBack(t,i,r)}class As{constructor(t){this.vertexArray=new e.dh,this.indices=new e.aV,fs(this.vertexArray,-1,-1,1),fs(this.vertexArray,1,-1,1),fs(this.vertexArray,-1,1,1),fs(this.vertexArray,1,1,1),fs(this.vertexArray,-1,-1,-1),fs(this.vertexArray,1,-1,-1),fs(this.vertexArray,-1,1,-1),fs(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=t.createVertexBuffer(this.vertexArray,ps),this.indexBuffer=t.createIndexBuffer(this.indices),this.segment=e.b8.simpleSegment(0,0,36,12)}}function ms(t,i,r,n,o,s){const a=t.context.gl,l=i.paint.get("sky-atmosphere-color"),c=i.paint.get("sky-atmosphere-halo-color"),u=i.paint.get("sky-atmosphere-sun-intensity"),h=((e,t,i,r,n)=>({u_matrix_3f:e,u_sun_direction:t,u_sun_intensity:i,u_color_tint_r:[r.r,r.g,r.b,r.a],u_color_tint_m:[n.r,n.g,n.b,n.a],u_luminance:5e-5}))(e.ad.mat3.fromMat4(e.ad.mat3.create(),n),o,u,l,c);a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_CUBE_MAP_POSITIVE_X+s,i.skyboxTexture,0),r.draw(t,a.TRIANGLES,Oi.disabled,Ni.disabled,Di.unblended,Vi.frontCW,h,"skyboxCapture",i.skyboxGeometry.vertexBuffer,i.skyboxGeometry.indexBuffer,i.skyboxGeometry.segment)}const gs=e.dd([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class _s{constructor(t){const i=new e.di;i.emplaceBack(-1,1,1,0,0),i.emplaceBack(1,1,1,1,0),i.emplaceBack(1,-1,1,1,1),i.emplaceBack(-1,-1,1,0,1);const r=new e.aV;r.emplaceBack(0,1,2),r.emplaceBack(2,3,0),this.vertexBuffer=t.createVertexBuffer(i,gs.members),this.indexBuffer=t.createIndexBuffer(r),this.segments=e.b8.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const ys=e.dd([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class vs{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class xs{constructor(t){this.colorModeAlphaBlendedWriteRGB=new Di([1,Ri,1,Ri],e.al.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new Di([1,0,1,0],e.al.transparent,[!1,!1,!1,!0]),this.params=new vs,this.updateNeeded=!0,t.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},(()=>{this.updateNeeded=!0})),t.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),t.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},(()=>{this.updateNeeded=!0})),t.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},(()=>{this.updateNeeded=!0}))}update(t){const i=t.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new _s(i);const t=this.params.sizeRange,r=this.params.intensityRange,n=function(t){const i=e.dl(30),r=[];for(let n=0;n<t;++n){const t=2*Math.PI*i(),n=Math.acos(1-2*i())-.5*Math.PI;r.push(e.ad.vec3.fromValues(Math.cos(n)*Math.cos(t),Math.cos(n)*Math.sin(t),Math.sin(n)))}return r}(this.params.starsCount),o=e.dl(300),s=new e.dj,a=new e.aV;let l=0;for(let i=0;i<n.length;++i){const c=e.ad.vec3.scale([],n[i],200),u=Math.max(0,1+.01*t*(1*o()-.5)),h=Math.max(0,1+.01*r*(1*o()-.5));s.emplaceBack(c[0],c[1],c[2],-1,-1,u,h),s.emplaceBack(c[0],c[1],c[2],1,-1,u,h),s.emplaceBack(c[0],c[1],c[2],1,1,u,h),s.emplaceBack(c[0],c[1],c[2],-1,1,u,h),a.emplaceBack(l+0,l+1,l+2),a.emplaceBack(l+0,l+2,l+3),l+=4}this.starsVx=i.createVertexBuffer(s,ys.members),this.starsIdx=i.createIndexBuffer(a),this.starsSegments=e.b8.simpleSegment(0,0,s.length,a.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(t,i){const r=t.context,n=r.gl,o=t.transform,s=new Oi(n.LEQUAL,Oi.ReadOnly,[0,1]),a=e.ag(o.zoom),l=t.style.getLut(i.scope),c="none"===i.properties.get("color-use-theme"),u=i.properties.get("color").toRenderColor(c?null:l).toArray01(),h="none"===i.properties.get("high-color-use-theme"),d=i.properties.get("high-color").toRenderColor(h?null:l).toArray01(),p="none"===i.properties.get("space-color-use-theme"),f=i.properties.get("space-color").toRenderColor(p?null:l).toArray01PremultipliedAlpha(),A=5e-4,m=e.dk(i.properties.get("horizon-blend"),0,1,A,.25),g=e.cD(t,r,o)&&m===A?o.worldSize/(2*Math.PI*1.025)-1:o.globeRadius,_=t.frameCounter/1e3%1,y=e.ad.vec3.length(o.globeCenterInViewSpace),v=Math.sqrt(Math.pow(y,2)-Math.pow(g,2)),x=Math.acos(v/y),b=e=>{const i="globe"===o.projection.name?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];e&&i.push("ALPHA_PASS");const l=t.getOrCreateProgram("globeAtmosphere",{defines:i}),c=((e,t,i,r,n,o,s,a,l,c,u,h)=>({u_frustum_tl:e,u_frustum_tr:t,u_frustum_br:i,u_frustum_bl:r,u_horizon:n,u_transition:o,u_fadeout_range:s,u_color:a,u_high_color:l,u_space_color:c,u_temporal_offset:u,u_horizon_angle:h}))(o.frustumCorners.TL,o.frustumCorners.TR,o.frustumCorners.BR,o.frustumCorners.BL,o.frustumCorners.horizon,a,m,u,d,f,_,x);t.uploadCommonUniforms(r,l);const h=this.atmosphereBuffer;h&&l.draw(t,n.TRIANGLES,s,Ni.disabled,e?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,Vi.backCW,c,e?"atmosphere_glow_alpha":"atmosphere_glow",h.vertexBuffer,h.indexBuffer,h.segments)};b(!1),b(!0)}drawStars(t,i){const r=e.ay(i.properties.get("star-intensity"),0,1);if(0===r)return;const n=t.context,o=n.gl,s=t.transform,a=t.getOrCreateProgram("stars"),l=e.ad.quat.identity([]);e.ad.quat.rotateX(l,l,-s._pitch),e.ad.quat.rotateZ(l,l,-s.angle),e.ad.quat.rotateX(l,l,e.ak(s._center.lat)),e.ad.quat.rotateY(l,l,-e.ak(s._center.lng));const c=e.ad.mat4.fromQuat(new Float32Array(16),l),u=e.ad.mat4.multiply([],s.starsProjMatrix,c),h=e.ad.mat3.fromMat4([],c),d=e.ad.mat3.invert([],h),p=[0,1,0];e.ad.vec3.transformMat3(p,p,d),e.ad.vec3.scale(p,p,this.params.sizeMultiplier);const f=[1,0,0];e.ad.vec3.transformMat3(f,f,d),e.ad.vec3.scale(f,f,this.params.sizeMultiplier);const A=(m=p,g=f,_=r,{u_matrix:Float32Array.from(u),u_up:m,u_right:g,u_intensity_multiplier:_});var m,g,_;t.uploadCommonUniforms(n,a),this.starsVx&&this.starsIdx&&a.draw(t,o.TRIANGLES,Oi.disabled,Ni.disabled,this.colorModeAlphaBlendedWriteRGB,Vi.disabled,A,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function bs(t,i){const r=[...t],n=i.cameraWorldSizeForFog/i.worldSize,o=e.ad.mat4.identity([]);return e.ad.mat4.scale(o,o,[n,n,1]),e.ad.mat4.multiply(r,o,r),e.ad.mat4.multiply(r,i.worldToFogMatrix,r),r}function ws(t,i,r,n,o){const s=r.material,a=n.context,{baseColorTexture:l,metallicRoughnessTexture:c}=s.pbrMetallicRoughness,{normalTexture:u,occlusionTexture:h,emissionTexture:d}=s;function p(e,i,r){if(e&&(t.push(i),a.activeTexture.set(a.gl.TEXTURE0+r),e.gfxTexture)){const{minFilter:t,magFilter:i,wrapS:r,wrapT:n}=e.sampler;e.gfxTexture.bindExtraParam(t,i,r,n)}}p(l,"HAS_TEXTURE_u_baseColorTexture",Ki.BaseColor),p(c,"HAS_TEXTURE_u_metallicRoughnessTexture",Ki.MetallicRoughness),p(u,"HAS_TEXTURE_u_normalTexture",Ki.Normal),p(h,"HAS_TEXTURE_u_occlusionTexture",Ki.Occlusion),p(d,"HAS_TEXTURE_u_emissionTexture",Ki.Emission),o&&(o.texture||(o.texture=new e.dn(n.context,o.image,[o.image.height,o.image.height,o.image.height],a.gl.RGBA8)),a.activeTexture.set(a.gl.TEXTURE0+Ki.LUT),o.texture&&o.texture.bind(a.gl.LINEAR,a.gl.CLAMP_TO_EDGE),t.push("APPLY_LUT_ON_GPU")),r.texcoordBuffer&&(t.push("HAS_ATTRIBUTE_a_uv_2f"),i.push(r.texcoordBuffer)),r.colorBuffer&&(t.push(12===r.colorBuffer.itemSize?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),i.push(r.colorBuffer)),r.normalBuffer&&(t.push("HAS_ATTRIBUTE_a_normal_3f"),i.push(r.normalBuffer)),r.pbrBuffer&&(t.push("HAS_ATTRIBUTE_a_pbr"),t.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),i.push(r.pbrBuffer)),"OPAQUE"!==s.alphaMode&&"MASK"!==s.alphaMode||t.push("UNPREMULT_TEXTURE_IN_SHADER"),s.defined||t.push("DIFFUSE_SHADED");const f=n.shadowRenderer;f&&(t.push("RENDER_SHADOWS","DEPTH_TEXTURE"),f.useNormalOffset&&t.push("NORMAL_OFFSET"))}function Ts(t,i,r,n,o,s){const a=r.paint.get("model-opacity").constantOr(1),l=i.context,c=new Oi(i.context.gl.LEQUAL,Oi.ReadWrite,i.depthRangeFor3D),u=i.transform,h=t.mesh,d=h.material,p=d.pbrMetallicRoughness,f=i.style.fog;let A;A="pixels"===i.transform.projection.zAxisUnit?[...t.nodeModelMatrix]:e.ad.mat4.multiply([],n.zScaleMatrix,t.nodeModelMatrix),e.ad.mat4.multiply(A,n.negCameraPosMatrix,A);const m=e.ad.mat4.invert([],A);e.ad.mat4.transpose(m,m);const g="none"===r.paint.get("model-color-use-theme").constantOr("default"),_=r.paint.get("model-emissive-strength").constantOr(0),y=wo(new Float32Array(t.worldViewProjection),new Float32Array(A),new Float32Array(m),null,i,a,p.baseColorFactor.toRenderColor(null),d.emissiveFactor,p.metallicFactor,p.roughnessFactor,d,_,r),v={defines:[]},x=[],b=i.shadowRenderer;b&&(b.useNormalOffset=!1),ws(v.defines,x,h,i,g?null:r.lut);let w=null;if(f){const e=bs(t.nodeModelMatrix,i.transform);if(w=new Float32Array(e),"globe"!==u.projection.name){const t=h.aabb.min,i=h.aabb.max,[r,n]=f.getOpacityForBounds(e,t[0],t[1],i[0],i[1]);v.overrideFog=r>=Re||n>=Re}}const T=Ji(i,r.paint.get("model-cutoff-fade-range"));T.shouldRenderCutoff&&v.defines.push("RENDER_CUTOFF");const B=i.getOrCreateProgram("model",v);i.uploadCommonUniforms(l,B,null,w,T),"shadow"!==i.renderPass&&b&&b.setupShadowsFromMatrix(t.nodeModelMatrix,B),B.draw(i,l.gl.TRIANGLES,c,o,s,h.material.doubleSided?Vi.disabled:Vi.backCCW,y,r.id,h.vertexBuffer,h.indexBuffer,h.segments,r.paint,i.transform.zoom,void 0,x)}function Bs(t,i,r,n,o,s,a){let l;l="globe"===t.projection.name?e.dp(r,t):[...r],e.ad.mat4.multiply(l,l,i.matrix);const c=e.ad.mat4.multiply([],n,l);if(i.meshes)for(const r of i.meshes){if("BLEND"!==r.material.alphaMode){a.push({mesh:r,depth:0,modelIndex:o,worldViewProjection:c,nodeModelMatrix:l});continue}const i=e.ad.vec3.transformMat4([],r.centroid,c);!t.isOrthographic&&i[2]<=0||s.push({mesh:r,depth:i[2],modelIndex:o,worldViewProjection:c,nodeModelMatrix:l})}if(i.children)for(const e of i.children)Bs(t,e,r,n,o,s,a)}function Cs(e,t,i,r){const n=i.shadowRenderer;if(!n)return;const o=n.getShadowPassDepthMode(),s=n.getShadowPassColorMode(),a=n.calculateShadowPassMatrixFromMatrix(t),l=To(a);i.getOrCreateProgram("modelDepth",{defines:i._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(i,i.context.gl.TRIANGLES,o,Ni.disabled,s,Vi.backCCW,l,r.id,e.vertexBuffer,e.indexBuffer,e.segments,r.paint,i.transform.zoom,void 0,void 0)}function Ss(t,i,r){const n=i.updateZoomBasedPaintProperties(),o=function(t,i,r){let n,o,s,a=t.terrain?t.terrain.exaggeration():0;if(t.terrain&&a>0){const i=t.terrain,o=i.findDEMTileFor(r);o&&o.dem?n=e.dr.create(i,r,o):a=0}if(0===a&&(i.terrainElevationMin=0,i.terrainElevationMax=0),a===i.validForExaggeration&&(0===a||n&&n._demTile&&n._demTile.tileID===i.validForDEMTile.id&&n._dem._timestamp===i.validForDEMTile.timestamp))return!1;for(const e in i.instancesPerModel){const t=i.instancesPerModel[e];for(let e=0;e<t.instancedDataArray.length;++e){const r=(n?a*n.getElevationAt(0|t.instancedDataArray.float32[16*e],0|t.instancedDataArray.float32[16*e+1],!0,!0):0)+t.instancesEvaluatedElevation[e];t.instancedDataArray.float32[16*e+6]=r,o=o?Math.min(i.terrainElevationMin,r):r,s=s?Math.max(i.terrainElevationMax,r):r}}return i.terrainElevationMin=o||0,i.terrainElevationMax=s||0,i.validForExaggeration=a,i.validForDEMTile=n&&n._demTile?{id:n._demTile.tileID,timestamp:n._dem._timestamp}:{id:void 0,timestamp:0},!0}(t,i,r);(n||o)&&(i.uploaded=!1,i.upload(t.context))}const Es={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new e.ce([0,0,0],[e.ai,e.ai,0])};function Ms(t,i){const r=1<<t.canonical.z,n=i.getFreeCameraOptions().position,o=i.elevation,s=t.canonical.x/r,a=(t.canonical.x+1)/r,l=t.canonical.y/r,c=(t.canonical.y+1)/r;let u=i._centerAltitude;if(o){const e=o.getMinMaxForTile(t);e&&e.max>u&&(u=e.max)}const h=e.ay(n.x,s,a)-n.x,d=e.ay(n.y,l,c)-n.y,p=e.bH(u,i.center.lat)-n.z;return i._zoomFromMercatorZ(Math.sqrt(h*h+d*d+p*p))}function Is(e,t,i,r,n,o,s){const a=e.context,l="shadow"===e.renderPass,c=e.shadowRenderer,u=l&&c?c.getShadowPassDepthMode():new Oi(a.gl.LEQUAL,Oi.ReadWrite,e.depthRangeFor3D),h=e.isTileAffectedByFog(o);if(i.meshes)for(const d of i.meshes){const p=["MODEL_POSITION_ON_GPU"],f=[];let A,m,g;r.instancedDataArray.length>20&&p.push("INSTANCED_ARRAYS");const _=Ji(e,t.paint.get("model-cutoff-fade-range"));if(_.shouldRenderCutoff&&p.push("RENDER_CUTOFF"),l&&c)A=e.getOrCreateProgram("modelDepth",{defines:p}),m=To(s.shadowTileMatrix,s.shadowTileMatrix,Float32Array.from(i.matrix)),g=c.getShadowPassColorMode();else{ws(p,f,d,e,"none"===t.paint.get("model-color-use-theme").constantOr("default")?null:t.lut),A=e.getOrCreateProgram("model",{defines:p,overrideFog:h});const r=d.material,l=r.pbrMetallicRoughness,u=t.paint.get("model-opacity").constantOr(1),y=t.paint.get("model-emissive-strength").constantOr(0);m=wo(o.expandedProjMatrix,Float32Array.from(i.matrix),new Float32Array(16),null,e,u,l.baseColorFactor.toRenderColor(null),r.emissiveFactor,l.metallicFactor,l.roughnessFactor,r,y,t,n),c&&(s.shadowUniformsInitialized?A.setShadowUniformValues(a,c.getShadowUniformValues()):(c.setupShadows(o.toUnwrapped(),A,"model-tile",o.overscaledZ),s.shadowUniformsInitialized=!0)),g=_.shouldRenderCutoff||u<1||"OPAQUE"!==r.alphaMode?Di.alphaBlended:Di.unblended}e.uploadCommonUniforms(a,A,o.toUnwrapped(),null,_);const y=d.material.doubleSided?Vi.disabled:Vi.backCCW;if(r.instancedDataArray.length>20)f.push(r.instancedDataBuffer),A.draw(e,a.gl.TRIANGLES,u,Ni.disabled,g,y,m,t.id,d.vertexBuffer,d.indexBuffer,d.segments,t.paint,e.transform.zoom,void 0,f,r.instancedDataArray.length);else{const i=l?"u_instance":"u_normal_matrix";for(let n=0;n<r.instancedDataArray.length;++n)m[i]=new Float32Array(r.instancedDataArray.arrayBuffer,64*n,16),A.draw(e,a.gl.TRIANGLES,u,Ni.disabled,g,y,m,t.id,d.vertexBuffer,d.indexBuffer,d.segments,t.paint,e.transform.zoom,void 0,f)}}if(i.children)for(const a of i.children)Is(e,t,a,r,n,o,s)}const Ps=[1,-1,1];function Ls(t,i,r,n){if(!r.modelManager)return!0;const o=r.modelManager;if(!r.shadowRenderer)return!0;const s=r.shadowRenderer,a=i.aabb;let l=!0,c=t.maxHeight;if(0===c){let e=0;for(const i in t.instancesPerModel){const t=o.getModel(i,n);t?e=Math.max(e,Math.max(Math.max(t.aabb.max[0],t.aabb.max[1]),t.aabb.max[2])):l=!1}c=t.maxScale*e*1.41+t.maxVerticalOffset,l&&(t.maxHeight=c)}a.max[2]=c,a.min[2]+=t.terrainElevationMin,a.max[2]+=t.terrainElevationMax,e.ad.vec3.transformMat4(a.min,a.min,i.tileMatrix),e.ad.vec3.transformMat4(a.max,a.max,i.tileMatrix);const u=a.intersects(s.getCurrentCascadeFrustum());return 0===r.currentShadowCascade&&(t.isInsideFirstShadowMapFrustum=2===u),0===u}function Fs(t,i){const r=t.uniformValues.u_cutoff_params[0],n=t.uniformValues.u_cutoff_params[1],o=t.uniformValues.u_cutoff_params[2],s=t.uniformValues.u_cutoff_params[3];return n===r||s===o?1:e.ay(((i-r)/(n-r)-o)/(s-o),0,1)}function ks(t,i,r,n){if(i.pitch<20)return 1;const o=i.getWorldToCameraMatrix();e.ad.mat4.multiply(o,o,t);const s=e.ad.vec4.fromValues(r.min[0],r.min[1],r.min[2],1);let a=e.ad.vec4.transformMat4(e.ad.vec4.create(),s,o),l=a,c=a;s[1]=r.max[1],a=e.ad.vec4.transformMat4(e.ad.vec4.create(),s,o),l=a[1]<l[1]?a:l,c=a[1]>c[1]?a:c,s[0]=r.max[0],a=e.ad.vec4.transformMat4(e.ad.vec4.create(),s,o),l=a[1]<l[1]?a:l,c=a[1]>c[1]?a:c,s[1]=r.min[1],a=e.ad.vec4.transformMat4(e.ad.vec4.create(),s,o),l=a[1]<l[1]?a:l,c=a[1]>c[1]?a:c;const u=e.ay(n[0],0,1),h=100*i.pixelsPerMeter*e.ay(n[1],0,1),d=e.ay(n[2],0,1),p=e.ad.vec4.lerp(e.ad.vec4.create(),l,c,u),f=Math.tan(.5*i.fovX),A=-p[2]*f;if(0===h)return p[1]<-Math.abs(A)?d:1;const m=(-Math.abs(A)-p[1])/h,g=(e,t,i)=>(1-i)*e+i*t,_=e.ay(g(1,d,m),d,1);return g(1,_,e.ay((i.pitch-20)/20,0,1))}class zs{}class Rs{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(t,i,r){{const e=this._storage.get(i.id);if(e)return e.lastUsedFrameIdx=t,e.buf}const n=r.gl,o=n.getBufferParameter(n.ELEMENT_ARRAY_BUFFER,n.BUFFER_SIZE),s=new ArrayBuffer(o),a=new Int16Array(s);n.getBufferSubData(n.ELEMENT_ARRAY_BUFFER,0,new Int16Array(s));const l=new e.dt;for(let e=0;e<o/2;e+=3){const t=a[e],i=a[e+1],r=a[e+2];l.emplaceBack(t,i),l.emplaceBack(i,r),l.emplaceBack(r,t)}const c=r.bindVertexArrayOES.current,u=new zs;return u.buf=new Co(r,l),u.lastUsedFrameIdx=t,this._storage.set(i.id,u),r.bindVertexArrayOES.set(c),u.buf}update(e){for(const[t,i]of this._storage)e-i.lastUsedFrameIdx>30&&(i.buf.destroy(),this._storage.delete(t))}destroy(){for(const[e,t]of this._storage)t.buf.destroy(),this._storage.delete(e)}}class Ds{constructor(e){this.occluderSize=30,this.depthOffset=-1e-4,e.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),e.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}const Os=e.dd([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class Us{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}class Ns{constructor(e,t){this.revealStart=11,this.revealRange=2,e.registerParameter(this,[...t,"Reveal"],"revealStart",{min:0,max:17,step:.05}),e.registerParameter(this,[...t,"Reveal"],"revealRange",{min:.1,max:5.1,step:.05})}}const Qs=e.dd([{type:"Float32",name:"a_pos_2f",components:2}]);class js{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(t,i){const r=t.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const i=new e.du,r=new e.aV;i.emplaceBack(-1,-1),i.emplaceBack(1,-1),i.emplaceBack(1,1),i.emplaceBack(-1,1),r.emplaceBack(0,1,2),r.emplaceBack(0,2,3),this.vignetteVx=t.context.createVertexBuffer(i,Qs.members),this.vignetteIdx=t.context.createIndexBuffer(r)}const n=e.b8.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){t.uploadCommonUniforms(t.context,r);const e={u_vignetteShape:(o={vignetteShape:[i.start,i.range,Math.pow(10,i.fadePower)],vignetteColor:[i.color.r,i.color.g,i.color.b,i.color.a*i.strength]}).vignetteShape,u_vignetteColor:o.vignetteColor};r.draw(t,t.context.gl.TRIANGLES,Oi.disabled,Ni.disabled,Di.alphaBlended,Vi.disabled,e,"vignette",this.vignetteVx,this.vignetteIdx,n)}var o}}class Vs{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(t,i){const r=t.getFreeCameraOptions().position,n=r.toAltitude(),o=r.toLngLat(),s=e.ak(o.lng),a=e.ak(o.lat),l=t.pixelsPerMeter/i,c=s*e.dv,u=e.dv*Math.log(Math.tan(Math.PI/4+a/2));if(void 0===this._offsetXPrev)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const e=-this._offsetYPrev+u,t=-this._elevationPrev+n;this._accumulatedOffsetX+=(-this._offsetXPrev+c)*l,this._accumulatedOffsetY+=e*l,this._accumulatedElevation+=t*l,this._offsetXPrev=c,this._offsetYPrev=u,this._elevationPrev=n}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function Hs(e,t){return[-(e[0]-Math.floor(e[0]/t)*t),-(e[1]-Math.floor(e[1]/t)*t),-(e[2]-Math.floor(e[2]/t)*t)]}function Gs(t){const i=e.dl(1323123451230),r=[];for(let n=0;n<t;++n){const t=2*i()-1,n=2*i()-1,o=2*i()-1;r.push(e.ad.vec3.fromValues(t,n,o))}return r}function $s(t,i,r,n,o){const s=e.ay((o-r)/(n-r),0,1);return(1-s)*t+s*i}class Zs{constructor(e){this._movement=new Vs,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new js,this._ppmScaleFactor=e}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(t,i){const r=t.transform;this._movement.update(r,this._ppmScaleFactor);const n=r.starsProjMatrix,o=e.ad.quat.identity([]);e.ad.quat.rotateX(o,o,e.ak(90)-r._pitch),e.ad.quat.rotateZ(o,o,-r.angle);const s=e.ad.mat4.fromQuat(new Float32Array(16),o),a=e.ad.mat4.fromValues(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),l=e.ad.mat4.transpose([],a),c=e.ad.mat4.multiply([],l,s),u=Date.now()/1e3;return this._accumulatedTimeFromStart+=(u-this._prevTime)*i,this._prevTime=u,{projectionMatrix:n,modelviewMatrix:c}}}class qs extends Zs{constructor(e){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new Ns(e.tp,["Precipitation","Rain"]),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(t){const i=t.context;if(!this.particlesVx){const t=Gs(this.particlesCount),r=new e.dw,n=new e.aV;let o=0;const s=e.dl(1323123451230);for(let e=0;e<t.length;++e){const i=t[e],a=[2*s()-1,s(),s(),s()];r.emplaceBack(i[0],i[1],i[2],-1,-1,...a),r.emplaceBack(i[0],i[1],i[2],1,-1,...a),r.emplaceBack(i[0],i[1],i[2],1,1,...a),r.emplaceBack(i[0],i[1],i[2],-1,1,...a),n.emplaceBack(o+0,o+1,o+2),n.emplaceBack(o+0,o+2,o+3),o+=4}this.particlesVx=i.createVertexBuffer(r,Os.members),this.particlesIdx=i.createIndexBuffer(n)}}draw(t){if(!this._params.overrideStyleParameters&&!t.style.rain)return;const i=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},r=t.transform.zoom;if(i.revealStart>r)return;const n=$s(0,1,i.revealStart,i.revealStart+i.revealRange,r);if(!this.particlesVx||!this.particlesIdx)return;const o=structuredClone(this._params);let s=[-o.direction.x,o.direction.y,-100];e.ad.vec3.normalize(s,s);const a=structuredClone(this._vignetteParams);a.strength*=n,o.overrideStyleParameters||(o.intensity=t.style.rain.state.density,o.timeFactor=t.style.rain.state.intensity,o.color=structuredClone(t.style.rain.state.color),s=structuredClone(t.style.rain.state.direction),o.screenThinning.intensity=t.style.rain.state.centerThinning,o.dropletSizeX=t.style.rain.state.dropletSize[0],o.dropletSizeYScale=t.style.rain.state.dropletSize[1]/t.style.rain.state.dropletSize[0],o.distortionStrength=100*t.style.rain.state.distortionStrength,a.strength=1,a.color=structuredClone(t.style.rain.state.vignetteColor));const l=this.updateOnRender(t,o.timeFactor),c=t.context,u=c.gl,h=t.transform;this.screenTexture&&this.screenTexture.size[0]===t.width&&this.screenTexture.size[1]===t.height||(this.screenTexture=new e.T(c,{width:t.width,height:t.height,data:null},u.RGBA8)),o.distortionStrength>0&&(c.activeTexture.set(u.TEXTURE0),this.screenTexture.bind(u.LINEAR,u.CLAMP_TO_EDGE),u.copyTexSubImage2D(u.TEXTURE_2D,0,0,0,0,0,t.width,t.height));const d=t.getOrCreateProgram("rainParticle");t.uploadCommonUniforms(c,d),c.activeTexture.set(u.TEXTURE0),this.screenTexture.bind(u.LINEAR,u.CLAMP_TO_EDGE);const p=[o.color.r,o.color.g,o.color.b,o.color.a],f=(i,r)=>{const n=Hs(this._movement.getPosition(),i),a=o.dropletSizeX,c=o.dropletSizeX*o.dropletSizeYScale,f=t.width/2,A=t.height/2,m=$s(0,o.screenThinning.start,0,1,o.screenThinning.intensity),g=$s(.001,o.screenThinning.range,0,1,o.screenThinning.intensity),_=$s(0,o.screenThinning.particleOffset,0,1,o.screenThinning.intensity),y=(v={modelview:l.modelviewMatrix,projection:l.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:n,velocityConeAperture:o.velocityConeAperture,velocity:o.velocity,boxSize:i,rainDropletSize:[a,c],distortionStrength:o.distortionStrength,rainDirection:s,color:p,screenSize:[h.width,h.height],thinningCenterPos:[f,A],thinningShape:[m,g,Math.pow(10,o.screenThinning.fadePower)],thinningAffectedRatio:o.screenThinning.affectedRatio,thinningParticleOffset:_,shapeDirectionalPower:o.shapeDirPower,shapeNormalPower:o.shapeNormalPower,mode:r?0:1},{u_modelview:Float32Array.from(v.modelview),u_projection:Float32Array.from(v.projection),u_time:v.time,u_cam_pos:v.camPos,u_texScreen:0,u_velocityConeAperture:v.velocityConeAperture,u_velocity:v.velocity,u_boxSize:v.boxSize,u_rainDropletSize:v.rainDropletSize,u_distortionStrength:v.distortionStrength,u_rainDirection:v.rainDirection,u_color:v.color,u_screenSize:v.screenSize,u_thinningCenterPos:v.thinningCenterPos,u_thinningShape:v.thinningShape,u_thinningAffectedRatio:v.thinningAffectedRatio,u_thinningParticleOffset:v.thinningParticleOffset,u_shapeDirectionalPower:v.shapeDirectionalPower,u_shapeNormalPower:v.shapeNormalPower,u_mode:v.mode});var v;const x=Math.round(o.intensity*this.particlesCount),b=e.b8.simpleSegment(0,0,4*x,2*x);d.draw(t,u.TRIANGLES,Oi.disabled,Ni.disabled,Di.alphaBlended,Vi.disabled,y,"rain_particles",this.particlesVx,this.particlesIdx,b)};o.distortionStrength>0&&f(o.boxSize,!0),f(o.boxSize,!1),this._vignette.draw(t,a)}}const Ks=e.dd([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class Ws extends Zs{constructor(e){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new Ns(e.tp,["Precipitation","Snow"]),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(t){const i=t.context;if(!this.particlesVx){const t=Gs(this.particlesCount),r=new e.dx,n=new e.aV;let o=0;const s=e.dl(1323123451230);for(let e=0;e<t.length;++e){const i=t[e],a=s(),l=s(),c=s(),u=[e/t.length,a,l,c],h=[s(),s()];r.emplaceBack(i[0],i[1],i[2],-1,-1,...u,...h),r.emplaceBack(i[0],i[1],i[2],1,-1,...u,...h),r.emplaceBack(i[0],i[1],i[2],1,1,...u,...h),r.emplaceBack(i[0],i[1],i[2],-1,1,...u,...h),n.emplaceBack(o+0,o+1,o+2),n.emplaceBack(o+0,o+2,o+3),o+=4}this.particlesVx=i.createVertexBuffer(r,Ks.members),this.particlesIdx=i.createIndexBuffer(n)}}draw(t){if(!this._params.overrideStyleParameters&&!t.style.snow)return;const i=structuredClone(this._params);let r=[-i.direction.x,i.direction.y,-100];e.ad.vec3.normalize(r,r);const n=structuredClone(this._vignetteParams),o=i.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},s=t.transform.zoom;if(o.revealStart>s)return;const a=$s(0,1,o.revealStart,o.revealStart+o.revealRange,s);n.strength*=a,i.overrideStyleParameters||(i.intensity=t.style.snow.state.density,i.timeFactor=t.style.snow.state.intensity,i.color=structuredClone(t.style.snow.state.color),r=structuredClone(t.style.snow.state.direction),i.screenThinning.intensity=t.style.snow.state.centerThinning,i.billboardSize=2.79*t.style.snow.state.flakeSize,n.strength=1,n.color=structuredClone(t.style.snow.state.vignetteColor));const l=this.updateOnRender(t,i.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const c=t.context,u=c.gl,h=t.transform,d=t.getOrCreateProgram("snowParticle");t.uploadCommonUniforms(c,d),((i,n,o)=>{const s=Hs(this._movement.getPosition(),i),a=h.width/2,c=h.height/2,p=$s(0,o.screenThinning.start,0,1,o.screenThinning.intensity),f=$s(.001,o.screenThinning.range,0,1,o.screenThinning.intensity),A=$s(0,o.screenThinning.particleOffset,0,1,o.screenThinning.intensity),m=(g={modelview:l.modelviewMatrix,projection:l.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:s,velocityConeAperture:o.velocityConeAperture,velocity:o.velocity,horizontalOscillationRadius:o.horizontalOscillationRadius,horizontalOscillationRate:o.horizontalOscillationRate,boxSize:i,billboardSize:1*o.billboardSize,simpleShapeParameters:[o.shapeFadeStart,o.shapeFadePower],screenSize:[h.width,h.height],thinningCenterPos:[a,c],thinningShape:[p,f,Math.pow(10,o.screenThinning.fadePower)],thinningAffectedRatio:o.screenThinning.affectedRatio,thinningParticleOffset:A,color:[o.color.r,o.color.g,o.color.b,o.color.a],direction:r},{u_modelview:Float32Array.from(g.modelview),u_projection:Float32Array.from(g.projection),u_time:g.time,u_cam_pos:g.camPos,u_velocityConeAperture:g.velocityConeAperture,u_velocity:g.velocity,u_horizontalOscillationRadius:g.horizontalOscillationRadius,u_horizontalOscillationRate:g.horizontalOscillationRate,u_boxSize:g.boxSize,u_billboardSize:g.billboardSize,u_simpleShapeParameters:g.simpleShapeParameters,u_screenSize:g.screenSize,u_thinningCenterPos:g.thinningCenterPos,u_thinningShape:g.thinningShape,u_thinningAffectedRatio:g.thinningAffectedRatio,u_thinningParticleOffset:g.thinningParticleOffset,u_particleColor:g.color,u_direction:g.direction});var g;const _=Math.round(o.intensity*this.particlesCount),y=e.b8.simpleSegment(0,0,4*_,2*_);this.particlesVx&&this.particlesIdx&&d.draw(t,u.TRIANGLES,Oi.disabled,Ni.disabled,Di.alphaBlended,Vi.disabled,m,"snow_particles",this.particlesVx,this.particlesIdx,y)})(i.boxSize,0,i),this._vignette.draw(t,n)}}const Xs={symbol:function(t,i,r,n,o){if("translucent"!==t.renderPass)return;const s=Ni.disabled,a=t.colorModeForRenderPass(),l=r.layout.get("text-variable-anchor"),c=r.layout.get("text-size-scale-range"),u=e.ay(t.scaleFactor,c[0],c[1]);l&&function(t,i,r,n,o,s,a,l){const c=i.transform,u="map"===o,h="map"===s;for(const i of t){const t=n.getTile(i),o=t.getBucket(r);if(!o||!o.text||!o.text.segments.get().length)continue;const s=e.bp(o.textSizeData,c.zoom,l),d=ci(i,o.getProjection(),c),p=c.calculatePixelsToTileUnitsMatrix(t),f=Ht(d,t.tileID.canonical,h,u,c,o.getProjection(),p),A=o.hasIconTextFit()&&o.hasIconData();if(s){const r=Math.pow(2,c.zoom-t.tileID.overscaledZ);Ro(o,u,h,a,e.cY,c,f,i,r,s,A)}}}(n,t,r,i,r.layout.get("text-rotation-alignment"),r.layout.get("text-pitch-alignment"),o,u);const h=0!==r.paint.get("icon-opacity").constantOr(1),d=0!==r.paint.get("text-opacity").constantOr(1);void 0!==r.layout.get("symbol-sort-key").constantOr(1)&&(h||d)?Do(t,i,r,n,s,a):(h&&Do(t,i,r,n,s,a,{onlyIcons:!0}),d&&Do(t,i,r,n,s,a,{onlyText:!0})),i.map.showCollisionBoxes&&(Lo(t,i,r,n,r.paint.get("text-translate"),r.paint.get("text-translate-anchor"),!0),Lo(t,i,r,n,r.paint.get("icon-translate"),r.paint.get("icon-translate-anchor"),!1))},circle:function(t,i,r,n){if("translucent"!==t.renderPass)return;const o=r.paint.get("circle-opacity"),s=r.paint.get("circle-stroke-width"),a=r.paint.get("circle-stroke-opacity"),l=void 0!==r.layout.get("circle-sort-key").constantOr(1),c=r.paint.get("circle-emissive-strength");if(0===o.constantOr(1)&&(0===s.constantOr(1)||0===a.constantOr(1)))return;const u=t.context,h=u.gl,d=t.transform,p=t.depthModeForSublayer(0,Oi.ReadOnly),f=Ni.disabled,A=t.colorModeForDrapableLayerRenderPass(c),m="globe"===d.projection.name,g=[e.av(d.center.lng),e.aC(d.center.lat)],_=[];for(let o=0;o<n.length;o++){const s=n[o],a=i.getTile(s),c=a.getBucket(r);if(!c||c.projection.name!==d.projection.name)continue;const u=c.programConfigurations.get(r.id),h=e.cZ(r),p=t.isTileAffectedByFog(s);m&&h.push("PROJECTION_GLOBE_VIEW"),h.push("DEPTH_D24"),t.terrain&&d.depthOcclusionForSymbolsAndCircles&&h.push("DEPTH_OCCLUSION");const f=t.getOrCreateProgram("circle",{config:u,defines:h,overrideFog:p}),A=c.layoutVertexBuffer,y=c.globeExtVertexBuffer,v=c.indexBuffer,x=d.projection.createInversionMatrix(d,s.canonical),b={programConfiguration:u,program:f,layoutVertexBuffer:A,globeExtVertexBuffer:y,indexBuffer:v,uniformValues:e.c_(t,s,a,x,g,r),tile:a};if(l){const t=c.segments.get();for(const i of t)_.push({segments:new e.b8([i]),sortKey:i.sortKey,state:b})}else _.push({segments:c.segments,sortKey:0,state:b})}l&&_.sort(((e,t)=>e.sortKey-t.sortKey));const y={useDepthForOcclusion:d.depthOcclusionForSymbolsAndCircles};for(const e of _){const{programConfiguration:i,program:n,layoutVertexBuffer:o,globeExtVertexBuffer:s,indexBuffer:a,uniformValues:l,tile:c}=e.state,m=e.segments;t.terrain&&t.terrain.setupElevationDraw(c,n,y),t.uploadCommonUniforms(u,n,c.tileID.toUnwrapped()),n.draw(t,h.TRIANGLES,p,f,A,Vi.disabled,l,r.id,o,a,m,r.paint,d.zoom,i,[s])}},heatmap:function(t,i,r,n){if(0!==r.paint.get("heatmap-opacity"))if("offscreen"===t.renderPass){const o=t.context,s=o.gl,a=Ni.disabled,l=new Di([s.ONE,s.ONE,s.ONE,s.ONE],e.al.transparent,[!0,!0,!0,!0]);!function(e,t,i,r){const n=e.gl,o=t.width*r,s=t.height*r;e.activeTexture.set(n.TEXTURE1),e.viewport.set([0,0,o,s]);let a=i.heatmapFbo;if(!a||a&&(a.width!==o||a.height!==s)){a&&a.destroy();const t=n.createTexture();n.bindTexture(n.TEXTURE_2D,t),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR),a=i.heatmapFbo=e.createFramebuffer(o,s,!0,null),function(e,t,i,r,n,o){const s=e.gl;s.texImage2D(s.TEXTURE_2D,0,e.extRenderToTextureHalfFloat?s.RGBA16F:s.RGBA,n,o,0,s.RGBA,e.extRenderToTextureHalfFloat?s.HALF_FLOAT:s.UNSIGNED_BYTE,null),r.colorAttachment.set(i)}(e,0,t,a,o,s)}else n.bindTexture(n.TEXTURE_2D,a.colorAttachment.get()),e.bindFramebuffer.set(a.framebuffer)}(o,t,r,"globe"===t.transform.projection.name?.5:.25),o.clear({color:e.al.transparent});const c=t.transform,u="globe"===c.projection.name,h=u?["PROJECTION_GLOBE_VIEW"]:[],d=u?Vi.frontCCW:Vi.disabled,p=[e.av(c.center.lng),e.aC(c.center.lat)];for(let e=0;e<n.length;e++){const f=n[e];if(i.hasRenderableParent(f))continue;const A=i.getTile(f),m=A.getBucket(r);if(!m||m.projection.name!==c.projection.name)continue;const g=t.isTileAffectedByFog(f),_=m.programConfigurations.get(r.id),y=t.getOrCreateProgram("heatmap",{config:_,defines:h,overrideFog:g}),{zoom:v}=t.transform;t.terrain&&t.terrain.setupElevationDraw(A,y),t.uploadCommonUniforms(o,y,f.toUnwrapped());const x=c.projection.createInversionMatrix(c,f.canonical);y.draw(t,s.TRIANGLES,Oi.disabled,a,l,d,lo(t,f,A,x,p,v,r.paint.get("heatmap-intensity")),r.id,m.layoutVertexBuffer,m.indexBuffer,m.segments,r.paint,t.transform.zoom,_,u?[m.globeExtVertexBuffer]:null)}o.viewport.set([0,0,t.width,t.height])}else"translucent"===t.renderPass&&(t.context.setColorMode(t.colorModeForRenderPass()),function(t,i){const r=t.context,n=r.gl,o=i.heatmapFbo;if(!o)return;r.activeTexture.set(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,o.colorAttachment.get()),r.activeTexture.set(n.TEXTURE1);let s=i.colorRampTexture;s||(s=i.colorRampTexture=new e.T(r,i.colorRamp,n.RGBA8)),s.bind(n.LINEAR,n.CLAMP_TO_EDGE),t.getOrCreateProgram("heatmapTexture").draw(t,n.TRIANGLES,Oi.disabled,Ni.disabled,t.colorModeForRenderPass(),Vi.disabled,((e,t)=>({u_image:0,u_color_ramp:1,u_opacity:t.paint.get("heatmap-opacity")}))(0,i),i.id,t.viewportBuffer,t.quadTriangleIndexBuffer,t.viewportSegments,i.paint,t.transform.zoom)}(t,r))},line:function(t,i,r,n){if("translucent"!==t.renderPass)return;const o=r.paint.get("line-opacity"),s=r.paint.get("line-width");if(0===o.constantOr(1)||0===s.constantOr(1))return;const a=r.paint.get("line-emissive-strength"),l=r.paint.get("line-occlusion-opacity"),c=r.layout.get("line-elevation-reference"),u="meters"===r.layout.get("line-width-unit"),h="sea"===c,d=t.context,p=d.gl;if(r.hasElevatedBuckets&&"globe"===t.transform.projection.name)return;const f=r.layout.get("line-cross-slope"),A=void 0!==f,m=f<1,g=t.colorModeForDrapableLayerRenderPass(a),_=t.terrain&&t.terrain.renderingToTexture,y=_?1:e.q.devicePixelRatio,v=r.paint.get("line-dasharray"),x=v.constantOr(1),b=r.layout.get("line-cap"),w=v.constantOr(null),T=b.constantOr(null),B=r.paint.get("line-pattern"),C=B.constantOr(1),S=B.constantOr(null),E=r.paint.get("line-opacity").constantOr(1);let M=!C&&1!==E||t.depthOcclusion&&l>0&&l<1;const I=r.paint.get("line-gradient"),P=C?"linePattern":"line",L=e.c$(r);let F;if(_&&t.terrain&&t.terrain.clipOrMaskOverlapStencilType()&&(M=!1),0!==l&&t.depthOcclusion){const t=r.paint._values["line-opacity"];t&&t.value&&"constant"===t.value.kind?F=t.value:e.w(`Occlusion opacity for layer ${r.id} is supported only when line-opacity isn't data-driven.`)}"constant"!==s.value.kind&&!1===s.value.isLineProgressConstant&&L.push("VARIABLE_LINE_WIDTH");const k=(n,o,s,a,c,f)=>{for(const A of n){const n=i.getTile(A);if(C&&!n.patternsLoaded())continue;const m=n.getBucket(r);if(!m)continue;if(m.hasZOffset&&!c||!m.hasZOffset&&c)continue;t.prepareDrawTile();const v=m.programConfigurations.get(r.id),b=t.isTileAffectedByFog(A),B=t.getOrCreateProgram(P,{config:v,defines:o,overrideFog:b,overrideRtt:!c&&void 0});if(S&&n.imageAtlas){const t=e.d0.from(S).getPrimary().scaleSelf(y).toString(),i=n.imageAtlas.patternPositions.get(t);i&&v.setConstantPatternPositions(i)}if(!C&&w&&T&&n.lineAtlas){const e=n.lineAtlas.getDash(w,T);e&&v.setConstantPatternPositions(e)}let[L,k]=r.paint.get("line-trim-offset");if("round"===T||"square"===T){const e=1;L!==k&&(0===L&&(L-=e),1===k&&(k+=e))}const z=_?A.projMatrix:null,R=u?1/m.tileToMeter/e.at(n,1,t.transform.zoom):1,D=u?1/m.tileToMeter/e.at(n,1,Math.floor(t.transform.zoom)):1,O=C?e.d1(t,n,r,z,y,R,D,[L,k]):e.d2(t,n,r,z,m.lineClipsArray.length,y,R,D,[L,k]);if(I){const n=m.gradients[r.id];let o=n.texture;if(r.gradientVersion!==n.version){let s=256;if(r.stepInterpolant){const r=i.getSource().maxzoom,n=A.canonical.z===r?Math.ceil(1<<t.transform.maxZoom-A.canonical.z):1;s=e.ay(e.d3(m.maxLineLength/e.ai*1024*n),256,d.maxTextureSize)}n.gradient=e.d4({expression:r.gradientExpression(),evaluationKey:"lineProgress",resolution:s,image:n.gradient||void 0,clips:m.lineClipsArray}),n.texture?n.texture.update(n.gradient):n.texture=new e.T(d,n.gradient,p.RGBA8),n.version=r.gradientVersion,o=n.texture}d.activeTexture.set(p.TEXTURE1),o.bind(r.stepInterpolant?p.NEAREST:p.LINEAR,p.CLAMP_TO_EDGE)}x&&(d.activeTexture.set(p.TEXTURE0),n.lineAtlasTexture&&n.lineAtlasTexture.bind(p.LINEAR,p.REPEAT),v.updatePaintBuffers()),C&&(d.activeTexture.set(p.TEXTURE0),n.imageAtlasTexture&&n.imageAtlasTexture.bind(p.LINEAR,p.CLAMP_TO_EDGE),v.updatePaintBuffers()),c&&!h&&t.terrain.setupElevationDraw(n,B),t.uploadCommonUniforms(d,B,A.toUnwrapped());const U=e=>{null!=F&&(F.value=E*l),B.draw(t,p.TRIANGLES,s,e,g,Vi.disabled,O,r.id,m.layoutVertexBuffer,m.indexBuffer,m.segments,r.paint,t.transform.zoom,v,[m.layoutVertexBuffer2,m.patternVertexBuffer,m.zOffsetVertexBuffer]),null!=F&&(F.value=E)};if(M&&!c){const e=t.stencilModeForClipping(A).ref;0===e&&_&&d.clear({stencil:0});const i={func:p.EQUAL,mask:255};O.u_alpha_discard_threshold=.8,U(new Ni(i,e,255,p.KEEP,p.KEEP,p.INVERT)),O.u_alpha_discard_threshold=0,U(new Ni(i,e,255,p.KEEP,p.KEEP,p.KEEP))}else O.u_alpha_discard_threshold=M&&c&&f?.8:0,U(c?a:t.stencilModeForClipping(A))}};if(r.hasNonElevatedBuckets){const i=!_&&t.terrain;0!==l&&i?e.w(`Occlusion opacity for layer ${r.id} is supported on terrain only if the layer has line-z-offset enabled.`):i?e.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${r.id}.`):k(n,L,t.depthModeForSublayer(0,Oi.ReadOnly),Ni.disabled,!1,!0)}if(r.hasElevatedBuckets){L.push("ELEVATED"),A&&L.push(m?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),h&&L.push("ELEVATION_REFERENCE_SEA");const e=M?t.stencilModeFor3D():Ni.disabled,i=new Oi(t.depthOcclusion?p.GREATER:p.LEQUAL,Oi.ReadOnly,t.depthRangeFor3D);t.forceTerrainMode=!0,k(n,L,i,e,!0,!0),M&&k(n,L,i,e,!0,!1),t.forceTerrainMode=!1}M&&(t.resetStencilClippingMasks(),_&&d.clear({stencil:0})),0===l||t.depthOcclusion||_||t.layersWithOcclusionOpacity.push(t.currentLayer)},fill:function(t,i,r,n){const o=r.paint.get("fill-color"),s=r.paint.get("fill-opacity");if(0===s.constantOr(1))return;const a=r.paint.get("fill-emissive-strength"),l=t.colorModeForDrapableLayerRenderPass(a),c=r.paint.get("fill-pattern"),u=t.opaquePassEnabledForLayer()&&!c.constantOr(1)&&1===o.constantOr(e.al.transparent).a&&1===s.constantOr(0)?"opaque":"translucent";let h="none";"none"!==r.layout.get("fill-elevation-reference")?h="road":0!==r.paint.get("fill-z-offset").constantOr(1)&&(h="offset");const d=!(!t.terrain||!t.terrain.enabled),p={painter:t,sourceCache:i,layer:r,coords:n,colorMode:l,elevationType:h,terrainEnabled:d,pass:u};if("offset"!==h){if(Qo(p,!1),"road"===h){const e=!d&&"translucent"===t.renderPass;e&&No(t,i,r,n,"geometry"),Qo(p,!0,Ni.disabled),e&&function(e){const{painter:t,sourceCache:i,layer:r,coords:n,colorMode:o}=e,s=t.context.gl,a=new Oi(t.context.gl.LEQUAL,Oi.ReadOnly,t.depthRangeFor3D);for(const e of n){const n=i.getTile(e),l=n.getBucket(r);if(!l)continue;const c=l.elevatedStructures;if(!c||!c.renderableSegments||0===c.renderableSegments.segments[0].primitiveLength)continue;t.prepareDrawTile();const u=l.bufferData.programConfigurations.get(r.id),h=t.isTileAffectedByFog(e),d=t.getOrCreateProgram("elevatedStructures",{config:u,overrideFog:h,defines:["NORMAL_OFFSET"]}),p={u_matrix:t.translatePosMatrix(e.projMatrix,n,r.paint.get("fill-translate"),r.paint.get("fill-translate-anchor"))};t.uploadCommonUniforms(t.context,d,e.toUnwrapped()),d.draw(t,s.TRIANGLES,a,Ni.disabled,o,Vi.backCCW,p,r.id,c.vertexBuffer,c.indexBuffer,c.renderableSegments,r.paint,t.transform.zoom,u,[c.vertexBufferNormal])}}(p)}}else Qo(p,!1,t.stencilModeFor3D())},"fill-extrusion":function(t,i,r,n){const o=r.paint.get("fill-extrusion-opacity"),s=t.context,a=s.gl,l=t.terrain,c=l&&l.renderingToTexture;if(0===o)return;const u=t.conflationActive&&t.style.isLayerClipped(r,i.getSource()),h=t.style.order.indexOf(r.fqid);if(u&&function(e,t,i,r,n){for(const o of r){const r=t.getTile(o).getBucket(i);r&&(r.updateReplacement(o,e.replacementSource,n),r.uploadCentroid(e.context))}}(t,i,r,n,h),l||u)for(const e of n){const n=i.getTile(e).getBucket(r);n&&Ho(t.context,i,e,n,r,l,u)}if("shadow"===t.renderPass&&t.shadowRenderer){const s=t.shadowRenderer;if(l&&o<.65&&r._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof e.ab)return;const a=s.getShadowPassDepthMode(),c=s.getShadowPassColorMode();jo(t,i,r,n,a,Ni.disabled,c,u)}else if("translucent"===t.renderPass){const h=!r.paint.get("fill-extrusion-pattern").constantOr(1),d=r.paint.get("fill-extrusion-color").constantOr(e.al.white);if(!c&&0!==d.a){const e=new Oi(t.context.gl.LEQUAL,Oi.ReadWrite,t.depthRangeFor3D);1===o&&h?jo(t,i,r,n,e,Ni.disabled,Di.unblended,u):(jo(t,i,r,n,e,Ni.disabled,Di.disabled,u),jo(t,i,r,n,e,t.stencilModeFor3D(),t.colorModeForRenderPass(),u),t.resetStencilClippingMasks())}if(t.style.enable3dLights()&&h&&(!l&&"globe"!==t.transform.projection.name||c)){const o=r.paint.get("fill-extrusion-opacity"),h=r.paint.get("fill-extrusion-ambient-occlusion-intensity"),d=r.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),p=r.paint.get("fill-extrusion-flood-light-intensity"),f="none"===r.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default"),A=r.paint.get("fill-extrusion-flood-light-color").toRenderColor(f?null:r.lut).toArray01().slice(0,3),m=h>0&&d>0,g=p>0,_=(e,t,i)=>(1-i)*e+i*t,y=s=>{const l=t.depthModeForSublayer(1,Oi.ReadOnly,a.LEQUAL,!0),c=r.paint.get(s?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),f=_(.1,3,c),m=t._showOverdrawInspector;if(!m){const c=new Ni({func:a.ALWAYS,mask:255},255,255,a.KEEP,a.KEEP,a.REPLACE),m=new Di([a.ONE,a.ONE,a.ONE,a.ONE],e.al.transparent,[!1,!1,!1,!0],a.MIN);Vo(t,i,r,n,l,c,m,Vi.disabled,s,"sdf",o,h,d,p,A,f,u,!1)}{const c=m?Ni.disabled:new Ni({func:a.EQUAL,mask:255},255,255,a.KEEP,a.DECR,a.DECR),g=m?t.colorModeForRenderPass():new Di([a.ONE_MINUS_DST_ALPHA,a.DST_ALPHA,a.ONE,a.ONE],e.al.transparent,[!0,!0,!0,!0]);Vo(t,i,r,n,l,c,g,Vi.disabled,s,"color",o,h,d,p,A,f,u,!1)}};if(c){const c=(s,l,c)=>{const f=t.depthModeForSublayer(1,Oi.ReadOnly,a.LEQUAL,!1),m=r.paint.get(s?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),g=_(.1,3,m);{const c=new Di([a.ONE,a.ONE,a.ONE,a.ONE],e.al.transparent,[!1,!1,!1,!0]);Vo(t,i,r,n,f,Ni.disabled,c,Vi.disabled,s,"clear",o,h,d,p,A,g,u,l)}{const c=new Ni({func:a.ALWAYS,mask:255},255,255,a.KEEP,a.KEEP,a.REPLACE),m=new Di([a.ONE,a.ONE,a.ONE,a.ONE],e.al.transparent,[!1,!1,!1,!0],a.MIN);Vo(t,i,r,n,f,c,m,Vi.disabled,s,"sdf",o,h,d,p,A,g,u,l)}{const c=s?a.ZERO:a.ONE_MINUS_DST_ALPHA,m=new Ni({func:a.EQUAL,mask:255},255,255,a.KEEP,a.DECR,a.DECR),_=new Di([c,a.DST_ALPHA,a.ONE_MINUS_DST_ALPHA,a.ZERO],e.al.transparent,[!0,!0,!0,!0]);Vo(t,i,r,n,f,m,_,Vi.disabled,s,"color",o,h,d,p,A,g,u,l)}{const m=new Di([a.ONE,a.ONE,a.ONE,s?a.ZERO:a.ONE],e.al.transparent,[!1,!1,!1,!0],s?a.FUNC_ADD:a.MAX);Vo(t,i,r,n,f,Ni.disabled,m,Vi.disabled,s,"clear",o,h,d,p,A,g,u,l,c)}};if(m||g){let i;if(t.prepareDrawTile(),l){const t=l.drapeBufferSize[0],r=l.drapeBufferSize[1];i=l.framebufferCopyTexture,i&&(!i||i.size[0]===t&&i.size[1]===r)||(i&&i.destroy(),i=l.framebufferCopyTexture=new e.T(s,new e.r({width:t,height:r}),a.RGBA8)),i.bind(a.LINEAR,a.CLAMP_TO_EDGE),a.copyTexSubImage2D(a.TEXTURE_2D,0,0,0,0,0,t,r)}m&&c(!0,!1,i),g&&c(!1,!0,i)}}else m&&y(!0),g&&y(!1),(m||g)&&t.resetStencilClippingMasks()}}},hillshade:function(e,t,i,r){if("offscreen"!==e.renderPass&&"translucent"!==e.renderPass)return;if(e.style.disableElevatedTerrain)return;const n=e.context,o=e.terrain&&e.terrain.renderingToTexture,[s,a]="translucent"!==e.renderPass||o?[{},r]:e.stencilConfigForOverlap(r);for(const r of a){const n=t.getTile(r);if(n.needsHillshadePrepare&&"offscreen"===e.renderPass)$r(e,n,i);else if("translucent"===e.renderPass){const t=e.depthModeForSublayer(0,Oi.ReadOnly),a=i.paint.get("hillshade-emissive-strength"),l=e.colorModeForDrapableLayerRenderPass(a),c=o&&e.terrain?e.terrain.stencilModeForRTTOverlap(r):s[r.overscaledZ];Hr(e,r,n,i,t,c,l)}}n.viewport.set([0,0,e.width,e.height]),e.resetStencilClippingMasks()},raster:function(t,i,r,n,o,s){if("translucent"!==t.renderPass)return;if(0===r.paint.get("raster-opacity"))return;const a="globe"===t.transform.projection.name,l=0!==r.paint.get("raster-elevation"),c=l&&a;if(t.renderElevatedRasterBackface&&!c)return;const u=t.context,h=u.gl,d=i.getSource(),p=function(t,i,r,n){const o=i.paint.get("raster-color"),s="raster-array"===t.type,a=[],l=i.paint.get("raster-resampling"),c=i.paint.get("raster-color-mix");let u=i.paint.get("raster-color-range");const h=[c[0],c[1],c[2],0],d=c[3];let p="nearest"===l?n.NEAREST:n.LINEAR;if(s&&(a.push("RASTER_ARRAY"),o||a.push("RASTER_COLOR"),"linear"===l&&a.push("RASTER_ARRAY_LINEAR"),p=n.NEAREST,!u&&t.rasterLayers)){const e=t.rasterLayers.find((({id:e})=>e===i.sourceLayer));e&&e.fields&&e.fields.range&&(u=e.fields.range)}if(u=u||[0,1],o){a.push("RASTER_COLOR"),r.activeTexture.set(n.TEXTURE2),i.updateColorRamp(u);let t=i.colorRampTexture;t||(t=i.colorRampTexture=new e.T(r,i.colorRamp,n.RGBA8)),t.bind(n.LINEAR,n.CLAMP_TO_EDGE)}return{mix:h,range:u,offset:d,defines:a,resampling:p}}(d,r,u,h);if(d instanceof e.aK&&!n.length&&!a)return;const f=r.paint.get("raster-emissive-strength"),A=t.colorModeForDrapableLayerRenderPass(f),m=t.terrain&&t.terrain.renderingToTexture,g=!t.options.moving,_="nearest"===r.paint.get("raster-resampling")?h.NEAREST:h.LINEAR;if(d instanceof e.aK&&!n.length&&(d.onNorthPole||d.onSouthPole)){const e=l?t.stencilModeFor3D():Ni.disabled;return void Wo(!!d.onNorthPole,null,t,i,r,f,p,Vi.disabled,e)}if(!n.length)return;const[y,v]=d instanceof e.aK||m?[{},n]:t.stencilConfigForOverlap(n),x=v[v.length-1].overscaledZ;c&&p.defines.push("PROJECTION_GLOBE_VIEW"),l&&p.defines.push("RENDER_CUTOFF");const b=(n,o,v)=>{for(const b of n){const n=b.toUnwrapped(),w=i.getTile(b);if(m&&(!w||!w.hasData()))continue;u.activeTexture.set(h.TEXTURE0);const T=Yo(w,d,r,p);if(!T||!T.texture)continue;const{texture:B,mix:C,offset:S,tileSize:E,buffer:M}=T;let I,P;m?(I=Oi.disabled,P=b.projMatrix):l?(I=new Oi(h.LEQUAL,Oi.ReadWrite,t.depthRangeFor3D),P=a?Float32Array.from(t.transform.expandedFarZProjMatrix):t.transform.calculateProjMatrix(n,g)):(I=t.depthModeForSublayer(b.overscaledZ-x,1===r.paint.get("raster-opacity")?Oi.ReadWrite:Oi.ReadOnly,h.LESS),P=t.transform.calculateProjMatrix(n,g));const L=t.terrain&&m?t.terrain.stencilModeForRTTOverlap(b):y[b.overscaledZ],F=s?0:r.paint.get("raster-fade-duration");w.registerFadeDuration(F);const k=i.findLoadedParent(b,0),z=Un(w,k,i,t.transform,F);let R,D;t.terrain&&t.terrain.prepareDrawTile(),u.activeTexture.set(h.TEXTURE0),B.bind(_,h.CLAMP_TO_EDGE),u.activeTexture.set(h.TEXTURE1),k?(k.texture&&k.texture.bind(_,h.CLAMP_TO_EDGE),R=Math.pow(2,k.tileID.overscaledZ-w.tileID.overscaledZ),D=[w.tileID.canonical.x*R%1,w.tileID.canonical.y*R%1]):B.bind(_,h.CLAMP_TO_EDGE),"useMipmap"in B&&u.extTextureFilterAnisotropic&&t.transform.pitch>20&&h.texParameterf(h.TEXTURE_2D,u.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,u.extTextureFilterAnisotropicMax);const O=t.transform;let U;const N=l?Xo(O):[0,0,0,0];let Q,j,V,H,G,$=0;if(c&&d instanceof e.aK&&d.coordinates.length>3)Q=Float32Array.from(e.bc(e.cI(new e.bT(0,0,0)))),j=Float32Array.from(O.globeMatrix),V=Float32Array.from(e.cE(O)),H=[e.av(O.center.lng),e.aC(O.center.lat)],U=d.elevatedGlobePerspectiveTransform,G=d.elevatedGlobeGridMatrix||new Float32Array(9);else if(c){const t=e.cF(b.canonical);$=e.cG(t.getCenter().lat),Q=Float32Array.from(e.bc(e.cI(b.canonical))),j=Float32Array.from(O.globeMatrix),V=Float32Array.from(e.cE(O)),H=[e.av(O.center.lng),e.aC(O.center.lat)],U=[0,0],G=Float32Array.from(e.cH(b.canonical,t,$,O.worldSize/O._pixelsPerMercatorPixel))}else U=d instanceof e.aK?d.perspectiveTransform:[0,0],Q=new Float32Array(16),j=new Float32Array(9),V=new Float32Array(16),H=[0,0],G=new Float32Array(9);const Z=ho(P,Q,j,V,G,D||[0,0],e.ag(t.transform.zoom),H,N,R||1,z,r,U,l?r.paint.get("raster-elevation"):0,2,C,S,p.range,E,M,f),q=t.isTileAffectedByFog(b),K=t.getOrCreateProgram("raster",{defines:p.defines,overrideFog:q});if(t.uploadCommonUniforms(u,K,n),d instanceof e.aK){const i=d.elevatedGlobeVertexBuffer,n=d.elevatedGlobeIndexBuffer;if(m||!a)d.boundsBuffer&&d.boundsSegments&&K.draw(t,h.TRIANGLES,I,Ni.disabled,A,Vi.disabled,Z,r.id,d.boundsBuffer,t.quadTriangleIndexBuffer,d.boundsSegments);else if(i&&n){const s=O.zoom<=e.c6?d.elevatedGlobeSegments:d.getSegmentsForLongitude(O.center.lng);s&&K.draw(t,h.TRIANGLES,I,Ni.disabled,A,o,Z,r.id,i,n,s)}}else if(c){I=new Oi(h.LEQUAL,Oi.ReadOnly,t.depthRangeFor3D);const e=t.globeSharedBuffers;if(e){const[i,n,s]=e.getGridBuffers($,!1);K.draw(t,h.TRIANGLES,I,v||L,t.colorModeForRenderPass(),o,Z,r.id,i,n,s)}}else{const{tileBoundsBuffer:e,tileBoundsIndexBuffer:i,tileBoundsSegments:n}=t.getTileBoundsBuffers(w);K.draw(t,h.TRIANGLES,I,L,A,Vi.disabled,Z,r.id,e,i,n)}}if(!(d instanceof e.aK)&&c)for(const e of n){const n=e.canonical.y===(1<<e.canonical.z)-1;0===e.canonical.y&&Wo(!0,e,t,i,r,f,p,o,v||Ni.disabled),n&&Wo(!1,e,t,i,r,f,p,o===Vi.frontCW?Vi.backCW:Vi.frontCW,v||Ni.disabled)}};c?b(v,t.renderElevatedRasterBackface?Vi.backCW:Vi.frontCW,t.stencilModeFor3D()):b(v,Vi.disabled,void 0),t.resetStencilClippingMasks()},"raster-particle":function(t,i,r,n,o,s){"offscreen"===t.renderPass&&function(t,i,r,n){if(!n.length)return;const o=t.context,s=o.gl,a=i.getSource();if(!(a instanceof rt))return;const l=Math.ceil(Math.sqrt(r.paint.get("raster-particle-count")));let c=r.particlePositionRGBAImage;if(!c||c.width!==l){const t=function(e){const t=e*e,i=new Uint8Array(4*t),r=function(e){return e|=0,e=Math.imul(2747636419^e,2654435769),e=Math.imul(e^e>>>16,2654435769),((e=Math.imul(e^e>>>16,2654435769))>>>0)/4294967296},n=1/1.1;for(let e=0;e<t;e++){const t=n*(r(2*e+0)+fo),o=n*(r(2*e+1)+fo),s=255*t%1,a=255*o%1,l=s,c=o-a/255,u=a;i[4*e+0]=255*(t-s/255),i[4*e+1]=255*l,i[4*e+2]=255*c,i[4*e+3]=255*u}return i}(l);c=r.particlePositionRGBAImage=new e.r({width:l,height:l},t)}let u=r.particleFramebuffer;u?u.width!==l&&(u.destroy(),u=r.particleFramebuffer=o.createFramebuffer(l,l,!0,null)):u=r.particleFramebuffer=o.createFramebuffer(l,l,!0,null);const h=[];for(const e of n){const t=i.getTile(e);if(!(t instanceof bt))continue;const n=ts(t,a,r);if(!n)continue;const s=[t.tileSize,t.tileSize];let u=r.tileFramebuffer;u||(u=r.tileFramebuffer=o.createFramebuffer(s[0],s[1],!0,null));let d=t.rasterParticleState;d||(d=t.rasterParticleState=new es(o,e,s,c));const p=d.update(r.lastInvalidatedAt);d.particleTextureDimension!==l&&d.updateParticleTexture(e,c);const f=d.targetColorTexture;d.targetColorTexture=d.backgroundColorTexture,d.backgroundColorTexture=f;const A=d.particleTexture0;d.particleTexture0=d.particleTexture1,d.particleTexture1=A,h.push([e,n,d,p])}if(0===h.length)return;const d=e.q.now(),p=r.previousDrawTimestamp?.001*(d-r.previousDrawTimestamp):.0167;if(r.previousDrawTimestamp=d,r.hasColorMap()){o.activeTexture.set(s.TEXTURE0+2);let t=r.colorRampTexture;t||(t=r.colorRampTexture=new e.T(o,r.colorRamp,s.RGBA8)),t.bind(s.LINEAR,s.CLAMP_TO_EDGE)}o.bindFramebuffer.set(r.tileFramebuffer.framebuffer),function(t,i,r){const n=t.context,o=n.gl,s=i.tileFramebuffer;n.activeTexture.set(o.TEXTURE0);const a={u_texture:0,u_opacity:1.05*(c=i.paint.get("raster-particle-fade-opacity-factor"))/(c+.05)},l=t.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var c;for(const c of r){const[,,r,u]=c;s.colorAttachment.set(r.targetColorTexture.texture),n.viewport.set([0,0,s.width,s.height]),n.clear({color:e.al.transparent}),u&&(r.backgroundColorTexture.bind(o.NEAREST,o.CLAMP_TO_EDGE),l.draw(t,o.TRIANGLES,Oi.disabled,Ni.disabled,Di.alphaBlended,Vi.disabled,a,i.id,t.viewportBuffer,t.quadTriangleIndexBuffer,t.viewportSegments))}}(t,r,h),function(t,i,r,n){const o=t.context,s=o.gl,a=r.tileFramebuffer,l="globe"===t.transform.projection.name,c=r.paint.get("raster-particle-max-speed");for(const u of n){const[n,h,d]=u;o.activeTexture.set(s.TEXTURE0+0),h.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE),a.colorAttachment.set(d.targetColorTexture.texture);const p=t.getOrCreateProgram("rasterParticleDraw",{defines:h.defines,overrideFog:!1});o.activeTexture.set(s.TEXTURE0+1);const f=h.scalarData?[]:[0,1,2,3].map((t=>e.d7[t](n)));f.push(n);const A=n.canonical.x,m=n.canonical.y;for(const e of f){const o=i.getTile(l?e.wrapped():e);if(!o)continue;const a=o.rasterParticleState;if(!a)continue;const u=e.canonical.x+(1<<e.canonical.z)*(e.wrap-n.wrap),d=e.canonical.y;a.particleTexture0.bind(s.NEAREST,s.CLAMP_TO_EDGE);const f=mo(1,a.particleTexture0.size[0],[u-A,d-m],0,h.texture.size,2,c,h.textureOffset,h.scale,h.offset);p.draw(t,s.POINTS,Oi.disabled,Ni.disabled,Di.alphaBlended,Vi.disabled,f,r.id,a.particleIndexBuffer,void 0,a.particleSegment)}}}(t,i,r,h),o.bindFramebuffer.set(r.particleFramebuffer.framebuffer),function(t,i,r,n){const o=t.context,s=o.gl,a=i.paint.get("raster-particle-max-speed"),l=n*i.paint.get("raster-particle-speed-factor")*.15,c=function(e){return Math.pow(e,6)}(.01+1*i.paint.get("raster-particle-reset-rate-factor")),u=i.particleFramebuffer;o.viewport.set([0,0,u.width,u.height]);for(const n of r){const[,r,h]=n;o.activeTexture.set(s.TEXTURE0+0),r.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE),o.activeTexture.set(s.TEXTURE0+1);const d=h.particleTexture0;d.bind(s.NEAREST,s.CLAMP_TO_EDGE);const p=go(1,d.size[0],0,r.texture.size,a,l,c,r.textureOffset,r.scale,r.offset);u.colorAttachment.set(h.particleTexture1.texture),o.clear({color:e.al.transparent}),t.getOrCreateProgram("rasterParticleUpdate",{defines:r.defines}).draw(t,s.TRIANGLES,Oi.disabled,Ni.disabled,Di.unblended,Vi.disabled,p,i.id,t.viewportBuffer,t.quadTriangleIndexBuffer,t.viewportSegments)}}(t,r,h,p)}(t,i,r,n),"translucent"===t.renderPass&&(function(t,i,r,n){const o=t.context,s=o.gl,a=i.getSource().tileSize,l=5*(1-e.ae(e.bY,e.bY+1,t.transform.zoom))*a+r.paint.get("raster-particle-elevation"),c=!t.options.moving,u="globe"===t.transform.projection.name;if(!n.length)return;const[h,d]=t.stencilConfigForOverlap(n),p=[];u&&p.push("PROJECTION_GLOBE_VIEW");const f=t.stencilModeFor3D();for(const n of d){const a=n.toUnwrapped(),d=i.getTile(n);if(!d.rasterParticleState)continue;const A=d.rasterParticleState,m=100;d.registerFadeDuration(m);const g=i.findLoadedParent(n,0),_=Un(d,g,i,t.transform,m);let y,v;t.terrain&&t.terrain.prepareDrawTile(),o.activeTexture.set(s.TEXTURE0),A.targetColorTexture.bind(s.LINEAR,s.CLAMP_TO_EDGE),o.activeTexture.set(s.TEXTURE1),g&&g.rasterParticleState?(g.rasterParticleState.targetColorTexture.bind(s.LINEAR,s.CLAMP_TO_EDGE),y=Math.pow(2,g.tileID.overscaledZ-d.tileID.overscaledZ),v=[d.tileID.canonical.x*y%1,d.tileID.canonical.y*y%1]):A.targetColorTexture.bind(s.LINEAR,s.CLAMP_TO_EDGE);const x=u?Float32Array.from(t.transform.expandedFarZProjMatrix):t.transform.calculateProjMatrix(a,c),b=t.transform,w=is(b),T=e.cF(n.canonical),B=e.cG(T.getCenter().lat);let C,S,E,M,I;u?(C=Float32Array.from(e.bc(e.cI(n.canonical))),S=Float32Array.from(b.globeMatrix),E=Float32Array.from(e.cE(b)),M=[e.av(b.center.lng),e.aC(b.center.lat)],I=Float32Array.from(e.cH(n.canonical,T,B,b.worldSize/b._pixelsPerMercatorPixel))):(C=new Float32Array(16),S=new Float32Array(9),E=new Float32Array(16),M=[0,0],I=new Float32Array(9));const P=Ao(x,C,S,E,I,v||[0,0],e.ag(t.transform.zoom),M,w,y||1,_,l),L=t.isTileAffectedByFog(n),F=t.getOrCreateProgram("rasterParticle",{defines:p,overrideFog:L});if(t.uploadCommonUniforms(o,F,a),u){const e=new Oi(s.LEQUAL,Oi.ReadOnly,t.depthRangeFor3D),i=0,n=t.globeSharedBuffers;if(n){const[o,a,l]=n.getGridBuffers(B,0!==i);F.draw(t,s.TRIANGLES,e,f,Di.alphaBlended,t.renderElevatedRasterBackface?Vi.frontCCW:Vi.backCCW,P,r.id,o,a,l)}}else{const e=t.depthModeForSublayer(0,Oi.ReadOnly),i=h[n.overscaledZ],{tileBoundsBuffer:o,tileBoundsIndexBuffer:a,tileBoundsSegments:l}=t.getTileBoundsBuffers(d);F.draw(t,s.TRIANGLES,e,i,Di.alphaBlended,Vi.disabled,P,r.id,o,a,l)}}t.resetStencilClippingMasks()}(t,i,r,n),t.style.map.triggerRepaint())},background:function(t,i,r,n){const o=r.paint.get("background-color"),s="none"===r.paint.get("background-color-use-theme").constantOr("default"),a=r.paint.get("background-opacity"),l=r.paint.get("background-emissive-strength"),c="viewport"===r.paint.get("background-pitch-alignment");if(0===a)return;const u=t.context,h=u.gl,d=t.transform,p=d.tileSize,f=r.paint.get("background-pattern");let A;if(void 0!==f){if(null===f)return;if(A=t.imageManager.getPattern(e.I.from(f.toString()),r.scope,t.style.getLut(r.scope)),!A)return}const m=!f&&1===o.a&&1===a&&t.opaquePassEnabledForLayer()?"opaque":"translucent";if(t.renderPass!==m)return;const g=Ni.disabled,_=t.depthModeForSublayer(0,"opaque"===m?Oi.ReadWrite:Oi.ReadOnly),y=t.colorModeForDrapableLayerRenderPass(l),v=f?"backgroundPattern":"background";let x,b=n;if(b||(x=t.getBackgroundTiles(),b=Object.values(x).map((e=>e.tileID))),f&&(u.activeTexture.set(h.TEXTURE0),t.imageManager.bind(t.context,r.scope)),c){const i=t.getOrCreateProgram(v,{overrideFog:!1,overrideRtt:!0}),n=new Float32Array(e.ad.mat4.identity([])),u=new e.aH(0,0,0,0,0),d=f?xo(n,l,a,t,0,r.scope,A,c,{tileID:u,tileSize:p}):vo(n,l,a,o.toRenderColor(s?null:r.lut));i.draw(t,h.TRIANGLES,_,g,y,Vi.disabled,d,r.id,t.viewportBuffer,t.quadTriangleIndexBuffer,t.viewportSegments)}else for(const e of b){const m=t.isTileAffectedByFog(e),b=t.getOrCreateProgram(v,{overrideFog:m}),w=e.toUnwrapped(),T=n?e.projMatrix:t.transform.calculateProjMatrix(w);t.prepareDrawTile();const B=i?i.getTile(e):x?x[e.key]:new xt(e,p,d.zoom,t),C=f?xo(T,l,a,t,0,r.scope,A,c,{tileID:e,tileSize:p}):vo(T,l,a,o.toRenderColor(s?null:r.lut));t.uploadCommonUniforms(u,b,w);const{tileBoundsBuffer:S,tileBoundsIndexBuffer:E,tileBoundsSegments:M}=t.getTileBoundsBuffers(B);b.draw(t,h.TRIANGLES,_,g,y,Vi.disabled,C,r.id,S,E,M)}},sky:function(t,i,r){const n=t._atmosphere?e.ag(t.transform.zoom):1,o=r.paint.get("sky-opacity")*n;if(0===o)return;const s=t.context,a=r.paint.get("sky-type"),l=new Oi(s.gl.LEQUAL,Oi.ReadOnly,[0,1]),c=t.frameCounter/1e3%1;"atmosphere"===a?"offscreen"===t.renderPass?r.needsSkyboxCapture(t)&&(function(t,i){const r=t.context,n=r.gl;let o=i.skyboxFbo;if(!o){o=i.skyboxFbo=r.createFramebuffer(32,32,!0,null),i.skyboxGeometry=new As(r),i.skyboxTexture=r.gl.createTexture(),n.bindTexture(n.TEXTURE_CUBE_MAP,i.skyboxTexture),n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_MAG_FILTER,n.LINEAR);for(let e=0;e<6;++e)n.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,n.RGBA,32,32,0,n.RGBA,n.UNSIGNED_BYTE,null)}r.bindFramebuffer.set(o.framebuffer),r.viewport.set([0,0,32,32]);const s=i.getCenter(t,!0),a=t.getOrCreateProgram("skyboxCapture"),l=new Float64Array(16);e.ad.mat4.identity(l),e.ad.mat4.rotateY(l,l,.5*-Math.PI),ms(t,i,a,l,s,0),e.ad.mat4.identity(l),e.ad.mat4.rotateY(l,l,.5*Math.PI),ms(t,i,a,l,s,1),e.ad.mat4.identity(l),e.ad.mat4.rotateX(l,l,.5*-Math.PI),ms(t,i,a,l,s,2),e.ad.mat4.identity(l),e.ad.mat4.rotateX(l,l,.5*Math.PI),ms(t,i,a,l,s,3),e.ad.mat4.identity(l),ms(t,i,a,l,s,4),e.ad.mat4.identity(l),e.ad.mat4.rotateY(l,l,Math.PI),ms(t,i,a,l,s,5),r.viewport.set([0,0,t.width,t.height])}(t,r),r.markSkyboxValid(t)):"sky"===t.renderPass&&function(e,t,i,r,n){const o=e.context,s=o.gl,a=e.transform,l=e.getOrCreateProgram("skybox");o.activeTexture.set(s.TEXTURE0),s.bindTexture(s.TEXTURE_CUBE_MAP,t.skyboxTexture);const c=((e,t,i,r,n)=>({u_matrix:e,u_sun_direction:t,u_cubemap:0,u_opacity:r,u_temporal_offset:n}))(a.skyboxMatrix,t.getCenter(e,!1),0,r,n);e.uploadCommonUniforms(o,l),l.draw(e,s.TRIANGLES,i,Ni.disabled,e.colorModeForRenderPass(),Vi.backCW,c,"skybox",t.skyboxGeometry.vertexBuffer,t.skyboxGeometry.indexBuffer,t.skyboxGeometry.segment)}(t,r,l,o,c):"gradient"===a&&"sky"===t.renderPass&&function(t,i,r,n,o){const s=t.context,a=s.gl,l=t.transform,c=t.getOrCreateProgram("skyboxGradient");i.skyboxGeometry||(i.skyboxGeometry=new As(s)),s.activeTexture.set(a.TEXTURE0);let u=i.colorRampTexture;u||(u=i.colorRampTexture=new e.T(s,i.colorRamp,a.RGBA8)),u.bind(a.LINEAR,a.CLAMP_TO_EDGE);const h=((t,i,r,n,o)=>({u_matrix:t,u_color_ramp:0,u_center_direction:i,u_radius:e.ak(r),u_opacity:n,u_temporal_offset:o}))(l.skyboxMatrix,i.getCenter(t,!1),i.paint.get("sky-gradient-radius"),n,o);t.uploadCommonUniforms(s,c),c.draw(t,a.TRIANGLES,r,Ni.disabled,t.colorModeForRenderPass(),Vi.backCW,h,"skyboxGradient",i.skyboxGeometry.vertexBuffer,i.skyboxGeometry.indexBuffer,i.skyboxGeometry.segment)}(t,r,l,o,c)},debug:function(t,i,r,n,o,s){for(let a=0;a<r.length;a++)if(o){const o=1,l=.8,c=new e.al(n.r*l,n.g*l,n.b*l,1);ls(t,i,r[a],n,-o,-o,s),ls(t,i,r[a],n,-o,o,s),ls(t,i,r[a],n,o,o,s),ls(t,i,r[a],n,o,-o,s),ls(t,i,r[a],c,0,0,s)}else ls(t,i,r[a],n,0,0,s)},custom:function(t,i,r,n){const o=t.context,s=r.implementation;if(!t.transform.projection.unsupportedLayers||!t.transform.projection.unsupportedLayers.includes("custom")||t.terrain&&(t.terrain.renderingToTexture||"offscreen"===t.renderPass)&&r.isDraped(i)){if("offscreen"===t.renderPass){const i=s.prerender;if(i){if(t.setCustomLayerDefaults(),o.setColorMode(t.colorModeForRenderPass()),"globe"===t.transform.projection.name){const r=t.transform.pointMerc;i.call(s,o.gl,t.transform.customLayerMatrix(),t.transform.getProjection(),t.transform.globeToMercatorMatrix(),e.ag(t.transform.zoom),[r.x,r.y],t.transform.pixelsPerMeterRatio)}else i.call(s,o.gl,t.transform.customLayerMatrix());o.setDirty(),t.setBaseState()}}else if("translucent"===t.renderPass){if(t.terrain&&t.terrain.renderingToTexture){const i=s.renderToTile;if(i){const r=n[0].canonical,a=new e.ac(r.x+n[0].wrap*(1<<r.z),r.y,r.z);o.setDepthMode(Oi.disabled),o.setStencilMode(Ni.disabled),o.setColorMode(t.colorModeForRenderPass()),t.setCustomLayerDefaults(),i.call(s,o.gl,a),o.setDirty(),t.setBaseState()}return}t.setCustomLayerDefaults(),o.setColorMode(t.colorModeForRenderPass()),o.setStencilMode(Ni.disabled);const i="3d"===s.renderingMode?new Oi(t.context.gl.LEQUAL,Oi.ReadWrite,t.depthRangeFor3D):t.depthModeForSublayer(0,Oi.ReadOnly);if(o.setDepthMode(i),"globe"===t.transform.projection.name){const i=t.transform.pointMerc;s.render(o.gl,t.transform.customLayerMatrix(),t.transform.getProjection(),t.transform.globeToMercatorMatrix(),e.ag(t.transform.zoom),[i.x,i.y],t.transform.pixelsPerMeterRatio)}else s.render(o.gl,t.transform.customLayerMatrix());o.setDirty(),t.setBaseState(),o.bindFramebuffer.set(null)}}else e.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(t,i,r,n){if("opaque"===t.renderPass)return;const o=r.paint.get("model-opacity").constantOr(1);if(0===o)return;const s=r.paint.get("model-cast-shadows");if("shadow"===t.renderPass){if(!s)return;if(t.terrain&&o<.65&&r._transitionablePaint._values["model-opacity"].value.expression instanceof e.ab)return}const a=t.shadowRenderer,l=r.paint.get("model-receive-shadows");a&&(a.useNormalOffset=!0,l||(a.enabled=!1));const c=()=>{a&&(a.useNormalOffset=!0,l||(a.enabled=!0))},u=i.getSource();if("light-beam"===t.renderPass&&"batched-model"!==u.type)return;if("vector"===u.type||"geojson"===u.type)return function(t,i,r,n,o){const s=t.transform;if("mercator"!==s.projection.name)return void e.w(`Drawing 3D models for ${s.projection.name} projection is not yet implemented`);const a=s.getFreeCameraOptions().position;if(!t.modelManager)return;const l=t.modelManager;r.modelManager=l;const c=t.shadowRenderer;if(!r._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const u=r._unevaluatedLayout._values["model-id"],h=Object.assign({},r.layout.get("model-id").parameters),d=t.style.order.indexOf(r.fqid);for(const p of n){const n=i.getTile(p).getBucket(r);if(!n||n.projection.name!==s.projection.name)continue;const f=n.getModelUris();f&&!n.modelsRequested&&(l.addModelsFromBucket(f,o),n.modelsRequested=!0);const A=Ms(p,s);h.zoom=A;const m=u.possiblyEvaluate(h);if(Ss(t,n,p),Es.shadowUniformsInitialized=!1,Es.useSingleShadowCascade=!!c&&0===c.getMaxCascadeForTile(p.toUnwrapped()),"shadow"===t.renderPass&&c){if(1===t.currentShadowCascade&&n.isInsideFirstShadowMapFrustum)continue;const i=s.calculatePosMatrix(p.toUnwrapped(),s.worldSize);if(Es.tileMatrix.set(i),Es.shadowTileMatrix=Float32Array.from(c.calculateShadowPassMatrixFromMatrix(i)),Es.aabb.min.fill(0),Es.aabb.max[0]=Es.aabb.max[1]=e.ai,Es.aabb.max[2]=0,Ls(n,Es,t,r.scope))continue}const g=1<<p.canonical.z,_=[((a.x-p.wrap)*g-p.canonical.x)*e.ai,(a.y*g-p.canonical.y)*e.ai,a.z*g*e.ai];t.conflationActive&&Object.keys(n.instancesPerModel).length>0&&t.style.isLayerClipped(r,i.getSource())&&n.updateReplacement(p,t.replacementSource,d,o)&&(n.uploaded=!1,n.upload(t.context));for(let e in n.instancesPerModel){const i=n.instancesPerModel[e];i.features.length>0&&(e=m.evaluate(i.features[0].feature,{}));const s=l.getModel(e,o);if(s&&s.uploaded)for(const e of s.nodes)Is(t,r,e,i,_,p,Es)}}}(t,i,r,n,"vector"===u.type?r.scope:""),void c();if(!u.loaded())return;if("batched-model"===u.type)return function(t,i,r,n){r.resetLayerRenderingStats(t);const o=t.context,s=t.transform,a=t.style.fog,l=t.shadowRenderer;if("mercator"!==s.projection.name)return void e.w(`Drawing 3D landmark models for ${s.projection.name} projection is not yet implemented`);const c=t.transform.getFreeCameraOptions().position,u=e.ad.vec3.scale([],[c.x,c.y,c.z],t.transform.worldSize),h=e.ad.vec3.negate([],u),d=e.ad.mat4.identity([]),p=e.dm(s.center.lat,s.zoom),f=e.ad.mat4.fromScaling([],[1,1,1/p]);e.ad.mat4.translate(d,d,h);const A=r.paint.get("model-opacity").constantOr(1),m=new Oi(o.gl.LEQUAL,Oi.ReadWrite,t.depthRangeFor3D),g=new Oi(o.gl.LEQUAL,Oi.ReadOnly,t.depthRangeFor3D),_=new e.ce([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),y="shadow"===t.renderPass,v=y&&l?l.getCurrentCascadeFrustum():s.getFrustum(s.scaleZoom(s.worldSize)),x=r.paint.get("model-front-cutoff"),b=x[2]<1,w=Ji(t,r.paint.get("model-cutoff-fade-range")),T=r.getLayerRenderingStats();(function(e,t,i,r){const n=e.terrain?e.terrain.exaggeration():0,o=e.transform.zoom;for(const s of r){const r=t.getTile(s).getBucket(i);r&&(r.setFilter(i.filter),e.conflationActive&&r.updateReplacement(s,e.replacementSource),r.evaluateScale(e,i),e.terrain&&n>0&&r.elevationUpdate(e.terrain,n,s,i.source),r.needsReEvaluation(e,o,i)&&r.evaluate(i))}})(t,i,r,n),function(){let c,h,B;b?(c=n.length-1,h=-1,B=-1):(c=0,h=n.length,B=1);const C=new Float64Array(16),S=e.ad.vec3.create(),E=new e.P(0,0);for(let M=c;M!==h;M+=B){const c=n[M],h=i.getTile(c).getBucket(r);if(!h||!h.uploaded)continue;let B=!1;l&&(B=0===l.getMaxCascadeForTile(c.toUnwrapped()));const I=s.calculatePosMatrix(c.toUnwrapped(),s.worldSize),P=h.modelTraits;!y&&b&&(e.ad.mat4.invert(C,I),e.ad.vec3.transformMat4(S,u,C),E.x=S[0],E.y=S[1]);const L=[];h.setFilter(r.filter);for(const i of h.getNodesInfo()){if(i.hiddenByReplacement)continue;if(!i.node.meshes)continue;const r=i.node;let n=0;t.terrain&&r.elevation&&(n=r.elevation*t.terrain.exaggeration());const o=(()=>{const t=i.aabb;return _.min=[...t.min],_.max=[...t.max],_.min[2]+=n,_.max[2]+=n,e.ad.vec3.transformMat4(_.min,_.min,I),e.ad.vec3.transformMat4(_.max,_.max,I),_})(),a=i.evaluatedScale;if(a[0]<=1&&a[1]<=1&&a[2]<=1&&0===o.intersects(v))continue;if(!y&&b){const t=1/6;i.cameraCollisionOpacity=u[0]>o.min[0]&&u[0]<o.max[0]&&u[1]>o.min[1]&&u[1]<o.max[1]&&u[2]*p<o.max[2]&&r.footprint&&e.bA(E,r.footprint)?Math.max(i.cameraCollisionOpacity-t,0):Math.min(1,i.cameraCollisionOpacity+t)}const l=[...I],c=r.anchor?r.anchor[0]:0,h=r.anchor?r.anchor[1]:0;e.ad.mat4.translate(l,l,[c*(a[0]-1),h*(a[1]-1),n]),e.ad.vec3.exactEquals(a,e.dq)||e.ad.mat4.scale(l,l,a);const d=e.ad.mat4.multiply([],l,r.matrix),f=e.ad.mat4.multiply([],s.expandedFarZProjMatrix,d),m=e.ad.mat4.multiply([],s.expandedFarZProjMatrix,l),g=e.ad.vec4.transformMat4([],[c,h,n,1],f)[2];r.hidden=!1;let T=A;y||(b&&(T*=i.cameraCollisionOpacity,T*=ks(l,s,i.aabb,x)),T*=Fs(w,g)),0!==T?L.push({nodeInfo:i,depth:g,opacity:T,wvpForNode:f,wvpForTile:m,nodeModelMatrix:d,tileModelMatrix:l}):r.hidden=!0}y||L.sort(((e,t)=>!b||1===e.opacity&&1===t.opacity?e.depth<t.depth?-1:1:1===e.opacity?-1:1===t.opacity?1:e.depth>t.depth?-1:1));for(const i of L){const n=i.nodeInfo,c=n.node;let u=e.ad.mat4.multiply([],f,i.tileModelMatrix);e.ad.mat4.multiply(u,d,u);const h=e.ad.mat4.invert([],u);e.ad.mat4.transpose(h,h),e.ad.mat4.scale(h,h,Ps),u=e.ad.mat4.multiply(u,u,c.matrix);const p="light-beam"===t.renderPass,A="none"===r.paint.get("model-color-use-theme").constantOr("default"),_=P&e.ds.HasMapboxMeshFeatures,v=_?0:n.evaluatedRMEA[0][2];for(let e=0;e<c.meshes.length;++e){const d=c.meshes[e],f=e===c.lightMeshIndex;let x=i.wvpForNode;if(f){if(!p&&!t.terrain&&t.shadowRenderer){t.currentLayer<t.firstLightBeamLayer&&(t.firstLightBeamLayer=t.currentLayer);continue}x=i.wvpForTile}else if(p)continue;const b={defines:[]},w=[];if(!y&&l&&(l.useNormalOffset=!!d.normalBuffer),ws(b.defines,w,d,t,A?null:r.lut),_||b.defines.push("DIFFUSE_SHADED"),B&&b.defines.push("SHADOWS_SINGLE_CASCADE"),T&&(y?T.numRenderedVerticesInShadowPass+=d.vertexArray.length:T.numRenderedVerticesInTransparentPass+=d.vertexArray.length),y){Cs(d,i.nodeModelMatrix,t,r);continue}let C=null;if(a){const e=bs(i.nodeModelMatrix,t.transform);if(C=new Float32Array(e),"globe"!==s.projection.name){const t=d.aabb.min,i=d.aabb.max,[r,n]=a.getOpacityForBounds(e,t[0],t[1],i[0],i[1]);b.overrideFog=r>=Re||n>=Re}}const S=d.material;let E;S.occlusionTexture&&S.occlusionTexture.offsetScale&&(E=S.occlusionTexture.offsetScale,b.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const M=t.getOrCreateProgram("model",b);!y&&l&&l.setupShadowsFromMatrix(i.tileModelMatrix,M,l.useNormalOffset),t.uploadCommonUniforms(o,M,null,C);const I=S.pbrMetallicRoughness;I.metallicFactor=.9,I.roughnessFactor=.5;const P=wo(new Float32Array(x),new Float32Array(u),new Float32Array(h),new Float32Array(c.matrix),t,i.opacity,I.baseColorFactor.toRenderColor(null),S.emissiveFactor,I.metallicFactor,I.roughnessFactor,S,v,r,[0,0,0],E);!f&&(n.hasTranslucentParts||i.opacity<1)&&M.draw(t,o.gl.TRIANGLES,m,Ni.disabled,Di.disabled,Vi.backCCW,P,r.id,d.vertexBuffer,d.indexBuffer,d.segments,r.paint,t.transform.zoom,void 0,w),M.draw(t,o.gl.TRIANGLES,f?g:m,Ni.disabled,f||i.opacity<1||n.hasTranslucentParts?Di.alphaBlended:Di.unblended,Vi.backCCW,P,r.id,d.vertexBuffer,d.indexBuffer,d.segments,r.paint,t.transform.zoom,void 0,w)}}}}()}(t,i,r,n),void c();if("model"!==u.type)return;const h=u.getModels(),d=[],p=t.transform.getFreeCameraOptions().position,f=e.ad.vec3.scale([],[p.x,p.y,p.z],t.transform.worldSize);e.ad.vec3.negate(f,f);const A=[],m=[];let g=0;for(const i of h){const n=r.paint.get("model-rotation").constantOr(null),o=r.paint.get("model-scale").constantOr(null),s=r.paint.get("model-translation").constantOr(null);i.computeModelMatrix(t,n,o,s,!0,!0,!1);const a=e.ad.mat4.identity([]),l=e.dm(i.position.lat,t.transform.zoom),c=e.ad.mat4.fromScaling([],[1,1,1/l]);e.ad.mat4.translate(a,a,f),d.push({zScaleMatrix:c,negCameraPosMatrix:a});for(const e of i.nodes)Bs(t.transform,e,i.matrix,t.transform.expandedFarZProjMatrix,g,A,m);g++}if(A.sort(((e,t)=>t.depth-e.depth)),"shadow"!==t.renderPass){if(1===o)for(const e of m)Ts(e,t,r,d[e.modelIndex],Ni.disabled,t.colorModeForRenderPass());else{for(const e of m)Ts(e,t,r,d[e.modelIndex],Ni.disabled,Di.disabled);for(const e of m)Ts(e,t,r,d[e.modelIndex],t.stencilModeFor3D(),t.colorModeForRenderPass());t.resetStencilClippingMasks()}for(const e of A)Ts(e,t,r,d[e.modelIndex],Ni.disabled,t.colorModeForRenderPass());c()}else{for(const e of m)Cs(e.mesh,e.nodeModelMatrix,t,r);for(const e of A)Cs(e.mesh,e.nodeModelMatrix,t,r);c()}}},Ys={line:function(e,t,i){if(e.hasElevatedBuckets=!1,e.hasNonElevatedBuckets=!1,void 0!==e._unevaluatedLayout.getValue("line-elevation-reference")||void 0!==e._unevaluatedLayout.getValue("line-z-offset")){if(t){const i=t.getVisibleCoordinates();for(const r of i){const i=t.getTile(r).getBucket(e);if(i&&(i.hasZOffset?e.hasElevatedBuckets=!0:e.hasNonElevatedBuckets=!0,e.hasElevatedBuckets&&e.hasNonElevatedBuckets))break}}}else e.hasNonElevatedBuckets=!0},model:function(e,t,i){const r=t.getSource();if(!r.loaded())return;if("vector"===r.type||"geojson"===r.type)return void(i.modelManager&&i.modelManager.upload(i,"vector"===r.type?e.scope:""));if("batched-model"===r.type)return;if("model"!==r.type)return;const n=r.getModels();for(const e of n)e.upload(i.context)},raster:function(e,t,i){const r=t.getSource();if(!(r instanceof rt&&r.loaded()))return;const n=e.sourceLayer||r.rasterLayerIds&&r.rasterLayerIds[0];if(!n)return;const o=e.paint.get("raster-array-band")||r.getInitialBand(n);if(null==o)return;const s=t.getIds().map((e=>t.getTileByID(e)));for(const e of s)e.updateNeeded(n,o)&&r.prepareTile(e,n,o)},"raster-particle":function(e,t,i){const r=t.getSource();if(!(r instanceof rt&&r.loaded()))return;const n=e.sourceLayer||r.rasterLayerIds&&r.rasterLayerIds[0];if(!n)return;const o=e.paint.get("raster-particle-array-band")||r.getInitialBand(n);if(null==o)return;const s=t.getIds().map((e=>t.getTileByID(e)));for(const e of s)e.updateNeeded(n,o)&&r.prepareTile(e,n,o)}},Js={fill:No};class ea{constructor(t,i,r,n,o){this.context=new Io(t,i),this.transform=r,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=o,this._timeStamp=e.q.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const s=["fill","line","symbol","circle","heatmap","fill-extrusion","raster","raster-particle","hillshade","model","background","sky"];for(const e of s)this._debugParams.enabledLayers[e]=!0;o.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},(()=>{this.style.map.triggerRepaint()})),o.registerParameter(this._debugParams,["Precipitation"],"forceEnablePrecipitation"),o.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),o.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),o.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),o.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const e of s)o.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],e);this.occlusionParams=new Ds(o),this.setup(),this.numSublayers=Bt.maxUnderzooming+Bt.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new e.dy,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new rr(this),this._wireframeDebugCache=new Rs,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const a=new e.r({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new e.T(this.context,a,t.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=n}updateTerrain(e,t){const i=!!e&&!!e.terrain&&this.transform.projection.supportsTerrain;if(!(i||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Vn(this,e));const r=this._terrain;this.transform.elevation=i?r:null,r.update(e,this.transform,t),this.transform.elevation&&!r.enabled&&(this.transform.elevation=null)}_updateFog(e){const t=e.fog;if(!t||"globe"===this.transform.projection.name||t.getOpacity(this.transform.pitch)<1||t.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[i,r]=t.getFovAdjustedRange(this.transform._fov);if(i>r)return void(this.transform.fogCullDistSq=null);const n=i+.78*(r-i);this.transform.fogCullDistSq=n*n}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(e){e&&!this._terrain&&(this._terrain=new Vn(this,this.style)),this._forceTerrainMode=e}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(t,i){if(this.width=t*e.q.devicePixelRatio,this.height=i*e.q.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const e of this.style.order)this.style._mergedLayers[e].resize()}setup(){const t=this.context,i=new e.b5;i.emplaceBack(0,0),i.emplaceBack(e.ai,0),i.emplaceBack(0,e.ai),i.emplaceBack(e.ai,e.ai),this.tileExtentBuffer=t.createVertexBuffer(i,e.b7.members),this.tileExtentSegments=e.b8.simpleSegment(0,0,4,2);const r=new e.b5;r.emplaceBack(0,0),r.emplaceBack(e.ai,0),r.emplaceBack(0,e.ai),r.emplaceBack(e.ai,e.ai),this.debugBuffer=t.createVertexBuffer(r,e.b7.members),this.debugSegments=e.b8.simpleSegment(0,0,4,5);const n=new e.b5;n.emplaceBack(-1,-1),n.emplaceBack(1,-1),n.emplaceBack(-1,1),n.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(n,e.b7.members),this.viewportSegments=e.b8.simpleSegment(0,0,4,2);const o=new e.aU;o.emplaceBack(0,0,0,0),o.emplaceBack(e.ai,0,e.ai,0),o.emplaceBack(0,e.ai,0,e.ai),o.emplaceBack(e.ai,e.ai,e.ai,e.ai),this.mercatorBoundsBuffer=t.createVertexBuffer(o,e.ba.members),this.mercatorBoundsSegments=e.b8.simpleSegment(0,0,4,2);const s=new e.aV;s.emplaceBack(0,1,2),s.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(s);const a=new e.b6;for(const e of[0,1,3,2,0])a.emplaceBack(e);this.debugIndexBuffer=t.createIndexBuffer(a),this.emptyTexture=new e.T(t,new e.r({width:1,height:1},Uint8Array.of(0,0,0,0)),t.gl.RGBA8),this.identityMat=e.ad.mat4.create();const l=this.context.gl;this.stencilClearMode=new Ni({func:l.ALWAYS,mask:0},0,255,l.ZERO,l.ZERO,l.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(e){return e._makeTileBoundsBuffers(this.context,this.transform.projection),e._tileBoundsBuffer?{tileBoundsBuffer:e._tileBoundsBuffer,tileBoundsIndexBuffer:e._tileBoundsIndexBuffer,tileBoundsSegments:e._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const e=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,e.TRIANGLES,Oi.disabled,this.stencilClearMode,Di.disabled,Vi.disabled,On(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(e,t,i){if(!t||this.currentStencilSource===t.id||!e.isTileClipped()||!i||0===i.length)return;if(this._tileClippingMaskIDs&&!this.terrain){let e=!1;for(const t of i)if(void 0===this._tileClippingMaskIDs[t.key]){e=!0;break}if(!e)return}this.currentStencilSource=t.id;const r=this.context,n=r.gl;this.nextStencilID+i.length>256&&this.clearStencil(),r.setColorMode(Di.disabled),r.setDepthMode(Oi.disabled);const o=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const e of i){const i=t.getTile(e),r=this._tileClippingMaskIDs[e.key]=this.nextStencilID++,{tileBoundsBuffer:s,tileBoundsIndexBuffer:a,tileBoundsSegments:l}=this.getTileBoundsBuffers(i);o.draw(this,n.TRIANGLES,Oi.disabled,new Ni({func:n.ALWAYS,mask:0},r,255,n.KEEP,n.KEEP,n.REPLACE),Di.disabled,Vi.disabled,On(e.projMatrix),"$clipping",s,a,l)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const e=this.nextStencilID++,t=this.context.gl;return new Ni({func:t.NOTEQUAL,mask:255},e,255,t.KEEP,t.KEEP,t.REPLACE)}stencilModeForClipping(e){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(e);const t=this.context.gl;return new Ni({func:t.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,t.KEEP,t.KEEP,t.REPLACE)}stencilConfigForOverlap(e){const t=this.context.gl,i=e.sort(((e,t)=>t.overscaledZ-e.overscaledZ)),r=i[i.length-1].overscaledZ,n=i[0].overscaledZ-r+1;if(n>1){this.currentStencilSource=void 0,this.nextStencilID+n>256&&this.clearStencil();const e={};for(let i=0;i<n;i++)e[i+r]=new Ni({func:t.GEQUAL,mask:255},i+this.nextStencilID,255,t.KEEP,t.KEEP,t.REPLACE);return this.nextStencilID+=n,[e,i]}return[{[r]:Ni.disabled},i]}colorModeForRenderPass(){const t=this.context.gl;if(this._showOverdrawInspector){const i=1/8;return new Di([t.CONSTANT_COLOR,t.ONE,t.CONSTANT_COLOR,t.ONE],new e.al(i,i,i,0),[!0,!0,!0,!0])}return"opaque"===this.renderPass?Di.unblended:Di.alphaBlended}colorModeForDrapableLayerRenderPass(t){const i=this.context.gl;return(()=>this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture)()&&"translucent"===this.renderPass?new Di([i.ONE,i.ONE_MINUS_SRC_ALPHA,i.CONSTANT_ALPHA,i.ONE_MINUS_SRC_ALPHA],new e.al(0,0,0,void 0===t?0:t),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(e,t,i,r=!1){if(this.depthOcclusion)return new Oi(this.context.gl.GREATER,Oi.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!r)return Oi.disabled;const n=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new Oi(i||this.context.gl.LEQUAL,t,[n,n])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const t=this.context.gl,i=Math.ceil(this.width),r=Math.ceil(this.height),n=this.context.bindFramebuffer.get(),o=t.getParameter(t.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===i&&this.depthFBO.height===r||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),0!==i&&0!==r&&(this.depthFBO=new Mo(this.context,i,r,!1,"texture"),this.depthTexture=new e.T(this.context,{width:i,height:r,data:null},t.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(n),t.bindTexture(t.TEXTURE_2D,o),this.depthFBO&&(t.bindFramebuffer(t.READ_FRAMEBUFFER,null),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),t.blitFramebuffer(0,0,i,r,0,0,i,r,t.DEPTH_BUFFER_BIT,t.NEAREST),t.bindFramebuffer(t.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(0===this._dt?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce(((e,t)=>e+t/this._fpsHistory.length),0))}render(t,i){const r=e.q.now();this._dt=r-this._timeStamp,this._timeStamp=r,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=t.map.repaint,this.style=t,this.options=i;const n=this.style._mergedLayers,o=!(!this.terrain||!this.terrain.enabled),s=()=>this.style._getOrder(o).filter((e=>{const t=n[e];return!(t.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[t.type]}));let a=s(),l=!1,c=!1;for(const e of a){const t=n[e];"circle"===t.type&&(l=!0),"symbol"===t.type&&(t.hasInitialOcclusionOpacityProperties?c=!0:l=!0)}let u=a.map((e=>n[e]));const h=this.style._mergedSourceCaches;this.imageManager=t.imageManager,this.modelManager=t.modelManager,this.symbolFadeChange=t.placement.symbolFadeChange(e.q.now()),this.imageManager.beginFrame();let d=0,p=!1;for(const e in h){const t=h[e];t.used&&(t.prepare(this.context),t.getSource().usedInConflation&&++d)}let f=!1;for(const e of u)e.isHidden(this.transform.zoom)||("clip"===e.type&&(f=!0),this.prepareLayer(e));const A={},m={},g={},_={},y={};for(const e in h){const t=h[e];A[e]=t.getVisibleCoordinates(),m[e]=A[e].slice().reverse(),g[e]=t.getVisibleCoordinates(!0).reverse(),_[e]=t.getShadowCasterCoordinates(),y[e]=t.sortCoordinatesByDistance(A[e])}const v=e=>{const t=this.style.getLayerSourceCache(e);return t&&t.used?t.getSource():null};if(d||f||this._clippingActiveLastFrame){const t=[],i=[];let r=0;for(const e of u)this.isSourceForClippingOrConflation(e,v(e))&&(t.push(e),i.push(r)),r++;if(t&&(f||t.length>1)||this._clippingActiveLastFrame){f=!1;const r=[];for(let n=0;n<t.length;n++){const o=t[n],s=i[n],a=this.style.getLayerSourceCache(o);if(!a||!a.used||!a.getSource().usedInConflation&&"clip"!==o.type)continue;let l=e.dA,c=e.by.None;const u=[];let h=!0;if("clip"===o.type){l=s;for(const t of o.layout.get("clip-layer-types"))c|="model"===t?e.by.Model:"symbol"===t?e.by.Symbol:e.by.FillExtrusion;for(const e of o.layout.get("clip-layer-scope"))u.push(e);o.isHidden(this.transform.zoom)?h=!1:f=!0}h&&r.push({layer:o.fqid,cache:a,order:l,clipMask:c,clipScope:u})}this.replacementSource.setSources(r),p=!0}}this._clippingActiveLastFrame=f,p||this.replacementSource.clear(),this.conflationActive=p,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let e=0;e<u.length;e++){const t=u[e],i=t.cutoffRange();if(this.longestCutoffRange=Math.max(i,this.longestCutoffRange),i>0){const e=v(t);e&&(this.minCutoffZoom=Math.max(e.minzoom,this.minCutoffZoom)),t.minzoom&&(this.minCutoffZoom=Math.max(t.minzoom,this.minCutoffZoom))}t.is3D(o)&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=e),this._lastOcclusionLayer=e)}const x=this.style&&this.style.fog;x?(this._fogVisible=0!==x.getOpacity(this.transform.pitch),this._fogVisible&&"globe"!==this.transform.projection.name&&(this._fogVisible=x.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(g),this.opaquePassCutoff=0,a=s(),u=a.map((e=>n[e])));const b=this._shadowRenderer;if(b){b.updateShadowParameters(this.transform,this.style.directionalLight);for(const e in h)for(const t of A[e]){let e={min:0,max:0};this.terrain&&(e=this.terrain.getMinMaxForTile(t)||e),b.addShadowReceiver(t.toUnwrapped(),e.min,e.max)}}"globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new e.dz(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new xs(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const w=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),T=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(w&&!this._snow&&(this._snow=new Ws(this)),!w&&this._snow&&(this._snow.destroy(),delete this._snow),T&&!this._rain&&(this._rain=new qs(this)),!T&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),!N.has(this.context.gl))return;this.renderPass="offscreen";for(const e of u){const i=t.getLayerSourceCache(e);if(!e.hasOffscreenPass()||e.isHidden(this.transform.zoom))continue;const r=i?m[i.id]:void 0;("custom"===e.type||"raster"===e.type||"raster-particle"===e.type||e.isSky()||r&&r.length)&&this.renderLayer(this,i,e,r)}this.depthRangeFor3D=[0,1-(u.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,_)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const B="globe"===this.transform.projection.name||this.transform.isHorizonVisible(),C=(()=>{if(i.showOverdrawInspector)return e.al.black;const t=this.style.fog;if(t&&this.transform.projection.supportsFog){const i=this.style.getLut(t.scope);if(!B){const r="none"===t.properties.get("color-use-theme"),n=t.properties.get("color").toRenderColor(r?null:i).toArray01();return new e.al(...n)}if(B){const r="none"===t.properties.get("space-color-use-theme"),n=t.properties.get("space-color").toRenderColor(r?null:i).toArray01();return new e.al(...n)}}return e.al.transparent})();if(this.context.clear({color:C,depth:1}),this.clearStencil(),this._showOverdrawInspector=i.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&B&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=a.length-1;this.currentLayer>=0;this.currentLayer--){const e=u[this.currentLayer],i=t.getLayerSourceCache(e);if(e.isSky())continue;const r=i?(e.is3D(o)?y:m)[i.id]:void 0;this._renderTileClippingMasks(e,i,r),this.renderLayer(this,i,e,r)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&B&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||e.ag(this.transform.zoom)>0)&&("globe"===this.transform.projection.name||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<a.length;this.currentLayer++){const e=u[this.currentLayer],i=t.getLayerSourceCache(e);e.isSky()&&this.renderLayer(this,i,e,i?m[i.id]:void 0)}function S(e,t){let i;return t&&(i=("symbol"===e.type?g:e.is3D(o)?y:m)[t.id]),i}if(this.renderPass="translucent","globe"===this.transform.projection.name){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<a.length;){const e=u[this.currentLayer];if("raster"===e.type||"raster-particle"===e.type){const i=t.getLayerSourceCache(e);this.renderLayer(this,i,e,S(e,i))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let E=0;b&&(E=b.getShadowCastingLayerCount());let M=!1,I=-1;for(let e=0;e<a.length;++e){const t=u[e];t.isHidden(this.transform.zoom)||t.is3D(o)&&(I=e)}c&&-1===I&&(l=!0);let P=!1;for(;this.currentLayer<a.length;){const e=u[this.currentLayer],i=t.getLayerSourceCache(e);if(e.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(e)){if(e.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(!P&&e.is3D(o)&&!o){const e=this.currentLayer,t=e=>{for(this.currentLayer=0;this.currentLayer<u.length;this.currentLayer++){const t=u[this.currentLayer];if(Js[t.type]){const i=this.style.getLayerSourceCache(t);Js[t.type](this,i,t,S(t,i),e)}}};t("initialize"),t("reset"),this.currentLayer=e,P=!0}if(l&&!M&&this.terrain&&!this.transform.isOrthographic&&(M=!0,this.blitDepth()),c&&-1!==I&&this.currentLayer===I+1&&!this.transform.isOrthographic&&this.blitDepth(),this.terrain||this._renderTileClippingMasks(e,i,i?A[i.id]:void 0),this.renderLayer(this,i,e,S(e,i)),!this.terrain&&b&&E>0&&e.hasShadowPass()&&0==--E&&(b.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){const e=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=e;this.currentLayer++){const e=u[this.currentLayer];if(!e.hasLightBeamPass())continue;const i=t.getLayerSourceCache(e);this.renderLayer(this,i,e,i?m[i.id]:void 0)}this.currentLayer=e,this.renderPass="translucent"}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const e=this.currentLayer;this.depthOcclusion=!0;for(const e of this.layersWithOcclusionOpacity){this.currentLayer=e;const i=u[this.currentLayer],r=t.getLayerSourceCache(i),n=r?m[r.id]:void 0;this.terrain||this._renderTileClippingMasks(i,r,r?A[r.id]:void 0),this.renderLayer(this,r,i,n)}this.depthOcclusion=!1,this.currentLayer=e,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let i=null;u.forEach((e=>{const r=t.getLayerSourceCache(e);r&&!e.isHidden(this.transform.zoom)&&r.getVisibleCoordinates().length&&(!i||i.getSource().maxzoom<r.getSource().maxzoom)&&(i=r)})),i&&this.options.showTileBoundaries&&Xs.debug(this,i,i.getVisibleCoordinates(),e.al.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&Xs.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new e.al(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(e){const t=e.transform.padding;cs(e,e.transform.height-(t.top||0),3,rs),cs(e,t.bottom||0,3,ns),us(e,t.left||0,3,os),us(e,e.transform.width-(t.right||0),3,ss);const i=e.transform.centerPoint;!function(e,t,i,r){hs(e,t-1,i-10,2,20,r),hs(e,t-10,i-1,20,2,r)}(e,i.x,e.transform.height-i.y,as)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),p||(this.conflationActive=!1)}prepareLayer(e){this.gpuTimingStart(e);const{unsupportedLayers:t}=this.transform.projection,i=!t||!t.includes(e.type);if(Ys[e.type]&&(i||this.terrain&&"custom"===e.type)){const t=this.style.getLayerSourceCache(e);Ys[e.type](e,t,this)}this.gpuTimingEnd()}renderLayer(e,t,i,r){i.isHidden(this.transform.zoom)||("background"===i.type||"sky"===i.type||"custom"===i.type||"model"===i.type||"raster"===i.type||"raster-particle"===i.type||r&&r.length)&&(this.id=i.id,this.gpuTimingStart(i),e.transform.projection.unsupportedLayers&&e.transform.projection.unsupportedLayers.includes(i.type)&&(!e.terrain||"custom"!==i.type)||"clip"===i.type||Xs[i.type](e,t,i,r,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(e){if(!this.options.gpuTiming)return;const t=this.context.extTimerQuery,i=this.context.gl;let r=this.gpuTimers[e.id];r||(r=this.gpuTimers[e.id]={calls:0,cpuTime:0,query:i.createQuery()}),r.calls++,i.beginQuery(t.TIME_ELAPSED_EXT,r.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const e=this.context.extTimerQuery,t=this.context.gl,i=t.createQuery();this.deferredRenderGpuTimeQueries.push(i),t.beginQuery(e.TIME_ELAPSED_EXT,i)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const e=this.gpuTimers;return this.gpuTimers={},e}collectDeferredRenderGpuQueries(){const e=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],e}queryGpuTimers(e){const t={};for(const i in e){const r=e[i],n=this.context.extTimerQuery,o=n.getQueryParameter(r.query,this.context.gl.QUERY_RESULT)/1e6;n.deleteQueryEXT(r.query),t[i]=o}return t}queryGpuTimeDeferredRender(e){if(!this.options.gpuTimingDeferredRender)return 0;const t=this.context.gl;let i=0;for(const r of e)i+=t.getQueryParameter(r,t.QUERY_RESULT)/1e6,t.deleteQuery(r);return i}translatePosMatrix(t,i,r,n,o){if(!r[0]&&!r[1])return t;const s=o?"map"===n?this.transform.angle:0:"viewport"===n?-this.transform.angle:0;if(s){const e=Math.sin(s),t=Math.cos(s);r=[r[0]*t-r[1]*e,r[0]*e+r[1]*t]}const a=[o?r[0]:e.at(i,r[0],this.transform.zoom),o?r[1]:e.at(i,r[1],this.transform.zoom),0],l=new Float32Array(16);return e.ad.mat4.translate(l,t,a),l}saveTileTexture(e){const t=e.size[0],i=this._tileTextures[t];i?i.push(e):this._tileTextures[t]=[e]}getTileTexture(e){const t=this._tileTextures[e];return t&&t.length>0?t.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return null!=this.context.extTextureFloatLinear}currentGlobalDefines(e,t,i){const r=void 0===i?this.terrain&&this.terrain.renderingToTexture:i,n=[];return this.style&&this.style.enable3dLights()&&("globeRaster"===e||"terrainRaster"===e?(n.push("LIGHTING_3D_MODE"),n.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):r||n.push("LIGHTING_3D_MODE")),"shadow"===this.renderPass&&(this._shadowMapDebug||n.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(n.push("TERRAIN"),this.linearFloatFilteringSupported()&&n.push("TERRAIN_DEM_FLOAT_FORMAT")),"globe"===this.transform.projection.name&&n.push("GLOBE"),!this._fogVisible||r||void 0!==t&&!t||n.push("FOG","FOG_DITHERING"),r&&n.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&n.push("OVERDRAW_INSPECTOR"),n}getOrCreateProgram(e,t){this.cache=this.cache||{};const i=t&&t.defines||[],r=t&&t.config,n=this.currentGlobalDefines(e,t&&t.overrideFog,t&&t.overrideRtt).concat(i),o=Zn.cacheKey(Ur[e],e,n,r);return this.cache[o]||(this.cache[o]=new Zn(this.context,e,Ur[e],r,Bo[e],n)),this.cache[o]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new e.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(t,i){if(this.style.enable3dLights()){const r=this.style.directionalLight,n=this.style.ambientLight;if(r&&n){const o=((t,i,r)=>{const n=t.properties.get("direction"),o="none"===t.properties.get("color-use-theme"),s=t.properties.get("color").toRenderColor(o?null:r.getLut(t.scope)).toArray01(),a=t.properties.get("intensity"),l="none"===i.properties.get("color-use-theme"),c=i.properties.get("color").toRenderColor(l?null:r.getLut(i.scope)).toArray01(),u=i.properties.get("intensity"),h=[n.x,n.y,n.z],d=e.cN(c,u),p=e.cN(s,a);return{u_lighting_ambient_color:d,u_lighting_directional_dir:h,u_lighting_directional_color:p,u_ground_radiance:Hn(h,p,d)}})(r,n,this.style);i.setLightsUniformValues(t,o)}}}uploadCommonUniforms(t,i,r,n,o){if(this.uploadCommonLightUniforms(t,i),this.terrain&&this.terrain.renderingToTexture)return;const s=this.style.fog;if(s){const o=s.getOpacity(this.transform.pitch),a=((t,i,r,n,o,s,a,l,c,u,h,d)=>{const p=t.transform,f="none"===i.properties.get("color-use-theme"),A=i.properties.get("color").toRenderColor(f?null:t.style.getLut(i.scope)).toArray01();A[3]=n;const m=t.frameCounter/1e3%1,[g,_]=i.properties.get("vertical-range");return{u_fog_matrix:r?p.calculateFogTileMatrix(r):d||t.identityMat,u_fog_range:i.getFovAdjustedRange(p._fov),u_fog_color:A,u_fog_horizon_blend:i.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(g,_),_],u_fog_temporal_offset:m,u_frustum_tl:o,u_frustum_tr:s,u_frustum_br:a,u_frustum_bl:l,u_globe_pos:c,u_globe_radius:u,u_viewport:h,u_globe_transition:e.ag(p.zoom),u_is_globe:+("globe"===p.projection.name)}})(this,s,r,o,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*e.q.devicePixelRatio,this.transform.height*e.q.devicePixelRatio],n);i.setFogUniformValues(t,a)}o&&i.setCutoffUniformValues(t,o.uniformValues)}setTileLoadedFlag(e){this.tileLoaded=e}saveCanvasCopy(){const e=this.canvasCopy();e&&(this.frameCopies.push(e),this.tileLoaded=!1)}canvasCopy(){const e=this.context.gl,t=e.createTexture();return e.bindTexture(e.TEXTURE_2D,t),e.copyTexImage2D(e.TEXTURE_2D,0,e.RGBA,0,0,e.drawingBufferWidth,e.drawingBufferHeight,0),t}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const e=this.style&&this.style.fog;return!!e&&0!==e.getOpacity(this.transform.pitch)}getBackgroundTiles(){const e=this._backgroundTiles,t=this._backgroundTiles={},i=this.transform.coveringTiles({tileSize:512});for(const r of i)t[r.key]=e[r.key]||new xt(r,512,this.transform.tileZoom,this);return t}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(e,t){return!(!e.is3D(!(!this.terrain||!this.terrain.enabled))||"clip"!==e.type&&(e.minzoom&&e.minzoom>this.transform.zoom||(this.style._clipLayerPresent||"building"!==e.sourceLayer)&&(!t||"batched-model"!==t.type)))}isTileAffectedByFog(e){if(!this.style||!this.style.fog)return!1;if("globe"===this.transform.projection.name)return!0;let t=this._cachedTileFogOpacities[e.key];return t||(this._cachedTileFogOpacities[e.key]=t=this.style.fog.getOpacityForTile(e)),t[0]>=Re||t[1]>=Re}setupDepthForOcclusion(e,t,i){const r=this.context,n=r.gl,o=!!i;var s;i||(i={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),r.activeTexture.set(n.TEXTURE3),e&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(n.NEAREST,n.CLAMP_TO_EDGE),i.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],i.u_depth_range_unpack=[2/((s=this.depthRangeFor3D)[1]-s[0]),-1-2*s[0]/(s[1]-s[0])],i.u_occluder_half_size=.5*this.occlusionParams.occluderSize,i.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(n.NEAREST,n.CLAMP_TO_EDGE),r.activeTexture.set(n.TEXTURE0),o||t.setTerrainUniformValues(r,i)}}function ta(e,t){let i=!1,r=null;const n=()=>{r=null,i&&(e(),r=setTimeout(n,t),i=!1)};return()=>(i=!0,r||n(),r)}class ia{constructor(t){this._hashName=t&&encodeURIComponent(t),e.aQ(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=ta(this._updateHashUnthrottled.bind(this),300)}addTo(e){return this._map=e,window.addEventListener("hashchange",this._onHashChange,!1),e.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const e=this._map;if(!e)return"";const t=ra(e);if(this._hashName){const e=this._hashName;let i=!1;const r=location.hash.slice(1).split("&").map((r=>{const n=r.split("=")[0];return n===e?(i=!0,`${n}=${t}`):r})).filter((e=>e));return i||r.push(`${e}=${t}`),`#${r.join("&")}`}return`#${t}`}_getCurrentHash(){const e=location.hash.replace("#","");if(this._hashName){let t;return e.split("&").map((e=>e.split("="))).forEach((e=>{e[0]===this._hashName&&(t=e)})),(t&&t[1]||"").split("/")}return e.split("/")}_onHashChange(){const e=this._map;if(!e)return!1;const t=this._getCurrentHash();if(t.length>=3&&!t.some((e=>isNaN(e)))){const i=e.dragRotate.isEnabled()&&e.touchZoomRotate.isEnabled()?+(t[3]||0):e.getBearing();return e.jumpTo({center:[+t[2],+t[1]],zoom:+t[0],bearing:i,pitch:+(t[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function ra(e,t){const i=e.getCenter(),r=Math.round(100*e.getZoom())/100,n=Math.ceil((r*Math.LN2+Math.log(512/360/.5))/Math.LN10),o=Math.pow(10,n),s=Math.round(i.lng*o)/o,a=Math.round(i.lat*o)/o,l=e.getBearing(),c=e.getPitch();let u=t?`/${s}/${a}/${r}`:`${r}/${a}/${s}`;return(l||c)&&(u+="/"+Math.round(10*l)/10),c&&(u+=`/${Math.round(c)}`),u}const na={linearity:.3,easing:e.dB(0,0,.3,1)},oa=e.l({deceleration:2500,maxSpeed:1400},na),sa=e.l({deceleration:20,maxSpeed:1400},na),aa=e.l({deceleration:1e3,maxSpeed:360},na),la=e.l({deceleration:1e3,maxSpeed:90},na);class ca{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:e.q.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,i=e.q.now();for(;t.length>0&&i-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._map._prefersReducedMotion())return;if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const i={zoom:0,bearing:0,pitch:0,pan:new e.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:e}of this._inertiaBuffer)i.zoom+=e.zoomDelta||0,i.bearing+=e.bearingDelta||0,i.pitch+=e.pitchDelta||0,e.panDelta&&i.pan._add(e.panDelta),e.around&&(i.around=e.around),e.pinchAround&&(i.pinchAround=e.pinchAround);const r=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,n={};if(i.pan.mag()){const o=ha(i.pan.mag(),r,e.l({},oa,t||{}));n.offset=i.pan.mult(o.amount/i.pan.mag()),n.center=this._map.transform.center,ua(n,o)}if(i.zoom){const e=ha(i.zoom,r,sa);n.zoom=this._map.transform.zoom+e.amount,ua(n,e)}if(i.bearing){const t=ha(i.bearing,r,aa);n.bearing=this._map.transform.bearing+e.ay(t.amount,-179,179),ua(n,t)}if(i.pitch){const e=ha(i.pitch,r,la);n.pitch=this._map.transform.pitch+e.amount,ua(n,e)}if(n.zoom||n.bearing){const e=void 0===i.pinchAround?i.around:i.pinchAround;n.around=e?this._map.unproject(e):this._map.getCenter()}return this.clear(),n.noMoveStart=!0,n}}function ua(e,t){(!e.duration||e.duration<t.duration)&&(e.duration=t.duration,e.easing=t.easing)}function ha(t,i,r){const{maxSpeed:n,linearity:o,deceleration:s}=r,a=e.ay(t*o/(i/1e3),-n,n),l=Math.abs(a)/(s*o);return{easing:r.easing,duration:1e3*l,amount:a*(l/2)}}class da extends e.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,i,r,n={}){const o=g(i.getCanvasContainer(),r),s=i.unproject(o);super(t,e.l({point:o,lngLat:s,originalEvent:r},n)),this._defaultPrevented=!1,this.target=i}}class pa extends e.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,i,r){const n="touchend"===t?r.changedTouches:r.touches,o=_(i.getCanvasContainer(),n),s=o.map((e=>i.unproject(e))),a=o.reduce(((e,t,i,r)=>e.add(t.div(r.length))),new e.P(0,0));super(t,{points:o,point:a,lngLats:s,lngLat:i.unproject(a),originalEvent:r}),this._defaultPrevented=!1}}class fa extends e.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,t){super("wheel",{originalEvent:t}),this._defaultPrevented=!1}}class Aa{constructor(e,t){this._map=e,this._clickTolerance=t.clickTolerance}reset(){this._mousedownPos=void 0}wheel(e){return this._firePreventable(new fa(this._map,e))}mousedown(e,t){return this._mousedownPos=t,this._firePreventable(new da(e.type,this._map,e))}mouseup(e){this._map.fire(new da(e.type,this._map,e))}preclick(t){const i=e.l({},t);i.type="preclick",this._map.fire(new da(i.type,this._map,i))}click(e,t){this._mousedownPos&&this._mousedownPos.dist(t)>=this._clickTolerance||(this.preclick(e),this._map.fire(new da(e.type,this._map,e)))}dblclick(e){return this._firePreventable(new da(e.type,this._map,e))}mouseover(e){this._map.fire(new da(e.type,this._map,e))}mouseout(e){this._map.fire(new da(e.type,this._map,e))}touchstart(e){return this._firePreventable(new pa(e.type,this._map,e))}touchmove(e){this._map.fire(new pa(e.type,this._map,e))}touchend(e){this._map.fire(new pa(e.type,this._map,e))}touchcancel(e){this._map.fire(new pa(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ma{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(e){this._map.fire(new da(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new da("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._map.fire(new da(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ga{constructor(e,t){this._map=e,this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=t.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,t){this.isEnabled()&&e.shiftKey&&0===e.button&&(p(),this._startPos=this._lastPos=t,this._active=!0)}mousemoveWindow(e,t){if(!this._active)return;const i=t,r=this._startPos,n=this._lastPos;if(!r||!n||n.equals(i)||!this._box&&i.dist(r)<this._clickTolerance)return;this._lastPos=i,this._box||(this._box=l("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",e));const o=Math.min(r.x,i.x),s=Math.max(r.x,i.x),a=Math.min(r.y,i.y),c=Math.max(r.y,i.y);this._map._requestDomTask((()=>{this._box&&(this._box.style.transform=`translate(${o}px,${a}px)`,this._box.style.width=s-o+"px",this._box.style.height=c-a+"px")}))}mouseupWindow(t,i){if(!this._active)return;const r=this._startPos,n=i;if(r&&0===t.button){if(this.reset(),m(),r.x!==n.x||r.y!==n.y)return this._map.fire(new e.A("boxzoomend",{originalEvent:t})),{cameraAnimation:e=>e.fitScreenCoordinates(r,n,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",t)}}keydown(e){this._active&&27===e.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",e))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),f(),delete this._startPos,delete this._lastPos}_fireEvent(t,i){return this._map.fire(new e.A(t,{originalEvent:i}))}}function _a(e,t){const i={};for(let r=0;r<e.length;r++)i[e[r].identifier]=t[r];return i}class ya{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(t,i,r){(this.centroid||r.length>this.numTouches)&&(this.aborted=!0),this.aborted||(0===this.startTime&&(this.startTime=t.timeStamp),r.length===this.numTouches&&(this.centroid=function(t){const i=new e.P(0,0);for(const e of t)i._add(e);return i.div(t.length)}(i),this.touches=_a(r,i)))}touchmove(e,t,i){if(this.aborted||!this.centroid)return;const r=_a(i,t);for(const e in this.touches){const t=r[e];(!t||t.dist(this.touches[e])>30)&&(this.aborted=!0)}}touchend(e,t,i){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),0===i.length){const e=!this.aborted&&this.centroid;if(this.reset(),e)return e}}}class va{constructor(e){this.singleTap=new ya(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(e,t,i){this.singleTap.touchstart(e,t,i)}touchmove(e,t,i){this.singleTap.touchmove(e,t,i)}touchend(e,t,i){const r=this.singleTap.touchend(e,t,i);if(r){const t=e.timeStamp-this.lastTime<500,i=!this.lastTap||this.lastTap.dist(r)<30;if(t&&i||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=r,this.count===this.numTaps)return this.reset(),r}}}class xa{constructor(){this._zoomIn=new va({numTouches:1,numTaps:2}),this._zoomOut=new va({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,t,i){this._zoomIn.touchstart(e,t,i),this._zoomOut.touchstart(e,t,i)}touchmove(e,t,i){this._zoomIn.touchmove(e,t,i),this._zoomOut.touchmove(e,t,i)}touchend(e,t,i){const r=this._zoomIn.touchend(e,t,i),n=this._zoomOut.touchend(e,t,i);return r?(this._active=!0,e.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:t=>t.easeTo({duration:300,zoom:t.getZoom()+1,around:t.unproject(r)},{originalEvent:e})}):n?(this._active=!0,e.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:t=>t.easeTo({duration:300,zoom:t.getZoom()-1,around:t.unproject(n)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const ba={0:1,2:2},wa={Control:"ctrlKey",Alt:"altKey",Shift:"shiftKey",Meta:"metaKey"};class Ta{constructor(e){this.reset(),this._clickTolerance=e.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(e,t){return!1}_move(e,t){return{}}mousedown(e,t){if(this._lastPoint)return;const i=y(e);this._correctButton(e,i)&&(this._lastPoint=t,this._eventButton=i)}mousemoveWindow(e,t){const i=this._lastPoint;if(i)if(e.preventDefault(),null!=this._eventButton&&function(e,t){const i=ba[t];return void 0===e.buttons||(e.buttons&i)!==i}(e,this._eventButton))this.reset();else if(this._moved||!(t.dist(i)<this._clickTolerance))return this._moved=!0,this._lastPoint=t,this._move(i,t)}mouseupWindow(e){this._lastPoint&&y(e)===this._eventButton&&(this._moved&&m(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ba extends Ta{mousedown(e,t){super.mousedown(e,t),this._lastPoint&&(this._active=!0)}_correctButton(e,t){return 0===t&&!e.ctrlKey}_move(e,t){return{around:t,panDelta:t.sub(e)}}}class Ca extends Ta{constructor(e){super(e),this._pitchRotateKey=e.pitchRotateKey?wa[e.pitchRotateKey]:void 0}_correctButton(e,t){return this._pitchRotateKey?0===t&&e[this._pitchRotateKey]:0===t&&e.ctrlKey||2===t}_move(e,t){const i=.8*(t.x-e.x);if(i)return this._active=!0,{bearingDelta:i}}contextmenu(e){this._pitchRotateKey||e.preventDefault()}}class Sa extends Ta{constructor(e){super(e),this._pitchRotateKey=e.pitchRotateKey?wa[e.pitchRotateKey]:void 0}_correctButton(e,t){return this._pitchRotateKey?0===t&&e[this._pitchRotateKey]:0===t&&e.ctrlKey||2===t}_move(e,t){const i=-.5*(t.y-e.y);if(i)return this._active=!0,{pitchDelta:i}}contextmenu(e){this._pitchRotateKey||e.preventDefault()}}class Ea{constructor(t,i){this._map=t,this._el=t.getCanvasContainer(),this._minTouches=1,this._clickTolerance=i.clickTolerance||1,this.reset(),e.aQ(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new e.P(0,0)}touchstart(e,t,i){return this._calculateTransform(e,t,i)}touchmove(t,i,r){if(this._active&&!(r.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===r.length&&!e.dC())return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return t.cancelable&&t.preventDefault(),this._calculateTransform(t,i,r)}}touchend(e,t,i){this._calculateTransform(e,t,i),this._active&&i.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,i,r){r.length>0&&(this._active=!0);const n=_a(r,i),o=new e.P(0,0),s=new e.P(0,0);let a=0;for(const e in n){const t=n[e],i=this._touches[e];i&&(o._add(t),s._add(t.sub(i)),a++,n[e]=t)}if(this._touches=n,a<this._minTouches||!s.mag())return;const l=s.div(a);return this._sum._add(l),this._sum.mag()<this._clickTolerance?void 0:{around:o.div(a),panDelta:l}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=l("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout((()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")}),500)}}class Ma{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(e){}_move(e,t,i){return{}}touchstart(e,t,i){this._firstTwoTouches||i.length<2||(this._firstTwoTouches=[i[0].identifier,i[1].identifier],this._start([t[0],t[1]]))}touchmove(e,t,i){const r=this._firstTwoTouches;if(!r)return;e.preventDefault();const[n,o]=r,s=Ia(i,t,n),a=Ia(i,t,o);if(!s||!a)return;const l=this._aroundCenter?null:s.add(a).div(2);return this._move([s,a],l,e)}touchend(e,t,i){if(!this._firstTwoTouches)return;const[r,n]=this._firstTwoTouches,o=Ia(i,t,r),s=Ia(i,t,n);o&&s||(this._active&&m(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&"center"===e.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Ia(e,t,i){for(let r=0;r<e.length;r++)if(e[r].identifier===i)return t[r]}function Pa(e,t){return Math.log(e/t)/Math.LN2}class La extends Ma{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,t){const i=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(Pa(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Pa(this._distance,i),pinchAround:t}}}function Fa(e,t){return 180*e.angleWith(t)/Math.PI}class ka extends Ma{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,t){const i=this._vector;if(this._vector=e[0].sub(e[1]),i&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Fa(this._vector,i),pinchAround:t}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());const t=25/(Math.PI*this._minDiameter)*360,i=this._startVector;if(!i)return!1;const r=Fa(e,i);return Math.abs(r)<t}}function za(e){return Math.abs(e.y)>Math.abs(e.x)}class Ra extends Ma{constructor(e){super(),this._map=e}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(e){this._lastPoints=e,za(e[0].sub(e[1]))&&(this._valid=!1)}_move(t,i,r){const n=this._lastPoints;if(!n)return;const o=t[0].sub(n[0]),s=t[1].sub(n[1]);return this._map._cooperativeGestures&&!e.dC()&&r.touches.length<3||(this._valid=this.gestureBeginsVertically(o,s,r.timeStamp),!this._valid)?void 0:(this._lastPoints=t,this._active=!0,{pitchDelta:(o.y+s.y)/2*-.5})}gestureBeginsVertically(e,t,i){if(void 0!==this._valid)return this._valid;const r=e.mag()>=2,n=t.mag()>=2;if(!r&&!n)return;if(!r||!n)return null==this._firstMove&&(this._firstMove=i),i-this._firstMove<100&&void 0;const o=e.y>0==t.y>0;return za(e)&&za(t)&&o}}const Da={panStep:100,bearingStep:15,pitchStep:10};class Oa{constructor(){const e=Da;this._panStep=e.panStep,this._bearingStep=e.bearingStep,this._pitchStep=e.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let t=0,i=0,r=0,n=0,o=0;switch(e.keyCode){case 61:case 107:case 171:case 187:t=1;break;case 189:case 109:case 173:t=-1;break;case 37:e.shiftKey?i=-1:(e.preventDefault(),n=-1);break;case 39:e.shiftKey?i=1:(e.preventDefault(),n=1);break;case 38:e.shiftKey?r=1:(e.preventDefault(),o=-1);break;case 40:e.shiftKey?r=-1:(e.preventDefault(),o=1);break;default:return}return this._rotationDisabled&&(i=0,r=0),{cameraAnimation:s=>{const a=s.getZoom();s.easeTo({duration:300,easeId:"keyboardHandler",easing:Ua,zoom:t?Math.round(a)+t*(e.shiftKey?2:1):a,bearing:s.getBearing()+i*this._bearingStep,pitch:s.getPitch()+r*this._pitchStep,offset:[-n*this._panStep,-o*this._panStep],center:s.getCenter()},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Ua(e){return e*(2-e)}const Na=4.000244140625,Qa=1/450;class ja{constructor(t,i){this._map=t,this._el=t.getCanvasContainer(),this._handler=i,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=Qa,e.aQ(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&"center"===e.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(t.ctrlKey||t.metaKey||this.isZooming()||e.dC()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let i=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const r=e.q.now(),n=r-(this._lastWheelEventTime||0);this._lastWheelEventTime=r,0!==i&&i%Na==0?this._type="wheel":0!==i&&Math.abs(i)<4?this._type="trackpad":n>400?(this._type=null,this._lastValue=i,this._timeout=window.setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(n*i)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,i+=this._lastValue)),t.shiftKey&&i&&(i/=4),this._type&&(this._lastWheelEvent=t,this._delta-=i,this._active||this._start(t)),t.preventDefault()}_onTimeout(e){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(e)}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const t=g(this._el,e);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:t,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId)return;if(this._frameId=null,!this.isActive())return;const t=this._map.transform;"wheel"===this._type&&t.projection.wrap&&(t._center.lng>=180||t._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const i=()=>t._terrainEnabled()&&this._aroundCoord?t.computeZoomRelativeTo(this._aroundCoord):t.zoom;if(0!==this._delta){const e="wheel"===this._type&&Math.abs(this._delta)>Na?this._wheelZoomRate:this._defaultZoomRate;let r=2/(1+Math.exp(-Math.abs(this._delta*e)));this._delta<0&&0!==r&&(r=1/r);const n=i(),o=Math.pow(2,n),s="number"==typeof this._targetZoom?t.zoomScale(this._targetZoom):o;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(s*r))),"wheel"===this._type&&(this._startZoom=n,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const r="number"==typeof this._targetZoom?this._targetZoom:i(),n=this._startZoom,o=this._easing;let s,a=!1;if("wheel"===this._type&&n&&o){const t=Math.min((e.q.now()-this._lastWheelEventTime)/200,1),i=o(t);s=e.ah(n,r,i),t<1?this._frameId||(this._frameId=!0):a=!0}else s=r,a=!0;this._active=!0,a&&(this._active=!1,this._finishTimeout=window.setTimeout((()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout}),200));let l=s-i();return l*this._lastDelta<0&&(l=0),{noInertia:!0,needsRenderFrame:!a,zoomDelta:l,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let i=e.dD;if(this._prevEase){const t=this._prevEase,r=(e.q.now()-t.start)/t.duration,n=t.easing(r+.01)-t.easing(r),o=.27/Math.sqrt(n*n+1e-4)*.01,s=Math.sqrt(.0729-o*o);i=e.dB(o,s,.25,1)}return this._prevEase={start:e.q.now(),duration:t,easing:i},i}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=l("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout((()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")}),200)}}class Va{constructor(e,t){this._clickZoom=e,this._tapZoom=t}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Ha{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(e,t){return e.preventDefault(),{cameraAnimation:i=>{i.easeTo({duration:300,zoom:i.getZoom()+(e.shiftKey?-1:1),around:i.unproject(t)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ga{constructor(){this._tap=new va({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(e,t,i){this._swipePoint||(this._tapTime&&e.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?i.length>0&&(this._swipePoint=t[0],this._swipeTouch=i[0].identifier):this._tap.touchstart(e,t,i))}touchmove(e,t,i){if(this._tapTime){if(this._swipePoint){if(i[0].identifier!==this._swipeTouch)return;const r=t[0],n=r.y-this._swipePoint.y;return this._swipePoint=r,e.preventDefault(),this._active=!0,{zoomDelta:n/128}}}else this._tap.touchmove(e,t,i)}touchend(e,t,i){this._tapTime?this._swipePoint&&0===i.length&&this.reset():this._tap.touchend(e,t,i)&&(this._tapTime=e.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class $a{constructor(e,t,i){this._el=e,this._mousePan=t,this._touchPan=i}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Za{constructor(e,t,i){this._pitchWithRotate=e.pitchWithRotate,this._mouseRotate=t,this._mousePitch=i}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class qa{constructor(e,t,i,r){this._el=e,this._touchZoom=t,this._touchRotate=i,this._tapDragZoom=r,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Ka=e=>e.zoom||e.drag||e.pitch||e.rotate;class Wa extends e.A{}class Xa{constructor(){this.constants=[1,1,.01],this.radius=0}setup(t,i){const r=e.ad.vec3.sub([],i,t);this.radius=e.ad.vec3.length(r[2]<0?e.ad.vec3.div([],r,this.constants):[r[0],r[1],0])}projectRay(t){e.ad.vec3.div(t,t,this.constants),e.ad.vec3.normalize(t,t),e.ad.vec3.mul(t,t,this.constants);const i=e.ad.vec3.scale([],t,this.radius);if(i[2]>0){const t=e.ad.vec3.scale([],[0,0,1],e.ad.vec3.dot(i,[0,0,1])),r=e.ad.vec3.scale([],e.ad.vec3.normalize([],[i[0],i[1],0]),this.radius),n=e.ad.vec3.add([],i,e.ad.vec3.scale([],e.ad.vec3.sub([],e.ad.vec3.add([],r,t),i),2));i[0]=n[0],i[1]=n[1]}return i}}function Ya(e){return e.panDelta&&e.panDelta.mag()||e.zoomDelta||e.bearingDelta||e.pitchDelta}class Ja{constructor(t,i){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new ca(t),this._bearingSnap=i.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Xa,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(i),e.aQ(["handleEvent","handleWindowEvent"],this);const r=this._el;this._listeners=[[r,"touchstart",{passive:!0}],[r,"touchmove",{passive:!1}],[r,"touchend",void 0],[r,"touchcancel",void 0],[r,"mousedown",void 0],[r,"mousemove",void 0],[r,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[r,"mouseover",void 0],[r,"mouseout",void 0],[r,"dblclick",void 0],[r,"click",void 0],[r,"keydown",{capture:!1}],[r,"keyup",void 0],[r,"wheel",{passive:!1}],[r,"contextmenu",void 0],[window,"blur",void 0]];for(const[e,t,i]of this._listeners){const r=e===document?this.handleWindowEvent:this.handleEvent;e.addEventListener(t,r,i)}}destroy(){for(const[e,t,i]of this._listeners){const r=e===document?this.handleWindowEvent:this.handleEvent;e.removeEventListener(t,r,i)}}_addDefaultHandlers(e){const t=this._map,i=t.getCanvasContainer();this._add("mapEvent",new Aa(t,e));const r=t.boxZoom=new ga(t,e);this._add("boxZoom",r);const n=new xa,o=new Ha;t.doubleClickZoom=new Va(o,n),this._add("tapZoom",n),this._add("clickZoom",o);const s=new Ga;this._add("tapDragZoom",s);const a=t.touchPitch=new Ra(t);this._add("touchPitch",a);const l=new Ca(e),c=new Sa(e);t.dragRotate=new Za(e,l,c),this._add("mouseRotate",l,["mousePitch"]),this._add("mousePitch",c,["mouseRotate"]);const u=new Ba(e),h=new Ea(t,e);t.dragPan=new $a(i,u,h),this._add("mousePan",u),this._add("touchPan",h,["touchZoom","touchRotate"]);const d=new ka,p=new La;t.touchZoomRotate=new qa(i,p,d,s),this._add("touchRotate",d,["touchPan","touchZoom"]),this._add("touchZoom",p,["touchPan","touchRotate"]),this._add("blockableMapEvent",new ma(t));const f=t.scrollZoom=new ja(t,this);this._add("scrollZoom",f,["mousePan"]);const A=t.keyboard=new Oa;this._add("keyboard",A);for(const i of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])e.interactive&&e[i]&&t[i].enable(e[i])}_add(e,t,i){this._handlers.push({handlerName:e,handler:t,allowed:i}),this._handlersById[e]=t}stop(e){if(!this._updatingCamera){for(const{handler:e}of this._handlers)e.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Ka(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(e,t,i){for(const r in e)if(r!==i&&(!t||t.indexOf(r)<0))return!0;return!1}handleWindowEvent(e){this.handleEvent(e,`${e.type}Window`)}_getMapTouches(e){const t=[];for(const i of e)this._el.contains(i.target)&&t.push(i);return t}handleEvent(e,t){this._updatingCamera=!0;const i="renderFrame"===e.type,r=i?void 0:e,n={needsRenderFrame:!1},o={},s={},a=e.touches?this._getMapTouches(e.touches):void 0,l=a?_(this._el,a):i?void 0:g(this._el,e);for(const{handlerName:i,handler:c,allowed:u}of this._handlers){if(!c.isEnabled())continue;let h;this._blockedByActive(s,u,i)?c.reset():c[t||e.type]&&(h=c[t||e.type](e,l,a),this.mergeHandlerResult(n,o,h,i,r),h&&h.needsRenderFrame&&this._triggerRenderFrame()),(h||c.isActive())&&(s[i]=c)}const c={};for(const e in this._previousActiveHandlers)s[e]||(c[e]=r);this._previousActiveHandlers=s,(Object.keys(c).length||Ya(n))&&(this._changes.push([n,o,c]),this._triggerRenderFrame()),(Object.keys(s).length||Ya(n))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:u}=n;u&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],u(this._map))}mergeHandlerResult(t,i,r,n,o){if(!r)return;e.l(t,r);const s={handlerName:n,originalEvent:r.originalEvent||o};void 0!==r.zoomDelta&&(i.zoom=s),void 0!==r.panDelta&&(i.drag=s),void 0!==r.pitchDelta&&(i.pitch=s),void 0!==r.bearingDelta&&(i.rotate=s)}_applyChanges(){const t={},i={},r={};for(const[n,o,s]of this._changes)n.panDelta&&(t.panDelta=(t.panDelta||new e.P(0,0))._add(n.panDelta)),n.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+n.zoomDelta),n.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+n.bearingDelta),n.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+n.pitchDelta),void 0!==n.around&&(t.around=n.around),void 0!==n.aroundCoord&&(t.aroundCoord=n.aroundCoord),void 0!==n.pinchAround&&(t.pinchAround=n.pinchAround),n.noInertia&&(t.noInertia=n.noInertia),e.l(i,o),e.l(r,s);this._updateMapTransform(t,i,r),this._changes=[]}_updateMapTransform(t,i,r){const n=this._map,o=n.transform,s=e=>[e.x,e.y,e.z];if((()=>{const e=this._eventsInProgress.drag;return e&&!this._handlersById[e.handlerName].isActive()})()&&!Ya(t)){const e=o.zoom;o.cameraElevationReference="sea",null!=this._originalZoom&&o._orthographicProjectionAtLowPitch&&"globe"!==o.projection.name&&0===o.pitch?(o.cameraElevationReference="ground",o.zoom=this._originalZoom):(o.recenterOnTerrain(),o.cameraElevationReference="ground"),e!==o.zoom&&this._map._update(!0)}if(o._isCameraConstrained&&n._stop(!0),!Ya(t))return void this._fireEvents(i,r,!0);let{panDelta:a,zoomDelta:l,bearingDelta:c,pitchDelta:u,around:h,aroundCoord:d,pinchAround:p}=t;o._isCameraConstrained&&(l>0&&(l=0),o._isCameraConstrained=!1),void 0!==p&&(h=p),(l||(e=>i[e]&&!this._eventsInProgress[e])("drag"))&&h&&(this._dragOrigin=s(o.pointCoordinate3D(h)),this._originalZoom=o.zoom,this._trackingEllipsoid.setup(o._camera.position,this._dragOrigin)),o.cameraElevationReference="sea",n._stop(!0),h=h||n.transform.centerPoint,c&&(o.bearing+=c),u&&(o.pitch+=u),o._updateCameraState();const f=[0,0,0];if(a)if("mercator"===o.projection.name){const e=this._trackingEllipsoid.projectRay(o.screenPointToMercatorRay(h).dir),t=this._trackingEllipsoid.projectRay(o.screenPointToMercatorRay(h.sub(a)).dir);f[0]=t[0]-e[0],f[1]=t[1]-e[1]}else{const t=o.pointCoordinate(h);if("globe"===o.projection.name){a=a.rotate(-o.angle);const i=o._pixelsPerMercatorPixel/o.worldSize;f[0]=-a.x*e.dE(e.aT(t.y))*i,f[1]=-a.y*e.dE(o.center.lat)*i}else{const e=o.pointCoordinate(h.sub(a));t&&e&&(f[0]=e.x-t.x,f[1]=e.y-t.y)}}const A=o.zoom,m=[0,0,0];if(l){const t=s(d||o.pointCoordinate3D(h)),i={dir:e.ad.vec3.normalize([],e.ad.vec3.sub([],t,o._camera.position))};if(i.dir[2]<0){const r=o.zoomDeltaToMovement(t,l);e.ad.vec3.scale(m,i.dir,r)}}const g=e.ad.vec3.add(f,f,m);o._translateCameraConstrained(g),l&&Math.abs(o.zoom-A)>1e-4&&o.recenterOnTerrain(),o.cameraElevationReference="ground",this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(i,r,!0)}_fireEvents(t,i,r){const n=Ka(this._eventsInProgress),o=Ka(t),s={};for(const e in t){const{originalEvent:i}=t[e];this._eventsInProgress[e]||(s[`${e}start`]=i),this._eventsInProgress[e]=t[e]}!n&&o&&this._fireEvent("movestart",o.originalEvent);for(const e in s)this._fireEvent(e,s[e]);o&&this._fireEvent("move",o.originalEvent);for(const e in t){const{originalEvent:i}=t[e];this._fireEvent(e,i)}const a={};let l;for(const e in this._eventsInProgress){const{handlerName:t,originalEvent:r}=this._eventsInProgress[e];this._handlersById[t].isActive()||(delete this._eventsInProgress[e],l=i[t]||r,a[`${e}end`]=l)}for(const e in a)this._fireEvent(e,a[e]);const c=Ka(this._eventsInProgress);if(r&&(n||o)&&!c){this._updatingCamera=!0;const t=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),i=e=>0!==e&&-this._bearingSnap<e&&e<this._bearingSnap;t?(i(t.bearing||this._map.getBearing())&&(t.bearing=0),this._map.easeTo(t,{originalEvent:l})):(this._map.fire(new e.A("moveend",{originalEvent:l})),i(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,i){this._map.fire(new e.A(t,i?{originalEvent:i}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((e=>{this._frameId=void 0,this.handleEvent(new Wa("renderFrame",{timeStamp:e})),this._applyChanges()}))}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const el="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class tl extends e.E{constructor(t,i){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=i.bearingSnap,this._respectPrefersReducedMotion=!1!==i.respectPrefersReducedMotion,e.aQ(["_renderFrameCallback"],this)}getCenter(){return new e.bO(this.transform.center.lng,this.transform.center.lat)}setCenter(e,t){return this.jumpTo({center:e},t)}panBy(t,i,r){return t=e.P.convert(t).mult(-1),this.panTo(this.transform.center,e.l({offset:t},i),r)}panTo(t,i,r){return this.easeTo(e.l({center:t},i),r)}getZoom(){return this.transform.zoom}setZoom(e,t){return this.jumpTo({zoom:e},t),this}zoomTo(t,i,r){return this.easeTo(e.l({zoom:t},i),r)}zoomIn(e,t){return this.zoomTo(this.getZoom()+1,e,t),this}zoomOut(e,t){return this.zoomTo(this.getZoom()-1,e,t),this}getBearing(){return this.transform.bearing}setBearing(e,t){return this.jumpTo({bearing:e},t),this}getPadding(){return this.transform.padding}setPadding(e,t){return this.jumpTo({padding:e},t),this}rotateTo(t,i,r){return this.easeTo(e.l({bearing:t},i),r)}resetNorth(t,i){return this.rotateTo(0,e.l({duration:1e3},t),i),this}resetNorthPitch(t,i){return this.easeTo(e.l({bearing:0,pitch:0,duration:1e3},t),i),this}snapToNorth(e,t){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,t):this}getPitch(){return this.transform.pitch}setPitch(e,t){return this.jumpTo({pitch:e},t),this}cameraForBounds(t,i){t=e.aB.convert(t);const r=i&&i.bearing||0,n=i&&i.pitch||0,o=t.getNorthWest(),s=t.getSouthEast();return this._cameraForBounds(this.transform,o,s,r,n,i)}_extendPadding(t){const i={top:0,right:0,bottom:0,left:0};return null==t?e.l({},i,this.transform.padding):"number"==typeof t?{top:t,bottom:t,right:t,left:t}:e.l({},i,t)}_extendCameraOptions(t){return(t=e.l({offset:[0,0],maxZoom:this.transform.maxZoom},t)).padding=this._extendPadding(t.padding),t}_minimumAABBFrustumDistance(e,t){const i=t.max[0]-t.min[0],r=t.max[1]-t.min[1];return i/r>e.aspect?i/(2*Math.tan(.5*e.fovX)*e.aspect):r/(2*Math.tan(.5*e.fovY)*e.aspect)}_cameraForBoundsOnGlobe(t,i,r,n,o,s){const a=t.clone(),l=this._extendCameraOptions(s);a.bearing=n,a.pitch=o;const c=e.bO.convert(i),u=e.bO.convert(r),h=.5*(c.lat+u.lat),d=.5*(c.lng+u.lng),p=e.dF(h,d),f=e.ad.vec3.normalize([],p),A=e.ad.vec3.normalize([],e.ad.vec3.cross([],f,[0,1,0])),m=e.ad.vec3.cross([],A,f),g=[A[0],A[1],A[2],0,m[0],m[1],m[2],0,f[0],f[1],f[2],0,0,0,0,1],_=[p,e.dF(c.lat,c.lng),e.dF(u.lat,c.lng),e.dF(u.lat,u.lng),e.dF(c.lat,u.lng),e.dF(h,c.lng),e.dF(h,u.lng),e.dF(c.lat,d),e.dF(u.lat,d)];let y=e.ce.fromPoints(_.map((t=>[e.ad.vec3.dot(A,t),e.ad.vec3.dot(m,t),e.ad.vec3.dot(f,t)])));const v=e.ad.vec3.transformMat4([],y.center,g);0===e.ad.vec3.squaredLength(v)&&e.ad.vec3.set(v,0,0,1),e.ad.vec3.normalize(v,v),e.ad.vec3.scale(v,v,e.az),a.center=e.dG(v);const x=a.getWorldToCameraMatrix(),b=e.ad.mat4.invert(new Float64Array(16),x);y=e.ce.applyTransform(y,e.ad.mat4.multiply([],x,g));const w=this._extendAABB(y,a,l,n);if(!w)return void e.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");y=w,e.ad.vec3.transformMat4(v,v,x);const T=.5*(y.max[2]-y.min[2]),B=this._minimumAABBFrustumDistance(a,y),C=e.ad.vec3.scale([],[0,0,1],T),S=e.ad.vec3.add(C,v,C),E=B+(0===a.pitch?0:e.ad.vec3.distance(v,S)),M=a.globeCenterInViewSpace,I=e.ad.vec3.sub([],v,[M[0],M[1],M[2]]);e.ad.vec3.normalize(I,I),e.ad.vec3.scale(I,I,E);const P=e.ad.vec3.add([],v,I);e.ad.vec3.transformMat4(P,P,b);const L=e.dv/e.az,F=e.ad.vec3.length(P),k=e.bH(Math.max(F*L-e.dv,Number.EPSILON),0),z=Math.min(a.zoomFromMercatorZAdjusted(k),l.maxZoom);return z>.5*(e.c6+e.bY)?(a.setProjection({name:"mercator"}),a.zoom=z,this._cameraForBounds(a,i,r,n,o,s)):{center:a.center,zoom:z,bearing:n,pitch:o}}_extendAABB(t,i,r,n){const o=.5*((r.padding.left||0)+(r.padding.right||0)),s=.5*((r.padding.top||0)+(r.padding.bottom||0)),a=s,l=o,c=o,u=s,h=i.width-(l+c),d=i.height-(a+u),p=e.ad.vec3.sub([],t.max,t.min),f=Math.min(h/p[0],d/p[1]),A=Math.min(i.scaleZoom(i.scale*f),r.maxZoom);if(isNaN(A))return null;const m=i.scale/i.zoomScale(A),g=new e.ce([t.min[0]-l*m,t.min[1]-u*m,t.min[2]],[t.max[0]+c*m,t.max[1]+a*m,t.max[2]]),_=("number"==typeof r.offset.x&&"number"==typeof r.offset.y?new e.P(r.offset.x,r.offset.y):e.P.convert(r.offset)).rotate(-e.ak(n));return g.center[0]-=_.x*m,g.center[1]+=_.y*m,g}queryTerrainElevation(t,i){const r=this.transform.elevation;return r?(i=e.l({},{exaggerated:!0},i),r.getAtPoint(e.ac.fromLngLat(t),null,i.exaggerated)):null}_cameraForBounds(t,i,r,n,o,s){if("globe"===t.projection.name)return this._cameraForBoundsOnGlobe(t,i,r,n,o,s);const a=t.clone(),l=this._extendCameraOptions(s);a.bearing=n,a.pitch=o;const c=e.bO.convert(i),u=e.bO.convert(r),h=new e.bO(c.lng,u.lat),d=new e.bO(u.lng,c.lat),p=a.project(c),f=a.project(u),A=this.queryTerrainElevation(c),m=this.queryTerrainElevation(u),g=this.queryTerrainElevation(h),_=this.queryTerrainElevation(d),y=[[p.x,p.y,Math.min(A||0,m||0,g||0,_||0)],[f.x,f.y,Math.max(A||0,m||0,g||0,_||0)]];let v=e.ce.fromPoints(y);const x=a.getWorldToCameraMatrix(),b=e.ad.mat4.invert(new Float64Array(16),x);v=e.ce.applyTransform(v,x);const w=this._extendAABB(v,a,l,n);if(!w)return void e.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");v=w;const T=.5*e.ad.vec3.sub([],v.max,v.min)[2],B=this._minimumAABBFrustumDistance(a,v),C=[0,0,1,0];e.ad.vec4.transformMat4(C,C,x),e.ad.vec4.normalize(C,C);const S=e.ad.vec3.scale([],C,B+T),E=e.ad.vec3.add([],v.center,S);e.ad.vec3.transformMat4(v.center,v.center,b),e.ad.vec3.transformMat4(E,E,b);const M=a.unproject(new e.P(v.center[0],v.center[1])),I=e.dH(a.projection,M),P=Math.pow(2,I),L=Math.min(a._zoomFromMercatorZ(E[2]*a.pixelsPerMeter*P/a.worldSize),l.maxZoom);return a.mercatorFromTransition&&L<.5*(e.c6+e.bY)?(a.setProjection({name:"globe"}),a.zoom=L,this._cameraForBounds(a,i,r,n,o,s)):{center:M,zoom:L,bearing:n,pitch:o}}fitBounds(e,t,i){const r=this.cameraForBounds(e,t);return this._fitInternal(r,t,i)}fitScreenCoordinates(t,i,r,n,o){const s=e.P.convert(t),a=e.P.convert(i),l=new e.P(Math.min(s.x,a.x),Math.min(s.y,a.y)),c=new e.P(Math.max(s.x,a.x),Math.max(s.y,a.y));if("mercator"===this.transform.projection.name&&this.transform.anyCornerOffEdge(s,a))return this;const u=this.transform.pointLocation3D(l),h=this.transform.pointLocation3D(c),d=this.transform.pointLocation3D(new e.P(l.x,c.y)),p=this.transform.pointLocation3D(new e.P(c.x,l.y)),f=[Math.min(u.lng,h.lng,d.lng,p.lng),Math.min(u.lat,h.lat,d.lat,p.lat)],A=[Math.max(u.lng,h.lng,d.lng,p.lng),Math.max(u.lat,h.lat,d.lat,p.lat)],m=n&&n.pitch?n.pitch:this.getPitch(),g=this._cameraForBounds(this.transform,f,A,r,m,n);return this._fitInternal(g,n,o)}_fitInternal(t,i,r){return t?(i=e.l(t,i)).linear?this.easeTo(i,r):this.flyTo(i,r):this}jumpTo(t,i){this.stop();const r=t.preloadOnly?this.transform.clone():this.transform;let n=!1,o=!1,s=!1;"zoom"in t&&r.zoom!==+t.zoom&&(n=!0,r.zoom=+t.zoom),void 0!==t.center&&(r.center=e.bO.convert(t.center)),"bearing"in t&&r.bearing!==+t.bearing&&(o=!0,r.bearing=+t.bearing),"pitch"in t&&r.pitch!==+t.pitch&&(s=!0,r.pitch=+t.pitch);const a="number"==typeof t.padding?this._extendPadding(t.padding):t.padding;if(null!=t.padding&&!r.isPaddingEqual(a))if(!1===t.retainPadding){const e=r.clone();e.padding=a,r.setLocationAtPoint(r.center,e.centerPoint)}else r.padding=a;return t.preloadOnly?(this._preloadTiles(r),this):(this.fire(new e.A("movestart",i)).fire(new e.A("move",i)),n&&this.fire(new e.A("zoomstart",i)).fire(new e.A("zoom",i)).fire(new e.A("zoomend",i)),o&&this.fire(new e.A("rotatestart",i)).fire(new e.A("rotate",i)).fire(new e.A("rotateend",i)),s&&this.fire(new e.A("pitchstart",i)).fire(new e.A("pitch",i)).fire(new e.A("pitchend",i)),this.fire(new e.A("moveend",i)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||e.w(el),this.transform.getFreeCameraOptions()}setFreeCameraOptions(t,i){const r=this.transform;if(!r.projection.supportsFreeCamera)return e.w(el),this;this.stop();const n=r.zoom,o=r.pitch,s=r.bearing;r.setFreeCameraOptions(t);const a=n!==r.zoom,l=o!==r.pitch,c=s!==r.bearing;return this.fire(new e.A("movestart",i)).fire(new e.A("move",i)),a&&this.fire(new e.A("zoomstart",i)).fire(new e.A("zoom",i)).fire(new e.A("zoomend",i)),c&&this.fire(new e.A("rotatestart",i)).fire(new e.A("rotate",i)).fire(new e.A("rotateend",i)),l&&this.fire(new e.A("pitchstart",i)).fire(new e.A("pitch",i)).fire(new e.A("pitchend",i)),this.fire(new e.A("moveend",i)),this}easeTo(t,i){this._stop(!1,t.easeId),(!1===(t=e.l({offset:[0,0],duration:500,easing:e.dD},t)).animate||this._prefersReducedMotion(t))&&(t.duration=0);const r=this.transform,n=this.getZoom(),o=this.getBearing(),s=this.getPitch(),a=this.getPadding(),l="zoom"in t?+t.zoom:n,c="bearing"in t?this._normalizeBearing(t.bearing,o):o,u="pitch"in t?+t.pitch:s,h=this._extendPadding(t.padding),d=e.P.convert(t.offset);let p,f,A;if("globe"===r.projection.name){const i=e.ac.fromLngLat(r.center),n=d.rotate(-r.angle);i.x+=n.x/r.worldSize,i.y+=n.y/r.worldSize;const o=i.toLngLat(),s=e.bO.convert(t.center||o);this._normalizeCenter(s),p=r.centerPoint.add(n),f=new e.P(i.x,i.y).mult(r.worldSize),A=new e.P(e.av(s.lng),e.aC(s.lat)).mult(r.worldSize).sub(f)}else{p=r.centerPoint.add(d);const i=r.pointLocation(p),n=e.bO.convert(t.center||i);this._normalizeCenter(n),f=r.project(i),A=r.project(n).sub(f)}const m=r.zoomScale(l-n);let g,_;t.around&&(g=e.bO.convert(t.around),_=r.locationPoint(g));const y=this._zooming||l!==n,v=this._rotating||o!==c,x=this._pitching||u!==s,b=!r.isPaddingEqual(h),w=!1===t.retainPadding?r.clone():r,T=r=>T=>{if(y&&(r.zoom=e.ah(n,l,T)),v&&(r.bearing=e.ah(o,c,T)),x&&(r.pitch=e.ah(s,u,T)),b&&(w.interpolatePadding(a,h,T),p=w.centerPoint.add(d)),g)r.setLocationAtPoint(g,_);else{const e=r.zoomScale(r.zoom-n),t=l>n?Math.min(2,m):Math.max(.5,m),i=Math.pow(t,1-T),o=r.unproject(f.add(A.mult(T*i)).mult(e));r.setLocationAtPoint(r.renderWorldCopies?o.wrap():o,p)}return t.preloadOnly||this._fireMoveEvents(i),r};if(t.preloadOnly){const e=this._emulate(T,t.duration,r);return this._preloadTiles(e),this}const B={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=y,this._rotating=v,this._pitching=x,this._padding=b,this._easeId=t.easeId,this._prepareEase(i,t.noMoveStart,B),this._ease(T(r),(e=>{"sea"===r.cameraElevationReference&&r.recenterOnTerrain(),this._afterEase(i,e)}),t),this}_prepareEase(t,i,r={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&0===this.transform.pitch&&"globe"!==this.transform.projection.name&&(this.transform.cameraElevationReference="ground"),i||r.moving||this.fire(new e.A("movestart",t)),this._zooming&&!r.zooming&&this.fire(new e.A("zoomstart",t)),this._rotating&&!r.rotating&&this.fire(new e.A("rotatestart",t)),this._pitching&&!r.pitching&&this.fire(new e.A("pitchstart",t))}_fireMoveEvents(t){this.fire(new e.A("move",t)),this._zooming&&this.fire(new e.A("zoom",t)),this._rotating&&this.fire(new e.A("rotate",t)),this._pitching&&this.fire(new e.A("pitch",t))}_afterEase(t,i){if(this._easeId&&i&&this._easeId===i)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const r=this._zooming,n=this._rotating,o=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,r&&this.fire(new e.A("zoomend",t)),n&&this.fire(new e.A("rotateend",t)),o&&this.fire(new e.A("pitchend",t)),this.fire(new e.A("moveend",t))}flyTo(t,i){if(this._prefersReducedMotion(t)){const r=e.aA(t,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(r,i)}this.stop(),t=e.l({offset:[0,0],speed:1.2,curve:1.42,easing:e.dD},t);const r=this.transform,n=this.getZoom(),o=this.getBearing(),s=this.getPitch(),a=this.getPadding(),l="zoom"in t?e.ay(+t.zoom,r.minZoom,r.maxZoom):n,c="bearing"in t?this._normalizeBearing(t.bearing,o):o,u="pitch"in t?+t.pitch:s,h=this._extendPadding(t.padding),d=r.zoomScale(l-n),p=e.P.convert(t.offset);let f=r.centerPoint.add(p);const A=r.pointLocation(f),m=e.bO.convert(t.center||A);this._normalizeCenter(m);const g=r.project(A),_=r.project(m).sub(g);let y=t.curve;const v=Math.max(r.width,r.height),x=v/d,b=_.mag();if("minZoom"in t){const i=e.ay(Math.min(t.minZoom,n,l),r.minZoom,r.maxZoom),o=v/r.zoomScale(i-n);y=Math.sqrt(o/b*2)}const w=y*y;function T(e){const t=(x*x-v*v+(e?-1:1)*w*w*b*b)/(2*(e?x:v)*w*b);return Math.log(Math.sqrt(t*t+1)-t)}function B(e){return(Math.exp(e)-Math.exp(-e))/2}function C(e){return(Math.exp(e)+Math.exp(-e))/2}const S=T(0);let E=function(e){return C(S)/C(S+y*e)},M=function(e){return v*((C(S)*(B(t=S+y*e)/C(t))-B(S))/w)/b;var t},I=(T(1)-S)/y;if(Math.abs(b)<1e-6||!isFinite(I)){if(Math.abs(v-x)<1e-6)return this.easeTo(t,i);const e=x<v?-1:1;I=Math.abs(Math.log(x/v))/y,M=function(){return 0},E=function(t){return Math.exp(e*y*t)}}t.duration="duration"in t?+t.duration:1e3*I/("screenSpeed"in t?+t.screenSpeed/y:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0);const P=o!==c,L=u!==s,F=!r.isPaddingEqual(h),k=!1===t.retainPadding?r.clone():r,z=r=>d=>{const A=d*I,y=1/E(A);r.zoom=1===d?l:n+r.scaleZoom(y),P&&(r.bearing=e.ah(o,c,d)),L&&(r.pitch=e.ah(s,u,d)),F&&(k.interpolatePadding(a,h,d),f=k.centerPoint.add(p));const v=1===d?m:r.unproject(g.add(_.mult(M(A))).mult(y));return r.setLocationAtPoint(r.renderWorldCopies?v.wrap():v,f),r._updateCameraOnTerrain(),t.preloadOnly||this._fireMoveEvents(i),r};if(t.preloadOnly){const e=this._emulate(z,t.duration,r);return this._preloadTiles(e),this}return this._zooming=!0,this._rotating=P,this._pitching=L,this._padding=F,this._prepareEase(i,!1),this._ease(z(r),(()=>this._afterEase(i)),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(e){}_cancelRenderFrame(e){}_stop(e,t){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const e=this._onEaseEnd;this._onEaseEnd=void 0,e.call(this,t)}if(!e){const e=this.handlers;e&&e.stop(!1)}return this}_ease(t,i,r){!1===r.animate||0===r.duration?(t(1),i()):(this._easeStart=e.q.now(),this._easeOptions=r,this._onEaseFrame=t,this._onEaseEnd=i,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const t=Math.min((e.q.now()-this._easeStart)/this._easeOptions.duration,1),i=this._onEaseFrame;i&&i(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(t,i){t=e.bF(t,-180,180);const r=Math.abs(t-i);return Math.abs(t-360-i)<r&&(t-=360),Math.abs(t+360-i)<r&&(t+=360),t}_normalizeCenter(e){const t=this.transform;if(t.maxBounds)return;if("globe"!==t.projection.name&&!t.renderWorldCopies)return;const i=e.lng-t.center.lng;e.lng+=i>180?-360:i<-180?360:0}_prefersReducedMotion(t){return this._respectPrefersReducedMotion&&e.q.prefersReducedMotion&&!(t&&t.essential)}_emulate(e,t,i){const r=Math.ceil(15*t/1e3),n=[],o=e(i.clone());for(let e=0;e<=r;e++){const t=o(e/r);n.push(t.clone())}return n}_preloadTiles(e,t){}}class il{constructor(t={}){this.options=t,e.aQ(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(e){const t=this.options&&this.options.compact,i=e._getUIString("AttributionControl.ToggleAttribution");this._map=e,this._container=l("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=l("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",i);const r=l("span","mapboxgl-ctrl-icon",this._compactButton);return r.setAttribute("aria-hidden","true"),r.setAttribute("title",i),this._innerContainer=l("div","mapboxgl-ctrl-attrib-inner",this._container),t&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===t&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let t=this._editLink;t||(t=this._editLink=this._container.querySelector(".mapbox-improve-map"));const i=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||e.e.ACCESS_TOKEN}];if(t){const r=i.reduce(((e,t,r)=>(t.value&&(e+=`${t.key}=${t.value}${r<i.length-1?"&":""}`),e)),"?");t.href=`${e.e.FEEDBACK_URL}/${r}#${ra(this._map,!0)}`,t.rel="noopener nofollow"}}_updateData(e){!e||"metadata"!==e.sourceDataType&&"visibility"!==e.sourceDataType&&"style"!==e.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let e=[];if(this._map.style.stylesheet){const e=this._map.style.stylesheet;this.styleOwner=e.owner,this.styleId=e.id}const t=this._map.style._mergedSourceCaches;for(const i in t){const r=t[i];if(r.used){const t=r.getSource();t.attribution&&e.indexOf(t.attribution)<0&&e.push(t.attribution)}}e.sort(((e,t)=>e.length-t.length)),e=e.filter(((t,i)=>{for(let r=i+1;r<e.length;r++)if(e[r].indexOf(t)>=0)return!1;return!0})),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=[...this.options.customAttribution,...e]:e.unshift(this.options.customAttribution));const i=e.join(" | ");i!==this._attribHTML&&(this._attribHTML=i,e.length?(this._innerContainer.innerHTML=i,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class rl{constructor(){e.aQ(["_updateLogo","_updateCompact"],this)}onAdd(e){this._map=e,this._container=l("div","mapboxgl-ctrl");const t=l("a","mapboxgl-ctrl-logo");return t.target="_blank",t.rel="noopener nofollow",t.href="https://www.mapbox.com/",t.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),t.setAttribute("rel","noopener nofollow"),this._container.appendChild(t),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(e){e&&"metadata"!==e.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const e=this._map.style._sourceCaches;if(0===Object.entries(e).length)return!0;for(const t in e){const i=e[t].getSource();if(i.hasOwnProperty("mapbox_logo")&&!i.mapbox_logo)return!1}return!0}_updateCompact(){const e=this._container.children;if(e.length){const t=e[0];this._map.getCanvasContainer().offsetWidth<250?t.classList.add("mapboxgl-compact"):t.classList.remove("mapboxgl-compact")}}}class nl{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){const t=++this._id;return this._queue.push({callback:e,id:t,cancelled:!1}),t}remove(e){const t=this._currentlyRunning,i=t?this._queue.concat(t):this._queue;for(const t of i)if(t.id===e)return void(t.cancelled=!0)}run(e=0){const t=this._currentlyRunning=this._queue;this._queue=[];for(const i of t)if(!i.cancelled&&(i.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class ol{constructor(e){this.jumpTo(e)}getValue(t){if(t<=this._startTime)return this._start;if(t>=this._endTime)return this._end;const i=e.cC((t-this._startTime)/(this._endTime-this._startTime));return this._start*(1-i)+this._end*i}isEasing(e){return e>=this._startTime&&e<=this._endTime}jumpTo(e){this._startTime=-1/0,this._endTime=-1/0,this._start=e,this._end=e}easeTo(e,t,i){this._start=this.getValue(t),this._end=e,this._startTime=t,this._endTime=t+i}}const sl={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class al extends e.A{constructor(e,t,i,r){const{point:n,lngLat:o,originalEvent:s,target:a}=e;super(e.type,{point:n,lngLat:o,originalEvent:s,target:a}),this.preventDefault=()=>{e.preventDefault()},this.id=t,this.interaction=i,this.feature=r}}class ll{constructor(e){this.map=e,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(t,i){if(this.typeById.has(t))throw new Error(`Interaction id "${t}" already exists.`);const r=i.filter;let n=i.type;r&&this.filters.set(t,e.a_(r)),"mouseover"===n&&(n="mouseenter"),"mouseout"===n&&(n="mouseleave");const o=this.interactionsByType.get(n)||new Map;"mouseenter"===n||"mouseleave"===n?(0===this.delegatedInteractions.size&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(t,i)):0===o.size&&this.map.on(n,this.handleType),0===o.size&&this.interactionsByType.set(n,o),o.set(t,i),this.typeById.set(t,n)}get(e){const t=this.typeById.get(e);if(!t)return;const i=this.interactionsByType.get(t);return i?i.get(e):void 0}remove(e){const t=this.typeById.get(e);if(!t)return;this.typeById.delete(e),this.filters.delete(e);const i=this.interactionsByType.get(t);i&&(i.delete(e),"mouseenter"===t||"mouseleave"===t?(this.delegatedInteractions.delete(e),0===this.delegatedInteractions.size&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):0===i.size&&this.map.off(t,this.handleType))}queryTargets(e,t){const i=[];for(const[e,r]of t)r.target&&i.push({targetId:e,target:r.target,filter:this.filters.get(e)});return this.map.style.queryRenderedTargets(e,i,this.map.transform)}handleMove(e){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const t=this.queryTargets(e.point,Array.from(this.delegatedInteractions).reverse());t.length&&(e.type="mouseenter",this.handleType(e,t));const i=new Map;for(const[e,{feature:t}]of this.prevHoveredFeatures)this.hoveredFeatures.has(e)||i.set(t.id,t);i.size&&(e.type="mouseleave",this.handleType(e,Array.from(i.values())))}handleOut(e){const t=Array.from(this.hoveredFeatures.values()).map((({feature:e})=>e));t.length&&(e.type="mouseleave",this.handleType(e,t)),this.hoveredFeatures.clear()}handleType(t,i){const r=Array.from(this.interactionsByType.get(t.type)).reverse(),n=!!i;i=i||this.queryTargets(t.point,r);const o="mouseenter"===t.type;let s=!1;const a=new Set;for(const l of i){for(const[i,c]of r){if(!c.target)continue;const r=l.variants?l.variants[i]:null;if(r){for(const u of r){if(at(u,l,a,i))continue;const r=new e.cx(l,u),h=st(u,l,i);n&&(r.state=this.map.getFeatureState(r));const d=o?this.prevHoveredFeatures.get(h):null,p=new al(t,i,c,r),f=d?d.stop:c.handler(p);if(o&&this.hoveredFeatures.set(h,{feature:l,stop:f}),!1!==f){s=!0;break}}if(s)break}}if(s)break}if(!s)for(const[e,i]of r){const{handler:r,target:n}=i;if(!n&&!1!==r(new al(t,e,i,null)))break}}}function cl(t,i){if(Array.isArray(t)&&Array.isArray(i)){const e=new Set(t),r=new Set(i);return e.size===r.size&&t.every((e=>r.has(e)))}return e.bn(t,i)}const ul={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},hl={showCompass:!0,showZoom:!0,visualizePitch:!1};class dl{constructor(t,i,r=!1){this._clickTolerance=10,this.element=i,this.mouseRotate=new Ca({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,r&&(this.mousePitch=new Sa({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),e.aQ(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),i.addEventListener("mousedown",this.mousedown),i.addEventListener("touchstart",this.touchstart,{passive:!1}),i.addEventListener("touchmove",this.touchmove),i.addEventListener("touchend",this.touchend),i.addEventListener("touchcancel",this.reset)}down(e,t){this.mouseRotate.mousedown(e,t),this.mousePitch&&this.mousePitch.mousedown(e,t),p()}move(e,t){const i=this.map,r=this.mouseRotate.mousemoveWindow(e,t),n=r&&r.bearingDelta;if(n&&i.setBearing(i.getBearing()+n),this.mousePitch){const r=this.mousePitch.mousemoveWindow(e,t),n=r&&r.pitchDelta;n&&i.setPitch(i.getPitch()+n)}}off(){const e=this.element;e.removeEventListener("mousedown",this.mousedown),e.removeEventListener("touchstart",this.touchstart,{passive:!1}),e.removeEventListener("touchmove",this.touchmove),e.removeEventListener("touchend",this.touchend),e.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){f(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(t){this.down(e.l({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),g(this.element,t)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(e){this.move(e,g(this.element,e))}mouseup(e){this.mouseRotate.mouseupWindow(e),this.mousePitch&&this.mousePitch.mouseupWindow(e),this.offTemp()}touchstart(e){1!==e.targetTouches.length?this.reset():(this._startPos=this._lastPos=_(this.element,e.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>e.preventDefault()},this._startPos))}touchmove(e){1!==e.targetTouches.length?this.reset():(this._lastPos=_(this.element,e.targetTouches)[0],this.move({preventDefault:()=>e.preventDefault()},this._lastPos))}touchend(e){0===e.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function pl(t,i,r){if(t=new e.bO(t.lng,t.lat),i){const n=new e.bO(t.lng-360,t.lat),o=new e.bO(t.lng+360,t.lat),s=360*Math.ceil(Math.abs(t.lng-r.center.lng)/360),a=r.locationPoint3D(t).distSqr(i),l=i.x<0||i.y<0||i.x>r.width||i.y>r.height;r.locationPoint3D(n).distSqr(i)<a&&(l||Math.abs(n.lng-r.center.lng)<s)?t=n:r.locationPoint3D(o).distSqr(i)<a&&(l||Math.abs(o.lng-r.center.lng)<s)&&(t=o)}for(;Math.abs(t.lng-r.center.lng)>180;){const e=r.locationPoint3D(t);if(e.x>=0&&e.y>=0&&e.x<=r.width&&e.y<=r.height)break;t.lng>r.center.lng?t.lng-=360:t.lng+=360}return t}const fl={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},Al={rotation:0,rotationAlignment:"auto",pitchAlignment:"auto",occludedOpacity:.2,altitude:0};class ml extends e.E{constructor(t,i){super(),(t instanceof HTMLElement||i)&&(t=e.l({element:t},i)),e.aQ(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this);const{anchor:r="center",color:n="#3FB1CE",scale:o=1,draggable:s=!1,clickTolerance:a=0,rotation:l=Al.rotation,rotationAlignment:c=Al.rotationAlignment,pitchAlignment:u=Al.pitchAlignment,occludedOpacity:h=Al.occludedOpacity,altitude:d=Al.altitude}=t||{};this._anchor=r,this._color=n,this._scale=o,this._draggable=s,this._clickTolerance=a,this._rotation=l,this._rotationAlignment=c,this._pitchAlignment=u,this._occludedOpacity=h,this._altitude=d,this._state="inactive",this._isDragging=!1,this._updateMoving=()=>this._update(!0),t&&t.element?(this._element=t.element,this._offset=e.P.convert(t&&t.offset||[0,0])):(this._defaultMarker=!0,this._element=this._createDefaultMarker(),this._offset=e.P.convert(t&&t.offset||[0,-14])),this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",(e=>{e.preventDefault()})),this._element.addEventListener("mousedown",(e=>{e.preventDefault()}));const p=this._element.classList;for(const e in fl)p.remove(`mapboxgl-marker-anchor-${e}`);p.add(`mapboxgl-marker-anchor-${this._anchor}`);const f=t&&t.className?t.className.trim().split(/\s+/):[];p.add(...f),this._popup=null}_createDefaultMarker(){const e=l("div"),t=c("svg",{display:"block",height:41*this._scale+"px",width:27*this._scale+"px",viewBox:"0 0 27 41"},e);if(0===this._altitude){const e=c("radialGradient",{id:"shadowGradient"},c("defs",{},t));c("stop",{offset:"10%","stop-opacity":.4},e),c("stop",{offset:"100%","stop-opacity":.05},e),c("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},t)}return c("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},t),c("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},t),c("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},t),e}addTo(e){return e===this._map||(this.remove(),this._map=e,e.getCanvasContainer().appendChild(this._element),e.on("move",this._updateMoving),e.on("moveend",this._update),e.on("remove",this._clearFadeTimer),e._addMarker(this),this.setDraggable(this._draggable),this._update(),e.on("click",this._onMapClick)),this}remove(){const e=this._map;return e&&(e.off("click",this._onMapClick),e.off("move",this._updateMoving),e.off("moveend",this._update),e.off("mousedown",this._addDragHandler),e.off("touchstart",this._addDragHandler),e.off("mouseup",this._onUp),e.off("touchend",this._onUp),e.off("mousemove",this._onMove),e.off("touchmove",this._onMove),e.off("remove",this._clearFadeTimer),e._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=e.bO.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}setAltitude(e){return e===this._altitude||(this._defaultMarker&&(0===this._altitude&&0!==e||0!==this._altitude&&0===e)&&(this._element=this._createDefaultMarker()),this._altitude=e||Al.altitude,this._update()),this}getAltitude(){return this._altitude}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){const t=38.1,i=13.5,r=Math.sqrt(Math.pow(i,2)/2);e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-t],"bottom-left":[r,-1*(t-i+r)],"bottom-right":[-r,-1*(t-i+r)],left:[i,-1*(t-i)],right:[-i,-1*(t-i)]}:this._offset}this._popup=e,e._marker=this,e._altitude=this._altitude,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(e){const t=e.code,i=e.charCode||e.keyCode;"Space"!==t&&"Enter"!==t&&32!==i&&13!==i||this.togglePopup()}_onMapClick(e){const t=e.originalEvent.target,i=this._element;this._popup&&(t===i||i.contains(t))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const e=this._popup;return e?(e.isOpen()?(e.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(e.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const e=this._map,t=this._pos;if(!e||!t)return!1;const i=e.unproject(t,this._altitude),r=e.getFreeCameraOptions();if(!r.position)return!1;const n=r.position.toLngLat();return n.distanceTo(i)<.9*n.distanceTo(this._lngLat)}_evaluateOpacity(){const t=this._map;if(!t)return;const i=this._pos;if(!i||i.x<0||i.x>t.transform.width||i.y<0||i.y>t.transform.height)return void this._clearFadeTimer();const r=t.unproject(i,this._altitude);let n;t._showingGlobe()&&e.dK(t.transform,this._lngLat)?n=0:(n=1-t._queryFogOpacity(r),t.transform._terrainEnabled()&&t.getTerrain()&&this._behindTerrain()&&(n*=this._occludedOpacity)),this._element.style.opacity=`${n}`,this._element.style.pointerEvents=n>0?"auto":"none",this._popup&&this._popup._setOpacity(n),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const e=this._pos;if(!e||!this._map)return;const t=this._offset.mult(this._scale);this._element.style.transform=`\n            translate(${e.x}px,${e.y}px)\n            ${fl[this._anchor]}\n            ${this._calculateXYTransform()} ${this._calculateZTransform()}\n            translate(${t.x}px,${t.y}px)\n        `}_calculateXYTransform(){const t=this._pos,i=this._map,r=this.getPitchAlignment();if(!i||!t||"map"!==r)return"";if(!i._showingGlobe()){const e=i.getPitch();return e?`rotateX(${e}deg)`:""}const n=e.c4(e.dL(i.transform,this._lngLat)),o=t.sub(e.dM(i.transform)),s=Math.abs(o.x)+Math.abs(o.y);if(0===s)return"";const a=n/s;return`rotateX(${-o.y*a}deg) rotateY(${o.x*a}deg)`}_calculateZTransform(){const t=this._pos,i=this._map;if(!i||!t)return"";let r=0;const n=this.getRotationAlignment();if("map"===n)if(i._showingGlobe()){const t=i.project(new e.bO(this._lngLat.lng,this._lngLat.lat+.001),this._altitude),n=i.project(new e.bO(this._lngLat.lng,this._lngLat.lat-.001),this._altitude).sub(t);r=e.c4(Math.atan2(n.y,n.x))-90}else r=-i.getBearing();else if("horizon"===n){const n=e.ae(4,6,i.getZoom()),o=e.dM(i.transform);o.y+=n*i.transform.height;const s=t.sub(o),a=e.c4(Math.atan2(s.y,s.x));r=(a>90?a-270:a+90)*(1-n)}return r+=this._rotation,r?`rotateZ(${r}deg)`:""}_update(e){cancelAnimationFrame(this._updateFrameId);const t=this._map;t&&(t.transform.renderWorldCopies&&(this._lngLat=pl(this._lngLat,this._pos,t.transform)),this._pos=t.project(this._lngLat,this._altitude),!0===e?this._updateFrameId=requestAnimationFrame((()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())})):this._pos=this._pos.round(),t._requestDomTask((()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(t._showingGlobe()||t.getTerrain()||t.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))})))}getOffset(){return this._offset}setOffset(t){return this._offset=e.P.convert(t),this._update(),this}addClassName(e){return this._element.classList.add(e),this}removeClassName(e){return this._element.classList.remove(e),this}toggleClassName(e){return this._element.classList.toggle(e)}_onMove(t){const i=this._map;if(!i)return;const r=this._pointerdownPos,n=this._positionDelta;if(r&&n){if(!this._isDragging){const e=this._clickTolerance||i._clickTolerance;if(t.point.dist(r)<e)return;this._isDragging=!0}this._pos=t.point.sub(n),this._lngLat=i.unproject(this._pos,this._altitude),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new e.A("dragstart"))),this.fire(new e.A("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const t=this._map;t&&(t.off("mousemove",this._onMove),t.off("touchmove",this._onMove)),"active"===this._state&&this.fire(new e.A("dragend")),this._state="inactive"}_addDragHandler(e){const t=this._map,i=this._pos;t&&i&&this._element.contains(e.originalEvent.target)&&(e.preventDefault(),this._positionDelta=e.point.sub(i),this._pointerdownPos=e.point,this._state="pending",t.on("mousemove",this._onMove),t.on("touchmove",this._onMove),t.once("mouseup",this._onUp),t.once("touchend",this._onUp))}setDraggable(e){this._draggable=!!e;const t=this._map;return t&&(e?(t.on("mousedown",this._addDragHandler),t.on("touchstart",this._addDragHandler)):(t.off("mousedown",this._addDragHandler),t.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||Al.rotation,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||Al.rotationAlignment,this._update(),this}getRotationAlignment(){return"auto"===this._rotationAlignment||"horizon"===this._rotationAlignment&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e||Al.pitchAlignment,this._update(),this}getPitchAlignment(){return"auto"===this._pitchAlignment?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(e){return this._occludedOpacity=e||Al.occludedOpacity,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const gl={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},_l={maxWidth:100,unit:"metric"},yl={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},vl={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",altitude:0},xl=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function bl(t=new e.P(0,0),i="bottom"){if("number"==typeof t){const r=Math.round(Math.sqrt(.5*Math.pow(t,2)));switch(i){case"top":return new e.P(0,t);case"top-left":return new e.P(r,r);case"top-right":return new e.P(-r,r);case"bottom":return new e.P(0,-t);case"bottom-left":return new e.P(r,-r);case"bottom-right":return new e.P(-r,-r);case"left":return new e.P(t,0);case"right":return new e.P(-t,0)}return new e.P(0,0)}return t instanceof e.P||Array.isArray(t)?e.P.convert(t):e.P.convert(t[i]||[0,0])}const wl={version:t,supported:a.supported,setRTLTextPlugin:e.dN,getRTLTextPluginStatus:e.dO,Map:class extends tl{constructor(t){r.mark(i.create);const n=t;if(null!=(t=e.l({},ul,t)).minZoom&&null!=t.maxZoom&&t.minZoom>t.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=t.minPitch&&null!=t.maxPitch&&t.minPitch>t.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=t.minPitch&&t.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=t.maxPitch&&t.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(t.antialias&&e.dI(window)&&(t.antialias=!1,e.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Yi(t.minZoom,t.maxZoom,t.minPitch,t.maxPitch,t.renderWorldCopies,null,null),t),this._repaint=!!t.repaint,this._interactive=t.interactive,this._minTileCacheSize=t.minTileCacheSize,this._maxTileCacheSize=t.maxTileCacheSize,this._failIfMajorPerformanceCaveat=t.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=t.preserveDrawingBuffer,this._antialias=t.antialias,this._trackResize=t.trackResize,this._bearingSnap=t.bearingSnap,this._refreshExpiredTiles=t.refreshExpiredTiles,this._fadeDuration=t.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=t.crossSourceCollisions,this._collectResourceTiming=t.collectResourceTiming,this._language=this._parseLanguage(t.language),this._worldview=t.worldview,this._renderTaskQueue=new nl,this._domRenderTaskQueue=new nl,this._controls=[],this._markers=[],this._popups=[],this._mapId=e.aW(),this._locale=e.l({},sl,t.locale),this._clickTolerance=t.clickTolerance,this._cooperativeGestures=t.cooperativeGestures,this._performanceMetricsCollection=t.performanceMetricsCollection,this._tessellationStep=t.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=t.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new ol(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=t.scaleFactor,this._requestManager=new w(t.transformRequest,t.accessToken,t.testMode),this._silenceAuthErrors=!!t.testMode,this._contextCreateOptions=t.contextCreateOptions?Object.assign({},t.contextCreateOptions):{},"string"==typeof t.container){const e=document.getElementById(t.container);if(!e)throw new Error(`Container '${t.container.toString()}' not found.`);this._container=e}else{if(!(t.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=t.container}if(this._container.childNodes.length>0&&e.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),t.maxBounds&&this.setMaxBounds(t.maxBounds),this._spriteFormat=t.spriteFormat,e.aQ(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new Us),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},(()=>{this._update()})),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._tp.registerParameter(this,["Scaling"],"_scaleFactor",{min:.1,max:10,step:.1},(()=>{this.setScaleFactor(this._scaleFactor)})),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");if(this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new Ja(this,t),this._localFontFamily=t.localFontFamily,this._localIdeographFontFamily=t.localIdeographFontFamily,(t.style||!t.testMode)&&this.setStyle(t.style||e.e.DEFAULT_STYLE,{config:t.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),t.projection&&this.setProjection(t.projection),this.indoor=new dr(this),t.hash&&(this._hash=new ia("string"==typeof t.hash&&t.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){null==n.center&&null==n.zoom||(this.transform._unmodified=!1),this.jumpTo({center:t.center,zoom:t.zoom,bearing:t.bearing,pitch:t.pitch});const i=t.bounds;i&&(this.resize(),this.fitBounds(i,e.l({},t.fitBoundsOptions,{duration:0})))}this.resize(),t.attributionControl&&this.addControl(new il({customAttribution:t.customAttribution})),this._logoControl=new rl,this.addControl(this._logoControl,t.logoPosition),this.on("style.load",(()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()})),this.on("data",(t=>{this._update("style"===t.dataType),this.fire(new e.A(`${t.dataType}data`,t))})),this.on("dataloading",(t=>{this.fire(new e.A(`${t.dataType}dataloading`,t))})),this._interactions=new ll(this)}_getMapId(){return this._mapId}addControl(t,i){if(void 0===i&&(i=t.getDefaultPosition?t.getDefaultPosition():"top-right"),!t||!t.onAdd)return this.fire(new e.z(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const r=t.onAdd(this);this._controls.push(t);const n=this._controlPositions[i];return-1!==i.indexOf("bottom")?n.insertBefore(r,n.firstChild):n.appendChild(r),this}removeControl(t){if(!t||!t.onRemove)return this.fire(new e.z(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const i=this._controls.indexOf(t);return i>-1&&this._controls.splice(i,1),t.onRemove(this),this}hasControl(e){return this._controls.indexOf(e)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(t){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const i=!this._moving;return i&&this.fire(new e.A("movestart",t)).fire(new e.A("move",t)),this.fire(new e.A("resize",t)),i&&this.fire(new e.A("moveend",t)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(t){return this.transform.setMaxBounds(e.aB.convert(t)),this._update()}setMinZoom(t){if((t=t??-2)>=-2&&t<=this.transform.maxZoom)return this.transform.minZoom=t,this._update(),this.getZoom()<t?this.setZoom(t):this.fire(new e.A("zoomstart")).fire(new e.A("zoom")).fire(new e.A("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(t){if((t=t??22)>=this.transform.minZoom)return this.transform.maxZoom=t,this._update(),this.getZoom()>t?this.setZoom(t):this.fire(new e.A("zoomstart")).fire(new e.A("zoom")).fire(new e.A("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(t){if((t=t??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(t>=0&&t<=this.transform.maxPitch)return this.transform.minPitch=t,this._update(),this.getPitch()<t?this.setPitch(t):this.fire(new e.A("pitchstart")).fire(new e.A("pitch")).fire(new e.A("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(t){if((t=t??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(t>=this.transform.minPitch)return this.transform.maxPitch=t,this._update(),this.getPitch()>t?this.setPitch(t):this.fire(new e.A("pitchstart")).fire(new e.A("pitch")).fire(new e.A("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(e){return this._scaleFactor=e,this.painter.scaleFactor=e,this._tp.refreshUI(),this._scaleFactorChanged=!0,this.style._updateFilteredLayers((e=>"symbol"===e.type)),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(e){return this.transform.renderWorldCopies=e,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(e){return"auto"===e?navigator.language:Array.isArray(e)?0===e.length?void 0:e.map((e=>"auto"===e?navigator.language:e)):e}setLanguage(e){const t=this._parseLanguage(e);if(!this.style||t===this._language)return this;this._language=t,this.style.reloadSources();for(const e of this._controls)e._setLanguage&&e._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(e){return this.style&&e!==this._worldview?(this._worldview=e,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return"globe"===this.transform.projection.name}setProjection(e){return this._lazyInitEmptyStyle(),e?"string"==typeof e&&(e={name:e}):e=null,this._useExplicitProjection=!!e,this._prioritizeAndUpdateProjection(e,this.style.projection)}_updateProjectionTransition(){if("globe"!==this.getProjection().name)return;const t=this.transform,i=t.projection.name;let r;"globe"===i&&t.zoom>=e.bY?(t.setMercatorFromTransition(),r=!0):"mercator"===i&&t.zoom<e.bY&&(t.setProjection({name:"globe"}),r=!0),r&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(e,t){return this._updateProjection(e||t||{name:"mercator"})}_updateProjection(t){let i;return i="globe"===t.name&&this.transform.zoom>=e.bY?this.transform.setMercatorFromTransition():this.transform.setProjection(t),this.style.applyProjectionUpdate(),i&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(t,i){return this.transform.locationPoint3D(e.bO.convert(t),i)}unproject(t,i){return this.transform.pointLocation3D(e.P.convert(t),i)}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(e,t,i){const r=e=>{let i=[];if(Array.isArray(t)){const r=t.filter((e=>this.getLayer(e)));i=r.length?this.queryRenderedFeatures(e,{layers:r}):[]}else i=this.queryRenderedFeatures(e,{target:t});return i};if("mouseenter"===e||"mouseover"===e){let n=!1;const o=t=>{const o=r(t.point);o.length?n||(n=!0,i.call(this,new da(e,this,t.originalEvent,{features:o}))):n=!1};return{listener:i,targets:t,delegates:{mousemove:o,mouseout:()=>{n=!1}}}}if("mouseleave"===e||"mouseout"===e){let n=!1;const o=t=>{r(t.point).length?n=!0:n&&(n=!1,i.call(this,new da(e,this,t.originalEvent)))},s=t=>{n&&(n=!1,i.call(this,new da(e,this,t.originalEvent)))};return{listener:i,targets:t,delegates:{mousemove:o,mouseout:s}}}{const n=e=>{const t=r(e.point);t.length&&(e.features=t,i.call(this,e),delete e.features)};return{listener:i,targets:t,delegates:{[e]:n}}}}on(e,t,i){if("function"==typeof t||void 0===i)return super.on(e,t);if("string"==typeof t&&(t=[t]),!this._areTargetsValid(t))return this;const r=this._createDelegatedListener(e,t,i);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[e]=this._delegatedListeners[e]||[],this._delegatedListeners[e].push(r);for(const e in r.delegates)this.on(e,r.delegates[e]);return this}once(e,t,i){if("function"==typeof t||void 0===i)return super.once(e,t);if("string"==typeof t&&(t=[t]),!this._areTargetsValid(t))return this;const r=this._createDelegatedListener(e,t,i);for(const e in r.delegates)this.once(e,r.delegates[e]);return this}off(e,t,i){if("function"==typeof t||void 0===i)return super.off(e,t);if("string"==typeof t&&(t=[t]),!this._areTargetsValid(t))return this;const r=this._delegatedListeners?this._delegatedListeners[e]:void 0;return r&&(e=>{for(let r=0;r<e.length;r++){const n=e[r];if(n.listener===i&&cl(n.targets,t)){for(const e in n.delegates)this.off(e,n.delegates[e]);return e.splice(r,1),this}}})(r),this}queryRenderedFeatures(t,i){if(!this.style)return[];if(void 0===t||t instanceof e.P||Array.isArray(t)||void 0!==i||(i=t,t=void 0),t=t||[[0,0],[this.transform.width,this.transform.height]],!i){const e=this.style.queryRenderedFeatures(t,void 0,this.transform),i=this.style.queryRenderedFeatureset(t,void 0,this.transform);return e.concat(i)}let r=!0;if(i.target&&(r=this._isTargetValid(i.target),r&&!i.layers))return this.style.queryRenderedFeatureset(t,i,this.transform);let n=!0;if(i.layers&&Array.isArray(i.layers)){for(const e of i.layers)if(!this._isValidId(e)){n=!1;break}if(n&&!i.target)return this.style.queryRenderedFeatures(t,i,this.transform)}let o=[];return n&&(o=o.concat(this.style.queryRenderedFeatures(t,i,this.transform))),r&&(o=o.concat(this.style.queryRenderedFeatureset(t,i,this.transform))),o}querySourceFeatures(e,t){return!e||"string"==typeof e&&!this._isValidId(e)?[]:this.style.querySourceFeatures(e,t)}isPointOnSurface(t){const{name:i}=this.transform.projection;return"globe"!==i&&"mercator"!==i&&e.w(`${i} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(e.P.convert(t))}addInteraction(e,t){return this._interactions.add(e,t),this}removeInteraction(e){return this._interactions.remove(e),this}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(e){return this._cooperativeGestures=e,this}setStyle(t,i){return i=e.l({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},i),this.style&&t&&!1!==i.diff&&i.localFontFamily===this._localFontFamily&&i.localIdeographFontFamily===this._localIdeographFontFamily&&!i.config?(this.style._diffStyle(t,((r,n)=>{r?(e.w(`Unable to perform style diff: ${String(r.message||r.error||r)}. Rebuilding the style from scratch.`),this._updateStyle(t,i)):n&&this._update(!0)}),(()=>{this._postStyleLoadEvent()})),this):(this._localIdeographFontFamily=i.localIdeographFontFamily,this._localFontFamily=i.localFontFamily,this._updateStyle(t,i))}_getUIString(e){const t=this._locale[e];if(null==t)throw new Error(`Missing UI string '${e}'`);return t}_updateStyle(t,i){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),t){const r=e.l({},i);i&&i.config&&(r.initialConfig=i.config,delete r.config),this.style=new br(this,r).load(t),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new br(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(e.w("There is no style added to the map."),!1)}_isValidId(t){return null==t?(this.fire(new e.z(new Error("IDs can't be empty."))),!1):!e.cs(t)||(this.fire(new e.z(new Error(`IDs can't contain special symbols: "${t}".`))),!1)}_isTargetValid(e){return"featuresetId"in e?this._isValidId("importId"in e?e.importId:e.featuresetId):"layerId"in e&&this._isValidId(e.layerId)}_areTargetsValid(e){if(Array.isArray(e)){for(const t of e)if(!this._isValidId(t))return!1;return!0}return this._isTargetValid(e)}addSource(e,t){return this._isValidId(e)?(this._lazyInitEmptyStyle(),this.style.addSource(e,t),this._update(!0)):this}isSourceLoaded(e){return!!this._isValidId(e)&&!!this.style&&this.style._isSourceCacheLoaded(e)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(e,t,i){this._lazyInitEmptyStyle(),this.style.addSourceType(e,t,i)}removeSource(e){return this._isValidId(e)?(this.style.removeSource(e),this._updateTerrain(),this._update(!0)):this}getSource(e){return this._isValidId(e)?this.style.getOwnSource(e):null}addImage(t,i,{pixelRatio:r=1,sdf:n=!1,stretchX:o,stretchY:s,content:a}={}){this._lazyInitEmptyStyle();const l=e.I.from(t);if(i instanceof HTMLImageElement||ImageBitmap&&i instanceof ImageBitmap){const{width:t,height:c,data:u}=e.q.getImageData(i);this.style.addImage(l,this.style.scope,{data:new e.r({width:t,height:c},u),pixelRatio:r,stretchX:o,stretchY:s,content:a,sdf:n,version:0,usvg:!1})}else if(void 0===i.width||void 0===i.height)this.fire(new e.z(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:c,height:u}=i,h=i;this.style.addImage(l,this.style.scope,{data:new e.r({width:c,height:u},new Uint8Array(h.data)),pixelRatio:r,stretchX:o,stretchY:s,content:a,sdf:n,usvg:!1,version:0,userImage:h}),h.onAdd&&h.onAdd(this,t)}}updateImage(t,i){this._lazyInitEmptyStyle();const r=e.I.from(t),n=this.style.getImage(r,this.style.scope);if(!n)return void this.fire(new e.z(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const o=i instanceof HTMLImageElement||ImageBitmap&&i instanceof ImageBitmap?e.q.getImageData(i):i,{width:s,height:a,data:l}=o;if(void 0===s||void 0===a)return void this.fire(new e.z(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(s!==(n.usvg?n.icon.usvg_tree.width:n.data.width)||a!==(n.usvg?n.icon.usvg_tree.height:n.data.height))return void this.fire(new e.z(new Error(`The width and height of the updated image (${s}, ${a})\n                must be that same as the previous version of the image\n                (${n.data.width}, ${n.data.height})`)));const c=!(i instanceof HTMLImageElement||ImageBitmap&&i instanceof ImageBitmap);let u=!1;n.usvg?(n.data=new e.r({width:s,height:a},new Uint8Array(l)),n.usvg=!1,n.icon=void 0,u=!0):n.data.replace(l,c),this.style.updateImage(r,this.style.scope,n,u)}hasImage(t){return t?!!this.style&&!!this.style.getImage(e.I.from(t),this.style.scope):(this.fire(new e.z(new Error("Missing required image id"))),!1)}removeImage(t){this.style.removeImage(e.I.from(t),this.style.scope)}loadImage(t,i){e.o(this._requestManager.transformRequest(t,e.R.Image),((t,r)=>{i(t,r instanceof HTMLImageElement?e.q.getImageData(r):r)}))}listImages(){return this.style.listImages().map((e=>e.name))}addModel(e,t){this._lazyInitEmptyStyle(),this.style.addModel(e,t)}hasModel(t){return t?this.style.hasModel(t):(this.fire(new e.z(new Error("Missing required model id"))),!1)}removeModel(e){this.style.removeModel(e)}listModels(){return this.style.listModels()}addLayer(e,t){return this._isValidId(e.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(e,t),this._update(!0)):this}getSlot(e){const t=this.getLayer(e);return t&&t.slot||null}setSlot(e,t){return this.style.setSlot(e,t),this.style.mergeLayers(),this._update(!0)}addImport(e,t){return this.style.addImport(e,t),this}updateImport(e,t){return"string"!=typeof t&&t.id!==e?(this.removeImport(e),this.addImport(t)):(this.style.updateImport(e,t),this._update(!0))}removeImport(e){return this.style.removeImport(e),this}moveImport(e,t){return this.style.moveImport(e,t),this._update(!0)}moveLayer(e,t){return this._isValidId(e)?(this.style.moveLayer(e,t),this._update(!0)):this}removeLayer(e){return this._isValidId(e)?(this.style.removeLayer(e),this._update(!0)):this}getLayer(e){if(!this._isValidId(e))return null;const t=this.style.getOwnLayer(e);return t?"custom"===t.type?t.implementation:t.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(e,t,i){return this._isValidId(e)?(this.style.setLayerZoomRange(e,t,i),this._update(!0)):this}setFilter(e,t,i={}){return this._isValidId(e)?(this.style.setFilter(e,t,i),this._update(!0)):this}getFilter(e){return this._isValidId(e)?this.style.getFilter(e):null}setPaintProperty(e,t,i,r={}){return this._isValidId(e)?(this.style.setPaintProperty(e,t,i,r),this._update(!0)):this}getPaintProperty(e,t){return this._isValidId(e)?this.style.getPaintProperty(e,t):null}setLayoutProperty(e,t,i,r={}){return this._isValidId(e)?(this.style.setLayoutProperty(e,t,i,r),this._update(!0)):this}getLayoutProperty(e,t){return this._isValidId(e)?this.style.getLayoutProperty(e,t):null}getGlyphsUrl(){return this.style.getGlyphsUrl()}setGlyphsUrl(e){return this.style.setGlyphsUrl(e),this._update(!0)}getSchema(e){return this.style.getSchema(e)}setSchema(e,t){return this.style.setSchema(e,t),this._update(!0)}getConfig(e){return this.style.getConfig(e)}setConfig(e,t){return this.style.setConfig(e,t),this._update(!0)}getConfigProperty(e,t){return this.style.getConfigProperty(e,t)}setConfigProperty(e,t,i){return this.style.setConfigProperty(e,t,i),this._update(!0)}getFeaturesetDescriptors(e){return this.style.getFeaturesetDescriptors(e)}setLights(e){if(this._lazyInitEmptyStyle(),e&&1===e.length&&"flat"===e[0].type){const t=e[0];t.properties?this.style.setFlatLight(t.properties,t.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(e),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const e=this.style.getLights()||[];return 0===e.length&&e.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),e}setLight(e,t={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:e}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(e){return this._lazyInitEmptyStyle(),!e&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(e),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(e){return this._lazyInitEmptyStyle(),this.style.setFog(e),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(e){return this._lazyInitEmptyStyle(),this.style.setSnow(e),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(e){return this._lazyInitEmptyStyle(),this.style.setRain(e),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(e){return this._lazyInitEmptyStyle(),this.style.setColorTheme(e),this._update(!0)}setImportColorTheme(e,t){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(e,t),this._update(!0)}setCamera(e){return this.style.setCamera(e),this._triggerCameraUpdate(e)}_triggerCameraUpdate(e){return this._update(this.transform.setOrthographicProjectionAtLowPitch("orthographic"===e["camera-projection"]))}getCamera(){return this.style.camera}_queryFogOpacity(t){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(e.bO.convert(t),this.transform):0}setFeatureState(e,t){return e.source&&!this._isValidId(e.source)?this:(this.style.setFeatureState(e,t),this._update())}removeFeatureState(e,t){return e.source&&!this._isValidId(e.source)?this:(this.style.removeFeatureState(e,t),this._update())}getFeatureState(e){return e.source&&!this._isValidId(e.source)?null:this.style.getFeatureState(e)}_updateContainerDimensions(){if(!this._container)return;const e=this._container.getBoundingClientRect().width||400,t=this._container.getBoundingClientRect().height||300;let i,r,n,o=this._container;for(;o&&(!r||!n);){const e=window.getComputedStyle(o).transform;e&&"none"!==e&&(i=e.match(/matrix.*\((.+)\)/)[1].split(", "),i[0]&&"0"!==i[0]&&"1"!==i[0]&&(r=i[0]),i[3]&&"0"!==i[3]&&"1"!==i[3]&&(n=i[3])),o=o.parentElement}this._containerWidth=r?Math.abs(e/r):e,this._containerHeight=n?Math.abs(t/n):t}_detectMissingCSS(){"rgb(250, 128, 114)"!==window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&e.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const e=this._container;e.classList.add("mapboxgl-map"),(this._missingCSSCanary=l("div","mapboxgl-canary",e)).style.visibility="hidden",this._detectMissingCSS();const t=this._canvasContainer=l("div","mapboxgl-canvas-container",e);this._canvas=l("canvas","mapboxgl-canvas",t),this._interactive&&(t.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const i=this._controlContainer=l("div","mapboxgl-control-container",e),r=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach((e=>{r[e]=l("div",`mapboxgl-ctrl-${e}`,i)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(t,i){const r=e.q.devicePixelRatio||1;this._canvas.width=r*Math.ceil(t),this._canvas.height=r*Math.ceil(i),this._canvas.style.width=`${t}px`,this._canvas.style.height=`${i}px`}_addMarker(e){this._markers.push(e)}_removeMarker(e){const t=this._markers.indexOf(e);-1!==t&&this._markers.splice(t,1)}_addPopup(e){this._popups.push(e)}_removePopup(e){const t=this._popups.indexOf(e);-1!==t&&this._popups.splice(t,1)}_setupPainter(){const t=e.l({},a.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),i=this._canvas.getContext("webgl2",t);i?(Q(i,!0),this.painter=new ea(i,this._contextCreateOptions,this.transform,this._scaleFactor,this._tp),this.on("data",(e=>{"source"===e.dataType&&this.painter.setTileLoadedFlag(!0)})),e.m.testSupport(i)):this.fire(new e.z(new Error("Failed to initialize WebGL")))}_contextLost(t){t.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new e.A("webglcontextlost",{originalEvent:t}))}_contextRestored(t){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style.reloadModels(),this.style.clearSources(),this._update(),this.fire(new e.A("webglcontextrestored",{originalEvent:t}))}_onMapScroll(e){if(e.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(e){return this.style?(this._styleDirty=this._styleDirty||e,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(e){return this._update(),this._renderTaskQueue.add(e)}_cancelRenderFrame(e){this._renderTaskQueue.remove(e)}_requestDomTask(e){!this.loaded()||this.loaded()&&!this.isMoving()?e():this._domRenderTaskQueue.add(e)}_render(t){let n;this.fire(new e.A("renderstart")),++this._frameId;const o=this.painter.context.extTimerQuery,s=e.q.now(),a=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(n=a.createQuery(),a.beginQuery(o.TIME_ELAPSED_EXT,n)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(t),this._domRenderTaskQueue.run(t),this._removed)return;this._updateProjectionTransition();const l=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const t=this.transform.zoom,i=this.transform.pitch,r=e.q.now(),n=new e.aa(t,{now:r,fadeDuration:l,pitch:i,transition:this.style.transition});this.style.update(n)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let c=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),c=this._updateAverageElevation(s),this.style.updateSources(this.transform),this.style.updateImageProviders(),this.isMoving()||this._forceMarkerAndPopupUpdate()):c=this._updateAverageElevation(s);const u=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,l,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),u&&(this._placementDirty=u.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:l,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new e.A("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,r.mark(i.load),this.fire(new e.A("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&this.style.imageManager.hasPatternsInFlight()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),n){const t=e.q.now()-s;a.endQuery(o.TIME_ELAPSED_EXT),setTimeout((()=>{const i=a.getQueryParameter(n,a.QUERY_RESULT)/1e6;a.deleteQuery(n),this.fire(new e.A("gpu-timing-frame",{cpuTime:t,gpuTime:i}))}),50)}if(this.listens("gpu-timing-layer")){const t=this.painter.collectGpuTimers();setTimeout((()=>{const i=this.painter.queryGpuTimers(t);this.fire(new e.A("gpu-timing-layer",{layerTimes:i}))}),50)}if(this.listens("gpu-timing-deferred-render")){const t=this.painter.collectDeferredRenderGpuQueries();setTimeout((()=>{const i=this.painter.queryGpuTimeDeferredRender(t);this.fire(new e.A("gpu-timing-deferred-render",{gpuTime:i}))}),50)}const h=this._sourcesDirty||this._styleDirty||this._placementDirty||c;if(h||this._repaint)this.triggerRepaint();else{const t=this.idle();if(t&&(c=this._updateAverageElevation(s,!0)),c)this.triggerRepaint();else if(this._triggerFrame(!1),t&&(this.fire(new e.A("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const t=this._calculateSpeedIndex();this.fire(new e.A("speedindexcompleted",{speedIndex:t})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||h||(this._fullyLoaded=!0,r.mark(i.fullLoad),this._performanceMetricsCollection&&D(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(e){for(const t of this._markers)e&&!this.getRenderWorldCopies()&&(t._lngLat=t._lngLat.wrap()),t._update();for(const t of this._popups)!e||this.getRenderWorldCopies()||t._trackPointer||(t._lngLat=t._lngLat.wrap()),t._update()}_updateAverageElevation(e,t=!1){const i=e=>(this.transform.averageElevation=e,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&i(0);const r=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(r||(t||e-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(e)){const t=this.transform.averageElevation;let n=this.transform.sampleAverageElevation();null!=this.transform.elevation&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(n)?n=0:this._averageElevationLastSampledAt=e;const o=Math.abs(t-n);if(o>1){if(this._isInitialLoad||r)return this._averageElevation.jumpTo(n),i(n);this._averageElevation.easeTo(n,e,300)}else if(o>1e-4)return this._averageElevation.jumpTo(n),i(n)}return!!this._averageElevation.isEasing(e)&&i(this._averageElevation.getValue(e))}_authenticate(){U(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,(t=>{if(t&&(t.message===b||401===t.status)){const t=this.painter.context.gl;Q(t,!1),this._logoControl instanceof rl&&this._logoControl._updateLogo(),t&&t.clear(t.DEPTH_BUFFER_BIT|t.COLOR_BUFFER_BIT|t.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new e.z(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}})),F(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,(()=>{}))}_postStyleLoadEvent(){this.style.globalId&&z(this._requestManager._customAccessToken,{map:this,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){const e=this._isDragging();this.painter.updateTerrain(this.style,e)}_calculateSpeedIndex(){const e=this.painter.canvasCopy(),t=this.painter.getCanvasCopiesAndTimestamps();t.timeStamps.push(performance.now());const i=this.painter.context.gl,r=i.createFramebuffer();function n(e){i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,e,0);const t=new Uint8Array(i.drawingBufferWidth*i.drawingBufferHeight*4);return i.readPixels(0,0,i.drawingBufferWidth,i.drawingBufferHeight,i.RGBA,i.UNSIGNED_BYTE,t),t}return i.bindFramebuffer(i.FRAMEBUFFER,r),this._canvasPixelComparison(n(e),t.canvasCopies.map(n),t.timeStamps)}_canvasPixelComparison(e,t,i){let r=i[1]-i[0];const n=e.length/4;for(let o=0;o<t.length;o++){const s=t[o];let a=0;for(let t=0;t<s.length;t+=4)s[t]===e[t]&&s[t+1]===e[t+1]&&s[t+2]===e[t+2]&&s[t+3]===e[t+3]&&(a+=1);r+=(i[o+2]-i[o+1])*(1-a/n)}return r}remove(){this._hash&&this._hash.remove();for(const e of this._controls)e.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const t=this.painter.context.gl.getExtension("WEBGL_lose_context");t&&t.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),N.delete(this.painter.context.gl),O.remove(),L.remove(),this._removed=!0,this.fire(new e.A("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(t){this._renderNextFrame=this._renderNextFrame||t,this.style&&!this._frame&&(this._frame=e.q.frame((e=>{const t=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,t&&this._render(e)})))}_preloadTiles(t){const i=this.style?this.style.getSourceCaches():[];return e.bl(i,((e,i)=>e._preloadTiles(t,i)),(()=>{this.triggerRepaint()})),this}_onWindowOnline(){this._update()}_onWindowResize(e){this._trackResize&&this.resize({originalEvent:e})._update()}_onVisibilityChange(){"hidden"===document.visibilityState&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(e){this._showTileBoundaries!==e&&(this._showTileBoundaries=e,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(e){this._showParseStatus!==e&&(this._showParseStatus=e,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(e){this._showTerrainWireframe!==e&&(this._showTerrainWireframe=e,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(e){this._showLayers2DWireframe!==e&&(this._showLayers2DWireframe=e,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(e){this._showLayers3DWireframe!==e&&(this._showLayers3DWireframe=e,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(e){this._speedIndexTiming!==e&&(this._speedIndexTiming=e,this._update())}get showPadding(){return!!this._showPadding}set showPadding(e){this._showPadding!==e&&(this._showPadding=e,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(e){this._showCollisionBoxes!==e&&(this._showCollisionBoxes=e,this._tp.refreshUI(),e?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(e){this._showOverdrawInspector!==e&&(this._showOverdrawInspector=e,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(e){this._repaint!==e&&(this._repaint=e,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(e){this._vertices=e,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(e){this._showTileAABBs!==e&&(this._showTileAABBs=e,this._tp.refreshUI(),e&&this._update())}_setCacheLimits(t,i){e.dJ(t,i)}get version(){return t}},NavigationControl:class{constructor(t={}){this.options=e.l({},hl,t),this._container=l("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",(e=>e.preventDefault())),this.options.showZoom&&(e.aQ(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",(e=>{this._map&&this._map.zoomIn({},{originalEvent:e})})),l("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",(e=>{this._map&&this._map.zoomOut({},{originalEvent:e})})),l("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(e.aQ(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",(e=>{const t=this._map;t&&(this.options.visualizePitch?t.resetNorthPitch({},{originalEvent:e}):t.resetNorth({},{originalEvent:e}))})),this._compassIcon=l("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const e=this._map;if(!e)return;const t=e.getZoom(),i=t===e.getMaxZoom(),r=t===e.getMinZoom();this._zoomInButton.disabled=i,this._zoomOutButton.disabled=r,this._zoomInButton.setAttribute("aria-disabled",i.toString()),this._zoomOutButton.setAttribute("aria-disabled",r.toString())}_rotateCompassArrow(){const e=this._map;if(!e)return;const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(e.transform.pitch*(Math.PI/180)),.5)}) rotateX(${e.transform.pitch}deg) rotateZ(${e.transform.angle*(180/Math.PI)}deg)`:`rotate(${e.transform.angle*(180/Math.PI)}deg)`;e._requestDomTask((()=>{this._compassIcon&&(this._compassIcon.style.transform=t)}))}onAdd(e){return this._map=e,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),e.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&e.on("pitch",this._rotateCompassArrow),e.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new dl(e,this._compass,this.options.visualizePitch)),this._container}onRemove(){const e=this._map;e&&(this._container.remove(),this.options.showZoom&&e.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&e.off("pitch",this._rotateCompassArrow),e.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(e,t){const i=l("button",e,this._container);return i.type="button",i.addEventListener("click",t),i}_setButtonTitle(e,t){if(!this._map)return;const i=this._map._getUIString(`NavigationControl.${t}`);e.setAttribute("aria-label",i),e.firstElementChild&&e.firstElementChild.setAttribute("title",i)}},GeolocateControl:class extends e.E{constructor(t={}){super();const i=navigator.geolocation;this.options=e.l({geolocation:i},gl,t),e.aQ(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=ta(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(e){return this._map=e,this._container=l("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){void 0!==this._geolocationWatchID&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(e){const t=(t=!!this.options.geolocation)=>{this._supportsGeolocation=t,e(t)};void 0!==this._supportsGeolocation?e(this._supportsGeolocation):void 0!==navigator.permissions?navigator.permissions.query({name:"geolocation"}).then((e=>t("denied"!==e.state))).catch((()=>t())):t()}_isOutOfMapMaxBounds(e){const t=this._map.getMaxBounds(),i=e.coords;return!!t&&(i.longitude<t.getWest()||i.longitude>t.getEast()||i.latitude<t.getSouth()||i.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(t){if(this._map){if(this._isOutOfMapMaxBounds(t))return this._setErrorState(),this.fire(new e.A("outofmaxbounds",t)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(t),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(t),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new e.A("geolocate",t)),this._finish()}}_updateCamera(t){const i=new e.bO(t.coords.longitude,t.coords.latitude),r=t.coords.accuracy,n=this._map.getBearing(),o=e.l({bearing:n},this.options.fitBoundsOptions);this._map.fitBounds(i.toBounds(r),o,{geolocateSource:!0})}_updateMarker(t){if(t){const i=new e.bO(t.coords.longitude,t.coords.latitude);this._accuracyCircleMarker.setLngLat(i).addTo(this._map),this._userLocationDotMarker.setLngLat(i).addTo(this._map),this._accuracy=t.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const t=this._map.transform,i=e.bH(1,t._center.lat)*t.worldSize,r=Math.ceil(2*this._accuracy*i);this._circleElement.style.width=`${r}px`,this._circleElement.style.height=`${r}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(t){if(this._map){if(this.options.trackUserLocation)if(1===t.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const e=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",e),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",e),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===t.code&&this._noTimeout)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new e.A("error",t)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(t){if(void 0!==this._map){if(this._container.addEventListener("contextmenu",(e=>e.preventDefault())),this._geolocateButton=l("button","mapboxgl-ctrl-geolocate",this._container),l("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===t){e.w("Geolocation support is not available so the GeolocateControl will be disabled.");const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}else{const e=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",e),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",e)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=l("div","mapboxgl-user-location"),this._dotElement.appendChild(l("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(l("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new ml({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=l("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new ml({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(t=>{t.geolocateSource||"ACTIVE_LOCK"!==this._watchState||t.originalEvent&&"resize"===t.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new e.A("trackuserlocationend")))}))}}_onDeviceOrientation(e){this._userLocationDotMarker&&(e.webkitCompassHeading?this._heading=e.webkitCompassHeading:!0===e.absolute&&(this._heading=-1*e.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return e.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new e.A("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new e.A("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new e.A("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let e;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(e={maximumAge:6e5,timeout:0},this._noTimeout=!0):(e=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,e),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const e=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};"undefined"!=typeof DeviceMotionEvent&&"function"==typeof DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then((t=>{"granted"===t&&e()})).catch(console.error):e()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:il,ScaleControl:class{constructor(t={}){this.options=e.l({},_l,t),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch(e){return!1}}(),e.aQ(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const e=this.options.maxWidth||100,t=this._map,i=t._containerHeight/2,r=t._containerWidth/2-e/2,n=t.unproject([r,i]),o=t.unproject([r+e,i]),s=n.distanceTo(o);if("imperial"===this.options.unit){const t=3.2808*s;t>5280?this._setScale(e,t/5280,"mile"):this._setScale(e,t,"foot")}else"nautical"===this.options.unit?this._setScale(e,s/1852,"nautical-mile"):s>=1e3?this._setScale(e,s/1e3,"kilometer"):this._setScale(e,s,"meter")}_setScale(e,t,i){this._map._requestDomTask((()=>{const r=function(e){const t=Math.pow(10,`${Math.floor(e)}`.length-1);let i=e/t;return i=i>=10?10:i>=5?5:i>=3?3:i>=2?2:i>=1?1:function(e){const t=Math.pow(10,Math.ceil(-Math.log(e)/Math.LN10));return Math.round(e*t)/t}(i),t*i}(t),n=r/t;this._container.innerHTML=this._isNumberFormatSupported&&"nautical-mile"!==i?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:i}).format(r):`${r}&nbsp;${yl[i]}`,this._container.style.width=e*n+"px"}))}onAdd(e){return this._map=e,this._language=e.getLanguage(),this._container=l("div","mapboxgl-ctrl mapboxgl-ctrl-scale",e.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(e){this._language=e,this._update()}setUnit(e){this.options.unit=e,this._update()}},FullscreenControl:class{constructor(t={}){this._fullscreen=!1,t&&t.container&&(t.container instanceof HTMLElement?this._container=t.container:e.w("Full screen control 'container' must be a DOM element.")),e.aQ(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(t){return this._map=t,this._container||(this._container=this._map.getContainer()),this._controlContainer=l("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",e.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const e=this._fullscreenButton=l("button","mapboxgl-ctrl-fullscreen",this._controlContainer);l("span","mapboxgl-ctrl-icon",e).setAttribute("aria-hidden","true"),e.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const e=this._getTitle();this._fullscreenButton.setAttribute("aria-label",e),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",e)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends e.E{constructor(t){super(),this.options=e.l(Object.create(vl),t),this._altitude=this.options.altitude,e.aQ(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(t&&t.className?t.className.trim().split(/\s+/):[])}addTo(t){return this._map&&this.remove(),this._map=t,this.options.closeOnClick&&t.on("preclick",this._onClose),this.options.closeOnMove&&t.on("move",this._onClose),t.on("remove",this.remove),this._update(),t._addPopup(this),this._focusFirstElement(),this._trackPointer?(t.on("mousemove",this._onMouseEvent),t.on("mouseup",this._onMouseEvent),t._canvasContainer.classList.add("mapboxgl-track-pointer")):t.on("move",this._update),this.fire(new e.A("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const t=this._map;return t&&(t.off("move",this._update),t.off("move",this._onClose),t.off("preclick",this._onClose),t.off("click",this._onClose),t.off("remove",this.remove),t.off("mousemove",this._onMouseEvent),t.off("mouseup",this._onMouseEvent),t.off("drag",this._onMouseEvent),t._canvasContainer&&t._canvasContainer.classList.remove("mapboxgl-track-pointer"),t._removePopup(this),this._map=void 0),this.fire(new e.A("close")),this}getLngLat(){return this._lngLat}setLngLat(t){this._lngLat=e.bO.convert(t),this._pos=null,this._trackPointer=!1,this._update();const i=this._map;return i&&(i.on("move",this._update),i.off("mousemove",this._onMouseEvent),i._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}getAltitude(){return this._altitude}setAltitude(e){return this._altitude=e,this._update(),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const e=this._map;return e&&(e.off("move",this._update),e.on("mousemove",this._onMouseEvent),e.on("drag",this._onMouseEvent),e._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(e){return this.setDOMContent(document.createTextNode(e))}setHTML(e){const t=document.createDocumentFragment(),i=document.createElement("body");let r;for(i.innerHTML=e;r=i.firstChild,r;)t.appendChild(r);return this.setDOMContent(t)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(e){return this.options.maxWidth=e,this._update(),this}setDOMContent(e){let t=this._content;if(t)for(;t.hasChildNodes();)t.firstChild&&t.removeChild(t.firstChild);else t=this._content=l("div","mapboxgl-popup-content",this._container||void 0);if(t.appendChild(e),this.options.closeButton){const e=this._closeButton=l("button","mapboxgl-popup-close-button",t);e.type="button",e.setAttribute("aria-label","Close popup"),e.innerHTML='<span aria-hidden="true">&#215;</span>',e.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(e){return this._classList.add(e),this._updateClassList(),this}removeClassName(e){return this._classList.delete(e),this._updateClassList(),this}setOffset(e){return this.options.offset=e,this._update(),this}toggleClassName(e){let t;return this._classList.delete(e)?t=!1:(this._classList.add(e),t=!0),this._updateClassList(),t}_onMouseEvent(e){this._update(e.point)}_getAnchor(e){if(this.options.anchor)return this.options.anchor;const t=this._map,i=this._container,r=this._pos;if(!t||!i||!r)return"bottom";const n=i.offsetWidth,o=i.offsetHeight,s=r.x<n/2,a=r.x>t.transform.width-n/2;if(r.y+e<o)return s?"top-left":a?"top-right":"top";if(r.y>t.transform.height-o){if(s)return"bottom-left";if(a)return"bottom-right"}return s?"left":a?"right":"bottom"}_updateClassList(){const e=this._container;if(!e)return;const t=[...this._classList];t.push("mapboxgl-popup"),this._anchor&&t.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&t.push("mapboxgl-popup-track-pointer"),e.className=t.join(" ")}_update(t){const i=this._map,r=this._content;if(!i||!this._lngLat&&!this._trackPointer||!r)return;let n=this._container;if(n||(n=this._container=l("div","mapboxgl-popup",i.getContainer()),this._tip=l("div","mapboxgl-popup-tip",n),n.appendChild(r)),this.options.maxWidth&&n.style.maxWidth!==this.options.maxWidth&&(n.style.maxWidth=this.options.maxWidth),i.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=pl(this._lngLat,this._pos,i.transform)),!this._trackPointer||t){const r=this._pos=this._trackPointer&&t instanceof e.P?t:i.project(this._lngLat,this._altitude),n=bl(this.options.offset),o=this._anchor=this._getAnchor(n.y),s=bl(this.options.offset,o),a=r.add(s).round();i._requestDomTask((()=>{this._container&&o&&(this._container.style.transform=`${fl[o]} translate(${a.x}px,${a.y}px)`)}))}if(!this._marker&&i._showingGlobe()){const t=e.dK(i.transform,this._lngLat)?0:1;this._setOpacity(t)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const e=this._container.querySelector(xl);e&&e.focus()}_onClose(){this.remove()}_setOpacity(e){this._container&&(this._container.style.opacity=`${e}`),this._content&&(this._content.style.pointerEvents=e?"auto":"none")}},Marker:ml,Style:br,LngLat:e.bO,LngLatBounds:e.aB,Point:e.P,MercatorCoordinate:e.ac,FreeCameraOptions:Zi,Evented:e.E,config:e.e,prewarm:e.dP,clearPrewarmedResources:e.dQ,get accessToken(){return e.e.ACCESS_TOKEN},set accessToken(t){e.e.ACCESS_TOKEN=t},get baseApiUrl(){return e.e.API_URL},set baseApiUrl(t){e.e.API_URL=t},get workerCount(){return e.dR.workerCount},set workerCount(t){e.dR.workerCount=t},get maxParallelImageRequests(){return e.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(t){e.e.MAX_PARALLEL_IMAGE_REQUESTS=t},clearStorage(t){e.dS(t)},get workerUrl(){return e.dT.workerUrl},set workerUrl(t){e.dT.workerUrl=t},get workerClass(){return e.dT.workerClass},set workerClass(t){e.dT.workerClass=t},get workerParams(){return e.dT.workerParams},set workerParams(t){e.dT.workerParams=t},get dracoUrl(){return e.dU()},set dracoUrl(t){e.dV(t)},get meshoptUrl(){return e.dW()},set meshoptUrl(t){e.dX(t)},setNow:e.q.setNow,restoreNow:e.q.restoreNow};return wl}));var n=i;return n}();var Ze=He($e.exports),qe=e({__proto__:null,default:Ze},[$e.exports]),Ke={exports:{}};Ke.exports=function(){var e={},t={};function i(i,r,n){if(t[i]=n,"index"===i){var o="var sharedModule = {}; ("+t.shared+")(sharedModule); ("+t.worker+")(sharedModule);",s={};return t.shared(s),t.index(e,s),"undefined"!=typeof window&&e.setWorkerUrl(window.URL.createObjectURL(new Blob([o],{type:"text/javascript"}))),e}}return i("shared",["exports"],(function(e){function t(e,t,i,r){return new(i||(i=Promise))((function(n,o){function s(e){try{l(r.next(e))}catch(e){o(e)}}function a(e){try{l(r.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(s,a)}l((r=r.apply(e,t||[])).next())}))}function i(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var r,n;function o(){if(n)return r;function e(e,t){this.x=e,this.y=t}return n=1,r=e,e.prototype={clone:function(){return new e(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,t){return this.clone()._rotateAround(e,t)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var t=e.x-this.x,i=e.y-this.y;return t*t+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult:function(e){var t=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=t,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var t=Math.cos(e),i=Math.sin(e),r=i*this.x+t*this.y;return this.x=t*this.x-i*this.y,this.y=r,this},_rotateAround:function(e,t){var i=Math.cos(e),r=Math.sin(e),n=t.y+r*(this.x-t.x)+i*(this.y-t.y);return this.x=t.x+i*(this.x-t.x)-r*(this.y-t.y),this.y=n,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},e.convert=function(t){return t instanceof e?t:Array.isArray(t)?new e(t[0],t[1]):t},r}"function"==typeof SuppressedError&&SuppressedError;var s,a,l=i(o()),c=function(){if(a)return s;function e(e,t,i,r){this.cx=3*e,this.bx=3*(i-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(r-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=t,this.p2x=i,this.p2y=r}return a=1,s=e,e.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,t){if(void 0===t&&(t=1e-6),e<0)return 0;if(e>1)return 1;for(var i=e,r=0;r<8;r++){var n=this.sampleCurveX(i)-e;if(Math.abs(n)<t)return i;var o=this.sampleCurveDerivativeX(i);if(Math.abs(o)<1e-6)break;i-=n/o}var s=0,a=1;for(i=e,r=0;r<20&&(n=this.sampleCurveX(i),!(Math.abs(n-e)<t));r++)e>n?s=i:a=i,i=.5*(a-s)+s;return i},solve:function(e,t){return this.sampleCurveY(this.solveCurveX(e,t))}},s}(),u=i(c);let h,d;function p(){return null==h&&(h="undefined"!=typeof OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof createImageBitmap),h}function f(){if(null==d&&(d=!1,p())){const e=5,t=new OffscreenCanvas(e,e).getContext("2d",{willReadFrequently:!0});if(t){for(let i=0;i<e*e;i++){const r=4*i;t.fillStyle=`rgb(${r},${r+1},${r+2})`,t.fillRect(i%e,Math.floor(i/e),1,1)}const i=t.getImageData(0,0,e,e).data;for(let t=0;t<e*e*4;t++)if(t%4!=3&&i[t]!==t){d=!0;break}}}return d||!1}var A=1e-6,m="undefined"!=typeof Float32Array?Float32Array:Array;function g(){var e=new m(9);return m!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}function _(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function y(){var e=new m(3);return m!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function v(e){return Math.hypot(e[0],e[1],e[2])}function x(e,t,i){var r=new m(3);return r[0]=e,r[1]=t,r[2]=i,r}Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});var b,w=v;function T(e,t,i){var r=t[0],n=t[1],o=t[2],s=t[3];return e[0]=i[0]*r+i[4]*n+i[8]*o+i[12]*s,e[1]=i[1]*r+i[5]*n+i[9]*o+i[13]*s,e[2]=i[2]*r+i[6]*n+i[10]*o+i[14]*s,e[3]=i[3]*r+i[7]*n+i[11]*o+i[15]*s,e}function B(){var e=new m(4);return m!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function C(){var e=new m(2);return m!=Float32Array&&(e[0]=0,e[1]=0),e}function S(e,t){var i=new m(2);return i[0]=e,i[1]=t,i}y(),b=new m(4),m!=Float32Array&&(b[0]=0,b[1]=0,b[2]=0,b[3]=0),y(),x(1,0,0),x(0,1,0),B(),B(),g(),C();const E=8192;function M(e,t,i){return t*(E/(e.tileSize*Math.pow(2,i-e.tileID.overscaledZ)))}function I(e,t){return(e%t+t)%t}function P(e,t,i){return e*(1-i)+t*i}function L(e){if(e<=0)return 0;if(e>=1)return 1;const t=e*e,i=t*e;return 4*(e<.5?i:3*(e-t)+i-.75)}function F(e,t,i,r){const n=new u(e,t,i,r);return e=>n.solve(e)}const k=F(.25,.1,.25,1);function z(e,t,i){return Math.min(i,Math.max(t,e))}function R(e,t,i){const r=i-t,n=((e-t)%r+r)%r+t;return n===t?i:n}function D(e,...t){for(const i of t)for(const t in i)e[t]=i[t];return e}let O=1;function U(e,t,i){const r={};for(const i in e)r[i]=t.call(this,e[i],i,e);return r}function N(e,t,i){const r={};for(const i in e)t.call(this,e[i],i,e)&&(r[i]=e[i]);return r}function Q(e){return Array.isArray(e)?e.map(Q):"object"==typeof e&&e?U(e,Q):e}const j={};function V(e){j[e]||("undefined"!=typeof console&&console.warn(e),j[e]=!0)}function H(e,t,i){return(i.y-e.y)*(t.x-e.x)>(t.y-e.y)*(i.x-e.x)}function G(e){return"undefined"!=typeof WorkerGlobalScope&&void 0!==e&&e instanceof WorkerGlobalScope}let $=null;function Z(e){return"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap}const q="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function K(e,i,r,n,o){return t(this,void 0,void 0,(function*(){if("undefined"==typeof VideoFrame)throw new Error("VideoFrame not supported");const t=new VideoFrame(e,{timestamp:0});try{const s=null==t?void 0:t.format;if(!s||!s.startsWith("BGR")&&!s.startsWith("RGB"))throw new Error(`Unrecognized format ${s}`);const a=s.startsWith("BGR"),l=new Uint8ClampedArray(n*o*4);if(yield t.copyTo(l,function(e,t,i,r,n){const o=4*Math.max(1,0),s=(Math.max(0,i)-i)*r*4+o,a=4*r,l=Math.max(0,t),c=Math.max(0,i);return{rect:{x:l,y:c,width:Math.min(e.width,t+r)-l,height:Math.min(e.height,i+n)-c},layout:[{offset:s,stride:a}]}}(e,i,r,n,o)),a)for(let e=0;e<l.length;e+=4){const t=l[e];l[e]=l[e+2],l[e+2]=t}return l}finally{t.close()}}))}let W,X;function Y(e,t,i,r){return e.addEventListener(t,i,r),{unsubscribe:()=>{e.removeEventListener(t,i,r)}}}function J(e){return e/Math.PI*180}const ee={touchstart:!0,touchmove:!0,touchmoveWindow:!0,touchend:!0,touchcancel:!0},te={dblclick:!0,click:!0,mouseover:!0,mouseout:!0,mousedown:!0,mousemove:!0,mousemoveWindow:!0,mouseup:!0,mouseupWindow:!0,contextmenu:!0,wheel:!0},ie="AbortError";function re(){return new Error(ie)}const ne={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function oe(e){return ne.REGISTERED_PROTOCOLS[e.substring(0,e.indexOf("://"))]}const se="global-dispatcher";class ae extends Error{constructor(e,t,i,r){super(`AJAXError: ${t} (${e}): ${i}`),this.status=e,this.statusText=t,this.url=i,this.body=r}}const le=()=>G(self)?self.worker&&self.worker.referrer:("blob:"===window.location.protocol?window.parent:window).location.href,ce=function(e,i){if(/:\/\//.test(e.url)&&!/^https?:|^file:/.test(e.url)){const t=oe(e.url);if(t)return t(e,i);if(G(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:e,targetMapId:se},i)}if(!(/^file:/.test(r=e.url)||/^file:/.test(le())&&!/^\w+:/.test(r))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(e,i){return t(this,void 0,void 0,(function*(){const t=new Request(e.url,{method:e.method||"GET",body:e.body,credentials:e.credentials,headers:e.headers,cache:e.cache,referrer:le(),signal:i.signal});let r,n;"json"!==e.type||t.headers.has("Accept")||t.headers.set("Accept","application/json");try{r=yield fetch(t)}catch(t){throw new ae(0,t.message,e.url,new Blob)}if(!r.ok){const t=yield r.blob();throw new ae(r.status,r.statusText,e.url,t)}n="arrayBuffer"===e.type||"image"===e.type?r.arrayBuffer():"json"===e.type?r.json():r.text();const o=yield n;if(i.signal.aborted)throw re();return{data:o,cacheControl:r.headers.get("Cache-Control"),expires:r.headers.get("Expires")}}))}(e,i);if(G(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:e,mustQueue:!0,targetMapId:se},i)}var r;return function(e,t){return new Promise(((i,r)=>{var n;const o=new XMLHttpRequest;o.open(e.method||"GET",e.url,!0),"arrayBuffer"!==e.type&&"image"!==e.type||(o.responseType="arraybuffer");for(const t in e.headers)o.setRequestHeader(t,e.headers[t]);"json"===e.type&&(o.responseType="text",(null===(n=e.headers)||void 0===n?void 0:n.Accept)||o.setRequestHeader("Accept","application/json")),o.withCredentials="include"===e.credentials,o.onerror=()=>{r(new Error(o.statusText))},o.onload=()=>{if(!t.signal.aborted)if((o.status>=200&&o.status<300||0===o.status)&&null!==o.response){let t=o.response;if("json"===e.type)try{t=JSON.parse(o.response)}catch(e){return void r(e)}i({data:t,cacheControl:o.getResponseHeader("Cache-Control"),expires:o.getResponseHeader("Expires")})}else{const t=new Blob([o.response],{type:o.getResponseHeader("Content-Type")});r(new ae(o.status,o.statusText,e.url,t))}},t.signal.addEventListener("abort",(()=>{o.abort(),r(re())})),o.send(e.body)}))}(e,i)};function ue(e){if(!e||e.indexOf("://")<=0||0===e.indexOf("data:image/")||0===e.indexOf("blob:"))return!0;const t=new URL(e),i=window.location;return t.protocol===i.protocol&&t.host===i.host}function he(e,t,i){i[e]&&-1!==i[e].indexOf(t)||(i[e]=i[e]||[],i[e].push(t))}function de(e,t,i){if(i&&i[e]){const r=i[e].indexOf(t);-1!==r&&i[e].splice(r,1)}}class pe{constructor(e,t={}){D(this,t),this.type=e}}class fe extends pe{constructor(e,t={}){super("error",D({error:e},t))}}class Ae{on(e,t){return this._listeners=this._listeners||{},he(e,t,this._listeners),{unsubscribe:()=>{this.off(e,t)}}}off(e,t){return de(e,t,this._listeners),de(e,t,this._oneTimeListeners),this}once(e,t){return t?(this._oneTimeListeners=this._oneTimeListeners||{},he(e,t,this._oneTimeListeners),this):new Promise((t=>this.once(e,t)))}fire(e,t){"string"==typeof e&&(e=new pe(e,t||{}));const i=e.type;if(this.listens(i)){e.target=this;const t=this._listeners&&this._listeners[i]?this._listeners[i].slice():[];for(const i of t)i.call(this,e);const r=this._oneTimeListeners&&this._oneTimeListeners[i]?this._oneTimeListeners[i].slice():[];for(const t of r)de(i,t,this._oneTimeListeners),t.call(this,e);const n=this._eventedParent;n&&(D(e,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),n.fire(e))}else e instanceof fe&&console.error(e.error);return this}listens(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)}setEventedParent(e,t){return this._eventedParent=e,this._eventedParentData=t,this}}var me={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const ge=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function _e(e,t){const i={};for(const t in e)"ref"!==t&&(i[t]=e[t]);return ge.forEach((e=>{e in t&&(i[e]=t[e])})),i}function ye(e,t){if(Array.isArray(e)){if(!Array.isArray(t)||e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(!ye(e[i],t[i]))return!1;return!0}if("object"==typeof e&&null!==e&&null!==t){if("object"!=typeof t)return!1;if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const i in e)if(!ye(e[i],t[i]))return!1;return!0}return e===t}function ve(e,t){e.push(t)}function xe(e,t,i){ve(i,{command:"addSource",args:[e,t[e]]})}function be(e,t,i){ve(t,{command:"removeSource",args:[e]}),i[e]=!0}function we(e,t,i,r){be(e,i,r),xe(e,t,i)}function Te(e,t,i){let r;for(r in e[i])if(Object.prototype.hasOwnProperty.call(e[i],r)&&"data"!==r&&!ye(e[i][r],t[i][r]))return!1;for(r in t[i])if(Object.prototype.hasOwnProperty.call(t[i],r)&&"data"!==r&&!ye(e[i][r],t[i][r]))return!1;return!0}function Be(e,t,i,r,n,o){e=e||{},t=t||{};for(const s in e)Object.prototype.hasOwnProperty.call(e,s)&&(ye(e[s],t[s])||i.push({command:o,args:[r,s,t[s],n]}));for(const s in t)Object.prototype.hasOwnProperty.call(t,s)&&!Object.prototype.hasOwnProperty.call(e,s)&&(ye(e[s],t[s])||i.push({command:o,args:[r,s,t[s],n]}))}function Ce(e){return e.id}function Se(e,t){return e[t.id]=t,e}class Ee{constructor(e,t,i,r){this.message=(e?`${e}: `:"")+i,r&&(this.identifier=r),null!=t&&t.__line__&&(this.line=t.__line__)}}function Me(e,...t){for(const i of t)for(const t in i)e[t]=i[t];return e}class Ie extends Error{constructor(e,t){super(t),this.message=t,this.key=e}}class Pe{constructor(e,t=[]){this.parent=e,this.bindings={};for(const[e,i]of t)this.bindings[e]=i}concat(e){return new Pe(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const Le={kind:"null"},Fe={kind:"number"},ke={kind:"string"},ze={kind:"boolean"},Re={kind:"color"},De={kind:"projectionDefinition"},Oe={kind:"object"},Ue={kind:"value"},Ne={kind:"collator"},Qe={kind:"formatted"},je={kind:"padding"},Ve={kind:"resolvedImage"},He={kind:"variableAnchorOffsetCollection"};function Ge(e,t){return{kind:"array",itemType:e,N:t}}function $e(e){if("array"===e.kind){const t=$e(e.itemType);return"number"==typeof e.N?`array<${t}, ${e.N}>`:"value"===e.itemType.kind?"array":`array<${t}>`}return e.kind}const Ze=[Le,Fe,ke,ze,Re,De,Qe,Oe,Ge(Ue),je,Ve,He];function qe(e,t){if("error"===t.kind)return null;if("array"===e.kind){if("array"===t.kind&&(0===t.N&&"value"===t.itemType.kind||!qe(e.itemType,t.itemType))&&("number"!=typeof e.N||e.N===t.N))return null}else{if(e.kind===t.kind)return null;if("value"===e.kind)for(const e of Ze)if(!qe(e,t))return null}return`Expected ${$e(e)} but found ${$e(t)} instead.`}function Ke(e,t){return t.some((t=>t.kind===e.kind))}function We(e,t){return t.some((t=>"null"===t?null===e:"array"===t?Array.isArray(e):"object"===t?e&&!Array.isArray(e)&&"object"==typeof e:t===typeof e))}function Xe(e,t){return"array"===e.kind&&"array"===t.kind?e.itemType.kind===t.itemType.kind&&"number"==typeof e.N:e.kind===t.kind}const Ye=.96422,Je=.82521,et=4/29,tt=6/29,it=3*tt*tt,rt=tt*tt*tt,nt=Math.PI/180,ot=180/Math.PI;function st(e){return(e%=360)<0&&(e+=360),e}function at([e,t,i,r]){let n,o;const s=ct((.2225045*(e=lt(e))+.7168786*(t=lt(t))+.0606169*(i=lt(i)))/1);e===t&&t===i?n=o=s:(n=ct((.4360747*e+.3850649*t+.1430804*i)/Ye),o=ct((.0139322*e+.0971045*t+.7141733*i)/Je));const a=116*s-16;return[a<0?0:a,500*(n-s),200*(s-o),r]}function lt(e){return e<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function ct(e){return e>rt?Math.pow(e,1/3):e/it+et}function ut([e,t,i,r]){let n=(e+16)/116,o=isNaN(t)?n:n+t/500,s=isNaN(i)?n:n-i/200;return n=1*dt(n),o=Ye*dt(o),s=Je*dt(s),[ht(3.1338561*o-1.6168667*n-.4906146*s),ht(-.9787684*o+1.9161415*n+.033454*s),ht(.0719453*o-.2289914*n+1.4052427*s),r]}function ht(e){return(e=e<=.00304?12.92*e:1.055*Math.pow(e,1/2.4)-.055)<0?0:e>1?1:e}function dt(e){return e>tt?e*e*e:it*(e-et)}function pt(e){return parseInt(e.padEnd(2,e),16)/255}function ft(e,t){return At(t?e/100:e,0,1)}function At(e,t,i){return Math.min(Math.max(t,e),i)}function mt(e){return!e.some(Number.isNaN)}const gt={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function _t(e,t,i){return e+i*(t-e)}function yt(e,t,i){return e.map(((e,r)=>_t(e,t[r],i)))}class vt{constructor(e,t,i,r=1,n=!0){this.r=e,this.g=t,this.b=i,this.a=r,n||(this.r*=r,this.g*=r,this.b*=r,r||this.overwriteGetter("rgb",[e,t,i,r]))}static parse(e){if(e instanceof vt)return e;if("string"!=typeof e)return;const t=function(e){if("transparent"===(e=e.toLowerCase().trim()))return[0,0,0,0];const t=gt[e];if(t){const[e,i,r]=t;return[e/255,i/255,r/255,1]}if(e.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(e)){const t=e.length<6?1:2;let i=1;return[pt(e.slice(i,i+=t)),pt(e.slice(i,i+=t)),pt(e.slice(i,i+=t)),pt(e.slice(i,i+t)||"ff")]}if(e.startsWith("rgb")){const t=e.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(t){const[e,i,r,n,o,s,a,l,c,u,h,d]=t,p=[n||" ",a||" ",u].join("");if("  "===p||"  /"===p||",,"===p||",,,"===p){const e=[r,s,c].join(""),t="%%%"===e?100:""===e?255:0;if(t){const e=[At(+i/t,0,1),At(+o/t,0,1),At(+l/t,0,1),h?ft(+h,d):1];if(mt(e))return e}}return}}const i=e.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(i){const[e,t,r,n,o,s,a,l,c]=i,u=[r||" ",o||" ",a].join("");if("  "===u||"  /"===u||",,"===u||",,,"===u){const e=[+t,At(+n,0,100),At(+s,0,100),l?ft(+l,c):1];if(mt(e))return function([e,t,i,r]){function n(r){const n=(r+e/30)%12,o=t*Math.min(i,1-i);return i-o*Math.max(-1,Math.min(n-3,9-n,1))}return e=st(e),t/=100,i/=100,[n(0),n(8),n(4),r]}(e)}}}(e);return t?new vt(...t,!1):void 0}get rgb(){const{r:e,g:t,b:i,a:r}=this,n=r||1/0;return this.overwriteGetter("rgb",[e/n,t/n,i/n,r])}get hcl(){return this.overwriteGetter("hcl",function(e){const[t,i,r,n]=at(e),o=Math.sqrt(i*i+r*r);return[Math.round(1e4*o)?st(Math.atan2(r,i)*ot):NaN,o,t,n]}(this.rgb))}get lab(){return this.overwriteGetter("lab",at(this.rgb))}overwriteGetter(e,t){return Object.defineProperty(this,e,{value:t}),t}toString(){const[e,t,i,r]=this.rgb;return`rgba(${[e,t,i].map((e=>Math.round(255*e))).join(",")},${r})`}static interpolate(e,t,i,r="rgb"){switch(r){case"rgb":{const[r,n,o,s]=yt(e.rgb,t.rgb,i);return new vt(r,n,o,s,!1)}case"hcl":{const[r,n,o,s]=e.hcl,[a,l,c,u]=t.hcl;let h,d;if(isNaN(r)||isNaN(a))isNaN(r)?isNaN(a)?h=NaN:(h=a,1!==o&&0!==o||(d=l)):(h=r,1!==c&&0!==c||(d=n));else{let e=a-r;a>r&&e>180?e-=360:a<r&&r-a>180&&(e+=360),h=r+i*e}const[p,f,A,m]=function([e,t,i,r]){return e=isNaN(e)?0:e*nt,ut([i,Math.cos(e)*t,Math.sin(e)*t,r])}([h,null!=d?d:_t(n,l,i),_t(o,c,i),_t(s,u,i)]);return new vt(p,f,A,m,!1)}case"lab":{const[r,n,o,s]=ut(yt(e.lab,t.lab,i));return new vt(r,n,o,s,!1)}}}}vt.black=new vt(0,0,0,1),vt.white=new vt(1,1,1,1),vt.transparent=new vt(0,0,0,0),vt.red=new vt(1,0,0,1);class xt{constructor(e,t,i){this.sensitivity=e?t?"variant":"case":t?"accent":"base",this.locale=i,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,t){return this.collator.compare(e,t)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const bt=["bottom","center","top"];class wt{constructor(e,t,i,r,n,o){this.text=e,this.image=t,this.scale=i,this.fontStack=r,this.textColor=n,this.verticalAlign=o}}class Tt{constructor(e){this.sections=e}static fromString(e){return new Tt([new wt(e,null,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some((e=>0!==e.text.length||e.image&&0!==e.image.name.length))}static factory(e){return e instanceof Tt?e:Tt.fromString(e)}toString(){return 0===this.sections.length?"":this.sections.map((e=>e.text)).join("")}}class Bt{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Bt)return e;if("number"==typeof e)return new Bt([e,e,e,e]);if(Array.isArray(e)&&!(e.length<1||e.length>4)){for(const t of e)if("number"!=typeof t)return;switch(e.length){case 1:e=[e[0],e[0],e[0],e[0]];break;case 2:e=[e[0],e[1],e[0],e[1]];break;case 3:e=[e[0],e[1],e[2],e[1]]}return new Bt(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,t,i){return new Bt(yt(e.values,t.values,i))}}class Ct{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const St=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Et{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Et)return e;if(Array.isArray(e)&&!(e.length<1)&&e.length%2==0){for(let t=0;t<e.length;t+=2){const i=e[t],r=e[t+1];if("string"!=typeof i||!St.has(i))return;if(!Array.isArray(r)||2!==r.length||"number"!=typeof r[0]||"number"!=typeof r[1])return}return new Et(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,t,i){const r=e.values,n=t.values;if(r.length!==n.length)throw new Ct(`Cannot interpolate values of different length. from: ${e.toString()}, to: ${t.toString()}`);const o=[];for(let e=0;e<r.length;e+=2){if(r[e]!==n[e])throw new Ct(`Cannot interpolate values containing mismatched anchors. from[${e}]: ${r[e]}, to[${e}]: ${n[e]}`);o.push(r[e]);const[t,s]=r[e+1],[a,l]=n[e+1];o.push([_t(t,a,i),_t(s,l,i)])}return new Et(o)}}class Mt{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new Mt({name:e,available:!1}):null}}class It{constructor(e,t,i){this.from=e,this.to=t,this.transition=i}static interpolate(e,t,i){return new It(e,t,i)}static parse(e){return e instanceof It?e:Array.isArray(e)&&3===e.length&&"string"==typeof e[0]&&"string"==typeof e[1]&&"number"==typeof e[2]?new It(e[0],e[1],e[2]):"object"==typeof e&&"string"==typeof e.from&&"string"==typeof e.to&&"number"==typeof e.transition?new It(e.from,e.to,e.transition):"string"==typeof e?new It(e,e,1):void 0}}function Pt(e,t,i,r){return"number"==typeof e&&e>=0&&e<=255&&"number"==typeof t&&t>=0&&t<=255&&"number"==typeof i&&i>=0&&i<=255?void 0===r||"number"==typeof r&&r>=0&&r<=1?null:`Invalid rgba value [${[e,t,i,r].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof r?[e,t,i,r]:[e,t,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Lt(e){if(null===e||"string"==typeof e||"boolean"==typeof e||"number"==typeof e||e instanceof It||e instanceof vt||e instanceof xt||e instanceof Tt||e instanceof Bt||e instanceof Et||e instanceof Mt)return!0;if(Array.isArray(e)){for(const t of e)if(!Lt(t))return!1;return!0}if("object"==typeof e){for(const t in e)if(!Lt(e[t]))return!1;return!0}return!1}function Ft(e){if(null===e)return Le;if("string"==typeof e)return ke;if("boolean"==typeof e)return ze;if("number"==typeof e)return Fe;if(e instanceof vt)return Re;if(e instanceof It)return De;if(e instanceof xt)return Ne;if(e instanceof Tt)return Qe;if(e instanceof Bt)return je;if(e instanceof Et)return He;if(e instanceof Mt)return Ve;if(Array.isArray(e)){const t=e.length;let i;for(const t of e){const e=Ft(t);if(i){if(i===e)continue;i=Ue;break}i=e}return Ge(i||Ue,t)}return Oe}function kt(e){const t=typeof e;return null===e?"":"string"===t||"number"===t||"boolean"===t?String(e):e instanceof vt||e instanceof It||e instanceof Tt||e instanceof Bt||e instanceof Et||e instanceof Mt?e.toString():JSON.stringify(e)}class zt{constructor(e,t){this.type=e,this.value=t}static parse(e,t){if(2!==e.length)return t.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Lt(e[1]))return t.error("invalid value");const i=e[1];let r=Ft(i);const n=t.expectedType;return"array"!==r.kind||0!==r.N||!n||"array"!==n.kind||"number"==typeof n.N&&0!==n.N||(r=n),new zt(r,i)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const Rt={string:ke,number:Fe,boolean:ze,object:Oe};class Dt{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");let i,r=1;const n=e[0];if("array"===n){let n,o;if(e.length>2){const i=e[1];if("string"!=typeof i||!(i in Rt)||"object"===i)return t.error('The item type argument of "array" must be one of string, number, boolean',1);n=Rt[i],r++}else n=Ue;if(e.length>3){if(null!==e[2]&&("number"!=typeof e[2]||e[2]<0||e[2]!==Math.floor(e[2])))return t.error('The length argument to "array" must be a positive integer literal',2);o=e[2],r++}i=Ge(n,o)}else{if(!Rt[n])throw new Error(`Types doesn't contain name = ${n}`);i=Rt[n]}const o=[];for(;r<e.length;r++){const i=t.parse(e[r],r,Ue);if(!i)return null;o.push(i)}return new Dt(i,o)}evaluate(e){for(let t=0;t<this.args.length;t++){const i=this.args[t].evaluate(e);if(!qe(this.type,Ft(i)))return i;if(t===this.args.length-1)throw new Ct(`Expected value to be of type ${$e(this.type)}, but found ${$e(Ft(i))} instead.`)}throw new Error}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}}const Ot={"to-boolean":ze,"to-color":Re,"to-number":Fe,"to-string":ke};class Ut{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const i=e[0];if(!Ot[i])throw new Error(`Can't parse ${i} as it is not part of the known types`);if(("to-boolean"===i||"to-string"===i)&&2!==e.length)return t.error("Expected one argument.");const r=Ot[i],n=[];for(let i=1;i<e.length;i++){const r=t.parse(e[i],i,Ue);if(!r)return null;n.push(r)}return new Ut(r,n)}evaluate(e){switch(this.type.kind){case"boolean":return Boolean(this.args[0].evaluate(e));case"color":{let t,i;for(const r of this.args){if(t=r.evaluate(e),i=null,t instanceof vt)return t;if("string"==typeof t){const i=e.parseColor(t);if(i)return i}else if(Array.isArray(t)&&(i=t.length<3||t.length>4?`Invalid rgba value ${JSON.stringify(t)}: expected an array containing either three or four numeric values.`:Pt(t[0],t[1],t[2],t[3]),!i))return new vt(t[0]/255,t[1]/255,t[2]/255,t[3])}throw new Ct(i||`Could not parse color from value '${"string"==typeof t?t:JSON.stringify(t)}'`)}case"padding":{let t;for(const i of this.args){t=i.evaluate(e);const r=Bt.parse(t);if(r)return r}throw new Ct(`Could not parse padding from value '${"string"==typeof t?t:JSON.stringify(t)}'`)}case"variableAnchorOffsetCollection":{let t;for(const i of this.args){t=i.evaluate(e);const r=Et.parse(t);if(r)return r}throw new Ct(`Could not parse variableAnchorOffsetCollection from value '${"string"==typeof t?t:JSON.stringify(t)}'`)}case"number":{let t=null;for(const i of this.args){if(t=i.evaluate(e),null===t)return 0;const r=Number(t);if(!isNaN(r))return r}throw new Ct(`Could not convert ${JSON.stringify(t)} to number.`)}case"formatted":return Tt.fromString(kt(this.args[0].evaluate(e)));case"resolvedImage":return Mt.fromString(kt(this.args[0].evaluate(e)));case"projectionDefinition":return this.args[0].evaluate(e);default:return kt(this.args[0].evaluate(e))}}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}}const Nt=["Unknown","Point","LineString","Polygon"];class Qt{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?Nt[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let t=this._parseColorCache[e];return t||(t=this._parseColorCache[e]=vt.parse(e)),t}}class jt{constructor(e,t,i=[],r,n=new Pe,o=[]){this.registry=e,this.path=i,this.key=i.map((e=>`[${e}]`)).join(""),this.scope=n,this.errors=o,this.expectedType=r,this._isConstant=t}parse(e,t,i,r,n={}){return t?this.concat(t,i,r)._parse(e,n):this._parse(e,n)}_parse(e,t){function i(e,t,i){return"assert"===i?new Dt(t,[e]):"coerce"===i?new Ut(t,[e]):e}if(null!==e&&"string"!=typeof e&&"boolean"!=typeof e&&"number"!=typeof e||(e=["literal",e]),Array.isArray(e)){if(0===e.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const r=e[0];if("string"!=typeof r)return this.error(`Expression name must be a string, but found ${typeof r} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const n=this.registry[r];if(n){let r=n.parse(e,this);if(!r)return null;if(this.expectedType){const e=this.expectedType,n=r.type;if("string"!==e.kind&&"number"!==e.kind&&"boolean"!==e.kind&&"object"!==e.kind&&"array"!==e.kind||"value"!==n.kind)if("projectionDefinition"!==e.kind||"string"!==n.kind&&"array"!==n.kind)if("color"!==e.kind&&"formatted"!==e.kind&&"resolvedImage"!==e.kind||"value"!==n.kind&&"string"!==n.kind)if("padding"!==e.kind||"value"!==n.kind&&"number"!==n.kind&&"array"!==n.kind)if("variableAnchorOffsetCollection"!==e.kind||"value"!==n.kind&&"array"!==n.kind){if(this.checkSubtype(e,n))return null}else r=i(r,e,t.typeAnnotation||"coerce");else r=i(r,e,t.typeAnnotation||"coerce");else r=i(r,e,t.typeAnnotation||"coerce");else r=i(r,e,t.typeAnnotation||"coerce");else r=i(r,e,t.typeAnnotation||"assert")}if(!(r instanceof zt)&&"resolvedImage"!==r.type.kind&&this._isConstant(r)){const t=new Qt;try{r=new zt(r.type,r.evaluate(t))}catch(e){return this.error(e.message),null}}return r}return this.error(`Unknown expression "${r}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===e?"'undefined' value invalid. Use null instead.":"object"==typeof e?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,t,i){const r="number"==typeof e?this.path.concat(e):this.path,n=i?this.scope.concat(i):this.scope;return new jt(this.registry,this._isConstant,r,t||null,n,this.errors)}error(e,...t){const i=`${this.key}${t.map((e=>`[${e}]`)).join("")}`;this.errors.push(new Ie(i,e))}checkSubtype(e,t){const i=qe(e,t);return i&&this.error(i),i}}class Vt{constructor(e,t){this.type=t.type,this.bindings=[].concat(e),this.result=t}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const t of this.bindings)e(t[1]);e(this.result)}static parse(e,t){if(e.length<4)return t.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const i=[];for(let r=1;r<e.length-1;r+=2){const n=e[r];if("string"!=typeof n)return t.error(`Expected string, but found ${typeof n} instead.`,r);if(/[^a-zA-Z0-9_]/.test(n))return t.error("Variable names must contain only alphanumeric characters or '_'.",r);const o=t.parse(e[r+1],r+1);if(!o)return null;i.push([n,o])}const r=t.parse(e[e.length-1],e.length-1,t.expectedType,i);return r?new Vt(i,r):null}outputDefined(){return this.result.outputDefined()}}class Ht{constructor(e,t){this.type=t.type,this.name=e,this.boundExpression=t}static parse(e,t){if(2!==e.length||"string"!=typeof e[1])return t.error("'var' expression requires exactly one string literal argument.");const i=e[1];return t.scope.has(i)?new Ht(i,t.scope.get(i)):t.error(`Unknown variable "${i}". Make sure "${i}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}}class Gt{constructor(e,t,i){this.type=e,this.index=t,this.input=i}static parse(e,t){if(3!==e.length)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const i=t.parse(e[1],1,Fe),r=t.parse(e[2],2,Ge(t.expectedType||Ue));return i&&r?new Gt(r.type.itemType,i,r):null}evaluate(e){const t=this.index.evaluate(e),i=this.input.evaluate(e);if(t<0)throw new Ct(`Array index out of bounds: ${t} < 0.`);if(t>=i.length)throw new Ct(`Array index out of bounds: ${t} > ${i.length-1}.`);if(t!==Math.floor(t))throw new Ct(`Array index must be an integer, but found ${t} instead.`);return i[t]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}}class $t{constructor(e,t){this.type=ze,this.needle=e,this.haystack=t}static parse(e,t){if(3!==e.length)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const i=t.parse(e[1],1,Ue),r=t.parse(e[2],2,Ue);return i&&r?Ke(i.type,[ze,ke,Fe,Le,Ue])?new $t(i,r):t.error(`Expected first argument to be of type boolean, string, number or null, but found ${$e(i.type)} instead`):null}evaluate(e){const t=this.needle.evaluate(e),i=this.haystack.evaluate(e);if(!i)return!1;if(!We(t,["boolean","string","number","null"]))throw new Ct(`Expected first argument to be of type boolean, string, number or null, but found ${$e(Ft(t))} instead.`);if(!We(i,["string","array"]))throw new Ct(`Expected second argument to be of type array or string, but found ${$e(Ft(i))} instead.`);return i.indexOf(t)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}}class Zt{constructor(e,t,i){this.type=Fe,this.needle=e,this.haystack=t,this.fromIndex=i}static parse(e,t){if(e.length<=2||e.length>=5)return t.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const i=t.parse(e[1],1,Ue),r=t.parse(e[2],2,Ue);if(!i||!r)return null;if(!Ke(i.type,[ze,ke,Fe,Le,Ue]))return t.error(`Expected first argument to be of type boolean, string, number or null, but found ${$e(i.type)} instead`);if(4===e.length){const n=t.parse(e[3],3,Fe);return n?new Zt(i,r,n):null}return new Zt(i,r)}evaluate(e){const t=this.needle.evaluate(e),i=this.haystack.evaluate(e);if(!We(t,["boolean","string","number","null"]))throw new Ct(`Expected first argument to be of type boolean, string, number or null, but found ${$e(Ft(t))} instead.`);let r;if(this.fromIndex&&(r=this.fromIndex.evaluate(e)),We(i,["string"])){const e=i.indexOf(t,r);return-1===e?-1:[...i.slice(0,e)].length}if(We(i,["array"]))return i.indexOf(t,r);throw new Ct(`Expected second argument to be of type array or string, but found ${$e(Ft(i))} instead.`)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}}class qt{constructor(e,t,i,r,n,o){this.inputType=e,this.type=t,this.input=i,this.cases=r,this.outputs=n,this.otherwise=o}static parse(e,t){if(e.length<5)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return t.error("Expected an even number of arguments.");let i,r;t.expectedType&&"value"!==t.expectedType.kind&&(r=t.expectedType);const n={},o=[];for(let s=2;s<e.length-1;s+=2){let a=e[s];const l=e[s+1];Array.isArray(a)||(a=[a]);const c=t.concat(s);if(0===a.length)return c.error("Expected at least one branch label.");for(const e of a){if("number"!=typeof e&&"string"!=typeof e)return c.error("Branch labels must be numbers or strings.");if("number"==typeof e&&Math.abs(e)>Number.MAX_SAFE_INTEGER)return c.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof e&&Math.floor(e)!==e)return c.error("Numeric branch labels must be integer values.");if(i){if(c.checkSubtype(i,Ft(e)))return null}else i=Ft(e);if(void 0!==n[String(e)])return c.error("Branch labels must be unique.");n[String(e)]=o.length}const u=t.parse(l,s,r);if(!u)return null;r=r||u.type,o.push(u)}const s=t.parse(e[1],1,Ue);if(!s)return null;const a=t.parse(e[e.length-1],e.length-1,r);return a?"value"!==s.type.kind&&t.concat(1).checkSubtype(i,s.type)?null:new qt(i,r,s,n,o,a):null}evaluate(e){const t=this.input.evaluate(e);return(Ft(t)===this.inputType&&this.outputs[this.cases[t]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))&&this.otherwise.outputDefined()}}class Kt{constructor(e,t,i){this.type=e,this.branches=t,this.otherwise=i}static parse(e,t){if(e.length<4)return t.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return t.error("Expected an odd number of arguments.");let i;t.expectedType&&"value"!==t.expectedType.kind&&(i=t.expectedType);const r=[];for(let n=1;n<e.length-1;n+=2){const o=t.parse(e[n],n,ze);if(!o)return null;const s=t.parse(e[n+1],n+1,i);if(!s)return null;r.push([o,s]),i=i||s.type}const n=t.parse(e[e.length-1],e.length-1,i);if(!n)return null;if(!i)throw new Error("Can't infer output type");return new Kt(i,r,n)}evaluate(e){for(const[t,i]of this.branches)if(t.evaluate(e))return i.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[t,i]of this.branches)e(t),e(i);e(this.otherwise)}outputDefined(){return this.branches.every((([e,t])=>t.outputDefined()))&&this.otherwise.outputDefined()}}class Wt{constructor(e,t,i,r){this.type=e,this.input=t,this.beginIndex=i,this.endIndex=r}static parse(e,t){if(e.length<=2||e.length>=5)return t.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const i=t.parse(e[1],1,Ue),r=t.parse(e[2],2,Fe);if(!i||!r)return null;if(!Ke(i.type,[Ge(Ue),ke,Ue]))return t.error(`Expected first argument to be of type array or string, but found ${$e(i.type)} instead`);if(4===e.length){const n=t.parse(e[3],3,Fe);return n?new Wt(i.type,i,r,n):null}return new Wt(i.type,i,r)}evaluate(e){const t=this.input.evaluate(e),i=this.beginIndex.evaluate(e);let r;if(this.endIndex&&(r=this.endIndex.evaluate(e)),We(t,["string"]))return[...t].slice(i,r).join("");if(We(t,["array"]))return t.slice(i,r);throw new Ct(`Expected first argument to be of type array or string, but found ${$e(Ft(t))} instead.`)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}}function Xt(e,t){const i=e.length-1;let r,n,o=0,s=i,a=0;for(;o<=s;)if(a=Math.floor((o+s)/2),r=e[a],n=e[a+1],r<=t){if(a===i||t<n)return a;o=a+1}else{if(!(r>t))throw new Ct("Input is not a number.");s=a-1}return 0}class Yt{constructor(e,t,i){this.type=e,this.input=t,this.labels=[],this.outputs=[];for(const[e,t]of i)this.labels.push(e),this.outputs.push(t)}static parse(e,t){if(e.length-1<4)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");const i=t.parse(e[1],1,Fe);if(!i)return null;const r=[];let n=null;t.expectedType&&"value"!==t.expectedType.kind&&(n=t.expectedType);for(let i=1;i<e.length;i+=2){const o=1===i?-1/0:e[i],s=e[i+1],a=i,l=i+1;if("number"!=typeof o)return t.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',a);if(r.length&&r[r.length-1][0]>=o)return t.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',a);const c=t.parse(s,l,n);if(!c)return null;n=n||c.type,r.push([o,c])}return new Yt(n,i,r)}evaluate(e){const t=this.labels,i=this.outputs;if(1===t.length)return i[0].evaluate(e);const r=this.input.evaluate(e);if(r<=t[0])return i[0].evaluate(e);const n=t.length;return r>=t[n-1]?i[n-1].evaluate(e):i[Xt(t,r)].evaluate(e)}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}}function Jt(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var ei,ti,ii=function(){if(ti)return ei;function e(e,t,i,r){this.cx=3*e,this.bx=3*(i-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(r-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=t,this.p2x=i,this.p2y=r}return ti=1,ei=e,e.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,t){if(void 0===t&&(t=1e-6),e<0)return 0;if(e>1)return 1;for(var i=e,r=0;r<8;r++){var n=this.sampleCurveX(i)-e;if(Math.abs(n)<t)return i;var o=this.sampleCurveDerivativeX(i);if(Math.abs(o)<1e-6)break;i-=n/o}var s=0,a=1;for(i=e,r=0;r<20&&(n=this.sampleCurveX(i),!(Math.abs(n-e)<t));r++)e>n?s=i:a=i,i=.5*(a-s)+s;return i},solve:function(e,t){return this.sampleCurveY(this.solveCurveX(e,t))}},ei}(),ri=Jt(ii);class ni{constructor(e,t,i,r,n){this.type=e,this.operator=t,this.interpolation=i,this.input=r,this.labels=[],this.outputs=[];for(const[e,t]of n)this.labels.push(e),this.outputs.push(t)}static interpolationFactor(e,t,i,r){let n=0;if("exponential"===e.name)n=oi(t,e.base,i,r);else if("linear"===e.name)n=oi(t,1,i,r);else if("cubic-bezier"===e.name){const o=e.controlPoints;n=new ri(o[0],o[1],o[2],o[3]).solve(oi(t,1,i,r))}return n}static parse(e,t){let[i,r,n,...o]=e;if(!Array.isArray(r)||0===r.length)return t.error("Expected an interpolation type expression.",1);if("linear"===r[0])r={name:"linear"};else if("exponential"===r[0]){const e=r[1];if("number"!=typeof e)return t.error("Exponential interpolation requires a numeric base.",1,1);r={name:"exponential",base:e}}else{if("cubic-bezier"!==r[0])return t.error(`Unknown interpolation type ${String(r[0])}`,1,0);{const e=r.slice(1);if(4!==e.length||e.some((e=>"number"!=typeof e||e<0||e>1)))return t.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);r={name:"cubic-bezier",controlPoints:e}}}if(e.length-1<4)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");if(n=t.parse(n,2,Fe),!n)return null;const s=[];let a=null;"interpolate-hcl"===i||"interpolate-lab"===i?a=Re:t.expectedType&&"value"!==t.expectedType.kind&&(a=t.expectedType);for(let e=0;e<o.length;e+=2){const i=o[e],r=o[e+1],n=e+3,l=e+4;if("number"!=typeof i)return t.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',n);if(s.length&&s[s.length-1][0]>=i)return t.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',n);const c=t.parse(r,l,a);if(!c)return null;a=a||c.type,s.push([i,c])}return Xe(a,Fe)||Xe(a,De)||Xe(a,Re)||Xe(a,je)||Xe(a,He)||Xe(a,Ge(Fe))?new ni(a,i,r,n,s):t.error(`Type ${$e(a)} is not interpolatable.`)}evaluate(e){const t=this.labels,i=this.outputs;if(1===t.length)return i[0].evaluate(e);const r=this.input.evaluate(e);if(r<=t[0])return i[0].evaluate(e);const n=t.length;if(r>=t[n-1])return i[n-1].evaluate(e);const o=Xt(t,r),s=ni.interpolationFactor(this.interpolation,r,t[o],t[o+1]),a=i[o].evaluate(e),l=i[o+1].evaluate(e);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return _t(a,l,s);case"color":return vt.interpolate(a,l,s);case"padding":return Bt.interpolate(a,l,s);case"variableAnchorOffsetCollection":return Et.interpolate(a,l,s);case"array":return yt(a,l,s);case"projectionDefinition":return It.interpolate(a,l,s)}case"interpolate-hcl":return vt.interpolate(a,l,s,"hcl");case"interpolate-lab":return vt.interpolate(a,l,s,"lab")}}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}}function oi(e,t,i,r){const n=r-i,o=e-i;return 0===n?0:1===t?o/n:(Math.pow(t,o)-1)/(Math.pow(t,n)-1)}const si={color:vt.interpolate,number:_t,padding:Bt.interpolate,variableAnchorOffsetCollection:Et.interpolate,array:yt};class ai{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");let i=null;const r=t.expectedType;r&&"value"!==r.kind&&(i=r);const n=[];for(const r of e.slice(1)){const e=t.parse(r,1+n.length,i,void 0,{typeAnnotation:"omit"});if(!e)return null;i=i||e.type,n.push(e)}if(!i)throw new Error("No output type");const o=r&&n.some((e=>qe(r,e.type)));return new ai(o?Ue:i,n)}evaluate(e){let t,i=null,r=0;for(const n of this.args)if(r++,i=n.evaluate(e),i&&i instanceof Mt&&!i.available&&(t||(t=i.name),i=null,r===this.args.length&&(i=t)),null!==i)break;return i}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}}function li(e,t){return"=="===e||"!="===e?"boolean"===t.kind||"string"===t.kind||"number"===t.kind||"null"===t.kind||"value"===t.kind:"string"===t.kind||"number"===t.kind||"value"===t.kind}function ci(e,t,i,r){return 0===r.compare(t,i)}function ui(e,t,i){const r="=="!==e&&"!="!==e;return class n{constructor(e,t,i){this.type=ze,this.lhs=e,this.rhs=t,this.collator=i,this.hasUntypedArgument="value"===e.type.kind||"value"===t.type.kind}static parse(e,t){if(3!==e.length&&4!==e.length)return t.error("Expected two or three arguments.");const i=e[0];let o=t.parse(e[1],1,Ue);if(!o)return null;if(!li(i,o.type))return t.concat(1).error(`"${i}" comparisons are not supported for type '${$e(o.type)}'.`);let s=t.parse(e[2],2,Ue);if(!s)return null;if(!li(i,s.type))return t.concat(2).error(`"${i}" comparisons are not supported for type '${$e(s.type)}'.`);if(o.type.kind!==s.type.kind&&"value"!==o.type.kind&&"value"!==s.type.kind)return t.error(`Cannot compare types '${$e(o.type)}' and '${$e(s.type)}'.`);r&&("value"===o.type.kind&&"value"!==s.type.kind?o=new Dt(s.type,[o]):"value"!==o.type.kind&&"value"===s.type.kind&&(s=new Dt(o.type,[s])));let a=null;if(4===e.length){if("string"!==o.type.kind&&"string"!==s.type.kind&&"value"!==o.type.kind&&"value"!==s.type.kind)return t.error("Cannot use collator to compare non-string types.");if(a=t.parse(e[3],3,Ne),!a)return null}return new n(o,s,a)}evaluate(n){const o=this.lhs.evaluate(n),s=this.rhs.evaluate(n);if(r&&this.hasUntypedArgument){const t=Ft(o),i=Ft(s);if(t.kind!==i.kind||"string"!==t.kind&&"number"!==t.kind)throw new Ct(`Expected arguments for "${e}" to be (string, string) or (number, number), but found (${t.kind}, ${i.kind}) instead.`)}if(this.collator&&!r&&this.hasUntypedArgument){const e=Ft(o),i=Ft(s);if("string"!==e.kind||"string"!==i.kind)return t(n,o,s)}return this.collator?i(n,o,s,this.collator.evaluate(n)):t(n,o,s)}eachChild(e){e(this.lhs),e(this.rhs),this.collator&&e(this.collator)}outputDefined(){return!0}}}const hi=ui("==",(function(e,t,i){return t===i}),ci),di=ui("!=",(function(e,t,i){return t!==i}),(function(e,t,i,r){return!ci(0,t,i,r)})),pi=ui("<",(function(e,t,i){return t<i}),(function(e,t,i,r){return r.compare(t,i)<0})),fi=ui(">",(function(e,t,i){return t>i}),(function(e,t,i,r){return r.compare(t,i)>0})),Ai=ui("<=",(function(e,t,i){return t<=i}),(function(e,t,i,r){return r.compare(t,i)<=0})),mi=ui(">=",(function(e,t,i){return t>=i}),(function(e,t,i,r){return r.compare(t,i)>=0}));class gi{constructor(e,t,i){this.type=Ne,this.locale=i,this.caseSensitive=e,this.diacriticSensitive=t}static parse(e,t){if(2!==e.length)return t.error("Expected one argument.");const i=e[1];if("object"!=typeof i||Array.isArray(i))return t.error("Collator options argument must be an object.");const r=t.parse(void 0!==i["case-sensitive"]&&i["case-sensitive"],1,ze);if(!r)return null;const n=t.parse(void 0!==i["diacritic-sensitive"]&&i["diacritic-sensitive"],1,ze);if(!n)return null;let o=null;return i.locale&&(o=t.parse(i.locale,1,ke),!o)?null:new gi(r,n,o)}evaluate(e){return new xt(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}}class _i{constructor(e,t,i,r,n){this.type=ke,this.number=e,this.locale=t,this.currency=i,this.minFractionDigits=r,this.maxFractionDigits=n}static parse(e,t){if(3!==e.length)return t.error("Expected two arguments.");const i=t.parse(e[1],1,Fe);if(!i)return null;const r=e[2];if("object"!=typeof r||Array.isArray(r))return t.error("NumberFormat options argument must be an object.");let n=null;if(r.locale&&(n=t.parse(r.locale,1,ke),!n))return null;let o=null;if(r.currency&&(o=t.parse(r.currency,1,ke),!o))return null;let s=null;if(r["min-fraction-digits"]&&(s=t.parse(r["min-fraction-digits"],1,Fe),!s))return null;let a=null;return r["max-fraction-digits"]&&(a=t.parse(r["max-fraction-digits"],1,Fe),!a)?null:new _i(i,n,o,s,a)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}}class yi{constructor(e){this.type=Qe,this.sections=e}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const i=e[1];if(!Array.isArray(i)&&"object"==typeof i)return t.error("First argument must be an image or text section.");const r=[];let n=!1;for(let i=1;i<=e.length-1;++i){const o=e[i];if(n&&"object"==typeof o&&!Array.isArray(o)){n=!1;let e=null;if(o["font-scale"]&&(e=t.parse(o["font-scale"],1,Fe),!e))return null;let i=null;if(o["text-font"]&&(i=t.parse(o["text-font"],1,Ge(ke)),!i))return null;let s=null;if(o["text-color"]&&(s=t.parse(o["text-color"],1,Re),!s))return null;let a=null;if(o["vertical-align"]){if("string"==typeof o["vertical-align"]&&!bt.includes(o["vertical-align"]))return t.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${o["vertical-align"]}' instead.`);if(a=t.parse(o["vertical-align"],1,ke),!a)return null}const l=r[r.length-1];l.scale=e,l.font=i,l.textColor=s,l.verticalAlign=a}else{const o=t.parse(e[i],1,Ue);if(!o)return null;const s=o.type.kind;if("string"!==s&&"value"!==s&&"null"!==s&&"resolvedImage"!==s)return t.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");n=!0,r.push({content:o,scale:null,font:null,textColor:null,verticalAlign:null})}}return new yi(r)}evaluate(e){return new Tt(this.sections.map((t=>{const i=t.content.evaluate(e);return Ft(i)===Ve?new wt("",i,null,null,null,t.verticalAlign?t.verticalAlign.evaluate(e):null):new wt(kt(i),null,t.scale?t.scale.evaluate(e):null,t.font?t.font.evaluate(e).join(","):null,t.textColor?t.textColor.evaluate(e):null,t.verticalAlign?t.verticalAlign.evaluate(e):null)})))}eachChild(e){for(const t of this.sections)e(t.content),t.scale&&e(t.scale),t.font&&e(t.font),t.textColor&&e(t.textColor),t.verticalAlign&&e(t.verticalAlign)}outputDefined(){return!1}}class vi{constructor(e){this.type=Ve,this.input=e}static parse(e,t){if(2!==e.length)return t.error("Expected two arguments.");const i=t.parse(e[1],1,ke);return i?new vi(i):t.error("No image name provided.")}evaluate(e){const t=this.input.evaluate(e),i=Mt.fromString(t);return i&&e.availableImages&&(i.available=e.availableImages.indexOf(t)>-1),i}eachChild(e){e(this.input)}outputDefined(){return!1}}class xi{constructor(e){this.type=Fe,this.input=e}static parse(e,t){if(2!==e.length)return t.error(`Expected 1 argument, but found ${e.length-1} instead.`);const i=t.parse(e[1],1);return i?"array"!==i.type.kind&&"string"!==i.type.kind&&"value"!==i.type.kind?t.error(`Expected argument of type string or array, but found ${$e(i.type)} instead.`):new xi(i):null}evaluate(e){const t=this.input.evaluate(e);if("string"==typeof t)return[...t].length;if(Array.isArray(t))return t.length;throw new Ct(`Expected value to be of type string or array, but found ${$e(Ft(t))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}}const bi=8192;function wi(e,t){const i=(180+e[0])/360,r=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e[1]*Math.PI/360)))/360,n=Math.pow(2,t.z);return[Math.round(i*n*bi),Math.round(r*n*bi)]}function Ti(e,t){const i=Math.pow(2,t.z);return[(n=(e[0]/bi+t.x)/i,360*n-180),(r=(e[1]/bi+t.y)/i,360/Math.PI*Math.atan(Math.exp((180-360*r)*Math.PI/180))-90)];var r,n}function Bi(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.max(e[2],t[0]),e[3]=Math.max(e[3],t[1])}function Ci(e,t){return!(e[0]<=t[0]||e[2]>=t[2]||e[1]<=t[1]||e[3]>=t[3])}function Si(e,t,i){const r=e[0]-t[0],n=e[1]-t[1],o=e[0]-i[0],s=e[1]-i[1];return r*s-o*n==0&&r*o<=0&&n*s<=0}function Ei(e,t,i,r){return 0!=(n=[r[0]-i[0],r[1]-i[1]])[0]*(o=[t[0]-e[0],t[1]-e[1]])[1]-n[1]*o[0]&&!(!ki(e,t,i,r)||!ki(i,r,e,t));var n,o}function Mi(e,t,i){for(const r of i)for(let i=0;i<r.length-1;++i)if(Ei(e,t,r[i],r[i+1]))return!0;return!1}function Ii(e,t,i=!1){let r=!1;for(const a of t)for(let t=0;t<a.length-1;t++){if(Si(e,a[t],a[t+1]))return i;(o=a[t])[1]>(n=e)[1]!=(s=a[t+1])[1]>n[1]&&n[0]<(s[0]-o[0])*(n[1]-o[1])/(s[1]-o[1])+o[0]&&(r=!r)}var n,o,s;return r}function Pi(e,t){for(const i of t)if(Ii(e,i))return!0;return!1}function Li(e,t){for(const i of e)if(!Ii(i,t))return!1;for(let i=0;i<e.length-1;++i)if(Mi(e[i],e[i+1],t))return!1;return!0}function Fi(e,t){for(const i of t)if(Li(e,i))return!0;return!1}function ki(e,t,i,r){const n=r[0]-i[0],o=r[1]-i[1],s=(e[0]-i[0])*o-n*(e[1]-i[1]),a=(t[0]-i[0])*o-n*(t[1]-i[1]);return s>0&&a<0||s<0&&a>0}function zi(e,t,i){const r=[];for(let n=0;n<e.length;n++){const o=[];for(let r=0;r<e[n].length;r++){const s=wi(e[n][r],i);Bi(t,s),o.push(s)}r.push(o)}return r}function Ri(e,t,i){const r=[];for(let n=0;n<e.length;n++){const o=zi(e[n],t,i);r.push(o)}return r}function Di(e,t,i,r){if(e[0]<i[0]||e[0]>i[2]){const t=.5*r;let n=e[0]-i[0]>t?-r:i[0]-e[0]>t?r:0;0===n&&(n=e[0]-i[2]>t?-r:i[2]-e[0]>t?r:0),e[0]+=n}Bi(t,e)}function Oi(e,t,i,r){const n=Math.pow(2,r.z)*bi,o=[r.x*bi,r.y*bi],s=[];for(const r of e)for(const e of r){const r=[e.x+o[0],e.y+o[1]];Di(r,t,i,n),s.push(r)}return s}function Ui(e,t,i,r){const n=Math.pow(2,r.z)*bi,o=[r.x*bi,r.y*bi],s=[];for(const i of e){const e=[];for(const r of i){const i=[r.x+o[0],r.y+o[1]];Bi(t,i),e.push(i)}s.push(e)}if(t[2]-t[0]<=n/2){(a=t)[0]=a[1]=1/0,a[2]=a[3]=-1/0;for(const e of s)for(const r of e)Di(r,t,i,n)}var a;return s}class Ni{constructor(e,t){this.type=ze,this.geojson=e,this.geometries=t}static parse(e,t){if(2!==e.length)return t.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Lt(e[1])){const t=e[1];if("FeatureCollection"===t.type){const e=[];for(const i of t.features){const{type:t,coordinates:r}=i.geometry;"Polygon"===t&&e.push(r),"MultiPolygon"===t&&e.push(...r)}if(e.length)return new Ni(t,{type:"MultiPolygon",coordinates:e})}else if("Feature"===t.type){const e=t.geometry.type;if("Polygon"===e||"MultiPolygon"===e)return new Ni(t,t.geometry)}else if("Polygon"===t.type||"MultiPolygon"===t.type)return new Ni(t,t)}return t.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(null!=e.geometry()&&null!=e.canonicalID()){if("Point"===e.geometryType())return function(e,t){const i=[1/0,1/0,-1/0,-1/0],r=[1/0,1/0,-1/0,-1/0],n=e.canonicalID();if("Polygon"===t.type){const o=zi(t.coordinates,r,n),s=Oi(e.geometry(),i,r,n);if(!Ci(i,r))return!1;for(const e of s)if(!Ii(e,o))return!1}if("MultiPolygon"===t.type){const o=Ri(t.coordinates,r,n),s=Oi(e.geometry(),i,r,n);if(!Ci(i,r))return!1;for(const e of s)if(!Pi(e,o))return!1}return!0}(e,this.geometries);if("LineString"===e.geometryType())return function(e,t){const i=[1/0,1/0,-1/0,-1/0],r=[1/0,1/0,-1/0,-1/0],n=e.canonicalID();if("Polygon"===t.type){const o=zi(t.coordinates,r,n),s=Ui(e.geometry(),i,r,n);if(!Ci(i,r))return!1;for(const e of s)if(!Li(e,o))return!1}if("MultiPolygon"===t.type){const o=Ri(t.coordinates,r,n),s=Ui(e.geometry(),i,r,n);if(!Ci(i,r))return!1;for(const e of s)if(!Fi(e,o))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let Qi=class{constructor(e=[],t=(e,t)=>e<t?-1:e>t?1:0){if(this.data=e,this.length=this.data.length,this.compare=t,this.length>0)for(let e=(this.length>>1)-1;e>=0;e--)this._down(e)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(0===this.length)return;const e=this.data[0],t=this.data.pop();return--this.length>0&&(this.data[0]=t,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:t,compare:i}=this,r=t[e];for(;e>0;){const n=e-1>>1,o=t[n];if(i(r,o)>=0)break;t[e]=o,e=n}t[e]=r}_down(e){const{data:t,compare:i}=this,r=this.length>>1,n=t[e];for(;e<r;){let r=1+(e<<1);const o=r+1;if(o<this.length&&i(t[o],t[r])<0&&(r=o),i(t[r],n)>=0)break;t[e]=t[r],e=r}t[e]=n}};function ji(e,t,i=0,r=e.length-1,n=Hi){for(;r>i;){if(r-i>600){const o=r-i+1,s=t-i+1,a=Math.log(o),l=.5*Math.exp(2*a/3),c=.5*Math.sqrt(a*l*(o-l)/o)*(s-o/2<0?-1:1);ji(e,t,Math.max(i,Math.floor(t-s*l/o+c)),Math.min(r,Math.floor(t+(o-s)*l/o+c)),n)}const o=e[t];let s=i,a=r;for(Vi(e,i,t),n(e[r],o)>0&&Vi(e,i,r);s<a;){for(Vi(e,s,a),s++,a--;n(e[s],o)<0;)s++;for(;n(e[a],o)>0;)a--}0===n(e[i],o)?Vi(e,i,a):(a++,Vi(e,a,r)),a<=t&&(i=a+1),t<=a&&(r=a-1)}}function Vi(e,t,i){const r=e[t];e[t]=e[i],e[i]=r}function Hi(e,t){return e<t?-1:e>t?1:0}function Gi(e,t){if(e.length<=1)return[e];const i=[];let r,n;for(const t of e){const e=Zi(t);0!==e&&(t.area=Math.abs(e),void 0===n&&(n=e<0),n===e<0?(r&&i.push(r),r=[t]):r.push(t))}if(r&&i.push(r),t>1)for(let e=0;e<i.length;e++)i[e].length<=t||(ji(i[e],t,1,i[e].length-1,$i),i[e]=i[e].slice(0,t));return i}function $i(e,t){return t.area-e.area}function Zi(e){let t=0;for(let i,r,n=0,o=e.length,s=o-1;n<o;s=n++)i=e[n],r=e[s],t+=(r.x-i.x)*(i.y+r.y);return t}const qi=1/298.257223563,Ki=qi*(2-qi),Wi=Math.PI/180;class Xi{constructor(e){const t=6378.137*Wi*1e3,i=Math.cos(e*Wi),r=1/(1-Ki*(1-i*i)),n=Math.sqrt(r);this.kx=t*n*i,this.ky=t*n*r*(1-Ki)}distance(e,t){const i=this.wrap(e[0]-t[0])*this.kx,r=(e[1]-t[1])*this.ky;return Math.sqrt(i*i+r*r)}pointOnLine(e,t){let i,r,n,o,s=1/0;for(let a=0;a<e.length-1;a++){let l=e[a][0],c=e[a][1],u=this.wrap(e[a+1][0]-l)*this.kx,h=(e[a+1][1]-c)*this.ky,d=0;0===u&&0===h||(d=(this.wrap(t[0]-l)*this.kx*u+(t[1]-c)*this.ky*h)/(u*u+h*h),d>1?(l=e[a+1][0],c=e[a+1][1]):d>0&&(l+=u/this.kx*d,c+=h/this.ky*d)),u=this.wrap(t[0]-l)*this.kx,h=(t[1]-c)*this.ky;const p=u*u+h*h;p<s&&(s=p,i=l,r=c,n=a,o=d)}return{point:[i,r],index:n,t:Math.max(0,Math.min(1,o))}}wrap(e){for(;e<-180;)e+=360;for(;e>180;)e-=360;return e}}function Yi(e,t){return t[0]-e[0]}function Ji(e){return e[1]-e[0]+1}function er(e,t){return e[1]>=e[0]&&e[1]<t}function tr(e,t){if(e[0]>e[1])return[null,null];const i=Ji(e);if(t){if(2===i)return[e,null];const t=Math.floor(i/2);return[[e[0],e[0]+t],[e[0]+t,e[1]]]}if(1===i)return[e,null];const r=Math.floor(i/2)-1;return[[e[0],e[0]+r],[e[0]+r+1,e[1]]]}function ir(e,t){if(!er(t,e.length))return[1/0,1/0,-1/0,-1/0];const i=[1/0,1/0,-1/0,-1/0];for(let r=t[0];r<=t[1];++r)Bi(i,e[r]);return i}function rr(e){const t=[1/0,1/0,-1/0,-1/0];for(const i of e)for(const e of i)Bi(t,e);return t}function nr(e){return e[0]!==-1/0&&e[1]!==-1/0&&e[2]!==1/0&&e[3]!==1/0}function or(e,t,i){if(!nr(e)||!nr(t))return NaN;let r=0,n=0;return e[2]<t[0]&&(r=t[0]-e[2]),e[0]>t[2]&&(r=e[0]-t[2]),e[1]>t[3]&&(n=e[1]-t[3]),e[3]<t[1]&&(n=t[1]-e[3]),i.distance([0,0],[r,n])}function sr(e,t,i){const r=i.pointOnLine(t,e);return i.distance(e,r.point)}function ar(e,t,i,r,n){const o=Math.min(sr(e,[i,r],n),sr(t,[i,r],n)),s=Math.min(sr(i,[e,t],n),sr(r,[e,t],n));return Math.min(o,s)}function lr(e,t,i,r,n){if(!er(t,e.length)||!er(r,i.length))return 1/0;let o=1/0;for(let s=t[0];s<t[1];++s){const t=e[s],a=e[s+1];for(let e=r[0];e<r[1];++e){const r=i[e],s=i[e+1];if(Ei(t,a,r,s))return 0;o=Math.min(o,ar(t,a,r,s,n))}}return o}function cr(e,t,i,r,n){if(!er(t,e.length)||!er(r,i.length))return NaN;let o=1/0;for(let s=t[0];s<=t[1];++s)for(let t=r[0];t<=r[1];++t)if(o=Math.min(o,n.distance(e[s],i[t])),0===o)return o;return o}function ur(e,t,i){if(Ii(e,t,!0))return 0;let r=1/0;for(const n of t){const t=n[0],o=n[n.length-1];if(t!==o&&(r=Math.min(r,sr(e,[o,t],i)),0===r))return r;const s=i.pointOnLine(n,e);if(r=Math.min(r,i.distance(e,s.point)),0===r)return r}return r}function hr(e,t,i,r){if(!er(t,e.length))return NaN;for(let r=t[0];r<=t[1];++r)if(Ii(e[r],i,!0))return 0;let n=1/0;for(let o=t[0];o<t[1];++o){const t=e[o],s=e[o+1];for(const e of i)for(let i=0,o=e.length,a=o-1;i<o;a=i++){const o=e[a],l=e[i];if(Ei(t,s,o,l))return 0;n=Math.min(n,ar(t,s,o,l,r))}}return n}function dr(e,t){for(const i of e)for(const e of i)if(Ii(e,t,!0))return!0;return!1}function pr(e,t,i,r=1/0){const n=rr(e),o=rr(t);if(r!==1/0&&or(n,o,i)>=r)return r;if(Ci(n,o)){if(dr(e,t))return 0}else if(dr(t,e))return 0;let s=1/0;for(const r of e)for(let e=0,n=r.length,o=n-1;e<n;o=e++){const n=r[o],a=r[e];for(const e of t)for(let t=0,r=e.length,o=r-1;t<r;o=t++){const r=e[o],l=e[t];if(Ei(n,a,r,l))return 0;s=Math.min(s,ar(n,a,r,l,i))}}return s}function fr(e,t,i,r,n,o){if(!o)return;const s=or(ir(r,o),n,i);s<t&&e.push([s,o,[0,0]])}function Ar(e,t,i,r,n,o,s){if(!o||!s)return;const a=or(ir(r,o),ir(n,s),i);a<t&&e.push([a,o,s])}function mr(e,t,i,r,n=1/0){let o=Math.min(r.distance(e[0],i[0][0]),n);if(0===o)return o;const s=new Qi([[0,[0,e.length-1],[0,0]]],Yi),a=rr(i);for(;s.length>0;){const n=s.pop();if(n[0]>=o)continue;const l=n[1],c=t?50:100;if(Ji(l)<=c){if(!er(l,e.length))return NaN;if(t){const t=hr(e,l,i,r);if(isNaN(t)||0===t)return t;o=Math.min(o,t)}else for(let t=l[0];t<=l[1];++t){const n=ur(e[t],i,r);if(o=Math.min(o,n),0===o)return 0}}else{const i=tr(l,t);fr(s,o,r,e,a,i[0]),fr(s,o,r,e,a,i[1])}}return o}function gr(e,t,i,r,n,o=1/0){let s=Math.min(o,n.distance(e[0],i[0]));if(0===s)return s;const a=new Qi([[0,[0,e.length-1],[0,i.length-1]]],Yi);for(;a.length>0;){const o=a.pop();if(o[0]>=s)continue;const l=o[1],c=o[2],u=t?50:100,h=r?50:100;if(Ji(l)<=u&&Ji(c)<=h){if(!er(l,e.length)&&er(c,i.length))return NaN;let o;if(t&&r)o=lr(e,l,i,c,n),s=Math.min(s,o);else if(t&&!r){const t=e.slice(l[0],l[1]+1);for(let e=c[0];e<=c[1];++e)if(o=sr(i[e],t,n),s=Math.min(s,o),0===s)return s}else if(!t&&r){const t=i.slice(c[0],c[1]+1);for(let i=l[0];i<=l[1];++i)if(o=sr(e[i],t,n),s=Math.min(s,o),0===s)return s}else o=cr(e,l,i,c,n),s=Math.min(s,o)}else{const o=tr(l,t),u=tr(c,r);Ar(a,s,n,e,i,o[0],u[0]),Ar(a,s,n,e,i,o[0],u[1]),Ar(a,s,n,e,i,o[1],u[0]),Ar(a,s,n,e,i,o[1],u[1])}}return s}function _r(e){return"MultiPolygon"===e.type?e.coordinates.map((e=>({type:"Polygon",coordinates:e}))):"MultiLineString"===e.type?e.coordinates.map((e=>({type:"LineString",coordinates:e}))):"MultiPoint"===e.type?e.coordinates.map((e=>({type:"Point",coordinates:e}))):[e]}class yr{constructor(e,t){this.type=Fe,this.geojson=e,this.geometries=t}static parse(e,t){if(2!==e.length)return t.error(`'distance' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Lt(e[1])){const t=e[1];if("FeatureCollection"===t.type)return new yr(t,t.features.map((e=>_r(e.geometry))).flat());if("Feature"===t.type)return new yr(t,_r(t.geometry));if("type"in t&&"coordinates"in t)return new yr(t,_r(t))}return t.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(null!=e.geometry()&&null!=e.canonicalID()){if("Point"===e.geometryType())return function(e,t){const i=e.geometry(),r=i.flat().map((t=>Ti([t.x,t.y],e.canonical)));if(0===i.length)return NaN;const n=new Xi(r[0][1]);let o=1/0;for(const e of t){switch(e.type){case"Point":o=Math.min(o,gr(r,!1,[e.coordinates],!1,n,o));break;case"LineString":o=Math.min(o,gr(r,!1,e.coordinates,!0,n,o));break;case"Polygon":o=Math.min(o,mr(r,!1,e.coordinates,n,o))}if(0===o)return o}return o}(e,this.geometries);if("LineString"===e.geometryType())return function(e,t){const i=e.geometry(),r=i.flat().map((t=>Ti([t.x,t.y],e.canonical)));if(0===i.length)return NaN;const n=new Xi(r[0][1]);let o=1/0;for(const e of t){switch(e.type){case"Point":o=Math.min(o,gr(r,!0,[e.coordinates],!1,n,o));break;case"LineString":o=Math.min(o,gr(r,!0,e.coordinates,!0,n,o));break;case"Polygon":o=Math.min(o,mr(r,!0,e.coordinates,n,o))}if(0===o)return o}return o}(e,this.geometries);if("Polygon"===e.geometryType())return function(e,t){const i=e.geometry();if(0===i.length||0===i[0].length)return NaN;const r=Gi(i,0).map((t=>t.map((t=>t.map((t=>Ti([t.x,t.y],e.canonical))))))),n=new Xi(r[0][0][0][1]);let o=1/0;for(const e of t)for(const t of r){switch(e.type){case"Point":o=Math.min(o,mr([e.coordinates],!1,t,n,o));break;case"LineString":o=Math.min(o,mr(e.coordinates,!0,t,n,o));break;case"Polygon":o=Math.min(o,pr(t,e.coordinates,n,o))}if(0===o)return o}return o}(e,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}const vr={"==":hi,"!=":di,">":fi,"<":pi,">=":mi,"<=":Ai,array:Dt,at:Gt,boolean:Dt,case:Kt,coalesce:ai,collator:gi,format:yi,image:vi,in:$t,"index-of":Zt,interpolate:ni,"interpolate-hcl":ni,"interpolate-lab":ni,length:xi,let:Vt,literal:zt,match:qt,number:Dt,"number-format":_i,object:Dt,slice:Wt,step:Yt,string:Dt,"to-boolean":Ut,"to-color":Ut,"to-number":Ut,"to-string":Ut,var:Ht,within:Ni,distance:yr};class xr{constructor(e,t,i,r){this.name=e,this.type=t,this._evaluate=i,this.args=r}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}static parse(e,t){const i=e[0],r=xr.definitions[i];if(!r)return t.error(`Unknown expression "${i}". If you wanted a literal array, use ["literal", [...]].`,0);const n=Array.isArray(r)?r[0]:r.type,o=Array.isArray(r)?[[r[1],r[2]]]:r.overloads,s=o.filter((([t])=>!Array.isArray(t)||t.length===e.length-1));let a=null;for(const[r,o]of s){a=new jt(t.registry,Cr,t.path,null,t.scope);const s=[];let l=!1;for(let t=1;t<e.length;t++){const i=e[t],n=Array.isArray(r)?r[t-1]:r.type,o=a.parse(i,1+s.length,n);if(!o){l=!0;break}s.push(o)}if(!l)if(Array.isArray(r)&&r.length!==s.length)a.error(`Expected ${r.length} arguments, but found ${s.length} instead.`);else{for(let e=0;e<s.length;e++){const t=Array.isArray(r)?r[e]:r.type,i=s[e];a.concat(e+1).checkSubtype(t,i.type)}if(0===a.errors.length)return new xr(i,n,o,s)}}if(1===s.length)t.errors.push(...a.errors);else{const i=(s.length?s:o).map((([e])=>{return t=e,Array.isArray(t)?`(${t.map($e).join(", ")})`:`(${$e(t.type)}...)`;var t})).join(" | "),r=[];for(let i=1;i<e.length;i++){const n=t.parse(e[i],1+r.length);if(!n)return null;r.push($e(n.type))}t.error(`Expected arguments of type ${i}, but found (${r.join(", ")}) instead.`)}return null}static register(e,t){xr.definitions=t;for(const i in t)e[i]=xr}}function br(e,[t,i,r,n]){t=t.evaluate(e),i=i.evaluate(e),r=r.evaluate(e);const o=n?n.evaluate(e):1,s=Pt(t,i,r,o);if(s)throw new Ct(s);return new vt(t/255,i/255,r/255,o,!1)}function wr(e,t){return e in t}function Tr(e,t){const i=t[e];return void 0===i?null:i}function Br(e){return{type:e}}function Cr(e){if(e instanceof Ht)return Cr(e.boundExpression);if(e instanceof xr&&"error"===e.name)return!1;if(e instanceof gi)return!1;if(e instanceof Ni)return!1;if(e instanceof yr)return!1;const t=e instanceof Ut||e instanceof Dt;let i=!0;return e.eachChild((e=>{i=t?i&&Cr(e):i&&e instanceof zt})),!!i&&Sr(e)&&Mr(e,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Sr(e){if(e instanceof xr){if("get"===e.name&&1===e.args.length)return!1;if("feature-state"===e.name)return!1;if("has"===e.name&&1===e.args.length)return!1;if("properties"===e.name||"geometry-type"===e.name||"id"===e.name)return!1;if(/^filter-/.test(e.name))return!1}if(e instanceof Ni)return!1;if(e instanceof yr)return!1;let t=!0;return e.eachChild((e=>{t&&!Sr(e)&&(t=!1)})),t}function Er(e){if(e instanceof xr&&"feature-state"===e.name)return!1;let t=!0;return e.eachChild((e=>{t&&!Er(e)&&(t=!1)})),t}function Mr(e,t){if(e instanceof xr&&t.indexOf(e.name)>=0)return!1;let i=!0;return e.eachChild((e=>{i&&!Mr(e,t)&&(i=!1)})),i}function Ir(e){return{result:"success",value:e}}function Pr(e){return{result:"error",value:e}}function Lr(e){return"data-driven"===e["property-type"]||"cross-faded-data-driven"===e["property-type"]}function Fr(e){return!!e.expression&&e.expression.parameters.indexOf("zoom")>-1}function kr(e){return!!e.expression&&e.expression.interpolated}function zr(e){return e instanceof Number?"number":e instanceof String?"string":e instanceof Boolean?"boolean":Array.isArray(e)?"array":null===e?"null":typeof e}function Rr(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)}function Dr(e){return e}function Or(e,t){const i="color"===t.type,r=e.stops&&"object"==typeof e.stops[0][0],n=r||!(r||void 0!==e.property),o=e.type||(kr(t)?"exponential":"interval");if(i||"padding"===t.type){const r=i?vt.parse:Bt.parse;(e=Me({},e)).stops&&(e.stops=e.stops.map((e=>[e[0],r(e[1])]))),e.default=r(e.default?e.default:t.default)}if(e.colorSpace&&"rgb"!==(s=e.colorSpace)&&"hcl"!==s&&"lab"!==s)throw new Error(`Unknown color space: "${e.colorSpace}"`);var s;let a,l,c;if("exponential"===o)a=jr;else if("interval"===o)a=Qr;else if("categorical"===o){a=Nr,l=Object.create(null);for(const t of e.stops)l[t[0]]=t[1];c=typeof e.stops[0][0]}else{if("identity"!==o)throw new Error(`Unknown function type "${o}"`);a=Vr}if(r){const i={},r=[];for(let t=0;t<e.stops.length;t++){const n=e.stops[t],o=n[0].zoom;void 0===i[o]&&(i[o]={zoom:o,type:e.type,property:e.property,default:e.default,stops:[]},r.push(o)),i[o].stops.push([n[0].value,n[1]])}const n=[];for(const e of r)n.push([i[e].zoom,Or(i[e],t)]);const o={name:"linear"};return{kind:"composite",interpolationType:o,interpolationFactor:ni.interpolationFactor.bind(void 0,o),zoomStops:n.map((e=>e[0])),evaluate:({zoom:i},r)=>jr({stops:n,base:e.base},t,i).evaluate(i,r)}}if(n){const i="exponential"===o?{name:"exponential",base:void 0!==e.base?e.base:1}:null;return{kind:"camera",interpolationType:i,interpolationFactor:ni.interpolationFactor.bind(void 0,i),zoomStops:e.stops.map((e=>e[0])),evaluate:({zoom:i})=>a(e,t,i,l,c)}}return{kind:"source",evaluate(i,r){const n=r&&r.properties?r.properties[e.property]:void 0;return void 0===n?Ur(e.default,t.default):a(e,t,n,l,c)}}}function Ur(e,t,i){return void 0!==e?e:void 0!==t?t:void 0!==i?i:void 0}function Nr(e,t,i,r,n){return Ur(typeof i===n?r[i]:void 0,e.default,t.default)}function Qr(e,t,i){if("number"!==zr(i))return Ur(e.default,t.default);const r=e.stops.length;if(1===r)return e.stops[0][1];if(i<=e.stops[0][0])return e.stops[0][1];if(i>=e.stops[r-1][0])return e.stops[r-1][1];const n=Xt(e.stops.map((e=>e[0])),i);return e.stops[n][1]}function jr(e,t,i){const r=void 0!==e.base?e.base:1;if("number"!==zr(i))return Ur(e.default,t.default);const n=e.stops.length;if(1===n)return e.stops[0][1];if(i<=e.stops[0][0])return e.stops[0][1];if(i>=e.stops[n-1][0])return e.stops[n-1][1];const o=Xt(e.stops.map((e=>e[0])),i),s=function(e,t,i,r){const n=r-i,o=e-i;return 0===n?0:1===t?o/n:(Math.pow(t,o)-1)/(Math.pow(t,n)-1)}(i,r,e.stops[o][0],e.stops[o+1][0]),a=e.stops[o][1],l=e.stops[o+1][1],c=si[t.type]||Dr;return"function"==typeof a.evaluate?{evaluate(...t){const i=a.evaluate.apply(void 0,t),r=l.evaluate.apply(void 0,t);if(void 0!==i&&void 0!==r)return c(i,r,s,e.colorSpace)}}:c(a,l,s,e.colorSpace)}function Vr(e,t,i){switch(t.type){case"color":i=vt.parse(i);break;case"formatted":i=Tt.fromString(i.toString());break;case"resolvedImage":i=Mt.fromString(i.toString());break;case"padding":i=Bt.parse(i);break;default:zr(i)===t.type||"enum"===t.type&&t.values[i]||(i=void 0)}return Ur(i,e.default,t.default)}xr.register(vr,{error:[{kind:"error"},[ke],(e,[t])=>{throw new Ct(t.evaluate(e))}],typeof:[ke,[Ue],(e,[t])=>$e(Ft(t.evaluate(e)))],"to-rgba":[Ge(Fe,4),[Re],(e,[t])=>{const[i,r,n,o]=t.evaluate(e).rgb;return[255*i,255*r,255*n,o]}],rgb:[Re,[Fe,Fe,Fe],br],rgba:[Re,[Fe,Fe,Fe,Fe],br],has:{type:ze,overloads:[[[ke],(e,[t])=>wr(t.evaluate(e),e.properties())],[[ke,Oe],(e,[t,i])=>wr(t.evaluate(e),i.evaluate(e))]]},get:{type:Ue,overloads:[[[ke],(e,[t])=>Tr(t.evaluate(e),e.properties())],[[ke,Oe],(e,[t,i])=>Tr(t.evaluate(e),i.evaluate(e))]]},"feature-state":[Ue,[ke],(e,[t])=>Tr(t.evaluate(e),e.featureState||{})],properties:[Oe,[],e=>e.properties()],"geometry-type":[ke,[],e=>e.geometryType()],id:[Ue,[],e=>e.id()],zoom:[Fe,[],e=>e.globals.zoom],"heatmap-density":[Fe,[],e=>e.globals.heatmapDensity||0],"line-progress":[Fe,[],e=>e.globals.lineProgress||0],accumulated:[Ue,[],e=>void 0===e.globals.accumulated?null:e.globals.accumulated],"+":[Fe,Br(Fe),(e,t)=>{let i=0;for(const r of t)i+=r.evaluate(e);return i}],"*":[Fe,Br(Fe),(e,t)=>{let i=1;for(const r of t)i*=r.evaluate(e);return i}],"-":{type:Fe,overloads:[[[Fe,Fe],(e,[t,i])=>t.evaluate(e)-i.evaluate(e)],[[Fe],(e,[t])=>-t.evaluate(e)]]},"/":[Fe,[Fe,Fe],(e,[t,i])=>t.evaluate(e)/i.evaluate(e)],"%":[Fe,[Fe,Fe],(e,[t,i])=>t.evaluate(e)%i.evaluate(e)],ln2:[Fe,[],()=>Math.LN2],pi:[Fe,[],()=>Math.PI],e:[Fe,[],()=>Math.E],"^":[Fe,[Fe,Fe],(e,[t,i])=>Math.pow(t.evaluate(e),i.evaluate(e))],sqrt:[Fe,[Fe],(e,[t])=>Math.sqrt(t.evaluate(e))],log10:[Fe,[Fe],(e,[t])=>Math.log(t.evaluate(e))/Math.LN10],ln:[Fe,[Fe],(e,[t])=>Math.log(t.evaluate(e))],log2:[Fe,[Fe],(e,[t])=>Math.log(t.evaluate(e))/Math.LN2],sin:[Fe,[Fe],(e,[t])=>Math.sin(t.evaluate(e))],cos:[Fe,[Fe],(e,[t])=>Math.cos(t.evaluate(e))],tan:[Fe,[Fe],(e,[t])=>Math.tan(t.evaluate(e))],asin:[Fe,[Fe],(e,[t])=>Math.asin(t.evaluate(e))],acos:[Fe,[Fe],(e,[t])=>Math.acos(t.evaluate(e))],atan:[Fe,[Fe],(e,[t])=>Math.atan(t.evaluate(e))],min:[Fe,Br(Fe),(e,t)=>Math.min(...t.map((t=>t.evaluate(e))))],max:[Fe,Br(Fe),(e,t)=>Math.max(...t.map((t=>t.evaluate(e))))],abs:[Fe,[Fe],(e,[t])=>Math.abs(t.evaluate(e))],round:[Fe,[Fe],(e,[t])=>{const i=t.evaluate(e);return i<0?-Math.round(-i):Math.round(i)}],floor:[Fe,[Fe],(e,[t])=>Math.floor(t.evaluate(e))],ceil:[Fe,[Fe],(e,[t])=>Math.ceil(t.evaluate(e))],"filter-==":[ze,[ke,Ue],(e,[t,i])=>e.properties()[t.value]===i.value],"filter-id-==":[ze,[Ue],(e,[t])=>e.id()===t.value],"filter-type-==":[ze,[ke],(e,[t])=>e.geometryType()===t.value],"filter-<":[ze,[ke,Ue],(e,[t,i])=>{const r=e.properties()[t.value],n=i.value;return typeof r==typeof n&&r<n}],"filter-id-<":[ze,[Ue],(e,[t])=>{const i=e.id(),r=t.value;return typeof i==typeof r&&i<r}],"filter->":[ze,[ke,Ue],(e,[t,i])=>{const r=e.properties()[t.value],n=i.value;return typeof r==typeof n&&r>n}],"filter-id->":[ze,[Ue],(e,[t])=>{const i=e.id(),r=t.value;return typeof i==typeof r&&i>r}],"filter-<=":[ze,[ke,Ue],(e,[t,i])=>{const r=e.properties()[t.value],n=i.value;return typeof r==typeof n&&r<=n}],"filter-id-<=":[ze,[Ue],(e,[t])=>{const i=e.id(),r=t.value;return typeof i==typeof r&&i<=r}],"filter->=":[ze,[ke,Ue],(e,[t,i])=>{const r=e.properties()[t.value],n=i.value;return typeof r==typeof n&&r>=n}],"filter-id->=":[ze,[Ue],(e,[t])=>{const i=e.id(),r=t.value;return typeof i==typeof r&&i>=r}],"filter-has":[ze,[Ue],(e,[t])=>t.value in e.properties()],"filter-has-id":[ze,[],e=>null!==e.id()&&void 0!==e.id()],"filter-type-in":[ze,[Ge(ke)],(e,[t])=>t.value.indexOf(e.geometryType())>=0],"filter-id-in":[ze,[Ge(Ue)],(e,[t])=>t.value.indexOf(e.id())>=0],"filter-in-small":[ze,[ke,Ge(Ue)],(e,[t,i])=>i.value.indexOf(e.properties()[t.value])>=0],"filter-in-large":[ze,[ke,Ge(Ue)],(e,[t,i])=>function(e,t,i,r){for(;i<=r;){const n=i+r>>1;if(t[n]===e)return!0;t[n]>e?r=n-1:i=n+1}return!1}(e.properties()[t.value],i.value,0,i.value.length-1)],all:{type:ze,overloads:[[[ze,ze],(e,[t,i])=>t.evaluate(e)&&i.evaluate(e)],[Br(ze),(e,t)=>{for(const i of t)if(!i.evaluate(e))return!1;return!0}]]},any:{type:ze,overloads:[[[ze,ze],(e,[t,i])=>t.evaluate(e)||i.evaluate(e)],[Br(ze),(e,t)=>{for(const i of t)if(i.evaluate(e))return!0;return!1}]]},"!":[ze,[ze],(e,[t])=>!t.evaluate(e)],"is-supported-script":[ze,[ke],(e,[t])=>{const i=e.globals&&e.globals.isSupportedScript;return!i||i(t.evaluate(e))}],upcase:[ke,[ke],(e,[t])=>t.evaluate(e).toUpperCase()],downcase:[ke,[ke],(e,[t])=>t.evaluate(e).toLowerCase()],concat:[ke,Br(Ue),(e,t)=>t.map((t=>kt(t.evaluate(e)))).join("")],"resolved-locale":[ke,[Ne],(e,[t])=>t.evaluate(e).resolvedLocale()]});class Hr{constructor(e,t){var i;this.expression=e,this._warningHistory={},this._evaluator=new Qt,this._defaultValue=t?"color"===(i=t).type&&Rr(i.default)?new vt(0,0,0,0):"color"===i.type?vt.parse(i.default)||null:"padding"===i.type?Bt.parse(i.default)||null:"variableAnchorOffsetCollection"===i.type?Et.parse(i.default)||null:"projectionDefinition"===i.type?It.parse(i.default)||null:void 0===i.default?null:i.default:null,this._enumValues=t&&"enum"===t.type?t.values:null}evaluateWithoutErrorHandling(e,t,i,r,n,o){return this._evaluator.globals=e,this._evaluator.feature=t,this._evaluator.featureState=i,this._evaluator.canonical=r,this._evaluator.availableImages=n||null,this._evaluator.formattedSection=o,this.expression.evaluate(this._evaluator)}evaluate(e,t,i,r,n,o){this._evaluator.globals=e,this._evaluator.feature=t||null,this._evaluator.featureState=i||null,this._evaluator.canonical=r,this._evaluator.availableImages=n||null,this._evaluator.formattedSection=o||null;try{const e=this.expression.evaluate(this._evaluator);if(null==e||"number"==typeof e&&e!=e)return this._defaultValue;if(this._enumValues&&!(e in this._enumValues))throw new Ct(`Expected value to be one of ${Object.keys(this._enumValues).map((e=>JSON.stringify(e))).join(", ")}, but found ${JSON.stringify(e)} instead.`);return e}catch(e){return this._warningHistory[e.message]||(this._warningHistory[e.message]=!0,"undefined"!=typeof console&&console.warn(e.message)),this._defaultValue}}}function Gr(e){return Array.isArray(e)&&e.length>0&&"string"==typeof e[0]&&e[0]in vr}function $r(e,t){const i=new jt(vr,Cr,[],t?function(e){const t={color:Re,string:ke,number:Fe,enum:ke,boolean:ze,formatted:Qe,padding:je,projectionDefinition:De,resolvedImage:Ve,variableAnchorOffsetCollection:He};return"array"===e.type?Ge(t[e.value]||Ue,e.length):t[e.type]}(t):void 0),r=i.parse(e,void 0,void 0,void 0,t&&"string"===t.type?{typeAnnotation:"coerce"}:void 0);return r?Ir(new Hr(r,t)):Pr(i.errors)}class Zr{constructor(e,t){this.kind=e,this._styleExpression=t,this.isStateDependent="constant"!==e&&!Er(t.expression)}evaluateWithoutErrorHandling(e,t,i,r,n,o){return this._styleExpression.evaluateWithoutErrorHandling(e,t,i,r,n,o)}evaluate(e,t,i,r,n,o){return this._styleExpression.evaluate(e,t,i,r,n,o)}}class qr{constructor(e,t,i,r){this.kind=e,this.zoomStops=i,this._styleExpression=t,this.isStateDependent="camera"!==e&&!Er(t.expression),this.interpolationType=r}evaluateWithoutErrorHandling(e,t,i,r,n,o){return this._styleExpression.evaluateWithoutErrorHandling(e,t,i,r,n,o)}evaluate(e,t,i,r,n,o){return this._styleExpression.evaluate(e,t,i,r,n,o)}interpolationFactor(e,t,i){return this.interpolationType?ni.interpolationFactor(this.interpolationType,e,t,i):0}}function Kr(e,t){const i=$r(e,t);if("error"===i.result)return i;const r=i.value.expression,n=Sr(r);if(!n&&!Lr(t))return Pr([new Ie("","data expressions not supported")]);const o=Mr(r,["zoom"]);if(!o&&!Fr(t))return Pr([new Ie("","zoom expressions not supported")]);const s=Xr(r);return s||o?s instanceof Ie?Pr([s]):s instanceof ni&&!kr(t)?Pr([new Ie("",'"interpolate" expressions cannot be used with this property')]):Ir(s?new qr(n?"camera":"composite",i.value,s.labels,s instanceof ni?s.interpolation:void 0):new Zr(n?"constant":"source",i.value)):Pr([new Ie("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Wr{constructor(e,t){this._parameters=e,this._specification=t,Me(this,Or(this._parameters,this._specification))}static deserialize(e){return new Wr(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Xr(e){let t=null;if(e instanceof Vt)t=Xr(e.result);else if(e instanceof ai){for(const i of e.args)if(t=Xr(i),t)break}else(e instanceof Yt||e instanceof ni)&&e.input instanceof xr&&"zoom"===e.input.name&&(t=e);return t instanceof Ie||e.eachChild((e=>{const i=Xr(e);i instanceof Ie?t=i:!t&&i?t=new Ie("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&i&&t!==i&&(t=new Ie("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),t}function Yr(e){if(!0===e||!1===e)return!0;if(!Array.isArray(e)||0===e.length)return!1;switch(e[0]){case"has":return e.length>=2&&"$id"!==e[1]&&"$type"!==e[1];case"in":return e.length>=3&&("string"!=typeof e[1]||Array.isArray(e[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==e.length||Array.isArray(e[1])||Array.isArray(e[2]);case"any":case"all":for(const t of e.slice(1))if(!Yr(t)&&"boolean"!=typeof t)return!1;return!0;default:return!0}}const Jr={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function en(e){if(null==e)return{filter:()=>!0,needGeometry:!1};Yr(e)||(e=nn(e));const t=$r(e,Jr);if("error"===t.result)throw new Error(t.value.map((e=>`${e.key}: ${e.message}`)).join(", "));return{filter:(e,i,r)=>t.value.evaluate(e,i,{},r),needGeometry:rn(e)}}function tn(e,t){return e<t?-1:e>t?1:0}function rn(e){if(!Array.isArray(e))return!1;if("within"===e[0]||"distance"===e[0])return!0;for(let t=1;t<e.length;t++)if(rn(e[t]))return!0;return!1}function nn(e){if(!e)return!0;const t=e[0];return e.length<=1?"any"!==t:"=="===t?on(e[1],e[2],"=="):"!="===t?ln(on(e[1],e[2],"==")):"<"===t||">"===t||"<="===t||">="===t?on(e[1],e[2],t):"any"===t?(i=e.slice(1),["any"].concat(i.map(nn))):"all"===t?["all"].concat(e.slice(1).map(nn)):"none"===t?["all"].concat(e.slice(1).map(nn).map(ln)):"in"===t?sn(e[1],e.slice(2)):"!in"===t?ln(sn(e[1],e.slice(2))):"has"===t?an(e[1]):"!has"!==t||ln(an(e[1]));var i}function on(e,t,i){switch(e){case"$type":return[`filter-type-${i}`,t];case"$id":return[`filter-id-${i}`,t];default:return[`filter-${i}`,e,t]}}function sn(e,t){if(0===t.length)return!1;switch(e){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some((e=>typeof e!=typeof t[0]))?["filter-in-large",e,["literal",t.sort(tn)]]:["filter-in-small",e,["literal",t]]}}function an(e){switch(e){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",e]}}function ln(e){return["!",e]}function cn(e){const t=typeof e;if("number"===t||"boolean"===t||"string"===t||null==e)return JSON.stringify(e);if(Array.isArray(e)){let t="[";for(const i of e)t+=`${cn(i)},`;return`${t}]`}const i=Object.keys(e).sort();let r="{";for(let t=0;t<i.length;t++)r+=`${JSON.stringify(i[t])}:${cn(e[i[t]])},`;return`${r}}`}function un(e){let t="";for(const i of ge)t+=`/${cn(e[i])}`;return t}function hn(e){const t=e.value;return t?[new Ee(e.key,t,"constants have been deprecated as of v8")]:[]}function dn(e){return e instanceof Number||e instanceof String||e instanceof Boolean?e.valueOf():e}function pn(e){if(Array.isArray(e))return e.map(pn);if(e instanceof Object&&!(e instanceof Number||e instanceof String||e instanceof Boolean)){const t={};for(const i in e)t[i]=pn(e[i]);return t}return dn(e)}function fn(e){const t=e.key,i=e.value,r=e.valueSpec||{},n=e.objectElementValidators||{},o=e.style,s=e.styleSpec,a=e.validateSpec;let l=[];const c=zr(i);if("object"!==c)return[new Ee(t,i,`object expected, ${c} found`)];for(const e in i){const c=e.split(".")[0],u=r[c]||r["*"];let h;if(n[c])h=n[c];else if(r[c])h=a;else if(n["*"])h=n["*"];else{if(!r["*"]){l.push(new Ee(t,i[e],`unknown property "${e}"`));continue}h=a}l=l.concat(h({key:(t?`${t}.`:t)+e,value:i[e],valueSpec:u,style:o,styleSpec:s,object:i,objectKey:e,validateSpec:a},i))}for(const e in r)n[e]||r[e].required&&void 0===r[e].default&&void 0===i[e]&&l.push(new Ee(t,i,`missing required property "${e}"`));return l}function An(e){const t=e.value,i=e.valueSpec,r=e.style,n=e.styleSpec,o=e.key,s=e.arrayElementValidator||e.validateSpec;if("array"!==zr(t))return[new Ee(o,t,`array expected, ${zr(t)} found`)];if(i.length&&t.length!==i.length)return[new Ee(o,t,`array length ${i.length} expected, length ${t.length} found`)];if(i["min-length"]&&t.length<i["min-length"])return[new Ee(o,t,`array length at least ${i["min-length"]} expected, length ${t.length} found`)];let a={type:i.value,values:i.values};n.$version<7&&(a.function=i.function),"object"===zr(i.value)&&(a=i.value);let l=[];for(let i=0;i<t.length;i++)l=l.concat(s({array:t,arrayIndex:i,value:t[i],valueSpec:a,validateSpec:e.validateSpec,style:r,styleSpec:n,key:`${o}[${i}]`}));return l}function mn(e){const t=e.key,i=e.value,r=e.valueSpec;let n=zr(i);return"number"===n&&i!=i&&(n="NaN"),"number"!==n?[new Ee(t,i,`number expected, ${n} found`)]:"minimum"in r&&i<r.minimum?[new Ee(t,i,`${i} is less than the minimum value ${r.minimum}`)]:"maximum"in r&&i>r.maximum?[new Ee(t,i,`${i} is greater than the maximum value ${r.maximum}`)]:[]}function gn(e){const t=e.valueSpec,i=dn(e.value.type);let r,n,o,s={};const a="categorical"!==i&&void 0===e.value.property,l=!a,c="array"===zr(e.value.stops)&&"array"===zr(e.value.stops[0])&&"object"===zr(e.value.stops[0][0]),u=fn({key:e.key,value:e.value,valueSpec:e.styleSpec.function,validateSpec:e.validateSpec,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{stops:function(e){if("identity"===i)return[new Ee(e.key,e.value,'identity function may not have a "stops" property')];let t=[];const r=e.value;return t=t.concat(An({key:e.key,value:r,valueSpec:e.valueSpec,validateSpec:e.validateSpec,style:e.style,styleSpec:e.styleSpec,arrayElementValidator:h})),"array"===zr(r)&&0===r.length&&t.push(new Ee(e.key,r,"array must have at least one stop")),t},default:function(e){return e.validateSpec({key:e.key,value:e.value,valueSpec:t,validateSpec:e.validateSpec,style:e.style,styleSpec:e.styleSpec})}}});return"identity"===i&&a&&u.push(new Ee(e.key,e.value,'missing required property "property"')),"identity"===i||e.value.stops||u.push(new Ee(e.key,e.value,'missing required property "stops"')),"exponential"===i&&e.valueSpec.expression&&!kr(e.valueSpec)&&u.push(new Ee(e.key,e.value,"exponential functions not supported")),e.styleSpec.$version>=8&&(l&&!Lr(e.valueSpec)?u.push(new Ee(e.key,e.value,"property functions not supported")):a&&!Fr(e.valueSpec)&&u.push(new Ee(e.key,e.value,"zoom functions not supported"))),"categorical"!==i&&!c||void 0!==e.value.property||u.push(new Ee(e.key,e.value,'"property" property is required')),u;function h(e){let i=[];const r=e.value,a=e.key;if("array"!==zr(r))return[new Ee(a,r,`array expected, ${zr(r)} found`)];if(2!==r.length)return[new Ee(a,r,`array length 2 expected, length ${r.length} found`)];if(c){if("object"!==zr(r[0]))return[new Ee(a,r,`object expected, ${zr(r[0])} found`)];if(void 0===r[0].zoom)return[new Ee(a,r,"object stop key must have zoom")];if(void 0===r[0].value)return[new Ee(a,r,"object stop key must have value")];if(o&&o>dn(r[0].zoom))return[new Ee(a,r[0].zoom,"stop zoom values must appear in ascending order")];dn(r[0].zoom)!==o&&(o=dn(r[0].zoom),n=void 0,s={}),i=i.concat(fn({key:`${a}[0]`,value:r[0],valueSpec:{zoom:{}},validateSpec:e.validateSpec,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{zoom:mn,value:d}}))}else i=i.concat(d({key:`${a}[0]`,value:r[0],validateSpec:e.validateSpec,style:e.style,styleSpec:e.styleSpec},r));return Gr(pn(r[1]))?i.concat([new Ee(`${a}[1]`,r[1],"expressions are not allowed in function stops.")]):i.concat(e.validateSpec({key:`${a}[1]`,value:r[1],valueSpec:t,validateSpec:e.validateSpec,style:e.style,styleSpec:e.styleSpec}))}function d(e,o){const a=zr(e.value),l=dn(e.value),c=null!==e.value?e.value:o;if(r){if(a!==r)return[new Ee(e.key,c,`${a} stop domain type must match previous stop domain type ${r}`)]}else r=a;if("number"!==a&&"string"!==a&&"boolean"!==a)return[new Ee(e.key,c,"stop domain value must be a number, string, or boolean")];if("number"!==a&&"categorical"!==i){let r=`number expected, ${a} found`;return Lr(t)&&void 0===i&&(r+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Ee(e.key,c,r)]}return"categorical"!==i||"number"!==a||isFinite(l)&&Math.floor(l)===l?"categorical"!==i&&"number"===a&&void 0!==n&&l<n?[new Ee(e.key,c,"stop domain values must appear in ascending order")]:(n=l,"categorical"===i&&l in s?[new Ee(e.key,c,"stop domain values must be unique")]:(s[l]=!0,[])):[new Ee(e.key,c,`integer expected, found ${l}`)]}}function _n(e){const t=("property"===e.expressionContext?Kr:$r)(pn(e.value),e.valueSpec);if("error"===t.result)return t.value.map((t=>new Ee(`${e.key}${t.key}`,e.value,t.message)));const i=t.value.expression||t.value._styleExpression.expression;if("property"===e.expressionContext&&"text-font"===e.propertyKey&&!i.outputDefined())return[new Ee(e.key,e.value,`Invalid data expression for "${e.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===e.expressionContext&&"layout"===e.propertyType&&!Er(i))return[new Ee(e.key,e.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===e.expressionContext&&!Er(i))return[new Ee(e.key,e.value,'"feature-state" data expressions are not supported with filters.')];if(e.expressionContext&&0===e.expressionContext.indexOf("cluster")){if(!Mr(i,["zoom","feature-state"]))return[new Ee(e.key,e.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===e.expressionContext&&!Sr(i))return[new Ee(e.key,e.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function yn(e){const t=e.key,i=e.value,r=e.valueSpec,n=[];return Array.isArray(r.values)?-1===r.values.indexOf(dn(i))&&n.push(new Ee(t,i,`expected one of [${r.values.join(", ")}], ${JSON.stringify(i)} found`)):-1===Object.keys(r.values).indexOf(dn(i))&&n.push(new Ee(t,i,`expected one of [${Object.keys(r.values).join(", ")}], ${JSON.stringify(i)} found`)),n}function vn(e){return Yr(pn(e.value))?_n(Me({},e,{expressionContext:"filter",valueSpec:{value:"boolean"}})):xn(e)}function xn(e){const t=e.value,i=e.key;if("array"!==zr(t))return[new Ee(i,t,`array expected, ${zr(t)} found`)];const r=e.styleSpec;let n,o=[];if(t.length<1)return[new Ee(i,t,"filter array must have at least 1 element")];switch(o=o.concat(yn({key:`${i}[0]`,value:t[0],valueSpec:r.filter_operator,style:e.style,styleSpec:e.styleSpec})),dn(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&"$type"===dn(t[1])&&o.push(new Ee(i,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":3!==t.length&&o.push(new Ee(i,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(n=zr(t[1]),"string"!==n&&o.push(new Ee(`${i}[1]`,t[1],`string expected, ${n} found`)));for(let s=2;s<t.length;s++)n=zr(t[s]),"$type"===dn(t[1])?o=o.concat(yn({key:`${i}[${s}]`,value:t[s],valueSpec:r.geometry_type,style:e.style,styleSpec:e.styleSpec})):"string"!==n&&"number"!==n&&"boolean"!==n&&o.push(new Ee(`${i}[${s}]`,t[s],`string, number, or boolean expected, ${n} found`));break;case"any":case"all":case"none":for(let r=1;r<t.length;r++)o=o.concat(xn({key:`${i}[${r}]`,value:t[r],style:e.style,styleSpec:e.styleSpec}));break;case"has":case"!has":n=zr(t[1]),2!==t.length?o.push(new Ee(i,t,`filter array for "${t[0]}" operator must have 2 elements`)):"string"!==n&&o.push(new Ee(`${i}[1]`,t[1],`string expected, ${n} found`))}return o}function bn(e,t){const i=e.key,r=e.validateSpec,n=e.style,o=e.styleSpec,s=e.value,a=e.objectKey,l=o[`${t}_${e.layerType}`];if(!l)return[];const c=a.match(/^(.*)-transition$/);if("paint"===t&&c&&l[c[1]]&&l[c[1]].transition)return r({key:i,value:s,valueSpec:o.transition,style:n,styleSpec:o});const u=e.valueSpec||l[a];if(!u)return[new Ee(i,s,`unknown property "${a}"`)];let h;if("string"===zr(s)&&Lr(u)&&!u.tokens&&(h=/^{([^}]+)}$/.exec(s)))return[new Ee(i,s,`"${a}" does not support interpolation syntax\nUse an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(h[1])} }\`.`)];const d=[];return"symbol"===e.layerType&&("text-field"===a&&n&&!n.glyphs&&d.push(new Ee(i,s,'use of "text-field" requires a style "glyphs" property')),"text-font"===a&&Rr(pn(s))&&"identity"===dn(s.type)&&d.push(new Ee(i,s,'"text-font" does not support identity functions'))),d.concat(r({key:e.key,value:s,valueSpec:u,style:n,styleSpec:o,expressionContext:"property",propertyType:t,propertyKey:a}))}function wn(e){return bn(e,"paint")}function Tn(e){return bn(e,"layout")}function Bn(e){let t=[];const i=e.value,r=e.key,n=e.style,o=e.styleSpec;i.type||i.ref||t.push(new Ee(r,i,'either "type" or "ref" is required'));let s=dn(i.type);const a=dn(i.ref);if(i.id){const o=dn(i.id);for(let s=0;s<e.arrayIndex;s++){const e=n.layers[s];dn(e.id)===o&&t.push(new Ee(r,i.id,`duplicate layer id "${i.id}", previously used at line ${e.id.__line__}`))}}if("ref"in i){let e;["type","source","source-layer","filter","layout"].forEach((e=>{e in i&&t.push(new Ee(r,i[e],`"${e}" is prohibited for ref layers`))})),n.layers.forEach((t=>{dn(t.id)===a&&(e=t)})),e?e.ref?t.push(new Ee(r,i.ref,"ref cannot reference another ref layer")):s=dn(e.type):t.push(new Ee(r,i.ref,`ref layer "${a}" not found`))}else if("background"!==s)if(i.source){const e=n.sources&&n.sources[i.source],o=e&&dn(e.type);e?"vector"===o&&"raster"===s?t.push(new Ee(r,i.source,`layer "${i.id}" requires a raster source`)):"raster-dem"!==o&&"hillshade"===s?t.push(new Ee(r,i.source,`layer "${i.id}" requires a raster-dem source`)):"raster"===o&&"raster"!==s?t.push(new Ee(r,i.source,`layer "${i.id}" requires a vector source`)):"vector"!==o||i["source-layer"]?"raster-dem"===o&&"hillshade"!==s?t.push(new Ee(r,i.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==s||!i.paint||!i.paint["line-gradient"]||"geojson"===o&&e.lineMetrics||t.push(new Ee(r,i,`layer "${i.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new Ee(r,i,`layer "${i.id}" must specify a "source-layer"`)):t.push(new Ee(r,i.source,`source "${i.source}" not found`))}else t.push(new Ee(r,i,'missing required property "source"'));return t=t.concat(fn({key:r,value:i,valueSpec:o.layer,style:e.style,styleSpec:e.styleSpec,validateSpec:e.validateSpec,objectElementValidators:{"*":()=>[],type:()=>e.validateSpec({key:`${r}.type`,value:i.type,valueSpec:o.layer.type,style:e.style,styleSpec:e.styleSpec,validateSpec:e.validateSpec,object:i,objectKey:"type"}),filter:vn,layout:e=>fn({layer:i,key:e.key,value:e.value,style:e.style,styleSpec:e.styleSpec,validateSpec:e.validateSpec,objectElementValidators:{"*":e=>Tn(Me({layerType:s},e))}}),paint:e=>fn({layer:i,key:e.key,value:e.value,style:e.style,styleSpec:e.styleSpec,validateSpec:e.validateSpec,objectElementValidators:{"*":e=>wn(Me({layerType:s},e))}})}})),t}function Cn(e){const t=e.value,i=e.key,r=zr(t);return"string"!==r?[new Ee(i,t,`string expected, ${r} found`)]:[]}const Sn={promoteId:function({key:e,value:t}){if("string"===zr(t))return Cn({key:e,value:t});{const i=[];for(const r in t)i.push(...Cn({key:`${e}.${r}`,value:t[r]}));return i}}};function En(e){const t=e.value,i=e.key,r=e.styleSpec,n=e.style,o=e.validateSpec;if(!t.type)return[new Ee(i,t,'"type" is required')];const s=dn(t.type);let a;switch(s){case"vector":case"raster":return a=fn({key:i,value:t,valueSpec:r[`source_${s.replace("-","_")}`],style:e.style,styleSpec:r,objectElementValidators:Sn,validateSpec:o}),a;case"raster-dem":return a=function(e){var t;const i=null!==(t=e.sourceName)&&void 0!==t?t:"",r=e.value,n=e.styleSpec,o=n.source_raster_dem,s=e.style;let a=[];const l=zr(r);if(void 0===r)return a;if("object"!==l)return a.push(new Ee("source_raster_dem",r,`object expected, ${l} found`)),a;const c="custom"===dn(r.encoding),u=["redFactor","greenFactor","blueFactor","baseShift"],h=e.value.encoding?`"${e.value.encoding}"`:"Default";for(const t in r)!c&&u.includes(t)?a.push(new Ee(t,r[t],`In "${i}": "${t}" is only valid when "encoding" is set to "custom". ${h} encoding found`)):o[t]?a=a.concat(e.validateSpec({key:t,value:r[t],valueSpec:o[t],validateSpec:e.validateSpec,style:s,styleSpec:n})):a.push(new Ee(t,r[t],`unknown property "${t}"`));return a}({sourceName:i,value:t,style:e.style,styleSpec:r,validateSpec:o}),a;case"geojson":if(a=fn({key:i,value:t,valueSpec:r.source_geojson,style:n,styleSpec:r,validateSpec:o,objectElementValidators:Sn}),t.cluster)for(const e in t.clusterProperties){const[r,n]=t.clusterProperties[e],o="string"==typeof r?[r,["accumulated"],["get",e]]:r;a.push(..._n({key:`${i}.${e}.map`,value:n,expressionContext:"cluster-map"})),a.push(..._n({key:`${i}.${e}.reduce`,value:o,expressionContext:"cluster-reduce"}))}return a;case"video":return fn({key:i,value:t,valueSpec:r.source_video,style:n,validateSpec:o,styleSpec:r});case"image":return fn({key:i,value:t,valueSpec:r.source_image,style:n,validateSpec:o,styleSpec:r});case"canvas":return[new Ee(i,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return yn({key:`${i}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function Mn(e){const t=e.value,i=e.styleSpec,r=i.light,n=e.style;let o=[];const s=zr(t);if(void 0===t)return o;if("object"!==s)return o=o.concat([new Ee("light",t,`object expected, ${s} found`)]),o;for(const s in t){const a=s.match(/^(.*)-transition$/);o=o.concat(a&&r[a[1]]&&r[a[1]].transition?e.validateSpec({key:s,value:t[s],valueSpec:i.transition,validateSpec:e.validateSpec,style:n,styleSpec:i}):r[s]?e.validateSpec({key:s,value:t[s],valueSpec:r[s],validateSpec:e.validateSpec,style:n,styleSpec:i}):[new Ee(s,t[s],`unknown property "${s}"`)])}return o}function In(e){const t=e.value,i=e.styleSpec,r=i.sky,n=e.style,o=zr(t);if(void 0===t)return[];if("object"!==o)return[new Ee("sky",t,`object expected, ${o} found`)];let s=[];for(const o in t)s=s.concat(r[o]?e.validateSpec({key:o,value:t[o],valueSpec:r[o],style:n,styleSpec:i}):[new Ee(o,t[o],`unknown property "${o}"`)]);return s}function Pn(e){const t=e.value,i=e.styleSpec,r=i.terrain,n=e.style;let o=[];const s=zr(t);if(void 0===t)return o;if("object"!==s)return o=o.concat([new Ee("terrain",t,`object expected, ${s} found`)]),o;for(const s in t)o=o.concat(r[s]?e.validateSpec({key:s,value:t[s],valueSpec:r[s],validateSpec:e.validateSpec,style:n,styleSpec:i}):[new Ee(s,t[s],`unknown property "${s}"`)]);return o}function Ln(e){let t=[];const i=e.value,r=e.key;if(Array.isArray(i)){const n=[],o=[];for(const s in i)i[s].id&&n.includes(i[s].id)&&t.push(new Ee(r,i,`all the sprites' ids must be unique, but ${i[s].id} is duplicated`)),n.push(i[s].id),i[s].url&&o.includes(i[s].url)&&t.push(new Ee(r,i,`all the sprites' URLs must be unique, but ${i[s].url} is duplicated`)),o.push(i[s].url),t=t.concat(fn({key:`${r}[${s}]`,value:i[s],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:e.validateSpec}));return t}return Cn({key:r,value:i})}const Fn={"*":()=>[],array:An,boolean:function(e){const t=e.value,i=e.key,r=zr(t);return"boolean"!==r?[new Ee(i,t,`boolean expected, ${r} found`)]:[]},number:mn,color:function(e){const t=e.key,i=e.value,r=zr(i);return"string"!==r?[new Ee(t,i,`color expected, ${r} found`)]:vt.parse(String(i))?[]:[new Ee(t,i,`color expected, "${i}" found`)]},constants:hn,enum:yn,filter:vn,function:gn,layer:Bn,object:fn,source:En,light:Mn,sky:In,terrain:Pn,projection:function(e){const t=e.value,i=e.styleSpec,r=i.projection,n=e.style,o=zr(t);if(void 0===t)return[];if("object"!==o)return[new Ee("projection",t,`object expected, ${o} found`)];let s=[];for(const o in t)s=s.concat(r[o]?e.validateSpec({key:o,value:t[o],valueSpec:r[o],style:n,styleSpec:i}):[new Ee(o,t[o],`unknown property "${o}"`)]);return s},projectionDefinition:function(e){const t=e.key;let i=e.value;i=i instanceof String?i.valueOf():i;const r=zr(i);return"array"!==r||function(e){return Array.isArray(e)&&3===e.length&&"string"==typeof e[0]&&"string"==typeof e[1]&&"number"==typeof e[2]}(i)||function(e){return!!["interpolate","step","literal"].includes(e[0])}(i)?["array","string"].includes(r)?[]:[new Ee(t,i,`projection expected, invalid type "${r}" found`)]:[new Ee(t,i,`projection expected, invalid array ${JSON.stringify(i)} found`)]},string:Cn,formatted:function(e){return 0===Cn(e).length?[]:_n(e)},resolvedImage:function(e){return 0===Cn(e).length?[]:_n(e)},padding:function(e){const t=e.key,i=e.value;if("array"===zr(i)){if(i.length<1||i.length>4)return[new Ee(t,i,`padding requires 1 to 4 values; ${i.length} values found`)];const r={type:"number"};let n=[];for(let o=0;o<i.length;o++)n=n.concat(e.validateSpec({key:`${t}[${o}]`,value:i[o],validateSpec:e.validateSpec,valueSpec:r}));return n}return mn({key:t,value:i,valueSpec:{}})},variableAnchorOffsetCollection:function(e){const t=e.key,i=e.value,r=zr(i),n=e.styleSpec;if("array"!==r||i.length<1||i.length%2!=0)return[new Ee(t,i,"variableAnchorOffsetCollection requires a non-empty array of even length")];let o=[];for(let r=0;r<i.length;r+=2)o=o.concat(yn({key:`${t}[${r}]`,value:i[r],valueSpec:n.layout_symbol["text-anchor"]})),o=o.concat(An({key:`${t}[${r+1}]`,value:i[r+1],valueSpec:{length:2,value:"number"},validateSpec:e.validateSpec,style:e.style,styleSpec:n}));return o},sprite:Ln};function kn(e){const t=e.value,i=e.valueSpec,r=e.styleSpec;return e.validateSpec=kn,i.expression&&Rr(dn(t))?gn(e):i.expression&&Gr(pn(t))?_n(e):i.type&&Fn[i.type]?Fn[i.type](e):fn(Me({},e,{valueSpec:i.type?r[i.type]:i}))}function zn(e){const t=e.value,i=e.key,r=Cn(e);return r.length||(-1===t.indexOf("{fontstack}")&&r.push(new Ee(i,t,'"glyphs" url must include a "{fontstack}" token')),-1===t.indexOf("{range}")&&r.push(new Ee(i,t,'"glyphs" url must include a "{range}" token'))),r}function Rn(e,t=me){let i=[];return i=i.concat(kn({key:"",value:e,valueSpec:t.$root,styleSpec:t,style:e,validateSpec:kn,objectElementValidators:{glyphs:zn,"*":()=>[]}})),e.constants&&(i=i.concat(hn({key:"constants",value:e.constants}))),On(i)}function Dn(e){return function(t){return e({...t,validateSpec:kn})}}function On(e){return[].concat(e).sort(((e,t)=>e.line-t.line))}function Un(e){return function(...t){return On(e.apply(this,t))}}Rn.source=Un(Dn(En)),Rn.sprite=Un(Dn(Ln)),Rn.glyphs=Un(Dn(zn)),Rn.light=Un(Dn(Mn)),Rn.sky=Un(Dn(In)),Rn.terrain=Un(Dn(Pn)),Rn.layer=Un(Dn(Bn)),Rn.filter=Un(Dn(vn)),Rn.paintProperty=Un(Dn(wn)),Rn.layoutProperty=Un(Dn(Tn));const Nn=Rn,Qn=Nn.light,jn=Nn.sky,Vn=Nn.paintProperty,Hn=Nn.layoutProperty;function Gn(e,t){let i=!1;if(t&&t.length)for(const r of t)e.fire(new fe(new Error(r.message))),i=!0;return i}class $n{constructor(e,t,i){const r=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;const n=new Int32Array(this.arrayBuffer);e=n[0],this.d=(t=n[1])+2*(i=n[2]);for(let e=0;e<this.d*this.d;e++){const t=n[3+e],i=n[3+e+1];r.push(t===i?null:n.subarray(t,i))}const o=n[3+r.length+1];this.keys=n.subarray(n[3+r.length],o),this.bboxes=n.subarray(o),this.insert=this._insertReadonly}else{this.d=t+2*i;for(let e=0;e<this.d*this.d;e++)r.push([]);this.keys=[],this.bboxes=[]}this.n=t,this.extent=e,this.padding=i,this.scale=t/e,this.uid=0;const n=i/t*e;this.min=-n,this.max=e+n}insert(e,t,i,r,n){this._forEachCell(t,i,r,n,this._insertCell,this.uid++,void 0,void 0),this.keys.push(e),this.bboxes.push(t),this.bboxes.push(i),this.bboxes.push(r),this.bboxes.push(n)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(e,t,i,r,n,o){this.cells[n].push(o)}query(e,t,i,r,n){const o=this.min,s=this.max;if(e<=o&&t<=o&&s<=i&&s<=r&&!n)return Array.prototype.slice.call(this.keys);{const o=[];return this._forEachCell(e,t,i,r,this._queryCell,o,{},n),o}}_queryCell(e,t,i,r,n,o,s,a){const l=this.cells[n];if(null!==l){const n=this.keys,c=this.bboxes;for(let u=0;u<l.length;u++){const h=l[u];if(void 0===s[h]){const l=4*h;(a?a(c[l+0],c[l+1],c[l+2],c[l+3]):e<=c[l+2]&&t<=c[l+3]&&i>=c[l+0]&&r>=c[l+1])?(s[h]=!0,o.push(n[h])):s[h]=!1}}}}_forEachCell(e,t,i,r,n,o,s,a){const l=this._convertToCellCoord(e),c=this._convertToCellCoord(t),u=this._convertToCellCoord(i),h=this._convertToCellCoord(r);for(let d=l;d<=u;d++)for(let l=c;l<=h;l++){const c=this.d*l+d;if((!a||a(this._convertFromCellCoord(d),this._convertFromCellCoord(l),this._convertFromCellCoord(d+1),this._convertFromCellCoord(l+1)))&&n.call(this,e,t,i,r,c,o,s,a))return}}_convertFromCellCoord(e){return(e-this.padding)/this.scale}_convertToCellCoord(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const e=this.cells,t=3+this.cells.length+1+1;let i=0;for(let e=0;e<this.cells.length;e++)i+=this.cells[e].length;const r=new Int32Array(t+i+this.keys.length+this.bboxes.length);r[0]=this.extent,r[1]=this.n,r[2]=this.padding;let n=t;for(let t=0;t<e.length;t++){const i=e[t];r[3+t]=n,r.set(i,n),n+=i.length}return r[3+e.length]=n,r.set(this.keys,n),n+=this.keys.length,r[3+e.length+1]=n,r.set(this.bboxes,n),n+=this.bboxes.length,r.buffer}static serialize(e,t){const i=e.toArrayBuffer();return t&&t.push(i),{buffer:i}}static deserialize(e){return new $n(e.buffer)}}const Zn={};function qn(e,t,i={}){if(Zn[e])throw new Error(`${e} is already registered.`);Object.defineProperty(t,"_classRegistryKey",{value:e,writeable:!1}),Zn[e]={klass:t,omit:i.omit||[],shallow:i.shallow||[]}}qn("Object",Object),qn("TransferableGridIndex",$n),qn("Color",vt),qn("Error",Error),qn("AJAXError",ae),qn("ResolvedImage",Mt),qn("StylePropertyFunction",Wr),qn("StyleExpression",Hr,{omit:["_evaluator"]}),qn("ZoomDependentExpression",qr),qn("ZoomConstantExpression",Zr),qn("CompoundExpression",xr,{omit:["_evaluate"]});for(const e in vr)vr[e]._classRegistryKey||qn(`Expression_${e}`,vr[e]);function Kn(e){return e&&"undefined"!=typeof ArrayBuffer&&(e instanceof ArrayBuffer||e.constructor&&"ArrayBuffer"===e.constructor.name)}function Wn(e){return e.$name||e.constructor._classRegistryKey}function Xn(e){return!function(e){if(null===e||"object"!=typeof e)return!1;const t=Wn(e);return!(!t||"Object"===t)}(e)&&(null==e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp||e instanceof Blob||e instanceof Error||Kn(e)||Z(e)||ArrayBuffer.isView(e)||e instanceof ImageData)}function Yn(e,t){if(Xn(e))return(Kn(e)||Z(e))&&t&&t.push(e),ArrayBuffer.isView(e)&&t&&t.push(e.buffer),e instanceof ImageData&&t&&t.push(e.data.buffer),e;if(Array.isArray(e)){const i=[];for(const r of e)i.push(Yn(r,t));return i}if("object"!=typeof e)throw new Error("can't serialize object of type "+typeof e);const i=Wn(e);if(!i)throw new Error(`can't serialize object of unregistered class ${e.constructor.name}`);if(!Zn[i])throw new Error(`${i} is not registered.`);const{klass:r}=Zn[i],n=r.serialize?r.serialize(e,t):{};if(r.serialize){if(t&&n===t[t.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const r in e){if(!e.hasOwnProperty(r))continue;if(Zn[i].omit.indexOf(r)>=0)continue;const o=e[r];n[r]=Zn[i].shallow.indexOf(r)>=0?o:Yn(o,t)}e instanceof Error&&(n.message=e.message)}if(n.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==i&&(n.$name=i),n}function Jn(e){if(Xn(e))return e;if(Array.isArray(e))return e.map(Jn);if("object"!=typeof e)throw new Error("can't deserialize object of type "+typeof e);const t=Wn(e)||"Object";if(!Zn[t])throw new Error(`can't deserialize unregistered class ${t}`);const{klass:i}=Zn[t];if(!i)throw new Error(`can't deserialize unregistered class ${t}`);if(i.deserialize)return i.deserialize(e);const r=Object.create(i.prototype);for(const i of Object.keys(e)){if("$name"===i)continue;const n=e[i];r[i]=Zn[t].shallow.indexOf(i)>=0?n:Jn(n)}return r}class eo{constructor(){this.first=!0}update(e,t){const i=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=i,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=i,!0):(this.lastFloorZoom>i?(this.lastIntegerZoom=i+1,this.lastIntegerZoomTime=t):this.lastFloorZoom<i&&(this.lastIntegerZoom=i,this.lastIntegerZoomTime=t),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=i,!0))}}const to={"Latin-1 Supplement":e=>e>=128&&e<=255,"Hangul Jamo":e=>e>=4352&&e<=4607,Khmer:e=>e>=6016&&e<=6143,"General Punctuation":e=>e>=8192&&e<=8303,"Letterlike Symbols":e=>e>=8448&&e<=8527,"Number Forms":e=>e>=8528&&e<=8591,"Miscellaneous Technical":e=>e>=8960&&e<=9215,"Control Pictures":e=>e>=9216&&e<=9279,"Optical Character Recognition":e=>e>=9280&&e<=9311,"Enclosed Alphanumerics":e=>e>=9312&&e<=9471,"Geometric Shapes":e=>e>=9632&&e<=9727,"Miscellaneous Symbols":e=>e>=9728&&e<=9983,"Miscellaneous Symbols and Arrows":e=>e>=11008&&e<=11263,"Ideographic Description Characters":e=>e>=12272&&e<=12287,"CJK Symbols and Punctuation":e=>e>=12288&&e<=12351,Hiragana:e=>e>=12352&&e<=12447,Katakana:e=>e>=12448&&e<=12543,Kanbun:e=>e>=12688&&e<=12703,"CJK Strokes":e=>e>=12736&&e<=12783,"Enclosed CJK Letters and Months":e=>e>=12800&&e<=13055,"CJK Compatibility":e=>e>=13056&&e<=13311,"Yijing Hexagram Symbols":e=>e>=19904&&e<=19967,"CJK Unified Ideographs":e=>e>=19968&&e<=40959,"Hangul Syllables":e=>e>=44032&&e<=55215,"Private Use Area":e=>e>=57344&&e<=63743,"Vertical Forms":e=>e>=65040&&e<=65055,"CJK Compatibility Forms":e=>e>=65072&&e<=65103,"Small Form Variants":e=>e>=65104&&e<=65135,"Halfwidth and Fullwidth Forms":e=>e>=65280&&e<=65519};function io(e){for(const t of e)if(lo(t.charCodeAt(0)))return!0;return!1}function ro(e){for(const t of e)if(!so(t.charCodeAt(0)))return!1;return!0}function no(e){const t=e.map((e=>{try{return new RegExp(`\\p{sc=${e}}`,"u").source}catch(e){return null}})).filter((e=>e));return new RegExp(t.join("|"),"u")}const oo=no(["Arab","Dupl","Mong","Ougr","Syrc"]);function so(e){return!oo.test(String.fromCodePoint(e))}const ao=no(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function lo(e){return!(746!==e&&747!==e&&(e<4352||!(to["CJK Compatibility Forms"](e)&&!(e>=65097&&e<=65103)||to["CJK Compatibility"](e)||to["CJK Strokes"](e)||!(!to["CJK Symbols and Punctuation"](e)||e>=12296&&e<=12305||e>=12308&&e<=12319||12336===e)||to["Enclosed CJK Letters and Months"](e)||to["Ideographic Description Characters"](e)||to.Kanbun(e)||to.Katakana(e)&&12540!==e||!(!to["Halfwidth and Fullwidth Forms"](e)||65288===e||65289===e||65293===e||e>=65306&&e<=65310||65339===e||65341===e||65343===e||e>=65371&&e<=65503||65507===e||e>=65512&&e<=65519)||!(!to["Small Form Variants"](e)||e>=65112&&e<=65118||e>=65123&&e<=65126)||to["Vertical Forms"](e)||to["Yijing Hexagram Symbols"](e)||/\p{sc=Cans}/u.test(String.fromCodePoint(e))||/\p{sc=Hang}/u.test(String.fromCodePoint(e))||ao.test(String.fromCodePoint(e)))))}function co(e){return!(lo(e)||function(e){return!!(to["Latin-1 Supplement"](e)&&(167===e||169===e||174===e||177===e||188===e||189===e||190===e||215===e||247===e)||to["General Punctuation"](e)&&(8214===e||8224===e||8225===e||8240===e||8241===e||8251===e||8252===e||8258===e||8263===e||8264===e||8265===e||8273===e)||to["Letterlike Symbols"](e)||to["Number Forms"](e)||to["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||9003===e||e>=9085&&e<=9114||e>=9150&&e<=9165||9167===e||e>=9169&&e<=9179||e>=9186&&e<=9215)||to["Control Pictures"](e)&&9251!==e||to["Optical Character Recognition"](e)||to["Enclosed Alphanumerics"](e)||to["Geometric Shapes"](e)||to["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||to["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||to["CJK Symbols and Punctuation"](e)||to.Katakana(e)||to["Private Use Area"](e)||to["CJK Compatibility Forms"](e)||to["Small Form Variants"](e)||to["Halfwidth and Fullwidth Forms"](e)||8734===e||8756===e||8757===e||e>=9984&&e<=10087||e>=10102&&e<=10131||65532===e||65533===e)}(e))}const uo=no(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function ho(e){return uo.test(String.fromCodePoint(e))}function po(e,t){return!(!t&&ho(e)||e>=2304&&e<=3583||e>=3840&&e<=4255||to.Khmer(e))}function fo(e){for(const t of e)if(ho(t.charCodeAt(0)))return!0;return!1}const Ao=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(e){this.pluginStatus=e.pluginStatus,this.pluginURL=e.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(e){if(Ao.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=e.applyArabicShaping,this.processBidirectionalText=e.processBidirectionalText,this.processStyledBidirectionalText=e.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return null!=this.applyArabicShaping&&null!=this.processBidirectionalText&&null!=this.processStyledBidirectionalText}getRTLTextPluginStatus(){return this.pluginStatus}syncState(e,i){return t(this,void 0,void 0,(function*(){if(this.isParsed())return this.getState();if("loading"!==e.pluginStatus)return this.setState(e),e;const t=e.pluginURL,r=new Promise((e=>{this.loadScriptResolve=e}));i(t);const n=new Promise((e=>setTimeout((()=>e()),this.TIMEOUT)));if(yield Promise.race([r,n]),this.isParsed()){const e={pluginStatus:"loaded",pluginURL:t};return this.setState(e),e}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${t}`)}))}};class mo{constructor(e,t){this.zoom=e,t?(this.now=t.now,this.fadeDuration=t.fadeDuration,this.zoomHistory=t.zoomHistory,this.transition=t.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new eo,this.transition={})}isSupportedScript(e){return function(e,t){for(const i of e)if(!po(i.charCodeAt(0),t))return!1;return!0}(e,"loaded"===Ao.getRTLTextPluginStatus())}crossFadingFactor(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,t=e-Math.floor(e),i=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:t+(1-t)*i}:{fromScale:.5,toScale:1,t:1-(1-i)*t}}}class go{constructor(e,t){this.property=e,this.value=t,this.expression=function(e,t){if(Rr(e))return new Wr(e,t);if(Gr(e)){const i=Kr(e,t);if("error"===i.result)throw new Error(i.value.map((e=>`${e.key}: ${e.message}`)).join(", "));return i.value}{let i=e;return"color"===t.type&&"string"==typeof e?i=vt.parse(e):"padding"!==t.type||"number"!=typeof e&&!Array.isArray(e)?"variableAnchorOffsetCollection"===t.type&&Array.isArray(e)?i=Et.parse(e):"projectionDefinition"===t.type&&"string"==typeof e&&(i=It.parse(e)):i=Bt.parse(e),{kind:"constant",evaluate:()=>i}}}(void 0===t?e.specification.default:t,e.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(e,t,i){return this.property.possiblyEvaluate(this,e,t,i)}}class _o{constructor(e){this.property=e,this.value=new go(e,void 0)}transitioned(e,t){return new vo(this.property,this.value,t,D({},e.transition,this.transition),e.now)}untransitioned(){return new vo(this.property,this.value,null,{},0)}}class yo{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return Q(this._values[e].value.value)}setValue(e,t){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new _o(this._values[e].property)),this._values[e].value=new go(this._values[e].property,null===t?void 0:Q(t))}getTransition(e){return Q(this._values[e].transition)}setTransition(e,t){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new _o(this._values[e].property)),this._values[e].transition=Q(t)||void 0}serialize(){const e={};for(const t of Object.keys(this._values)){const i=this.getValue(t);void 0!==i&&(e[t]=i);const r=this.getTransition(t);void 0!==r&&(e[`${t}-transition`]=r)}return e}transitioned(e,t){const i=new xo(this._properties);for(const r of Object.keys(this._values))i._values[r]=this._values[r].transitioned(e,t._values[r]);return i}untransitioned(){const e=new xo(this._properties);for(const t of Object.keys(this._values))e._values[t]=this._values[t].untransitioned();return e}}class vo{constructor(e,t,i,r,n){this.property=e,this.value=t,this.begin=n+r.delay||0,this.end=this.begin+r.duration||0,e.specification.transition&&(r.delay||r.duration)&&(this.prior=i)}possiblyEvaluate(e,t,i){const r=e.now||0,n=this.value.possiblyEvaluate(e,t,i),o=this.prior;if(o){if(r>this.end)return this.prior=null,n;if(this.value.isDataDriven())return this.prior=null,n;if(r<this.begin)return o.possiblyEvaluate(e,t,i);{const s=(r-this.begin)/(this.end-this.begin);return this.property.interpolate(o.possiblyEvaluate(e,t,i),n,L(s))}}return n}}class xo{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,t,i){const r=new To(this._properties);for(const n of Object.keys(this._values))r._values[n]=this._values[n].possiblyEvaluate(e,t,i);return r}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class bo{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}hasValue(e){return void 0!==this._values[e].value}getValue(e){return Q(this._values[e].value)}setValue(e,t){this._values[e]=new go(this._values[e].property,null===t?void 0:Q(t))}serialize(){const e={};for(const t of Object.keys(this._values)){const i=this.getValue(t);void 0!==i&&(e[t]=i)}return e}possiblyEvaluate(e,t,i){const r=new To(this._properties);for(const n of Object.keys(this._values))r._values[n]=this._values[n].possiblyEvaluate(e,t,i);return r}}class wo{constructor(e,t,i){this.property=e,this.value=t,this.parameters=i}isConstant(){return"constant"===this.value.kind}constantOr(e){return"constant"===this.value.kind?this.value.value:e}evaluate(e,t,i,r){return this.property.evaluate(this.value,this.parameters,e,t,i,r)}}class To{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class Bo{constructor(e){this.specification=e}possiblyEvaluate(e,t){if(e.isDataDriven())throw new Error("Value should not be data driven");return e.expression.evaluate(t)}interpolate(e,t,i){const r=si[this.specification.type];return r?r(e,t,i):e}}class Co{constructor(e,t){this.specification=e,this.overrides=t}possiblyEvaluate(e,t,i,r){return new wo(this,"constant"===e.expression.kind||"camera"===e.expression.kind?{kind:"constant",value:e.expression.evaluate(t,null,{},i,r)}:e.expression,t)}interpolate(e,t,i){if("constant"!==e.value.kind||"constant"!==t.value.kind)return e;if(void 0===e.value.value||void 0===t.value.value)return new wo(this,{kind:"constant",value:void 0},e.parameters);const r=si[this.specification.type];if(r){const n=r(e.value.value,t.value.value,i);return new wo(this,{kind:"constant",value:n},e.parameters)}return e}evaluate(e,t,i,r,n,o){return"constant"===e.kind?e.value:e.evaluate(t,i,r,n,o)}}class So extends Co{possiblyEvaluate(e,t,i,r){if(void 0===e.value)return new wo(this,{kind:"constant",value:void 0},t);if("constant"===e.expression.kind){const n=e.expression.evaluate(t,null,{},i,r),o="resolvedImage"===e.property.specification.type&&"string"!=typeof n?n.name:n,s=this._calculate(o,o,o,t);return new wo(this,{kind:"constant",value:s},t)}if("camera"===e.expression.kind){const i=this._calculate(e.expression.evaluate({zoom:t.zoom-1}),e.expression.evaluate({zoom:t.zoom}),e.expression.evaluate({zoom:t.zoom+1}),t);return new wo(this,{kind:"constant",value:i},t)}return new wo(this,e.expression,t)}evaluate(e,t,i,r,n,o){if("source"===e.kind){const s=e.evaluate(t,i,r,n,o);return this._calculate(s,s,s,t)}return"composite"===e.kind?this._calculate(e.evaluate({zoom:Math.floor(t.zoom)-1},i,r),e.evaluate({zoom:Math.floor(t.zoom)},i,r),e.evaluate({zoom:Math.floor(t.zoom)+1},i,r),t):e.value}_calculate(e,t,i,r){return r.zoom>r.zoomHistory.lastIntegerZoom?{from:e,to:t}:{from:i,to:t}}interpolate(e){return e}}class Eo{constructor(e){this.specification=e}possiblyEvaluate(e,t,i,r){if(void 0!==e.value){if("constant"===e.expression.kind){const n=e.expression.evaluate(t,null,{},i,r);return this._calculate(n,n,n,t)}return this._calculate(e.expression.evaluate(new mo(Math.floor(t.zoom-1),t)),e.expression.evaluate(new mo(Math.floor(t.zoom),t)),e.expression.evaluate(new mo(Math.floor(t.zoom+1),t)),t)}}_calculate(e,t,i,r){return r.zoom>r.zoomHistory.lastIntegerZoom?{from:e,to:t}:{from:i,to:t}}interpolate(e){return e}}class Mo{constructor(e){this.specification=e}possiblyEvaluate(e,t,i,r){return!!e.expression.evaluate(t,null,{},i,r)}interpolate(){return!1}}class Io{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const t in e){const i=e[t];i.specification.overridable&&this.overridableProperties.push(t);const r=this.defaultPropertyValues[t]=new go(i,void 0),n=this.defaultTransitionablePropertyValues[t]=new _o(i);this.defaultTransitioningPropertyValues[t]=n.untransitioned(),this.defaultPossiblyEvaluatedValues[t]=r.possiblyEvaluate({})}}}qn("DataDrivenProperty",Co),qn("DataConstantProperty",Bo),qn("CrossFadedDataDrivenProperty",So),qn("CrossFadedProperty",Eo),qn("ColorRampProperty",Mo);const Po="-transition";class Lo extends Ae{constructor(e,t){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1},"custom"!==e.type&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,"background"!==e.type&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),t.layout&&(this._unevaluatedLayout=new bo(t.layout)),t.paint)){this._transitionablePaint=new yo(t.paint);for(const t in e.paint)this.setPaintProperty(t,e.paint[t],{validate:!1});for(const t in e.layout)this.setLayoutProperty(t,e.layout[t],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new To(t.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return"visibility"===e?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,t,i={}){null!=t&&this._validate(Hn,`layers.${this.id}.layout.${e}`,e,t,i)||("visibility"!==e?this._unevaluatedLayout.setValue(e,t):this.visibility=t)}getPaintProperty(e){return e.endsWith(Po)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,t,i={}){if(null!=t&&this._validate(Vn,`layers.${this.id}.paint.${e}`,e,t,i))return!1;if(e.endsWith(Po))return this._transitionablePaint.setTransition(e.slice(0,-11),t||void 0),!1;{const i=this._transitionablePaint._values[e],r="cross-faded-data-driven"===i.property.specification["property-type"],n=i.value.isDataDriven(),o=i.value;this._transitionablePaint.setValue(e,t),this._handleSpecialPaintPropertyUpdate(e);const s=this._transitionablePaint._values[e].value;return s.isDataDriven()||n||r||this._handleOverridablePaintPropertyUpdate(e,o,s)}}_handleSpecialPaintPropertyUpdate(e){}_handleOverridablePaintPropertyUpdate(e,t,i){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||"none"===this.visibility}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,t){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,t)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,t)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),N(e,((e,t)=>!(void 0===e||"layout"===t&&!Object.keys(e).length||"paint"===t&&!Object.keys(e).length)))}_validate(e,t,i,r,n={}){return(!n||!1!==n.validate)&&Gn(this,e.call(Nn,{key:t,layerType:this.type,objectKey:i,value:r,styleSpec:me,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const t=this.paint.get(e);if(t instanceof wo&&Lr(t.property.specification)&&("source"===t.value.kind||"composite"===t.value.kind)&&t.value.isStateDependent)return!0}return!1}}const Fo={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class ko{constructor(e,t){this._structArray=e,this._pos1=t*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class zo{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,t){return e._trim(),t&&(e.isTransferred=!0,t.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const t=Object.create(this.prototype);return t.arrayBuffer=e.arrayBuffer,t.length=e.length,t.capacity=e.arrayBuffer.byteLength/t.bytesPerElement,t._refreshViews(),t}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const t=this.uint8;this._refreshViews(),t&&this.uint8.set(t)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Ro(e,t=1){let i=0,r=0;return{members:e.map((e=>{const n=Fo[e.type].BYTES_PER_ELEMENT,o=i=Do(i,Math.max(t,n)),s=e.components||1;return r=Math.max(r,n),i+=n*s,{name:e.name,type:e.type,components:s,offset:o}})),size:Do(i,Math.max(r,t)),alignment:t}}function Do(e,t){return Math.ceil(e/t)*t}class Oo extends zo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t){const i=this.length;return this.resize(i+1),this.emplace(i,e,t)}emplace(e,t,i){const r=2*e;return this.int16[r+0]=t,this.int16[r+1]=i,e}}Oo.prototype.bytesPerElement=4,qn("StructArrayLayout2i4",Oo);class Uo extends zo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,i){const r=this.length;return this.resize(r+1),this.emplace(r,e,t,i)}emplace(e,t,i,r){const n=3*e;return this.int16[n+0]=t,this.int16[n+1]=i,this.int16[n+2]=r,e}}Uo.prototype.bytesPerElement=6,qn("StructArrayLayout3i6",Uo);class No extends zo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,i,r){const n=this.length;return this.resize(n+1),this.emplace(n,e,t,i,r)}emplace(e,t,i,r,n){const o=4*e;return this.int16[o+0]=t,this.int16[o+1]=i,this.int16[o+2]=r,this.int16[o+3]=n,e}}No.prototype.bytesPerElement=8,qn("StructArrayLayout4i8",No);class Qo extends zo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,i,r,n,o){const s=this.length;return this.resize(s+1),this.emplace(s,e,t,i,r,n,o)}emplace(e,t,i,r,n,o,s){const a=6*e;return this.int16[a+0]=t,this.int16[a+1]=i,this.int16[a+2]=r,this.int16[a+3]=n,this.int16[a+4]=o,this.int16[a+5]=s,e}}Qo.prototype.bytesPerElement=12,qn("StructArrayLayout2i4i12",Qo);class jo extends zo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,i,r,n,o){const s=this.length;return this.resize(s+1),this.emplace(s,e,t,i,r,n,o)}emplace(e,t,i,r,n,o,s){const a=4*e,l=8*e;return this.int16[a+0]=t,this.int16[a+1]=i,this.uint8[l+4]=r,this.uint8[l+5]=n,this.uint8[l+6]=o,this.uint8[l+7]=s,e}}jo.prototype.bytesPerElement=8,qn("StructArrayLayout2i4ub8",jo);class Vo extends zo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t){const i=this.length;return this.resize(i+1),this.emplace(i,e,t)}emplace(e,t,i){const r=2*e;return this.float32[r+0]=t,this.float32[r+1]=i,e}}Vo.prototype.bytesPerElement=8,qn("StructArrayLayout2f8",Vo);class Ho extends zo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,i,r,n,o,s,a,l,c){const u=this.length;return this.resize(u+1),this.emplace(u,e,t,i,r,n,o,s,a,l,c)}emplace(e,t,i,r,n,o,s,a,l,c,u){const h=10*e;return this.uint16[h+0]=t,this.uint16[h+1]=i,this.uint16[h+2]=r,this.uint16[h+3]=n,this.uint16[h+4]=o,this.uint16[h+5]=s,this.uint16[h+6]=a,this.uint16[h+7]=l,this.uint16[h+8]=c,this.uint16[h+9]=u,e}}Ho.prototype.bytesPerElement=20,qn("StructArrayLayout10ui20",Ho);class Go extends zo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,i,r,n,o,s,a,l,c,u,h){const d=this.length;return this.resize(d+1),this.emplace(d,e,t,i,r,n,o,s,a,l,c,u,h)}emplace(e,t,i,r,n,o,s,a,l,c,u,h,d){const p=12*e;return this.int16[p+0]=t,this.int16[p+1]=i,this.int16[p+2]=r,this.int16[p+3]=n,this.uint16[p+4]=o,this.uint16[p+5]=s,this.uint16[p+6]=a,this.uint16[p+7]=l,this.int16[p+8]=c,this.int16[p+9]=u,this.int16[p+10]=h,this.int16[p+11]=d,e}}Go.prototype.bytesPerElement=24,qn("StructArrayLayout4i4ui4i24",Go);class $o extends zo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,i){const r=this.length;return this.resize(r+1),this.emplace(r,e,t,i)}emplace(e,t,i,r){const n=3*e;return this.float32[n+0]=t,this.float32[n+1]=i,this.float32[n+2]=r,e}}$o.prototype.bytesPerElement=12,qn("StructArrayLayout3f12",$o);class Zo extends zo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.uint32[1*e+0]=t,e}}Zo.prototype.bytesPerElement=4,qn("StructArrayLayout1ul4",Zo);class qo extends zo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,i,r,n,o,s,a,l){const c=this.length;return this.resize(c+1),this.emplace(c,e,t,i,r,n,o,s,a,l)}emplace(e,t,i,r,n,o,s,a,l,c){const u=10*e,h=5*e;return this.int16[u+0]=t,this.int16[u+1]=i,this.int16[u+2]=r,this.int16[u+3]=n,this.int16[u+4]=o,this.int16[u+5]=s,this.uint32[h+3]=a,this.uint16[u+8]=l,this.uint16[u+9]=c,e}}qo.prototype.bytesPerElement=20,qn("StructArrayLayout6i1ul2ui20",qo);class Ko extends zo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,i,r,n,o){const s=this.length;return this.resize(s+1),this.emplace(s,e,t,i,r,n,o)}emplace(e,t,i,r,n,o,s){const a=6*e;return this.int16[a+0]=t,this.int16[a+1]=i,this.int16[a+2]=r,this.int16[a+3]=n,this.int16[a+4]=o,this.int16[a+5]=s,e}}Ko.prototype.bytesPerElement=12,qn("StructArrayLayout2i2i2i12",Ko);class Wo extends zo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,i,r,n){const o=this.length;return this.resize(o+1),this.emplace(o,e,t,i,r,n)}emplace(e,t,i,r,n,o){const s=4*e,a=8*e;return this.float32[s+0]=t,this.float32[s+1]=i,this.float32[s+2]=r,this.int16[a+6]=n,this.int16[a+7]=o,e}}Wo.prototype.bytesPerElement=16,qn("StructArrayLayout2f1f2i16",Wo);class Xo extends zo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,i,r,n,o){const s=this.length;return this.resize(s+1),this.emplace(s,e,t,i,r,n,o)}emplace(e,t,i,r,n,o,s){const a=16*e,l=4*e,c=8*e;return this.uint8[a+0]=t,this.uint8[a+1]=i,this.float32[l+1]=r,this.float32[l+2]=n,this.int16[c+6]=o,this.int16[c+7]=s,e}}Xo.prototype.bytesPerElement=16,qn("StructArrayLayout2ub2f2i16",Xo);class Yo extends zo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,i){const r=this.length;return this.resize(r+1),this.emplace(r,e,t,i)}emplace(e,t,i,r){const n=3*e;return this.uint16[n+0]=t,this.uint16[n+1]=i,this.uint16[n+2]=r,e}}Yo.prototype.bytesPerElement=6,qn("StructArrayLayout3ui6",Yo);class Jo extends zo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,i,r,n,o,s,a,l,c,u,h,d,p,f,A,m){const g=this.length;return this.resize(g+1),this.emplace(g,e,t,i,r,n,o,s,a,l,c,u,h,d,p,f,A,m)}emplace(e,t,i,r,n,o,s,a,l,c,u,h,d,p,f,A,m,g){const _=24*e,y=12*e,v=48*e;return this.int16[_+0]=t,this.int16[_+1]=i,this.uint16[_+2]=r,this.uint16[_+3]=n,this.uint32[y+2]=o,this.uint32[y+3]=s,this.uint32[y+4]=a,this.uint16[_+10]=l,this.uint16[_+11]=c,this.uint16[_+12]=u,this.float32[y+7]=h,this.float32[y+8]=d,this.uint8[v+36]=p,this.uint8[v+37]=f,this.uint8[v+38]=A,this.uint32[y+10]=m,this.int16[_+22]=g,e}}Jo.prototype.bytesPerElement=48,qn("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Jo);class es extends zo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,i,r,n,o,s,a,l,c,u,h,d,p,f,A,m,g,_,y,v,x,b,w,T,B,C,S){const E=this.length;return this.resize(E+1),this.emplace(E,e,t,i,r,n,o,s,a,l,c,u,h,d,p,f,A,m,g,_,y,v,x,b,w,T,B,C,S)}emplace(e,t,i,r,n,o,s,a,l,c,u,h,d,p,f,A,m,g,_,y,v,x,b,w,T,B,C,S,E){const M=32*e,I=16*e;return this.int16[M+0]=t,this.int16[M+1]=i,this.int16[M+2]=r,this.int16[M+3]=n,this.int16[M+4]=o,this.int16[M+5]=s,this.int16[M+6]=a,this.int16[M+7]=l,this.uint16[M+8]=c,this.uint16[M+9]=u,this.uint16[M+10]=h,this.uint16[M+11]=d,this.uint16[M+12]=p,this.uint16[M+13]=f,this.uint16[M+14]=A,this.uint16[M+15]=m,this.uint16[M+16]=g,this.uint16[M+17]=_,this.uint16[M+18]=y,this.uint16[M+19]=v,this.uint16[M+20]=x,this.uint16[M+21]=b,this.uint16[M+22]=w,this.uint32[I+12]=T,this.float32[I+13]=B,this.float32[I+14]=C,this.uint16[M+30]=S,this.uint16[M+31]=E,e}}es.prototype.bytesPerElement=64,qn("StructArrayLayout8i15ui1ul2f2ui64",es);class ts extends zo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.float32[1*e+0]=t,e}}ts.prototype.bytesPerElement=4,qn("StructArrayLayout1f4",ts);class is extends zo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,i){const r=this.length;return this.resize(r+1),this.emplace(r,e,t,i)}emplace(e,t,i,r){const n=3*e;return this.uint16[6*e+0]=t,this.float32[n+1]=i,this.float32[n+2]=r,e}}is.prototype.bytesPerElement=12,qn("StructArrayLayout1ui2f12",is);class rs extends zo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,i){const r=this.length;return this.resize(r+1),this.emplace(r,e,t,i)}emplace(e,t,i,r){const n=4*e;return this.uint32[2*e+0]=t,this.uint16[n+2]=i,this.uint16[n+3]=r,e}}rs.prototype.bytesPerElement=8,qn("StructArrayLayout1ul2ui8",rs);class ns extends zo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t){const i=this.length;return this.resize(i+1),this.emplace(i,e,t)}emplace(e,t,i){const r=2*e;return this.uint16[r+0]=t,this.uint16[r+1]=i,e}}ns.prototype.bytesPerElement=4,qn("StructArrayLayout2ui4",ns);class os extends zo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.uint16[1*e+0]=t,e}}os.prototype.bytesPerElement=2,qn("StructArrayLayout1ui2",os);class ss extends zo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,i,r){const n=this.length;return this.resize(n+1),this.emplace(n,e,t,i,r)}emplace(e,t,i,r,n){const o=4*e;return this.float32[o+0]=t,this.float32[o+1]=i,this.float32[o+2]=r,this.float32[o+3]=n,e}}ss.prototype.bytesPerElement=16,qn("StructArrayLayout4f16",ss);class as extends ko{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new l(this.anchorPointX,this.anchorPointY)}}as.prototype.size=20;class ls extends qo{get(e){return new as(this,e)}}qn("CollisionBoxArray",ls);class cs extends ko{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(e){this._structArray.uint8[this._pos1+37]=e}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(e){this._structArray.uint8[this._pos1+38]=e}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(e){this._structArray.uint32[this._pos4+10]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}cs.prototype.size=48;class us extends Jo{get(e){return new cs(this,e)}}qn("PlacedSymbolArray",us);class hs extends ko{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(e){this._structArray.uint32[this._pos4+12]=e}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}hs.prototype.size=64;class ds extends es{get(e){return new hs(this,e)}}qn("SymbolInstanceArray",ds);class ps extends ts{getoffsetX(e){return this.float32[1*e+0]}}qn("GlyphOffsetArray",ps);class fs extends Uo{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}qn("SymbolLineVertexArray",fs);class As extends ko{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}As.prototype.size=12;class ms extends is{get(e){return new As(this,e)}}qn("TextAnchorOffsetArray",ms);class gs extends ko{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}gs.prototype.size=8;class _s extends rs{get(e){return new gs(this,e)}}qn("FeatureIndexArray",_s);class ys extends Oo{}class vs extends Oo{}class xs extends Oo{}class bs extends Qo{}class ws extends jo{}class Ts extends Vo{}class Bs extends Ho{}class Cs extends Go{}class Ss extends $o{}class Es extends Zo{}class Ms extends Ko{}class Is extends Xo{}class Ps extends Yo{}class Ls extends ns{}const Fs=Ro([{name:"a_pos",components:2,type:"Int16"}],4),{members:ks}=Fs;class zs{constructor(e=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=e}prepareSegment(e,t,i,r){const n=this.segments[this.segments.length-1];return e>zs.MAX_VERTEX_ARRAY_LENGTH&&V(`Max vertices per segment is ${zs.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${zs.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!n||n.vertexLength+e>zs.MAX_VERTEX_ARRAY_LENGTH||n.sortKey!==r?this.createNewSegment(t,i,r):n}createNewSegment(e,t,i){const r={vertexOffset:e.length,primitiveOffset:t.length,vertexLength:0,primitiveLength:0,vaos:{}};return void 0!==i&&(r.sortKey=i),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(r),r}getOrCreateLatestSegment(e,t,i){return this.prepareSegment(0,e,t,i)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(const e of this.segments)for(const t in e.vaos)e.vaos[t].destroy()}static simpleSegment(e,t,i,r){return new zs([{vertexOffset:e,primitiveOffset:t,vertexLength:i,primitiveLength:r,vaos:{},sortKey:0}])}}function Rs(e,t){return 256*(e=z(Math.floor(e),0,255))+z(Math.floor(t),0,255)}zs.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,qn("SegmentVector",zs);const Ds=Ro([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Os,Us,Ns,Qs={exports:{}},js={exports:{}},Vs={exports:{}},Hs=function(){if(Ns)return Qs.exports;Ns=1;var e=(Os||(Os=1,js.exports=function(e,t){var i,r,n,o,s,a,l,c;for(r=e.length-(i=3&e.length),n=t,s=3432918353,a=461845907,c=0;c<r;)l=255&e.charCodeAt(c)|(255&e.charCodeAt(++c))<<8|(255&e.charCodeAt(++c))<<16|(255&e.charCodeAt(++c))<<24,++c,n=27492+(65535&(o=5*(65535&(n=(n^=l=(65535&(l=(l=(65535&l)*s+(((l>>>16)*s&65535)<<16)&4294967295)<<15|l>>>17))*a+(((l>>>16)*a&65535)<<16)&4294967295)<<13|n>>>19))+((5*(n>>>16)&65535)<<16)&4294967295))+((58964+(o>>>16)&65535)<<16);switch(l=0,i){case 3:l^=(255&e.charCodeAt(c+2))<<16;case 2:l^=(255&e.charCodeAt(c+1))<<8;case 1:n^=l=(65535&(l=(l=(65535&(l^=255&e.charCodeAt(c)))*s+(((l>>>16)*s&65535)<<16)&4294967295)<<15|l>>>17))*a+(((l>>>16)*a&65535)<<16)&4294967295}return n^=e.length,n=2246822507*(65535&(n^=n>>>16))+((2246822507*(n>>>16)&65535)<<16)&4294967295,n=3266489909*(65535&(n^=n>>>13))+((3266489909*(n>>>16)&65535)<<16)&4294967295,(n^=n>>>16)>>>0}),js.exports),t=(Us||(Us=1,Vs.exports=function(e,t){for(var i,r=e.length,n=t^r,o=0;r>=4;)i=1540483477*(65535&(i=255&e.charCodeAt(o)|(255&e.charCodeAt(++o))<<8|(255&e.charCodeAt(++o))<<16|(255&e.charCodeAt(++o))<<24))+((1540483477*(i>>>16)&65535)<<16),n=1540483477*(65535&n)+((1540483477*(n>>>16)&65535)<<16)^(i=1540483477*(65535&(i^=i>>>24))+((1540483477*(i>>>16)&65535)<<16)),r-=4,++o;switch(r){case 3:n^=(255&e.charCodeAt(o+2))<<16;case 2:n^=(255&e.charCodeAt(o+1))<<8;case 1:n=1540483477*(65535&(n^=255&e.charCodeAt(o)))+((1540483477*(n>>>16)&65535)<<16)}return n=1540483477*(65535&(n^=n>>>13))+((1540483477*(n>>>16)&65535)<<16),(n^=n>>>15)>>>0}),Vs.exports);return Qs.exports=e,Qs.exports.murmur3=e,Qs.exports.murmur2=t,Qs.exports}(),Gs=i(Hs);class $s{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,t,i,r){this.ids.push(Zs(e)),this.positions.push(t,i,r)}getPositions(e){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const t=Zs(e);let i=0,r=this.ids.length-1;for(;i<r;){const e=i+r>>1;this.ids[e]>=t?r=e:i=e+1}const n=[];for(;this.ids[i]===t;)n.push({index:this.positions[3*i],start:this.positions[3*i+1],end:this.positions[3*i+2]}),i++;return n}static serialize(e,t){const i=new Float64Array(e.ids),r=new Uint32Array(e.positions);return qs(i,r,0,i.length-1),t&&t.push(i.buffer,r.buffer),{ids:i,positions:r}}static deserialize(e){const t=new $s;return t.ids=e.ids,t.positions=e.positions,t.indexed=!0,t}}function Zs(e){const t=+e;return!isNaN(t)&&t<=Number.MAX_SAFE_INTEGER?t:Gs(String(e))}function qs(e,t,i,r){for(;i<r;){const n=e[i+r>>1];let o=i-1,s=r+1;for(;;){do{o++}while(e[o]<n);do{s--}while(e[s]>n);if(o>=s)break;Ks(e,o,s),Ks(t,3*o,3*s),Ks(t,3*o+1,3*s+1),Ks(t,3*o+2,3*s+2)}s-i<r-s?(qs(e,t,i,s),i=s+1):(qs(e,t,s+1,r),r=s)}}function Ks(e,t,i){const r=e[t];e[t]=e[i],e[i]=r}qn("FeaturePositionMap",$s);class Ws{constructor(e,t){this.gl=e.gl,this.location=t}}class Xs extends Ws{constructor(e,t){super(e,t),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class Ys extends Ws{constructor(e,t){super(e,t),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class Js extends Ws{constructor(e,t){super(e,t),this.current=vt.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const ea=new Float32Array(16);function ta(e){return[Rs(255*e.r,255*e.g),Rs(255*e.b,255*e.a)]}class ia{constructor(e,t,i){this.value=e,this.uniformNames=t.map((e=>`u_${e}`)),this.type=i}setUniform(e,t,i){e.set(i.constantOr(this.value))}getBinding(e,t,i){return"color"===this.type?new Js(e,t):new Xs(e,t)}}class ra{constructor(e,t){this.uniformNames=t.map((e=>`u_${e}`)),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,t){this.pixelRatioFrom=t.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=t.tlbr,this.patternTo=e.tlbr}setUniform(e,t,i,r){const n="u_pattern_to"===r?this.patternTo:"u_pattern_from"===r?this.patternFrom:"u_pixel_ratio_to"===r?this.pixelRatioTo:"u_pixel_ratio_from"===r?this.pixelRatioFrom:null;n&&e.set(n)}getBinding(e,t,i){return"u_pattern"===i.substr(0,9)?new Ys(e,t):new Xs(e,t)}}class na{constructor(e,t,i,r){this.expression=e,this.type=i,this.maxValue=0,this.paintVertexAttributes=t.map((e=>({name:`a_${e}`,type:"Float32",components:"color"===i?2:1,offset:0}))),this.paintVertexArray=new r}populatePaintArray(e,t,i,r,n){const o=this.paintVertexArray.length,s=this.expression.evaluate(new mo(0),t,{},r,[],n);this.paintVertexArray.resize(e),this._setPaintValue(o,e,s)}updatePaintArray(e,t,i,r){const n=this.expression.evaluate({zoom:0},i,r);this._setPaintValue(e,t,n)}_setPaintValue(e,t,i){if("color"===this.type){const r=ta(i);for(let i=e;i<t;i++)this.paintVertexArray.emplace(i,r[0],r[1])}else{for(let r=e;r<t;r++)this.paintVertexArray.emplace(r,i);this.maxValue=Math.max(this.maxValue,Math.abs(i))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class oa{constructor(e,t,i,r,n,o){this.expression=e,this.uniformNames=t.map((e=>`u_${e}_t`)),this.type=i,this.useIntegerZoom=r,this.zoom=n,this.maxValue=0,this.paintVertexAttributes=t.map((e=>({name:`a_${e}`,type:"Float32",components:"color"===i?4:2,offset:0}))),this.paintVertexArray=new o}populatePaintArray(e,t,i,r,n){const o=this.expression.evaluate(new mo(this.zoom),t,{},r,[],n),s=this.expression.evaluate(new mo(this.zoom+1),t,{},r,[],n),a=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(a,e,o,s)}updatePaintArray(e,t,i,r){const n=this.expression.evaluate({zoom:this.zoom},i,r),o=this.expression.evaluate({zoom:this.zoom+1},i,r);this._setPaintValue(e,t,n,o)}_setPaintValue(e,t,i,r){if("color"===this.type){const n=ta(i),o=ta(r);for(let i=e;i<t;i++)this.paintVertexArray.emplace(i,n[0],n[1],o[0],o[1])}else{for(let n=e;n<t;n++)this.paintVertexArray.emplace(n,i,r);this.maxValue=Math.max(this.maxValue,Math.abs(i),Math.abs(r))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,t){const i=this.useIntegerZoom?Math.floor(t.zoom):t.zoom,r=z(this.expression.interpolationFactor(i,this.zoom,this.zoom+1),0,1);e.set(r)}getBinding(e,t,i){return new Xs(e,t)}}class sa{constructor(e,t,i,r,n,o){this.expression=e,this.type=t,this.useIntegerZoom=i,this.zoom=r,this.layerId=o,this.zoomInPaintVertexArray=new n,this.zoomOutPaintVertexArray=new n}populatePaintArray(e,t,i){const r=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(r,e,t.patterns&&t.patterns[this.layerId],i)}updatePaintArray(e,t,i,r,n){this._setPaintValues(e,t,i.patterns&&i.patterns[this.layerId],n)}_setPaintValues(e,t,i,r){if(!r||!i)return;const{min:n,mid:o,max:s}=i,a=r[n],l=r[o],c=r[s];if(a&&l&&c)for(let i=e;i<t;i++)this.zoomInPaintVertexArray.emplace(i,l.tl[0],l.tl[1],l.br[0],l.br[1],a.tl[0],a.tl[1],a.br[0],a.br[1],l.pixelRatio,a.pixelRatio),this.zoomOutPaintVertexArray.emplace(i,l.tl[0],l.tl[1],l.br[0],l.br[1],c.tl[0],c.tl[1],c.br[0],c.br[1],l.pixelRatio,c.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,Ds.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,Ds.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class aa{constructor(e,t,i){this.binders={},this._buffers=[];const r=[];for(const n in e.paint._values){if(!i(n))continue;const o=e.paint.get(n);if(!(o instanceof wo&&Lr(o.property.specification)))continue;const s=ca(n,e.type),a=o.value,l=o.property.specification.type,c=o.property.useIntegerZoom,u=o.property.specification["property-type"],h="cross-faded"===u||"cross-faded-data-driven"===u;if("constant"===a.kind)this.binders[n]=h?new ra(a.value,s):new ia(a.value,s,l),r.push(`/u_${n}`);else if("source"===a.kind||h){const i=ua(n,l,"source");this.binders[n]=h?new sa(a,l,c,t,i,e.id):new na(a,s,l,i),r.push(`/a_${n}`)}else{const e=ua(n,l,"composite");this.binders[n]=new oa(a,s,l,c,t,e),r.push(`/z_${n}`)}}this.cacheKey=r.sort().join("")}getMaxValue(e){const t=this.binders[e];return t instanceof na||t instanceof oa?t.maxValue:0}populatePaintArrays(e,t,i,r,n){for(const o in this.binders){const s=this.binders[o];(s instanceof na||s instanceof oa||s instanceof sa)&&s.populatePaintArray(e,t,i,r,n)}}setConstantPatternPositions(e,t){for(const i in this.binders){const r=this.binders[i];r instanceof ra&&r.setConstantPatternPositions(e,t)}}updatePaintArrays(e,t,i,r,n){let o=!1;for(const s in e){const a=t.getPositions(s);for(const t of a){const a=i.feature(t.index);for(const i in this.binders){const l=this.binders[i];if((l instanceof na||l instanceof oa||l instanceof sa)&&!0===l.expression.isStateDependent){const c=r.paint.get(i);l.expression=c.value,l.updatePaintArray(t.start,t.end,a,e[s],n),o=!0}}}}return o}defines(){const e=[];for(const t in this.binders){const i=this.binders[t];(i instanceof ia||i instanceof ra)&&e.push(...i.uniformNames.map((e=>`#define HAS_UNIFORM_${e}`)))}return e}getBinderAttributes(){const e=[];for(const t in this.binders){const i=this.binders[t];if(i instanceof na||i instanceof oa)for(let t=0;t<i.paintVertexAttributes.length;t++)e.push(i.paintVertexAttributes[t].name);else if(i instanceof sa)for(let t=0;t<Ds.members.length;t++)e.push(Ds.members[t].name)}return e}getBinderUniforms(){const e=[];for(const t in this.binders){const i=this.binders[t];if(i instanceof ia||i instanceof ra||i instanceof oa)for(const t of i.uniformNames)e.push(t)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,t){const i=[];for(const r in this.binders){const n=this.binders[r];if(n instanceof ia||n instanceof ra||n instanceof oa)for(const o of n.uniformNames)if(t[o]){const s=n.getBinding(e,t[o],o);i.push({name:o,property:r,binding:s})}}return i}setUniforms(e,t,i,r){for(const{name:e,property:n,binding:o}of t)this.binders[n].setUniform(o,r,i.get(n),e)}updatePaintBuffers(e){this._buffers=[];for(const t in this.binders){const i=this.binders[t];if(e&&i instanceof sa){const t=2===e.fromScale?i.zoomInPaintVertexBuffer:i.zoomOutPaintVertexBuffer;t&&this._buffers.push(t)}else(i instanceof na||i instanceof oa)&&i.paintVertexBuffer&&this._buffers.push(i.paintVertexBuffer)}}upload(e){for(const t in this.binders){const i=this.binders[t];(i instanceof na||i instanceof oa||i instanceof sa)&&i.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const t=this.binders[e];(t instanceof na||t instanceof oa||t instanceof sa)&&t.destroy()}}}class la{constructor(e,t,i=()=>!0){this.programConfigurations={};for(const r of e)this.programConfigurations[r.id]=new aa(r,t,i);this.needsUpload=!1,this._featureMap=new $s,this._bufferOffset=0}populatePaintArrays(e,t,i,r,n,o){for(const i in this.programConfigurations)this.programConfigurations[i].populatePaintArrays(e,t,r,n,o);void 0!==t.id&&this._featureMap.add(t.id,i,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,t,i,r){for(const n of i)this.needsUpload=this.programConfigurations[n.id].updatePaintArrays(e,this._featureMap,t,n,r)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const t in this.programConfigurations)this.programConfigurations[t].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}function ca(e,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[e]||[e.replace(`${t}-`,"").replace(/-/g,"_")]}function ua(e,t,i){const r={color:{source:Vo,composite:ss},number:{source:ts,composite:Vo}},n=function(e){return{"line-pattern":{source:Bs,composite:Bs},"fill-pattern":{source:Bs,composite:Bs},"fill-extrusion-pattern":{source:Bs,composite:Bs}}[e]}(e);return n&&n[i]||r[t][i]}qn("ConstantBinder",ia),qn("CrossFadedConstantBinder",ra),qn("SourceExpressionBinder",na),qn("CrossFadedCompositeBinder",sa),qn("CompositeExpressionBinder",oa),qn("ProgramConfiguration",aa,{omit:["_buffers"]}),qn("ProgramConfigurationSet",la);const ha=Math.pow(2,14)-1,da=-ha-1;function pa(e){const t=E/e.extent,i=e.loadGeometry();for(let e=0;e<i.length;e++){const r=i[e];for(let e=0;e<r.length;e++){const i=r[e],n=Math.round(i.x*t),o=Math.round(i.y*t);i.x=z(n,da,ha),i.y=z(o,da,ha),(n<i.x||n>i.x+1||o<i.y||o>i.y+1)&&V("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return i}function fa(e,t){return{type:e.type,id:e.id,properties:e.properties,geometry:t?pa(e):[]}}const Aa=-32768;function ma(e,t,i,r,n){e.emplaceBack(Aa+8*t+r,Aa+8*i+n)}class ga{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.id)),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new vs,this.indexArray=new Ps,this.segments=new zs,this.programConfigurations=new la(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id))}populate(e,t,i){const r=this.layers[0],n=[];let o=null,s=!1,a="heatmap"===r.type;if("circle"===r.type){const e=r;o=e.layout.get("circle-sort-key"),s=!o.isConstant(),a=a||"map"===e.paint.get("circle-pitch-alignment")}const l=a?t.subdivisionGranularity.circle:1;for(const{feature:t,id:r,index:a,sourceLayerIndex:l}of e){const e=this.layers[0]._featureFilter.needGeometry,c=fa(t,e);if(!this.layers[0]._featureFilter.filter(new mo(this.zoom),c,i))continue;const u=s?o.evaluate(c,{},i):void 0,h={id:r,properties:t.properties,type:t.type,sourceLayerIndex:l,index:a,geometry:e?c.geometry:pa(t),patterns:{},sortKey:u};n.push(h)}s&&n.sort(((e,t)=>e.sortKey-t.sortKey));for(const r of n){const{geometry:n,index:o,sourceLayerIndex:s}=r,a=e[o].feature;this.addFeature(r,n,o,i,l),t.featureIndex.insert(a,n,o,s,this.index)}}update(e,t,i){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,i)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,ks),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,t,i,r,n=1){let o;switch(n){case 1:o=[0,7];break;case 3:o=[0,2,5,7];break;case 5:o=[0,1,3,4,6,7];break;case 7:o=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${n}; valid values are 1, 3, 5, 7.`)}const s=o.length;for(const i of t)for(const t of i){const i=t.x,r=t.y;if(i<0||i>=E||r<0||r>=E)continue;const n=this.segments.prepareSegment(s*s,this.layoutVertexArray,this.indexArray,e.sortKey),a=n.vertexLength;for(let e=0;e<s;e++)for(let t=0;t<s;t++)ma(this.layoutVertexArray,i,r,o[t],o[e]);for(let e=0;e<s-1;e++)for(let t=0;t<s-1;t++){const i=a+e*s+t,r=a+(e+1)*s+t;this.indexArray.emplaceBack(i,r+1,i+1),this.indexArray.emplaceBack(i,r,r+1)}n.vertexLength+=s*s,n.primitiveLength+=(s-1)*(s-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,{},r)}}function _a(e,t){for(let i=0;i<e.length;i++)if(Sa(t,e[i]))return!0;for(let i=0;i<t.length;i++)if(Sa(e,t[i]))return!0;return!!ba(e,t)}function ya(e,t,i){return!!Sa(e,t)||!!Ta(t,e,i)}function va(e,t){if(1===e.length)return Ca(t,e[0]);for(let i=0;i<t.length;i++){const r=t[i];for(let t=0;t<r.length;t++)if(Sa(e,r[t]))return!0}for(let i=0;i<e.length;i++)if(Ca(t,e[i]))return!0;for(let i=0;i<t.length;i++)if(ba(e,t[i]))return!0;return!1}function xa(e,t,i){if(e.length>1){if(ba(e,t))return!0;for(let r=0;r<t.length;r++)if(Ta(t[r],e,i))return!0}for(let r=0;r<e.length;r++)if(Ta(e[r],t,i))return!0;return!1}function ba(e,t){if(0===e.length||0===t.length)return!1;for(let i=0;i<e.length-1;i++){const r=e[i],n=e[i+1];for(let e=0;e<t.length-1;e++)if(wa(r,n,t[e],t[e+1]))return!0}return!1}function wa(e,t,i,r){return H(e,i,r)!==H(t,i,r)&&H(e,t,i)!==H(e,t,r)}function Ta(e,t,i){const r=i*i;if(1===t.length)return e.distSqr(t[0])<r;for(let i=1;i<t.length;i++)if(Ba(e,t[i-1],t[i])<r)return!0;return!1}function Ba(e,t,i){const r=t.distSqr(i);if(0===r)return e.distSqr(t);const n=((e.x-t.x)*(i.x-t.x)+(e.y-t.y)*(i.y-t.y))/r;return e.distSqr(n<0?t:n>1?i:i.sub(t)._mult(n)._add(t))}function Ca(e,t){for(let i=0;i<e.length;i++)if(Sa(e[i],t))return!0;return!1}function Sa(e,t){let i=!1;for(let r=0,n=e.length-1;r<e.length;n=r++){const o=e[r],s=e[n];o.y>t.y!=s.y>t.y&&t.x<(s.x-o.x)*(t.y-o.y)/(s.y-o.y)+o.x&&(i=!i)}return i}function Ea(e,t,i){const r=i[0],n=i[2];if(e.x<r.x&&t.x<r.x||e.x>n.x&&t.x>n.x||e.y<r.y&&t.y<r.y||e.y>n.y&&t.y>n.y)return!1;const o=H(e,t,i[0]);return o!==H(e,t,i[1])||o!==H(e,t,i[2])||o!==H(e,t,i[3])}function Ma(e,t,i){const r=t.paint.get(e).value;return"constant"===r.kind?r.value:i.programConfigurations.get(t.id).getMaxValue(e)}function Ia(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function Pa(e,t,i,r,n){if(!t[0]&&!t[1])return e;const o=l.convert(t)._mult(n);"viewport"===i&&o._rotate(-r);const s=[];for(let t=0;t<e.length;t++)s.push(e[t].sub(o));return s}let La,Fa;qn("CircleBucket",ga,{omit:["layers"]});var ka={get paint(){return Fa=Fa||new Io({"circle-radius":new Co(me.paint_circle["circle-radius"]),"circle-color":new Co(me.paint_circle["circle-color"]),"circle-blur":new Co(me.paint_circle["circle-blur"]),"circle-opacity":new Co(me.paint_circle["circle-opacity"]),"circle-translate":new Bo(me.paint_circle["circle-translate"]),"circle-translate-anchor":new Bo(me.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Bo(me.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Bo(me.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Co(me.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Co(me.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Co(me.paint_circle["circle-stroke-opacity"])})},get layout(){return La=La||new Io({"circle-sort-key":new Co(me.layout_circle["circle-sort-key"])})}};class za extends Lo{constructor(e){super(e,ka)}createBucket(e){return new ga(e)}queryRadius(e){const t=e;return Ma("circle-radius",this,t)+Ma("circle-stroke-width",this,t)+Ia(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:e,feature:t,featureState:i,geometry:r,transform:n,pixelsToTileUnits:o,unwrappedTileID:s,getElevation:a}){const l=Pa(e,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-n.bearingInRadians,o),c=this.paint.get("circle-radius").evaluate(t,i)+this.paint.get("circle-stroke-width").evaluate(t,i),u="map"===this.paint.get("circle-pitch-alignment"),h=u?l:function(e,t,i,r){return e.map((e=>Ra(e,t,i,r)))}(l,n,s,a),d=u?c*o:c;for(const e of r)for(const t of e){const e=u?t:Ra(t,n,s,a);let i=d;const r=n.projectTileCoordinates(t.x,t.y,s,a).signedDistanceFromCamera;if("viewport"===this.paint.get("circle-pitch-scale")&&"map"===this.paint.get("circle-pitch-alignment")?i*=r/n.cameraToCenterDistance:"map"===this.paint.get("circle-pitch-scale")&&"viewport"===this.paint.get("circle-pitch-alignment")&&(i*=n.cameraToCenterDistance/r),ya(h,e,i))return!0}return!1}}function Ra(e,t,i,r){const n=t.projectTileCoordinates(e.x,e.y,i,r).point;return new l((.5*n.x+.5)*t.width,(.5*-n.y+.5)*t.height)}class Da extends ga{}let Oa;qn("HeatmapBucket",Da,{omit:["layers"]});var Ua={get paint(){return Oa=Oa||new Io({"heatmap-radius":new Co(me.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Co(me.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Bo(me.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Mo(me.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Bo(me.paint_heatmap["heatmap-opacity"])})}};function Na(e,{width:t,height:i},r,n){if(n){if(n instanceof Uint8ClampedArray)n=new Uint8Array(n.buffer);else if(n.length!==t*i*r)throw new RangeError(`mismatched image size. expected: ${n.length} but got: ${t*i*r}`)}else n=new Uint8Array(t*i*r);return e.width=t,e.height=i,e.data=n,e}function Qa(e,{width:t,height:i},r){if(t===e.width&&i===e.height)return;const n=Na({},{width:t,height:i},r);ja(e,n,{x:0,y:0},{x:0,y:0},{width:Math.min(e.width,t),height:Math.min(e.height,i)},r),e.width=t,e.height=i,e.data=n.data}function ja(e,t,i,r,n,o){if(0===n.width||0===n.height)return t;if(n.width>e.width||n.height>e.height||i.x>e.width-n.width||i.y>e.height-n.height)throw new RangeError("out of range source coordinates for image copy");if(n.width>t.width||n.height>t.height||r.x>t.width-n.width||r.y>t.height-n.height)throw new RangeError("out of range destination coordinates for image copy");const s=e.data,a=t.data;if(s===a)throw new Error("srcData equals dstData, so image is already copied");for(let l=0;l<n.height;l++){const c=((i.y+l)*e.width+i.x)*o,u=((r.y+l)*t.width+r.x)*o;for(let e=0;e<n.width*o;e++)a[u+e]=s[c+e]}return t}class Va{constructor(e,t){Na(this,e,1,t)}resize(e){Qa(this,e,1)}clone(){return new Va({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,t,i,r,n){ja(e,t,i,r,n,1)}}class Ha{constructor(e,t){Na(this,e,4,t)}resize(e){Qa(this,e,4)}replace(e,t){t?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Ha({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,t,i,r,n){ja(e,t,i,r,n,4)}}function Ga(e){const t={},i=e.resolution||256,r=e.clips?e.clips.length:1,n=e.image||new Ha({width:i,height:r});if(Math.log(i)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${i}`);const o=(i,r,o)=>{t[e.evaluationKey]=o;const s=e.expression.evaluate(t);n.data[i+r+0]=Math.floor(255*s.r/s.a),n.data[i+r+1]=Math.floor(255*s.g/s.a),n.data[i+r+2]=Math.floor(255*s.b/s.a),n.data[i+r+3]=Math.floor(255*s.a)};if(e.clips)for(let t=0,n=0;t<r;++t,n+=4*i)for(let r=0,s=0;r<i;r++,s+=4){const a=r/(i-1),{start:l,end:c}=e.clips[t];o(n,s,l*(1-a)+c*a)}else for(let e=0,t=0;e<i;e++,t+=4)o(0,t,e/(i-1));return n}qn("AlphaImage",Va),qn("RGBAImage",Ha);const $a="big-fb";class Za extends Lo{createBucket(e){return new Da(e)}constructor(e){super(e,Ua),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){"heatmap-color"===e&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Ga({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has($a)&&this.heatmapFbos.delete($a)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}}let qa;var Ka={get paint(){return qa=qa||new Io({"hillshade-illumination-direction":new Bo(me.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Bo(me.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Bo(me.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Bo(me.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Bo(me.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Bo(me.paint_hillshade["hillshade-accent-color"])})}};class Wa extends Lo{constructor(e){super(e,Ka)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}}const Xa=Ro([{name:"a_pos",components:2,type:"Int16"}],4),{members:Ya}=Xa;function Ja(e,t,i){const r=i.patternDependencies;let n=!1;for(const i of t){const t=i.paint.get(`${e}-pattern`);t.isConstant()||(n=!0);const o=t.constantOr(null);o&&(n=!0,r[o.to]=!0,r[o.from]=!0)}return n}function el(e,t,i,r,n){const o=n.patternDependencies;for(const s of t){const t=s.paint.get(`${e}-pattern`).value;if("constant"!==t.kind){let e=t.evaluate({zoom:r-1},i,{},n.availableImages),a=t.evaluate({zoom:r},i,{},n.availableImages),l=t.evaluate({zoom:r+1},i,{},n.availableImages);e=e&&e.name?e.name:e,a=a&&a.name?a.name:a,l=l&&l.name?l.name:l,o[e]=!0,o[a]=!0,o[l]=!0,i.patterns[s.id]={min:e,mid:a,max:l}}}return i}function tl(e,t,i,r,n){let o;if(n===function(e,t,i,r){let n=0;for(let o=t,s=i-r;o<i;o+=r)n+=(e[s]-e[o])*(e[o+1]+e[s+1]),s=o;return n}(e,t,i,r)>0)for(let n=t;n<i;n+=r)o=wl(n/r|0,e[n],e[n+1],o);else for(let n=i-r;n>=t;n-=r)o=wl(n/r|0,e[n],e[n+1],o);return o&&gl(o,o.next)&&(Tl(o),o=o.next),o}function il(e,t){if(!e)return e;t||(t=e);let i,r=e;do{if(i=!1,r.steiner||!gl(r,r.next)&&0!==ml(r.prev,r,r.next))r=r.next;else{if(Tl(r),r=t=r.prev,r===r.next)break;i=!0}}while(i||r!==t);return t}function rl(e,t,i,r,n,o,s){if(!e)return;!s&&o&&function(e,t,i,r){let n=e;do{0===n.z&&(n.z=hl(n.x,n.y,t,i,r)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next}while(n!==e);n.prevZ.nextZ=null,n.prevZ=null,function(e){let t,i=1;do{let r,n=e;e=null;let o=null;for(t=0;n;){t++;let s=n,a=0;for(let e=0;e<i&&(a++,s=s.nextZ,s);e++);let l=i;for(;a>0||l>0&&s;)0!==a&&(0===l||!s||n.z<=s.z)?(r=n,n=n.nextZ,a--):(r=s,s=s.nextZ,l--),o?o.nextZ=r:e=r,r.prevZ=o,o=r;n=s}o.nextZ=null,i*=2}while(t>1)}(n)}(e,r,n,o);let a=e;for(;e.prev!==e.next;){const l=e.prev,c=e.next;if(o?ol(e,r,n,o):nl(e))t.push(l.i,e.i,c.i),Tl(e),e=c.next,a=c.next;else if((e=c)===a){s?1===s?rl(e=sl(il(e),t),t,i,r,n,o,2):2===s&&al(e,t,i,r,n,o):rl(il(e),t,i,r,n,o,1);break}}}function nl(e){const t=e.prev,i=e,r=e.next;if(ml(t,i,r)>=0)return!1;const n=t.x,o=i.x,s=r.x,a=t.y,l=i.y,c=r.y,u=Math.min(n,o,s),h=Math.min(a,l,c),d=Math.max(n,o,s),p=Math.max(a,l,c);let f=r.next;for(;f!==t;){if(f.x>=u&&f.x<=d&&f.y>=h&&f.y<=p&&fl(n,a,o,l,s,c,f.x,f.y)&&ml(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}function ol(e,t,i,r){const n=e.prev,o=e,s=e.next;if(ml(n,o,s)>=0)return!1;const a=n.x,l=o.x,c=s.x,u=n.y,h=o.y,d=s.y,p=Math.min(a,l,c),f=Math.min(u,h,d),A=Math.max(a,l,c),m=Math.max(u,h,d),g=hl(p,f,t,i,r),_=hl(A,m,t,i,r);let y=e.prevZ,v=e.nextZ;for(;y&&y.z>=g&&v&&v.z<=_;){if(y.x>=p&&y.x<=A&&y.y>=f&&y.y<=m&&y!==n&&y!==s&&fl(a,u,l,h,c,d,y.x,y.y)&&ml(y.prev,y,y.next)>=0)return!1;if(y=y.prevZ,v.x>=p&&v.x<=A&&v.y>=f&&v.y<=m&&v!==n&&v!==s&&fl(a,u,l,h,c,d,v.x,v.y)&&ml(v.prev,v,v.next)>=0)return!1;v=v.nextZ}for(;y&&y.z>=g;){if(y.x>=p&&y.x<=A&&y.y>=f&&y.y<=m&&y!==n&&y!==s&&fl(a,u,l,h,c,d,y.x,y.y)&&ml(y.prev,y,y.next)>=0)return!1;y=y.prevZ}for(;v&&v.z<=_;){if(v.x>=p&&v.x<=A&&v.y>=f&&v.y<=m&&v!==n&&v!==s&&fl(a,u,l,h,c,d,v.x,v.y)&&ml(v.prev,v,v.next)>=0)return!1;v=v.nextZ}return!0}function sl(e,t){let i=e;do{const r=i.prev,n=i.next.next;!gl(r,n)&&_l(r,i,i.next,n)&&xl(r,n)&&xl(n,r)&&(t.push(r.i,i.i,n.i),Tl(i),Tl(i.next),i=e=n),i=i.next}while(i!==e);return il(i)}function al(e,t,i,r,n,o){let s=e;do{let e=s.next.next;for(;e!==s.prev;){if(s.i!==e.i&&Al(s,e)){let a=bl(s,e);return s=il(s,s.next),a=il(a,a.next),rl(s,t,i,r,n,o,0),void rl(a,t,i,r,n,o,0)}e=e.next}s=s.next}while(s!==e)}function ll(e,t){let i=e.x-t.x;return 0===i&&(i=e.y-t.y,0===i)&&(i=(e.next.y-e.y)/(e.next.x-e.x)-(t.next.y-t.y)/(t.next.x-t.x)),i}function cl(e,t){const i=function(e,t){let i=t;const r=e.x,n=e.y;let o,s=-1/0;if(gl(e,i))return i;do{if(gl(e,i.next))return i.next;if(n<=i.y&&n>=i.next.y&&i.next.y!==i.y){const e=i.x+(n-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(e<=r&&e>s&&(s=e,o=i.x<i.next.x?i:i.next,e===r))return o}i=i.next}while(i!==t);if(!o)return null;const a=o,l=o.x,c=o.y;let u=1/0;i=o;do{if(r>=i.x&&i.x>=l&&r!==i.x&&pl(n<c?r:s,n,l,c,n<c?s:r,n,i.x,i.y)){const t=Math.abs(n-i.y)/(r-i.x);xl(i,e)&&(t<u||t===u&&(i.x>o.x||i.x===o.x&&ul(o,i)))&&(o=i,u=t)}i=i.next}while(i!==a);return o}(e,t);if(!i)return t;const r=bl(i,e);return il(r,r.next),il(i,i.next)}function ul(e,t){return ml(e.prev,e,t.prev)<0&&ml(t.next,e,e.next)<0}function hl(e,t,i,r,n){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-i)*n|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-r)*n|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function dl(e){let t=e,i=e;do{(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next}while(t!==e);return i}function pl(e,t,i,r,n,o,s,a){return(n-s)*(t-a)>=(e-s)*(o-a)&&(e-s)*(r-a)>=(i-s)*(t-a)&&(i-s)*(o-a)>=(n-s)*(r-a)}function fl(e,t,i,r,n,o,s,a){return!(e===s&&t===a)&&pl(e,t,i,r,n,o,s,a)}function Al(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){let i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==t.i&&i.next.i!==t.i&&_l(i,i.next,e,t))return!0;i=i.next}while(i!==e);return!1}(e,t)&&(xl(e,t)&&xl(t,e)&&function(e,t){let i=e,r=!1;const n=(e.x+t.x)/2,o=(e.y+t.y)/2;do{i.y>o!=i.next.y>o&&i.next.y!==i.y&&n<(i.next.x-i.x)*(o-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next}while(i!==e);return r}(e,t)&&(ml(e.prev,e,t.prev)||ml(e,t.prev,t))||gl(e,t)&&ml(e.prev,e,e.next)>0&&ml(t.prev,t,t.next)>0)}function ml(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function gl(e,t){return e.x===t.x&&e.y===t.y}function _l(e,t,i,r){const n=vl(ml(e,t,i)),o=vl(ml(e,t,r)),s=vl(ml(i,r,e)),a=vl(ml(i,r,t));return n!==o&&s!==a||!(0!==n||!yl(e,i,t))||!(0!==o||!yl(e,r,t))||!(0!==s||!yl(i,e,r))||!(0!==a||!yl(i,t,r))}function yl(e,t,i){return t.x<=Math.max(e.x,i.x)&&t.x>=Math.min(e.x,i.x)&&t.y<=Math.max(e.y,i.y)&&t.y>=Math.min(e.y,i.y)}function vl(e){return e>0?1:e<0?-1:0}function xl(e,t){return ml(e.prev,e,e.next)<0?ml(e,t,e.next)>=0&&ml(e,e.prev,t)>=0:ml(e,t,e.prev)<0||ml(e,e.next,t)<0}function bl(e,t){const i=Bl(e.i,e.x,e.y),r=Bl(t.i,t.x,t.y),n=e.next,o=t.prev;return e.next=t,t.prev=e,i.next=n,n.prev=i,r.next=i,i.prev=r,o.next=r,r.prev=o,r}function wl(e,t,i,r){const n=Bl(e,t,i);return r?(n.next=r.next,n.prev=r,r.next.prev=n,r.next=n):(n.prev=n,n.next=n),n}function Tl(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Bl(e,t,i){return{i:e,x:t,y:i,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class Cl{constructor(e,t){if(t>e)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=e,this._minGranularity=t}getGranularityForZoomLevel(e){return Math.max(Math.floor(this._baseZoomGranularity/(1<<e)),this._minGranularity,1)}}class Sl{constructor(e){this.fill=e.fill,this.line=e.line,this.tile=e.tile,this.stencil=e.stencil,this.circle=e.circle}}Sl.noSubdivision=new Sl({fill:new Cl(0,0),line:new Cl(0,0),tile:new Cl(0,0),stencil:new Cl(0,0),circle:1}),qn("SubdivisionGranularityExpression",Cl),qn("SubdivisionGranularitySetting",Sl);const El=-32768,Ml=32767;class Il{constructor(e,t){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=e,this._granularityCellSize=E/e,this._canonical=t}_getKey(e,t){return(e+=32768)<<16|(t+=32768)}_vertexToIndex(e,t){if(e<-32768||t<-32768||e>32767||t>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");const i=0|Math.round(e),r=0|Math.round(t),n=this._getKey(i,r);if(this._vertexDictionary.has(n))return this._vertexDictionary.get(n);const o=this._vertexBuffer.length/2;return this._vertexDictionary.set(n,o),this._vertexBuffer.push(i,r),o}_subdivideTrianglesScanline(e){if(this._granularity<2)return function(e,t){const i=[];for(let r=0;r<t.length;r+=3){const n=t[r],o=t[r+1],s=t[r+2],a=e[2*n],l=e[2*n+1];(e[2*o]-a)*(e[2*s+1]-l)-(e[2*o+1]-l)*(e[2*s]-a)>0?(i.push(n),i.push(s),i.push(o)):(i.push(n),i.push(o),i.push(s))}return i}(this._vertexBuffer,e);const t=[],i=e.length;for(let r=0;r<i;r+=3){const i=[e[r+0],e[r+1],e[r+2]],n=[this._vertexBuffer[2*e[r+0]+0],this._vertexBuffer[2*e[r+0]+1],this._vertexBuffer[2*e[r+1]+0],this._vertexBuffer[2*e[r+1]+1],this._vertexBuffer[2*e[r+2]+0],this._vertexBuffer[2*e[r+2]+1]];let o=1/0,s=1/0,a=-1/0,l=-1/0;for(let e=0;e<3;e++){const t=n[2*e],i=n[2*e+1];o=Math.min(o,t),a=Math.max(a,t),s=Math.min(s,i),l=Math.max(l,i)}if(o===a||s===l)continue;const c=Math.floor(o/this._granularityCellSize),u=Math.ceil(a/this._granularityCellSize),h=Math.floor(s/this._granularityCellSize),d=Math.ceil(l/this._granularityCellSize);if(c!==u||h!==d)for(let e=h;e<d;e++){const r=this._scanlineGenerateVertexRingForCellRow(e,n,i);Fl(this._vertexBuffer,r,t)}else t.push(...i)}return t}_scanlineGenerateVertexRingForCellRow(e,t,i){const r=e*this._granularityCellSize,n=r+this._granularityCellSize,o=[];for(let e=0;e<3;e++){const s=t[2*e],a=t[2*e+1],l=t[2*(e+1)%6],c=t[(2*(e+1)+1)%6],u=t[2*(e+2)%6],h=t[(2*(e+2)+1)%6],d=l-s,p=c-a,f=0===d,A=0===p,m=(r-a)/p,g=(n-a)/p,_=Math.min(m,g),y=Math.max(m,g);if(!A&&(_>=1||y<=0)||A&&(a<r||a>n)){c>=r&&c<=n&&o.push(i[(e+1)%3]);continue}!A&&_>0&&o.push(this._vertexToIndex(s+d*_,a+p*_));const v=s+d*Math.max(_,0),x=s+d*Math.min(y,1);f||this._generateIntraEdgeVertices(o,s,a,l,c,v,x),!A&&y<1&&o.push(this._vertexToIndex(s+d*y,a+p*y)),(A||c>=r&&c<=n)&&o.push(i[(e+1)%3]),!A&&(c<=r||c>=n)&&this._generateInterEdgeVertices(o,s,a,l,c,u,h,x,r,n)}return o}_generateIntraEdgeVertices(e,t,i,r,n,o,s){const a=r-t,l=n-i,c=0===l,u=c?Math.min(t,r):Math.min(o,s),h=c?Math.max(t,r):Math.max(o,s),d=Math.floor(u/this._granularityCellSize)+1,p=Math.ceil(h/this._granularityCellSize)-1;if(c?t<r:o<s)for(let r=d;r<=p;r++){const n=r*this._granularityCellSize;e.push(this._vertexToIndex(n,i+l*(n-t)/a))}else for(let r=p;r>=d;r--){const n=r*this._granularityCellSize;e.push(this._vertexToIndex(n,i+l*(n-t)/a))}}_generateInterEdgeVertices(e,t,i,r,n,o,s,a,l,c){const u=n-i,h=o-r,d=s-n,p=(l-n)/d,f=(c-n)/d,A=Math.min(p,f),m=Math.max(p,f),g=r+h*A;let _=Math.floor(Math.min(g,a)/this._granularityCellSize)+1,y=Math.ceil(Math.max(g,a)/this._granularityCellSize)-1,v=a<g;const x=0===d;if(x&&(s===l||s===c))return;if(x||A>=1||m<=0){const e=i-s,r=o+(t-o)*Math.min((l-s)/e,(c-s)/e);_=Math.floor(Math.min(r,a)/this._granularityCellSize)+1,y=Math.ceil(Math.max(r,a)/this._granularityCellSize)-1,v=a<r}const b=u>0?c:l;if(v)for(let t=_;t<=y;t++)e.push(this._vertexToIndex(t*this._granularityCellSize,b));else for(let t=y;t>=_;t--)e.push(this._vertexToIndex(t*this._granularityCellSize,b))}_generateOutline(e){const t=[];for(const i of e){const e=Ll(i,this._granularity,!0),r=this._pointArrayToIndices(e),n=[];for(let e=1;e<r.length;e++)n.push(r[e-1]),n.push(r[e]);t.push(n)}return t}_handlePoles(e){let t=!1,i=!1;this._canonical&&(0===this._canonical.y&&(t=!0),this._canonical.y===(1<<this._canonical.z)-1&&(i=!0)),(t||i)&&this._fillPoles(e,t,i)}_ensureNoPoleVertices(){const e=this._vertexBuffer;for(let t=0;t<e.length;t+=2){const i=e[t+1];i===El&&(e[t+1]=-32767),i===Ml&&(e[t+1]=32766)}}_generatePoleQuad(e,t,i,r,n,o){r>n!=(o===El)?(e.push(t),e.push(i),e.push(this._vertexToIndex(r,o)),e.push(i),e.push(this._vertexToIndex(n,o)),e.push(this._vertexToIndex(r,o))):(e.push(i),e.push(t),e.push(this._vertexToIndex(r,o)),e.push(this._vertexToIndex(n,o)),e.push(i),e.push(this._vertexToIndex(r,o)))}_fillPoles(e,t,i){const r=this._vertexBuffer,n=E,o=e.length;for(let s=2;s<o;s+=3){const o=e[s-2],a=e[s-1],l=e[s],c=r[2*o],u=r[2*o+1],h=r[2*a],d=r[2*a+1],p=r[2*l],f=r[2*l+1];t&&(0===u&&0===d&&this._generatePoleQuad(e,o,a,c,h,El),0===d&&0===f&&this._generatePoleQuad(e,a,l,h,p,El),0===f&&0===u&&this._generatePoleQuad(e,l,o,p,c,El)),i&&(u===n&&d===n&&this._generatePoleQuad(e,o,a,c,h,Ml),d===n&&f===n&&this._generatePoleQuad(e,a,l,h,p,Ml),f===n&&u===n&&this._generatePoleQuad(e,l,o,p,c,Ml))}}_initializeVertices(e){for(let t=0;t<e.length;t+=2)this._vertexToIndex(e[t],e[t+1])}subdividePolygonInternal(e,t){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;const{flattened:i,holeIndices:r}=function(e){const t=[],i=[];for(const r of e)if(0!==r.length){r!==e[0]&&t.push(i.length/2);for(let e=0;e<r.length;e++)i.push(r[e].x),i.push(r[e].y)}return{flattened:i,holeIndices:t}}(e);let n;this._initializeVertices(i);try{const e=function(e,t,i=2){const r=t&&t.length,n=r?t[0]*i:e.length;let o=tl(e,0,n,i,!0);const s=[];if(!o||o.next===o.prev)return s;let a,l,c;if(r&&(o=function(e,t,i,r){const n=[];for(let i=0,o=t.length;i<o;i++){const s=tl(e,t[i]*r,i<o-1?t[i+1]*r:e.length,r,!1);s===s.next&&(s.steiner=!0),n.push(dl(s))}n.sort(ll);for(let e=0;e<n.length;e++)i=cl(n[e],i);return i}(e,t,o,i)),e.length>80*i){a=1/0,l=1/0;let t=-1/0,r=-1/0;for(let o=i;o<n;o+=i){const i=e[o],n=e[o+1];i<a&&(a=i),n<l&&(l=n),i>t&&(t=i),n>r&&(r=n)}c=Math.max(t-a,r-l),c=0!==c?32767/c:0}return rl(o,s,i,a,l,c,0),s}(i,r),t=this._convertIndices(i,e);n=this._subdivideTrianglesScanline(t)}catch(e){console.error(e)}let o=[];return t&&(o=this._generateOutline(e)),this._ensureNoPoleVertices(),this._handlePoles(n),{verticesFlattened:this._vertexBuffer,indicesTriangles:n,indicesLineList:o}}_convertIndices(e,t){const i=[];for(let r=0;r<t.length;r++)i.push(this._vertexToIndex(e[2*t[r]],e[2*t[r]+1]));return i}_pointArrayToIndices(e){const t=[];for(let i=0;i<e.length;i++){const r=e[i];t.push(this._vertexToIndex(r.x,r.y))}return t}}function Pl(e,t,i,r=!0){return new Il(i,t).subdividePolygonInternal(e,r)}function Ll(e,t,i=!1){if(!e||e.length<1)return[];if(e.length<2)return[];const r=e[0],n=e[e.length-1],o=i&&(r.x!==n.x||r.y!==n.y);if(t<2)return o?[...e,e[0]]:[...e];const s=Math.floor(E/t),a=[];a.push(new l(e[0].x,e[0].y));const c=e.length,u=o?c:c-1;for(let t=0;t<u;t++){const i=e[t],r=t<c-1?e[t+1]:e[0],n=i.x,o=i.y,u=r.x,h=r.y,d=n!==u,p=o!==h;if(!d&&!p)continue;const f=u-n,A=h-o,m=Math.abs(f),g=Math.abs(A);let _=n,y=o;for(;;){const e=f>0?(Math.floor(_/s)+1)*s:(Math.ceil(_/s)-1)*s,t=A>0?(Math.floor(y/s)+1)*s:(Math.ceil(y/s)-1)*s,i=Math.abs(_-e),r=Math.abs(y-t),n=Math.abs(_-u),o=Math.abs(y-h),c=d?i/m:Number.POSITIVE_INFINITY,v=p?r/g:Number.POSITIVE_INFINITY;if((n<=i||!d)&&(o<=r||!p))break;if(c<v&&d||!p){_=e,y+=A*c;const t=new l(_,Math.round(y));a[a.length-1].x===t.x&&a[a.length-1].y===t.y||a.push(t)}else{_+=f*v,y=t;const e=new l(Math.round(_),y);a[a.length-1].x===e.x&&a[a.length-1].y===e.y||a.push(e)}}const v=new l(u,h);a[a.length-1].x===v.x&&a[a.length-1].y===v.y||a.push(v)}return a}function Fl(e,t,i){if(0===t.length)throw new Error("Subdivision vertex ring is empty.");let r=0,n=e[2*t[0]];for(let i=1;i<t.length;i++){const o=e[2*t[i]];o<n&&(n=o,r=i)}const o=t.length;let s=r,a=(s+1)%o;for(;;){const r=s-1>=0?s-1:o-1,n=(a+1)%o,l=e[2*t[r]],c=e[2*t[n]],u=e[2*t[s]],h=e[2*t[s]+1],d=e[2*t[a]+1];let p=!1;if(l<c)p=!0;else if(l>c)p=!1;else{const i=d-h,o=-(e[2*t[a]]-u),s=h<d?1:-1;((l-u)*i+(e[2*t[r]+1]-h)*o)*s>((c-u)*i+(e[2*t[n]+1]-h)*o)*s&&(p=!0)}if(p){const e=t[r],n=t[s],l=t[a];e!==n&&e!==l&&n!==l&&i.push(l,n,e),s--,s<0&&(s=o-1)}else{const e=t[n],r=t[s],l=t[a];e!==r&&e!==l&&r!==l&&i.push(l,r,e),a++,a>=o&&(a=0)}if(r===n)break}}function kl(e,t,i,r,n,o,s,a,l){const c=n.length/2,u=s&&a&&l;if(c<zs.MAX_VERTEX_ARRAY_LENGTH){const h=t.prepareSegment(c,i,r),d=h.vertexLength;for(let e=0;e<o.length;e+=3)r.emplaceBack(d+o[e],d+o[e+1],d+o[e+2]);let p,f;h.vertexLength+=c,h.primitiveLength+=o.length/3,u&&(f=s.prepareSegment(c,i,a),p=f.vertexLength,f.vertexLength+=c);for(let t=0;t<n.length;t+=2)e(n[t],n[t+1]);if(u)for(let e=0;e<l.length;e++){const t=l[e];for(let e=1;e<t.length;e+=2)a.emplaceBack(p+t[e-1],p+t[e]);f.primitiveLength+=t.length/2}}else!function(e,t,i,r,n,o){const s=[];for(let e=0;e<r.length/2;e++)s.push(-1);const a={count:0};let l=0,c=e.getOrCreateLatestSegment(t,i),u=c.vertexLength;for(let h=2;h<n.length;h+=3){const d=n[h-2],p=n[h-1],f=n[h];let A=s[d]<l,m=s[p]<l,g=s[f]<l;c.vertexLength+((A?1:0)+(m?1:0)+(g?1:0))>zs.MAX_VERTEX_ARRAY_LENGTH&&(c=e.createNewSegment(t,i),l=a.count,A=!0,m=!0,g=!0,u=0);const _=zl(s,r,o,a,d,A,c),y=zl(s,r,o,a,p,m,c),v=zl(s,r,o,a,f,g,c);i.emplaceBack(u+_-l,u+y-l,u+v-l),c.primitiveLength++}}(t,i,r,n,o,e),u&&function(e,t,i,r,n,o){const s=[];for(let e=0;e<r.length/2;e++)s.push(-1);const a={count:0};let l=0,c=e.getOrCreateLatestSegment(t,i),u=c.vertexLength;for(let h=0;h<n.length;h++){const d=n[h];for(let p=1;p<n[h].length;p+=2){const n=d[p-1],h=d[p];let f=s[n]<l,A=s[h]<l;c.vertexLength+((f?1:0)+(A?1:0))>zs.MAX_VERTEX_ARRAY_LENGTH&&(c=e.createNewSegment(t,i),l=a.count,f=!0,A=!0,u=0);const m=zl(s,r,o,a,n,f,c),g=zl(s,r,o,a,h,A,c);i.emplaceBack(u+m-l,u+g-l),c.primitiveLength++}}}(s,i,a,n,l,e),t.forceNewSegmentOnNextPrepare(),null==s||s.forceNewSegmentOnNextPrepare()}function zl(e,t,i,r,n,o,s){if(o){const o=r.count;return i(t[2*n],t[2*n+1]),e[n]=r.count,r.count++,s.vertexLength++,o}return e[n]}class Rl{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.id)),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new xs,this.indexArray=new Ps,this.indexArray2=new Ls,this.programConfigurations=new la(e.layers,e.zoom),this.segments=new zs,this.segments2=new zs,this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id))}populate(e,t,i){this.hasPattern=Ja("fill",this.layers,t);const r=this.layers[0].layout.get("fill-sort-key"),n=!r.isConstant(),o=[];for(const{feature:s,id:a,index:l,sourceLayerIndex:c}of e){const e=this.layers[0]._featureFilter.needGeometry,u=fa(s,e);if(!this.layers[0]._featureFilter.filter(new mo(this.zoom),u,i))continue;const h=n?r.evaluate(u,{},i,t.availableImages):void 0,d={id:a,properties:s.properties,type:s.type,sourceLayerIndex:c,index:l,geometry:e?u.geometry:pa(s),patterns:{},sortKey:h};o.push(d)}n&&o.sort(((e,t)=>e.sortKey-t.sortKey));for(const r of o){const{geometry:n,index:o,sourceLayerIndex:s}=r;if(this.hasPattern){const e=el("fill",this.layers,r,this.zoom,t);this.patternFeatures.push(e)}else this.addFeature(r,n,o,i,{},t.subdivisionGranularity);t.featureIndex.insert(e[o].feature,n,o,s,this.index)}}update(e,t,i){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,i)}addFeatures(e,t,i){for(const r of this.patternFeatures)this.addFeature(r,r.geometry,r.index,t,i,e.subdivisionGranularity)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Ya),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,t,i,r,n,o){for(const e of Gi(t,500)){const t=Pl(e,r,o.fill.getGranularityForZoomLevel(r.z)),i=this.layoutVertexArray;kl(((e,t)=>{i.emplaceBack(e,t)}),this.segments,this.layoutVertexArray,this.indexArray,t.verticesFlattened,t.indicesTriangles,this.segments2,this.indexArray2,t.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,n,r)}}let Dl,Ol;qn("FillBucket",Rl,{omit:["layers","patternFeatures"]});var Ul={get paint(){return Ol=Ol||new Io({"fill-antialias":new Bo(me.paint_fill["fill-antialias"]),"fill-opacity":new Co(me.paint_fill["fill-opacity"]),"fill-color":new Co(me.paint_fill["fill-color"]),"fill-outline-color":new Co(me.paint_fill["fill-outline-color"]),"fill-translate":new Bo(me.paint_fill["fill-translate"]),"fill-translate-anchor":new Bo(me.paint_fill["fill-translate-anchor"]),"fill-pattern":new So(me.paint_fill["fill-pattern"])})},get layout(){return Dl=Dl||new Io({"fill-sort-key":new Co(me.layout_fill["fill-sort-key"])})}};class Nl extends Lo{constructor(e){super(e,Ul)}recalculate(e,t){super.recalculate(e,t);const i=this.paint._values["fill-outline-color"];"constant"===i.value.kind&&void 0===i.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new Rl(e)}queryRadius(){return Ia(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:e,geometry:t,transform:i,pixelsToTileUnits:r}){return va(Pa(e,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-i.bearingInRadians,r),t)}isTileClipped(){return!0}}const Ql=Ro([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),jl=Ro([{name:"a_centroid",components:2,type:"Int16"}],4),{members:Vl}=Ql;var Hl,Gl,$l,Zl,ql,Kl,Wl,Xl={};function Yl(){if(Gl)return Hl;Gl=1;var e=o();function t(e,t,r,n,o){this.properties={},this.extent=r,this.type=0,this._pbf=e,this._geometry=-1,this._keys=n,this._values=o,e.readFields(i,this,t)}function i(e,t,i){1==e?t.id=i.readVarint():2==e?function(e,t){for(var i=e.readVarint()+e.pos;e.pos<i;){var r=t._keys[e.readVarint()],n=t._values[e.readVarint()];t.properties[r]=n}}(i,t):3==e?t.type=i.readVarint():4==e&&(t._geometry=i.pos)}function r(e){for(var t,i,r=0,n=0,o=e.length,s=o-1;n<o;s=n++)r+=((i=e[s]).x-(t=e[n]).x)*(t.y+i.y);return r}return Hl=t,t.types=["Unknown","Point","LineString","Polygon"],t.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var i,r=t.readVarint()+t.pos,n=1,o=0,s=0,a=0,l=[];t.pos<r;){if(o<=0){var c=t.readVarint();n=7&c,o=c>>3}if(o--,1===n||2===n)s+=t.readSVarint(),a+=t.readSVarint(),1===n&&(i&&l.push(i),i=[]),i.push(new e(s,a));else{if(7!==n)throw new Error("unknown command "+n);i&&i.push(i[0].clone())}}return i&&l.push(i),l},t.prototype.bbox=function(){var e=this._pbf;e.pos=this._geometry;for(var t=e.readVarint()+e.pos,i=1,r=0,n=0,o=0,s=1/0,a=-1/0,l=1/0,c=-1/0;e.pos<t;){if(r<=0){var u=e.readVarint();i=7&u,r=u>>3}if(r--,1===i||2===i)(n+=e.readSVarint())<s&&(s=n),n>a&&(a=n),(o+=e.readSVarint())<l&&(l=o),o>c&&(c=o);else if(7!==i)throw new Error("unknown command "+i)}return[s,l,a,c]},t.prototype.toGeoJSON=function(e,i,n){var o,s,a=this.extent*Math.pow(2,n),l=this.extent*e,c=this.extent*i,u=this.loadGeometry(),h=t.types[this.type];function d(e){for(var t=0;t<e.length;t++){var i=e[t];e[t]=[360*(i.x+l)/a-180,360/Math.PI*Math.atan(Math.exp((180-360*(i.y+c)/a)*Math.PI/180))-90]}}switch(this.type){case 1:var p=[];for(o=0;o<u.length;o++)p[o]=u[o][0];d(u=p);break;case 2:for(o=0;o<u.length;o++)d(u[o]);break;case 3:for(u=function(e){var t=e.length;if(t<=1)return[e];for(var i,n,o=[],s=0;s<t;s++){var a=r(e[s]);0!==a&&(void 0===n&&(n=a<0),n===a<0?(i&&o.push(i),i=[e[s]]):i.push(e[s]))}return i&&o.push(i),o}(u),o=0;o<u.length;o++)for(s=0;s<u[o].length;s++)d(u[o][s])}1===u.length?u=u[0]:h="Multi"+h;var f={type:"Feature",geometry:{type:h,coordinates:u},properties:this.properties};return"id"in this&&(f.id=this.id),f},Hl}function Jl(){if(Zl)return $l;Zl=1;var e=Yl();function t(e,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(i,this,t),this.length=this._features.length}function i(e,t,i){15===e?t.version=i.readVarint():1===e?t.name=i.readString():5===e?t.extent=i.readVarint():2===e?t._features.push(i.pos):3===e?t._keys.push(i.readString()):4===e&&t._values.push(function(e){for(var t=null,i=e.readVarint()+e.pos;e.pos<i;){var r=e.readVarint()>>3;t=1===r?e.readString():2===r?e.readFloat():3===r?e.readDouble():4===r?e.readVarint64():5===r?e.readVarint():6===r?e.readSVarint():7===r?e.readBoolean():null}return t}(i))}return $l=t,t.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var i=this._pbf.readVarint()+this._pbf.pos;return new e(this._pbf,i,this.extent,this._keys,this._values)},$l}function ec(){return Wl||(Wl=1,Xl.VectorTile=function(){if(Kl)return ql;Kl=1;var e=Jl();function t(t,i,r){if(3===t){var n=new e(r,r.readVarint()+r.pos);n.length&&(i[n.name]=n)}}return ql=function(e,i){this.layers=e.readFields(t,{},i)},ql}(),Xl.VectorTileFeature=Yl(),Xl.VectorTileLayer=Jl()),Xl}var tc=i(ec());const ic=tc.VectorTileFeature.types,rc=Math.pow(2,13);function nc(e,t,i,r,n,o,s,a){e.emplaceBack(t,i,2*Math.floor(r*rc)+s,n*rc*2,o*rc*2,Math.round(a))}class oc{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.id)),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new bs,this.centroidVertexArray=new ys,this.indexArray=new Ps,this.programConfigurations=new la(e.layers,e.zoom),this.segments=new zs,this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id))}populate(e,t,i){this.features=[],this.hasPattern=Ja("fill-extrusion",this.layers,t);for(const{feature:r,id:n,index:o,sourceLayerIndex:s}of e){const e=this.layers[0]._featureFilter.needGeometry,a=fa(r,e);if(!this.layers[0]._featureFilter.filter(new mo(this.zoom),a,i))continue;const l={id:n,sourceLayerIndex:s,index:o,geometry:e?a.geometry:pa(r),properties:r.properties,type:r.type,patterns:{}};this.hasPattern?this.features.push(el("fill-extrusion",this.layers,l,this.zoom,t)):this.addFeature(l,l.geometry,o,i,{},t.subdivisionGranularity),t.featureIndex.insert(r,l.geometry,o,s,this.index,!0)}}addFeatures(e,t,i){for(const r of this.features){const{geometry:n}=r;this.addFeature(r,n,r.index,t,i,e.subdivisionGranularity)}}update(e,t,i){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,i)}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.centroidVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Vl),this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,jl.members,!0),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(e,t,i,r,n,o){for(const i of Gi(t,500)){const t={x:0,y:0,sampleCount:0},n=this.layoutVertexArray.length;this.processPolygon(t,r,e,i,o);const s=this.layoutVertexArray.length-n,a=Math.floor(t.x/t.sampleCount),l=Math.floor(t.y/t.sampleCount);for(let e=0;e<s;e++)this.centroidVertexArray.emplaceBack(a,l)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,n,r)}processPolygon(e,t,i,r,n){if(r.length<1)return;if(lc(r[0]))return;for(const t of r)0!==t.length&&sc(e,t);const o={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},s=n.fill.getGranularityForZoomLevel(t.z),a="Polygon"===ic[i.type];for(const e of r){if(0===e.length)continue;if(lc(e))continue;const t=Ll(e,s,a);this._generateSideFaces(t,o)}if(!a)return;const l=Pl(r,t,s,!1),c=this.layoutVertexArray;kl(((e,t)=>{nc(c,e,t,0,0,1,1,0)}),this.segments,this.layoutVertexArray,this.indexArray,l.verticesFlattened,l.indicesTriangles)}_generateSideFaces(e,t){let i=0;for(let r=1;r<e.length;r++){const n=e[r],o=e[r-1];if(ac(n,o))continue;t.segment.vertexLength+4>zs.MAX_VERTEX_ARRAY_LENGTH&&(t.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const s=n.sub(o)._perp()._unit(),a=o.dist(n);i+a>32768&&(i=0),nc(this.layoutVertexArray,n.x,n.y,s.x,s.y,0,0,i),nc(this.layoutVertexArray,n.x,n.y,s.x,s.y,0,1,i),i+=a,nc(this.layoutVertexArray,o.x,o.y,s.x,s.y,0,0,i),nc(this.layoutVertexArray,o.x,o.y,s.x,s.y,0,1,i);const l=t.segment.vertexLength;this.indexArray.emplaceBack(l,l+2,l+1),this.indexArray.emplaceBack(l+1,l+2,l+3),t.segment.vertexLength+=4,t.segment.primitiveLength+=2}}}function sc(e,t){for(let i=0;i<t.length;i++){const r=t[i];i===t.length-1&&t[0].x===r.x&&t[0].y===r.y||(e.x+=r.x,e.y+=r.y,e.sampleCount++)}}function ac(e,t){return e.x===t.x&&(e.x<0||e.x>E)||e.y===t.y&&(e.y<0||e.y>E)}function lc(e){return e.every((e=>e.x<0))||e.every((e=>e.x>E))||e.every((e=>e.y<0))||e.every((e=>e.y>E))}let cc;qn("FillExtrusionBucket",oc,{omit:["layers","features"]});var uc={get paint(){return cc=cc||new Io({"fill-extrusion-opacity":new Bo(me["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Co(me["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Bo(me["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Bo(me["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new So(me["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Co(me["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Co(me["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Bo(me["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class hc extends Lo{constructor(e){super(e,uc)}createBucket(e){return new oc(e)}queryRadius(){return Ia(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:e,feature:t,featureState:i,geometry:r,transform:n,pixelsToTileUnits:o,pixelPosMatrix:s}){const a=Pa(e,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-n.bearingInRadians,o),c=this.paint.get("fill-extrusion-height").evaluate(t,i),u=this.paint.get("fill-extrusion-base").evaluate(t,i),h=function(e,t){const i=[];for(const r of e){const e=[r.x,r.y,0,1];T(e,e,t),i.push(new l(e[0]/e[3],e[1]/e[3]))}return i}(a,s),d=function(e,t,i,r){const n=[],o=[],s=r[8]*t,a=r[9]*t,c=r[10]*t,u=r[11]*t,h=r[8]*i,d=r[9]*i,p=r[10]*i,f=r[11]*i;for(const t of e){const e=[],i=[];for(const n of t){const t=n.x,o=n.y,A=r[0]*t+r[4]*o+r[12],m=r[1]*t+r[5]*o+r[13],g=r[2]*t+r[6]*o+r[14],_=r[3]*t+r[7]*o+r[15],y=g+c,v=_+u,x=A+h,b=m+d,w=g+p,T=_+f,B=new l((A+s)/v,(m+a)/v);B.z=y/v,e.push(B);const C=new l(x/T,b/T);C.z=w/T,i.push(C)}n.push(e),o.push(i)}return[n,o]}(r,u,c,s);return function(e,t,i){let r=1/0;va(i,t)&&(r=pc(i,t[0]));for(let n=0;n<t.length;n++){const o=t[n],s=e[n];for(let e=0;e<o.length-1;e++){const t=o[e],n=[t,o[e+1],s[e+1],s[e],t];_a(i,n)&&(r=Math.min(r,pc(i,n)))}}return r!==1/0&&r}(d[0],d[1],h)}}function dc(e,t){return e.x*t.x+e.y*t.y}function pc(e,t){if(1===e.length){let i=0;const r=t[i++];let n;for(;!n||r.equals(n);)if(n=t[i++],!n)return 1/0;for(;i<t.length;i++){const o=t[i],s=e[0],a=n.sub(r),l=o.sub(r),c=s.sub(r),u=dc(a,a),h=dc(a,l),d=dc(l,l),p=dc(c,a),f=dc(c,l),A=u*d-h*h,m=(d*p-h*f)/A,g=(u*f-h*p)/A,_=r.z*(1-m-g)+n.z*m+o.z*g;if(isFinite(_))return _}return 1/0}{let e=1/0;for(const i of t)e=Math.min(e,i.z);return e}}const fc=Ro([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Ac}=fc,mc=Ro([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:gc}=mc,_c=tc.VectorTileFeature.types,yc=Math.cos(Math.PI/180*37.5),vc=Math.pow(2,14)/.5;class xc{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.id)),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((e=>{this.gradients[e.id]={}})),this.layoutVertexArray=new ws,this.layoutVertexArray2=new Ts,this.indexArray=new Ps,this.programConfigurations=new la(e.layers,e.zoom),this.segments=new zs,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id))}populate(e,t,i){this.hasPattern=Ja("line",this.layers,t);const r=this.layers[0].layout.get("line-sort-key"),n=!r.isConstant(),o=[];for(const{feature:t,id:s,index:a,sourceLayerIndex:l}of e){const e=this.layers[0]._featureFilter.needGeometry,c=fa(t,e);if(!this.layers[0]._featureFilter.filter(new mo(this.zoom),c,i))continue;const u=n?r.evaluate(c,{},i):void 0,h={id:s,properties:t.properties,type:t.type,sourceLayerIndex:l,index:a,geometry:e?c.geometry:pa(t),patterns:{},sortKey:u};o.push(h)}n&&o.sort(((e,t)=>e.sortKey-t.sortKey));for(const r of o){const{geometry:n,index:o,sourceLayerIndex:s}=r;if(this.hasPattern){const e=el("line",this.layers,r,this.zoom,t);this.patternFeatures.push(e)}else this.addFeature(r,n,o,i,{},t.subdivisionGranularity);t.featureIndex.insert(e[o].feature,n,o,s,this.index)}}update(e,t,i){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,i)}addFeatures(e,t,i){for(const r of this.patternFeatures)this.addFeature(r,r.geometry,r.index,t,i,e.subdivisionGranularity)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,gc)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Ac),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,t,i,r,n,o){const s=this.layers[0].layout,a=s.get("line-join").evaluate(e,{}),l=s.get("line-cap"),c=s.get("line-miter-limit"),u=s.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const i of t)this.addLine(i,e,a,l,c,u,r,o);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,n,r)}addLine(e,t,i,r,n,o,s,a){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,e=Ll(e,s?a.line.getGranularityForZoomLevel(s.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let t=0;t<e.length-1;t++)this.totalDistance+=e[t].dist(e[t+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const l="Polygon"===_c[t.type];let c=e.length;for(;c>=2&&e[c-1].equals(e[c-2]);)c--;let u=0;for(;u<c-1&&e[u].equals(e[u+1]);)u++;if(c<(l?3:2))return;"bevel"===i&&(n=1.05);const h=this.overscaling<=16?15*E/(512*this.overscaling):0,d=this.segments.prepareSegment(10*c,this.layoutVertexArray,this.indexArray);let p,f,A,m,g;this.e1=this.e2=-1,l&&(p=e[c-2],g=e[u].sub(p)._unit()._perp());for(let t=u;t<c;t++){if(A=t===c-1?l?e[u+1]:void 0:e[t+1],A&&e[t].equals(A))continue;g&&(m=g),p&&(f=p),p=e[t],g=A?A.sub(p)._unit()._perp():m,m=m||g;let s=m.add(g);0===s.x&&0===s.y||s._unit();const a=m.x*g.x+m.y*g.y,_=s.x*g.x+s.y*g.y,y=0!==_?1/_:1/0,v=2*Math.sqrt(2-2*_),x=_<yc&&f&&A,b=m.x*g.y-m.y*g.x>0;if(x&&t>u){const e=p.dist(f);if(e>2*h){const t=p.sub(p.sub(f)._mult(h/e)._round());this.updateDistance(f,t),this.addCurrentVertex(t,m,0,0,d),f=t}}const w=f&&A;let T=w?i:l?"butt":r;if(w&&"round"===T&&(y<o?T="miter":y<=2&&(T="fakeround")),"miter"===T&&y>n&&(T="bevel"),"bevel"===T&&(y>2&&(T="flipbevel"),y<n&&(T="miter")),f&&this.updateDistance(f,p),"miter"===T)s._mult(y),this.addCurrentVertex(p,s,0,0,d);else if("flipbevel"===T){if(y>100)s=g.mult(-1);else{const e=y*m.add(g).mag()/m.sub(g).mag();s._perp()._mult(e*(b?-1:1))}this.addCurrentVertex(p,s,0,0,d),this.addCurrentVertex(p,s.mult(-1),0,0,d)}else if("bevel"===T||"fakeround"===T){const e=-Math.sqrt(y*y-1),t=b?e:0,i=b?0:e;if(f&&this.addCurrentVertex(p,m,t,i,d),"fakeround"===T){const e=Math.round(180*v/Math.PI/20);for(let t=1;t<e;t++){let i=t/e;if(.5!==i){const e=i-.5;i+=i*e*(i-1)*((1.0904+a*(a*(3.55645-1.43519*a)-3.2452))*e*e+(.848013+a*(.215638*a-1.06021)))}const r=g.sub(m)._mult(i)._add(m)._unit()._mult(b?-1:1);this.addHalfVertex(p,r.x,r.y,!1,b,0,d)}}A&&this.addCurrentVertex(p,g,-t,-i,d)}else if("butt"===T)this.addCurrentVertex(p,s,0,0,d);else if("square"===T){const e=f?1:-1;this.addCurrentVertex(p,s,e,e,d)}else"round"===T&&(f&&(this.addCurrentVertex(p,m,0,0,d),this.addCurrentVertex(p,m,1,1,d,!0)),A&&(this.addCurrentVertex(p,g,-1,-1,d,!0),this.addCurrentVertex(p,g,0,0,d)));if(x&&t<c-1){const e=p.dist(A);if(e>2*h){const t=p.add(A.sub(p)._mult(h/e)._round());this.updateDistance(p,t),this.addCurrentVertex(t,g,0,0,d),p=t}}}}addCurrentVertex(e,t,i,r,n,o=!1){const s=t.y*r-t.x,a=-t.y-t.x*r;this.addHalfVertex(e,t.x+t.y*i,t.y-t.x*i,o,!1,i,n),this.addHalfVertex(e,s,a,o,!0,-r,n),this.distance>vc/2&&0===this.totalDistance&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(e,t,i,r,n,o))}addHalfVertex({x:e,y:t},i,r,n,o,s,a){const l=.5*(this.lineClips?this.scaledDistance*(vc-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((e<<1)+(n?1:0),(t<<1)+(o?1:0),Math.round(63*i)+128,Math.round(63*r)+128,1+(0===s?0:s<0?-1:1)|(63&l)<<2,l>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const c=a.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,c,this.e2),a.primitiveLength++),o?this.e2=c:this.e1=c}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(e,t){this.distance+=e.dist(t),this.updateScaledDistance()}}let bc,wc;qn("LineBucket",xc,{omit:["layers","patternFeatures"]});var Tc={get paint(){return wc=wc||new Io({"line-opacity":new Co(me.paint_line["line-opacity"]),"line-color":new Co(me.paint_line["line-color"]),"line-translate":new Bo(me.paint_line["line-translate"]),"line-translate-anchor":new Bo(me.paint_line["line-translate-anchor"]),"line-width":new Co(me.paint_line["line-width"]),"line-gap-width":new Co(me.paint_line["line-gap-width"]),"line-offset":new Co(me.paint_line["line-offset"]),"line-blur":new Co(me.paint_line["line-blur"]),"line-dasharray":new Eo(me.paint_line["line-dasharray"]),"line-pattern":new So(me.paint_line["line-pattern"]),"line-gradient":new Mo(me.paint_line["line-gradient"])})},get layout(){return bc=bc||new Io({"line-cap":new Bo(me.layout_line["line-cap"]),"line-join":new Co(me.layout_line["line-join"]),"line-miter-limit":new Bo(me.layout_line["line-miter-limit"]),"line-round-limit":new Bo(me.layout_line["line-round-limit"]),"line-sort-key":new Co(me.layout_line["line-sort-key"])})}};class Bc extends Co{possiblyEvaluate(e,t){return t=new mo(Math.floor(t.zoom),{now:t.now,fadeDuration:t.fadeDuration,zoomHistory:t.zoomHistory,transition:t.transition}),super.possiblyEvaluate(e,t)}evaluate(e,t,i,r){return t=D({},t,{zoom:Math.floor(t.zoom)}),super.evaluate(e,t,i,r)}}let Cc;class Sc extends Lo{constructor(e){super(e,Tc),this.gradientVersion=0,Cc||(Cc=new Bc(Tc.paint.properties["line-width"].specification),Cc.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(e){if("line-gradient"===e){const e=this.gradientExpression();this.stepInterpolant=!!function(e){return void 0!==e._styleExpression}(e)&&e._styleExpression.expression instanceof Yt,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(e,t){super.recalculate(e,t),this.paint._values["line-floorwidth"]=Cc.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new xc(e)}queryRadius(e){const t=e,i=Ec(Ma("line-width",this,t),Ma("line-gap-width",this,t)),r=Ma("line-offset",this,t);return i/2+Math.abs(r)+Ia(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:e,feature:t,featureState:i,geometry:r,transform:n,pixelsToTileUnits:o}){const s=Pa(e,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-n.bearingInRadians,o),a=o/2*Ec(this.paint.get("line-width").evaluate(t,i),this.paint.get("line-gap-width").evaluate(t,i)),c=this.paint.get("line-offset").evaluate(t,i);return c&&(r=function(e,t){const i=[];for(let r=0;r<e.length;r++){const n=e[r],o=[];for(let e=0;e<n.length;e++){const i=n[e-1],r=n[e],s=n[e+1],a=0===e?new l(0,0):r.sub(i)._unit()._perp(),c=e===n.length-1?new l(0,0):s.sub(r)._unit()._perp(),u=a._add(c)._unit(),h=u.x*c.x+u.y*c.y;0!==h&&u._mult(1/h),o.push(u._mult(t)._add(r))}i.push(o)}return i}(r,c*o)),function(e,t,i){for(let r=0;r<t.length;r++){const n=t[r];if(e.length>=3)for(let t=0;t<n.length;t++)if(Sa(e,n[t]))return!0;if(xa(e,n,i))return!0}return!1}(s,r,a)}isTileClipped(){return!0}}function Ec(e,t){return t>0?t+2*e:e}const Mc=Ro([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Ic=Ro([{name:"a_projected_pos",components:3,type:"Float32"}],4);Ro([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Pc=Ro([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);Ro([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Lc=Ro([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Fc=Ro([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function kc(e,t,i){return e.sections.forEach((e=>{e.text=function(e,t,i){const r=t.layout.get("text-transform").evaluate(i,{});return"uppercase"===r?e=e.toLocaleUpperCase():"lowercase"===r&&(e=e.toLocaleLowerCase()),Ao.applyArabicShaping&&(e=Ao.applyArabicShaping(e)),e}(e.text,t,i)})),e}Ro([{name:"triangle",components:3,type:"Uint16"}]),Ro([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Ro([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),Ro([{type:"Float32",name:"offsetX"}]),Ro([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),Ro([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const zc={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var Rc,Dc,Oc,Uc=24,Nc={};function Qc(){return Rc||(Rc=1,Nc.read=function(e,t,i,r,n){var o,s,a=8*n-r-1,l=(1<<a)-1,c=l>>1,u=-7,h=i?n-1:0,d=i?-1:1,p=e[t+h];for(h+=d,o=p&(1<<-u)-1,p>>=-u,u+=a;u>0;o=256*o+e[t+h],h+=d,u-=8);for(s=o&(1<<-u)-1,o>>=-u,u+=r;u>0;s=256*s+e[t+h],h+=d,u-=8);if(0===o)o=1-c;else{if(o===l)return s?NaN:1/0*(p?-1:1);s+=Math.pow(2,r),o-=c}return(p?-1:1)*s*Math.pow(2,o-r)},Nc.write=function(e,t,i,r,n,o){var s,a,l,c=8*o-n-1,u=(1<<c)-1,h=u>>1,d=23===n?Math.pow(2,-24)-Math.pow(2,-77):0,p=r?0:o-1,f=r?1:-1,A=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,s=u):(s=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-s))<1&&(s--,l*=2),(t+=s+h>=1?d/l:d*Math.pow(2,1-h))*l>=2&&(s++,l/=2),s+h>=u?(a=0,s=u):s+h>=1?(a=(t*l-1)*Math.pow(2,n),s+=h):(a=t*Math.pow(2,h-1)*Math.pow(2,n),s=0));n>=8;e[i+p]=255&a,p+=f,a/=256,n-=8);for(s=s<<n|a,c+=n;c>0;e[i+p]=255&s,p+=f,s/=256,c-=8);e[i+p-f]|=128*A}),Nc}function jc(){if(Oc)return Dc;Oc=1,Dc=t;var e=Qc();function t(e){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(e)?e:new Uint8Array(e||0),this.pos=0,this.type=0,this.length=this.buf.length}t.Varint=0,t.Fixed64=1,t.Bytes=2,t.Fixed32=5;var i=4294967296,r=1/i,n="undefined"==typeof TextDecoder?null:new TextDecoder("utf-8");function o(e){return e.type===t.Bytes?e.readVarint()+e.pos:e.pos+1}function s(e,t,i){return i?4294967296*t+(e>>>0):4294967296*(t>>>0)+(e>>>0)}function a(e,t,i){var r=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));i.realloc(r);for(var n=i.pos-1;n>=e;n--)i.buf[n+r]=i.buf[n]}function l(e,t){for(var i=0;i<e.length;i++)t.writeVarint(e[i])}function c(e,t){for(var i=0;i<e.length;i++)t.writeSVarint(e[i])}function u(e,t){for(var i=0;i<e.length;i++)t.writeFloat(e[i])}function h(e,t){for(var i=0;i<e.length;i++)t.writeDouble(e[i])}function d(e,t){for(var i=0;i<e.length;i++)t.writeBoolean(e[i])}function p(e,t){for(var i=0;i<e.length;i++)t.writeFixed32(e[i])}function f(e,t){for(var i=0;i<e.length;i++)t.writeSFixed32(e[i])}function A(e,t){for(var i=0;i<e.length;i++)t.writeFixed64(e[i])}function m(e,t){for(var i=0;i<e.length;i++)t.writeSFixed64(e[i])}function g(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+16777216*e[t+3]}function _(e,t,i){e[i]=t,e[i+1]=t>>>8,e[i+2]=t>>>16,e[i+3]=t>>>24}function y(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+(e[t+3]<<24)}return t.prototype={destroy:function(){this.buf=null},readFields:function(e,t,i){for(i=i||this.length;this.pos<i;){var r=this.readVarint(),n=r>>3,o=this.pos;this.type=7&r,e(n,t,this),this.pos===o&&this.skip(r)}return t},readMessage:function(e,t){return this.readFields(e,t,this.readVarint()+this.pos)},readFixed32:function(){var e=g(this.buf,this.pos);return this.pos+=4,e},readSFixed32:function(){var e=y(this.buf,this.pos);return this.pos+=4,e},readFixed64:function(){var e=g(this.buf,this.pos)+g(this.buf,this.pos+4)*i;return this.pos+=8,e},readSFixed64:function(){var e=g(this.buf,this.pos)+y(this.buf,this.pos+4)*i;return this.pos+=8,e},readFloat:function(){var t=e.read(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=e.read(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(e){var t,i,r=this.buf;return t=127&(i=r[this.pos++]),i<128?t:(t|=(127&(i=r[this.pos++]))<<7,i<128?t:(t|=(127&(i=r[this.pos++]))<<14,i<128?t:(t|=(127&(i=r[this.pos++]))<<21,i<128?t:function(e,t,i){var r,n,o=i.buf;if(r=(112&(n=o[i.pos++]))>>4,n<128)return s(e,r,t);if(r|=(127&(n=o[i.pos++]))<<3,n<128)return s(e,r,t);if(r|=(127&(n=o[i.pos++]))<<10,n<128)return s(e,r,t);if(r|=(127&(n=o[i.pos++]))<<17,n<128)return s(e,r,t);if(r|=(127&(n=o[i.pos++]))<<24,n<128)return s(e,r,t);if(r|=(1&(n=o[i.pos++]))<<31,n<128)return s(e,r,t);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(i=r[this.pos]))<<28,e,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var e=this.readVarint();return e%2==1?(e+1)/-2:e/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var e=this.readVarint()+this.pos,t=this.pos;return this.pos=e,e-t>=12&&n?function(e,t,i){return n.decode(e.subarray(t,i))}(this.buf,t,e):function(e,t,i){for(var r="",n=t;n<i;){var o,s,a,l=e[n],c=null,u=l>239?4:l>223?3:l>191?2:1;if(n+u>i)break;1===u?l<128&&(c=l):2===u?128==(192&(o=e[n+1]))&&(c=(31&l)<<6|63&o)<=127&&(c=null):3===u?(s=e[n+2],128==(192&(o=e[n+1]))&&128==(192&s)&&((c=(15&l)<<12|(63&o)<<6|63&s)<=2047||c>=55296&&c<=57343)&&(c=null)):4===u&&(s=e[n+2],a=e[n+3],128==(192&(o=e[n+1]))&&128==(192&s)&&128==(192&a)&&((c=(15&l)<<18|(63&o)<<12|(63&s)<<6|63&a)<=65535||c>=1114112)&&(c=null)),null===c?(c=65533,u=1):c>65535&&(c-=65536,r+=String.fromCharCode(c>>>10&1023|55296),c=56320|1023&c),r+=String.fromCharCode(c),n+=u}return r}(this.buf,t,e)},readBytes:function(){var e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t},readPackedVarint:function(e,i){if(this.type!==t.Bytes)return e.push(this.readVarint(i));var r=o(this);for(e=e||[];this.pos<r;)e.push(this.readVarint(i));return e},readPackedSVarint:function(e){if(this.type!==t.Bytes)return e.push(this.readSVarint());var i=o(this);for(e=e||[];this.pos<i;)e.push(this.readSVarint());return e},readPackedBoolean:function(e){if(this.type!==t.Bytes)return e.push(this.readBoolean());var i=o(this);for(e=e||[];this.pos<i;)e.push(this.readBoolean());return e},readPackedFloat:function(e){if(this.type!==t.Bytes)return e.push(this.readFloat());var i=o(this);for(e=e||[];this.pos<i;)e.push(this.readFloat());return e},readPackedDouble:function(e){if(this.type!==t.Bytes)return e.push(this.readDouble());var i=o(this);for(e=e||[];this.pos<i;)e.push(this.readDouble());return e},readPackedFixed32:function(e){if(this.type!==t.Bytes)return e.push(this.readFixed32());var i=o(this);for(e=e||[];this.pos<i;)e.push(this.readFixed32());return e},readPackedSFixed32:function(e){if(this.type!==t.Bytes)return e.push(this.readSFixed32());var i=o(this);for(e=e||[];this.pos<i;)e.push(this.readSFixed32());return e},readPackedFixed64:function(e){if(this.type!==t.Bytes)return e.push(this.readFixed64());var i=o(this);for(e=e||[];this.pos<i;)e.push(this.readFixed64());return e},readPackedSFixed64:function(e){if(this.type!==t.Bytes)return e.push(this.readSFixed64());var i=o(this);for(e=e||[];this.pos<i;)e.push(this.readSFixed64());return e},skip:function(e){var i=7&e;if(i===t.Varint)for(;this.buf[this.pos++]>127;);else if(i===t.Bytes)this.pos=this.readVarint()+this.pos;else if(i===t.Fixed32)this.pos+=4;else{if(i!==t.Fixed64)throw new Error("Unimplemented type: "+i);this.pos+=8}},writeTag:function(e,t){this.writeVarint(e<<3|t)},realloc:function(e){for(var t=this.length||16;t<this.pos+e;)t*=2;if(t!==this.length){var i=new Uint8Array(t);i.set(this.buf),this.buf=i,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(e){this.realloc(4),_(this.buf,e,this.pos),this.pos+=4},writeSFixed32:function(e){this.realloc(4),_(this.buf,e,this.pos),this.pos+=4},writeFixed64:function(e){this.realloc(8),_(this.buf,-1&e,this.pos),_(this.buf,Math.floor(e*r),this.pos+4),this.pos+=8},writeSFixed64:function(e){this.realloc(8),_(this.buf,-1&e,this.pos),_(this.buf,Math.floor(e*r),this.pos+4),this.pos+=8},writeVarint:function(e){(e=+e||0)>268435455||e<0?function(e,t){var i,r;if(e>=0?(i=e%4294967296|0,r=e/4294967296|0):(r=~(-e/4294967296),4294967295^(i=~(-e%4294967296))?i=i+1|0:(i=0,r=r+1|0)),e>=0x10000000000000000||e<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");t.realloc(10),function(e,t,i){i.buf[i.pos++]=127&e|128,e>>>=7,i.buf[i.pos++]=127&e|128,e>>>=7,i.buf[i.pos++]=127&e|128,e>>>=7,i.buf[i.pos++]=127&e|128,i.buf[i.pos]=127&(e>>>=7)}(i,0,t),function(e,t){var i=(7&e)<<4;t.buf[t.pos++]|=i|((e>>>=3)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e)))))}(r,t)}(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))},writeSVarint:function(e){this.writeVarint(e<0?2*-e-1:2*e)},writeBoolean:function(e){this.writeVarint(Boolean(e))},writeString:function(e){e=String(e),this.realloc(4*e.length),this.pos++;var t=this.pos;this.pos=function(e,t,i){for(var r,n,o=0;o<t.length;o++){if((r=t.charCodeAt(o))>55295&&r<57344){if(!n){r>56319||o+1===t.length?(e[i++]=239,e[i++]=191,e[i++]=189):n=r;continue}if(r<56320){e[i++]=239,e[i++]=191,e[i++]=189,n=r;continue}r=n-55296<<10|r-56320|65536,n=null}else n&&(e[i++]=239,e[i++]=191,e[i++]=189,n=null);r<128?e[i++]=r:(r<2048?e[i++]=r>>6|192:(r<65536?e[i++]=r>>12|224:(e[i++]=r>>18|240,e[i++]=r>>12&63|128),e[i++]=r>>6&63|128),e[i++]=63&r|128)}return i}(this.buf,e,this.pos);var i=this.pos-t;i>=128&&a(t,i,this),this.pos=t-1,this.writeVarint(i),this.pos+=i},writeFloat:function(t){this.realloc(4),e.write(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),e.write(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(e){var t=e.length;this.writeVarint(t),this.realloc(t);for(var i=0;i<t;i++)this.buf[this.pos++]=e[i]},writeRawMessage:function(e,t){this.pos++;var i=this.pos;e(t,this);var r=this.pos-i;r>=128&&a(i,r,this),this.pos=i-1,this.writeVarint(r),this.pos+=r},writeMessage:function(e,i,r){this.writeTag(e,t.Bytes),this.writeRawMessage(i,r)},writePackedVarint:function(e,t){t.length&&this.writeMessage(e,l,t)},writePackedSVarint:function(e,t){t.length&&this.writeMessage(e,c,t)},writePackedBoolean:function(e,t){t.length&&this.writeMessage(e,d,t)},writePackedFloat:function(e,t){t.length&&this.writeMessage(e,u,t)},writePackedDouble:function(e,t){t.length&&this.writeMessage(e,h,t)},writePackedFixed32:function(e,t){t.length&&this.writeMessage(e,p,t)},writePackedSFixed32:function(e,t){t.length&&this.writeMessage(e,f,t)},writePackedFixed64:function(e,t){t.length&&this.writeMessage(e,A,t)},writePackedSFixed64:function(e,t){t.length&&this.writeMessage(e,m,t)},writeBytesField:function(e,i){this.writeTag(e,t.Bytes),this.writeBytes(i)},writeFixed32Field:function(e,i){this.writeTag(e,t.Fixed32),this.writeFixed32(i)},writeSFixed32Field:function(e,i){this.writeTag(e,t.Fixed32),this.writeSFixed32(i)},writeFixed64Field:function(e,i){this.writeTag(e,t.Fixed64),this.writeFixed64(i)},writeSFixed64Field:function(e,i){this.writeTag(e,t.Fixed64),this.writeSFixed64(i)},writeVarintField:function(e,i){this.writeTag(e,t.Varint),this.writeVarint(i)},writeSVarintField:function(e,i){this.writeTag(e,t.Varint),this.writeSVarint(i)},writeStringField:function(e,i){this.writeTag(e,t.Bytes),this.writeString(i)},writeFloatField:function(e,i){this.writeTag(e,t.Fixed32),this.writeFloat(i)},writeDoubleField:function(e,i){this.writeTag(e,t.Fixed64),this.writeDouble(i)},writeBooleanField:function(e,t){this.writeVarintField(e,Boolean(t))}},Dc}var Vc=i(jc());const Hc=3;function Gc(e,t,i){1===e&&i.readMessage($c,t)}function $c(e,t,i){if(3===e){const{id:e,bitmap:r,width:n,height:o,left:s,top:a,advance:l}=i.readMessage(Zc,{});t.push({id:e,bitmap:new Va({width:n+2*Hc,height:o+2*Hc},r),metrics:{width:n,height:o,left:s,top:a,advance:l}})}}function Zc(e,t,i){1===e?t.id=i.readVarint():2===e?t.bitmap=i.readBytes():3===e?t.width=i.readVarint():4===e?t.height=i.readVarint():5===e?t.left=i.readSVarint():6===e?t.top=i.readSVarint():7===e&&(t.advance=i.readVarint())}const qc=Hc;function Kc(e){let t=0,i=0;for(const r of e)t+=r.w*r.h,i=Math.max(i,r.w);e.sort(((e,t)=>t.h-e.h));const r=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),i),h:1/0}];let n=0,o=0;for(const t of e)for(let e=r.length-1;e>=0;e--){const i=r[e];if(!(t.w>i.w||t.h>i.h)){if(t.x=i.x,t.y=i.y,o=Math.max(o,t.y+t.h),n=Math.max(n,t.x+t.w),t.w===i.w&&t.h===i.h){const t=r.pop();e<r.length&&(r[e]=t)}else t.h===i.h?(i.x+=t.w,i.w-=t.w):t.w===i.w?(i.y+=t.h,i.h-=t.h):(r.push({x:i.x+t.w,y:i.y,w:i.w-t.w,h:t.h}),i.y+=t.h,i.h-=t.h);break}}return{w:n,h:o,fill:t/(n*o)||0}}const Wc=1;class Xc{constructor(e,{pixelRatio:t,version:i,stretchX:r,stretchY:n,content:o,textFitWidth:s,textFitHeight:a}){this.paddedRect=e,this.pixelRatio=t,this.stretchX=r,this.stretchY=n,this.content=o,this.version=i,this.textFitWidth=s,this.textFitHeight=a}get tl(){return[this.paddedRect.x+Wc,this.paddedRect.y+Wc]}get br(){return[this.paddedRect.x+this.paddedRect.w-Wc,this.paddedRect.y+this.paddedRect.h-Wc]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*Wc)/this.pixelRatio,(this.paddedRect.h-2*Wc)/this.pixelRatio]}}class Yc{constructor(e,t){const i={},r={};this.haveRenderCallbacks=[];const n=[];this.addImages(e,i,n),this.addImages(t,r,n);const{w:o,h:s}=Kc(n),a=new Ha({width:o||1,height:s||1});for(const t in e){const r=e[t],n=i[t].paddedRect;Ha.copy(r.data,a,{x:0,y:0},{x:n.x+Wc,y:n.y+Wc},r.data)}for(const e in t){const i=t[e],n=r[e].paddedRect,o=n.x+Wc,s=n.y+Wc,l=i.data.width,c=i.data.height;Ha.copy(i.data,a,{x:0,y:0},{x:o,y:s},i.data),Ha.copy(i.data,a,{x:0,y:c-1},{x:o,y:s-1},{width:l,height:1}),Ha.copy(i.data,a,{x:0,y:0},{x:o,y:s+c},{width:l,height:1}),Ha.copy(i.data,a,{x:l-1,y:0},{x:o-1,y:s},{width:1,height:c}),Ha.copy(i.data,a,{x:0,y:0},{x:o+l,y:s},{width:1,height:c})}this.image=a,this.iconPositions=i,this.patternPositions=r}addImages(e,t,i){for(const r in e){const n=e[r],o={x:0,y:0,w:n.data.width+2*Wc,h:n.data.height+2*Wc};i.push(o),t[r]=new Xc(o,n),n.hasRenderCallback&&this.haveRenderCallbacks.push(r)}}patchUpdatedImages(e,t){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const i in e.updatedImages)this.patchUpdatedImage(this.iconPositions[i],e.getImage(i),t),this.patchUpdatedImage(this.patternPositions[i],e.getImage(i),t)}patchUpdatedImage(e,t,i){if(!e||!t)return;if(e.version===t.version)return;e.version=t.version;const[r,n]=e.tl;i.update(t.data,void 0,{x:r,y:n})}}var Jc;qn("ImagePosition",Xc),qn("ImageAtlas",Yc),e.al=void 0,(Jc=e.al||(e.al={}))[Jc.none=0]="none",Jc[Jc.horizontal=1]="horizontal",Jc[Jc.vertical=2]="vertical",Jc[Jc.horizontalOnly=3]="horizontalOnly";const eu=-17;class tu{constructor(){this.scale=1,this.fontStack="",this.imageName=null,this.verticalAlign="bottom"}static forText(e,t,i){const r=new tu;return r.scale=e||1,r.fontStack=t,r.verticalAlign=i||"bottom",r}static forImage(e,t){const i=new tu;return i.imageName=e,i.verticalAlign=t||"bottom",i}}class iu{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,t){const i=new iu;for(let r=0;r<e.sections.length;r++){const n=e.sections[r];n.image?i.addImageSection(n):i.addTextSection(n,t)}return i}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(){this.text=function(e){let t="";for(let i=0;i<e.length;i++){const r=e.charCodeAt(i+1)||null,n=e.charCodeAt(i-1)||null;t+=r&&co(r)&&!zc[e[i+1]]||n&&co(n)&&!zc[e[i-1]]||!zc[e[i]]?e[i]:zc[e[i]]}return t}(this.text)}trim(){let e=0;for(let t=0;t<this.text.length&&nu[this.text.charCodeAt(t)];t++)e++;let t=this.text.length;for(let i=this.text.length-1;i>=0&&i>=e&&nu[this.text.charCodeAt(i)];i--)t--;this.text=this.text.substring(e,t),this.sectionIndex=this.sectionIndex.slice(e,t)}substring(e,t){const i=new iu;return i.text=this.text.substring(e,t),i.sectionIndex=this.sectionIndex.slice(e,t),i.sections=this.sections,i}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((e,t)=>Math.max(e,this.sections[t].scale)),0)}getMaxImageSize(e){let t=0,i=0;for(let r=0;r<this.length();r++){const n=this.getSection(r);if(n.imageName){const r=e[n.imageName];if(!r)continue;const o=r.displaySize;t=Math.max(t,o[0]),i=Math.max(i,o[1])}}return{maxImageWidth:t,maxImageHeight:i}}addTextSection(e,t){this.text+=e.text,this.sections.push(tu.forText(e.scale,e.fontStack||t,e.verticalAlign));const i=this.sections.length-1;for(let t=0;t<e.text.length;++t)this.sectionIndex.push(i)}addImageSection(e){const t=e.image?e.image.name:"";if(0===t.length)return void V("Can't add FormattedSection with an empty image.");const i=this.getNextImageSectionCharCode();i?(this.text+=String.fromCharCode(i),this.sections.push(tu.forImage(t,e.verticalAlign)),this.sectionIndex.push(this.sections.length-1)):V("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function ru(t,i,r,n,o,s,a,l,c,u,h,d,p,f,A){const m=iu.fromFeature(t,o);let g;d===e.al.vertical&&m.verticalizePunctuation();const{processBidirectionalText:_,processStyledBidirectionalText:y}=Ao;if(_&&1===m.sections.length){g=[];const e=_(m.toString(),du(m,u,s,i,n,f));for(const t of e){const e=new iu;e.text=t,e.sections=m.sections;for(let i=0;i<t.length;i++)e.sectionIndex.push(0);g.push(e)}}else if(y){g=[];const e=y(m.text,m.sectionIndex,du(m,u,s,i,n,f));for(const t of e){const e=new iu;e.text=t[0],e.sectionIndex=t[1],e.sections=m.sections,g.push(e)}}else g=function(e,t){const i=[],r=e.text;let n=0;for(const r of t)i.push(e.substring(n,r)),n=r;return n<r.length&&i.push(e.substring(n,r.length)),i}(m,du(m,u,s,i,n,f));const v=[],x={positionedLines:v,text:m.toString(),top:h[1],bottom:h[1],left:h[0],right:h[0],writingMode:d,iconsInText:!1,verticalizable:!1};return function(e,t,i,r,n,o,s,a,l,c,u,h){let d=0,p=0,f=0,A=0;const m="right"===a?1:"left"===a?0:.5,g=Uc/h;let _=0;for(const s of n){s.trim();const n=s.getMaxScale(),a={positionedGlyphs:[],lineOffset:0};e.positionedLines[_]=a;const h=a.positionedGlyphs;let y=0;if(!s.length()){p+=o,++_;continue}const v=fu(r,s,g);for(let o=0;o<s.length();o++){const a=s.getSection(o),f=s.getSectionIndex(o),A=s.getCharCode(o),m=mu(l,u,A);let _;if(a.imageName){if(e.iconsInText=!0,a.scale=a.scale*g,_=_u(a,m,n,v,r),!_)continue;y=Math.max(y,_.imageOffset)}else if(_=gu(a,A,m,v,t,i),!_)continue;const{rect:x,metrics:b,baselineOffset:w}=_;h.push({glyph:A,imageName:a.imageName,x:d,y:p+w+eu,vertical:m,scale:a.scale,fontStack:a.fontStack,sectionIndex:f,metrics:b,rect:x}),m?(e.verticalizable=!0,d+=(a.imageName?b.advance:Uc)*a.scale+c):d+=b.advance*a.scale+c}0!==h.length&&(f=Math.max(d-c,f),yu(h,0,h.length-1,m)),d=0,a.lineOffset=Math.max(y,(n-1)*Uc);const x=o*n+y;p+=x,A=Math.max(x,A),++_}const{horizontalAlign:y,verticalAlign:v}=pu(s);(function(e,t,i,r,n,o,s,a,l){const c=(t-i)*n;let u=0;u=o!==s?-a*r-eu:-r*l*s+.5*s;for(const t of e)for(const e of t.positionedGlyphs)e.x+=c,e.y+=u})(e.positionedLines,m,y,v,f,A,o,p,n.length),e.top+=-v*p,e.bottom=e.top+p,e.left+=-y*f,e.right=e.left+f}(x,i,r,n,g,a,l,c,d,u,p,A),!function(e){for(const t of e)if(0!==t.positionedGlyphs.length)return!1;return!0}(v)&&x}const nu={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},ou={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},su={40:!0};function au(e,t,i,r,n,o){if(t.imageName){const e=r[t.imageName];return e?e.displaySize[0]*t.scale*Uc/o+n:0}{const r=i[t.fontStack],o=r&&r[e];return o?o.metrics.advance*t.scale+n:0}}function lu(e,t,i,r){const n=Math.pow(e-t,2);return r?e<t?n/2:2*n:n+Math.abs(i)*i}function cu(e,t,i){let r=0;return 10===e&&(r-=1e4),i&&(r+=150),40!==e&&65288!==e||(r+=50),41!==t&&65289!==t||(r+=50),r}function uu(e,t,i,r,n,o){let s=null,a=lu(t,i,n,o);for(const e of r){const r=lu(t-e.x,i,n,o)+e.badness;r<=a&&(s=e,a=r)}return{index:e,x:t,priorBreak:s,badness:a}}function hu(e){return e?hu(e.priorBreak).concat(e.index):[]}function du(e,t,i,r,n,o){if(!e)return[];const s=[],a=function(e,t,i,r,n,o){let s=0;for(let i=0;i<e.length();i++){const a=e.getSection(i);s+=au(e.getCharCode(i),a,r,n,t,o)}return s/Math.max(1,Math.ceil(s/i))}(e,t,i,r,n,o),l=e.text.indexOf("")>=0;let c=0;for(let i=0;i<e.length();i++){const h=e.getSection(i),d=e.getCharCode(i);if(nu[d]||(c+=au(d,h,r,n,t,o)),i<e.length()-1){const t=!((u=d)<11904)&&(!!to["CJK Compatibility Forms"](u)||!!to["CJK Compatibility"](u)||!!to["CJK Strokes"](u)||!!to["CJK Symbols and Punctuation"](u)||!!to["Enclosed CJK Letters and Months"](u)||!!to["Halfwidth and Fullwidth Forms"](u)||!!to["Ideographic Description Characters"](u)||!!to["Vertical Forms"](u)||ao.test(String.fromCodePoint(u)));(ou[d]||t||h.imageName||i!==e.length()-2&&su[e.getCharCode(i+1)])&&s.push(uu(i+1,c,a,s,cu(d,e.getCharCode(i+1),t&&l),!1))}}var u;return hu(uu(e.length(),c,a,s,0,!0))}function pu(e){let t=.5,i=.5;switch(e){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(e){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:t,verticalAlign:i}}function fu(e,t,i){const r=t.getMaxScale()*Uc,{maxImageWidth:n,maxImageHeight:o}=t.getMaxImageSize(e),s=Math.max(r,o*i);return{verticalLineContentWidth:Math.max(r,n*i),horizontalLineContentHeight:s}}function Au(e){switch(e){case"top":return 0;case"center":return.5;default:return 1}}function mu(t,i,r){return!(t===e.al.horizontal||!i&&!lo(r)||i&&(nu[r]||(n=r,/\p{sc=Arab}/u.test(String.fromCodePoint(n)))));var n}function gu(e,t,i,r,n,o){const s=o[e.fontStack],a=function(e,t,i,r){if(e&&e.rect)return e;const n=t[i.fontStack],o=n&&n[r];return o?{rect:null,metrics:o.metrics}:null}(s&&s[t],n,e,t);if(null===a)return null;let l;if(i)l=r.verticalLineContentWidth-e.scale*Uc;else{const t=Au(e.verticalAlign);l=(r.horizontalLineContentHeight-e.scale*Uc)*t}return{rect:a.rect,metrics:a.metrics,baselineOffset:l}}function _u(e,t,i,r,n){const o=n[e.imageName];if(!o)return null;const s=o.paddedRect,a=o.displaySize,l={width:a[0],height:a[1],left:Wc,top:-3,advance:t?a[1]:a[0]};let c;if(t)c=r.verticalLineContentWidth-a[1]*e.scale;else{const t=Au(e.verticalAlign);c=(r.horizontalLineContentHeight-a[1]*e.scale)*t}return{rect:s,metrics:l,baselineOffset:c,imageOffset:(t?a[0]:a[1])*e.scale-Uc*i}}function yu(e,t,i,r){if(0===r)return;const n=e[i],o=(e[i].x+n.metrics.advance*n.scale)*r;for(let r=t;r<=i;r++)e[r].x-=o}function vu(e,t,i){const{horizontalAlign:r,verticalAlign:n}=pu(i),o=t[0]-e.displaySize[0]*r,s=t[1]-e.displaySize[1]*n;return{image:e,top:s,bottom:s+e.displaySize[1],left:o,right:o+e.displaySize[0]}}function xu(e){var t,i;let r=e.left,n=e.top,o=e.right-r,s=e.bottom-n;const a=null!==(t=e.image.textFitWidth)&&void 0!==t?t:"stretchOrShrink",l=null!==(i=e.image.textFitHeight)&&void 0!==i?i:"stretchOrShrink",c=(e.image.content[2]-e.image.content[0])/(e.image.content[3]-e.image.content[1]);if("proportional"===l){if("stretchOnly"===a&&o/s<c||"proportional"===a){const e=Math.ceil(s*c);r*=e/o,o=e}}else if("proportional"===a&&"stretchOnly"===l&&0!==c&&o/s>c){const e=Math.ceil(o/c);n*=e/s,s=e}return{x1:r,y1:n,x2:r+o,y2:n+s}}function bu(e,t,i,r,n,o){const s=e.image;let a;if(s.content){const e=s.content,t=s.pixelRatio||1;a=[e[0]/t,e[1]/t,s.displaySize[0]-e[2]/t,s.displaySize[1]-e[3]/t]}const l=t.left*o,c=t.right*o;let u,h,d,p;"width"===i||"both"===i?(p=n[0]+l-r[3],h=n[0]+c+r[1]):(p=n[0]+(l+c-s.displaySize[0])/2,h=p+s.displaySize[0]);const f=t.top*o,A=t.bottom*o;return"height"===i||"both"===i?(u=n[1]+f-r[0],d=n[1]+A+r[2]):(u=n[1]+(f+A-s.displaySize[1])/2,d=u+s.displaySize[1]),{image:s,top:u,right:h,bottom:d,left:p,collisionPadding:a}}const wu=255,Tu=128,Bu=wu*Tu;function Cu(e,t){const{expression:i}=t;if("constant"===i.kind)return{kind:"constant",layoutSize:i.evaluate(new mo(e+1))};if("source"===i.kind)return{kind:"source"};{const{zoomStops:t,interpolationType:r}=i;let n=0;for(;n<t.length&&t[n]<=e;)n++;n=Math.max(0,n-1);let o=n;for(;o<t.length&&t[o]<e+1;)o++;o=Math.min(t.length-1,o);const s=t[n],a=t[o];return"composite"===i.kind?{kind:"composite",minZoom:s,maxZoom:a,interpolationType:r}:{kind:"camera",minZoom:s,maxZoom:a,minSize:i.evaluate(new mo(s)),maxSize:i.evaluate(new mo(a)),interpolationType:r}}}function Su(e,t,i){let r="never";const n=e.get(t);return n?r=n:e.get(i)&&(r="always"),r}const Eu=tc.VectorTileFeature.types,Mu=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Iu(e,t,i,r,n,o,s,a,l,c,u,h,d){const p=a?Math.min(Bu,Math.round(a[0])):0,f=a?Math.min(Bu,Math.round(a[1])):0;e.emplaceBack(t,i,Math.round(32*r),Math.round(32*n),o,s,(p<<1)+(l?1:0),f,16*c,16*u,256*h,256*d)}function Pu(e,t,i){e.emplaceBack(t.x,t.y,i),e.emplaceBack(t.x,t.y,i),e.emplaceBack(t.x,t.y,i),e.emplaceBack(t.x,t.y,i)}function Lu(e){for(const t of e.sections)if(fo(t.text))return!0;return!1}class Fu{constructor(e){this.layoutVertexArray=new Cs,this.indexArray=new Ps,this.programConfigurations=e,this.segments=new zs,this.dynamicLayoutVertexArray=new Ss,this.opacityVertexArray=new Es,this.hasVisibleVertices=!1,this.placedSymbolArray=new us}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(e,t,i,r){this.isEmpty()||(i&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Mc.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,t),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,Ic.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,Mu,!0),this.opacityVertexBuffer.itemSize=1),(i||r)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}qn("SymbolBuffers",Fu);class ku{constructor(e,t,i){this.layoutVertexArray=new e,this.layoutAttributes=t,this.indexArray=new i,this.segments=new zs,this.collisionVertexArray=new Is}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,Pc.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}qn("CollisionBuffers",ku);class zu{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((e=>e.id)),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];const i=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Cu(this.zoom,i["text-size"]),this.iconSizeData=Cu(this.zoom,i["icon-size"]);const r=this.layers[0].layout,n=r.get("symbol-sort-key"),o=r.get("symbol-z-order");this.canOverlap="never"!==Su(r,"text-overlap","text-allow-overlap")||"never"!==Su(r,"icon-overlap","icon-allow-overlap")||r.get("text-ignore-placement")||r.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==o&&!n.isConstant(),this.sortFeaturesByY=("viewport-y"===o||"auto"===o&&!this.sortFeaturesByKey)&&this.canOverlap,"point"===r.get("symbol-placement")&&(this.writingModes=r.get("text-writing-mode").map((t=>e.al[t]))),this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id)),this.sourceID=t.sourceID}createArrays(){this.text=new Fu(new la(this.layers,this.zoom,(e=>/^text/.test(e)))),this.icon=new Fu(new la(this.layers,this.zoom,(e=>/^icon/.test(e)))),this.glyphOffsetArray=new ps,this.lineVertexArray=new fs,this.symbolInstances=new ds,this.textAnchorOffsets=new ms}calculateGlyphDependencies(e,t,i,r,n){for(let o=0;o<e.length;o++)if(t[e.charCodeAt(o)]=!0,(i||r)&&n){const i=zc[e.charAt(o)];i&&(t[i.charCodeAt(0)]=!0)}}populate(t,i,r){const n=this.layers[0],o=n.layout,s=o.get("text-font"),a=o.get("text-field"),l=o.get("icon-image"),c=("constant"!==a.value.kind||a.value.value instanceof Tt&&!a.value.value.isEmpty()||a.value.value.toString().length>0)&&("constant"!==s.value.kind||s.value.value.length>0),u="constant"!==l.value.kind||!!l.value.value||Object.keys(l.parameters).length>0,h=o.get("symbol-sort-key");if(this.features=[],!c&&!u)return;const d=i.iconDependencies,p=i.glyphDependencies,f=i.availableImages,A=new mo(this.zoom);for(const{feature:i,id:a,index:l,sourceLayerIndex:m}of t){const t=n._featureFilter.needGeometry,g=fa(i,t);if(!n._featureFilter.filter(A,g,r))continue;let _,y;if(t||(g.geometry=pa(i)),c){const e=n.getValueAndResolveTokens("text-field",g,r,f),t=Tt.factory(e),i=this.hasRTLText=this.hasRTLText||Lu(t);(!i||"unavailable"===Ao.getRTLTextPluginStatus()||i&&Ao.isParsed())&&(_=kc(t,n,g))}if(u){const e=n.getValueAndResolveTokens("icon-image",g,r,f);y=e instanceof Mt?e:Mt.fromString(e)}if(!_&&!y)continue;const v=this.sortFeaturesByKey?h.evaluate(g,{},r):void 0;if(this.features.push({id:a,text:_,icon:y,index:l,sourceLayerIndex:m,geometry:g.geometry,properties:i.properties,type:Eu[i.type],sortKey:v}),y&&(d[y.name]=!0),_){const t=s.evaluate(g,{},r).join(","),i="viewport"!==o.get("text-rotation-alignment")&&"point"!==o.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(e.al.vertical)>=0;for(const e of _.sections)if(e.image)d[e.image.name]=!0;else{const r=io(_.toString()),n=e.fontStack||t,o=p[n]=p[n]||{};this.calculateGlyphDependencies(e.text,o,i,this.allowVerticalPlacement,r)}}}"line"===o.get("symbol-placement")&&(this.features=function(e){const t={},i={},r=[];let n=0;function o(t){r.push(e[t]),n++}function s(e,t,n){const o=i[e];return delete i[e],i[t]=o,r[o].geometry[0].pop(),r[o].geometry[0]=r[o].geometry[0].concat(n[0]),o}function a(e,i,n){const o=t[i];return delete t[i],t[e]=o,r[o].geometry[0].shift(),r[o].geometry[0]=n[0].concat(r[o].geometry[0]),o}function l(e,t,i){const r=i?t[0][t[0].length-1]:t[0][0];return`${e}:${r.x}:${r.y}`}for(let c=0;c<e.length;c++){const u=e[c],h=u.geometry,d=u.text?u.text.toString():null;if(!d){o(c);continue}const p=l(d,h),f=l(d,h,!0);if(p in i&&f in t&&i[p]!==t[f]){const e=a(p,f,h),n=s(p,f,r[e].geometry);delete t[p],delete i[f],i[l(d,r[n].geometry,!0)]=n,r[e].geometry=null}else p in i?s(p,f,h):f in t?a(p,f,h):(o(c),t[p]=n-1,i[f]=n-1)}return r.filter((e=>e.geometry))}(this.features)),this.sortFeaturesByKey&&this.features.sort(((e,t)=>e.sortKey-t.sortKey))}update(e,t,i){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,t,this.layers,i),this.icon.programConfigurations.updatePaintArrays(e,t,this.layers,i))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,t){const i=this.lineVertexArray.length;if(void 0!==e.segment){let i=e.dist(t[e.segment+1]),r=e.dist(t[e.segment]);const n={};for(let r=e.segment+1;r<t.length;r++)n[r]={x:t[r].x,y:t[r].y,tileUnitDistanceFromAnchor:i},r<t.length-1&&(i+=t[r+1].dist(t[r]));for(let i=e.segment||0;i>=0;i--)n[i]={x:t[i].x,y:t[i].y,tileUnitDistanceFromAnchor:r},i>0&&(r+=t[i-1].dist(t[i]));for(let e=0;e<t.length;e++){const t=n[e];this.lineVertexArray.emplaceBack(t.x,t.y,t.tileUnitDistanceFromAnchor)}}return{lineStartIndex:i,lineLength:this.lineVertexArray.length-i}}addSymbols(t,i,r,n,o,s,a,l,c,u,h,d){const p=t.indexArray,f=t.layoutVertexArray,A=t.segments.prepareSegment(4*i.length,f,p,this.canOverlap?s.sortKey:void 0),m=this.glyphOffsetArray.length,g=A.vertexLength,_=this.allowVerticalPlacement&&a===e.al.vertical?Math.PI/2:0,y=s.text&&s.text.sections;for(let e=0;e<i.length;e++){const{tl:n,tr:o,bl:a,br:c,tex:u,pixelOffsetTL:h,pixelOffsetBR:m,minFontScaleX:g,minFontScaleY:v,glyphOffset:x,isSDF:b,sectionIndex:w}=i[e],T=A.vertexLength,B=x[1];Iu(f,l.x,l.y,n.x,B+n.y,u.x,u.y,r,b,h.x,h.y,g,v),Iu(f,l.x,l.y,o.x,B+o.y,u.x+u.w,u.y,r,b,m.x,h.y,g,v),Iu(f,l.x,l.y,a.x,B+a.y,u.x,u.y+u.h,r,b,h.x,m.y,g,v),Iu(f,l.x,l.y,c.x,B+c.y,u.x+u.w,u.y+u.h,r,b,m.x,m.y,g,v),Pu(t.dynamicLayoutVertexArray,l,_),p.emplaceBack(T,T+2,T+1),p.emplaceBack(T+1,T+2,T+3),A.vertexLength+=4,A.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(x[0]),e!==i.length-1&&w===i[e+1].sectionIndex||t.programConfigurations.populatePaintArrays(f.length,s,s.index,{},d,y&&y[w])}t.placedSymbolArray.emplaceBack(l.x,l.y,m,this.glyphOffsetArray.length-m,g,c,u,l.segment,r?r[0]:0,r?r[1]:0,n[0],n[1],a,0,!1,0,h)}_addCollisionDebugVertex(e,t,i,r,n,o){return t.emplaceBack(0,0),e.emplaceBack(i.x,i.y,r,n,Math.round(o.x),Math.round(o.y))}addCollisionDebugVertices(e,t,i,r,n,o,s){const a=n.segments.prepareSegment(4,n.layoutVertexArray,n.indexArray),c=a.vertexLength,u=n.layoutVertexArray,h=n.collisionVertexArray,d=s.anchorX,p=s.anchorY;this._addCollisionDebugVertex(u,h,o,d,p,new l(e,t)),this._addCollisionDebugVertex(u,h,o,d,p,new l(i,t)),this._addCollisionDebugVertex(u,h,o,d,p,new l(i,r)),this._addCollisionDebugVertex(u,h,o,d,p,new l(e,r)),a.vertexLength+=4;const f=n.indexArray;f.emplaceBack(c,c+1),f.emplaceBack(c+1,c+2),f.emplaceBack(c+2,c+3),f.emplaceBack(c+3,c),a.primitiveLength+=4}addDebugCollisionBoxes(e,t,i,r){for(let n=e;n<t;n++){const e=this.collisionBoxArray.get(n);this.addCollisionDebugVertices(e.x1,e.y1,e.x2,e.y2,r?this.textCollisionBox:this.iconCollisionBox,e.anchorPoint,i)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new ku(Ms,Lc.members,Ls),this.iconCollisionBox=new ku(Ms,Lc.members,Ls);for(let e=0;e<this.symbolInstances.length;e++){const t=this.symbolInstances.get(e);this.addDebugCollisionBoxes(t.textBoxStartIndex,t.textBoxEndIndex,t,!0),this.addDebugCollisionBoxes(t.verticalTextBoxStartIndex,t.verticalTextBoxEndIndex,t,!0),this.addDebugCollisionBoxes(t.iconBoxStartIndex,t.iconBoxEndIndex,t,!1),this.addDebugCollisionBoxes(t.verticalIconBoxStartIndex,t.verticalIconBoxEndIndex,t,!1)}}_deserializeCollisionBoxesForSymbol(e,t,i,r,n,o,s,a,l){const c={};for(let r=t;r<i;r++){const t=e.get(r);c.textBox={x1:t.x1,y1:t.y1,x2:t.x2,y2:t.y2,anchorPointX:t.anchorPointX,anchorPointY:t.anchorPointY},c.textFeatureIndex=t.featureIndex;break}for(let t=r;t<n;t++){const i=e.get(t);c.verticalTextBox={x1:i.x1,y1:i.y1,x2:i.x2,y2:i.y2,anchorPointX:i.anchorPointX,anchorPointY:i.anchorPointY},c.verticalTextFeatureIndex=i.featureIndex;break}for(let t=o;t<s;t++){const i=e.get(t);c.iconBox={x1:i.x1,y1:i.y1,x2:i.x2,y2:i.y2,anchorPointX:i.anchorPointX,anchorPointY:i.anchorPointY},c.iconFeatureIndex=i.featureIndex;break}for(let t=a;t<l;t++){const i=e.get(t);c.verticalIconBox={x1:i.x1,y1:i.y1,x2:i.x2,y2:i.y2,anchorPointX:i.anchorPointX,anchorPointY:i.anchorPointY},c.verticalIconFeatureIndex=i.featureIndex;break}return c}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let t=0;t<this.symbolInstances.length;t++){const i=this.symbolInstances.get(t);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,i.textBoxStartIndex,i.textBoxEndIndex,i.verticalTextBoxStartIndex,i.verticalTextBoxEndIndex,i.iconBoxStartIndex,i.iconBoxEndIndex,i.verticalIconBoxStartIndex,i.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,t){const i=e.placedSymbolArray.get(t),r=i.vertexStartIndex+4*i.numGlyphs;for(let t=i.vertexStartIndex;t<r;t+=4)e.indexArray.emplaceBack(t,t+2,t+1),e.indexArray.emplaceBack(t+1,t+2,t+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const t=Math.sin(e),i=Math.cos(e),r=[],n=[],o=[];for(let e=0;e<this.symbolInstances.length;++e){o.push(e);const s=this.symbolInstances.get(e);r.push(0|Math.round(t*s.anchorX+i*s.anchorY)),n.push(s.featureIndex)}return o.sort(((e,t)=>r[e]-r[t]||n[t]-n[e])),o}addToSortKeyRanges(e,t){const i=this.sortKeyRanges[this.sortKeyRanges.length-1];i&&i.sortKey===t?i.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:t,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const e of this.symbolInstanceIndexes){const t=this.symbolInstances.get(e);this.featureSortOrder.push(t.featureIndex),[t.rightJustifiedTextSymbolIndex,t.centerJustifiedTextSymbolIndex,t.leftJustifiedTextSymbolIndex].forEach(((e,t,i)=>{e>=0&&i.indexOf(e)===t&&this.addIndicesForPlacedSymbol(this.text,e)})),t.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,t.verticalPlacedTextSymbolIndex),t.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,t.placedIconSymbolIndex),t.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,t.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let Ru,Du;qn("SymbolBucket",zu,{omit:["layers","collisionBoxArray","features","compareText"]}),zu.MAX_GLYPHS=65535,zu.addDynamicAttributes=Pu;var Ou={get paint(){return Du=Du||new Io({"icon-opacity":new Co(me.paint_symbol["icon-opacity"]),"icon-color":new Co(me.paint_symbol["icon-color"]),"icon-halo-color":new Co(me.paint_symbol["icon-halo-color"]),"icon-halo-width":new Co(me.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Co(me.paint_symbol["icon-halo-blur"]),"icon-translate":new Bo(me.paint_symbol["icon-translate"]),"icon-translate-anchor":new Bo(me.paint_symbol["icon-translate-anchor"]),"text-opacity":new Co(me.paint_symbol["text-opacity"]),"text-color":new Co(me.paint_symbol["text-color"],{runtimeType:Re,getOverride:e=>e.textColor,hasOverride:e=>!!e.textColor}),"text-halo-color":new Co(me.paint_symbol["text-halo-color"]),"text-halo-width":new Co(me.paint_symbol["text-halo-width"]),"text-halo-blur":new Co(me.paint_symbol["text-halo-blur"]),"text-translate":new Bo(me.paint_symbol["text-translate"]),"text-translate-anchor":new Bo(me.paint_symbol["text-translate-anchor"])})},get layout(){return Ru=Ru||new Io({"symbol-placement":new Bo(me.layout_symbol["symbol-placement"]),"symbol-spacing":new Bo(me.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Bo(me.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Co(me.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Bo(me.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Bo(me.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Bo(me.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Bo(me.layout_symbol["icon-ignore-placement"]),"icon-optional":new Bo(me.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Bo(me.layout_symbol["icon-rotation-alignment"]),"icon-size":new Co(me.layout_symbol["icon-size"]),"icon-text-fit":new Bo(me.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Bo(me.layout_symbol["icon-text-fit-padding"]),"icon-image":new Co(me.layout_symbol["icon-image"]),"icon-rotate":new Co(me.layout_symbol["icon-rotate"]),"icon-padding":new Co(me.layout_symbol["icon-padding"]),"icon-keep-upright":new Bo(me.layout_symbol["icon-keep-upright"]),"icon-offset":new Co(me.layout_symbol["icon-offset"]),"icon-anchor":new Co(me.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Bo(me.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Bo(me.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Bo(me.layout_symbol["text-rotation-alignment"]),"text-field":new Co(me.layout_symbol["text-field"]),"text-font":new Co(me.layout_symbol["text-font"]),"text-size":new Co(me.layout_symbol["text-size"]),"text-max-width":new Co(me.layout_symbol["text-max-width"]),"text-line-height":new Bo(me.layout_symbol["text-line-height"]),"text-letter-spacing":new Co(me.layout_symbol["text-letter-spacing"]),"text-justify":new Co(me.layout_symbol["text-justify"]),"text-radial-offset":new Co(me.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Bo(me.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Co(me.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Co(me.layout_symbol["text-anchor"]),"text-max-angle":new Bo(me.layout_symbol["text-max-angle"]),"text-writing-mode":new Bo(me.layout_symbol["text-writing-mode"]),"text-rotate":new Co(me.layout_symbol["text-rotate"]),"text-padding":new Bo(me.layout_symbol["text-padding"]),"text-keep-upright":new Bo(me.layout_symbol["text-keep-upright"]),"text-transform":new Co(me.layout_symbol["text-transform"]),"text-offset":new Co(me.layout_symbol["text-offset"]),"text-allow-overlap":new Bo(me.layout_symbol["text-allow-overlap"]),"text-overlap":new Bo(me.layout_symbol["text-overlap"]),"text-ignore-placement":new Bo(me.layout_symbol["text-ignore-placement"]),"text-optional":new Bo(me.layout_symbol["text-optional"])})}};class Uu{constructor(e){if(void 0===e.property.overrides)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=e.property.overrides?e.property.overrides.runtimeType:Le,this.defaultValue=e}evaluate(e){if(e.formattedSection){const t=this.defaultValue.property.overrides;if(t&&t.hasOverride(e.formattedSection))return t.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}qn("FormatSectionOverride",Uu,{omit:["defaultValue"]});class Nu extends Lo{constructor(e){super(e,Ou)}recalculate(e,t){if(super.recalculate(e,t),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]="map"===this.layout.get("text-rotation-alignment")?"map":"viewport"),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),"point"===this.layout.get("symbol-placement")){const e=this.layout.get("text-writing-mode");if(e){const t=[];for(const i of e)t.indexOf(i)<0&&t.push(i);this.layout._values["text-writing-mode"]=t}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(e,t,i,r){const n=this.layout.get(e).evaluate(t,{},i,r),o=this._unevaluatedLayout._values[e];return o.isDataDriven()||Gr(o.value)||!n?n:function(e,t){return t.replace(/{([^{}]+)}/g,((t,i)=>e&&i in e?String(e[i]):""))}(t.properties,n)}createBucket(e){return new zu(e)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const e of Ou.paint.overridableProperties){if(!Nu.hasPaintOverride(this.layout,e))continue;const t=this.paint.get(e),i=new Uu(t),r=new Hr(i,t.property.specification);let n=null;n="constant"===t.value.kind||"source"===t.value.kind?new Zr("source",r):new qr("composite",r,t.value.zoomStops),this.paint._values[e]=new wo(t.property,n,t.parameters)}}_handleOverridablePaintPropertyUpdate(e,t,i){return!(!this.layout||t.isDataDriven()||i.isDataDriven())&&Nu.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,t){const i=e.get("text-field"),r=Ou.paint.properties[t];let n=!1;const o=e=>{for(const t of e)if(r.overrides&&r.overrides.hasOverride(t))return void(n=!0)};if("constant"===i.value.kind&&i.value.value instanceof Tt)o(i.value.value.sections);else if("source"===i.value.kind){const e=t=>{n||(t instanceof zt&&Ft(t.value)===Qe?o(t.value.sections):t instanceof yi?o(t.sections):t.eachChild(e))},t=i.value;t._styleExpression&&e(t._styleExpression.expression)}return n}}let Qu;var ju={get paint(){return Qu=Qu||new Io({"background-color":new Bo(me.paint_background["background-color"]),"background-pattern":new Eo(me.paint_background["background-pattern"]),"background-opacity":new Bo(me.paint_background["background-opacity"])})}};class Vu extends Lo{constructor(e){super(e,ju)}}let Hu;var Gu={get paint(){return Hu=Hu||new Io({"raster-opacity":new Bo(me.paint_raster["raster-opacity"]),"raster-hue-rotate":new Bo(me.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Bo(me.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Bo(me.paint_raster["raster-brightness-max"]),"raster-saturation":new Bo(me.paint_raster["raster-saturation"]),"raster-contrast":new Bo(me.paint_raster["raster-contrast"]),"raster-resampling":new Bo(me.paint_raster["raster-resampling"]),"raster-fade-duration":new Bo(me.paint_raster["raster-fade-duration"])})}};class $u extends Lo{constructor(e){super(e,Gu)}}class Zu extends Lo{constructor(e){super(e,{}),this.onAdd=e=>{this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)},this.onRemove=e=>{this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)},this.implementation=e}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class qu{constructor(e){this._methodToThrottle=e,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._methodToThrottle()}),0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const Ku={once:!0},Wu=6371008.8;class Xu{constructor(e,t){if(isNaN(e)||isNaN(t))throw new Error(`Invalid LngLat object: (${e}, ${t})`);if(this.lng=+e,this.lat=+t,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Xu(R(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const t=Math.PI/180,i=this.lat*t,r=e.lat*t,n=Math.sin(i)*Math.sin(r)+Math.cos(i)*Math.cos(r)*Math.cos((e.lng-this.lng)*t);return Wu*Math.acos(Math.min(n,1))}static convert(e){if(e instanceof Xu)return e;if(Array.isArray(e)&&(2===e.length||3===e.length))return new Xu(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&"object"==typeof e&&null!==e)return new Xu(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Yu=2*Math.PI*Wu;function Ju(e){return Yu*Math.cos(e*Math.PI/180)}function eh(e){return(180+e)/360}function th(e){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e*Math.PI/360)))/360}function ih(e,t){return e/Ju(t)}function rh(e){return 360/Math.PI*Math.atan(Math.exp((180-360*e)*Math.PI/180))-90}function nh(e,t){return e*Ju(rh(t))}class oh{constructor(e,t,i=0){this.x=+e,this.y=+t,this.z=+i}static fromLngLat(e,t=0){const i=Xu.convert(e);return new oh(eh(i.lng),th(i.lat),ih(t,i.lat))}toLngLat(){return new Xu(360*this.x-180,rh(this.y))}toAltitude(){return nh(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Yu*(e=rh(this.y),1/Math.cos(e*Math.PI/180));var e}}function sh(e,t,i){var r=2*Math.PI*6378137/256/Math.pow(2,i);return[e*r-2*Math.PI*6378137/2,t*r-2*Math.PI*6378137/2]}class ah{constructor(e,t,i){if(!function(e,t,i){return!(e<0||e>25||i<0||i>=Math.pow(2,e)||t<0||t>=Math.pow(2,e))}(e,t,i))throw new Error(`x=${t}, y=${i}, z=${e} outside of bounds. 0<=x<${Math.pow(2,e)}, 0<=y<${Math.pow(2,e)} 0<=z<=25 `);this.z=e,this.x=t,this.y=i,this.key=uh(0,e,e,t,i)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,t,i){const r=(o=this.y,s=this.z,a=sh(256*(n=this.x),256*(o=Math.pow(2,s)-o-1),s),l=sh(256*(n+1),256*(o+1),s),a[0]+","+a[1]+","+l[0]+","+l[1]);var n,o,s,a,l;const c=function(e,t,i){let r,n="";for(let o=e;o>0;o--)r=1<<o-1,n+=(t&r?1:0)+(i&r?2:0);return n}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===i?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,t>1?"@2x":"").replace(/{quadkey}/g,c).replace(/{bbox-epsg-3857}/g,r)}isChildOf(e){const t=this.z-e.z;return t>0&&e.x===this.x>>t&&e.y===this.y>>t}getTilePoint(e){const t=Math.pow(2,this.z);return new l((e.x*t-this.x)*E,(e.y*t-this.y)*E)}toString(){return`${this.z}/${this.x}/${this.y}`}}class lh{constructor(e,t){this.wrap=e,this.canonical=t,this.key=uh(e,t.z,t.z,t.x,t.y)}}class ch{constructor(e,t,i,r,n){if(this.terrainRttPosMatrix32f=null,e<i)throw new Error(`overscaledZ should be >= z; overscaledZ = ${e}; z = ${i}`);this.overscaledZ=e,this.wrap=t,this.canonical=new ah(i,+r,+n),this.key=uh(t,e,i,r,n)}clone(){return new ch(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const t=this.canonical.z-e;return e>this.canonical.z?new ch(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new ch(e,this.wrap,e,this.canonical.x>>t,this.canonical.y>>t)}calculateScaledKey(e,t){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const i=this.canonical.z-e;return e>this.canonical.z?uh(this.wrap*+t,e,this.canonical.z,this.canonical.x,this.canonical.y):uh(this.wrap*+t,e,e,this.canonical.x>>i,this.canonical.y>>i)}isChildOf(e){if(e.wrap!==this.wrap)return!1;const t=this.canonical.z-e.canonical.z;return 0===e.overscaledZ||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>t&&e.canonical.y===this.canonical.y>>t}children(e){if(this.overscaledZ>=e)return[new ch(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const t=this.canonical.z+1,i=2*this.canonical.x,r=2*this.canonical.y;return[new ch(t,this.wrap,t,i,r),new ch(t,this.wrap,t,i+1,r),new ch(t,this.wrap,t,i,r+1),new ch(t,this.wrap,t,i+1,r+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new ch(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new ch(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new lh(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(e){return this.canonical.getTilePoint(new oh(e.x-this.wrap,e.y))}}function uh(e,t,i,r,n){(e*=2)<0&&(e=-1*e-1);const o=1<<i;return(o*o*e+o*n+r).toString(36)+i.toString(36)+t.toString(36)}qn("CanonicalTileID",ah),qn("OverscaledTileID",ch,{omit:["terrainRttPosMatrix32f"]});class hh{constructor(e,t,i,r=1,n=1,o=1,s=0){if(this.uid=e,t.height!==t.width)throw new RangeError("DEM tiles must be square");if(i&&!["mapbox","terrarium","custom"].includes(i))return void V(`"${i}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=t.height;const a=this.dim=t.height-2;switch(this.data=new Uint32Array(t.data.buffer),i){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=r,this.greenFactor=n,this.blueFactor=o,this.baseShift=s;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let e=0;e<a;e++)this.data[this._idx(-1,e)]=this.data[this._idx(0,e)],this.data[this._idx(a,e)]=this.data[this._idx(a-1,e)],this.data[this._idx(e,-1)]=this.data[this._idx(e,0)],this.data[this._idx(e,a)]=this.data[this._idx(e,a-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(a,-1)]=this.data[this._idx(a-1,0)],this.data[this._idx(-1,a)]=this.data[this._idx(0,a-1)],this.data[this._idx(a,a)]=this.data[this._idx(a-1,a-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let e=0;e<a;e++)for(let t=0;t<a;t++){const i=this.get(e,t);i>this.max&&(this.max=i),i<this.min&&(this.min=i)}}get(e,t){const i=new Uint8Array(this.data.buffer),r=4*this._idx(e,t);return this.unpack(i[r],i[r+1],i[r+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(e,t){if(e<-1||e>=this.dim+1||t<-1||t>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(t+1)*this.stride+(e+1)}unpack(e,t,i){return e*this.redFactor+t*this.greenFactor+i*this.blueFactor-this.baseShift}getPixels(){return new Ha({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(e,t,i){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let r=t*this.dim,n=t*this.dim+this.dim,o=i*this.dim,s=i*this.dim+this.dim;switch(t){case-1:r=n-1;break;case 1:n=r+1}switch(i){case-1:o=s-1;break;case 1:s=o+1}const a=-t*this.dim,l=-i*this.dim;for(let t=o;t<s;t++)for(let i=r;i<n;i++)this.data[this._idx(i,t)]=e.data[this._idx(i+a,t+l)]}}qn("DEMData",hh);class dh{constructor(e){this._stringToNumber={},this._numberToString=[];for(let t=0;t<e.length;t++){const i=e[t];this._stringToNumber[i]=t,this._numberToString[t]=i}}encode(e){return this._stringToNumber[e]}decode(e){if(e>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${e} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[e]}}class ph{constructor(e,t,i,r,n){this.type="Feature",this._vectorTileFeature=e,e._z=t,e._x=i,e._y=r,this.properties=e.properties,this.id=n}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={geometry:this.geometry};for(const t in this)"_geometry"!==t&&"_vectorTileFeature"!==t&&(e[t]=this[t]);return e}}class fh{constructor(e,t){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new $n(E,16,0),this.grid3D=new $n(E,16,0),this.featureIndexArray=new _s,this.promoteId=t}insert(e,t,i,r,n,o){const s=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(i,r,n);const a=o?this.grid3D:this.grid;for(let e=0;e<t.length;e++){const i=t[e],r=[1/0,1/0,-1/0,-1/0];for(let e=0;e<i.length;e++){const t=i[e];r[0]=Math.min(r[0],t.x),r[1]=Math.min(r[1],t.y),r[2]=Math.max(r[2],t.x),r[3]=Math.max(r[3],t.y)}r[0]<E&&r[1]<E&&r[2]>=0&&r[3]>=0&&a.insert(s,r[0],r[1],r[2],r[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new tc.VectorTile(new Vc(this.rawTileData)).layers,this.sourceLayerCoder=new dh(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(e,t,i,r){this.loadVTLayers();const n=e.params,o=E/e.tileSize/e.scale,s=en(n.filter),a=e.queryGeometry,c=e.queryPadding*o,u=mh(a),h=this.grid.query(u.minX-c,u.minY-c,u.maxX+c,u.maxY+c),d=mh(e.cameraQueryGeometry),p=this.grid3D.query(d.minX-c,d.minY-c,d.maxX+c,d.maxY+c,((t,i,r,n)=>function(e,t,i,r,n){for(const o of e)if(t<=o.x&&i<=o.y&&r>=o.x&&n>=o.y)return!0;const o=[new l(t,i),new l(t,n),new l(r,n),new l(r,i)];if(e.length>2)for(const t of o)if(Sa(e,t))return!0;for(let t=0;t<e.length-1;t++)if(Ea(e[t],e[t+1],o))return!0;return!1}(e.cameraQueryGeometry,t-c,i-c,r+c,n+c)));for(const e of p)h.push(e);h.sort(gh);const f={};let A;for(let l=0;l<h.length;l++){const c=h[l];if(c===A)continue;A=c;const u=this.featureIndexArray.get(c);let d=null;this.loadMatchingFeature(f,u.bucketIndex,u.sourceLayerIndex,u.featureIndex,s,n.layers,n.availableImages,t,i,r,((t,i,r)=>(d||(d=pa(t)),i.queryIntersectsFeature({queryGeometry:a,feature:t,featureState:r,geometry:d,zoom:this.z,transform:e.transform,pixelsToTileUnits:o,pixelPosMatrix:e.pixelPosMatrix,unwrappedTileID:this.tileID.toUnwrapped(),getElevation:e.getElevation}))))}return f}loadMatchingFeature(e,t,i,r,n,o,s,a,l,c,u){const h=this.bucketLayerIDs[t];if(o&&!h.some((e=>o.has(e))))return;const d=this.sourceLayerCoder.decode(i),p=this.vtLayers[d].feature(r);if(n.needGeometry){const e=fa(p,!0);if(!n.filter(new mo(this.tileID.overscaledZ),e,this.tileID.canonical))return}else if(!n.filter(new mo(this.tileID.overscaledZ),p))return;const f=this.getId(p,d);for(let t=0;t<h.length;t++){const i=h[t];if(o&&!o.has(i))continue;const n=a[i];if(!n)continue;let d={};f&&c&&(d=c.getState(n.sourceLayer||"_geojsonTileLayer",f));const A=D({},l[i]);A.paint=Ah(A.paint,n.paint,p,d,s),A.layout=Ah(A.layout,n.layout,p,d,s);const m=!u||u(p,n,d);if(!m)continue;const g=new ph(p,this.z,this.x,this.y,f);g.layer=A;let _=e[i];void 0===_&&(_=e[i]=[]),_.push({featureIndex:r,feature:g,intersectionZ:m})}}lookupSymbolFeatures(e,t,i,r,n,o,s,a){const l={};this.loadVTLayers();const c=en(n);for(const n of e)this.loadMatchingFeature(l,i,r,n,c,o,s,a,t);return l}hasLayer(e){for(const t of this.bucketLayerIDs)for(const i of t)if(e===i)return!0;return!1}getId(e,t){var i;let r=e.id;return this.promoteId&&(r=e.properties["string"==typeof this.promoteId?this.promoteId:this.promoteId[t]],"boolean"==typeof r&&(r=Number(r)),void 0===r&&(null===(i=e.properties)||void 0===i?void 0:i.cluster)&&this.promoteId&&(r=Number(e.properties.cluster_id))),r}}function Ah(e,t,i,r,n){return U(e,((e,o)=>{const s=t instanceof To?t.get(o):null;return s&&s.evaluate?s.evaluate(i,r,n):s}))}function mh(e){let t=1/0,i=1/0,r=-1/0,n=-1/0;for(const o of e)t=Math.min(t,o.x),i=Math.min(i,o.y),r=Math.max(r,o.x),n=Math.max(n,o.y);return{minX:t,minY:i,maxX:r,maxY:n}}function gh(e,t){return t-e}function _h(e,t,i,r,n){const o=[];for(let s=0;s<e.length;s++){const a=e[s];let c;for(let e=0;e<a.length-1;e++){let s=a[e],u=a[e+1];s.x<t&&u.x<t||(s.x<t?s=new l(t,s.y+(t-s.x)/(u.x-s.x)*(u.y-s.y))._round():u.x<t&&(u=new l(t,s.y+(t-s.x)/(u.x-s.x)*(u.y-s.y))._round()),s.y<i&&u.y<i||(s.y<i?s=new l(s.x+(i-s.y)/(u.y-s.y)*(u.x-s.x),i)._round():u.y<i&&(u=new l(s.x+(i-s.y)/(u.y-s.y)*(u.x-s.x),i)._round()),s.x>=r&&u.x>=r||(s.x>=r?s=new l(r,s.y+(r-s.x)/(u.x-s.x)*(u.y-s.y))._round():u.x>=r&&(u=new l(r,s.y+(r-s.x)/(u.x-s.x)*(u.y-s.y))._round()),s.y>=n&&u.y>=n||(s.y>=n?s=new l(s.x+(n-s.y)/(u.y-s.y)*(u.x-s.x),n)._round():u.y>=n&&(u=new l(s.x+(n-s.y)/(u.y-s.y)*(u.x-s.x),n)._round()),c&&s.equals(c[c.length-1])||(c=[s],o.push(c)),c.push(u)))))}}return o}qn("FeatureIndex",fh,{omit:["rawTileData","sourceLayerCoder"]});class yh extends l{constructor(e,t,i,r){super(e,t),this.angle=i,void 0!==r&&(this.segment=r)}clone(){return new yh(this.x,this.y,this.angle,this.segment)}}function vh(e,t,i,r,n){if(void 0===t.segment||0===i)return!0;let o=t,s=t.segment+1,a=0;for(;a>-i/2;){if(s--,s<0)return!1;a-=e[s].dist(o),o=e[s]}a+=e[s].dist(e[s+1]),s++;const l=[];let c=0;for(;a<i/2;){const t=e[s],i=e[s+1];if(!i)return!1;let o=e[s-1].angleTo(t)-t.angleTo(i);for(o=Math.abs((o+3*Math.PI)%(2*Math.PI)-Math.PI),l.push({distance:a,angleDelta:o}),c+=o;a-l[0].distance>r;)c-=l.shift().angleDelta;if(c>n)return!1;s++,a+=t.dist(i)}return!0}function xh(e){let t=0;for(let i=0;i<e.length-1;i++)t+=e[i].dist(e[i+1]);return t}function bh(e,t,i){return e?.6*t*i:0}function wh(e,t){return Math.max(e?e.right-e.left:0,t?t.right-t.left:0)}function Th(e,t,i,r,n,o){const s=bh(i,n,o),a=wh(i,r)*o;let l=0;const c=xh(e)/2;for(let i=0;i<e.length-1;i++){const r=e[i],n=e[i+1],o=r.dist(n);if(l+o>c){const u=(c-l)/o,h=si.number(r.x,n.x,u),d=si.number(r.y,n.y,u),p=new yh(h,d,n.angleTo(r),i);return p._round(),!s||vh(e,p,a,s,t)?p:void 0}l+=o}}function Bh(e,t,i,r,n,o,s,a,l){const c=bh(r,o,s),u=wh(r,n),h=u*s,d=0===e[0].x||e[0].x===l||0===e[0].y||e[0].y===l;return t-h<t/4&&(t=h+t/4),Ch(e,d?t/2*a%t:(u/2+2*o)*s*a%t,t,c,i,h,d,!1,l)}function Ch(e,t,i,r,n,o,s,a,l){const c=o/2,u=xh(e);let h=0,d=t-i,p=[];for(let t=0;t<e.length-1;t++){const s=e[t],a=e[t+1],f=s.dist(a),A=a.angleTo(s);for(;d+i<h+f;){d+=i;const m=(d-h)/f,g=si.number(s.x,a.x,m),_=si.number(s.y,a.y,m);if(g>=0&&g<l&&_>=0&&_<l&&d-c>=0&&d+c<=u){const i=new yh(g,_,A,t);i._round(),r&&!vh(e,i,o,r,n)||p.push(i)}}h+=f}return a||p.length||s||(p=Ch(e,h/2,i,r,n,o,s,!0,l)),p}qn("Anchor",yh);const Sh=Wc;function Eh(e,t,i,r){const n=[],o=e.image,s=o.pixelRatio,a=o.paddedRect.w-2*Sh,c=o.paddedRect.h-2*Sh;let u={x1:e.left,y1:e.top,x2:e.right,y2:e.bottom};const h=o.stretchX||[[0,a]],d=o.stretchY||[[0,c]],p=(e,t)=>e+t[1]-t[0],f=h.reduce(p,0),A=d.reduce(p,0),m=a-f,g=c-A;let _=0,y=f,v=0,x=A,b=0,w=m,T=0,B=g;if(o.content&&r){const t=o.content,i=t[2]-t[0],r=t[3]-t[1];(o.textFitWidth||o.textFitHeight)&&(u=xu(e)),_=Mh(h,0,t[0]),v=Mh(d,0,t[1]),y=Mh(h,t[0],t[2]),x=Mh(d,t[1],t[3]),b=t[0]-_,T=t[1]-v,w=i-y,B=r-x}const C=u.x1,S=u.y1,E=u.x2-C,M=u.y2-S,I=(e,r,n,a)=>{const c=Ph(e.stretch-_,y,E,C),u=Lh(e.fixed-b,w,e.stretch,f),h=Ph(r.stretch-v,x,M,S),d=Lh(r.fixed-T,B,r.stretch,A),p=Ph(n.stretch-_,y,E,C),m=Lh(n.fixed-b,w,n.stretch,f),g=Ph(a.stretch-v,x,M,S),I=Lh(a.fixed-T,B,a.stretch,A),P=new l(c,h),L=new l(p,h),F=new l(p,g),k=new l(c,g),z=new l(u/s,d/s),R=new l(m/s,I/s),D=t*Math.PI/180;if(D){const e=Math.sin(D),t=Math.cos(D),i=[t,-e,e,t];P._matMult(i),L._matMult(i),k._matMult(i),F._matMult(i)}const O=e.stretch+e.fixed,U=r.stretch+r.fixed;return{tl:P,tr:L,bl:k,br:F,tex:{x:o.paddedRect.x+Sh+O,y:o.paddedRect.y+Sh+U,w:n.stretch+n.fixed-O,h:a.stretch+a.fixed-U},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:z,pixelOffsetBR:R,minFontScaleX:w/s/E,minFontScaleY:B/s/M,isSDF:i}};if(r&&(o.stretchX||o.stretchY)){const e=Ih(h,m,f),t=Ih(d,g,A);for(let i=0;i<e.length-1;i++){const r=e[i],o=e[i+1];for(let e=0;e<t.length-1;e++)n.push(I(r,t[e],o,t[e+1]))}}else n.push(I({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:a+1},{fixed:0,stretch:c+1}));return n}function Mh(e,t,i){let r=0;for(const n of e)r+=Math.max(t,Math.min(i,n[1]))-Math.max(t,Math.min(i,n[0]));return r}function Ih(e,t,i){const r=[{fixed:-1,stretch:0}];for(const[t,i]of e){const e=r[r.length-1];r.push({fixed:t-e.stretch,stretch:e.stretch}),r.push({fixed:t-e.stretch,stretch:e.stretch+(i-t)})}return r.push({fixed:t+Sh,stretch:i}),r}function Ph(e,t,i,r){return e/t*i+r}function Lh(e,t,i,r){return e-t*i/r}class Fh{constructor(e,t,i,r,n,o,s,a,c,u){var h;if(this.boxStartIndex=e.length,c){let e=o.top,t=o.bottom;const i=o.collisionPadding;i&&(e-=i[1],t+=i[3]);let r=t-e;r>0&&(r=Math.max(10,r),this.circleDiameter=r)}else{const c=(null===(h=o.image)||void 0===h?void 0:h.content)&&(o.image.textFitWidth||o.image.textFitHeight)?xu(o):{x1:o.left,y1:o.top,x2:o.right,y2:o.bottom};c.y1=c.y1*s-a[0],c.y2=c.y2*s+a[2],c.x1=c.x1*s-a[3],c.x2=c.x2*s+a[1];const d=o.collisionPadding;if(d&&(c.x1-=d[0]*s,c.y1-=d[1]*s,c.x2+=d[2]*s,c.y2+=d[3]*s),u){const e=new l(c.x1,c.y1),t=new l(c.x2,c.y1),i=new l(c.x1,c.y2),r=new l(c.x2,c.y2),n=u*Math.PI/180;e._rotate(n),t._rotate(n),i._rotate(n),r._rotate(n),c.x1=Math.min(e.x,t.x,i.x,r.x),c.x2=Math.max(e.x,t.x,i.x,r.x),c.y1=Math.min(e.y,t.y,i.y,r.y),c.y2=Math.max(e.y,t.y,i.y,r.y)}e.emplaceBack(t.x,t.y,c.x1,c.y1,c.x2,c.y2,i,r,n)}this.boxEndIndex=e.length}}class kh{constructor(e=[],t=(e,t)=>e<t?-1:e>t?1:0){if(this.data=e,this.length=this.data.length,this.compare=t,this.length>0)for(let e=(this.length>>1)-1;e>=0;e--)this._down(e)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(0===this.length)return;const e=this.data[0],t=this.data.pop();return--this.length>0&&(this.data[0]=t,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:t,compare:i}=this,r=t[e];for(;e>0;){const n=e-1>>1,o=t[n];if(i(r,o)>=0)break;t[e]=o,e=n}t[e]=r}_down(e){const{data:t,compare:i}=this,r=this.length>>1,n=t[e];for(;e<r;){let r=1+(e<<1);const o=r+1;if(o<this.length&&i(t[o],t[r])<0&&(r=o),i(t[r],n)>=0)break;t[e]=t[r],e=r}t[e]=n}}function zh(e,t=1,i=!1){let r=1/0,n=1/0,o=-1/0,s=-1/0;const a=e[0];for(let e=0;e<a.length;e++){const t=a[e];(!e||t.x<r)&&(r=t.x),(!e||t.y<n)&&(n=t.y),(!e||t.x>o)&&(o=t.x),(!e||t.y>s)&&(s=t.y)}const c=Math.min(o-r,s-n);let u=c/2;const h=new kh([],Rh);if(0===c)return new l(r,n);for(let t=r;t<o;t+=c)for(let i=n;i<s;i+=c)h.push(new Dh(t+u,i+u,u,e));let d=function(e){let t=0,i=0,r=0;const n=e[0];for(let e=0,o=n.length,s=o-1;e<o;s=e++){const o=n[e],a=n[s],l=o.x*a.y-a.x*o.y;i+=(o.x+a.x)*l,r+=(o.y+a.y)*l,t+=3*l}return new Dh(i/t,r/t,0,e)}(e),p=h.length;for(;h.length;){const r=h.pop();(r.d>d.d||!d.d)&&(d=r,i&&console.log("found best %d after %d probes",Math.round(1e4*r.d)/1e4,p)),r.max-d.d<=t||(u=r.h/2,h.push(new Dh(r.p.x-u,r.p.y-u,u,e)),h.push(new Dh(r.p.x+u,r.p.y-u,u,e)),h.push(new Dh(r.p.x-u,r.p.y+u,u,e)),h.push(new Dh(r.p.x+u,r.p.y+u,u,e)),p+=4)}return i&&(console.log(`num probes: ${p}`),console.log(`best distance: ${d.d}`)),d.p}function Rh(e,t){return t.max-e.max}function Dh(e,t,i,r){this.p=new l(e,t),this.h=i,this.d=function(e,t){let i=!1,r=1/0;for(let n=0;n<t.length;n++){const o=t[n];for(let t=0,n=o.length,s=n-1;t<n;s=t++){const n=o[t],a=o[s];n.y>e.y!=a.y>e.y&&e.x<(a.x-n.x)*(e.y-n.y)/(a.y-n.y)+n.x&&(i=!i),r=Math.min(r,Ba(e,n,a))}}return(i?1:-1)*Math.sqrt(r)}(this.p,r),this.max=this.d+this.h*Math.SQRT2}var Oh;e.aB=void 0,(Oh=e.aB||(e.aB={}))[Oh.center=1]="center",Oh[Oh.left=2]="left",Oh[Oh.right=3]="right",Oh[Oh.top=4]="top",Oh[Oh.bottom=5]="bottom",Oh[Oh["top-left"]=6]="top-left",Oh[Oh["top-right"]=7]="top-right",Oh[Oh["bottom-left"]=8]="bottom-left",Oh[Oh["bottom-right"]=9]="bottom-right";const Uh=7,Nh=Number.POSITIVE_INFINITY;function Qh(e,t){return t[1]!==Nh?function(e,t,i){let r=0,n=0;switch(t=Math.abs(t),i=Math.abs(i),e){case"top-right":case"top-left":case"top":n=i-Uh;break;case"bottom-right":case"bottom-left":case"bottom":n=-i+Uh}switch(e){case"top-right":case"bottom-right":case"right":r=-t;break;case"top-left":case"bottom-left":case"left":r=t}return[r,n]}(e,t[0],t[1]):function(e,t){let i=0,r=0;t<0&&(t=0);const n=t/Math.SQRT2;switch(e){case"top-right":case"top-left":r=n-Uh;break;case"bottom-right":case"bottom-left":r=-n+Uh;break;case"bottom":r=-t+Uh;break;case"top":r=t-Uh}switch(e){case"top-right":case"bottom-right":i=-n;break;case"top-left":case"bottom-left":i=n;break;case"left":i=t;break;case"right":i=-t}return[i,r]}(e,t[0])}function jh(e,t,i){var r;const n=e.layout,o=null===(r=n.get("text-variable-anchor-offset"))||void 0===r?void 0:r.evaluate(t,{},i);if(o){const e=o.values,t=[];for(let i=0;i<e.length;i+=2){const r=t[i]=e[i],n=e[i+1].map((e=>e*Uc));r.startsWith("top")?n[1]-=Uh:r.startsWith("bottom")&&(n[1]+=Uh),t[i+1]=n}return new Et(t)}const s=n.get("text-variable-anchor");if(s){let r;r=void 0!==e._unevaluatedLayout.getValue("text-radial-offset")?[n.get("text-radial-offset").evaluate(t,{},i)*Uc,Nh]:n.get("text-offset").evaluate(t,{},i).map((e=>e*Uc));const o=[];for(const e of s)o.push(e,Qh(e,r));return new Et(o)}return null}function Vh(e){switch(e){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Hh(t,i,r,n,o,s,a,l,c,u,h,d){let p=s.textMaxSize.evaluate(i,{});void 0===p&&(p=a);const f=t.layers[0].layout,A=f.get("icon-offset").evaluate(i,{},h),m=$h(r.horizontal),g=a/24,_=t.tilePixelRatio*g,y=t.tilePixelRatio*p/24,v=t.tilePixelRatio*l,x=t.tilePixelRatio*f.get("symbol-spacing"),b=f.get("text-padding")*t.tilePixelRatio,w=function(e,t,i,r=1){const n=e.get("icon-padding").evaluate(t,{},i),o=n&&n.values;return[o[0]*r,o[1]*r,o[2]*r,o[3]*r]}(f,i,h,t.tilePixelRatio),T=f.get("text-max-angle")/180*Math.PI,B="viewport"!==f.get("text-rotation-alignment")&&"point"!==f.get("symbol-placement"),C="map"===f.get("icon-rotation-alignment")&&"point"!==f.get("symbol-placement"),S=f.get("symbol-placement"),M=x/2,I=f.get("icon-text-fit");let P;n&&"none"!==I&&(t.allowVerticalPlacement&&r.vertical&&(P=bu(n,r.vertical,I,f.get("icon-text-fit-padding"),A,g)),m&&(n=bu(n,m,I,f.get("icon-text-fit-padding"),A,g)));const L=h?d.line.getGranularityForZoomLevel(h.z):1,F=(l,d)=>{d.x<0||d.x>=E||d.y<0||d.y>=E||function(t,i,r,n,o,s,a,l,c,u,h,d,p,f,A,m,g,_,y,v,x,b,w,T,B){const C=t.addToLineVertexArray(i,r);let S,E,M,I,P=0,L=0,F=0,k=0,z=-1,R=-1;const D={};let O=Gs("");if(t.allowVerticalPlacement&&n.vertical){const e=l.layout.get("text-rotate").evaluate(x,{},T)+90;M=new Fh(c,i,u,h,d,n.vertical,p,f,A,e),a&&(I=new Fh(c,i,u,h,d,a,g,_,A,e))}if(o){const r=l.layout.get("icon-rotate").evaluate(x,{}),n="none"!==l.layout.get("icon-text-fit"),s=Eh(o,r,w,n),p=a?Eh(a,r,w,n):void 0;E=new Fh(c,i,u,h,d,o,g,_,!1,r),P=4*s.length;const f=t.iconSizeData;let A=null;"source"===f.kind?(A=[Tu*l.layout.get("icon-size").evaluate(x,{})],A[0]>Bu&&V(`${t.layerIds[0]}: Value for "icon-size" is >= ${wu}. Reduce your "icon-size".`)):"composite"===f.kind&&(A=[Tu*b.compositeIconSizes[0].evaluate(x,{},T),Tu*b.compositeIconSizes[1].evaluate(x,{},T)],(A[0]>Bu||A[1]>Bu)&&V(`${t.layerIds[0]}: Value for "icon-size" is >= ${wu}. Reduce your "icon-size".`)),t.addSymbols(t.icon,s,A,v,y,x,e.al.none,i,C.lineStartIndex,C.lineLength,-1,T),z=t.icon.placedSymbolArray.length-1,p&&(L=4*p.length,t.addSymbols(t.icon,p,A,v,y,x,e.al.vertical,i,C.lineStartIndex,C.lineLength,-1,T),R=t.icon.placedSymbolArray.length-1)}const U=Object.keys(n.horizontal);for(const r of U){const o=n.horizontal[r];if(!S){O=Gs(o.text);const e=l.layout.get("text-rotate").evaluate(x,{},T);S=new Fh(c,i,u,h,d,o,p,f,A,e)}const a=1===o.positionedLines.length;if(F+=Gh(t,i,o,s,l,A,x,m,C,n.vertical?e.al.horizontal:e.al.horizontalOnly,a?U:[r],D,z,b,T),a)break}n.vertical&&(k+=Gh(t,i,n.vertical,s,l,A,x,m,C,e.al.vertical,["vertical"],D,R,b,T));const N=S?S.boxStartIndex:t.collisionBoxArray.length,Q=S?S.boxEndIndex:t.collisionBoxArray.length,j=M?M.boxStartIndex:t.collisionBoxArray.length,H=M?M.boxEndIndex:t.collisionBoxArray.length,G=E?E.boxStartIndex:t.collisionBoxArray.length,$=E?E.boxEndIndex:t.collisionBoxArray.length,Z=I?I.boxStartIndex:t.collisionBoxArray.length,q=I?I.boxEndIndex:t.collisionBoxArray.length;let K=-1;const W=(e,t)=>e&&e.circleDiameter?Math.max(e.circleDiameter,t):t;K=W(S,K),K=W(M,K),K=W(E,K),K=W(I,K);const X=K>-1?1:0;X&&(K*=B/Uc),t.glyphOffsetArray.length>=zu.MAX_GLYPHS&&V("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==x.sortKey&&t.addToSortKeyRanges(t.symbolInstances.length,x.sortKey);const Y=jh(l,x,T),[J,ee]=function(t,i){const r=t.length,n=null==i?void 0:i.values;if((null==n?void 0:n.length)>0)for(let i=0;i<n.length;i+=2){const r=n[i+1];t.emplaceBack(e.aB[n[i]],r[0],r[1])}return[r,t.length]}(t.textAnchorOffsets,Y);t.symbolInstances.emplaceBack(i.x,i.y,D.right>=0?D.right:-1,D.center>=0?D.center:-1,D.left>=0?D.left:-1,D.vertical||-1,z,R,O,N,Q,j,H,G,$,Z,q,u,F,k,P,L,X,0,p,K,J,ee)}(t,d,l,r,n,o,P,t.layers[0],t.collisionBoxArray,i.index,i.sourceLayerIndex,t.index,_,[b,b,b,b],B,c,v,w,C,A,i,s,u,h,a)};if("line"===S)for(const e of _h(i.geometry,0,0,E,E)){const i=Ll(e,L),o=Bh(i,x,T,r.vertical||m,n,24,y,t.overscaling,E);for(const e of o)m&&Zh(t,m.text,M,e)||F(i,e)}else if("line-center"===S){for(const e of i.geometry)if(e.length>1){const t=Ll(e,L),i=Th(t,T,r.vertical||m,n,24,y);i&&F(t,i)}}else if("Polygon"===i.type)for(const e of Gi(i.geometry,0)){const t=zh(e,16);F(Ll(e[0],L,!0),new yh(t.x,t.y,0))}else if("LineString"===i.type)for(const e of i.geometry){const t=Ll(e,L);F(t,new yh(t[0].x,t[0].y,0))}else if("Point"===i.type)for(const e of i.geometry)for(const t of e)F([t],new yh(t.x,t.y,0))}function Gh(e,t,i,r,n,o,s,a,c,u,h,d,p,f,A){const m=function(e,t,i,r,n,o,s,a){const c=r.layout.get("text-rotate").evaluate(o,{})*Math.PI/180,u=[];for(const e of t.positionedLines)for(const r of e.positionedGlyphs){if(!r.rect)continue;const o=r.rect||{};let h=qc+1,d=!0,p=1,f=0;const A=(n||a)&&r.vertical,m=r.metrics.advance*r.scale/2;if(a&&t.verticalizable&&(f=e.lineOffset/2-(r.imageName?-(Uc-r.metrics.width*r.scale)/2:(r.scale-1)*Uc)),r.imageName){const e=s[r.imageName];d=e.sdf,p=e.pixelRatio,h=Wc/p}const g=n?[r.x+m,r.y]:[0,0];let _=n?[0,0]:[r.x+m+i[0],r.y+i[1]-f],y=[0,0];A&&(y=_,_=[0,0]);const v=r.metrics.isDoubleResolution?2:1,x=(r.metrics.left-h)*r.scale-m+_[0],b=(-r.metrics.top-h)*r.scale+_[1],w=x+o.w/v*r.scale/p,T=b+o.h/v*r.scale/p,B=new l(x,b),C=new l(w,b),S=new l(x,T),E=new l(w,T);if(A){const e=new l(-m,m-eu),t=-Math.PI/2,i=Uc/2-m,n=new l(5-eu-i,-(r.imageName?i:0)),o=new l(...y);B._rotateAround(t,e)._add(n)._add(o),C._rotateAround(t,e)._add(n)._add(o),S._rotateAround(t,e)._add(n)._add(o),E._rotateAround(t,e)._add(n)._add(o)}if(c){const e=Math.sin(c),t=Math.cos(c),i=[t,-e,e,t];B._matMult(i),C._matMult(i),S._matMult(i),E._matMult(i)}const M=new l(0,0),I=new l(0,0);u.push({tl:B,tr:C,bl:S,br:E,tex:o,writingMode:t.writingMode,glyphOffset:g,sectionIndex:r.sectionIndex,isSDF:d,pixelOffsetTL:M,pixelOffsetBR:I,minFontScaleX:0,minFontScaleY:0})}return u}(0,i,a,n,o,s,r,e.allowVerticalPlacement),g=e.textSizeData;let _=null;"source"===g.kind?(_=[Tu*n.layout.get("text-size").evaluate(s,{})],_[0]>Bu&&V(`${e.layerIds[0]}: Value for "text-size" is >= ${wu}. Reduce your "text-size".`)):"composite"===g.kind&&(_=[Tu*f.compositeTextSizes[0].evaluate(s,{},A),Tu*f.compositeTextSizes[1].evaluate(s,{},A)],(_[0]>Bu||_[1]>Bu)&&V(`${e.layerIds[0]}: Value for "text-size" is >= ${wu}. Reduce your "text-size".`)),e.addSymbols(e.text,m,_,a,o,s,u,t,c.lineStartIndex,c.lineLength,p,A);for(const t of h)d[t]=e.text.placedSymbolArray.length-1;return 4*m.length}function $h(e){for(const t in e)return e[t];return null}function Zh(e,t,i,r){const n=e.compareText;if(t in n){const e=n[t];for(let t=e.length-1;t>=0;t--)if(r.dist(e[t])<i)return!0}else n[t]=[];return n[t].push(r),!1}const qh=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Kh{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[t,i]=new Uint8Array(e,0,2);if(219!==t)throw new Error("Data does not appear to be in a KDBush format.");const r=i>>4;if(1!==r)throw new Error(`Got v${r} data when expected v1.`);const n=qh[15&i];if(!n)throw new Error("Unrecognized array type.");const[o]=new Uint16Array(e,2,1),[s]=new Uint32Array(e,4,1);return new Kh(s,o,n,e)}constructor(e,t=64,i=Float64Array,r){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+t,2),65535),this.ArrayType=i,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const n=qh.indexOf(this.ArrayType),o=2*e*this.ArrayType.BYTES_PER_ELEMENT,s=e*this.IndexArrayType.BYTES_PER_ELEMENT,a=(8-s%8)%8;if(n<0)throw new Error(`Unexpected typed array class: ${i}.`);r&&r instanceof ArrayBuffer?(this.data=r,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+s+a,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+o+s+a),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+s+a,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+n]),new Uint16Array(this.data,2,1)[0]=t,new Uint32Array(this.data,4,1)[0]=e)}add(e,t){const i=this._pos>>1;return this.ids[i]=i,this.coords[this._pos++]=e,this.coords[this._pos++]=t,i}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return Wh(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,t,i,r){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:n,coords:o,nodeSize:s}=this,a=[0,n.length-1,0],l=[];for(;a.length;){const c=a.pop()||0,u=a.pop()||0,h=a.pop()||0;if(u-h<=s){for(let s=h;s<=u;s++){const a=o[2*s],c=o[2*s+1];a>=e&&a<=i&&c>=t&&c<=r&&l.push(n[s])}continue}const d=h+u>>1,p=o[2*d],f=o[2*d+1];p>=e&&p<=i&&f>=t&&f<=r&&l.push(n[d]),(0===c?e<=p:t<=f)&&(a.push(h),a.push(d-1),a.push(1-c)),(0===c?i>=p:r>=f)&&(a.push(d+1),a.push(u),a.push(1-c))}return l}within(e,t,i){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:r,coords:n,nodeSize:o}=this,s=[0,r.length-1,0],a=[],l=i*i;for(;s.length;){const c=s.pop()||0,u=s.pop()||0,h=s.pop()||0;if(u-h<=o){for(let i=h;i<=u;i++)ed(n[2*i],n[2*i+1],e,t)<=l&&a.push(r[i]);continue}const d=h+u>>1,p=n[2*d],f=n[2*d+1];ed(p,f,e,t)<=l&&a.push(r[d]),(0===c?e-i<=p:t-i<=f)&&(s.push(h),s.push(d-1),s.push(1-c)),(0===c?e+i>=p:t+i>=f)&&(s.push(d+1),s.push(u),s.push(1-c))}return a}}function Wh(e,t,i,r,n,o){if(n-r<=i)return;const s=r+n>>1;Xh(e,t,s,r,n,o),Wh(e,t,i,r,s-1,1-o),Wh(e,t,i,s+1,n,1-o)}function Xh(e,t,i,r,n,o){for(;n>r;){if(n-r>600){const s=n-r+1,a=i-r+1,l=Math.log(s),c=.5*Math.exp(2*l/3),u=.5*Math.sqrt(l*c*(s-c)/s)*(a-s/2<0?-1:1);Xh(e,t,i,Math.max(r,Math.floor(i-a*c/s+u)),Math.min(n,Math.floor(i+(s-a)*c/s+u)),o)}const s=t[2*i+o];let a=r,l=n;for(Yh(e,t,r,i),t[2*n+o]>s&&Yh(e,t,r,n);a<l;){for(Yh(e,t,a,l),a++,l--;t[2*a+o]<s;)a++;for(;t[2*l+o]>s;)l--}t[2*r+o]===s?Yh(e,t,r,l):(l++,Yh(e,t,l,n)),l<=i&&(r=l+1),i<=l&&(n=l-1)}}function Yh(e,t,i,r){Jh(e,i,r),Jh(t,2*i,2*r),Jh(t,2*i+1,2*r+1)}function Jh(e,t,i){const r=e[t];e[t]=e[i],e[i]=r}function ed(e,t,i,r){const n=e-i,o=t-r;return n*n+o*o}var td;e.cm=void 0,(td=e.cm||(e.cm={})).create="create",td.load="load",td.fullLoad="fullLoad";let id=null,rd=[];const nd=1e3/60,od="loadTime",sd="fullLoadTime",ad={mark(e){performance.mark(e)},frame(e){const t=e;null!=id&&rd.push(t-id),id=t},clearMetrics(){id=null,rd=[],performance.clearMeasures(od),performance.clearMeasures(sd);for(const t in e.cm)performance.clearMarks(e.cm[t])},getPerformanceMetrics(){performance.measure(od,e.cm.create,e.cm.load),performance.measure(sd,e.cm.create,e.cm.fullLoad);const t=performance.getEntriesByName(od)[0].duration,i=performance.getEntriesByName(sd)[0].duration,r=rd.length,n=1/(rd.reduce(((e,t)=>e+t),0)/r/1e3),o=rd.filter((e=>e>nd)).reduce(((e,t)=>e+(t-nd)/nd),0);return{loadTime:t,fullLoadTime:i,fps:n,percentDroppedFrames:o/(r+o)*100,totalFrames:r}}};e.$=oh,e.A=m,e.B=si,e.C=mo,e.D=Bo,e.E=Ae,e.F=jn,e.G=function(e){if(null==$){const t=e.navigator?e.navigator.userAgent:null;$=!!e.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return $},e.H=class{constructor(e,t){this.target=e,this.mapId=t,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new qu((()=>this.process())),this.subscription=Y(this.target,"message",(e=>this.receive(e)),!1),this.globalScope=G(self)?e:window}registerMessageHandler(e,t){this.messageHandlers[e]=t}sendAsync(e,t){return new Promise(((i,r)=>{const n=Math.round(1e18*Math.random()).toString(36).substring(0,10),o=t?Y(t.signal,"abort",(()=>{null==o||o.unsubscribe(),delete this.resolveRejects[n];const t={id:n,type:"<cancel>",origin:location.origin,targetMapId:e.targetMapId,sourceMapId:this.mapId};this.target.postMessage(t)}),Ku):null;this.resolveRejects[n]={resolve:e=>{null==o||o.unsubscribe(),i(e)},reject:e=>{null==o||o.unsubscribe(),r(e)}};const s=[],a=Object.assign(Object.assign({},e),{id:n,sourceMapId:this.mapId,origin:location.origin,data:Yn(e.data,s)});this.target.postMessage(a,{transfer:s})}))}receive(e){const t=e.data,i=t.id;if(!("file://"!==t.origin&&"file://"!==location.origin&&"resource://android"!==t.origin&&"resource://android"!==location.origin&&t.origin!==location.origin||t.targetMapId&&this.mapId!==t.targetMapId)){if("<cancel>"===t.type){delete this.tasks[i];const e=this.abortControllers[i];return delete this.abortControllers[i],void(e&&e.abort())}if(G(self)||t.mustQueue)return this.tasks[i]=t,this.taskQueue.push(i),void this.invoker.trigger();this.processTask(i,t)}}process(){if(0===this.taskQueue.length)return;const e=this.taskQueue.shift(),t=this.tasks[e];delete this.tasks[e],this.taskQueue.length>0&&this.invoker.trigger(),t&&this.processTask(e,t)}processTask(e,i){return t(this,void 0,void 0,(function*(){if("<response>"===i.type){const t=this.resolveRejects[e];if(delete this.resolveRejects[e],!t)return;return void(i.error?t.reject(Jn(i.error)):t.resolve(Jn(i.data)))}if(!this.messageHandlers[i.type])return void this.completeTask(e,new Error(`Could not find a registered handler for ${i.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const t=Jn(i.data),r=new AbortController;this.abortControllers[e]=r;try{const n=yield this.messageHandlers[i.type](i.sourceMapId,t,r);this.completeTask(e,null,n)}catch(t){this.completeTask(e,t)}}))}completeTask(e,t,i){const r=[];delete this.abortControllers[e];const n={id:e,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:t?Yn(t):null,data:Yn(i,r)};this.target.postMessage(n,{transfer:r})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},e.I=Xc,e.J=se,e.K=function(){var e=new m(16);return m!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e},e.L=function(e,t,i){var r,n,o,s,a,l,c,u,h,d,p,f,A=i[0],m=i[1],g=i[2];return t===e?(e[12]=t[0]*A+t[4]*m+t[8]*g+t[12],e[13]=t[1]*A+t[5]*m+t[9]*g+t[13],e[14]=t[2]*A+t[6]*m+t[10]*g+t[14],e[15]=t[3]*A+t[7]*m+t[11]*g+t[15]):(n=t[1],o=t[2],s=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=t[9],p=t[10],f=t[11],e[0]=r=t[0],e[1]=n,e[2]=o,e[3]=s,e[4]=a,e[5]=l,e[6]=c,e[7]=u,e[8]=h,e[9]=d,e[10]=p,e[11]=f,e[12]=r*A+a*m+h*g+t[12],e[13]=n*A+l*m+d*g+t[13],e[14]=o*A+c*m+p*g+t[14],e[15]=s*A+u*m+f*g+t[15]),e},e.M=function(e,t,i){var r=i[0],n=i[1],o=i[2];return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*o,e[9]=t[9]*o,e[10]=t[10]*o,e[11]=t[11]*o,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},e.N=function(e,t,i){var r=t[0],n=t[1],o=t[2],s=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=t[9],p=t[10],f=t[11],A=t[12],m=t[13],g=t[14],_=t[15],y=i[0],v=i[1],x=i[2],b=i[3];return e[0]=y*r+v*a+x*h+b*A,e[1]=y*n+v*l+x*d+b*m,e[2]=y*o+v*c+x*p+b*g,e[3]=y*s+v*u+x*f+b*_,e[4]=(y=i[4])*r+(v=i[5])*a+(x=i[6])*h+(b=i[7])*A,e[5]=y*n+v*l+x*d+b*m,e[6]=y*o+v*c+x*p+b*g,e[7]=y*s+v*u+x*f+b*_,e[8]=(y=i[8])*r+(v=i[9])*a+(x=i[10])*h+(b=i[11])*A,e[9]=y*n+v*l+x*d+b*m,e[10]=y*o+v*c+x*p+b*g,e[11]=y*s+v*u+x*f+b*_,e[12]=(y=i[12])*r+(v=i[13])*a+(x=i[14])*h+(b=i[15])*A,e[13]=y*n+v*l+x*d+b*m,e[14]=y*o+v*c+x*p+b*g,e[15]=y*s+v*u+x*f+b*_,e},e.O=function(e,t){const i={};for(let r=0;r<t.length;r++){const n=t[r];n in e&&(i[n]=e[n])}return i},e.P=l,e.Q=Xu,e.R=Ha,e.S=th,e.T=yo,e.U=eh,e.V=p,e.W=f,e.X=K,e.Y=ch,e.Z=E,e._=t,e.a=ne,e.a$=function(e,t,i){var r=Math.sin(i),n=Math.cos(i),o=t[4],s=t[5],a=t[6],l=t[7],c=t[8],u=t[9],h=t[10],d=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=o*n+c*r,e[5]=s*n+u*r,e[6]=a*n+h*r,e[7]=l*n+d*r,e[8]=c*n-o*r,e[9]=u*n-s*r,e[10]=h*n-a*r,e[11]=d*n-l*r,e},e.a0=25,e.a1=ah,e.a2=e=>{const t=window.document.createElement("video");return t.muted=!0,new Promise((i=>{t.onloadstart=()=>{i(t)};for(const i of e){const e=window.document.createElement("source");ue(i)||(t.crossOrigin="Anonymous"),e.src=i,t.appendChild(e)}}))},e.a3=Ee,e.a4=function(){return O++},e.a5=ls,e.a6=zu,e.a7=en,e.a8=fa,e.a9=ph,e.aA=function(e,t,i,r,n=!1){if(!i[0]&&!i[1])return[0,0];const o=n?"map"===r?-e.bearingInRadians:0:"viewport"===r?e.bearingInRadians:0;if(o){const e=Math.sin(o),t=Math.cos(o);i=[i[0]*t-i[1]*e,i[0]*e+i[1]*t]}return[n?i[0]:M(t,i[0],e.zoom),n?i[1]:M(t,i[1],e.zoom)]},e.aC=Su,e.aD=Vh,e.aE=pu,e.aF=Kh,e.aG=Ro,e.aH=Sl,e.aI=ys,e.aJ=zs,e.aK=Ps,e.aL=R,e.aM=J,e.aN=nh,e.aO=function(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e},e.aP=function(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e},e.aQ=function(e){var t=new m(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},e.aR=function(e,t,i){return e[0]=t[0]*i[0],e[1]=t[1]*i[1],e[2]=t[2]*i[2],e[3]=t[3]*i[3],e},e.aS=function(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e},e.aT=function(e,t){var i=t[0],r=t[1],n=t[2],o=i*i+r*r+n*n;return o>0&&(o=1/Math.sqrt(o)),e[0]=t[0]*o,e[1]=t[1]*o,e[2]=t[2]*o,e},e.aU=function(e,t,i){var r=t[0],n=t[1],o=t[2],s=i[0],a=i[1],l=i[2];return e[0]=n*l-o*a,e[1]=o*s-r*l,e[2]=r*a-n*s,e},e.aV=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},e.aW=lh,e.aX=uh,e.aY=function(e,t,i,r,n){var o,s=1/Math.tan(t/2);return e[0]=s/i,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=n&&n!==1/0?(e[10]=(n+r)*(o=1/(r-n)),e[14]=2*n*r*o):(e[10]=-1,e[14]=-2*r),e},e.aZ=function(e){var t=new m(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},e.a_=function(e,t,i){var r=Math.sin(i),n=Math.cos(i),o=t[0],s=t[1],a=t[2],l=t[3],c=t[4],u=t[5],h=t[6],d=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*n+c*r,e[1]=s*n+u*r,e[2]=a*n+h*r,e[3]=l*n+d*r,e[4]=c*n-o*r,e[5]=u*n-s*r,e[6]=h*n-a*r,e[7]=d*n-l*r,e},e.aa=function(e){const t={};if(e.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((e,i,r,n)=>{const o=r||n;return t[i]=!o||o.toLowerCase(),""})),t["max-age"]){const e=parseInt(t["max-age"],10);isNaN(e)?delete t["max-age"]:t["max-age"]=e}return t},e.ab=function(e){return e*Math.PI/180},e.ac=function(e){return Math.pow(2,e)},e.ad=_,e.ae=z,e.af=85.051129,e.ag=ih,e.ah=function(e){return Math.log(e)/Math.LN2},e.ai=function(e){var t=e[0],i=e[1];return t*t+i*i},e.aj=function(e,t){const i=[];for(const r in e)r in t||i.push(r);return i},e.ak=function(e,t){let i=0,r=0;if("constant"===e.kind)r=e.layoutSize;else if("source"!==e.kind){const{interpolationType:n,minZoom:o,maxZoom:s}=e,a=n?z(ni.interpolationFactor(n,t,o,s),0,1):0;"camera"===e.kind?r=si.number(e.minSize,e.maxSize,a):i=a}return{uSizeT:i,uSize:r}},e.am=function(e,{uSize:t,uSizeT:i},{lowerSize:r,upperSize:n}){return"source"===e.kind?r/Tu:"composite"===e.kind?si.number(r/Tu,n/Tu,i):t},e.an=function(e,t){var i=t[0],r=t[1],n=t[2],o=t[3],s=t[4],a=t[5],l=t[6],c=t[7],u=t[8],h=t[9],d=t[10],p=t[11],f=t[12],A=t[13],m=t[14],g=t[15],_=i*a-r*s,y=i*l-n*s,v=i*c-o*s,x=r*l-n*a,b=r*c-o*a,w=n*c-o*l,T=u*A-h*f,B=u*m-d*f,C=u*g-p*f,S=h*m-d*A,E=h*g-p*A,M=d*g-p*m,I=_*M-y*E+v*S+x*C-b*B+w*T;return I?(e[0]=(a*M-l*E+c*S)*(I=1/I),e[1]=(n*E-r*M-o*S)*I,e[2]=(A*w-m*b+g*x)*I,e[3]=(d*b-h*w-p*x)*I,e[4]=(l*C-s*M-c*B)*I,e[5]=(i*M-n*C+o*B)*I,e[6]=(m*v-f*w-g*y)*I,e[7]=(u*w-d*v+p*y)*I,e[8]=(s*E-a*C+c*T)*I,e[9]=(r*C-i*E-o*T)*I,e[10]=(f*b-A*v+g*_)*I,e[11]=(h*v-u*b-p*_)*I,e[12]=(a*B-s*S-l*T)*I,e[13]=(i*S-r*B+n*T)*I,e[14]=(A*y-f*x-m*_)*I,e[15]=(u*x-h*y+d*_)*I,e):null},e.ao=C,e.ap=function(e){return Math.hypot(e[0],e[1])},e.aq=function(e){return e[0]=0,e[1]=0,e},e.ar=function(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e},e.as=Pu,e.at=T,e.au=function(e,t,i,r){const n=t.y-e.y,o=t.x-e.x,s=r.y-i.y,a=r.x-i.x,c=s*o-a*n;if(0===c)return null;const u=(a*(e.y-i.y)-s*(e.x-i.x))/c;return new l(e.x+u*o,e.y+u*n)},e.av=_h,e.aw=_a,e.ax=function(e){let t=1/0,i=1/0,r=-1/0,n=-1/0;for(const o of e)t=Math.min(t,o.x),i=Math.min(i,o.y),r=Math.max(r,o.x),n=Math.max(n,o.y);return[t,i,r,n]},e.ay=Uc,e.az=M,e.b=Z,e.b$=function(e,t){var i=e[0],r=e[1],n=e[2],o=e[3],s=e[4],a=e[5],l=e[6],c=e[7],u=e[8],h=e[9],d=e[10],p=e[11],f=e[12],m=e[13],g=e[14],_=e[15],y=t[0],v=t[1],x=t[2],b=t[3],w=t[4],T=t[5],B=t[6],C=t[7],S=t[8],E=t[9],M=t[10],I=t[11],P=t[12],L=t[13],F=t[14],k=t[15];return Math.abs(i-y)<=A*Math.max(1,Math.abs(i),Math.abs(y))&&Math.abs(r-v)<=A*Math.max(1,Math.abs(r),Math.abs(v))&&Math.abs(n-x)<=A*Math.max(1,Math.abs(n),Math.abs(x))&&Math.abs(o-b)<=A*Math.max(1,Math.abs(o),Math.abs(b))&&Math.abs(s-w)<=A*Math.max(1,Math.abs(s),Math.abs(w))&&Math.abs(a-T)<=A*Math.max(1,Math.abs(a),Math.abs(T))&&Math.abs(l-B)<=A*Math.max(1,Math.abs(l),Math.abs(B))&&Math.abs(c-C)<=A*Math.max(1,Math.abs(c),Math.abs(C))&&Math.abs(u-S)<=A*Math.max(1,Math.abs(u),Math.abs(S))&&Math.abs(h-E)<=A*Math.max(1,Math.abs(h),Math.abs(E))&&Math.abs(d-M)<=A*Math.max(1,Math.abs(d),Math.abs(M))&&Math.abs(p-I)<=A*Math.max(1,Math.abs(p),Math.abs(I))&&Math.abs(f-P)<=A*Math.max(1,Math.abs(f),Math.abs(P))&&Math.abs(m-L)<=A*Math.max(1,Math.abs(m),Math.abs(L))&&Math.abs(g-F)<=A*Math.max(1,Math.abs(g),Math.abs(F))&&Math.abs(_-k)<=A*Math.max(1,Math.abs(_),Math.abs(k))},e.b0=function(){const e=new Float32Array(16);return _(e),e},e.b1=function(){const e=new Float64Array(16);return _(e),e},e.b2=function(){return new Float64Array(16)},e.b3=function(e,t,i){const r=new Float64Array(4);return function(e,t,i,r){var n=.5*Math.PI/180;t*=n,i*=n,r*=n;var o=Math.sin(t),s=Math.cos(t),a=Math.sin(i),l=Math.cos(i),c=Math.sin(r),u=Math.cos(r);e[0]=o*l*u-s*a*c,e[1]=s*a*u+o*l*c,e[2]=s*l*c-o*a*u,e[3]=s*l*u+o*a*c}(r,e,t-90,i),r},e.b4=function(e,t,i,r){var n,o,s,a,l,c=t[0],u=t[1],h=t[2],d=t[3],p=i[0],f=i[1],m=i[2],g=i[3];return(o=c*p+u*f+h*m+d*g)<0&&(o=-o,p=-p,f=-f,m=-m,g=-g),1-o>A?(n=Math.acos(o),s=Math.sin(n),a=Math.sin((1-r)*n)/s,l=Math.sin(r*n)/s):(a=1-r,l=r),e[0]=a*c+l*p,e[1]=a*u+l*f,e[2]=a*h+l*m,e[3]=a*d+l*g,e},e.b5=function(e){const t=new Float64Array(9);var i,r,n,o,s,a,l,c,u,h,d,p,f,A,m,g,_,y;h=(n=(r=e)[0])*(l=n+n),d=(o=r[1])*l,f=(s=r[2])*l,A=s*(c=o+o),g=(a=r[3])*l,_=a*c,y=a*(u=s+s),(i=t)[0]=1-(p=o*c)-(m=s*u),i[3]=d-y,i[6]=f+_,i[1]=d+y,i[4]=1-h-m,i[7]=A-g,i[2]=f-_,i[5]=A+g,i[8]=1-h-p;const v=J(-Math.asin(z(t[2],-1,1)));let x,b;return Math.hypot(t[5],t[8])<.001?(x=0,b=-J(Math.atan2(t[3],t[4]))):(x=J(0===t[5]&&0===t[8]?0:Math.atan2(t[5],t[8])),b=J(0===t[1]&&0===t[0]?0:Math.atan2(t[1],t[0]))),{roll:x,pitch:v+90,bearing:b}},e.b6=function(e,t){return e.roll==t.roll&&e.pitch==t.pitch&&e.bearing==t.bearing},e.b7=vt,e.b8=Xs,e.b9=El,e.bA=function(e){if("custom"===e.type)return new Zu(e);switch(e.type){case"background":return new Vu(e);case"circle":return new za(e);case"fill":return new Nl(e);case"fill-extrusion":return new hc(e);case"heatmap":return new Za(e);case"hillshade":return new Wa(e);case"line":return new Sc(e);case"raster":return new $u(e);case"symbol":return new Nu(e)}},e.bB=Q,e.bC=function(e,t){if(!e)return[{command:"setStyle",args:[t]}];let i=[];try{if(!ye(e.version,t.version))return[{command:"setStyle",args:[t]}];ye(e.center,t.center)||i.push({command:"setCenter",args:[t.center]}),ye(e.centerAltitude,t.centerAltitude)||i.push({command:"setCenterAltitude",args:[t.centerAltitude]}),ye(e.zoom,t.zoom)||i.push({command:"setZoom",args:[t.zoom]}),ye(e.bearing,t.bearing)||i.push({command:"setBearing",args:[t.bearing]}),ye(e.pitch,t.pitch)||i.push({command:"setPitch",args:[t.pitch]}),ye(e.roll,t.roll)||i.push({command:"setRoll",args:[t.roll]}),ye(e.sprite,t.sprite)||i.push({command:"setSprite",args:[t.sprite]}),ye(e.glyphs,t.glyphs)||i.push({command:"setGlyphs",args:[t.glyphs]}),ye(e.transition,t.transition)||i.push({command:"setTransition",args:[t.transition]}),ye(e.light,t.light)||i.push({command:"setLight",args:[t.light]}),ye(e.terrain,t.terrain)||i.push({command:"setTerrain",args:[t.terrain]}),ye(e.sky,t.sky)||i.push({command:"setSky",args:[t.sky]}),ye(e.projection,t.projection)||i.push({command:"setProjection",args:[t.projection]});const r={},n=[];!function(e,t,i,r){let n;for(n in t=t||{},e=e||{})Object.prototype.hasOwnProperty.call(e,n)&&(Object.prototype.hasOwnProperty.call(t,n)||be(n,i,r));for(n in t)Object.prototype.hasOwnProperty.call(t,n)&&(Object.prototype.hasOwnProperty.call(e,n)?ye(e[n],t[n])||("geojson"===e[n].type&&"geojson"===t[n].type&&Te(e,t,n)?ve(i,{command:"setGeoJSONSourceData",args:[n,t[n].data]}):we(n,t,i,r)):xe(n,t,i))}(e.sources,t.sources,n,r);const o=[];e.layers&&e.layers.forEach((e=>{"source"in e&&r[e.source]?i.push({command:"removeLayer",args:[e.id]}):o.push(e)})),i=i.concat(n),function(e,t,i){t=t||[];const r=(e=e||[]).map(Ce),n=t.map(Ce),o=e.reduce(Se,{}),s=t.reduce(Se,{}),a=r.slice(),l=Object.create(null);let c,u,h,d,p;for(let e=0,t=0;e<r.length;e++)c=r[e],Object.prototype.hasOwnProperty.call(s,c)?t++:(ve(i,{command:"removeLayer",args:[c]}),a.splice(a.indexOf(c,t),1));for(let e=0,t=0;e<n.length;e++)c=n[n.length-1-e],a[a.length-1-e]!==c&&(Object.prototype.hasOwnProperty.call(o,c)?(ve(i,{command:"removeLayer",args:[c]}),a.splice(a.lastIndexOf(c,a.length-t),1)):t++,d=a[a.length-e],ve(i,{command:"addLayer",args:[s[c],d]}),a.splice(a.length-e,0,c),l[c]=!0);for(let e=0;e<n.length;e++)if(c=n[e],u=o[c],h=s[c],!l[c]&&!ye(u,h))if(ye(u.source,h.source)&&ye(u["source-layer"],h["source-layer"])&&ye(u.type,h.type)){for(p in Be(u.layout,h.layout,i,c,null,"setLayoutProperty"),Be(u.paint,h.paint,i,c,null,"setPaintProperty"),ye(u.filter,h.filter)||ve(i,{command:"setFilter",args:[c,h.filter]}),ye(u.minzoom,h.minzoom)&&ye(u.maxzoom,h.maxzoom)||ve(i,{command:"setLayerZoomRange",args:[c,h.minzoom,h.maxzoom]}),u)Object.prototype.hasOwnProperty.call(u,p)&&"layout"!==p&&"paint"!==p&&"filter"!==p&&"metadata"!==p&&"minzoom"!==p&&"maxzoom"!==p&&(0===p.indexOf("paint.")?Be(u[p],h[p],i,c,p.slice(6),"setPaintProperty"):ye(u[p],h[p])||ve(i,{command:"setLayerProperty",args:[c,p,h[p]]}));for(p in h)Object.prototype.hasOwnProperty.call(h,p)&&!Object.prototype.hasOwnProperty.call(u,p)&&"layout"!==p&&"paint"!==p&&"filter"!==p&&"metadata"!==p&&"minzoom"!==p&&"maxzoom"!==p&&(0===p.indexOf("paint.")?Be(u[p],h[p],i,c,p.slice(6),"setPaintProperty"):ye(u[p],h[p])||ve(i,{command:"setLayerProperty",args:[c,p,h[p]]}))}else ve(i,{command:"removeLayer",args:[c]}),d=a[a.lastIndexOf(c)+1],ve(i,{command:"addLayer",args:[h,d]})}(o,t.layers,i)}catch(e){console.warn("Unable to compute style diff:",e),i=[{command:"setStyle",args:[t]}]}return i},e.bD=function(e){const t=[],i=e.id;return void 0===i&&t.push({message:`layers.${i}: missing required property "id"`}),void 0===e.render&&t.push({message:`layers.${i}: missing required method "render"`}),e.renderingMode&&"2d"!==e.renderingMode&&"3d"!==e.renderingMode&&t.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),t},e.bE=function e(t,i){if(Array.isArray(t)){if(!Array.isArray(i)||t.length!==i.length)return!1;for(let r=0;r<t.length;r++)if(!e(t[r],i[r]))return!1;return!0}if("object"==typeof t&&null!==t&&null!==i){if("object"!=typeof i)return!1;if(Object.keys(t).length!==Object.keys(i).length)return!1;for(const r in t)if(!e(t[r],i[r]))return!1;return!0}return t===i},e.bF=U,e.bG=N,e.bH=class extends Ws{constructor(e,t){super(e,t),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1i(this.location,e))}},e.bI=Js,e.bJ=class extends Ws{constructor(e,t){super(e,t),this.current=ea}set(e){if(e[12]!==this.current[12]||e[0]!==this.current[0])return this.current=e,void this.gl.uniformMatrix4fv(this.location,!1,e);for(let t=1;t<16;t++)if(e[t]!==this.current[t]){this.current=e,this.gl.uniformMatrix4fv(this.location,!1,e);break}}},e.bK=Ys,e.bL=class extends Ws{constructor(e,t){super(e,t),this.current=[0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]||(this.current=e,this.gl.uniform3f(this.location,e[0],e[1],e[2]))}},e.bM=class extends Ws{constructor(e,t){super(e,t),this.current=[0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]||(this.current=e,this.gl.uniform2f(this.location,e[0],e[1]))}},e.bN=g,e.bO=function(e,t){var i=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=i,e[2]=0,e[3]=-i,e[4]=r,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},e.bP=function(e,t,i){var r=t[0],n=t[1],o=t[2];return e[0]=r*i[0]+n*i[3]+o*i[6],e[1]=r*i[1]+n*i[4]+o*i[7],e[2]=r*i[2]+n*i[5]+o*i[8],e},e.bQ=function(e,t,i,r,n,o,s){var a=1/(t-i),l=1/(r-n),c=1/(o-s);return e[0]=-2*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*c,e[11]=0,e[12]=(t+i)*a,e[13]=(n+r)*l,e[14]=(s+o)*c,e[15]=1,e},e.bR=class extends Wo{},e.bS=Fc,e.bT=class extends Yo{},e.bU=$a,e.bV=function(e){return e<=1?1:Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},e.bW=Ga,e.bX=function(e,t,i){var r=t[0],n=t[1],o=t[2],s=i[3]*r+i[7]*n+i[11]*o+i[15];return e[0]=(i[0]*r+i[4]*n+i[8]*o+i[12])/(s=s||1),e[1]=(i[1]*r+i[5]*n+i[9]*o+i[13])/s,e[2]=(i[2]*r+i[6]*n+i[10]*o+i[14])/s,e},e.bY=class extends No{},e.bZ=class extends os{},e.b_=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]},e.ba=Ml,e.bb=Cl,e.bc=P,e.bd=L,e.be=It,e.bf=function(e,t,i,r,n){return P(r,n,z((e-t)/(i-t),0,1))},e.bg=I,e.bh=function(){return new Float64Array(3)},e.bi=function(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e},e.bj=w,e.bk=function(){return new Float64Array(4)},e.bl=function(e,t,i,r){var n=[],o=[];return n[0]=t[0]-i[0],n[1]=t[1]-i[1],n[2]=t[2]-i[2],o[0]=n[0]*Math.cos(r)-n[1]*Math.sin(r),o[1]=n[0]*Math.sin(r)+n[1]*Math.cos(r),o[2]=n[2],e[0]=o[0]+i[0],e[1]=o[1]+i[1],e[2]=o[2]+i[2],e},e.bm=function(e,t,i,r){var n=[],o=[];return n[0]=t[0]-i[0],n[1]=t[1]-i[1],n[2]=t[2]-i[2],o[0]=n[0],o[1]=n[1]*Math.cos(r)-n[2]*Math.sin(r),o[2]=n[1]*Math.sin(r)+n[2]*Math.cos(r),e[0]=o[0]+i[0],e[1]=o[1]+i[1],e[2]=o[2]+i[2],e},e.bn=function(e,t,i,r){var n=[],o=[];return n[0]=t[0]-i[0],n[1]=t[1]-i[1],n[2]=t[2]-i[2],o[0]=n[2]*Math.sin(r)+n[0]*Math.cos(r),o[1]=n[1],o[2]=n[2]*Math.cos(r)-n[0]*Math.sin(r),e[0]=o[0]+i[0],e[1]=o[1]+i[1],e[2]=o[2]+i[2],e},e.bo=v,e.bp=function(e,t,i){var r=Math.sin(i),n=Math.cos(i),o=t[0],s=t[1],a=t[2],l=t[3],c=t[8],u=t[9],h=t[10],d=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*n-c*r,e[1]=s*n-u*r,e[2]=a*n-h*r,e[3]=l*n-d*r,e[8]=o*r+c*n,e[9]=s*r+u*n,e[10]=a*r+h*n,e[11]=l*r+d*n,e},e.bq=function(e,t){const i=I(e,360),r=I(t,360),n=r-i,o=r>i?n-360:n+360;return Math.abs(n)<Math.abs(o)?n:o},e.br=function(e){return e[0]=0,e[1]=0,e[2]=0,e},e.bs=function(e,t,i,r){const n=Math.sqrt(e*e+t*t),o=Math.sqrt(i*i+r*r);e/=n,t/=n,i/=o,r/=o;const s=Math.acos(e*i+t*r);return-t*i+e*r>0?s:-s},e.bt=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]},e.bu=Wu,e.bv=function(e,t){const i=I(e,2*Math.PI),r=I(t,2*Math.PI);return Math.min(Math.abs(i-r),Math.abs(i-r+2*Math.PI),Math.abs(i-r-2*Math.PI))},e.bw=function(){const e={},t=me.$version;for(const i in me.$root){const r=me.$root[i];if(r.required){let n=null;n="version"===i?t:"array"===r.type?[]:{},null!=n&&(e[i]=n)}}return e},e.bx=eo,e.by=le,e.bz=function(e){e=e.slice();const t=Object.create(null);for(let i=0;i<e.length;i++)t[e[i].id]=e[i];for(let i=0;i<e.length;i++)"ref"in e[i]&&(e[i]=_e(e[i],t[e[i].ref]));return e},e.c=re,e.c0=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},e.c1=e=>"symbol"===e.type,e.c2=e=>"circle"===e.type,e.c3=e=>"heatmap"===e.type,e.c4=e=>"line"===e.type,e.c5=e=>"fill"===e.type,e.c6=e=>"fill-extrusion"===e.type,e.c7=e=>"hillshade"===e.type,e.c8=e=>"raster"===e.type,e.c9=e=>"background"===e.type,e.cA=tc,e.cB=Vc,e.cC=class{constructor(e){this._marks={start:[e.url,"start"].join("#"),end:[e.url,"end"].join("#"),measure:e.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let e=performance.getEntriesByName(this._marks.measure);return 0===e.length&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),e=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),e}},e.cD=function(e,i,r,n,o){return t(this,void 0,void 0,(function*(){if(f())try{return yield K(e,i,r,n,o)}catch(e){}return function(e,t,i,r,n){const o=e.width,s=e.height;W&&X||(W=new OffscreenCanvas(o,s),X=W.getContext("2d",{willReadFrequently:!0})),W.width=o,W.height=s,X.drawImage(e,0,0,o,s);const a=X.getImageData(t,i,r,n);return X.clearRect(0,0,o,s),a.data}(e,i,r,n,o)}))},e.cE=hh,e.cF=i,e.cG=o,e.cH=ec,e.cI=jc,e.cJ=$r,e.cK=Ao,e.ca=e=>"custom"===e.type,e.cb=F,e.cc=function(e,t,i){const r=S(t.x-i.x,t.y-i.y),n=S(e.x-i.x,e.y-i.y);var o,s;return J(Math.atan2(r[0]*n[1]-r[1]*n[0],(o=r)[0]*(s=n)[0]+o[1]*s[1]))},e.cd=k,e.ce=function(e,t){return te[t]&&(e instanceof MouseEvent||e instanceof WheelEvent)},e.cf=function(e,t){return ee[t]&&"touches"in e},e.cg=function(e){return ee[e]||te[e]},e.ch=function(e,t,i){var r=t[0],n=t[1];return e[0]=i[0]*r+i[4]*n+i[12],e[1]=i[1]*r+i[5]*n+i[13],e},e.ci=function(e,t){const{x:i,y:r}=oh.fromLngLat(t);return!(e<0||e>25||r<0||r>=1||i<0||i>=1)},e.cj=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},e.ck=class extends Uo{},e.cl=ad,e.cn=function(e){return e.message===ie},e.co=ae,e.cp=function(e,t){ne.REGISTERED_PROTOCOLS[e]=t},e.cq=function(e){delete ne.REGISTERED_PROTOCOLS[e]},e.cr=function(e,t){const i={};for(let r=0;r<e.length;r++){const n=t&&t[e[r].id]||un(e[r]);t&&(t[e[r].id]=n);let o=i[n];o||(o=i[n]=[]),o.push(e[r])}const r=[];for(const e in i)r.push(i[e]);return r},e.cs=qn,e.ct=dh,e.cu=fh,e.cv=Yc,e.cw=function(t){t.bucket.createArrays(),t.bucket.tilePixelRatio=E/(512*t.bucket.overscaling),t.bucket.compareText={},t.bucket.iconsNeedLinear=!1;const i=t.bucket.layers[0],r=i.layout,n=i._unevaluatedLayout._values,o={layoutIconSize:n["icon-size"].possiblyEvaluate(new mo(t.bucket.zoom+1),t.canonical),layoutTextSize:n["text-size"].possiblyEvaluate(new mo(t.bucket.zoom+1),t.canonical),textMaxSize:n["text-size"].possiblyEvaluate(new mo(18))};if("composite"===t.bucket.textSizeData.kind){const{minZoom:e,maxZoom:i}=t.bucket.textSizeData;o.compositeTextSizes=[n["text-size"].possiblyEvaluate(new mo(e),t.canonical),n["text-size"].possiblyEvaluate(new mo(i),t.canonical)]}if("composite"===t.bucket.iconSizeData.kind){const{minZoom:e,maxZoom:i}=t.bucket.iconSizeData;o.compositeIconSizes=[n["icon-size"].possiblyEvaluate(new mo(e),t.canonical),n["icon-size"].possiblyEvaluate(new mo(i),t.canonical)]}const s=r.get("text-line-height")*Uc,a="viewport"!==r.get("text-rotation-alignment")&&"point"!==r.get("symbol-placement"),l=r.get("text-keep-upright"),c=r.get("text-size");for(const n of t.bucket.features){const u=r.get("text-font").evaluate(n,{},t.canonical).join(","),h=c.evaluate(n,{},t.canonical),d=o.layoutTextSize.evaluate(n,{},t.canonical),p=o.layoutIconSize.evaluate(n,{},t.canonical),f={horizontal:{},vertical:void 0},A=n.text;let m,g=[0,0];if(A){const o=A.toString(),c=r.get("text-letter-spacing").evaluate(n,{},t.canonical)*Uc,p=ro(o)?c:0,m=r.get("text-anchor").evaluate(n,{},t.canonical),_=jh(i,n,t.canonical);if(!_){const e=r.get("text-radial-offset").evaluate(n,{},t.canonical);g=e?Qh(m,[e*Uc,Nh]):r.get("text-offset").evaluate(n,{},t.canonical).map((e=>e*Uc))}let y=a?"center":r.get("text-justify").evaluate(n,{},t.canonical);const v="point"===r.get("symbol-placement")?r.get("text-max-width").evaluate(n,{},t.canonical)*Uc:1/0,x=()=>{t.bucket.allowVerticalPlacement&&io(o)&&(f.vertical=ru(A,t.glyphMap,t.glyphPositions,t.imagePositions,u,v,s,m,"left",p,g,e.al.vertical,!0,d,h))};if(!a&&_){const i=new Set;if("auto"===y)for(let e=0;e<_.values.length;e+=2)i.add(Vh(_.values[e]));else i.add(y);let r=!1;for(const n of i)if(!f.horizontal[n])if(r)f.horizontal[n]=f.horizontal[0];else{const i=ru(A,t.glyphMap,t.glyphPositions,t.imagePositions,u,v,s,"center",n,p,g,e.al.horizontal,!1,d,h);i&&(f.horizontal[n]=i,r=1===i.positionedLines.length)}x()}else{"auto"===y&&(y=Vh(m));const i=ru(A,t.glyphMap,t.glyphPositions,t.imagePositions,u,v,s,m,y,p,g,e.al.horizontal,!1,d,h);i&&(f.horizontal[y]=i),x(),io(o)&&a&&l&&(f.vertical=ru(A,t.glyphMap,t.glyphPositions,t.imagePositions,u,v,s,m,y,p,g,e.al.vertical,!1,d,h))}}let _=!1;if(n.icon&&n.icon.name){const e=t.imageMap[n.icon.name];e&&(m=vu(t.imagePositions[n.icon.name],r.get("icon-offset").evaluate(n,{},t.canonical),r.get("icon-anchor").evaluate(n,{},t.canonical)),_=!!e.sdf,void 0===t.bucket.sdfIcons?t.bucket.sdfIcons=_:t.bucket.sdfIcons!==_&&V("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(e.pixelRatio!==t.bucket.pixelRatio||0!==r.get("icon-rotate").constantOr(1))&&(t.bucket.iconsNeedLinear=!0))}const y=$h(f.horizontal)||f.vertical;t.bucket.iconsInText=!!y&&y.iconsInText,(y||m)&&Hh(t.bucket,n,f,m,t.imageMap,o,d,p,g,_,t.canonical,t.subdivisionGranularity)}t.showCollisionBoxes&&t.bucket.generateCollisionDebugBuffers()},e.cx=xc,e.cy=Rl,e.cz=oc,e.d=ue,e.e=D,e.f=e=>t(void 0,void 0,void 0,(function*(){if(0===e.byteLength)return createImageBitmap(new ImageData(1,1));const t=new Blob([new Uint8Array(e)],{type:"image/png"});try{return createImageBitmap(t)}catch(e){throw new Error(`Could not load image because of ${e.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}})),e.g=oe,e.h=e=>new Promise(((t,i)=>{const r=new Image;r.onload=()=>{t(r),URL.revokeObjectURL(r.src),r.onload=null,window.requestAnimationFrame((()=>{r.src=q}))},r.onerror=()=>i(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const n=new Blob([new Uint8Array(e)],{type:"image/png"});r.src=e.byteLength?URL.createObjectURL(n):q})),e.i=G,e.j=(e,t)=>ce(D(e,{type:"json"}),t),e.k=fe,e.l=pe,e.m=ce,e.n=(e,t)=>ce(D(e,{type:"arrayBuffer"}),t),e.o=function(e){return new Vc(e).readFields(Gc,[])},e.p=Kc,e.q=Va,e.r=Io,e.s=Y,e.t=Qn,e.u=to,e.v=me,e.w=V,e.x=Gn,e.y=Nn,e.z=function([e,t,i]){return t+=90,t*=Math.PI/180,i*=Math.PI/180,{x:e*Math.cos(t)*Math.sin(i),y:e*Math.sin(t)*Math.sin(i),z:e*Math.cos(i)}}})),i("worker",["./shared"],(function(e){class t{constructor(e){this.keyCache={},e&&this.replace(e)}replace(e){this._layerConfigs={},this._layers={},this.update(e,[])}update(t,i){for(const i of t){this._layerConfigs[i.id]=i;const t=this._layers[i.id]=e.bA(i);t._featureFilter=e.a7(t.filter),this.keyCache[i.id]&&delete this.keyCache[i.id]}for(const e of i)delete this.keyCache[e],delete this._layerConfigs[e],delete this._layers[e];this.familiesBySource={};const r=e.cr(Object.values(this._layerConfigs),this.keyCache);for(const e of r){const t=e.map((e=>this._layers[e.id])),i=t[0];if("none"===i.visibility)continue;const r=i.source||"";let n=this.familiesBySource[r];n||(n=this.familiesBySource[r]={});const o=i.sourceLayer||"_geojsonTileLayer";let s=n[o];s||(s=n[o]=[]),s.push(t)}}}class i{constructor(t){const i={},r=[];for(const e in t){const n=t[e],o=i[e]={};for(const e in n){const t=n[+e];if(!t||0===t.bitmap.width||0===t.bitmap.height)continue;const i={x:0,y:0,w:t.bitmap.width+2,h:t.bitmap.height+2};r.push(i),o[e]={rect:i,metrics:t.metrics}}}const{w:n,h:o}=e.p(r),s=new e.q({width:n||1,height:o||1});for(const r in t){const n=t[r];for(const t in n){const o=n[+t];if(!o||0===o.bitmap.width||0===o.bitmap.height)continue;const a=i[r][t].rect;e.q.copy(o.bitmap,s,{x:0,y:0},{x:a.x+1,y:a.y+1},o.bitmap)}}this.image=s,this.positions=i}}e.cs("GlyphAtlas",i);class r{constructor(t){this.tileID=new e.Y(t.tileID.overscaledZ,t.tileID.wrap,t.tileID.canonical.z,t.tileID.canonical.x,t.tileID.canonical.y),this.uid=t.uid,this.zoom=t.zoom,this.pixelRatio=t.pixelRatio,this.tileSize=t.tileSize,this.source=t.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=t.showCollisionBoxes,this.collectResourceTiming=!!t.collectResourceTiming,this.returnDependencies=!!t.returnDependencies,this.promoteId=t.promoteId,this.inFlightDependencies=[]}parse(t,r,o,s,a){return e._(this,void 0,void 0,(function*(){this.status="parsing",this.data=t,this.collisionBoxArray=new e.a5;const l=new e.ct(Object.keys(t.layers).sort()),c=new e.cu(this.tileID,this.promoteId);c.bucketLayerIDs=[];const u={},h={featureIndex:c,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:o,subdivisionGranularity:a},d=r.familiesBySource[this.source];for(const i in d){const r=t.layers[i];if(!r)continue;1===r.version&&e.w(`Vector tile source "${this.source}" layer "${i}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const s=l.encode(i),a=[];for(let e=0;e<r.length;e++){const t=r.feature(e),n=c.getId(t,i);a.push({feature:t,id:n,index:e,sourceLayerIndex:s})}for(const t of d[i]){const i=t[0];i.source!==this.source&&e.w(`layer.source = ${i.source} does not equal this.source = ${this.source}`),i.minzoom&&this.zoom<Math.floor(i.minzoom)||i.maxzoom&&this.zoom>=i.maxzoom||"none"!==i.visibility&&(n(t,this.zoom,o),(u[i.id]=i.createBucket({index:c.bucketLayerIDs.length,layers:t,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:s,sourceID:this.source})).populate(a,h,this.tileID.canonical),c.bucketLayerIDs.push(t.map((e=>e.id))))}}const p=e.bF(h.glyphDependencies,(e=>Object.keys(e).map(Number)));this.inFlightDependencies.forEach((e=>null==e?void 0:e.abort())),this.inFlightDependencies=[];let f=Promise.resolve({});if(Object.keys(p).length){const e=new AbortController;this.inFlightDependencies.push(e),f=s.sendAsync({type:"GG",data:{stacks:p,source:this.source,tileID:this.tileID,type:"glyphs"}},e)}const A=Object.keys(h.iconDependencies);let m=Promise.resolve({});if(A.length){const e=new AbortController;this.inFlightDependencies.push(e),m=s.sendAsync({type:"GI",data:{icons:A,source:this.source,tileID:this.tileID,type:"icons"}},e)}const g=Object.keys(h.patternDependencies);let _=Promise.resolve({});if(g.length){const e=new AbortController;this.inFlightDependencies.push(e),_=s.sendAsync({type:"GI",data:{icons:g,source:this.source,tileID:this.tileID,type:"patterns"}},e)}const[y,v,x]=yield Promise.all([f,m,_]),b=new i(y),w=new e.cv(v,x);for(const t in u){const i=u[t];i instanceof e.a6?(n(i.layers,this.zoom,o),e.cw({bucket:i,glyphMap:y,glyphPositions:b.positions,imageMap:v,imagePositions:w.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:h.subdivisionGranularity})):i.hasPattern&&(i instanceof e.cx||i instanceof e.cy||i instanceof e.cz)&&(n(i.layers,this.zoom,o),i.addFeatures(h,this.tileID.canonical,w.patternPositions))}return this.status="done",{buckets:Object.values(u).filter((e=>!e.isEmpty())),featureIndex:c,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:b.image,imageAtlas:w,glyphMap:this.returnDependencies?y:null,iconMap:this.returnDependencies?v:null,glyphPositions:this.returnDependencies?b.positions:null}}))}}function n(t,i,r){const n=new e.C(i);for(const e of t)e.recalculate(n,r)}class o{constructor(e,t,i){this.actor=e,this.layerIndex=t,this.availableImages=i,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(t,i){return e._(this,void 0,void 0,(function*(){const r=yield e.n(t.request,i);try{return{vectorTile:new e.cA.VectorTile(new e.cB(r.data)),rawData:r.data,cacheControl:r.cacheControl,expires:r.expires}}catch(e){const i=new Uint8Array(r.data);let n=`Unable to parse the tile at ${t.request.url}, `;throw n+=31===i[0]&&139===i[1]?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${e.message}`,new Error(n)}}))}loadTile(t){return e._(this,void 0,void 0,(function*(){const i=t.uid,n=!!(t&&t.request&&t.request.collectResourceTiming)&&new e.cC(t.request),o=new r(t);this.loading[i]=o;const s=new AbortController;o.abort=s;try{const r=yield this.loadVectorTile(t,s);if(delete this.loading[i],!r)return null;const a=r.rawData,l={};r.expires&&(l.expires=r.expires),r.cacheControl&&(l.cacheControl=r.cacheControl);const c={};if(n){const e=n.finish();e&&(c.resourceTiming=JSON.parse(JSON.stringify(e)))}o.vectorTile=r.vectorTile;const u=o.parse(r.vectorTile,this.layerIndex,this.availableImages,this.actor,t.subdivisionGranularity);this.loaded[i]=o,this.fetching[i]={rawTileData:a,cacheControl:l,resourceTiming:c};try{const t=yield u;return e.e({rawTileData:a.slice(0)},t,l,c)}finally{delete this.fetching[i]}}catch(e){throw delete this.loading[i],o.status="done",this.loaded[i]=o,e}}))}reloadTile(t){return e._(this,void 0,void 0,(function*(){const i=t.uid;if(!this.loaded||!this.loaded[i])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const r=this.loaded[i];if(r.showCollisionBoxes=t.showCollisionBoxes,"parsing"===r.status){const n=yield r.parse(r.vectorTile,this.layerIndex,this.availableImages,this.actor,t.subdivisionGranularity);let o;if(this.fetching[i]){const{rawTileData:t,cacheControl:r,resourceTiming:s}=this.fetching[i];delete this.fetching[i],o=e.e({rawTileData:t.slice(0)},n,r,s)}else o=n;return o}if("done"===r.status&&r.vectorTile)return r.parse(r.vectorTile,this.layerIndex,this.availableImages,this.actor,t.subdivisionGranularity)}))}abortTile(t){return e._(this,void 0,void 0,(function*(){const e=this.loading,i=t.uid;e&&e[i]&&e[i].abort&&(e[i].abort.abort(),delete e[i])}))}removeTile(t){return e._(this,void 0,void 0,(function*(){this.loaded&&this.loaded[t.uid]&&delete this.loaded[t.uid]}))}}class s{constructor(){this.loaded={}}loadTile(t){return e._(this,void 0,void 0,(function*(){const{uid:i,encoding:r,rawImageData:n,redFactor:o,greenFactor:s,blueFactor:a,baseShift:l}=t,c=n.width+2,u=n.height+2,h=e.b(n)?new e.R({width:c,height:u},yield e.cD(n,-1,-1,c,u)):n,d=new e.cE(i,h,r,o,s,a,l);return this.loaded=this.loaded||{},this.loaded[i]=d,d}))}removeTile(e){const t=this.loaded,i=e.uid;t&&t[i]&&delete t[i]}}var a,l,c=function(){if(l)return a;function e(e,i){if(0!==e.length){t(e[0],i);for(var r=1;r<e.length;r++)t(e[r],!i)}}function t(e,t){for(var i=0,r=0,n=0,o=e.length,s=o-1;n<o;s=n++){var a=(e[n][0]-e[s][0])*(e[s][1]+e[n][1]),l=i+a;r+=Math.abs(i)>=Math.abs(a)?i-l+a:a-l+i,i=l}i+r>=0!=!!t&&e.reverse()}return l=1,a=function t(i,r){var n,o=i&&i.type;if("FeatureCollection"===o)for(n=0;n<i.features.length;n++)t(i.features[n],r);else if("GeometryCollection"===o)for(n=0;n<i.geometries.length;n++)t(i.geometries[n],r);else if("Feature"===o)t(i.geometry,r);else if("Polygon"===o)e(i.coordinates,r);else if("MultiPolygon"===o)for(n=0;n<i.coordinates.length;n++)e(i.coordinates[n],r);return i}}(),u=e.cF(c);const h=e.cA.VectorTileFeature.prototype.toGeoJSON;class d{constructor(t){this._feature=t,this.extent=e.Z,this.type=t.type,this.properties=t.tags,"id"in t&&!isNaN(t.id)&&(this.id=parseInt(t.id,10))}loadGeometry(){if(1===this._feature.type){const t=[];for(const i of this._feature.geometry)t.push([new e.P(i[0],i[1])]);return t}{const t=[];for(const i of this._feature.geometry){const r=[];for(const t of i)r.push(new e.P(t[0],t[1]));t.push(r)}return t}}toGeoJSON(e,t,i){return h.call(this,e,t,i)}}class p{constructor(t){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=e.Z,this.length=t.length,this._features=t}feature(e){return new d(this._features[e])}}var f,A,m,g={exports:{}},_=function(){if(m)return g.exports;m=1;var t=e.cI(),i=function(){if(A)return f;A=1;var t=e.cG(),i=e.cH().VectorTileFeature;function r(e,t){this.options=t||{},this.features=e,this.length=e.length}function n(e,t){this.id="number"==typeof e.id?e.id:void 0,this.type=e.type,this.rawGeometry=1===e.type?[e.geometry]:e.geometry,this.properties=e.tags,this.extent=t||4096}return f=r,r.prototype.feature=function(e){return new n(this.features[e],this.options.extent)},n.prototype.loadGeometry=function(){var e=this.rawGeometry;this.geometry=[];for(var i=0;i<e.length;i++){for(var r=e[i],n=[],o=0;o<r.length;o++)n.push(new t(r[o][0],r[o][1]));this.geometry.push(n)}return this.geometry},n.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var e=this.geometry,t=1/0,i=-1/0,r=1/0,n=-1/0,o=0;o<e.length;o++)for(var s=e[o],a=0;a<s.length;a++){var l=s[a];t=Math.min(t,l.x),i=Math.max(i,l.x),r=Math.min(r,l.y),n=Math.max(n,l.y)}return[t,r,i,n]},n.prototype.toGeoJSON=i.prototype.toGeoJSON,f}();function r(e){var i=new t;return function(e,t){for(var i in e.layers)t.writeMessage(3,n,e.layers[i])}(e,i),i.finish()}function n(e,t){var i;t.writeVarintField(15,e.version||1),t.writeStringField(1,e.name||""),t.writeVarintField(5,e.extent||4096);var r={keys:[],values:[],keycache:{},valuecache:{}};for(i=0;i<e.length;i++)r.feature=e.feature(i),t.writeMessage(2,o,r);var n=r.keys;for(i=0;i<n.length;i++)t.writeStringField(3,n[i]);var s=r.values;for(i=0;i<s.length;i++)t.writeMessage(4,u,s[i])}function o(e,t){var i=e.feature;void 0!==i.id&&t.writeVarintField(1,i.id),t.writeMessage(2,s,e),t.writeVarintField(3,i.type),t.writeMessage(4,c,i)}function s(e,t){var i=e.feature,r=e.keys,n=e.values,o=e.keycache,s=e.valuecache;for(var a in i.properties){var l=i.properties[a],c=o[a];if(null!==l){void 0===c&&(r.push(a),o[a]=c=r.length-1),t.writeVarint(c);var u=typeof l;"string"!==u&&"boolean"!==u&&"number"!==u&&(l=JSON.stringify(l));var h=u+":"+l,d=s[h];void 0===d&&(n.push(l),s[h]=d=n.length-1),t.writeVarint(d)}}}function a(e,t){return(t<<3)+(7&e)}function l(e){return e<<1^e>>31}function c(e,t){for(var i=e.loadGeometry(),r=e.type,n=0,o=0,s=i.length,c=0;c<s;c++){var u=i[c],h=1;1===r&&(h=u.length),t.writeVarint(a(1,h));for(var d=3===r?u.length-1:u.length,p=0;p<d;p++){1===p&&1!==r&&t.writeVarint(a(2,d-1));var f=u[p].x-n,A=u[p].y-o;t.writeVarint(l(f)),t.writeVarint(l(A)),n+=f,o+=A}3===r&&t.writeVarint(a(7,1))}}function u(e,t){var i=typeof e;"string"===i?t.writeStringField(1,e):"boolean"===i?t.writeBooleanField(7,e):"number"===i&&(e%1!=0?t.writeDoubleField(3,e):e<0?t.writeSVarintField(6,e):t.writeVarintField(5,e))}return g.exports=r,g.exports.fromVectorTileJs=r,g.exports.fromGeojsonVt=function(e,t){t=t||{};var n={};for(var o in e)n[o]=new i(e[o].features,t),n[o].name=o,n[o].version=t.version,n[o].extent=t.extent;return r({layers:n})},g.exports.GeoJSONWrapper=i,g.exports}(),y=e.cF(_);const v={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:e=>e},x=Math.fround||(b=new Float32Array(1),e=>(b[0]=+e,b[0]));var b;const w=3,T=5,B=6;class C{constructor(e){this.options=Object.assign(Object.create(v),e),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(e){const{log:t,minZoom:i,maxZoom:r}=this.options;t&&console.time("total time");const n=`prepare ${e.length} points`;t&&console.time(n),this.points=e;const o=[];for(let t=0;t<e.length;t++){const i=e[t];if(!i.geometry)continue;const[r,n]=i.geometry.coordinates,s=x(M(r)),a=x(I(n));o.push(s,a,1/0,t,-1,1),this.options.reduce&&o.push(0)}let s=this.trees[r+1]=this._createTree(o);t&&console.timeEnd(n);for(let e=r;e>=i;e--){const i=+Date.now();s=this.trees[e]=this._createTree(this._cluster(s,e)),t&&console.log("z%d: %d clusters in %dms",e,s.numItems,+Date.now()-i)}return t&&console.timeEnd("total time"),this}getClusters(e,t){let i=((e[0]+180)%360+360)%360-180;const r=Math.max(-90,Math.min(90,e[1]));let n=180===e[2]?180:((e[2]+180)%360+360)%360-180;const o=Math.max(-90,Math.min(90,e[3]));if(e[2]-e[0]>=360)i=-180,n=180;else if(i>n){const e=this.getClusters([i,r,180,o],t),s=this.getClusters([-180,r,n,o],t);return e.concat(s)}const s=this.trees[this._limitZoom(t)],a=s.range(M(i),I(o),M(n),I(r)),l=s.data,c=[];for(const e of a){const t=this.stride*e;c.push(l[t+T]>1?S(l,t,this.clusterProps):this.points[l[t+w]])}return c}getChildren(e){const t=this._getOriginId(e),i=this._getOriginZoom(e),r="No cluster with the specified id.",n=this.trees[i];if(!n)throw new Error(r);const o=n.data;if(t*this.stride>=o.length)throw new Error(r);const s=this.options.radius/(this.options.extent*Math.pow(2,i-1)),a=n.within(o[t*this.stride],o[t*this.stride+1],s),l=[];for(const t of a){const i=t*this.stride;o[i+4]===e&&l.push(o[i+T]>1?S(o,i,this.clusterProps):this.points[o[i+w]])}if(0===l.length)throw new Error(r);return l}getLeaves(e,t,i){const r=[];return this._appendLeaves(r,e,t=t||10,i=i||0,0),r}getTile(e,t,i){const r=this.trees[this._limitZoom(e)],n=Math.pow(2,e),{extent:o,radius:s}=this.options,a=s/o,l=(i-a)/n,c=(i+1+a)/n,u={features:[]};return this._addTileFeatures(r.range((t-a)/n,l,(t+1+a)/n,c),r.data,t,i,n,u),0===t&&this._addTileFeatures(r.range(1-a/n,l,1,c),r.data,n,i,n,u),t===n-1&&this._addTileFeatures(r.range(0,l,a/n,c),r.data,-1,i,n,u),u.features.length?u:null}getClusterExpansionZoom(e){let t=this._getOriginZoom(e)-1;for(;t<=this.options.maxZoom;){const i=this.getChildren(e);if(t++,1!==i.length)break;e=i[0].properties.cluster_id}return t}_appendLeaves(e,t,i,r,n){const o=this.getChildren(t);for(const t of o){const o=t.properties;if(o&&o.cluster?n+o.point_count<=r?n+=o.point_count:n=this._appendLeaves(e,o.cluster_id,i,r,n):n<r?n++:e.push(t),e.length===i)break}return n}_createTree(t){const i=new e.aF(t.length/this.stride|0,this.options.nodeSize,Float32Array);for(let e=0;e<t.length;e+=this.stride)i.add(t[e],t[e+1]);return i.finish(),i.data=t,i}_addTileFeatures(e,t,i,r,n,o){for(const s of e){const e=s*this.stride,a=t[e+T]>1;let l,c,u;if(a)l=E(t,e,this.clusterProps),c=t[e],u=t[e+1];else{const i=this.points[t[e+w]];l=i.properties;const[r,n]=i.geometry.coordinates;c=M(r),u=I(n)}const h={type:1,geometry:[[Math.round(this.options.extent*(c*n-i)),Math.round(this.options.extent*(u*n-r))]],tags:l};let d;d=a||this.options.generateId?t[e+w]:this.points[t[e+w]].id,void 0!==d&&(h.id=d),o.features.push(h)}}_limitZoom(e){return Math.max(this.options.minZoom,Math.min(Math.floor(+e),this.options.maxZoom+1))}_cluster(e,t){const{radius:i,extent:r,reduce:n,minPoints:o}=this.options,s=i/(r*Math.pow(2,t)),a=e.data,l=[],c=this.stride;for(let i=0;i<a.length;i+=c){if(a[i+2]<=t)continue;a[i+2]=t;const r=a[i],u=a[i+1],h=e.within(a[i],a[i+1],s),d=a[i+T];let p=d;for(const e of h){const i=e*c;a[i+2]>t&&(p+=a[i+T])}if(p>d&&p>=o){let e,o=r*d,s=u*d,f=-1;const A=(i/c<<5)+(t+1)+this.points.length;for(const r of h){const l=r*c;if(a[l+2]<=t)continue;a[l+2]=t;const u=a[l+T];o+=a[l]*u,s+=a[l+1]*u,a[l+4]=A,n&&(e||(e=this._map(a,i,!0),f=this.clusterProps.length,this.clusterProps.push(e)),n(e,this._map(a,l)))}a[i+4]=A,l.push(o/p,s/p,1/0,A,-1,p),n&&l.push(f)}else{for(let e=0;e<c;e++)l.push(a[i+e]);if(p>1)for(const e of h){const i=e*c;if(!(a[i+2]<=t)){a[i+2]=t;for(let e=0;e<c;e++)l.push(a[i+e])}}}}return l}_getOriginId(e){return e-this.points.length>>5}_getOriginZoom(e){return(e-this.points.length)%32}_map(e,t,i){if(e[t+T]>1){const r=this.clusterProps[e[t+B]];return i?Object.assign({},r):r}const r=this.points[e[t+w]].properties,n=this.options.map(r);return i&&n===r?Object.assign({},n):n}}function S(e,t,i){return{type:"Feature",id:e[t+w],properties:E(e,t,i),geometry:{type:"Point",coordinates:[(r=e[t],360*(r-.5)),P(e[t+1])]}};var r}function E(e,t,i){const r=e[t+T],n=r>=1e4?`${Math.round(r/1e3)}k`:r>=1e3?Math.round(r/100)/10+"k":r,o=e[t+B],s=-1===o?{}:Object.assign({},i[o]);return Object.assign(s,{cluster:!0,cluster_id:e[t+w],point_count:r,point_count_abbreviated:n})}function M(e){return e/360+.5}function I(e){const t=Math.sin(e*Math.PI/180),i=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return i<0?0:i>1?1:i}function P(e){const t=(180-360*e)*Math.PI/180;return 360*Math.atan(Math.exp(t))/Math.PI-90}function L(e,t,i,r){let n=r;const o=t+(i-t>>1);let s,a=i-t;const l=e[t],c=e[t+1],u=e[i],h=e[i+1];for(let r=t+3;r<i;r+=3){const t=F(e[r],e[r+1],l,c,u,h);if(t>n)s=r,n=t;else if(t===n){const e=Math.abs(r-o);e<a&&(s=r,a=e)}}n>r&&(s-t>3&&L(e,t,s,r),e[s+2]=n,i-s>3&&L(e,s,i,r))}function F(e,t,i,r,n,o){let s=n-i,a=o-r;if(0!==s||0!==a){const l=((e-i)*s+(t-r)*a)/(s*s+a*a);l>1?(i=n,r=o):l>0&&(i+=s*l,r+=a*l)}return s=e-i,a=t-r,s*s+a*a}function k(e,t,i,r){const n={id:null==e?null:e,type:t,geometry:i,tags:r,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if("Point"===t||"MultiPoint"===t||"LineString"===t)z(n,i);else if("Polygon"===t)z(n,i[0]);else if("MultiLineString"===t)for(const e of i)z(n,e);else if("MultiPolygon"===t)for(const e of i)z(n,e[0]);return n}function z(e,t){for(let i=0;i<t.length;i+=3)e.minX=Math.min(e.minX,t[i]),e.minY=Math.min(e.minY,t[i+1]),e.maxX=Math.max(e.maxX,t[i]),e.maxY=Math.max(e.maxY,t[i+1])}function R(e,t,i,r){if(!t.geometry)return;const n=t.geometry.coordinates;if(n&&0===n.length)return;const o=t.geometry.type,s=Math.pow(i.tolerance/((1<<i.maxZoom)*i.extent),2);let a=[],l=t.id;if(i.promoteId?l=t.properties[i.promoteId]:i.generateId&&(l=r||0),"Point"===o)D(n,a);else if("MultiPoint"===o)for(const e of n)D(e,a);else if("LineString"===o)O(n,a,s,!1);else if("MultiLineString"===o){if(i.lineMetrics){for(const i of n)a=[],O(i,a,s,!1),e.push(k(l,"LineString",a,t.properties));return}U(n,a,s,!1)}else if("Polygon"===o)U(n,a,s,!0);else{if("MultiPolygon"!==o){if("GeometryCollection"===o){for(const n of t.geometry.geometries)R(e,{id:l,geometry:n,properties:t.properties},i,r);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const e of n){const t=[];U(e,t,s,!0),a.push(t)}}e.push(k(l,o,a,t.properties))}function D(e,t){t.push(N(e[0]),Q(e[1]),0)}function O(e,t,i,r){let n,o,s=0;for(let i=0;i<e.length;i++){const a=N(e[i][0]),l=Q(e[i][1]);t.push(a,l,0),i>0&&(s+=r?(n*l-a*o)/2:Math.sqrt(Math.pow(a-n,2)+Math.pow(l-o,2))),n=a,o=l}const a=t.length-3;t[2]=1,L(t,0,a,i),t[a+2]=1,t.size=Math.abs(s),t.start=0,t.end=t.size}function U(e,t,i,r){for(let n=0;n<e.length;n++){const o=[];O(e[n],o,i,r),t.push(o)}}function N(e){return e/360+.5}function Q(e){const t=Math.sin(e*Math.PI/180),i=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return i<0?0:i>1?1:i}function j(e,t,i,r,n,o,s,a){if(r/=t,o>=(i/=t)&&s<r)return e;if(s<i||o>=r)return null;const l=[];for(const t of e){const e=t.geometry;let o=t.type;const s=0===n?t.minX:t.minY,c=0===n?t.maxX:t.maxY;if(s>=i&&c<r){l.push(t);continue}if(c<i||s>=r)continue;let u=[];if("Point"===o||"MultiPoint"===o)V(e,u,i,r,n);else if("LineString"===o)H(e,u,i,r,n,!1,a.lineMetrics);else if("MultiLineString"===o)$(e,u,i,r,n,!1);else if("Polygon"===o)$(e,u,i,r,n,!0);else if("MultiPolygon"===o)for(const t of e){const e=[];$(t,e,i,r,n,!0),e.length&&u.push(e)}if(u.length){if(a.lineMetrics&&"LineString"===o){for(const e of u)l.push(k(t.id,o,e,t.tags));continue}"LineString"!==o&&"MultiLineString"!==o||(1===u.length?(o="LineString",u=u[0]):o="MultiLineString"),"Point"!==o&&"MultiPoint"!==o||(o=3===u.length?"Point":"MultiPoint"),l.push(k(t.id,o,u,t.tags))}}return l.length?l:null}function V(e,t,i,r,n){for(let o=0;o<e.length;o+=3){const s=e[o+n];s>=i&&s<=r&&Z(t,e[o],e[o+1],e[o+2])}}function H(e,t,i,r,n,o,s){let a=G(e);const l=0===n?q:K;let c,u,h=e.start;for(let d=0;d<e.length-3;d+=3){const p=e[d],f=e[d+1],A=e[d+2],m=e[d+3],g=e[d+4],_=0===n?p:f,y=0===n?m:g;let v=!1;s&&(c=Math.sqrt(Math.pow(p-m,2)+Math.pow(f-g,2))),_<i?y>i&&(u=l(a,p,f,m,g,i),s&&(a.start=h+c*u)):_>r?y<r&&(u=l(a,p,f,m,g,r),s&&(a.start=h+c*u)):Z(a,p,f,A),y<i&&_>=i&&(u=l(a,p,f,m,g,i),v=!0),y>r&&_<=r&&(u=l(a,p,f,m,g,r),v=!0),!o&&v&&(s&&(a.end=h+c*u),t.push(a),a=G(e)),s&&(h+=c)}let d=e.length-3;const p=e[d],f=e[d+1],A=0===n?p:f;A>=i&&A<=r&&Z(a,p,f,e[d+2]),d=a.length-3,o&&d>=3&&(a[d]!==a[0]||a[d+1]!==a[1])&&Z(a,a[0],a[1],a[2]),a.length&&t.push(a)}function G(e){const t=[];return t.size=e.size,t.start=e.start,t.end=e.end,t}function $(e,t,i,r,n,o){for(const s of e)H(s,t,i,r,n,o,!1)}function Z(e,t,i,r){e.push(t,i,r)}function q(e,t,i,r,n,o){const s=(o-t)/(r-t);return Z(e,o,i+(n-i)*s,1),s}function K(e,t,i,r,n,o){const s=(o-i)/(n-i);return Z(e,t+(r-t)*s,o,1),s}function W(e,t){const i=[];for(let r=0;r<e.length;r++){const n=e[r],o=n.type;let s;if("Point"===o||"MultiPoint"===o||"LineString"===o)s=X(n.geometry,t);else if("MultiLineString"===o||"Polygon"===o){s=[];for(const e of n.geometry)s.push(X(e,t))}else if("MultiPolygon"===o){s=[];for(const e of n.geometry){const i=[];for(const r of e)i.push(X(r,t));s.push(i)}}i.push(k(n.id,o,s,n.tags))}return i}function X(e,t){const i=[];i.size=e.size,void 0!==e.start&&(i.start=e.start,i.end=e.end);for(let r=0;r<e.length;r+=3)i.push(e[r]+t,e[r+1],e[r+2]);return i}function Y(e,t){if(e.transformed)return e;const i=1<<e.z,r=e.x,n=e.y;for(const o of e.features){const e=o.geometry,s=o.type;if(o.geometry=[],1===s)for(let s=0;s<e.length;s+=2)o.geometry.push(J(e[s],e[s+1],t,i,r,n));else for(let s=0;s<e.length;s++){const a=[];for(let o=0;o<e[s].length;o+=2)a.push(J(e[s][o],e[s][o+1],t,i,r,n));o.geometry.push(a)}}return e.transformed=!0,e}function J(e,t,i,r,n,o){return[Math.round(i*(e*r-n)),Math.round(i*(t*r-o))]}function ee(e,t,i,r,n){const o=t===n.maxZoom?0:n.tolerance/((1<<t)*n.extent),s={features:[],numPoints:0,numSimplified:0,numFeatures:e.length,source:null,x:i,y:r,z:t,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const t of e)te(s,t,o,n);return s}function te(e,t,i,r){const n=t.geometry,o=t.type,s=[];if(e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY),"Point"===o||"MultiPoint"===o)for(let t=0;t<n.length;t+=3)s.push(n[t],n[t+1]),e.numPoints++,e.numSimplified++;else if("LineString"===o)ie(s,n,e,i,!1,!1);else if("MultiLineString"===o||"Polygon"===o)for(let t=0;t<n.length;t++)ie(s,n[t],e,i,"Polygon"===o,0===t);else if("MultiPolygon"===o)for(let t=0;t<n.length;t++){const r=n[t];for(let t=0;t<r.length;t++)ie(s,r[t],e,i,!0,0===t)}if(s.length){let i=t.tags||null;if("LineString"===o&&r.lineMetrics){i={};for(const e in t.tags)i[e]=t.tags[e];i.mapbox_clip_start=n.start/n.size,i.mapbox_clip_end=n.end/n.size}const a={geometry:s,type:"Polygon"===o||"MultiPolygon"===o?3:"LineString"===o||"MultiLineString"===o?2:1,tags:i};null!==t.id&&(a.id=t.id),e.features.push(a)}}function ie(e,t,i,r,n,o){const s=r*r;if(r>0&&t.size<(n?s:r))return void(i.numPoints+=t.length/3);const a=[];for(let e=0;e<t.length;e+=3)(0===r||t[e+2]>s)&&(i.numSimplified++,a.push(t[e],t[e+1])),i.numPoints++;n&&function(e,t){let i=0;for(let t=0,r=e.length,n=r-2;t<r;n=t,t+=2)i+=(e[t]-e[n])*(e[t+1]+e[n+1]);if(i>0===t)for(let t=0,i=e.length;t<i/2;t+=2){const r=e[t],n=e[t+1];e[t]=e[i-2-t],e[t+1]=e[i-1-t],e[i-2-t]=r,e[i-1-t]=n}}(a,o),e.push(a)}const re={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class ne{constructor(e,t){const i=(t=this.options=function(e,t){for(const i in t)e[i]=t[i];return e}(Object.create(re),t)).debug;if(i&&console.time("preprocess data"),t.maxZoom<0||t.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(t.promoteId&&t.generateId)throw new Error("promoteId and generateId cannot be used together.");let r=function(e,t){const i=[];if("FeatureCollection"===e.type)for(let r=0;r<e.features.length;r++)R(i,e.features[r],t,r);else R(i,"Feature"===e.type?e:{geometry:e},t);return i}(e,t);this.tiles={},this.tileCoords=[],i&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",t.indexMaxZoom,t.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),r=function(e,t){const i=t.buffer/t.extent;let r=e;const n=j(e,1,-1-i,i,0,-1,2,t),o=j(e,1,1-i,2+i,0,-1,2,t);return(n||o)&&(r=j(e,1,-i,1+i,0,-1,2,t)||[],n&&(r=W(n,1).concat(r)),o&&(r=r.concat(W(o,-1)))),r}(r,t),r.length&&this.splitTile(r,0,0,0),i&&(r.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(e,t,i,r,n,o,s){const a=[e,t,i,r],l=this.options,c=l.debug;for(;a.length;){r=a.pop(),i=a.pop(),t=a.pop(),e=a.pop();const u=1<<t,h=oe(t,i,r);let d=this.tiles[h];if(!d&&(c>1&&console.time("creation"),d=this.tiles[h]=ee(e,t,i,r,l),this.tileCoords.push({z:t,x:i,y:r}),c)){c>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",t,i,r,d.numFeatures,d.numPoints,d.numSimplified),console.timeEnd("creation"));const e=`z${t}`;this.stats[e]=(this.stats[e]||0)+1,this.total++}if(d.source=e,null==n){if(t===l.indexMaxZoom||d.numPoints<=l.indexMaxPoints)continue}else{if(t===l.maxZoom||t===n)continue;if(null!=n){const e=n-t;if(i!==o>>e||r!==s>>e)continue}}if(d.source=null,0===e.length)continue;c>1&&console.time("clipping");const p=.5*l.buffer/l.extent,f=.5-p,A=.5+p,m=1+p;let g=null,_=null,y=null,v=null,x=j(e,u,i-p,i+A,0,d.minX,d.maxX,l),b=j(e,u,i+f,i+m,0,d.minX,d.maxX,l);e=null,x&&(g=j(x,u,r-p,r+A,1,d.minY,d.maxY,l),_=j(x,u,r+f,r+m,1,d.minY,d.maxY,l),x=null),b&&(y=j(b,u,r-p,r+A,1,d.minY,d.maxY,l),v=j(b,u,r+f,r+m,1,d.minY,d.maxY,l),b=null),c>1&&console.timeEnd("clipping"),a.push(g||[],t+1,2*i,2*r),a.push(_||[],t+1,2*i,2*r+1),a.push(y||[],t+1,2*i+1,2*r),a.push(v||[],t+1,2*i+1,2*r+1)}}getTile(e,t,i){e=+e,t=+t,i=+i;const r=this.options,{extent:n,debug:o}=r;if(e<0||e>24)return null;const s=1<<e,a=oe(e,t=t+s&s-1,i);if(this.tiles[a])return Y(this.tiles[a],n);o>1&&console.log("drilling down to z%d-%d-%d",e,t,i);let l,c=e,u=t,h=i;for(;!l&&c>0;)c--,u>>=1,h>>=1,l=this.tiles[oe(c,u,h)];return l&&l.source?(o>1&&(console.log("found parent tile z%d-%d-%d",c,u,h),console.time("drilling down")),this.splitTile(l.source,c,u,h,e,t,i),o>1&&console.timeEnd("drilling down"),this.tiles[a]?Y(this.tiles[a],n):null):null}}function oe(e,t,i){return 32*((1<<e)*i+t)+e}function se(e,t){return t?e.properties[t]:e.id}function ae(e,t){if(null==e)return!0;if("Feature"===e.type)return null!=se(e,t);if("FeatureCollection"===e.type){const i=new Set;for(const r of e.features){const e=se(r,t);if(null==e)return!1;if(i.has(e))return!1;i.add(e)}return!0}return!1}function le(e,t){const i=new Map;if(null==e);else if("Feature"===e.type)i.set(se(e,t),e);else for(const r of e.features)i.set(se(r,t),r);return i}class ce extends o{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(t,i){return e._(this,void 0,void 0,(function*(){const e=t.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const i=this._geoJSONIndex.getTile(e.z,e.x,e.y);if(!i)return null;const r=new p(i.features);let n=y(r);return 0===n.byteOffset&&n.byteLength===n.buffer.byteLength||(n=new Uint8Array(n)),{vectorTile:r,rawData:n.buffer}}))}loadData(t){return e._(this,void 0,void 0,(function*(){var i;null===(i=this._pendingRequest)||void 0===i||i.abort();const r=!!(t&&t.request&&t.request.collectResourceTiming)&&new e.cC(t.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(t,this._pendingRequest),this._geoJSONIndex=t.cluster?new C(function({superclusterOptions:t,clusterProperties:i}){if(!i||!t)return t;const r={},n={},o={accumulated:null,zoom:0},s={properties:null},a=Object.keys(i);for(const t of a){const[o,s]=i[t],a=e.cJ(s),l=e.cJ("string"==typeof o?[o,["accumulated"],["get",t]]:o);r[t]=a.value,n[t]=l.value}return t.map=e=>{s.properties=e;const t={};for(const e of a)t[e]=r[e].evaluate(o,s);return t},t.reduce=(e,t)=>{s.properties=t;for(const t of a)o.accumulated=e[t],e[t]=n[t].evaluate(o,s)},t}(t)).load((yield this._pendingData).features):(n=yield this._pendingData,new ne(n,t.geojsonVtOptions)),this.loaded={};const i={};if(r){const e=r.finish();e&&(i.resourceTiming={},i.resourceTiming[t.source]=JSON.parse(JSON.stringify(e)))}return i}catch(t){if(delete this._pendingRequest,e.cn(t))return{abandoned:!0};throw t}var n}))}getData(){return e._(this,void 0,void 0,(function*(){return this._pendingData}))}reloadTile(e){const t=this.loaded;return t&&t[e.uid]?super.reloadTile(e):this.loadTile(e)}loadAndProcessGeoJSON(t,i){return e._(this,void 0,void 0,(function*(){let r=yield this.loadGeoJSON(t,i);if(delete this._pendingRequest,"object"!=typeof r)throw new Error(`Input data given to '${t.source}' is not a valid GeoJSON object.`);if(u(r,!0),t.filter){const i=e.cJ(t.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===i.result)throw new Error(i.value.map((e=>`${e.key}: ${e.message}`)).join(", "));const n=r.features.filter((e=>i.value.evaluate({zoom:0},e)));r={type:"FeatureCollection",features:n}}return r}))}loadGeoJSON(t,i){return e._(this,void 0,void 0,(function*(){const{promoteId:r}=t;if(t.request){const n=yield e.j(t.request,i);return this._dataUpdateable=ae(n.data,r)?le(n.data,r):void 0,n.data}if("string"==typeof t.data)try{const e=JSON.parse(t.data);return this._dataUpdateable=ae(e,r)?le(e,r):void 0,e}catch(e){throw new Error(`Input data given to '${t.source}' is not a valid GeoJSON object.`)}if(!t.dataDiff)throw new Error(`Input data given to '${t.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${t.source}`);return function(e,t,i){var r,n,o,s;if(t.removeAll&&e.clear(),t.remove)for(const i of t.remove)e.delete(i);if(t.add)for(const r of t.add){const t=se(r,i);null!=t&&e.set(t,r)}if(t.update)for(const i of t.update){let t=e.get(i.id);if(null==t)continue;const a=!i.removeAllProperties&&((null===(r=i.removeProperties)||void 0===r?void 0:r.length)>0||(null===(n=i.addOrUpdateProperties)||void 0===n?void 0:n.length)>0);if((i.newGeometry||i.removeAllProperties||a)&&(t=Object.assign({},t),e.set(i.id,t),a&&(t.properties=Object.assign({},t.properties))),i.newGeometry&&(t.geometry=i.newGeometry),i.removeAllProperties)t.properties={};else if((null===(o=i.removeProperties)||void 0===o?void 0:o.length)>0)for(const e of i.removeProperties)Object.prototype.hasOwnProperty.call(t.properties,e)&&delete t.properties[e];if((null===(s=i.addOrUpdateProperties)||void 0===s?void 0:s.length)>0)for(const{key:e,value:r}of i.addOrUpdateProperties)t.properties[e]=r}}(this._dataUpdateable,t.dataDiff,r),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}}))}removeSource(t){return e._(this,void 0,void 0,(function*(){this._pendingRequest&&this._pendingRequest.abort()}))}getClusterExpansionZoom(e){return this._geoJSONIndex.getClusterExpansionZoom(e.clusterId)}getClusterChildren(e){return this._geoJSONIndex.getChildren(e.clusterId)}getClusterLeaves(e){return this._geoJSONIndex.getLeaves(e.clusterId,e.limit,e.offset)}}class ue{constructor(t){this.self=t,this.actor=new e.H(t),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(e,t)=>{if(this.externalWorkerSourceTypes[e])throw new Error(`Worker source with name "${e}" already registered.`);this.externalWorkerSourceTypes[e]=t},this.self.addProtocol=e.cp,this.self.removeProtocol=e.cq,this.self.registerRTLTextPlugin=t=>{e.cK.setMethods(t)},this.actor.registerMessageHandler("LDT",((e,t)=>this._getDEMWorkerSource(e,t.source).loadTile(t))),this.actor.registerMessageHandler("RDT",((t,i)=>e._(this,void 0,void 0,(function*(){this._getDEMWorkerSource(t,i.source).removeTile(i)})))),this.actor.registerMessageHandler("GCEZ",((t,i)=>e._(this,void 0,void 0,(function*(){return this._getWorkerSource(t,i.type,i.source).getClusterExpansionZoom(i)})))),this.actor.registerMessageHandler("GCC",((t,i)=>e._(this,void 0,void 0,(function*(){return this._getWorkerSource(t,i.type,i.source).getClusterChildren(i)})))),this.actor.registerMessageHandler("GCL",((t,i)=>e._(this,void 0,void 0,(function*(){return this._getWorkerSource(t,i.type,i.source).getClusterLeaves(i)})))),this.actor.registerMessageHandler("LD",((e,t)=>this._getWorkerSource(e,t.type,t.source).loadData(t))),this.actor.registerMessageHandler("GD",((e,t)=>this._getWorkerSource(e,t.type,t.source).getData())),this.actor.registerMessageHandler("LT",((e,t)=>this._getWorkerSource(e,t.type,t.source).loadTile(t))),this.actor.registerMessageHandler("RT",((e,t)=>this._getWorkerSource(e,t.type,t.source).reloadTile(t))),this.actor.registerMessageHandler("AT",((e,t)=>this._getWorkerSource(e,t.type,t.source).abortTile(t))),this.actor.registerMessageHandler("RMT",((e,t)=>this._getWorkerSource(e,t.type,t.source).removeTile(t))),this.actor.registerMessageHandler("RS",((t,i)=>e._(this,void 0,void 0,(function*(){if(!this.workerSources[t]||!this.workerSources[t][i.type]||!this.workerSources[t][i.type][i.source])return;const e=this.workerSources[t][i.type][i.source];delete this.workerSources[t][i.type][i.source],void 0!==e.removeSource&&e.removeSource(i)})))),this.actor.registerMessageHandler("RM",(t=>e._(this,void 0,void 0,(function*(){delete this.layerIndexes[t],delete this.availableImages[t],delete this.workerSources[t],delete this.demWorkerSources[t]})))),this.actor.registerMessageHandler("SR",((t,i)=>e._(this,void 0,void 0,(function*(){this.referrer=i})))),this.actor.registerMessageHandler("SRPS",((e,t)=>this._syncRTLPluginState(e,t))),this.actor.registerMessageHandler("IS",((t,i)=>e._(this,void 0,void 0,(function*(){this.self.importScripts(i)})))),this.actor.registerMessageHandler("SI",((e,t)=>this._setImages(e,t))),this.actor.registerMessageHandler("UL",((t,i)=>e._(this,void 0,void 0,(function*(){this._getLayerIndex(t).update(i.layers,i.removedIds)})))),this.actor.registerMessageHandler("SL",((t,i)=>e._(this,void 0,void 0,(function*(){this._getLayerIndex(t).replace(i)}))))}_setImages(t,i){return e._(this,void 0,void 0,(function*(){this.availableImages[t]=i;for(const e in this.workerSources[t]){const r=this.workerSources[t][e];for(const e in r)r[e].availableImages=i}}))}_syncRTLPluginState(t,i){return e._(this,void 0,void 0,(function*(){return yield e.cK.syncState(i,this.self.importScripts)}))}_getAvailableImages(e){let t=this.availableImages[e];return t||(t=[]),t}_getLayerIndex(e){let i=this.layerIndexes[e];return i||(i=this.layerIndexes[e]=new t),i}_getWorkerSource(e,t,i){if(this.workerSources[e]||(this.workerSources[e]={}),this.workerSources[e][t]||(this.workerSources[e][t]={}),!this.workerSources[e][t][i]){const r={sendAsync:(t,i)=>(t.targetMapId=e,this.actor.sendAsync(t,i))};switch(t){case"vector":this.workerSources[e][t][i]=new o(r,this._getLayerIndex(e),this._getAvailableImages(e));break;case"geojson":this.workerSources[e][t][i]=new ce(r,this._getLayerIndex(e),this._getAvailableImages(e));break;default:this.workerSources[e][t][i]=new this.externalWorkerSourceTypes[t](r,this._getLayerIndex(e),this._getAvailableImages(e))}}return this.workerSources[e][t][i]}_getDEMWorkerSource(e,t){return this.demWorkerSources[e]||(this.demWorkerSources[e]={}),this.demWorkerSources[e][t]||(this.demWorkerSources[e][t]=new s),this.demWorkerSources[e][t]}}return e.i(self)&&(self.worker=new ue(self)),ue})),i("index",["exports","./shared"],(function(e,t){var i="5.4.0";function r(){var e=new t.A(4);return t.A!=Float32Array&&(e[1]=0,e[2]=0),e[0]=1,e[3]=1,e}let n,o;const s={now:"undefined"!=typeof performance&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(e,i,r){const n=requestAnimationFrame((e=>{o(),i(e)})),{unsubscribe:o}=t.s(e.signal,"abort",(()=>{o(),cancelAnimationFrame(n),r(t.c())}),!1)},frameAsync(e){return new Promise(((t,i)=>{this.frame(e,t,i)}))},getImageData(e,t=0){return this.getImageCanvasContext(e).getImageData(-t,-t,e.width+2*t,e.height+2*t)},getImageCanvasContext(e){const t=window.document.createElement("canvas"),i=t.getContext("2d",{willReadFrequently:!0});if(!i)throw new Error("failed to create canvas 2d context");return t.width=e.width,t.height=e.height,i.drawImage(e,0,0,e.width,e.height),i},resolveURL:e=>(n||(n=document.createElement("a")),n.href=e,n.href),hardwareConcurrency:"undefined"!=typeof navigator&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(null==o&&(o=matchMedia("(prefers-reduced-motion: reduce)")),o.matches)}};class a{static testProp(e){if(!a.docStyle)return e[0];for(let t=0;t<e.length;t++)if(e[t]in a.docStyle)return e[t];return e[0]}static create(e,t,i){const r=window.document.createElement(e);return void 0!==t&&(r.className=t),i&&i.appendChild(r),r}static createNS(e,t){return window.document.createElementNS(e,t)}static disableDrag(){a.docStyle&&a.selectProp&&(a.userSelect=a.docStyle[a.selectProp],a.docStyle[a.selectProp]="none")}static enableDrag(){a.docStyle&&a.selectProp&&(a.docStyle[a.selectProp]=a.userSelect)}static setTransform(e,t){e.style[a.transformProp]=t}static addEventListener(e,t,i,r={}){e.addEventListener(t,i,"passive"in r?r:r.capture)}static removeEventListener(e,t,i,r={}){e.removeEventListener(t,i,"passive"in r?r:r.capture)}static suppressClickInternal(e){e.preventDefault(),e.stopPropagation(),window.removeEventListener("click",a.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",a.suppressClickInternal,!0),window.setTimeout((()=>{window.removeEventListener("click",a.suppressClickInternal,!0)}),0)}static getScale(e){const t=e.getBoundingClientRect();return{x:t.width/e.offsetWidth||1,y:t.height/e.offsetHeight||1,boundingClientRect:t}}static getPoint(e,i,r){const n=i.boundingClientRect;return new t.P((r.clientX-n.left)/i.x-e.clientLeft,(r.clientY-n.top)/i.y-e.clientTop)}static mousePos(e,t){const i=a.getScale(e);return a.getPoint(e,i,t)}static touchPos(e,t){const i=[],r=a.getScale(e);for(let n=0;n<t.length;n++)i.push(a.getPoint(e,r,t[n]));return i}static mouseButton(e){return e.button}static remove(e){e.parentNode&&e.parentNode.removeChild(e)}static sanitize(e){const t=(new DOMParser).parseFromString(e,"text/html").body||document.createElement("body"),i=t.querySelectorAll("script");for(const e of i)e.remove();return a.clean(t),t.innerHTML}static isPossiblyDangerous(e,t){const i=t.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(e)||!i.includes("javascript:")&&!i.includes("data:"))||!!e.startsWith("on")||void 0}static clean(e){const t=e.children;for(const e of t)a.removeAttributes(e),a.clean(e)}static removeAttributes(e){for(const{name:t,value:i}of e.attributes)a.isPossiblyDangerous(t,i)&&e.removeAttribute(t)}}a.docStyle="undefined"!=typeof window&&window.document&&window.document.documentElement.style,a.selectProp=a.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),a.transformProp=a.testProp(["transform","WebkitTransform"]);const l={supported:!1,testSupport:function(e){!h&&u&&(d?p(e):c=e)}};let c,u,h=!1,d=!1;function p(e){const t=e.createTexture();e.bindTexture(e.TEXTURE_2D,t);try{if(e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,u),e.isContextLost())return;l.supported=!0}catch(e){}e.deleteTexture(t),h=!0}var f;"undefined"!=typeof document&&(u=document.createElement("img"),u.onload=()=>{c&&p(c),c=null,d=!0},u.onerror=()=>{h=!0,c=null},u.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(e){let i,r,n,o;e.resetRequestQueue=()=>{i=[],r=0,n=0,o={}},e.addThrottleControl=e=>{const t=n++;return o[t]=e,t},e.removeThrottleControl=e=>{delete o[e],a()},e.getImage=(e,r,n=!0)=>new Promise(((o,s)=>{l.supported&&(e.headers||(e.headers={}),e.headers.accept="image/webp,*/*"),t.e(e,{type:"image"}),i.push({abortController:r,requestParameters:e,supportImageRefresh:n,state:"queued",onError:e=>{s(e)},onSuccess:e=>{o(e)}}),a()}));const s=e=>t._(this,void 0,void 0,(function*(){e.state="running";const{requestParameters:i,supportImageRefresh:n,onError:o,onSuccess:s,abortController:l}=e,u=!1===n&&!t.i(self)&&!t.g(i.url)&&(!i.headers||Object.keys(i.headers).reduce(((e,t)=>e&&"accept"===t),!0));r++;const h=u?c(i,l):t.m(i,l);try{const i=yield h;delete e.abortController,e.state="completed",i.data instanceof HTMLImageElement||t.b(i.data)?s(i):i.data&&s({data:yield(d=i.data,"function"==typeof createImageBitmap?t.f(d):t.h(d)),cacheControl:i.cacheControl,expires:i.expires})}catch(t){delete e.abortController,o(t)}finally{r--,a()}var d})),a=()=>{const e=(()=>{for(const e of Object.keys(o))if(o[e]())return!0;return!1})()?t.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:t.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let t=r;t<e&&i.length>0;t++){const e=i.shift();e.abortController.signal.aborted?t--:s(e)}},c=(e,i)=>new Promise(((r,n)=>{const o=new Image,s=e.url,a=e.credentials;a&&"include"===a?o.crossOrigin="use-credentials":(a&&"same-origin"===a||!t.d(s))&&(o.crossOrigin="anonymous"),i.signal.addEventListener("abort",(()=>{o.src="",n(t.c())})),o.fetchPriority="high",o.onload=()=>{o.onerror=o.onload=null,r({data:o})},o.onerror=()=>{o.onerror=o.onload=null,i.signal.aborted||n(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},o.src=s}))}(f||(f={})),f.resetRequestQueue();class A{constructor(e){this._transformRequestFn=e}transformRequest(e,t){return this._transformRequestFn&&this._transformRequestFn(e,t)||{url:e}}setTransformRequest(e){this._transformRequestFn=e}}function m(e){const t=[];if("string"==typeof e)t.push({id:"default",url:e});else if(e&&e.length>0){const i=[];for(const{id:r,url:n}of e){const e=`${r}${n}`;-1===i.indexOf(e)&&(i.push(e),t.push({id:r,url:n}))}}return t}function g(e,t,i){try{const r=new URL(e);return r.pathname+=`${t}${i}`,r.toString()}catch(t){throw new Error(`Invalid sprite URL "${e}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}class _{constructor(e,t,i,r){this.context=e,this.format=i,this.texture=e.gl.createTexture(),this.update(t,r)}update(e,i,r){const{width:n,height:o}=e,s=!(this.size&&this.size[0]===n&&this.size[1]===o||r),{context:a}=this,{gl:l}=a;if(this.useMipmap=Boolean(i&&i.useMipmap),l.bindTexture(l.TEXTURE_2D,this.texture),a.pixelStoreUnpackFlipY.set(!1),a.pixelStoreUnpack.set(1),a.pixelStoreUnpackPremultiplyAlpha.set(this.format===l.RGBA&&(!i||!1!==i.premultiply)),s)this.size=[n,o],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||t.b(e)?l.texImage2D(l.TEXTURE_2D,0,this.format,this.format,l.UNSIGNED_BYTE,e):l.texImage2D(l.TEXTURE_2D,0,this.format,n,o,0,this.format,l.UNSIGNED_BYTE,e.data);else{const{x:i,y:s}=r||{x:0,y:0};e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||t.b(e)?l.texSubImage2D(l.TEXTURE_2D,0,i,s,l.RGBA,l.UNSIGNED_BYTE,e):l.texSubImage2D(l.TEXTURE_2D,0,i,s,n,o,l.RGBA,l.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&l.generateMipmap(l.TEXTURE_2D),a.pixelStoreUnpackFlipY.setDefault(),a.pixelStoreUnpack.setDefault(),a.pixelStoreUnpackPremultiplyAlpha.setDefault()}bind(e,t,i){const{context:r}=this,{gl:n}=r;n.bindTexture(n.TEXTURE_2D,this.texture),i!==n.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(i=n.LINEAR),e!==this.filter&&(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,e),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,i||e),this.filter=e),t!==this.wrap&&(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,t),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,t),this.wrap=t)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}function y(e){const{userImage:t}=e;return!!(t&&t.render&&t.render())&&(e.data.replace(new Uint8Array(t.data.buffer)),!0)}class v extends t.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new t.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(e){if(this.loaded!==e&&(this.loaded=e,e)){for(const{ids:e,promiseResolve:t}of this.requestors)t(this._getImagesForIds(e));this.requestors=[]}}getImage(e){const i=this.images[e];if(i&&!i.data&&i.spriteData){const e=i.spriteData;i.data=new t.R({width:e.width,height:e.height},e.context.getImageData(e.x,e.y,e.width,e.height).data),i.spriteData=null}return i}addImage(e,t){if(this.images[e])throw new Error(`Image id ${e} already exist, use updateImage instead`);this._validate(e,t)&&(this.images[e]=t)}_validate(e,i){let r=!0;const n=i.data||i.spriteData;return this._validateStretch(i.stretchX,n&&n.width)||(this.fire(new t.k(new Error(`Image "${e}" has invalid "stretchX" value`))),r=!1),this._validateStretch(i.stretchY,n&&n.height)||(this.fire(new t.k(new Error(`Image "${e}" has invalid "stretchY" value`))),r=!1),this._validateContent(i.content,i)||(this.fire(new t.k(new Error(`Image "${e}" has invalid "content" value`))),r=!1),r}_validateStretch(e,t){if(!e)return!0;let i=0;for(const r of e){if(r[0]<i||r[1]<r[0]||t<r[1])return!1;i=r[1]}return!0}_validateContent(e,t){if(!e)return!0;if(4!==e.length)return!1;const i=t.spriteData,r=i&&i.width||t.data.width,n=i&&i.height||t.data.height;return!(e[0]<0||r<e[0]||e[1]<0||n<e[1]||e[2]<0||r<e[2]||e[3]<0||n<e[3]||e[2]<e[0]||e[3]<e[1])}updateImage(e,t,i=!0){const r=this.getImage(e);if(i&&(r.data.width!==t.data.width||r.data.height!==t.data.height))throw new Error(`size mismatch between old image (${r.data.width}x${r.data.height}) and new image (${t.data.width}x${t.data.height}).`);t.version=r.version+1,this.images[e]=t,this.updatedImages[e]=!0}removeImage(e){const t=this.images[e];delete this.images[e],delete this.patterns[e],t.userImage&&t.userImage.onRemove&&t.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(e){return new Promise(((t,i)=>{let r=!0;if(!this.isLoaded())for(const t of e)this.images[t]||(r=!1);this.isLoaded()||r?t(this._getImagesForIds(e)):this.requestors.push({ids:e,promiseResolve:t})}))}_getImagesForIds(e){const i={};for(const r of e){let e=this.getImage(r);e||(this.fire(new t.l("styleimagemissing",{id:r})),e=this.getImage(r)),e?i[r]={data:e.data.clone(),pixelRatio:e.pixelRatio,sdf:e.sdf,version:e.version,stretchX:e.stretchX,stretchY:e.stretchY,content:e.content,textFitWidth:e.textFitWidth,textFitHeight:e.textFitHeight,hasRenderCallback:Boolean(e.userImage&&e.userImage.render)}:t.w(`Image "${r}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return i}getPixelSize(){const{width:e,height:t}=this.atlasImage;return{width:e,height:t}}getPattern(e){const i=this.patterns[e],r=this.getImage(e);if(!r)return null;if(i&&i.position.version===r.version)return i.position;if(i)i.position.version=r.version;else{const i={w:r.data.width+2,h:r.data.height+2,x:0,y:0},n=new t.I(i,r);this.patterns[e]={bin:i,position:n}}return this._updatePatternAtlas(),this.patterns[e].position}bind(e){const t=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new _(e,this.atlasImage,t.RGBA),this.atlasTexture.bind(t.LINEAR,t.CLAMP_TO_EDGE)}_updatePatternAtlas(){const e=[];for(const t in this.patterns)e.push(this.patterns[t].bin);const{w:i,h:r}=t.p(e),n=this.atlasImage;n.resize({width:i||1,height:r||1});for(const e in this.patterns){const{bin:i}=this.patterns[e],r=i.x+1,o=i.y+1,s=this.getImage(e).data,a=s.width,l=s.height;t.R.copy(s,n,{x:0,y:0},{x:r,y:o},{width:a,height:l}),t.R.copy(s,n,{x:0,y:l-1},{x:r,y:o-1},{width:a,height:1}),t.R.copy(s,n,{x:0,y:0},{x:r,y:o+l},{width:a,height:1}),t.R.copy(s,n,{x:a-1,y:0},{x:r-1,y:o},{width:1,height:l}),t.R.copy(s,n,{x:0,y:0},{x:r+a,y:o},{width:1,height:l})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(e){for(const i of e){if(this.callbackDispatchedThisFrame[i])continue;this.callbackDispatchedThisFrame[i]=!0;const e=this.getImage(i);e||t.w(`Image with ID: "${i}" was not found`),y(e)&&this.updateImage(i,e)}}}const x=1e20;function b(e,t,i,r,n,o,s,a,l){for(let c=t;c<t+r;c++)w(e,i*o+c,o,n,s,a,l);for(let c=i;c<i+n;c++)w(e,c*o+t,1,r,s,a,l)}function w(e,t,i,r,n,o,s){o[0]=0,s[0]=-1e20,s[1]=x,n[0]=e[t];for(let a=1,l=0,c=0;a<r;a++){n[a]=e[t+a*i];const r=a*a;do{const e=o[l];c=(n[a]-n[e]+r-e*e)/(a-e)/2}while(c<=s[l]&&--l>-1);l++,o[l]=a,s[l]=c,s[l+1]=x}for(let a=0,l=0;a<r;a++){for(;s[l+1]<a;)l++;const r=o[l],c=a-r;e[t+a*i]=n[r]+c*c}}class T{constructor(e,t){this.requestManager=e,this.localIdeographFontFamily=t,this.entries={}}setURL(e){this.url=e}getGlyphs(e){return t._(this,void 0,void 0,(function*(){const t=[];for(const i in e)for(const r of e[i])t.push(this._getAndCacheGlyphsPromise(i,r));const i=yield Promise.all(t),r={};for(const{stack:e,id:t,glyph:n}of i)r[e]||(r[e]={}),r[e][t]=n&&{id:n.id,bitmap:n.bitmap.clone(),metrics:n.metrics};return r}))}_getAndCacheGlyphsPromise(e,i){return t._(this,void 0,void 0,(function*(){let t=this.entries[e];t||(t=this.entries[e]={glyphs:{},requests:{},ranges:{}});let r=t.glyphs[i];if(void 0!==r)return{stack:e,id:i,glyph:r};if(r=this._tinySDF(t,e,i),r)return t.glyphs[i]=r,{stack:e,id:i,glyph:r};const n=Math.floor(i/256);if(256*n>65535)throw new Error("glyphs > 65535 not supported");if(t.ranges[n])return{stack:e,id:i,glyph:r};if(!this.url)throw new Error("glyphsUrl is not set");if(!t.requests[n]){const i=T.loadGlyphRange(e,n,this.url,this.requestManager);t.requests[n]=i}const o=yield t.requests[n];for(const e in o)this._doesCharSupportLocalGlyph(+e)||(t.glyphs[+e]=o[+e]);return t.ranges[n]=!0,{stack:e,id:i,glyph:o[i]||null}}))}_doesCharSupportLocalGlyph(e){return!!this.localIdeographFontFamily&&(/\p{Ideo}|\p{sc=Hang}|\p{sc=Hira}|\p{sc=Kana}/u.test(String.fromCodePoint(e))||t.u["CJK Unified Ideographs"](e)||t.u["Hangul Syllables"](e)||t.u.Hiragana(e)||t.u.Katakana(e)||t.u["CJK Symbols and Punctuation"](e)||t.u["Halfwidth and Fullwidth Forms"](e))}_tinySDF(e,i,r){const n=this.localIdeographFontFamily;if(!n)return;if(!this._doesCharSupportLocalGlyph(r))return;let o=e.tinySDF;if(!o){let t="400";/bold/i.test(i)?t="900":/medium/i.test(i)?t="500":/light/i.test(i)&&(t="200"),o=e.tinySDF=new T.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:n,fontWeight:t})}const s=o.draw(String.fromCharCode(r));return{id:r,bitmap:new t.q({width:s.width||60,height:s.height||60},s.data),metrics:{width:s.glyphWidth/2||24,height:s.glyphHeight/2||24,left:s.glyphLeft/2+.5||0,top:s.glyphTop/2-27.5||-8,advance:s.glyphAdvance/2||24,isDoubleResolution:!0}}}}T.loadGlyphRange=function(e,i,r,n){return t._(this,void 0,void 0,(function*(){const o=256*i,s=o+255,a=n.transformRequest(r.replace("{fontstack}",e).replace("{range}",`${o}-${s}`),"Glyphs"),l=yield t.n(a,new AbortController);if(!l||!l.data)throw new Error(`Could not load glyph range. range: ${i}, ${o}-${s}`);const c={};for(const e of t.o(l.data))c[e.id]=e;return c}))},T.TinySDF=class{constructor({fontSize:e=24,buffer:t=3,radius:i=8,cutoff:r=.25,fontFamily:n="sans-serif",fontWeight:o="normal",fontStyle:s="normal"}={}){this.buffer=t,this.cutoff=r,this.radius=i;const a=this.size=e+4*t,l=this._createCanvas(a),c=this.ctx=l.getContext("2d",{willReadFrequently:!0});c.font=`${s} ${o} ${e}px ${n}`,c.textBaseline="alphabetic",c.textAlign="left",c.fillStyle="black",this.gridOuter=new Float64Array(a*a),this.gridInner=new Float64Array(a*a),this.f=new Float64Array(a),this.z=new Float64Array(a+1),this.v=new Uint16Array(a)}_createCanvas(e){const t=document.createElement("canvas");return t.width=t.height=e,t}draw(e){const{width:t,actualBoundingBoxAscent:i,actualBoundingBoxDescent:r,actualBoundingBoxLeft:n,actualBoundingBoxRight:o}=this.ctx.measureText(e),s=Math.ceil(i),a=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(o-n))),l=Math.min(this.size-this.buffer,s+Math.ceil(r)),c=a+2*this.buffer,u=l+2*this.buffer,h=Math.max(c*u,0),d=new Uint8ClampedArray(h),p={data:d,width:c,height:u,glyphWidth:a,glyphHeight:l,glyphTop:s,glyphLeft:0,glyphAdvance:t};if(0===a||0===l)return p;const{ctx:f,buffer:A,gridInner:m,gridOuter:g}=this;f.clearRect(A,A,a,l),f.fillText(e,A,A+s);const _=f.getImageData(A,A,a,l);g.fill(x,0,h),m.fill(0,0,h);for(let e=0;e<l;e++)for(let t=0;t<a;t++){const i=_.data[4*(e*a+t)+3]/255;if(0===i)continue;const r=(e+A)*c+t+A;if(1===i)g[r]=0,m[r]=x;else{const e=.5-i;g[r]=e>0?e*e:0,m[r]=e<0?e*e:0}}b(g,0,0,c,u,c,this.f,this.v,this.z),b(m,A,A,a,l,c,this.f,this.v,this.z);for(let e=0;e<h;e++){const t=Math.sqrt(g[e])-Math.sqrt(m[e]);d[e]=Math.round(255-255*(t/this.radius+this.cutoff))}return p}};class B{constructor(){this.specification=t.v.light.position}possiblyEvaluate(e,i){return t.z(e.expression.evaluate(i))}interpolate(e,i,r){return{x:t.B.number(e.x,i.x,r),y:t.B.number(e.y,i.y,r),z:t.B.number(e.z,i.z,r)}}}let C;class S extends t.E{constructor(e){super(),C=C||new t.r({anchor:new t.D(t.v.light.anchor),position:new B,color:new t.D(t.v.light.color),intensity:new t.D(t.v.light.intensity)}),this._transitionable=new t.T(C),this.setLight(e),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,i={}){if(!this._validate(t.t,e,i))for(const t in e){const i=e[t];t.endsWith("-transition")?this._transitionable.setTransition(t.slice(0,-11),i):this._transitionable.setValue(t,i)}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,i,r){return(!r||!1!==r.validate)&&t.x(this,e.call(t.y,{value:i,style:{glyphs:!0,sprite:!0},styleSpec:t.v}))}}const E=new t.r({"sky-color":new t.D(t.v.sky["sky-color"]),"horizon-color":new t.D(t.v.sky["horizon-color"]),"fog-color":new t.D(t.v.sky["fog-color"]),"fog-ground-blend":new t.D(t.v.sky["fog-ground-blend"]),"horizon-fog-blend":new t.D(t.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new t.D(t.v.sky["sky-horizon-blend"]),"atmosphere-blend":new t.D(t.v.sky["atmosphere-blend"])});class M extends t.E{constructor(e){super(),this._transitionable=new t.T(E),this.setSky(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new t.C(0))}setSky(e,i={}){if(!this._validate(t.F,e,i)){e||(e={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const t in e){const i=e[t];t.endsWith("-transition")?this._transitionable.setTransition(t.slice(0,-11),i):this._transitionable.setValue(t,i)}}}getSky(){return this._transitionable.serialize()}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,i,r={}){return!1!==(null==r?void 0:r.validate)&&t.x(this,e.call(t.y,t.e({value:i,style:{glyphs:!0,sprite:!0},styleSpec:t.v})))}calculateFogBlendOpacity(e){return e<60?0:e<70?(e-60)/10:1}}class I{constructor(e,t){this.width=e,this.height=t,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(e,t){const i=e.join(",")+String(t);return this.dashEntry[i]||(this.dashEntry[i]=this.addDash(e,t)),this.dashEntry[i]}getDashRanges(e,t,i){const r=[];let n=e.length%2==1?-e[e.length-1]*i:0,o=e[0]*i,s=!0;r.push({left:n,right:o,isDash:s,zeroLength:0===e[0]});let a=e[0];for(let t=1;t<e.length;t++){s=!s;const l=e[t];n=a*i,a+=l,o=a*i,r.push({left:n,right:o,isDash:s,zeroLength:0===l})}return r}addRoundDash(e,t,i){const r=t/2;for(let t=-i;t<=i;t++){const n=this.width*(this.nextRow+i+t);let o=0,s=e[o];for(let a=0;a<this.width;a++){a/s.right>1&&(s=e[++o]);const l=Math.abs(a-s.left),c=Math.abs(a-s.right),u=Math.min(l,c);let h;const d=t/i*(r+1);if(s.isDash){const e=r-Math.abs(d);h=Math.sqrt(u*u+e*e)}else h=r-Math.sqrt(u*u+d*d);this.data[n+a]=Math.max(0,Math.min(255,h+128))}}}addRegularDash(e){for(let t=e.length-1;t>=0;--t){const i=e[t],r=e[t+1];i.zeroLength?e.splice(t,1):r&&r.isDash===i.isDash&&(r.left=i.left,e.splice(t,1))}const t=e[0],i=e[e.length-1];t.isDash===i.isDash&&(t.left=i.left-this.width,i.right=t.right+this.width);const r=this.width*this.nextRow;let n=0,o=e[n];for(let t=0;t<this.width;t++){t/o.right>1&&(o=e[++n]);const i=Math.abs(t-o.left),s=Math.abs(t-o.right),a=Math.min(i,s);this.data[r+t]=Math.max(0,Math.min(255,(o.isDash?a:-a)+128))}}addDash(e,i){const r=i?7:0,n=2*r+1;if(this.nextRow+n>this.height)return t.w("LineAtlas out of space"),null;let o=0;for(let t=0;t<e.length;t++)o+=e[t];if(0!==o){const t=this.width/o,n=this.getDashRanges(e,this.width,t);i?this.addRoundDash(n,t,r):this.addRegularDash(n)}const s={y:(this.nextRow+r+.5)/this.height,height:2*r/this.height,width:o};return this.nextRow+=n,this.dirty=!0,s}bind(e){const t=e.gl;this.texture?(t.bindTexture(t.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,t.texSubImage2D(t.TEXTURE_2D,0,0,0,this.width,this.height,t.ALPHA,t.UNSIGNED_BYTE,this.data))):(this.texture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texImage2D(t.TEXTURE_2D,0,t.ALPHA,this.width,this.height,0,t.ALPHA,t.UNSIGNED_BYTE,this.data))}}const P="maplibre_preloaded_worker_pool";class L{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<L.workerCount;)this.workers.push(new Worker(t.a.WORKER_URL));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],0===this.numActive()&&(this.workers.forEach((e=>{e.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[P]}numActive(){return Object.keys(this.active).length}}const F=Math.floor(s.hardwareConcurrency/2);let k,z;function R(){return k||(k=new L),k}L.workerCount=t.G(globalThis)?Math.max(Math.min(F,3),1):1;class D{constructor(e,i){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=i;const r=this.workerPool.acquire(i);for(let e=0;e<r.length;e++){const n=new t.H(r[e],i);n.name=`Worker ${e}`,this.actors.push(n)}if(!this.actors.length)throw new Error("No actors found")}broadcast(e,t){const i=[];for(const r of this.actors)i.push(r.sendAsync({type:e,data:t}));return Promise.all(i)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(e=!0){this.actors.forEach((e=>{e.remove()})),this.actors=[],e&&this.workerPool.release(this.id)}registerMessageHandler(e,t){for(const i of this.actors)i.registerMessageHandler(e,t)}}function O(){return z||(z=new D(R(),t.J),z.registerMessageHandler("GR",((e,i,r)=>t.m(i,r)))),z}function U(e,i){const r=t.K();return t.L(r,r,[1,1,0]),t.M(r,r,[.5*e.width,.5*e.height,1]),e.calculatePosMatrix?t.N(r,r,e.calculatePosMatrix(i.toUnwrapped())):r}function N(e,t,i,r,n,o,s){var a;const l=function(e,t,i){if(e)for(const r of e){const e=t[r];if(e&&e.source===i&&"fill-extrusion"===e.type)return!0}else for(const e in t){const r=t[e];if(r.source===i&&"fill-extrusion"===r.type)return!0}return!1}(null!==(a=null==n?void 0:n.layers)&&void 0!==a?a:null,t,e.id),c=o.maxPitchScaleFactor(),u=e.tilesIn(r,c,l);u.sort(Q);const h=[];for(const r of u)h.push({wrappedTileID:r.tileID.wrapped().key,queryResults:r.tile.queryRenderedFeatures(t,i,e._state,r.queryGeometry,r.cameraQueryGeometry,r.scale,n,o,c,U(e.transform,r.tileID),s?(e,t)=>s(r.tileID,e,t):void 0)});return function(e,t){for(const i in e)for(const r of e[i])j(r,t);return e}(function(e){const t={},i={};for(const r of e){const e=r.queryResults,n=r.wrappedTileID,o=i[n]=i[n]||{};for(const i in e){const r=e[i],n=o[i]=o[i]||{},s=t[i]=t[i]||[];for(const e of r)n[e.featureIndex]||(n[e.featureIndex]=!0,s.push(e))}}return t}(h),e)}function Q(e,t){const i=e.tileID,r=t.tileID;return i.overscaledZ-r.overscaledZ||i.canonical.y-r.canonical.y||i.wrap-r.wrap||i.canonical.x-r.canonical.x}function j(e,t){const i=e.feature,r=t.getFeatureState(i.layer["source-layer"],i.id);i.source=i.layer.source,i.layer["source-layer"]&&(i.sourceLayer=i.layer["source-layer"]),i.state=r}function V(e,i,r){return t._(this,void 0,void 0,(function*(){let n=e;if(e.url?n=(yield t.j(i.transformRequest(e.url,"Source"),r)).data:yield s.frameAsync(r),!n)return null;const o=t.O(t.e(n,e),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in n&&n.vector_layers&&(o.vectorLayerIds=n.vector_layers.map((e=>e.id))),o}))}class H{constructor(e,t){e&&(t?this.setSouthWest(e).setNorthEast(t):Array.isArray(e)&&(4===e.length?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1])))}setNorthEast(e){return this._ne=e instanceof t.Q?new t.Q(e.lng,e.lat):t.Q.convert(e),this}setSouthWest(e){return this._sw=e instanceof t.Q?new t.Q(e.lng,e.lat):t.Q.convert(e),this}extend(e){const i=this._sw,r=this._ne;let n,o;if(e instanceof t.Q)n=e,o=e;else{if(!(e instanceof H))return Array.isArray(e)?4===e.length||e.every(Array.isArray)?this.extend(H.convert(e)):this.extend(t.Q.convert(e)):e&&("lng"in e||"lon"in e)&&"lat"in e?this.extend(t.Q.convert(e)):this;if(n=e._sw,o=e._ne,!n||!o)return this}return i||r?(i.lng=Math.min(n.lng,i.lng),i.lat=Math.min(n.lat,i.lat),r.lng=Math.max(o.lng,r.lng),r.lat=Math.max(o.lat,r.lat)):(this._sw=new t.Q(n.lng,n.lat),this._ne=new t.Q(o.lng,o.lat)),this}getCenter(){return new t.Q((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new t.Q(this.getWest(),this.getNorth())}getSouthEast(){return new t.Q(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:i,lat:r}=t.Q.convert(e);let n=this._sw.lng<=i&&i<=this._ne.lng;return this._sw.lng>this._ne.lng&&(n=this._sw.lng>=i&&i>=this._ne.lng),this._sw.lat<=r&&r<=this._ne.lat&&n}static convert(e){return e instanceof H?e:e?new H(e):e}static fromLngLat(e,i=0){const r=360*i/40075017,n=r/Math.cos(Math.PI/180*e.lat);return new H(new t.Q(e.lng-n,e.lat-r),new t.Q(e.lng+n,e.lat+r))}adjustAntiMeridian(){const e=new t.Q(this._sw.lng,this._sw.lat),i=new t.Q(this._ne.lng,this._ne.lat);return new H(e,e.lng>i.lng?new t.Q(i.lng+360,i.lat):i)}}class G{constructor(e,t,i){this.bounds=H.convert(this.validateBounds(e)),this.minzoom=t||0,this.maxzoom=i||24}validateBounds(e){return Array.isArray(e)&&4===e.length?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(e){const i=Math.pow(2,e.z),r=Math.floor(t.U(this.bounds.getWest())*i),n=Math.floor(t.S(this.bounds.getNorth())*i),o=Math.ceil(t.U(this.bounds.getEast())*i),s=Math.ceil(t.S(this.bounds.getSouth())*i);return e.x>=r&&e.x<o&&e.y>=n&&e.y<s}}class $ extends t.E{constructor(e,i,r,n){if(super(),this.id=e,this.dispatcher=r,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,t.e(this,t.O(i,["url","scheme","tileSize","promoteId"])),this._options=t.e({type:"vector"},i),this._collectResourceTiming=i.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(n)}load(){return t._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new t.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const e=yield V(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),e&&(t.e(this,e),e.bounds&&(this.tileBounds=new G(e.bounds,this.minzoom,this.maxzoom)),this.fire(new t.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new t.l("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this.fire(new t.k(e))}}))}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}setSourceProperty(e){this._tileJSONRequest&&this._tileJSONRequest.abort(),e(),this.load()}setTiles(e){return this.setSourceProperty((()=>{this._options.tiles=e})),this}setUrl(e){return this.setSourceProperty((()=>{this.url=e,this._options.url=e})),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return t.e({},this._options)}loadTile(e){return t._(this,void 0,void 0,(function*(){const t=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),i={request:this.map._requestManager.transformRequest(t,"Tile"),uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};i.request.collectResourceTiming=this._collectResourceTiming;let r="RT";if(e.actor&&"expired"!==e.state){if("loading"===e.state)return new Promise(((t,i)=>{e.reloadPromise={resolve:t,reject:i}}))}else e.actor=this.dispatcher.getActor(),r="LT";e.abortController=new AbortController;try{const t=yield e.actor.sendAsync({type:r,data:i},e.abortController);if(delete e.abortController,e.aborted)return;this._afterTileLoadWorkerResponse(e,t)}catch(t){if(delete e.abortController,e.aborted)return;if(t&&404!==t.status)throw t;this._afterTileLoadWorkerResponse(e,null)}}))}_afterTileLoadWorkerResponse(e,t){if(t&&t.resourceTiming&&(e.resourceTiming=t.resourceTiming),t&&this.map._refreshExpiredTiles&&e.setExpiryData(t),e.loadVectorData(t,this.map.painter),e.reloadPromise){const t=e.reloadPromise;e.reloadPromise=null,this.loadTile(e).then(t.resolve).catch(t.reject)}}abortTile(e){return t._(this,void 0,void 0,(function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.actor&&(yield e.actor.sendAsync({type:"AT",data:{uid:e.uid,type:this.type,source:this.id}}))}))}unloadTile(e){return t._(this,void 0,void 0,(function*(){e.unloadVectorData(),e.actor&&(yield e.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}}))}))}hasTransition(){return!1}}class Z extends t.E{constructor(e,i,r,n){super(),this.id=e,this.dispatcher=r,this.setEventedParent(n),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=t.e({type:"raster"},i),t.e(this,t.O(i,["url","scheme","tileSize"]))}load(){return t._(this,arguments,void 0,(function*(e=!1){this._loaded=!1,this.fire(new t.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const i=yield V(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,i&&(t.e(this,i),i.bounds&&(this.tileBounds=new G(i.bounds,this.minzoom,this.maxzoom)),this.fire(new t.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new t.l("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:e})))}catch(e){this._tileJSONRequest=null,this.fire(new t.k(e))}}))}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(e){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),e(),this.load(!0)}setTiles(e){return this.setSourceProperty((()=>{this._options.tiles=e})),this}setUrl(e){return this.setSourceProperty((()=>{this.url=e,this._options.url=e})),this}serialize(){return t.e({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e){return t._(this,void 0,void 0,(function*(){const t=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);e.abortController=new AbortController;try{const i=yield f.getImage(this.map._requestManager.transformRequest(t,"Tile"),e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(i&&i.data){this.map._refreshExpiredTiles&&i.cacheControl&&i.expires&&e.setExpiryData({cacheControl:i.cacheControl,expires:i.expires});const t=this.map.painter.context,r=t.gl,n=i.data;e.texture=this.map.painter.getTileTexture(n.width),e.texture?e.texture.update(n,{useMipmap:!0}):(e.texture=new _(t,n,r.RGBA,{useMipmap:!0}),e.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE,r.LINEAR_MIPMAP_NEAREST)),e.state="loaded"}}catch(t){if(delete e.abortController,e.aborted)e.state="unloaded";else if(t)throw e.state="errored",t}}))}abortTile(e){return t._(this,void 0,void 0,(function*(){e.abortController&&(e.abortController.abort(),delete e.abortController)}))}unloadTile(e){return t._(this,void 0,void 0,(function*(){e.texture&&this.map.painter.saveTileTexture(e.texture)}))}hasTransition(){return!1}}class q extends Z{constructor(e,i,r,n){super(e,i,r,n),this.type="raster-dem",this.maxzoom=22,this._options=t.e({type:"raster-dem"},i),this.encoding=i.encoding||"mapbox",this.redFactor=i.redFactor,this.greenFactor=i.greenFactor,this.blueFactor=i.blueFactor,this.baseShift=i.baseShift}loadTile(e){return t._(this,void 0,void 0,(function*(){const i=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),r=this.map._requestManager.transformRequest(i,"Tile");e.neighboringTiles=this._getNeighboringTiles(e.tileID),e.abortController=new AbortController;try{const i=yield f.getImage(r,e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(i&&i.data){const r=i.data;this.map._refreshExpiredTiles&&i.cacheControl&&i.expires&&e.setExpiryData({cacheControl:i.cacheControl,expires:i.expires});const n=t.b(r)&&t.V()?r:yield this.readImageNow(r),o={type:this.type,uid:e.uid,source:this.id,rawImageData:n,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!e.actor||"expired"===e.state){e.actor=this.dispatcher.getActor();const t=yield e.actor.sendAsync({type:"LDT",data:o});e.dem=t,e.needsHillshadePrepare=!0,e.needsTerrainPrepare=!0,e.state="loaded"}}}catch(t){if(delete e.abortController,e.aborted)e.state="unloaded";else if(t)throw e.state="errored",t}}))}readImageNow(e){return t._(this,void 0,void 0,(function*(){if("undefined"!=typeof VideoFrame&&t.W()){const i=e.width+2,r=e.height+2;try{return new t.R({width:i,height:r},yield t.X(e,-1,-1,i,r))}catch(e){}}return s.getImageData(e,1)}))}_getNeighboringTiles(e){const i=e.canonical,r=Math.pow(2,i.z),n=(i.x-1+r)%r,o=0===i.x?e.wrap-1:e.wrap,s=(i.x+1+r)%r,a=i.x+1===r?e.wrap+1:e.wrap,l={};return l[new t.Y(e.overscaledZ,o,i.z,n,i.y).key]={backfilled:!1},l[new t.Y(e.overscaledZ,a,i.z,s,i.y).key]={backfilled:!1},i.y>0&&(l[new t.Y(e.overscaledZ,o,i.z,n,i.y-1).key]={backfilled:!1},l[new t.Y(e.overscaledZ,e.wrap,i.z,i.x,i.y-1).key]={backfilled:!1},l[new t.Y(e.overscaledZ,a,i.z,s,i.y-1).key]={backfilled:!1}),i.y+1<r&&(l[new t.Y(e.overscaledZ,o,i.z,n,i.y+1).key]={backfilled:!1},l[new t.Y(e.overscaledZ,e.wrap,i.z,i.x,i.y+1).key]={backfilled:!1},l[new t.Y(e.overscaledZ,a,i.z,s,i.y+1).key]={backfilled:!1}),l}unloadTile(e){return t._(this,void 0,void 0,(function*(){e.demTexture&&this.map.painter.saveTileTexture(e.demTexture),e.fbo&&(e.fbo.destroy(),delete e.fbo),e.dem&&delete e.dem,delete e.neighboringTiles,e.state="unloaded",e.actor&&(yield e.actor.sendAsync({type:"RDT",data:{type:this.type,uid:e.uid,source:this.id}}))}))}}class K extends t.E{constructor(e,i,r,n){super(),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=r.getActor(),this.setEventedParent(n),this._data=i.data,this._options=t.e({},i),this._collectResourceTiming=i.collectResourceTiming,void 0!==i.maxzoom&&(this.maxzoom=i.maxzoom),i.type&&(this.type=i.type),i.attribution&&(this.attribution=i.attribution),this.promoteId=i.promoteId,void 0!==i.clusterMaxZoom&&this.maxzoom<=i.clusterMaxZoom&&t.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${i.clusterMaxZoom}".`),this.workerOptions=t.e({source:this.id,cluster:i.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(void 0!==i.buffer?i.buffer:128),tolerance:this._pixelsToTileUnits(void 0!==i.tolerance?i.tolerance:.375),extent:t.Z,maxZoom:this.maxzoom,lineMetrics:i.lineMetrics||!1,generateId:i.generateId||!1},superclusterOptions:{maxZoom:void 0!==i.clusterMaxZoom?i.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,i.clusterMinPoints||2),extent:t.Z,radius:this._pixelsToTileUnits(i.clusterRadius||50),log:!1,generateId:i.generateId||!1},clusterProperties:i.clusterProperties,filter:i.filter},i.workerOptions),"string"==typeof this.promoteId&&(this.workerOptions.promoteId=this.promoteId)}_pixelsToTileUnits(e){return e*(t.Z/this.tileSize)}load(){return t._(this,void 0,void 0,(function*(){yield this._updateWorkerData()}))}onAdd(e){this.map=e,this.load()}setData(e){return this._data=e,this._updateWorkerData(),this}updateData(e){return this._updateWorkerData(e),this}getData(){return t._(this,void 0,void 0,(function*(){const e=t.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:e})}))}getCoordinatesFromGeometry(e){return"GeometryCollection"===e.type?e.geometries.map((e=>e.coordinates)).flat(1/0):e.coordinates.flat(1/0)}getBounds(){return t._(this,void 0,void 0,(function*(){const e=new H,t=yield this.getData();let i;switch(t.type){case"FeatureCollection":i=t.features.map((e=>this.getCoordinatesFromGeometry(e.geometry))).flat(1/0);break;case"Feature":i=this.getCoordinatesFromGeometry(t.geometry);break;default:i=this.getCoordinatesFromGeometry(t)}if(0==i.length)return e;for(let t=0;t<i.length-1;t+=2)e.extend([i[t],i[t+1]]);return e}))}setClusterOptions(e){return this.workerOptions.cluster=e.cluster,e&&(void 0!==e.clusterRadius&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(e.clusterRadius)),void 0!==e.clusterMaxZoom&&(this.workerOptions.superclusterOptions.maxZoom=e.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(e){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:e,source:this.id}})}getClusterChildren(e){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:e,source:this.id}})}getClusterLeaves(e,t,i){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:e,limit:t,offset:i}})}_updateWorkerData(e){return t._(this,void 0,void 0,(function*(){const i=t.e({type:this.type},this.workerOptions);e?i.dataDiff=e:"string"==typeof this._data?(i.request=this.map._requestManager.transformRequest(s.resolveURL(this._data),"Source"),i.request.collectResourceTiming=this._collectResourceTiming):i.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new t.l("dataloading",{dataType:"source"}));try{const e=yield this.actor.sendAsync({type:"LD",data:i});if(this._pendingLoads--,this._removed||e.abandoned)return void this.fire(new t.l("dataabort",{dataType:"source"}));let r=null;e.resourceTiming&&e.resourceTiming[this.id]&&(r=e.resourceTiming[this.id].slice(0));const n={dataType:"source"};this._collectResourceTiming&&r&&r.length>0&&t.e(n,{resourceTiming:r}),this.fire(new t.l("data",Object.assign(Object.assign({},n),{sourceDataType:"metadata"}))),this.fire(new t.l("data",Object.assign(Object.assign({},n),{sourceDataType:"content"})))}catch(e){if(this._pendingLoads--,this._removed)return void this.fire(new t.l("dataabort",{dataType:"source"}));this.fire(new t.k(e))}}))}loaded(){return 0===this._pendingLoads}loadTile(e){return t._(this,void 0,void 0,(function*(){const t=e.actor?"RT":"LT";e.actor=this.actor;const i={type:this.type,uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};e.abortController=new AbortController;const r=yield this.actor.sendAsync({type:t,data:i},e.abortController);delete e.abortController,e.unloadVectorData(),e.aborted||e.loadVectorData(r,this.map.painter,"RT"===t)}))}abortTile(e){return t._(this,void 0,void 0,(function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.aborted=!0}))}unloadTile(e){return t._(this,void 0,void 0,(function*(){e.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}})}))}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return t.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}class W extends t.E{constructor(e,t,i,r){super(),this.flippedWindingOrder=!1,this.id=e,this.dispatcher=i,this.coordinates=t.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(r),this.options=t}load(e){return t._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new t.l("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const t=yield f.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,t&&t.data&&(this.image=t.data,e&&(this.coordinates=e),this._finishLoading())}catch(e){this._request=null,this._loaded=!0,this.fire(new t.k(e))}}))}loaded(){return this._loaded}updateImage(e){return e.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=e.url,this.load(e.coordinates).finally((()=>{this.texture=null})),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new t.l("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(e){this.coordinates=e;const i=e.map(t.$.fromLngLat);var r;return this.tileID=function(e){let i=1/0,r=1/0,n=-1/0,o=-1/0;for(const t of e)i=Math.min(i,t.x),r=Math.min(r,t.y),n=Math.max(n,t.x),o=Math.max(o,t.y);const s=Math.max(n-i,o-r),a=Math.max(0,Math.floor(-Math.log(s)/Math.LN2)),l=Math.pow(2,a);return new t.a1(a,Math.floor((i+n)/2*l),Math.floor((r+o)/2*l))}(i),this.terrainTileRanges=this._getOverlappingTileRanges(i),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=i.map((e=>this.tileID.getTilePoint(e)._round())),this.flippedWindingOrder=((r=this.tileCoords)[1].x-r[0].x)*(r[2].y-r[0].y)-(r[1].y-r[0].y)*(r[2].x-r[0].x)<0,this.fire(new t.l("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const e=this.map.painter.context,i=e.gl;this.texture||(this.texture=new _(e,this.image,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE));let r=!1;for(const e in this.tiles){const t=this.tiles[e];"loaded"!==t.state&&(t.state="loaded",t.texture=this.texture,r=!0)}r&&this.fire(new t.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(e){return t._(this,void 0,void 0,(function*(){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={}):e.state="errored"}))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}_getOverlappingTileRanges(e){let i=1/0,r=1/0,n=-1/0,o=-1/0;for(const t of e)i=Math.min(i,t.x),r=Math.min(r,t.y),n=Math.max(n,t.x),o=Math.max(o,t.y);const s={};for(let e=0;e<=t.a0;e++){const t=Math.pow(2,e),a=Math.floor(i*t),l=Math.floor(r*t),c=Math.floor(n*t),u=Math.floor(o*t);s[e]={minTileX:a,minTileY:l,maxTileX:c,maxTileY:u}}return s}}class X extends W{constructor(e,t,i,r){super(e,t,i,r),this.roundZoom=!0,this.type="video",this.options=t}load(){return t._(this,void 0,void 0,(function*(){this._loaded=!1;const e=this.options;this.urls=[];for(const t of e.urls)this.urls.push(this.map._requestManager.transformRequest(t,"Source").url);try{const e=yield t.a2(this.urls);if(this._loaded=!0,!e)return;this.video=e,this.video.loop=!0,this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading()}catch(e){this.fire(new t.k(e))}}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){const i=this.video.seekable;e<i.start(0)||e>i.end(0)?this.fire(new t.k(new t.a3(`sources.${this.id}`,null,`Playback for this video can be set only between the ${i.start(0)} and ${i.end(0)}-second mark.`))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const e=this.map.painter.context,i=e.gl;this.texture?this.video.paused||(this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),i.texSubImage2D(i.TEXTURE_2D,0,0,0,i.RGBA,i.UNSIGNED_BYTE,this.video)):(this.texture=new _(e,this.video,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE));let r=!1;for(const e in this.tiles){const t=this.tiles[e];"loaded"!==t.state&&(t.state="loaded",t.texture=this.texture,r=!0)}r&&this.fire(new t.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class Y extends W{constructor(e,i,r,n){super(e,i,r,n),i.coordinates?Array.isArray(i.coordinates)&&4===i.coordinates.length&&!i.coordinates.some((e=>!Array.isArray(e)||2!==e.length||e.some((e=>"number"!=typeof e))))||this.fire(new t.k(new t.a3(`sources.${e}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new t.k(new t.a3(`sources.${e}`,null,'missing required property "coordinates"'))),i.animate&&"boolean"!=typeof i.animate&&this.fire(new t.k(new t.a3(`sources.${e}`,null,'optional "animate" property must be a boolean value'))),i.canvas?"string"==typeof i.canvas||i.canvas instanceof HTMLCanvasElement||this.fire(new t.k(new t.a3(`sources.${e}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new t.k(new t.a3(`sources.${e}`,null,'missing required property "canvas"'))),this.options=i,this.animate=void 0===i.animate||i.animate}load(){return t._(this,void 0,void 0,(function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new t.k(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}))}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions())return;if(0===Object.keys(this.tiles).length)return;const i=this.map.painter.context,r=i.gl;this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new _(i,this.canvas,r.RGBA,{premultiply:!0});let n=!1;for(const e in this.tiles){const t=this.tiles[e];"loaded"!==t.state&&(t.state="loaded",t.texture=this.texture,n=!0)}n&&this.fire(new t.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}}const J={},ee=e=>{switch(e){case"geojson":return K;case"image":return W;case"raster":return Z;case"raster-dem":return q;case"vector":return $;case"video":return X;case"canvas":return Y}return J[e]},te="RTLPluginLoaded";class ie extends t.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=O()}_syncState(e){return this.status=e,this.dispatcher.broadcast("SRPS",{pluginStatus:e,pluginURL:this.url}).catch((e=>{throw this.status="error",e}))}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(e){return t._(this,arguments,void 0,(function*(e,t=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=s.resolveURL(e),!this.url)throw new Error(`requested url ${e} is invalid`);if("unavailable"===this.status){if(!t)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if("requested"===this.status)return this._requestImport()}))}_requestImport(){return t._(this,void 0,void 0,(function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new t.l(te))}))}lazyLoad(){"unavailable"===this.status?this.status="requested":"deferred"===this.status&&this._requestImport()}}let re=null;function ne(){return re||(re=new ie),re}class oe{constructor(e,i){this.timeAdded=0,this.fadeEndTime=0,this.tileID=e,this.uid=t.a4(),this.uses=0,this.tileSize=i,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(e){const t=e+this.timeAdded;t<this.fadeEndTime||(this.fadeEndTime=t)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}clearTextures(e){this.demTexture&&e.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(e,i,r){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(e,t){const i={};if(!t)return i;for(const r of e){const e=r.layerIds.map((e=>t.getLayer(e))).filter(Boolean);if(0!==e.length){r.layers=e,r.stateDependentLayerIds&&(r.stateDependentLayers=r.stateDependentLayerIds.map((t=>e.filter((e=>e.id===t))[0])));for(const t of e)i[t.id]=r}}return i}(e.buckets,null==i?void 0:i.style),this.hasSymbolBuckets=!1;for(const e in this.buckets){const i=this.buckets[e];if(i instanceof t.a6){if(this.hasSymbolBuckets=!0,!r)break;i.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const e in this.buckets){const i=this.buckets[e];if(i instanceof t.a6&&i.hasRTLText){this.hasRTLText=!0,ne().lazyLoad();break}}this.queryPadding=0;for(const e in this.buckets){const t=this.buckets[e];this.queryPadding=Math.max(this.queryPadding,i.style.getLayer(e).queryRadius(t))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage)}else this.collisionBoxArray=new t.a5}unloadVectorData(){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(e){return this.buckets[e.id]}upload(e){for(const t in this.buckets){const i=this.buckets[t];i.uploadPending()&&i.upload(e)}const t=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new _(e,this.imageAtlas.image,t.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new _(e,this.glyphAtlasImage,t.ALPHA),this.glyphAtlasImage=null)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,t,i,r,n,o,s,a,l,c,u){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:r,cameraQueryGeometry:n,scale:o,tileSize:this.tileSize,pixelPosMatrix:c,transform:a,params:s,queryPadding:this.queryPadding*l,getElevation:u},e,t,i):{}}querySourceFeatures(e,i){const r=this.latestFeatureIndex;if(!r||!r.rawTileData)return;const n=r.loadVTLayers(),o=i&&i.sourceLayer?i.sourceLayer:"",s=n._geojsonTileLayer||n[o];if(!s)return;const a=t.a7(i&&i.filter),{z:l,x:c,y:u}=this.tileID.canonical,h={z:l,x:c,y:u};for(let i=0;i<s.length;i++){const n=s.feature(i);if(a.needGeometry){const e=t.a8(n,!0);if(!a.filter(new t.C(this.tileID.overscaledZ),e,this.tileID.canonical))continue}else if(!a.filter(new t.C(this.tileID.overscaledZ),n))continue;const d=r.getId(n,o),p=new t.a9(n,l,c,u,d);p.tile=h,e.push(p)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const i=this.expirationTime;if(e.cacheControl){const i=t.aa(e.cacheControl);i["max-age"]&&(this.expirationTime=Date.now()+1e3*i["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const e=Date.now();let t=!1;if(this.expirationTime>e)t=!1;else if(i)if(this.expirationTime<i)t=!0;else{const r=this.expirationTime-i;r?this.expirationTime=e+Math.max(r,3e4):t=!0}else t=!0;t?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(e,t){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(e).length)return;const i=this.latestFeatureIndex.loadVTLayers();for(const r in this.buckets){if(!t.style.hasLayer(r))continue;const n=this.buckets[r],o=n.layers[0].sourceLayer||"_geojsonTileLayer",s=i[o],a=e[o];if(!s||!a||0===Object.keys(a).length)continue;n.update(a,s,this.imageAtlas&&this.imageAtlas.patternPositions||{});const l=t&&t.style&&t.style.getLayer(r);l&&(this.queryPadding=Math.max(this.queryPadding,l.queryRadius(n)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<s.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=s.now()+e}setDependencies(e,t){const i={};for(const e of t)i[e]=!0;this.dependencies[e]=i}hasDependency(e,t){for(const i of e){const e=this.dependencies[i];if(e)for(const i of t)if(e[i])return!0}return!1}}class se{constructor(e,t){this.max=e,this.onRemove=t,this.reset()}reset(){for(const e in this.data)for(const t of this.data[e])t.timeout&&clearTimeout(t.timeout),this.onRemove(t.value);return this.data={},this.order=[],this}add(e,t,i){const r=e.wrapped().key;void 0===this.data[r]&&(this.data[r]=[]);const n={value:t,timeout:void 0};if(void 0!==i&&(n.timeout=setTimeout((()=>{this.remove(e,n)}),i)),this.data[r].push(n),this.order.push(r),this.order.length>this.max){const e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const t=this.data[e].shift();return t.timeout&&clearTimeout(t.timeout),0===this.data[e].length&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),t.value}getByKey(e){const t=this.data[e];return t?t[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,t){if(!this.has(e))return this;const i=e.wrapped().key,r=void 0===t?0:this.data[i].indexOf(t),n=this.data[i][r];return this.data[i].splice(r,1),n.timeout&&clearTimeout(n.timeout),0===this.data[i].length&&delete this.data[i],this.onRemove(n.value),this.order.splice(this.order.indexOf(i),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e)}return this}filter(e){const t=[];for(const i in this.data)for(const r of this.data[i])e(r.value)||t.push(r);for(const e of t)this.remove(e.value.tileID,e)}}class ae{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,i,r){const n=String(i);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][n]=this.stateChanges[e][n]||{},t.e(this.stateChanges[e][n],r),null===this.deletedStates[e]){this.deletedStates[e]={};for(const t in this.state[e])t!==n&&(this.deletedStates[e][t]=null)}else if(this.deletedStates[e]&&null===this.deletedStates[e][n]){this.deletedStates[e][n]={};for(const t in this.state[e][n])r[t]||(this.deletedStates[e][n][t]=null)}else for(const t in r)this.deletedStates[e]&&this.deletedStates[e][n]&&null===this.deletedStates[e][n][t]&&delete this.deletedStates[e][n][t]}removeFeatureState(e,t,i){if(null===this.deletedStates[e])return;const r=String(t);if(this.deletedStates[e]=this.deletedStates[e]||{},i&&void 0!==t)null!==this.deletedStates[e][r]&&(this.deletedStates[e][r]=this.deletedStates[e][r]||{},this.deletedStates[e][r][i]=null);else if(void 0!==t)if(this.stateChanges[e]&&this.stateChanges[e][r])for(i in this.deletedStates[e][r]={},this.stateChanges[e][r])this.deletedStates[e][r][i]=null;else this.deletedStates[e][r]=null;else this.deletedStates[e]=null}getState(e,i){const r=String(i),n=t.e({},(this.state[e]||{})[r],(this.stateChanges[e]||{})[r]);if(null===this.deletedStates[e])return{};if(this.deletedStates[e]){const t=this.deletedStates[e][i];if(null===t)return{};for(const e in t)delete n[e]}return n}initializeTileState(e,t){e.setFeatureState(this.state,t)}coalesceChanges(e,i){const r={};for(const e in this.stateChanges){this.state[e]=this.state[e]||{};const i={};for(const r in this.stateChanges[e])this.state[e][r]||(this.state[e][r]={}),t.e(this.state[e][r],this.stateChanges[e][r]),i[r]=this.state[e][r];r[e]=i}for(const e in this.deletedStates){this.state[e]=this.state[e]||{};const i={};if(null===this.deletedStates[e])for(const t in this.state[e])i[t]={},this.state[e][t]={};else for(const t in this.deletedStates[e]){if(null===this.deletedStates[e][t])this.state[e][t]={};else for(const i of Object.keys(this.deletedStates[e][t]))delete this.state[e][t][i];i[t]=this.state[e][t]}r[e]=r[e]||{},t.e(r[e],i)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(r).length)for(const t in e)e[t].setFeatureState(r,i)}}const le=89.25;function ce(e,i){const r=t.ae(i.lat,-85.051129,t.af);return new t.P(t.U(i.lng)*e,t.S(r)*e)}function ue(e,i){return new t.$(i.x/e,i.y/e).toLngLat()}function he(e){return e.cameraToCenterDistance*Math.min(.85*Math.tan(t.ab(90-e.pitch)),Math.tan(t.ab(le-e.pitch)))}function de(e,i){const r=e.canonical,n=i/t.ac(r.z),o=r.x+Math.pow(2,r.z)*e.wrap,s=t.ad(new Float64Array(16));return t.L(s,s,[o*n,r.y*n,0]),t.M(s,s,[n/t.Z,n/t.Z,1]),s}function pe(e,i,r,n,o){const s=t.$.fromLngLat(e,i),a=o*t.ag(1,e.lat),l=a*Math.cos(t.ab(r)),c=Math.sqrt(a*a-l*l),u=c*Math.sin(t.ab(-n)),h=c*Math.cos(t.ab(-n));return new t.$(s.x+u,s.y+h,s.z+l)}function fe(e,t,i){const r=t.intersectsFrustum(e);if(!i)return r;const n=t.intersectsPlane(i);return 0===r||0===n?0:2===r&&2===n?2:1}function Ae(e,t,i){let r=0;const n=(i-t)/10;for(let o=0;o<10;o++)r+=n*Math.pow(Math.cos(t+(o+.5)/10*(i-t)),e);return r}function me(e,i){return function(r,n,o,s,a){const l=2*((e-1)/t.ah(Math.cos(t.ab(le-a))/Math.cos(t.ab(le)))-1),c=Math.acos(o/s),u=2*Ae(l-1,0,t.ab(a/2)),h=Math.min(t.ab(le),c+t.ab(a/2)),d=Ae(l-1,Math.min(h,c-t.ab(a/2)),h),p=Math.atan(n/o),f=Math.hypot(n,o);let A=r;return A+=t.ah(s/f/Math.max(.5,Math.cos(t.ab(a/2)))),A+=l*t.ah(Math.cos(p))/2,A-=t.ah(Math.max(1,d/u/i))/2,A}}const ge=me(9.314,3);function _e(e,i){const r=(i.roundZoom?Math.round:Math.floor)(e.zoom+t.ah(e.tileSize/i.tileSize));return Math.max(0,r)}function ye(e,i){const r=e.getCameraFrustum(),n=e.getClippingPlane(),o=e.screenPointToMercatorCoordinate(e.getCameraPoint()),s=t.$.fromLngLat(e.center,e.elevation);o.z=s.z+Math.cos(e.pitchInRadians)*e.cameraToCenterDistance/e.worldSize;const a=e.getCoveringTilesDetailsProvider(),l=a.allowVariableZoom(e,i),c=_e(e,i),u=i.minzoom||0,h=void 0!==i.maxzoom?i.maxzoom:e.maxZoom,d=Math.min(Math.max(0,c),h),p=Math.pow(2,d),f=[p*o.x,p*o.y,0],A=[p*s.x,p*s.y,0],m=Math.hypot(s.x-o.x,s.y-o.y),g=Math.abs(s.z-o.z),_=Math.hypot(m,g),y=e=>({zoom:0,x:0,y:0,wrap:e,fullyVisible:!1}),v=[],x=[];if(e.renderWorldCopies&&a.allowWorldCopies())for(let e=1;e<=3;e++)v.push(y(-e)),v.push(y(e));for(v.push(y(0));v.length>0;){const p=v.pop(),m=p.x,y=p.y;let b=p.fullyVisible;const w={x:m,y:y,z:p.zoom},T=a.getTileAABB(w,p.wrap,e.elevation,i);if(!b){const e=fe(r,T,n);if(0===e)continue;b=2===e}const B=a.distanceToTile2d(o.x,o.y,w,T);let C=c;l&&(C=(i.calculateTileZoom||ge)(e.zoom+t.ah(e.tileSize/i.tileSize),B,g,_,e.fov)),C=(i.roundZoom?Math.round:Math.floor)(C),C=Math.max(0,C);const S=Math.min(C,h);if(p.wrap=a.getWrap(s,w,p.wrap),p.zoom>=S){if(p.zoom<u)continue;const e=d-p.zoom,r=f[0]-.5-(m<<e),n=f[1]-.5-(y<<e),o=i.reparseOverscaled?Math.max(p.zoom,C):p.zoom;x.push({tileID:new t.Y(p.zoom===h?o:p.zoom,p.wrap,p.zoom,m,y),distanceSq:t.ai([A[0]-.5-m,A[1]-.5-y]),tileDistanceToCamera:Math.sqrt(r*r+n*n)})}else for(let e=0;e<4;e++)v.push({zoom:p.zoom+1,x:(m<<1)+e%2,y:(y<<1)+(e>>1),wrap:p.wrap,fullyVisible:b})}return x.sort(((e,t)=>e.distanceSq-t.distanceSq)).map((e=>e.tileID))}class ve extends t.E{constructor(e,t,i){super(),this.id=e,this.dispatcher=i,this.on("data",(e=>this._dataHandler(e))),this.on("dataloading",(()=>{this._sourceErrored=!1})),this.on("error",(()=>{this._sourceErrored=this._source.loaded()})),this._source=((e,t,i,r)=>{const n=new(ee(t.type))(e,t,i,r);if(n.id!==e)throw new Error(`Expected Source id to be ${e} instead of ${n.id}`);return n})(e,t,i,this),this._tiles={},this._cache=new se(0,(e=>this._unloadTile(e))),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new ae,this._didEmitContent=!1,this._updated=!1}onAdd(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null,this._maxTileCacheZoomLevels=e?e._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(e)}onRemove(e){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(e)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded)return!1;if(!this._source.loaded())return!1;if(!(void 0===this.used&&void 0===this.usedForTerrain||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const e in this._tiles){const t=this._tiles[e];if("loaded"!==t.state&&"errored"!==t.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(e,i,r){return t._(this,void 0,void 0,(function*(){try{yield this._source.loadTile(e),this._tileLoaded(e,i,r)}catch(i){e.state="errored",404!==i.status?this._source.fire(new t.k(i,{tile:e})):this.update(this.transform,this.terrain)}}))}_unloadTile(e){this._source.unloadTile&&this._source.unloadTile(e)}_abortTile(e){this._source.abortTile&&this._source.abortTile(e),this._source.fire(new t.l("dataabort",{tile:e,coord:e.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const t in this._tiles){const i=this._tiles[t];i.upload(e),i.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map((e=>e.tileID)).sort(xe).map((e=>e.key))}getRenderableIds(e){const i=[];for(const t in this._tiles)this._isIdRenderable(t,e)&&i.push(this._tiles[t]);return e?i.sort(((e,i)=>{const r=e.tileID,n=i.tileID,o=new t.P(r.canonical.x,r.canonical.y)._rotate(-this.transform.bearingInRadians),s=new t.P(n.canonical.x,n.canonical.y)._rotate(-this.transform.bearingInRadians);return r.overscaledZ-n.overscaledZ||s.y-o.y||s.x-o.x})).map((e=>e.tileID.key)):i.map((e=>e.tileID)).sort(xe).map((e=>e.key))}hasRenderableParent(e){const t=this.findLoadedParent(e,0);return!!t&&this._isIdRenderable(t.tileID.key)}_isIdRenderable(e,t){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(t||!this._tiles[e].holdingForFade())}reload(e){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)(e||"errored"!==this._tiles[t].state)&&this._reloadTile(t,"reloading")}}_reloadTile(e,i){return t._(this,void 0,void 0,(function*(){const t=this._tiles[e];t&&("loading"!==t.state&&(t.state=i),yield this._loadTile(t,e,i))}))}_tileLoaded(e,i,r){e.timeAdded=s.now(),"expired"===r&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(i,e),"raster-dem"===this.getSource().type&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),e.aborted||this._source.fire(new t.l("data",{dataType:"source",tile:e,coord:e.tileID}))}_backfillDEM(e){const t=this.getRenderableIds();for(let r=0;r<t.length;r++){const n=t[r];if(e.neighboringTiles&&e.neighboringTiles[n]){const t=this.getTileByID(n);i(e,t),i(t,e)}}function i(e,t){e.needsHillshadePrepare=!0,e.needsTerrainPrepare=!0;let i=t.tileID.canonical.x-e.tileID.canonical.x;const r=t.tileID.canonical.y-e.tileID.canonical.y,n=Math.pow(2,e.tileID.canonical.z),o=t.tileID.key;0===i&&0===r||Math.abs(r)>1||(Math.abs(i)>1&&(1===Math.abs(i+n)?i+=n:1===Math.abs(i-n)&&(i-=n)),t.dem&&e.dem&&(e.dem.backfillBorder(t.dem,i,r),e.neighboringTiles&&e.neighboringTiles[o]&&(e.neighboringTiles[o].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,t,i,r){for(const n in this._tiles){let o=this._tiles[n];if(r[n]||!o.hasData()||o.tileID.overscaledZ<=t||o.tileID.overscaledZ>i)continue;let s=o.tileID;for(;o&&o.tileID.overscaledZ>t+1;){const e=o.tileID.scaledTo(o.tileID.overscaledZ-1);o=this._tiles[e.key],o&&o.hasData()&&(s=e)}let a=s;for(;a.overscaledZ>t;)if(a=a.scaledTo(a.overscaledZ-1),e[a.key]||e[a.canonical.key]){r[s.key]=s;break}}}findLoadedParent(e,t){if(e.key in this._loadedParentTiles){const i=this._loadedParentTiles[e.key];return i&&i.tileID.overscaledZ>=t?i:null}for(let i=e.overscaledZ-1;i>=t;i--){const t=e.scaledTo(i),r=this._getLoadedTile(t);if(r)return r}}findLoadedSibling(e){return this._getLoadedTile(e)}_getLoadedTile(e){const t=this._tiles[e.key];return t&&t.hasData()?t:this._cache.getByKey(e.wrapped().key)}updateCacheSize(e){const i=Math.ceil(e.width/this._source.tileSize)+1,r=Math.ceil(e.height/this._source.tileSize)+1,n=Math.floor(i*r*(null===this._maxTileCacheZoomLevels?t.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),o="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,n):n;this._cache.setMaxSize(o)}handleWrapJump(e){const t=Math.round((e-(void 0===this._prevLng?e:this._prevLng))/360);if(this._prevLng=e,t){const e={};for(const i in this._tiles){const r=this._tiles[i];r.tileID=r.tileID.unwrapTo(r.tileID.wrap+t),e[r.tileID.key]=r}this._tiles=e;for(const e in this._timers)clearTimeout(this._timers[e]),delete this._timers[e];for(const e in this._tiles)this._setTileReloadTimer(e,this._tiles[e])}}_updateCoveredAndRetainedTiles(e,t,i,r,n,o){const a={},l={},c=Object.keys(e),u=s.now();for(const i of c){const r=e[i],n=this._tiles[i];if(!n||0!==n.fadeEndTime&&n.fadeEndTime<=u)continue;const o=this.findLoadedParent(r,t),s=this.findLoadedSibling(r),c=o||s||null;c&&(this._addTile(c.tileID),a[c.tileID.key]=c.tileID),l[i]=r}this._retainLoadedChildren(l,r,i,e);for(const t in a)e[t]||(this._coveredTiles[t]=!0,e[t]=a[t]);if(o){const t={},i={};for(const e of n)this._tiles[e.key].hasData()?t[e.key]=e:i[e.key]=e;for(const r in i){const n=i[r].children(this._source.maxzoom);this._tiles[n[0].key]&&this._tiles[n[1].key]&&this._tiles[n[2].key]&&this._tiles[n[3].key]&&(t[n[0].key]=e[n[0].key]=n[0],t[n[1].key]=e[n[1].key]=n[1],t[n[2].key]=e[n[2].key]=n[2],t[n[3].key]=e[n[3].key]=n[3],delete i[r])}for(const r in i){const n=i[r],o=this.findLoadedParent(n,this._source.minzoom),s=this.findLoadedSibling(n),a=o||s||null;if(a){t[a.tileID.key]=e[a.tileID.key]=a.tileID;for(const e in t)t[e].isChildOf(a.tileID)&&delete t[e]}}for(const e in this._tiles)t[e]||(this._coveredTiles[e]=!0)}}update(e,i){if(!this._sourceLoaded||this._paused)return;let r;this.transform=e,this.terrain=i,this.updateCacheSize(e),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?r=e.getVisibleUnwrappedCoordinates(this._source.tileID).map((e=>new t.Y(e.canonical.z,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y))):(r=ye(e,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:i,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(r=r.filter((e=>this._source.hasTile(e))))):r=[];const n=_e(e,this._source),o=Math.max(n-ve.maxOverzooming,this._source.minzoom),s=Math.max(n+ve.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const e={};for(const t of r)if(t.canonical.z>this._source.minzoom){const i=t.scaledTo(t.canonical.z-1);e[i.key]=i;const r=t.scaledTo(Math.max(this._source.minzoom,Math.min(t.canonical.z,5)));e[r.key]=r}r=r.concat(Object.values(e))}const a=0===r.length&&!this._updated&&this._didEmitContent;this._updated=!0,a&&this.fire(new t.l("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const l=this._updateRetainedTiles(r,n);be(this._source.type)&&this._updateCoveredAndRetainedTiles(l,o,s,n,r,i);for(const e in l)this._tiles[e].clearFadeHold();const c=t.aj(this._tiles,l);for(const e of c){const t=this._tiles[e];t.hasSymbolBuckets&&!t.holdingForFade()?t.setHoldDuration(this.map._fadeDuration):t.hasSymbolBuckets&&!t.symbolFadeFinished()||this._removeTile(e)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(e)}_updateRetainedTiles(e,t){var i;const r={},n={},o=Math.max(t-ve.maxOverzooming,this._source.minzoom),s=Math.max(t+ve.maxUnderzooming,this._source.minzoom),a={};for(const i of e){const e=this._addTile(i);r[i.key]=i,e.hasData()||t<this._source.maxzoom&&(a[i.key]=i)}this._retainLoadedChildren(a,t,s,r);for(const s of e){let e=this._tiles[s.key];if(e.hasData())continue;if(t+1>this._source.maxzoom){const e=s.children(this._source.maxzoom)[0],t=this.getTile(e);if(t&&t.hasData()){r[e.key]=e;continue}}else{const e=s.children(this._source.maxzoom);if(r[e[0].key]&&r[e[1].key]&&r[e[2].key]&&r[e[3].key])continue}let a=e.wasRequested();for(let t=s.overscaledZ-1;t>=o;--t){const o=s.scaledTo(t);if(n[o.key])break;if(n[o.key]=!0,e=this.getTile(o),!e&&a&&(e=this._addTile(o)),e){const t=e.hasData();if((t||!(null===(i=this.map)||void 0===i?void 0:i.cancelPendingTileRequestsWhileZooming)||a)&&(r[o.key]=o),a=e.wasRequested(),t)break}}}return r}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const t=[];let i,r=this._tiles[e].tileID;for(;r.overscaledZ>0;){if(r.key in this._loadedParentTiles){i=this._loadedParentTiles[r.key];break}t.push(r.key);const e=r.scaledTo(r.overscaledZ-1);if(i=this._getLoadedTile(e),i)break;r=e}for(const e of t)this._loadedParentTiles[e]=i}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const e in this._tiles){const t=this._tiles[e].tileID,i=this._getLoadedTile(t);this._loadedSiblingTiles[t.key]=i}}_addTile(e){let i=this._tiles[e.key];if(i)return i;i=this._cache.getAndRemove(e),i&&(this._setTileReloadTimer(e.key,i),i.tileID=e,this._state.initializeTileState(i,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,i)));const r=i;return i||(i=new oe(e,this._source.tileSize*e.overscaleFactor()),this._loadTile(i,e.key,i.state)),i.uses++,this._tiles[e.key]=i,r||this._source.fire(new t.l("dataloading",{tile:i,coord:i.tileID,dataType:"source"})),i}_setTileReloadTimer(e,t){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const i=t.getExpiryTimeout();i&&(this._timers[e]=setTimeout((()=>{this._reloadTile(e,"expired"),delete this._timers[e]}),i))}_removeTile(e){const t=this._tiles[e];t&&(t.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),t.uses>0||(t.hasData()&&"reloading"!==t.state?this._cache.add(t.tileID,t,t.getExpiryTimeout()):(t.aborted=!0,this._abortTile(t),this._unloadTile(t))))}_dataHandler(e){const t=e.sourceDataType;"source"===e.dataType&&"metadata"===t&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===e.dataType&&"content"===t&&(this.reload(e.sourceDataChanged),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(e);this._cache.reset()}tilesIn(e,i,r){const n=[],o=this.transform;if(!o)return n;const s=r?o.getCameraQueryGeometry(e):e,a=e.map((e=>o.screenPointToMercatorCoordinate(e,this.terrain))),l=s.map((e=>o.screenPointToMercatorCoordinate(e,this.terrain))),c=this.getIds();let u=1/0,h=1/0,d=-1/0,p=-1/0;for(const e of l)u=Math.min(u,e.x),h=Math.min(h,e.y),d=Math.max(d,e.x),p=Math.max(p,e.y);for(let e=0;e<c.length;e++){const r=this._tiles[c[e]];if(r.holdingForFade())continue;const s=o.getCoveringTilesDetailsProvider().allowWorldCopies()?r.tileID:r.tileID.unwrapTo(0),f=Math.pow(2,o.zoom-r.tileID.overscaledZ),A=i*r.queryPadding*t.Z/r.tileSize/f,m=[s.getTilePoint(new t.$(u,h)),s.getTilePoint(new t.$(d,p))];if(m[0].x-A<t.Z&&m[0].y-A<t.Z&&m[1].x+A>=0&&m[1].y+A>=0){const e=a.map((e=>s.getTilePoint(e))),t=l.map((e=>s.getTilePoint(e)));n.push({tile:r,tileID:s,queryGeometry:e,cameraQueryGeometry:t,scale:f})}}return n}getVisibleCoordinates(e){const t=this.getRenderableIds(e).map((e=>this._tiles[e].tileID));return this.transform&&this.transform.populateCache(t),t}hasTransition(){if(this._source.hasTransition())return!0;if(be(this._source.type)){const e=s.now();for(const t in this._tiles)if(this._tiles[t].fadeEndTime>=e)return!0}return!1}setFeatureState(e,t,i){this._state.updateState(e=e||"_geojsonTileLayer",t,i)}removeFeatureState(e,t,i){this._state.removeFeatureState(e=e||"_geojsonTileLayer",t,i)}getFeatureState(e,t){return this._state.getState(e=e||"_geojsonTileLayer",t)}setDependencies(e,t,i){const r=this._tiles[e];r&&r.setDependencies(t,i)}reloadTilesForDependencies(e,t){for(const i in this._tiles)this._tiles[i].hasDependency(e,t)&&this._reloadTile(i,"reloading");this._cache.filter((i=>!i.hasDependency(e,t)))}}function xe(e,t){const i=Math.abs(2*e.wrap)-+(e.wrap<0),r=Math.abs(2*t.wrap)-+(t.wrap<0);return e.overscaledZ-t.overscaledZ||r-i||t.canonical.y-e.canonical.y||t.canonical.x-e.canonical.x}function be(e){return"raster"===e||"image"===e||"video"===e}ve.maxOverzooming=10,ve.maxUnderzooming=3;class we{constructor(e,t){this.reset(e,t)}reset(e,t){this.points=e||[],this._distances=[0];for(let e=1;e<this.points.length;e++)this._distances[e]=this._distances[e-1]+this.points[e].dist(this.points[e-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(t||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(1===this.points.length)return this.points[0];e=t.ae(e,0,1);let i=1,r=this._distances[i];const n=e*this.paddedLength+this.padding;for(;r<n&&i<this._distances.length;)r=this._distances[++i];const o=i-1,s=this._distances[o],a=r-s,l=a>0?(n-s)/a:0;return this.points[o].mult(1-l).add(this.points[i].mult(l))}}function Te(e,t){let i=!0;return"always"===e||"never"!==e&&"never"!==t||(i=!1),i}class Be{constructor(e,t,i){const r=this.boxCells=[],n=this.circleCells=[];this.xCellCount=Math.ceil(e/i),this.yCellCount=Math.ceil(t/i);for(let e=0;e<this.xCellCount*this.yCellCount;e++)r.push([]),n.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=t,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/t,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,t,i,r,n){this._forEachCell(t,i,r,n,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(t),this.bboxes.push(i),this.bboxes.push(r),this.bboxes.push(n)}insertCircle(e,t,i,r){this._forEachCell(t-r,i-r,t+r,i+r,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(t),this.circles.push(i),this.circles.push(r)}_insertBoxCell(e,t,i,r,n,o){this.boxCells[n].push(o)}_insertCircleCell(e,t,i,r,n,o){this.circleCells[n].push(o)}_query(e,t,i,r,n,o,s){if(i<0||e>this.width||r<0||t>this.height)return[];const a=[];if(e<=0&&t<=0&&this.width<=i&&this.height<=r){if(n)return[{key:null,x1:e,y1:t,x2:i,y2:r}];for(let e=0;e<this.boxKeys.length;e++)a.push({key:this.boxKeys[e],x1:this.bboxes[4*e],y1:this.bboxes[4*e+1],x2:this.bboxes[4*e+2],y2:this.bboxes[4*e+3]});for(let e=0;e<this.circleKeys.length;e++){const t=this.circles[3*e],i=this.circles[3*e+1],r=this.circles[3*e+2];a.push({key:this.circleKeys[e],x1:t-r,y1:i-r,x2:t+r,y2:i+r})}}else this._forEachCell(e,t,i,r,this._queryCell,a,{hitTest:n,overlapMode:o,seenUids:{box:{},circle:{}}},s);return a}query(e,t,i,r){return this._query(e,t,i,r,!1,null)}hitTest(e,t,i,r,n,o){return this._query(e,t,i,r,!0,n,o).length>0}hitTestCircle(e,t,i,r,n){const o=e-i,s=e+i,a=t-i,l=t+i;if(s<0||o>this.width||l<0||a>this.height)return!1;const c=[];return this._forEachCell(o,a,s,l,this._queryCellCircle,c,{hitTest:!0,overlapMode:r,circle:{x:e,y:t,radius:i},seenUids:{box:{},circle:{}}},n),c.length>0}_queryCell(e,t,i,r,n,o,s,a){const{seenUids:l,hitTest:c,overlapMode:u}=s,h=this.boxCells[n];if(null!==h){const n=this.bboxes;for(const s of h)if(!l.box[s]){l.box[s]=!0;const h=4*s,d=this.boxKeys[s];if(e<=n[h+2]&&t<=n[h+3]&&i>=n[h+0]&&r>=n[h+1]&&(!a||a(d))&&(!c||!Te(u,d.overlapMode))&&(o.push({key:d,x1:n[h],y1:n[h+1],x2:n[h+2],y2:n[h+3]}),c))return!0}}const d=this.circleCells[n];if(null!==d){const n=this.circles;for(const s of d)if(!l.circle[s]){l.circle[s]=!0;const h=3*s,d=this.circleKeys[s];if(this._circleAndRectCollide(n[h],n[h+1],n[h+2],e,t,i,r)&&(!a||a(d))&&(!c||!Te(u,d.overlapMode))){const e=n[h],t=n[h+1],i=n[h+2];if(o.push({key:d,x1:e-i,y1:t-i,x2:e+i,y2:t+i}),c)return!0}}}return!1}_queryCellCircle(e,t,i,r,n,o,s,a){const{circle:l,seenUids:c,overlapMode:u}=s,h=this.boxCells[n];if(null!==h){const e=this.bboxes;for(const t of h)if(!c.box[t]){c.box[t]=!0;const i=4*t,r=this.boxKeys[t];if(this._circleAndRectCollide(l.x,l.y,l.radius,e[i+0],e[i+1],e[i+2],e[i+3])&&(!a||a(r))&&!Te(u,r.overlapMode))return o.push(!0),!0}}const d=this.circleCells[n];if(null!==d){const e=this.circles;for(const t of d)if(!c.circle[t]){c.circle[t]=!0;const i=3*t,r=this.circleKeys[t];if(this._circlesCollide(e[i],e[i+1],e[i+2],l.x,l.y,l.radius)&&(!a||a(r))&&!Te(u,r.overlapMode))return o.push(!0),!0}}}_forEachCell(e,t,i,r,n,o,s,a){const l=this._convertToXCellCoord(e),c=this._convertToYCellCoord(t),u=this._convertToXCellCoord(i),h=this._convertToYCellCoord(r);for(let d=l;d<=u;d++)for(let l=c;l<=h;l++)if(n.call(this,e,t,i,r,this.xCellCount*l+d,o,s,a))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,t,i,r,n,o){const s=r-e,a=n-t,l=i+o;return l*l>s*s+a*a}_circleAndRectCollide(e,t,i,r,n,o,s){const a=(o-r)/2,l=Math.abs(e-(r+a));if(l>a+i)return!1;const c=(s-n)/2,u=Math.abs(t-(n+c));if(u>c+i)return!1;if(l<=a||u<=c)return!0;const h=l-a,d=u-c;return h*h+d*d<=i*i}}function Ce(e,i,n){const o=t.K();if(!e){const{vecSouth:e,vecEast:t}=Ee(i),n=r();n[0]=t[0],n[1]=t[1],n[2]=e[0],n[3]=e[1],s=n,(d=(l=(a=n)[0])*(h=a[3])-(u=a[2])*(c=a[1]))&&(s[0]=h*(d=1/d),s[1]=-c*d,s[2]=-u*d,s[3]=l*d),o[0]=n[0],o[1]=n[1],o[4]=n[2],o[5]=n[3]}var s,a,l,c,u,h,d;return t.M(o,o,[1/n,1/n,1]),o}function Se(e,i,r,n){if(e){const e=t.K();if(!i){const{vecSouth:t,vecEast:i}=Ee(r);e[0]=i[0],e[1]=i[1],e[4]=t[0],e[5]=t[1]}return t.M(e,e,[n,n,1]),e}return r.pixelsToClipSpaceMatrix}function Ee(e){const i=Math.cos(e.rollInRadians),r=Math.sin(e.rollInRadians),n=Math.cos(e.pitchInRadians),o=Math.cos(e.bearingInRadians),s=Math.sin(e.bearingInRadians),a=t.ao();a[0]=-o*n*r-s*i,a[1]=-s*n*r+o*i;const l=t.ap(a);l<1e-9?t.aq(a):t.ar(a,a,1/l);const c=t.ao();c[0]=o*n*i-s*r,c[1]=s*n*i+o*r;const u=t.ap(c);return u<1e-9?t.aq(c):t.ar(c,c,1/u),{vecEast:c,vecSouth:a}}function Me(e,i,r,n){let o;n?(o=[e,i,n(e,i),1],t.at(o,o,r)):(o=[e,i,0,1],$e(o,o,r));const s=o[3];return{point:new t.P(o[0]/s,o[1]/s),signedDistanceFromCamera:s,isOccluded:!1}}function Ie(e,t){return.5+e/t*.5}function Pe(e,t){return e.x>=-t[0]&&e.x<=t[0]&&e.y>=-t[1]&&e.y<=t[1]}function Le(e,i,r,n,o,s,a,l,c,u,h,d,p){const f=r?e.textSizeData:e.iconSizeData,A=t.ak(f,i.transform.zoom),m=[256/i.width*2+1,256/i.height*2+1],g=r?e.text.dynamicLayoutVertexArray:e.icon.dynamicLayoutVertexArray;g.clear();const _=e.lineVertexArray,y=r?e.text.placedSymbolArray:e.icon.placedSymbolArray,v=i.transform.width/i.transform.height;let x=!1;for(let r=0;r<y.length;r++){const b=y.get(r);if(b.hidden||b.writingMode===t.al.vertical&&!x){Ge(b.numGlyphs,g);continue}x=!1;const w=new t.P(b.anchorX,b.anchorY),T={getElevation:p,pitchedLabelPlaneMatrix:n,lineVertexArray:_,pitchWithMap:s,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:i.transform,tileAnchorPoint:w,unwrappedTileID:c,width:u,height:h,translation:d},B=Ne(b.anchorX,b.anchorY,T);if(!Pe(B.point,m)){Ge(b.numGlyphs,g);continue}const C=Ie(i.transform.cameraToCenterDistance,B.signedDistanceFromCamera),S=t.am(f,A,b),E=s?S*i.transform.getPitchedTextCorrection(b.anchorX,b.anchorY,c)/C:S*C,M=ze({projectionContext:T,pitchedLabelPlaneMatrixInverse:o,symbol:b,fontSize:E,flip:!1,keepUpright:a,glyphOffsetArray:e.glyphOffsetArray,dynamicLayoutVertexArray:g,aspectRatio:v,rotateToLine:l});x=M.useVertical,(M.notEnoughRoom||x||M.needsFlipping&&ze({projectionContext:T,pitchedLabelPlaneMatrixInverse:o,symbol:b,fontSize:E,flip:!0,keepUpright:a,glyphOffsetArray:e.glyphOffsetArray,dynamicLayoutVertexArray:g,aspectRatio:v,rotateToLine:l}).notEnoughRoom)&&Ge(b.numGlyphs,g)}r?e.text.dynamicLayoutVertexBuffer.updateData(g):e.icon.dynamicLayoutVertexBuffer.updateData(g)}function Fe(e,t,i,r,n,o,s,a){const l=o.glyphStartIndex+o.numGlyphs,c=o.lineStartIndex,u=o.lineStartIndex+o.lineLength,h=t.getoffsetX(o.glyphStartIndex),d=t.getoffsetX(l-1),p=Ve(e*h,i,r,n,o.segment,c,u,a,s);if(!p)return null;const f=Ve(e*d,i,r,n,o.segment,c,u,a,s);return f?a.projectionCache.anyProjectionOccluded?null:{first:p,last:f}:null}function ke(e,i,r,n){return e===t.al.horizontal&&Math.abs(r.y-i.y)>Math.abs(r.x-i.x)*n?{useVertical:!0}:(e===t.al.vertical?i.y<r.y:i.x>r.x)?{needsFlipping:!0}:null}function ze(e){const{projectionContext:i,pitchedLabelPlaneMatrixInverse:r,symbol:n,fontSize:o,flip:s,keepUpright:a,glyphOffsetArray:l,dynamicLayoutVertexArray:c,aspectRatio:u,rotateToLine:h}=e,d=o/24,p=n.lineOffsetX*d,f=n.lineOffsetY*d;let A;if(n.numGlyphs>1){const e=n.glyphStartIndex+n.numGlyphs,t=n.lineStartIndex,o=n.lineStartIndex+n.lineLength,c=Fe(d,l,p,f,s,n,h,i);if(!c)return{notEnoughRoom:!0};const m=Ue(c.first.point.x,c.first.point.y,i,r),g=Ue(c.last.point.x,c.last.point.y,i,r);if(a&&!s){const e=ke(n.writingMode,m,g,u);if(e)return e}A=[c.first];for(let r=n.glyphStartIndex+1;r<e-1;r++)A.push(Ve(d*l.getoffsetX(r),p,f,s,n.segment,t,o,i,h));A.push(c.last)}else{if(a&&!s){const e=Oe(i.tileAnchorPoint.x,i.tileAnchorPoint.y,i).point,o=n.lineStartIndex+n.segment+1,s=new t.P(i.lineVertexArray.getx(o),i.lineVertexArray.gety(o)),a=Oe(s.x,s.y,i),l=a.signedDistanceFromCamera>0?a.point:Re(i.tileAnchorPoint,s,e,1,i),c=Ue(e.x,e.y,i,r),h=Ue(l.x,l.y,i,r),d=ke(n.writingMode,c,h,u);if(d)return d}const e=Ve(d*l.getoffsetX(n.glyphStartIndex),p,f,s,n.segment,n.lineStartIndex,n.lineStartIndex+n.lineLength,i,h);if(!e||i.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};A=[e]}for(const e of A)t.as(c,e.point,e.angle);return{}}function Re(e,t,i,r,n){const o=e.add(e.sub(t)._unit()),s=Oe(o.x,o.y,n).point,a=i.sub(s);return i.add(a._mult(r/a.mag()))}function De(e,i,r){const n=i.projectionCache;if(n.projections[e])return n.projections[e];const o=new t.P(i.lineVertexArray.getx(e),i.lineVertexArray.gety(e)),s=Oe(o.x,o.y,i);if(s.signedDistanceFromCamera>0)return n.projections[e]=s.point,n.anyProjectionOccluded=n.anyProjectionOccluded||s.isOccluded,s.point;const a=e-r.direction;return Re(0===r.distanceFromAnchor?i.tileAnchorPoint:new t.P(i.lineVertexArray.getx(a),i.lineVertexArray.gety(a)),o,r.previousVertex,r.absOffsetX-r.distanceFromAnchor+1,i)}function Oe(e,t,i){const r=e+i.translation[0],n=t+i.translation[1];let o;return i.pitchWithMap?(o=Me(r,n,i.pitchedLabelPlaneMatrix,i.getElevation),o.isOccluded=!1):(o=i.transform.projectTileCoordinates(r,n,i.unwrappedTileID,i.getElevation),o.point.x=(.5*o.point.x+.5)*i.width,o.point.y=(.5*-o.point.y+.5)*i.height),o}function Ue(e,i,r,n){if(r.pitchWithMap){const o=[e,i,0,1];return t.at(o,o,n),r.transform.projectTileCoordinates(o[0]/o[3],o[1]/o[3],r.unwrappedTileID,r.getElevation).point}return{x:e/r.width*2-1,y:i/r.height*2-1}}function Ne(e,t,i){return i.transform.projectTileCoordinates(e,t,i.unwrappedTileID,i.getElevation)}function Qe(e,t,i){return e._unit()._perp()._mult(t*i)}function je(e,i,r,n,o,s,a,l,c){if(l.projectionCache.offsets[e])return l.projectionCache.offsets[e];const u=r.add(i);if(e+c.direction<n||e+c.direction>=o)return l.projectionCache.offsets[e]=u,u;const h=De(e+c.direction,l,c),d=Qe(h.sub(r),a,c.direction),p=r.add(d),f=h.add(d);return l.projectionCache.offsets[e]=t.au(s,u,p,f)||u,l.projectionCache.offsets[e]}function Ve(e,t,i,r,n,o,s,a,l){const c=r?e-t:e+t;let u=c>0?1:-1,h=0;r&&(u*=-1,h=Math.PI),u<0&&(h+=Math.PI);let d,p=u>0?o+n:o+n+1;a.projectionCache.cachedAnchorPoint?d=a.projectionCache.cachedAnchorPoint:(d=Oe(a.tileAnchorPoint.x,a.tileAnchorPoint.y,a).point,a.projectionCache.cachedAnchorPoint=d);let f,A,m=d,g=d,_=0,y=0;const v=Math.abs(c),x=[];let b;for(;_+y<=v;){if(p+=u,p<o||p>=s)return null;_+=y,g=m,A=f;const e={absOffsetX:v,direction:u,distanceFromAnchor:_,previousVertex:g};if(m=De(p,a,e),0===i)x.push(g),b=m.sub(g);else{let t;const r=m.sub(g);t=0===r.mag()?Qe(De(p+u,a,e).sub(m),i,u):Qe(r,i,u),A||(A=g.add(t)),f=je(p,t,m,o,s,A,i,a,e),x.push(A),b=f.sub(A)}y=b.mag()}const w=b._mult((v-_)/y)._add(A||g),T=h+Math.atan2(m.y-g.y,m.x-g.x);return x.push(w),{point:w,angle:l?T:0,path:x}}const He=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Ge(e,t){for(let i=0;i<e;i++){const e=t.length;t.resize(e+4),t.float32.set(He,3*e)}}function $e(e,t,i){const r=t[0],n=t[1];return e[0]=i[0]*r+i[4]*n+i[12],e[1]=i[1]*r+i[5]*n+i[13],e[3]=i[3]*r+i[7]*n+i[15],e}const Ze=100;class qe{constructor(e,t=new Be(e.width+200,e.height+200,25),i=new Be(e.width+200,e.height+200,25)){this.transform=e,this.grid=t,this.ignoredGrid=i,this.pitchFactor=Math.cos(e.pitch*Math.PI/180)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+Ze,this.screenBottomBoundary=e.height+Ze,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(e,t,i,r,n,o,s,a,l,c,u,h){const d=this.projectAndGetPerspectiveRatio(e.anchorPointX+a[0],e.anchorPointY+a[1],n,c,h),p=i*d.perspectiveRatio;let f;if(o||s)f=this._projectCollisionBox(e,p,r,n,o,s,a,d,c,u,h);else{const t=d.x+(u?u.x*p:0),i=d.y+(u?u.y*p:0);f={allPointsOccluded:!1,box:[t+e.x1*p,i+e.y1*p,t+e.x2*p,i+e.y2*p]}}const[A,m,g,_]=f.box,y=o?f.allPointsOccluded:d.isOccluded;let v=y;return v||(v=d.perspectiveRatio<this.perspectiveRatioCutoff),v||(v=!this.isInsideGrid(A,m,g,_)),v||"always"!==t&&this.grid.hitTest(A,m,g,_,t,l)?{box:[A,m,g,_],placeable:!1,offscreen:!1,occluded:y}:{box:[A,m,g,_],placeable:!0,offscreen:this.isOffscreen(A,m,g,_),occluded:y}}placeCollisionCircles(e,i,r,n,o,s,a,l,c,u,h,d,p,f){const A=[],m=new t.P(i.anchorX,i.anchorY),g=this.getPerspectiveRatio(m.x,m.y,s,f),_=(c?o*this.transform.getPitchedTextCorrection(i.anchorX,i.anchorY,s)/g:o*g)/t.ay,y={getElevation:f,pitchedLabelPlaneMatrix:a,lineVertexArray:r,pitchWithMap:c,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:m,unwrappedTileID:s,width:this.transform.width,height:this.transform.height,translation:p},v=Fe(_,n,i.lineOffsetX*_,i.lineOffsetY*_,!1,i,!1,y);let x=!1,b=!1,w=!0;if(v){const i=.5*h*g+d,r=new t.P(-100,-100),n=new t.P(this.screenRightBoundary,this.screenBottomBoundary),o=new we,s=v.first,a=v.last;let p=[];for(let e=s.path.length-1;e>=1;e--)p.push(s.path[e]);for(let e=1;e<a.path.length;e++)p.push(a.path[e]);const f=2.5*i;if(c){const e=this.projectPathToScreenSpace(p,y);p=e.some((e=>e.signedDistanceFromCamera<=0))?[]:e.map((e=>e.point))}let m=[];if(p.length>0){const e=p[0].clone(),i=p[0].clone();for(let t=1;t<p.length;t++)e.x=Math.min(e.x,p[t].x),e.y=Math.min(e.y,p[t].y),i.x=Math.max(i.x,p[t].x),i.y=Math.max(i.y,p[t].y);m=e.x>=r.x&&i.x<=n.x&&e.y>=r.y&&i.y<=n.y?[p]:i.x<r.x||e.x>n.x||i.y<r.y||e.y>n.y?[]:t.av([p],r.x,r.y,n.x,n.y)}for(const t of m){o.reset(t,.25*i);let r=0;r=o.length<=.5*i?1:Math.ceil(o.paddedLength/f)+1;for(let t=0;t<r;t++){const n=t/Math.max(r-1,1),s=o.lerp(n),a=s.x+Ze,c=s.y+Ze;A.push(a,c,i,0);const h=a-i,d=c-i,p=a+i,f=c+i;if(w=w&&this.isOffscreen(h,d,p,f),b=b||this.isInsideGrid(h,d,p,f),"always"!==e&&this.grid.hitTestCircle(a,c,i,e,u)&&(x=!0,!l))return{circles:[],offscreen:!1,collisionDetected:x}}}}return{circles:!l&&x||!b||g<this.perspectiveRatioCutoff?[]:A,offscreen:w,collisionDetected:x}}projectPathToScreenSpace(e,i){const r=function(e,i){const r=t.K();return t.an(r,i.pitchedLabelPlaneMatrix),e.map((e=>{const t=Me(e.x,e.y,r,i.getElevation),n=i.transform.projectTileCoordinates(t.point.x,t.point.y,i.unwrappedTileID,i.getElevation);return n.point.x=(.5*n.point.x+.5)*i.width,n.point.y=(.5*-n.point.y+.5)*i.height,n}))}(e,i);return function(e){let t=0,i=0,r=0,n=0;for(let o=0;o<e.length;o++)e[o].isOccluded?(r=o+1,n=0):(n++,n>i&&(i=n,t=r));return e.slice(t,t+i)}(r)}queryRenderedSymbols(e){if(0===e.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const i=[];let r=1/0,n=1/0,o=-1/0,s=-1/0;for(const a of e){const e=new t.P(a.x+Ze,a.y+Ze);r=Math.min(r,e.x),n=Math.min(n,e.y),o=Math.max(o,e.x),s=Math.max(s,e.y),i.push(e)}const a=this.grid.query(r,n,o,s).concat(this.ignoredGrid.query(r,n,o,s)),l={},c={};for(const e of a){const r=e.key;if(void 0===l[r.bucketInstanceId]&&(l[r.bucketInstanceId]={}),l[r.bucketInstanceId][r.featureIndex])continue;const n=[new t.P(e.x1,e.y1),new t.P(e.x2,e.y1),new t.P(e.x2,e.y2),new t.P(e.x1,e.y2)];t.aw(i,n)&&(l[r.bucketInstanceId][r.featureIndex]=!0,void 0===c[r.bucketInstanceId]&&(c[r.bucketInstanceId]=[]),c[r.bucketInstanceId].push(r.featureIndex))}return c}insertCollisionBox(e,t,i,r,n,o){(i?this.ignoredGrid:this.grid).insert({bucketInstanceId:r,featureIndex:n,collisionGroupID:o,overlapMode:t},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,t,i,r,n,o){const s=i?this.ignoredGrid:this.grid,a={bucketInstanceId:r,featureIndex:n,collisionGroupID:o,overlapMode:t};for(let t=0;t<e.length;t+=4)s.insertCircle(a,e[t],e[t+1],e[t+2])}projectAndGetPerspectiveRatio(e,i,r,n,o){if(o){let r;n?(r=[e,i,n(e,i),1],t.at(r,r,o)):(r=[e,i,0,1],$e(r,r,o));const s=r[3];return{x:(r[0]/s+1)/2*this.transform.width+Ze,y:(-r[1]/s+1)/2*this.transform.height+Ze,perspectiveRatio:.5+this.transform.cameraToCenterDistance/s*.5,isOccluded:!1,signedDistanceFromCamera:s}}{const t=this.transform.projectTileCoordinates(e,i,r,n);return{x:(t.point.x+1)/2*this.transform.width+Ze,y:(1-t.point.y)/2*this.transform.height+Ze,perspectiveRatio:.5+this.transform.cameraToCenterDistance/t.signedDistanceFromCamera*.5,isOccluded:t.isOccluded,signedDistanceFromCamera:t.signedDistanceFromCamera}}}getPerspectiveRatio(e,t,i,r){const n=this.transform.projectTileCoordinates(e,t,i,r);return.5+this.transform.cameraToCenterDistance/n.signedDistanceFromCamera*.5}isOffscreen(e,t,i,r){return i<Ze||e>=this.screenRightBoundary||r<Ze||t>this.screenBottomBoundary}isInsideGrid(e,t,i,r){return i>=0&&e<this.gridRightBoundary&&r>=0&&t<this.gridBottomBoundary}getViewportMatrix(){const e=t.ad([]);return t.L(e,e,[-100,-100,0]),e}_projectCollisionBox(e,i,r,n,o,s,a,l,c,u,h){let d=1,p=0,f=0,A=1;const m=e.anchorPointX+a[0],g=e.anchorPointY+a[1];if(s&&!o){const e=this.projectAndGetPerspectiveRatio(m+1,g,n,c,h),t=e.x-l.x,i=Math.atan((e.y-l.y)/t)+(t<0?Math.PI:0),r=Math.sin(i),o=Math.cos(i);d=o,p=r,f=-r,A=o}else if(!s&&o){const e=Ee(this.transform);d=e.vecEast[0],p=e.vecEast[1],f=e.vecSouth[0],A=e.vecSouth[1]}let _=l.x,y=l.y,v=i;o&&(_=m,y=g,v=Math.pow(2,-(this.transform.zoom-r.overscaledZ)),v*=this.transform.getPitchedTextCorrection(m,g,n),u||(v*=t.ae(.5+l.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),u&&(_+=d*u.x*v+f*u.y*v,y+=p*u.x*v+A*u.y*v);const x=e.x1*v,b=e.x2*v,w=(x+b)/2,T=e.y1*v,B=e.y2*v,C=(T+B)/2,S=[{offsetX:x,offsetY:T},{offsetX:w,offsetY:T},{offsetX:b,offsetY:T},{offsetX:b,offsetY:C},{offsetX:b,offsetY:B},{offsetX:w,offsetY:B},{offsetX:x,offsetY:B},{offsetX:x,offsetY:C}];let E=[];for(const{offsetX:e,offsetY:i}of S)E.push(new t.P(_+d*e+f*i,y+p*e+A*i));let M=!1;if(o){const e=E.map((e=>this.projectAndGetPerspectiveRatio(e.x,e.y,n,c,h)));M=e.some((e=>!e.isOccluded)),E=e.map((e=>new t.P(e.x,e.y)))}else M=!0;return{box:t.ax(E),allPointsOccluded:!M}}}class Ke{constructor(e,t,i,r){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?t:-t))):r&&i?1:0,this.placed=i}isHidden(){return 0===this.opacity&&!this.placed}}class We{constructor(e,t,i,r,n){this.text=new Ke(e?e.text:null,t,i,n),this.icon=new Ke(e?e.icon:null,t,r,n)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Xe{constructor(e,t,i){this.text=e,this.icon=t,this.skipFade=i}}class Ye{constructor(e,t,i,r,n){this.bucketInstanceId=e,this.featureIndex=t,this.sourceLayerIndex=i,this.bucketIndex=r,this.tileID=n}}class Je{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){const t=++this.maxGroupID;this.collisionGroups[e]={ID:t,predicate:e=>e.collisionGroupID===t}}return this.collisionGroups[e]}}function et(e,i,r,n,o){const{horizontalAlign:s,verticalAlign:a}=t.aE(e);return new t.P(-(s-.5)*i+n[0]*o,-(a-.5)*r+n[1]*o)}class tt{constructor(e,t,i,r,n){this.transform=e.clone(),this.terrain=t,this.collisionIndex=new qe(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=i,this.retainedQueryData={},this.collisionGroups=new Je(r),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=n,n&&(n.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(e){const t=this.terrain;return t?(i,r)=>t.getElevation(e,i,r):null}getBucketParts(e,i,r,n){const o=r.getBucket(i),s=r.latestFeatureIndex;if(!o||!s||i.id!==o.layerIds[0])return;const a=r.collisionBoxArray,l=o.layers[0].layout,c=o.layers[0].paint,u=Math.pow(2,this.transform.zoom-r.tileID.overscaledZ),h=r.tileSize/t.Z,d=r.tileID.toUnwrapped(),p="map"===l.get("text-rotation-alignment"),f=t.az(r,1,this.transform.zoom),A=t.aA(this.collisionIndex.transform,r,c.get("text-translate"),c.get("text-translate-anchor")),m=t.aA(this.collisionIndex.transform,r,c.get("icon-translate"),c.get("icon-translate-anchor")),g=Ce(p,this.transform,f);this.retainedQueryData[o.bucketInstanceId]=new Ye(o.bucketInstanceId,s,o.sourceLayerIndex,o.index,r.tileID);const _={bucket:o,layout:l,translationText:A,translationIcon:m,unwrappedTileID:d,pitchedLabelPlaneMatrix:g,scale:u,textPixelRatio:h,holdingForFade:r.holdingForFade(),collisionBoxArray:a,partiallyEvaluatedTextSize:t.ak(o.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(o.sourceID)};if(n)for(const t of o.sortKeyRanges){const{sortKey:i,symbolInstanceStart:r,symbolInstanceEnd:n}=t;e.push({sortKey:i,symbolInstanceStart:r,symbolInstanceEnd:n,parameters:_})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:o.symbolInstances.length,parameters:_})}attemptAnchorPlacement(e,i,r,n,o,s,a,l,c,u,h,d,p,f,A,m,g,_,y,v){const x=t.aB[e.textAnchor],b=[e.textOffset0,e.textOffset1],w=et(x,r,n,b,o),T=this.collisionIndex.placeCollisionBox(i,d,l,c,u,a,s,m,h.predicate,y,w,v);if((!_||this.collisionIndex.placeCollisionBox(_,d,l,c,u,a,s,g,h.predicate,y,w,v).placeable)&&T.placeable){let e;if(this.prevPlacement&&this.prevPlacement.variableOffsets[p.crossTileID]&&this.prevPlacement.placements[p.crossTileID]&&this.prevPlacement.placements[p.crossTileID].text&&(e=this.prevPlacement.variableOffsets[p.crossTileID].anchor),0===p.crossTileID)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[p.crossTileID]={textOffset:b,width:r,height:n,anchor:x,textBoxScale:o,prevAnchor:e},this.markUsedJustification(f,x,p,A),f.allowVerticalPlacement&&(this.markUsedOrientation(f,A,p),this.placedOrientations[p.crossTileID]=A),{shift:w,placedGlyphBoxes:T}}}placeLayerBucketPart(e,i,r){const{bucket:n,layout:o,translationText:s,translationIcon:a,unwrappedTileID:l,pitchedLabelPlaneMatrix:c,textPixelRatio:u,holdingForFade:h,collisionBoxArray:d,partiallyEvaluatedTextSize:p,collisionGroup:f}=e.parameters,A=o.get("text-optional"),m=o.get("icon-optional"),g=t.aC(o,"text-overlap","text-allow-overlap"),_="always"===g,y=t.aC(o,"icon-overlap","icon-allow-overlap"),v="always"===y,x="map"===o.get("text-rotation-alignment"),b="map"===o.get("text-pitch-alignment"),w="none"!==o.get("icon-text-fit"),T="viewport-y"===o.get("symbol-z-order"),B=_&&(v||!n.hasIconData()||m),C=v&&(_||!n.hasTextData()||A);!n.collisionArrays&&d&&n.deserializeCollisionBoxes(d);const S=this.retainedQueryData[n.bucketInstanceId].tileID,E=this._getTerrainElevationFunc(S),M=this.transform.getFastPathSimpleProjectionMatrix(S),I=(e,d,v)=>{var T,I;if(i[e.crossTileID])return;if(h)return void(this.placements[e.crossTileID]=new Xe(!1,!1,!1));let P=!1,L=!1,F=!0,k=null,z={box:null,placeable:!1,offscreen:null,occluded:!1},R={placeable:!1},D=null,O=null,U=null,N=0,Q=0,j=0;d.textFeatureIndex?N=d.textFeatureIndex:e.useRuntimeCollisionCircles&&(N=e.featureIndex),d.verticalTextFeatureIndex&&(Q=d.verticalTextFeatureIndex);const V=d.textBox;if(V){const i=i=>{let r=t.al.horizontal;if(n.allowVerticalPlacement&&!i&&this.prevPlacement){const t=this.prevPlacement.placedOrientations[e.crossTileID];t&&(this.placedOrientations[e.crossTileID]=t,r=t,this.markUsedOrientation(n,r,e))}return r},o=(i,r)=>{if(n.allowVerticalPlacement&&e.numVerticalGlyphVertices>0&&d.verticalTextBox){for(const e of n.writingModes)if(e===t.al.vertical?(z=r(),R=z):z=i(),z&&z.placeable)break}else z=i()},c=e.textAnchorOffsetStartIndex,h=e.textAnchorOffsetEndIndex;if(h===c){const r=(t,i)=>{const r=this.collisionIndex.placeCollisionBox(t,g,u,S,l,b,x,s,f.predicate,E,void 0,M);return r&&r.placeable&&(this.markUsedOrientation(n,i,e),this.placedOrientations[e.crossTileID]=i),r};o((()=>r(V,t.al.horizontal)),(()=>{const i=d.verticalTextBox;return n.allowVerticalPlacement&&e.numVerticalGlyphVertices>0&&i?r(i,t.al.vertical):{box:null,offscreen:null}})),i(z&&z.placeable)}else{let p=t.aB[null===(I=null===(T=this.prevPlacement)||void 0===T?void 0:T.variableOffsets[e.crossTileID])||void 0===I?void 0:I.anchor];const A=(t,i,o)=>{const d=t.x2-t.x1,A=t.y2-t.y1,m=e.textBoxScale,_=w&&"never"===y?i:null;let v=null,T="never"===g?1:2,B="never";p&&T++;for(let i=0;i<T;i++){for(let i=c;i<h;i++){const r=n.textAnchorOffsets.get(i);if(p&&r.textAnchor!==p)continue;const c=this.attemptAnchorPlacement(r,t,d,A,m,x,b,u,S,l,f,B,e,n,o,s,a,_,E);if(c&&(v=c.placedGlyphBoxes,v&&v.placeable))return P=!0,k=c.shift,v}p?p=null:B=g}return r&&!v&&(v={box:this.collisionIndex.placeCollisionBox(V,"always",u,S,l,b,x,s,f.predicate,E,void 0,M).box,offscreen:!1,placeable:!1,occluded:!1}),v};o((()=>A(V,d.iconBox,t.al.horizontal)),(()=>{const i=d.verticalTextBox;return n.allowVerticalPlacement&&(!z||!z.placeable)&&e.numVerticalGlyphVertices>0&&i?A(i,d.verticalIconBox,t.al.vertical):{box:null,occluded:!0,offscreen:null}})),z&&(P=z.placeable,F=z.offscreen);const m=i(z&&z.placeable);if(!P&&this.prevPlacement){const t=this.prevPlacement.variableOffsets[e.crossTileID];t&&(this.variableOffsets[e.crossTileID]=t,this.markUsedJustification(n,t.anchor,e,m))}}}if(D=z,P=D&&D.placeable,F=D&&D.offscreen,e.useRuntimeCollisionCircles){const i=n.text.placedSymbolArray.get(e.centerJustifiedTextSymbolIndex),a=t.am(n.textSizeData,p,i),u=o.get("text-padding");O=this.collisionIndex.placeCollisionCircles(g,i,n.lineVertexArray,n.glyphOffsetArray,a,l,c,r,b,f.predicate,e.collisionCircleDiameter,u,s,E),O.circles.length&&O.collisionDetected&&!r&&t.w("Collisions detected, but collision boxes are not shown"),P=_||O.circles.length>0&&!O.collisionDetected,F=F&&O.offscreen}if(d.iconFeatureIndex&&(j=d.iconFeatureIndex),d.iconBox){const e=e=>this.collisionIndex.placeCollisionBox(e,y,u,S,l,b,x,a,f.predicate,E,w&&k?k:void 0,M);R&&R.placeable&&d.verticalIconBox?(U=e(d.verticalIconBox),L=U.placeable):(U=e(d.iconBox),L=U.placeable),F=F&&U.offscreen}const H=A||0===e.numHorizontalGlyphVertices&&0===e.numVerticalGlyphVertices,G=m||0===e.numIconVertices;H||G?G?H||(L=L&&P):P=L&&P:L=P=L&&P;const $=L&&U.placeable;if(P&&D.placeable&&this.collisionIndex.insertCollisionBox(D.box,g,o.get("text-ignore-placement"),n.bucketInstanceId,R&&R.placeable&&Q?Q:N,f.ID),$&&this.collisionIndex.insertCollisionBox(U.box,y,o.get("icon-ignore-placement"),n.bucketInstanceId,j,f.ID),O&&P&&this.collisionIndex.insertCollisionCircles(O.circles,g,o.get("text-ignore-placement"),n.bucketInstanceId,N,f.ID),r&&this.storeCollisionData(n.bucketInstanceId,v,d,D,U,O),0===e.crossTileID)throw new Error("symbolInstance.crossTileID can't be 0");if(0===n.bucketInstanceId)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[e.crossTileID]=new Xe((P||B)&&!(null==D?void 0:D.occluded),(L||C)&&!(null==U?void 0:U.occluded),F||n.justReloaded),i[e.crossTileID]=!0};if(T){if(0!==e.symbolInstanceStart)throw new Error("bucket.bucketInstanceId should be 0");const t=n.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let e=t.length-1;e>=0;--e){const i=t[e];I(n.symbolInstances.get(i),n.collisionArrays[i],i)}}else for(let t=e.symbolInstanceStart;t<e.symbolInstanceEnd;t++)I(n.symbolInstances.get(t),n.collisionArrays[t],t);n.justReloaded=!1}storeCollisionData(e,t,i,r,n,o){if(i.textBox||i.iconBox){let o,s;this.collisionBoxArrays.has(e)?o=this.collisionBoxArrays.get(e):(o=new Map,this.collisionBoxArrays.set(e,o)),o.has(t)?s=o.get(t):(s={text:null,icon:null},o.set(t,s)),i.textBox&&(s.text=r.box),i.iconBox&&(s.icon=n.box)}if(o){let t=this.collisionCircleArrays[e];void 0===t&&(t=this.collisionCircleArrays[e]=[]);for(let e=0;e<o.circles.length;e+=4)t.push(o.circles[e+0]-Ze),t.push(o.circles[e+1]-Ze),t.push(o.circles[e+2]),t.push(o.collisionDetected?1:0)}}markUsedJustification(e,i,r,n){let o;o=n===t.al.vertical?r.verticalPlacedTextSymbolIndex:{left:r.leftJustifiedTextSymbolIndex,center:r.centerJustifiedTextSymbolIndex,right:r.rightJustifiedTextSymbolIndex}[t.aD(i)];const s=[r.leftJustifiedTextSymbolIndex,r.centerJustifiedTextSymbolIndex,r.rightJustifiedTextSymbolIndex,r.verticalPlacedTextSymbolIndex];for(const t of s)t>=0&&(e.text.placedSymbolArray.get(t).crossTileID=o>=0&&t!==o?0:r.crossTileID)}markUsedOrientation(e,i,r){const n=i===t.al.horizontal||i===t.al.horizontalOnly?i:0,o=i===t.al.vertical?i:0,s=[r.leftJustifiedTextSymbolIndex,r.centerJustifiedTextSymbolIndex,r.rightJustifiedTextSymbolIndex];for(const t of s)e.text.placedSymbolArray.get(t).placedOrientation=n;r.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(r.verticalPlacedTextSymbolIndex).placedOrientation=o)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;const t=this.prevPlacement;let i=!1;this.prevZoomAdjustment=t?t.zoomAdjustment(this.transform.zoom):0;const r=t?t.symbolFadeChange(e):1,n=t?t.opacities:{},o=t?t.variableOffsets:{},s=t?t.placedOrientations:{};for(const e in this.placements){const t=this.placements[e],o=n[e];o?(this.opacities[e]=new We(o,r,t.text,t.icon),i=i||t.text!==o.text.placed||t.icon!==o.icon.placed):(this.opacities[e]=new We(null,r,t.text,t.icon,t.skipFade),i=i||t.text||t.icon)}for(const e in n){const t=n[e];if(!this.opacities[e]){const n=new We(t,r,!1,!1);n.isHidden()||(this.opacities[e]=n,i=i||t.text.placed||t.icon.placed)}}for(const e in o)this.variableOffsets[e]||!this.opacities[e]||this.opacities[e].isHidden()||(this.variableOffsets[e]=o[e]);for(const e in s)this.placedOrientations[e]||!this.opacities[e]||this.opacities[e].isHidden()||(this.placedOrientations[e]=s[e]);if(t&&void 0===t.lastPlacementChangeTime)throw new Error("Last placement time for previous placement is not defined");i?this.lastPlacementChangeTime=e:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=t?t.lastPlacementChangeTime:e)}updateLayerOpacities(e,t){const i={};for(const r of t){const t=r.getBucket(e);t&&r.latestFeatureIndex&&e.id===t.layerIds[0]&&this.updateBucketOpacities(t,r.tileID,i,r.collisionBoxArray)}}updateBucketOpacities(e,i,r,n){e.hasTextData()&&(e.text.opacityVertexArray.clear(),e.text.hasVisibleVertices=!1),e.hasIconData()&&(e.icon.opacityVertexArray.clear(),e.icon.hasVisibleVertices=!1),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();const o=e.layers[0],s=o.layout,a=new We(null,0,!1,!1,!0),l=s.get("text-allow-overlap"),c=s.get("icon-allow-overlap"),u=o._unevaluatedLayout.hasValue("text-variable-anchor")||o._unevaluatedLayout.hasValue("text-variable-anchor-offset"),h="map"===s.get("text-rotation-alignment"),d="map"===s.get("text-pitch-alignment"),p="none"!==s.get("icon-text-fit"),f=new We(null,0,l&&(c||!e.hasIconData()||s.get("icon-optional")),c&&(l||!e.hasTextData()||s.get("text-optional")),!0);!e.collisionArrays&&n&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(n);const A=(e,t,i)=>{for(let r=0;r<t/4;r++)e.opacityVertexArray.emplaceBack(i);e.hasVisibleVertices=e.hasVisibleVertices||i!==ht},m=this.collisionBoxArrays.get(e.bucketInstanceId);for(let i=0;i<e.symbolInstances.length;i++){const n=e.symbolInstances.get(i),{numHorizontalGlyphVertices:o,numVerticalGlyphVertices:s,crossTileID:l}=n;let c=this.opacities[l];r[l]?c=a:c||(c=f,this.opacities[l]=c),r[l]=!0;const g=n.numIconVertices>0,_=this.placedOrientations[n.crossTileID],y=_===t.al.vertical,v=_===t.al.horizontal||_===t.al.horizontalOnly;if(o>0||s>0){const t=ut(c.text);A(e.text,o,y?ht:t),A(e.text,s,v?ht:t);const i=c.text.isHidden();[n.rightJustifiedTextSymbolIndex,n.centerJustifiedTextSymbolIndex,n.leftJustifiedTextSymbolIndex].forEach((t=>{t>=0&&(e.text.placedSymbolArray.get(t).hidden=i||y?1:0)})),n.verticalPlacedTextSymbolIndex>=0&&(e.text.placedSymbolArray.get(n.verticalPlacedTextSymbolIndex).hidden=i||v?1:0);const r=this.variableOffsets[n.crossTileID];r&&this.markUsedJustification(e,r.anchor,n,_);const a=this.placedOrientations[n.crossTileID];a&&(this.markUsedJustification(e,"left",n,a),this.markUsedOrientation(e,a,n))}if(g){const t=ut(c.icon),i=!(p&&n.verticalPlacedIconSymbolIndex&&y);n.placedIconSymbolIndex>=0&&(A(e.icon,n.numIconVertices,i?t:ht),e.icon.placedSymbolArray.get(n.placedIconSymbolIndex).hidden=c.icon.isHidden()),n.verticalPlacedIconSymbolIndex>=0&&(A(e.icon,n.numVerticalIconVertices,i?ht:t),e.icon.placedSymbolArray.get(n.verticalPlacedIconSymbolIndex).hidden=c.icon.isHidden())}const x=m&&m.has(i)?m.get(i):{text:null,icon:null};if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){const r=e.collisionArrays[i];if(r){let i=new t.P(0,0);if(r.textBox||r.verticalTextBox){let t=!0;if(u){const e=this.variableOffsets[l];e?(i=et(e.anchor,e.width,e.height,e.textOffset,e.textBoxScale),h&&i._rotate(d?-this.transform.bearingInRadians:this.transform.bearingInRadians)):t=!1}if(r.textBox||r.verticalTextBox){let n;r.textBox&&(n=y),r.verticalTextBox&&(n=v),it(e.textCollisionBox.collisionVertexArray,c.text.placed,!t||n,x.text,i.x,i.y)}}if(r.iconBox||r.verticalIconBox){const t=Boolean(!v&&r.verticalIconBox);let n;r.iconBox&&(n=t),r.verticalIconBox&&(n=!t),it(e.iconCollisionBox.collisionVertexArray,c.icon.placed,n,x.icon,p?i.x:0,p?i.y:0)}}}}if(e.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.text.opacityVertexArray.length!==e.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${e.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${e.text.layoutVertexArray.length}) / 4`);if(e.icon.opacityVertexArray.length!==e.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${e.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${e.icon.layoutVertexArray.length}) / 4`);e.bucketInstanceId in this.collisionCircleArrays&&(e.collisionCircleArray=this.collisionCircleArrays[e.bucketInstanceId],delete this.collisionCircleArrays[e.bucketInstanceId])}symbolFadeChange(e){return 0===this.fadeDuration?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,t){const i=this.zoomAtLastRecencyCheck===t?1-this.zoomAdjustment(t):1;return this.zoomAtLastRecencyCheck=t,this.commitTime+this.fadeDuration*i>e}setStale(){this.stale=!0}}function it(e,t,i,r,n,o){r&&0!==r.length||(r=[0,0,0,0]);const s=r[0]-Ze,a=r[1]-Ze,l=r[2]-Ze,c=r[3]-Ze;e.emplaceBack(t?1:0,i?1:0,n||0,o||0,s,a),e.emplaceBack(t?1:0,i?1:0,n||0,o||0,l,a),e.emplaceBack(t?1:0,i?1:0,n||0,o||0,l,c),e.emplaceBack(t?1:0,i?1:0,n||0,o||0,s,c)}const rt=Math.pow(2,25),nt=Math.pow(2,24),ot=Math.pow(2,17),st=Math.pow(2,16),at=Math.pow(2,9),lt=Math.pow(2,8),ct=Math.pow(2,1);function ut(e){if(0===e.opacity&&!e.placed)return 0;if(1===e.opacity&&e.placed)return 4294967295;const t=e.placed?1:0,i=Math.floor(127*e.opacity);return i*rt+t*nt+i*ot+t*st+i*at+t*lt+i*ct+t}const ht=0;class dt{constructor(e){this._sortAcrossTiles="viewport-y"!==e.layout.get("symbol-z-order")&&!e.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(e,t,i,r,n){const o=this._bucketParts;for(;this._currentTileIndex<e.length;)if(t.getBucketParts(o,r,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,n())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,o.sort(((e,t)=>e.sortKey-t.sortKey)));this._currentPartIndex<o.length;)if(t.placeLayerBucketPart(o[this._currentPartIndex],this._seenCrossTileIDs,i),this._currentPartIndex++,n())return!0;return!1}}class pt{constructor(e,t,i,r,n,o,s,a){this.placement=new tt(e,t,o,s,a),this._currentPlacementIndex=i.length-1,this._forceFullPlacement=r,this._showCollisionBoxes=n,this._done=!1}isDone(){return this._done}continuePlacement(e,t,i){const r=s.now(),n=()=>!this._forceFullPlacement&&s.now()-r>2;for(;this._currentPlacementIndex>=0;){const r=t[e[this._currentPlacementIndex]],o=this.placement.collisionIndex.transform.zoom;if("symbol"===r.type&&(!r.minzoom||r.minzoom<=o)&&(!r.maxzoom||r.maxzoom>o)){if(this._inProgressLayer||(this._inProgressLayer=new dt(r)),this._inProgressLayer.continuePlacement(i[r.source],this.placement,this._showCollisionBoxes,r,n))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}const ft=512/t.Z/2;class At{constructor(e,i,r){this.tileID=e,this.bucketInstanceId=r,this._symbolsByKey={};const n=new Map;for(let e=0;e<i.length;e++){const t=i.get(e),r=t.key,o=n.get(r);o?o.push(t):n.set(r,[t])}for(const[e,i]of n){const r={positions:i.map((e=>({x:Math.floor(e.anchorX*ft),y:Math.floor(e.anchorY*ft)}))),crossTileIDs:i.map((e=>e.crossTileID))};if(r.positions.length>128){const e=new t.aF(r.positions.length,16,Uint16Array);for(const{x:t,y:i}of r.positions)e.add(t,i);e.finish(),delete r.positions,r.index=e}this._symbolsByKey[e]=r}}getScaledCoordinates(e,i){const{x:r,y:n,z:o}=this.tileID.canonical,{x:s,y:a,z:l}=i.canonical,c=ft/Math.pow(2,l-o),u=(a*t.Z+e.anchorY)*c,h=n*t.Z*ft;return{x:Math.floor((s*t.Z+e.anchorX)*c-r*t.Z*ft),y:Math.floor(u-h)}}findMatches(e,t,i){const r=this.tileID.canonical.z<t.canonical.z?1:Math.pow(2,this.tileID.canonical.z-t.canonical.z);for(let n=0;n<e.length;n++){const o=e.get(n);if(o.crossTileID)continue;const s=this._symbolsByKey[o.key];if(!s)continue;const a=this.getScaledCoordinates(o,t);if(s.index){const e=s.index.range(a.x-r,a.y-r,a.x+r,a.y+r).sort();for(const t of e){const e=s.crossTileIDs[t];if(!i[e]){i[e]=!0,o.crossTileID=e;break}}}else if(s.positions)for(let e=0;e<s.positions.length;e++){const t=s.positions[e],n=s.crossTileIDs[e];if(Math.abs(t.x-a.x)<=r&&Math.abs(t.y-a.y)<=r&&!i[n]){i[n]=!0,o.crossTileID=n;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map((({crossTileIDs:e})=>e))}}class mt{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class gt{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){const t=Math.round((e-this.lng)/360);if(0!==t)for(const e in this.indexes){const i=this.indexes[e],r={};for(const e in i){const n=i[e];n.tileID=n.tileID.unwrapTo(n.tileID.wrap+t),r[n.tileID.key]=n}this.indexes[e]=r}this.lng=e}addBucket(e,t,i){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===t.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let e=0;e<t.symbolInstances.length;e++)t.symbolInstances.get(e).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]={});const r=this.usedCrossTileIDs[e.overscaledZ];for(const i in this.indexes){const n=this.indexes[i];if(Number(i)>e.overscaledZ)for(const i in n){const o=n[i];o.tileID.isChildOf(e)&&o.findMatches(t.symbolInstances,e,r)}else{const o=n[e.scaledTo(Number(i)).key];o&&o.findMatches(t.symbolInstances,e,r)}}for(let e=0;e<t.symbolInstances.length;e++){const n=t.symbolInstances.get(e);n.crossTileID||(n.crossTileID=i.generate(),r[n.crossTileID]=!0)}return void 0===this.indexes[e.overscaledZ]&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new At(e,t.symbolInstances,t.bucketInstanceId),!0}removeBucketCrossTileIDs(e,t){for(const i of t.getCrossTileIDsLists())for(const t of i)delete this.usedCrossTileIDs[e][t]}removeStaleBuckets(e){let t=!1;for(const i in this.indexes){const r=this.indexes[i];for(const n in r)e[r[n].bucketInstanceId]||(this.removeBucketCrossTileIDs(i,r[n]),delete r[n],t=!0)}return t}}class _t{constructor(){this.layerIndexes={},this.crossTileIDs=new mt,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,t,i){let r=this.layerIndexes[e.id];void 0===r&&(r=this.layerIndexes[e.id]=new gt);let n=!1;const o={};r.handleWrapJump(i);for(const i of t){const t=i.getBucket(e);t&&e.id===t.layerIds[0]&&(t.bucketInstanceId||(t.bucketInstanceId=++this.maxBucketInstanceId),r.addBucket(i.tileID,t,this.crossTileIDs)&&(n=!0),o[t.bucketInstanceId]=!0)}return r.removeStaleBuckets(o)&&(n=!0),n}pruneUnusedLayers(e){const t={};e.forEach((e=>{t[e]=!0}));for(const e in this.layerIndexes)t[e]||delete this.layerIndexes[e]}}var yt="void main() {fragColor=vec4(1.0);}";const vt={prelude:xt("#ifdef GL_ES\nprecision mediump float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif\nout highp vec4 fragColor;","#ifdef GL_ES\nprecision highp float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c\n);}\n#ifdef TERRAIN3D\nuniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;\n#endif\nconst highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {\n#ifdef TERRAIN3D\nhighp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));\n#else\nreturn 1.0;\n#endif\n}float calculate_visibility(vec4 pos) {\n#ifdef TERRAIN3D\nvec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;\n#else\nreturn 1.0;\n#endif\n}float ele(vec2 pos) {\n#ifdef TERRAIN3D\nvec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;\n#else\nreturn 0.0;\n#endif\n}float get_elevation(vec2 pos) {\n#ifdef TERRAIN3D\n#ifdef GLOBE\nif ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}\n#endif\nvec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;\n#else\nreturn 0.0;\n#endif\n}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;"),projectionMercator:xt("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:xt("","#define GLOBE_RADIUS 6371008.8\nuniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos\n);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); \nif (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len\n);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}"),background:xt("uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:xt("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:xt("in vec3 v_data;in float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {\n#ifdef GLOBE\nvec3 center_vector=projectToSphere(circle_center);\n#endif\nfloat angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {\n#ifdef GLOBE\nvec4 projected_center=interpolateProjection(circle_center,center_vector,ele);\n#else\nvec4 projected_center=projectTileWithElevation(circle_center,ele);\n#endif\ncorner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}\n#ifdef GLOBE\nvec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);\n#else\ngl_Position=projectTileWithElevation(corner_position,ele);\n#endif\n} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}"),clippingMask:xt(yt,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:xt("uniform highp float u_intensity;in vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);\n#ifdef GLOBE\nvec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);\n#else\ngl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));\n#endif\n}"),heatmapTexture:xt("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(0.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:xt("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:xt("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:xt("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:xt(yt,"in vec2 a_pos;void main() {\n#ifdef GLOBE\ngl_Position=projectTileFor3D(a_pos,0.0);\n#else\ngl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);\n#endif\n}"),fill:xt("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nfragColor=color*opacity;\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform vec2 u_fill_translate;in vec2 a_pos;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=projectTile(a_pos+u_fill_translate,a_pos);}"),fillOutline:xt("in vec2 v_pos;\n#ifdef GLOBE\nin float v_depth;\n#endif\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);\n#ifdef GLOBE\nif (v_depth > 1.0) {discard;}\n#endif\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;\n#ifdef GLOBE\nout float v_depth;\n#endif\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef GLOBE\nv_depth=gl_Position.z/gl_Position.w;\n#endif\n}"),fillOutlinePattern:xt("uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;\n#ifdef GLOBE\nin float v_depth;\n#endif\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;\n#ifdef GLOBE\nif (v_depth > 1.0) {discard;}\n#endif\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;\n#ifdef GLOBE\nout float v_depth;\n#endif\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef GLOBE\nv_depth=gl_Position.z/gl_Position.w;\n#endif\n}"),fillPattern:xt("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}"),fillExtrusion:xt("in vec4 v_color;void main() {fragColor=v_color;\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;\n#ifdef TERRAIN3D\nin vec2 a_centroid;\n#endif\nout vec4 v_color;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec3 normal=a_normal_ed.xyz;\n#ifdef TERRAIN3D\nfloat height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);\n#else\nfloat height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;\n#endif\nbase=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;\n#ifdef GLOBE\nvec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);\n#else\ngl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);\n#endif\nfloat colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);\n#ifdef GLOBE\nmat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);\n#endif\ndirectional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}"),fillExtrusionPattern:xt("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;\n#ifdef TERRAIN3D\nin vec2 a_centroid;\n#endif\n#ifdef GLOBE\nout vec3 v_sphere_pos;\n#endif\nout vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;\n#ifdef TERRAIN3D\nfloat height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);\n#else\nfloat height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;\n#endif\nbase=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;\n#ifdef GLOBE\nvec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);\n#else\ngl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);\n#endif\nvec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0\n? a_pos\n: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}"),hillshadePrepare:xt("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));fragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:xt("uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;\n#define PI 3.141592653589793\nvoid main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:xt("uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;\n#ifdef GLOBE\nin float v_depth;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);\n#ifdef GLOBE\nif (v_depth > 1.0) {discard;}\n#endif\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nin vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;\n#ifdef GLOBE\nout float v_depth;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;\n#ifdef GLOBE\nv_depth=gl_Position.z/gl_Position.w;\n#endif\n#ifdef TERRAIN3D\nv_gamma_scale=1.0;\n#else\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#endif\nv_width2=vec2(outset,inset);}"),lineGradient:xt("uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;\n#ifdef GLOBE\nin float v_depth;\n#endif\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);\n#ifdef GLOBE\nif (v_depth > 1.0) {discard;}\n#endif\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nin vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;\n#ifdef GLOBE\nout float v_depth;\n#endif\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;\n#ifdef GLOBE\nv_depth=gl_Position.z/gl_Position.w;\n#endif\n#ifdef TERRAIN3D\nv_gamma_scale=1.0;\n#else\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#endif\nv_width2=vec2(outset,inset);}"),linePattern:xt("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;\n#ifdef GLOBE\nin float v_depth;\n#endif\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;\n#ifdef GLOBE\nif (v_depth > 1.0) {discard;}\n#endif\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\n#define LINE_DISTANCE_SCALE 2.0\nin vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;\n#ifdef GLOBE\nout float v_depth;\n#endif\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;\n#ifdef GLOBE\nv_depth=gl_Position.z/gl_Position.w;\n#endif\n#ifdef TERRAIN3D\nv_gamma_scale=1.0;\n#else\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}"),lineSDF:xt("uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;\n#ifdef GLOBE\nin float v_depth;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);\n#ifdef GLOBE\nif (v_depth > 1.0) {discard;}\n#endif\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\n#define LINE_DISTANCE_SCALE 2.0\nin vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;\n#ifdef GLOBE\nout float v_depth;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;\n#ifdef GLOBE\nv_depth=gl_Position.z/gl_Position.w;\n#endif\n#ifdef TERRAIN3D\nv_gamma_scale=1.0;\n#else\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#endif\nv_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}"),raster:xt("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;\n#ifdef GLOBE\nif (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}\n#endif\nv_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:xt("uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;\n#ifdef GLOBE\nif(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}\n#endif\nvec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}"),symbolSDF:xt("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;\n#ifdef GLOBE\nif(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}\n#endif\nvec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}"),symbolTextAndIcon:xt("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;\n#ifdef GLOBE\nif(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}\n#endif\nvec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}"),terrain:xt("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:xt("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:xt("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:xt("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:xt("in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758\n);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}","in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:xt("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function xt(e,t){const i=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,r=t.match(/in ([\w]+) ([\w]+)/g),n=e.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),o=t.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),s=o?o.concat(n):n,a={};return{fragmentSource:e=e.replace(i,((e,t,i,r,n)=>(a[n]=!0,"define"===t?`\n#ifndef HAS_UNIFORM_u_${n}\nin ${i} ${r} ${n};\n#else\nuniform ${i} ${r} u_${n};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${n}\n    ${i} ${r} ${n} = u_${n};\n#endif\n`))),vertexSource:t=t.replace(i,((e,t,i,r,n)=>{const o="float"===r?"vec2":"vec4",s=n.match(/color/)?"color":o;return a[n]?"define"===t?`\n#ifndef HAS_UNIFORM_u_${n}\nuniform lowp float u_${n}_t;\nin ${i} ${o} a_${n};\nout ${i} ${r} ${n};\n#else\nuniform ${i} ${r} u_${n};\n#endif\n`:"vec4"===s?`\n#ifndef HAS_UNIFORM_u_${n}\n    ${n} = a_${n};\n#else\n    ${i} ${r} ${n} = u_${n};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${n}\n    ${n} = unpack_mix_${s}(a_${n}, u_${n}_t);\n#else\n    ${i} ${r} ${n} = u_${n};\n#endif\n`:"define"===t?`\n#ifndef HAS_UNIFORM_u_${n}\nuniform lowp float u_${n}_t;\nin ${i} ${o} a_${n};\n#else\nuniform ${i} ${r} u_${n};\n#endif\n`:"vec4"===s?`\n#ifndef HAS_UNIFORM_u_${n}\n    ${i} ${r} ${n} = a_${n};\n#else\n    ${i} ${r} ${n} = u_${n};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${n}\n    ${i} ${r} ${n} = unpack_mix_${s}(a_${n}, u_${n}_t);\n#else\n    ${i} ${r} ${n} = u_${n};\n#endif\n`})),staticAttributes:r,staticUniforms:s}}class bt{constructor(e,t,i){this.vertexBuffer=e,this.indexBuffer=t,this.segments=i}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var wt=t.aG([{name:"a_pos",type:"Int16",components:2}]);const Tt="#define PROJECTION_MERCATOR",Bt="mercator";class Ct{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return Bt}get shaderDefine(){return Tt}get shaderPreludeCode(){return vt.projectionMercator}get vertexShaderPreludeCode(){return vt.projectionMercator.vertexSource}get subdivisionGranularity(){return t.aH.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(e){}getMeshFromTileID(e,i,r,n,o){if(this._cachedMesh)return this._cachedMesh;const s=new t.aI;s.emplaceBack(0,0),s.emplaceBack(t.Z,0),s.emplaceBack(0,t.Z),s.emplaceBack(t.Z,t.Z);const a=e.createVertexBuffer(s,wt.members),l=t.aJ.simpleSegment(0,0,4,2),c=new t.aK;c.emplaceBack(1,0,2),c.emplaceBack(1,2,3);const u=e.createIndexBuffer(c);return this._cachedMesh=new bt(a,u,l),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(e){}}class St{constructor(e=0,t=0,i=0,r=0){if(isNaN(e)||e<0||isNaN(t)||t<0||isNaN(i)||i<0||isNaN(r)||r<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=t,this.left=i,this.right=r}interpolate(e,i,r){return null!=i.top&&null!=e.top&&(this.top=t.B.number(e.top,i.top,r)),null!=i.bottom&&null!=e.bottom&&(this.bottom=t.B.number(e.bottom,i.bottom,r)),null!=i.left&&null!=e.left&&(this.left=t.B.number(e.left,i.left,r)),null!=i.right&&null!=e.right&&(this.right=t.B.number(e.right,i.right,r)),this}getCenter(e,i){const r=t.ae((this.left+e-this.right)/2,0,e),n=t.ae((this.top+i-this.bottom)/2,0,i);return new t.P(r,n)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new St(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Et(e,t){if(!e.renderWorldCopies||e.lngRange)return;const i=t.lng-e.center.lng;t.lng+=i>180?-360:i<-180?360:0}function Mt(e){return Math.max(0,Math.floor(e))}class It{constructor(e,i,r,n,o,s){this._callbacks=e,this._tileSize=512,this._renderWorldCopies=void 0===s||!!s,this._minZoom=i||0,this._maxZoom=r||22,this._minPitch=null==n?0:n,this._maxPitch=null==o?60:o,this.setMaxBounds(),this._width=0,this._height=0,this._center=new t.Q(0,0),this._elevation=0,this._zoom=0,this._tileZoom=Mt(this._zoom),this._scale=t.ac(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new St,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(e,i,r){this._latRange=e.latRange,this._lngRange=e.lngRange,this._width=e.width,this._height=e.height,this._center=e.center,this._elevation=e.elevation,this._minElevationForCurrentTile=e.minElevationForCurrentTile,this._zoom=e.zoom,this._tileZoom=Mt(this._zoom),this._scale=t.ac(this._zoom),this._bearingInRadians=e.bearingInRadians,this._fovInRadians=e.fovInRadians,this._pitchInRadians=e.pitchInRadians,this._rollInRadians=e.rollInRadians,this._unmodified=e.unmodified,this._edgeInsets=new St(e.padding.top,e.padding.bottom,e.padding.left,e.padding.right),this._minZoom=e.minZoom,this._maxZoom=e.maxZoom,this._minPitch=e.minPitch,this._maxPitch=e.maxPitch,this._renderWorldCopies=e.renderWorldCopies,this._cameraToCenterDistance=e.cameraToCenterDistance,this._nearZ=e.nearZ,this._farZ=e.farZ,this._autoCalculateNearFarZ=!r&&e.autoCalculateNearFarZ,i&&this._constrain(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(e){this._minElevationForCurrentTile=e}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(e){this._minZoom!==e&&(this._minZoom=e,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(e){this._minPitch!==e&&(this._minPitch=e,this.setPitch(Math.max(this.pitch,e)))}get maxPitch(){return this._maxPitch}setMaxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.setPitch(Math.min(this.pitch,e)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(e){void 0===e?e=!0:null===e&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new t.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(e){const i=t.aL(e,-180,180)*Math.PI/180;var n,o,s,a,l,c,u,h,d;this._bearingInRadians!==i&&(this._unmodified=!1,this._bearingInRadians=i,this._calcMatrices(),this._rotationMatrix=r(),n=this._rotationMatrix,s=-this._bearingInRadians,a=(o=this._rotationMatrix)[0],l=o[1],c=o[2],u=o[3],h=Math.sin(s),d=Math.cos(s),n[0]=a*d+c*h,n[1]=l*d+u*h,n[2]=a*-h+c*d,n[3]=l*-h+u*d)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(e){const i=t.ae(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==i&&(this._unmodified=!1,this._pitchInRadians=i,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(e){const t=e/180*Math.PI;this._rollInRadians!==t&&(this._unmodified=!1,this._rollInRadians=t,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return t.aM(this._fovInRadians)}setFov(e){e=t.ae(e,.1,150),this.fov!==e&&(this._unmodified=!1,this._fovInRadians=t.ab(e),this._calcMatrices())}get zoom(){return this._zoom}setZoom(e){const i=this.getConstrained(this._center,e).zoom;this._zoom!==i&&(this._unmodified=!1,this._zoom=i,this._tileZoom=Math.max(0,Math.floor(i)),this._scale=t.ac(i),this._constrain(),this._calcMatrices())}get center(){return this._center}setCenter(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(e){e!==this._elevation&&(this._elevation=e,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(e,t){this._autoCalculateNearFarZ=!1,this._nearZ=e,this._farZ=t,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,t,i){this._unmodified=!1,this._edgeInsets.interpolate(e,t,i),this._constrain(),this._calcMatrices()}resize(e,t,i=!0){this._width=e,this._height=t,i&&this._constrain(),this._calcMatrices()}getMaxBounds(){return this._latRange&&2===this._latRange.length&&this._lngRange&&2===this._lngRange.length?new H([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(e){e?(this._lngRange=[e.getWest(),e.getEast()],this._latRange=[e.getSouth(),e.getNorth()],this._constrain()):(this._lngRange=null,this._latRange=[-85.051129,t.af])}getConstrained(e,t){return this._callbacks.getConstrained(e,t)}getCameraQueryGeometry(e,i){if(1===i.length)return[i[0],e];{let r=e.x,n=e.y,o=e.x,s=e.y;for(const e of i)r=Math.min(r,e.x),n=Math.min(n,e.y),o=Math.max(o,e.x),s=Math.max(s,e.y);return[new t.P(r,n),new t.P(o,n),new t.P(o,s),new t.P(r,s),new t.P(r,n)]}}_constrain(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;const e=this._unmodified,{center:t,zoom:i}=this.getConstrained(this.center,this.zoom);this.setCenter(t),this.setZoom(i),this._unmodified=e,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let e=t.ad(new Float64Array(16));t.M(e,e,[this._width/2,-this._height/2,1]),t.L(e,e,[1,-1,0]),this._clipSpaceToPixelsMatrix=e,e=t.ad(new Float64Array(16)),t.M(e,e,[1,-1,1]),t.L(e,e,[-1,-1,0]),t.M(e,e,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=e,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(e,i,r,n){const o=void 0!==r?r:this.bearing,s=n=void 0!==n?n:this.pitch,a=t.$.fromLngLat(e,i),l=-Math.cos(t.ab(s)),c=Math.sin(t.ab(s)),u=c*Math.sin(t.ab(o)),h=-c*Math.cos(t.ab(o));let d=this.elevation;const p=i-d;let f;l*p>=0||Math.abs(l)<.1?(f=1e4,d=i+f*l):f=-p/l;let A,m,g=t.aN(1,a.y),_=0;do{if(_+=1,_>10)break;m=f/g,A=new t.$(a.x+u*m,a.y+h*m),g=1/A.meterInMercatorCoordinateUnits()}while(Math.abs(f-m*g)>1e-12);return{center:A.toLngLat(),elevation:d,zoom:t.ah(this.height/2/Math.tan(this.fovInRadians/2)/m/this.tileSize)}}recalculateZoomAndCenter(e){if(this.elevation-e==0)return;const i=t.ag(1,this.center.lat)*this.worldSize,r=this.cameraToCenterDistance/i,n=t.$.fromLngLat(this.center,this.elevation),o=pe(this.center,this.elevation,this.pitch,this.bearing,r);this._elevation=e;const s=this.calculateCenterFromCameraLngLatAlt(o.toLngLat(),t.aN(o.z,n.y),this.bearing,this.pitch);this._elevation=s.elevation,this._center=s.center,this.setZoom(s.zoom)}getCameraPoint(){const e=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new t.P(e*Math.sin(this.rollInRadians),e*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){const e=t.ag(1,this.center.lat)*this.worldSize;return pe(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/e).toLngLat()}getMercatorTileCoordinates(e){if(!e)return[0,0,1,1];const i=e.canonical.z>=0?1<<e.canonical.z:Math.pow(2,e.canonical.z);return[e.canonical.x/i,e.canonical.y/i,1/i/t.Z,1/i/t.Z]}}class Pt{constructor(e,i){this.min=e,this.max=i,this.center=t.aO([],t.aP([],this.min,this.max),.5)}quadrant(e){const i=[e%2==0,e<2],r=t.aQ(this.min),n=t.aQ(this.max);for(let e=0;e<i.length;e++)r[e]=i[e]?this.min[e]:this.center[e],n[e]=i[e]?this.center[e]:this.max[e];return n[2]=this.max[2],new Pt(r,n)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}intersectsFrustum(e){let t=!0;for(let i=0;i<e.planes.length;i++){const r=this.intersectsPlane(e.planes[i]);if(0===r)return 0;1===r&&(t=!1)}return t?2:e.aabb.min[0]>this.max[0]||e.aabb.min[1]>this.max[1]||e.aabb.min[2]>this.max[2]||e.aabb.max[0]<this.min[0]||e.aabb.max[1]<this.min[1]||e.aabb.max[2]<this.min[2]?0:1}intersectsPlane(e){let t=e[3],i=e[3];for(let r=0;r<3;r++)e[r]>0?(t+=e[r]*this.min[r],i+=e[r]*this.max[r]):(i+=e[r]*this.min[r],t+=e[r]*this.max[r]);return t>=0?2:i<0?0:1}}class Lt{distanceToTile2d(e,t,i,r){const n=r.distanceX([e,t]),o=r.distanceY([e,t]);return Math.hypot(n,o)}getWrap(e,t,i){return i}getTileAABB(e,i,r,n){var o,s;let a=r,l=r;if(n.terrain){const c=new t.Y(e.z,i,e.z,e.x,e.y),u=n.terrain.getMinMaxElevation(c);a=null!==(o=u.minElevation)&&void 0!==o?o:r,l=null!==(s=u.maxElevation)&&void 0!==s?s:r}const c=1<<e.z;return new Pt([i+e.x/c,e.y/c,a],[i+(e.x+1)/c,(e.y+1)/c,l])}allowVariableZoom(e,i){const r=e.fov*(Math.abs(Math.cos(e.rollInRadians))*e.height+Math.abs(Math.sin(e.rollInRadians))*e.width)/e.height,n=t.ae(78.5-r/2,0,60);return!!i.terrain||e.pitch>n}allowWorldCopies(){return!0}recalculateCache(){}}class Ft{constructor(e,t,i){this.points=e,this.planes=t,this.aabb=i}static fromInvProjectionMatrix(e,i=1,r=0){const n=Math.pow(2,r),o=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((r=>{const o=1/(r=t.at([],r,e))[3]/i*n;return t.aR(r,r,[o,o,1/r[3],o])})),s=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map((e=>{const i=t.aS([],o[e[0]],o[e[1]]),r=t.aS([],o[e[2]],o[e[1]]),n=t.aT([],t.aU([],i,r)),s=-t.aV(n,o[e[1]]);return n.concat(s)})),a=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],l=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(const e of o)for(let t=0;t<3;t++)a[t]=Math.min(a[t],e[t]),l[t]=Math.max(l[t],e[t]);return new Ft(o,s,new Pt(a,l))}}class kt{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,t,i){return this._helper.interpolatePadding(e,t,i)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,t,i=!0){this._helper.resize(e,t,i)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}overrideNearFarZ(e,t){this._helper.overrideNearFarZ(e,t)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(e,t){}constructor(e,t,i,r,n){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this._helper=new It({calcMatrices:()=>{this._calcMatrices()},getConstrained:(e,t)=>this.getConstrained(e,t)},e,t,i,r,n),this._coveringTilesDetailsProvider=new Lt}clone(){const e=new kt;return e.apply(this),e}apply(e,t,i){this._helper.apply(e,t,i)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(e){const i=[new t.aW(0,e)];if(this._helper._renderWorldCopies){const r=this.screenPointToMercatorCoordinate(new t.P(0,0)),n=this.screenPointToMercatorCoordinate(new t.P(this._helper._width,0)),o=this.screenPointToMercatorCoordinate(new t.P(this._helper._width,this._helper._height)),s=this.screenPointToMercatorCoordinate(new t.P(0,this._helper._height)),a=Math.floor(Math.min(r.x,n.x,o.x,s.x)),l=Math.floor(Math.max(r.x,n.x,o.x,s.x)),c=1;for(let r=a-c;r<=l+c;r++)0!==r&&i.push(new t.aW(r,e))}return i}getCameraFrustum(){return Ft.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(e){const t=this.screenPointToLocation(this.centerPoint,e),i=e?e.getElevationForLngLatZoom(t,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(i)}setLocationAtPoint(e,i){const r=t.ag(this.elevation,this.center.lat),n=this.screenPointToMercatorCoordinateAtZ(i,r),o=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,r),s=t.$.fromLngLat(e),a=new t.$(s.x-(n.x-o.x),s.y-(n.y-o.y));this.setCenter(null==a?void 0:a.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(e,i){return i?this.coordinatePoint(t.$.fromLngLat(e),i.getElevationForLngLatZoom(e,this._helper._tileZoom),this._pixelMatrix3D):this.coordinatePoint(t.$.fromLngLat(e))}screenPointToLocation(e,t){var i;return null===(i=this.screenPointToMercatorCoordinate(e,t))||void 0===i?void 0:i.toLngLat()}screenPointToMercatorCoordinate(e,t){if(t){const i=t.pointCoordinate(e);if(null!=i)return i}return this.screenPointToMercatorCoordinateAtZ(e)}screenPointToMercatorCoordinateAtZ(e,i){const r=i||0,n=[e.x,e.y,0,1],o=[e.x,e.y,1,1];t.at(n,n,this._pixelMatrixInverse),t.at(o,o,this._pixelMatrixInverse);const s=n[3],a=o[3],l=n[1]/s,c=o[1]/a,u=n[2]/s,h=o[2]/a,d=u===h?0:(r-u)/(h-u);return new t.$(t.B.number(n[0]/s,o[0]/a,d)/this.worldSize,t.B.number(l,c,d)/this.worldSize,r)}coordinatePoint(e,i=0,r=this._pixelMatrix){const n=[e.x*this.worldSize,e.y*this.worldSize,i,1];return t.at(n,n,r),new t.P(n[0]/n[3],n[1]/n[3])}getBounds(){const e=Math.max(0,this._helper._height/2-he(this));return(new H).extend(this.screenPointToLocation(new t.P(0,e))).extend(this.screenPointToLocation(new t.P(this._helper._width,e))).extend(this.screenPointToLocation(new t.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new t.P(0,this._helper._height)))}isPointOnMapSurface(e,t){return t?null!=t.pointCoordinate(e):e.y>this.height/2-he(this)}calculatePosMatrix(e,i=!1,r){var n;const o=null!==(n=e.key)&&void 0!==n?n:t.aX(e.wrap,e.canonical.z,e.canonical.z,e.canonical.x,e.canonical.y),s=i?this._alignedPosMatrixCache:this._posMatrixCache;if(s.has(o)){const e=s.get(o);return r?e.f32:e.f64}const a=de(e,this.worldSize);t.N(a,i?this._alignedProjMatrix:this._viewProjMatrix,a);const l={f64:a,f32:new Float32Array(a)};return s.set(o,l),r?l.f32:l.f64}calculateFogMatrix(e){const i=e.key,r=this._fogMatrixCacheF32;if(r.has(i))return r.get(i);const n=de(e,this.worldSize);return t.N(n,this._fogMatrix,n),r.set(i,new Float32Array(n)),r.get(i)}getConstrained(e,i){i=t.ae(+i,this.minZoom,this.maxZoom);const r={center:new t.Q(e.lng,e.lat),zoom:i};let n=this._helper._lngRange;this._helper._renderWorldCopies||null!==n||(n=[-179.9999999999,180-1e-10]);const o=this.tileSize*t.ac(r.zoom);let s=0,a=o,l=0,c=o,u=0,h=0;const{x:d,y:p}=this.size;if(this._helper._latRange){const e=this._helper._latRange;s=t.S(e[1])*o,a=t.S(e[0])*o,a-s<p&&(u=p/(a-s))}n&&(l=t.aL(t.U(n[0])*o,0,o),c=t.aL(t.U(n[1])*o,0,o),c<l&&(c+=o),c-l<d&&(h=d/(c-l)));const{x:f,y:A}=ce(o,e);let m,g;const _=Math.max(h||0,u||0);if(_){const e=new t.P(h?(c+l)/2:f,u?(a+s)/2:A);return r.center=ue(o,e).wrap(),r.zoom+=t.ah(_),r}if(this._helper._latRange){const e=p/2;A-e<s&&(g=s+e),A+e>a&&(g=a-e)}if(n){const e=(l+c)/2;let i=f;this._helper._renderWorldCopies&&(i=t.aL(f,e-o/2,e+o/2));const r=d/2;i-r<l&&(m=l+r),i+r>c&&(m=c-r)}if(void 0!==m||void 0!==g){const e=new t.P(null!=m?m:f,null!=g?g:A);r.center=ue(o,e).wrap()}return r}calculateCenterFromCameraLngLatAlt(e,t,i,r){return this._helper.calculateCenterFromCameraLngLatAlt(e,t,i,r)}_calculateNearFarZIfNeeded(e,i,r){if(!this._helper.autoCalculateNearFarZ)return;const n=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),o=e-n*this._helper._pixelPerMeter/Math.cos(i),s=n<0?o:e,a=Math.PI/2+this.pitchInRadians,l=t.ab(this.fov)*(Math.abs(Math.cos(t.ab(this.roll)))*this.height+Math.abs(Math.sin(t.ab(this.roll)))*this.width)/this.height*(.5+r.y/this.height),c=Math.sin(l)*s/Math.sin(t.ae(Math.PI-a-l,.01,Math.PI-.01)),u=he(this),h=Math.atan(u/this._helper.cameraToCenterDistance),d=t.ab(.75),p=h>d?2*h*(.5+r.y/(2*u)):d,f=Math.sin(p)*s/Math.sin(t.ae(Math.PI-a-p,.01,Math.PI-.01)),A=Math.min(c,f);this._helper._farZ=1.01*(Math.cos(Math.PI/2-i)*A+s),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;const e=this.centerOffset,i=ce(this.worldSize,this.center),r=i.x,n=i.y;this._helper._pixelPerMeter=t.ag(1,this.center.lat)*this.worldSize;const o=t.ab(Math.min(this.pitch,le)),s=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(o));let a;this._calculateNearFarZIfNeeded(s,o,e),a=new Float64Array(16),t.aY(a,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),t.an(this._invProjMatrix,a),a[8]=2*-e.x/this._helper._width,a[9]=2*e.y/this._helper._height,this._projectionMatrix=t.aZ(a),t.M(a,a,[1,-1,1]),t.L(a,a,[0,0,-this._helper.cameraToCenterDistance]),t.a_(a,a,-this.rollInRadians),t.a$(a,a,this.pitchInRadians),t.a_(a,a,-this.bearingInRadians),t.L(a,a,[-r,-n,0]),this._mercatorMatrix=t.M([],a,[this.worldSize,this.worldSize,this.worldSize]),t.M(a,a,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=t.N(new Float64Array(16),this.clipSpaceToPixelsMatrix,a),t.L(a,a,[0,0,-this.elevation]),this._viewProjMatrix=a,this._invViewProjMatrix=t.an([],a);const l=[0,0,-1,1];t.at(l,l,this._invViewProjMatrix),this._cameraPosition=[l[0]/l[3],l[1]/l[3],l[2]/l[3]],this._fogMatrix=new Float64Array(16),t.aY(this._fogMatrix,this.fovInRadians,this.width/this.height,s,this._helper._farZ),this._fogMatrix[8]=2*-e.x/this.width,this._fogMatrix[9]=2*e.y/this.height,t.M(this._fogMatrix,this._fogMatrix,[1,-1,1]),t.L(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),t.a_(this._fogMatrix,this._fogMatrix,-this.rollInRadians),t.a$(this._fogMatrix,this._fogMatrix,this.pitchInRadians),t.a_(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),t.L(this._fogMatrix,this._fogMatrix,[-r,-n,0]),t.M(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),t.L(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=t.N(new Float64Array(16),this.clipSpaceToPixelsMatrix,a);const c=this._helper._width%2/2,u=this._helper._height%2/2,h=Math.cos(this.bearingInRadians),d=Math.sin(-this.bearingInRadians),p=r-Math.round(r)+h*c+d*u,f=n-Math.round(n)+h*u+d*c,A=new Float64Array(a);if(t.L(A,A,[p>.5?p-1:p,f>.5?f-1:f,0]),this._alignedProjMatrix=A,a=t.an(new Float64Array(16),this._pixelMatrix),!a)throw new Error("failed to invert matrix");this._pixelMatrixInverse=a,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;const e=this.screenPointToMercatorCoordinate(new t.P(0,0)),i=[e.x*this.worldSize,e.y*this.worldSize,0,1];return t.at(i,i,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){const e=t.ag(1,this.center.lat)*this.worldSize;return pe(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/e).toLngLat()}lngLatToCameraDepth(e,i){const r=t.$.fromLngLat(e),n=[r.x*this.worldSize,r.y*this.worldSize,i,1];return t.at(n,n,this._viewProjMatrix),n[2]/n[3]}getProjectionData(e){const{overscaledTileID:i,aligned:r,applyTerrainMatrix:n}=e,o=this._helper.getMercatorTileCoordinates(i),s=i?this.calculatePosMatrix(i,r,!0):null;let a;return a=i&&i.terrainRttPosMatrix32f&&n?i.terrainRttPosMatrix32f:s||t.b0(),{mainMatrix:a,tileMercatorCoords:o,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:a}}isLocationOccluded(e){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(e,t,i){return 1}transformLightDirection(e){return t.aQ(e)}getRayDirectionFromPixel(e){throw new Error("Not implemented.")}projectTileCoordinates(e,i,r,n){const o=this.calculatePosMatrix(r);let s;n?(s=[e,i,n(e,i),1],t.at(s,s,o)):(s=[e,i,0,1],$e(s,s,o));const a=s[3];return{point:new t.P(s[0]/a,s[1]/a),signedDistanceFromCamera:a,isOccluded:!1}}populateCache(e){for(const t of e)this.calculatePosMatrix(t)}getMatrixForModel(e,i){const r=t.$.fromLngLat(e,i),n=r.meterInMercatorCoordinateUnits(),o=t.b1();return t.L(o,o,[r.x,r.y,r.z]),t.a_(o,o,Math.PI),t.a$(o,o,Math.PI/2),t.M(o,o,[-n,n,n]),o}getProjectionDataForCustomLayer(e=!0){const i=new t.Y(0,0,0,0,0),r=this.getProjectionData({overscaledTileID:i,applyGlobeMatrix:e}),n=de(i,this.worldSize);t.N(n,this._viewProjMatrix,n),r.tileMercatorCoords=[0,0,1,1];const o=[t.Z,t.Z,this.worldSize/this._helper.pixelsPerMeter],s=t.b2();return t.M(s,n,o),r.fallbackMatrix=s,r.mainMatrix=s,r}getFastPathSimpleProjectionMatrix(e){return this.calculatePosMatrix(e)}}function zt(){t.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function Rt(e){if(e.useSlerp)if(e.k<1){const i=t.b3(e.startEulerAngles.roll,e.startEulerAngles.pitch,e.startEulerAngles.bearing),r=t.b3(e.endEulerAngles.roll,e.endEulerAngles.pitch,e.endEulerAngles.bearing),n=new Float64Array(4);t.b4(n,i,r,e.k);const o=t.b5(n);e.tr.setRoll(o.roll),e.tr.setPitch(o.pitch),e.tr.setBearing(o.bearing)}else e.tr.setRoll(e.endEulerAngles.roll),e.tr.setPitch(e.endEulerAngles.pitch),e.tr.setBearing(e.endEulerAngles.bearing);else e.tr.setRoll(t.B.number(e.startEulerAngles.roll,e.endEulerAngles.roll,e.k)),e.tr.setPitch(t.B.number(e.startEulerAngles.pitch,e.endEulerAngles.pitch,e.k)),e.tr.setBearing(t.B.number(e.startEulerAngles.bearing,e.endEulerAngles.bearing,e.k))}function Dt(e,i,r,n,o){const s=o.padding,a=ce(o.worldSize,r.getNorthWest()),l=ce(o.worldSize,r.getNorthEast()),c=ce(o.worldSize,r.getSouthEast()),u=ce(o.worldSize,r.getSouthWest()),h=t.ab(-n),d=a.rotate(h),p=l.rotate(h),f=c.rotate(h),A=u.rotate(h),m=new t.P(Math.max(d.x,p.x,A.x,f.x),Math.max(d.y,p.y,A.y,f.y)),g=new t.P(Math.min(d.x,p.x,A.x,f.x),Math.min(d.y,p.y,A.y,f.y)),_=m.sub(g),y=(o.width-(s.left+s.right+i.left+i.right))/_.x,v=(o.height-(s.top+s.bottom+i.top+i.bottom))/_.y;if(v<0||y<0)return void zt();const x=Math.min(t.ah(o.scale*Math.min(y,v)),e.maxZoom),b=t.P.convert(e.offset),w=new t.P((i.left-i.right)/2,(i.top-i.bottom)/2).rotate(t.ab(n)),T=b.add(w).mult(o.scale/t.ac(x));return{center:ue(o.worldSize,a.add(c).div(2).sub(T)),zoom:x,bearing:n}}class Ot{get useGlobeControls(){return!1}handlePanInertia(e,t){return{easingOffset:e,easingCenter:t.center}}handleMapControlsRollPitchBearingZoom(e,t){e.bearingDelta&&t.setBearing(t.bearing+e.bearingDelta),e.pitchDelta&&t.setPitch(t.pitch+e.pitchDelta),e.rollDelta&&t.setRoll(t.roll+e.rollDelta),e.zoomDelta&&t.setZoom(t.zoom+e.zoomDelta)}handleMapControlsPan(e,t,i){e.around.distSqr(t.centerPoint)<.01||t.setLocationAtPoint(i,e.around)}cameraForBoxAndBearing(e,t,i,r,n){return Dt(e,t,i,r,n)}handleJumpToCenterZoom(e,i){e.zoom!==(void 0!==i.zoom?+i.zoom:e.zoom)&&e.setZoom(+i.zoom),void 0!==i.center&&e.setCenter(t.Q.convert(i.center))}handleEaseTo(e,i){const r=e.zoom,n=e.padding,o={roll:e.roll,pitch:e.pitch,bearing:e.bearing},s={roll:void 0===i.roll?e.roll:i.roll,pitch:void 0===i.pitch?e.pitch:i.pitch,bearing:void 0===i.bearing?e.bearing:i.bearing},a=void 0!==i.zoom,l=!e.isPaddingEqual(i.padding);let c=!1;const u=a?+i.zoom:e.zoom;let h=e.centerPoint.add(i.offsetAsPoint);const d=e.screenPointToLocation(h),{center:p,zoom:f}=e.getConstrained(t.Q.convert(i.center||d),null!=u?u:r);Et(e,p);const A=ce(e.worldSize,d),m=ce(e.worldSize,p).sub(A),g=t.ac(f-r);return c=f!==r,{easeFunc:a=>{if(c&&e.setZoom(t.B.number(r,f,a)),t.b6(o,s)||Rt({startEulerAngles:o,endEulerAngles:s,tr:e,k:a,useSlerp:o.roll!=s.roll}),l&&(e.interpolatePadding(n,i.padding,a),h=e.centerPoint.add(i.offsetAsPoint)),i.around)e.setLocationAtPoint(i.around,i.aroundPoint);else{const i=t.ac(e.zoom-r),n=f>r?Math.min(2,g):Math.max(.5,g),o=Math.pow(n,1-a),s=ue(e.worldSize,A.add(m.mult(a*o)).mult(i));e.setLocationAtPoint(e.renderWorldCopies?s.wrap():s,h)}},isZooming:c,elevationCenter:p}}handleFlyTo(e,i){const r=void 0!==i.zoom,n=e.zoom,o=e.getConstrained(t.Q.convert(i.center||i.locationAtOffset),r?+i.zoom:n),s=o.center,a=o.zoom;Et(e,s);const l=ce(e.worldSize,i.locationAtOffset),c=ce(e.worldSize,s).sub(l),u=c.mag(),h=t.ac(a-n);let d;if(void 0!==i.minZoom){const r=Math.min(+i.minZoom,n,a),o=e.getConstrained(s,r).zoom;d=t.ac(o-n)}return{easeFunc:(i,r,o,u)=>{e.setZoom(1===i?a:n+t.ah(r));const h=1===i?s:ue(e.worldSize,l.add(c.mult(o)).mult(r));e.setLocationAtPoint(e.renderWorldCopies?h.wrap():h,u)},scaleOfZoom:h,targetCenter:s,scaleOfMinZoom:d,pixelPathLength:u}}}class Ut{constructor(e,t,i){this.blendFunction=e,this.blendColor=t,this.mask=i}}Ut.Replace=[1,0],Ut.disabled=new Ut(Ut.Replace,t.b7.transparent,[!1,!1,!1,!1]),Ut.unblended=new Ut(Ut.Replace,t.b7.transparent,[!0,!0,!0,!0]),Ut.alphaBlended=new Ut([1,771],t.b7.transparent,[!0,!0,!0,!0]);const Nt=2305;class Qt{constructor(e,t,i){this.enable=e,this.mode=t,this.frontFace=i}}Qt.disabled=new Qt(!1,1029,Nt),Qt.backCCW=new Qt(!0,1029,Nt),Qt.frontCCW=new Qt(!0,1028,Nt);class jt{constructor(e,t,i){this.func=e,this.mask=t,this.range=i}}jt.ReadOnly=!1,jt.ReadWrite=!0,jt.disabled=new jt(519,jt.ReadOnly,[0,1]);const Vt=7680;class Ht{constructor(e,t,i,r,n,o){this.test=e,this.ref=t,this.mask=i,this.fail=r,this.depthFail=n,this.pass=o}}Ht.disabled=new Ht({func:519,mask:0},0,0,Vt,Vt,Vt);const Gt=new WeakMap;function $t(e){var t;if(Gt.has(e))return Gt.get(e);{const i=null===(t=e.getParameter(e.VERSION))||void 0===t?void 0:t.startsWith("WebGL 2.0");return Gt.set(e,i),i}}class Zt{get awaitingQuery(){return!!this._readbackQueue}constructor(e){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=e;const i=e.context,r=i.gl;this._texFormat=r.RGBA,this._texType=r.UNSIGNED_BYTE;const n=new t.aI;n.emplaceBack(-1,-1),n.emplaceBack(2,-1),n.emplaceBack(-1,2);const o=new t.aK;o.emplaceBack(0,1,2),this._fullscreenTriangle=new bt(i.createVertexBuffer(n,wt.members),i.createIndexBuffer(o),t.aJ.simpleSegment(0,0,n.length,o.length)),this._resultBuffer=new Uint8Array(4),i.activeTexture.set(r.TEXTURE1);const s=r.createTexture();r.bindTexture(r.TEXTURE_2D,s),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.NEAREST),r.texImage2D(r.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=i.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(s),$t(r)&&(this._pbo=r.createBuffer(),r.bindBuffer(r.PIXEL_PACK_BUFFER,this._pbo),r.bufferData(r.PIXEL_PACK_BUFFER,4,r.STREAM_READ),r.bindBuffer(r.PIXEL_PACK_BUFFER,null))}destroy(){const e=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),e.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(e,t){const i=this._updateCount;return this._readbackQueue?i>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():i>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(e,t),this._updateCount++,this._measuredError}_bindFramebuffer(){const e=this._cachedRenderContext.context,t=e.gl;e.activeTexture.set(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,this._fbo.colorAttachment.get()),e.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(e,i){const r=this._cachedRenderContext.context,n=r.gl;if(this._bindFramebuffer(),r.viewport.set([0,0,this._texWidth,this._texHeight]),r.clear({color:t.b7.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(r,n.TRIANGLES,jt.disabled,Ht.disabled,Ut.unblended,Qt.disabled,((e,t)=>({u_input:e,u_output_expected:t}))(e,i),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&$t(n)){n.bindBuffer(n.PIXEL_PACK_BUFFER,this._pbo),n.readBuffer(n.COLOR_ATTACHMENT0),n.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),n.bindBuffer(n.PIXEL_PACK_BUFFER,null);const e=n.fenceSync(n.SYNC_GPU_COMMANDS_COMPLETE,0);n.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:e}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){const e=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&$t(e)){const i=e.clientWaitSync(this._readbackQueue.sync,0,0);if(i===e.WAIT_FAILED)return t.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(i===e.TIMEOUT_EXPIRED)return;e.bindBuffer(e.PIXEL_PACK_BUFFER,this._pbo),e.getBufferSubData(e.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),e.bindBuffer(e.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),e.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=Zt._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(e){let t=0;return t+=e[0]/256,t+=e[1]/65536,t+=e[2]/16777216,e[3]<127&&(t=-t),t/128}}const qt=t.Z/128;function Kt(e,i){const r=void 0!==e.granularity?Math.max(e.granularity,1):1,n=r+(e.generateBorders?2:0),o=r+(e.extendToNorthPole||e.generateBorders?1:0)+(e.extendToSouthPole||e.generateBorders?1:0),s=n+1,a=o+1,l=e.generateBorders?-1:0,c=e.generateBorders||e.extendToNorthPole?-1:0,u=r+(e.generateBorders?1:0),h=r+(e.generateBorders||e.extendToSouthPole?1:0),d=s*a,p=n*o*6,f=s*a>65536;if(f&&"16bit"===i)throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");const A=f||"32bit"===i,m=new Int16Array(2*d);let g=0;for(let i=c;i<=h;i++)for(let n=l;n<=u;n++){let o=n/r*t.Z;-1===n&&(o=-64),n===r+1&&(o=t.Z+qt);let s=i/r*t.Z;-1===i&&(s=e.extendToNorthPole?t.b9:-64),i===r+1&&(s=e.extendToSouthPole?t.ba:t.Z+qt),m[g++]=o,m[g++]=s}const _=A?new Uint32Array(p):new Uint16Array(p);let y=0;for(let e=0;e<o;e++)for(let t=0;t<n;t++){const i=t+1+e*s,r=t+(e+1)*s,n=t+1+(e+1)*s;_[y++]=t+e*s,_[y++]=r,_[y++]=i,_[y++]=i,_[y++]=r,_[y++]=n}return{vertices:m.buffer.slice(0),indices:_.buffer.slice(0),uses32bitIndices:A}}const Wt=new t.aH({fill:new t.bb(128,2),line:new t.bb(512,0),tile:new t.bb(128,32),stencil:new t.bb(128,1),circle:3});class Xt{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return vt.projectionGlobe}get vertexShaderPreludeCode(){return vt.projectionMercator.vertexSource}get subdivisionGranularity(){return Wt}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(e){this._errorMeasurement||(this._errorMeasurement=new Zt(e));const i=t.S(this._errorQueryLatitudeDegrees),r=2*Math.atan(Math.exp(Math.PI-i*Math.PI*2))-.5*Math.PI,n=this._errorMeasurement.updateErrorLoop(i,r),o=s.now();n!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=n,this._errorMeasurementLastChangeTime=o);const a=Math.min(Math.max((o-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=t.bc(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,t.bd(a))}_getMeshKey(e){return`${e.granularity.toString(36)}_${e.generateBorders?"b":""}${e.extendToNorthPole?"n":""}${e.extendToSouthPole?"s":""}`}getMeshFromTileID(e,t,i,r,n){const o=("stencil"===n?Wt.stencil:Wt.tile).getGranularityForZoomLevel(t.z);return this._getMesh(e,{granularity:o,generateBorders:i,extendToNorthPole:0===t.y&&r,extendToSouthPole:t.y===(1<<t.z)-1&&r})}_getMesh(e,i){const r=this._getMeshKey(i);if(r in this._tileMeshCache)return this._tileMeshCache[r];const n=function(e,i){const r=Kt(i,"16bit"),n=t.aI.deserialize({arrayBuffer:r.vertices,length:r.vertices.byteLength/2/2}),o=t.aK.deserialize({arrayBuffer:r.indices,length:r.indices.byteLength/2/3});return new bt(e.createVertexBuffer(n,wt.members),e.createIndexBuffer(o),t.aJ.simpleSegment(0,0,n.length,o.length))}(e,i);return this._tileMeshCache[r]=n,n}recalculate(e){}hasTransition(){const e=s.now();let t=!1;return t=t||(e-this._errorMeasurementLastChangeTime)/1e3<.7,t=t||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,t}setErrorQueryLatitudeDegrees(e){this._errorQueryLatitudeDegrees=e}}const Yt=new t.r({type:new t.D(t.v.projection.type)});class Jt extends t.E{constructor(e){super(),this._transitionable=new t.T(Yt),this.setProjection(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new t.C(0)),this._mercatorProjection=new Ct,this._verticalPerspectiveProjection=new Xt}get transitionState(){const e=this.properties.get("type");if("string"==typeof e&&"mercator"===e)return 0;if("string"==typeof e&&"vertical-perspective"===e)return 1;if(e instanceof t.be){if("vertical-perspective"===e.from&&"mercator"===e.to)return 1-e.transition;if("mercator"===e.from&&"vertical-perspective"===e.to)return e.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(e){this._mercatorProjection.updateGPUdependent(e),this._verticalPerspectiveProjection.updateGPUdependent(e)}getMeshFromTileID(e,t,i,r,n){return this.currentProjection.getMeshFromTileID(e,t,i,r,n)}setProjection(e){this._transitionable.setValue("type",(null==e?void 0:e.type)||"mercator")}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}setErrorQueryLatitudeDegrees(e){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(e),this._mercatorProjection.setErrorQueryLatitudeDegrees(e)}}function ei(e){const t=ri(e.worldSize,e.center.lat);return 2*Math.PI*t}function ti(e,i,r,n,o){const s=1/(1<<o),a=i/t.Z*s+n*s,l=t.bg((e/t.Z*s+r*s)*Math.PI*2+Math.PI,2*Math.PI),c=2*Math.atan(Math.exp(Math.PI-a*Math.PI*2))-.5*Math.PI,u=Math.cos(c),h=new Float64Array(3);return h[0]=Math.sin(l)*u,h[1]=Math.sin(c),h[2]=Math.cos(l)*u,h}function ii(e){return function(e,t){const i=Math.cos(t),r=new Float64Array(3);return r[0]=Math.sin(e)*i,r[1]=Math.sin(t),r[2]=Math.cos(e)*i,r}(e.lng*Math.PI/180,e.lat*Math.PI/180)}function ri(e,t){return e/(2*Math.PI)/Math.cos(t*Math.PI/180)}function ni(e){const i=Math.asin(e[1])/Math.PI*180,r=Math.sqrt(e[0]*e[0]+e[2]*e[2]);if(r>1e-6){const n=e[0]/r,o=Math.acos(e[2]/r),s=(n>0?o:-o)/Math.PI*180;return new t.Q(t.aL(s,-180,180),i)}return new t.Q(0,i)}function oi(e){return Math.cos(e*Math.PI/180)}function si(e,i){const r=oi(e),n=oi(i);return t.ah(n/r)}function ai(e,i){const r=e.rotate(i.bearingInRadians),n=i.zoom+si(i.center.lat,0),o=t.bc(1/oi(i.center.lat),1/oi(Math.min(Math.abs(i.center.lat),60)),t.bf(n,7,3,0,1)),s=360/ei({worldSize:i.worldSize,center:{lat:i.center.lat}});return new t.Q(i.center.lng-r.x*s*o,t.ae(i.center.lat+r.y*s,-85.051129,t.af))}function li(e){const t=.5*e,i=Math.sin(t),r=Math.cos(t);return Math.log(i+r)-Math.log(r-i)}function ci(e,i,r,n){const o=e.lat+r*n;if(Math.abs(r)>1){const s=(Math.sign(e.lat+r)!==Math.sign(e.lat)?-Math.abs(e.lat):Math.abs(e.lat))*Math.PI/180,a=Math.abs(e.lat+r)*Math.PI/180,l=li(s+n*(a-s)),c=li(s),u=li(a);return new t.Q(e.lng+i*((l-c)/(u-c)),o)}return new t.Q(e.lng+i*n,o)}class ui{constructor(e){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._aabbFactory=e}recalculateCache(){if(!this._hadAnyChanges)return;const e=this._cachePrevious;this._cachePrevious=this._cache,this._cache=e,this._cache.clear(),this._hadAnyChanges=!1}getTileAABB(e,t,i,r){const n=`${e.z}_${e.x}_${e.y}`,o=this._cache.get(n);if(o)return o;const s=this._cachePrevious.get(n);if(s)return this._cache.set(n,s),s;const a=this._aabbFactory(e,t,i,r);return this._cache.set(n,a),this._hadAnyChanges=!0,a}}function hi(e,t,i){const r=e-t;return r<0?-r:Math.max(0,r-i)}function di(e,t,i,r,n){const o=e-i;let s;return s=o<0?Math.min(-o,1+o-n):o>1?Math.min(Math.max(o-n,0),1-o):0,Math.max(s,hi(t,r,n))}class pi{constructor(){this._aabbCache=new ui(this._computeTileAABB)}recalculateCache(){this._aabbCache.recalculateCache()}distanceToTile2d(e,t,i,r){const n=1<<i.z,o=1/n,s=i.x/n,a=i.y/n;let l=2;return l=Math.min(l,di(e,t,s,a,o)),l=Math.min(l,di(e,t,s+.5,-a-o,o)),l=Math.min(l,di(e,t,s+.5,2-a-o,o)),l}getWrap(e,t,i){const r=1<<t.z,n=1/r,o=t.x/r,s=hi(e.x,o,n),a=hi(e.x,o-1,n),l=hi(e.x,o+1,n),c=Math.min(s,a,l);return c===l?1:c===a?-1:0}allowVariableZoom(e,t){return _e(e,t)>4}allowWorldCopies(){return!1}getTileAABB(e,t,i,r){return this._aabbCache.getTileAABB(e,t,i,r)}_computeTileAABB(e,i,r,n){if(e.z<=0)return new Pt([-1,-1,-1],[1,1,1]);if(1===e.z)return new Pt([0===e.x?-1:0,0===e.y?0:-1,-1],[0===e.x?0:1,0===e.y?1:0,1]);{const i=[ti(0,0,e.x,e.y,e.z),ti(t.Z,0,e.x,e.y,e.z),ti(t.Z,t.Z,e.x,e.y,e.z),ti(0,t.Z,e.x,e.y,e.z)],r=[1,1,1],n=[-1,-1,-1];for(const e of i)for(let t=0;t<3;t++)r[t]=Math.min(r[t],e[t]),n[t]=Math.max(n[t],e[t]);if(0===e.y||e.y===(1<<e.z)-1){const t=[0,0===e.y?1:-1,0];for(let e=0;e<3;e++)r[e]=Math.min(r[e],t[e]),n[e]=Math.max(n[e],t[e])}return new Pt(r,n)}}}class fi{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,t,i){return this._helper.interpolatePadding(e,t,i)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,t){this._helper.resize(e,t)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}overrideNearFarZ(e,t){this._helper.overrideNearFarZ(e,t)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(e){}constructor(){this._cachedClippingPlane=t.bk(),this._projectionMatrix=t.b1(),this._globeViewProjMatrix32f=t.b0(),this._globeViewProjMatrixNoCorrection=t.b1(),this._globeViewProjMatrixNoCorrectionInverted=t.b1(),this._globeProjMatrixInverted=t.b1(),this._cameraPosition=t.bh(),this._globeLatitudeErrorCorrectionRadians=0,this._helper=new It({calcMatrices:()=>{this._calcMatrices()},getConstrained:(e,t)=>this.getConstrained(e,t)}),this._coveringTilesDetailsProvider=new pi}clone(){const e=new fi;return e.apply(this),e}apply(e,t){this._globeLatitudeErrorCorrectionRadians=t||0,this._helper.apply(e)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){const e=t.bh();return e[0]=this._cameraPosition[0],e[1]=this._cameraPosition[1],e[2]=this._cameraPosition[2],e}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(e){const{overscaledTileID:t,applyGlobeMatrix:i}=e,r=this._helper.getMercatorTileCoordinates(t);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:r,clippingPlane:this._cachedClippingPlane,projectionTransition:i?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(e){const i=this.pitchInRadians,r=this.cameraToCenterDistance/e,n=Math.sin(i)*r,o=Math.cos(i)*r+1,s=1/Math.sqrt(n*n+o*o)*1;let a=-n,l=o;const c=Math.sqrt(a*a+l*l);a/=c,l/=c;const u=[0,a,l];t.bl(u,u,[0,0,0],-this.bearingInRadians),t.bm(u,u,[0,0,0],-1*this.center.lat*Math.PI/180),t.bn(u,u,[0,0,0],this.center.lng*Math.PI/180);const h=1/t.bo(u);return t.aO(u,u,h),[...u,-s*h]}isLocationOccluded(e){return!this.isSurfacePointVisible(ii(e))}transformLightDirection(e){const i=this._helper._center.lng*Math.PI/180,r=this._helper._center.lat*Math.PI/180,n=Math.cos(r),o=[Math.sin(i)*n,Math.sin(r),Math.cos(i)*n],s=[o[2],0,-o[0]],a=[0,0,0];t.aU(a,s,o),t.aT(s,s),t.aT(a,a);const l=[0,0,0];return t.aT(l,[s[0]*e[0]+a[0]*e[1]+o[0]*e[2],s[1]*e[0]+a[1]*e[1]+o[1]*e[2],s[2]*e[0]+a[2]*e[1]+o[2]*e[2]]),l}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(e,i,r){const n=function(e,i,r){const n=1/(1<<r.z);return new t.$(e/t.Z*n+r.x*n,i/t.Z*n+r.y*n)}(e,i,r.canonical),o=(s=n.y,[t.bg(n.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-s*Math.PI*2))-.5*Math.PI]);var s;return this.getCircleRadiusCorrection()/Math.cos(o[1])}projectTileCoordinates(e,i,r,n){const o=r.canonical,s=ti(e,i,o.x,o.y,o.z),a=1+(n?n(e,i):0)/t.bu,l=[s[0]*a,s[1]*a,s[2]*a,1];t.at(l,l,this._globeViewProjMatrixNoCorrection);const c=this._cachedClippingPlane,u=c[0]*s[0]+c[1]*s[1]+c[2]*s[2]+c[3]<0;return{point:new t.P(l[0]/l[3],l[1]/l[3]),signedDistanceFromCamera:l[3],isOccluded:u}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;const e=ri(this.worldSize,this.center.lat),i=t.b2(),r=t.b2();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*e),t.aY(i,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);const n=this.centerOffset;i[8]=2*-n.x/this._helper._width,i[9]=2*n.y/this._helper._height,this._projectionMatrix=t.aZ(i),this._globeProjMatrixInverted=t.b2(),t.an(this._globeProjMatrixInverted,i),t.L(i,i,[0,0,-this.cameraToCenterDistance]),t.a_(i,i,this.rollInRadians),t.a$(i,i,-this.pitchInRadians),t.a_(i,i,this.bearingInRadians),t.L(i,i,[0,0,-e]);const o=t.bh();o[0]=e,o[1]=e,o[2]=e,t.a$(r,i,this.center.lat*Math.PI/180),t.bp(r,r,-this.center.lng*Math.PI/180),t.M(r,r,o),this._globeViewProjMatrixNoCorrection=r,t.a$(i,i,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),t.bp(i,i,-this.center.lng*Math.PI/180),t.M(i,i,o),this._globeViewProjMatrix32f=new Float32Array(i),this._globeViewProjMatrixNoCorrectionInverted=t.b2(),t.an(this._globeViewProjMatrixNoCorrectionInverted,r);const s=t.bh();this._cameraPosition=t.bh(),this._cameraPosition[2]=this.cameraToCenterDistance/e,t.bl(this._cameraPosition,this._cameraPosition,s,-this.rollInRadians),t.bm(this._cameraPosition,this._cameraPosition,s,this.pitchInRadians),t.bl(this._cameraPosition,this._cameraPosition,s,-this.bearingInRadians),t.aP(this._cameraPosition,this._cameraPosition,[0,0,1]),t.bm(this._cameraPosition,this._cameraPosition,s,-this.center.lat*Math.PI/180),t.bn(this._cameraPosition,this._cameraPosition,s,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(e);const a=t.aZ(this._globeViewProjMatrixNoCorrectionInverted);t.M(a,a,[1,1,-1]),this._cachedFrustum=Ft.fromInvProjectionMatrix(a)}calculateFogMatrix(e){t.w("calculateFogMatrix is not supported on globe projection.");const i=t.b2();return t.ad(i),i}getVisibleUnwrappedCoordinates(e){return[new t.aW(0,e)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(e){e&&t.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(e,i){if(!this._globeViewProjMatrixNoCorrection)return 1;const r=ii(e);t.aO(r,r,1+i/t.bu);const n=t.bk();return t.at(n,[r[0],r[1],r[2],1],this._globeViewProjMatrixNoCorrection),n[2]/n[3]}populateCache(e){}getBounds(){const e=.5*this.width,i=.5*this.height,r=[new t.P(0,0),new t.P(e,0),new t.P(this.width,0),new t.P(this.width,i),new t.P(this.width,this.height),new t.P(e,this.height),new t.P(0,this.height),new t.P(0,i)],n=[];for(const e of r)n.push(this.unprojectScreenPoint(e));let o=0,s=0,a=0,l=0;const c=this.center;for(const e of n){const i=t.bq(c.lng,e.lng),r=t.bq(c.lat,e.lat);i<s&&(s=i),i>o&&(o=i),r<l&&(l=r),r>a&&(a=r)}const u=[c.lng+s,c.lat+l,c.lng+o,c.lat+a];return this.isSurfacePointOnScreen([0,1,0])&&(u[3]=90,u[0]=-180,u[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(u[1]=-90,u[0]=-180,u[2]=180),new H(u)}getConstrained(e,i){const r=t.ae(e.lat,-85.051129,t.af),n=t.ae(+i,this.minZoom+si(0,r),this.maxZoom);return{center:new t.Q(e.lng,r),zoom:n}}calculateCenterFromCameraLngLatAlt(e,t,i,r){return this._helper.calculateCenterFromCameraLngLatAlt(e,t,i,r)}setLocationAtPoint(e,i){const r=ii(this.unprojectScreenPoint(i)),n=ii(e),o=t.bh();t.br(o);const s=t.bh();t.bn(s,r,o,-this.center.lng*Math.PI/180),t.bm(s,s,o,this.center.lat*Math.PI/180);const a=n[0]*n[0]+n[2]*n[2],l=s[0]*s[0];if(a<l)return;const c=Math.sqrt(a-l),u=-c,h=t.bs(n[0],n[2],s[0],c),d=t.bs(n[0],n[2],s[0],u),p=t.bh();t.bn(p,n,o,-h);const f=t.bs(p[1],p[2],s[1],s[2]),A=t.bh();t.bn(A,n,o,-d);const m=t.bs(A[1],A[2],s[1],s[2]),g=.5*Math.PI,_=f>=-g&&f<=g,y=m>=-g&&m<=g;let v,x;if(_&&y){const e=this.center.lng*Math.PI/180,i=this.center.lat*Math.PI/180;t.bv(h,e)+t.bv(f,i)<t.bv(d,e)+t.bv(m,i)?(v=h,x=f):(v=d,x=m)}else if(_)v=h,x=f;else{if(!y)return;v=d,x=m}const b=v/Math.PI*180,w=x/Math.PI*180,T=this.center.lat;this.setCenter(new t.Q(b,t.ae(w,-90,90))),this.setZoom(this.zoom+si(T,this.center.lat))}locationToScreenPoint(e,i){const r=ii(e);if(i){const n=i.getElevationForLngLatZoom(e,this._helper._tileZoom);t.aO(r,r,1+n/t.bu)}return this._projectSurfacePointToScreen(r)}_projectSurfacePointToScreen(e){const i=t.bk();return t.at(i,[...e,1],this._globeViewProjMatrixNoCorrection),i[0]/=i[3],i[1]/=i[3],new t.P((.5*i[0]+.5)*this.width,(.5*-i[1]+.5)*this.height)}screenPointToMercatorCoordinate(e,i){if(i){const t=i.pointCoordinate(e);if(t)return t}return t.$.fromLngLat(this.unprojectScreenPoint(e))}screenPointToLocation(e,t){var i;return null===(i=this.screenPointToMercatorCoordinate(e,t))||void 0===i?void 0:i.toLngLat()}isPointOnMapSurface(e,t){const i=this._cameraPosition,r=this.getRayDirectionFromPixel(e);return!!this.rayPlanetIntersection(i,r)}getRayDirectionFromPixel(e){const i=t.bk();i[0]=e.x/this.width*2-1,i[1]=-1*(e.y/this.height*2-1),i[2]=1,i[3]=1,t.at(i,i,this._globeViewProjMatrixNoCorrectionInverted),i[0]/=i[3],i[1]/=i[3],i[2]/=i[3];const r=t.bh();r[0]=i[0]-this._cameraPosition[0],r[1]=i[1]-this._cameraPosition[1],r[2]=i[2]-this._cameraPosition[2];const n=t.bh();return t.aT(n,r),n}isSurfacePointVisible(e){const t=this._cachedClippingPlane;return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]>=0}isSurfacePointOnScreen(e){if(!this.isSurfacePointVisible(e))return!1;const i=t.bk();return t.at(i,[...e,1],this._globeViewProjMatrixNoCorrection),i[0]/=i[3],i[1]/=i[3],i[2]/=i[3],i[0]>-1&&i[0]<1&&i[1]>-1&&i[1]<1&&i[2]>-1&&i[2]<1}rayPlanetIntersection(e,i){const r=t.aV(e,i),n=t.bh(),o=t.bh();t.aO(o,i,r),t.aS(n,e,o);const s=1-t.aV(n,n);if(s<0)return null;const a=t.aV(e,e)-1,l=-r+(r<0?1:-1)*Math.sqrt(s),c=a/l,u=l;return{tMin:Math.min(c,u),tMax:Math.max(c,u)}}unprojectScreenPoint(e){const i=this._cameraPosition,r=this.getRayDirectionFromPixel(e),n=this.rayPlanetIntersection(i,r);if(n){const e=t.bh();t.aP(e,i,[r[0]*n.tMin,r[1]*n.tMin,r[2]*n.tMin]);const o=t.bh();return t.aT(o,e),ni(o)}const o=this._cachedClippingPlane,s=o[0]*r[0]+o[1]*r[1]+o[2]*r[2],a=-t.bt(o,i)/s,l=t.bh();if(a>0)t.aP(l,i,[r[0]*a,r[1]*a,r[2]*a]);else{const e=t.bh();t.aP(e,i,[2*r[0],2*r[1],2*r[2]]);const n=t.bt(this._cachedClippingPlane,e);t.aS(l,e,[this._cachedClippingPlane[0]*n,this._cachedClippingPlane[1]*n,this._cachedClippingPlane[2]*n])}const c=function(e){const i=t.bh();return i[0]=e[0]*-e[3],i[1]=e[1]*-e[3],i[2]=e[2]*-e[3],{center:i,radius:Math.sqrt(1-e[3]*e[3])}}(o);return ni(function(e,i,r){const n=t.bh();t.aS(n,r,e);const o=t.bh();return t.bi(o,e,n,i/t.bj(n)),o}(c.center,c.radius,l))}getMatrixForModel(e,i){const r=t.Q.convert(e),n=1/t.bu,o=t.b1();return t.bp(o,o,r.lng/180*Math.PI),t.a$(o,o,-r.lat/180*Math.PI),t.L(o,o,[0,0,1+i/t.bu]),t.a$(o,o,.5*Math.PI),t.M(o,o,[n,n,n]),o}getProjectionDataForCustomLayer(e=!0){const i=this.getProjectionData({overscaledTileID:new t.Y(0,0,0,0,0),applyGlobeMatrix:e});return i.tileMercatorCoords=[0,0,1,1],i}getFastPathSimpleProjectionMatrix(e){}}class Ai{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,t,i){return this._helper.interpolatePadding(e,t,i)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,t,i=!0){this._helper.resize(e,t,i)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}overrideNearFarZ(e,t){this._helper.overrideNearFarZ(e,t)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(e,t){this._globeness=e,this._globeLatitudeErrorCorrectionRadians=t,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().recalculateCache(),this._mercatorTransform.getCoveringTilesDetailsProvider().recalculateCache()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this._helper=new It({calcMatrices:()=>{this._calcMatrices()},getConstrained:(e,t)=>this.getConstrained(e,t)}),this._globeness=1,this._mercatorTransform=new kt,this._verticalPerspectiveTransform=new fi}clone(){const e=new Ai;return e._globeness=this._globeness,e._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,e.apply(this),e}apply(e){this._helper.apply(e),this._mercatorTransform.apply(this),this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(e){const t=this._mercatorTransform.getProjectionData(e),i=this._verticalPerspectiveTransform.getProjectionData(e);return{mainMatrix:this.isGlobeRendering?i.mainMatrix:t.mainMatrix,clippingPlane:i.clippingPlane,tileMercatorCoords:i.tileMercatorCoords,projectionTransition:e.applyGlobeMatrix?this._globeness:0,fallbackMatrix:t.fallbackMatrix}}isLocationOccluded(e){return this.currentTransform.isLocationOccluded(e)}transformLightDirection(e){return this.currentTransform.transformLightDirection(e)}getPixelScale(){return t.bc(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return t.bc(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(e,i,r){const n=this._mercatorTransform.getPitchedTextCorrection(e,i,r),o=this._verticalPerspectiveTransform.getPitchedTextCorrection(e,i,r);return t.bc(n,o,this._globeness)}projectTileCoordinates(e,t,i,r){return this.currentTransform.projectTileCoordinates(e,t,i,r)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(e){return this.currentTransform.calculateFogMatrix(e)}getVisibleUnwrappedCoordinates(e){return this.currentTransform.getVisibleUnwrappedCoordinates(e)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(e){this._mercatorTransform.recalculateZoomAndCenter(e),this._verticalPerspectiveTransform.recalculateZoomAndCenter(e)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(e,t){return this.currentTransform.lngLatToCameraDepth(e,t)}populateCache(e){this._mercatorTransform.populateCache(e),this._verticalPerspectiveTransform.populateCache(e)}getBounds(){return this.currentTransform.getBounds()}getConstrained(e,t){return this.currentTransform.getConstrained(e,t)}calculateCenterFromCameraLngLatAlt(e,t,i,r){return this._helper.calculateCenterFromCameraLngLatAlt(e,t,i,r)}setLocationAtPoint(e,t){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(e,t),void this.apply(this._mercatorTransform);this._verticalPerspectiveTransform.setLocationAtPoint(e,t),this.apply(this._verticalPerspectiveTransform)}locationToScreenPoint(e,t){return this.currentTransform.locationToScreenPoint(e,t)}screenPointToMercatorCoordinate(e,t){return this.currentTransform.screenPointToMercatorCoordinate(e,t)}screenPointToLocation(e,t){return this.currentTransform.screenPointToLocation(e,t)}isPointOnMapSurface(e,t){return this.currentTransform.isPointOnMapSurface(e,t)}getRayDirectionFromPixel(e){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(e)}getMatrixForModel(e,t){return this.currentTransform.getMatrixForModel(e,t)}getProjectionDataForCustomLayer(e=!0){const t=this._mercatorTransform.getProjectionDataForCustomLayer(e);if(!this.isGlobeRendering)return t;const i=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(e);return i.fallbackMatrix=t.mainMatrix,i}getFastPathSimpleProjectionMatrix(e){return this.currentTransform.getFastPathSimpleProjectionMatrix(e)}}class mi{get useGlobeControls(){return!0}handlePanInertia(e,i){const r=ai(e,i);return Math.abs(r.lng-i.center.lng)>180&&(r.lng=i.center.lng+179.5*Math.sign(r.lng-i.center.lng)),{easingCenter:r,easingOffset:new t.P(0,0)}}handleMapControlsRollPitchBearingZoom(e,i){const r=e.around,n=i.screenPointToLocation(r);e.bearingDelta&&i.setBearing(i.bearing+e.bearingDelta),e.pitchDelta&&i.setPitch(i.pitch+e.pitchDelta),e.rollDelta&&i.setRoll(i.roll+e.rollDelta);const o=i.zoom;e.zoomDelta&&i.setZoom(i.zoom+e.zoomDelta);const s=i.zoom-o;if(0===s)return;const a=t.bq(i.center.lng,n.lng),l=a/(Math.abs(a/180)+1),c=t.bq(i.center.lat,n.lat),u=i.getRayDirectionFromPixel(r),h=i.cameraPosition,d=-1*t.aV(h,u),p=t.bh();t.aP(p,h,[u[0]*d,u[1]*d,u[2]*d]);const f=t.bo(p)-1,A=Math.exp(.5*-Math.max(f-.3,0)),m=ri(i.worldSize,i.center.lat)/Math.min(i.width,i.height),g=t.bf(m,.9,.5,1,.25),_=(1-t.ac(-s))*Math.min(A,g),y=i.center.lat,v=i.zoom,x=new t.Q(i.center.lng+l*_,t.ae(i.center.lat+c*_,-85.051129,t.af));i.setLocationAtPoint(n,r);const b=i.center,w=t.bf(Math.abs(a),45,85,0,1),T=t.bf(m,.75,.35,0,1),B=Math.pow(Math.max(w,T),.25),C=t.bq(b.lng,x.lng),S=t.bq(b.lat,x.lat);i.setCenter(new t.Q(b.lng+C*B,b.lat+S*B).wrap()),i.setZoom(v+si(y,i.center.lat))}handleMapControlsPan(e,t,i){if(!e.panDelta)return;const r=t.center.lat,n=t.zoom;t.setCenter(ai(e.panDelta,t).wrap()),t.setZoom(n+si(r,t.center.lat))}cameraForBoxAndBearing(e,i,r,n,o){const s=Dt(e,i,r,n,o),a=i.left/o.width*2-1,l=(o.width-i.right)/o.width*2-1,c=i.top/o.height*-2+1,u=(o.height-i.bottom)/o.height*-2+1,h=t.bq(r.getWest(),r.getEast())<0,d=h?r.getEast():r.getWest(),p=h?r.getWest():r.getEast(),f=Math.max(r.getNorth(),r.getSouth()),A=Math.min(r.getNorth(),r.getSouth()),m=d+.5*t.bq(d,p),g=f+.5*t.bq(f,A),_=o.clone();_.setCenter(s.center),_.setBearing(s.bearing),_.setPitch(0),_.setRoll(0),_.setZoom(s.zoom);const y=_.modelViewProjectionMatrix,v=[ii(r.getNorthWest()),ii(r.getNorthEast()),ii(r.getSouthWest()),ii(r.getSouthEast()),ii(new t.Q(p,g)),ii(new t.Q(d,g)),ii(new t.Q(m,f)),ii(new t.Q(m,A))],x=ii(s.center);let b=Number.POSITIVE_INFINITY;for(const e of v)a<0&&(b=mi.getLesserNonNegativeNonNull(b,mi.solveVectorScale(e,x,y,"x",a))),l>0&&(b=mi.getLesserNonNegativeNonNull(b,mi.solveVectorScale(e,x,y,"x",l))),c>0&&(b=mi.getLesserNonNegativeNonNull(b,mi.solveVectorScale(e,x,y,"y",c))),u<0&&(b=mi.getLesserNonNegativeNonNull(b,mi.solveVectorScale(e,x,y,"y",u)));if(Number.isFinite(b)&&0!==b)return s.zoom=_.zoom+t.ah(b),s;zt()}handleJumpToCenterZoom(e,i){const r=e.center.lat,n=e.getConstrained(i.center?t.Q.convert(i.center):e.center,e.zoom).center;e.setCenter(n.wrap());const o=void 0!==i.zoom?+i.zoom:e.zoom+si(r,n.lat);e.zoom!==o&&e.setZoom(o)}handleEaseTo(e,i){const r=e.zoom,n=e.center,o=e.padding,s={roll:e.roll,pitch:e.pitch,bearing:e.bearing},a={roll:void 0===i.roll?e.roll:i.roll,pitch:void 0===i.pitch?e.pitch:i.pitch,bearing:void 0===i.bearing?e.bearing:i.bearing},l=void 0!==i.zoom,c=!e.isPaddingEqual(i.padding);let u=!1;const h=i.center?t.Q.convert(i.center):n,d=e.getConstrained(h,r).center;Et(e,d);const p=e.clone();p.setCenter(d),p.setZoom(l?+i.zoom:r+si(n.lat,h.lat)),p.setBearing(i.bearing);const f=new t.P(t.ae(e.centerPoint.x+i.offsetAsPoint.x,0,e.width),t.ae(e.centerPoint.y+i.offsetAsPoint.y,0,e.height));p.setLocationAtPoint(d,f);const A=(i.offset&&i.offsetAsPoint.mag())>0?p.center:d,m=l?+i.zoom:r+si(n.lat,A.lat),g=r+si(n.lat,0),_=m+si(A.lat,0),y=t.bq(n.lng,A.lng),v=t.bq(n.lat,A.lat),x=t.ac(_-g);return u=m!==r,{easeFunc:r=>{if(t.b6(s,a)||Rt({startEulerAngles:s,endEulerAngles:a,tr:e,k:r,useSlerp:s.roll!=a.roll}),c&&e.interpolatePadding(o,i.padding,r),i.around)t.w("Easing around a point is not supported under globe projection."),e.setLocationAtPoint(i.around,i.aroundPoint);else{const t=_>g?Math.min(2,x):Math.max(.5,x),i=Math.pow(t,1-r),o=ci(n,y,v,r*i);e.setCenter(o.wrap())}if(u){const i=t.B.number(g,_,r)+si(0,e.center.lat);e.setZoom(i)}},isZooming:u,elevationCenter:A}}handleFlyTo(e,i){const r=void 0!==i.zoom,n=e.center,o=e.zoom,s=e.padding,a=!e.isPaddingEqual(i.padding),l=e.getConstrained(t.Q.convert(i.center||i.locationAtOffset),o).center,c=r?+i.zoom:e.zoom+si(e.center.lat,l.lat),u=e.clone();u.setCenter(l),u.setZoom(c),u.setBearing(i.bearing);const h=new t.P(t.ae(e.centerPoint.x+i.offsetAsPoint.x,0,e.width),t.ae(e.centerPoint.y+i.offsetAsPoint.y,0,e.height));u.setLocationAtPoint(l,h);const d=u.center;Et(e,d);const p=function(e,i,r){const n=ii(i),o=ii(r),s=t.aV(n,o),a=Math.acos(s),l=ei(e);return a/(2*Math.PI)*l}(e,n,d),f=o+si(n.lat,0),A=c+si(d.lat,0),m=t.ac(A-f);let g;if("number"==typeof i.minZoom){const r=+i.minZoom+si(d.lat,0),n=Math.min(r,f,A)+si(0,d.lat),o=e.getConstrained(d,n).zoom+si(d.lat,0);g=t.ac(o-f)}const _=t.bq(n.lng,d.lng),y=t.bq(n.lat,d.lat);return{easeFunc:(r,o,l,u)=>{const h=ci(n,_,y,l);a&&e.interpolatePadding(s,i.padding,r);const p=1===r?d:h;e.setCenter(p.wrap());const A=f+t.ah(o);e.setZoom(1===r?c:A+si(0,p.lat))},scaleOfZoom:m,targetCenter:d,scaleOfMinZoom:g,pixelPathLength:p}}static solveVectorScale(e,t,i,r,n){const o="x"===r?[i[0],i[4],i[8],i[12]]:[i[1],i[5],i[9],i[13]],s=[i[3],i[7],i[11],i[15]],a=e[0]*o[0]+e[1]*o[1]+e[2]*o[2],l=e[0]*s[0]+e[1]*s[1]+e[2]*s[2],c=t[0]*o[0]+t[1]*o[1]+t[2]*o[2],u=t[0]*s[0]+t[1]*s[1]+t[2]*s[2];return c+n*l===a+n*u||s[3]*(a-c)+o[3]*(u-l)+a*u==c*l?null:(c+o[3]-n*u-n*s[3])/(c-a-n*u+n*l)}static getLesserNonNegativeNonNull(e,t){return null!==t&&t>=0&&t<e?t:e}}class gi{constructor(e){this._globe=e,this._mercatorCameraHelper=new Ot,this._verticalPerspectiveCameraHelper=new mi}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(e,t){return this.currentHelper.handlePanInertia(e,t)}handleMapControlsRollPitchBearingZoom(e,t){return this.currentHelper.handleMapControlsRollPitchBearingZoom(e,t)}handleMapControlsPan(e,t,i){this.currentHelper.handleMapControlsPan(e,t,i)}cameraForBoxAndBearing(e,t,i,r,n){return this.currentHelper.cameraForBoxAndBearing(e,t,i,r,n)}handleJumpToCenterZoom(e,t){this.currentHelper.handleJumpToCenterZoom(e,t)}handleEaseTo(e,t){return this.currentHelper.handleEaseTo(e,t)}handleFlyTo(e,t){return this.currentHelper.handleFlyTo(e,t)}}const _i=(e,i)=>t.x(e,i&&i.filter((e=>"source.canvas"!==e.identifier))),yi=t.bw();class vi extends t.E{constructor(e,i={}){super(),this._rtlPluginLoaded=()=>{for(const e in this.sourceCaches){const t=this.sourceCaches[e].getSource().type;"vector"!==t&&"geojson"!==t||this.sourceCaches[e].reload()}},this.map=e,this.dispatcher=new D(R(),e._getMapId()),this.dispatcher.registerMessageHandler("GG",((e,t)=>this.getGlyphs(e,t))),this.dispatcher.registerMessageHandler("GI",((e,t)=>this.getImages(e,t))),this.imageManager=new v,this.imageManager.setEventedParent(this),this.glyphManager=new T(e._requestManager,i.localIdeographFontFamily),this.lineAtlas=new I(256,512),this.crossTileSymbolIndex=new _t,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new t.bx,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",t.by()),ne().on(te,this._rtlPluginLoaded),this.on("data",(e=>{if("source"!==e.dataType||"metadata"!==e.sourceDataType)return;const t=this.sourceCaches[e.sourceId];if(!t)return;const i=t.getSource();if(i&&i.vectorLayerIds)for(const e in this._layers){const t=this._layers[e];t.source===i.id&&this._validateLayer(t)}}))}loadURL(e,i={},r){this.fire(new t.l("dataloading",{dataType:"style"})),i.validate="boolean"!=typeof i.validate||i.validate;const n=this.map._requestManager.transformRequest(e,"Style");this._loadStyleRequest=new AbortController;const o=this._loadStyleRequest;t.j(n,this._loadStyleRequest).then((e=>{this._loadStyleRequest=null,this._load(e.data,i,r)})).catch((e=>{this._loadStyleRequest=null,e&&!o.signal.aborted&&this.fire(new t.k(e))}))}loadJSON(e,i={},r){this.fire(new t.l("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,s.frameAsync(this._frameRequest).then((()=>{this._frameRequest=null,i.validate=!1!==i.validate,this._load(e,i,r)})).catch((()=>{}))}loadEmpty(){this.fire(new t.l("dataloading",{dataType:"style"})),this._load(yi,{validate:!1})}_load(e,i,r){var n,o;const s=i.transformStyle?i.transformStyle(r,e):e;if(!i.validate||!_i(this,t.y(s))){this._loaded=!0,this.stylesheet=s;for(const e in s.sources)this.addSource(e,s.sources[e],{validate:!1});s.sprite?this._loadSprite(s.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(s.glyphs),this._createLayers(),this.light=new S(this.stylesheet.light),this._setProjectionInternal((null===(n=this.stylesheet.projection)||void 0===n?void 0:n.type)||"mercator"),this.sky=new M(this.stylesheet.sky),this.map.setTerrain(null!==(o=this.stylesheet.terrain)&&void 0!==o?o:null),this.fire(new t.l("data",{dataType:"style"})),this.fire(new t.l("style.load"))}}_createLayers(){const e=t.bz(this.stylesheet.layers);this.dispatcher.broadcast("SL",e),this._order=e.map((e=>e.id)),this._layers={},this._serializedLayers=null;for(const i of e){const e=t.bA(i);e.setEventedParent(this,{layer:{id:i.id}}),this._layers[i.id]=e}}_loadSprite(e,i=!1,r=void 0){let n;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(e,i,r,n){return t._(this,void 0,void 0,(function*(){const o=m(e),a=r>1?"@2x":"",l={},c={};for(const{id:e,url:r}of o){const o=i.transformRequest(g(r,a,".json"),"SpriteJSON");l[e]=t.j(o,n);const s=i.transformRequest(g(r,a,".png"),"SpriteImage");c[e]=f.getImage(s,n)}return yield Promise.all([...Object.values(l),...Object.values(c)]),function(e,i){return t._(this,void 0,void 0,(function*(){const t={};for(const r in e){t[r]={};const n=s.getImageCanvasContext((yield i[r]).data),o=(yield e[r]).data;for(const e in o){const{width:i,height:s,x:a,y:l,sdf:c,pixelRatio:u,stretchX:h,stretchY:d,content:p,textFitWidth:f,textFitHeight:A}=o[e];t[r][e]={data:null,pixelRatio:u,sdf:c,stretchX:h,stretchY:d,content:p,textFitWidth:f,textFitHeight:A,spriteData:{width:i,height:s,x:a,y:l,context:n}}}}return t}))}(l,c)}))}(e,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then((e=>{if(this._spriteRequest=null,e)for(const t in e){this._spritesImagesIds[t]=[];const r=this._spritesImagesIds[t]?this._spritesImagesIds[t].filter((t=>!(t in e))):[];for(const e of r)this.imageManager.removeImage(e),this._changedImages[e]=!0;for(const r in e[t]){const n="default"===t?r:`${t}:${r}`;this._spritesImagesIds[t].push(n),n in this.imageManager.images?this.imageManager.updateImage(n,e[t][r],!1):this.imageManager.addImage(n,e[t][r]),i&&(this._changedImages[n]=!0)}}})).catch((e=>{this._spriteRequest=null,n=e,this.fire(new t.k(n))})).finally((()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),i&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new t.l("data",{dataType:"style"})),r&&r(n)}))}_unloadSprite(){for(const e of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(e),this._changedImages[e]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new t.l("data",{dataType:"style"}))}_validateLayer(e){const i=this.sourceCaches[e.source];if(!i)return;const r=e.sourceLayer;if(!r)return;const n=i.getSource();("geojson"===n.type||n.vectorLayerIds&&-1===n.vectorLayerIds.indexOf(r))&&this.fire(new t.k(new Error(`Source layer "${r}" does not exist on source "${n.id}" as specified by style layer "${e.id}".`)))}loaded(){if(!this._loaded)return!1;if(Object.keys(this._updatedSources).length)return!1;for(const e in this.sourceCaches)if(!this.sourceCaches[e].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(e,i=!1){const r=this._serializedAllLayers();if(!e||0===e.length)return Object.values(i?t.bB(r):r);const n=[];for(const o of e)if(r[o]){const e=i?t.bB(r[o]):r[o];n.push(e)}return n}_serializedAllLayers(){let e=this._serializedLayers;if(e)return e;e=this._serializedLayers={};const t=Object.keys(this._layers);for(const i of t){const t=this._layers[i];"custom"!==t.type&&(e[i]=t.serialize())}return e}hasTransitions(){var e,t,i;if(null===(e=this.light)||void 0===e?void 0:e.hasTransition())return!0;if(null===(t=this.sky)||void 0===t?void 0:t.hasTransition())return!0;if(null===(i=this.projection)||void 0===i?void 0:i.hasTransition())return!0;for(const e in this.sourceCaches)if(this.sourceCaches[e].hasTransition())return!0;for(const e in this._layers)if(this._layers[e].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(e){if(!this._loaded)return;const i=this._changed;if(i){const t=Object.keys(this._updatedLayers),i=Object.keys(this._removedLayers);(t.length||i.length)&&this._updateWorkerLayers(t,i);for(const e in this._updatedSources){const t=this._updatedSources[e];if("reload"===t)this._reloadSource(e);else{if("clear"!==t)throw new Error(`Invalid action ${t}`);this._clearSource(e)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const t in this._updatedPaintProps)this._layers[t].updateTransitions(e);this.light.updateTransitions(e),this.sky.updateTransitions(e),this._resetUpdates()}const r={};for(const e in this.sourceCaches){const t=this.sourceCaches[e];r[e]=t.used,t.used=!1}for(const t of this._order){const i=this._layers[t];i.recalculate(e,this._availableImages),!i.isHidden(e.zoom)&&i.source&&(this.sourceCaches[i.source].used=!0)}for(const e in r){const i=this.sourceCaches[e];!!r[e]!=!!i.used&&i.fire(new t.l("data",{sourceDataType:"visibility",dataType:"source",sourceId:e}))}this.light.recalculate(e),this.sky.recalculate(e),this.projection.recalculate(e),this.z=e.zoom,i&&this.fire(new t.l("data",{dataType:"style"}))}_updateTilesForChangedImages(){const e=Object.keys(this._changedImages);if(e.length){for(const t in this.sourceCaches)this.sourceCaches[t].reloadTilesForDependencies(["icons","patterns"],e);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const e in this.sourceCaches)this.sourceCaches[e].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(e,t){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(e,!1),removedIds:t})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(e,i={}){var r;this._checkLoaded();const n=this.serialize();if(e=i.transformStyle?i.transformStyle(n,e):e,(null===(r=i.validate)||void 0===r||r)&&_i(this,t.y(e)))return!1;(e=t.bB(e)).layers=t.bz(e.layers);const o=t.bC(n,e),s=this._getOperationsToPerform(o);if(s.unimplemented.length>0)throw new Error(`Unimplemented: ${s.unimplemented.join(", ")}.`);if(0===s.operations.length)return!1;for(const e of s.operations)e();return this.stylesheet=e,this._serializedLayers=null,!0}_getOperationsToPerform(e){const t=[],i=[];for(const r of e)switch(r.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":t.push((()=>this.addLayer.apply(this,r.args)));break;case"removeLayer":t.push((()=>this.removeLayer.apply(this,r.args)));break;case"setPaintProperty":t.push((()=>this.setPaintProperty.apply(this,r.args)));break;case"setLayoutProperty":t.push((()=>this.setLayoutProperty.apply(this,r.args)));break;case"setFilter":t.push((()=>this.setFilter.apply(this,r.args)));break;case"addSource":t.push((()=>this.addSource.apply(this,r.args)));break;case"removeSource":t.push((()=>this.removeSource.apply(this,r.args)));break;case"setLayerZoomRange":t.push((()=>this.setLayerZoomRange.apply(this,r.args)));break;case"setLight":t.push((()=>this.setLight.apply(this,r.args)));break;case"setGeoJSONSourceData":t.push((()=>this.setGeoJSONSourceData.apply(this,r.args)));break;case"setGlyphs":t.push((()=>this.setGlyphs.apply(this,r.args)));break;case"setSprite":t.push((()=>this.setSprite.apply(this,r.args)));break;case"setTerrain":t.push((()=>this.map.setTerrain.apply(this,r.args)));break;case"setSky":t.push((()=>this.setSky.apply(this,r.args)));break;case"setProjection":this.setProjection.apply(this,r.args);break;case"setTransition":t.push((()=>{}));break;default:i.push(r.command)}return{operations:t,unimplemented:i}}addImage(e,i){if(this.getImage(e))return this.fire(new t.k(new Error(`An image named "${e}" already exists.`)));this.imageManager.addImage(e,i),this._afterImageUpdated(e)}updateImage(e,t){this.imageManager.updateImage(e,t)}getImage(e){return this.imageManager.getImage(e)}removeImage(e){if(!this.getImage(e))return this.fire(new t.k(new Error(`An image named "${e}" does not exist.`)));this.imageManager.removeImage(e),this._afterImageUpdated(e)}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new t.l("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(e,i,r={}){if(this._checkLoaded(),void 0!==this.sourceCaches[e])throw new Error(`Source "${e}" already exists.`);if(!i.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(i).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(i.type)>=0&&this._validate(t.y.source,`sources.${e}`,i,null,r))return;this.map&&this.map._collectResourceTiming&&(i.collectResourceTiming=!0);const n=this.sourceCaches[e]=new ve(e,i,this.dispatcher);n.style=this,n.setEventedParent(this,(()=>({isSourceLoaded:n.loaded(),source:n.serialize(),sourceId:e}))),n.onAdd(this.map),this._changed=!0}removeSource(e){if(this._checkLoaded(),void 0===this.sourceCaches[e])throw new Error("There is no source with this ID");for(const i in this._layers)if(this._layers[i].source===e)return this.fire(new t.k(new Error(`Source "${e}" cannot be removed while layer "${i}" is using it.`)));const i=this.sourceCaches[e];delete this.sourceCaches[e],delete this._updatedSources[e],i.fire(new t.l("data",{sourceDataType:"metadata",dataType:"source",sourceId:e})),i.setEventedParent(null),i.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(e,t){if(this._checkLoaded(),void 0===this.sourceCaches[e])throw new Error(`There is no source with this ID=${e}`);const i=this.sourceCaches[e].getSource();if("geojson"!==i.type)throw new Error(`geojsonSource.type is ${i.type}, which is !== 'geojson`);i.setData(t),this._changed=!0}getSource(e){return this.sourceCaches[e]&&this.sourceCaches[e].getSource()}addLayer(e,i,r={}){this._checkLoaded();const n=e.id;if(this.getLayer(n))return void this.fire(new t.k(new Error(`Layer "${n}" already exists on this map.`)));let o;if("custom"===e.type){if(_i(this,t.bD(e)))return;o=t.bA(e)}else{if("source"in e&&"object"==typeof e.source&&(this.addSource(n,e.source),e=t.bB(e),e=t.e(e,{source:n})),this._validate(t.y.layer,`layers.${n}`,e,{arrayIndex:-1},r))return;o=t.bA(e),this._validateLayer(o),o.setEventedParent(this,{layer:{id:n}})}const s=i?this._order.indexOf(i):this._order.length;if(i&&-1===s)this.fire(new t.k(new Error(`Cannot add layer "${n}" before non-existing layer "${i}".`)));else{if(this._order.splice(s,0,n),this._layerOrderChanged=!0,this._layers[n]=o,this._removedLayers[n]&&o.source&&"custom"!==o.type){const e=this._removedLayers[n];delete this._removedLayers[n],e.type!==o.type?this._updatedSources[o.source]="clear":(this._updatedSources[o.source]="reload",this.sourceCaches[o.source].pause())}this._updateLayer(o),o.onAdd&&o.onAdd(this.map)}}moveLayer(e,i){if(this._checkLoaded(),this._changed=!0,!this._layers[e])return void this.fire(new t.k(new Error(`The layer '${e}' does not exist in the map's style and cannot be moved.`)));if(e===i)return;const r=this._order.indexOf(e);this._order.splice(r,1);const n=i?this._order.indexOf(i):this._order.length;i&&-1===n?this.fire(new t.k(new Error(`Cannot move layer "${e}" before non-existing layer "${i}".`))):(this._order.splice(n,0,e),this._layerOrderChanged=!0)}removeLayer(e){this._checkLoaded();const i=this._layers[e];if(!i)return void this.fire(new t.k(new Error(`Cannot remove non-existing layer "${e}".`)));i.setEventedParent(null);const r=this._order.indexOf(e);this._order.splice(r,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=i,delete this._layers[e],this._serializedLayers&&delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],i.onRemove&&i.onRemove(this.map)}getLayer(e){return this._layers[e]}getLayersOrder(){return[...this._order]}hasLayer(e){return e in this._layers}setLayerZoomRange(e,i,r){this._checkLoaded();const n=this.getLayer(e);n?n.minzoom===i&&n.maxzoom===r||(null!=i&&(n.minzoom=i),null!=r&&(n.maxzoom=r),this._updateLayer(n)):this.fire(new t.k(new Error(`Cannot set the zoom range of non-existing layer "${e}".`)))}setFilter(e,i,r={}){this._checkLoaded();const n=this.getLayer(e);if(n){if(!t.bE(n.filter,i))return null==i?(n.filter=void 0,void this._updateLayer(n)):void(this._validate(t.y.filter,`layers.${n.id}.filter`,i,null,r)||(n.filter=t.bB(i),this._updateLayer(n)))}else this.fire(new t.k(new Error(`Cannot filter non-existing layer "${e}".`)))}getFilter(e){return t.bB(this.getLayer(e).filter)}setLayoutProperty(e,i,r,n={}){this._checkLoaded();const o=this.getLayer(e);o?t.bE(o.getLayoutProperty(i),r)||(o.setLayoutProperty(i,r,n),this._updateLayer(o)):this.fire(new t.k(new Error(`Cannot style non-existing layer "${e}".`)))}getLayoutProperty(e,i){const r=this.getLayer(e);if(r)return r.getLayoutProperty(i);this.fire(new t.k(new Error(`Cannot get style of non-existing layer "${e}".`)))}setPaintProperty(e,i,r,n={}){this._checkLoaded();const o=this.getLayer(e);o?t.bE(o.getPaintProperty(i),r)||(o.setPaintProperty(i,r,n)&&this._updateLayer(o),this._changed=!0,this._updatedPaintProps[e]=!0,this._serializedLayers=null):this.fire(new t.k(new Error(`Cannot style non-existing layer "${e}".`)))}getPaintProperty(e,t){return this.getLayer(e).getPaintProperty(t)}setFeatureState(e,i){this._checkLoaded();const r=e.source,n=e.sourceLayer,o=this.sourceCaches[r];if(void 0===o)return void this.fire(new t.k(new Error(`The source '${r}' does not exist in the map's style.`)));const s=o.getSource().type;"geojson"===s&&n?this.fire(new t.k(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):"vector"!==s||n?(void 0===e.id&&this.fire(new t.k(new Error("The feature id parameter must be provided."))),o.setFeatureState(n,e.id,i)):this.fire(new t.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(e,i){this._checkLoaded();const r=e.source,n=this.sourceCaches[r];if(void 0===n)return void this.fire(new t.k(new Error(`The source '${r}' does not exist in the map's style.`)));const o=n.getSource().type,s="vector"===o?e.sourceLayer:void 0;"vector"!==o||s?i&&"string"!=typeof e.id&&"number"!=typeof e.id?this.fire(new t.k(new Error("A feature id is required to remove its specific state property."))):n.removeFeatureState(s,e.id,i):this.fire(new t.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(e){this._checkLoaded();const i=e.source,r=e.sourceLayer,n=this.sourceCaches[i];if(void 0!==n)return"vector"!==n.getSource().type||r?(void 0===e.id&&this.fire(new t.k(new Error("The feature id parameter must be provided."))),n.getFeatureState(r,e.id)):void this.fire(new t.k(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new t.k(new Error(`The source '${i}' does not exist in the map's style.`)))}getTransition(){return t.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const e=t.bF(this.sourceCaches,(e=>e.serialize())),i=this._serializeByIds(this._order,!0),r=this.map.getTerrain()||void 0,n=this.stylesheet;return t.bG({version:n.version,name:n.name,metadata:n.metadata,light:n.light,sky:n.sky,center:n.center,zoom:n.zoom,bearing:n.bearing,pitch:n.pitch,sprite:n.sprite,glyphs:n.glyphs,transition:n.transition,projection:n.projection,sources:e,layers:i,terrain:r},(e=>void 0!==e))}_updateLayer(e){this._updatedLayers[e.id]=!0,e.source&&!this._updatedSources[e.source]&&"raster"!==this.sourceCaches[e.source].getSource().type&&(this._updatedSources[e.source]="reload",this.sourceCaches[e.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(e){const t=e=>"fill-extrusion"===this._layers[e].type,i={},r=[];for(let n=this._order.length-1;n>=0;n--){const o=this._order[n];if(t(o)){i[o]=n;for(const t of e){const e=t[o];if(e)for(const t of e)r.push(t)}}}r.sort(((e,t)=>t.intersectionZ-e.intersectionZ));const n=[];for(let o=this._order.length-1;o>=0;o--){const s=this._order[o];if(t(s))for(let e=r.length-1;e>=0;e--){const t=r[e].feature;if(i[t.layer.id]<o)break;n.push(t),r.pop()}else for(const t of e){const e=t[s];if(e)for(const t of e)n.push(t.feature)}}return n}queryRenderedFeatures(e,i,r){i&&i.filter&&this._validate(t.y.filter,"queryRenderedFeatures.filter",i.filter,null,i);const n={};if(i&&i.layers){if(!(Array.isArray(i.layers)||i.layers instanceof Set))return this.fire(new t.k(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(const e of i.layers){const i=this._layers[e];if(!i)return this.fire(new t.k(new Error(`The layer '${e}' does not exist in the map's style and cannot be queried for features.`))),[];n[i.source]=!0}}const o=[];i.availableImages=this._availableImages;const s=this._serializedAllLayers(),a=i.layers instanceof Set?i.layers:Array.isArray(i.layers)?new Set(i.layers):null,l=Object.assign(Object.assign({},i),{layers:a});for(const t in this.sourceCaches)i.layers&&!n[t]||o.push(N(this.sourceCaches[t],this._layers,s,e,l,r,this.map.terrain?(e,t,i)=>this.map.terrain.getElevation(e,t,i):void 0));return this.placement&&o.push(function(e,t,i,r,n,o,s){const a={},l=o.queryRenderedSymbols(r),c=[];for(const e of Object.keys(l).map(Number))c.push(s[e]);c.sort(Q);for(const i of c){const r=i.featureIndex.lookupSymbolFeatures(l[i.bucketInstanceId],t,i.bucketIndex,i.sourceLayerIndex,n.filter,n.layers,n.availableImages,e);for(const e in r){const t=a[e]=a[e]||[],n=r[e];n.sort(((e,t)=>{const r=i.featureSortOrder;if(r){const i=r.indexOf(e.featureIndex);return r.indexOf(t.featureIndex)-i}return t.featureIndex-e.featureIndex}));for(const e of n)t.push(e)}}return function(e,t,i){for(const r in e)for(const n of e[r])j(n,i[t[r].source]);return e}(a,e,i)}(this._layers,s,this.sourceCaches,e,l,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(o)}querySourceFeatures(e,i){i&&i.filter&&this._validate(t.y.filter,"querySourceFeatures.filter",i.filter,null,i);const r=this.sourceCaches[e];return r?function(e,t){const i=e.getRenderableIds().map((t=>e.getTileByID(t))),r=[],n={};for(let e=0;e<i.length;e++){const o=i[e],s=o.tileID.canonical.key;n[s]||(n[s]=!0,o.querySourceFeatures(r,t))}return r}(r,i):[]}getLight(){return this.light.getLight()}setLight(e,i={}){this._checkLoaded();const r=this.light.getLight();let n=!1;for(const i in e)if(!t.bE(e[i],r[i])){n=!0;break}if(!n)return;const o={now:s.now(),transition:t.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,i),this.light.updateTransitions(o)}getProjection(){var e;return null===(e=this.stylesheet)||void 0===e?void 0:e.projection}setProjection(e){if(this._checkLoaded(),this.projection){if(this.projection.name===e.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=e,this._setProjectionInternal(e.type)}getSky(){var e;return null===(e=this.stylesheet)||void 0===e?void 0:e.sky}setSky(e,i={}){this._checkLoaded();const r=this.getSky();let n=!1;if(!e&&!r)return;if(e&&!r)n=!0;else if(!e&&r)n=!0;else for(const i in e)if(!t.bE(e[i],r[i])){n=!0;break}if(!n)return;const o={now:s.now(),transition:t.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=e,this.sky.setSky(e,i),this.sky.updateTransitions(o)}_setProjectionInternal(e){const i=function(e){if(Array.isArray(e)){const t=new Jt({type:e});return{projection:t,transform:new Ai,cameraHelper:new gi(t)}}switch(e){case"mercator":return{projection:new Ct,transform:new kt,cameraHelper:new Ot};case"globe":{const e=new Jt({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:e,transform:new Ai,cameraHelper:new gi(e)}}case"vertical-perspective":return{projection:new Xt,transform:new fi,cameraHelper:new mi};default:return t.w(`Unknown projection name: ${e}. Falling back to mercator projection.`),{projection:new Ct,transform:new kt,cameraHelper:new Ot}}}(e);this.projection=i.projection,this.map.migrateProjection(i.transform,i.cameraHelper);for(const e in this.sourceCaches)this.sourceCaches[e].reload()}_validate(e,i,r,n,o={}){return(!o||!1!==o.validate)&&_i(this,e.call(t.y,t.e({key:i,style:this.serialize(),value:r,styleSpec:t.v},n)))}_remove(e=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),ne().off(te,this._rtlPluginLoaded);for(const e in this._layers)this._layers[e].setEventedParent(null);for(const e in this.sourceCaches){const t=this.sourceCaches[e];t.setEventedParent(null),t.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),e&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(e)}_clearSource(e){this.sourceCaches[e].clearTiles()}_reloadSource(e){this.sourceCaches[e].resume(),this.sourceCaches[e].reload()}_updateSources(e){for(const t in this.sourceCaches)this.sourceCaches[t].update(e,this.map.terrain)}_generateCollisionBoxes(){for(const e in this.sourceCaches)this._reloadSource(e)}_updatePlacement(e,t,i,r,n=!1){let o=!1,a=!1;const l={};for(const t of this._order){const i=this._layers[t];if("symbol"!==i.type)continue;if(!l[i.source]){const e=this.sourceCaches[i.source];l[i.source]=e.getRenderableIds(!0).map((t=>e.getTileByID(t))).sort(((e,t)=>t.tileID.overscaledZ-e.tileID.overscaledZ||(e.tileID.isLessThan(t.tileID)?-1:1)))}const r=this.crossTileSymbolIndex.addLayer(i,l[i.source],e.center.lng);o=o||r}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((n=n||this._layerOrderChanged||0===i)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(s.now(),e.zoom))&&(this.pauseablePlacement=new pt(e,this.map.terrain,this._order,n,t,i,r,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,l),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(s.now()),a=!0),o&&this.pauseablePlacement.placement.setStale()),a||o)for(const e of this._order){const t=this._layers[e];"symbol"===t.type&&this.placement.updateLayerOpacities(t,l[t.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(s.now())}_releaseSymbolFadeTiles(){for(const e in this.sourceCaches)this.sourceCaches[e].releaseSymbolFadeTiles()}getImages(e,i){return t._(this,void 0,void 0,(function*(){const e=yield this.imageManager.getImages(i.icons);this._updateTilesForChangedImages();const t=this.sourceCaches[i.source];return t&&t.setDependencies(i.tileID.key,i.type,i.icons),e}))}getGlyphs(e,i){return t._(this,void 0,void 0,(function*(){const e=yield this.glyphManager.getGlyphs(i.stacks),t=this.sourceCaches[i.source];return t&&t.setDependencies(i.tileID.key,i.type,[""]),e}))}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(e,i={}){this._checkLoaded(),e&&this._validate(t.y.glyphs,"glyphs",e,null,i)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=e,this.glyphManager.entries={},this.glyphManager.setURL(e))}addSprite(e,i,r={},n){this._checkLoaded();const o=[{id:e,url:i}],s=[...m(this.stylesheet.sprite),...o];this._validate(t.y.sprite,"sprite",s,null,r)||(this.stylesheet.sprite=s,this._loadSprite(o,!0,n))}removeSprite(e){this._checkLoaded();const i=m(this.stylesheet.sprite);if(i.find((t=>t.id===e))){if(this._spritesImagesIds[e])for(const t of this._spritesImagesIds[e])this.imageManager.removeImage(t),this._changedImages[t]=!0;i.splice(i.findIndex((t=>t.id===e)),1),this.stylesheet.sprite=i.length>0?i:void 0,delete this._spritesImagesIds[e],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new t.l("data",{dataType:"style"}))}else this.fire(new t.k(new Error(`Sprite "${e}" doesn't exists on this map.`)))}getSprite(){return m(this.stylesheet.sprite)}setSprite(e,i={},r){this._checkLoaded(),e&&this._validate(t.y.sprite,"sprite",e,null,i)||(this.stylesheet.sprite=e,e?this._loadSprite(e,!0,r):(this._unloadSprite(),r&&r(null)))}}var xi=t.aG([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class bi{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(e,t,i,r,n,o,s,a,l){this.context=e;let c=this.boundPaintVertexBuffers.length!==r.length;for(let e=0;!c&&e<r.length;e++)this.boundPaintVertexBuffers[e]!==r[e]&&(c=!0);!this.vao||this.boundProgram!==t||this.boundLayoutVertexBuffer!==i||c||this.boundIndexBuffer!==n||this.boundVertexOffset!==o||this.boundDynamicVertexBuffer!==s||this.boundDynamicVertexBuffer2!==a||this.boundDynamicVertexBuffer3!==l?this.freshBind(t,i,r,n,o,s,a,l):(e.bindVertexArray.set(this.vao),s&&s.bind(),n&&n.dynamicDraw&&n.bind(),a&&a.bind(),l&&l.bind())}freshBind(e,t,i,r,n,o,s,a){const l=e.numAttributes,c=this.context,u=c.gl;this.vao&&this.destroy(),this.vao=c.createVertexArray(),c.bindVertexArray.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=t,this.boundPaintVertexBuffers=i,this.boundIndexBuffer=r,this.boundVertexOffset=n,this.boundDynamicVertexBuffer=o,this.boundDynamicVertexBuffer2=s,this.boundDynamicVertexBuffer3=a,t.enableAttributes(u,e);for(const t of i)t.enableAttributes(u,e);o&&o.enableAttributes(u,e),s&&s.enableAttributes(u,e),a&&a.enableAttributes(u,e),t.bind(),t.setVertexAttribPointers(u,e,n);for(const t of i)t.bind(),t.setVertexAttribPointers(u,e,n);o&&(o.bind(),o.setVertexAttribPointers(u,e,n)),r&&r.bind(),s&&(s.bind(),s.setVertexAttribPointers(u,e,n)),a&&(a.bind(),a.setVertexAttribPointers(u,e,n)),c.currentNumAttributes=l}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const wi=(e,i,r,n,o)=>({u_texture:0,u_ele_delta:e,u_fog_matrix:i,u_fog_color:r?r.properties.get("fog-color"):t.b7.white,u_fog_ground_blend:r?r.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:o?0:r?r.calculateFogBlendOpacity(n):0,u_horizon_color:r?r.properties.get("horizon-color"):t.b7.white,u_horizon_fog_blend:r?r.properties.get("horizon-fog-blend"):1,u_is_globe_mode:o?1:0}),Ti={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function Bi(e){const t=[];for(let i=0;i<e.length;i++){if(null===e[i])continue;const r=e[i].split(" ");t.push(r.pop())}return t}class Ci{constructor(e,i,r,n,o,s,a,l){const c=e.gl;this.program=c.createProgram();const u=Bi(i.staticAttributes),h=r?r.getBinderAttributes():[],d=u.concat(h),p=vt.prelude.staticUniforms?Bi(vt.prelude.staticUniforms):[],f=a.staticUniforms?Bi(a.staticUniforms):[],A=i.staticUniforms?Bi(i.staticUniforms):[],m=r?r.getBinderUniforms():[],g=p.concat(f).concat(A).concat(m),_=[];for(const e of g)_.indexOf(e)<0&&_.push(e);const y=r?r.defines():[];$t(c)&&y.unshift("#version 300 es"),o&&y.push("#define OVERDRAW_INSPECTOR;"),s&&y.push("#define TERRAIN3D;"),l&&y.push(l);let v=y.concat(vt.prelude.fragmentSource,a.fragmentSource,i.fragmentSource).join("\n"),x=y.concat(vt.prelude.vertexSource,a.vertexSource,i.vertexSource).join("\n");$t(c)||(v=function(e){return e.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")}(v),x=function(e){return e.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")}(x));const b=c.createShader(c.FRAGMENT_SHADER);if(c.isContextLost())return void(this.failedToCreate=!0);if(c.shaderSource(b,v),c.compileShader(b),!c.getShaderParameter(b,c.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${c.getShaderInfoLog(b)}`);c.attachShader(this.program,b);const w=c.createShader(c.VERTEX_SHADER);if(c.isContextLost())return void(this.failedToCreate=!0);if(c.shaderSource(w,x),c.compileShader(w),!c.getShaderParameter(w,c.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${c.getShaderInfoLog(w)}`);c.attachShader(this.program,w),this.attributes={};const T={};this.numAttributes=d.length;for(let e=0;e<this.numAttributes;e++)d[e]&&(c.bindAttribLocation(this.program,e,d[e]),this.attributes[d[e]]=e);if(c.linkProgram(this.program),!c.getProgramParameter(this.program,c.LINK_STATUS))throw new Error(`Program failed to link: ${c.getProgramInfoLog(this.program)}`);c.deleteShader(w),c.deleteShader(b);for(let e=0;e<_.length;e++){const t=_[e];if(t&&!T[t]){const e=c.getUniformLocation(this.program,t);e&&(T[t]=e)}}this.fixedUniforms=n(e,T),this.terrainUniforms=((e,i)=>({u_depth:new t.bH(e,i.u_depth),u_terrain:new t.bH(e,i.u_terrain),u_terrain_dim:new t.b8(e,i.u_terrain_dim),u_terrain_matrix:new t.bJ(e,i.u_terrain_matrix),u_terrain_unpack:new t.bK(e,i.u_terrain_unpack),u_terrain_exaggeration:new t.b8(e,i.u_terrain_exaggeration)}))(e,T),this.projectionUniforms=((e,i)=>({u_projection_matrix:new t.bJ(e,i.u_projection_matrix),u_projection_tile_mercator_coords:new t.bK(e,i.u_projection_tile_mercator_coords),u_projection_clipping_plane:new t.bK(e,i.u_projection_clipping_plane),u_projection_transition:new t.b8(e,i.u_projection_transition),u_projection_fallback_matrix:new t.bJ(e,i.u_projection_fallback_matrix)}))(e,T),this.binderUniforms=r?r.getUniforms(e,T):[]}draw(e,t,i,r,n,o,s,a,l,c,u,h,d,p,f,A,m,g,_){const y=e.gl;if(this.failedToCreate)return;if(e.program.set(this.program),e.setDepthMode(i),e.setStencilMode(r),e.setColorMode(n),e.setCullFace(o),a){e.activeTexture.set(y.TEXTURE2),y.bindTexture(y.TEXTURE_2D,a.depthTexture),e.activeTexture.set(y.TEXTURE3),y.bindTexture(y.TEXTURE_2D,a.texture);for(const e in this.terrainUniforms)this.terrainUniforms[e].set(a[e])}if(l)for(const e in l)this.projectionUniforms[Ti[e]].set(l[e]);if(s)for(const e in this.fixedUniforms)this.fixedUniforms[e].set(s[e]);A&&A.setUniforms(e,this.binderUniforms,p,{zoom:f});let v=0;switch(t){case y.LINES:v=2;break;case y.TRIANGLES:v=3;break;case y.LINE_STRIP:v=1}for(const i of d.get()){const r=i.vaos||(i.vaos={});(r[c]||(r[c]=new bi)).bind(e,this,u,A?A.getPaintVertexBuffers():[],h,i.vertexOffset,m,g,_),y.drawElements(t,i.primitiveLength*v,y.UNSIGNED_SHORT,i.primitiveOffset*v*2)}}}function Si(e,i,r){const n=1/t.az(r,1,i.transform.tileZoom),o=Math.pow(2,r.tileID.overscaledZ),s=r.tileSize*Math.pow(2,i.transform.tileZoom)/o,a=s*(r.tileID.canonical.x+r.tileID.wrap*o),l=s*r.tileID.canonical.y;return{u_image:0,u_texsize:r.imageAtlasTexture.size,u_scale:[n,e.fromScale,e.toScale],u_fade:e.t,u_pixel_coord_upper:[a>>16,l>>16],u_pixel_coord_lower:[65535&a,65535&l]}}const Ei=(e,i,r,n)=>{const o=e.style.light,s=o.properties.get("position"),a=[s.x,s.y,s.z],l=t.bN();"viewport"===o.properties.get("anchor")&&t.bO(l,e.transform.bearingInRadians),t.bP(a,a,l);const c=e.transform.transformLightDirection(a),u=o.properties.get("color");return{u_lightpos:a,u_lightpos_globe:c,u_lightintensity:o.properties.get("intensity"),u_lightcolor:[u.r,u.g,u.b],u_vertical_gradient:+i,u_opacity:r,u_fill_translate:n}},Mi=(e,i,r,n,o,s,a)=>t.e(Ei(e,i,r,n),Si(s,e,a),{u_height_factor:-Math.pow(2,o.overscaledZ)/a.tileSize/8}),Ii=(e,i,r,n)=>t.e(Si(i,e,r),{u_fill_translate:n}),Pi=(e,t)=>({u_world:e,u_fill_translate:t}),Li=(e,i,r,n,o)=>t.e(Ii(e,i,r,o),{u_world:n}),Fi=(e,i,r,n,o)=>{const s=e.transform;let a,l,c=0;if("map"===r.paint.get("circle-pitch-alignment")){const e=t.az(i,1,s.zoom);a=!0,l=[e,e],c=e/(t.Z*Math.pow(2,i.tileID.overscaledZ))*2*Math.PI*o}else a=!1,l=s.pixelsToGLUnits;return{u_camera_to_center_distance:s.cameraToCenterDistance,u_scale_with_map:+("map"===r.paint.get("circle-pitch-scale")),u_pitch_with_map:+a,u_device_pixel_ratio:e.pixelRatio,u_extrude_scale:l,u_globe_extrude_scale:c,u_translate:n}},ki=e=>({u_pixel_extrude_scale:[1/e.width,1/e.height]}),zi=e=>({u_viewport_size:[e.width,e.height]}),Ri=(e,t=1)=>({u_color:e,u_overlay:0,u_overlay_scale:t}),Di=(e,i,r,n)=>{const o=t.az(e,1,i)/(t.Z*Math.pow(2,e.tileID.overscaledZ))*2*Math.PI*n;return{u_extrude_scale:t.az(e,1,i),u_intensity:r,u_globe_extrude_scale:o}},Oi=(e,i,r,n)=>{const o=t.K();t.bQ(o,0,e.width,e.height,0,0,1);const s=e.context.gl;return{u_matrix:o,u_world:[s.drawingBufferWidth,s.drawingBufferHeight],u_image:r,u_color_ramp:n,u_opacity:i.paint.get("heatmap-opacity")}},Ui=(e,t,i)=>{const r=i.paint.get("hillshade-shadow-color"),n=i.paint.get("hillshade-highlight-color"),o=i.paint.get("hillshade-accent-color");let s=i.paint.get("hillshade-illumination-direction")*(Math.PI/180);return"viewport"===i.paint.get("hillshade-illumination-anchor")&&(s+=e.transform.bearingInRadians),{u_image:0,u_latrange:Qi(0,t.tileID),u_light:[i.paint.get("hillshade-exaggeration"),s],u_shadow:r,u_highlight:n,u_accent:o}},Ni=(e,i)=>{const r=i.stride,n=t.K();return t.bQ(n,0,t.Z,-8192,0,0,1),t.L(n,n,[0,-8192,0]),{u_matrix:n,u_image:1,u_dimension:[r,r],u_zoom:e.overscaledZ,u_unpack:i.getUnpackVector()}};function Qi(e,i){const r=Math.pow(2,i.canonical.z),n=i.canonical.y;return[new t.$(0,n/r).toLngLat().lat,new t.$(0,(n+1)/r).toLngLat().lat]}const ji=(e,i,r,n)=>{const o=e.transform;return{u_translation:Zi(e,i,r),u_ratio:n/t.az(i,1,o.zoom),u_device_pixel_ratio:e.pixelRatio,u_units_to_pixels:[1/o.pixelsToGLUnits[0],1/o.pixelsToGLUnits[1]]}},Vi=(e,i,r,n,o)=>t.e(ji(e,i,r,n),{u_image:0,u_image_height:o}),Hi=(e,i,r,n,o)=>{const s=e.transform,a=$i(i,s);return{u_translation:Zi(e,i,r),u_texsize:i.imageAtlasTexture.size,u_ratio:n/t.az(i,1,s.zoom),u_device_pixel_ratio:e.pixelRatio,u_image:0,u_scale:[a,o.fromScale,o.toScale],u_fade:o.t,u_units_to_pixels:[1/s.pixelsToGLUnits[0],1/s.pixelsToGLUnits[1]]}},Gi=(e,i,r,n,o,s)=>{const a=e.lineAtlas,l=$i(i,e.transform),c="round"===r.layout.get("line-cap"),u=a.getDash(o.from,c),h=a.getDash(o.to,c),d=u.width*s.fromScale,p=h.width*s.toScale;return t.e(ji(e,i,r,n),{u_patternscale_a:[l/d,-u.height/2],u_patternscale_b:[l/p,-h.height/2],u_sdfgamma:a.width/(256*Math.min(d,p)*e.pixelRatio)/2,u_image:0,u_tex_y_a:u.y,u_tex_y_b:h.y,u_mix:s.t})};function $i(e,i){return 1/t.az(e,1,i.tileZoom)}function Zi(e,i,r){return t.aA(e.transform,i,r.paint.get("line-translate"),r.paint.get("line-translate-anchor"))}const qi=(e,t,i,r,n)=>{return{u_tl_parent:e,u_scale_parent:t,u_buffer_scale:1,u_fade_t:i.mix,u_opacity:i.opacity*r.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:r.paint.get("raster-brightness-min"),u_brightness_high:r.paint.get("raster-brightness-max"),u_saturation_factor:(s=r.paint.get("raster-saturation"),s>0?1-1/(1.001-s):-s),u_contrast_factor:(o=r.paint.get("raster-contrast"),o>0?1/(1-o):1+o),u_spin_weights:Ki(r.paint.get("raster-hue-rotate")),u_coords_top:[n[0].x,n[0].y,n[1].x,n[1].y],u_coords_bottom:[n[3].x,n[3].y,n[2].x,n[2].y]};var o,s};function Ki(e){e*=Math.PI/180;const t=Math.sin(e),i=Math.cos(e);return[(2*i+1)/3,(-Math.sqrt(3)*t-i+1)/3,(Math.sqrt(3)*t-i+1)/3]}const Wi=(e,t,i,r,n,o,s,a,l,c,u,h,d)=>{const p=s.transform;return{u_is_size_zoom_constant:+("constant"===e||"source"===e),u_is_size_feature_constant:+("constant"===e||"camera"===e),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:p.cameraToCenterDistance,u_pitch:p.pitch/360*2*Math.PI,u_rotate_symbol:+i,u_aspect_ratio:p.width/p.height,u_fade_change:s.options.fadeDuration?s.symbolFadeChange:1,u_label_plane_matrix:a,u_coord_matrix:l,u_is_text:+u,u_pitch_with_map:+r,u_is_along_line:n,u_is_variable_anchor:o,u_texsize:h,u_texture:0,u_translation:c,u_pitched_scale:d}},Xi=(e,i,r,n,o,s,a,l,c,u,h,d,p,f)=>{const A=a.transform;return t.e(Wi(e,i,r,n,o,s,a,l,c,u,h,d,f),{u_gamma_scale:n?Math.cos(A.pitch*Math.PI/180)*A.cameraToCenterDistance:1,u_device_pixel_ratio:a.pixelRatio,u_is_halo:1})},Yi=(e,i,r,n,o,s,a,l,c,u,h,d,p)=>t.e(Xi(e,i,r,n,o,s,a,l,c,u,!0,h,0,p),{u_texsize_icon:d,u_texture_icon:1}),Ji=(e,t)=>({u_opacity:e,u_color:t}),er=(e,i,r,n,o)=>t.e(function(e,i,r,n){const o=r.imageManager.getPattern(e.from.toString()),s=r.imageManager.getPattern(e.to.toString()),{width:a,height:l}=r.imageManager.getPixelSize(),c=Math.pow(2,n.tileID.overscaledZ),u=n.tileSize*Math.pow(2,r.transform.tileZoom)/c,h=u*(n.tileID.canonical.x+n.tileID.wrap*c),d=u*n.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:o.tl,u_pattern_br_a:o.br,u_pattern_tl_b:s.tl,u_pattern_br_b:s.br,u_texsize:[a,l],u_mix:i.t,u_pattern_size_a:o.displaySize,u_pattern_size_b:s.displaySize,u_scale_a:i.fromScale,u_scale_b:i.toScale,u_tile_units_to_pixels:1/t.az(n,1,r.transform.tileZoom),u_pixel_coord_upper:[h>>16,d>>16],u_pixel_coord_lower:[65535&h,65535&d]}}(r,o,i,n),{u_opacity:e}),tr=(e,t)=>{},ir={fillExtrusion:(e,i)=>({u_lightpos:new t.bL(e,i.u_lightpos),u_lightpos_globe:new t.bL(e,i.u_lightpos_globe),u_lightintensity:new t.b8(e,i.u_lightintensity),u_lightcolor:new t.bL(e,i.u_lightcolor),u_vertical_gradient:new t.b8(e,i.u_vertical_gradient),u_opacity:new t.b8(e,i.u_opacity),u_fill_translate:new t.bM(e,i.u_fill_translate)}),fillExtrusionPattern:(e,i)=>({u_lightpos:new t.bL(e,i.u_lightpos),u_lightpos_globe:new t.bL(e,i.u_lightpos_globe),u_lightintensity:new t.b8(e,i.u_lightintensity),u_lightcolor:new t.bL(e,i.u_lightcolor),u_vertical_gradient:new t.b8(e,i.u_vertical_gradient),u_height_factor:new t.b8(e,i.u_height_factor),u_opacity:new t.b8(e,i.u_opacity),u_fill_translate:new t.bM(e,i.u_fill_translate),u_image:new t.bH(e,i.u_image),u_texsize:new t.bM(e,i.u_texsize),u_pixel_coord_upper:new t.bM(e,i.u_pixel_coord_upper),u_pixel_coord_lower:new t.bM(e,i.u_pixel_coord_lower),u_scale:new t.bL(e,i.u_scale),u_fade:new t.b8(e,i.u_fade)}),fill:(e,i)=>({u_fill_translate:new t.bM(e,i.u_fill_translate)}),fillPattern:(e,i)=>({u_image:new t.bH(e,i.u_image),u_texsize:new t.bM(e,i.u_texsize),u_pixel_coord_upper:new t.bM(e,i.u_pixel_coord_upper),u_pixel_coord_lower:new t.bM(e,i.u_pixel_coord_lower),u_scale:new t.bL(e,i.u_scale),u_fade:new t.b8(e,i.u_fade),u_fill_translate:new t.bM(e,i.u_fill_translate)}),fillOutline:(e,i)=>({u_world:new t.bM(e,i.u_world),u_fill_translate:new t.bM(e,i.u_fill_translate)}),fillOutlinePattern:(e,i)=>({u_world:new t.bM(e,i.u_world),u_image:new t.bH(e,i.u_image),u_texsize:new t.bM(e,i.u_texsize),u_pixel_coord_upper:new t.bM(e,i.u_pixel_coord_upper),u_pixel_coord_lower:new t.bM(e,i.u_pixel_coord_lower),u_scale:new t.bL(e,i.u_scale),u_fade:new t.b8(e,i.u_fade),u_fill_translate:new t.bM(e,i.u_fill_translate)}),circle:(e,i)=>({u_camera_to_center_distance:new t.b8(e,i.u_camera_to_center_distance),u_scale_with_map:new t.bH(e,i.u_scale_with_map),u_pitch_with_map:new t.bH(e,i.u_pitch_with_map),u_extrude_scale:new t.bM(e,i.u_extrude_scale),u_device_pixel_ratio:new t.b8(e,i.u_device_pixel_ratio),u_globe_extrude_scale:new t.b8(e,i.u_globe_extrude_scale),u_translate:new t.bM(e,i.u_translate)}),collisionBox:(e,i)=>({u_pixel_extrude_scale:new t.bM(e,i.u_pixel_extrude_scale)}),collisionCircle:(e,i)=>({u_viewport_size:new t.bM(e,i.u_viewport_size)}),debug:(e,i)=>({u_color:new t.bI(e,i.u_color),u_overlay:new t.bH(e,i.u_overlay),u_overlay_scale:new t.b8(e,i.u_overlay_scale)}),depth:tr,clippingMask:tr,heatmap:(e,i)=>({u_extrude_scale:new t.b8(e,i.u_extrude_scale),u_intensity:new t.b8(e,i.u_intensity),u_globe_extrude_scale:new t.b8(e,i.u_globe_extrude_scale)}),heatmapTexture:(e,i)=>({u_matrix:new t.bJ(e,i.u_matrix),u_world:new t.bM(e,i.u_world),u_image:new t.bH(e,i.u_image),u_color_ramp:new t.bH(e,i.u_color_ramp),u_opacity:new t.b8(e,i.u_opacity)}),hillshade:(e,i)=>({u_image:new t.bH(e,i.u_image),u_latrange:new t.bM(e,i.u_latrange),u_light:new t.bM(e,i.u_light),u_shadow:new t.bI(e,i.u_shadow),u_highlight:new t.bI(e,i.u_highlight),u_accent:new t.bI(e,i.u_accent)}),hillshadePrepare:(e,i)=>({u_matrix:new t.bJ(e,i.u_matrix),u_image:new t.bH(e,i.u_image),u_dimension:new t.bM(e,i.u_dimension),u_zoom:new t.b8(e,i.u_zoom),u_unpack:new t.bK(e,i.u_unpack)}),line:(e,i)=>({u_translation:new t.bM(e,i.u_translation),u_ratio:new t.b8(e,i.u_ratio),u_device_pixel_ratio:new t.b8(e,i.u_device_pixel_ratio),u_units_to_pixels:new t.bM(e,i.u_units_to_pixels)}),lineGradient:(e,i)=>({u_translation:new t.bM(e,i.u_translation),u_ratio:new t.b8(e,i.u_ratio),u_device_pixel_ratio:new t.b8(e,i.u_device_pixel_ratio),u_units_to_pixels:new t.bM(e,i.u_units_to_pixels),u_image:new t.bH(e,i.u_image),u_image_height:new t.b8(e,i.u_image_height)}),linePattern:(e,i)=>({u_translation:new t.bM(e,i.u_translation),u_texsize:new t.bM(e,i.u_texsize),u_ratio:new t.b8(e,i.u_ratio),u_device_pixel_ratio:new t.b8(e,i.u_device_pixel_ratio),u_image:new t.bH(e,i.u_image),u_units_to_pixels:new t.bM(e,i.u_units_to_pixels),u_scale:new t.bL(e,i.u_scale),u_fade:new t.b8(e,i.u_fade)}),lineSDF:(e,i)=>({u_translation:new t.bM(e,i.u_translation),u_ratio:new t.b8(e,i.u_ratio),u_device_pixel_ratio:new t.b8(e,i.u_device_pixel_ratio),u_units_to_pixels:new t.bM(e,i.u_units_to_pixels),u_patternscale_a:new t.bM(e,i.u_patternscale_a),u_patternscale_b:new t.bM(e,i.u_patternscale_b),u_sdfgamma:new t.b8(e,i.u_sdfgamma),u_image:new t.bH(e,i.u_image),u_tex_y_a:new t.b8(e,i.u_tex_y_a),u_tex_y_b:new t.b8(e,i.u_tex_y_b),u_mix:new t.b8(e,i.u_mix)}),raster:(e,i)=>({u_tl_parent:new t.bM(e,i.u_tl_parent),u_scale_parent:new t.b8(e,i.u_scale_parent),u_buffer_scale:new t.b8(e,i.u_buffer_scale),u_fade_t:new t.b8(e,i.u_fade_t),u_opacity:new t.b8(e,i.u_opacity),u_image0:new t.bH(e,i.u_image0),u_image1:new t.bH(e,i.u_image1),u_brightness_low:new t.b8(e,i.u_brightness_low),u_brightness_high:new t.b8(e,i.u_brightness_high),u_saturation_factor:new t.b8(e,i.u_saturation_factor),u_contrast_factor:new t.b8(e,i.u_contrast_factor),u_spin_weights:new t.bL(e,i.u_spin_weights),u_coords_top:new t.bK(e,i.u_coords_top),u_coords_bottom:new t.bK(e,i.u_coords_bottom)}),symbolIcon:(e,i)=>({u_is_size_zoom_constant:new t.bH(e,i.u_is_size_zoom_constant),u_is_size_feature_constant:new t.bH(e,i.u_is_size_feature_constant),u_size_t:new t.b8(e,i.u_size_t),u_size:new t.b8(e,i.u_size),u_camera_to_center_distance:new t.b8(e,i.u_camera_to_center_distance),u_pitch:new t.b8(e,i.u_pitch),u_rotate_symbol:new t.bH(e,i.u_rotate_symbol),u_aspect_ratio:new t.b8(e,i.u_aspect_ratio),u_fade_change:new t.b8(e,i.u_fade_change),u_label_plane_matrix:new t.bJ(e,i.u_label_plane_matrix),u_coord_matrix:new t.bJ(e,i.u_coord_matrix),u_is_text:new t.bH(e,i.u_is_text),u_pitch_with_map:new t.bH(e,i.u_pitch_with_map),u_is_along_line:new t.bH(e,i.u_is_along_line),u_is_variable_anchor:new t.bH(e,i.u_is_variable_anchor),u_texsize:new t.bM(e,i.u_texsize),u_texture:new t.bH(e,i.u_texture),u_translation:new t.bM(e,i.u_translation),u_pitched_scale:new t.b8(e,i.u_pitched_scale)}),symbolSDF:(e,i)=>({u_is_size_zoom_constant:new t.bH(e,i.u_is_size_zoom_constant),u_is_size_feature_constant:new t.bH(e,i.u_is_size_feature_constant),u_size_t:new t.b8(e,i.u_size_t),u_size:new t.b8(e,i.u_size),u_camera_to_center_distance:new t.b8(e,i.u_camera_to_center_distance),u_pitch:new t.b8(e,i.u_pitch),u_rotate_symbol:new t.bH(e,i.u_rotate_symbol),u_aspect_ratio:new t.b8(e,i.u_aspect_ratio),u_fade_change:new t.b8(e,i.u_fade_change),u_label_plane_matrix:new t.bJ(e,i.u_label_plane_matrix),u_coord_matrix:new t.bJ(e,i.u_coord_matrix),u_is_text:new t.bH(e,i.u_is_text),u_pitch_with_map:new t.bH(e,i.u_pitch_with_map),u_is_along_line:new t.bH(e,i.u_is_along_line),u_is_variable_anchor:new t.bH(e,i.u_is_variable_anchor),u_texsize:new t.bM(e,i.u_texsize),u_texture:new t.bH(e,i.u_texture),u_gamma_scale:new t.b8(e,i.u_gamma_scale),u_device_pixel_ratio:new t.b8(e,i.u_device_pixel_ratio),u_is_halo:new t.bH(e,i.u_is_halo),u_translation:new t.bM(e,i.u_translation),u_pitched_scale:new t.b8(e,i.u_pitched_scale)}),symbolTextAndIcon:(e,i)=>({u_is_size_zoom_constant:new t.bH(e,i.u_is_size_zoom_constant),u_is_size_feature_constant:new t.bH(e,i.u_is_size_feature_constant),u_size_t:new t.b8(e,i.u_size_t),u_size:new t.b8(e,i.u_size),u_camera_to_center_distance:new t.b8(e,i.u_camera_to_center_distance),u_pitch:new t.b8(e,i.u_pitch),u_rotate_symbol:new t.bH(e,i.u_rotate_symbol),u_aspect_ratio:new t.b8(e,i.u_aspect_ratio),u_fade_change:new t.b8(e,i.u_fade_change),u_label_plane_matrix:new t.bJ(e,i.u_label_plane_matrix),u_coord_matrix:new t.bJ(e,i.u_coord_matrix),u_is_text:new t.bH(e,i.u_is_text),u_pitch_with_map:new t.bH(e,i.u_pitch_with_map),u_is_along_line:new t.bH(e,i.u_is_along_line),u_is_variable_anchor:new t.bH(e,i.u_is_variable_anchor),u_texsize:new t.bM(e,i.u_texsize),u_texsize_icon:new t.bM(e,i.u_texsize_icon),u_texture:new t.bH(e,i.u_texture),u_texture_icon:new t.bH(e,i.u_texture_icon),u_gamma_scale:new t.b8(e,i.u_gamma_scale),u_device_pixel_ratio:new t.b8(e,i.u_device_pixel_ratio),u_is_halo:new t.bH(e,i.u_is_halo),u_translation:new t.bM(e,i.u_translation),u_pitched_scale:new t.b8(e,i.u_pitched_scale)}),background:(e,i)=>({u_opacity:new t.b8(e,i.u_opacity),u_color:new t.bI(e,i.u_color)}),backgroundPattern:(e,i)=>({u_opacity:new t.b8(e,i.u_opacity),u_image:new t.bH(e,i.u_image),u_pattern_tl_a:new t.bM(e,i.u_pattern_tl_a),u_pattern_br_a:new t.bM(e,i.u_pattern_br_a),u_pattern_tl_b:new t.bM(e,i.u_pattern_tl_b),u_pattern_br_b:new t.bM(e,i.u_pattern_br_b),u_texsize:new t.bM(e,i.u_texsize),u_mix:new t.b8(e,i.u_mix),u_pattern_size_a:new t.bM(e,i.u_pattern_size_a),u_pattern_size_b:new t.bM(e,i.u_pattern_size_b),u_scale_a:new t.b8(e,i.u_scale_a),u_scale_b:new t.b8(e,i.u_scale_b),u_pixel_coord_upper:new t.bM(e,i.u_pixel_coord_upper),u_pixel_coord_lower:new t.bM(e,i.u_pixel_coord_lower),u_tile_units_to_pixels:new t.b8(e,i.u_tile_units_to_pixels)}),terrain:(e,i)=>({u_texture:new t.bH(e,i.u_texture),u_ele_delta:new t.b8(e,i.u_ele_delta),u_fog_matrix:new t.bJ(e,i.u_fog_matrix),u_fog_color:new t.bI(e,i.u_fog_color),u_fog_ground_blend:new t.b8(e,i.u_fog_ground_blend),u_fog_ground_blend_opacity:new t.b8(e,i.u_fog_ground_blend_opacity),u_horizon_color:new t.bI(e,i.u_horizon_color),u_horizon_fog_blend:new t.b8(e,i.u_horizon_fog_blend),u_is_globe_mode:new t.b8(e,i.u_is_globe_mode)}),terrainDepth:(e,i)=>({u_ele_delta:new t.b8(e,i.u_ele_delta)}),terrainCoords:(e,i)=>({u_texture:new t.bH(e,i.u_texture),u_terrain_coords_id:new t.b8(e,i.u_terrain_coords_id),u_ele_delta:new t.b8(e,i.u_ele_delta)}),projectionErrorMeasurement:(e,i)=>({u_input:new t.b8(e,i.u_input),u_output_expected:new t.b8(e,i.u_output_expected)}),atmosphere:(e,i)=>({u_sun_pos:new t.bL(e,i.u_sun_pos),u_atmosphere_blend:new t.b8(e,i.u_atmosphere_blend),u_globe_position:new t.bL(e,i.u_globe_position),u_globe_radius:new t.b8(e,i.u_globe_radius),u_inv_proj_matrix:new t.bJ(e,i.u_inv_proj_matrix)}),sky:(e,i)=>({u_sky_color:new t.bI(e,i.u_sky_color),u_horizon_color:new t.bI(e,i.u_horizon_color),u_horizon:new t.bM(e,i.u_horizon),u_horizon_normal:new t.bM(e,i.u_horizon_normal),u_sky_horizon_blend:new t.b8(e,i.u_sky_horizon_blend),u_sky_blend:new t.b8(e,i.u_sky_blend)})};class rr{constructor(e,t,i){this.context=e;const r=e.gl;this.buffer=r.createBuffer(),this.dynamicDraw=Boolean(i),this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),r.bufferData(r.ELEMENT_ARRAY_BUFFER,t.arrayBuffer,this.dynamicDraw?r.DYNAMIC_DRAW:r.STATIC_DRAW),this.dynamicDraw||delete t.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){const t=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),t.bufferSubData(t.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const nr={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class or{constructor(e,t,i,r){this.length=t.length,this.attributes=i,this.itemSize=t.bytesPerElement,this.dynamicDraw=r,this.context=e;const n=e.gl;this.buffer=n.createBuffer(),e.bindVertexBuffer.set(this.buffer),n.bufferData(n.ARRAY_BUFFER,t.arrayBuffer,this.dynamicDraw?n.DYNAMIC_DRAW:n.STATIC_DRAW),this.dynamicDraw||delete t.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){if(e.length!==this.length)throw new Error(`Length of new data is ${e.length}, which doesn't match current length of ${this.length}`);const t=this.context.gl;this.bind(),t.bufferSubData(t.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,t){for(let i=0;i<this.attributes.length;i++){const r=t.attributes[this.attributes[i].name];void 0!==r&&e.enableVertexAttribArray(r)}}setVertexAttribPointers(e,t,i){for(let r=0;r<this.attributes.length;r++){const n=this.attributes[r],o=t.attributes[n.name];void 0!==o&&e.vertexAttribPointer(o,n.components,e[nr[n.type]],!1,this.itemSize,n.offset+this.itemSize*(i||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class sr{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class ar extends sr{getDefault(){return t.b7.transparent}set(e){const t=this.current;(e.r!==t.r||e.g!==t.g||e.b!==t.b||e.a!==t.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class lr extends sr{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class cr extends sr{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class ur extends sr{getDefault(){return[!0,!0,!0,!0]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||e[3]!==t[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class hr extends sr{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class dr extends sr{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class pr extends sr{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){const t=this.current;(e.func!==t.func||e.ref!==t.ref||e.mask!==t.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class fr extends sr{getDefault(){const e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class Ar extends sr{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;e?t.enable(t.STENCIL_TEST):t.disable(t.STENCIL_TEST),this.current=e,this.dirty=!1}}class mr extends sr{getDefault(){return[0,1]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class gr extends sr{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;e?t.enable(t.DEPTH_TEST):t.disable(t.DEPTH_TEST),this.current=e,this.dirty=!1}}class _r extends sr{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class yr extends sr{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;e?t.enable(t.BLEND):t.disable(t.BLEND),this.current=e,this.dirty=!1}}class vr extends sr{getDefault(){const e=this.gl;return[e.ONE,e.ZERO]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||this.dirty)&&(this.gl.blendFunc(e[0],e[1]),this.current=e,this.dirty=!1)}}class xr extends sr{getDefault(){return t.b7.transparent}set(e){const t=this.current;(e.r!==t.r||e.g!==t.g||e.b!==t.b||e.a!==t.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class br extends sr{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquation(e),this.current=e,this.dirty=!1)}}class wr extends sr{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;e?t.enable(t.CULL_FACE):t.disable(t.CULL_FACE),this.current=e,this.dirty=!1}}class Tr extends sr{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class Br extends sr{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}class Cr extends sr{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}}class Sr extends sr{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class Er extends sr{getDefault(){const e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||e[3]!==t[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class Mr extends sr{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.bindFramebuffer(t.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class Ir extends sr{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.bindRenderbuffer(t.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class Pr extends sr{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.bindTexture(t.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class Lr extends sr{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.bindBuffer(t.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class Fr extends sr{getDefault(){return null}set(e){const t=this.gl;t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class kr extends sr{getDefault(){return null}set(e){var t;if(e===this.current&&!this.dirty)return;const i=this.gl;$t(i)?i.bindVertexArray(e):null===(t=i.getExtension("OES_vertex_array_object"))||void 0===t||t.bindVertexArrayOES(e),this.current=e,this.dirty=!1}}class zr extends sr{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.pixelStorei(t.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class Rr extends sr{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class Dr extends sr{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class Or extends sr{constructor(e,t){super(e),this.context=e,this.parent=t}getDefault(){return null}}class Ur extends Or{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const t=this.gl;t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class Nr extends Or{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const t=this.gl;t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class Qr extends Or{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const t=this.gl;t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.RENDERBUFFER,e),this.current=e,this.dirty=!1}}const jr="Framebuffer is not complete";class Vr{constructor(e,t,i,r,n){this.context=e,this.width=t,this.height=i;const o=e.gl,s=this.framebuffer=o.createFramebuffer();if(this.colorAttachment=new Ur(e,s),r)this.depthAttachment=n?new Qr(e,s):new Nr(e,s);else if(n)throw new Error("Stencil cannot be set without depth");if(o.checkFramebufferStatus(o.FRAMEBUFFER)!==o.FRAMEBUFFER_COMPLETE)throw new Error(jr)}destroy(){const e=this.context.gl,t=this.colorAttachment.get();if(t&&e.deleteTexture(t),this.depthAttachment){const t=this.depthAttachment.get();t&&e.deleteRenderbuffer(t)}e.deleteFramebuffer(this.framebuffer)}}class Hr{constructor(e){var t,i;if(this.gl=e,this.clearColor=new ar(this),this.clearDepth=new lr(this),this.clearStencil=new cr(this),this.colorMask=new ur(this),this.depthMask=new hr(this),this.stencilMask=new dr(this),this.stencilFunc=new pr(this),this.stencilOp=new fr(this),this.stencilTest=new Ar(this),this.depthRange=new mr(this),this.depthTest=new gr(this),this.depthFunc=new _r(this),this.blend=new yr(this),this.blendFunc=new vr(this),this.blendColor=new xr(this),this.blendEquation=new br(this),this.cullFace=new wr(this),this.cullFaceSide=new Tr(this),this.frontFace=new Br(this),this.program=new Cr(this),this.activeTexture=new Sr(this),this.viewport=new Er(this),this.bindFramebuffer=new Mr(this),this.bindRenderbuffer=new Ir(this),this.bindTexture=new Pr(this),this.bindVertexBuffer=new Lr(this),this.bindElementBuffer=new Fr(this),this.bindVertexArray=new kr(this),this.pixelStoreUnpack=new zr(this),this.pixelStoreUnpackPremultiplyAlpha=new Rr(this),this.pixelStoreUnpackFlipY=new Dr(this),this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),$t(e)){this.HALF_FLOAT=e.HALF_FLOAT;const r=e.getExtension("EXT_color_buffer_half_float");this.RGBA16F=null!==(t=e.RGBA16F)&&void 0!==t?t:null==r?void 0:r.RGBA16F_EXT,this.RGB16F=null!==(i=e.RGB16F)&&void 0!==i?i:null==r?void 0:r.RGB16F_EXT,e.getExtension("EXT_color_buffer_float")}else{e.getExtension("EXT_color_buffer_half_float"),e.getExtension("OES_texture_half_float_linear");const t=e.getExtension("OES_texture_half_float");this.HALF_FLOAT=null==t?void 0:t.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,t){return new rr(this,e,t)}createVertexBuffer(e,t,i){return new or(this,e,t,i)}createRenderbuffer(e,t,i){const r=this.gl,n=r.createRenderbuffer();return this.bindRenderbuffer.set(n),r.renderbufferStorage(r.RENDERBUFFER,e,t,i),this.bindRenderbuffer.set(null),n}createFramebuffer(e,t,i,r){return new Vr(this,e,t,i,r)}clear({color:e,depth:t,stencil:i}){const r=this.gl;let n=0;e&&(n|=r.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),void 0!==t&&(n|=r.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(t),this.depthMask.set(!0)),void 0!==i&&(n|=r.STENCIL_BUFFER_BIT,this.clearStencil.set(i),this.stencilMask.set(255)),r.clear(n)}setCullFace(e){!1===e.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(e){t.bE(e.blendFunction,Ut.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)}createVertexArray(){var e;return $t(this.gl)?this.gl.createVertexArray():null===(e=this.gl.getExtension("OES_vertex_array_object"))||void 0===e?void 0:e.createVertexArrayOES()}deleteVertexArray(e){var t;return $t(this.gl)?this.gl.deleteVertexArray(e):null===(t=this.gl.getExtension("OES_vertex_array_object"))||void 0===t?void 0:t.deleteVertexArrayOES(e)}unbindVAO(){this.bindVertexArray.set(null)}}let Gr;function $r(e,i,r,n,o){const s=e.context,a=e.transform,l=s.gl,c=e.useProgram("collisionBox"),u=[];let h=0,d=0;for(let t=0;t<n.length;t++){const p=n[t],f=i.getTile(p).getBucket(r);if(!f)continue;const A=o?f.textCollisionBox:f.iconCollisionBox,m=f.collisionCircleArray;m.length>0&&(u.push({circleArray:m,circleOffset:d,coord:p}),h+=m.length/4,d=h),A&&c.draw(s,l.LINES,jt.disabled,Ht.disabled,e.colorModeForRenderPass(),Qt.disabled,ki(e.transform),e.style.map.terrain&&e.style.map.terrain.getTerrainData(p),a.getProjectionData({overscaledTileID:p,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),r.id,A.layoutVertexBuffer,A.indexBuffer,A.segments,null,e.transform.zoom,null,null,A.collisionVertexBuffer)}if(!o||!u.length)return;const p=e.useProgram("collisionCircle"),f=new t.bR;f.resize(4*h),f._trim();let A=0;for(const e of u)for(let t=0;t<e.circleArray.length/4;t++){const i=4*t,r=e.circleArray[i+0],n=e.circleArray[i+1],o=e.circleArray[i+2],s=e.circleArray[i+3];f.emplace(A++,r,n,o,s,0),f.emplace(A++,r,n,o,s,1),f.emplace(A++,r,n,o,s,2),f.emplace(A++,r,n,o,s,3)}(!Gr||Gr.length<2*h)&&(Gr=function(e){const i=2*e,r=new t.bT;r.resize(i),r._trim();for(let e=0;e<i;e++){const t=6*e;r.uint16[t+0]=4*e+0,r.uint16[t+1]=4*e+1,r.uint16[t+2]=4*e+2,r.uint16[t+3]=4*e+2,r.uint16[t+4]=4*e+3,r.uint16[t+5]=4*e+0}return r}(h));const m=s.createIndexBuffer(Gr,!0),g=s.createVertexBuffer(f,t.bS.members,!0);for(const i of u){const n=zi(e.transform);p.draw(s,l.TRIANGLES,jt.disabled,Ht.disabled,e.colorModeForRenderPass(),Qt.disabled,n,e.style.map.terrain&&e.style.map.terrain.getTerrainData(i.coord),null,r.id,g,m,t.aJ.simpleSegment(0,2*i.circleOffset,i.circleArray.length,i.circleArray.length/2),null,e.transform.zoom,null,null,null)}g.destroy(),m.destroy()}const Zr=t.ad(new Float32Array(16));function qr(e,i,r,n,o,s){const{horizontalAlign:a,verticalAlign:l}=t.aE(e);return new t.P((-(a-.5)*i/o+n[0])*s,(-(l-.5)*r/o+n[1])*s)}function Kr(e,i,r,n,o,s){const a=i.tileAnchorPoint.add(new t.P(i.translation[0],i.translation[1]));if(i.pitchWithMap){let e=n.mult(s);r||(e=e.rotate(-o));const t=a.add(e);return Me(t.x,t.y,i.pitchedLabelPlaneMatrix,i.getElevation).point}if(r){const t=Oe(i.tileAnchorPoint.x+1,i.tileAnchorPoint.y,i).point.sub(e),r=Math.atan(t.y/t.x)+(t.x<0?Math.PI:0);return e.add(n.rotate(r))}return e.add(n)}function Wr(e,i,r,n,o,s,a,l,c,u,h,d){const p=e.text.placedSymbolArray,f=e.text.dynamicLayoutVertexArray,A=e.icon.dynamicLayoutVertexArray,m={};f.clear();for(let A=0;A<p.length;A++){const g=p.get(A),_=g.hidden||!g.crossTileID||e.allowVerticalPlacement&&!g.placedOrientation?null:n[g.crossTileID];if(_){const n=new t.P(g.anchorX,g.anchorY),p={getElevation:d,width:o.width,height:o.height,pitchedLabelPlaneMatrix:s,pitchWithMap:r,transform:o,tileAnchorPoint:n,translation:u,unwrappedTileID:h},A=r?Ne(n.x,n.y,p):Oe(n.x,n.y,p),y=Ie(o.cameraToCenterDistance,A.signedDistanceFromCamera);let v=t.am(e.textSizeData,l,g)*y/t.ay;r&&(v*=e.tilePixelRatio/a);const{width:x,height:b,anchor:w,textOffset:T,textBoxScale:B}=_,C=qr(w,x,b,T,B,v),S=o.getPitchedTextCorrection(n.x+u[0],n.y+u[1],h),E=Kr(A.point,p,i,C,-o.bearingInRadians,S),M=e.allowVerticalPlacement&&g.placedOrientation===t.al.vertical?Math.PI/2:0;for(let e=0;e<g.numGlyphs;e++)t.as(f,E,M);c&&g.associatedIconIndex>=0&&(m[g.associatedIconIndex]={shiftedAnchor:E,angle:M})}else Ge(g.numGlyphs,f)}if(c){A.clear();const i=e.icon.placedSymbolArray;for(let e=0;e<i.length;e++){const r=i.get(e);if(r.hidden)Ge(r.numGlyphs,A);else{const i=m[e];if(i)for(let e=0;e<r.numGlyphs;e++)t.as(A,i.shiftedAnchor,i.angle);else Ge(r.numGlyphs,A)}}e.icon.dynamicLayoutVertexBuffer.updateData(A)}e.text.dynamicLayoutVertexBuffer.updateData(f)}function Xr(e,t,i){return i.iconsInText&&t?"symbolTextAndIcon":e?"symbolSDF":"symbolIcon"}function Yr(e,i,r,n,o,s,a,l,c,u,h,d,p){const f=e.context,A=f.gl,m=e.transform,g="map"===l,_="map"===c,y="viewport"!==l&&"point"!==r.layout.get("symbol-placement"),v=g&&!_&&!y,x=!r.layout.get("symbol-sort-key").isConstant();let b=!1;const w=e.getDepthModeForSublayer(0,jt.ReadOnly),T=r._unevaluatedLayout.hasValue("text-variable-anchor")||r._unevaluatedLayout.hasValue("text-variable-anchor-offset"),B=[],C=m.getCircleRadiusCorrection();for(const l of n){const n=i.getTile(l),c=n.getBucket(r);if(!c)continue;const h=o?c.text:c.icon;if(!h||!h.segments.get().length||!h.hasVisibleVertices)continue;const d=h.programConfigurations.get(r.id),f=o||c.sdfIcons,w=o?c.textSizeData:c.iconSizeData,S=_||0!==m.pitch,E=e.useProgram(Xr(f,o,c),d),M=t.ak(w,m.zoom),I=e.style.map.terrain&&e.style.map.terrain.getTerrainData(l);let P,L,F,k,z=[0,0],R=null;if(o)L=n.glyphAtlasTexture,F=A.LINEAR,P=n.glyphAtlasTexture.size,c.iconsInText&&(z=n.imageAtlasTexture.size,R=n.imageAtlasTexture,k=S||e.options.rotating||e.options.zooming||"composite"===w.kind||"camera"===w.kind?A.LINEAR:A.NEAREST);else{const t=1!==r.layout.get("icon-size").constantOr(0)||c.iconsNeedLinear;L=n.imageAtlasTexture,F=f||e.options.rotating||e.options.zooming||t||S?A.LINEAR:A.NEAREST,P=n.imageAtlasTexture.size}const D=t.az(n,1,e.transform.zoom),O=Ce(g,e.transform,D),U=t.K();t.an(U,O);const N=Se(_,g,e.transform,D),Q=t.aA(m,n,s,a),j=m.getProjectionData({overscaledTileID:l,applyGlobeMatrix:!p,applyTerrainMatrix:!0}),V=T&&c.hasTextData(),H="none"!==r.layout.get("icon-text-fit")&&V&&c.hasIconData();if(y){const t=e.style.map.terrain?(t,i)=>e.style.map.terrain.getElevation(l,t,i):null,i="map"===r.layout.get("text-rotation-alignment");Le(c,e,o,O,U,_,u,i,l.toUnwrapped(),m.width,m.height,Q,t)}const G=o&&T||H,$=y||G?Zr:_?O:e.transform.clipSpaceToPixelsMatrix,Z=f&&0!==r.paint.get(o?"text-halo-width":"icon-halo-width").constantOr(1);let q;q=f?c.iconsInText?Yi(w.kind,M,v,_,y,G,e,$,N,Q,P,z,C):Xi(w.kind,M,v,_,y,G,e,$,N,Q,o,P,0,C):Wi(w.kind,M,v,_,y,G,e,$,N,Q,o,P,C);const K={program:E,buffers:h,uniformValues:q,projectionData:j,atlasTexture:L,atlasTextureIcon:R,atlasInterpolation:F,atlasInterpolationIcon:k,isSDF:f,hasHalo:Z};if(x&&c.canOverlap){b=!0;const e=h.segments.get();for(const i of e)B.push({segments:new t.aJ([i]),sortKey:i.sortKey,state:K,terrainData:I})}else B.push({segments:h.segments,sortKey:0,state:K,terrainData:I})}b&&B.sort(((e,t)=>e.sortKey-t.sortKey));for(const t of B){const i=t.state;if(f.activeTexture.set(A.TEXTURE0),i.atlasTexture.bind(i.atlasInterpolation,A.CLAMP_TO_EDGE),i.atlasTextureIcon&&(f.activeTexture.set(A.TEXTURE1),i.atlasTextureIcon&&i.atlasTextureIcon.bind(i.atlasInterpolationIcon,A.CLAMP_TO_EDGE)),i.isSDF){const n=i.uniformValues;i.hasHalo&&(n.u_is_halo=1,Jr(i.buffers,t.segments,r,e,i.program,w,h,d,n,i.projectionData,t.terrainData)),n.u_is_halo=0}Jr(i.buffers,t.segments,r,e,i.program,w,h,d,i.uniformValues,i.projectionData,t.terrainData)}}function Jr(e,t,i,r,n,o,s,a,l,c,u){const h=r.context;n.draw(h,h.gl.TRIANGLES,o,s,a,Qt.backCCW,l,u,c,i.id,e.layoutVertexBuffer,e.indexBuffer,t,i.paint,r.transform.zoom,e.programConfigurations.get(i.id),e.dynamicLayoutVertexBuffer,e.opacityVertexBuffer)}function en(e,i,r,n,o){const s=e.context,a=s.gl,l=Ht.disabled,c=new Ut([a.ONE,a.ONE],t.b7.transparent,[!0,!0,!0,!0]),u=i.getBucket(r);if(!u)return;const h=n.key;let d=r.heatmapFbos.get(h);d||(d=rn(s,i.tileSize,i.tileSize),r.heatmapFbos.set(h,d)),s.bindFramebuffer.set(d.framebuffer),s.viewport.set([0,0,i.tileSize,i.tileSize]),s.clear({color:t.b7.transparent});const p=u.programConfigurations.get(r.id),f=e.useProgram("heatmap",p,!o),A=e.transform.getProjectionData({overscaledTileID:i.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),m=e.style.map.terrain.getTerrainData(n);f.draw(s,a.TRIANGLES,jt.disabled,l,c,Qt.disabled,Di(i,e.transform.zoom,r.paint.get("heatmap-intensity"),1),m,A,r.id,u.layoutVertexBuffer,u.indexBuffer,u.segments,r.paint,e.transform.zoom,p)}function tn(e,t,i,r,n){const o=e.context,s=o.gl,a=e.transform;o.setColorMode(e.colorModeForRenderPass());const l=nn(o,t),c=i.key,u=t.heatmapFbos.get(c);if(!u)return;o.activeTexture.set(s.TEXTURE0),s.bindTexture(s.TEXTURE_2D,u.colorAttachment.get()),o.activeTexture.set(s.TEXTURE1),l.bind(s.LINEAR,s.CLAMP_TO_EDGE);const h=a.getProjectionData({overscaledTileID:i,applyTerrainMatrix:n,applyGlobeMatrix:!r});e.useProgram("heatmapTexture").draw(o,s.TRIANGLES,jt.disabled,Ht.disabled,e.colorModeForRenderPass(),Qt.disabled,Oi(e,t,0,1),null,h,t.id,e.rasterBoundsBuffer,e.quadTriangleIndexBuffer,e.rasterBoundsSegments,t.paint,a.zoom),u.destroy(),t.heatmapFbos.delete(c)}function rn(e,t,i){var r,n;const o=e.gl,s=o.createTexture();o.bindTexture(o.TEXTURE_2D,s),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,o.LINEAR);const a=null!==(r=e.HALF_FLOAT)&&void 0!==r?r:o.UNSIGNED_BYTE,l=null!==(n=e.RGBA16F)&&void 0!==n?n:o.RGBA;o.texImage2D(o.TEXTURE_2D,0,l,t,i,0,o.RGBA,a,null);const c=e.createFramebuffer(t,i,!1,!1);return c.colorAttachment.set(s),c}function nn(e,t){return t.colorRampTexture||(t.colorRampTexture=new _(e,t.colorRamp,e.gl.RGBA)),t.colorRampTexture}function on(e,t,i,r,n){if(!i||!r||!r.imageAtlas)return;const o=r.imageAtlas.patternPositions;let s=o[i.to.toString()],a=o[i.from.toString()];if(!s&&a&&(s=a),!a&&s&&(a=s),!s||!a){const e=n.getPaintProperty(t);s=o[e],a=o[e]}s&&a&&e.setConstantPatternPositions(s,a)}function sn(e,i,r,n,o,s,a,l){const c=e.context.gl,u="fill-pattern",h=r.paint.get(u),d=h&&h.constantOr(1),p=r.getCrossfadeParameters();let f,A,m,g,_;const y=e.transform,v=r.paint.get("fill-translate"),x=r.paint.get("fill-translate-anchor");a?(A=d&&!r.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",f=c.LINES):(A=d?"fillPattern":"fill",f=c.TRIANGLES);const b=h.constantOr(null);for(const h of n){const w=i.getTile(h);if(d&&!w.patternsLoaded())continue;const T=w.getBucket(r);if(!T)continue;const B=T.programConfigurations.get(r.id),C=e.useProgram(A,B),S=e.style.map.terrain&&e.style.map.terrain.getTerrainData(h);d&&(e.context.activeTexture.set(c.TEXTURE0),w.imageAtlasTexture.bind(c.LINEAR,c.CLAMP_TO_EDGE),B.updatePaintBuffers(p)),on(B,u,b,w,r);const E=y.getProjectionData({overscaledTileID:h,applyGlobeMatrix:!l,applyTerrainMatrix:!0}),M=t.aA(y,w,v,x);if(a){g=T.indexBuffer2,_=T.segments2;const t=[c.drawingBufferWidth,c.drawingBufferHeight];m="fillOutlinePattern"===A&&d?Li(e,p,w,t,M):Pi(t,M)}else g=T.indexBuffer,_=T.segments,m=d?Ii(e,p,w,M):{u_fill_translate:M};let I;if("translucent"===e.renderPass&&l){const[t]=e.getStencilConfigForOverlapAndUpdateStencilID(n);I=t[h.overscaledZ]}else I=e.stencilModeForClipping(h);C.draw(e.context,f,o,I,s,Qt.backCCW,m,S,E,r.id,T.layoutVertexBuffer,g,_,r.paint,e.transform.zoom,B)}}function an(e,i,r,n,o,s,a,l){const c=e.context,u=c.gl,h="fill-extrusion-pattern",d=r.paint.get(h),p=d.constantOr(1),f=r.getCrossfadeParameters(),A=r.paint.get("fill-extrusion-opacity"),m=d.constantOr(null),g=e.transform;for(const d of n){const n=i.getTile(d),_=n.getBucket(r);if(!_)continue;const y=e.style.map.terrain&&e.style.map.terrain.getTerrainData(d),v=_.programConfigurations.get(r.id),x=e.useProgram(p?"fillExtrusionPattern":"fillExtrusion",v);p&&(e.context.activeTexture.set(u.TEXTURE0),n.imageAtlasTexture.bind(u.LINEAR,u.CLAMP_TO_EDGE),v.updatePaintBuffers(f));const b=g.getProjectionData({overscaledTileID:d,applyGlobeMatrix:!l,applyTerrainMatrix:!0});on(v,h,m,n,r);const w=t.aA(g,n,r.paint.get("fill-extrusion-translate"),r.paint.get("fill-extrusion-translate-anchor")),T=r.paint.get("fill-extrusion-vertical-gradient"),B=p?Mi(e,T,A,w,d,f,n):Ei(e,T,A,w);x.draw(c,c.gl.TRIANGLES,o,s,a,Qt.backCCW,B,y,b,r.id,_.layoutVertexBuffer,_.indexBuffer,_.segments,r.paint,e.transform.zoom,v,e.style.map.terrain&&_.centroidVertexBuffer)}}function ln(e,t,i,r,n,o,s,a,l){var c;const u=e.style.projection,h=e.context,d=e.transform,p=h.gl,f=e.useProgram("hillshade"),A=!e.options.moving;for(const m of r){const r=t.getTile(m),g=r.fbo;if(!g)continue;const _=u.getMeshFromTileID(h,m.canonical,a,!0,"raster"),y=null===(c=e.style.map.terrain)||void 0===c?void 0:c.getTerrainData(m);h.activeTexture.set(p.TEXTURE0),p.bindTexture(p.TEXTURE_2D,g.colorAttachment.get());const v=d.getProjectionData({overscaledTileID:m,aligned:A,applyGlobeMatrix:!l,applyTerrainMatrix:!0});f.draw(h,p.TRIANGLES,o,n[m.overscaledZ],s,Qt.backCCW,Ui(e,r,i),y,v,i.id,_.vertexBuffer,_.indexBuffer,_.segments)}}const cn=[new t.P(0,0),new t.P(t.Z,0),new t.P(t.Z,t.Z),new t.P(0,t.Z)];function un(e,t,i,r,n,o,s,a,l=!1,c=!1){const u=r[r.length-1].overscaledZ,h=e.context,d=h.gl,p=e.useProgram("raster"),f=e.transform,A=e.style.projection,m=e.colorModeForRenderPass(),g=!e.options.moving;for(const _ of r){const r=e.getDepthModeForSublayer(_.overscaledZ-u,1===i.paint.get("raster-opacity")?jt.ReadWrite:jt.ReadOnly,d.LESS),y=t.getTile(_);y.registerFadeDuration(i.paint.get("raster-fade-duration"));const v=t.findLoadedParent(_,0),x=t.findLoadedSibling(_),b=hn(y,v||x||null,t,i,e.transform,e.style.map.terrain);let w,T;const B="nearest"===i.paint.get("raster-resampling")?d.NEAREST:d.LINEAR;h.activeTexture.set(d.TEXTURE0),y.texture.bind(B,d.CLAMP_TO_EDGE,d.LINEAR_MIPMAP_NEAREST),h.activeTexture.set(d.TEXTURE1),v?(v.texture.bind(B,d.CLAMP_TO_EDGE,d.LINEAR_MIPMAP_NEAREST),w=Math.pow(2,v.tileID.overscaledZ-y.tileID.overscaledZ),T=[y.tileID.canonical.x*w%1,y.tileID.canonical.y*w%1]):y.texture.bind(B,d.CLAMP_TO_EDGE,d.LINEAR_MIPMAP_NEAREST),y.texture.useMipmap&&h.extTextureFilterAnisotropic&&e.transform.pitch>20&&d.texParameterf(d.TEXTURE_2D,h.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,h.extTextureFilterAnisotropicMax);const C=e.style.map.terrain&&e.style.map.terrain.getTerrainData(_),S=f.getProjectionData({overscaledTileID:_,aligned:g,applyGlobeMatrix:!c,applyTerrainMatrix:!0}),E=qi(T||[0,0],w||1,b,i,a),M=A.getMeshFromTileID(h,_.canonical,o,s,"raster");p.draw(h,d.TRIANGLES,r,n?n[_.overscaledZ]:Ht.disabled,m,l?Qt.frontCCW:Qt.backCCW,E,C,S,i.id,M.vertexBuffer,M.indexBuffer,M.segments)}}function hn(e,i,r,n,o,a){const l=n.paint.get("raster-fade-duration");if(!a&&l>0){const n=s.now(),a=(n-e.timeAdded)/l,c=i?(n-i.timeAdded)/l:-1,u=r.getSource(),h=_e(o,{tileSize:u.tileSize,roundZoom:u.roundZoom}),d=!i||Math.abs(i.tileID.overscaledZ-h)>Math.abs(e.tileID.overscaledZ-h),p=d&&e.refreshedUponExpiration?1:t.ae(d?a:1-c,0,1);return e.refreshedUponExpiration&&a>=1&&(e.refreshedUponExpiration=!1),i?{opacity:1,mix:1-p}:{opacity:p,mix:0}}return{opacity:1,mix:0}}const dn=new t.b7(1,0,0,1),pn=new t.b7(0,1,0,1),fn=new t.b7(0,0,1,1),An=new t.b7(1,0,1,1),mn=new t.b7(0,1,1,1);function gn(e,t,i,r){yn(e,0,t+i/2,e.transform.width,i,r)}function _n(e,t,i,r){yn(e,t-i/2,0,i,e.transform.height,r)}function yn(e,t,i,r,n,o){const s=e.context,a=s.gl;a.enable(a.SCISSOR_TEST),a.scissor(t*e.pixelRatio,i*e.pixelRatio,r*e.pixelRatio,n*e.pixelRatio),s.clear({color:o}),a.disable(a.SCISSOR_TEST)}function vn(e,i,r){const n=e.context,o=n.gl,s=e.useProgram("debug"),a=jt.disabled,l=Ht.disabled,c=e.colorModeForRenderPass(),u="$debug",h=e.style.map.terrain&&e.style.map.terrain.getTerrainData(r);n.activeTexture.set(o.TEXTURE0);const d=i.getTileByID(r.key).latestRawTileData,p=Math.floor((d&&d.byteLength||0)/1024),f=i.getTile(r).tileSize,A=512/Math.min(f,512)*(r.overscaledZ/e.transform.zoom)*.5;let m=r.canonical.toString();r.overscaledZ!==r.canonical.z&&(m+=` => ${r.overscaledZ}`),function(e,t){e.initDebugOverlayCanvas();const i=e.debugOverlayCanvas,r=e.context.gl,n=e.debugOverlayCanvas.getContext("2d");n.clearRect(0,0,i.width,i.height),n.shadowColor="white",n.shadowBlur=2,n.lineWidth=1.5,n.strokeStyle="white",n.textBaseline="top",n.font="bold 36px Open Sans, sans-serif",n.fillText(t,5,5),n.strokeText(t,5,5),e.debugOverlayTexture.update(i),e.debugOverlayTexture.bind(r.LINEAR,r.CLAMP_TO_EDGE)}(e,`${m} ${p}kB`);const g=e.transform.getProjectionData({overscaledTileID:r,applyGlobeMatrix:!0,applyTerrainMatrix:!0});s.draw(n,o.TRIANGLES,a,l,Ut.alphaBlended,Qt.disabled,Ri(t.b7.transparent,A),null,g,u,e.debugBuffer,e.quadTriangleIndexBuffer,e.debugSegments),s.draw(n,o.LINE_STRIP,a,l,c,Qt.disabled,Ri(t.b7.red),h,g,u,e.debugBuffer,e.tileBorderIndexBuffer,e.debugSegments)}function xn(e,t,i,r){const{isRenderingGlobe:n}=r,o=e.context,s=o.gl,a=e.transform,l=e.colorModeForRenderPass(),c=e.getDepthModeFor3D(),u=e.useProgram("terrain");o.bindFramebuffer.set(null),o.viewport.set([0,0,e.width,e.height]);for(const r of i){const i=t.getTerrainMesh(r.tileID),h=e.renderToTexture.getTexture(r),d=t.getTerrainData(r.tileID);o.activeTexture.set(s.TEXTURE0),s.bindTexture(s.TEXTURE_2D,h.texture);const p=t.getMeshFrameDelta(a.zoom),f=a.calculateFogMatrix(r.tileID.toUnwrapped()),A=wi(p,f,e.style.sky,a.pitch,n),m=a.getProjectionData({overscaledTileID:r.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});u.draw(o,s.TRIANGLES,c,Ht.disabled,l,Qt.backCCW,A,d,m,"terrain",i.vertexBuffer,i.indexBuffer,i.segments)}}function bn(e,i){if(!i.mesh){const r=new t.aI;r.emplaceBack(-1,-1),r.emplaceBack(1,-1),r.emplaceBack(1,1),r.emplaceBack(-1,1);const n=new t.aK;n.emplaceBack(0,1,2),n.emplaceBack(0,2,3),i.mesh=new bt(e.createVertexBuffer(r,wt.members),e.createIndexBuffer(n),t.aJ.simpleSegment(0,0,r.length,n.length))}return i.mesh}class wn{constructor(e,i){this.context=new Hr(e),this.transform=i,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:t.ad(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=ve.maxUnderzooming+ve.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new _t}resize(e,t,i){if(this.width=Math.floor(e*i),this.height=Math.floor(t*i),this.pixelRatio=i,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const e of this.style._order)this.style._layers[e].resize()}setup(){const e=this.context,i=new t.aI;i.emplaceBack(0,0),i.emplaceBack(t.Z,0),i.emplaceBack(0,t.Z),i.emplaceBack(t.Z,t.Z),this.tileExtentBuffer=e.createVertexBuffer(i,wt.members),this.tileExtentSegments=t.aJ.simpleSegment(0,0,4,2);const r=new t.aI;r.emplaceBack(0,0),r.emplaceBack(t.Z,0),r.emplaceBack(0,t.Z),r.emplaceBack(t.Z,t.Z),this.debugBuffer=e.createVertexBuffer(r,wt.members),this.debugSegments=t.aJ.simpleSegment(0,0,4,5);const n=new t.bY;n.emplaceBack(0,0,0,0),n.emplaceBack(t.Z,0,t.Z,0),n.emplaceBack(0,t.Z,0,t.Z),n.emplaceBack(t.Z,t.Z,t.Z,t.Z),this.rasterBoundsBuffer=e.createVertexBuffer(n,xi.members),this.rasterBoundsSegments=t.aJ.simpleSegment(0,0,4,2);const o=new t.aI;o.emplaceBack(0,0),o.emplaceBack(t.Z,0),o.emplaceBack(0,t.Z),o.emplaceBack(t.Z,t.Z),this.rasterBoundsBufferPosOnly=e.createVertexBuffer(o,wt.members),this.rasterBoundsSegmentsPosOnly=t.aJ.simpleSegment(0,0,4,5);const s=new t.aI;s.emplaceBack(0,0),s.emplaceBack(1,0),s.emplaceBack(0,1),s.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(s,wt.members),this.viewportSegments=t.aJ.simpleSegment(0,0,4,2);const a=new t.bZ;a.emplaceBack(0),a.emplaceBack(1),a.emplaceBack(3),a.emplaceBack(2),a.emplaceBack(0),this.tileBorderIndexBuffer=e.createIndexBuffer(a);const l=new t.aK;l.emplaceBack(1,0,2),l.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(l);const c=this.context.gl;this.stencilClearMode=new Ht({func:c.ALWAYS,mask:0},0,255,c.ZERO,c.ZERO,c.ZERO),this.tileExtentMesh=new bt(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){const e=this.context,i=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const r=t.K();t.bQ(r,0,this.width,this.height,0,0,1),t.M(r,r,[i.drawingBufferWidth,i.drawingBufferHeight,0]);const n={mainMatrix:r,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:r};this.useProgram("clippingMask",null,!0).draw(e,i.TRIANGLES,jt.disabled,this.stencilClearMode,Ut.disabled,Qt.disabled,null,null,n,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(e,t,i){if(this.currentStencilSource===e.source||!e.isTileClipped()||!t||!t.length)return;this.currentStencilSource=e.source,this.nextStencilID+t.length>256&&this.clearStencil();const r=this.context;r.setColorMode(Ut.disabled),r.setDepthMode(jt.disabled);const n={};for(const e of t)n[e.key]=this.nextStencilID++;this._renderTileMasks(n,t,i,!0),this._renderTileMasks(n,t,i,!1),this._tileClippingMaskIDs=n}_renderTileMasks(e,t,i,r){const n=this.context,o=n.gl,s=this.style.projection,a=this.transform,l=this.useProgram("clippingMask");for(const c of t){const t=e[c.key],u=this.style.map.terrain&&this.style.map.terrain.getTerrainData(c),h=s.getMeshFromTileID(this.context,c.canonical,r,!0,"stencil"),d=a.getProjectionData({overscaledTileID:c,applyGlobeMatrix:!0,applyTerrainMatrix:!0});l.draw(n,o.TRIANGLES,jt.disabled,new Ht({func:o.ALWAYS,mask:0},t,255,o.KEEP,o.KEEP,o.REPLACE),Ut.disabled,i?Qt.disabled:Qt.backCCW,null,u,d,"$clipping",h.vertexBuffer,h.indexBuffer,h.segments)}}_renderTilesDepthBuffer(){const e=this.context,t=e.gl,i=this.style.projection,r=this.transform,n=this.useProgram("depth"),o=this.getDepthModeFor3D(),s=ye(r,{tileSize:r.tileSize});for(const a of s){const s=this.style.map.terrain&&this.style.map.terrain.getTerrainData(a),l=i.getMeshFromTileID(this.context,a.canonical,!0,!0,"raster"),c=r.getProjectionData({overscaledTileID:a,applyGlobeMatrix:!0,applyTerrainMatrix:!0});n.draw(e,t.TRIANGLES,o,Ht.disabled,Ut.disabled,Qt.backCCW,null,s,c,"$clipping",l.vertexBuffer,l.indexBuffer,l.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const e=this.nextStencilID++,t=this.context.gl;return new Ht({func:t.NOTEQUAL,mask:255},e,255,t.KEEP,t.KEEP,t.REPLACE)}stencilModeForClipping(e){const t=this.context.gl;return new Ht({func:t.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,t.KEEP,t.KEEP,t.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(e){const t=this.context.gl,i=e.sort(((e,t)=>t.overscaledZ-e.overscaledZ)),r=i[i.length-1].overscaledZ,n=i[0].overscaledZ-r+1;if(n>1){this.currentStencilSource=void 0,this.nextStencilID+n>256&&this.clearStencil();const e={};for(let i=0;i<n;i++)e[i+r]=new Ht({func:t.GEQUAL,mask:255},i+this.nextStencilID,255,t.KEEP,t.KEEP,t.REPLACE);return this.nextStencilID+=n,[e,i]}return[{[r]:Ht.disabled},i]}stencilConfigForOverlapTwoPass(e){const t=this.context.gl,i=e.sort(((e,t)=>t.overscaledZ-e.overscaledZ)),r=i[i.length-1].overscaledZ,n=i[0].overscaledZ-r+1;if(this.clearStencil(),n>1){const e={},o={};for(let i=0;i<n;i++)e[i+r]=new Ht({func:t.GREATER,mask:255},n+1+i,255,t.KEEP,t.KEEP,t.REPLACE),o[i+r]=new Ht({func:t.GREATER,mask:255},1+i,255,t.KEEP,t.KEEP,t.REPLACE);return this.nextStencilID=2*n+1,[e,o,i]}return this.nextStencilID=3,[{[r]:new Ht({func:t.GREATER,mask:255},2,255,t.KEEP,t.KEEP,t.REPLACE)},{[r]:new Ht({func:t.GREATER,mask:255},1,255,t.KEEP,t.KEEP,t.REPLACE)},i]}colorModeForRenderPass(){const e=this.context.gl;if(this._showOverdrawInspector){const i=1/8;return new Ut([e.CONSTANT_COLOR,e.ONE],new t.b7(i,i,i,0),[!0,!0,!0,!0])}return"opaque"===this.renderPass?Ut.unblended:Ut.alphaBlended}getDepthModeForSublayer(e,t,i){if(!this.opaquePassEnabledForLayer())return jt.disabled;const r=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new jt(i||this.context.gl.LEQUAL,t,[r,r])}getDepthModeFor3D(){return new jt(this.context.gl.LEQUAL,jt.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(e,i){var r,n;this.style=e,this.options=i,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(s.now()),this.imageManager.beginFrame();const o=this.style._order,a=this.style.sourceCaches,l={},c={},u={},h={isRenderingToTexture:!1,isRenderingGlobe:(null===(r=e.projection)||void 0===r?void 0:r.transitionState)>0};for(const e in a){const t=a[e];t.used&&t.prepare(this.context),l[e]=t.getVisibleCoordinates(!1),c[e]=l[e].slice().reverse(),u[e]=t.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let e=0;e<o.length;e++)if(this.style._layers[o[e]].is3D()){this.opaquePassCutoff=e;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const e of o){const t=this.style._layers[e];if(!t.hasOffscreenPass()||t.isHidden(this.transform.zoom))continue;const i=c[t.source];("custom"===t.type||i.length)&&this.renderLayer(this,a[t.source],t,i,h)}if(null===(n=this.style.projection)||void 0===n||n.updateGPUdependent({context:this.context,useProgram:e=>this.useProgram(e)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:i.showOverdrawInspector?t.b7.black:t.b7.transparent,depth:1}),this.clearStencil(),this.style.sky&&function(e,t){const i=e.context,r=i.gl,n=((e,t,i)=>{const r=Math.cos(t.rollInRadians),n=Math.sin(t.rollInRadians),o=he(t),s=t.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:e.properties.get("sky-color"),u_horizon_color:e.properties.get("horizon-color"),u_horizon:[(t.width/2-o*n)*i,(t.height/2+o*r)*i],u_horizon_normal:[-n,r],u_sky_horizon_blend:e.properties.get("sky-horizon-blend")*t.height/2*i,u_sky_blend:s}})(t,e.style.map.transform,e.pixelRatio),o=new jt(r.LEQUAL,jt.ReadWrite,[0,1]),s=Ht.disabled,a=e.colorModeForRenderPass(),l=e.useProgram("sky"),c=bn(i,t);l.draw(i,r.TRIANGLES,o,s,a,Qt.disabled,n,null,void 0,"sky",c.vertexBuffer,c.indexBuffer,c.segments)}(this,this.style.sky),this._showOverdrawInspector=i.showOverdrawInspector,this.depthRangeFor3D=[0,1-(e._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=o.length-1;this.currentLayer>=0;this.currentLayer--){const e=this.style._layers[o[this.currentLayer]],t=a[e.source],i=l[e.source];this._renderTileClippingMasks(e,i,!1),this.renderLayer(this,t,e,i,h)}this.renderPass="translucent";let d=!1;for(this.currentLayer=0;this.currentLayer<o.length;this.currentLayer++){const e=this.style._layers[o[this.currentLayer]],t=a[e.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(e,h))continue;this.opaquePassEnabledForLayer()||d||(d=!0,h.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());const i=("symbol"===e.type?u:c)[e.source];this._renderTileClippingMasks(e,l[e.source],!1),this.renderLayer(this,t,e,i,h)}if(h.isRenderingGlobe&&function(e,i,r){const n=e.context,o=n.gl,s=e.useProgram("atmosphere"),a=new jt(o.LEQUAL,jt.ReadOnly,[0,1]),l=e.transform,c=function(e,i){const r=e.properties.get("position"),n=[-r.x,-r.y,-r.z],o=t.ad(new Float64Array(16));return"map"===e.properties.get("anchor")&&(t.a_(o,o,i.rollInRadians),t.a$(o,o,-i.pitchInRadians),t.a_(o,o,i.bearingInRadians),t.a$(o,o,i.center.lat*Math.PI/180),t.bp(o,o,-i.center.lng*Math.PI/180)),t.bX(n,n,o),n}(r,e.transform),u=l.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),h=i.properties.get("atmosphere-blend")*u.projectionTransition;if(0===h)return;const d=ri(l.worldSize,l.center.lat),p=l.inverseProjectionMatrix,f=new Float64Array(4);f[3]=1,t.at(f,f,l.modelViewProjectionMatrix),f[0]/=f[3],f[1]/=f[3],f[2]/=f[3],f[3]=1,t.at(f,f,p),f[0]/=f[3],f[1]/=f[3],f[2]/=f[3],f[3]=1;const A=((e,t,i,r,n)=>({u_sun_pos:e,u_atmosphere_blend:t,u_globe_position:i,u_globe_radius:r,u_inv_proj_matrix:n}))(c,h,[f[0],f[1],f[2]],d,p),m=bn(n,i);s.draw(n,o.TRIANGLES,a,Ht.disabled,Ut.alphaBlended,Qt.disabled,A,null,null,"atmosphere",m.vertexBuffer,m.indexBuffer,m.segments)}(this,this.style.sky,this.style.light),this.options.showTileBoundaries){const e=function(e,t){let i=null;const r=Object.values(e._layers).flatMap((i=>i.source&&!i.isHidden(t)?[e.sourceCaches[i.source]]:[])),n=r.filter((e=>"vector"===e.getSource().type)),o=r.filter((e=>"vector"!==e.getSource().type)),s=e=>{(!i||i.getSource().maxzoom<e.getSource().maxzoom)&&(i=e)};return n.forEach((e=>s(e))),i||o.forEach((e=>s(e))),i}(this.style,this.transform.zoom);e&&function(e,t,i){for(let r=0;r<i.length;r++)vn(e,t,i[r])}(this,e,e.getVisibleCoordinates())}this.options.showPadding&&function(e){const t=e.transform.padding;gn(e,e.transform.height-(t.top||0),3,dn),gn(e,t.bottom||0,3,pn),_n(e,t.left||0,3,fn),_n(e,e.transform.width-(t.right||0),3,An);const i=e.transform.centerPoint;!function(e,t,i,r){yn(e,t-1,i-10,2,20,r),yn(e,t-10,i-1,20,2,r)}(e,i.x,e.transform.height-i.y,mn)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(e){if(!this.style||!this.style.map||!this.style.map.terrain)return;const i=this.terrainFacilitator.matrix,r=this.transform.modelViewProjectionMatrix;let n=this.terrainFacilitator.dirty;n||(n=e?!t.b_(i,r):!t.b$(i,r)),n||(n=this.style.map.terrain.sourceCache.anyTilesAfterTime(this.terrainFacilitator.renderTime)),n&&(t.c0(i,r),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(e,i){const r=e.context,n=r.gl,o=e.transform,s=Ut.unblended,a=new jt(n.LEQUAL,jt.ReadWrite,[0,1]),l=i.sourceCache.getRenderableTiles(),c=e.useProgram("terrainDepth");r.bindFramebuffer.set(i.getFramebuffer("depth").framebuffer),r.viewport.set([0,0,e.width/devicePixelRatio,e.height/devicePixelRatio]),r.clear({color:t.b7.transparent,depth:1});for(const e of l){const t=i.getTerrainMesh(e.tileID),l=i.getTerrainData(e.tileID),u=o.getProjectionData({overscaledTileID:e.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),h={u_ele_delta:i.getMeshFrameDelta(o.zoom)};c.draw(r,n.TRIANGLES,a,Ht.disabled,s,Qt.backCCW,h,l,u,"terrain",t.vertexBuffer,t.indexBuffer,t.segments)}r.bindFramebuffer.set(null),r.viewport.set([0,0,e.width,e.height])}(this,this.style.map.terrain),function(e,i){const r=e.context,n=r.gl,o=e.transform,s=Ut.unblended,a=new jt(n.LEQUAL,jt.ReadWrite,[0,1]),l=i.getCoordsTexture(),c=i.sourceCache.getRenderableTiles(),u=e.useProgram("terrainCoords");r.bindFramebuffer.set(i.getFramebuffer("coords").framebuffer),r.viewport.set([0,0,e.width/devicePixelRatio,e.height/devicePixelRatio]),r.clear({color:t.b7.transparent,depth:1}),i.coordsIndex=[];for(const e of c){const t=i.getTerrainMesh(e.tileID),c=i.getTerrainData(e.tileID);r.activeTexture.set(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,l.texture);const h={u_terrain_coords_id:(255-i.coordsIndex.length)/255,u_texture:0,u_ele_delta:i.getMeshFrameDelta(o.zoom)},d=o.getProjectionData({overscaledTileID:e.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});u.draw(r,n.TRIANGLES,a,Ht.disabled,s,Qt.backCCW,h,c,d,"terrain",t.vertexBuffer,t.indexBuffer,t.segments),i.coordsIndex.push(e.tileID.key)}r.bindFramebuffer.set(null),r.viewport.set([0,0,e.width,e.height])}(this,this.style.map.terrain))}renderLayer(e,i,r,n,o){r.isHidden(this.transform.zoom)||("background"===r.type||"custom"===r.type||(n||[]).length)&&(this.id=r.id,t.c1(r)?function(e,i,r,n,o,s){if("translucent"!==e.renderPass)return;const{isRenderingToTexture:a}=s,l=Ht.disabled,c=e.colorModeForRenderPass();(r._unevaluatedLayout.hasValue("text-variable-anchor")||r._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(e,i,r,n,o,s,a,l,c){const u=i.transform,h=i.style.map.terrain,d="map"===o,p="map"===s;for(const o of e){const e=n.getTile(o),s=e.getBucket(r);if(!s||!s.text||!s.text.segments.get().length)continue;const f=t.ak(s.textSizeData,u.zoom),A=t.az(e,1,i.transform.zoom),m=Ce(d,i.transform,A),g="none"!==r.layout.get("icon-text-fit")&&s.hasIconData();if(f){const i=Math.pow(2,u.zoom-e.tileID.overscaledZ),r=h?(e,t)=>h.getElevation(o,e,t):null;Wr(s,d,p,c,u,m,i,f,g,t.aA(u,e,a,l),o.toUnwrapped(),r)}}}(n,e,r,i,r.layout.get("text-rotation-alignment"),r.layout.get("text-pitch-alignment"),r.paint.get("text-translate"),r.paint.get("text-translate-anchor"),o),0!==r.paint.get("icon-opacity").constantOr(1)&&Yr(e,i,r,n,!1,r.paint.get("icon-translate"),r.paint.get("icon-translate-anchor"),r.layout.get("icon-rotation-alignment"),r.layout.get("icon-pitch-alignment"),r.layout.get("icon-keep-upright"),l,c,a),0!==r.paint.get("text-opacity").constantOr(1)&&Yr(e,i,r,n,!0,r.paint.get("text-translate"),r.paint.get("text-translate-anchor"),r.layout.get("text-rotation-alignment"),r.layout.get("text-pitch-alignment"),r.layout.get("text-keep-upright"),l,c,a),i.map.showCollisionBoxes&&($r(e,i,r,n,!0),$r(e,i,r,n,!1))}(e,i,r,n,this.style.placement.variableOffsets,o):t.c2(r)?function(e,i,r,n,o){if("translucent"!==e.renderPass)return;const{isRenderingToTexture:s}=o,a=r.paint.get("circle-opacity"),l=r.paint.get("circle-stroke-width"),c=r.paint.get("circle-stroke-opacity"),u=!r.layout.get("circle-sort-key").isConstant();if(0===a.constantOr(1)&&(0===l.constantOr(1)||0===c.constantOr(1)))return;const h=e.context,d=h.gl,p=e.transform,f=e.getDepthModeForSublayer(0,jt.ReadOnly),A=Ht.disabled,m=e.colorModeForRenderPass(),g=[],_=p.getCircleRadiusCorrection();for(let o=0;o<n.length;o++){const a=n[o],l=i.getTile(a),c=l.getBucket(r);if(!c)continue;const h=r.paint.get("circle-translate"),d=r.paint.get("circle-translate-anchor"),f=t.aA(p,l,h,d),A=c.programConfigurations.get(r.id),m=e.useProgram("circle",A),y=c.layoutVertexBuffer,v=c.indexBuffer,x=e.style.map.terrain&&e.style.map.terrain.getTerrainData(a),b={programConfiguration:A,program:m,layoutVertexBuffer:y,indexBuffer:v,uniformValues:Fi(e,l,r,f,_),terrainData:x,projectionData:p.getProjectionData({overscaledTileID:a,applyGlobeMatrix:!s,applyTerrainMatrix:!0})};if(u){const e=c.segments.get();for(const i of e)g.push({segments:new t.aJ([i]),sortKey:i.sortKey,state:b})}else g.push({segments:c.segments,sortKey:0,state:b})}u&&g.sort(((e,t)=>e.sortKey-t.sortKey));for(const t of g){const{programConfiguration:i,program:n,layoutVertexBuffer:o,indexBuffer:s,uniformValues:a,terrainData:l,projectionData:c}=t.state;n.draw(h,d.TRIANGLES,f,A,m,Qt.backCCW,a,l,c,r.id,o,s,t.segments,r.paint,e.transform.zoom,i)}}(e,i,r,n,o):t.c3(r)?function(e,i,r,n,o){if(0===r.paint.get("heatmap-opacity"))return;const s=e.context,{isRenderingToTexture:a,isRenderingGlobe:l}=o;if(e.style.map.terrain){for(const t of n){const n=i.getTile(t);i.hasRenderableParent(t)||("offscreen"===e.renderPass?en(e,n,r,t,l):"translucent"===e.renderPass&&tn(e,r,t,a,l))}s.viewport.set([0,0,e.width,e.height])}else"offscreen"===e.renderPass?function(e,i,r,n){const o=e.context,s=o.gl,a=e.transform,l=Ht.disabled,c=new Ut([s.ONE,s.ONE],t.b7.transparent,[!0,!0,!0,!0]);(function(e,i,r){const n=e.gl;e.activeTexture.set(n.TEXTURE1),e.viewport.set([0,0,i.width/4,i.height/4]);let o=r.heatmapFbos.get(t.bU);o?(n.bindTexture(n.TEXTURE_2D,o.colorAttachment.get()),e.bindFramebuffer.set(o.framebuffer)):(o=rn(e,i.width/4,i.height/4),r.heatmapFbos.set(t.bU,o))})(o,e,r),o.clear({color:t.b7.transparent});for(let t=0;t<n.length;t++){const u=n[t];if(i.hasRenderableParent(u))continue;const h=i.getTile(u),d=h.getBucket(r);if(!d)continue;const p=d.programConfigurations.get(r.id),f=e.useProgram("heatmap",p),A=a.getProjectionData({overscaledTileID:u,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),m=a.getCircleRadiusCorrection();f.draw(o,s.TRIANGLES,jt.disabled,l,c,Qt.backCCW,Di(h,a.zoom,r.paint.get("heatmap-intensity"),m),null,A,r.id,d.layoutVertexBuffer,d.indexBuffer,d.segments,r.paint,a.zoom,p)}o.viewport.set([0,0,e.width,e.height])}(e,i,r,n):"translucent"===e.renderPass&&function(e,i){const r=e.context,n=r.gl;r.setColorMode(e.colorModeForRenderPass());const o=i.heatmapFbos.get(t.bU);o&&(r.activeTexture.set(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,o.colorAttachment.get()),r.activeTexture.set(n.TEXTURE1),nn(r,i).bind(n.LINEAR,n.CLAMP_TO_EDGE),e.useProgram("heatmapTexture").draw(r,n.TRIANGLES,jt.disabled,Ht.disabled,e.colorModeForRenderPass(),Qt.disabled,Oi(e,i,0,1),null,null,i.id,e.viewportBuffer,e.quadTriangleIndexBuffer,e.viewportSegments,i.paint,e.transform.zoom))}(e,r)}(e,i,r,n,o):t.c4(r)?function(e,i,r,n,o){if("translucent"!==e.renderPass)return;const{isRenderingToTexture:s}=o,a=r.paint.get("line-opacity"),l=r.paint.get("line-width");if(0===a.constantOr(1)||0===l.constantOr(1))return;const c=e.getDepthModeForSublayer(0,jt.ReadOnly),u=e.colorModeForRenderPass(),h=r.paint.get("line-dasharray"),d=r.paint.get("line-pattern"),p=d.constantOr(1),f=r.paint.get("line-gradient"),A=r.getCrossfadeParameters(),m=p?"linePattern":h?"lineSDF":f?"lineGradient":"line",g=e.context,y=g.gl,v=e.transform;let x=!0;for(const o of n){const a=i.getTile(o);if(p&&!a.patternsLoaded())continue;const l=a.getBucket(r);if(!l)continue;const b=l.programConfigurations.get(r.id),w=e.context.program.get(),T=e.useProgram(m,b),B=x||T.program!==w,C=e.style.map.terrain&&e.style.map.terrain.getTerrainData(o),S=d.constantOr(null);if(S&&a.imageAtlas){const e=a.imageAtlas,t=e.patternPositions[S.to.toString()],i=e.patternPositions[S.from.toString()];t&&i&&b.setConstantPatternPositions(t,i)}const E=v.getProjectionData({overscaledTileID:o,applyGlobeMatrix:!s,applyTerrainMatrix:!0}),M=v.getPixelScale(),I=p?Hi(e,a,r,M,A):h?Gi(e,a,r,M,h,A):f?Vi(e,a,r,M,l.lineClipsArray.length):ji(e,a,r,M);if(p)g.activeTexture.set(y.TEXTURE0),a.imageAtlasTexture.bind(y.LINEAR,y.CLAMP_TO_EDGE),b.updatePaintBuffers(A);else if(h&&(B||e.lineAtlas.dirty))g.activeTexture.set(y.TEXTURE0),e.lineAtlas.bind(g);else if(f){const n=l.gradients[r.id];let s=n.texture;if(r.gradientVersion!==n.version){let a=256;if(r.stepInterpolant){const r=i.getSource().maxzoom,n=o.canonical.z===r?Math.ceil(1<<e.transform.maxZoom-o.canonical.z):1;a=t.ae(t.bV(l.maxLineLength/t.Z*1024*n),256,g.maxTextureSize)}n.gradient=t.bW({expression:r.gradientExpression(),evaluationKey:"lineProgress",resolution:a,image:n.gradient||void 0,clips:l.lineClipsArray}),n.texture?n.texture.update(n.gradient):n.texture=new _(g,n.gradient,y.RGBA),n.version=r.gradientVersion,s=n.texture}g.activeTexture.set(y.TEXTURE0),s.bind(r.stepInterpolant?y.NEAREST:y.LINEAR,y.CLAMP_TO_EDGE)}let P;if(s){const[t]=e.getStencilConfigForOverlapAndUpdateStencilID(n);P=t[o.overscaledZ]}else P=e.stencilModeForClipping(o);T.draw(g,y.TRIANGLES,c,P,u,Qt.disabled,I,C,E,r.id,l.layoutVertexBuffer,l.indexBuffer,l.segments,r.paint,e.transform.zoom,b,l.layoutVertexBuffer2),x=!1}}(e,i,r,n,o):t.c5(r)?function(e,i,r,n,o){const s=r.paint.get("fill-color"),a=r.paint.get("fill-opacity");if(0===a.constantOr(1))return;const{isRenderingToTexture:l}=o,c=e.colorModeForRenderPass(),u=r.paint.get("fill-pattern"),h=e.opaquePassEnabledForLayer()&&!u.constantOr(1)&&1===s.constantOr(t.b7.transparent).a&&1===a.constantOr(0)?"opaque":"translucent";if(e.renderPass===h){const t=e.getDepthModeForSublayer(1,"opaque"===e.renderPass?jt.ReadWrite:jt.ReadOnly);sn(e,i,r,n,t,c,!1,l)}if("translucent"===e.renderPass&&r.paint.get("fill-antialias")){const t=e.getDepthModeForSublayer(r.getPaintProperty("fill-outline-color")?2:0,jt.ReadOnly);sn(e,i,r,n,t,c,!0,l)}}(e,i,r,n,o):t.c6(r)?function(e,t,i,r,n){const o=i.paint.get("fill-extrusion-opacity");if(0===o)return;const{isRenderingToTexture:s}=n;if("translucent"===e.renderPass){const n=new jt(e.context.gl.LEQUAL,jt.ReadWrite,e.depthRangeFor3D);if(1!==o||i.paint.get("fill-extrusion-pattern").constantOr(1))an(e,t,i,r,n,Ht.disabled,Ut.disabled,s),an(e,t,i,r,n,e.stencilModeFor3D(),e.colorModeForRenderPass(),s);else{const o=e.colorModeForRenderPass();an(e,t,i,r,n,Ht.disabled,o,s)}}}(e,i,r,n,o):t.c7(r)?function(e,t,i,r,n){if("offscreen"!==e.renderPass&&"translucent"!==e.renderPass)return;const{isRenderingToTexture:o}=n,s=e.context,a=e.style.projection.useSubdivision,l=e.getDepthModeForSublayer(0,jt.ReadOnly),c=e.colorModeForRenderPass();if("offscreen"===e.renderPass)!function(e,t,i,r,n,o,s){const a=e.context,l=a.gl;for(const c of i){const i=t.getTile(c),u=i.dem;if(!u||!u.data)continue;if(!i.needsHillshadePrepare)continue;const h=u.dim,d=u.stride,p=u.getPixels();if(a.activeTexture.set(l.TEXTURE1),a.pixelStoreUnpackPremultiplyAlpha.set(!1),i.demTexture=i.demTexture||e.getTileTexture(d),i.demTexture){const e=i.demTexture;e.update(p,{premultiply:!1}),e.bind(l.NEAREST,l.CLAMP_TO_EDGE)}else i.demTexture=new _(a,p,l.RGBA,{premultiply:!1}),i.demTexture.bind(l.NEAREST,l.CLAMP_TO_EDGE);a.activeTexture.set(l.TEXTURE0);let f=i.fbo;if(!f){const e=new _(a,{width:h,height:h,data:null},l.RGBA);e.bind(l.LINEAR,l.CLAMP_TO_EDGE),f=i.fbo=a.createFramebuffer(h,h,!0,!1),f.colorAttachment.set(e.texture)}a.bindFramebuffer.set(f.framebuffer),a.viewport.set([0,0,h,h]),e.useProgram("hillshadePrepare").draw(a,l.TRIANGLES,n,o,s,Qt.disabled,Ni(i.tileID,u),null,null,r.id,e.rasterBoundsBuffer,e.quadTriangleIndexBuffer,e.rasterBoundsSegments),i.needsHillshadePrepare=!1}}(e,t,r,i,l,Ht.disabled,c),s.viewport.set([0,0,e.width,e.height]);else if("translucent"===e.renderPass)if(a){const[n,s,a]=e.stencilConfigForOverlapTwoPass(r);ln(e,t,i,a,n,l,c,!1,o),ln(e,t,i,a,s,l,c,!0,o)}else{const[n,s]=e.getStencilConfigForOverlapAndUpdateStencilID(r);ln(e,t,i,s,n,l,c,!1,o)}}(e,i,r,n,o):t.c8(r)?function(e,t,i,r,n){if("translucent"!==e.renderPass)return;if(0===i.paint.get("raster-opacity"))return;if(!r.length)return;const{isRenderingToTexture:o}=n,s=t.getSource(),a=e.style.projection.useSubdivision;if(s instanceof W)un(e,t,i,r,null,!1,!1,s.tileCoords,s.flippedWindingOrder,o);else if(a){const[n,s,a]=e.stencilConfigForOverlapTwoPass(r);un(e,t,i,a,n,!1,!0,cn,!1,o),un(e,t,i,a,s,!0,!0,cn,!1,o)}else{const[n,s]=e.getStencilConfigForOverlapAndUpdateStencilID(r);un(e,t,i,s,n,!1,!0,cn,!1,o)}}(e,i,r,n,o):t.c9(r)?function(e,t,i,r,n){const o=i.paint.get("background-color"),s=i.paint.get("background-opacity");if(0===s)return;const{isRenderingToTexture:a}=n,l=e.context,c=l.gl,u=e.style.projection,h=e.transform,d=h.tileSize,p=i.paint.get("background-pattern");if(e.isPatternMissing(p))return;const f=!p&&1===o.a&&1===s&&e.opaquePassEnabledForLayer()?"opaque":"translucent";if(e.renderPass!==f)return;const A=Ht.disabled,m=e.getDepthModeForSublayer(0,"opaque"===f?jt.ReadWrite:jt.ReadOnly),g=e.colorModeForRenderPass(),_=e.useProgram(p?"backgroundPattern":"background"),y=r||ye(h,{tileSize:d,terrain:e.style.map.terrain});p&&(l.activeTexture.set(c.TEXTURE0),e.imageManager.bind(e.context));const v=i.getCrossfadeParameters();for(const t of y){const r=h.getProjectionData({overscaledTileID:t,applyGlobeMatrix:!a,applyTerrainMatrix:!0}),n=p?er(s,e,p,{tileID:t,tileSize:d},v):Ji(s,o),f=e.style.map.terrain&&e.style.map.terrain.getTerrainData(t),y=u.getMeshFromTileID(l,t.canonical,!1,!0,"raster");_.draw(l,c.TRIANGLES,m,A,g,Qt.backCCW,n,f,r,i.id,y.vertexBuffer,y.indexBuffer,y.segments)}}(e,0,r,n,o):t.ca(r)&&function(e,t,i,r){const{isRenderingGlobe:n}=r,o=e.context,s=i.implementation,a=e.style.projection,l=e.transform,c=l.getProjectionDataForCustomLayer(n),u={farZ:l.farZ,nearZ:l.nearZ,fov:l.fov*Math.PI/180,modelViewProjectionMatrix:l.modelViewProjectionMatrix,projectionMatrix:l.projectionMatrix,shaderData:{variantName:a.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;\nuniform mat4 u_projection_matrix;\n${a.shaderPreludeCode.vertexSource}`,define:a.shaderDefine},defaultProjectionData:c},h=s.renderingMode?s.renderingMode:"2d";if("offscreen"===e.renderPass){const t=s.prerender;t&&(e.setCustomLayerDefaults(),o.setColorMode(e.colorModeForRenderPass()),t.call(s,o.gl,u),o.setDirty(),e.setBaseState())}else if("translucent"===e.renderPass){e.setCustomLayerDefaults(),o.setColorMode(e.colorModeForRenderPass()),o.setStencilMode(Ht.disabled);const t="3d"===h?e.getDepthModeFor3D():e.getDepthModeForSublayer(0,jt.ReadOnly);o.setDepthMode(t),s.render(o.gl,u),o.setDirty(),e.setBaseState(),o.bindFramebuffer.set(null)}}(e,0,r,o))}saveTileTexture(e){const t=this._tileTextures[e.size[0]];t?t.push(e):this._tileTextures[e.size[0]]=[e]}getTileTexture(e){const t=this._tileTextures[e];return t&&t.length>0?t.pop():null}isPatternMissing(e){if(!e)return!1;if(!e.from||!e.to)return!0;const t=this.imageManager.getPattern(e.from.toString()),i=this.imageManager.getPattern(e.to.toString());return!t||!i}useProgram(e,t,i=!1){this.cache=this.cache||{};const r=!!this.style.map.terrain,n=this.style.projection,o=e+(t?t.cacheKey:"")+`/${i?Bt:n.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(r?"/terrain":"");return this.cache[o]||(this.cache[o]=new Ci(this.context,vt[e],t,ir[e],this._showOverdrawInspector,r,i?vt.projectionMercator:n.shaderPreludeCode,i?Tt:n.shaderDefine)),this.cache[o]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new _(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:e,drawingBufferHeight:t}=this.context.gl;return this.width!==e||this.height!==t}}function Tn(e,t){let i,r=!1,n=null,o=null;const s=()=>{n=null,r&&(e.apply(o,i),n=setTimeout(s,t),r=!1)};return(...e)=>(r=!0,o=this,i=e,n||s(),n)}class Bn{constructor(e){this._getCurrentHash=()=>{const e=window.location.hash.replace("#","");if(this._hashName){let t;return e.split("&").map((e=>e.split("="))).forEach((e=>{e[0]===this._hashName&&(t=e)})),(t&&t[1]||"").split("/")}return e.split("/")},this._onHashChange=()=>{const e=this._getCurrentHash();if(!this._isValidHash(e))return!1;const t=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(e[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+e[2],+e[1]],zoom:+e[0],bearing:t,pitch:+(e[4]||0)}),!0},this._updateHashUnthrottled=()=>{const e=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,e)},this._removeHash=()=>{const e=this._getCurrentHash();if(0===e.length)return;const t=e.join("/");let i=t;i.split("&").length>0&&(i=i.split("&")[0]),this._hashName&&(i=`${this._hashName}=${t}`);let r=window.location.hash.replace(i,"");r.startsWith("#&")?r=r.slice(0,1)+r.slice(2):"#"===r&&(r="");let n=window.location.href.replace(/(#.+)?$/,r);n=n.replace("&&","&"),window.history.replaceState(window.history.state,null,n)},this._updateHash=Tn(this._updateHashUnthrottled,300),this._hashName=e&&encodeURIComponent(e)}addTo(e){return this._map=e,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(e){const t=this._map.getCenter(),i=Math.round(100*this._map.getZoom())/100,r=Math.ceil((i*Math.LN2+Math.log(512/360/.5))/Math.LN10),n=Math.pow(10,r),o=Math.round(t.lng*n)/n,s=Math.round(t.lat*n)/n,a=this._map.getBearing(),l=this._map.getPitch();let c="";if(c+=e?`/${o}/${s}/${i}`:`${i}/${s}/${o}`,(a||l)&&(c+="/"+Math.round(10*a)/10),l&&(c+=`/${Math.round(l)}`),this._hashName){const e=this._hashName;let t=!1;const i=window.location.hash.slice(1).split("&").map((i=>{const r=i.split("=")[0];return r===e?(t=!0,`${r}=${c}`):i})).filter((e=>e));return t||i.push(`${e}=${c}`),`#${i.join("&")}`}return`#${c}`}_isValidHash(e){if(e.length<3||e.some(isNaN))return!1;try{new t.Q(+e[2],+e[1])}catch(e){return!1}const i=+e[0],r=+(e[3]||0),n=+(e[4]||0);return i>=this._map.getMinZoom()&&i<=this._map.getMaxZoom()&&r>=-180&&r<=180&&n>=this._map.getMinPitch()&&n<=this._map.getMaxPitch()}}const Cn={linearity:.3,easing:t.cb(0,0,.3,1)},Sn=t.e({deceleration:2500,maxSpeed:1400},Cn),En=t.e({deceleration:20,maxSpeed:1400},Cn),Mn=t.e({deceleration:1e3,maxSpeed:360},Cn),In=t.e({deceleration:1e3,maxSpeed:90},Cn),Pn=t.e({deceleration:1e3,maxSpeed:360},Cn);class Ln{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:s.now(),settings:e})}_drainInertiaBuffer(){const e=this._inertiaBuffer,t=s.now();for(;e.length>0&&t-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const i={zoom:0,bearing:0,pitch:0,roll:0,pan:new t.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:e}of this._inertiaBuffer)i.zoom+=e.zoomDelta||0,i.bearing+=e.bearingDelta||0,i.pitch+=e.pitchDelta||0,i.roll+=e.rollDelta||0,e.panDelta&&i.pan._add(e.panDelta),e.around&&(i.around=e.around),e.pinchAround&&(i.pinchAround=e.pinchAround);const r=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,n={};if(i.pan.mag()){const o=kn(i.pan.mag(),r,t.e({},Sn,e||{})),s=i.pan.mult(o.amount/i.pan.mag()),a=this._map.cameraHelper.handlePanInertia(s,this._map.transform);n.center=a.easingCenter,n.offset=a.easingOffset,Fn(n,o)}if(i.zoom){const e=kn(i.zoom,r,En);n.zoom=this._map.transform.zoom+e.amount,Fn(n,e)}if(i.bearing){const e=kn(i.bearing,r,Mn);n.bearing=this._map.transform.bearing+t.ae(e.amount,-179,179),Fn(n,e)}if(i.pitch){const e=kn(i.pitch,r,In);n.pitch=this._map.transform.pitch+e.amount,Fn(n,e)}if(i.roll){const e=kn(i.roll,r,Pn);n.roll=this._map.transform.roll+t.ae(e.amount,-179,179),Fn(n,e)}if(n.zoom||n.bearing){const e=void 0===i.pinchAround?i.around:i.pinchAround;n.around=e?this._map.unproject(e):this._map.getCenter()}return this.clear(),t.e(n,{noMoveStart:!0})}}function Fn(e,t){(!e.duration||e.duration<t.duration)&&(e.duration=t.duration,e.easing=t.easing)}function kn(e,i,r){const{maxSpeed:n,linearity:o,deceleration:s}=r,a=t.ae(e*o/(i/1e3),-n,n),l=Math.abs(a)/(s*o);return{easing:r.easing,duration:1e3*l,amount:a*(l/2)}}class zn extends t.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,i,r,n={}){r=r instanceof MouseEvent?r:new MouseEvent(e,r);const o=a.mousePos(i.getCanvas(),r),s=i.unproject(o);super(e,t.e({point:o,lngLat:s,originalEvent:r},n)),this._defaultPrevented=!1,this.target=i}}class Rn extends t.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,i,r){const n="touchend"===e?r.changedTouches:r.touches,o=a.touchPos(i.getCanvasContainer(),n),s=o.map((e=>i.unproject(e))),l=o.reduce(((e,t,i,r)=>e.add(t.div(r.length))),new t.P(0,0));super(e,{points:o,point:l,lngLats:s,lngLat:i.unproject(l),originalEvent:r}),this._defaultPrevented=!1}}class Dn extends t.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,t,i){super(e,{originalEvent:i}),this._defaultPrevented=!1}}class On{constructor(e,t){this._map=e,this._clickTolerance=t.clickTolerance}reset(){delete this._mousedownPos}wheel(e){return this._firePreventable(new Dn(e.type,this._map,e))}mousedown(e,t){return this._mousedownPos=t,this._firePreventable(new zn(e.type,this._map,e))}mouseup(e){this._map.fire(new zn(e.type,this._map,e))}click(e,t){this._mousedownPos&&this._mousedownPos.dist(t)>=this._clickTolerance||this._map.fire(new zn(e.type,this._map,e))}dblclick(e){return this._firePreventable(new zn(e.type,this._map,e))}mouseover(e){this._map.fire(new zn(e.type,this._map,e))}mouseout(e){this._map.fire(new zn(e.type,this._map,e))}touchstart(e){return this._firePreventable(new Rn(e.type,this._map,e))}touchmove(e){this._map.fire(new Rn(e.type,this._map,e))}touchend(e){this._map.fire(new Rn(e.type,this._map,e))}touchcancel(e){this._map.fire(new Rn(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Un{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(e){this._map.fire(new zn(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new zn("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._ignoreContextMenu||this._map.fire(new zn(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Nn{constructor(e){this._map=e}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(e){return this.transform.screenPointToLocation(t.P.convert(e),this._map.terrain)}}class Qn{constructor(e,t){this._map=e,this._tr=new Nn(e),this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=t.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,t){this.isEnabled()&&e.shiftKey&&0===e.button&&(a.disableDrag(),this._startPos=this._lastPos=t,this._active=!0)}mousemoveWindow(e,t){if(!this._active)return;const i=t;if(this._lastPos.equals(i)||!this._box&&i.dist(this._startPos)<this._clickTolerance)return;const r=this._startPos;this._lastPos=i,this._box||(this._box=a.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",e));const n=Math.min(r.x,i.x),o=Math.max(r.x,i.x),s=Math.min(r.y,i.y),l=Math.max(r.y,i.y);a.setTransform(this._box,`translate(${n}px,${s}px)`),this._box.style.width=o-n+"px",this._box.style.height=l-s+"px"}mouseupWindow(e,i){if(!this._active)return;if(0!==e.button)return;const r=this._startPos,n=i;if(this.reset(),a.suppressClick(),r.x!==n.x||r.y!==n.y)return this._map.fire(new t.l("boxzoomend",{originalEvent:e})),{cameraAnimation:e=>e.fitScreenCoordinates(r,n,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",e)}keydown(e){this._active&&27===e.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",e))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(a.remove(this._box),this._box=null),a.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(e,i){return this._map.fire(new t.l(e,{originalEvent:i}))}}function jn(e,t){if(e.length!==t.length)throw new Error(`The number of touches and points are not equal - touches ${e.length}, points ${t.length}`);const i={};for(let r=0;r<e.length;r++)i[e[r].identifier]=t[r];return i}class Vn{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(e,i,r){(this.centroid||r.length>this.numTouches)&&(this.aborted=!0),this.aborted||(void 0===this.startTime&&(this.startTime=e.timeStamp),r.length===this.numTouches&&(this.centroid=function(e){const i=new t.P(0,0);for(const t of e)i._add(t);return i.div(e.length)}(i),this.touches=jn(r,i)))}touchmove(e,t,i){if(this.aborted||!this.centroid)return;const r=jn(i,t);for(const e in this.touches){const t=r[e];(!t||t.dist(this.touches[e])>30)&&(this.aborted=!0)}}touchend(e,t,i){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),0===i.length){const e=!this.aborted&&this.centroid;if(this.reset(),e)return e}}}class Hn{constructor(e){this.singleTap=new Vn(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(e,t,i){this.singleTap.touchstart(e,t,i)}touchmove(e,t,i){this.singleTap.touchmove(e,t,i)}touchend(e,t,i){const r=this.singleTap.touchend(e,t,i);if(r){const t=e.timeStamp-this.lastTime<500,i=!this.lastTap||this.lastTap.dist(r)<30;if(t&&i||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=r,this.count===this.numTaps)return this.reset(),r}}}class Gn{constructor(e){this._tr=new Nn(e),this._zoomIn=new Hn({numTouches:1,numTaps:2}),this._zoomOut=new Hn({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,t,i){this._zoomIn.touchstart(e,t,i),this._zoomOut.touchstart(e,t,i)}touchmove(e,t,i){this._zoomIn.touchmove(e,t,i),this._zoomOut.touchmove(e,t,i)}touchend(e,t,i){const r=this._zoomIn.touchend(e,t,i),n=this._zoomOut.touchend(e,t,i),o=this._tr;return r?(this._active=!0,e.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:t=>t.easeTo({duration:300,zoom:o.zoom+1,around:o.unproject(r)},{originalEvent:e})}):n?(this._active=!0,e.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:t=>t.easeTo({duration:300,zoom:o.zoom-1,around:o.unproject(n)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class $n{constructor(e){this._enabled=!!e.enable,this._moveStateManager=e.moveStateManager,this._clickTolerance=e.clickTolerance||1,this._moveFunction=e.move,this._activateOnStart=!!e.activateOnStart,e.assignEvents(this),this.reset()}reset(e){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(e)}_move(...e){const t=this._moveFunction(...e);if(t.bearingDelta||t.pitchDelta||t.rollDelta||t.around||t.panDelta)return this._active=!0,t}dragStart(e,t){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(e)&&(this._moveStateManager.startMove(e),this._lastPoint=Array.isArray(t)?t[0]:t,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(e,t){if(!this.isEnabled())return;const i=this._lastPoint;if(!i)return;if(e.preventDefault(),!this._moveStateManager.isValidMoveEvent(e))return void this.reset(e);const r=Array.isArray(t)?t[0]:t;return!this._moved&&r.dist(i)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=r,this._move(i,r))}dragEnd(e){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(e)&&(this._moved&&a.suppressClick(),this.reset(e))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Zn={0:1,2:2};class qn{constructor(e){this._correctEvent=e.checkCorrectEvent}startMove(e){const t=a.mouseButton(e);this._eventButton=t}endMove(e){delete this._eventButton}isValidStartEvent(e){return this._correctEvent(e)}isValidMoveEvent(e){return!function(e,t){const i=Zn[t];return void 0===e.buttons||(e.buttons&i)!==i}(e,this._eventButton)}isValidEndEvent(e){return a.mouseButton(e)===this._eventButton}}class Kn{constructor(){this._firstTouch=void 0}_isOneFingerTouch(e){return 1===e.targetTouches.length}_isSameTouchEvent(e){return e.targetTouches[0].identifier===this._firstTouch}startMove(e){this._firstTouch=e.targetTouches[0].identifier}endMove(e){delete this._firstTouch}isValidStartEvent(e){return this._isOneFingerTouch(e)}isValidMoveEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}isValidEndEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}}class Wn{constructor(e=new qn({checkCorrectEvent:()=>!0}),t=new Kn){this.mouseMoveStateManager=e,this.oneFingerTouchMoveStateManager=t}_executeRelevantHandler(e,t,i){return e instanceof MouseEvent?t(e):"undefined"!=typeof TouchEvent&&e instanceof TouchEvent?i(e):void 0}startMove(e){this._executeRelevantHandler(e,(e=>this.mouseMoveStateManager.startMove(e)),(e=>this.oneFingerTouchMoveStateManager.startMove(e)))}endMove(e){this._executeRelevantHandler(e,(e=>this.mouseMoveStateManager.endMove(e)),(e=>this.oneFingerTouchMoveStateManager.endMove(e)))}isValidStartEvent(e){return this._executeRelevantHandler(e,(e=>this.mouseMoveStateManager.isValidStartEvent(e)),(e=>this.oneFingerTouchMoveStateManager.isValidStartEvent(e)))}isValidMoveEvent(e){return this._executeRelevantHandler(e,(e=>this.mouseMoveStateManager.isValidMoveEvent(e)),(e=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(e)))}isValidEndEvent(e){return this._executeRelevantHandler(e,(e=>this.mouseMoveStateManager.isValidEndEvent(e)),(e=>this.oneFingerTouchMoveStateManager.isValidEndEvent(e)))}}const Xn=e=>{e.mousedown=e.dragStart,e.mousemoveWindow=e.dragMove,e.mouseup=e.dragEnd,e.contextmenu=e=>{e.preventDefault()}};class Yn{constructor(e,t){this._clickTolerance=e.clickTolerance||1,this._map=t,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new t.P(0,0)}_shouldBePrevented(e){return e<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(e,t,i){return this._calculateTransform(e,t,i)}touchmove(e,t,i){if(this._active){if(!this._shouldBePrevented(i.length))return e.preventDefault(),this._calculateTransform(e,t,i);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",e)}}touchend(e,t,i){this._calculateTransform(e,t,i),this._active&&this._shouldBePrevented(i.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,i,r){r.length>0&&(this._active=!0);const n=jn(r,i),o=new t.P(0,0),s=new t.P(0,0);let a=0;for(const e in n){const t=n[e],i=this._touches[e];i&&(o._add(t),s._add(t.sub(i)),a++,n[e]=t)}if(this._touches=n,this._shouldBePrevented(a)||!s.mag())return;const l=s.div(a);return this._sum._add(l),this._sum.mag()<this._clickTolerance?void 0:{around:o.div(a),panDelta:l}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Jn{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(e,t,i){this._firstTwoTouches||i.length<2||(this._firstTwoTouches=[i[0].identifier,i[1].identifier],this._start([t[0],t[1]]))}touchmove(e,t,i){if(!this._firstTwoTouches)return;e.preventDefault();const[r,n]=this._firstTwoTouches,o=eo(i,t,r),s=eo(i,t,n);if(!o||!s)return;const a=this._aroundCenter?null:o.add(s).div(2);return this._move([o,s],a,e)}touchend(e,t,i){if(!this._firstTwoTouches)return;const[r,n]=this._firstTwoTouches,o=eo(i,t,r),s=eo(i,t,n);o&&s||(this._active&&a.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&"center"===e.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function eo(e,t,i){for(let r=0;r<e.length;r++)if(e[r].identifier===i)return t[r]}function to(e,t){return Math.log(e/t)/Math.LN2}class io extends Jn{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,t){const i=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(to(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:to(this._distance,i),pinchAround:t}}}function ro(e,t){return 180*e.angleWith(t)/Math.PI}class no extends Jn{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,t,i){const r=this._vector;if(this._vector=e[0].sub(e[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:ro(this._vector,r),pinchAround:t}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());const t=25/(Math.PI*this._minDiameter)*360,i=ro(e,this._startVector);return Math.abs(i)<t}}function oo(e){return Math.abs(e.y)>Math.abs(e.x)}class so extends Jn{constructor(e){super(),this._currentTouchCount=0,this._map=e}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(e,t,i){super.touchstart(e,t,i),this._currentTouchCount=i.length}_start(e){this._lastPoints=e,oo(e[0].sub(e[1]))&&(this._valid=!1)}_move(e,t,i){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const r=e[0].sub(this._lastPoints[0]),n=e[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(r,n,i.timeStamp),this._valid?(this._lastPoints=e,this._active=!0,{pitchDelta:(r.y+n.y)/2*-.5}):void 0}gestureBeginsVertically(e,t,i){if(void 0!==this._valid)return this._valid;const r=e.mag()>=2,n=t.mag()>=2;if(!r&&!n)return;if(!r||!n)return void 0===this._firstMove&&(this._firstMove=i),i-this._firstMove<100&&void 0;const o=e.y>0==t.y>0;return oo(e)&&oo(t)&&o}}const ao={panStep:100,bearingStep:15,pitchStep:10};class lo{constructor(e){this._tr=new Nn(e);const t=ao;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let t=0,i=0,r=0,n=0,o=0;switch(e.keyCode){case 61:case 107:case 171:case 187:t=1;break;case 189:case 109:case 173:t=-1;break;case 37:e.shiftKey?i=-1:(e.preventDefault(),n=-1);break;case 39:e.shiftKey?i=1:(e.preventDefault(),n=1);break;case 38:e.shiftKey?r=1:(e.preventDefault(),o=-1);break;case 40:e.shiftKey?r=-1:(e.preventDefault(),o=1);break;default:return}return this._rotationDisabled&&(i=0,r=0),{cameraAnimation:s=>{const a=this._tr;s.easeTo({duration:300,easeId:"keyboardHandler",easing:co,zoom:t?Math.round(a.zoom)+t*(e.shiftKey?2:1):a.zoom,bearing:a.bearing+i*this._bearingStep,pitch:a.pitch+r*this._pitchStep,offset:[-n*this._panStep,-o*this._panStep],center:a.center},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function co(e){return e*(2-e)}const uo=4.000244140625;class ho{constructor(e,t){this._onTimeout=e=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(e)},this._map=e,this._tr=new Nn(e),this._triggerRenderFrame=t,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return!!this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&"center"===e.around)}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(e){return!!this._map.cooperativeGestures.isEnabled()&&!(e.ctrlKey||this._map.cooperativeGestures.isBypassed(e))}wheel(e){if(!this.isEnabled())return;if(this._shouldBePrevented(e))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",e);let t=e.deltaMode===WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY;const i=s.now(),r=i-(this._lastWheelEventTime||0);this._lastWheelEventTime=i,0!==t&&t%uo==0?this._type="wheel":0!==t&&Math.abs(t)<4?this._type="trackpad":r>400?(this._type=null,this._lastValue=t,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(r*t)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,t+=this._lastValue)),e.shiftKey&&t&&(t/=4),this._type&&(this._lastWheelEvent=e,this._delta-=t,this._active||this._start(e)),e.preventDefault()}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const i=a.mousePos(this._map.getCanvas(),e),r=this._tr;this._aroundPoint=this._aroundCenter?r.transform.locationToScreenPoint(t.Q.convert(r.center)):i,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId)return;if(this._frameId=null,!this.isActive())return;const e=this._tr.transform;if("number"==typeof this._lastExpectedZoom){const t=e.zoom-this._lastExpectedZoom;"number"==typeof this._startZoom&&(this._startZoom+=t),"number"==typeof this._targetZoom&&(this._targetZoom+=t)}if(0!==this._delta){const i="wheel"===this._type&&Math.abs(this._delta)>uo?this._wheelZoomRate:this._defaultZoomRate;let r=2/(1+Math.exp(-Math.abs(this._delta*i)));this._delta<0&&0!==r&&(r=1/r);const n="number"!=typeof this._targetZoom?e.scale:t.ac(this._targetZoom);this._targetZoom=Math.min(e.maxZoom,Math.max(e.minZoom,t.ah(n*r))),"wheel"===this._type&&(this._startZoom=e.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const i="number"!=typeof this._targetZoom?e.zoom:this._targetZoom,r=this._startZoom,n=this._easing;let o,a=!1;if("wheel"===this._type&&r&&n){const e=s.now()-this._lastWheelEventTime,l=Math.min((e+5)/200,1),c=n(l);o=t.B.number(r,i,c),l<1?this._frameId||(this._frameId=!0):a=!0}else o=i,a=!0;return this._active=!0,a&&(this._active=!1,this._finishTimeout=setTimeout((()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout}),200)),this._lastExpectedZoom=o,{noInertia:!0,needsRenderFrame:!a,zoomDelta:o-e.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let i=t.cd;if(this._prevEase){const e=this._prevEase,r=(s.now()-e.start)/e.duration,n=e.easing(r+.01)-e.easing(r),o=.27/Math.sqrt(n*n+1e-4)*.01,a=Math.sqrt(.0729-o*o);i=t.cb(o,a,.25,1)}return this._prevEase={start:s.now(),duration:e,easing:i},i}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class po{constructor(e,t){this._clickZoom=e,this._tapZoom=t}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class fo{constructor(e){this._tr=new Nn(e),this.reset()}reset(){this._active=!1}dblclick(e,t){return e.preventDefault(),{cameraAnimation:i=>{i.easeTo({duration:300,zoom:this._tr.zoom+(e.shiftKey?-1:1),around:this._tr.unproject(t)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ao{constructor(){this._tap=new Hn({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(e,t,i){if(!this._swipePoint)if(this._tapTime){const r=t[0],n=e.timeStamp-this._tapTime<500,o=this._tapPoint.dist(r)<30;n&&o?i.length>0&&(this._swipePoint=r,this._swipeTouch=i[0].identifier):this.reset()}else this._tap.touchstart(e,t,i)}touchmove(e,t,i){if(this._tapTime){if(this._swipePoint){if(i[0].identifier!==this._swipeTouch)return;const r=t[0],n=r.y-this._swipePoint.y;return this._swipePoint=r,e.preventDefault(),this._active=!0,{zoomDelta:n/128}}}else this._tap.touchmove(e,t,i)}touchend(e,t,i){if(this._tapTime)this._swipePoint&&0===i.length&&this.reset();else{const r=this._tap.touchend(e,t,i);r&&(this._tapTime=e.timeStamp,this._tapPoint=r)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class mo{constructor(e,t,i){this._el=e,this._mousePan=t,this._touchPan=i}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class go{constructor(e,t,i,r){this._pitchWithRotate=e.pitchWithRotate,this._rollEnabled=e.rollEnabled,this._mouseRotate=t,this._mousePitch=i,this._mouseRoll=r}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class _o{constructor(e,t,i,r){this._el=e,this._touchZoom=t,this._touchRotate=i,this._tapDragZoom=r,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class yo{constructor(e,t){this._bypassKey=-1!==navigator.userAgent.indexOf("Mac")?"metaKey":"ctrlKey",this._map=e,this._options=t,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const e=this._map.getCanvasContainer();e.classList.add("maplibregl-cooperative-gestures"),this._container=a.create("div","maplibregl-cooperative-gesture-screen",e);let t=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");"metaKey"===this._bypassKey&&(t=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const i=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),r=document.createElement("div");r.className="maplibregl-desktop-message",r.textContent=t,this._container.appendChild(r);const n=document.createElement("div");n.className="maplibregl-mobile-message",n.textContent=i,this._container.appendChild(n),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(a.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(e){return e[this._bypassKey]}notifyGestureBlocked(e,i){this._enabled&&(this._map.fire(new t.l("cooperativegestureprevented",{gestureType:e,originalEvent:i})),this._container.classList.add("maplibregl-show"),setTimeout((()=>{this._container.classList.remove("maplibregl-show")}),100))}}const vo=e=>e.zoom||e.drag||e.roll||e.pitch||e.rotate;class xo extends t.l{}function bo(e){return e.panDelta&&e.panDelta.mag()||e.zoomDelta||e.bearingDelta||e.pitchDelta||e.rollDelta}class wo{constructor(e,i){this.handleWindowEvent=e=>{this.handleEvent(e,`${e.type}Window`)},this.handleEvent=(e,i)=>{if("blur"===e.type)return void this.stop(!0);this._updatingCamera=!0;const r="renderFrame"===e.type?void 0:e,n={needsRenderFrame:!1},o={},s={};for(const{handlerName:l,handler:c,allowed:u}of this._handlers){if(!c.isEnabled())continue;let h;if(this._blockedByActive(s,u,l))c.reset();else if(c[i||e.type]){if(t.ce(e,i||e.type)){const t=a.mousePos(this._map.getCanvas(),e);h=c[i||e.type](e,t)}else if(t.cf(e,i||e.type)){const t=this._getMapTouches(e.touches),r=a.touchPos(this._map.getCanvas(),t);h=c[i||e.type](e,r,t)}else t.cg(i||e.type)||(h=c[i||e.type](e));this.mergeHandlerResult(n,o,h,l,r),h&&h.needsRenderFrame&&this._triggerRenderFrame()}(h||c.isActive())&&(s[l]=c)}const l={};for(const e in this._previousActiveHandlers)s[e]||(l[e]=r);this._previousActiveHandlers=s,(Object.keys(l).length||bo(n))&&(this._changes.push([n,o,l]),this._triggerRenderFrame()),(Object.keys(s).length||bo(n))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:c}=n;c&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],c(this._map))},this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Ln(e),this._bearingSnap=i.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(i);const r=this._el;this._listeners=[[r,"touchstart",{passive:!0}],[r,"touchmove",{passive:!1}],[r,"touchend",void 0],[r,"touchcancel",void 0],[r,"mousedown",void 0],[r,"mousemove",void 0],[r,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[r,"mouseover",void 0],[r,"mouseout",void 0],[r,"dblclick",void 0],[r,"click",void 0],[r,"keydown",{capture:!1}],[r,"keyup",void 0],[r,"wheel",{passive:!1}],[r,"contextmenu",void 0],[window,"blur",void 0]];for(const[e,t,i]of this._listeners)a.addEventListener(e,t,e===document?this.handleWindowEvent:this.handleEvent,i)}destroy(){for(const[e,t,i]of this._listeners)a.removeEventListener(e,t,e===document?this.handleWindowEvent:this.handleEvent,i)}_addDefaultHandlers(e){const i=this._map,r=i.getCanvasContainer();this._add("mapEvent",new On(i,e));const n=i.boxZoom=new Qn(i,e);this._add("boxZoom",n),e.interactive&&e.boxZoom&&n.enable();const o=i.cooperativeGestures=new yo(i,e.cooperativeGestures);this._add("cooperativeGestures",o),e.cooperativeGestures&&o.enable();const s=new Gn(i),l=new fo(i);i.doubleClickZoom=new po(l,s),this._add("tapZoom",s),this._add("clickZoom",l),e.interactive&&e.doubleClickZoom&&i.doubleClickZoom.enable();const c=new Ao;this._add("tapDragZoom",c);const u=i.touchPitch=new so(i);this._add("touchPitch",u),e.interactive&&e.touchPitch&&i.touchPitch.enable(e.touchPitch);const h=()=>i.project(i.getCenter()),d=function({enable:e,clickTolerance:i,aroundCenter:r=!0,minPixelCenterThreshold:n=100,rotateDegreesPerPixelMoved:o=.8},s){const l=new qn({checkCorrectEvent:e=>0===a.mouseButton(e)&&e.ctrlKey||2===a.mouseButton(e)&&!e.ctrlKey});return new $n({clickTolerance:i,move:(e,i)=>{const a=s();if(r&&Math.abs(a.y-e.y)>n)return{bearingDelta:t.cc(new t.P(e.x,i.y),i,a)};let l=(i.x-e.x)*o;return r&&i.y<a.y&&(l=-l),{bearingDelta:l}},moveStateManager:l,enable:e,assignEvents:Xn})}(e,h),p=function({enable:e,clickTolerance:t,pitchDegreesPerPixelMoved:i=-.5}){const r=new qn({checkCorrectEvent:e=>0===a.mouseButton(e)&&e.ctrlKey||2===a.mouseButton(e)});return new $n({clickTolerance:t,move:(e,t)=>({pitchDelta:(t.y-e.y)*i}),moveStateManager:r,enable:e,assignEvents:Xn})}(e),f=function({enable:e,clickTolerance:t,rollDegreesPerPixelMoved:i=.3},r){const n=new qn({checkCorrectEvent:e=>2===a.mouseButton(e)&&e.ctrlKey});return new $n({clickTolerance:t,move:(e,t)=>{const n=r();let o=(t.x-e.x)*i;return t.y<n.y&&(o=-o),{rollDelta:o}},moveStateManager:n,enable:e,assignEvents:Xn})}(e,h);i.dragRotate=new go(e,d,p,f),this._add("mouseRotate",d,["mousePitch"]),this._add("mousePitch",p,["mouseRotate","mouseRoll"]),this._add("mouseRoll",f,["mousePitch"]),e.interactive&&e.dragRotate&&i.dragRotate.enable();const A=function({enable:e,clickTolerance:t}){const i=new qn({checkCorrectEvent:e=>0===a.mouseButton(e)&&!e.ctrlKey});return new $n({clickTolerance:t,move:(e,t)=>({around:t,panDelta:t.sub(e)}),activateOnStart:!0,moveStateManager:i,enable:e,assignEvents:Xn})}(e),m=new Yn(e,i);i.dragPan=new mo(r,A,m),this._add("mousePan",A),this._add("touchPan",m,["touchZoom","touchRotate"]),e.interactive&&e.dragPan&&i.dragPan.enable(e.dragPan);const g=new no,_=new io;i.touchZoomRotate=new _o(r,_,g,c),this._add("touchRotate",g,["touchPan","touchZoom"]),this._add("touchZoom",_,["touchPan","touchRotate"]),e.interactive&&e.touchZoomRotate&&i.touchZoomRotate.enable(e.touchZoomRotate);const y=i.scrollZoom=new ho(i,(()=>this._triggerRenderFrame()));this._add("scrollZoom",y,["mousePan"]),e.interactive&&e.scrollZoom&&i.scrollZoom.enable(e.scrollZoom);const v=i.keyboard=new lo(i);this._add("keyboard",v),e.interactive&&e.keyboard&&i.keyboard.enable(),this._add("blockableMapEvent",new Un(i))}_add(e,t,i){this._handlers.push({handlerName:e,handler:t,allowed:i}),this._handlersById[e]=t}stop(e){if(!this._updatingCamera){for(const{handler:e}of this._handlers)e.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[]}}isActive(){for(const{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return Boolean(vo(this._eventsInProgress))||this.isZooming()}_blockedByActive(e,t,i){for(const r in e)if(r!==i&&(!t||t.indexOf(r)<0))return!0;return!1}_getMapTouches(e){const t=[];for(const i of e)this._el.contains(i.target)&&t.push(i);return t}mergeHandlerResult(e,i,r,n,o){if(!r)return;t.e(e,r);const s={handlerName:n,originalEvent:r.originalEvent||o};void 0!==r.zoomDelta&&(i.zoom=s),void 0!==r.panDelta&&(i.drag=s),void 0!==r.rollDelta&&(i.roll=s),void 0!==r.pitchDelta&&(i.pitch=s),void 0!==r.bearingDelta&&(i.rotate=s)}_applyChanges(){const e={},i={},r={};for(const[n,o,s]of this._changes)n.panDelta&&(e.panDelta=(e.panDelta||new t.P(0,0))._add(n.panDelta)),n.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+n.zoomDelta),n.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+n.bearingDelta),n.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+n.pitchDelta),n.rollDelta&&(e.rollDelta=(e.rollDelta||0)+n.rollDelta),void 0!==n.around&&(e.around=n.around),void 0!==n.pinchAround&&(e.pinchAround=n.pinchAround),n.noInertia&&(e.noInertia=n.noInertia),t.e(i,o),t.e(r,s);this._updateMapTransform(e,i,r),this._changes=[]}_updateMapTransform(e,t,i){const r=this._map,n=r._getTransformForUpdate(),o=r.terrain;if(!(bo(e)||o&&this._terrainMovement))return this._fireEvents(t,i,!0);r._stop(!0);let{panDelta:s,zoomDelta:a,bearingDelta:l,pitchDelta:c,rollDelta:u,around:h,pinchAround:d}=e;void 0!==d&&(h=d),h=h||r.transform.centerPoint,o&&!n.isPointOnMapSurface(h)&&(h=n.centerPoint);const p={panDelta:s,zoomDelta:a,rollDelta:u,pitchDelta:c,bearingDelta:l,around:h};this._map.cameraHelper.useGlobeControls&&!n.isPointOnMapSurface(h)&&(h=n.centerPoint);const f=h.distSqr(n.centerPoint)<.01?n.center:n.screenPointToLocation(s?h.sub(s):h);o?(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(p,n),this._terrainMovement||!t.drag&&!t.zoom?t.drag&&this._terrainMovement?n.setCenter(n.screenPointToLocation(n.centerPoint.sub(s))):this._map.cameraHelper.handleMapControlsPan(p,n,f):(this._terrainMovement=!0,this._map._elevationFreeze=!0,this._map.cameraHelper.handleMapControlsPan(p,n,f))):(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(p,n),this._map.cameraHelper.handleMapControlsPan(p,n,f)),r._applyUpdatedTransform(n),this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(t,i,!0)}_fireEvents(e,i,r){const n=vo(this._eventsInProgress),o=vo(e),a={};for(const t in e){const{originalEvent:i}=e[t];this._eventsInProgress[t]||(a[`${t}start`]=i),this._eventsInProgress[t]=e[t]}!n&&o&&this._fireEvent("movestart",o.originalEvent);for(const e in a)this._fireEvent(e,a[e]);o&&this._fireEvent("move",o.originalEvent);for(const t in e){const{originalEvent:i}=e[t];this._fireEvent(t,i)}const l={};let c;for(const e in this._eventsInProgress){const{handlerName:t,originalEvent:r}=this._eventsInProgress[e];this._handlersById[t].isActive()||(delete this._eventsInProgress[e],c=i[t]||r,l[`${e}end`]=c)}for(const e in l)this._fireEvent(e,l[e]);const u=vo(this._eventsInProgress),h=(n||o)&&!u;if(h&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const e=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&e.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(e)}if(r&&h){this._updatingCamera=!0;const e=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),i=e=>0!==e&&-this._bearingSnap<e&&e<this._bearingSnap;!e||!e.essential&&s.prefersReducedMotion?(this._map.fire(new t.l("moveend",{originalEvent:c})),i(this._map.getBearing())&&this._map.resetNorth()):(i(e.bearing||this._map.getBearing())&&(e.bearing=0),e.freezeElevation=!0,this._map.easeTo(e,{originalEvent:c})),this._updatingCamera=!1}}_fireEvent(e,i){this._map.fire(new t.l(e,i?{originalEvent:i}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((e=>{delete this._frameId,this.handleEvent(new xo("renderFrame",{timeStamp:e})),this._applyChanges()}))}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}class To extends t.E{constructor(e,t,i){super(),this._renderFrameCallback=()=>{const e=Math.min((s.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(e)),e<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=i.bearingSnap,this.cameraHelper=t,this.on("moveend",(()=>{delete this._requestedCameraState}))}migrateProjection(e,t){e.apply(this.transform),this.transform=e,this.cameraHelper=t}getCenter(){return new t.Q(this.transform.center.lng,this.transform.center.lat)}setCenter(e,t){return this.jumpTo({center:e},t)}getCenterElevation(){return this.transform.elevation}setCenterElevation(e,t){return this.jumpTo({elevation:e},t),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(e){this._centerClampedToGround=e}panBy(e,i,r){return e=t.P.convert(e).mult(-1),this.panTo(this.transform.center,t.e({offset:e},i),r)}panTo(e,i,r){return this.easeTo(t.e({center:e},i),r)}getZoom(){return this.transform.zoom}setZoom(e,t){return this.jumpTo({zoom:e},t),this}zoomTo(e,i,r){return this.easeTo(t.e({zoom:e},i),r)}zoomIn(e,t){return this.zoomTo(this.getZoom()+1,e,t),this}zoomOut(e,t){return this.zoomTo(this.getZoom()-1,e,t),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(e,i){return e!=this.transform.fov&&(this.transform.setFov(e),this.fire(new t.l("movestart",i)).fire(new t.l("move",i)).fire(new t.l("moveend",i))),this}getBearing(){return this.transform.bearing}setBearing(e,t){return this.jumpTo({bearing:e},t),this}getPadding(){return this.transform.padding}setPadding(e,t){return this.jumpTo({padding:e},t),this}rotateTo(e,i,r){return this.easeTo(t.e({bearing:e},i),r)}resetNorth(e,i){return this.rotateTo(0,t.e({duration:1e3},e),i),this}resetNorthPitch(e,i){return this.easeTo(t.e({bearing:0,pitch:0,roll:0,duration:1e3},e),i),this}snapToNorth(e,t){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,t):this}getPitch(){return this.transform.pitch}setPitch(e,t){return this.jumpTo({pitch:e},t),this}getRoll(){return this.transform.roll}setRoll(e,t){return this.jumpTo({roll:e},t),this}cameraForBounds(e,t){e=H.convert(e).adjustAntiMeridian();const i=t&&t.bearing||0;return this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),i,t)}_cameraForBoxAndBearing(e,i,r,n){const o={top:0,bottom:0,right:0,left:0};if("number"==typeof(n=t.e({padding:o,offset:[0,0],maxZoom:this.transform.maxZoom},n)).padding){const e=n.padding;n.padding={top:e,bottom:e,right:e,left:e}}const s=t.e(o,n.padding);n.padding=s;const a=this.transform,l=new H(e,i);return this.cameraHelper.cameraForBoxAndBearing(n,s,l,r,a)}fitBounds(e,t,i){return this._fitInternal(this.cameraForBounds(e,t),t,i)}fitScreenCoordinates(e,i,r,n,o){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(t.P.convert(e)),this.transform.screenPointToLocation(t.P.convert(i)),r,n),n,o)}_fitInternal(e,i,r){return e?(delete(i=t.e(e,i)).padding,i.linear?this.easeTo(i,r):this.flyTo(i,r)):this}jumpTo(e,i){this.stop();const r=this._getTransformForUpdate();let n=!1,o=!1,s=!1;const a=r.zoom;this.cameraHelper.handleJumpToCenterZoom(r,e);const l=r.zoom!==a;return"elevation"in e&&r.elevation!==+e.elevation&&r.setElevation(+e.elevation),"bearing"in e&&r.bearing!==+e.bearing&&(n=!0,r.setBearing(+e.bearing)),"pitch"in e&&r.pitch!==+e.pitch&&(o=!0,r.setPitch(+e.pitch)),"roll"in e&&r.roll!==+e.roll&&(s=!0,r.setRoll(+e.roll)),null==e.padding||r.isPaddingEqual(e.padding)||r.setPadding(e.padding),this._applyUpdatedTransform(r),this.fire(new t.l("movestart",i)).fire(new t.l("move",i)),l&&this.fire(new t.l("zoomstart",i)).fire(new t.l("zoom",i)).fire(new t.l("zoomend",i)),n&&this.fire(new t.l("rotatestart",i)).fire(new t.l("rotate",i)).fire(new t.l("rotateend",i)),o&&this.fire(new t.l("pitchstart",i)).fire(new t.l("pitch",i)).fire(new t.l("pitchend",i)),s&&this.fire(new t.l("rollstart",i)).fire(new t.l("roll",i)).fire(new t.l("rollend",i)),this.fire(new t.l("moveend",i))}calculateCameraOptionsFromTo(e,i,r,n=0){const o=t.$.fromLngLat(e,i),s=t.$.fromLngLat(r,n),a=s.x-o.x,l=s.y-o.y,c=s.z-o.z,u=Math.hypot(a,l,c);if(0===u)throw new Error("Can't calculate camera options with same From and To");const h=Math.hypot(a,l),d=t.ah(this.transform.cameraToCenterDistance/u/this.transform.tileSize),p=180*Math.atan2(a,-l)/Math.PI;let f=180*Math.acos(h/u)/Math.PI;return f=c<0?90-f:90+f,{center:s.toLngLat(),elevation:n,zoom:d,pitch:f,bearing:p}}calculateCameraOptionsFromCameraLngLatAltRotation(e,t,i,r,n){const o=this.transform.calculateCenterFromCameraLngLatAlt(e,t,i,r);return{center:o.center,elevation:o.elevation,zoom:o.zoom,bearing:i,pitch:r,roll:n}}easeTo(e,i){this._stop(!1,e.easeId),(!1===(e=t.e({offset:[0,0],duration:500,easing:t.cd},e)).animate||!e.essential&&s.prefersReducedMotion)&&(e.duration=0);const r=this._getTransformForUpdate(),n=this.getBearing(),o=r.pitch,a=r.roll,l="bearing"in e?this._normalizeBearing(e.bearing,n):n,c="pitch"in e?+e.pitch:o,u="roll"in e?this._normalizeBearing(e.roll,a):a,h="padding"in e?e.padding:r.padding,d=t.P.convert(e.offset);let p,f;e.around&&(p=t.Q.convert(e.around),f=r.locationToScreenPoint(p));const A={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},m=this.cameraHelper.handleEaseTo(r,{bearing:l,pitch:c,roll:u,padding:h,around:p,aroundPoint:f,offsetAsPoint:d,offset:e.offset,zoom:e.zoom,center:e.center});return this._rotating=this._rotating||n!==l,this._pitching=this._pitching||c!==o,this._rolling=this._rolling||u!==a,this._padding=!r.isPaddingEqual(h),this._zooming=this._zooming||m.isZooming,this._easeId=e.easeId,this._prepareEase(i,e.noMoveStart,A),this.terrain&&this._prepareElevation(m.elevationCenter),this._ease((t=>{m.easeFunc(t),this.terrain&&!e.freezeElevation&&this._updateElevation(t),this._applyUpdatedTransform(r),this._fireMoveEvents(i)}),(t=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(i,t)}),e),this}_prepareEase(e,i,r={}){this._moving=!0,i||r.moving||this.fire(new t.l("movestart",e)),this._zooming&&!r.zooming&&this.fire(new t.l("zoomstart",e)),this._rotating&&!r.rotating&&this.fire(new t.l("rotatestart",e)),this._pitching&&!r.pitching&&this.fire(new t.l("pitchstart",e)),this._rolling&&!r.rolling&&this.fire(new t.l("rollstart",e))}_prepareElevation(e){this._elevationCenter=e,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(e,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(e){this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));const i=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(e<1&&i!==this._elevationTarget){const t=this._elevationTarget-this._elevationStart;this._elevationStart+=e*(t-(i-(t*e+this._elevationStart))/(1-e)),this._elevationTarget=i}this.transform.setElevation(t.B.number(this._elevationStart,this._elevationTarget,e))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(e){if(!this.terrain&&e.elevation>=0&&e.pitch<=90)return{};const t=e.getCameraLngLat(),i=e.getCameraAltitude(),r=this.terrain?this.terrain.getElevationForLngLatZoom(t,e.zoom):0;if(i<r){const i=this.calculateCameraOptionsFromTo(t,r,e.center,e.elevation);return{pitch:i.pitch,zoom:i.zoom}}return{}}_applyUpdatedTransform(e){const t=[];if(t.push((e=>this._elevateCameraIfInsideTerrain(e))),this.transformCameraUpdate&&t.push((e=>this.transformCameraUpdate(e))),!t.length)return;const i=e.clone();for(const e of t){const t=i.clone(),{center:r,zoom:n,roll:o,pitch:s,bearing:a,elevation:l}=e(t);r&&t.setCenter(r),void 0!==l&&t.setElevation(l),void 0!==n&&t.setZoom(n),void 0!==o&&t.setRoll(o),void 0!==s&&t.setPitch(s),void 0!==a&&t.setBearing(a),i.apply(t)}this.transform.apply(i)}_fireMoveEvents(e){this.fire(new t.l("move",e)),this._zooming&&this.fire(new t.l("zoom",e)),this._rotating&&this.fire(new t.l("rotate",e)),this._pitching&&this.fire(new t.l("pitch",e)),this._rolling&&this.fire(new t.l("roll",e))}_afterEase(e,i){if(this._easeId&&i&&this._easeId===i)return;delete this._easeId;const r=this._zooming,n=this._rotating,o=this._pitching,s=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,r&&this.fire(new t.l("zoomend",e)),n&&this.fire(new t.l("rotateend",e)),o&&this.fire(new t.l("pitchend",e)),s&&this.fire(new t.l("rollend",e)),this.fire(new t.l("moveend",e))}flyTo(e,i){if(!e.essential&&s.prefersReducedMotion){const r=t.O(e,["center","zoom","bearing","pitch","roll","elevation"]);return this.jumpTo(r,i)}this.stop(),e=t.e({offset:[0,0],speed:1.2,curve:1.42,easing:t.cd},e);const r=this._getTransformForUpdate(),n=r.bearing,o=r.pitch,a=r.roll,l=r.padding,c="bearing"in e?this._normalizeBearing(e.bearing,n):n,u="pitch"in e?+e.pitch:o,h="roll"in e?this._normalizeBearing(e.roll,a):a,d="padding"in e?e.padding:r.padding,p=t.P.convert(e.offset);let f=r.centerPoint.add(p);const A=r.screenPointToLocation(f),m=this.cameraHelper.handleFlyTo(r,{bearing:c,pitch:u,roll:h,padding:d,locationAtOffset:A,offsetAsPoint:p,center:e.center,minZoom:e.minZoom,zoom:e.zoom});let g=e.curve;const _=Math.max(r.width,r.height),y=_/m.scaleOfZoom,v=m.pixelPathLength;"number"==typeof m.scaleOfMinZoom&&(g=Math.sqrt(_/m.scaleOfMinZoom/v*2));const x=g*g;function b(e){const t=(y*y-_*_+(e?-1:1)*x*x*v*v)/(2*(e?y:_)*x*v);return Math.log(Math.sqrt(t*t+1)-t)}function w(e){return(Math.exp(e)-Math.exp(-e))/2}function T(e){return(Math.exp(e)+Math.exp(-e))/2}const B=b(!1);let C=function(e){return T(B)/T(B+g*e)},S=function(e){return _*((T(B)*(w(t=B+g*e)/T(t))-w(B))/x)/v;var t},E=(b(!0)-B)/g;if(Math.abs(v)<2e-6||!isFinite(E)){if(Math.abs(_-y)<1e-6)return this.easeTo(e,i);const t=y<_?-1:1;E=Math.abs(Math.log(y/_))/g,S=()=>0,C=e=>Math.exp(t*g*e)}return e.duration="duration"in e?+e.duration:1e3*E/("screenSpeed"in e?+e.screenSpeed/g:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=n!==c,this._pitching=u!==o,this._rolling=h!==a,this._padding=!r.isPaddingEqual(d),this._prepareEase(i,!1),this.terrain&&this._prepareElevation(m.targetCenter),this._ease((s=>{const A=s*E,g=1/C(A),_=S(A);this._rotating&&r.setBearing(t.B.number(n,c,s)),this._pitching&&r.setPitch(t.B.number(o,u,s)),this._rolling&&r.setRoll(t.B.number(a,h,s)),this._padding&&(r.interpolatePadding(l,d,s),f=r.centerPoint.add(p)),m.easeFunc(s,g,_,f),this.terrain&&!e.freezeElevation&&this._updateElevation(s),this._applyUpdatedTransform(r),this._fireMoveEvents(i)}),(()=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(i)}),e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,t){var i;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const e=this._onEaseEnd;delete this._onEaseEnd,e.call(this,t)}return e||null===(i=this.handlers)||void 0===i||i.stop(!1),this}_ease(e,t,i){!1===i.animate||0===i.duration?(e(1),t()):(this._easeStart=s.now(),this._easeOptions=i,this._onEaseFrame=e,this._onEaseEnd=t,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(e,i){e=t.aL(e,-180,180);const r=Math.abs(e-i);return Math.abs(e-360-i)<r&&(e-=360),Math.abs(e+360-i)<r&&(e+=360),e}queryTerrainElevation(e){return this.terrain?this.terrain.getElevationForLngLatZoom(t.Q.convert(e),this.transform.tileZoom):null}}const Bo={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class Co{constructor(e=Bo){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=e=>{!e||"metadata"!==e.sourceDataType&&"visibility"!==e.sourceDataType&&"style"!==e.dataType&&"terrain"!==e.type||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?!1===this._compact?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=e}getDefaultPosition(){return"bottom-right"}onAdd(e){return this._map=e,this._compact=this.options.compact,this._container=a.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=a.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=a.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){a.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(e,t){const i=this._map._getUIString(`AttributionControl.${t}`);e.title=i,e.setAttribute("aria-label",i)}_updateAttributions(){if(!this._map.style)return;let e=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=e.concat(this.options.customAttribution.map((e=>"string"!=typeof e?"":e))):"string"==typeof this.options.customAttribution&&e.push(this.options.customAttribution)),this._map.style.stylesheet){const e=this._map.style.stylesheet;this.styleOwner=e.owner,this.styleId=e.id}const t=this._map.style.sourceCaches;for(const i in t){const r=t[i];if(r.used||r.usedForTerrain){const t=r.getSource();t.attribution&&e.indexOf(t.attribution)<0&&e.push(t.attribution)}}e=e.filter((e=>String(e).trim())),e.sort(((e,t)=>e.length-t.length)),e=e.filter(((t,i)=>{for(let r=i+1;r<e.length;r++)if(e[r].indexOf(t)>=0)return!1;return!0}));const i=e.join(" | ");i!==this._attribHTML&&(this._attribHTML=i,e.length?(this._innerContainer.innerHTML=a.sanitize(i),this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class So{constructor(e={}){this._updateCompact=()=>{const e=this._container.children;if(e.length){const t=e[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?!1!==this._compact&&t.classList.add("maplibregl-compact"):t.classList.remove("maplibregl-compact")}},this.options=e}getDefaultPosition(){return"bottom-left"}onAdd(e){this._map=e,this._compact=this.options&&this.options.compact,this._container=a.create("div","maplibregl-ctrl");const t=a.create("a","maplibregl-ctrl-logo");return t.target="_blank",t.rel="noopener nofollow",t.href="https://maplibre.org/",t.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),t.setAttribute("rel","noopener nofollow"),this._container.appendChild(t),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){a.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Eo{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){const t=++this._id;return this._queue.push({callback:e,id:t,cancelled:!1}),t}remove(e){const t=this._currentlyRunning,i=t?this._queue.concat(t):this._queue;for(const t of i)if(t.id===e)return void(t.cancelled=!0)}run(e=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const t=this._currentlyRunning=this._queue;this._queue=[];for(const i of t)if(!i.cancelled&&(i.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var Mo=t.aG([{name:"a_pos3d",type:"Int16",components:3}]);class Io extends t.E{constructor(e){super(),this._lastTilesetChange=s.now(),this.sourceCache=e,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=e._source.tileSize*2**this.deltaZoom,e.usedForTerrain=!0,e.tileSize=this.tileSize}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(e,i){this.sourceCache.update(e,i),this._renderableTilesKeys=[];const r={};for(const n of ye(e,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:i,calculateTileZoom:this.sourceCache._source.calculateTileZoom}))r[n.key]=!0,this._renderableTilesKeys.push(n.key),this._tiles[n.key]||(n.terrainRttPosMatrix32f=new Float64Array(16),t.bQ(n.terrainRttPosMatrix32f,0,t.Z,t.Z,0,0,1),this._tiles[n.key]=new oe(n,this.tileSize),this._lastTilesetChange=s.now());for(const e in this._tiles)r[e]||delete this._tiles[e]}freeRtt(e){for(const t in this._tiles){const i=this._tiles[t];(!e||i.tileID.equals(e)||i.tileID.isChildOf(e)||e.isChildOf(i.tileID))&&(i.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map((e=>this.getTileByID(e)))}getTileByID(e){return this._tiles[e]}getTerrainCoords(e,t){return t?this._getTerrainCoordsForTileRanges(e,t):this._getTerrainCoordsForRegularTile(e)}_getTerrainCoordsForRegularTile(e){const i={};for(const r of this._renderableTilesKeys){const n=this._tiles[r].tileID,o=e.clone(),s=t.b2();if(n.canonical.equals(e.canonical))t.bQ(s,0,t.Z,t.Z,0,0,1);else if(n.canonical.isChildOf(e.canonical)){const i=n.canonical.z-e.canonical.z,r=n.canonical.x-(n.canonical.x>>i<<i),o=n.canonical.y-(n.canonical.y>>i<<i),a=t.Z>>i;t.bQ(s,0,a,a,0,0,1),t.L(s,s,[-r*a,-o*a,0])}else{if(!e.canonical.isChildOf(n.canonical))continue;{const i=e.canonical.z-n.canonical.z,r=e.canonical.x-(e.canonical.x>>i<<i),o=e.canonical.y-(e.canonical.y>>i<<i),a=t.Z>>i;t.bQ(s,0,t.Z,t.Z,0,0,1),t.L(s,s,[r*a,o*a,0]),t.M(s,s,[1/2**i,1/2**i,0])}}o.terrainRttPosMatrix32f=new Float32Array(s),i[r]=o}return i}_getTerrainCoordsForTileRanges(e,i){const r={};for(const n of this._renderableTilesKeys){const o=this._tiles[n].tileID;if(!this._isWithinTileRanges(o,i))continue;const s=e.clone(),a=t.b2();if(o.canonical.z===e.canonical.z){const i=e.canonical.x-o.canonical.x,r=e.canonical.y-o.canonical.y;t.bQ(a,0,t.Z,t.Z,0,0,1),t.L(a,a,[i*t.Z,r*t.Z,0])}else if(o.canonical.z>e.canonical.z){const i=o.canonical.z-e.canonical.z,r=o.canonical.x-(o.canonical.x>>i<<i),n=o.canonical.y-(o.canonical.y>>i<<i),s=e.canonical.x-(o.canonical.x>>i),l=e.canonical.y-(o.canonical.y>>i),c=t.Z>>i;t.bQ(a,0,c,c,0,0,1),t.L(a,a,[-r*c+s*t.Z,-n*c+l*t.Z,0])}else{const i=e.canonical.z-o.canonical.z,r=e.canonical.x-(e.canonical.x>>i<<i),n=e.canonical.y-(e.canonical.y>>i<<i),s=(e.canonical.x>>i)-o.canonical.x,l=(e.canonical.y>>i)-o.canonical.y,c=t.Z<<i;t.bQ(a,0,c,c,0,0,1),t.L(a,a,[r*t.Z+s*c,n*t.Z+l*c,0])}s.terrainRttPosMatrix32f=new Float32Array(a),r[n]=s}return r}getSourceTile(e,t){const i=this.sourceCache._source;let r=e.overscaledZ-this.deltaZoom;if(r>i.maxzoom&&(r=i.maxzoom),r<i.minzoom)return null;this._sourceTileCache[e.key]||(this._sourceTileCache[e.key]=e.scaledTo(r).key);let n=this.sourceCache.getTileByID(this._sourceTileCache[e.key]);if((!n||!n.dem)&&t)for(;r>=i.minzoom&&(!n||!n.dem);)n=this.sourceCache.getTileByID(e.scaledTo(r--).key);return n}anyTilesAfterTime(e=Date.now()){return this._lastTilesetChange>=e}_isWithinTileRanges(e,t){return t[e.canonical.z]&&e.canonical.x>=t[e.canonical.z].minTileX&&e.canonical.x<=t[e.canonical.z].maxTileX&&e.canonical.y>=t[e.canonical.z].minTileY&&e.canonical.y<=t[e.canonical.z].maxTileY}}class Po{constructor(e,t,i){this._meshCache={},this.painter=e,this.sourceCache=new Io(t),this.options=i,this.exaggeration="number"==typeof i.exaggeration?i.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(e,i,r,n=t.Z){var o;if(!(i>=0&&i<n&&r>=0&&r<n))return 0;const s=this.getTerrainData(e),a=null===(o=s.tile)||void 0===o?void 0:o.dem;if(!a)return 0;const l=t.ch([],[i/n*t.Z,r/n*t.Z],s.u_terrain_matrix),c=[l[0]*a.dim,l[1]*a.dim],u=Math.floor(c[0]),h=Math.floor(c[1]),d=c[0]-u,p=c[1]-h;return a.get(u,h)*(1-d)*(1-p)+a.get(u+1,h)*d*(1-p)+a.get(u,h+1)*(1-d)*p+a.get(u+1,h+1)*d*p}getElevationForLngLatZoom(e,i){if(!t.ci(i,e.wrap()))return 0;const{tileID:r,mercatorX:n,mercatorY:o}=this._getOverscaledTileIDFromLngLatZoom(e,i);return this.getElevation(r,n%t.Z,o%t.Z,t.Z)}getElevation(e,i,r,n=t.Z){return this.getDEMElevation(e,i,r,n)*this.exaggeration}getTerrainData(e){if(!this._emptyDemTexture){const e=this.painter.context,i=new t.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new _(e,i,e.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new _(e,new t.R({width:1,height:1}),e.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(e.gl.NEAREST,e.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=t.ad([])}const i=this.sourceCache.getSourceTile(e,!0);if(i&&i.dem&&(!i.demTexture||i.needsTerrainPrepare)){const e=this.painter.context;i.demTexture=this.painter.getTileTexture(i.dem.stride),i.demTexture?i.demTexture.update(i.dem.getPixels(),{premultiply:!1}):i.demTexture=new _(e,i.dem.getPixels(),e.gl.RGBA,{premultiply:!1}),i.demTexture.bind(e.gl.NEAREST,e.gl.CLAMP_TO_EDGE),i.needsTerrainPrepare=!1}const r=i&&i+i.tileID.key+e.key;if(r&&!this._demMatrixCache[r]){const r=this.sourceCache.sourceCache._source.maxzoom;let n=e.canonical.z-i.tileID.canonical.z;e.overscaledZ>e.canonical.z&&(e.canonical.z>=r?n=e.canonical.z-r:t.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const o=e.canonical.x-(e.canonical.x>>n<<n),s=e.canonical.y-(e.canonical.y>>n<<n),a=t.cj(new Float64Array(16),[1/(t.Z<<n),1/(t.Z<<n),0]);t.L(a,a,[o*t.Z,s*t.Z,0]),this._demMatrixCache[e.key]={matrix:a,coord:e}}return{u_depth:2,u_terrain:3,u_terrain_dim:i&&i.dem&&i.dem.dim||1,u_terrain_matrix:r?this._demMatrixCache[e.key].matrix:this._emptyDemMatrix,u_terrain_unpack:i&&i.dem&&i.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(i&&i.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:i}}getFramebuffer(e){const t=this.painter,i=t.width/devicePixelRatio,r=t.height/devicePixelRatio;return!this._fbo||this._fbo.width===i&&this._fbo.height===r||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new _(t.context,{width:i,height:r,data:null},t.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(t.context.gl.NEAREST,t.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new _(t.context,{width:i,height:r,data:null},t.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(t.context.gl.NEAREST,t.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=t.context.createFramebuffer(i,r,!0,!1),this._fbo.depthAttachment.set(t.context.createRenderbuffer(t.context.gl.DEPTH_COMPONENT16,i,r))),this._fbo.colorAttachment.set("coords"===e?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const e=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const i=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let e=0,t=0;e<this._coordsTextureSize;e++)for(let r=0;r<this._coordsTextureSize;r++,t+=4)i[t+0]=255&r,i[t+1]=255&e,i[t+2]=r>>8<<4|e>>8,i[t+3]=0;const r=new t.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(i.buffer)),n=new _(e,r,e.gl.RGBA,{premultiply:!1});return n.bind(e.gl.NEAREST,e.gl.CLAMP_TO_EDGE),this._coordsTexture=n,n}pointCoordinate(e){this.painter.maybeDrawDepthAndCoords(!0);const i=new Uint8Array(4),r=this.painter.context,n=r.gl,o=Math.round(e.x*this.painter.pixelRatio/devicePixelRatio),s=Math.round(e.y*this.painter.pixelRatio/devicePixelRatio),a=Math.round(this.painter.height/devicePixelRatio);r.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),n.readPixels(o,a-s-1,1,1,n.RGBA,n.UNSIGNED_BYTE,i),r.bindFramebuffer.set(null);const l=i[0]+(i[2]>>4<<8),c=i[1]+((15&i[2])<<8),u=this.coordsIndex[255-i[3]],h=u&&this.sourceCache.getTileByID(u);if(!h)return null;const d=this._coordsTextureSize,p=(1<<h.tileID.canonical.z)*d;return new t.$((h.tileID.canonical.x*d+l)/p+h.tileID.wrap,(h.tileID.canonical.y*d+c)/p,this.getElevation(h.tileID,l,c,d))}depthAtPoint(e){const t=new Uint8Array(4),i=this.painter.context,r=i.gl;return i.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),r.readPixels(e.x,this.painter.height/devicePixelRatio-e.y-1,1,1,r.RGBA,r.UNSIGNED_BYTE,t),i.bindFramebuffer.set(null),(t[0]/16777216+t[1]/65536+t[2]/256+t[3])/256}getTerrainMesh(e){var i;const r=(null===(i=this.painter.style.projection)||void 0===i?void 0:i.transitionState)>0,n=r&&0===e.canonical.y,o=r&&e.canonical.y===(1<<e.canonical.z)-1,s=`m_${n?"n":""}_${o?"s":""}`;if(this._meshCache[s])return this._meshCache[s];const a=this.painter.context,l=new t.ck,c=new t.aK,u=this.meshSize,h=t.Z/u,d=u*u;for(let e=0;e<=u;e++)for(let t=0;t<=u;t++)l.emplaceBack(t*h,e*h,0);for(let e=0;e<d;e+=u+1)for(let t=0;t<u;t++)c.emplaceBack(t+e,u+t+e+1,u+t+e+2),c.emplaceBack(t+e,u+t+e+2,t+e+1);const p=l.length,f=p+(u+1),A=(u+1)*u,m=n?t.b9:0,g=n?0:1,_=o?t.ba:t.Z,y=o?0:1;for(let e=0;e<=u;e++)l.emplaceBack(e*h,m,g);for(let e=0;e<=u;e++)l.emplaceBack(e*h,_,y);for(let e=0;e<u;e++)c.emplaceBack(A+e,f+e,f+e+1),c.emplaceBack(A+e,f+e+1,A+e+1),c.emplaceBack(0+e,p+e+1,p+e),c.emplaceBack(0+e,0+e+1,p+e+1);const v=l.length,x=v+2*(u+1);for(const e of[0,1])for(let i=0;i<=u;i++)for(const r of[0,1])l.emplaceBack(e*t.Z,i*h,r);for(let e=0;e<2*u;e+=2)c.emplaceBack(v+e,v+e+1,v+e+3),c.emplaceBack(v+e,v+e+3,v+e+2),c.emplaceBack(x+e,x+e+3,x+e+1),c.emplaceBack(x+e,x+e+2,x+e+3);const b=new bt(a.createVertexBuffer(l,Mo.members),a.createIndexBuffer(c),t.aJ.simpleSegment(0,0,l.length,c.length));return this._meshCache[s]=b,b}getMeshFrameDelta(e){return 2*Math.PI*t.bu/Math.pow(2,Math.max(e,0))/5}getMinTileElevationForLngLatZoom(e,t){var i;const{tileID:r}=this._getOverscaledTileIDFromLngLatZoom(e,t);return null!==(i=this.getMinMaxElevation(r).minElevation)&&void 0!==i?i:0}getMinMaxElevation(e){const t=this.getTerrainData(e).tile,i={minElevation:null,maxElevation:null};return t&&t.dem&&(i.minElevation=t.dem.min*this.exaggeration,i.maxElevation=t.dem.max*this.exaggeration),i}_getOverscaledTileIDFromLngLatZoom(e,i){const r=t.$.fromLngLat(e.wrap()),n=(1<<i)*t.Z,o=r.x*n,s=r.y*n,a=Math.floor(o/t.Z),l=Math.floor(s/t.Z);return{tileID:new t.Y(i,0,i,a,l),mercatorX:o,mercatorY:s}}}class Lo{constructor(e,t,i){this._context=e,this._size=t,this._tileSize=i,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const e of this._objects)e.texture.destroy(),e.fbo.destroy()}_createObject(e){const t=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),i=new _(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return i.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),t.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),t.colorAttachment.set(i.texture),{id:e,fbo:t,texture:i,stamp:-1,inUse:!1}}getObjectForId(e){return this._objects[e]}useObject(e){e.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter((t=>e.id!==t)),this._recentlyUsed.push(e.id)}stampObject(e){e.stamp=++this._stamp}getOrCreateFreeObject(){for(const e of this._recentlyUsed)if(!this._objects[e].inUse)return this._objects[e];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const e=this._createObject(this._objects.length);return this._objects.push(e),e}freeObject(e){e.inUse=!1}freeAllObjects(){for(const e of this._objects)this.freeObject(e)}isFull(){return!(this._objects.length<this._size)&&!1===this._objects.some((e=>!e.inUse))}}const Fo={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class ko{constructor(e,t){this.painter=e,this.terrain=t,this.pool=new Lo(e.context,30,t.sourceCache.tileSize*t.qualityFactor)}destruct(){this.pool.destruct()}getTexture(e){return this.pool.getObjectForId(e.rtt[this._stacks.length-1].id).texture}prepareForRender(e,t){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=e._order.filter((i=>!e._layers[i].isHidden(t))),this._coordsAscending={};for(const t in e.sourceCaches){this._coordsAscending[t]={};const i=e.sourceCaches[t].getVisibleCoordinates(),r=e.sourceCaches[t].getSource(),n=r instanceof W?r.terrainTileRanges:null;for(const e of i){const i=this.terrain.sourceCache.getTerrainCoords(e,n);for(const e in i)this._coordsAscending[t][e]||(this._coordsAscending[t][e]=[]),this._coordsAscending[t][e].push(i[e])}}this._coordsAscendingStr={};for(const t of e._order){const i=e._layers[t],r=i.source;if(Fo[i.type]&&!this._coordsAscendingStr[r]){this._coordsAscendingStr[r]={};for(const e in this._coordsAscending[r])this._coordsAscendingStr[r][e]=this._coordsAscending[r][e].map((e=>e.key)).sort().join()}}for(const e of this._renderableTiles)for(const t in this._coordsAscendingStr){const i=this._coordsAscendingStr[t][e.tileID.key];i&&i!==e.rttCoords[t]&&(e.rtt=[])}}renderLayer(e,i){if(e.isHidden(this.painter.transform.zoom))return!1;const r=Object.assign(Object.assign({},i),{isRenderingToTexture:!0}),n=e.type,o=this.painter,s=this._renderableLayerIds[this._renderableLayerIds.length-1]===e.id;if(Fo[n]&&(this._prevType&&Fo[this._prevType]||this._stacks.push([]),this._prevType=n,this._stacks[this._stacks.length-1].push(e.id),!s))return!0;if(Fo[this._prevType]||Fo[n]&&s){this._prevType=n;const e=this._stacks.length-1,i=this._stacks[e]||[];for(const n of this._renderableTiles){if(this.pool.isFull()&&(xn(this.painter,this.terrain,this._rttTiles,r),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(n),n.rtt[e]){const t=this.pool.getObjectForId(n.rtt[e].id);if(t.stamp===n.rtt[e].stamp){this.pool.useObject(t);continue}}const s=this.pool.getOrCreateFreeObject();this.pool.useObject(s),this.pool.stampObject(s),n.rtt[e]={id:s.id,stamp:s.stamp},o.context.bindFramebuffer.set(s.fbo.framebuffer),o.context.clear({color:t.b7.transparent,stencil:0}),o.currentStencilSource=void 0;for(let e=0;e<i.length;e++){const t=o.style._layers[i[e]],a=t.source?this._coordsAscending[t.source][n.tileID.key]:[n.tileID];o.context.viewport.set([0,0,s.fbo.width,s.fbo.height]),o._renderTileClippingMasks(t,a,!0),o.renderLayer(o,o.style.sourceCaches[t.source],t,a,r),t.source&&(n.rttCoords[t.source]=this._coordsAscendingStr[t.source][n.tileID.key])}}return xn(this.painter,this.terrain,this._rttTiles,r),this._rttTiles=[],this.pool.freeAllObjects(),Fo[n]}return!1}}const zo={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Ro=i,Do={hash:!1,interactive:!0,bearingSnap:7,attributionControl:Bo,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:t.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0},Oo={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class Uo{constructor(e,i,r=!1){this.mousedown=e=>{this.startMove(e,a.mousePos(this.element,e)),a.addEventListener(window,"mousemove",this.mousemove),a.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=e=>{this.move(e,a.mousePos(this.element,e))},this.mouseup=e=>{this._rotatePitchHanlder.dragEnd(e),this.offTemp()},this.touchstart=e=>{1!==e.targetTouches.length?this.reset():(this._startPos=this._lastPos=a.touchPos(this.element,e.targetTouches)[0],this.startMove(e,this._startPos),a.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),a.addEventListener(window,"touchend",this.touchend))},this.touchmove=e=>{1!==e.targetTouches.length?this.reset():(this._lastPos=a.touchPos(this.element,e.targetTouches)[0],this.move(e,this._lastPos))},this.touchend=e=>{0===e.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHanlder.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=i;const n=new Wn;this._rotatePitchHanlder=new $n({clickTolerance:3,move:(e,n)=>{const o=i.getBoundingClientRect(),s=new t.P((o.bottom-o.top)/2,(o.right-o.left)/2);return{bearingDelta:t.cc(new t.P(e.x,n.y),n,s),pitchDelta:r?-.5*(n.y-e.y):void 0}},moveStateManager:n,enable:!0,assignEvents:()=>{}}),this.map=e,a.addEventListener(i,"mousedown",this.mousedown),a.addEventListener(i,"touchstart",this.touchstart,{passive:!1}),a.addEventListener(i,"touchcancel",this.reset)}startMove(e,t){this._rotatePitchHanlder.dragStart(e,t),a.disableDrag()}move(e,t){const i=this.map,{bearingDelta:r,pitchDelta:n}=this._rotatePitchHanlder.dragMove(e,t)||{};r&&i.setBearing(i.getBearing()+r),n&&i.setPitch(i.getPitch()+n)}off(){const e=this.element;a.removeEventListener(e,"mousedown",this.mousedown),a.removeEventListener(e,"touchstart",this.touchstart,{passive:!1}),a.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),a.removeEventListener(window,"touchend",this.touchend),a.removeEventListener(e,"touchcancel",this.reset),this.offTemp()}offTemp(){a.enableDrag(),a.removeEventListener(window,"mousemove",this.mousemove),a.removeEventListener(window,"mouseup",this.mouseup),a.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),a.removeEventListener(window,"touchend",this.touchend)}}let No;function Qo(e,i,r,n=!1){if(n||!r.getCoveringTilesDetailsProvider().allowWorldCopies())return null==e?void 0:e.wrap();const o=new t.Q(e.lng,e.lat);if(e=new t.Q(e.lng,e.lat),i){const n=new t.Q(e.lng-360,e.lat),o=new t.Q(e.lng+360,e.lat),s=r.locationToScreenPoint(e).distSqr(i);r.locationToScreenPoint(n).distSqr(i)<s?e=n:r.locationToScreenPoint(o).distSqr(i)<s&&(e=o)}for(;Math.abs(e.lng-r.center.lng)>180;){const t=r.locationToScreenPoint(e);if(t.x>=0&&t.y>=0&&t.x<=r.width&&t.y<=r.height)break;e.lng>r.center.lng?e.lng-=360:e.lng+=360}return e.lng!==o.lng&&r.isPointOnMapSurface(r.locationToScreenPoint(e))?e:o}const jo={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Vo(e,t,i){const r=e.classList;for(const e in jo)r.remove(`maplibregl-${i}-anchor-${e}`);r.add(`maplibregl-${i}-anchor-${t}`)}class Ho extends t.E{constructor(e){if(super(),this._onKeyPress=e=>{const t=e.code,i=e.charCode||e.keyCode;"Space"!==t&&"Enter"!==t&&32!==i&&13!==i||this.togglePopup()},this._onMapClick=e=>{const t=e.originalEvent.target,i=this._element;this._popup&&(t===i||i.contains(t))&&this.togglePopup()},this._update=e=>{if(!this._map)return;const t=this._map.loaded()&&!this._map.isMoving();("terrain"===(null==e?void 0:e.type)||"render"===(null==e?void 0:e.type)&&!t)&&this._map.once("render",this._update),this._lngLat=Qo(this._lngLat,this._flatPos,this._map.transform),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let i="";"viewport"===this._rotationAlignment||"auto"===this._rotationAlignment?i=`rotateZ(${this._rotation}deg)`:"map"===this._rotationAlignment&&(i=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let r="";"viewport"===this._pitchAlignment||"auto"===this._pitchAlignment?r="rotateX(0deg)":"map"===this._pitchAlignment&&(r=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||e&&"moveend"!==e.type||(this._pos=this._pos.round()),a.setTransform(this._element,`${jo[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${r} ${i}`),s.frameAsync(new AbortController).then((()=>{this._updateOpacity(e&&"moveend"===e.type)})).catch((()=>{}))},this._onMove=e=>{if(!this._isDragging){const t=this._clickTolerance||this._map._clickTolerance;this._isDragging=e.point.dist(this._pointerdownPos)>=t}this._isDragging&&(this._pos=e.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new t.l("dragstart"))),this.fire(new t.l("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),"active"===this._state&&this.fire(new t.l("dragend")),this._state="inactive"},this._addDragHandler=e=>{this._element.contains(e.originalEvent.target)&&(e.preventDefault(),this._positionDelta=e.point.sub(this._pos).add(this._offset),this._pointerdownPos=e.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._subpixelPositioning=e&&e.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&"auto"!==e.pitchAlignment?e.pitchAlignment:this._rotationAlignment,this.setOpacity(null==e?void 0:e.opacity,null==e?void 0:e.opacityWhenCovered),e&&e.element)this._element=e.element,this._offset=t.P.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=a.create("div");const i=a.createNS("http://www.w3.org/2000/svg","svg"),r=41,n=27;i.setAttributeNS(null,"display","block"),i.setAttributeNS(null,"height",`${r}px`),i.setAttributeNS(null,"width",`${n}px`),i.setAttributeNS(null,"viewBox",`0 0 ${n} ${r}`);const o=a.createNS("http://www.w3.org/2000/svg","g");o.setAttributeNS(null,"stroke","none"),o.setAttributeNS(null,"stroke-width","1"),o.setAttributeNS(null,"fill","none"),o.setAttributeNS(null,"fill-rule","evenodd");const s=a.createNS("http://www.w3.org/2000/svg","g");s.setAttributeNS(null,"fill-rule","nonzero");const l=a.createNS("http://www.w3.org/2000/svg","g");l.setAttributeNS(null,"transform","translate(3.0, 29.0)"),l.setAttributeNS(null,"fill","#000000");const c=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const e of c){const t=a.createNS("http://www.w3.org/2000/svg","ellipse");t.setAttributeNS(null,"opacity","0.04"),t.setAttributeNS(null,"cx","10.5"),t.setAttributeNS(null,"cy","5.80029008"),t.setAttributeNS(null,"rx",e.rx),t.setAttributeNS(null,"ry",e.ry),l.appendChild(t)}const u=a.createNS("http://www.w3.org/2000/svg","g");u.setAttributeNS(null,"fill",this._color);const h=a.createNS("http://www.w3.org/2000/svg","path");h.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),u.appendChild(h);const d=a.createNS("http://www.w3.org/2000/svg","g");d.setAttributeNS(null,"opacity","0.25"),d.setAttributeNS(null,"fill","#000000");const p=a.createNS("http://www.w3.org/2000/svg","path");p.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),d.appendChild(p);const f=a.createNS("http://www.w3.org/2000/svg","g");f.setAttributeNS(null,"transform","translate(6.0, 7.0)"),f.setAttributeNS(null,"fill","#FFFFFF");const A=a.createNS("http://www.w3.org/2000/svg","g");A.setAttributeNS(null,"transform","translate(8.0, 8.0)");const m=a.createNS("http://www.w3.org/2000/svg","circle");m.setAttributeNS(null,"fill","#000000"),m.setAttributeNS(null,"opacity","0.25"),m.setAttributeNS(null,"cx","5.5"),m.setAttributeNS(null,"cy","5.5"),m.setAttributeNS(null,"r","5.4999962");const g=a.createNS("http://www.w3.org/2000/svg","circle");g.setAttributeNS(null,"fill","#FFFFFF"),g.setAttributeNS(null,"cx","5.5"),g.setAttributeNS(null,"cy","5.5"),g.setAttributeNS(null,"r","5.4999962"),A.appendChild(m),A.appendChild(g),s.appendChild(l),s.appendChild(u),s.appendChild(d),s.appendChild(f),s.appendChild(A),i.appendChild(s),i.setAttributeNS(null,"height",r*this._scale+"px"),i.setAttributeNS(null,"width",n*this._scale+"px"),this._element.appendChild(i),this._offset=t.P.convert(e&&e.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",(e=>{e.preventDefault()})),this._element.addEventListener("mousedown",(e=>{e.preventDefault()})),Vo(this._element,this._anchor,"marker"),e&&e.className)for(const t of e.className.split(" "))this._element.classList.add(t);this._popup=null}addTo(e){return this.remove(),this._map=e,this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label",e._getUIString("Marker.Title")),e.getCanvasContainer().appendChild(this._element),e.on("move",this._update),e.on("moveend",this._update),e.on("terrain",this._update),e.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),a.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=t.Q.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){const t=38.1,i=13.5,r=Math.abs(i)/Math.SQRT2;e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[r,-1*(t-i+r)],"bottom-right":[-r,-1*(t-i+r)],left:[i,-1*(t-i)],right:[-13.5,-1*(t-i)]}:this._offset}this._popup=e,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(e){return this._subpixelPositioning=e,this}getPopup(){return this._popup}togglePopup(){const e=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:e?(e.isOpen()?e.remove():(e.setLngLat(this._lngLat),e.addTo(this._map)),this):this}_updateOpacity(e=!1){var i,r;if(!(null===(i=this._map)||void 0===i?void 0:i.terrain)){const e=this._map.transform.isLocationOccluded(this._lngLat)?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==e&&(this._element.style.opacity=e))}if(e)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout((()=>{this._opacityTimeout=null}),100)}const n=this._map,o=n.terrain.depthAtPoint(this._pos),s=n.terrain.getElevationForLngLatZoom(this._lngLat,n.transform.tileZoom);if(n.transform.lngLatToCameraDepth(this._lngLat,s)-o<.006)return void(this._element.style.opacity=this._opacity);const a=-this._offset.y/n.transform.pixelsPerMeter,l=Math.sin(n.getPitch()*Math.PI/180)*a,c=n.terrain.depthAtPoint(new t.P(this._pos.x,this._pos.y-this._offset.y)),u=n.transform.lngLatToCameraDepth(this._lngLat,s+l)-c>.006;(null===(r=this._popup)||void 0===r?void 0:r.isOpen())&&u&&this._popup.remove(),this._element.style.opacity=u?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(e){return this._offset=t.P.convert(e),this._update(),this}addClassName(e){this._element.classList.add(e)}removeClassName(e){this._element.classList.remove(e)}toggleClassName(e){return this._element.classList.toggle(e)}setDraggable(e){return this._draggable=!!e,this._map&&(e?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e&&"auto"!==e?e:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(e,t){return(void 0===this._opacity||void 0===e&&void 0===t)&&(this._opacity="1",this._opacityWhenCovered="0.2"),void 0!==e&&(this._opacity=e),void 0!==t&&(this._opacityWhenCovered=t),this._map&&this._updateOpacity(!0),this}}const Go={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let $o=0,Zo=!1;const qo={maxWidth:100,unit:"metric"};function Ko(e,t,i){const r=i&&i.maxWidth||100,n=e._container.clientHeight/2,o=e._container.clientWidth/2,s=e.unproject([o-r/2,n]),a=e.unproject([o+r/2,n]),l=Math.round(e.project(a).x-e.project(s).x),c=Math.min(r,l,e._container.clientWidth),u=s.distanceTo(a);if(i&&"imperial"===i.unit){const i=3.2808*u;i>5280?Wo(t,c,i/5280,e._getUIString("ScaleControl.Miles")):Wo(t,c,i,e._getUIString("ScaleControl.Feet"))}else i&&"nautical"===i.unit?Wo(t,c,u/1852,e._getUIString("ScaleControl.NauticalMiles")):u>=1e3?Wo(t,c,u/1e3,e._getUIString("ScaleControl.Kilometers")):Wo(t,c,u,e._getUIString("ScaleControl.Meters"))}function Wo(e,t,i,r){const n=function(e){const t=Math.pow(10,`${Math.floor(e)}`.length-1);let i=e/t;return i=i>=10?10:i>=5?5:i>=3?3:i>=2?2:i>=1?1:function(e){const t=Math.pow(10,Math.ceil(-Math.log(e)/Math.LN10));return Math.round(e*t)/t}(i),t*i}(i);e.style.width=t*(n/i)+"px",e.innerHTML=`${n}&nbsp;${r}`}const Xo={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1,locationOccludedOpacity:void 0},Yo=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Jo(e){if(e){if("number"==typeof e){const i=Math.round(Math.abs(e)/Math.SQRT2);return{center:new t.P(0,0),top:new t.P(0,e),"top-left":new t.P(i,i),"top-right":new t.P(-i,i),bottom:new t.P(0,-e),"bottom-left":new t.P(i,-i),"bottom-right":new t.P(-i,-i),left:new t.P(e,0),right:new t.P(-e,0)}}if(e instanceof t.P||Array.isArray(e)){const i=t.P.convert(e);return{center:i,top:i,"top-left":i,"top-right":i,bottom:i,"bottom-left":i,"bottom-right":i,left:i,right:i}}return{center:t.P.convert(e.center||[0,0]),top:t.P.convert(e.top||[0,0]),"top-left":t.P.convert(e["top-left"]||[0,0]),"top-right":t.P.convert(e["top-right"]||[0,0]),bottom:t.P.convert(e.bottom||[0,0]),"bottom-left":t.P.convert(e["bottom-left"]||[0,0]),"bottom-right":t.P.convert(e["bottom-right"]||[0,0]),left:t.P.convert(e.left||[0,0]),right:t.P.convert(e.right||[0,0])}}return Jo(new t.P(0,0))}const es=i;e.AJAXError=t.co,e.Event=t.l,e.Evented=t.E,e.LngLat=t.Q,e.MercatorCoordinate=t.$,e.Point=t.P,e.addProtocol=t.cp,e.config=t.a,e.removeProtocol=t.cq,e.AttributionControl=Co,e.BoxZoomHandler=Qn,e.CanvasSource=Y,e.CooperativeGesturesHandler=yo,e.DoubleClickZoomHandler=po,e.DragPanHandler=mo,e.DragRotateHandler=go,e.EdgeInsets=St,e.FullscreenControl=class extends t.E{constructor(e={}){super(),this._onFullscreenChange=()=>{var e;let t=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;null===(e=null==t?void 0:t.shadowRoot)||void 0===e?void 0:e.fullscreenElement;)t=t.shadowRoot.fullscreenElement;t===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,e&&e.container&&(e.container instanceof HTMLElement?this._container=e.container:t.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(e){return this._map=e,this._container||(this._container=this._map.getContainer()),this._controlContainer=a.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){a.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const e=this._fullscreenButton=a.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);a.create("span","maplibregl-ctrl-icon",e).setAttribute("aria-hidden","true"),e.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const e=this._getTitle();this._fullscreenButton.setAttribute("aria-label",e),this._fullscreenButton.title=e}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new t.l("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new t.l("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},e.GeoJSONSource=K,e.GeolocateControl=class extends t.E{constructor(e){super(),this._onSuccess=e=>{if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new t.l("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(e),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new t.l("geolocate",e)),this._finish()}},this._updateCamera=e=>{const i=new t.Q(e.coords.longitude,e.coords.latitude),r=e.coords.accuracy,n=this._map.getBearing(),o=t.e({bearing:n},this.options.fitBoundsOptions),s=H.fromLngLat(i,r);this._map.fitBounds(s,o,{geolocateSource:!0})},this._updateMarker=e=>{if(e){const i=new t.Q(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(i).addTo(this._map),this._userLocationDotMarker.setLngLat(i).addTo(this._map),this._accuracy=e.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=e=>{if(this._map){if(this.options.trackUserLocation)if(1===e.code){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const e=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=e,this._geolocateButton.setAttribute("aria-label",e),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===e.code&&Zo)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new t.l("error",e)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",(e=>e.preventDefault())),this._geolocateButton=a.create("button","maplibregl-ctrl-geolocate",this._container),a.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=e=>{if(this._map){if(!1===e){t.w("Geolocation support is not available so the GeolocateControl will be disabled.");const e=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=e,this._geolocateButton.setAttribute("aria-label",e)}else{const e=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=e,this._geolocateButton.setAttribute("aria-label",e)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=a.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Ho({element:this._dotElement}),this._circleElement=a.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Ho({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",(()=>this.trigger())),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(e=>{e.geolocateSource||"ACTIVE_LOCK"!==this._watchState||e.originalEvent&&"resize"===e.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new t.l("trackuserlocationend")),this.fire(new t.l("userlocationlostfocus")))}))}},this.options=t.e({},Go,e)}onAdd(e){return this._map=e,this._container=a.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),function(){return t._(this,arguments,void 0,(function*(e=!1){if(void 0!==No&&!e)return No;if(void 0===window.navigator.permissions)return No=!!window.navigator.geolocation,No;try{const e=yield window.navigator.permissions.query({name:"geolocation"});No="denied"!==e.state}catch(e){No=!!window.navigator.geolocation}return No}))}().then((e=>this._finishSetupUI(e))),this._container}onRemove(){void 0!==this._geolocationWatchID&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),a.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,$o=0,Zo=!1}_isOutOfMapMaxBounds(e){const t=this._map.getMaxBounds(),i=e.coords;return t&&(i.longitude<t.getWest()||i.longitude>t.getEast()||i.latitude<t.getSouth()||i.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const e=this._map.getBounds(),t=e.getSouthEast(),i=e.getNorthEast(),r=t.distanceTo(i),n=Math.ceil(this._accuracy/(r/this._map._container.clientHeight)*2);this._circleElement.style.width=`${n}px`,this._circleElement.style.height=`${n}px`}trigger(){if(!this._setup)return t.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new t.l("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":$o--,Zo=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new t.l("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new t.l("trackuserlocationstart")),this.fire(new t.l("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let e;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),$o++,$o>1?(e={maximumAge:6e5,timeout:0},Zo=!0):(e=this.options.positionOptions,Zo=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,e)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},e.GlobeControl=class{constructor(){this._toggleProjection=()=>{var e;const t=null===(e=this._map.getProjection())||void 0===e?void 0:e.type;this._map.setProjection("mercator"!==t&&t?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var e;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),"globe"===(null===(e=this._map.getProjection())||void 0===e?void 0:e.type)?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(e){return this._map=e,this._container=a.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=a.create("button","maplibregl-ctrl-globe",this._container),a.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){a.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},e.Hash=Bn,e.ImageSource=W,e.KeyboardHandler=lo,e.LngLatBounds=H,e.LogoControl=So,e.Map=class extends To{constructor(e){var i,r;t.cl.mark(t.cm.create);const n=Object.assign(Object.assign(Object.assign({},Do),e),{canvasContextAttributes:Object.assign(Object.assign({},Do.canvasContextAttributes),e.canvasContextAttributes)});if(null!=n.minZoom&&null!=n.maxZoom&&n.minZoom>n.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=n.minPitch&&null!=n.maxPitch&&n.minPitch>n.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=n.minPitch&&n.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=n.maxPitch&&n.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");const o=new kt,s=new Ot;if(void 0!==n.minZoom&&o.setMinZoom(n.minZoom),void 0!==n.maxZoom&&o.setMaxZoom(n.maxZoom),void 0!==n.minPitch&&o.setMinPitch(n.minPitch),void 0!==n.maxPitch&&o.setMaxPitch(n.maxPitch),void 0!==n.renderWorldCopies&&o.setRenderWorldCopies(n.renderWorldCopies),super(o,s,{bearingSnap:n.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new Eo,this._controls=[],this._mapId=t.a4(),this._contextLost=e=>{e.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new t.l("webglcontextlost",{originalEvent:e}))},this._contextRestored=e=>{this._setupPainter(),this.resize(),this._update(),this.fire(new t.l("webglcontextrestored",{originalEvent:e}))},this._onMapScroll=e=>{if(e.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=n.interactive,this._maxTileCacheSize=n.maxTileCacheSize,this._maxTileCacheZoomLevels=n.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},n.canvasContextAttributes),this._trackResize=!0===n.trackResize,this._bearingSnap=n.bearingSnap,this._centerClampedToGround=n.centerClampedToGround,this._refreshExpiredTiles=!0===n.refreshExpiredTiles,this._fadeDuration=n.fadeDuration,this._crossSourceCollisions=!0===n.crossSourceCollisions,this._collectResourceTiming=!0===n.collectResourceTiming,this._locale=Object.assign(Object.assign({},zo),n.locale),this._clickTolerance=n.clickTolerance,this._overridePixelRatio=n.pixelRatio,this._maxCanvasSize=n.maxCanvasSize,this.transformCameraUpdate=n.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=!0===n.cancelPendingTileRequestsWhileZooming,this._imageQueueHandle=f.addThrottleControl((()=>this.isMoving())),this._requestManager=new A(n.transformRequest),"string"==typeof n.container){if(this._container=document.getElementById(n.container),!this._container)throw new Error(`Container '${n.container}' not found.`)}else{if(!(n.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=n.container}if(n.maxBounds&&this.setMaxBounds(n.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),this.on("terrain",(()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)})),this.once("idle",(()=>{this._idleTriggered=!0})),"undefined"!=typeof window){addEventListener("online",this._onWindowOnline,!1);let e=!1;const t=Tn((e=>{this._trackResize&&!this._removed&&(this.resize(e),this.redraw())}),50);this._resizeObserver=new ResizeObserver((i=>{e?t(i):e=!0})),this._resizeObserver.observe(this._container)}this.handlers=new wo(this,n),this._hash=n.hash&&new Bn("string"==typeof n.hash&&n.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:n.center,elevation:n.elevation,zoom:n.zoom,bearing:n.bearing,pitch:n.pitch,roll:n.roll}),n.bounds&&(this.resize(),this.fitBounds(n.bounds,t.e({},n.fitBoundsOptions,{duration:0}))));const a="string"==typeof n.style||!("globe"===(null===(r=null===(i=n.style)||void 0===i?void 0:i.projection)||void 0===r?void 0:r.type));this.resize(null,a),this._localIdeographFontFamily=n.localIdeographFontFamily,this._validateStyle=n.validateStyle,n.style&&this.setStyle(n.style,{localIdeographFontFamily:n.localIdeographFontFamily}),n.attributionControl&&this.addControl(new Co("boolean"==typeof n.attributionControl?void 0:n.attributionControl)),n.maplibreLogo&&this.addControl(new So,n.logoPosition),this.on("style.load",(()=>{if(a||this._resizeTransform(),this.transform.unmodified){const e=t.O(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(e)}})),this.on("data",(e=>{this._update("style"===e.dataType),this.fire(new t.l(`${e.dataType}data`,e))})),this.on("dataloading",(e=>{this.fire(new t.l(`${e.dataType}dataloading`,e))})),this.on("dataabort",(e=>{this.fire(new t.l("sourcedataabort",e))}))}_getMapId(){return this._mapId}addControl(e,i){if(void 0===i&&(i=e.getDefaultPosition?e.getDefaultPosition():"top-right"),!e||!e.onAdd)return this.fire(new t.k(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const r=e.onAdd(this);this._controls.push(e);const n=this._controlPositions[i];return-1!==i.indexOf("bottom")?n.insertBefore(r,n.firstChild):n.appendChild(r),this}removeControl(e){if(!e||!e.onRemove)return this.fire(new t.k(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const i=this._controls.indexOf(e);return i>-1&&this._controls.splice(i,1),e.onRemove(this),this}hasControl(e){return this._controls.indexOf(e)>-1}calculateCameraOptionsFromTo(e,t,i,r){return null==r&&this.terrain&&(r=this.terrain.getElevationForLngLatZoom(i,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(e,t,i,r)}resize(e,i=!0){const[r,n]=this._containerDimensions(),o=this._getClampedPixelRatio(r,n);if(this._resizeCanvas(r,n,o),this.painter.resize(r,n,o),this.painter.overLimit()){const e=this.painter.context.gl;this._maxCanvasSize=[e.drawingBufferWidth,e.drawingBufferHeight];const t=this._getClampedPixelRatio(r,n);this._resizeCanvas(r,n,t),this.painter.resize(r,n,t)}this._resizeTransform(i);const s=!this._moving;return s&&(this.stop(),this.fire(new t.l("movestart",e)).fire(new t.l("move",e))),this.fire(new t.l("resize",e)),s&&this.fire(new t.l("moveend",e)),this}_resizeTransform(e=!0){var t;const[i,r]=this._containerDimensions();this.transform.resize(i,r,e),null===(t=this._requestedCameraState)||void 0===t||t.resize(i,r,e)}_getClampedPixelRatio(e,t){const{0:i,1:r}=this._maxCanvasSize,n=this.getPixelRatio(),o=e*n,s=t*n;return Math.min(o>i?i/o:1,s>r?r/s:1)*n}getPixelRatio(){var e;return null!==(e=this._overridePixelRatio)&&void 0!==e?e:devicePixelRatio}setPixelRatio(e){this._overridePixelRatio=e,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(e){return this.transform.setMaxBounds(H.convert(e)),this._update()}setMinZoom(e){if((e=null==e?-2:e)>=-2&&e<=this.transform.maxZoom)return this.transform.setMinZoom(e),this._update(),this.getZoom()<e&&this.setZoom(e),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(e){if((e=null==e?22:e)>=this.transform.minZoom)return this.transform.setMaxZoom(e),this._update(),this.getZoom()>e&&this.setZoom(e),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(e){if((e=null==e?0:e)<0)throw new Error("minPitch must be greater than or equal to 0");if(e>=0&&e<=this.transform.maxPitch)return this.transform.setMinPitch(e),this._update(),this.getPitch()<e&&this.setPitch(e),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(e){if((e=null==e?60:e)>180)throw new Error("maxPitch must be less than or equal to 180");if(e>=this.transform.minPitch)return this.transform.setMaxPitch(e),this._update(),this.getPitch()>e&&this.setPitch(e),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(e){return this.transform.setRenderWorldCopies(e),this._update()}project(e){return this.transform.locationToScreenPoint(t.Q.convert(e),this.style&&this.terrain)}unproject(e){return this.transform.screenPointToLocation(t.P.convert(e),this.terrain)}isMoving(){var e;return this._moving||(null===(e=this.handlers)||void 0===e?void 0:e.isMoving())}isZooming(){var e;return this._zooming||(null===(e=this.handlers)||void 0===e?void 0:e.isZooming())}isRotating(){var e;return this._rotating||(null===(e=this.handlers)||void 0===e?void 0:e.isRotating())}_createDelegatedListener(e,t,i){if("mouseenter"===e||"mouseover"===e){let r=!1;const n=n=>{const o=t.filter((e=>this.getLayer(e))),s=0!==o.length?this.queryRenderedFeatures(n.point,{layers:o}):[];s.length?r||(r=!0,i.call(this,new zn(e,this,n.originalEvent,{features:s}))):r=!1};return{layers:t,listener:i,delegates:{mousemove:n,mouseout:()=>{r=!1}}}}if("mouseleave"===e||"mouseout"===e){let r=!1;const n=n=>{const o=t.filter((e=>this.getLayer(e)));(0!==o.length?this.queryRenderedFeatures(n.point,{layers:o}):[]).length?r=!0:r&&(r=!1,i.call(this,new zn(e,this,n.originalEvent)))},o=t=>{r&&(r=!1,i.call(this,new zn(e,this,t.originalEvent)))};return{layers:t,listener:i,delegates:{mousemove:n,mouseout:o}}}{const r=e=>{const r=t.filter((e=>this.getLayer(e))),n=0!==r.length?this.queryRenderedFeatures(e.point,{layers:r}):[];n.length&&(e.features=n,i.call(this,e),delete e.features)};return{layers:t,listener:i,delegates:{[e]:r}}}}_saveDelegatedListener(e,t){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[e]=this._delegatedListeners[e]||[],this._delegatedListeners[e].push(t)}_removeDelegatedListener(e,t,i){if(!this._delegatedListeners||!this._delegatedListeners[e])return;const r=this._delegatedListeners[e];for(let e=0;e<r.length;e++){const n=r[e];if(n.listener===i&&n.layers.length===t.length&&n.layers.every((e=>t.includes(e)))){for(const e in n.delegates)this.off(e,n.delegates[e]);return void r.splice(e,1)}}}on(e,t,i){if(void 0===i)return super.on(e,t);const r="string"==typeof t?[t]:t,n=this._createDelegatedListener(e,r,i);this._saveDelegatedListener(e,n);for(const e in n.delegates)this.on(e,n.delegates[e]);return{unsubscribe:()=>{this._removeDelegatedListener(e,r,i)}}}once(e,t,i){if(void 0===i)return super.once(e,t);const r="string"==typeof t?[t]:t,n=this._createDelegatedListener(e,r,i);for(const t in n.delegates){const o=n.delegates[t];n.delegates[t]=(...t)=>{this._removeDelegatedListener(e,r,i),o(...t)}}this._saveDelegatedListener(e,n);for(const e in n.delegates)this.once(e,n.delegates[e]);return this}off(e,t,i){return void 0===i?super.off(e,t):(this._removeDelegatedListener(e,"string"==typeof t?[t]:t,i),this)}queryRenderedFeatures(e,i){if(!this.style)return[];let r;const n=e instanceof t.P||Array.isArray(e),o=n?e:[[0,0],[this.transform.width,this.transform.height]];if(i=i||(n?{}:e)||{},o instanceof t.P||"number"==typeof o[0])r=[t.P.convert(o)];else{const e=t.P.convert(o[0]),i=t.P.convert(o[1]);r=[e,new t.P(i.x,e.y),i,new t.P(e.x,i.y),e]}return this.style.queryRenderedFeatures(r,i,this.transform)}querySourceFeatures(e,t){return this.style.querySourceFeatures(e,t)}setStyle(e,i){return!1!==(i=t.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},i)).diff&&i.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&e?(this._diffStyle(e,i),this):(this._localIdeographFontFamily=i.localIdeographFontFamily,this._updateStyle(e,i))}setTransformRequest(e){return this._requestManager.setTransformRequest(e),this}_getUIString(e){const t=this._locale[e];if(null==t)throw new Error(`Missing UI string '${e}'`);return t}_updateStyle(e,t){var i,r;if(t.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",(()=>this._updateStyle(e,t)));const n=this.style&&t.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!e)),e?(this.style=new vi(this,t||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof e?this.style.loadURL(e,t,n):this.style.loadJSON(e,t,n),this):(null===(r=null===(i=this.style)||void 0===i?void 0:i.projection)||void 0===r||r.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new vi(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(e,i){if("string"==typeof e){const r=this._requestManager.transformRequest(e,"Style");t.j(r,new AbortController).then((e=>{this._updateDiff(e.data,i)})).catch((e=>{e&&this.fire(new t.k(e))}))}else"object"==typeof e&&this._updateDiff(e,i)}_updateDiff(e,i){try{this.style.setState(e,i)&&this._update(!0)}catch(r){t.w(`Unable to perform style diff: ${r.message||r.error||r}.  Rebuilding the style from scratch.`),this._updateStyle(e,i)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():t.w("There is no style added to the map.")}addSource(e,t){return this._lazyInitEmptyStyle(),this.style.addSource(e,t),this._update(!0)}isSourceLoaded(e){const i=this.style&&this.style.sourceCaches[e];if(void 0!==i)return i.loaded();this.fire(new t.k(new Error(`There is no source with ID '${e}'`)))}setTerrain(e){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),e){const i=this.style.sourceCaches[e.source];if(!i)throw new Error(`cannot load terrain, because there exists no source with ID: ${e.source}`);null===this.terrain&&i.reload();for(const i in this.style._layers){const r=this.style._layers[i];"hillshade"===r.type&&r.source===e.source&&t.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Po(this.painter,i,e),this.painter.renderToTexture=new ko(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=t=>{var i;"style"===t.dataType?this.terrain.sourceCache.freeRtt():"source"===t.dataType&&t.tile&&(t.sourceId!==e.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),"image"===(null===(i=t.source)||void 0===i?void 0:i.type)?this.terrain.sourceCache.freeRtt():this.terrain.sourceCache.freeRtt(t.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new t.l("terrain",{terrain:e})),this}getTerrain(){var e,t;return null!==(t=null===(e=this.terrain)||void 0===e?void 0:e.options)&&void 0!==t?t:null}areTilesLoaded(){const e=this.style&&this.style.sourceCaches;for(const t in e){const i=e[t]._tiles;for(const e in i){const t=i[e];if("loaded"!==t.state&&"errored"!==t.state)return!1}}return!0}removeSource(e){return this.style.removeSource(e),this._update(!0)}getSource(e){return this.style.getSource(e)}setSourceTileLodParams(e,t,i){if(i){const r=this.getSource(i);if(!r)throw new Error(`There is no source with ID "${i}", cannot set LOD parameters`);r.calculateTileZoom=me(Math.max(1,e),Math.max(1,t))}else for(const i in this.style.sourceCaches)this.style.sourceCaches[i].getSource().calculateTileZoom=me(Math.max(1,e),Math.max(1,t));return this._update(!0),this}addImage(e,i,r={}){const{pixelRatio:n=1,sdf:o=!1,stretchX:a,stretchY:l,content:c,textFitWidth:u,textFitHeight:h}=r;if(this._lazyInitEmptyStyle(),!(i instanceof HTMLImageElement||t.b(i))){if(void 0===i.width||void 0===i.height)return this.fire(new t.k(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:r,height:s,data:d}=i,p=i;return this.style.addImage(e,{data:new t.R({width:r,height:s},new Uint8Array(d)),pixelRatio:n,stretchX:a,stretchY:l,content:c,textFitWidth:u,textFitHeight:h,sdf:o,version:0,userImage:p}),p.onAdd&&p.onAdd(this,e),this}}{const{width:r,height:d,data:p}=s.getImageData(i);this.style.addImage(e,{data:new t.R({width:r,height:d},p),pixelRatio:n,stretchX:a,stretchY:l,content:c,textFitWidth:u,textFitHeight:h,sdf:o,version:0})}}updateImage(e,i){const r=this.style.getImage(e);if(!r)return this.fire(new t.k(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const n=i instanceof HTMLImageElement||t.b(i)?s.getImageData(i):i,{width:o,height:a,data:l}=n;if(void 0===o||void 0===a)return this.fire(new t.k(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(o!==r.data.width||a!==r.data.height)return this.fire(new t.k(new Error("The width and height of the updated image must be that same as the previous version of the image")));const c=!(i instanceof HTMLImageElement||t.b(i));return r.data.replace(l,c),this.style.updateImage(e,r),this}getImage(e){return this.style.getImage(e)}hasImage(e){return e?!!this.style.getImage(e):(this.fire(new t.k(new Error("Missing required image id"))),!1)}removeImage(e){this.style.removeImage(e)}loadImage(e){return f.getImage(this._requestManager.transformRequest(e,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(e,t){return this._lazyInitEmptyStyle(),this.style.addLayer(e,t),this._update(!0)}moveLayer(e,t){return this.style.moveLayer(e,t),this._update(!0)}removeLayer(e){return this.style.removeLayer(e),this._update(!0)}getLayer(e){return this.style.getLayer(e)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(e,t,i){return this.style.setLayerZoomRange(e,t,i),this._update(!0)}setFilter(e,t,i={}){return this.style.setFilter(e,t,i),this._update(!0)}getFilter(e){return this.style.getFilter(e)}setPaintProperty(e,t,i,r={}){return this.style.setPaintProperty(e,t,i,r),this._update(!0)}getPaintProperty(e,t){return this.style.getPaintProperty(e,t)}setLayoutProperty(e,t,i,r={}){return this.style.setLayoutProperty(e,t,i,r),this._update(!0)}getLayoutProperty(e,t){return this.style.getLayoutProperty(e,t)}setGlyphs(e,t={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(e,t),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(e,t,i={}){return this._lazyInitEmptyStyle(),this.style.addSprite(e,t,i,(e=>{e||this._update(!0)})),this}removeSprite(e){return this._lazyInitEmptyStyle(),this.style.removeSprite(e),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(e,t={}){return this._lazyInitEmptyStyle(),this.style.setSprite(e,t,(e=>{e||this._update(!0)})),this}setLight(e,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(e,t),this._update(!0)}getLight(){return this.style.getLight()}setSky(e,t={}){return this._lazyInitEmptyStyle(),this.style.setSky(e,t),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(e,t){return this.style.setFeatureState(e,t),this._update()}removeFeatureState(e,t){return this.style.removeFeatureState(e,t),this._update()}getFeatureState(e){return this.style.getFeatureState(e)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let e=0,t=0;return this._container&&(e=this._container.clientWidth||400,t=this._container.clientHeight||300),[e,t]}_setupContainer(){const e=this._container;e.classList.add("maplibregl-map");const t=this._canvasContainer=a.create("div","maplibregl-canvas-container",e);this._interactive&&t.classList.add("maplibregl-interactive"),this._canvas=a.create("canvas","maplibregl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const i=this._containerDimensions(),r=this._getClampedPixelRatio(i[0],i[1]);this._resizeCanvas(i[0],i[1],r);const n=this._controlContainer=a.create("div","maplibregl-control-container",e),o=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((e=>{o[e]=a.create("div",`maplibregl-ctrl-${e} `,n)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(e,t,i){this._canvas.width=Math.floor(i*e),this._canvas.height=Math.floor(i*t),this._canvas.style.width=`${e}px`,this._canvas.style.height=`${t}px`}_setupPainter(){const e=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0});let t=null;this._canvas.addEventListener("webglcontextcreationerror",(i=>{t={requestedAttributes:e},i&&(t.statusMessage=i.statusMessage,t.type=i.type)}),{once:!0});let i=null;if(i=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,e):this._canvas.getContext("webgl2",e)||this._canvas.getContext("webgl",e),!i){const e="Failed to initialize WebGL";throw t?(t.message=e,new Error(JSON.stringify(t))):new Error(e)}this.painter=new wn(i,this.transform),l.testSupport(i)}migrateProjection(e,i){super.migrateProjection(e,i),this.painter.transform=e,this.fire(new t.l("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(e){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||e,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(e){return this._update(),this._renderTaskQueue.add(e)}_cancelRenderFrame(e){this._renderTaskQueue.remove(e)}_render(e){var i,r,n,o,a;const l=this._idleTriggered?this._fadeDuration:0,c=(null===(i=this.style.projection)||void 0===i?void 0:i.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(e),this._removed)return;let u=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const e=this.transform.zoom,i=s.now();this.style.zoomHistory.update(e,i);const r=new t.C(e,{now:i,fadeDuration:l,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),n=r.crossFadingFactor();1===n&&n===this._crossFadingFactor||(u=!0,this._crossFadingFactor=n),this.style.update(r)}const h=(null===(r=this.style.projection)||void 0===r?void 0:r.transitionState)>0!==c;null===(n=this.style.projection)||void 0===n||n.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState(null===(o=this.style.projection)||void 0===o?void 0:o.transitionState,null===(a=this.style.projection)||void 0===a?void 0:a.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||h)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,l,this._crossSourceCollisions,h),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:l,showPadding:this.showPadding}),this.fire(new t.l("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,t.cl.mark(t.cm.load),this.fire(new t.l("load"))),this.style&&(this.style.hasTransitions()||u)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const d=this._sourcesDirty||this._styleDirty||this._placementDirty;return d||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new t.l("idle")),!this._loaded||this._fullyLoaded||d||(this._fullyLoaded=!0,t.cl.mark(t.cm.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var e;this._hash&&this._hash.remove();for(const e of this._controls)e.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),"undefined"!=typeof window&&removeEventListener("online",this._onWindowOnline,!1),f.removeThrottleControl(this._imageQueueHandle),null===(e=this._resizeObserver)||void 0===e||e.disconnect();const i=this.painter.context.gl.getExtension("WEBGL_lose_context");(null==i?void 0:i.loseContext)&&i.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),a.remove(this._canvasContainer),a.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),t.cl.clearMetrics(),this._removed=!0,this.fire(new t.l("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,s.frame(this._frameRequest,(e=>{t.cl.frame(e),this._frameRequest=null;try{this._render(e)}catch(e){if(!t.cn(e)&&!function(e){return e.message===jr}(e))throw e}}),(()=>{})))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(e){this._showTileBoundaries!==e&&(this._showTileBoundaries=e,this._update())}get showPadding(){return!!this._showPadding}set showPadding(e){this._showPadding!==e&&(this._showPadding=e,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(e){this._showCollisionBoxes!==e&&(this._showCollisionBoxes=e,e?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(e){this._showOverdrawInspector!==e&&(this._showOverdrawInspector=e,this._update())}get repaint(){return!!this._repaint}set repaint(e){this._repaint!==e&&(this._repaint=e,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(e){this._vertices=e,this._update()}get version(){return Ro}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(e){return this._lazyInitEmptyStyle(),this.style.setProjection(e),this._update(!0)}},e.MapMouseEvent=zn,e.MapTouchEvent=Rn,e.MapWheelEvent=Dn,e.Marker=Ho,e.NavigationControl=class{constructor(e){this._updateZoomButtons=()=>{const e=this._map.getZoom(),t=e===this._map.getMaxZoom(),i=e===this._map.getMinZoom();this._zoomInButton.disabled=t,this._zoomOutButton.disabled=i,this._zoomInButton.setAttribute("aria-disabled",t.toString()),this._zoomOutButton.setAttribute("aria-disabled",i.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(e,t)=>{const i=this._map._getUIString(`NavigationControl.${t}`);e.title=i,e.setAttribute("aria-label",i)},this.options=t.e({},Oo,e),this._container=a.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",(e=>e.preventDefault())),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",(e=>this._map.zoomIn({},{originalEvent:e}))),a.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",(e=>this._map.zoomOut({},{originalEvent:e}))),a.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",(e=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:e}):this._map.resetNorth({},{originalEvent:e})})),this._compassIcon=a.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(e){return this._map=e,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Uo(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){a.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(e,t){const i=a.create("button",e,this._container);return i.type="button",i.addEventListener("click",t),i}},e.Popup=class extends t.E{constructor(e){super(),this._updateOpacity=()=>{void 0!==this.options.locationOccludedOpacity&&(this._container.style.opacity=this._map.transform.isLocationOccluded(this.getLngLat())?`${this.options.locationOccludedOpacity}`:void 0)},this.remove=()=>(this._content&&a.remove(this._content),this._container&&(a.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new t.l("close"))),this),this._onMouseUp=e=>{this._update(e.point)},this._onMouseMove=e=>{this._update(e.point)},this._onDrag=e=>{this._update(e.point)},this._update=e=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=a.create("div","maplibregl-popup",this._map.getContainer()),this._tip=a.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const e of this.options.className.split(" "))this._container.classList.add(e);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=Qo(this._lngLat,this._flatPos,this._map.transform,this._trackPointer),this._trackPointer&&!e)return;const t=this._flatPos=this._pos=this._trackPointer&&e?e:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&e?e:this._map.transform.locationToScreenPoint(this._lngLat));let i=this.options.anchor;const r=Jo(this.options.offset);if(!i){const e=this._container.offsetWidth,n=this._container.offsetHeight;let o;o=t.y+r.bottom.y<n?["top"]:t.y>this._map.transform.height-n?["bottom"]:[],t.x<e/2?o.push("left"):t.x>this._map.transform.width-e/2&&o.push("right"),i=0===o.length?"bottom":o.join("-")}let n=t.add(r[i]);this.options.subpixelPositioning||(n=n.round()),a.setTransform(this._container,`${jo[i]} translate(${n.x}px,${n.y}px)`),Vo(this._container,i,"popup"),this._updateOpacity()},this._onClose=()=>{this.remove()},this.options=t.e(Object.create(Xo),e)}addTo(e){return this._map&&this.remove(),this._map=e,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new t.l("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=t.Q.convert(e),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(e){return this.setDOMContent(document.createTextNode(e))}setHTML(e){const t=document.createDocumentFragment(),i=document.createElement("body");let r;for(i.innerHTML=e;r=i.firstChild,r;)t.appendChild(r);return this.setDOMContent(t)}getMaxWidth(){var e;return null===(e=this._container)||void 0===e?void 0:e.style.maxWidth}setMaxWidth(e){return this.options.maxWidth=e,this._update(),this}setDOMContent(e){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=a.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(e),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(e){return this._container&&this._container.classList.add(e),this}removeClassName(e){return this._container&&this._container.classList.remove(e),this}setOffset(e){return this.options.offset=e,this._update(),this}toggleClassName(e){if(this._container)return this._container.classList.toggle(e)}setSubpixelPositioning(e){this.options.subpixelPositioning=e}_createCloseButton(){this.options.closeButton&&(this._closeButton=a.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const e=this._container.querySelector(Yo);e&&e.focus()}},e.RasterDEMTileSource=q,e.RasterTileSource=Z,e.ScaleControl=class{constructor(e){this._onMove=()=>{Ko(this._map,this._container,this.options)},this.setUnit=e=>{this.options.unit=e,Ko(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},qo),e)}getDefaultPosition(){return"bottom-left"}onAdd(e){return this._map=e,this._container=a.create("div","maplibregl-ctrl maplibregl-ctrl-scale",e.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){a.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},e.ScrollZoomHandler=ho,e.Style=vi,e.TerrainControl=class{constructor(e){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=e}onAdd(e){return this._map=e,this._container=a.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=a.create("button","maplibregl-ctrl-terrain",this._container),a.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){a.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},e.TwoFingersTouchPitchHandler=so,e.TwoFingersTouchRotateHandler=no,e.TwoFingersTouchZoomHandler=io,e.TwoFingersTouchZoomRotateHandler=_o,e.VectorTileSource=$,e.VideoSource=X,e.addSourceType=(e,i)=>t._(void 0,void 0,void 0,(function*(){if(ee(e))throw new Error(`A source type called "${e}" already exists.`);((e,t)=>{J[e]=t})(e,i)})),e.clearPrewarmedResources=function(){const e=k;e&&(e.isPreloaded()&&1===e.numActive()?(e.release(P),k=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},e.createTileMesh=Kt,e.getMaxParallelImageRequests=function(){return t.a.MAX_PARALLEL_IMAGE_REQUESTS},e.getRTLTextPluginStatus=function(){return ne().getRTLTextPluginStatus()},e.getVersion=function(){return es},e.getWorkerCount=function(){return L.workerCount},e.getWorkerUrl=function(){return t.a.WORKER_URL},e.importScriptInWorkers=function(e){return O().broadcast("IS",e)},e.prewarm=function(){R().acquire(P)},e.setMaxParallelImageRequests=function(e){t.a.MAX_PARALLEL_IMAGE_REQUESTS=e},e.setRTLTextPlugin=function(e,t){return ne().setRTLTextPlugin(e,t)},e.setWorkerCount=function(e){L.workerCount=e},e.setWorkerUrl=function(e){t.a.WORKER_URL=e}})),e}();var We=He(Ke.exports),Xe=e({__proto__:null,default:We},[Ke.exports]);const Ye=[];function Je(e,i=t){let r;const n=new Set;function o(t){if(a(e,t)&&(e=t,r)){const t=!Ye.length;for(const t of n)t[1](),Ye.push(t,e);if(t){for(let e=0;e<Ye.length;e+=2)Ye[e][0](Ye[e+1]);Ye.length=0}}}return{set:o,update:function(t){o(t(e))},subscribe:function(s,a=t){const l=[s,a];return n.add(l),1===n.size&&(r=i(o)||t),s(e),()=>{n.delete(l),0===n.size&&r&&(r(),r=null)}}}}const et=Je([]),tt=Je([]),it=Je([]),rt=Je(!0),nt=Je(!0),ot=Je([]),st=Je({}),at=e=>{if(!Array.isArray(e))return!1;const t=["id","name","type"],i=e=>{const i=Object.keys(e);return t.filter((e=>!i.includes(e))).length>0};return!(e.filter((e=>"sublist"===e.type?e.presets.every(i):i(e))).length>0)},lt=(e,t)=>Math.round(e*10**t)/10**t;var ct="Expected a function",ut=/^\s+|\s+$/g,ht=/^[-+]0x[0-9a-f]+$/i,dt=/^0b[01]+$/i,pt=/^0o[0-7]+$/i,ft=parseInt,At="object"==typeof Ve&&Ve&&Ve.Object===Object&&Ve,mt="object"==typeof self&&self&&self.Object===Object&&self,gt=At||mt||Function("return this")(),_t=Object.prototype.toString,yt=Math.max,vt=Math.min,xt=function(){return gt.Date.now()};function bt(e,t,i){var r,n,o,s,a,l,c=0,u=!1,h=!1,d=!0;if("function"!=typeof e)throw new TypeError(ct);function p(t){var i=r,o=n;return r=n=void 0,c=t,s=e.apply(o,i)}function f(e){var i=e-l;return void 0===l||i>=t||i<0||h&&e-c>=o}function A(){var e=xt();if(f(e))return m(e);a=setTimeout(A,function(e){var i=t-(e-l);return h?vt(i,o-(e-c)):i}(e))}function m(e){return a=void 0,d&&r?p(e):(r=n=void 0,s)}function g(){var e=xt(),i=f(e);if(r=arguments,n=this,l=e,i){if(void 0===a)return function(e){return c=e,a=setTimeout(A,t),u?p(e):s}(l);if(h)return a=setTimeout(A,t),p(l)}return void 0===a&&(a=setTimeout(A,t)),s}return t=Tt(t)||0,wt(i)&&(u=!!i.leading,o=(h="maxWait"in i)?yt(Tt(i.maxWait)||0,t):o,d="trailing"in i?!!i.trailing:d),g.cancel=function(){void 0!==a&&clearTimeout(a),c=0,r=l=n=a=void 0},g.flush=function(){return void 0===a?s:m(xt())},g}function wt(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function Tt(e){if("number"==typeof e)return e;if(function(e){return"symbol"==typeof e||function(e){return!!e&&"object"==typeof e}(e)&&"[object Symbol]"==_t.call(e)}(e))return NaN;if(wt(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=wt(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(ut,"");var i=dt.test(e);return i||pt.test(e)?ft(e.slice(2),i?2:8):ht.test(e)?NaN:+e}var Bt,Ct=function(e,t,i){var r=!0,n=!0;if("function"!=typeof e)throw new TypeError(ct);return wt(i)&&(r="leading"in i?!!i.leading:r,n="trailing"in i?!!i.trailing:n),bt(e,t,{leading:r,maxWait:t,trailing:n})},St=Object.prototype.toString,Et=function(e){var t=St.call(e),i="[object Arguments]"===t;return i||(i="[object Array]"!==t&&null!==e&&"object"==typeof e&&"number"==typeof e.length&&e.length>=0&&"[object Function]"===St.call(e.callee)),i};if(!Object.keys){var Mt=Object.prototype.hasOwnProperty,It=Object.prototype.toString,Pt=Et,Lt=Object.prototype.propertyIsEnumerable,Ft=!Lt.call({toString:null},"toString"),kt=Lt.call((function(){}),"prototype"),zt=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],Rt=function(e){var t=e.constructor;return t&&t.prototype===e},Dt={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},Ot=function(){if("undefined"==typeof window)return!1;for(var e in window)try{if(!Dt["$"+e]&&Mt.call(window,e)&&null!==window[e]&&"object"==typeof window[e])try{Rt(window[e])}catch(e){return!0}}catch(e){return!0}return!1}();Bt=function(e){var t=null!==e&&"object"==typeof e,i="[object Function]"===It.call(e),r=Pt(e),n=t&&"[object String]"===It.call(e),o=[];if(!t&&!i&&!r)throw new TypeError("Object.keys called on a non-object");var s=kt&&i;if(n&&e.length>0&&!Mt.call(e,0))for(var a=0;a<e.length;++a)o.push(String(a));if(r&&e.length>0)for(var l=0;l<e.length;++l)o.push(String(l));else for(var c in e)s&&"prototype"===c||!Mt.call(e,c)||o.push(String(c));if(Ft)for(var u=function(e){if("undefined"==typeof window||!Ot)return Rt(e);try{return Rt(e)}catch(e){return!1}}(e),h=0;h<zt.length;++h)u&&"constructor"===zt[h]||!Mt.call(e,zt[h])||o.push(zt[h]);return o}}var Ut=Bt,Nt=Array.prototype.slice,Qt=Et,jt=Object.keys,Vt=jt?function(e){return jt(e)}:Ut,Ht=Object.keys;Vt.shim=function(){if(Object.keys){var e=function(){var e=Object.keys(arguments);return e&&e.length===arguments.length}(1,2);e||(Object.keys=function(e){return Qt(e)?Ht(Nt.call(e)):Ht(e)})}else Object.keys=Vt;return Object.keys||Vt};var Gt=Vt,$t=Object.defineProperty||!1;if($t)try{$t({},"a",{value:1})}catch(e){$t=!1}var Zt=$t,qt=SyntaxError,Kt=TypeError,Wt=Object.getOwnPropertyDescriptor;if(Wt)try{Wt([],"length")}catch(e){Wt=null}var Xt=Wt,Yt=Zt,Jt=qt,ei=Kt,ti=Xt,ii=function(e,t,i){if(!e||"object"!=typeof e&&"function"!=typeof e)throw new ei("`obj` must be an object or a function`");if("string"!=typeof t&&"symbol"!=typeof t)throw new ei("`property` must be a string or a symbol`");if(arguments.length>3&&"boolean"!=typeof arguments[3]&&null!==arguments[3])throw new ei("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&"boolean"!=typeof arguments[4]&&null!==arguments[4])throw new ei("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&"boolean"!=typeof arguments[5]&&null!==arguments[5])throw new ei("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&"boolean"!=typeof arguments[6])throw new ei("`loose`, if provided, must be a boolean");var r=arguments.length>3?arguments[3]:null,n=arguments.length>4?arguments[4]:null,o=arguments.length>5?arguments[5]:null,s=arguments.length>6&&arguments[6],a=!!ti&&ti(e,t);if(Yt)Yt(e,t,{configurable:null===o&&a?a.configurable:!o,enumerable:null===r&&a?a.enumerable:!r,value:i,writable:null===n&&a?a.writable:!n});else{if(!s&&(r||n||o))throw new Jt("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.");e[t]=i}},ri=Zt,ni=function(){return!!ri};ni.hasArrayLengthDefineBug=function(){if(!ri)return null;try{return 1!==ri([],"length",{value:1}).length}catch(e){return!0}};var oi=ni,si=Gt,ai="function"==typeof Symbol&&"symbol"==typeof Symbol("foo"),li=Object.prototype.toString,ci=Array.prototype.concat,ui=ii,hi=oi(),di=function(e,t,i,r){if(t in e)if(!0===r){if(e[t]===i)return}else if(!function(e){return"function"==typeof e&&"[object Function]"===li.call(e)}(r)||!r())return;hi?ui(e,t,i,!0):ui(e,t,i)},pi=function(e,t){var i=arguments.length>2?arguments[2]:{},r=si(t);ai&&(r=ci.call(r,Object.getOwnPropertySymbols(t)));for(var n=0;n<r.length;n+=1)di(e,r[n],t[r[n]],i[r[n]])};pi.supportsDescriptors=!!hi;var fi,Ai=pi,mi={exports:{}},gi=Object,_i=Error,yi=EvalError,vi=RangeError,xi=ReferenceError,bi=URIError,wi=Math.abs,Ti=Math.floor,Bi=Math.max,Ci=Math.min,Si=Math.pow,Ei=Math.round,Mi=Number.isNaN||function(e){return e!=e},Ii=function(){if("function"!=typeof Symbol||"function"!=typeof Object.getOwnPropertySymbols)return!1;if("symbol"==typeof Symbol.iterator)return!0;var e={},t=Symbol("test"),i=Object(t);if("string"==typeof t)return!1;if("[object Symbol]"!==Object.prototype.toString.call(t))return!1;if("[object Symbol]"!==Object.prototype.toString.call(i))return!1;for(var r in e[t]=42,e)return!1;if("function"==typeof Object.keys&&0!==Object.keys(e).length)return!1;if("function"==typeof Object.getOwnPropertyNames&&0!==Object.getOwnPropertyNames(e).length)return!1;var n=Object.getOwnPropertySymbols(e);if(1!==n.length||n[0]!==t)return!1;if(!Object.prototype.propertyIsEnumerable.call(e,t))return!1;if("function"==typeof Object.getOwnPropertyDescriptor){var o=Object.getOwnPropertyDescriptor(e,t);if(42!==o.value||!0!==o.enumerable)return!1}return!0},Pi="undefined"!=typeof Symbol&&Symbol,Li=Ii,Fi=function(){return"function"==typeof Pi&&("function"==typeof Symbol&&("symbol"==typeof Pi("foo")&&("symbol"==typeof Symbol("bar")&&Li())))},ki="undefined"!=typeof Reflect&&Reflect.getPrototypeOf||null,zi=gi.getPrototypeOf||null,Ri=Object.prototype.toString,Di=Math.max,Oi=function(e,t){for(var i=[],r=0;r<e.length;r+=1)i[r]=e[r];for(var n=0;n<t.length;n+=1)i[n+e.length]=t[n];return i},Ui=function(e){var t=this;if("function"!=typeof t||"[object Function]"!==Ri.apply(t))throw new TypeError("Function.prototype.bind called on incompatible "+t);for(var i,r=function(e,t){for(var i=[],r=t||0,n=0;r<e.length;r+=1,n+=1)i[n]=e[r];return i}(arguments,1),n=Di(0,t.length-r.length),o=[],s=0;s<n;s++)o[s]="$"+s;if(i=Function("binder","return function ("+function(e,t){for(var i="",r=0;r<e.length;r+=1)i+=e[r],r+1<e.length&&(i+=t);return i}(o,",")+"){ return binder.apply(this,arguments); }")((function(){if(this instanceof i){var n=t.apply(this,Oi(r,arguments));return Object(n)===n?n:this}return t.apply(e,Oi(r,arguments))})),t.prototype){var a=function(){};a.prototype=t.prototype,i.prototype=new a,a.prototype=null}return i},Ni=Function.prototype.bind||Ui,Qi=Function.prototype.call,ji=Function.prototype.apply,Vi=ji,Hi=Qi,Gi="undefined"!=typeof Reflect&&Reflect&&Reflect.apply||Ni.call(Hi,Vi),$i=Ni,Zi=Kt,qi=Qi,Ki=Gi,Wi=function(e){if(e.length<1||"function"!=typeof e[0])throw new Zi("a function is required");return Ki($i,qi,e)},Xi=Wi,Yi=Xt;try{fi=[].__proto__===Array.prototype}catch(e){if(!e||"object"!=typeof e||!("code"in e)||"ERR_PROTO_ACCESS"!==e.code)throw e}var Ji,er=!!fi&&Yi&&Yi(Object.prototype,"__proto__"),tr=Object,ir=tr.getPrototypeOf,rr=er&&"function"==typeof er.get?Xi([er.get]):"function"==typeof ir&&function(e){return ir(null==e?e:tr(e))},nr=ki,or=zi,sr=rr,ar=nr?function(e){return nr(e)}:or?function(e){if(!e||"object"!=typeof e&&"function"!=typeof e)throw new TypeError("getProto: not an object");return or(e)}:sr?function(e){return sr(e)}:null,lr=Function.prototype.call,cr=Object.prototype.hasOwnProperty,ur=Ni.call(lr,cr),hr=gi,dr=_i,pr=yi,fr=vi,Ar=xi,mr=qt,gr=Kt,_r=bi,yr=wi,vr=Ti,xr=Bi,br=Ci,wr=Si,Tr=Ei,Br=function(e){return Mi(e)||0===e?e:e<0?-1:1},Cr=Function,Sr=function(e){try{return Cr('"use strict"; return ('+e+").constructor;")()}catch(e){}},Er=Xt,Mr=Zt,Ir=function(){throw new gr},Pr=Er?function(){try{return Ir}catch(e){try{return Er(arguments,"callee").get}catch(e){return Ir}}}():Ir,Lr=Fi(),Fr=ar,kr=zi,zr=ki,Rr=ji,Dr=Qi,Or={},Ur="undefined"!=typeof Uint8Array&&Fr?Fr(Uint8Array):Ji,Nr={__proto__:null,"%AggregateError%":"undefined"==typeof AggregateError?Ji:AggregateError,"%Array%":Array,"%ArrayBuffer%":"undefined"==typeof ArrayBuffer?Ji:ArrayBuffer,"%ArrayIteratorPrototype%":Lr&&Fr?Fr([][Symbol.iterator]()):Ji,"%AsyncFromSyncIteratorPrototype%":Ji,"%AsyncFunction%":Or,"%AsyncGenerator%":Or,"%AsyncGeneratorFunction%":Or,"%AsyncIteratorPrototype%":Or,"%Atomics%":"undefined"==typeof Atomics?Ji:Atomics,"%BigInt%":"undefined"==typeof BigInt?Ji:BigInt,"%BigInt64Array%":"undefined"==typeof BigInt64Array?Ji:BigInt64Array,"%BigUint64Array%":"undefined"==typeof BigUint64Array?Ji:BigUint64Array,"%Boolean%":Boolean,"%DataView%":"undefined"==typeof DataView?Ji:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":dr,"%eval%":eval,"%EvalError%":pr,"%Float16Array%":"undefined"==typeof Float16Array?Ji:Float16Array,"%Float32Array%":"undefined"==typeof Float32Array?Ji:Float32Array,"%Float64Array%":"undefined"==typeof Float64Array?Ji:Float64Array,"%FinalizationRegistry%":"undefined"==typeof FinalizationRegistry?Ji:FinalizationRegistry,"%Function%":Cr,"%GeneratorFunction%":Or,"%Int8Array%":"undefined"==typeof Int8Array?Ji:Int8Array,"%Int16Array%":"undefined"==typeof Int16Array?Ji:Int16Array,"%Int32Array%":"undefined"==typeof Int32Array?Ji:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":Lr&&Fr?Fr(Fr([][Symbol.iterator]())):Ji,"%JSON%":"object"==typeof JSON?JSON:Ji,"%Map%":"undefined"==typeof Map?Ji:Map,"%MapIteratorPrototype%":"undefined"!=typeof Map&&Lr&&Fr?Fr((new Map)[Symbol.iterator]()):Ji,"%Math%":Math,"%Number%":Number,"%Object%":hr,"%Object.getOwnPropertyDescriptor%":Er,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":"undefined"==typeof Promise?Ji:Promise,"%Proxy%":"undefined"==typeof Proxy?Ji:Proxy,"%RangeError%":fr,"%ReferenceError%":Ar,"%Reflect%":"undefined"==typeof Reflect?Ji:Reflect,"%RegExp%":RegExp,"%Set%":"undefined"==typeof Set?Ji:Set,"%SetIteratorPrototype%":"undefined"!=typeof Set&&Lr&&Fr?Fr((new Set)[Symbol.iterator]()):Ji,"%SharedArrayBuffer%":"undefined"==typeof SharedArrayBuffer?Ji:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":Lr&&Fr?Fr(""[Symbol.iterator]()):Ji,"%Symbol%":Lr?Symbol:Ji,"%SyntaxError%":mr,"%ThrowTypeError%":Pr,"%TypedArray%":Ur,"%TypeError%":gr,"%Uint8Array%":"undefined"==typeof Uint8Array?Ji:Uint8Array,"%Uint8ClampedArray%":"undefined"==typeof Uint8ClampedArray?Ji:Uint8ClampedArray,"%Uint16Array%":"undefined"==typeof Uint16Array?Ji:Uint16Array,"%Uint32Array%":"undefined"==typeof Uint32Array?Ji:Uint32Array,"%URIError%":_r,"%WeakMap%":"undefined"==typeof WeakMap?Ji:WeakMap,"%WeakRef%":"undefined"==typeof WeakRef?Ji:WeakRef,"%WeakSet%":"undefined"==typeof WeakSet?Ji:WeakSet,"%Function.prototype.call%":Dr,"%Function.prototype.apply%":Rr,"%Object.defineProperty%":Mr,"%Object.getPrototypeOf%":kr,"%Math.abs%":yr,"%Math.floor%":vr,"%Math.max%":xr,"%Math.min%":br,"%Math.pow%":wr,"%Math.round%":Tr,"%Math.sign%":Br,"%Reflect.getPrototypeOf%":zr};if(Fr)try{null.error}catch(e){var Qr=Fr(Fr(e));Nr["%Error.prototype%"]=Qr}var jr=function e(t){var i;if("%AsyncFunction%"===t)i=Sr("async function () {}");else if("%GeneratorFunction%"===t)i=Sr("function* () {}");else if("%AsyncGeneratorFunction%"===t)i=Sr("async function* () {}");else if("%AsyncGenerator%"===t){var r=e("%AsyncGeneratorFunction%");r&&(i=r.prototype)}else if("%AsyncIteratorPrototype%"===t){var n=e("%AsyncGenerator%");n&&Fr&&(i=Fr(n.prototype))}return Nr[t]=i,i},Vr={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},Hr=Ni,Gr=ur,$r=Hr.call(Dr,Array.prototype.concat),Zr=Hr.call(Rr,Array.prototype.splice),qr=Hr.call(Dr,String.prototype.replace),Kr=Hr.call(Dr,String.prototype.slice),Wr=Hr.call(Dr,RegExp.prototype.exec),Xr=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,Yr=/\\(\\)?/g,Jr=function(e,t){var i,r=e;if(Gr(Vr,r)&&(r="%"+(i=Vr[r])[0]+"%"),Gr(Nr,r)){var n=Nr[r];if(n===Or&&(n=jr(r)),void 0===n&&!t)throw new gr("intrinsic "+e+" exists, but is not available. Please file an issue!");return{alias:i,name:r,value:n}}throw new mr("intrinsic "+e+" does not exist!")},en=function(e,t){if("string"!=typeof e||0===e.length)throw new gr("intrinsic name must be a non-empty string");if(arguments.length>1&&"boolean"!=typeof t)throw new gr('"allowMissing" argument must be a boolean');if(null===Wr(/^%?[^%]*%?$/,e))throw new mr("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var i=function(e){var t=Kr(e,0,1),i=Kr(e,-1);if("%"===t&&"%"!==i)throw new mr("invalid intrinsic syntax, expected closing `%`");if("%"===i&&"%"!==t)throw new mr("invalid intrinsic syntax, expected opening `%`");var r=[];return qr(e,Xr,(function(e,t,i,n){r[r.length]=i?qr(n,Yr,"$1"):t||e})),r}(e),r=i.length>0?i[0]:"",n=Jr("%"+r+"%",t),o=n.name,s=n.value,a=!1,l=n.alias;l&&(r=l[0],Zr(i,$r([0,1],l)));for(var c=1,u=!0;c<i.length;c+=1){var h=i[c],d=Kr(h,0,1),p=Kr(h,-1);if(('"'===d||"'"===d||"`"===d||'"'===p||"'"===p||"`"===p)&&d!==p)throw new mr("property names with quotes must have matching quotes");if("constructor"!==h&&u||(a=!0),Gr(Nr,o="%"+(r+="."+h)+"%"))s=Nr[o];else if(null!=s){if(!(h in s)){if(!t)throw new gr("base intrinsic for "+e+" exists, but the property is not available.");return}if(Er&&c+1>=i.length){var f=Er(s,h);s=(u=!!f)&&"get"in f&&!("originalValue"in f.get)?f.get:s[h]}else u=Gr(s,h),s=s[h];u&&!a&&(Nr[o]=s)}}return s},tn=en,rn=ii,nn=oi(),on=Xt,sn=Kt,an=tn("%Math.floor%"),ln=function(e,t){if("function"!=typeof e)throw new sn("`fn` is not a function");if("number"!=typeof t||t<0||t>4294967295||an(t)!==t)throw new sn("`length` must be a positive 32-bit integer");var i=arguments.length>2&&!!arguments[2],r=!0,n=!0;if("length"in e&&on){var o=on(e,"length");o&&!o.configurable&&(r=!1),o&&!o.writable&&(n=!1)}return(r||n||!i)&&(nn?rn(e,"length",t,!0,!0):rn(e,"length",t)),e},cn=Ni,un=ji,hn=Gi,dn=function(){return hn(cn,un,arguments)};!function(e){var t=ln,i=Zt,r=Wi,n=dn;e.exports=function(e){var i=r(arguments),n=e.length-(arguments.length-1);return t(i,1+(n>0?n:0),!0)},i?i(e.exports,"apply",{value:n}):e.exports.apply=n}(mi);var pn=en,fn=Wi,An=fn([pn("%String.prototype.indexOf%")]),mn=function(e,t){var i=pn(e,!!t);return"function"==typeof i&&An(e,".prototype.")>-1?fn([i]):i},gn=Gt,_n=Ii(),yn=mn,vn=gi,xn=yn("Array.prototype.push"),bn=yn("Object.prototype.propertyIsEnumerable"),wn=_n?vn.getOwnPropertySymbols:null,Tn=function(e,t){if(null==e)throw new TypeError("target must be an object");var i=vn(e);if(1===arguments.length)return i;for(var r=1;r<arguments.length;++r){var n=vn(arguments[r]),o=gn(n),s=_n&&(vn.getOwnPropertySymbols||wn);if(s)for(var a=s(n),l=0;l<a.length;++l){var c=a[l];bn(n,c)&&xn(o,c)}for(var u=0;u<o.length;++u){var h=o[u];if(bn(n,h)){var d=n[h];i[h]=d}}}return i},Bn=Tn,Cn=function(){return Object.assign?function(){if(!Object.assign)return!1;for(var e="abcdefghijklmnopqrst",t=e.split(""),i={},r=0;r<t.length;++r)i[t[r]]=t[r];var n=Object.assign({},i),o="";for(var s in n)o+=s;return e!==o}()||function(){if(!Object.assign||!Object.preventExtensions)return!1;var e=Object.preventExtensions({1:2});try{Object.assign(e,"xy")}catch(t){return"y"===e[1]}return!1}()?Bn:Object.assign:Bn},Sn=Ai,En=Cn,Mn=Ai,In=Tn,Pn=Cn,Ln=function(){var e=En();return Sn(Object,{assign:e},{assign:function(){return Object.assign!==e}}),e},Fn=mi.exports.apply(Pn()),kn=function(e,t){return Fn(Object,arguments)};Mn(kn,{getPolyfill:Pn,implementation:In,shim:Ln});var zn=kn,Rn=en,Dn=mi.exports,On=Dn(Rn("String.prototype.indexOf")),Un=function(){return"string"==typeof function(){}.name},Nn=Object.getOwnPropertyDescriptor;if(Nn)try{Nn([],"length")}catch(e){Nn=null}Un.functionsHaveConfigurableNames=function(){if(!Un()||!Nn)return!1;var e=Nn((function(){}),"name");return!!e&&!!e.configurable};var Qn=Function.prototype.bind;Un.boundFunctionsHaveNames=function(){return Un()&&"function"==typeof Qn&&""!==function(){}.bind().name};var jn=Un,Vn=ii,Hn=oi(),Gn=jn.functionsHaveConfigurableNames(),$n=Kt,Zn=function(e,t){if("function"!=typeof e)throw new $n("`fn` is not a function");return arguments.length>2&&!!arguments[2]&&!Gn||(Hn?Vn(e,"name",t,!0,!0):Vn(e,"name",t)),e},qn=Kt,Kn=Object,Wn=Zn((function(){if(null==this||this!==Kn(this))throw new qn("RegExp.prototype.flags getter called on non-object");var e="";return this.hasIndices&&(e+="d"),this.global&&(e+="g"),this.ignoreCase&&(e+="i"),this.multiline&&(e+="m"),this.dotAll&&(e+="s"),this.unicode&&(e+="u"),this.unicodeSets&&(e+="v"),this.sticky&&(e+="y"),e}),"get flags",!0),Xn=Wn,Yn=Ai.supportsDescriptors,Jn=Object.getOwnPropertyDescriptor,eo=function(){if(Yn&&"gim"===/a/gim.flags){var e=Jn(RegExp.prototype,"flags");if(e&&"function"==typeof e.get&&"dotAll"in RegExp.prototype&&"hasIndices"in RegExp.prototype){var t="",i={};if(Object.defineProperty(i,"hasIndices",{get:function(){t+="d"}}),Object.defineProperty(i,"sticky",{get:function(){t+="y"}}),e.get.call(i),"dy"===t)return e.get}}return Xn},to=Ai.supportsDescriptors,io=eo,ro=Xt,no=Object.defineProperty,oo=_i,so=ar,ao=/a/,lo=Ai,co=Wn,uo=eo,ho=function(){if(!to||!so)throw new oo("RegExp.prototype.flags requires a true ES5 environment that supports property descriptors");var e=io(),t=so(ao),i=ro(t,"flags");return i&&i.get===e||no(t,"flags",{configurable:!0,enumerable:!1,get:e}),e},po=(0,mi.exports)(uo());lo(po,{getPolyfill:uo,implementation:co,shim:ho});var fo=po,Ao=Symbol.iterator,mo=Ge(Object.freeze({__proto__:null,default:{}})),go="function"==typeof Map&&Map.prototype,_o=Object.getOwnPropertyDescriptor&&go?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,yo=go&&_o&&"function"==typeof _o.get?_o.get:null,vo=go&&Map.prototype.forEach,xo="function"==typeof Set&&Set.prototype,bo=Object.getOwnPropertyDescriptor&&xo?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,wo=xo&&bo&&"function"==typeof bo.get?bo.get:null,To=xo&&Set.prototype.forEach,Bo="function"==typeof WeakMap&&WeakMap.prototype?WeakMap.prototype.has:null,Co="function"==typeof WeakSet&&WeakSet.prototype?WeakSet.prototype.has:null,So="function"==typeof WeakRef&&WeakRef.prototype?WeakRef.prototype.deref:null,Eo=Boolean.prototype.valueOf,Mo=Object.prototype.toString,Io=Function.prototype.toString,Po=String.prototype.match,Lo=String.prototype.slice,Fo=String.prototype.replace,ko=String.prototype.toUpperCase,zo=String.prototype.toLowerCase,Ro=RegExp.prototype.test,Do=Array.prototype.concat,Oo=Array.prototype.join,Uo=Array.prototype.slice,No=Math.floor,Qo="function"==typeof BigInt?BigInt.prototype.valueOf:null,jo=Object.getOwnPropertySymbols,Vo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?Symbol.prototype.toString:null,Ho="function"==typeof Symbol&&"object"==typeof Symbol.iterator,Go="function"==typeof Symbol&&Symbol.toStringTag&&(typeof Symbol.toStringTag===Ho||"symbol")?Symbol.toStringTag:null,$o=Object.prototype.propertyIsEnumerable,Zo=("function"==typeof Reflect?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(e){return e.__proto__}:null);function qo(e,t){if(e===1/0||e===-1/0||e!=e||e&&e>-1e3&&e<1e3||Ro.call(/e/,t))return t;var i=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if("number"==typeof e){var r=e<0?-No(-e):No(e);if(r!==e){var n=String(r),o=Lo.call(t,n.length+1);return Fo.call(n,i,"$&_")+"."+Fo.call(Fo.call(o,/([0-9]{3})/g,"$&_"),/_$/,"")}}return Fo.call(t,i,"$&_")}var Ko=mo,Wo=Ko.custom,Xo=ss(Wo)?Wo:null,Yo={__proto__:null,double:'"',single:"'"},Jo={__proto__:null,double:/(["\\])/g,single:/(['\\])/g},es=function e(t,i,r,n){var o=i||{};if(ls(o,"quoteStyle")&&!ls(Yo,o.quoteStyle))throw new TypeError('option "quoteStyle" must be "single" or "double"');if(ls(o,"maxStringLength")&&("number"==typeof o.maxStringLength?o.maxStringLength<0&&o.maxStringLength!==1/0:null!==o.maxStringLength))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var s=!ls(o,"customInspect")||o.customInspect;if("boolean"!=typeof s&&"symbol"!==s)throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(ls(o,"indent")&&null!==o.indent&&"\t"!==o.indent&&!(parseInt(o.indent,10)===o.indent&&o.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(ls(o,"numericSeparator")&&"boolean"!=typeof o.numericSeparator)throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var a=o.numericSeparator;if(void 0===t)return"undefined";if(null===t)return"null";if("boolean"==typeof t)return t?"true":"false";if("string"==typeof t)return hs(t,o);if("number"==typeof t){if(0===t)return 1/0/t>0?"0":"-0";var l=String(t);return a?qo(t,l):l}if("bigint"==typeof t){var c=String(t)+"n";return a?qo(t,c):c}var u=void 0===o.depth?5:o.depth;if(void 0===r&&(r=0),r>=u&&u>0&&"object"==typeof t)return ns(t)?"[Array]":"[Object]";var h=function(e,t){var i;if("\t"===e.indent)i="\t";else{if(!("number"==typeof e.indent&&e.indent>0))return null;i=Oo.call(Array(e.indent+1)," ")}return{base:i,prev:Oo.call(Array(t+1),i)}}(o,r);if(void 0===n)n=[];else if(us(n,t)>=0)return"[Circular]";function d(t,i,s){if(i&&(n=Uo.call(n)).push(i),s){var a={depth:o.depth};return ls(o,"quoteStyle")&&(a.quoteStyle=o.quoteStyle),e(t,a,r+1,n)}return e(t,o,r+1,n)}if("function"==typeof t&&!os(t)){var p=function(e){if(e.name)return e.name;var t=Po.call(Io.call(e),/^function\s*([\w$]+)/);if(t)return t[1];return null}(t),f=gs(t,d);return"[Function"+(p?": "+p:" (anonymous)")+"]"+(f.length>0?" { "+Oo.call(f,", ")+" }":"")}if(ss(t)){var A=Ho?Fo.call(String(t),/^(Symbol\(.*\))_[^)]*$/,"$1"):Vo.call(t);return"object"!=typeof t||Ho?A:ps(A)}if(function(e){if(!e||"object"!=typeof e)return!1;if("undefined"!=typeof HTMLElement&&e instanceof HTMLElement)return!0;return"string"==typeof e.nodeName&&"function"==typeof e.getAttribute}(t)){for(var m="<"+zo.call(String(t.nodeName)),g=t.attributes||[],_=0;_<g.length;_++)m+=" "+g[_].name+"="+ts(is(g[_].value),"double",o);return m+=">",t.childNodes&&t.childNodes.length&&(m+="..."),m+="</"+zo.call(String(t.nodeName))+">"}if(ns(t)){if(0===t.length)return"[]";var y=gs(t,d);return h&&!function(e){for(var t=0;t<e.length;t++)if(us(e[t],"\n")>=0)return!1;return!0}(y)?"["+ms(y,h)+"]":"[ "+Oo.call(y,", ")+" ]"}if(function(e){return"[object Error]"===cs(e)&&rs(e)}(t)){var v=gs(t,d);return"cause"in Error.prototype||!("cause"in t)||$o.call(t,"cause")?0===v.length?"["+String(t)+"]":"{ ["+String(t)+"] "+Oo.call(v,", ")+" }":"{ ["+String(t)+"] "+Oo.call(Do.call("[cause]: "+d(t.cause),v),", ")+" }"}if("object"==typeof t&&s){if(Xo&&"function"==typeof t[Xo]&&Ko)return Ko(t,{depth:u-r});if("symbol"!==s&&"function"==typeof t.inspect)return t.inspect()}if(function(e){if(!yo||!e||"object"!=typeof e)return!1;try{yo.call(e);try{wo.call(e)}catch(e){return!0}return e instanceof Map}catch(e){}return!1}(t)){var x=[];return vo&&vo.call(t,(function(e,i){x.push(d(i,t,!0)+" => "+d(e,t))})),As("Map",yo.call(t),x,h)}if(function(e){if(!wo||!e||"object"!=typeof e)return!1;try{wo.call(e);try{yo.call(e)}catch(e){return!0}return e instanceof Set}catch(e){}return!1}(t)){var b=[];return To&&To.call(t,(function(e){b.push(d(e,t))})),As("Set",wo.call(t),b,h)}if(function(e){if(!Bo||!e||"object"!=typeof e)return!1;try{Bo.call(e,Bo);try{Co.call(e,Co)}catch(e){return!0}return e instanceof WeakMap}catch(e){}return!1}(t))return fs("WeakMap");if(function(e){if(!Co||!e||"object"!=typeof e)return!1;try{Co.call(e,Co);try{Bo.call(e,Bo)}catch(e){return!0}return e instanceof WeakSet}catch(e){}return!1}(t))return fs("WeakSet");if(function(e){if(!So||!e||"object"!=typeof e)return!1;try{return So.call(e),!0}catch(e){}return!1}(t))return fs("WeakRef");if(function(e){return"[object Number]"===cs(e)&&rs(e)}(t))return ps(d(Number(t)));if(function(e){if(!e||"object"!=typeof e||!Qo)return!1;try{return Qo.call(e),!0}catch(e){}return!1}(t))return ps(d(Qo.call(t)));if(function(e){return"[object Boolean]"===cs(e)&&rs(e)}(t))return ps(Eo.call(t));if(function(e){return"[object String]"===cs(e)&&rs(e)}(t))return ps(d(String(t)));if("undefined"!=typeof window&&t===window)return"{ [object Window] }";if("undefined"!=typeof globalThis&&t===globalThis||void 0!==Ve&&t===Ve)return"{ [object globalThis] }";if(!function(e){return"[object Date]"===cs(e)&&rs(e)}(t)&&!os(t)){var w=gs(t,d),T=Zo?Zo(t)===Object.prototype:t instanceof Object||t.constructor===Object,B=t instanceof Object?"":"null prototype",C=!T&&Go&&Object(t)===t&&Go in t?Lo.call(cs(t),8,-1):B?"Object":"",S=(T||"function"!=typeof t.constructor?"":t.constructor.name?t.constructor.name+" ":"")+(C||B?"["+Oo.call(Do.call([],C||[],B||[]),": ")+"] ":"");return 0===w.length?S+"{}":h?S+"{"+ms(w,h)+"}":S+"{ "+Oo.call(w,", ")+" }"}return String(t)};function ts(e,t,i){var r=i.quoteStyle||t,n=Yo[r];return n+e+n}function is(e){return Fo.call(String(e),/"/g,"&quot;")}function rs(e){return!Go||!("object"==typeof e&&(Go in e||void 0!==e[Go]))}function ns(e){return"[object Array]"===cs(e)&&rs(e)}function os(e){return"[object RegExp]"===cs(e)&&rs(e)}function ss(e){if(Ho)return e&&"object"==typeof e&&e instanceof Symbol;if("symbol"==typeof e)return!0;if(!e||"object"!=typeof e||!Vo)return!1;try{return Vo.call(e),!0}catch(e){}return!1}var as=Object.prototype.hasOwnProperty||function(e){return e in this};function ls(e,t){return as.call(e,t)}function cs(e){return Mo.call(e)}function us(e,t){if(e.indexOf)return e.indexOf(t);for(var i=0,r=e.length;i<r;i++)if(e[i]===t)return i;return-1}function hs(e,t){if(e.length>t.maxStringLength){var i=e.length-t.maxStringLength,r="... "+i+" more character"+(i>1?"s":"");return hs(Lo.call(e,0,t.maxStringLength),t)+r}var n=Jo[t.quoteStyle||"single"];return n.lastIndex=0,ts(Fo.call(Fo.call(e,n,"\\$1"),/[\x00-\x1f]/g,ds),"single",t)}function ds(e){var t=e.charCodeAt(0),i={8:"b",9:"t",10:"n",12:"f",13:"r"}[t];return i?"\\"+i:"\\x"+(t<16?"0":"")+ko.call(t.toString(16))}function ps(e){return"Object("+e+")"}function fs(e){return e+" { ? }"}function As(e,t,i,r){return e+" ("+t+") {"+(r?ms(i,r):Oo.call(i,", "))+"}"}function ms(e,t){if(0===e.length)return"";var i="\n"+t.prev+t.base;return i+Oo.call(e,","+i)+"\n"+t.prev}function gs(e,t){var i=ns(e),r=[];if(i){r.length=e.length;for(var n=0;n<e.length;n++)r[n]=ls(e,n)?t(e[n],e):""}var o,s="function"==typeof jo?jo(e):[];if(Ho){o={};for(var a=0;a<s.length;a++)o["$"+s[a]]=s[a]}for(var l in e)ls(e,l)&&(i&&String(Number(l))===l&&l<e.length||Ho&&o["$"+l]instanceof Symbol||(Ro.call(/[^\w$]/,l)?r.push(t(l,e)+": "+t(e[l],e)):r.push(l+": "+t(e[l],e))));if("function"==typeof jo)for(var c=0;c<s.length;c++)$o.call(e,s[c])&&r.push("["+t(s[c])+"]: "+t(e[s[c]],e));return r}var _s=es,ys=Kt,vs=function(e,t,i){for(var r,n=e;null!=(r=n.next);n=r)if(r.key===t)return n.next=r.next,i||(r.next=e.next,e.next=r),r},xs=mn,bs=es,ws=Kt,Ts=en("%Map%",!0),Bs=xs("Map.prototype.get",!0),Cs=xs("Map.prototype.set",!0),Ss=xs("Map.prototype.has",!0),Es=xs("Map.prototype.delete",!0),Ms=xs("Map.prototype.size",!0),Is=!!Ts&&function(){var e,t={assert:function(e){if(!t.has(e))throw new ws("Side channel does not contain "+bs(e))},delete:function(t){if(e){var i=Es(e,t);return 0===Ms(e)&&(e=void 0),i}return!1},get:function(t){if(e)return Bs(e,t)},has:function(t){return!!e&&Ss(e,t)},set:function(t,i){e||(e=new Ts),Cs(e,t,i)}};return t},Ps=mn,Ls=es,Fs=Is,ks=Kt,zs=en("%WeakMap%",!0),Rs=Ps("WeakMap.prototype.get",!0),Ds=Ps("WeakMap.prototype.set",!0),Os=Ps("WeakMap.prototype.has",!0),Us=Ps("WeakMap.prototype.delete",!0),Ns=Kt,Qs=es,js=function(){var e,t={assert:function(e){if(!t.has(e))throw new ys("Side channel does not contain "+_s(e))},delete:function(t){var i=e&&e.next,r=function(e,t){if(e)return vs(e,t,!0)}(e,t);return r&&i&&i===r&&(e=void 0),!!r},get:function(t){return function(e,t){if(e){var i=vs(e,t);return i&&i.value}}(e,t)},has:function(t){return function(e,t){return!!e&&!!vs(e,t)}(e,t)},set:function(t,i){e||(e={next:void 0}),function(e,t,i){var r=vs(e,t);r?r.value=i:e.next={key:t,next:e.next,value:i}}(e,t,i)}};return t},Vs=(zs?function(){var e,t,i={assert:function(e){if(!i.has(e))throw new ks("Side channel does not contain "+Ls(e))},delete:function(i){if(zs&&i&&("object"==typeof i||"function"==typeof i)){if(e)return Us(e,i)}else if(Fs&&t)return t.delete(i);return!1},get:function(i){return zs&&i&&("object"==typeof i||"function"==typeof i)&&e?Rs(e,i):t&&t.get(i)},has:function(i){return zs&&i&&("object"==typeof i||"function"==typeof i)&&e?Os(e,i):!!t&&t.has(i)},set:function(i,r){zs&&i&&("object"==typeof i||"function"==typeof i)?(e||(e=new zs),Ds(e,i,r)):Fs&&(t||(t=Fs()),t.set(i,r))}};return i}:Fs)||Is||js,Hs=function(e){return e!=e},Gs=function(e,t){return 0===e&&0===t?1/e==1/t:e===t||!(!Hs(e)||!Hs(t))},$s=Gs,Zs=function(){return"function"==typeof Object.is?Object.is:$s},qs=Zs,Ks=Ai,Ws=Ai,Xs=Gs,Ys=Zs,Js=function(){var e=qs();return Ks(Object,{is:e},{is:function(){return Object.is!==e}}),e},ea=(0,mi.exports)(Ys(),Object);Ws(ea,{getPolyfill:Ys,implementation:Xs,shim:Js});var ta=ea,ia=Ii,ra=function(){return ia()&&!!Symbol.toStringTag},na=ra(),oa=mn("Object.prototype.toString"),sa=function(e){return!(na&&e&&"object"==typeof e&&Symbol.toStringTag in e)&&"[object Arguments]"===oa(e)},aa=function(e){return!!sa(e)||null!==e&&"object"==typeof e&&"length"in e&&"number"==typeof e.length&&e.length>=0&&"[object Array]"!==oa(e)&&"callee"in e&&"[object Function]"===oa(e.callee)},la=function(){return sa(arguments)}();sa.isLegacyArguments=aa;var ca,ua=la?sa:aa,ha={}.toString,da=Array.isArray||function(e){return"[object Array]"==ha.call(e)},pa=mi.exports,fa=mn,Aa=en("%ArrayBuffer%",!0),ma=fa("ArrayBuffer.prototype.byteLength",!0),ga=fa("Object.prototype.toString"),_a=!!Aa&&!ma&&new Aa(0).slice,ya=!!_a&&pa(_a),va=ma||ya?function(e){if(!e||"object"!=typeof e)return!1;try{return ma?ma(e):ya(e,0),!0}catch(e){return!1}}:Aa?function(e){return"[object ArrayBuffer]"===ga(e)}:function(e){return!1},xa=mn,ba=xa("Date.prototype.getDay"),wa=xa("Object.prototype.toString"),Ta=ra(),Ba=mn,Ca=ra(),Sa=ur,Ea=Xt;if(Ca){var Ma=Ba("RegExp.prototype.exec"),Ia={},Pa=function(){throw Ia},La={toString:Pa,valueOf:Pa};"symbol"==typeof Symbol.toPrimitive&&(La[Symbol.toPrimitive]=Pa),ca=function(e){if(!e||"object"!=typeof e)return!1;var t=Ea(e,"lastIndex");if(!(t&&Sa(t,"value")))return!1;try{Ma(e,La)}catch(e){return e===Ia}}}else{var Fa=Ba("Object.prototype.toString");ca=function(e){return!(!e||"object"!=typeof e&&"function"!=typeof e)&&"[object RegExp]"===Fa(e)}}var ka=ca,za=mn("SharedArrayBuffer.prototype.byteLength",!0),Ra=za?function(e){if(!e||"object"!=typeof e)return!1;try{return za(e),!0}catch(e){return!1}}:function(e){return!1},Da=mn,Oa=Da("String.prototype.valueOf"),Ua=Da("Object.prototype.toString"),Na=ra(),Qa=mn,ja=Qa("Number.prototype.toString"),Va=Qa("Object.prototype.toString"),Ha=ra(),Ga=mn,$a=Ga("Boolean.prototype.toString"),Za=Ga("Object.prototype.toString"),qa=ra(),Ka={exports:{}},Wa=ka,Xa=mn("RegExp.prototype.exec"),Ya=Kt,Ja=mn,el=Ja("Object.prototype.toString"),tl=function(e){if(!Wa(e))throw new Ya("`regex` must be a RegExp");return function(t){return null!==Xa(e,t)}};if(Fi()){var il=Ja("Symbol.prototype.toString"),rl=tl(/^Symbol\(.*\)$/);Ka.exports=function(e){if("symbol"==typeof e)return!0;if(!e||"object"!=typeof e||"[object Symbol]"!==el(e))return!1;try{return function(e){return"symbol"==typeof e.valueOf()&&rl(il(e))}(e)}catch(e){return!1}}}else Ka.exports=function(e){return!1};var nl={exports:{}},ol="undefined"!=typeof BigInt&&BigInt;if("function"==typeof ol&&"function"==typeof BigInt&&"bigint"==typeof ol(42)&&"bigint"==typeof BigInt(42)){var sl=BigInt.prototype.valueOf;nl.exports=function(e){return null!=e&&"boolean"!=typeof e&&"string"!=typeof e&&"number"!=typeof e&&"symbol"!=typeof e&&"function"!=typeof e&&("bigint"==typeof e||function(e){try{return sl.call(e),!0}catch(e){}return!1}(e))}}else nl.exports=function(e){return!1};var al,ll=function(e){return"string"==typeof e||!(!e||"object"!=typeof e)&&(Na?function(e){try{return Oa(e),!0}catch(e){return!1}}(e):"[object String]"===Ua(e))},cl=function(e){return"number"==typeof e||!(!e||"object"!=typeof e)&&(Ha?function(e){try{return ja(e),!0}catch(e){return!1}}(e):"[object Number]"===Va(e))},ul=function(e){return"boolean"==typeof e||null!==e&&"object"==typeof e&&(qa?function(e){try{return $a(e),!0}catch(e){return!1}}(e):"[object Boolean]"===Za(e))},hl=Ka.exports,dl=nl.exports,pl="function"==typeof Map&&Map.prototype?Map:null,fl="function"==typeof Set&&Set.prototype?Set:null;pl||(al=function(e){return!1});var Al=pl?Map.prototype.has:null,ml=fl?Set.prototype.has:null;al||Al||(al=function(e){return!1});var gl,_l=al||function(e){if(!e||"object"!=typeof e)return!1;try{if(Al.call(e),ml)try{ml.call(e)}catch(e){return!0}return e instanceof pl}catch(e){}return!1},yl="function"==typeof Map&&Map.prototype?Map:null,vl="function"==typeof Set&&Set.prototype?Set:null;vl||(gl=function(e){return!1});var xl=yl?Map.prototype.has:null,bl=vl?Set.prototype.has:null;gl||bl||(gl=function(e){return!1});var wl,Tl=gl||function(e){if(!e||"object"!=typeof e)return!1;try{if(bl.call(e),xl)try{xl.call(e)}catch(e){return!0}return e instanceof vl}catch(e){}return!1},Bl="function"==typeof WeakMap&&WeakMap.prototype?WeakMap:null,Cl="function"==typeof WeakSet&&WeakSet.prototype?WeakSet:null;Bl||(wl=function(e){return!1});var Sl=Bl?Bl.prototype.has:null,El=Cl?Cl.prototype.has:null;wl||Sl||(wl=function(e){return!1});var Ml=wl||function(e){if(!e||"object"!=typeof e)return!1;try{if(Sl.call(e,Sl),El)try{El.call(e,El)}catch(e){return!0}return e instanceof Bl}catch(e){}return!1},Il={exports:{}},Pl=mn,Ll=en("%WeakSet%",!0),Fl=Pl("WeakSet.prototype.has",!0);if(Fl){var kl=Pl("WeakMap.prototype.has",!0);Il.exports=function(e){if(!e||"object"!=typeof e)return!1;try{if(Fl(e,Fl),kl)try{kl(e,kl)}catch(e){return!0}return e instanceof Ll}catch(e){}return!1}}else Il.exports=function(e){return!1};var zl,Rl,Dl=_l,Ol=Tl,Ul=Ml,Nl=Il.exports,Ql=Function.prototype.toString,jl="object"==typeof Reflect&&null!==Reflect&&Reflect.apply;if("function"==typeof jl&&"function"==typeof Object.defineProperty)try{zl=Object.defineProperty({},"length",{get:function(){throw Rl}}),Rl={},jl((function(){throw 42}),null,zl)}catch(iv){iv!==Rl&&(jl=null)}else jl=null;var Vl=/^\s*class\b/,Hl=function(e){try{var t=Ql.call(e);return Vl.test(t)}catch(e){return!1}},Gl=function(e){try{return!Hl(e)&&(Ql.call(e),!0)}catch(e){return!1}},$l=Object.prototype.toString,Zl="function"==typeof Symbol&&!!Symbol.toStringTag,ql=!(0 in[,]),Kl=function(){return!1};if("object"==typeof document){var Wl=document.all;$l.call(Wl)===$l.call(document.all)&&(Kl=function(e){if((ql||!e)&&(void 0===e||"object"==typeof e))try{var t=$l.call(e);return("[object HTMLAllCollection]"===t||"[object HTML document.all class]"===t||"[object HTMLCollection]"===t||"[object Object]"===t)&&null==e("")}catch(e){}return!1})}var Xl=jl?function(e){if(Kl(e))return!0;if(!e)return!1;if("function"!=typeof e&&"object"!=typeof e)return!1;try{jl(e,null,zl)}catch(e){if(e!==Rl)return!1}return!Hl(e)&&Gl(e)}:function(e){if(Kl(e))return!0;if(!e)return!1;if("function"!=typeof e&&"object"!=typeof e)return!1;if(Zl)return Gl(e);if(Hl(e))return!1;var t=$l.call(e);return!("[object Function]"!==t&&"[object GeneratorFunction]"!==t&&!/^\[object HTML/.test(t))&&Gl(e)},Yl=Xl,Jl=Object.prototype.toString,ec=Object.prototype.hasOwnProperty;var tc=["Float16Array","Float32Array","Float64Array","Int8Array","Int16Array","Int32Array","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","BigInt64Array","BigUint64Array"],ic="undefined"==typeof globalThis?Ve:globalThis,rc=function(e,t,i){if(!Yl(t))throw new TypeError("iterator must be a function");var r;arguments.length>=3&&(r=i),function(e){return"[object Array]"===Jl.call(e)}(e)?function(e,t,i){for(var r=0,n=e.length;r<n;r++)ec.call(e,r)&&(null==i?t(e[r],r,e):t.call(i,e[r],r,e))}(e,t,r):"string"==typeof e?function(e,t,i){for(var r=0,n=e.length;r<n;r++)null==i?t(e.charAt(r),r,e):t.call(i,e.charAt(r),r,e)}(e,t,r):function(e,t,i){for(var r in e)ec.call(e,r)&&(null==i?t(e[r],r,e):t.call(i,e[r],r,e))}(e,t,r)},nc=function(){for(var e=[],t=0;t<tc.length;t++)"function"==typeof ic[tc[t]]&&(e[e.length]=tc[t]);return e},oc=mi.exports,sc=mn,ac=Xt,lc=ar,cc=sc("Object.prototype.toString"),uc=ra(),hc="undefined"==typeof globalThis?Ve:globalThis,dc=nc(),pc=sc("String.prototype.slice"),fc=sc("Array.prototype.indexOf",!0)||function(e,t){for(var i=0;i<e.length;i+=1)if(e[i]===t)return i;return-1},Ac={__proto__:null};rc(dc,uc&&ac&&lc?function(e){var t=new hc[e];if(Symbol.toStringTag in t&&lc){var i=lc(t),r=ac(i,Symbol.toStringTag);if(!r&&i){var n=lc(i);r=ac(n,Symbol.toStringTag)}Ac["$"+e]=oc(r.get)}}:function(e){var t=new hc[e],i=t.slice||t.set;i&&(Ac["$"+e]=oc(i))});var mc=mn("ArrayBuffer.prototype.byteLength",!0),gc=va,_c=zn,yc=function(e,t){var i=Rn(e,!!t);return"function"==typeof i&&On(e,".prototype.")>-1?Dn(i):i},vc=fo,xc=en,bc=function(e){if(null!=e&&void 0!==e[Ao])return e[Ao]()},wc=function(){var e,t={assert:function(e){if(!t.has(e))throw new Ns("Side channel does not contain "+Qs(e))},delete:function(t){return!!e&&e.delete(t)},get:function(t){return e&&e.get(t)},has:function(t){return!!e&&e.has(t)},set:function(t,i){e||(e=Vs()),e.set(t,i)}};return t},Tc=ta,Bc=ua,Cc=da,Sc=va,Ec=function(e){return"object"==typeof e&&null!==e&&(Ta?function(e){try{return ba(e),!0}catch(e){return!1}}(e):"[object Date]"===wa(e))},Mc=ka,Ic=Ra,Pc=Gt,Lc=function(e){return null==e||"object"!=typeof e&&"function"!=typeof e?null:ll(e)?"String":cl(e)?"Number":ul(e)?"Boolean":hl(e)?"Symbol":dl(e)?"BigInt":void 0},Fc=function(e){if(e&&"object"==typeof e){if(Dl(e))return"Map";if(Ol(e))return"Set";if(Ul(e))return"WeakMap";if(Nl(e))return"WeakSet"}return!1},kc=function(e){if(!e||"object"!=typeof e)return!1;if(!uc){var t=pc(cc(e),8,-1);return fc(dc,t)>-1?t:"Object"===t&&function(e){var t=!1;return rc(Ac,(function(i,r){if(!t)try{i(e),t=pc(r,1)}catch(e){}})),t}(e)}return ac?function(e){var t=!1;return rc(Ac,(function(i,r){if(!t)try{"$"+i(e)===r&&(t=pc(r,1))}catch(e){}})),t}(e):null},zc=function(e){return gc(e)?mc?mc(e):e.byteLength:NaN},Rc=yc("SharedArrayBuffer.prototype.byteLength",!0),Dc=yc("Date.prototype.getTime"),Oc=Object.getPrototypeOf,Uc=yc("Object.prototype.toString"),Nc=xc("%Set%",!0),Qc=yc("Map.prototype.has",!0),jc=yc("Map.prototype.get",!0),Vc=yc("Map.prototype.size",!0),Hc=yc("Set.prototype.add",!0),Gc=yc("Set.prototype.delete",!0),$c=yc("Set.prototype.has",!0),Zc=yc("Set.prototype.size",!0);function qc(e,t,i,r){for(var n,o=bc(e);(n=o.next())&&!n.done;)if(Jc(t,n.value,i,r))return Gc(e,n.value),!0;return!1}function Kc(e){return void 0===e?null:"object"!=typeof e?"symbol"!=typeof e&&("string"!=typeof e&&"number"!=typeof e||+e==+e):void 0}function Wc(e,t,i,r,n,o){var s=Kc(i);if(null!=s)return s;var a=jc(t,s),l=_c({},n,{strict:!1});return!(void 0===a&&!Qc(t,s)||!Jc(r,a,l,o))&&(!Qc(e,s)&&Jc(r,a,l,o))}function Xc(e,t,i){var r=Kc(i);return null!=r?r:$c(t,r)&&!$c(e,r)}function Yc(e,t,i,r,n,o){for(var s,a,l=bc(e);(s=l.next())&&!s.done;)if(Jc(i,a=s.value,n,o)&&Jc(r,jc(t,a),n,o))return Gc(e,a),!0;return!1}function Jc(e,t,i,r){var n=i||{};if(n.strict?Tc(e,t):e===t)return!0;if(Lc(e)!==Lc(t))return!1;if(!e||!t||"object"!=typeof e&&"object"!=typeof t)return n.strict?Tc(e,t):e==t;var o,s=r.has(e),a=r.has(t);if(s&&a){if(r.get(e)===r.get(t))return!0}else o={};return s||r.set(e,o),a||r.set(t,o),function(e,t,i,r){var n,o;if(typeof e!=typeof t)return!1;if(null==e||null==t)return!1;if(Uc(e)!==Uc(t))return!1;if(Bc(e)!==Bc(t))return!1;var s=Cc(e),a=Cc(t);if(s!==a)return!1;var l=e instanceof Error,c=t instanceof Error;if(l!==c)return!1;if((l||c)&&(e.name!==t.name||e.message!==t.message))return!1;var u=Mc(e),h=Mc(t);if(u!==h)return!1;if((u||h)&&(e.source!==t.source||vc(e)!==vc(t)))return!1;var d=Ec(e),p=Ec(t);if(d!==p)return!1;if((d||p)&&Dc(e)!==Dc(t))return!1;if(i.strict&&Oc&&Oc(e)!==Oc(t))return!1;var f=kc(e),A=kc(t);if(f!==A)return!1;if(f||A){if(e.length!==t.length)return!1;for(n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}var m=eu(e),g=eu(t);if(m!==g)return!1;if(m||g){if(e.length!==t.length)return!1;for(n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}var _=Sc(e),y=Sc(t);if(_!==y)return!1;if(_||y)return zc(e)===zc(t)&&("function"==typeof Uint8Array&&Jc(new Uint8Array(e),new Uint8Array(t),i,r));var v=Ic(e),x=Ic(t);if(v!==x)return!1;if(v||x)return Rc(e)===Rc(t)&&("function"==typeof Uint8Array&&Jc(new Uint8Array(e),new Uint8Array(t),i,r));if(typeof e!=typeof t)return!1;var b=Pc(e),w=Pc(t);if(b.length!==w.length)return!1;for(b.sort(),w.sort(),n=b.length-1;n>=0;n--)if(b[n]!=w[n])return!1;for(n=b.length-1;n>=0;n--)if(!Jc(e[o=b[n]],t[o],i,r))return!1;var T=Fc(e),B=Fc(t);if(T!==B)return!1;if("Set"===T||"Set"===B)return function(e,t,i,r){if(Zc(e)!==Zc(t))return!1;var n,o,s,a=bc(e),l=bc(t);for(;(n=a.next())&&!n.done;)if(n.value&&"object"==typeof n.value)s||(s=new Nc),Hc(s,n.value);else if(!$c(t,n.value)){if(i.strict)return!1;if(!Xc(e,t,n.value))return!1;s||(s=new Nc),Hc(s,n.value)}if(s){for(;(o=l.next())&&!o.done;)if(o.value&&"object"==typeof o.value){if(!qc(s,o.value,i.strict,r))return!1}else if(!i.strict&&!$c(e,o.value)&&!qc(s,o.value,i.strict,r))return!1;return 0===Zc(s)}return!0}(e,t,i,r);if("Map"===T)return function(e,t,i,r){if(Vc(e)!==Vc(t))return!1;var n,o,s,a,l,c,u=bc(e),h=bc(t);for(;(n=u.next())&&!n.done;)if(a=n.value[0],l=n.value[1],a&&"object"==typeof a)s||(s=new Nc),Hc(s,a);else if(void 0===(c=jc(t,a))&&!Qc(t,a)||!Jc(l,c,i,r)){if(i.strict)return!1;if(!Wc(e,t,a,l,i,r))return!1;s||(s=new Nc),Hc(s,a)}if(s){for(;(o=h.next())&&!o.done;)if(a=o.value[0],c=o.value[1],a&&"object"==typeof a){if(!Yc(s,e,a,c,i,r))return!1}else if(!(i.strict||e.has(a)&&Jc(jc(e,a),c,i,r)||Yc(s,e,a,c,_c({},i,{strict:!1}),r)))return!1;return 0===Zc(s)}return!0}(e,t,i,r);return!0}(e,t,n,r)}function eu(e){return!(!e||"object"!=typeof e||"number"!=typeof e.length)&&("function"==typeof e.copy&&"function"==typeof e.slice&&(!(e.length>0&&"number"!=typeof e[0])&&!!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e))))}var tu=function(e,t,i){return Jc(e,t,i,wc())};function iu(e,t,i,r){return new(i||(i=Promise))((function(n,o){function s(e){try{l(r.next(e))}catch(e){o(e)}}function a(e){try{l(r.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(s,a)}l((r=r.apply(e,t||[])).next())}))}function ru(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}"function"==typeof SuppressedError&&SuppressedError;var nu=function e(t,i){if(t===i)return!0;if(t&&i&&"object"==typeof t&&"object"==typeof i){if(t.constructor!==i.constructor)return!1;var r,n,o;if(Array.isArray(t)){if((r=t.length)!=i.length)return!1;for(n=r;0!=n--;)if(!e(t[n],i[n]))return!1;return!0}if(t.constructor===RegExp)return t.source===i.source&&t.flags===i.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===i.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===i.toString();if((r=(o=Object.keys(t)).length)!==Object.keys(i).length)return!1;for(n=r;0!=n--;)if(!Object.prototype.hasOwnProperty.call(i,o[n]))return!1;for(n=r;0!=n--;){var s=o[n];if(!e(t[s],i[s]))return!1}return!0}return t!=t&&i!=i},ou=ru(nu);const su="__googleMapsScriptId";var au;!function(e){e[e.INITIALIZED=0]="INITIALIZED",e[e.LOADING=1]="LOADING",e[e.SUCCESS=2]="SUCCESS",e[e.FAILURE=3]="FAILURE"}(au||(au={}));class lu{constructor({apiKey:e,authReferrerPolicy:t,channel:i,client:r,id:n=su,language:o,libraries:s=[],mapIds:a,nonce:l,region:c,retries:u=3,url:h="https://maps.googleapis.com/maps/api/js",version:d}){if(this.callbacks=[],this.done=!1,this.loading=!1,this.errors=[],this.apiKey=e,this.authReferrerPolicy=t,this.channel=i,this.client=r,this.id=n||su,this.language=o,this.libraries=s,this.mapIds=a,this.nonce=l,this.region=c,this.retries=u,this.url=h,this.version=d,lu.instance){if(!ou(this.options,lu.instance.options))throw new Error(`Loader must not be called again with different options. ${JSON.stringify(this.options)} !== ${JSON.stringify(lu.instance.options)}`);return lu.instance}lu.instance=this}get options(){return{version:this.version,apiKey:this.apiKey,channel:this.channel,client:this.client,id:this.id,libraries:this.libraries,language:this.language,region:this.region,mapIds:this.mapIds,nonce:this.nonce,url:this.url,authReferrerPolicy:this.authReferrerPolicy}}get status(){return this.errors.length?au.FAILURE:this.done?au.SUCCESS:this.loading?au.LOADING:au.INITIALIZED}get failed(){return this.done&&!this.loading&&this.errors.length>=this.retries+1}createUrl(){let e=this.url;return e+="?callback=__googleMapsCallback&loading=async",this.apiKey&&(e+=`&key=${this.apiKey}`),this.channel&&(e+=`&channel=${this.channel}`),this.client&&(e+=`&client=${this.client}`),this.libraries.length>0&&(e+=`&libraries=${this.libraries.join(",")}`),this.language&&(e+=`&language=${this.language}`),this.region&&(e+=`&region=${this.region}`),this.version&&(e+=`&v=${this.version}`),this.mapIds&&(e+=`&map_ids=${this.mapIds.join(",")}`),this.authReferrerPolicy&&(e+=`&auth_referrer_policy=${this.authReferrerPolicy}`),e}deleteScript(){const e=document.getElementById(this.id);e&&e.remove()}load(){return this.loadPromise()}loadPromise(){return new Promise(((e,t)=>{this.loadCallback((i=>{i?t(i.error):e(window.google)}))}))}importLibrary(e){return this.execute(),google.maps.importLibrary(e)}loadCallback(e){this.callbacks.push(e),this.execute()}setScript(){var e,t;if(document.getElementById(this.id))return void this.callback();const i={key:this.apiKey,channel:this.channel,client:this.client,libraries:this.libraries.length&&this.libraries,v:this.version,mapIds:this.mapIds,language:this.language,region:this.region,authReferrerPolicy:this.authReferrerPolicy};Object.keys(i).forEach((e=>!i[e]&&delete i[e])),(null===(t=null===(e=null===window||void 0===window?void 0:window.google)||void 0===e?void 0:e.maps)||void 0===t?void 0:t.importLibrary)||(e=>{let t,i,r,n="The Google Maps JavaScript API",o="google",s="importLibrary",a="__ib__",l=document,c=window;c=c[o]||(c[o]={});const u=c.maps||(c.maps={}),h=new Set,d=new URLSearchParams,p=()=>t||(t=new Promise(((s,c)=>iu(this,void 0,void 0,(function*(){var p;for(r in yield i=l.createElement("script"),i.id=this.id,d.set("libraries",[...h]+""),e)d.set(r.replace(/[A-Z]/g,(e=>"_"+e[0].toLowerCase())),e[r]);d.set("callback",o+".maps."+a),i.src=this.url+"?"+d,u[a]=s,i.onerror=()=>t=c(Error(n+" could not load.")),i.nonce=this.nonce||(null===(p=l.querySelector("script[nonce]"))||void 0===p?void 0:p.nonce)||"",l.head.append(i)})))));u[s]?console.warn(n+" only loads once. Ignoring:",e):u[s]=(e,...t)=>h.add(e)&&p().then((()=>u[s](e,...t)))})(i);const r=this.libraries.map((e=>this.importLibrary(e)));r.length||r.push(this.importLibrary("core")),Promise.all(r).then((()=>this.callback()),(e=>{const t=new ErrorEvent("error",{error:e});this.loadErrorCallback(t)}))}reset(){this.deleteScript(),this.done=!1,this.loading=!1,this.errors=[],this.onerrorEvent=null}resetIfRetryingFailed(){this.failed&&this.reset()}loadErrorCallback(e){if(this.errors.push(e),this.errors.length<=this.retries){const e=this.errors.length*Math.pow(2,this.errors.length);console.error(`Failed to load Google Maps script, retrying in ${e} ms.`),setTimeout((()=>{this.deleteScript(),this.setScript()}),e)}else this.onerrorEvent=e,this.callback()}callback(){this.done=!0,this.loading=!1,this.callbacks.forEach((e=>{e(this.onerrorEvent)})),this.callbacks=[]}execute(){if(this.resetIfRetryingFailed(),!this.loading)if(this.done)this.callback();else{if(window.google&&window.google.maps&&window.google.maps.version)return console.warn("Google Maps already loaded outside @googlemaps/js-api-loader. This may result in undesirable behavior as options and script parameters may not match."),void this.callback();this.loading=!0,this.setScript()}}}function cu(e){let i;return{c(){i=b("div"),E(i,"id",e[0]),E(i,"class","map svelte-16c2pp7")},m(e,t){y(e,i,t)},p(e,[t]){1&t&&E(i,"id",e[0])},i:t,o:t,d(e){e&&v(i)}}}function uu(e,t,i){let r,n,{id:o}=t,{bearing:s}=t,{center:a}=t,{pitch:l}=t,{zoom:c}=t,{mapStyle:u}=t,{numberOfMaps:h}=t,{onMapMount:d}=t;it.subscribe((e=>({googleMapsAPIKey:n}=e)));const p=H();let f,A={};const m=new lu({apiKey:n,version:"beta"}),g=()=>({bearing:f.getHeading(),center:{lng:f.getCenter().lng(),lat:f.getCenter().lat()},pitch:f.getTilt(),zoom:f.getZoom()-1}),_=()=>{const e=y(g()),t=y(A);return!tu(e,t)},y=e=>({bearing:lt(e.bearing,1),pitch:lt(e.pitch,1),center:{lat:lt(e.center.lat,6),lng:lt(e.center.lng,6)},zoom:lt(e.zoom,2)});return j((()=>{m.load().then((()=>{var t;HTMLCanvasElement.prototype.getContext=(t=HTMLCanvasElement.prototype.getContext,function(e,i){return(i=i||{}).preserveDrawingBuffer=!0,t.call(this,e,i)}),i(8,f=new google.maps.Map(document.getElementById(o),{center:A.center,zoom:A.zoom,mapId:r,disableDefaultUI:!0,isFractionalZoomEnabled:!0,fullscreenControl:!1,zoomControl:!1})),d(f);const n=Ct((()=>{document.getElementById(o).querySelector('div[tabindex="0"]').focus()}),250);document.getElementById(o).addEventListener("wheel",n,{passive:!0}),f.addListener("center_changed",e),f.addListener("heading_changed",e),f.addListener("tilt_changed",e),f.addListener("zoom_changed",e)}));const e=()=>{document.getElementById(o).contains(document.activeElement)&&_()&&p("mapMove",{options:g()})}})),e.$$set=e=>{"id"in e&&i(0,o=e.id),"bearing"in e&&i(1,s=e.bearing),"center"in e&&i(2,a=e.center),"pitch"in e&&i(3,l=e.pitch),"zoom"in e&&i(4,c=e.zoom),"mapStyle"in e&&i(5,u=e.mapStyle),"numberOfMaps"in e&&i(6,h=e.numberOfMaps),"onMapMount"in e&&i(7,d=e.onMapMount)},e.$$.update=()=>{if(32&e.$$.dirty&&(r=u?.mapId),30&e.$$.dirty&&i(9,A={bearing:s,center:a,pitch:l,zoom:c}),768&e.$$.dirty&&(e=>{e&&_()&&e.moveCamera({center:{lat:a.lat,lng:a.lng},zoom:c+1,heading:s,tilt:l})})(f),321&e.$$.dirty&&f&&h){const e=document.getElementById(o);if(e){new ResizeObserver((()=>{google.maps.event.trigger(f,"resize")})).observe(e)}}},[o,s,a,l,c,u,h,d,f,A]}class hu extends me{constructor(e){super(),Ae(this,e,uu,cu,a,{id:0,bearing:1,center:2,pitch:3,zoom:4,mapStyle:5,numberOfMaps:6,onMapMount:7})}}const du=e=>{if("string"!=typeof e)return!1;return e.startsWith("mapbox://")},pu=e=>{if(!e)return!1;let t;try{t=new URL(e)}catch(e){return!1}return"api.maptiler.com"===t.host&&!t.searchParams.has("key")},fu=(e,t)=>{const{mapboxKey:i,maptilerKey:r}=t;let n=e;return du(e)&&i?n=((e,t)=>{if(!du(e))return e;if(!t)return e;const[,,,i,r]=e.split("/");return`https://api.mapbox.com/styles/v1/${i}/${r}?title=true&access_token=${t}`})(n,i):pu(e)&&r&&(n=((e,t)=>{if(!t)return e;let i=new URL(e);return t&&pu(e)&&i.searchParams.append("key",t),i.toString()})(n,r)),n};let Au,mu;it.subscribe((e=>({mapboxGlAccessToken:Au,maptilerApiKey:mu}=e)));const gu=async e=>{const t=du(e);let i,r=e;try{r=new URL(e);const t={mapboxKey:Au,maptilerKey:mu};r=fu(r.toString(),t)}catch(e){}try{i=await fetch(r)}catch(e){throw{message:e.message}}if(!i.ok)throw{status:i.status,message:i.statusText};const n=await i.json();if(t&&n.message)throw{message:n.message};return n},_u=(e,t,i)=>e.replace("{branch}",t).replace("{style}",i);function yu(e){let i;return{c(){i=b("div"),E(i,"id",e[0]),E(i,"class","map svelte-369bnt")},m(e,t){y(e,i,t)},p(e,[t]){1&t&&E(i,"id",e[0])},i:t,o:t,d(e){e&&v(i)}}}function vu(e,t,i){let r,n,o;l(e,it,(e=>i(20,o=e)));let s,{id:a}=t,{bearing:c}=t,{center:u}=t,{pitch:h}=t,{showCollisions:d}=t,{showBoundaries:p}=t,{zoom:f}=t,{mapStyle:A}=t,{numberOfMaps:m}=t,{onMapMount:g}=t,{mapRenderer:_}=t;const y=H();let v,x,b={},w=null,T=!1,B={};const C=()=>({bearing:x.getBearing(),center:x.getCenter(),pitch:x.getPitch(),zoom:x.getZoom()}),S=(e,t)=>{e&&!tu(C(),B)&&e.jumpTo(t)};return j((async()=>{await(async()=>{"maplibre-gl"===_?(await Promise.resolve().then((function(){return tf})),s=await Promise.resolve().then((function(){return Xe}))):"maptiler-sdk"===_?(await Promise.resolve().then((function(){return rf})),s=await Promise.resolve().then((function(){return lw})),s.config.apiKey=o.maptilerApiKey):(await Promise.resolve().then((function(){return cw})),s=await Promise.resolve().then((function(){return qe})),s.accessToken=o.mapboxGlAccessToken,o.mapboxBaseApiUrl&&(s.baseApiUrl=o.mapboxBaseApiUrl))})();const e=s;let t,l="string"==typeof v;if(r){const e=n??r?.options?.default;if(!e)return;if(l&&(t=await gu(v)),!t)return;t=await r.script(t,e)}i(13,x=new e.Map({container:a,style:t??v,canvasContextAttributes:{preserveDrawingBuffer:!0},preserveDrawingBuffer:!0,...B})),g(x);const c=Ct((()=>{document.getElementById(a).querySelector('canvas[tabindex="0"]').focus()}),250);document.getElementById(a).addEventListener("wheel",c,{passive:!0});x.on("move",(e=>{e?.resize||(({origin:e})=>{document.getElementById(a)?.contains(document.activeElement)&&y("mapMove",{options:C()})})(e)})),x.on("click",(t=>{let i=x.queryRenderedFeatures(t.point);i.length&&(T?(w.remove(),w=null):(w=(new e.Popup).setLngLat(t.lngLat).setHTML((e=>{const t=e.reduce(((e,t)=>{const{source:i,sourceLayer:r,properties:n}=t;return e.some((e=>{const t=e.source===i&&e.sourceLayer===r,o=Object.keys(n).every((t=>n[t]===e.properties[t]));return t&&o}))||e.push(t),e}),[]);let i='<div class="popup">';for(const e of t){i+='<div class="popup-feature">';const{properties:t,layer:r}=e;i+='<div class="popup-label-heading">layer id</div>',i+=`<div class="popup-layer-id">${r.id}</div>`,i+='<div class="popup-label-heading">source: source-layer</div>',i+=`<div class="popup-source-layer"><span class="popup-source">${e.source}:</span> ${e.sourceLayer}</div>`,t&&Object.keys(t).length?(i+='<div class="popup-label-heading">properties</div>',Object.keys(t).sort().forEach((e=>{const r=t[e];i+=`<p class="popup-property"><span class="popup-property-id">${e}:</span> <span class="popup-property-value">${r}</span></p>`}))):i+='<p class="popup-no-properties">No properties</p>',i+="</div>"}return i+="</div>",i})(i)).setMaxWidth(360).addTo(x),T=!0,w.on("close",(()=>{T=!1}))))}))})),V((()=>{x&&x.remove()})),e.$$set=e=>{"id"in e&&i(0,a=e.id),"bearing"in e&&i(1,c=e.bearing),"center"in e&&i(2,u=e.center),"pitch"in e&&i(3,h=e.pitch),"showCollisions"in e&&i(4,d=e.showCollisions),"showBoundaries"in e&&i(5,p=e.showBoundaries),"zoom"in e&&i(6,f=e.zoom),"mapStyle"in e&&i(7,A=e.mapStyle),"numberOfMaps"in e&&i(8,m=e.numberOfMaps),"onMapMount"in e&&i(9,g=e.onMapMount),"mapRenderer"in e&&i(10,_=e.mapRenderer)},e.$$.update=()=>{128&e.$$.dirty&&i(11,({style:b,url:v,precompile:r,selectedPrecompileOption:n}=A),b,(i(12,v),i(7,A)),(i(15,n),i(7,A))),78&e.$$.dirty&&i(14,B={bearing:c,center:u,pitch:h,zoom:f}),8208&e.$$.dirty&&x&&i(13,x.showCollisionBoxes=d,x),8224&e.$$.dirty&&x&&i(13,x.showTileBoundaries=p,x),24576&e.$$.dirty&&S(x,B),47104&e.$$.dirty&&(async(e,t,i,n)=>{if(!e)return;let o=t;!o&&A?.pattern&&(o=_u(A?.pattern,A?.branch,A?.branchStyle));let s=i;if(r){if(!n)return;if(!i&&"string"==typeof o&&(s=await gu(o)),!s)return;s=await r.script(s,n),e.setStyle(s)}else e.setStyle(o||i)})(x,v,b,n),9473&e.$$.dirty&&x&&m&&"maplibre-gl"!==_&&"maptiler-sdk"!==_&&x.once("render",(()=>{const e=document.getElementById(a);if(e){new ResizeObserver((()=>{x.resize({resize:!0})})).observe(e)}}))},[a,c,u,h,d,p,f,A,m,g,_,b,v,x,B,n]}class xu extends me{constructor(e){super(),Ae(this,e,vu,yu,a,{id:0,bearing:1,center:2,pitch:3,showCollisions:4,showBoundaries:5,zoom:6,mapStyle:7,numberOfMaps:8,onMapMount:9,mapRenderer:10})}}var bu={exports:{}};
/* @preserve
 * Leaflet 1.9.4, a JS library for interactive maps. https://leafletjs.com
 * (c) 2010-2023 Vladimir Agafonkin, (c) 2010-2011 CloudMade
 */function wu(e){let i;return{c(){i=b("div"),E(i,"id",e[0]),E(i,"class","map svelte-84o01x")},m(e,t){y(e,i,t)},p(e,[t]){1&t&&E(i,"id",e[0])},i:t,o:t,d(e){e&&v(i)}}}function Tu(e,t,i){let{id:r}=t,{center:n}=t,{zoom:o}=t,{mapStyle:s}=t,{numberOfMaps:a}=t,{overrideLayer:l}=t,{onMapMount:c}=t;const u=H();let h,d,p,f={};const A=()=>({center:d.getCenter(),zoom:d.getZoom()-1}),m=(e,t)=>{e&&!tu(A(),f)&&e.setView(t.center,t.zoom+1,{animate:!1})};return j((async()=>{i(8,d=bu.exports.map(r,{zoomControl:!1,zoomDelta:.25,zoomSnap:0}).setView(f.center,f.zoom+1)),d.attributionControl.setPrefix(""),c(d);const e=Ct((()=>{document.getElementById(r).focus()}),250);document.getElementById(r).addEventListener("wheel",e,{passive:!0});d.on("move",(e=>{e?.resize||(({origin:e})=>{document.getElementById(r)===document.activeElement&&u("mapMove",{options:A()})})(e)}))})),V((()=>{d&&d.remove()})),e.$$set=e=>{"id"in e&&i(0,r=e.id),"center"in e&&i(1,n=e.center),"zoom"in e&&i(2,o=e.zoom),"mapStyle"in e&&i(3,s=e.mapStyle),"numberOfMaps"in e&&i(4,a=e.numberOfMaps),"overrideLayer"in e&&i(5,l=e.overrideLayer),"onMapMount"in e&&i(6,c=e.onMapMount)},e.$$.update=()=>{8&e.$$.dirty&&i(7,({url:h}=s),h),6&e.$$.dirty&&i(9,f={center:n,zoom:o}),768&e.$$.dirty&&m(d,f),416&e.$$.dirty&&((e,t,i)=>{e&&(p&&p.remove(),p=i||bu.exports.tileLayer(t,{detectRetina:!0}),p.addTo(e))})(d,h,l),273&e.$$.dirty&&d&&a&&d.once("render",(()=>{const e=document.getElementById(r);if(e){new ResizeObserver((()=>{d.resize({resize:!0})})).observe(e)}}))},[r,n,o,s,a,l,c,h,d,f]}!function(e){var t="1.9.4";function i(e){var t,i,r,n;for(i=1,r=arguments.length;i<r;i++)for(t in n=arguments[i])e[t]=n[t];return e}var r=Object.create||function(){function e(){}return function(t){return e.prototype=t,new e}}();function n(e,t){var i=Array.prototype.slice;if(e.bind)return e.bind.apply(e,i.call(arguments,1));var r=i.call(arguments,2);return function(){return e.apply(t,r.length?r.concat(i.call(arguments)):arguments)}}var o=0;function s(e){return"_leaflet_id"in e||(e._leaflet_id=++o),e._leaflet_id}function a(e,t,i){var r,n,o,s;return s=function(){r=!1,n&&(o.apply(i,n),n=!1)},o=function(){r?n=arguments:(e.apply(i,arguments),setTimeout(s,t),r=!0)},o}function l(e,t,i){var r=t[1],n=t[0],o=r-n;return e===r&&i?e:((e-n)%o+o)%o+n}function c(){return!1}function u(e,t){if(!1===t)return e;var i=Math.pow(10,void 0===t?6:t);return Math.round(e*i)/i}function h(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function d(e){return h(e).split(/\s+/)}function p(e,t){for(var i in Object.prototype.hasOwnProperty.call(e,"options")||(e.options=e.options?r(e.options):{}),t)e.options[i]=t[i];return e.options}function f(e,t,i){var r=[];for(var n in e)r.push(encodeURIComponent(i?n.toUpperCase():n)+"="+encodeURIComponent(e[n]));return(t&&-1!==t.indexOf("?")?"&":"?")+r.join("&")}var A=/\{ *([\w_ -]+) *\}/g;function m(e,t){return e.replace(A,(function(e,i){var r=t[i];if(void 0===r)throw new Error("No value provided for variable "+e);return"function"==typeof r&&(r=r(t)),r}))}var g=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)};function _(e,t){for(var i=0;i<e.length;i++)if(e[i]===t)return i;return-1}var y="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=";function v(e){return window["webkit"+e]||window["moz"+e]||window["ms"+e]}var x=0;function b(e){var t=+new Date,i=Math.max(0,16-(t-x));return x=t+i,window.setTimeout(e,i)}var w=window.requestAnimationFrame||v("RequestAnimationFrame")||b,T=window.cancelAnimationFrame||v("CancelAnimationFrame")||v("CancelRequestAnimationFrame")||function(e){window.clearTimeout(e)};function B(e,t,i){if(!i||w!==b)return w.call(window,n(e,t));e.call(t)}function C(e){e&&T.call(window,e)}var S={__proto__:null,extend:i,create:r,bind:n,get lastId(){return o},stamp:s,throttle:a,wrapNum:l,falseFn:c,formatNum:u,trim:h,splitWords:d,setOptions:p,getParamString:f,template:m,isArray:g,indexOf:_,emptyImageUrl:y,requestFn:w,cancelFn:T,requestAnimFrame:B,cancelAnimFrame:C};function E(){}function M(e){if("undefined"!=typeof L&&L&&L.Mixin){e=g(e)?e:[e];for(var t=0;t<e.length;t++)e[t]===L.Mixin.Events&&console.warn("Deprecated include of L.Mixin.Events: this property will be removed in future releases, please inherit from L.Evented instead.",(new Error).stack)}}E.extend=function(e){var t=function(){p(this),this.initialize&&this.initialize.apply(this,arguments),this.callInitHooks()},n=t.__super__=this.prototype,o=r(n);for(var s in o.constructor=t,t.prototype=o,this)Object.prototype.hasOwnProperty.call(this,s)&&"prototype"!==s&&"__super__"!==s&&(t[s]=this[s]);return e.statics&&i(t,e.statics),e.includes&&(M(e.includes),i.apply(null,[o].concat(e.includes))),i(o,e),delete o.statics,delete o.includes,o.options&&(o.options=n.options?r(n.options):{},i(o.options,e.options)),o._initHooks=[],o.callInitHooks=function(){if(!this._initHooksCalled){n.callInitHooks&&n.callInitHooks.call(this),this._initHooksCalled=!0;for(var e=0,t=o._initHooks.length;e<t;e++)o._initHooks[e].call(this)}},t},E.include=function(e){var t=this.prototype.options;return i(this.prototype,e),e.options&&(this.prototype.options=t,this.mergeOptions(e.options)),this},E.mergeOptions=function(e){return i(this.prototype.options,e),this},E.addInitHook=function(e){var t=Array.prototype.slice.call(arguments,1),i="function"==typeof e?e:function(){this[e].apply(this,t)};return this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(i),this};var I={on:function(e,t,i){if("object"==typeof e)for(var r in e)this._on(r,e[r],t);else for(var n=0,o=(e=d(e)).length;n<o;n++)this._on(e[n],t,i);return this},off:function(e,t,i){if(arguments.length)if("object"==typeof e)for(var r in e)this._off(r,e[r],t);else{e=d(e);for(var n=1===arguments.length,o=0,s=e.length;o<s;o++)n?this._off(e[o]):this._off(e[o],t,i)}else delete this._events;return this},_on:function(e,t,i,r){if("function"==typeof t){if(!1===this._listens(e,t,i)){i===this&&(i=void 0);var n={fn:t,ctx:i};r&&(n.once=!0),this._events=this._events||{},this._events[e]=this._events[e]||[],this._events[e].push(n)}}else console.warn("wrong listener type: "+typeof t)},_off:function(e,t,i){var r,n,o;if(this._events&&(r=this._events[e]))if(1!==arguments.length)if("function"==typeof t){var s=this._listens(e,t,i);if(!1!==s){var a=r[s];this._firingCount&&(a.fn=c,this._events[e]=r=r.slice()),r.splice(s,1)}}else console.warn("wrong listener type: "+typeof t);else{if(this._firingCount)for(n=0,o=r.length;n<o;n++)r[n].fn=c;delete this._events[e]}},fire:function(e,t,r){if(!this.listens(e,r))return this;var n=i({},t,{type:e,target:this,sourceTarget:t&&t.sourceTarget||this});if(this._events){var o=this._events[e];if(o){this._firingCount=this._firingCount+1||1;for(var s=0,a=o.length;s<a;s++){var l=o[s],c=l.fn;l.once&&this.off(e,c,l.ctx),c.call(l.ctx||this,n)}this._firingCount--}}return r&&this._propagateEvent(n),this},listens:function(e,t,i,r){"string"!=typeof e&&console.warn('"string" type argument expected');var n=t;"function"!=typeof t&&(r=!!t,n=void 0,i=void 0);var o=this._events&&this._events[e];if(o&&o.length&&!1!==this._listens(e,n,i))return!0;if(r)for(var s in this._eventParents)if(this._eventParents[s].listens(e,t,i,r))return!0;return!1},_listens:function(e,t,i){if(!this._events)return!1;var r=this._events[e]||[];if(!t)return!!r.length;i===this&&(i=void 0);for(var n=0,o=r.length;n<o;n++)if(r[n].fn===t&&r[n].ctx===i)return n;return!1},once:function(e,t,i){if("object"==typeof e)for(var r in e)this._on(r,e[r],t,!0);else for(var n=0,o=(e=d(e)).length;n<o;n++)this._on(e[n],t,i,!0);return this},addEventParent:function(e){return this._eventParents=this._eventParents||{},this._eventParents[s(e)]=e,this},removeEventParent:function(e){return this._eventParents&&delete this._eventParents[s(e)],this},_propagateEvent:function(e){for(var t in this._eventParents)this._eventParents[t].fire(e.type,i({layer:e.target,propagatedFrom:e.target},e),!0)}};I.addEventListener=I.on,I.removeEventListener=I.clearAllEventListeners=I.off,I.addOneTimeEventListener=I.once,I.fireEvent=I.fire,I.hasEventListeners=I.listens;var P=E.extend(I);function F(e,t,i){this.x=i?Math.round(e):e,this.y=i?Math.round(t):t}var k=Math.trunc||function(e){return e>0?Math.floor(e):Math.ceil(e)};function z(e,t,i){return e instanceof F?e:g(e)?new F(e[0],e[1]):null==e?e:"object"==typeof e&&"x"in e&&"y"in e?new F(e.x,e.y):new F(e,t,i)}function R(e,t){if(e)for(var i=t?[e,t]:e,r=0,n=i.length;r<n;r++)this.extend(i[r])}function D(e,t){return!e||e instanceof R?e:new R(e,t)}function O(e,t){if(e)for(var i=t?[e,t]:e,r=0,n=i.length;r<n;r++)this.extend(i[r])}function U(e,t){return e instanceof O?e:new O(e,t)}function N(e,t,i){if(isNaN(e)||isNaN(t))throw new Error("Invalid LatLng object: ("+e+", "+t+")");this.lat=+e,this.lng=+t,void 0!==i&&(this.alt=+i)}function Q(e,t,i){return e instanceof N?e:g(e)&&"object"!=typeof e[0]?3===e.length?new N(e[0],e[1],e[2]):2===e.length?new N(e[0],e[1]):null:null==e?e:"object"==typeof e&&"lat"in e?new N(e.lat,"lng"in e?e.lng:e.lon,e.alt):void 0===t?null:new N(e,t,i)}F.prototype={clone:function(){return new F(this.x,this.y)},add:function(e){return this.clone()._add(z(e))},_add:function(e){return this.x+=e.x,this.y+=e.y,this},subtract:function(e){return this.clone()._subtract(z(e))},_subtract:function(e){return this.x-=e.x,this.y-=e.y,this},divideBy:function(e){return this.clone()._divideBy(e)},_divideBy:function(e){return this.x/=e,this.y/=e,this},multiplyBy:function(e){return this.clone()._multiplyBy(e)},_multiplyBy:function(e){return this.x*=e,this.y*=e,this},scaleBy:function(e){return new F(this.x*e.x,this.y*e.y)},unscaleBy:function(e){return new F(this.x/e.x,this.y/e.y)},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.clone()._ceil()},_ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},trunc:function(){return this.clone()._trunc()},_trunc:function(){return this.x=k(this.x),this.y=k(this.y),this},distanceTo:function(e){var t=(e=z(e)).x-this.x,i=e.y-this.y;return Math.sqrt(t*t+i*i)},equals:function(e){return(e=z(e)).x===this.x&&e.y===this.y},contains:function(e){return e=z(e),Math.abs(e.x)<=Math.abs(this.x)&&Math.abs(e.y)<=Math.abs(this.y)},toString:function(){return"Point("+u(this.x)+", "+u(this.y)+")"}},R.prototype={extend:function(e){var t,i;if(!e)return this;if(e instanceof F||"number"==typeof e[0]||"x"in e)t=i=z(e);else if(t=(e=D(e)).min,i=e.max,!t||!i)return this;return this.min||this.max?(this.min.x=Math.min(t.x,this.min.x),this.max.x=Math.max(i.x,this.max.x),this.min.y=Math.min(t.y,this.min.y),this.max.y=Math.max(i.y,this.max.y)):(this.min=t.clone(),this.max=i.clone()),this},getCenter:function(e){return z((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,e)},getBottomLeft:function(){return z(this.min.x,this.max.y)},getTopRight:function(){return z(this.max.x,this.min.y)},getTopLeft:function(){return this.min},getBottomRight:function(){return this.max},getSize:function(){return this.max.subtract(this.min)},contains:function(e){var t,i;return(e="number"==typeof e[0]||e instanceof F?z(e):D(e))instanceof R?(t=e.min,i=e.max):t=i=e,t.x>=this.min.x&&i.x<=this.max.x&&t.y>=this.min.y&&i.y<=this.max.y},intersects:function(e){e=D(e);var t=this.min,i=this.max,r=e.min,n=e.max,o=n.x>=t.x&&r.x<=i.x,s=n.y>=t.y&&r.y<=i.y;return o&&s},overlaps:function(e){e=D(e);var t=this.min,i=this.max,r=e.min,n=e.max,o=n.x>t.x&&r.x<i.x,s=n.y>t.y&&r.y<i.y;return o&&s},isValid:function(){return!(!this.min||!this.max)},pad:function(e){var t=this.min,i=this.max,r=Math.abs(t.x-i.x)*e,n=Math.abs(t.y-i.y)*e;return D(z(t.x-r,t.y-n),z(i.x+r,i.y+n))},equals:function(e){return!!e&&(e=D(e),this.min.equals(e.getTopLeft())&&this.max.equals(e.getBottomRight()))}},O.prototype={extend:function(e){var t,i,r=this._southWest,n=this._northEast;if(e instanceof N)t=e,i=e;else{if(!(e instanceof O))return e?this.extend(Q(e)||U(e)):this;if(t=e._southWest,i=e._northEast,!t||!i)return this}return r||n?(r.lat=Math.min(t.lat,r.lat),r.lng=Math.min(t.lng,r.lng),n.lat=Math.max(i.lat,n.lat),n.lng=Math.max(i.lng,n.lng)):(this._southWest=new N(t.lat,t.lng),this._northEast=new N(i.lat,i.lng)),this},pad:function(e){var t=this._southWest,i=this._northEast,r=Math.abs(t.lat-i.lat)*e,n=Math.abs(t.lng-i.lng)*e;return new O(new N(t.lat-r,t.lng-n),new N(i.lat+r,i.lng+n))},getCenter:function(){return new N((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new N(this.getNorth(),this.getWest())},getSouthEast:function(){return new N(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(e){e="number"==typeof e[0]||e instanceof N||"lat"in e?Q(e):U(e);var t,i,r=this._southWest,n=this._northEast;return e instanceof O?(t=e.getSouthWest(),i=e.getNorthEast()):t=i=e,t.lat>=r.lat&&i.lat<=n.lat&&t.lng>=r.lng&&i.lng<=n.lng},intersects:function(e){e=U(e);var t=this._southWest,i=this._northEast,r=e.getSouthWest(),n=e.getNorthEast(),o=n.lat>=t.lat&&r.lat<=i.lat,s=n.lng>=t.lng&&r.lng<=i.lng;return o&&s},overlaps:function(e){e=U(e);var t=this._southWest,i=this._northEast,r=e.getSouthWest(),n=e.getNorthEast(),o=n.lat>t.lat&&r.lat<i.lat,s=n.lng>t.lng&&r.lng<i.lng;return o&&s},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(e,t){return!!e&&(e=U(e),this._southWest.equals(e.getSouthWest(),t)&&this._northEast.equals(e.getNorthEast(),t))},isValid:function(){return!(!this._southWest||!this._northEast)}},N.prototype={equals:function(e,t){return!!e&&(e=Q(e),Math.max(Math.abs(this.lat-e.lat),Math.abs(this.lng-e.lng))<=(void 0===t?1e-9:t))},toString:function(e){return"LatLng("+u(this.lat,e)+", "+u(this.lng,e)+")"},distanceTo:function(e){return H.distance(this,Q(e))},wrap:function(){return H.wrapLatLng(this)},toBounds:function(e){var t=180*e/40075017,i=t/Math.cos(Math.PI/180*this.lat);return U([this.lat-t,this.lng-i],[this.lat+t,this.lng+i])},clone:function(){return new N(this.lat,this.lng,this.alt)}};var j,V={latLngToPoint:function(e,t){var i=this.projection.project(e),r=this.scale(t);return this.transformation._transform(i,r)},pointToLatLng:function(e,t){var i=this.scale(t),r=this.transformation.untransform(e,i);return this.projection.unproject(r)},project:function(e){return this.projection.project(e)},unproject:function(e){return this.projection.unproject(e)},scale:function(e){return 256*Math.pow(2,e)},zoom:function(e){return Math.log(e/256)/Math.LN2},getProjectedBounds:function(e){if(this.infinite)return null;var t=this.projection.bounds,i=this.scale(e);return new R(this.transformation.transform(t.min,i),this.transformation.transform(t.max,i))},infinite:!1,wrapLatLng:function(e){var t=this.wrapLng?l(e.lng,this.wrapLng,!0):e.lng;return new N(this.wrapLat?l(e.lat,this.wrapLat,!0):e.lat,t,e.alt)},wrapLatLngBounds:function(e){var t=e.getCenter(),i=this.wrapLatLng(t),r=t.lat-i.lat,n=t.lng-i.lng;if(0===r&&0===n)return e;var o=e.getSouthWest(),s=e.getNorthEast();return new O(new N(o.lat-r,o.lng-n),new N(s.lat-r,s.lng-n))}},H=i({},V,{wrapLng:[-180,180],R:6371e3,distance:function(e,t){var i=Math.PI/180,r=e.lat*i,n=t.lat*i,o=Math.sin((t.lat-e.lat)*i/2),s=Math.sin((t.lng-e.lng)*i/2),a=o*o+Math.cos(r)*Math.cos(n)*s*s,l=2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a));return this.R*l}}),G=6378137,$={R:G,MAX_LATITUDE:85.0511287798,project:function(e){var t=Math.PI/180,i=this.MAX_LATITUDE,r=Math.max(Math.min(i,e.lat),-i),n=Math.sin(r*t);return new F(this.R*e.lng*t,this.R*Math.log((1+n)/(1-n))/2)},unproject:function(e){var t=180/Math.PI;return new N((2*Math.atan(Math.exp(e.y/this.R))-Math.PI/2)*t,e.x*t/this.R)},bounds:(j=G*Math.PI,new R([-j,-j],[j,j]))};function Z(e,t,i,r){if(g(e))return this._a=e[0],this._b=e[1],this._c=e[2],void(this._d=e[3]);this._a=e,this._b=t,this._c=i,this._d=r}function q(e,t,i,r){return new Z(e,t,i,r)}Z.prototype={transform:function(e,t){return this._transform(e.clone(),t)},_transform:function(e,t){return t=t||1,e.x=t*(this._a*e.x+this._b),e.y=t*(this._c*e.y+this._d),e},untransform:function(e,t){return t=t||1,new F((e.x/t-this._b)/this._a,(e.y/t-this._d)/this._c)}};var K=i({},H,{code:"EPSG:3857",projection:$,transformation:function(){var e=.5/(Math.PI*$.R);return q(e,.5,-e,.5)}()}),W=i({},K,{code:"EPSG:900913"});function X(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function Y(e,t){var i,r,n,o,s,a,l="";for(i=0,n=e.length;i<n;i++){for(r=0,o=(s=e[i]).length;r<o;r++)l+=(r?"L":"M")+(a=s[r]).x+" "+a.y;l+=t?Oe.svg?"z":"x":""}return l||"M0 0"}var J,ee=document.documentElement.style,te="ActiveXObject"in window,ie=te&&!document.addEventListener,re="msLaunchUri"in navigator&&!("documentMode"in document),ne=De("webkit"),oe=De("android"),se=De("android 2")||De("android 3"),ae=parseInt(/WebKit\/([0-9]+)|$/.exec(navigator.userAgent)[1],10),le=oe&&De("Google")&&ae<537&&!("AudioNode"in window),ce=!!window.opera,ue=!re&&De("chrome"),he=De("gecko")&&!ne&&!ce&&!te,de=!ue&&De("safari"),pe=De("phantom"),fe="OTransition"in ee,Ae=0===navigator.platform.indexOf("Win"),me=te&&"transition"in ee,ge="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!se,_e="MozPerspective"in ee,ye=!window.L_DISABLE_3D&&(me||ge||_e)&&!fe&&!pe,ve="undefined"!=typeof orientation||De("mobile"),xe=ve&&ne,be=ve&&ge,we=!window.PointerEvent&&window.MSPointerEvent,Te=!(!window.PointerEvent&&!we),Be="ontouchstart"in window||!!window.TouchEvent,Ce=!window.L_NO_TOUCH&&(Be||Te),Se=ve&&ce,Ee=ve&&he,Me=(window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI)>1,Ie=function(){var e=!1;try{var t=Object.defineProperty({},"passive",{get:function(){e=!0}});window.addEventListener("testPassiveEventSupport",c,t),window.removeEventListener("testPassiveEventSupport",c,t)}catch(e){}return e}(),Pe=!!document.createElement("canvas").getContext,Le=!(!document.createElementNS||!X("svg").createSVGRect),Fe=!!Le&&((J=document.createElement("div")).innerHTML="<svg/>","http://www.w3.org/2000/svg"===(J.firstChild&&J.firstChild.namespaceURI)),ke=!Le&&function(){try{var e=document.createElement("div");e.innerHTML='<v:shape adj="1"/>';var t=e.firstChild;return t.style.behavior="url(#default#VML)",t&&"object"==typeof t.adj}catch(e){return!1}}(),ze=0===navigator.platform.indexOf("Mac"),Re=0===navigator.platform.indexOf("Linux");function De(e){return navigator.userAgent.toLowerCase().indexOf(e)>=0}var Oe={ie:te,ielt9:ie,edge:re,webkit:ne,android:oe,android23:se,androidStock:le,opera:ce,chrome:ue,gecko:he,safari:de,phantom:pe,opera12:fe,win:Ae,ie3d:me,webkit3d:ge,gecko3d:_e,any3d:ye,mobile:ve,mobileWebkit:xe,mobileWebkit3d:be,msPointer:we,pointer:Te,touch:Ce,touchNative:Be,mobileOpera:Se,mobileGecko:Ee,retina:Me,passiveEvents:Ie,canvas:Pe,svg:Le,vml:ke,inlineSvg:Fe,mac:ze,linux:Re},Ue=Oe.msPointer?"MSPointerDown":"pointerdown",Ne=Oe.msPointer?"MSPointerMove":"pointermove",Qe=Oe.msPointer?"MSPointerUp":"pointerup",je=Oe.msPointer?"MSPointerCancel":"pointercancel",Ve={touchstart:Ue,touchmove:Ne,touchend:Qe,touchcancel:je},He={touchstart:et,touchmove:Je,touchend:Je,touchcancel:Je},Ge={},$e=!1;function Ze(e,t,i){return"touchstart"===t&&Ye(),He[t]?(i=He[t].bind(this,i),e.addEventListener(Ve[t],i,!1),i):(console.warn("wrong event specified:",t),c)}function qe(e,t,i){Ve[t]?e.removeEventListener(Ve[t],i,!1):console.warn("wrong event specified:",t)}function Ke(e){Ge[e.pointerId]=e}function We(e){Ge[e.pointerId]&&(Ge[e.pointerId]=e)}function Xe(e){delete Ge[e.pointerId]}function Ye(){$e||(document.addEventListener(Ue,Ke,!0),document.addEventListener(Ne,We,!0),document.addEventListener(Qe,Xe,!0),document.addEventListener(je,Xe,!0),$e=!0)}function Je(e,t){if(t.pointerType!==(t.MSPOINTER_TYPE_MOUSE||"mouse")){for(var i in t.touches=[],Ge)t.touches.push(Ge[i]);t.changedTouches=[t],e(t)}}function et(e,t){t.MSPOINTER_TYPE_TOUCH&&t.pointerType===t.MSPOINTER_TYPE_TOUCH&&Kt(t),Je(e,t)}function tt(e){var t,i,r={};for(i in e)t=e[i],r[i]=t&&t.bind?t.bind(e):t;return e=r,r.type="dblclick",r.detail=2,r.isTrusted=!1,r._simulated=!0,r}var it=200;function rt(e,t){e.addEventListener("dblclick",t);var i,r=0;function n(e){if(1===e.detail){if("mouse"!==e.pointerType&&(!e.sourceCapabilities||e.sourceCapabilities.firesTouchEvents)){var n=Xt(e);if(!n.some((function(e){return e instanceof HTMLLabelElement&&e.attributes.for}))||n.some((function(e){return e instanceof HTMLInputElement||e instanceof HTMLSelectElement}))){var o=Date.now();o-r<=it?2==++i&&t(tt(e)):i=1,r=o}}}else i=e.detail}return e.addEventListener("click",n),{dblclick:t,simDblclick:n}}function nt(e,t){e.removeEventListener("dblclick",t.dblclick),e.removeEventListener("click",t.simDblclick)}var ot,st,at,lt,ct,ut=St(["transform","webkitTransform","OTransform","MozTransform","msTransform"]),ht=St(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),dt="webkitTransition"===ht||"OTransition"===ht?ht+"End":"transitionend";function pt(e){return"string"==typeof e?document.getElementById(e):e}function ft(e,t){var i=e.style[t]||e.currentStyle&&e.currentStyle[t];if((!i||"auto"===i)&&document.defaultView){var r=document.defaultView.getComputedStyle(e,null);i=r?r[t]:null}return"auto"===i?null:i}function At(e,t,i){var r=document.createElement(e);return r.className=t||"",i&&i.appendChild(r),r}function mt(e){var t=e.parentNode;t&&t.removeChild(e)}function gt(e){for(;e.firstChild;)e.removeChild(e.firstChild)}function _t(e){var t=e.parentNode;t&&t.lastChild!==e&&t.appendChild(e)}function yt(e){var t=e.parentNode;t&&t.firstChild!==e&&t.insertBefore(e,t.firstChild)}function vt(e,t){if(void 0!==e.classList)return e.classList.contains(t);var i=Tt(e);return i.length>0&&new RegExp("(^|\\s)"+t+"(\\s|$)").test(i)}function xt(e,t){if(void 0!==e.classList)for(var i=d(t),r=0,n=i.length;r<n;r++)e.classList.add(i[r]);else if(!vt(e,t)){var o=Tt(e);wt(e,(o?o+" ":"")+t)}}function bt(e,t){void 0!==e.classList?e.classList.remove(t):wt(e,h((" "+Tt(e)+" ").replace(" "+t+" "," ")))}function wt(e,t){void 0===e.className.baseVal?e.className=t:e.className.baseVal=t}function Tt(e){return e.correspondingElement&&(e=e.correspondingElement),void 0===e.className.baseVal?e.className:e.className.baseVal}function Bt(e,t){"opacity"in e.style?e.style.opacity=t:"filter"in e.style&&Ct(e,t)}function Ct(e,t){var i=!1,r="DXImageTransform.Microsoft.Alpha";try{i=e.filters.item(r)}catch(e){if(1===t)return}t=Math.round(100*t),i?(i.Enabled=100!==t,i.Opacity=t):e.style.filter+=" progid:"+r+"(opacity="+t+")"}function St(e){for(var t=document.documentElement.style,i=0;i<e.length;i++)if(e[i]in t)return e[i];return!1}function Et(e,t,i){var r=t||new F(0,0);e.style[ut]=(Oe.ie3d?"translate("+r.x+"px,"+r.y+"px)":"translate3d("+r.x+"px,"+r.y+"px,0)")+(i?" scale("+i+")":"")}function Mt(e,t){e._leaflet_pos=t,Oe.any3d?Et(e,t):(e.style.left=t.x+"px",e.style.top=t.y+"px")}function It(e){return e._leaflet_pos||new F(0,0)}if("onselectstart"in document)ot=function(){Ut(window,"selectstart",Kt)},st=function(){Qt(window,"selectstart",Kt)};else{var Pt=St(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);ot=function(){if(Pt){var e=document.documentElement.style;at=e[Pt],e[Pt]="none"}},st=function(){Pt&&(document.documentElement.style[Pt]=at,at=void 0)}}function Lt(){Ut(window,"dragstart",Kt)}function Ft(){Qt(window,"dragstart",Kt)}function kt(e){for(;-1===e.tabIndex;)e=e.parentNode;e.style&&(zt(),lt=e,ct=e.style.outlineStyle,e.style.outlineStyle="none",Ut(window,"keydown",zt))}function zt(){lt&&(lt.style.outlineStyle=ct,lt=void 0,ct=void 0,Qt(window,"keydown",zt))}function Rt(e){do{e=e.parentNode}while(!(e.offsetWidth&&e.offsetHeight||e===document.body));return e}function Dt(e){var t=e.getBoundingClientRect();return{x:t.width/e.offsetWidth||1,y:t.height/e.offsetHeight||1,boundingClientRect:t}}var Ot={__proto__:null,TRANSFORM:ut,TRANSITION:ht,TRANSITION_END:dt,get:pt,getStyle:ft,create:At,remove:mt,empty:gt,toFront:_t,toBack:yt,hasClass:vt,addClass:xt,removeClass:bt,setClass:wt,getClass:Tt,setOpacity:Bt,testProp:St,setTransform:Et,setPosition:Mt,getPosition:It,get disableTextSelection(){return ot},get enableTextSelection(){return st},disableImageDrag:Lt,enableImageDrag:Ft,preventOutline:kt,restoreOutline:zt,getSizedParentNode:Rt,getScale:Dt};function Ut(e,t,i,r){if(t&&"object"==typeof t)for(var n in t)Ht(e,n,t[n],i);else for(var o=0,s=(t=d(t)).length;o<s;o++)Ht(e,t[o],i,r);return this}var Nt="_leaflet_events";function Qt(e,t,i,r){if(1===arguments.length)jt(e),delete e[Nt];else if(t&&"object"==typeof t)for(var n in t)Gt(e,n,t[n],i);else if(t=d(t),2===arguments.length)jt(e,(function(e){return-1!==_(t,e)}));else for(var o=0,s=t.length;o<s;o++)Gt(e,t[o],i,r);return this}function jt(e,t){for(var i in e[Nt]){var r=i.split(/\d/)[0];t&&!t(r)||Gt(e,r,null,null,i)}}var Vt={mouseenter:"mouseover",mouseleave:"mouseout",wheel:!("onwheel"in window)&&"mousewheel"};function Ht(e,t,i,r){var n=t+s(i)+(r?"_"+s(r):"");if(e[Nt]&&e[Nt][n])return this;var o=function(t){return i.call(r||e,t||window.event)},a=o;!Oe.touchNative&&Oe.pointer&&0===t.indexOf("touch")?o=Ze(e,t,o):Oe.touch&&"dblclick"===t?o=rt(e,o):"addEventListener"in e?"touchstart"===t||"touchmove"===t||"wheel"===t||"mousewheel"===t?e.addEventListener(Vt[t]||t,o,!!Oe.passiveEvents&&{passive:!1}):"mouseenter"===t||"mouseleave"===t?(o=function(t){t=t||window.event,ti(e,t)&&a(t)},e.addEventListener(Vt[t],o,!1)):e.addEventListener(t,a,!1):e.attachEvent("on"+t,o),e[Nt]=e[Nt]||{},e[Nt][n]=o}function Gt(e,t,i,r,n){n=n||t+s(i)+(r?"_"+s(r):"");var o=e[Nt]&&e[Nt][n];if(!o)return this;!Oe.touchNative&&Oe.pointer&&0===t.indexOf("touch")?qe(e,t,o):Oe.touch&&"dblclick"===t?nt(e,o):"removeEventListener"in e?e.removeEventListener(Vt[t]||t,o,!1):e.detachEvent("on"+t,o),e[Nt][n]=null}function $t(e){return e.stopPropagation?e.stopPropagation():e.originalEvent?e.originalEvent._stopped=!0:e.cancelBubble=!0,this}function Zt(e){return Ht(e,"wheel",$t),this}function qt(e){return Ut(e,"mousedown touchstart dblclick contextmenu",$t),e._leaflet_disable_click=!0,this}function Kt(e){return e.preventDefault?e.preventDefault():e.returnValue=!1,this}function Wt(e){return Kt(e),$t(e),this}function Xt(e){if(e.composedPath)return e.composedPath();for(var t=[],i=e.target;i;)t.push(i),i=i.parentNode;return t}function Yt(e,t){if(!t)return new F(e.clientX,e.clientY);var i=Dt(t),r=i.boundingClientRect;return new F((e.clientX-r.left)/i.x-t.clientLeft,(e.clientY-r.top)/i.y-t.clientTop)}var Jt=Oe.linux&&Oe.chrome?window.devicePixelRatio:Oe.mac?3*window.devicePixelRatio:window.devicePixelRatio>0?2*window.devicePixelRatio:1;function ei(e){return Oe.edge?e.wheelDeltaY/2:e.deltaY&&0===e.deltaMode?-e.deltaY/Jt:e.deltaY&&1===e.deltaMode?20*-e.deltaY:e.deltaY&&2===e.deltaMode?60*-e.deltaY:e.deltaX||e.deltaZ?0:e.wheelDelta?(e.wheelDeltaY||e.wheelDelta)/2:e.detail&&Math.abs(e.detail)<32765?20*-e.detail:e.detail?e.detail/-32765*60:0}function ti(e,t){var i=t.relatedTarget;if(!i)return!0;try{for(;i&&i!==e;)i=i.parentNode}catch(e){return!1}return i!==e}var ii={__proto__:null,on:Ut,off:Qt,stopPropagation:$t,disableScrollPropagation:Zt,disableClickPropagation:qt,preventDefault:Kt,stop:Wt,getPropagationPath:Xt,getMousePosition:Yt,getWheelDelta:ei,isExternalTarget:ti,addListener:Ut,removeListener:Qt},ri=P.extend({run:function(e,t,i,r){this.stop(),this._el=e,this._inProgress=!0,this._duration=i||.25,this._easeOutPower=1/Math.max(r||.5,.2),this._startPos=It(e),this._offset=t.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(!0),this._complete())},_animate:function(){this._animId=B(this._animate,this),this._step()},_step:function(e){var t=+new Date-this._startTime,i=1e3*this._duration;t<i?this._runFrame(this._easeOut(t/i),e):(this._runFrame(1),this._complete())},_runFrame:function(e,t){var i=this._startPos.add(this._offset.multiplyBy(e));t&&i._round(),Mt(this._el,i),this.fire("step")},_complete:function(){C(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(e){return 1-Math.pow(1-e,this._easeOutPower)}}),ni=P.extend({options:{crs:K,center:void 0,zoom:void 0,minZoom:void 0,maxZoom:void 0,layers:[],maxBounds:void 0,renderer:void 0,zoomAnimation:!0,zoomAnimationThreshold:4,fadeAnimation:!0,markerZoomAnimation:!0,transform3DLimit:8388608,zoomSnap:1,zoomDelta:1,trackResize:!0},initialize:function(e,t){t=p(this,t),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._sizeChanged=!0,this._initContainer(e),this._initLayout(),this._onResize=n(this._onResize,this),this._initEvents(),t.maxBounds&&this.setMaxBounds(t.maxBounds),void 0!==t.zoom&&(this._zoom=this._limitZoom(t.zoom)),t.center&&void 0!==t.zoom&&this.setView(Q(t.center),t.zoom,{reset:!0}),this.callInitHooks(),this._zoomAnimated=ht&&Oe.any3d&&!Oe.mobileOpera&&this.options.zoomAnimation,this._zoomAnimated&&(this._createAnimProxy(),Ut(this._proxy,dt,this._catchTransitionEnd,this)),this._addLayers(this.options.layers)},setView:function(e,t,r){return t=void 0===t?this._zoom:this._limitZoom(t),e=this._limitCenter(Q(e),t,this.options.maxBounds),r=r||{},this._stop(),this._loaded&&!r.reset&&!0!==r&&(void 0!==r.animate&&(r.zoom=i({animate:r.animate},r.zoom),r.pan=i({animate:r.animate,duration:r.duration},r.pan)),this._zoom!==t?this._tryAnimatedZoom&&this._tryAnimatedZoom(e,t,r.zoom):this._tryAnimatedPan(e,r.pan))?(clearTimeout(this._sizeTimer),this):(this._resetView(e,t,r.pan&&r.pan.noMoveStart),this)},setZoom:function(e,t){return this._loaded?this.setView(this.getCenter(),e,{zoom:t}):(this._zoom=e,this)},zoomIn:function(e,t){return e=e||(Oe.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom+e,t)},zoomOut:function(e,t){return e=e||(Oe.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom-e,t)},setZoomAround:function(e,t,i){var r=this.getZoomScale(t),n=this.getSize().divideBy(2),o=(e instanceof F?e:this.latLngToContainerPoint(e)).subtract(n).multiplyBy(1-1/r),s=this.containerPointToLatLng(n.add(o));return this.setView(s,t,{zoom:i})},_getBoundsCenterZoom:function(e,t){t=t||{},e=e.getBounds?e.getBounds():U(e);var i=z(t.paddingTopLeft||t.padding||[0,0]),r=z(t.paddingBottomRight||t.padding||[0,0]),n=this.getBoundsZoom(e,!1,i.add(r));if((n="number"==typeof t.maxZoom?Math.min(t.maxZoom,n):n)===1/0)return{center:e.getCenter(),zoom:n};var o=r.subtract(i).divideBy(2),s=this.project(e.getSouthWest(),n),a=this.project(e.getNorthEast(),n);return{center:this.unproject(s.add(a).divideBy(2).add(o),n),zoom:n}},fitBounds:function(e,t){if(!(e=U(e)).isValid())throw new Error("Bounds are not valid.");var i=this._getBoundsCenterZoom(e,t);return this.setView(i.center,i.zoom,t)},fitWorld:function(e){return this.fitBounds([[-90,-180],[90,180]],e)},panTo:function(e,t){return this.setView(e,this._zoom,{pan:t})},panBy:function(e,t){if(t=t||{},!(e=z(e).round()).x&&!e.y)return this.fire("moveend");if(!0!==t.animate&&!this.getSize().contains(e))return this._resetView(this.unproject(this.project(this.getCenter()).add(e)),this.getZoom()),this;if(this._panAnim||(this._panAnim=new ri,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),t.noMoveStart||this.fire("movestart"),!1!==t.animate){xt(this._mapPane,"leaflet-pan-anim");var i=this._getMapPanePos().subtract(e).round();this._panAnim.run(this._mapPane,i,t.duration||.25,t.easeLinearity)}else this._rawPanBy(e),this.fire("move").fire("moveend");return this},flyTo:function(e,t,i){if(!1===(i=i||{}).animate||!Oe.any3d)return this.setView(e,t,i);this._stop();var r=this.project(this.getCenter()),n=this.project(e),o=this.getSize(),s=this._zoom;e=Q(e),t=void 0===t?s:t;var a=Math.max(o.x,o.y),l=a*this.getZoomScale(s,t),c=n.distanceTo(r)||1,u=1.42,h=u*u;function d(e){var t=(l*l-a*a+(e?-1:1)*h*h*c*c)/(2*(e?l:a)*h*c),i=Math.sqrt(t*t+1)-t;return i<1e-9?-18:Math.log(i)}function p(e){return(Math.exp(e)-Math.exp(-e))/2}function f(e){return(Math.exp(e)+Math.exp(-e))/2}function A(e){return p(e)/f(e)}var m=d(0);function g(e){return a*(f(m)/f(m+u*e))}function _(e){return a*(f(m)*A(m+u*e)-p(m))/h}function y(e){return 1-Math.pow(1-e,1.5)}var v=Date.now(),x=(d(1)-m)/u,b=i.duration?1e3*i.duration:1e3*x*.8;function w(){var i=(Date.now()-v)/b,o=y(i)*x;i<=1?(this._flyToFrame=B(w,this),this._move(this.unproject(r.add(n.subtract(r).multiplyBy(_(o)/c)),s),this.getScaleZoom(a/g(o),s),{flyTo:!0})):this._move(e,t)._moveEnd(!0)}return this._moveStart(!0,i.noMoveStart),w.call(this),this},flyToBounds:function(e,t){var i=this._getBoundsCenterZoom(e,t);return this.flyTo(i.center,i.zoom,t)},setMaxBounds:function(e){return e=U(e),this.listens("moveend",this._panInsideMaxBounds)&&this.off("moveend",this._panInsideMaxBounds),e.isValid()?(this.options.maxBounds=e,this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds)):(this.options.maxBounds=null,this)},setMinZoom:function(e){var t=this.options.minZoom;return this.options.minZoom=e,this._loaded&&t!==e&&(this.fire("zoomlevelschange"),this.getZoom()<this.options.minZoom)?this.setZoom(e):this},setMaxZoom:function(e){var t=this.options.maxZoom;return this.options.maxZoom=e,this._loaded&&t!==e&&(this.fire("zoomlevelschange"),this.getZoom()>this.options.maxZoom)?this.setZoom(e):this},panInsideBounds:function(e,t){this._enforcingBounds=!0;var i=this.getCenter(),r=this._limitCenter(i,this._zoom,U(e));return i.equals(r)||this.panTo(r,t),this._enforcingBounds=!1,this},panInside:function(e,t){var i=z((t=t||{}).paddingTopLeft||t.padding||[0,0]),r=z(t.paddingBottomRight||t.padding||[0,0]),n=this.project(this.getCenter()),o=this.project(e),s=this.getPixelBounds(),a=D([s.min.add(i),s.max.subtract(r)]),l=a.getSize();if(!a.contains(o)){this._enforcingBounds=!0;var c=o.subtract(a.getCenter()),u=a.extend(o).getSize().subtract(l);n.x+=c.x<0?-u.x:u.x,n.y+=c.y<0?-u.y:u.y,this.panTo(this.unproject(n),t),this._enforcingBounds=!1}return this},invalidateSize:function(e){if(!this._loaded)return this;e=i({animate:!1,pan:!0},!0===e?{animate:!0}:e);var t=this.getSize();this._sizeChanged=!0,this._lastCenter=null;var r=this.getSize(),o=t.divideBy(2).round(),s=r.divideBy(2).round(),a=o.subtract(s);return a.x||a.y?(e.animate&&e.pan?this.panBy(a):(e.pan&&this._rawPanBy(a),this.fire("move"),e.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(n(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:t,newSize:r})):this},stop:function(){return this.setZoom(this._limitZoom(this._zoom)),this.options.zoomSnap||this.fire("viewreset"),this._stop()},locate:function(e){if(e=this._locateOptions=i({timeout:1e4,watch:!1},e),!("geolocation"in navigator))return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var t=n(this._handleGeolocationResponse,this),r=n(this._handleGeolocationError,this);return e.watch?this._locationWatchId=navigator.geolocation.watchPosition(t,r,e):navigator.geolocation.getCurrentPosition(t,r,e),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(e){if(this._container._leaflet_id){var t=e.code,i=e.message||(1===t?"permission denied":2===t?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:t,message:"Geolocation error: "+i+"."})}},_handleGeolocationResponse:function(e){if(this._container._leaflet_id){var t=new N(e.coords.latitude,e.coords.longitude),i=t.toBounds(2*e.coords.accuracy),r=this._locateOptions;if(r.setView){var n=this.getBoundsZoom(i);this.setView(t,r.maxZoom?Math.min(n,r.maxZoom):n)}var o={latlng:t,bounds:i,timestamp:e.timestamp};for(var s in e.coords)"number"==typeof e.coords[s]&&(o[s]=e.coords[s]);this.fire("locationfound",o)}},addHandler:function(e,t){if(!t)return this;var i=this[e]=new t(this);return this._handlers.push(i),this.options[e]&&i.enable(),this},remove:function(){if(this._initEvents(!0),this.options.maxBounds&&this.off("moveend",this._panInsideMaxBounds),this._containerId!==this._container._leaflet_id)throw new Error("Map container is being reused by another instance");try{delete this._container._leaflet_id,delete this._containerId}catch(e){this._container._leaflet_id=void 0,this._containerId=void 0}var e;for(e in void 0!==this._locationWatchId&&this.stopLocate(),this._stop(),mt(this._mapPane),this._clearControlPos&&this._clearControlPos(),this._resizeRequest&&(C(this._resizeRequest),this._resizeRequest=null),this._clearHandlers(),this._loaded&&this.fire("unload"),this._layers)this._layers[e].remove();for(e in this._panes)mt(this._panes[e]);return this._layers=[],this._panes=[],delete this._mapPane,delete this._renderer,this},createPane:function(e,t){var i=At("div","leaflet-pane"+(e?" leaflet-"+e.replace("Pane","")+"-pane":""),t||this._mapPane);return e&&(this._panes[e]=i),i},getCenter:function(){return this._checkIfLoaded(),this._lastCenter&&!this._moved()?this._lastCenter.clone():this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var e=this.getPixelBounds();return new O(this.unproject(e.getBottomLeft()),this.unproject(e.getTopRight()))},getMinZoom:function(){return void 0===this.options.minZoom?this._layersMinZoom||0:this.options.minZoom},getMaxZoom:function(){return void 0===this.options.maxZoom?void 0===this._layersMaxZoom?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(e,t,i){e=U(e),i=z(i||[0,0]);var r=this.getZoom()||0,n=this.getMinZoom(),o=this.getMaxZoom(),s=e.getNorthWest(),a=e.getSouthEast(),l=this.getSize().subtract(i),c=D(this.project(a,r),this.project(s,r)).getSize(),u=Oe.any3d?this.options.zoomSnap:1,h=l.x/c.x,d=l.y/c.y,p=t?Math.max(h,d):Math.min(h,d);return r=this.getScaleZoom(p,r),u&&(r=Math.round(r/(u/100))*(u/100),r=t?Math.ceil(r/u)*u:Math.floor(r/u)*u),Math.max(n,Math.min(o,r))},getSize:function(){return this._size&&!this._sizeChanged||(this._size=new F(this._container.clientWidth||0,this._container.clientHeight||0),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(e,t){var i=this._getTopLeftPoint(e,t);return new R(i,i.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._pixelOrigin},getPixelWorldBounds:function(e){return this.options.crs.getProjectedBounds(void 0===e?this.getZoom():e)},getPane:function(e){return"string"==typeof e?this._panes[e]:e},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(e,t){var i=this.options.crs;return t=void 0===t?this._zoom:t,i.scale(e)/i.scale(t)},getScaleZoom:function(e,t){var i=this.options.crs;t=void 0===t?this._zoom:t;var r=i.zoom(e*i.scale(t));return isNaN(r)?1/0:r},project:function(e,t){return t=void 0===t?this._zoom:t,this.options.crs.latLngToPoint(Q(e),t)},unproject:function(e,t){return t=void 0===t?this._zoom:t,this.options.crs.pointToLatLng(z(e),t)},layerPointToLatLng:function(e){var t=z(e).add(this.getPixelOrigin());return this.unproject(t)},latLngToLayerPoint:function(e){return this.project(Q(e))._round()._subtract(this.getPixelOrigin())},wrapLatLng:function(e){return this.options.crs.wrapLatLng(Q(e))},wrapLatLngBounds:function(e){return this.options.crs.wrapLatLngBounds(U(e))},distance:function(e,t){return this.options.crs.distance(Q(e),Q(t))},containerPointToLayerPoint:function(e){return z(e).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(e){return z(e).add(this._getMapPanePos())},containerPointToLatLng:function(e){var t=this.containerPointToLayerPoint(z(e));return this.layerPointToLatLng(t)},latLngToContainerPoint:function(e){return this.layerPointToContainerPoint(this.latLngToLayerPoint(Q(e)))},mouseEventToContainerPoint:function(e){return Yt(e,this._container)},mouseEventToLayerPoint:function(e){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(e))},mouseEventToLatLng:function(e){return this.layerPointToLatLng(this.mouseEventToLayerPoint(e))},_initContainer:function(e){var t=this._container=pt(e);if(!t)throw new Error("Map container not found.");if(t._leaflet_id)throw new Error("Map container is already initialized.");Ut(t,"scroll",this._onScroll,this),this._containerId=s(t)},_initLayout:function(){var e=this._container;this._fadeAnimated=this.options.fadeAnimation&&Oe.any3d,xt(e,"leaflet-container"+(Oe.touch?" leaflet-touch":"")+(Oe.retina?" leaflet-retina":"")+(Oe.ielt9?" leaflet-oldie":"")+(Oe.safari?" leaflet-safari":"")+(this._fadeAnimated?" leaflet-fade-anim":""));var t=ft(e,"position");"absolute"!==t&&"relative"!==t&&"fixed"!==t&&"sticky"!==t&&(e.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var e=this._panes={};this._paneRenderers={},this._mapPane=this.createPane("mapPane",this._container),Mt(this._mapPane,new F(0,0)),this.createPane("tilePane"),this.createPane("overlayPane"),this.createPane("shadowPane"),this.createPane("markerPane"),this.createPane("tooltipPane"),this.createPane("popupPane"),this.options.markerZoomAnimation||(xt(e.markerPane,"leaflet-zoom-hide"),xt(e.shadowPane,"leaflet-zoom-hide"))},_resetView:function(e,t,i){Mt(this._mapPane,new F(0,0));var r=!this._loaded;this._loaded=!0,t=this._limitZoom(t),this.fire("viewprereset");var n=this._zoom!==t;this._moveStart(n,i)._move(e,t)._moveEnd(n),this.fire("viewreset"),r&&this.fire("load")},_moveStart:function(e,t){return e&&this.fire("zoomstart"),t||this.fire("movestart"),this},_move:function(e,t,i,r){void 0===t&&(t=this._zoom);var n=this._zoom!==t;return this._zoom=t,this._lastCenter=e,this._pixelOrigin=this._getNewPixelOrigin(e),r?i&&i.pinch&&this.fire("zoom",i):((n||i&&i.pinch)&&this.fire("zoom",i),this.fire("move",i)),this},_moveEnd:function(e){return e&&this.fire("zoomend"),this.fire("moveend")},_stop:function(){return C(this._flyToFrame),this._panAnim&&this._panAnim.stop(),this},_rawPanBy:function(e){Mt(this._mapPane,this._getMapPanePos().subtract(e))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_panInsideMaxBounds:function(){this._enforcingBounds||this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(e){this._targets={},this._targets[s(this._container)]=this;var t=e?Qt:Ut;t(this._container,"click dblclick mousedown mouseup mouseover mouseout mousemove contextmenu keypress keydown keyup",this._handleDOMEvent,this),this.options.trackResize&&t(window,"resize",this._onResize,this),Oe.any3d&&this.options.transform3DLimit&&(e?this.off:this.on).call(this,"moveend",this._onMoveEnd)},_onResize:function(){C(this._resizeRequest),this._resizeRequest=B((function(){this.invalidateSize({debounceMoveend:!0})}),this)},_onScroll:function(){this._container.scrollTop=0,this._container.scrollLeft=0},_onMoveEnd:function(){var e=this._getMapPanePos();Math.max(Math.abs(e.x),Math.abs(e.y))>=this.options.transform3DLimit&&this._resetView(this.getCenter(),this.getZoom())},_findEventTargets:function(e,t){for(var i,r=[],n="mouseout"===t||"mouseover"===t,o=e.target||e.srcElement,a=!1;o;){if((i=this._targets[s(o)])&&("click"===t||"preclick"===t)&&this._draggableMoved(i)){a=!0;break}if(i&&i.listens(t,!0)){if(n&&!ti(o,e))break;if(r.push(i),n)break}if(o===this._container)break;o=o.parentNode}return r.length||a||n||!this.listens(t,!0)||(r=[this]),r},_isClickDisabled:function(e){for(;e&&e!==this._container;){if(e._leaflet_disable_click)return!0;e=e.parentNode}},_handleDOMEvent:function(e){var t=e.target||e.srcElement;if(!(!this._loaded||t._leaflet_disable_events||"click"===e.type&&this._isClickDisabled(t))){var i=e.type;"mousedown"===i&&kt(t),this._fireDOMEvent(e,i)}},_mouseEvents:["click","dblclick","mouseover","mouseout","contextmenu"],_fireDOMEvent:function(e,t,r){if("click"===e.type){var n=i({},e);n.type="preclick",this._fireDOMEvent(n,n.type,r)}var o=this._findEventTargets(e,t);if(r){for(var s=[],a=0;a<r.length;a++)r[a].listens(t,!0)&&s.push(r[a]);o=s.concat(o)}if(o.length){"contextmenu"===t&&Kt(e);var l=o[0],c={originalEvent:e};if("keypress"!==e.type&&"keydown"!==e.type&&"keyup"!==e.type){var u=l.getLatLng&&(!l._radius||l._radius<=10);c.containerPoint=u?this.latLngToContainerPoint(l.getLatLng()):this.mouseEventToContainerPoint(e),c.layerPoint=this.containerPointToLayerPoint(c.containerPoint),c.latlng=u?l.getLatLng():this.layerPointToLatLng(c.layerPoint)}for(a=0;a<o.length;a++)if(o[a].fire(t,c,!0),c.originalEvent._stopped||!1===o[a].options.bubblingMouseEvents&&-1!==_(this._mouseEvents,t))return}},_draggableMoved:function(e){return(e=e.dragging&&e.dragging.enabled()?e:this).dragging&&e.dragging.moved()||this.boxZoom&&this.boxZoom.moved()},_clearHandlers:function(){for(var e=0,t=this._handlers.length;e<t;e++)this._handlers[e].disable()},whenReady:function(e,t){return this._loaded?e.call(t||this,{target:this}):this.on("load",e,t),this},_getMapPanePos:function(){return It(this._mapPane)||new F(0,0)},_moved:function(){var e=this._getMapPanePos();return e&&!e.equals([0,0])},_getTopLeftPoint:function(e,t){return(e&&void 0!==t?this._getNewPixelOrigin(e,t):this.getPixelOrigin()).subtract(this._getMapPanePos())},_getNewPixelOrigin:function(e,t){var i=this.getSize()._divideBy(2);return this.project(e,t)._subtract(i)._add(this._getMapPanePos())._round()},_latLngToNewLayerPoint:function(e,t,i){var r=this._getNewPixelOrigin(i,t);return this.project(e,t)._subtract(r)},_latLngBoundsToNewLayerBounds:function(e,t,i){var r=this._getNewPixelOrigin(i,t);return D([this.project(e.getSouthWest(),t)._subtract(r),this.project(e.getNorthWest(),t)._subtract(r),this.project(e.getSouthEast(),t)._subtract(r),this.project(e.getNorthEast(),t)._subtract(r)])},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(e){return this.latLngToLayerPoint(e).subtract(this._getCenterLayerPoint())},_limitCenter:function(e,t,i){if(!i)return e;var r=this.project(e,t),n=this.getSize().divideBy(2),o=new R(r.subtract(n),r.add(n)),s=this._getBoundsOffset(o,i,t);return Math.abs(s.x)<=1&&Math.abs(s.y)<=1?e:this.unproject(r.add(s),t)},_limitOffset:function(e,t){if(!t)return e;var i=this.getPixelBounds(),r=new R(i.min.add(e),i.max.add(e));return e.add(this._getBoundsOffset(r,t))},_getBoundsOffset:function(e,t,i){var r=D(this.project(t.getNorthEast(),i),this.project(t.getSouthWest(),i)),n=r.min.subtract(e.min),o=r.max.subtract(e.max);return new F(this._rebound(n.x,-o.x),this._rebound(n.y,-o.y))},_rebound:function(e,t){return e+t>0?Math.round(e-t)/2:Math.max(0,Math.ceil(e))-Math.max(0,Math.floor(t))},_limitZoom:function(e){var t=this.getMinZoom(),i=this.getMaxZoom(),r=Oe.any3d?this.options.zoomSnap:1;return r&&(e=Math.round(e/r)*r),Math.max(t,Math.min(i,e))},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){bt(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(e,t){var i=this._getCenterOffset(e)._trunc();return!(!0!==(t&&t.animate)&&!this.getSize().contains(i)||(this.panBy(i,t),0))},_createAnimProxy:function(){var e=this._proxy=At("div","leaflet-proxy leaflet-zoom-animated");this._panes.mapPane.appendChild(e),this.on("zoomanim",(function(e){var t=ut,i=this._proxy.style[t];Et(this._proxy,this.project(e.center,e.zoom),this.getZoomScale(e.zoom,1)),i===this._proxy.style[t]&&this._animatingZoom&&this._onZoomTransitionEnd()}),this),this.on("load moveend",this._animMoveEnd,this),this._on("unload",this._destroyAnimProxy,this)},_destroyAnimProxy:function(){mt(this._proxy),this.off("load moveend",this._animMoveEnd,this),delete this._proxy},_animMoveEnd:function(){var e=this.getCenter(),t=this.getZoom();Et(this._proxy,this.project(e,t),this.getZoomScale(t,1))},_catchTransitionEnd:function(e){this._animatingZoom&&e.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(e,t,i){if(this._animatingZoom)return!0;if(i=i||{},!this._zoomAnimated||!1===i.animate||this._nothingToAnimate()||Math.abs(t-this._zoom)>this.options.zoomAnimationThreshold)return!1;var r=this.getZoomScale(t),n=this._getCenterOffset(e)._divideBy(1-1/r);return!(!0!==i.animate&&!this.getSize().contains(n)||(B((function(){this._moveStart(!0,i.noMoveStart||!1)._animateZoom(e,t,!0)}),this),0))},_animateZoom:function(e,t,i,r){this._mapPane&&(i&&(this._animatingZoom=!0,this._animateToCenter=e,this._animateToZoom=t,xt(this._mapPane,"leaflet-zoom-anim")),this.fire("zoomanim",{center:e,zoom:t,noUpdate:r}),this._tempFireZoomEvent||(this._tempFireZoomEvent=this._zoom!==this._animateToZoom),this._move(this._animateToCenter,this._animateToZoom,void 0,!0),setTimeout(n(this._onZoomTransitionEnd,this),250))},_onZoomTransitionEnd:function(){this._animatingZoom&&(this._mapPane&&bt(this._mapPane,"leaflet-zoom-anim"),this._animatingZoom=!1,this._move(this._animateToCenter,this._animateToZoom,void 0,!0),this._tempFireZoomEvent&&this.fire("zoom"),delete this._tempFireZoomEvent,this.fire("move"),this._moveEnd(!0))}});function oi(e,t){return new ni(e,t)}var si=E.extend({options:{position:"topright"},initialize:function(e){p(this,e)},getPosition:function(){return this.options.position},setPosition:function(e){var t=this._map;return t&&t.removeControl(this),this.options.position=e,t&&t.addControl(this),this},getContainer:function(){return this._container},addTo:function(e){this.remove(),this._map=e;var t=this._container=this.onAdd(e),i=this.getPosition(),r=e._controlCorners[i];return xt(t,"leaflet-control"),-1!==i.indexOf("bottom")?r.insertBefore(t,r.firstChild):r.appendChild(t),this._map.on("unload",this.remove,this),this},remove:function(){return this._map?(mt(this._container),this.onRemove&&this.onRemove(this._map),this._map.off("unload",this.remove,this),this._map=null,this):this},_refocusOnMap:function(e){this._map&&e&&e.screenX>0&&e.screenY>0&&this._map.getContainer().focus()}}),ai=function(e){return new si(e)};ni.include({addControl:function(e){return e.addTo(this),this},removeControl:function(e){return e.remove(),this},_initControlPos:function(){var e=this._controlCorners={},t="leaflet-",i=this._controlContainer=At("div",t+"control-container",this._container);function r(r,n){var o=t+r+" "+t+n;e[r+n]=At("div",o,i)}r("top","left"),r("top","right"),r("bottom","left"),r("bottom","right")},_clearControlPos:function(){for(var e in this._controlCorners)mt(this._controlCorners[e]);mt(this._controlContainer),delete this._controlCorners,delete this._controlContainer}});var li=si.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,sortFunction:function(e,t,i,r){return i<r?-1:r<i?1:0}},initialize:function(e,t,i){for(var r in p(this,i),this._layerControlInputs=[],this._layers=[],this._lastZIndex=0,this._handlingClick=!1,this._preventClick=!1,e)this._addLayer(e[r],r);for(r in t)this._addLayer(t[r],r,!0)},onAdd:function(e){this._initLayout(),this._update(),this._map=e,e.on("zoomend",this._checkDisabledLayers,this);for(var t=0;t<this._layers.length;t++)this._layers[t].layer.on("add remove",this._onLayerChange,this);return this._container},addTo:function(e){return si.prototype.addTo.call(this,e),this._expandIfNotCollapsed()},onRemove:function(){this._map.off("zoomend",this._checkDisabledLayers,this);for(var e=0;e<this._layers.length;e++)this._layers[e].layer.off("add remove",this._onLayerChange,this)},addBaseLayer:function(e,t){return this._addLayer(e,t),this._map?this._update():this},addOverlay:function(e,t){return this._addLayer(e,t,!0),this._map?this._update():this},removeLayer:function(e){e.off("add remove",this._onLayerChange,this);var t=this._getLayer(s(e));return t&&this._layers.splice(this._layers.indexOf(t),1),this._map?this._update():this},expand:function(){xt(this._container,"leaflet-control-layers-expanded"),this._section.style.height=null;var e=this._map.getSize().y-(this._container.offsetTop+50);return e<this._section.clientHeight?(xt(this._section,"leaflet-control-layers-scrollbar"),this._section.style.height=e+"px"):bt(this._section,"leaflet-control-layers-scrollbar"),this._checkDisabledLayers(),this},collapse:function(){return bt(this._container,"leaflet-control-layers-expanded"),this},_initLayout:function(){var e="leaflet-control-layers",t=this._container=At("div",e),i=this.options.collapsed;t.setAttribute("aria-haspopup",!0),qt(t),Zt(t);var r=this._section=At("section",e+"-list");i&&(this._map.on("click",this.collapse,this),Ut(t,{mouseenter:this._expandSafely,mouseleave:this.collapse},this));var n=this._layersLink=At("a",e+"-toggle",t);n.href="#",n.title="Layers",n.setAttribute("role","button"),Ut(n,{keydown:function(e){13===e.keyCode&&this._expandSafely()},click:function(e){Kt(e),this._expandSafely()}},this),i||this.expand(),this._baseLayersList=At("div",e+"-base",r),this._separator=At("div",e+"-separator",r),this._overlaysList=At("div",e+"-overlays",r),t.appendChild(r)},_getLayer:function(e){for(var t=0;t<this._layers.length;t++)if(this._layers[t]&&s(this._layers[t].layer)===e)return this._layers[t]},_addLayer:function(e,t,i){this._map&&e.on("add remove",this._onLayerChange,this),this._layers.push({layer:e,name:t,overlay:i}),this.options.sortLayers&&this._layers.sort(n((function(e,t){return this.options.sortFunction(e.layer,t.layer,e.name,t.name)}),this)),this.options.autoZIndex&&e.setZIndex&&(this._lastZIndex++,e.setZIndex(this._lastZIndex)),this._expandIfNotCollapsed()},_update:function(){if(!this._container)return this;gt(this._baseLayersList),gt(this._overlaysList),this._layerControlInputs=[];var e,t,i,r,n=0;for(i=0;i<this._layers.length;i++)r=this._layers[i],this._addItem(r),t=t||r.overlay,e=e||!r.overlay,n+=r.overlay?0:1;return this.options.hideSingleBase&&(e=e&&n>1,this._baseLayersList.style.display=e?"":"none"),this._separator.style.display=t&&e?"":"none",this},_onLayerChange:function(e){this._handlingClick||this._update();var t=this._getLayer(s(e.target)),i=t.overlay?"add"===e.type?"overlayadd":"overlayremove":"add"===e.type?"baselayerchange":null;i&&this._map.fire(i,t)},_createRadioElement:function(e,t){var i='<input type="radio" class="leaflet-control-layers-selector" name="'+e+'"'+(t?' checked="checked"':"")+"/>",r=document.createElement("div");return r.innerHTML=i,r.firstChild},_addItem:function(e){var t,i=document.createElement("label"),r=this._map.hasLayer(e.layer);e.overlay?((t=document.createElement("input")).type="checkbox",t.className="leaflet-control-layers-selector",t.defaultChecked=r):t=this._createRadioElement("leaflet-base-layers_"+s(this),r),this._layerControlInputs.push(t),t.layerId=s(e.layer),Ut(t,"click",this._onInputClick,this);var n=document.createElement("span");n.innerHTML=" "+e.name;var o=document.createElement("span");return i.appendChild(o),o.appendChild(t),o.appendChild(n),(e.overlay?this._overlaysList:this._baseLayersList).appendChild(i),this._checkDisabledLayers(),i},_onInputClick:function(){if(!this._preventClick){var e,t,i=this._layerControlInputs,r=[],n=[];this._handlingClick=!0;for(var o=i.length-1;o>=0;o--)e=i[o],t=this._getLayer(e.layerId).layer,e.checked?r.push(t):e.checked||n.push(t);for(o=0;o<n.length;o++)this._map.hasLayer(n[o])&&this._map.removeLayer(n[o]);for(o=0;o<r.length;o++)this._map.hasLayer(r[o])||this._map.addLayer(r[o]);this._handlingClick=!1,this._refocusOnMap()}},_checkDisabledLayers:function(){for(var e,t,i=this._layerControlInputs,r=this._map.getZoom(),n=i.length-1;n>=0;n--)e=i[n],t=this._getLayer(e.layerId).layer,e.disabled=void 0!==t.options.minZoom&&r<t.options.minZoom||void 0!==t.options.maxZoom&&r>t.options.maxZoom},_expandIfNotCollapsed:function(){return this._map&&!this.options.collapsed&&this.expand(),this},_expandSafely:function(){var e=this._section;this._preventClick=!0,Ut(e,"click",Kt),this.expand();var t=this;setTimeout((function(){Qt(e,"click",Kt),t._preventClick=!1}))}}),ci=function(e,t,i){return new li(e,t,i)},ui=si.extend({options:{position:"topleft",zoomInText:'<span aria-hidden="true">+</span>',zoomInTitle:"Zoom in",zoomOutText:'<span aria-hidden="true">&#x2212;</span>',zoomOutTitle:"Zoom out"},onAdd:function(e){var t="leaflet-control-zoom",i=At("div",t+" leaflet-bar"),r=this.options;return this._zoomInButton=this._createButton(r.zoomInText,r.zoomInTitle,t+"-in",i,this._zoomIn),this._zoomOutButton=this._createButton(r.zoomOutText,r.zoomOutTitle,t+"-out",i,this._zoomOut),this._updateDisabled(),e.on("zoomend zoomlevelschange",this._updateDisabled,this),i},onRemove:function(e){e.off("zoomend zoomlevelschange",this._updateDisabled,this)},disable:function(){return this._disabled=!0,this._updateDisabled(),this},enable:function(){return this._disabled=!1,this._updateDisabled(),this},_zoomIn:function(e){!this._disabled&&this._map._zoom<this._map.getMaxZoom()&&this._map.zoomIn(this._map.options.zoomDelta*(e.shiftKey?3:1))},_zoomOut:function(e){!this._disabled&&this._map._zoom>this._map.getMinZoom()&&this._map.zoomOut(this._map.options.zoomDelta*(e.shiftKey?3:1))},_createButton:function(e,t,i,r,n){var o=At("a",i,r);return o.innerHTML=e,o.href="#",o.title=t,o.setAttribute("role","button"),o.setAttribute("aria-label",t),qt(o),Ut(o,"click",Wt),Ut(o,"click",n,this),Ut(o,"click",this._refocusOnMap,this),o},_updateDisabled:function(){var e=this._map,t="leaflet-disabled";bt(this._zoomInButton,t),bt(this._zoomOutButton,t),this._zoomInButton.setAttribute("aria-disabled","false"),this._zoomOutButton.setAttribute("aria-disabled","false"),(this._disabled||e._zoom===e.getMinZoom())&&(xt(this._zoomOutButton,t),this._zoomOutButton.setAttribute("aria-disabled","true")),(this._disabled||e._zoom===e.getMaxZoom())&&(xt(this._zoomInButton,t),this._zoomInButton.setAttribute("aria-disabled","true"))}});ni.mergeOptions({zoomControl:!0}),ni.addInitHook((function(){this.options.zoomControl&&(this.zoomControl=new ui,this.addControl(this.zoomControl))}));var hi=function(e){return new ui(e)},di=si.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0},onAdd:function(e){var t="leaflet-control-scale",i=At("div",t),r=this.options;return this._addScales(r,t+"-line",i),e.on(r.updateWhenIdle?"moveend":"move",this._update,this),e.whenReady(this._update,this),i},onRemove:function(e){e.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(e,t,i){e.metric&&(this._mScale=At("div",t,i)),e.imperial&&(this._iScale=At("div",t,i))},_update:function(){var e=this._map,t=e.getSize().y/2,i=e.distance(e.containerPointToLatLng([0,t]),e.containerPointToLatLng([this.options.maxWidth,t]));this._updateScales(i)},_updateScales:function(e){this.options.metric&&e&&this._updateMetric(e),this.options.imperial&&e&&this._updateImperial(e)},_updateMetric:function(e){var t=this._getRoundNum(e),i=t<1e3?t+" m":t/1e3+" km";this._updateScale(this._mScale,i,t/e)},_updateImperial:function(e){var t,i,r,n=3.2808399*e;n>5280?(t=n/5280,i=this._getRoundNum(t),this._updateScale(this._iScale,i+" mi",i/t)):(r=this._getRoundNum(n),this._updateScale(this._iScale,r+" ft",r/n))},_updateScale:function(e,t,i){e.style.width=Math.round(this.options.maxWidth*i)+"px",e.innerHTML=t},_getRoundNum:function(e){var t=Math.pow(10,(Math.floor(e)+"").length-1),i=e/t;return t*(i=i>=10?10:i>=5?5:i>=3?3:i>=2?2:1)}}),pi=function(e){return new di(e)},fi='<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="12" height="8" viewBox="0 0 12 8" class="leaflet-attribution-flag"><path fill="#4C7BE1" d="M0 0h12v4H0z"/><path fill="#FFD500" d="M0 4h12v3H0z"/><path fill="#E0BC00" d="M0 7h12v1H0z"/></svg>',Ai=si.extend({options:{position:"bottomright",prefix:'<a href="https://leafletjs.com" title="A JavaScript library for interactive maps">'+(Oe.inlineSvg?fi+" ":"")+"Leaflet</a>"},initialize:function(e){p(this,e),this._attributions={}},onAdd:function(e){for(var t in e.attributionControl=this,this._container=At("div","leaflet-control-attribution"),qt(this._container),e._layers)e._layers[t].getAttribution&&this.addAttribution(e._layers[t].getAttribution());return this._update(),e.on("layeradd",this._addAttribution,this),this._container},onRemove:function(e){e.off("layeradd",this._addAttribution,this)},_addAttribution:function(e){e.layer.getAttribution&&(this.addAttribution(e.layer.getAttribution()),e.layer.once("remove",(function(){this.removeAttribution(e.layer.getAttribution())}),this))},setPrefix:function(e){return this.options.prefix=e,this._update(),this},addAttribution:function(e){return e?(this._attributions[e]||(this._attributions[e]=0),this._attributions[e]++,this._update(),this):this},removeAttribution:function(e){return e?(this._attributions[e]&&(this._attributions[e]--,this._update()),this):this},_update:function(){if(this._map){var e=[];for(var t in this._attributions)this._attributions[t]&&e.push(t);var i=[];this.options.prefix&&i.push(this.options.prefix),e.length&&i.push(e.join(", ")),this._container.innerHTML=i.join(' <span aria-hidden="true">|</span> ')}}});ni.mergeOptions({attributionControl:!0}),ni.addInitHook((function(){this.options.attributionControl&&(new Ai).addTo(this)}));var mi=function(e){return new Ai(e)};si.Layers=li,si.Zoom=ui,si.Scale=di,si.Attribution=Ai,ai.layers=ci,ai.zoom=hi,ai.scale=pi,ai.attribution=mi;var gi=E.extend({initialize:function(e){this._map=e},enable:function(){return this._enabled||(this._enabled=!0,this.addHooks()),this},disable:function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},enabled:function(){return!!this._enabled}});gi.addTo=function(e,t){return e.addHandler(t,this),this};var _i={Events:I},yi=Oe.touch?"touchstart mousedown":"mousedown",vi=P.extend({options:{clickTolerance:3},initialize:function(e,t,i,r){p(this,r),this._element=e,this._dragStartTarget=t||e,this._preventOutline=i},enable:function(){this._enabled||(Ut(this._dragStartTarget,yi,this._onDown,this),this._enabled=!0)},disable:function(){this._enabled&&(vi._dragging===this&&this.finishDrag(!0),Qt(this._dragStartTarget,yi,this._onDown,this),this._enabled=!1,this._moved=!1)},_onDown:function(e){if(this._enabled&&(this._moved=!1,!vt(this._element,"leaflet-zoom-anim")))if(e.touches&&1!==e.touches.length)vi._dragging===this&&this.finishDrag();else if(!(vi._dragging||e.shiftKey||1!==e.which&&1!==e.button&&!e.touches||(vi._dragging=this,this._preventOutline&&kt(this._element),Lt(),ot(),this._moving))){this.fire("down");var t=e.touches?e.touches[0]:e,i=Rt(this._element);this._startPoint=new F(t.clientX,t.clientY),this._startPos=It(this._element),this._parentScale=Dt(i);var r="mousedown"===e.type;Ut(document,r?"mousemove":"touchmove",this._onMove,this),Ut(document,r?"mouseup":"touchend touchcancel",this._onUp,this)}},_onMove:function(e){if(this._enabled)if(e.touches&&e.touches.length>1)this._moved=!0;else{var t=e.touches&&1===e.touches.length?e.touches[0]:e,i=new F(t.clientX,t.clientY)._subtract(this._startPoint);(i.x||i.y)&&(Math.abs(i.x)+Math.abs(i.y)<this.options.clickTolerance||(i.x/=this._parentScale.x,i.y/=this._parentScale.y,Kt(e),this._moved||(this.fire("dragstart"),this._moved=!0,xt(document.body,"leaflet-dragging"),this._lastTarget=e.target||e.srcElement,window.SVGElementInstance&&this._lastTarget instanceof window.SVGElementInstance&&(this._lastTarget=this._lastTarget.correspondingUseElement),xt(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(i),this._moving=!0,this._lastEvent=e,this._updatePosition()))}},_updatePosition:function(){var e={originalEvent:this._lastEvent};this.fire("predrag",e),Mt(this._element,this._newPos),this.fire("drag",e)},_onUp:function(){this._enabled&&this.finishDrag()},finishDrag:function(e){bt(document.body,"leaflet-dragging"),this._lastTarget&&(bt(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null),Qt(document,"mousemove touchmove",this._onMove,this),Qt(document,"mouseup touchend touchcancel",this._onUp,this),Ft(),st();var t=this._moved&&this._moving;this._moving=!1,vi._dragging=!1,t&&this.fire("dragend",{noInertia:e,distance:this._newPos.distanceTo(this._startPos)})}});function xi(e,t,i){var r,n,o,s,a,l,c,u,h,d=[1,4,2,8];for(n=0,c=e.length;n<c;n++)e[n]._code=ki(e[n],t);for(s=0;s<4;s++){for(u=d[s],r=[],n=0,o=(c=e.length)-1;n<c;o=n++)a=e[n],l=e[o],a._code&u?l._code&u||((h=Fi(l,a,u,t,i))._code=ki(h,t),r.push(h)):(l._code&u&&((h=Fi(l,a,u,t,i))._code=ki(h,t),r.push(h)),r.push(a));e=r}return e}function bi(e,t){var i,r,n,o,s,a,l,c,u;if(!e||0===e.length)throw new Error("latlngs not passed");Di(e)||(console.warn("latlngs are not flat! Only the first ring will be used"),e=e[0]);var h=Q([0,0]),d=U(e);d.getNorthWest().distanceTo(d.getSouthWest())*d.getNorthEast().distanceTo(d.getNorthWest())<1700&&(h=wi(e));var p=e.length,f=[];for(i=0;i<p;i++){var A=Q(e[i]);f.push(t.project(Q([A.lat-h.lat,A.lng-h.lng])))}for(a=l=c=0,i=0,r=p-1;i<p;r=i++)n=f[i],o=f[r],s=n.y*o.x-o.y*n.x,l+=(n.x+o.x)*s,c+=(n.y+o.y)*s,a+=3*s;u=0===a?f[0]:[l/a,c/a];var m=t.unproject(z(u));return Q([m.lat+h.lat,m.lng+h.lng])}function wi(e){for(var t=0,i=0,r=0,n=0;n<e.length;n++){var o=Q(e[n]);t+=o.lat,i+=o.lng,r++}return Q([t/r,i/r])}var Ti,Bi={__proto__:null,clipPolygon:xi,polygonCenter:bi,centroid:wi};function Ci(e,t){if(!t||!e.length)return e.slice();var i=t*t;return e=Mi(e=Pi(e,i),i)}function Si(e,t,i){return Math.sqrt(Ri(e,t,i,!0))}function Ei(e,t,i){return Ri(e,t,i)}function Mi(e,t){var i=e.length,r=new(typeof Uint8Array!=void 0+""?Uint8Array:Array)(i);r[0]=r[i-1]=1,Ii(e,r,t,0,i-1);var n,o=[];for(n=0;n<i;n++)r[n]&&o.push(e[n]);return o}function Ii(e,t,i,r,n){var o,s,a,l=0;for(s=r+1;s<=n-1;s++)(a=Ri(e[s],e[r],e[n],!0))>l&&(o=s,l=a);l>i&&(t[o]=1,Ii(e,t,i,r,o),Ii(e,t,i,o,n))}function Pi(e,t){for(var i=[e[0]],r=1,n=0,o=e.length;r<o;r++)zi(e[r],e[n])>t&&(i.push(e[r]),n=r);return n<o-1&&i.push(e[o-1]),i}function Li(e,t,i,r,n){var o,s,a,l=r?Ti:ki(e,i),c=ki(t,i);for(Ti=c;;){if(!(l|c))return[e,t];if(l&c)return!1;a=ki(s=Fi(e,t,o=l||c,i,n),i),o===l?(e=s,l=a):(t=s,c=a)}}function Fi(e,t,i,r,n){var o,s,a=t.x-e.x,l=t.y-e.y,c=r.min,u=r.max;return 8&i?(o=e.x+a*(u.y-e.y)/l,s=u.y):4&i?(o=e.x+a*(c.y-e.y)/l,s=c.y):2&i?(o=u.x,s=e.y+l*(u.x-e.x)/a):1&i&&(o=c.x,s=e.y+l*(c.x-e.x)/a),new F(o,s,n)}function ki(e,t){var i=0;return e.x<t.min.x?i|=1:e.x>t.max.x&&(i|=2),e.y<t.min.y?i|=4:e.y>t.max.y&&(i|=8),i}function zi(e,t){var i=t.x-e.x,r=t.y-e.y;return i*i+r*r}function Ri(e,t,i,r){var n,o=t.x,s=t.y,a=i.x-o,l=i.y-s,c=a*a+l*l;return c>0&&((n=((e.x-o)*a+(e.y-s)*l)/c)>1?(o=i.x,s=i.y):n>0&&(o+=a*n,s+=l*n)),a=e.x-o,l=e.y-s,r?a*a+l*l:new F(o,s)}function Di(e){return!g(e[0])||"object"!=typeof e[0][0]&&void 0!==e[0][0]}function Oi(e){return console.warn("Deprecated use of _flat, please use L.LineUtil.isFlat instead."),Di(e)}function Ui(e,t){var i,r,n,o,s,a,l,c;if(!e||0===e.length)throw new Error("latlngs not passed");Di(e)||(console.warn("latlngs are not flat! Only the first ring will be used"),e=e[0]);var u=Q([0,0]),h=U(e);h.getNorthWest().distanceTo(h.getSouthWest())*h.getNorthEast().distanceTo(h.getNorthWest())<1700&&(u=wi(e));var d=e.length,p=[];for(i=0;i<d;i++){var f=Q(e[i]);p.push(t.project(Q([f.lat-u.lat,f.lng-u.lng])))}for(i=0,r=0;i<d-1;i++)r+=p[i].distanceTo(p[i+1])/2;if(0===r)c=p[0];else for(i=0,o=0;i<d-1;i++)if(s=p[i],a=p[i+1],(o+=n=s.distanceTo(a))>r){l=(o-r)/n,c=[a.x-l*(a.x-s.x),a.y-l*(a.y-s.y)];break}var A=t.unproject(z(c));return Q([A.lat+u.lat,A.lng+u.lng])}var Ni={__proto__:null,simplify:Ci,pointToSegmentDistance:Si,closestPointOnSegment:Ei,clipSegment:Li,_getEdgeIntersection:Fi,_getBitCode:ki,_sqClosestPointOnSegment:Ri,isFlat:Di,_flat:Oi,polylineCenter:Ui},Qi={project:function(e){return new F(e.lng,e.lat)},unproject:function(e){return new N(e.y,e.x)},bounds:new R([-180,-90],[180,90])},ji={R:6378137,R_MINOR:6356752.314245179,bounds:new R([-20037508.34279,-15496570.73972],[20037508.34279,18764656.23138]),project:function(e){var t=Math.PI/180,i=this.R,r=e.lat*t,n=this.R_MINOR/i,o=Math.sqrt(1-n*n),s=o*Math.sin(r),a=Math.tan(Math.PI/4-r/2)/Math.pow((1-s)/(1+s),o/2);return r=-i*Math.log(Math.max(a,1e-10)),new F(e.lng*t*i,r)},unproject:function(e){for(var t,i=180/Math.PI,r=this.R,n=this.R_MINOR/r,o=Math.sqrt(1-n*n),s=Math.exp(-e.y/r),a=Math.PI/2-2*Math.atan(s),l=0,c=.1;l<15&&Math.abs(c)>1e-7;l++)t=o*Math.sin(a),t=Math.pow((1-t)/(1+t),o/2),a+=c=Math.PI/2-2*Math.atan(s*t)-a;return new N(a*i,e.x*i/r)}},Vi={__proto__:null,LonLat:Qi,Mercator:ji,SphericalMercator:$},Hi=i({},H,{code:"EPSG:3395",projection:ji,transformation:function(){var e=.5/(Math.PI*ji.R);return q(e,.5,-e,.5)}()}),Gi=i({},H,{code:"EPSG:4326",projection:Qi,transformation:q(1/180,1,-1/180,.5)}),$i=i({},V,{projection:Qi,transformation:q(1,0,-1,0),scale:function(e){return Math.pow(2,e)},zoom:function(e){return Math.log(e)/Math.LN2},distance:function(e,t){var i=t.lng-e.lng,r=t.lat-e.lat;return Math.sqrt(i*i+r*r)},infinite:!0});V.Earth=H,V.EPSG3395=Hi,V.EPSG3857=K,V.EPSG900913=W,V.EPSG4326=Gi,V.Simple=$i;var Zi=P.extend({options:{pane:"overlayPane",attribution:null,bubblingMouseEvents:!0},addTo:function(e){return e.addLayer(this),this},remove:function(){return this.removeFrom(this._map||this._mapToAdd)},removeFrom:function(e){return e&&e.removeLayer(this),this},getPane:function(e){return this._map.getPane(e?this.options[e]||e:this.options.pane)},addInteractiveTarget:function(e){return this._map._targets[s(e)]=this,this},removeInteractiveTarget:function(e){return delete this._map._targets[s(e)],this},getAttribution:function(){return this.options.attribution},_layerAdd:function(e){var t=e.target;if(t.hasLayer(this)){if(this._map=t,this._zoomAnimated=t._zoomAnimated,this.getEvents){var i=this.getEvents();t.on(i,this),this.once("remove",(function(){t.off(i,this)}),this)}this.onAdd(t),this.fire("add"),t.fire("layeradd",{layer:this})}}});ni.include({addLayer:function(e){if(!e._layerAdd)throw new Error("The provided object is not a Layer.");var t=s(e);return this._layers[t]||(this._layers[t]=e,e._mapToAdd=this,e.beforeAdd&&e.beforeAdd(this),this.whenReady(e._layerAdd,e)),this},removeLayer:function(e){var t=s(e);return this._layers[t]?(this._loaded&&e.onRemove(this),delete this._layers[t],this._loaded&&(this.fire("layerremove",{layer:e}),e.fire("remove")),e._map=e._mapToAdd=null,this):this},hasLayer:function(e){return s(e)in this._layers},eachLayer:function(e,t){for(var i in this._layers)e.call(t,this._layers[i]);return this},_addLayers:function(e){for(var t=0,i=(e=e?g(e)?e:[e]:[]).length;t<i;t++)this.addLayer(e[t])},_addZoomLimit:function(e){isNaN(e.options.maxZoom)&&isNaN(e.options.minZoom)||(this._zoomBoundLayers[s(e)]=e,this._updateZoomLevels())},_removeZoomLimit:function(e){var t=s(e);this._zoomBoundLayers[t]&&(delete this._zoomBoundLayers[t],this._updateZoomLevels())},_updateZoomLevels:function(){var e=1/0,t=-1/0,i=this._getZoomSpan();for(var r in this._zoomBoundLayers){var n=this._zoomBoundLayers[r].options;e=void 0===n.minZoom?e:Math.min(e,n.minZoom),t=void 0===n.maxZoom?t:Math.max(t,n.maxZoom)}this._layersMaxZoom=t===-1/0?void 0:t,this._layersMinZoom=e===1/0?void 0:e,i!==this._getZoomSpan()&&this.fire("zoomlevelschange"),void 0===this.options.maxZoom&&this._layersMaxZoom&&this.getZoom()>this._layersMaxZoom&&this.setZoom(this._layersMaxZoom),void 0===this.options.minZoom&&this._layersMinZoom&&this.getZoom()<this._layersMinZoom&&this.setZoom(this._layersMinZoom)}});var qi=Zi.extend({initialize:function(e,t){var i,r;if(p(this,t),this._layers={},e)for(i=0,r=e.length;i<r;i++)this.addLayer(e[i])},addLayer:function(e){var t=this.getLayerId(e);return this._layers[t]=e,this._map&&this._map.addLayer(e),this},removeLayer:function(e){var t=e in this._layers?e:this.getLayerId(e);return this._map&&this._layers[t]&&this._map.removeLayer(this._layers[t]),delete this._layers[t],this},hasLayer:function(e){return("number"==typeof e?e:this.getLayerId(e))in this._layers},clearLayers:function(){return this.eachLayer(this.removeLayer,this)},invoke:function(e){var t,i,r=Array.prototype.slice.call(arguments,1);for(t in this._layers)(i=this._layers[t])[e]&&i[e].apply(i,r);return this},onAdd:function(e){this.eachLayer(e.addLayer,e)},onRemove:function(e){this.eachLayer(e.removeLayer,e)},eachLayer:function(e,t){for(var i in this._layers)e.call(t,this._layers[i]);return this},getLayer:function(e){return this._layers[e]},getLayers:function(){var e=[];return this.eachLayer(e.push,e),e},setZIndex:function(e){return this.invoke("setZIndex",e)},getLayerId:function(e){return s(e)}}),Ki=function(e,t){return new qi(e,t)},Wi=qi.extend({addLayer:function(e){return this.hasLayer(e)?this:(e.addEventParent(this),qi.prototype.addLayer.call(this,e),this.fire("layeradd",{layer:e}))},removeLayer:function(e){return this.hasLayer(e)?(e in this._layers&&(e=this._layers[e]),e.removeEventParent(this),qi.prototype.removeLayer.call(this,e),this.fire("layerremove",{layer:e})):this},setStyle:function(e){return this.invoke("setStyle",e)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var e=new O;for(var t in this._layers){var i=this._layers[t];e.extend(i.getBounds?i.getBounds():i.getLatLng())}return e}}),Xi=function(e,t){return new Wi(e,t)},Yi=E.extend({options:{popupAnchor:[0,0],tooltipAnchor:[0,0],crossOrigin:!1},initialize:function(e){p(this,e)},createIcon:function(e){return this._createIcon("icon",e)},createShadow:function(e){return this._createIcon("shadow",e)},_createIcon:function(e,t){var i=this._getIconUrl(e);if(!i){if("icon"===e)throw new Error("iconUrl not set in Icon options (see the docs).");return null}var r=this._createImg(i,t&&"IMG"===t.tagName?t:null);return this._setIconStyles(r,e),(this.options.crossOrigin||""===this.options.crossOrigin)&&(r.crossOrigin=!0===this.options.crossOrigin?"":this.options.crossOrigin),r},_setIconStyles:function(e,t){var i=this.options,r=i[t+"Size"];"number"==typeof r&&(r=[r,r]);var n=z(r),o=z("shadow"===t&&i.shadowAnchor||i.iconAnchor||n&&n.divideBy(2,!0));e.className="leaflet-marker-"+t+" "+(i.className||""),o&&(e.style.marginLeft=-o.x+"px",e.style.marginTop=-o.y+"px"),n&&(e.style.width=n.x+"px",e.style.height=n.y+"px")},_createImg:function(e,t){return(t=t||document.createElement("img")).src=e,t},_getIconUrl:function(e){return Oe.retina&&this.options[e+"RetinaUrl"]||this.options[e+"Url"]}});function Ji(e){return new Yi(e)}var er=Yi.extend({options:{iconUrl:"marker-icon.png",iconRetinaUrl:"marker-icon-2x.png",shadowUrl:"marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]},_getIconUrl:function(e){return"string"!=typeof er.imagePath&&(er.imagePath=this._detectIconPath()),(this.options.imagePath||er.imagePath)+Yi.prototype._getIconUrl.call(this,e)},_stripUrl:function(e){var t=function(e,t,i){var r=t.exec(e);return r&&r[i]};return(e=t(e,/^url\((['"])?(.+)\1\)$/,2))&&t(e,/^(.*)marker-icon\.png$/,1)},_detectIconPath:function(){var e=At("div","leaflet-default-icon-path",document.body),t=ft(e,"background-image")||ft(e,"backgroundImage");if(document.body.removeChild(e),t=this._stripUrl(t))return t;var i=document.querySelector('link[href$="leaflet.css"]');return i?i.href.substring(0,i.href.length-11-1):""}}),tr=gi.extend({initialize:function(e){this._marker=e},addHooks:function(){var e=this._marker._icon;this._draggable||(this._draggable=new vi(e,e,!0)),this._draggable.on({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).enable(),xt(e,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).disable(),this._marker._icon&&bt(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_adjustPan:function(e){var t=this._marker,i=t._map,r=this._marker.options.autoPanSpeed,n=this._marker.options.autoPanPadding,o=It(t._icon),s=i.getPixelBounds(),a=i.getPixelOrigin(),l=D(s.min._subtract(a).add(n),s.max._subtract(a).subtract(n));if(!l.contains(o)){var c=z((Math.max(l.max.x,o.x)-l.max.x)/(s.max.x-l.max.x)-(Math.min(l.min.x,o.x)-l.min.x)/(s.min.x-l.min.x),(Math.max(l.max.y,o.y)-l.max.y)/(s.max.y-l.max.y)-(Math.min(l.min.y,o.y)-l.min.y)/(s.min.y-l.min.y)).multiplyBy(r);i.panBy(c,{animate:!1}),this._draggable._newPos._add(c),this._draggable._startPos._add(c),Mt(t._icon,this._draggable._newPos),this._onDrag(e),this._panRequest=B(this._adjustPan.bind(this,e))}},_onDragStart:function(){this._oldLatLng=this._marker.getLatLng(),this._marker.closePopup&&this._marker.closePopup(),this._marker.fire("movestart").fire("dragstart")},_onPreDrag:function(e){this._marker.options.autoPan&&(C(this._panRequest),this._panRequest=B(this._adjustPan.bind(this,e)))},_onDrag:function(e){var t=this._marker,i=t._shadow,r=It(t._icon),n=t._map.layerPointToLatLng(r);i&&Mt(i,r),t._latlng=n,e.latlng=n,e.oldLatLng=this._oldLatLng,t.fire("move",e).fire("drag",e)},_onDragEnd:function(e){C(this._panRequest),delete this._oldLatLng,this._marker.fire("moveend").fire("dragend",e)}}),ir=Zi.extend({options:{icon:new er,interactive:!0,keyboard:!0,title:"",alt:"Marker",zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250,pane:"markerPane",shadowPane:"shadowPane",bubblingMouseEvents:!1,autoPanOnFocus:!0,draggable:!1,autoPan:!1,autoPanPadding:[50,50],autoPanSpeed:10},initialize:function(e,t){p(this,t),this._latlng=Q(e)},onAdd:function(e){this._zoomAnimated=this._zoomAnimated&&e.options.markerZoomAnimation,this._zoomAnimated&&e.on("zoomanim",this._animateZoom,this),this._initIcon(),this.update()},onRemove:function(e){this.dragging&&this.dragging.enabled()&&(this.options.draggable=!0,this.dragging.removeHooks()),delete this.dragging,this._zoomAnimated&&e.off("zoomanim",this._animateZoom,this),this._removeIcon(),this._removeShadow()},getEvents:function(){return{zoom:this.update,viewreset:this.update}},getLatLng:function(){return this._latlng},setLatLng:function(e){var t=this._latlng;return this._latlng=Q(e),this.update(),this.fire("move",{oldLatLng:t,latlng:this._latlng})},setZIndexOffset:function(e){return this.options.zIndexOffset=e,this.update()},getIcon:function(){return this.options.icon},setIcon:function(e){return this.options.icon=e,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup,this._popup.options),this},getElement:function(){return this._icon},update:function(){if(this._icon&&this._map){var e=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(e)}return this},_initIcon:function(){var e=this.options,t="leaflet-zoom-"+(this._zoomAnimated?"animated":"hide"),i=e.icon.createIcon(this._icon),r=!1;i!==this._icon&&(this._icon&&this._removeIcon(),r=!0,e.title&&(i.title=e.title),"IMG"===i.tagName&&(i.alt=e.alt||"")),xt(i,t),e.keyboard&&(i.tabIndex="0",i.setAttribute("role","button")),this._icon=i,e.riseOnHover&&this.on({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&Ut(i,"focus",this._panOnFocus,this);var n=e.icon.createShadow(this._shadow),o=!1;n!==this._shadow&&(this._removeShadow(),o=!0),n&&(xt(n,t),n.alt=""),this._shadow=n,e.opacity<1&&this._updateOpacity(),r&&this.getPane().appendChild(this._icon),this._initInteraction(),n&&o&&this.getPane(e.shadowPane).appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&this.off({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&Qt(this._icon,"focus",this._panOnFocus,this),mt(this._icon),this.removeInteractiveTarget(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&mt(this._shadow),this._shadow=null},_setPos:function(e){this._icon&&Mt(this._icon,e),this._shadow&&Mt(this._shadow,e),this._zIndex=e.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(e){this._icon&&(this._icon.style.zIndex=this._zIndex+e)},_animateZoom:function(e){var t=this._map._latLngToNewLayerPoint(this._latlng,e.zoom,e.center).round();this._setPos(t)},_initInteraction:function(){if(this.options.interactive&&(xt(this._icon,"leaflet-interactive"),this.addInteractiveTarget(this._icon),tr)){var e=this.options.draggable;this.dragging&&(e=this.dragging.enabled(),this.dragging.disable()),this.dragging=new tr(this),e&&this.dragging.enable()}},setOpacity:function(e){return this.options.opacity=e,this._map&&this._updateOpacity(),this},_updateOpacity:function(){var e=this.options.opacity;this._icon&&Bt(this._icon,e),this._shadow&&Bt(this._shadow,e)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)},_panOnFocus:function(){var e=this._map;if(e){var t=this.options.icon.options,i=t.iconSize?z(t.iconSize):z(0,0),r=t.iconAnchor?z(t.iconAnchor):z(0,0);e.panInside(this._latlng,{paddingTopLeft:r,paddingBottomRight:i.subtract(r)})}},_getPopupAnchor:function(){return this.options.icon.options.popupAnchor},_getTooltipAnchor:function(){return this.options.icon.options.tooltipAnchor}});function rr(e,t){return new ir(e,t)}var nr=Zi.extend({options:{stroke:!0,color:"#3388ff",weight:3,opacity:1,lineCap:"round",lineJoin:"round",dashArray:null,dashOffset:null,fill:!1,fillColor:null,fillOpacity:.2,fillRule:"evenodd",interactive:!0,bubblingMouseEvents:!0},beforeAdd:function(e){this._renderer=e.getRenderer(this)},onAdd:function(){this._renderer._initPath(this),this._reset(),this._renderer._addPath(this)},onRemove:function(){this._renderer._removePath(this)},redraw:function(){return this._map&&this._renderer._updatePath(this),this},setStyle:function(e){return p(this,e),this._renderer&&(this._renderer._updateStyle(this),this.options.stroke&&e&&Object.prototype.hasOwnProperty.call(e,"weight")&&this._updateBounds()),this},bringToFront:function(){return this._renderer&&this._renderer._bringToFront(this),this},bringToBack:function(){return this._renderer&&this._renderer._bringToBack(this),this},getElement:function(){return this._path},_reset:function(){this._project(),this._update()},_clickTolerance:function(){return(this.options.stroke?this.options.weight/2:0)+(this._renderer.options.tolerance||0)}}),or=nr.extend({options:{fill:!0,radius:10},initialize:function(e,t){p(this,t),this._latlng=Q(e),this._radius=this.options.radius},setLatLng:function(e){var t=this._latlng;return this._latlng=Q(e),this.redraw(),this.fire("move",{oldLatLng:t,latlng:this._latlng})},getLatLng:function(){return this._latlng},setRadius:function(e){return this.options.radius=this._radius=e,this.redraw()},getRadius:function(){return this._radius},setStyle:function(e){var t=e&&e.radius||this._radius;return nr.prototype.setStyle.call(this,e),this.setRadius(t),this},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._updateBounds()},_updateBounds:function(){var e=this._radius,t=this._radiusY||e,i=this._clickTolerance(),r=[e+i,t+i];this._pxBounds=new R(this._point.subtract(r),this._point.add(r))},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updateCircle(this)},_empty:function(){return this._radius&&!this._renderer._bounds.intersects(this._pxBounds)},_containsPoint:function(e){return e.distanceTo(this._point)<=this._radius+this._clickTolerance()}});function sr(e,t){return new or(e,t)}var ar=or.extend({initialize:function(e,t,r){if("number"==typeof t&&(t=i({},r,{radius:t})),p(this,t),this._latlng=Q(e),isNaN(this.options.radius))throw new Error("Circle radius cannot be NaN");this._mRadius=this.options.radius},setRadius:function(e){return this._mRadius=e,this.redraw()},getRadius:function(){return this._mRadius},getBounds:function(){var e=[this._radius,this._radiusY||this._radius];return new O(this._map.layerPointToLatLng(this._point.subtract(e)),this._map.layerPointToLatLng(this._point.add(e)))},setStyle:nr.prototype.setStyle,_project:function(){var e=this._latlng.lng,t=this._latlng.lat,i=this._map,r=i.options.crs;if(r.distance===H.distance){var n=Math.PI/180,o=this._mRadius/H.R/n,s=i.project([t+o,e]),a=i.project([t-o,e]),l=s.add(a).divideBy(2),c=i.unproject(l).lat,u=Math.acos((Math.cos(o*n)-Math.sin(t*n)*Math.sin(c*n))/(Math.cos(t*n)*Math.cos(c*n)))/n;(isNaN(u)||0===u)&&(u=o/Math.cos(Math.PI/180*t)),this._point=l.subtract(i.getPixelOrigin()),this._radius=isNaN(u)?0:l.x-i.project([c,e-u]).x,this._radiusY=l.y-s.y}else{var h=r.unproject(r.project(this._latlng).subtract([this._mRadius,0]));this._point=i.latLngToLayerPoint(this._latlng),this._radius=this._point.x-i.latLngToLayerPoint(h).x}this._updateBounds()}});function lr(e,t,i){return new ar(e,t,i)}var cr=nr.extend({options:{smoothFactor:1,noClip:!1},initialize:function(e,t){p(this,t),this._setLatLngs(e)},getLatLngs:function(){return this._latlngs},setLatLngs:function(e){return this._setLatLngs(e),this.redraw()},isEmpty:function(){return!this._latlngs.length},closestLayerPoint:function(e){for(var t,i,r=1/0,n=null,o=Ri,s=0,a=this._parts.length;s<a;s++)for(var l=this._parts[s],c=1,u=l.length;c<u;c++){var h=o(e,t=l[c-1],i=l[c],!0);h<r&&(r=h,n=o(e,t,i))}return n&&(n.distance=Math.sqrt(r)),n},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return Ui(this._defaultShape(),this._map.options.crs)},getBounds:function(){return this._bounds},addLatLng:function(e,t){return t=t||this._defaultShape(),e=Q(e),t.push(e),this._bounds.extend(e),this.redraw()},_setLatLngs:function(e){this._bounds=new O,this._latlngs=this._convertLatLngs(e)},_defaultShape:function(){return Di(this._latlngs)?this._latlngs:this._latlngs[0]},_convertLatLngs:function(e){for(var t=[],i=Di(e),r=0,n=e.length;r<n;r++)i?(t[r]=Q(e[r]),this._bounds.extend(t[r])):t[r]=this._convertLatLngs(e[r]);return t},_project:function(){var e=new R;this._rings=[],this._projectLatlngs(this._latlngs,this._rings,e),this._bounds.isValid()&&e.isValid()&&(this._rawPxBounds=e,this._updateBounds())},_updateBounds:function(){var e=this._clickTolerance(),t=new F(e,e);this._rawPxBounds&&(this._pxBounds=new R([this._rawPxBounds.min.subtract(t),this._rawPxBounds.max.add(t)]))},_projectLatlngs:function(e,t,i){var r,n,o=e[0]instanceof N,s=e.length;if(o){for(n=[],r=0;r<s;r++)n[r]=this._map.latLngToLayerPoint(e[r]),i.extend(n[r]);t.push(n)}else for(r=0;r<s;r++)this._projectLatlngs(e[r],t,i)},_clipPoints:function(){var e=this._renderer._bounds;if(this._parts=[],this._pxBounds&&this._pxBounds.intersects(e))if(this.options.noClip)this._parts=this._rings;else{var t,i,r,n,o,s,a,l=this._parts;for(t=0,r=0,n=this._rings.length;t<n;t++)for(i=0,o=(a=this._rings[t]).length;i<o-1;i++)(s=Li(a[i],a[i+1],e,i,!0))&&(l[r]=l[r]||[],l[r].push(s[0]),s[1]===a[i+1]&&i!==o-2||(l[r].push(s[1]),r++))}},_simplifyPoints:function(){for(var e=this._parts,t=this.options.smoothFactor,i=0,r=e.length;i<r;i++)e[i]=Ci(e[i],t)},_update:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),this._updatePath())},_updatePath:function(){this._renderer._updatePoly(this)},_containsPoint:function(e,t){var i,r,n,o,s,a,l=this._clickTolerance();if(!this._pxBounds||!this._pxBounds.contains(e))return!1;for(i=0,o=this._parts.length;i<o;i++)for(r=0,n=(s=(a=this._parts[i]).length)-1;r<s;n=r++)if((t||0!==r)&&Si(e,a[n],a[r])<=l)return!0;return!1}});function ur(e,t){return new cr(e,t)}cr._flat=Oi;var hr=cr.extend({options:{fill:!0},isEmpty:function(){return!this._latlngs.length||!this._latlngs[0].length},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return bi(this._defaultShape(),this._map.options.crs)},_convertLatLngs:function(e){var t=cr.prototype._convertLatLngs.call(this,e),i=t.length;return i>=2&&t[0]instanceof N&&t[0].equals(t[i-1])&&t.pop(),t},_setLatLngs:function(e){cr.prototype._setLatLngs.call(this,e),Di(this._latlngs)&&(this._latlngs=[this._latlngs])},_defaultShape:function(){return Di(this._latlngs[0])?this._latlngs[0]:this._latlngs[0][0]},_clipPoints:function(){var e=this._renderer._bounds,t=this.options.weight,i=new F(t,t);if(e=new R(e.min.subtract(i),e.max.add(i)),this._parts=[],this._pxBounds&&this._pxBounds.intersects(e))if(this.options.noClip)this._parts=this._rings;else for(var r,n=0,o=this._rings.length;n<o;n++)(r=xi(this._rings[n],e,!0)).length&&this._parts.push(r)},_updatePath:function(){this._renderer._updatePoly(this,!0)},_containsPoint:function(e){var t,i,r,n,o,s,a,l,c=!1;if(!this._pxBounds||!this._pxBounds.contains(e))return!1;for(n=0,a=this._parts.length;n<a;n++)for(o=0,s=(l=(t=this._parts[n]).length)-1;o<l;s=o++)i=t[o],r=t[s],i.y>e.y!=r.y>e.y&&e.x<(r.x-i.x)*(e.y-i.y)/(r.y-i.y)+i.x&&(c=!c);return c||cr.prototype._containsPoint.call(this,e,!0)}});function dr(e,t){return new hr(e,t)}var pr=Wi.extend({initialize:function(e,t){p(this,t),this._layers={},e&&this.addData(e)},addData:function(e){var t,i,r,n=g(e)?e:e.features;if(n){for(t=0,i=n.length;t<i;t++)((r=n[t]).geometries||r.geometry||r.features||r.coordinates)&&this.addData(r);return this}var o=this.options;if(o.filter&&!o.filter(e))return this;var s=fr(e,o);return s?(s.feature=xr(e),s.defaultOptions=s.options,this.resetStyle(s),o.onEachFeature&&o.onEachFeature(e,s),this.addLayer(s)):this},resetStyle:function(e){return void 0===e?this.eachLayer(this.resetStyle,this):(e.options=i({},e.defaultOptions),this._setLayerStyle(e,this.options.style),this)},setStyle:function(e){return this.eachLayer((function(t){this._setLayerStyle(t,e)}),this)},_setLayerStyle:function(e,t){e.setStyle&&("function"==typeof t&&(t=t(e.feature)),e.setStyle(t))}});function fr(e,t){var i,r,n,o,s="Feature"===e.type?e.geometry:e,a=s?s.coordinates:null,l=[],c=t&&t.pointToLayer,u=t&&t.coordsToLatLng||mr;if(!a&&!s)return null;switch(s.type){case"Point":return Ar(c,e,i=u(a),t);case"MultiPoint":for(n=0,o=a.length;n<o;n++)i=u(a[n]),l.push(Ar(c,e,i,t));return new Wi(l);case"LineString":case"MultiLineString":return r=gr(a,"LineString"===s.type?0:1,u),new cr(r,t);case"Polygon":case"MultiPolygon":return r=gr(a,"Polygon"===s.type?1:2,u),new hr(r,t);case"GeometryCollection":for(n=0,o=s.geometries.length;n<o;n++){var h=fr({geometry:s.geometries[n],type:"Feature",properties:e.properties},t);h&&l.push(h)}return new Wi(l);case"FeatureCollection":for(n=0,o=s.features.length;n<o;n++){var d=fr(s.features[n],t);d&&l.push(d)}return new Wi(l);default:throw new Error("Invalid GeoJSON object.")}}function Ar(e,t,i,r){return e?e(t,i):new ir(i,r&&r.markersInheritOptions&&r)}function mr(e){return new N(e[1],e[0],e[2])}function gr(e,t,i){for(var r,n=[],o=0,s=e.length;o<s;o++)r=t?gr(e[o],t-1,i):(i||mr)(e[o]),n.push(r);return n}function _r(e,t){return void 0!==(e=Q(e)).alt?[u(e.lng,t),u(e.lat,t),u(e.alt,t)]:[u(e.lng,t),u(e.lat,t)]}function yr(e,t,i,r){for(var n=[],o=0,s=e.length;o<s;o++)n.push(t?yr(e[o],Di(e[o])?0:t-1,i,r):_r(e[o],r));return!t&&i&&n.length>0&&n.push(n[0].slice()),n}function vr(e,t){return e.feature?i({},e.feature,{geometry:t}):xr(t)}function xr(e){return"Feature"===e.type||"FeatureCollection"===e.type?e:{type:"Feature",properties:{},geometry:e}}var br={toGeoJSON:function(e){return vr(this,{type:"Point",coordinates:_r(this.getLatLng(),e)})}};function wr(e,t){return new pr(e,t)}ir.include(br),ar.include(br),or.include(br),cr.include({toGeoJSON:function(e){var t=!Di(this._latlngs);return vr(this,{type:(t?"Multi":"")+"LineString",coordinates:yr(this._latlngs,t?1:0,!1,e)})}}),hr.include({toGeoJSON:function(e){var t=!Di(this._latlngs),i=t&&!Di(this._latlngs[0]),r=yr(this._latlngs,i?2:t?1:0,!0,e);return t||(r=[r]),vr(this,{type:(i?"Multi":"")+"Polygon",coordinates:r})}}),qi.include({toMultiPoint:function(e){var t=[];return this.eachLayer((function(i){t.push(i.toGeoJSON(e).geometry.coordinates)})),vr(this,{type:"MultiPoint",coordinates:t})},toGeoJSON:function(e){var t=this.feature&&this.feature.geometry&&this.feature.geometry.type;if("MultiPoint"===t)return this.toMultiPoint(e);var i="GeometryCollection"===t,r=[];return this.eachLayer((function(t){if(t.toGeoJSON){var n=t.toGeoJSON(e);if(i)r.push(n.geometry);else{var o=xr(n);"FeatureCollection"===o.type?r.push.apply(r,o.features):r.push(o)}}})),i?vr(this,{geometries:r,type:"GeometryCollection"}):{type:"FeatureCollection",features:r}}});var Tr=wr,Br=Zi.extend({options:{opacity:1,alt:"",interactive:!1,crossOrigin:!1,errorOverlayUrl:"",zIndex:1,className:""},initialize:function(e,t,i){this._url=e,this._bounds=U(t),p(this,i)},onAdd:function(){this._image||(this._initImage(),this.options.opacity<1&&this._updateOpacity()),this.options.interactive&&(xt(this._image,"leaflet-interactive"),this.addInteractiveTarget(this._image)),this.getPane().appendChild(this._image),this._reset()},onRemove:function(){mt(this._image),this.options.interactive&&this.removeInteractiveTarget(this._image)},setOpacity:function(e){return this.options.opacity=e,this._image&&this._updateOpacity(),this},setStyle:function(e){return e.opacity&&this.setOpacity(e.opacity),this},bringToFront:function(){return this._map&&_t(this._image),this},bringToBack:function(){return this._map&&yt(this._image),this},setUrl:function(e){return this._url=e,this._image&&(this._image.src=e),this},setBounds:function(e){return this._bounds=U(e),this._map&&this._reset(),this},getEvents:function(){var e={zoom:this._reset,viewreset:this._reset};return this._zoomAnimated&&(e.zoomanim=this._animateZoom),e},setZIndex:function(e){return this.options.zIndex=e,this._updateZIndex(),this},getBounds:function(){return this._bounds},getElement:function(){return this._image},_initImage:function(){var e="IMG"===this._url.tagName,t=this._image=e?this._url:At("img");xt(t,"leaflet-image-layer"),this._zoomAnimated&&xt(t,"leaflet-zoom-animated"),this.options.className&&xt(t,this.options.className),t.onselectstart=c,t.onmousemove=c,t.onload=n(this.fire,this,"load"),t.onerror=n(this._overlayOnError,this,"error"),(this.options.crossOrigin||""===this.options.crossOrigin)&&(t.crossOrigin=!0===this.options.crossOrigin?"":this.options.crossOrigin),this.options.zIndex&&this._updateZIndex(),e?this._url=t.src:(t.src=this._url,t.alt=this.options.alt)},_animateZoom:function(e){var t=this._map.getZoomScale(e.zoom),i=this._map._latLngBoundsToNewLayerBounds(this._bounds,e.zoom,e.center).min;Et(this._image,i,t)},_reset:function(){var e=this._image,t=new R(this._map.latLngToLayerPoint(this._bounds.getNorthWest()),this._map.latLngToLayerPoint(this._bounds.getSouthEast())),i=t.getSize();Mt(e,t.min),e.style.width=i.x+"px",e.style.height=i.y+"px"},_updateOpacity:function(){Bt(this._image,this.options.opacity)},_updateZIndex:function(){this._image&&void 0!==this.options.zIndex&&null!==this.options.zIndex&&(this._image.style.zIndex=this.options.zIndex)},_overlayOnError:function(){this.fire("error");var e=this.options.errorOverlayUrl;e&&this._url!==e&&(this._url=e,this._image.src=e)},getCenter:function(){return this._bounds.getCenter()}}),Cr=function(e,t,i){return new Br(e,t,i)},Sr=Br.extend({options:{autoplay:!0,loop:!0,keepAspectRatio:!0,muted:!1,playsInline:!0},_initImage:function(){var e="VIDEO"===this._url.tagName,t=this._image=e?this._url:At("video");if(xt(t,"leaflet-image-layer"),this._zoomAnimated&&xt(t,"leaflet-zoom-animated"),this.options.className&&xt(t,this.options.className),t.onselectstart=c,t.onmousemove=c,t.onloadeddata=n(this.fire,this,"load"),e){for(var i=t.getElementsByTagName("source"),r=[],o=0;o<i.length;o++)r.push(i[o].src);this._url=i.length>0?r:[t.src]}else{g(this._url)||(this._url=[this._url]),!this.options.keepAspectRatio&&Object.prototype.hasOwnProperty.call(t.style,"objectFit")&&(t.style.objectFit="fill"),t.autoplay=!!this.options.autoplay,t.loop=!!this.options.loop,t.muted=!!this.options.muted,t.playsInline=!!this.options.playsInline;for(var s=0;s<this._url.length;s++){var a=At("source");a.src=this._url[s],t.appendChild(a)}}}});function Er(e,t,i){return new Sr(e,t,i)}var Mr=Br.extend({_initImage:function(){var e=this._image=this._url;xt(e,"leaflet-image-layer"),this._zoomAnimated&&xt(e,"leaflet-zoom-animated"),this.options.className&&xt(e,this.options.className),e.onselectstart=c,e.onmousemove=c}});function Ir(e,t,i){return new Mr(e,t,i)}var Pr=Zi.extend({options:{interactive:!1,offset:[0,0],className:"",pane:void 0,content:""},initialize:function(e,t){e&&(e instanceof N||g(e))?(this._latlng=Q(e),p(this,t)):(p(this,e),this._source=t),this.options.content&&(this._content=this.options.content)},openOn:function(e){return(e=arguments.length?e:this._source._map).hasLayer(this)||e.addLayer(this),this},close:function(){return this._map&&this._map.removeLayer(this),this},toggle:function(e){return this._map?this.close():(arguments.length?this._source=e:e=this._source,this._prepareOpen(),this.openOn(e._map)),this},onAdd:function(e){this._zoomAnimated=e._zoomAnimated,this._container||this._initLayout(),e._fadeAnimated&&Bt(this._container,0),clearTimeout(this._removeTimeout),this.getPane().appendChild(this._container),this.update(),e._fadeAnimated&&Bt(this._container,1),this.bringToFront(),this.options.interactive&&(xt(this._container,"leaflet-interactive"),this.addInteractiveTarget(this._container))},onRemove:function(e){e._fadeAnimated?(Bt(this._container,0),this._removeTimeout=setTimeout(n(mt,void 0,this._container),200)):mt(this._container),this.options.interactive&&(bt(this._container,"leaflet-interactive"),this.removeInteractiveTarget(this._container))},getLatLng:function(){return this._latlng},setLatLng:function(e){return this._latlng=Q(e),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(e){return this._content=e,this.update(),this},getElement:function(){return this._container},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},getEvents:function(){var e={zoom:this._updatePosition,viewreset:this._updatePosition};return this._zoomAnimated&&(e.zoomanim=this._animateZoom),e},isOpen:function(){return!!this._map&&this._map.hasLayer(this)},bringToFront:function(){return this._map&&_t(this._container),this},bringToBack:function(){return this._map&&yt(this._container),this},_prepareOpen:function(e){var t=this._source;if(!t._map)return!1;if(t instanceof Wi){t=null;var i=this._source._layers;for(var r in i)if(i[r]._map){t=i[r];break}if(!t)return!1;this._source=t}if(!e)if(t.getCenter)e=t.getCenter();else if(t.getLatLng)e=t.getLatLng();else{if(!t.getBounds)throw new Error("Unable to get source layer LatLng.");e=t.getBounds().getCenter()}return this.setLatLng(e),this._map&&this.update(),!0},_updateContent:function(){if(this._content){var e=this._contentNode,t="function"==typeof this._content?this._content(this._source||this):this._content;if("string"==typeof t)e.innerHTML=t;else{for(;e.hasChildNodes();)e.removeChild(e.firstChild);e.appendChild(t)}this.fire("contentupdate")}},_updatePosition:function(){if(this._map){var e=this._map.latLngToLayerPoint(this._latlng),t=z(this.options.offset),i=this._getAnchor();this._zoomAnimated?Mt(this._container,e.add(i)):t=t.add(e).add(i);var r=this._containerBottom=-t.y,n=this._containerLeft=-Math.round(this._containerWidth/2)+t.x;this._container.style.bottom=r+"px",this._container.style.left=n+"px"}},_getAnchor:function(){return[0,0]}});ni.include({_initOverlay:function(e,t,i,r){var n=t;return n instanceof e||(n=new e(r).setContent(t)),i&&n.setLatLng(i),n}}),Zi.include({_initOverlay:function(e,t,i,r){var n=i;return n instanceof e?(p(n,r),n._source=this):(n=t&&!r?t:new e(r,this)).setContent(i),n}});var Lr=Pr.extend({options:{pane:"popupPane",offset:[0,7],maxWidth:300,minWidth:50,maxHeight:null,autoPan:!0,autoPanPaddingTopLeft:null,autoPanPaddingBottomRight:null,autoPanPadding:[5,5],keepInView:!1,closeButton:!0,autoClose:!0,closeOnEscapeKey:!0,className:""},openOn:function(e){return!(e=arguments.length?e:this._source._map).hasLayer(this)&&e._popup&&e._popup.options.autoClose&&e.removeLayer(e._popup),e._popup=this,Pr.prototype.openOn.call(this,e)},onAdd:function(e){Pr.prototype.onAdd.call(this,e),e.fire("popupopen",{popup:this}),this._source&&(this._source.fire("popupopen",{popup:this},!0),this._source instanceof nr||this._source.on("preclick",$t))},onRemove:function(e){Pr.prototype.onRemove.call(this,e),e.fire("popupclose",{popup:this}),this._source&&(this._source.fire("popupclose",{popup:this},!0),this._source instanceof nr||this._source.off("preclick",$t))},getEvents:function(){var e=Pr.prototype.getEvents.call(this);return(void 0!==this.options.closeOnClick?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(e.preclick=this.close),this.options.keepInView&&(e.moveend=this._adjustPan),e},_initLayout:function(){var e="leaflet-popup",t=this._container=At("div",e+" "+(this.options.className||"")+" leaflet-zoom-animated"),i=this._wrapper=At("div",e+"-content-wrapper",t);if(this._contentNode=At("div",e+"-content",i),qt(t),Zt(this._contentNode),Ut(t,"contextmenu",$t),this._tipContainer=At("div",e+"-tip-container",t),this._tip=At("div",e+"-tip",this._tipContainer),this.options.closeButton){var r=this._closeButton=At("a",e+"-close-button",t);r.setAttribute("role","button"),r.setAttribute("aria-label","Close popup"),r.href="#close",r.innerHTML='<span aria-hidden="true">&#215;</span>',Ut(r,"click",(function(e){Kt(e),this.close()}),this)}},_updateLayout:function(){var e=this._contentNode,t=e.style;t.width="",t.whiteSpace="nowrap";var i=e.offsetWidth;i=Math.min(i,this.options.maxWidth),i=Math.max(i,this.options.minWidth),t.width=i+1+"px",t.whiteSpace="",t.height="";var r=e.offsetHeight,n=this.options.maxHeight,o="leaflet-popup-scrolled";n&&r>n?(t.height=n+"px",xt(e,o)):bt(e,o),this._containerWidth=this._container.offsetWidth},_animateZoom:function(e){var t=this._map._latLngToNewLayerPoint(this._latlng,e.zoom,e.center),i=this._getAnchor();Mt(this._container,t.add(i))},_adjustPan:function(){if(this.options.autoPan)if(this._map._panAnim&&this._map._panAnim.stop(),this._autopanning)this._autopanning=!1;else{var e=this._map,t=parseInt(ft(this._container,"marginBottom"),10)||0,i=this._container.offsetHeight+t,r=this._containerWidth,n=new F(this._containerLeft,-i-this._containerBottom);n._add(It(this._container));var o=e.layerPointToContainerPoint(n),s=z(this.options.autoPanPadding),a=z(this.options.autoPanPaddingTopLeft||s),l=z(this.options.autoPanPaddingBottomRight||s),c=e.getSize(),u=0,h=0;o.x+r+l.x>c.x&&(u=o.x+r-c.x+l.x),o.x-u-a.x<0&&(u=o.x-a.x),o.y+i+l.y>c.y&&(h=o.y+i-c.y+l.y),o.y-h-a.y<0&&(h=o.y-a.y),(u||h)&&(this.options.keepInView&&(this._autopanning=!0),e.fire("autopanstart").panBy([u,h]))}},_getAnchor:function(){return z(this._source&&this._source._getPopupAnchor?this._source._getPopupAnchor():[0,0])}}),Fr=function(e,t){return new Lr(e,t)};ni.mergeOptions({closePopupOnClick:!0}),ni.include({openPopup:function(e,t,i){return this._initOverlay(Lr,e,t,i).openOn(this),this},closePopup:function(e){return(e=arguments.length?e:this._popup)&&e.close(),this}}),Zi.include({bindPopup:function(e,t){return this._popup=this._initOverlay(Lr,this._popup,e,t),this._popupHandlersAdded||(this.on({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this.off({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!1,this._popup=null),this},openPopup:function(e){return this._popup&&(this instanceof Wi||(this._popup._source=this),this._popup._prepareOpen(e||this._latlng)&&this._popup.openOn(this._map)),this},closePopup:function(){return this._popup&&this._popup.close(),this},togglePopup:function(){return this._popup&&this._popup.toggle(this),this},isPopupOpen:function(){return!!this._popup&&this._popup.isOpen()},setPopupContent:function(e){return this._popup&&this._popup.setContent(e),this},getPopup:function(){return this._popup},_openPopup:function(e){if(this._popup&&this._map){Wt(e);var t=e.layer||e.target;this._popup._source!==t||t instanceof nr?(this._popup._source=t,this.openPopup(e.latlng)):this._map.hasLayer(this._popup)?this.closePopup():this.openPopup(e.latlng)}},_movePopup:function(e){this._popup.setLatLng(e.latlng)},_onKeyPress:function(e){13===e.originalEvent.keyCode&&this._openPopup(e)}});var kr=Pr.extend({options:{pane:"tooltipPane",offset:[0,0],direction:"auto",permanent:!1,sticky:!1,opacity:.9},onAdd:function(e){Pr.prototype.onAdd.call(this,e),this.setOpacity(this.options.opacity),e.fire("tooltipopen",{tooltip:this}),this._source&&(this.addEventParent(this._source),this._source.fire("tooltipopen",{tooltip:this},!0))},onRemove:function(e){Pr.prototype.onRemove.call(this,e),e.fire("tooltipclose",{tooltip:this}),this._source&&(this.removeEventParent(this._source),this._source.fire("tooltipclose",{tooltip:this},!0))},getEvents:function(){var e=Pr.prototype.getEvents.call(this);return this.options.permanent||(e.preclick=this.close),e},_initLayout:function(){var e="leaflet-tooltip "+(this.options.className||"")+" leaflet-zoom-"+(this._zoomAnimated?"animated":"hide");this._contentNode=this._container=At("div",e),this._container.setAttribute("role","tooltip"),this._container.setAttribute("id","leaflet-tooltip-"+s(this))},_updateLayout:function(){},_adjustPan:function(){},_setPosition:function(e){var t,i,r=this._map,n=this._container,o=r.latLngToContainerPoint(r.getCenter()),s=r.layerPointToContainerPoint(e),a=this.options.direction,l=n.offsetWidth,c=n.offsetHeight,u=z(this.options.offset),h=this._getAnchor();"top"===a?(t=l/2,i=c):"bottom"===a?(t=l/2,i=0):"center"===a?(t=l/2,i=c/2):"right"===a?(t=0,i=c/2):"left"===a?(t=l,i=c/2):s.x<o.x?(a="right",t=0,i=c/2):(a="left",t=l+2*(u.x+h.x),i=c/2),e=e.subtract(z(t,i,!0)).add(u).add(h),bt(n,"leaflet-tooltip-right"),bt(n,"leaflet-tooltip-left"),bt(n,"leaflet-tooltip-top"),bt(n,"leaflet-tooltip-bottom"),xt(n,"leaflet-tooltip-"+a),Mt(n,e)},_updatePosition:function(){var e=this._map.latLngToLayerPoint(this._latlng);this._setPosition(e)},setOpacity:function(e){this.options.opacity=e,this._container&&Bt(this._container,e)},_animateZoom:function(e){var t=this._map._latLngToNewLayerPoint(this._latlng,e.zoom,e.center);this._setPosition(t)},_getAnchor:function(){return z(this._source&&this._source._getTooltipAnchor&&!this.options.sticky?this._source._getTooltipAnchor():[0,0])}}),zr=function(e,t){return new kr(e,t)};ni.include({openTooltip:function(e,t,i){return this._initOverlay(kr,e,t,i).openOn(this),this},closeTooltip:function(e){return e.close(),this}}),Zi.include({bindTooltip:function(e,t){return this._tooltip&&this.isTooltipOpen()&&this.unbindTooltip(),this._tooltip=this._initOverlay(kr,this._tooltip,e,t),this._initTooltipInteractions(),this._tooltip.options.permanent&&this._map&&this._map.hasLayer(this)&&this.openTooltip(),this},unbindTooltip:function(){return this._tooltip&&(this._initTooltipInteractions(!0),this.closeTooltip(),this._tooltip=null),this},_initTooltipInteractions:function(e){if(e||!this._tooltipHandlersAdded){var t=e?"off":"on",i={remove:this.closeTooltip,move:this._moveTooltip};this._tooltip.options.permanent?i.add=this._openTooltip:(i.mouseover=this._openTooltip,i.mouseout=this.closeTooltip,i.click=this._openTooltip,this._map?this._addFocusListeners():i.add=this._addFocusListeners),this._tooltip.options.sticky&&(i.mousemove=this._moveTooltip),this[t](i),this._tooltipHandlersAdded=!e}},openTooltip:function(e){return this._tooltip&&(this instanceof Wi||(this._tooltip._source=this),this._tooltip._prepareOpen(e)&&(this._tooltip.openOn(this._map),this.getElement?this._setAriaDescribedByOnLayer(this):this.eachLayer&&this.eachLayer(this._setAriaDescribedByOnLayer,this))),this},closeTooltip:function(){if(this._tooltip)return this._tooltip.close()},toggleTooltip:function(){return this._tooltip&&this._tooltip.toggle(this),this},isTooltipOpen:function(){return this._tooltip.isOpen()},setTooltipContent:function(e){return this._tooltip&&this._tooltip.setContent(e),this},getTooltip:function(){return this._tooltip},_addFocusListeners:function(){this.getElement?this._addFocusListenersOnLayer(this):this.eachLayer&&this.eachLayer(this._addFocusListenersOnLayer,this)},_addFocusListenersOnLayer:function(e){var t="function"==typeof e.getElement&&e.getElement();t&&(Ut(t,"focus",(function(){this._tooltip._source=e,this.openTooltip()}),this),Ut(t,"blur",this.closeTooltip,this))},_setAriaDescribedByOnLayer:function(e){var t="function"==typeof e.getElement&&e.getElement();t&&t.setAttribute("aria-describedby",this._tooltip._container.id)},_openTooltip:function(e){if(this._tooltip&&this._map)if(this._map.dragging&&this._map.dragging.moving()&&!this._openOnceFlag){this._openOnceFlag=!0;var t=this;this._map.once("moveend",(function(){t._openOnceFlag=!1,t._openTooltip(e)}))}else this._tooltip._source=e.layer||e.target,this.openTooltip(this._tooltip.options.sticky?e.latlng:void 0)},_moveTooltip:function(e){var t,i,r=e.latlng;this._tooltip.options.sticky&&e.originalEvent&&(t=this._map.mouseEventToContainerPoint(e.originalEvent),i=this._map.containerPointToLayerPoint(t),r=this._map.layerPointToLatLng(i)),this._tooltip.setLatLng(r)}});var Rr=Yi.extend({options:{iconSize:[12,12],html:!1,bgPos:null,className:"leaflet-div-icon"},createIcon:function(e){var t=e&&"DIV"===e.tagName?e:document.createElement("div"),i=this.options;if(i.html instanceof Element?(gt(t),t.appendChild(i.html)):t.innerHTML=!1!==i.html?i.html:"",i.bgPos){var r=z(i.bgPos);t.style.backgroundPosition=-r.x+"px "+-r.y+"px"}return this._setIconStyles(t,"icon"),t},createShadow:function(){return null}});function Dr(e){return new Rr(e)}Yi.Default=er;var Or=Zi.extend({options:{tileSize:256,opacity:1,updateWhenIdle:Oe.mobile,updateWhenZooming:!0,updateInterval:200,zIndex:1,bounds:null,minZoom:0,maxZoom:void 0,maxNativeZoom:void 0,minNativeZoom:void 0,noWrap:!1,pane:"tilePane",className:"",keepBuffer:2},initialize:function(e){p(this,e)},onAdd:function(){this._initContainer(),this._levels={},this._tiles={},this._resetView()},beforeAdd:function(e){e._addZoomLimit(this)},onRemove:function(e){this._removeAllTiles(),mt(this._container),e._removeZoomLimit(this),this._container=null,this._tileZoom=void 0},bringToFront:function(){return this._map&&(_t(this._container),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this._map&&(yt(this._container),this._setAutoZIndex(Math.min)),this},getContainer:function(){return this._container},setOpacity:function(e){return this.options.opacity=e,this._updateOpacity(),this},setZIndex:function(e){return this.options.zIndex=e,this._updateZIndex(),this},isLoading:function(){return this._loading},redraw:function(){if(this._map){this._removeAllTiles();var e=this._clampZoom(this._map.getZoom());e!==this._tileZoom&&(this._tileZoom=e,this._updateLevels()),this._update()}return this},getEvents:function(){var e={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=a(this._onMoveEnd,this.options.updateInterval,this)),e.move=this._onMove),this._zoomAnimated&&(e.zoomanim=this._animateZoom),e},createTile:function(){return document.createElement("div")},getTileSize:function(){var e=this.options.tileSize;return e instanceof F?e:new F(e,e)},_updateZIndex:function(){this._container&&void 0!==this.options.zIndex&&null!==this.options.zIndex&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(e){for(var t,i=this.getPane().children,r=-e(-1/0,1/0),n=0,o=i.length;n<o;n++)t=i[n].style.zIndex,i[n]!==this._container&&t&&(r=e(r,+t));isFinite(r)&&(this.options.zIndex=r+e(-1,1),this._updateZIndex())},_updateOpacity:function(){if(this._map&&!Oe.ielt9){Bt(this._container,this.options.opacity);var e=+new Date,t=!1,i=!1;for(var r in this._tiles){var n=this._tiles[r];if(n.current&&n.loaded){var o=Math.min(1,(e-n.loaded)/200);Bt(n.el,o),o<1?t=!0:(n.active?i=!0:this._onOpaqueTile(n),n.active=!0)}}i&&!this._noPrune&&this._pruneTiles(),t&&(C(this._fadeFrame),this._fadeFrame=B(this._updateOpacity,this))}},_onOpaqueTile:c,_initContainer:function(){this._container||(this._container=At("div","leaflet-layer "+(this.options.className||"")),this._updateZIndex(),this.options.opacity<1&&this._updateOpacity(),this.getPane().appendChild(this._container))},_updateLevels:function(){var e=this._tileZoom,t=this.options.maxZoom;if(void 0!==e){for(var i in this._levels)i=Number(i),this._levels[i].el.children.length||i===e?(this._levels[i].el.style.zIndex=t-Math.abs(e-i),this._onUpdateLevel(i)):(mt(this._levels[i].el),this._removeTilesAtZoom(i),this._onRemoveLevel(i),delete this._levels[i]);var r=this._levels[e],n=this._map;return r||((r=this._levels[e]={}).el=At("div","leaflet-tile-container leaflet-zoom-animated",this._container),r.el.style.zIndex=t,r.origin=n.project(n.unproject(n.getPixelOrigin()),e).round(),r.zoom=e,this._setZoomTransform(r,n.getCenter(),n.getZoom()),c(r.el.offsetWidth),this._onCreateLevel(r)),this._level=r,r}},_onUpdateLevel:c,_onRemoveLevel:c,_onCreateLevel:c,_pruneTiles:function(){if(this._map){var e,t,i=this._map.getZoom();if(i>this.options.maxZoom||i<this.options.minZoom)this._removeAllTiles();else{for(e in this._tiles)(t=this._tiles[e]).retain=t.current;for(e in this._tiles)if((t=this._tiles[e]).current&&!t.active){var r=t.coords;this._retainParent(r.x,r.y,r.z,r.z-5)||this._retainChildren(r.x,r.y,r.z,r.z+2)}for(e in this._tiles)this._tiles[e].retain||this._removeTile(e)}}},_removeTilesAtZoom:function(e){for(var t in this._tiles)this._tiles[t].coords.z===e&&this._removeTile(t)},_removeAllTiles:function(){for(var e in this._tiles)this._removeTile(e)},_invalidateAll:function(){for(var e in this._levels)mt(this._levels[e].el),this._onRemoveLevel(Number(e)),delete this._levels[e];this._removeAllTiles(),this._tileZoom=void 0},_retainParent:function(e,t,i,r){var n=Math.floor(e/2),o=Math.floor(t/2),s=i-1,a=new F(+n,+o);a.z=+s;var l=this._tileCoordsToKey(a),c=this._tiles[l];return c&&c.active?(c.retain=!0,!0):(c&&c.loaded&&(c.retain=!0),s>r&&this._retainParent(n,o,s,r))},_retainChildren:function(e,t,i,r){for(var n=2*e;n<2*e+2;n++)for(var o=2*t;o<2*t+2;o++){var s=new F(n,o);s.z=i+1;var a=this._tileCoordsToKey(s),l=this._tiles[a];l&&l.active?l.retain=!0:(l&&l.loaded&&(l.retain=!0),i+1<r&&this._retainChildren(n,o,i+1,r))}},_resetView:function(e){var t=e&&(e.pinch||e.flyTo);this._setView(this._map.getCenter(),this._map.getZoom(),t,t)},_animateZoom:function(e){this._setView(e.center,e.zoom,!0,e.noUpdate)},_clampZoom:function(e){var t=this.options;return void 0!==t.minNativeZoom&&e<t.minNativeZoom?t.minNativeZoom:void 0!==t.maxNativeZoom&&t.maxNativeZoom<e?t.maxNativeZoom:e},_setView:function(e,t,i,r){var n=Math.round(t);n=void 0!==this.options.maxZoom&&n>this.options.maxZoom||void 0!==this.options.minZoom&&n<this.options.minZoom?void 0:this._clampZoom(n);var o=this.options.updateWhenZooming&&n!==this._tileZoom;r&&!o||(this._tileZoom=n,this._abortLoading&&this._abortLoading(),this._updateLevels(),this._resetGrid(),void 0!==n&&this._update(e),i||this._pruneTiles(),this._noPrune=!!i),this._setZoomTransforms(e,t)},_setZoomTransforms:function(e,t){for(var i in this._levels)this._setZoomTransform(this._levels[i],e,t)},_setZoomTransform:function(e,t,i){var r=this._map.getZoomScale(i,e.zoom),n=e.origin.multiplyBy(r).subtract(this._map._getNewPixelOrigin(t,i)).round();Oe.any3d?Et(e.el,n,r):Mt(e.el,n)},_resetGrid:function(){var e=this._map,t=e.options.crs,i=this._tileSize=this.getTileSize(),r=this._tileZoom,n=this._map.getPixelWorldBounds(this._tileZoom);n&&(this._globalTileRange=this._pxBoundsToTileRange(n)),this._wrapX=t.wrapLng&&!this.options.noWrap&&[Math.floor(e.project([0,t.wrapLng[0]],r).x/i.x),Math.ceil(e.project([0,t.wrapLng[1]],r).x/i.y)],this._wrapY=t.wrapLat&&!this.options.noWrap&&[Math.floor(e.project([t.wrapLat[0],0],r).y/i.x),Math.ceil(e.project([t.wrapLat[1],0],r).y/i.y)]},_onMoveEnd:function(){this._map&&!this._map._animatingZoom&&this._update()},_getTiledPixelBounds:function(e){var t=this._map,i=t._animatingZoom?Math.max(t._animateToZoom,t.getZoom()):t.getZoom(),r=t.getZoomScale(i,this._tileZoom),n=t.project(e,this._tileZoom).floor(),o=t.getSize().divideBy(2*r);return new R(n.subtract(o),n.add(o))},_update:function(e){var t=this._map;if(t){var i=this._clampZoom(t.getZoom());if(void 0===e&&(e=t.getCenter()),void 0!==this._tileZoom){var r=this._getTiledPixelBounds(e),n=this._pxBoundsToTileRange(r),o=n.getCenter(),s=[],a=this.options.keepBuffer,l=new R(n.getBottomLeft().subtract([a,-a]),n.getTopRight().add([a,-a]));if(!(isFinite(n.min.x)&&isFinite(n.min.y)&&isFinite(n.max.x)&&isFinite(n.max.y)))throw new Error("Attempted to load an infinite number of tiles");for(var c in this._tiles){var u=this._tiles[c].coords;u.z===this._tileZoom&&l.contains(new F(u.x,u.y))||(this._tiles[c].current=!1)}if(Math.abs(i-this._tileZoom)>1)this._setView(e,i);else{for(var h=n.min.y;h<=n.max.y;h++)for(var d=n.min.x;d<=n.max.x;d++){var p=new F(d,h);if(p.z=this._tileZoom,this._isValidTile(p)){var f=this._tiles[this._tileCoordsToKey(p)];f?f.current=!0:s.push(p)}}if(s.sort((function(e,t){return e.distanceTo(o)-t.distanceTo(o)})),0!==s.length){this._loading||(this._loading=!0,this.fire("loading"));var A=document.createDocumentFragment();for(d=0;d<s.length;d++)this._addTile(s[d],A);this._level.el.appendChild(A)}}}}},_isValidTile:function(e){var t=this._map.options.crs;if(!t.infinite){var i=this._globalTileRange;if(!t.wrapLng&&(e.x<i.min.x||e.x>i.max.x)||!t.wrapLat&&(e.y<i.min.y||e.y>i.max.y))return!1}if(!this.options.bounds)return!0;var r=this._tileCoordsToBounds(e);return U(this.options.bounds).overlaps(r)},_keyToBounds:function(e){return this._tileCoordsToBounds(this._keyToTileCoords(e))},_tileCoordsToNwSe:function(e){var t=this._map,i=this.getTileSize(),r=e.scaleBy(i),n=r.add(i);return[t.unproject(r,e.z),t.unproject(n,e.z)]},_tileCoordsToBounds:function(e){var t=this._tileCoordsToNwSe(e),i=new O(t[0],t[1]);return this.options.noWrap||(i=this._map.wrapLatLngBounds(i)),i},_tileCoordsToKey:function(e){return e.x+":"+e.y+":"+e.z},_keyToTileCoords:function(e){var t=e.split(":"),i=new F(+t[0],+t[1]);return i.z=+t[2],i},_removeTile:function(e){var t=this._tiles[e];t&&(mt(t.el),delete this._tiles[e],this.fire("tileunload",{tile:t.el,coords:this._keyToTileCoords(e)}))},_initTile:function(e){xt(e,"leaflet-tile");var t=this.getTileSize();e.style.width=t.x+"px",e.style.height=t.y+"px",e.onselectstart=c,e.onmousemove=c,Oe.ielt9&&this.options.opacity<1&&Bt(e,this.options.opacity)},_addTile:function(e,t){var i=this._getTilePos(e),r=this._tileCoordsToKey(e),o=this.createTile(this._wrapCoords(e),n(this._tileReady,this,e));this._initTile(o),this.createTile.length<2&&B(n(this._tileReady,this,e,null,o)),Mt(o,i),this._tiles[r]={el:o,coords:e,current:!0},t.appendChild(o),this.fire("tileloadstart",{tile:o,coords:e})},_tileReady:function(e,t,i){t&&this.fire("tileerror",{error:t,tile:i,coords:e});var r=this._tileCoordsToKey(e);(i=this._tiles[r])&&(i.loaded=+new Date,this._map._fadeAnimated?(Bt(i.el,0),C(this._fadeFrame),this._fadeFrame=B(this._updateOpacity,this)):(i.active=!0,this._pruneTiles()),t||(xt(i.el,"leaflet-tile-loaded"),this.fire("tileload",{tile:i.el,coords:e})),this._noTilesToLoad()&&(this._loading=!1,this.fire("load"),Oe.ielt9||!this._map._fadeAnimated?B(this._pruneTiles,this):setTimeout(n(this._pruneTiles,this),250)))},_getTilePos:function(e){return e.scaleBy(this.getTileSize()).subtract(this._level.origin)},_wrapCoords:function(e){var t=new F(this._wrapX?l(e.x,this._wrapX):e.x,this._wrapY?l(e.y,this._wrapY):e.y);return t.z=e.z,t},_pxBoundsToTileRange:function(e){var t=this.getTileSize();return new R(e.min.unscaleBy(t).floor(),e.max.unscaleBy(t).ceil().subtract([1,1]))},_noTilesToLoad:function(){for(var e in this._tiles)if(!this._tiles[e].loaded)return!1;return!0}});function Ur(e){return new Or(e)}var Nr=Or.extend({options:{minZoom:0,maxZoom:18,subdomains:"abc",errorTileUrl:"",zoomOffset:0,tms:!1,zoomReverse:!1,detectRetina:!1,crossOrigin:!1,referrerPolicy:!1},initialize:function(e,t){this._url=e,(t=p(this,t)).detectRetina&&Oe.retina&&t.maxZoom>0?(t.tileSize=Math.floor(t.tileSize/2),t.zoomReverse?(t.zoomOffset--,t.minZoom=Math.min(t.maxZoom,t.minZoom+1)):(t.zoomOffset++,t.maxZoom=Math.max(t.minZoom,t.maxZoom-1)),t.minZoom=Math.max(0,t.minZoom)):t.zoomReverse?t.minZoom=Math.min(t.maxZoom,t.minZoom):t.maxZoom=Math.max(t.minZoom,t.maxZoom),"string"==typeof t.subdomains&&(t.subdomains=t.subdomains.split("")),this.on("tileunload",this._onTileRemove)},setUrl:function(e,t){return this._url===e&&void 0===t&&(t=!0),this._url=e,t||this.redraw(),this},createTile:function(e,t){var i=document.createElement("img");return Ut(i,"load",n(this._tileOnLoad,this,t,i)),Ut(i,"error",n(this._tileOnError,this,t,i)),(this.options.crossOrigin||""===this.options.crossOrigin)&&(i.crossOrigin=!0===this.options.crossOrigin?"":this.options.crossOrigin),"string"==typeof this.options.referrerPolicy&&(i.referrerPolicy=this.options.referrerPolicy),i.alt="",i.src=this.getTileUrl(e),i},getTileUrl:function(e){var t={r:Oe.retina?"@2x":"",s:this._getSubdomain(e),x:e.x,y:e.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var r=this._globalTileRange.max.y-e.y;this.options.tms&&(t.y=r),t["-y"]=r}return m(this._url,i(t,this.options))},_tileOnLoad:function(e,t){Oe.ielt9?setTimeout(n(e,this,null,t),0):e(null,t)},_tileOnError:function(e,t,i){var r=this.options.errorTileUrl;r&&t.getAttribute("src")!==r&&(t.src=r),e(i,t)},_onTileRemove:function(e){e.tile.onload=null},_getZoomForUrl:function(){var e=this._tileZoom,t=this.options.maxZoom;return this.options.zoomReverse&&(e=t-e),e+this.options.zoomOffset},_getSubdomain:function(e){var t=Math.abs(e.x+e.y)%this.options.subdomains.length;return this.options.subdomains[t]},_abortLoading:function(){var e,t;for(e in this._tiles)if(this._tiles[e].coords.z!==this._tileZoom&&((t=this._tiles[e].el).onload=c,t.onerror=c,!t.complete)){t.src=y;var i=this._tiles[e].coords;mt(t),delete this._tiles[e],this.fire("tileabort",{tile:t,coords:i})}},_removeTile:function(e){var t=this._tiles[e];if(t)return t.el.setAttribute("src",y),Or.prototype._removeTile.call(this,e)},_tileReady:function(e,t,i){if(this._map&&(!i||i.getAttribute("src")!==y))return Or.prototype._tileReady.call(this,e,t,i)}});function Qr(e,t){return new Nr(e,t)}var jr=Nr.extend({defaultWmsParams:{service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},options:{crs:null,uppercase:!1},initialize:function(e,t){this._url=e;var r=i({},this.defaultWmsParams);for(var n in t)n in this.options||(r[n]=t[n]);var o=(t=p(this,t)).detectRetina&&Oe.retina?2:1,s=this.getTileSize();r.width=s.x*o,r.height=s.y*o,this.wmsParams=r},onAdd:function(e){this._crs=this.options.crs||e.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var t=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[t]=this._crs.code,Nr.prototype.onAdd.call(this,e)},getTileUrl:function(e){var t=this._tileCoordsToNwSe(e),i=this._crs,r=D(i.project(t[0]),i.project(t[1])),n=r.min,o=r.max,s=(this._wmsVersion>=1.3&&this._crs===Gi?[n.y,n.x,o.y,o.x]:[n.x,n.y,o.x,o.y]).join(","),a=Nr.prototype.getTileUrl.call(this,e);return a+f(this.wmsParams,a,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+s},setParams:function(e,t){return i(this.wmsParams,e),t||this.redraw(),this}});function Vr(e,t){return new jr(e,t)}Nr.WMS=jr,Qr.wms=Vr;var Hr=Zi.extend({options:{padding:.1},initialize:function(e){p(this,e),s(this),this._layers=this._layers||{}},onAdd:function(){this._container||(this._initContainer(),xt(this._container,"leaflet-zoom-animated")),this.getPane().appendChild(this._container),this._update(),this.on("update",this._updatePaths,this)},onRemove:function(){this.off("update",this._updatePaths,this),this._destroyContainer()},getEvents:function(){var e={viewreset:this._reset,zoom:this._onZoom,moveend:this._update,zoomend:this._onZoomEnd};return this._zoomAnimated&&(e.zoomanim=this._onAnimZoom),e},_onAnimZoom:function(e){this._updateTransform(e.center,e.zoom)},_onZoom:function(){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_updateTransform:function(e,t){var i=this._map.getZoomScale(t,this._zoom),r=this._map.getSize().multiplyBy(.5+this.options.padding),n=this._map.project(this._center,t),o=r.multiplyBy(-i).add(n).subtract(this._map._getNewPixelOrigin(e,t));Oe.any3d?Et(this._container,o,i):Mt(this._container,o)},_reset:function(){for(var e in this._update(),this._updateTransform(this._center,this._zoom),this._layers)this._layers[e]._reset()},_onZoomEnd:function(){for(var e in this._layers)this._layers[e]._project()},_updatePaths:function(){for(var e in this._layers)this._layers[e]._update()},_update:function(){var e=this.options.padding,t=this._map.getSize(),i=this._map.containerPointToLayerPoint(t.multiplyBy(-e)).round();this._bounds=new R(i,i.add(t.multiplyBy(1+2*e)).round()),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()}}),Gr=Hr.extend({options:{tolerance:0},getEvents:function(){var e=Hr.prototype.getEvents.call(this);return e.viewprereset=this._onViewPreReset,e},_onViewPreReset:function(){this._postponeUpdatePaths=!0},onAdd:function(){Hr.prototype.onAdd.call(this),this._draw()},_initContainer:function(){var e=this._container=document.createElement("canvas");Ut(e,"mousemove",this._onMouseMove,this),Ut(e,"click dblclick mousedown mouseup contextmenu",this._onClick,this),Ut(e,"mouseout",this._handleMouseOut,this),e._leaflet_disable_events=!0,this._ctx=e.getContext("2d")},_destroyContainer:function(){C(this._redrawRequest),delete this._ctx,mt(this._container),Qt(this._container),delete this._container},_updatePaths:function(){if(!this._postponeUpdatePaths){for(var e in this._redrawBounds=null,this._layers)this._layers[e]._update();this._redraw()}},_update:function(){if(!this._map._animatingZoom||!this._bounds){Hr.prototype._update.call(this);var e=this._bounds,t=this._container,i=e.getSize(),r=Oe.retina?2:1;Mt(t,e.min),t.width=r*i.x,t.height=r*i.y,t.style.width=i.x+"px",t.style.height=i.y+"px",Oe.retina&&this._ctx.scale(2,2),this._ctx.translate(-e.min.x,-e.min.y),this.fire("update")}},_reset:function(){Hr.prototype._reset.call(this),this._postponeUpdatePaths&&(this._postponeUpdatePaths=!1,this._updatePaths())},_initPath:function(e){this._updateDashArray(e),this._layers[s(e)]=e;var t=e._order={layer:e,prev:this._drawLast,next:null};this._drawLast&&(this._drawLast.next=t),this._drawLast=t,this._drawFirst=this._drawFirst||this._drawLast},_addPath:function(e){this._requestRedraw(e)},_removePath:function(e){var t=e._order,i=t.next,r=t.prev;i?i.prev=r:this._drawLast=r,r?r.next=i:this._drawFirst=i,delete e._order,delete this._layers[s(e)],this._requestRedraw(e)},_updatePath:function(e){this._extendRedrawBounds(e),e._project(),e._update(),this._requestRedraw(e)},_updateStyle:function(e){this._updateDashArray(e),this._requestRedraw(e)},_updateDashArray:function(e){if("string"==typeof e.options.dashArray){var t,i,r=e.options.dashArray.split(/[, ]+/),n=[];for(i=0;i<r.length;i++){if(t=Number(r[i]),isNaN(t))return;n.push(t)}e.options._dashArray=n}else e.options._dashArray=e.options.dashArray},_requestRedraw:function(e){this._map&&(this._extendRedrawBounds(e),this._redrawRequest=this._redrawRequest||B(this._redraw,this))},_extendRedrawBounds:function(e){if(e._pxBounds){var t=(e.options.weight||0)+1;this._redrawBounds=this._redrawBounds||new R,this._redrawBounds.extend(e._pxBounds.min.subtract([t,t])),this._redrawBounds.extend(e._pxBounds.max.add([t,t]))}},_redraw:function(){this._redrawRequest=null,this._redrawBounds&&(this._redrawBounds.min._floor(),this._redrawBounds.max._ceil()),this._clear(),this._draw(),this._redrawBounds=null},_clear:function(){var e=this._redrawBounds;if(e){var t=e.getSize();this._ctx.clearRect(e.min.x,e.min.y,t.x,t.y)}else this._ctx.save(),this._ctx.setTransform(1,0,0,1,0,0),this._ctx.clearRect(0,0,this._container.width,this._container.height),this._ctx.restore()},_draw:function(){var e,t=this._redrawBounds;if(this._ctx.save(),t){var i=t.getSize();this._ctx.beginPath(),this._ctx.rect(t.min.x,t.min.y,i.x,i.y),this._ctx.clip()}this._drawing=!0;for(var r=this._drawFirst;r;r=r.next)e=r.layer,(!t||e._pxBounds&&e._pxBounds.intersects(t))&&e._updatePath();this._drawing=!1,this._ctx.restore()},_updatePoly:function(e,t){if(this._drawing){var i,r,n,o,s=e._parts,a=s.length,l=this._ctx;if(a){for(l.beginPath(),i=0;i<a;i++){for(r=0,n=s[i].length;r<n;r++)o=s[i][r],l[r?"lineTo":"moveTo"](o.x,o.y);t&&l.closePath()}this._fillStroke(l,e)}}},_updateCircle:function(e){if(this._drawing&&!e._empty()){var t=e._point,i=this._ctx,r=Math.max(Math.round(e._radius),1),n=(Math.max(Math.round(e._radiusY),1)||r)/r;1!==n&&(i.save(),i.scale(1,n)),i.beginPath(),i.arc(t.x,t.y/n,r,0,2*Math.PI,!1),1!==n&&i.restore(),this._fillStroke(i,e)}},_fillStroke:function(e,t){var i=t.options;i.fill&&(e.globalAlpha=i.fillOpacity,e.fillStyle=i.fillColor||i.color,e.fill(i.fillRule||"evenodd")),i.stroke&&0!==i.weight&&(e.setLineDash&&e.setLineDash(t.options&&t.options._dashArray||[]),e.globalAlpha=i.opacity,e.lineWidth=i.weight,e.strokeStyle=i.color,e.lineCap=i.lineCap,e.lineJoin=i.lineJoin,e.stroke())},_onClick:function(e){for(var t,i,r=this._map.mouseEventToLayerPoint(e),n=this._drawFirst;n;n=n.next)(t=n.layer).options.interactive&&t._containsPoint(r)&&("click"!==e.type&&"preclick"!==e.type||!this._map._draggableMoved(t))&&(i=t);this._fireEvent(!!i&&[i],e)},_onMouseMove:function(e){if(this._map&&!this._map.dragging.moving()&&!this._map._animatingZoom){var t=this._map.mouseEventToLayerPoint(e);this._handleMouseHover(e,t)}},_handleMouseOut:function(e){var t=this._hoveredLayer;t&&(bt(this._container,"leaflet-interactive"),this._fireEvent([t],e,"mouseout"),this._hoveredLayer=null,this._mouseHoverThrottled=!1)},_handleMouseHover:function(e,t){if(!this._mouseHoverThrottled){for(var i,r,o=this._drawFirst;o;o=o.next)(i=o.layer).options.interactive&&i._containsPoint(t)&&(r=i);r!==this._hoveredLayer&&(this._handleMouseOut(e),r&&(xt(this._container,"leaflet-interactive"),this._fireEvent([r],e,"mouseover"),this._hoveredLayer=r)),this._fireEvent(!!this._hoveredLayer&&[this._hoveredLayer],e),this._mouseHoverThrottled=!0,setTimeout(n((function(){this._mouseHoverThrottled=!1}),this),32)}},_fireEvent:function(e,t,i){this._map._fireDOMEvent(t,i||t.type,e)},_bringToFront:function(e){var t=e._order;if(t){var i=t.next,r=t.prev;i&&(i.prev=r,r?r.next=i:i&&(this._drawFirst=i),t.prev=this._drawLast,this._drawLast.next=t,t.next=null,this._drawLast=t,this._requestRedraw(e))}},_bringToBack:function(e){var t=e._order;if(t){var i=t.next,r=t.prev;r&&(r.next=i,i?i.prev=r:r&&(this._drawLast=r),t.prev=null,t.next=this._drawFirst,this._drawFirst.prev=t,this._drawFirst=t,this._requestRedraw(e))}}});function $r(e){return Oe.canvas?new Gr(e):null}var Zr=function(){try{return document.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(e){return document.createElement("<lvml:"+e+' class="lvml">')}}catch(e){}return function(e){return document.createElement("<"+e+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}}(),qr={_initContainer:function(){this._container=At("div","leaflet-vml-container")},_update:function(){this._map._animatingZoom||(Hr.prototype._update.call(this),this.fire("update"))},_initPath:function(e){var t=e._container=Zr("shape");xt(t,"leaflet-vml-shape "+(this.options.className||"")),t.coordsize="1 1",e._path=Zr("path"),t.appendChild(e._path),this._updateStyle(e),this._layers[s(e)]=e},_addPath:function(e){var t=e._container;this._container.appendChild(t),e.options.interactive&&e.addInteractiveTarget(t)},_removePath:function(e){var t=e._container;mt(t),e.removeInteractiveTarget(t),delete this._layers[s(e)]},_updateStyle:function(e){var t=e._stroke,i=e._fill,r=e.options,n=e._container;n.stroked=!!r.stroke,n.filled=!!r.fill,r.stroke?(t||(t=e._stroke=Zr("stroke")),n.appendChild(t),t.weight=r.weight+"px",t.color=r.color,t.opacity=r.opacity,r.dashArray?t.dashStyle=g(r.dashArray)?r.dashArray.join(" "):r.dashArray.replace(/( *, *)/g," "):t.dashStyle="",t.endcap=r.lineCap.replace("butt","flat"),t.joinstyle=r.lineJoin):t&&(n.removeChild(t),e._stroke=null),r.fill?(i||(i=e._fill=Zr("fill")),n.appendChild(i),i.color=r.fillColor||r.color,i.opacity=r.fillOpacity):i&&(n.removeChild(i),e._fill=null)},_updateCircle:function(e){var t=e._point.round(),i=Math.round(e._radius),r=Math.round(e._radiusY||i);this._setPath(e,e._empty()?"M0 0":"AL "+t.x+","+t.y+" "+i+","+r+" 0,23592600")},_setPath:function(e,t){e._path.v=t},_bringToFront:function(e){_t(e._container)},_bringToBack:function(e){yt(e._container)}},Kr=Oe.vml?Zr:X,Wr=Hr.extend({_initContainer:function(){this._container=Kr("svg"),this._container.setAttribute("pointer-events","none"),this._rootGroup=Kr("g"),this._container.appendChild(this._rootGroup)},_destroyContainer:function(){mt(this._container),Qt(this._container),delete this._container,delete this._rootGroup,delete this._svgSize},_update:function(){if(!this._map._animatingZoom||!this._bounds){Hr.prototype._update.call(this);var e=this._bounds,t=e.getSize(),i=this._container;this._svgSize&&this._svgSize.equals(t)||(this._svgSize=t,i.setAttribute("width",t.x),i.setAttribute("height",t.y)),Mt(i,e.min),i.setAttribute("viewBox",[e.min.x,e.min.y,t.x,t.y].join(" ")),this.fire("update")}},_initPath:function(e){var t=e._path=Kr("path");e.options.className&&xt(t,e.options.className),e.options.interactive&&xt(t,"leaflet-interactive"),this._updateStyle(e),this._layers[s(e)]=e},_addPath:function(e){this._rootGroup||this._initContainer(),this._rootGroup.appendChild(e._path),e.addInteractiveTarget(e._path)},_removePath:function(e){mt(e._path),e.removeInteractiveTarget(e._path),delete this._layers[s(e)]},_updatePath:function(e){e._project(),e._update()},_updateStyle:function(e){var t=e._path,i=e.options;t&&(i.stroke?(t.setAttribute("stroke",i.color),t.setAttribute("stroke-opacity",i.opacity),t.setAttribute("stroke-width",i.weight),t.setAttribute("stroke-linecap",i.lineCap),t.setAttribute("stroke-linejoin",i.lineJoin),i.dashArray?t.setAttribute("stroke-dasharray",i.dashArray):t.removeAttribute("stroke-dasharray"),i.dashOffset?t.setAttribute("stroke-dashoffset",i.dashOffset):t.removeAttribute("stroke-dashoffset")):t.setAttribute("stroke","none"),i.fill?(t.setAttribute("fill",i.fillColor||i.color),t.setAttribute("fill-opacity",i.fillOpacity),t.setAttribute("fill-rule",i.fillRule||"evenodd")):t.setAttribute("fill","none"))},_updatePoly:function(e,t){this._setPath(e,Y(e._parts,t))},_updateCircle:function(e){var t=e._point,i=Math.max(Math.round(e._radius),1),r="a"+i+","+(Math.max(Math.round(e._radiusY),1)||i)+" 0 1,0 ",n=e._empty()?"M0 0":"M"+(t.x-i)+","+t.y+r+2*i+",0 "+r+2*-i+",0 ";this._setPath(e,n)},_setPath:function(e,t){e._path.setAttribute("d",t)},_bringToFront:function(e){_t(e._path)},_bringToBack:function(e){yt(e._path)}});function Xr(e){return Oe.svg||Oe.vml?new Wr(e):null}Oe.vml&&Wr.include(qr),ni.include({getRenderer:function(e){var t=e.options.renderer||this._getPaneRenderer(e.options.pane)||this.options.renderer||this._renderer;return t||(t=this._renderer=this._createRenderer()),this.hasLayer(t)||this.addLayer(t),t},_getPaneRenderer:function(e){if("overlayPane"===e||void 0===e)return!1;var t=this._paneRenderers[e];return void 0===t&&(t=this._createRenderer({pane:e}),this._paneRenderers[e]=t),t},_createRenderer:function(e){return this.options.preferCanvas&&$r(e)||Xr(e)}});var Yr=hr.extend({initialize:function(e,t){hr.prototype.initialize.call(this,this._boundsToLatLngs(e),t)},setBounds:function(e){return this.setLatLngs(this._boundsToLatLngs(e))},_boundsToLatLngs:function(e){return[(e=U(e)).getSouthWest(),e.getNorthWest(),e.getNorthEast(),e.getSouthEast()]}});function Jr(e,t){return new Yr(e,t)}Wr.create=Kr,Wr.pointsToPath=Y,pr.geometryToLayer=fr,pr.coordsToLatLng=mr,pr.coordsToLatLngs=gr,pr.latLngToCoords=_r,pr.latLngsToCoords=yr,pr.getFeature=vr,pr.asFeature=xr,ni.mergeOptions({boxZoom:!0});var en=gi.extend({initialize:function(e){this._map=e,this._container=e._container,this._pane=e._panes.overlayPane,this._resetStateTimeout=0,e.on("unload",this._destroy,this)},addHooks:function(){Ut(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){Qt(this._container,"mousedown",this._onMouseDown,this)},moved:function(){return this._moved},_destroy:function(){mt(this._pane),delete this._pane},_resetState:function(){this._resetStateTimeout=0,this._moved=!1},_clearDeferredResetState:function(){0!==this._resetStateTimeout&&(clearTimeout(this._resetStateTimeout),this._resetStateTimeout=0)},_onMouseDown:function(e){if(!e.shiftKey||1!==e.which&&1!==e.button)return!1;this._clearDeferredResetState(),this._resetState(),ot(),Lt(),this._startPoint=this._map.mouseEventToContainerPoint(e),Ut(document,{contextmenu:Wt,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseMove:function(e){this._moved||(this._moved=!0,this._box=At("div","leaflet-zoom-box",this._container),xt(this._container,"leaflet-crosshair"),this._map.fire("boxzoomstart")),this._point=this._map.mouseEventToContainerPoint(e);var t=new R(this._point,this._startPoint),i=t.getSize();Mt(this._box,t.min),this._box.style.width=i.x+"px",this._box.style.height=i.y+"px"},_finish:function(){this._moved&&(mt(this._box),bt(this._container,"leaflet-crosshair")),st(),Ft(),Qt(document,{contextmenu:Wt,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseUp:function(e){if((1===e.which||1===e.button)&&(this._finish(),this._moved)){this._clearDeferredResetState(),this._resetStateTimeout=setTimeout(n(this._resetState,this),0);var t=new O(this._map.containerPointToLatLng(this._startPoint),this._map.containerPointToLatLng(this._point));this._map.fitBounds(t).fire("boxzoomend",{boxZoomBounds:t})}},_onKeyDown:function(e){27===e.keyCode&&(this._finish(),this._clearDeferredResetState(),this._resetState())}});ni.addInitHook("addHandler","boxZoom",en),ni.mergeOptions({doubleClickZoom:!0});var tn=gi.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(e){var t=this._map,i=t.getZoom(),r=t.options.zoomDelta,n=e.originalEvent.shiftKey?i-r:i+r;"center"===t.options.doubleClickZoom?t.setZoom(n):t.setZoomAround(e.containerPoint,n)}});ni.addInitHook("addHandler","doubleClickZoom",tn),ni.mergeOptions({dragging:!0,inertia:!0,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,easeLinearity:.2,worldCopyJump:!1,maxBoundsViscosity:0});var rn=gi.extend({addHooks:function(){if(!this._draggable){var e=this._map;this._draggable=new vi(e._mapPane,e._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),this._draggable.on("predrag",this._onPreDragLimit,this),e.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDragWrap,this),e.on("zoomend",this._onZoomEnd,this),e.whenReady(this._onZoomEnd,this))}xt(this._map._container,"leaflet-grab leaflet-touch-drag"),this._draggable.enable(),this._positions=[],this._times=[]},removeHooks:function(){bt(this._map._container,"leaflet-grab"),bt(this._map._container,"leaflet-touch-drag"),this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},moving:function(){return this._draggable&&this._draggable._moving},_onDragStart:function(){var e=this._map;if(e._stop(),this._map.options.maxBounds&&this._map.options.maxBoundsViscosity){var t=U(this._map.options.maxBounds);this._offsetLimit=D(this._map.latLngToContainerPoint(t.getNorthWest()).multiplyBy(-1),this._map.latLngToContainerPoint(t.getSouthEast()).multiplyBy(-1).add(this._map.getSize())),this._viscosity=Math.min(1,Math.max(0,this._map.options.maxBoundsViscosity))}else this._offsetLimit=null;e.fire("movestart").fire("dragstart"),e.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(e){if(this._map.options.inertia){var t=this._lastTime=+new Date,i=this._lastPos=this._draggable._absPos||this._draggable._newPos;this._positions.push(i),this._times.push(t),this._prunePositions(t)}this._map.fire("move",e).fire("drag",e)},_prunePositions:function(e){for(;this._positions.length>1&&e-this._times[0]>50;)this._positions.shift(),this._times.shift()},_onZoomEnd:function(){var e=this._map.getSize().divideBy(2),t=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=t.subtract(e).x,this._worldWidth=this._map.getPixelWorldBounds().getSize().x},_viscousLimit:function(e,t){return e-(e-t)*this._viscosity},_onPreDragLimit:function(){if(this._viscosity&&this._offsetLimit){var e=this._draggable._newPos.subtract(this._draggable._startPos),t=this._offsetLimit;e.x<t.min.x&&(e.x=this._viscousLimit(e.x,t.min.x)),e.y<t.min.y&&(e.y=this._viscousLimit(e.y,t.min.y)),e.x>t.max.x&&(e.x=this._viscousLimit(e.x,t.max.x)),e.y>t.max.y&&(e.y=this._viscousLimit(e.y,t.max.y)),this._draggable._newPos=this._draggable._startPos.add(e)}},_onPreDragWrap:function(){var e=this._worldWidth,t=Math.round(e/2),i=this._initialWorldOffset,r=this._draggable._newPos.x,n=(r-t+i)%e+t-i,o=(r+t+i)%e-t-i,s=Math.abs(n+i)<Math.abs(o+i)?n:o;this._draggable._absPos=this._draggable._newPos.clone(),this._draggable._newPos.x=s},_onDragEnd:function(e){var t=this._map,i=t.options,r=!i.inertia||e.noInertia||this._times.length<2;if(t.fire("dragend",e),r)t.fire("moveend");else{this._prunePositions(+new Date);var n=this._lastPos.subtract(this._positions[0]),o=(this._lastTime-this._times[0])/1e3,s=i.easeLinearity,a=n.multiplyBy(s/o),l=a.distanceTo([0,0]),c=Math.min(i.inertiaMaxSpeed,l),u=a.multiplyBy(c/l),h=c/(i.inertiaDeceleration*s),d=u.multiplyBy(-h/2).round();d.x||d.y?(d=t._limitOffset(d,t.options.maxBounds),B((function(){t.panBy(d,{duration:h,easeLinearity:s,noMoveStart:!0,animate:!0})}))):t.fire("moveend")}}});ni.addInitHook("addHandler","dragging",rn),ni.mergeOptions({keyboard:!0,keyboardPanDelta:80});var nn=gi.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,54,173]},initialize:function(e){this._map=e,this._setPanDelta(e.options.keyboardPanDelta),this._setZoomDelta(e.options.zoomDelta)},addHooks:function(){var e=this._map._container;e.tabIndex<=0&&(e.tabIndex="0"),Ut(e,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.on({focus:this._addHooks,blur:this._removeHooks},this)},removeHooks:function(){this._removeHooks(),Qt(this._map._container,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.off({focus:this._addHooks,blur:this._removeHooks},this)},_onMouseDown:function(){if(!this._focused){var e=document.body,t=document.documentElement,i=e.scrollTop||t.scrollTop,r=e.scrollLeft||t.scrollLeft;this._map._container.focus(),window.scrollTo(r,i)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanDelta:function(e){var t,i,r=this._panKeys={},n=this.keyCodes;for(t=0,i=n.left.length;t<i;t++)r[n.left[t]]=[-1*e,0];for(t=0,i=n.right.length;t<i;t++)r[n.right[t]]=[e,0];for(t=0,i=n.down.length;t<i;t++)r[n.down[t]]=[0,e];for(t=0,i=n.up.length;t<i;t++)r[n.up[t]]=[0,-1*e]},_setZoomDelta:function(e){var t,i,r=this._zoomKeys={},n=this.keyCodes;for(t=0,i=n.zoomIn.length;t<i;t++)r[n.zoomIn[t]]=e;for(t=0,i=n.zoomOut.length;t<i;t++)r[n.zoomOut[t]]=-e},_addHooks:function(){Ut(document,"keydown",this._onKeyDown,this)},_removeHooks:function(){Qt(document,"keydown",this._onKeyDown,this)},_onKeyDown:function(e){if(!(e.altKey||e.ctrlKey||e.metaKey)){var t,i=e.keyCode,r=this._map;if(i in this._panKeys){if(!r._panAnim||!r._panAnim._inProgress)if(t=this._panKeys[i],e.shiftKey&&(t=z(t).multiplyBy(3)),r.options.maxBounds&&(t=r._limitOffset(z(t),r.options.maxBounds)),r.options.worldCopyJump){var n=r.wrapLatLng(r.unproject(r.project(r.getCenter()).add(t)));r.panTo(n)}else r.panBy(t)}else if(i in this._zoomKeys)r.setZoom(r.getZoom()+(e.shiftKey?3:1)*this._zoomKeys[i]);else{if(27!==i||!r._popup||!r._popup.options.closeOnEscapeKey)return;r.closePopup()}Wt(e)}}});ni.addInitHook("addHandler","keyboard",nn),ni.mergeOptions({scrollWheelZoom:!0,wheelDebounceTime:40,wheelPxPerZoomLevel:60});var on=gi.extend({addHooks:function(){Ut(this._map._container,"wheel",this._onWheelScroll,this),this._delta=0},removeHooks:function(){Qt(this._map._container,"wheel",this._onWheelScroll,this)},_onWheelScroll:function(e){var t=ei(e),i=this._map.options.wheelDebounceTime;this._delta+=t,this._lastMousePos=this._map.mouseEventToContainerPoint(e),this._startTime||(this._startTime=+new Date);var r=Math.max(i-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(n(this._performZoom,this),r),Wt(e)},_performZoom:function(){var e=this._map,t=e.getZoom(),i=this._map.options.zoomSnap||0;e._stop();var r=this._delta/(4*this._map.options.wheelPxPerZoomLevel),n=4*Math.log(2/(1+Math.exp(-Math.abs(r))))/Math.LN2,o=i?Math.ceil(n/i)*i:n,s=e._limitZoom(t+(this._delta>0?o:-o))-t;this._delta=0,this._startTime=null,s&&("center"===e.options.scrollWheelZoom?e.setZoom(t+s):e.setZoomAround(this._lastMousePos,t+s))}});ni.addInitHook("addHandler","scrollWheelZoom",on);var sn=600;ni.mergeOptions({tapHold:Oe.touchNative&&Oe.safari&&Oe.mobile,tapTolerance:15});var an=gi.extend({addHooks:function(){Ut(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){Qt(this._map._container,"touchstart",this._onDown,this)},_onDown:function(e){if(clearTimeout(this._holdTimeout),1===e.touches.length){var t=e.touches[0];this._startPos=this._newPos=new F(t.clientX,t.clientY),this._holdTimeout=setTimeout(n((function(){this._cancel(),this._isTapValid()&&(Ut(document,"touchend",Kt),Ut(document,"touchend touchcancel",this._cancelClickPrevent),this._simulateEvent("contextmenu",t))}),this),sn),Ut(document,"touchend touchcancel contextmenu",this._cancel,this),Ut(document,"touchmove",this._onMove,this)}},_cancelClickPrevent:function e(){Qt(document,"touchend",Kt),Qt(document,"touchend touchcancel",e)},_cancel:function(){clearTimeout(this._holdTimeout),Qt(document,"touchend touchcancel contextmenu",this._cancel,this),Qt(document,"touchmove",this._onMove,this)},_onMove:function(e){var t=e.touches[0];this._newPos=new F(t.clientX,t.clientY)},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_simulateEvent:function(e,t){var i=new MouseEvent(e,{bubbles:!0,cancelable:!0,view:window,screenX:t.screenX,screenY:t.screenY,clientX:t.clientX,clientY:t.clientY});i._simulated=!0,t.target.dispatchEvent(i)}});ni.addInitHook("addHandler","tapHold",an),ni.mergeOptions({touchZoom:Oe.touch,bounceAtZoomLimits:!0});var ln=gi.extend({addHooks:function(){xt(this._map._container,"leaflet-touch-zoom"),Ut(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){bt(this._map._container,"leaflet-touch-zoom"),Qt(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(e){var t=this._map;if(e.touches&&2===e.touches.length&&!t._animatingZoom&&!this._zooming){var i=t.mouseEventToContainerPoint(e.touches[0]),r=t.mouseEventToContainerPoint(e.touches[1]);this._centerPoint=t.getSize()._divideBy(2),this._startLatLng=t.containerPointToLatLng(this._centerPoint),"center"!==t.options.touchZoom&&(this._pinchStartLatLng=t.containerPointToLatLng(i.add(r)._divideBy(2))),this._startDist=i.distanceTo(r),this._startZoom=t.getZoom(),this._moved=!1,this._zooming=!0,t._stop(),Ut(document,"touchmove",this._onTouchMove,this),Ut(document,"touchend touchcancel",this._onTouchEnd,this),Kt(e)}},_onTouchMove:function(e){if(e.touches&&2===e.touches.length&&this._zooming){var t=this._map,i=t.mouseEventToContainerPoint(e.touches[0]),r=t.mouseEventToContainerPoint(e.touches[1]),o=i.distanceTo(r)/this._startDist;if(this._zoom=t.getScaleZoom(o,this._startZoom),!t.options.bounceAtZoomLimits&&(this._zoom<t.getMinZoom()&&o<1||this._zoom>t.getMaxZoom()&&o>1)&&(this._zoom=t._limitZoom(this._zoom)),"center"===t.options.touchZoom){if(this._center=this._startLatLng,1===o)return}else{var s=i._add(r)._divideBy(2)._subtract(this._centerPoint);if(1===o&&0===s.x&&0===s.y)return;this._center=t.unproject(t.project(this._pinchStartLatLng,this._zoom).subtract(s),this._zoom)}this._moved||(t._moveStart(!0,!1),this._moved=!0),C(this._animRequest);var a=n(t._move,t,this._center,this._zoom,{pinch:!0,round:!1},void 0);this._animRequest=B(a,this,!0),Kt(e)}},_onTouchEnd:function(){this._moved&&this._zooming?(this._zooming=!1,C(this._animRequest),Qt(document,"touchmove",this._onTouchMove,this),Qt(document,"touchend touchcancel",this._onTouchEnd,this),this._map.options.zoomAnimation?this._map._animateZoom(this._center,this._map._limitZoom(this._zoom),!0,this._map.options.zoomSnap):this._map._resetView(this._center,this._map._limitZoom(this._zoom))):this._zooming=!1}});ni.addInitHook("addHandler","touchZoom",ln),ni.BoxZoom=en,ni.DoubleClickZoom=tn,ni.Drag=rn,ni.Keyboard=nn,ni.ScrollWheelZoom=on,ni.TapHold=an,ni.TouchZoom=ln,e.Bounds=R,e.Browser=Oe,e.CRS=V,e.Canvas=Gr,e.Circle=ar,e.CircleMarker=or,e.Class=E,e.Control=si,e.DivIcon=Rr,e.DivOverlay=Pr,e.DomEvent=ii,e.DomUtil=Ot,e.Draggable=vi,e.Evented=P,e.FeatureGroup=Wi,e.GeoJSON=pr,e.GridLayer=Or,e.Handler=gi,e.Icon=Yi,e.ImageOverlay=Br,e.LatLng=N,e.LatLngBounds=O,e.Layer=Zi,e.LayerGroup=qi,e.LineUtil=Ni,e.Map=ni,e.Marker=ir,e.Mixin=_i,e.Path=nr,e.Point=F,e.PolyUtil=Bi,e.Polygon=hr,e.Polyline=cr,e.Popup=Lr,e.PosAnimation=ri,e.Projection=Vi,e.Rectangle=Yr,e.Renderer=Hr,e.SVG=Wr,e.SVGOverlay=Mr,e.TileLayer=Nr,e.Tooltip=kr,e.Transformation=Z,e.Util=S,e.VideoOverlay=Sr,e.bind=n,e.bounds=D,e.canvas=$r,e.circle=lr,e.circleMarker=sr,e.control=ai,e.divIcon=Dr,e.extend=i,e.featureGroup=Xi,e.geoJSON=wr,e.geoJson=Tr,e.gridLayer=Ur,e.icon=Ji,e.imageOverlay=Cr,e.latLng=Q,e.latLngBounds=U,e.layerGroup=Ki,e.map=oi,e.marker=rr,e.point=z,e.polygon=dr,e.polyline=ur,e.popup=Fr,e.rectangle=Jr,e.setOptions=p,e.stamp=s,e.svg=Xr,e.svgOverlay=Ir,e.tileLayer=Qr,e.tooltip=zr,e.transformation=q,e.version=t,e.videoOverlay=Er;var cn=window.L;e.noConflict=function(){return window.L=cn,this},window.L=e}(bu.exports);class Bu extends me{constructor(e){super(),Ae(this,e,Tu,wu,a,{id:0,center:1,zoom:2,mapStyle:3,numberOfMaps:4,overrideLayer:5,onMapMount:6})}}var Cu={exports:{}};function Su(e){let t,r;const n=[{mapStyle:e[0]},{overrideLayer:e[1]},e[2]];let o={};for(let e=0;e<n.length;e+=1)o=i(o,n[e]);return t=new Bu({props:o}),t.$on("mapMove",e[4]),{c(){de(t.$$.fragment)},m(e,i){pe(t,e,i),r=!0},p(e,[i]){const r=7&i?ue(n,[1&i&&{mapStyle:e[0]},2&i&&{overrideLayer:e[1]},4&i&&he(e[2])]):{};t.$set(r)},i(e){r||(le(t.$$.fragment,e),r=!0)},o(e){ce(t.$$.fragment,e),r=!1},d(e){fe(t,e)}}}function Eu(e,t,r){const n=["mapStyle"];let o,s,a=A(t,n),{mapStyle:l}=t;return e.$$set=e=>{t=i(i({},t),f(e)),r(2,a=A(t,n)),"mapStyle"in e&&r(0,l=e.mapStyle)},e.$$.update=()=>{1&e.$$.dirty&&r(3,({url:s}=l),s),8&e.$$.dirty&&r(1,o=(e=>null!=o&&o.options.scene===e?o:Cu.exports.leafletLayer({scene:e,webGLContextOptions:{preserveDrawingBuffer:!0}}))(s))},[l,o,a,s,function(t){G.call(this,e,t)}]}Cu.exports=function(){var e,t,i={};function r(r,n){if(e)if(t){var o="var shared_chunk = {}; ("+e+")(shared_chunk); ("+t+")(shared_chunk);",s={};e(s),(i=n(s)).workerURL=window.URL.createObjectURL(new Blob([o],{type:"text/javascript"}))}else t=n;else e=n}r(["exports"],(function(e){function t(e,t){return e(t={exports:{}},t.exports),t.exports}var i=t((function(e){var t=e.exports={version:"2.6.3"};"number"==typeof __e&&(__e=t)})),r=(i.version,t((function(e){var t=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=t)}))),n=t((function(e){var t=r["__core-js_shared__"]||(r["__core-js_shared__"]={});(e.exports=function(e,i){return t[e]||(t[e]=void 0!==i?i:{})})("versions",[]).push({version:i.version,mode:"global",copyright:" 2019 Denis Pushkarev (zloirock.ru)"})})),o=0,s=Math.random(),a=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++o+s).toString(36))},l=t((function(e){var t=n("wks"),i=r.Symbol,o="function"==typeof i;(e.exports=function(e){return t[e]||(t[e]=o&&i[e]||(o?i:a)("Symbol."+e))}).store=t})),c=function(e){return"object"==typeof e?null!==e:"function"==typeof e},u=function(e){if(!c(e))throw TypeError(e+" is not an object!");return e},h=function(e){try{return!!e()}catch(e){return!0}},d=!h((function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})),p=r.document,f=c(p)&&c(p.createElement),A=function(e){return f?p.createElement(e):{}},m=!d&&!h((function(){return 7!=Object.defineProperty(A("div"),"a",{get:function(){return 7}}).a})),g=function(e,t){if(!c(e))return e;var i,r;if(t&&"function"==typeof(i=e.toString)&&!c(r=i.call(e)))return r;if("function"==typeof(i=e.valueOf)&&!c(r=i.call(e)))return r;if(!t&&"function"==typeof(i=e.toString)&&!c(r=i.call(e)))return r;throw TypeError("Can't convert object to primitive value")},_=Object.defineProperty,y={f:d?Object.defineProperty:function(e,t,i){if(u(e),t=g(t,!0),u(i),m)try{return _(e,t,i)}catch(e){}if("get"in i||"set"in i)throw TypeError("Accessors not supported!");return"value"in i&&(e[t]=i.value),e}},v=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},x=d?function(e,t,i){return y.f(e,t,v(1,i))}:function(e,t,i){return e[t]=i,e},b=l("unscopables"),w=Array.prototype;null==w[b]&&x(w,b,{});var T=function(e){w[b][e]=!0},B=function(e,t){return{value:t,done:!!e}},C={},S={}.toString,E=function(e){return S.call(e).slice(8,-1)},M=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==E(e)?e.split(""):Object(e)},I=function(e){if(null==e)throw TypeError("Can't call method on  "+e);return e},P=function(e){return M(I(e))},L={}.hasOwnProperty,F=function(e,t){return L.call(e,t)},k=t((function(e){var t=a("src"),n=Function.toString,o=(""+n).split("toString");i.inspectSource=function(e){return n.call(e)},(e.exports=function(e,i,n,s){var a="function"==typeof n;a&&(F(n,"name")||x(n,"name",i)),e[i]!==n&&(a&&(F(n,t)||x(n,t,e[i]?""+e[i]:o.join(String(i)))),e===r?e[i]=n:s?e[i]?e[i]=n:x(e,i,n):(delete e[i],x(e,i,n)))})(Function.prototype,"toString",(function(){return"function"==typeof this&&this[t]||n.call(this)}))})),z=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e},R=function(e,t,i){if(z(e),void 0===t)return e;switch(i){case 1:return function(i){return e.call(t,i)};case 2:return function(i,r){return e.call(t,i,r)};case 3:return function(i,r,n){return e.call(t,i,r,n)}}return function(){return e.apply(t,arguments)}},D=function(e,t,n){var o,s,a,l,c=e&D.F,u=e&D.G,h=e&D.S,d=e&D.P,p=e&D.B,f=u?r:h?r[t]||(r[t]={}):(r[t]||{}).prototype,A=u?i:i[t]||(i[t]={}),m=A.prototype||(A.prototype={});for(o in u&&(n=t),n)a=((s=!c&&f&&void 0!==f[o])?f:n)[o],l=p&&s?R(a,r):d&&"function"==typeof a?R(Function.call,a):a,f&&k(f,o,a,e&D.U),A[o]!=a&&x(A,o,l),d&&m[o]!=a&&(m[o]=a)};r.core=i,D.F=1,D.G=2,D.S=4,D.P=8,D.B=16,D.W=32,D.U=64,D.R=128;var O=D,U=Math.ceil,N=Math.floor,Q=function(e){return isNaN(e=+e)?0:(e>0?N:U)(e)},j=Math.min,V=function(e){return e>0?j(Q(e),9007199254740991):0},H=Math.max,G=Math.min,$=function(e,t){return(e=Q(e))<0?H(e+t,0):G(e,t)},Z=function(e){return function(t,i,r){var n,o=P(t),s=V(o.length),a=$(r,s);if(e&&i!=i){for(;s>a;)if((n=o[a++])!=n)return!0}else for(;s>a;a++)if((e||a in o)&&o[a]===i)return e||a||0;return!e&&-1}},q=n("keys"),K=function(e){return q[e]||(q[e]=a(e))},W=Z(!1),X=K("IE_PROTO"),Y=function(e,t){var i,r=P(e),n=0,o=[];for(i in r)i!=X&&F(r,i)&&o.push(i);for(;t.length>n;)F(r,i=t[n++])&&(~W(o,i)||o.push(i));return o},J="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(","),ee=Object.keys||function(e){return Y(e,J)},te=d?Object.defineProperties:function(e,t){u(e);for(var i,r=ee(t),n=r.length,o=0;n>o;)y.f(e,i=r[o++],t[i]);return e},ie=r.document,re=ie&&ie.documentElement,ne=K("IE_PROTO"),oe=function(){},se=function(){var e,t=A("iframe"),i=J.length;for(t.style.display="none",re.appendChild(t),t.src="javascript:",(e=t.contentWindow.document).open(),e.write("<script>document.F=Object<\/script>"),e.close(),se=e.F;i--;)delete se.prototype[J[i]];return se()},ae=Object.create||function(e,t){var i;return null!==e?(oe.prototype=u(e),i=new oe,oe.prototype=null,i[ne]=e):i=se(),void 0===t?i:te(i,t)},le=y.f,ce=l("toStringTag"),ue=function(e,t,i){e&&!F(e=i?e:e.prototype,ce)&&le(e,ce,{configurable:!0,value:t})},he={};x(he,l("iterator"),(function(){return this}));var de=function(e,t,i){e.prototype=ae(he,{next:v(1,i)}),ue(e,t+" Iterator")},pe=function(e){return Object(I(e))},fe=K("IE_PROTO"),Ae=Object.prototype,me=Object.getPrototypeOf||function(e){return e=pe(e),F(e,fe)?e[fe]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?Ae:null},ge=l("iterator"),_e=!([].keys&&"next"in[].keys()),ye=function(){return this},ve=function(e,t,i,r,n,o,s){de(i,t,r);var a,l,c,u=function(e){if(!_e&&e in f)return f[e];switch(e){case"keys":case"values":return function(){return new i(this,e)}}return function(){return new i(this,e)}},h=t+" Iterator",d="values"==n,p=!1,f=e.prototype,A=f[ge]||f["@@iterator"]||n&&f[n],m=A||u(n),g=n?d?u("entries"):m:void 0,_="Array"==t&&f.entries||A;if(_&&(c=me(_.call(new e)))!==Object.prototype&&c.next&&(ue(c,h,!0),"function"!=typeof c[ge]&&x(c,ge,ye)),d&&A&&"values"!==A.name&&(p=!0,m=function(){return A.call(this)}),(_e||p||!f[ge])&&x(f,ge,m),C[t]=m,C[h]=ye,n)if(a={values:d?m:u("values"),keys:o?m:u("keys"),entries:g},s)for(l in a)l in f||k(f,l,a[l]);else O(O.P+O.F*(_e||p),t,a);return a},xe=ve(Array,"Array",(function(e,t){this._t=P(e),this._i=0,this._k=t}),(function(){var e=this._t,t=this._k,i=this._i++;return!e||i>=e.length?(this._t=void 0,B(1)):B(0,"keys"==t?i:"values"==t?e[i]:[i,e[i]])}),"values");C.Arguments=C.Array,T("keys"),T("values"),T("entries");for(var be=l("iterator"),we=l("toStringTag"),Te=C.Array,Be={CSSRuleList:!0,CSSStyleDeclaration:!1,CSSValueList:!1,ClientRectList:!1,DOMRectList:!1,DOMStringList:!1,DOMTokenList:!0,DataTransferItemList:!1,FileList:!1,HTMLAllCollection:!1,HTMLCollection:!1,HTMLFormElement:!1,HTMLSelectElement:!1,MediaList:!0,MimeTypeArray:!1,NamedNodeMap:!1,NodeList:!0,PaintRequestList:!1,Plugin:!1,PluginArray:!1,SVGLengthList:!1,SVGNumberList:!1,SVGPathSegList:!1,SVGPointList:!1,SVGStringList:!1,SVGTransformList:!1,SourceBufferList:!1,StyleSheetList:!0,TextTrackCueList:!1,TextTrackList:!1,TouchList:!1},Ce=ee(Be),Se=0;Se<Ce.length;Se++){var Ee,Me=Ce[Se],Ie=Be[Me],Pe=r[Me],Le=Pe&&Pe.prototype;if(Le&&(Le[be]||x(Le,be,Te),Le[we]||x(Le,we,Me),C[Me]=Te,Ie))for(Ee in xe)Le[Ee]||k(Le,Ee,xe[Ee],!0)}var Fe=l("toStringTag"),ke="Arguments"==E(function(){return arguments}()),ze=function(e){var t,i,r;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(i=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),Fe))?i:ke?E(t):"Object"==(r=E(t))&&"function"==typeof t.callee?"Arguments":r},Re={};Re[l("toStringTag")]="z",Re+""!="[object z]"&&k(Object.prototype,"toString",(function(){return"[object "+ze(this)+"]"}),!0);var De={f:{}.propertyIsEnumerable},Oe=De.f,Ue=function(e){return function(t){for(var i,r=P(t),n=ee(r),o=n.length,s=0,a=[];o>s;)Oe.call(r,i=n[s++])&&a.push(e?[i,r[i]]:r[i]);return a}},Ne=Ue(!0);O(O.S,"Object",{entries:function(e){return Ne(e)}});var Qe={f:Object.getOwnPropertySymbols},je=Object.assign,Ve=!je||h((function(){var e={},t={},i=Symbol(),r="abcdefghijklmnopqrst";return e[i]=7,r.split("").forEach((function(e){t[e]=e})),7!=je({},e)[i]||Object.keys(je({},t)).join("")!=r}))?function(e,t){for(var i=pe(e),r=arguments.length,n=1,o=Qe.f,s=De.f;r>n;)for(var a,l=M(arguments[n++]),c=o?ee(l).concat(o(l)):ee(l),u=c.length,h=0;u>h;)s.call(l,a=c[h++])&&(i[a]=l[a]);return i}:je;O(O.S+O.F,"Object",{assign:Ve});var He={};try{window instanceof Window&&window.document instanceof HTMLDocument&&(He.is_worker=!1,He.is_main=!0)}catch(e){He.is_worker=!0,He.is_main=!1,self.window={document:{}},self.document=self.window.document}var Ge=function(e){return function(t,i){var r,n,o=String(I(t)),s=Q(i),a=o.length;return s<0||s>=a?e?"":void 0:(r=o.charCodeAt(s))<55296||r>56319||s+1===a||(n=o.charCodeAt(s+1))<56320||n>57343?e?o.charAt(s):r:e?o.slice(s,s+2):n-56320+(r-55296<<10)+65536}},$e=Ge(!0),Ze=function(e,t,i){return t+(i?$e(e,t).length:1)},qe=RegExp.prototype.exec,Ke=function(e,t){var i=e.exec;if("function"==typeof i){var r=i.call(e,t);if("object"!=typeof r)throw new TypeError("RegExp exec method returned something other than an Object or null");return r}if("RegExp"!==ze(e))throw new TypeError("RegExp#exec called on incompatible receiver");return qe.call(e,t)},We=function(){var e=u(this),t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.unicode&&(t+="u"),e.sticky&&(t+="y"),t},Xe=RegExp.prototype.exec,Ye=String.prototype.replace,Je=Xe,et=function(){var e=/a/,t=/b*/g;return Xe.call(e,"a"),Xe.call(t,"a"),0!==e.lastIndex||0!==t.lastIndex}(),tt=void 0!==/()??/.exec("")[1];(et||tt)&&(Je=function(e){var t,i,r,n,o=this;return tt&&(i=new RegExp("^"+o.source+"$(?!\\s)",We.call(o))),et&&(t=o.lastIndex),r=Xe.call(o,e),et&&r&&(o.lastIndex=o.global?r.index+r[0].length:t),tt&&r&&r.length>1&&Ye.call(r[0],i,(function(){for(n=1;n<arguments.length-2;n++)void 0===arguments[n]&&(r[n]=void 0)})),r});var it=Je;O({target:"RegExp",proto:!0,forced:it!==/./.exec},{exec:it});var rt=l("species"),nt=!h((function(){var e=/./;return e.exec=function(){var e=[];return e.groups={a:"7"},e},"7"!=="".replace(e,"$<a>")})),ot=function(){var e=/(?:)/,t=e.exec;e.exec=function(){return t.apply(this,arguments)};var i="ab".split(e);return 2===i.length&&"a"===i[0]&&"b"===i[1]}(),st=function(e,t,i){var r=l(e),n=!h((function(){var t={};return t[r]=function(){return 7},7!=""[e](t)})),o=n?!h((function(){var t=!1,i=/a/;return i.exec=function(){return t=!0,null},"split"===e&&(i.constructor={},i.constructor[rt]=function(){return i}),i[r](""),!t})):void 0;if(!n||!o||"replace"===e&&!nt||"split"===e&&!ot){var s=/./[r],a=i(I,r,""[e],(function(e,t,i,r,o){return t.exec===it?n&&!o?{done:!0,value:s.call(t,i,r)}:{done:!0,value:e.call(i,t,r)}:{done:!1}})),c=a[0],u=a[1];k(String.prototype,e,c),x(RegExp.prototype,r,2==t?function(e,t){return u.call(e,this,t)}:function(e){return u.call(e,this)})}},at=Math.max,lt=Math.min,ct=Math.floor,ut=/\$([$&`']|\d\d?|<[^>]*>)/g,ht=/\$([$&`']|\d\d?)/g;function dt(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function pt(e,t,i){return t&&dt(e.prototype,t),i&&dt(e,i),e}function ft(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}function At(e){return(At=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function mt(e,t){return(mt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function gt(e,t,i){return(gt=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}()?Reflect.construct:function(e,t,i){var r=[null];r.push.apply(r,t);var n=new(Function.bind.apply(e,r));return i&&mt(n,i.prototype),n}).apply(null,arguments)}function _t(e){var t="function"==typeof Map?new Map:void 0;return(_t=function(e){if(null===e||(i=e,-1===Function.toString.call(i).indexOf("[native code]")))return e;var i;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return gt(e,arguments,At(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),mt(r,e)})(e)}function yt(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,r=new Array(t);i<t;i++)r[i]=e[i];return r}function vt(e,t){var i;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(i=function(e,t){if(e){if("string"==typeof e)return yt(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?yt(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){i&&(e=i);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(i=e[Symbol.iterator]()).next.bind(i)}st("replace",2,(function(e,t,i,r){return[function(r,n){var o=e(this),s=null==r?void 0:r[t];return void 0!==s?s.call(r,o,n):i.call(String(o),r,n)},function(e,t){var o=r(i,e,this,t);if(o.done)return o.value;var s=u(e),a=String(this),l="function"==typeof t;l||(t=String(t));var c=s.global;if(c){var h=s.unicode;s.lastIndex=0}for(var d=[];;){var p=Ke(s,a);if(null===p)break;if(d.push(p),!c)break;""===String(p[0])&&(s.lastIndex=Ze(a,V(s.lastIndex),h))}for(var f,A="",m=0,g=0;g<d.length;g++){p=d[g];for(var _=String(p[0]),y=at(lt(Q(p.index),a.length),0),v=[],x=1;x<p.length;x++)v.push(void 0===(f=p[x])?f:String(f));var b=p.groups;if(l){var w=[_].concat(v,y,a);void 0!==b&&w.push(b);var T=String(t.apply(void 0,w))}else T=n(_,a,y,v,b,t);y>=m&&(A+=a.slice(m,y)+T,m=y+_.length)}return A+a.slice(m)}];function n(e,t,r,n,o,s){var a=r+e.length,l=n.length,c=ht;return void 0!==o&&(o=pe(o),c=ut),i.call(s,c,(function(i,s){var c;switch(s.charAt(0)){case"$":return"$";case"&":return e;case"`":return t.slice(0,r);case"'":return t.slice(a);case"<":c=o[s.slice(1,-1)];break;default:var u=+s;if(0===u)return i;if(u>l){var h=ct(u/10);return 0===h?i:h<=l?void 0===n[h-1]?s.charAt(1):n[h-1]+s.charAt(1):i}c=n[u-1]}return void 0===c?"":c}))}}));var xt=Ge(!0);ve(String,"String",(function(e){this._t=String(e),this._i=0}),(function(){var e,t=this._t,i=this._i;return i>=t.length?{value:void 0,done:!0}:(e=xt(t,i),this._i+=e.length,{value:e,done:!1})}));var bt,wt,Tt,Bt=function(e,t,i,r){if(!(e instanceof t)||void 0!==r&&r in e)throw TypeError(i+": incorrect invocation!");return e},Ct=function(e,t,i,r){try{return r?t(u(i)[0],i[1]):t(i)}catch(t){var n=e.return;throw void 0!==n&&u(n.call(e)),t}},St=l("iterator"),Et=Array.prototype,Mt=function(e){return void 0!==e&&(C.Array===e||Et[St]===e)},It=l("iterator"),Pt=i.getIteratorMethod=function(e){if(null!=e)return e[It]||e["@@iterator"]||C[ze(e)]},Lt=t((function(e){var t={},i={},r=e.exports=function(e,r,n,o,s){var a,l,c,h,d=s?function(){return e}:Pt(e),p=R(n,o,r?2:1),f=0;if("function"!=typeof d)throw TypeError(e+" is not iterable!");if(Mt(d)){for(a=V(e.length);a>f;f++)if((h=r?p(u(l=e[f])[0],l[1]):p(e[f]))===t||h===i)return h}else for(c=d.call(e);!(l=c.next()).done;)if((h=Ct(c,p,l.value,r))===t||h===i)return h};r.BREAK=t,r.RETURN=i})),Ft=l("species"),kt=function(e,t){var i,r=u(e).constructor;return void 0===r||null==(i=u(r)[Ft])?t:z(i)},zt=r.process,Rt=r.setImmediate,Dt=r.clearImmediate,Ot=r.MessageChannel,Ut=r.Dispatch,Nt=0,Qt={},jt=function(){var e=+this;if(Qt.hasOwnProperty(e)){var t=Qt[e];delete Qt[e],t()}},Vt=function(e){jt.call(e.data)};Rt&&Dt||(Rt=function(e){for(var t=[],i=1;arguments.length>i;)t.push(arguments[i++]);return Qt[++Nt]=function(){!function(e,t,i){var r=void 0===i;switch(t.length){case 0:return r?e():e.call(i);case 1:return r?e(t[0]):e.call(i,t[0]);case 2:return r?e(t[0],t[1]):e.call(i,t[0],t[1]);case 3:return r?e(t[0],t[1],t[2]):e.call(i,t[0],t[1],t[2]);case 4:return r?e(t[0],t[1],t[2],t[3]):e.call(i,t[0],t[1],t[2],t[3])}e.apply(i,t)}("function"==typeof e?e:Function(e),t)},bt(Nt),Nt},Dt=function(e){delete Qt[e]},"process"==E(zt)?bt=function(e){zt.nextTick(R(jt,e,1))}:Ut&&Ut.now?bt=function(e){Ut.now(R(jt,e,1))}:Ot?(Tt=(wt=new Ot).port2,wt.port1.onmessage=Vt,bt=R(Tt.postMessage,Tt,1)):r.addEventListener&&"function"==typeof postMessage&&!r.importScripts?(bt=function(e){r.postMessage(e+"","*")},r.addEventListener("message",Vt,!1)):bt="onreadystatechange"in A("script")?function(e){re.appendChild(A("script")).onreadystatechange=function(){re.removeChild(this),jt.call(e)}}:function(e){setTimeout(R(jt,e,1),0)});var Ht={set:Rt,clear:Dt},Gt=Ht.set,$t=r.MutationObserver||r.WebKitMutationObserver,Zt=r.process,qt=r.Promise,Kt="process"==E(Zt);function Wt(e){var t,i;this.promise=new e((function(e,r){if(void 0!==t||void 0!==i)throw TypeError("Bad Promise constructor");t=e,i=r})),this.resolve=z(t),this.reject=z(i)}var Xt={f:function(e){return new Wt(e)}},Yt=function(e){try{return{e:!1,v:e()}}catch(e){return{e:!0,v:e}}},Jt=r.navigator,ei=Jt&&Jt.userAgent||"",ti=function(e,t,i){for(var r in t)k(e,r,t[r],i);return e},ii=l("species"),ri=function(e){var t=r[e];d&&t&&!t[ii]&&y.f(t,ii,{configurable:!0,get:function(){return this}})},ni=l("iterator"),oi=!1;try{var si=[7][ni]();si.return=function(){oi=!0},Array.from(si,(function(){throw 2}))}catch(e){}var ai,li,ci,ui,hi=function(e,t){if(!t&&!oi)return!1;var i=!1;try{var r=[7],n=r[ni]();n.next=function(){return{done:i=!0}},r[ni]=function(){return n},e(r)}catch(e){}return i},di=Ht.set,pi=function(){var e,t,i,n=function(){var r,n;for(Kt&&(r=Zt.domain)&&r.exit();e;){n=e.fn,e=e.next;try{n()}catch(r){throw e?i():t=void 0,r}}t=void 0,r&&r.enter()};if(Kt)i=function(){Zt.nextTick(n)};else if(!$t||r.navigator&&r.navigator.standalone)if(qt&&qt.resolve){var o=qt.resolve(void 0);i=function(){o.then(n)}}else i=function(){Gt.call(r,n)};else{var s=!0,a=document.createTextNode("");new $t(n).observe(a,{characterData:!0}),i=function(){a.data=s=!s}}return function(r){var n={fn:r,next:void 0};t&&(t.next=n),e||(e=n,i()),t=n}}(),fi=r.TypeError,Ai=r.process,mi=Ai&&Ai.versions,gi=mi&&mi.v8||"",_i=r.Promise,yi="process"==ze(Ai),vi=function(){},xi=li=Xt.f,bi=!!function(){try{var e=_i.resolve(1),t=(e.constructor={})[l("species")]=function(e){e(vi,vi)};return(yi||"function"==typeof PromiseRejectionEvent)&&e.then(vi)instanceof t&&0!==gi.indexOf("6.6")&&-1===ei.indexOf("Chrome/66")}catch(e){}}(),wi=function(e){var t;return!(!c(e)||"function"!=typeof(t=e.then))&&t},Ti=function(e,t){if(!e._n){e._n=!0;var i=e._c;pi((function(){for(var r=e._v,n=1==e._s,o=0,s=function(t){var i,o,s,a=n?t.ok:t.fail,l=t.resolve,c=t.reject,u=t.domain;try{a?(n||(2==e._h&&Si(e),e._h=1),!0===a?i=r:(u&&u.enter(),i=a(r),u&&(u.exit(),s=!0)),i===t.promise?c(fi("Promise-chain cycle")):(o=wi(i))?o.call(i,l,c):l(i)):c(r)}catch(e){u&&!s&&u.exit(),c(e)}};i.length>o;)s(i[o++]);e._c=[],e._n=!1,t&&!e._h&&Bi(e)}))}},Bi=function(e){di.call(r,(function(){var t,i,n,o=e._v,s=Ci(e);if(s&&(t=Yt((function(){yi?Ai.emit("unhandledRejection",o,e):(i=r.onunhandledrejection)?i({promise:e,reason:o}):(n=r.console)&&n.error&&n.error("Unhandled promise rejection",o)})),e._h=yi||Ci(e)?2:1),e._a=void 0,s&&t.e)throw t.v}))},Ci=function(e){return 1!==e._h&&0===(e._a||e._c).length},Si=function(e){di.call(r,(function(){var t;yi?Ai.emit("rejectionHandled",e):(t=r.onrejectionhandled)&&t({promise:e,reason:e._v})}))},Ei=function(e){var t=this;t._d||(t._d=!0,(t=t._w||t)._v=e,t._s=2,t._a||(t._a=t._c.slice()),Ti(t,!0))},Mi=function(e){var t,i=this;if(!i._d){i._d=!0,i=i._w||i;try{if(i===e)throw fi("Promise can't be resolved itself");(t=wi(e))?pi((function(){var r={_w:i,_d:!1};try{t.call(e,R(Mi,r,1),R(Ei,r,1))}catch(e){Ei.call(r,e)}})):(i._v=e,i._s=1,Ti(i,!1))}catch(e){Ei.call({_w:i,_d:!1},e)}}};bi||(_i=function(e){Bt(this,_i,"Promise","_h"),z(e),ai.call(this);try{e(R(Mi,this,1),R(Ei,this,1))}catch(e){Ei.call(this,e)}},(ai=function(e){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1}).prototype=ti(_i.prototype,{then:function(e,t){var i=xi(kt(this,_i));return i.ok="function"!=typeof e||e,i.fail="function"==typeof t&&t,i.domain=yi?Ai.domain:void 0,this._c.push(i),this._a&&this._a.push(i),this._s&&Ti(this,!1),i.promise},catch:function(e){return this.then(void 0,e)}}),ci=function(){var e=new ai;this.promise=e,this.resolve=R(Mi,e,1),this.reject=R(Ei,e,1)},Xt.f=xi=function(e){return e===_i||e===ui?new ci(e):li(e)}),O(O.G+O.W+O.F*!bi,{Promise:_i}),ue(_i,"Promise"),ri("Promise"),ui=i.Promise,O(O.S+O.F*!bi,"Promise",{reject:function(e){var t=xi(this);return(0,t.reject)(e),t.promise}}),O(O.S+O.F*!bi,"Promise",{resolve:function(e){return function(e,t){if(u(e),c(t)&&t.constructor===e)return t;var i=Xt.f(e);return(0,i.resolve)(t),i.promise}(this,e)}}),O(O.S+O.F*!(bi&&hi((function(e){_i.all(e).catch(vi)}))),"Promise",{all:function(e){var t=this,i=xi(t),r=i.resolve,n=i.reject,o=Yt((function(){var i=[],o=0,s=1;Lt(e,!1,(function(e){var a=o++,l=!1;i.push(void 0),s++,t.resolve(e).then((function(e){l||(l=!0,i[a]=e,--s||r(i))}),n)})),--s||r(i)}));return o.e&&n(o.v),i.promise},race:function(e){var t=this,i=xi(t),r=i.reject,n=Yt((function(){Lt(e,!1,(function(e){t.resolve(e).then(i.resolve,r)}))}));return n.e&&r(n.v),i.promise}});var Ii=y.f,Pi=Function.prototype,Li=/^\s*function ([^ (]*)/;"name"in Pi||d&&Ii(Pi,"name",{configurable:!0,get:function(){try{return(""+this).match(Li)[1]}catch(e){return""}}});var Fi=function(e,t){var r=(i.Object||{})[e]||Object[e],n={};n[e]=t(r),O(O.S+O.F*h((function(){r(1)})),"Object",n)};Fi("keys",(function(){return function(e){return ee(pe(e))}}));var ki,zi="v0.21.1",Ri=l("match"),Di=function(e){var t;return c(e)&&(void 0!==(t=e[Ri])?!!t:"RegExp"==E(e))},Oi=Math.min,Ui=[].push,Ni=!h((function(){RegExp(4294967295,"y")}));st("split",2,(function(e,t,i,r){var n;return n="c"=="abbc".split(/(b)*/)[1]||4!="test".split(/(?:)/,-1).length||2!="ab".split(/(?:ab)*/).length||4!=".".split(/(.?)(.?)/).length||".".split(/()()/).length>1||"".split(/.?/).length?function(e,t){var r=String(this);if(void 0===e&&0===t)return[];if(!Di(e))return i.call(r,e,t);for(var n,o,s,a=[],l=(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.unicode?"u":"")+(e.sticky?"y":""),c=0,u=void 0===t?4294967295:t>>>0,h=new RegExp(e.source,l+"g");(n=it.call(h,r))&&!((o=h.lastIndex)>c&&(a.push(r.slice(c,n.index)),n.length>1&&n.index<r.length&&Ui.apply(a,n.slice(1)),s=n[0].length,c=o,a.length>=u));)h.lastIndex===n.index&&h.lastIndex++;return c===r.length?!s&&h.test("")||a.push(""):a.push(r.slice(c)),a.length>u?a.slice(0,u):a}:"0".split(void 0,0).length?function(e,t){return void 0===e&&0===t?[]:i.call(this,e,t)}:i,[function(i,r){var o=e(this),s=null==i?void 0:i[t];return void 0!==s?s.call(i,o,r):n.call(String(o),i,r)},function(e,t){var o=r(n,e,this,t,n!==i);if(o.done)return o.value;var s=u(e),a=String(this),l=kt(s,RegExp),c=s.unicode,h=(s.ignoreCase?"i":"")+(s.multiline?"m":"")+(s.unicode?"u":"")+(Ni?"y":"g"),d=new l(Ni?s:"^(?:"+s.source+")",h),p=void 0===t?4294967295:t>>>0;if(0===p)return[];if(0===a.length)return null===Ke(d,a)?[a]:[];for(var f=0,A=0,m=[];A<a.length;){d.lastIndex=Ni?A:0;var g,_=Ke(d,Ni?a:a.slice(A));if(null===_||(g=Oi(V(d.lastIndex+(Ni?0:A)),a.length))===f)A=Ze(a,A,c);else{if(m.push(a.slice(f,A)),m.length===p)return m;for(var y=1;y<=_.length-1;y++)if(m.push(_[y]),m.length===p)return m;A=f=g}}return m.push(a.slice(f)),m}]}));var Qi=ki={},ji=0,Vi={};function Hi(e){var t=[];"string"==typeof e&&(t=e.split("."),e=t.pop());for(var i=ki.targets,r=0;r<t.length;r++){if(!i[t[r]])return[];i=i[t[r]]}return[e,i]}function Gi(e){Array.isArray(e)&&e.filter((function(e){return e.parent&&e.property})).forEach((function(e){return delete e.parent[e.property]}))}ki.targets={},ki.addTarget=function(e,t){ki.targets[e]=t},ki.removeTarget=function(e){e&&delete ki.targets[e]},ki.withTransferables=function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];if(!(this instanceof ki.withTransferables))return gt(ki.withTransferables,t);this.value=t,this.transferables=function e(t,i,r,n){if(void 0===i&&(i=null),void 0===r&&(r=null),void 0===n&&(n=[]),!t)return n;if(Array.isArray(t))t.forEach((function(i,r){return e(i,t,r,n)}));else if("object"==typeof t)if(t instanceof ArrayBuffer)n.push({object:t,parent:i,property:r});else if(t.buffer instanceof ArrayBuffer)n.push({object:t.buffer,parent:i,property:r});else for(var o in t)e(t[o],t,o,n);return n}(this.value)},He.is_main&&(ki.postMessage=function(e,t){for(var i=arguments.length,r=new Array(i>2?i-2:0),n=2;n<i;n++)r[n-2]=arguments[n];if(Array.isArray(e))return Promise.all(e.map((function(e){var i;return(i=ki).postMessage.apply(i,[e,t].concat(r))})));var o={};"object"==typeof t&&(o=t,t=t.method);var s,a=new Promise((function(e,i){Vi[ji]={method:t,message:r,resolve:e,reject:i}})),l=[];return r&&1===r.length&&r[0]instanceof ki.withTransferables&&(l=r[0].transferables,r=r[0].value),s={type:"main_send",message_id:ji,method:t,message:r},o.stringify&&(s=JSON.stringify(s)),e.postMessage(s,l.map((function(e){return e.object}))),Gi(l),l.length>0&&Ki("trace","'"+t+"' transferred "+l.length+" objects to worker thread"),ji++,a},ki.addWorker=function(e){if(!(e instanceof Worker))throw Error("Worker broker could not add non-Worker object",e);e.addEventListener("message",(function(t){var i="string"==typeof t.data?JSON.parse(t.data):t.data,r=i.message_id;if("worker_reply"===i.type)Vi[r]&&(i.error?Vi[r].reject(i.error):Vi[r].resolve(i.message),delete Vi[r]);else if("worker_send"===i.type&&null!=r){var n,o,s,a,l;try{var c=Hi(i.method);if(a=c[0],!(s=c[1]))throw Error("Worker broker could not dispatch message type "+i.method+" on target "+i.target+" because no object with that name is registered on main thread");if(!(l="function"==typeof s[a]&&s[a]))throw Error("Worker broker could not dispatch message type "+i.method+" on target "+i.target+" because object has no method with that name");n=l.apply(s,i.message)}catch(e){o=e}var u,h=[];n instanceof Promise?n.then((function(t){t instanceof ki.withTransferables&&(h=t.transferables,t=t.value[0]),u={type:"main_reply",message_id:r,message:t},e.postMessage(u,h.map((function(e){return e.object}))),Gi(h),h.length>0&&Ki("trace","'"+a+"' transferred "+h.length+" objects to worker thread")}),(function(t){e.postMessage({type:"main_reply",message_id:r,error:t instanceof Error?t.message+": "+t.stack:t})})):(n instanceof ki.withTransferables&&(h=n.transferables,n=n.value[0]),u={type:"main_reply",message_id:r,message:n,error:o instanceof Error?o.message+": "+o.stack:o},e.postMessage(u,h.map((function(e){return e.object}))),Gi(h),h.length>0&&Ki("trace","'"+a+"' transferred "+h.length+" objects to worker thread"))}}))},ki.getMessages=function(){return Vi},ki.getMessageId=function(){return ji}),He.is_worker&&(ki.postMessage=function(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];var n={};"object"==typeof e&&(n=e,e=e.method);var o,s=new Promise((function(t,r){Vi[ji]={method:e,message:i,resolve:t,reject:r}})),a=[];return i&&1===i.length&&i[0]instanceof ki.withTransferables&&(a=i[0].transferables,i=i[0].value),o={type:"worker_send",message_id:ji,method:e,message:i},n.stringify&&(o=JSON.stringify(o)),self.postMessage(o,a.map((function(e){return e.object}))),Gi(a),a.length>0&&Ki("trace","'"+e+"' transferred "+a.length+" objects to main thread"),ji++,s},self.addEventListener("message",(function(e){var t="string"==typeof e.data?JSON.parse(e.data):e.data,i=t.message_id;if("main_reply"===t.type)Vi[i]&&(t.error?Vi[i].reject(t.error):Vi[i].resolve(t.message),delete Vi[i]);else if("main_send"===t.type&&null!=i){var r,n,o,s,a;try{var l=Hi(t.method);if(s=l[0],!(o=l[1]))throw Error("Worker broker could not dispatch message type "+t.method+" on target "+t.target+" because no object with that name is registered on main thread");if(!(a="function"==typeof o[s]&&o[s]))throw Error("Worker broker could not dispatch message type "+t.method+" because worker has no method with that name");r=a.apply(o,t.message)}catch(e){n=e}var c,u=[];r instanceof Promise?r.then((function(e){e instanceof ki.withTransferables&&(u=e.transferables,e=e.value[0]),c={type:"worker_reply",message_id:i,message:e},self.postMessage(c,u.map((function(e){return e.object}))),Gi(u),u.length>0&&Ki("trace","'"+s+"' transferred "+u.length+" objects to main thread")}),(function(e){self.postMessage({type:"worker_reply",message_id:i,error:e instanceof Error?e.message+": "+e.stack:e})})):(r instanceof ki.withTransferables&&(u=r.transferables,r=r.value[0]),c={type:"worker_reply",message_id:i,message:r,error:n instanceof Error?n.message+": "+n.stack:n},self.postMessage(c,u.map((function(e){return e.object}))),Gi(u),u.length>0&&Ki("trace","'"+s+"' transferred "+u.length+" objects to main thread"))}})));var $i={silent:-1,error:0,warn:1,info:2,debug:3,trace:4},Zi={},qi={};function Ki(e){var t="object"==typeof e?e.level:e;if($i[t]<=$i[Ki.level]){for(var i=arguments.length,r=new Array(i>1?i-1:0),n=1;n<i;n++)r[n-1]=arguments[n];if(He.is_worker)return Qi.postMessage.apply(Qi,[{method:"_logProxy",stringify:!0},e].concat(r));if("object"==typeof e&&!0===e.once){if(qi[JSON.stringify(r)])return Promise.resolve(!1);qi[JSON.stringify(r)]=!0}var o=function(e){if(He.is_main)return Zi[e]=Zi[e]||(console[e]?console[e]:console.log).bind(console),Zi[e]}(t);return r.length>1?o.apply(void 0,["Tangram "+zi+" ["+t+"]: "+r[0]].concat(r.slice(1))):o("Tangram "+zi+" ["+t+"]: "+r[0]),Promise.resolve(!0)}return Promise.resolve(!1)}Ki.level="info",Ki.workers=null,Ki.setLevel=function(e){Ki.level=e,He.is_main&&Array.isArray(Ki.workers)&&Qi.postMessage(Ki.workers,"_logSetLevelProxy",e)},He.is_main&&(Ki.setWorkers=function(e){Ki.workers=e},Ki.reset=function(){qi={}}),Qi.addTarget("_logProxy",Ki),Qi.addTarget("_logSetLevelProxy",Ki.setLevel),d&&"g"!=/./g.flags&&y.f(RegExp.prototype,"flags",{configurable:!0,get:We});var Wi=/./.toString,Xi=function(e){k(RegExp.prototype,"toString",e,!0)};h((function(){return"/a/b"!=Wi.call({source:"a",flags:"b"})}))?Xi((function(){var e=u(this);return"/".concat(e.source,"/","flags"in e?e.flags:!d&&e instanceof RegExp?We.call(e):void 0)})):"toString"!=Wi.name&&Xi((function(){return Wi.call(this)}));var Yi,Ji={};Qi.addTarget("Utils",Ji),Ji.isSafari=function(){return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)},Ji.isMicrosoft=function(){return/(Trident\/7.0|Edge[ \/](\d+[.\d]+))/i.test(navigator.userAgent)},Ji._requests={},Ji._proxy_requests={},Ji.io=function(e,t,i,r,n,o,s){if(void 0===t&&(t=6e4),void 0===i&&(i="text"),void 0===r&&(r="GET"),void 0===n&&(n={}),void 0===o&&(o=null),void 0===s&&(s=!1),He.is_worker&&Ji.isMicrosoft())return Ki("debug","Proxying request for URL to worker",e),o&&(Ji._proxy_requests[o]=!0),Qi.postMessage("Utils.io",e,t,i,r,n,o,!0);var a=new XMLHttpRequest,l=new Promise((function(o,s){if(a.open(r,e,!0),a.timeout=t,a.responseType=i,n&&"object"==typeof n)for(var l in n)a.setRequestHeader(l,n[l]);a.onload=function(){200===a.status?["text","json"].indexOf(a.responseType)>-1?o({body:a.responseText,status:a.status}):o({body:a.response,status:a.status}):204===a.status?o({body:null,status:a.status}):s(Error("Request error with a status of "+a.statusText))},a.onerror=function(e){s(Error("There was a network error"+e.toString()))},a.ontimeout=function(e){s(Error("timeout "+e.toString()))},a.send()}));return l=l.then((function(e){return o&&delete Ji._requests[o],s?Qi.withTransferables(e):e})),o&&(Ji._requests[o]=a),l},Ji.cancelRequest=function(e){if(He.is_worker&&Ji._proxy_requests[e])return Qi.postMessage("Utils.cancelRequest",e);Ji._requests[e]?(Ki("trace","Cancelling network request key '"+e+"'"),Ji._requests[e].abort(),delete Ji._requests[e]):Ki("trace","Could not find network request key '"+e+"'")},Ji.serializeWithFunctions=function(e){return"function"==typeof e?e.toString():JSON.stringify(e,(function(e,t){return"function"==typeof t?t.toString():t}))},Ji.use_high_density_display=!0,Ji.updateDevicePixelRatio=function(){var e=Ji.device_pixel_ratio;return Ji.device_pixel_ratio=Ji.use_high_density_display&&window.devicePixelRatio||1,Ji.device_pixel_ratio!==e},He.is_main&&Ji.updateDevicePixelRatio(),Ji.isPowerOf2=function(e){return!(e&e-1)},Ji.interpolate=function(e,t,i){if(!Array.isArray(t)||!Array.isArray(t[0]))return t;if(t.length<1)return t;var r,n,o,s,a;if(e<=t[0][0])s=t[0][1],"function"==typeof i&&(s=i(s));else if(e>=t[t.length-1][0])s=t[t.length-1][1],"function"==typeof i&&(s=i(s));else for(var l=0;l<t.length-1;l++)if(e>=t[l][0]&&e<t[l+1][0]){if(r=t[l][0],n=t[l+1][0],Array.isArray(t[l][1])){s=[];for(var c=0;c<t[l][1].length;c++)"function"==typeof i?(a=i(t[l][1][c]),o=i(t[l+1][1][c])-a,s[c]=o*(e-r)/(n-r)+a):(o=t[l+1][1][c]-t[l][1][c],s[c]=o*(e-r)/(n-r)+t[l][1][c])}else"function"==typeof i?(a=i(t[l][1]),s=(o=i(t[l+1][1])-a)*(e-r)/(n-r)+a):s=(o=t[l+1][1]-t[l][1])*(e-r)/(n-r)+t[l][1];break}return s},Ji.toCSSColor=function(e){if(null!=e)return 1===e[3]?"rgb("+e.slice(0,3).map((function(e){return Math.round(255*e)})).join(", ")+")":"rgba("+e.map((function(e,t){return t<3&&Math.round(255*e)||e})).join(", ")+")"};var er=Yi={draw_label_collision_boxes:!1,draw_label_texture_boxes:!1,suppress_label_fade_in:!1,suppress_label_snap_animation:!1,show_hidden_labels:!1,layer_stats:!1,wireframe:!1},tr=Object.getOwnPropertyDescriptor,ir={f:d?tr:function(e,t){if(e=P(e),t=g(t,!0),m)try{return tr(e,t)}catch(e){}if(F(e,t))return v(!De.f.call(e,t),e[t])}},rr=function(e,t){if(u(e),!c(t)&&null!==t)throw TypeError(t+": can't set as prototype!")},nr=Object.setPrototypeOf||("__proto__"in{}?function(e,t,i){try{(i=R(Function.call,ir.f(Object.prototype,"__proto__").set,2))(e,[]),t=!(e instanceof Array)}catch(e){t=!0}return function(e,r){return rr(e,r),t?e.__proto__=r:i(e,r),e}}({},!1):void 0),or=function(e,t,i){var r,n=t.constructor;return n!==i&&"function"==typeof n&&(r=n.prototype)!==i.prototype&&c(r)&&nr&&nr(e,r),e},sr=J.concat("length","prototype"),ar={f:Object.getOwnPropertyNames||function(e){return Y(e,sr)}},lr=y.f,cr=ar.f,ur=r.RegExp,hr=ur,dr=ur.prototype,pr=/a/g,fr=/a/g,Ar=new ur(pr)!==pr;if(d&&(!Ar||h((function(){return fr[l("match")]=!1,ur(pr)!=pr||ur(fr)==fr||"/a/i"!=ur(pr,"i")})))){ur=function(e,t){var i=this instanceof ur,r=Di(e),n=void 0===t;return!i&&r&&e.constructor===ur&&n?e:or(Ar?new hr(r&&!n?e.source:e,t):hr((r=e instanceof ur)?e.source:e,r&&n?We.call(e):t),i?this:dr,ur)};for(var mr=function(e){e in ur||lr(ur,e,{configurable:!0,get:function(){return hr[e]},set:function(t){hr[e]=t}})},gr=cr(hr),_r=0;gr.length>_r;)mr(gr[_r++]);dr.constructor=ur,ur.prototype=dr,k(r,"RegExp",ur)}ri("RegExp");var yr,vr=Object.is||function(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t};function xr(e){if("string"==typeof e&&-1===e.search(/^(data|blob):/)){var t=e.indexOf("?");t>-1&&(e=e.substr(0,t));var i=e.indexOf("#");return i>-1&&(e=e.substr(0,i)),e.substr(0,e.lastIndexOf("/")+1)||""}return""}function br(e){if("string"==typeof e)return!(e.search(/^(http|https|data|blob):/)>-1||"//"===e.substr(0,2))}function wr(e,t){e=e.replace(/[[]/,"\\[").replace(/[\]]/,"\\]");var i=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(t);return null===i?"":decodeURIComponent(i[1].replace(/\+/g," "))}st("search",1,(function(e,t,i,r){return[function(i){var r=e(this),n=null==i?void 0:i[t];return void 0!==n?n.call(i,r):new RegExp(i)[t](String(r))},function(e){var t=r(i,e,this);if(t.done)return t.value;var n=u(e),o=String(this),s=n.lastIndex;vr(s,0)||(n.lastIndex=0);var a=Ke(n,o);return vr(n.lastIndex,s)||(n.lastIndex=s),null===a?-1:a.index}]}));var Tr={id:0,queue:[],max_time:20,start_time:null,state:{},add:function(e){e.id=Tr.id++,e.max_time=e.max_time||Tr.max_time,e.pause_factor=e.pause_factor||1;var t=new Promise((function(t,i){e.resolve=t,e.reject=i}));return e.promise=t,e.elapsed=0,e.total_elapsed=0,e.stats={calls:0},this.queue.push(e),this.start_time=this.start_time||performance.now(),this.elapsed=performance.now()-this.start_time,(this.elapsed<Tr.max_time||e.immediate)&&this.process(e),e.promise},remove:function(e){var t=this.queue.indexOf(e);t>-1&&this.queue.splice(t,1)},process:function(e){if(!this.state.user_moving_view||!1!==e.user_moving_view)return e.pause?(e.pause--,!0):(e.stats.calls++,e.start_time=performance.now(),e.run(e))},processAll:function(){this.start_time=this.start_time||performance.now();for(var e=0;e<this.queue.length;e++){var t=this.queue[e];if(!0!==this.process(t)&&(t.pause||(t.pause=t.elapsed>t.max_time?t.pause_factor:0),t.total_elapsed+=t.elapsed),this.elapsed=performance.now()-this.start_time,this.elapsed>=Tr.max_time){this.start_time=null;break}}},finish:function(e,t){return e.elapsed=performance.now()-e.start_time,e.total_elapsed+=e.elapsed,this.remove(e),e.resolve(t),e.promise},cancel:function(e){var t;e.cancel instanceof Function&&(t=e.cancel(e)),e.resolve(t)},shouldContinue:function(e){return e.elapsed=performance.now()-e.start_time,this.elapsed=performance.now()-this.start_time,e.elapsed<e.max_time&&this.elapsed<Tr.max_time},removeForTile:function(e){for(var t=this.queue.length-1;t>=0;t--)this.queue[t].tile_id===e&&(this.cancel(this.queue[t]),this.queue.splice(t,1))},setState:function(e){this.state=e}};function Br(e){var t=[];return Object.assign(e,{subscribe:function(e){-1===t.indexOf(e)&&t.push(e)},unsubscribe:function(e){var i=t.indexOf(e);i>-1&&t.splice(i,1)},unsubscribeAll:function(){t=[]},trigger:function(e){for(var i=arguments.length,r=new Array(i>1?i-1:0),n=1;n<i;n++)r[n-1]=arguments[n];t.forEach((function(t){if("function"==typeof t[e])try{t[e].apply(t,r)}catch(t){Ki("warn","Caught exception in listener for event '"+e+"':",t)}}))},hasSubscribersFor:function(e){var i=!1;return t.forEach((function(t){"function"==typeof t[e]&&(i=!0)})),i}})}function Cr(e,t){var i={};return t.forEach((function(t){return i[t]=e[t]})),i}O(O.P,"String",{repeat:function(e){var t=String(I(this)),i="",r=Q(e);if(r<0||r==1/0)throw RangeError("Count can't be negative");for(;r>0;(r>>>=1)&&(t+=t))1&r&&(i+=t);return i}});for(var Sr,Er=a("typed_array"),Mr=a("view"),Ir=!(!r.ArrayBuffer||!r.DataView),Pr=Ir,Lr=0,Fr="Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array".split(",");Lr<9;)(Sr=r[Fr[Lr++]])?(x(Sr.prototype,Er,!0),x(Sr.prototype,Mr,!0)):Pr=!1;var kr={ABV:Ir,CONSTR:Pr,TYPED:Er,VIEW:Mr},zr=function(e){if(void 0===e)return 0;var t=Q(e),i=V(t);if(t!==i)throw RangeError("Wrong length!");return i},Rr=function(e){for(var t=pe(this),i=V(t.length),r=arguments.length,n=$(r>1?arguments[1]:void 0,i),o=r>2?arguments[2]:void 0,s=void 0===o?i:$(o,i);s>n;)t[n++]=e;return t},Dr=t((function(e,t){var i=ar.f,n=y.f,o="prototype",s="Wrong index!",a=r.ArrayBuffer,l=r.DataView,c=r.Math,u=r.RangeError,p=r.Infinity,f=a,A=c.abs,m=c.pow,g=c.floor,_=c.log,v=c.LN2,b=d?"_b":"buffer",w=d?"_l":"byteLength",T=d?"_o":"byteOffset";function B(e,t,i){var r,n,o,s=new Array(i),a=8*i-t-1,l=(1<<a)-1,c=l>>1,u=23===t?m(2,-24)-m(2,-77):0,h=0,d=e<0||0===e&&1/e<0?1:0;for((e=A(e))!=e||e===p?(n=e!=e?1:0,r=l):(r=g(_(e)/v),e*(o=m(2,-r))<1&&(r--,o*=2),(e+=r+c>=1?u/o:u*m(2,1-c))*o>=2&&(r++,o/=2),r+c>=l?(n=0,r=l):r+c>=1?(n=(e*o-1)*m(2,t),r+=c):(n=e*m(2,c-1)*m(2,t),r=0));t>=8;s[h++]=255&n,n/=256,t-=8);for(r=r<<t|n,a+=t;a>0;s[h++]=255&r,r/=256,a-=8);return s[--h]|=128*d,s}function C(e,t,i){var r,n=8*i-t-1,o=(1<<n)-1,s=o>>1,a=n-7,l=i-1,c=e[l--],u=127&c;for(c>>=7;a>0;u=256*u+e[l],l--,a-=8);for(r=u&(1<<-a)-1,u>>=-a,a+=t;a>0;r=256*r+e[l],l--,a-=8);if(0===u)u=1-s;else{if(u===o)return r?NaN:c?-p:p;r+=m(2,t),u-=s}return(c?-1:1)*r*m(2,u-t)}function S(e){return e[3]<<24|e[2]<<16|e[1]<<8|e[0]}function E(e){return[255&e]}function M(e){return[255&e,e>>8&255]}function I(e){return[255&e,e>>8&255,e>>16&255,e>>24&255]}function P(e){return B(e,52,8)}function L(e){return B(e,23,4)}function F(e,t,i){n(e[o],t,{get:function(){return this[i]}})}function k(e,t,i,r){var n=zr(+i);if(n+t>e[w])throw u(s);var o=e[b]._b,a=n+e[T],l=o.slice(a,a+t);return r?l:l.reverse()}function z(e,t,i,r,n,o){var a=zr(+i);if(a+t>e[w])throw u(s);for(var l=e[b]._b,c=a+e[T],h=r(+n),d=0;d<t;d++)l[c+d]=h[o?d:t-d-1]}if(kr.ABV){if(!h((function(){a(1)}))||!h((function(){new a(-1)}))||h((function(){return new a,new a(1.5),new a(NaN),"ArrayBuffer"!=a.name}))){for(var R,D=(a=function(e){return Bt(this,a),new f(zr(e))})[o]=f[o],O=i(f),U=0;O.length>U;)(R=O[U++])in a||x(a,R,f[R]);D.constructor=a}var N=new l(new a(2)),j=l[o].setInt8;N.setInt8(0,2147483648),N.setInt8(1,2147483649),!N.getInt8(0)&&N.getInt8(1)||ti(l[o],{setInt8:function(e,t){j.call(this,e,t<<24>>24)},setUint8:function(e,t){j.call(this,e,t<<24>>24)}},!0)}else a=function(e){Bt(this,a,"ArrayBuffer");var t=zr(e);this._b=Rr.call(new Array(t),0),this[w]=t},l=function(e,t,i){Bt(this,l,"DataView"),Bt(e,a,"DataView");var r=e[w],n=Q(t);if(n<0||n>r)throw u("Wrong offset!");if(n+(i=void 0===i?r-n:V(i))>r)throw u("Wrong length!");this[b]=e,this[T]=n,this[w]=i},d&&(F(a,"byteLength","_l"),F(l,"buffer","_b"),F(l,"byteLength","_l"),F(l,"byteOffset","_o")),ti(l[o],{getInt8:function(e){return k(this,1,e)[0]<<24>>24},getUint8:function(e){return k(this,1,e)[0]},getInt16:function(e){var t=k(this,2,e,arguments[1]);return(t[1]<<8|t[0])<<16>>16},getUint16:function(e){var t=k(this,2,e,arguments[1]);return t[1]<<8|t[0]},getInt32:function(e){return S(k(this,4,e,arguments[1]))},getUint32:function(e){return S(k(this,4,e,arguments[1]))>>>0},getFloat32:function(e){return C(k(this,4,e,arguments[1]),23,4)},getFloat64:function(e){return C(k(this,8,e,arguments[1]),52,8)},setInt8:function(e,t){z(this,1,e,E,t)},setUint8:function(e,t){z(this,1,e,E,t)},setInt16:function(e,t){z(this,2,e,M,t,arguments[2])},setUint16:function(e,t){z(this,2,e,M,t,arguments[2])},setInt32:function(e,t){z(this,4,e,I,t,arguments[2])},setUint32:function(e,t){z(this,4,e,I,t,arguments[2])},setFloat32:function(e,t){z(this,4,e,L,t,arguments[2])},setFloat64:function(e,t){z(this,8,e,P,t,arguments[2])}});ue(a,"ArrayBuffer"),ue(l,"DataView"),x(l[o],kr.VIEW,!0),t.ArrayBuffer=a,t.DataView=l})),Or=Array.isArray||function(e){return"Array"==E(e)},Ur=l("species"),Nr=function(e,t){return new(function(e){var t;return Or(e)&&("function"!=typeof(t=e.constructor)||t!==Array&&!Or(t.prototype)||(t=void 0),c(t)&&null===(t=t[Ur])&&(t=void 0)),void 0===t?Array:t}(e))(t)},Qr=function(e,t){var i=1==e,r=2==e,n=3==e,o=4==e,s=6==e,a=5==e||s,l=t||Nr;return function(t,c,u){for(var h,d,p=pe(t),f=M(p),A=R(c,u,3),m=V(f.length),g=0,_=i?l(t,m):r?l(t,0):void 0;m>g;g++)if((a||g in f)&&(d=A(h=f[g],g,p),e))if(i)_[g]=d;else if(d)switch(e){case 3:return!0;case 5:return h;case 6:return g;case 2:_.push(h)}else if(o)return!1;return s?-1:n||o?o:_}},jr=[].copyWithin||function(e,t){var i=pe(this),r=V(i.length),n=$(e,r),o=$(t,r),s=arguments.length>2?arguments[2]:void 0,a=Math.min((void 0===s?r:$(s,r))-o,r-n),l=1;for(o<n&&n<o+a&&(l=-1,o+=a-1,n+=a-1);a-- >0;)o in i?i[n]=i[o]:delete i[n],n+=l,o+=l;return i},Vr=t((function(e){if(d){var t=r,i=h,n=O,o=kr,s=Dr,u=R,p=Bt,f=v,A=x,m=ti,_=Q,b=V,w=zr,T=$,B=g,S=F,E=ze,M=c,I=pe,P=Mt,L=ae,k=me,z=ar.f,D=Pt,U=a,N=l,j=Qr,H=Z,G=kt,q=xe,K=C,W=hi,X=ri,Y=Rr,J=jr,ee=y,te=ir,ie=ee.f,re=te.f,ne=t.RangeError,oe=t.TypeError,se=t.Uint8Array,le=Array.prototype,ce=s.ArrayBuffer,ue=s.DataView,he=j(0),de=j(2),fe=j(3),Ae=j(4),ge=j(5),_e=j(6),ye=H(!0),ve=H(!1),be=q.values,we=q.keys,Te=q.entries,Be=le.lastIndexOf,Ce=le.reduce,Se=le.reduceRight,Ee=le.join,Me=le.sort,Ie=le.slice,Pe=le.toString,Le=le.toLocaleString,Fe=N("iterator"),ke=N("toStringTag"),Re=U("typed_constructor"),De=U("def_constructor"),Oe=o.CONSTR,Ue=o.TYPED,Ne=o.VIEW,Qe=j(1,(function(e,t){return $e(G(e,e[De]),t)})),je=i((function(){return 1===new se(new Uint16Array([1]).buffer)[0]})),Ve=!!se&&!!se.prototype.set&&i((function(){new se(1).set({})})),He=function(e,t){var i=_(e);if(i<0||i%t)throw ne("Wrong offset!");return i},Ge=function(e){if(M(e)&&Ue in e)return e;throw oe(e+" is not a typed array!")},$e=function(e,t){if(!M(e)||!(Re in e))throw oe("It is not a typed array constructor!");return new e(t)},Ze=function(e,t){return qe(G(e,e[De]),t)},qe=function(e,t){for(var i=0,r=t.length,n=$e(e,r);r>i;)n[i]=t[i++];return n},Ke=function(e,t,i){ie(e,t,{get:function(){return this._d[i]}})},We=function(e){var t,i,r,n,o,s,a=I(e),l=arguments.length,c=l>1?arguments[1]:void 0,h=void 0!==c,d=D(a);if(null!=d&&!P(d)){for(s=d.call(a),r=[],t=0;!(o=s.next()).done;t++)r.push(o.value);a=r}for(h&&l>2&&(c=u(c,arguments[2],2)),t=0,i=b(a.length),n=$e(this,i);i>t;t++)n[t]=h?c(a[t],t):a[t];return n},Xe=function(){for(var e=0,t=arguments.length,i=$e(this,t);t>e;)i[e]=arguments[e++];return i},Ye=!!se&&i((function(){Le.call(new se(1))})),Je=function(){return Le.apply(Ye?Ie.call(Ge(this)):Ge(this),arguments)},et={copyWithin:function(e,t){return J.call(Ge(this),e,t,arguments.length>2?arguments[2]:void 0)},every:function(e){return Ae(Ge(this),e,arguments.length>1?arguments[1]:void 0)},fill:function(e){return Y.apply(Ge(this),arguments)},filter:function(e){return Ze(this,de(Ge(this),e,arguments.length>1?arguments[1]:void 0))},find:function(e){return ge(Ge(this),e,arguments.length>1?arguments[1]:void 0)},findIndex:function(e){return _e(Ge(this),e,arguments.length>1?arguments[1]:void 0)},forEach:function(e){he(Ge(this),e,arguments.length>1?arguments[1]:void 0)},indexOf:function(e){return ve(Ge(this),e,arguments.length>1?arguments[1]:void 0)},includes:function(e){return ye(Ge(this),e,arguments.length>1?arguments[1]:void 0)},join:function(e){return Ee.apply(Ge(this),arguments)},lastIndexOf:function(e){return Be.apply(Ge(this),arguments)},map:function(e){return Qe(Ge(this),e,arguments.length>1?arguments[1]:void 0)},reduce:function(e){return Ce.apply(Ge(this),arguments)},reduceRight:function(e){return Se.apply(Ge(this),arguments)},reverse:function(){for(var e,t=Ge(this).length,i=Math.floor(t/2),r=0;r<i;)e=this[r],this[r++]=this[--t],this[t]=e;return this},some:function(e){return fe(Ge(this),e,arguments.length>1?arguments[1]:void 0)},sort:function(e){return Me.call(Ge(this),e)},subarray:function(e,t){var i=Ge(this),r=i.length,n=T(e,r);return new(G(i,i[De]))(i.buffer,i.byteOffset+n*i.BYTES_PER_ELEMENT,b((void 0===t?r:T(t,r))-n))}},tt=function(e,t){return Ze(this,Ie.call(Ge(this),e,t))},it=function(e){Ge(this);var t=He(arguments[1],1),i=this.length,r=I(e),n=b(r.length),o=0;if(n+t>i)throw ne("Wrong length!");for(;o<n;)this[t+o]=r[o++]},rt={entries:function(){return Te.call(Ge(this))},keys:function(){return we.call(Ge(this))},values:function(){return be.call(Ge(this))}},nt=function(e,t){return M(e)&&e[Ue]&&"symbol"!=typeof t&&t in e&&String(+t)==String(t)},ot=function(e,t){return nt(e,t=B(t,!0))?f(2,e[t]):re(e,t)},st=function(e,t,i){return!(nt(e,t=B(t,!0))&&M(i)&&S(i,"value"))||S(i,"get")||S(i,"set")||i.configurable||S(i,"writable")&&!i.writable||S(i,"enumerable")&&!i.enumerable?ie(e,t,i):(e[t]=i.value,e)};Oe||(te.f=ot,ee.f=st),n(n.S+n.F*!Oe,"Object",{getOwnPropertyDescriptor:ot,defineProperty:st}),i((function(){Pe.call({})}))&&(Pe=Le=function(){return Ee.call(this)});var at=m({},et);m(at,rt),A(at,Fe,rt.values),m(at,{slice:tt,set:it,constructor:function(){},toString:Pe,toLocaleString:Je}),Ke(at,"buffer","b"),Ke(at,"byteOffset","o"),Ke(at,"byteLength","l"),Ke(at,"length","e"),ie(at,ke,{get:function(){return this[Ue]}}),e.exports=function(e,r,s,a){var l=e+((a=!!a)?"Clamped":"")+"Array",c="get"+e,u="set"+e,h=t[l],d=h||{},f=h&&k(h),m=!h||!o.ABV,g={},_=h&&h.prototype,y=function(e,t){ie(e,t,{get:function(){return function(e,t){var i=e._d;return i.v[c](t*r+i.o,je)}(this,t)},set:function(e){return function(e,t,i){var n=e._d;a&&(i=(i=Math.round(i))<0?0:i>255?255:255&i),n.v[u](t*r+n.o,i,je)}(this,t,e)},enumerable:!0})};m?(h=s((function(e,t,i,n){p(e,h,l,"_d");var o,s,a,c,u=0,d=0;if(M(t)){if(!(t instanceof ce||"ArrayBuffer"==(c=E(t))||"SharedArrayBuffer"==c))return Ue in t?qe(h,t):We.call(h,t);o=t,d=He(i,r);var f=t.byteLength;if(void 0===n){if(f%r)throw ne("Wrong length!");if((s=f-d)<0)throw ne("Wrong length!")}else if((s=b(n)*r)+d>f)throw ne("Wrong length!");a=s/r}else a=w(t),o=new ce(s=a*r);for(A(e,"_d",{b:o,o:d,l:s,e:a,v:new ue(o)});u<a;)y(e,u++)})),_=h.prototype=L(at),A(_,"constructor",h)):i((function(){h(1)}))&&i((function(){new h(-1)}))&&W((function(e){new h,new h(null),new h(1.5),new h(e)}),!0)||(h=s((function(e,t,i,n){var o;return p(e,h,l),M(t)?t instanceof ce||"ArrayBuffer"==(o=E(t))||"SharedArrayBuffer"==o?void 0!==n?new d(t,He(i,r),n):void 0!==i?new d(t,He(i,r)):new d(t):Ue in t?qe(h,t):We.call(h,t):new d(w(t))})),he(f!==Function.prototype?z(d).concat(z(f)):z(d),(function(e){e in h||A(h,e,d[e])})),h.prototype=_,_.constructor=h);var v=_[Fe],x=!!v&&("values"==v.name||null==v.name),T=rt.values;A(h,Re,!0),A(_,Ue,l),A(_,Ne,!0),A(_,De,h),(a?new h(1)[ke]==l:ke in _)||ie(_,ke,{get:function(){return l}}),g[l]=h,n(n.G+n.W+n.F*(h!=d),g),n(n.S,l,{BYTES_PER_ELEMENT:r}),n(n.S+n.F*i((function(){d.of.call(h,1)})),l,{from:We,of:Xe}),"BYTES_PER_ELEMENT"in _||A(_,"BYTES_PER_ELEMENT",r),n(n.P,l,et),X(l),n(n.P+n.F*Ve,l,{set:it}),n(n.P+n.F*!x,l,rt),_.toString!=Pe&&(_.toString=Pe),n(n.P+n.F*i((function(){new h(1).slice()})),l,{slice:tt}),n(n.P+n.F*(i((function(){return[1,2].toLocaleString()!=new h([1,2]).toLocaleString()}))||!i((function(){_.toLocaleString.call([1,2])}))),l,{toLocaleString:Je}),K[l]=x?v:T,x||A(_,Fe,T)}}else e.exports=function(){}}));Vr("Uint8",1,(function(e){return function(t,i,r){return e(this,t,i,r)}}));var Hr=function(){function e(t,i,r){void 0===r&&(r={}),r=e.sliceOptions(r),this.gl=t,this.texture=t.createTexture(),this.texture&&(this.valid=!0),this.bind(),this.name=i,this.retain_count=0,this.config_type=null,this.loading=null,this.loaded=!1,this.filtering=r.filtering,this.density=r.density||1,this.sprites=r.sprites,this.texcoords={},this.sizes={},this.css_sizes={},this.aspects={},this.setData(1,1,new Uint8Array([0,0,0,0]),{filtering:"nearest"}),this.loaded=!1,e.textures[this.name]&&(this.retain_count=e.textures[this.name].retain_count,e.textures[this.name].retain_count=0,e.textures[this.name].destroy()),e.textures[this.name]=this,e.texture_configs[this.name]=JSON.stringify(Object.assign({name:i},r)),this.load(r),Ki("trace","creating Texture "+this.name)}var t=e.prototype;return t.destroy=function(t){var i=(void 0===t?{}:t).force;this.retain_count>0&&!i?Ki("error","Texture '"+this.name+"': destroying texture with retain count of '"+this.retain_count+"'"):this.valid&&(this.gl.deleteTexture(this.texture),this.texture=null,e.textures[this.name]===this&&(delete e.textures[this.name],delete e.texture_configs[this.name]),this.valid=!1,Ki("trace","destroying Texture "+this.name))},t.retain=function(){this.retain_count++},t.release=function(){this.retain_count<=0&&Ki("error","Texture '"+this.name+"': releasing texture with retain count of '"+this.retain_count+"'"),this.retain_count--,this.retain_count<=0&&this.destroy()},t.bind=function(t){void 0===t&&(t=0),this.valid&&(e.activeUnit!==t&&(this.gl.activeTexture(this.gl.TEXTURE0+t),e.activeUnit=t,e.boundTexture=null),e.boundTexture!==this.texture&&(this.gl.bindTexture(this.gl.TEXTURE_2D,this.texture),e.boundTexture=this.texture))},t.load=function(e){var t=this;return e?(this.loading=null,"string"==typeof e.url?(this.config_type="url",this.setUrl(e.url,e)):e.element?(this.config_type="element",this.setElement(e.element,e)):e.data&&e.width&&e.height&&(this.config_type="data",this.setData(e.width,e.height,e.data,e)),this.loading=this.loading&&this.loading.then((function(){return t.calculateSprites(),t}))||Promise.resolve(this),this.loading):this.loading||Promise.resolve(this)},t.setUrl=function(t,i){var r=this;if(void 0===i&&(i={}),this.valid)return this.url=t,this.loading=new Promise((function(t){var n=new Image;n.onload=function(){try{if("data:"===r.url.slice(0,5)){var o=document.createElement("canvas"),s=o.getContext("2d");o.width=n.width,o.height=n.height,s.drawImage(n,0,0),r.setElement(o,i)}else r.setElement(n,i)}catch(t){r.loaded=!1,Ki("warn","Texture '"+r.name+"': failed to load url: '"+r.url+"'",t,i),e.trigger("warning",{message:"Failed to load texture from "+r.url,error:t,texture:i})}r.loaded=!0,t(r)},n.onerror=function(n){r.loaded=!1,Ki("warn","Texture '"+r.name+"': failed to load url: '"+r.url+"'",n,i),e.trigger("warning",{message:"Failed to load texture from "+r.url,error:n,texture:i}),t(r)},Ji.isSafari()&&"data:"===r.url.slice(0,5)||(n.crossOrigin="anonymous"),n.src=r.url})),this.loading},t.setData=function(e,t,i,r){return void 0===r&&(r={}),this.width=e,this.height=t,Array.isArray(i)&&(i=new Uint8Array(i)),this.update(i,r),this.setFiltering(r),this.loaded=!0,this.loading=Promise.resolve(this),this.loading},t.setElement=function(t,i){var r=t;if("string"==typeof t&&(t=document.querySelector(t)),t instanceof HTMLCanvasElement||t instanceof HTMLImageElement||t instanceof HTMLVideoElement)this.update(t,i),this.setFiltering(i);else{this.loaded=!1;var n="the 'element' parameter (`element: "+JSON.stringify(r)+"`) must be a CSS ";n+="selector string, or a <canvas>, <image> or <video> object",Ki("warn","Texture '"+this.name+"': "+n,i),e.trigger("warning",{message:"Failed to load texture because "+n,texture:i})}return this.loaded=!0,this.loading=Promise.resolve(this),this.loading},t.update=function(t,i){void 0===i&&(i={}),this.valid&&(this.bind(),t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof HTMLImageElement&&t.complete?(this.width=t.width,this.height=t.height,this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1!==i.UNPACK_FLIP_Y_WEBGL),this.gl.pixelStorei(this.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i.UNPACK_PREMULTIPLY_ALPHA_WEBGL||!1),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,t)):(this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,null),this.gl.pixelStorei(this.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,null),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.width,this.height,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,t)),e.trigger("update",this))},t.setFiltering=function(t){if(void 0===t&&(t={}),this.valid){t.filtering=t.filtering||"linear";var i=this.gl;this.bind(),Ji.isPowerOf2(this.width)&&Ji.isPowerOf2(this.height)?(this.power_of_2=!0,i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,t.TEXTURE_WRAP_S||t.repeat&&i.REPEAT||i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,t.TEXTURE_WRAP_T||t.repeat&&i.REPEAT||i.CLAMP_TO_EDGE),"mipmap"===t.filtering?(this.filtering="mipmap",i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR_MIPMAP_LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR),i.generateMipmap(i.TEXTURE_2D)):"linear"===t.filtering?(this.filtering="linear",i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR)):"nearest"===t.filtering&&(this.filtering="nearest",i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.NEAREST))):(this.power_of_2=!1,i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),"nearest"===t.filtering?(this.filtering="nearest",i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.NEAREST)):(this.filtering="linear",i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR))),e.trigger("update",this)}},t.calculateSprites=function(){if(this.sprites)for(var t in this.sprites){var i=this.sprites[t];this.texcoords[t]=e.getTexcoordsForSprite([i[0],i[1]],[i[2],i[3]],[this.width,this.height]),this.sizes[t]=[i[2],i[3]],this.css_sizes[t]=[i[2]/this.density,i[3]/this.density],this.aspects[t]=i[2]/i[3]}},t.byteSize=function(){return Math.round(this.width*this.height*4*("mipmap"==this.filtering?1.33:1))},e}();Hr.create=function(e,t,i){return new Hr(e,t,i)},Hr.retain=function(e){Hr.textures[e]&&Hr.textures[e].retain()},Hr.release=function(e){Hr.textures[e]&&Hr.textures[e].release()},Hr.destroy=function(e){Object.keys(Hr.textures).forEach((function(t){var i=Hr.textures[t];i.gl===e&&i.destroy({force:!0})}))},Hr.getSpriteInfo=function(e,t){var i=Hr.textures[e];return i&&{size:i.sizes[t],css_size:i.css_sizes[t],aspect:i.aspects[t],texcoords:i.texcoords[t]}},Hr.getTexcoordsForSprite=function(e,t,i){var r=i[1]-e[1]-t[1];return[e[0]/i[0],r/i[1],(t[0]+e[0])/i[0],(t[1]+r)/i[1]]},Hr.createFromObject=function(e,t){var i=[];if(t)for(var r in t){var n=t[r];if(!n.skip_create&&Hr.changed(r,n)){var o=Hr.create(e,r,n);i.push(o.loading)}}return Promise.all(i)},Hr.default="__default",Hr.createDefault=function(e){return Hr.create(e,Hr.default)},Hr.sliceOptions=function(e){return{filtering:e.filtering,sprites:e.sprites,url:e.url,element:e.element,data:e.data,width:e.width,height:e.height,density:e.density,repeat:e.repeat,TEXTURE_WRAP_S:e.TEXTURE_WRAP_S,TEXTURE_WRAP_T:e.TEXTURE_WRAP_T,UNPACK_FLIP_Y_WEBGL:e.UNPACK_FLIP_Y_WEBGL,UNPACK_PREMULTIPLY_ALPHA_WEBGL:e.UNPACK_PREMULTIPLY_ALPHA_WEBGL}},Hr.changed=function(e,t){var i=Hr.textures[e];if(i){if("element"===i.config_type||null!=t.element)return!0;if(t=Hr.sliceOptions(t),Hr.texture_configs[e]===JSON.stringify(Object.assign({name:e},t)))return!1}return!0},Hr.getInfo=function(e){if(e||(e=Object.keys(Hr.textures)),Array.isArray(e))return Promise.all(e.map((function(e){return Hr.getInfo(e)})));var t=Hr.textures[e];return t?(t.loading||Promise.resolve(t)).then((function(){return{name:t.name,width:t.width,height:t.height,density:t.density,css_size:[t.width/t.density,t.height/t.density],aspect:t.width/t.height,sprites:t.sprites,texcoords:t.texcoords,sizes:t.sizes,css_sizes:t.css_sizes,aspects:t.aspects,filtering:t.filtering,power_of_2:t.power_of_2,valid:t.valid}})):Promise.resolve(null)},Hr.syncTexturesToWorker=function(e){return Qi.postMessage("Texture.getInfo",e).then((function(e){return e&&e.filter((function(e){return e})).forEach((function(e){return Hr.textures[e.name]=e})),Hr.textures}))},Hr.getMaxTextureSize=function(e){return e.getParameter(e.MAX_TEXTURE_SIZE)},Hr.textures={},Hr.texture_configs={},Hr.boundTexture=null,Hr.activeUnit=null,Qi.addTarget("Texture",Hr),Br(Hr),st("match",1,(function(e,t,i,r){return[function(i){var r=e(this),n=null==i?void 0:i[t];return void 0!==n?n.call(i,r):new RegExp(i)[t](String(r))},function(e){var t=r(i,e,this);if(t.done)return t.value;var n=u(e),o=String(this);if(!n.global)return Ke(n,o);var s=n.unicode;n.lastIndex=0;for(var a,l=[],c=0;null!==(a=Ke(n,o));){var h=String(a[0]);l[c]=h,""===h&&(n.lastIndex=Ze(o,V(n.lastIndex),s)),c++}return 0===c?null:l}]}));var Gr={parseUniforms:function(e){var t=[];for(var i in e){var r,n=i,o=e[i];if("number"==typeof o)t.push({type:"float",method:"1f",name:i,value:o,key:n,uniforms:e});else if(Array.isArray(o)){if("number"==typeof o[0])o.length>=2&&o.length<=4?t.push({type:"vec"+o.length,method:o.length+"fv",name:i,value:o,key:n,uniforms:e}):o.length>4&&t.push({type:"float[]",method:"1fv",name:i+"[0]",value:o,key:n,uniforms:e});else if("string"==typeof o[0])for(r=0;r<o.length;r++)t.push({type:"sampler2D",method:"1i",name:i+"["+r+"]",value:o[r],key:r,uniforms:o});else if(Array.isArray(o[0])&&"number"==typeof o[0][0]&&o[0].length>=2&&o[0].length<=4)for(r=0;r<o.length;r++)t.push({type:"vec"+o[0].length,method:o[0].length+"fv",name:i+"["+r+"]",value:o[r],key:r,uniforms:o})}else"boolean"==typeof o?t.push({type:"bool",method:"1i",name:i,value:o,key:n,uniforms:e}):"string"==typeof o&&t.push({type:"sampler2D",method:"1i",name:i,value:o,key:n,uniforms:e})}return t},defineVariable:function(e,t){var i,r;if("number"==typeof t)i="float";else if(Array.isArray(t))"number"==typeof t[0]?t.length>=2&&t.length<=4?i="vec"+t.length:(i="float",r=t.length):"string"==typeof t[0]?(i="sampler2D",r=t.length):Array.isArray(t[0])&&"number"==typeof t[0][0]&&t[0].length>=2&&t[0].length<=4&&(i="vec"+t[0].length,r=t.length);else if("boolean"==typeof t)i="bool";else{if("string"!=typeof t)return;i="sampler2D"}var n="";return n+=i+" "+e,r&&(n+="["+r+"]"),n+";\n"},defineUniform:function(e,t){var i=Gr.defineVariable(e,t);if(i)return"uniform "+i},expandVec3:function(e,t){var i;if(void 0===t&&(t=1),Array.isArray(e)){if(2!==e.length)return e;i=[].concat(e,[t]).map(parseFloat)}else i=[e,e,e].map(parseFloat);if(i&&i.every((function(e){return"number"==typeof e&&!isNaN(e)})))return i},expandVec4:function(e,t){var i;if(void 0===t&&(t=1),Array.isArray(e)){if(3!==e.length)return e;i=[].concat(e,[t]).map(parseFloat)}else i=[e,e,e,t].map(parseFloat);if(i&&i.every((function(e){return"number"==typeof e&&!isNaN(e)})))return i}},$r=[];function Zr(e,t){var i=$r.filter((function(t){return t[0]===e}))[0];return(i=i&&i[1])||($r.push([e,{}]),i=$r[$r.length-1][1]),i[t]||(i[t]=e.getExtension(t)),i[t]}function qr(e){var t,i,r=0;if(0===e.length)return r;for(t=0,i=e.length;t<i;t++)r=(r<<5)-r+e.charCodeAt(t),r|=0;return r}var Kr=function(e){e=String(e);for(var t,i=[];t=e.match(/ERROR\:([^\n]+)/);){e=e.slice(t.index+1);var r=(s=t[1].trim()).split(":"),n=r.slice(2).join(":").trim(),o=parseInt(r[0],10),s=parseInt(r[1],10);i.push({message:n,file:o,line:s})}return i},Wr=/^\s*#pragma.*$/gm,Xr=/\\\s*\n/gm,Yr=function(){function e(t,i,r,n){n=n||{},this.gl=t,this.program=null,this.compiled=!1,this.compiling=!1,this.error=null,this.defines=Object.assign({},n.defines||{}),this.blocks=Object.assign({},n.blocks||{}),this.block_scopes=Object.assign({},n.block_scopes||{}),this.extensions=n.extensions||[],this.dependent_uniforms=n.uniforms,this.uniforms={},this.attribs={},this.vertex_source=i,this.fragment_source=r,this.id=e.id++,this.name=n.name}var t=e.prototype;return t.destroy=function(){this.gl.useProgram(null),this.gl.deleteProgram(this.program),this.program=null,this.uniforms={},this.attribs={},this.compiled=!1},t.use=function(){this.compiled&&(e.current!==this&&this.gl.useProgram(this.program),e.current=this)},t.compile=function(){var t=this;if(this.compiling)throw new Error("ShaderProgram.compile(): skipping for "+this.id+" ("+this.name+") because already compiling");this.compiling=!0,this.compiled=!1,this.error=null,this.computed_vertex_source=this.vertex_source,this.computed_fragment_source=this.fragment_source;var i,r=this.checkExtensions(),n=this.buildDefineList(),o=this.buildShaderBlockList();for(var s in o){var a=o[s];if(a&&(!Array.isArray(a)||0!==a.length)){i=new RegExp("^\\s*#pragma\\s+tangram:\\s+"+s+"\\s*$","m");var l=this.computed_vertex_source.match(i),c=this.computed_fragment_source.match(i);if(null!=l||null!=c){var u="";a.forEach((function(e){var t=e.scope+", "+e.key+", "+e.num;u+="\n// tangram-block-start: "+t+"\n",u+=e.source,u+="\n// tangram-block-end: "+t+"\n"})),null!=l&&(this.computed_vertex_source=this.computed_vertex_source.replace(i,u)),null!=c&&(this.computed_fragment_source=this.computed_fragment_source.replace(i,u)),n["TANGRAM_BLOCK_"+s.replace(/[\s-]+/g,"_").toUpperCase()]=!0}}}this.computed_vertex_source=this.computed_vertex_source.replace(Wr,""),this.computed_fragment_source=this.computed_fragment_source.replace(Wr,""),this.ensureUniforms(this.dependent_uniforms);var h="",d=this.gl.getShaderPrecisionFormat(this.gl.FRAGMENT_SHADER,this.gl.HIGH_FLOAT);h=d&&d.precision>0?"precision highp float;\n":"precision mediump float;\n",n.TANGRAM_VERTEX_SHADER=!0,n.TANGRAM_FRAGMENT_SHADER=!1,this.computed_vertex_source=h+e.buildDefineString(n)+this.computed_vertex_source,n.TANGRAM_VERTEX_SHADER=!1,n.TANGRAM_FRAGMENT_SHADER=!0,this.computed_fragment_source=e.buildExtensionString(r)+h+e.buildDefineString(n)+this.computed_fragment_source,this.computed_vertex_source=this.computed_vertex_source.replace(Xr,""),this.computed_fragment_source=this.computed_fragment_source.replace(Xr,"");try{this.program=e.updateProgram(this.gl,this.program,this.computed_vertex_source,this.computed_fragment_source),this.compiled=!0,this.compiling=!1}catch(e){throw this.program=null,this.compiled=!1,this.compiling=!1,this.error=e,this.error.vertex_shader_source=this.computed_vertex_source,this.error.fragment_shader_source=this.computed_fragment_source,"vertex"!==e.type&&"fragment"!==e.type||(this.shader_errors=e.errors,this.shader_errors.forEach((function(i){i.type=e.type,i.block=t.block(e.type,i.line),i.line=t.block(e.type,i.line)})),this.error.shader_errors=this.shader_errors),e}this.computed_vertex_source=null,this.computed_fragment_source=null,this.use(),this.refreshUniforms(),this.refreshAttributes()},t.buildDefineList=function(){var t,i={};for(t in e.defines)i[t]=e.defines[t];for(t in this.defines)i[t]=this.defines[t];return i},t.buildShaderBlockList=function(){var t,i={};for(t in e.blocks){var r;i[t]=[],Array.isArray(e.blocks[t])?(r=i[t]).push.apply(r,e.blocks[t].map((function(e,i){return{key:t,source:e,num:i,scope:"ShaderProgram"}}))):i[t]=[{key:t,source:e.blocks[t],num:0,scope:"ShaderProgram"}]}for(t in this.blocks)if(i[t]=i[t]||[],Array.isArray(this.blocks[t]))for(var n=this.block_scopes&&this.block_scopes[t]||[],o=null,s=0,a=0;a<this.blocks[t].length;a++)n[a]!==o&&(o=n[a],s=0),i[t].push({key:t,source:this.blocks[t][a],num:s,scope:o||this.name}),s++;else i[t].push({key:t,source:this.blocks[t],num:0,scope:this.name});return i},t.ensureUniforms=function(e){if(e){var t=Object.entries(e).map((function(e){var t=e[0],i=e[1];return Gr.defineUniform(t,i)})).filter((function(e){return e}));this.computed_vertex_source=t.join("\n")+this.computed_vertex_source,this.computed_fragment_source=t.join("\n")+this.computed_fragment_source}},t.setUniforms=function(e,t){if(void 0===t&&(t=!0),this.compiled){t&&(this.texture_unit=0);for(var i=Gr.parseUniforms(e),r=0;r<i.length;r++){var n=i[r];"sampler2D"===n.type?this.setTextureUniform(n.name,n.value):this.uniform(n.method,n.name,n.value)}}},t.saveUniforms=function(e){var t=e||this.uniforms;for(var i in t){var r=this.uniforms[i];r&&(r.saved_value=r.value)}this.saved_texture_unit=this.texture_unit||0},t.restoreUniforms=function(e){var t=e||this.uniforms;for(var i in t){var r=this.uniforms[i];r&&r.saved_value&&(r.value=r.saved_value,this.updateUniform(r))}this.texture_unit=this.saved_texture_unit||0},t.setTextureUniform=function(e,t){var i=Hr.textures[t];null!=i?(i.bind(this.texture_unit),this.uniform("1i",e,this.texture_unit),this.texture_unit++):Ki("warn","Cannot find texture '"+t+"'")},t.uniform=function(e,t,i){if(this.compiled){this.uniforms[t]=this.uniforms[t]||{};var r=this.uniforms[t];r.name=t,void 0===r.location&&(r.location=this.gl.getUniformLocation(this.program,t)),r.method=e,r.value=i,this.updateUniform(r)}},t.updateUniform=function(e){this.compiled&&e&&null!=e.location&&(this.use(),this.commitUniform(e))},t.commitUniform=function(e){var t=e.location,i=e.value;switch(e.method){case"1i":this.gl.uniform1i(t,i);break;case"1f":this.gl.uniform1f(t,i);break;case"2f":this.gl.uniform2f(t,i[0],i[1]);break;case"3f":this.gl.uniform3f(t,i[0],i[1],i[2]);break;case"4f":this.gl.uniform4f(t,i[0],i[1],i[2],i[3]);break;case"1iv":this.gl.uniform1iv(t,i);break;case"3iv":this.gl.uniform3iv(t,i);break;case"1fv":this.gl.uniform1fv(t,i);break;case"2fv":this.gl.uniform2fv(t,i);break;case"3fv":this.gl.uniform3fv(t,i);break;case"4fv":this.gl.uniform4fv(t,i);break;case"Matrix3fv":this.gl.uniformMatrix3fv(t,!1,i);break;case"Matrix4fv":this.gl.uniformMatrix4fv(t,!1,i)}},t.refreshUniforms=function(){if(this.compiled)for(var e in this.uniforms){var t=this.uniforms[e];t.location=this.gl.getUniformLocation(this.program,e),this.updateUniform(t)}},t.refreshAttributes=function(){this.attribs={}},t.attribute=function(e){if(this.compiled){var t=this.attribs[e]=this.attribs[e]||{};return null!=t.location||(t.name=e,t.location=this.gl.getAttribLocation(this.program,e)),t}},t.source=function(e){return"vertex"===e?this.computed_vertex_source:"fragment"===e?this.computed_fragment_source:void 0},t.lines=function(e){var t=this.source(e);return t?t.split("\n"):[]},t.line=function(e,t){var i=this.lines(e);if(i)return i[t]},t.block=function(e,t){for(var i,r=this.lines(e),n=0;n<t&&n<r.length;n++){var o=r[n],s=o.match(/\/\/ tangram-block-start: ([A-Za-z0-9_-]+), ([A-Za-z0-9_-]+), (\d+)/);s&&s.length>1?i={scope:s[1],name:s[2],num:s[3]}:(s=o.match(/\/\/ tangram-block-end: ([A-Za-z0-9_-]+), ([A-Za-z0-9_-]+), (\d+)/))&&s.length>1&&(i=null),i&&(i.line=null==i.line?-1:i.line+1,i.source=o)}return i},t.checkExtensions=function(){var e=this,t=[];return this.extensions.forEach((function(i){var r=Zr(e.gl,i),n="TANGRAM_EXTENSION_"+i;e.defines[n]=null!=r,r?t.push(i):Ki("debug","Could not enable extension '"+i+"'")})),t},e}();Yr.id=0,Yr.current=null,Yr.defines={},Yr.blocks={},Yr.reset=function(){Yr.programs_by_source={},Yr.shaders_by_source={}},Yr.reset(),Yr.buildDefineString=function(e){var t="";for(var i in e)null!=e[i]&&!1!==e[i]&&("boolean"==typeof e[i]&&!0===e[i]?t+="#define "+i+"\n":"number"==typeof e[i]&&Math.floor(e[i])===e[i]?t+="#define "+i+" "+e[i].toFixed(1)+"\n":t+="#define "+i+" "+e[i]+"\n");return t},Yr.buildExtensionString=function(e){var t="";return(e=e||[]).forEach((function(e){t+="#ifdef GL_"+e+"\n#extension GL_"+e+" : enable\n#endif\n"})),t},Yr.addBlock=function(e){var t;Yr.blocks[e]=Yr.blocks[e]||[];for(var i=arguments.length,r=new Array(i>1?i-1:0),n=1;n<i;n++)r[n-1]=arguments[n];(t=Yr.blocks[e]).push.apply(t,r)},Yr.removeBlock=function(e){Yr.blocks[e]=[]},Yr.replaceBlock=function(e){Yr.removeBlock(e);for(var t=arguments.length,i=new Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];Yr.addBlock.apply(Yr,[e].concat(i))},Yr.updateProgram=function(e,t,i,r){var n=qr(e._tangram_id+"::"+i+"::"+r);if(Yr.programs_by_source[n])return Ki("trace","Reusing identical source GL program object"),Yr.programs_by_source[n];var o=Yr.createShader(e,i,e.VERTEX_SHADER),s=Yr.createShader(e,r,e.FRAGMENT_SHADER);if(e.useProgram(null),null!=t)for(var a=e.getAttachedShaders(t),l=0;l<a.length;l++)e.detachShader(t,a[l]);else t=e.createProgram();if(null==o||null==s)return t;if(e.attachShader(t,o),e.attachShader(t,s),e.bindAttribLocation(t,0,"a_position"),e.linkProgram(t),!e.getProgramParameter(t,e.LINK_STATUS)){var c=new Error("WebGL program error:\n            VALIDATE_STATUS: "+e.getProgramParameter(t,e.VALIDATE_STATUS)+"\n            ERROR: "+e.getError()+"\n            --- Vertex Shader ---\n            "+i+"\n            --- Fragment Shader ---\n            "+r);throw Object.assign(new Error(c),{type:"program"})}return Yr.programs_by_source[n]=t,t},Yr.createShader=function(e,t,i){var r=qr(e._tangram_id+"::"+t);if(Yr.shaders_by_source[r])return Ki("trace","Reusing identical source GL shader object"),Yr.shaders_by_source[r];var n=e.createShader(i);if(e.shaderSource(n,t),e.compileShader(n),!e.getShaderParameter(n,e.COMPILE_STATUS)){var o=i===e.VERTEX_SHADER?"vertex":"fragment",s=e.getShaderInfoLog(n),a=Kr(s);throw Object.assign(new Error(s),{type:o,errors:a})}return Yr.shaders_by_source[r]=n,n};var Jr={disabled:!1,bound_vao:[],init:function(e){var t;!0!==this.disabled&&(t=Zr(e,"OES_vertex_array_object")),null!=t?Ki("info","Vertex Array Object extension available"):!0!==this.disabled?Ki("warn","Vertex Array Object extension NOT available"):Ki("warn","Vertex Array Object extension force disabled")},getExtension:function(e,t){if(!0!==this.disabled)return Zr(e,t)},create:function(e,t,i){var r={};r.setup=t,r.teardown=i;var n=this.getExtension(e,"OES_vertex_array_object");return null!=n&&(r._vao=n.createVertexArrayOES(),n.bindVertexArrayOES(r._vao)),r.setup(),r},getCurrentBinding:function(e){var t=this.bound_vao.filter((function(t){return t[0]===e}))[0];return t&&t[1]},setCurrentBinding:function(e,t){var i=this.bound_vao,r=i.filter((function(t){return t[0]===e}))[0];null==r?i.push([e,t]):r[1]=t},bind:function(e,t){var i=this.getExtension(e,"OES_vertex_array_object");if(null!=t)null!=i&&null!=t._vao?(i.bindVertexArrayOES(t._vao),this.setCurrentBinding(e,t)):t.setup();else{var r=this.getCurrentBinding(e);null!=i?i.bindVertexArrayOES(null):null!=r&&"function"==typeof r.teardown&&r.teardown(),this.setCurrentBinding(e,null)}},destroy:function(e,t){var i=this.getExtension(e,"OES_vertex_array_object");null!=i&&null!=t&&null!=t._vao&&(i.deleteVertexArrayOES(t._vao),t._vao=null)}},en=Ue(!1);O(O.S,"Object",{values:function(e){return en(e)}});var tn,rn=Qr(6),nn="findIndex",on=!0;function sn(e){for(var t=0;t<(arguments.length<=1?0:arguments.length-1);t++){var i=t+1<1||arguments.length<=t+1?void 0:arguments[t+1];if(i)for(var r in i){var n=i[r];null===n||"object"!=typeof n||Array.isArray(n)?void 0!==n&&(e[r]=n):null===e[r]||"object"!=typeof e[r]||Array.isArray(e[r])?e[r]=sn({},n):e[r]=sn(e[r],n)}}return e}nn in[]&&Array(1)[nn]((function(){on=!1})),O(O.P+O.F*on,"Array",{findIndex:function(e){return rn(this,e,arguments.length>1?arguments[1]:void 0)}}),T(nn);var an=tn={};tn.default_source_max_zoom=18,tn.default_view_max_zoom=20,tn.max_style_zoom=25,tn.tile_size=256,tn.half_circumference_meters=20037508.342789244,tn.circumference_meters=2*tn.half_circumference_meters,tn.min_zoom_meters_per_pixel=tn.circumference_meters/tn.tile_size;var ln=[];tn.metersPerPixel=function(e){return ln[e]=ln[e]||tn.min_zoom_meters_per_pixel/Math.pow(2,e),ln[e]};var cn=[];tn.metersPerTile=function(e){return cn[e]=cn[e]||tn.circumference_meters/Math.pow(2,e),cn[e]},tn.tile_scale=4096,tn.units_per_pixel=tn.tile_scale/tn.tile_size,tn.height_scale=16;var un=[];tn.unitsPerMeter=function(e){return un[e]=un[e]||tn.tile_scale/(tn.tile_size*tn.metersPerPixel(e)),un[e]},tn.metersForTile=function(e){return{x:e.x*tn.circumference_meters/Math.pow(2,e.z)-tn.half_circumference_meters,y:-(e.y*tn.circumference_meters/Math.pow(2,e.z)-tn.half_circumference_meters)}},tn.tileForMeters=function(e,t){var i=e[0],r=e[1];return{x:Math.floor((i+tn.half_circumference_meters)/(tn.circumference_meters/Math.pow(2,t))),y:Math.floor((-r+tn.half_circumference_meters)/(tn.circumference_meters/Math.pow(2,t))),z:t}},tn.wrapTile=function(e,t){var i=e.x,r=e.y,n=e.z;void 0===t&&(t={x:!0,y:!1});var o=(1<<n)-1;return t.x&&(i&=o),t.y&&(r&=o),{x:i,y:r,z:n}},tn.metersToLatLng=function(e){return e[0]/=tn.half_circumference_meters,e[1]/=tn.half_circumference_meters,e[1]=(2*Math.atan(Math.exp(e[1]*Math.PI))-Math.PI/2)/Math.PI,e[0]*=180,e[1]*=180,e},tn.latLngToMeters=function(e){return e[1]=Math.log(Math.tan(e[1]*Math.PI/360+Math.PI/4))/Math.PI,e[1]*=tn.half_circumference_meters,e[0]*=tn.half_circumference_meters/180,e},tn.tileSpaceToLatlng=function(e,t,i){var r=tn.unitsPerMeter(t);return tn.transformGeometry(e,(function(e){e[0]=e[0]/r+i.x,e[1]=e[1]/r+i.y,tn.metersToLatLng(e)})),e},tn.copyGeometry=function(e){if(null!=e){var t={type:e.type};return"Point"===e.type?t.coordinates=[e.coordinates[0],e.coordinates[1]]:"LineString"===e.type||"MultiPoint"===e.type?t.coordinates=e.coordinates.map((function(e){return[e[0],e[1]]})):"Polygon"===e.type||"MultiLineString"===e.type?t.coordinates=e.coordinates.map((function(e){return e.map((function(e){return[e[0],e[1]]}))})):"MultiPolygon"===e.type&&(t.coordinates=e.coordinates.map((function(e){return e.map((function(e){return e.map((function(e){return[e[0],e[1]]}))}))}))),t}},tn.transformGeometry=function(e,t){null!=e&&("Point"===e.type?t(e.coordinates):"LineString"===e.type||"MultiPoint"===e.type?e.coordinates.forEach(t):"Polygon"===e.type||"MultiLineString"===e.type?e.coordinates.forEach((function(e){return e.forEach(t)})):"MultiPolygon"===e.type&&e.coordinates.forEach((function(e){e.forEach((function(e){return e.forEach(t)}))})))},tn.boxIntersect=function(e,t){return!(t.sw.x>e.ne.x||t.ne.x<e.sw.x||t.sw.y>e.ne.y||t.ne.y<e.sw.y)},tn.findBoundingBox=function(e){for(var t=1/0,i=-1/0,r=1/0,n=-1/0,o=e[0].length,s=0;s<o;s++){var a=e[0][s];a[0]<t&&(t=a[0]),a[1]<r&&(r=a[1]),a[0]>i&&(i=a[0]),a[1]>n&&(n=a[1])}return[t,r,i,n]},tn.geometryType=function(e){return"Polygon"===e||"MultiPolygon"===e?"polygon":"LineString"===e||"MultiLineString"===e?"line":"Point"===e||"MultiPoint"===e?"point":void 0},tn.centroid=function(e,t){if(void 0===t&&(t=!0),e&&0!==e.length){var i,r=0,n=0,o=0,s=e[0],a=s.length;t&&(i=s[0],s=s.map((function(e){return[e[0]-i[0],e[1]-i[1]]})));for(var l=0,c=a-1;l<a;c=l,l++){var u=s[l],h=s[c],d=u[1]*h[0]-h[1]*u[0];r+=(u[0]+h[0])*d,n+=(u[1]+h[1])*d,o+=3*d}if(o){var p=[r/o,n/o];return t&&(p[0]+=i[0],p[1]+=i[1]),p}}},tn.multiCentroid=function(e){for(var t=0,i=null,r=0;r<e.length;r++){var n=tn.centroid(e[r]);n&&((i=i||[0,0])[0]+=n[0],i[1]+=n[1],t++)}return t>0&&(i[0]/=t,i[1]/=t),i},tn.signedPolygonRingAreaSum=function(e){for(var t=0,i=e.length,r=0;r<i-1;r++){var n=e[r],o=e[r+1];t+=n[0]*o[1]-o[0]*n[1]}return t+(e[i-1][0]*e[0][1]-e[0][0]*e[i-1][1])},tn.polygonRingArea=function(e){return Math.abs(tn.signedPolygonRingAreaSum(e))/2},tn.polygonArea=function(e){if(e)return tn.polygonRingArea(e[0])},tn.multiPolygonArea=function(e){for(var t=0,i=0;i<e.length;i++)t+=tn.polygonArea(e[i]);return t},tn.ringWinding=function(e){var t=tn.signedPolygonRingAreaSum(e);return t>0?"CW":t<0?"CCW":void 0};var hn="\t\n\v\f\r \u2028\u2029\ufeff",dn="["+hn+"]",pn=RegExp("^"+dn+dn+"*"),fn=RegExp(dn+dn+"*$"),An=function(e,t,i){var r={},n=h((function(){return!!hn[e]()||""!=""[e]()})),o=r[e]=n?t(mn):hn[e];i&&(r[i]=o),O(O.P+O.F*n,"String",r)},mn=An.trim=function(e,t){return e=String(I(e)),1&t&&(e=e.replace(pn,"")),2&t&&(e=e.replace(fn,"")),e},gn=An,_n=ar.f,yn=ir.f,vn=y.f,xn=gn.trim,bn=r.Number,wn=bn,Tn=bn.prototype,Bn="Number"==E(ae(Tn)),Cn="trim"in String.prototype,Sn=function(e){var t=g(e,!1);if("string"==typeof t&&t.length>2){var i,r,n,o=(t=Cn?t.trim():xn(t,3)).charCodeAt(0);if(43===o||45===o){if(88===(i=t.charCodeAt(2))||120===i)return NaN}else if(48===o){switch(t.charCodeAt(1)){case 66:case 98:r=2,n=49;break;case 79:case 111:r=8,n=55;break;default:return+t}for(var s,a=t.slice(2),l=0,c=a.length;l<c;l++)if((s=a.charCodeAt(l))<48||s>n)return NaN;return parseInt(a,r)}}return+t};if(!bn(" 0o1")||!bn("0b1")||bn("+0x1")){bn=function(e){var t=arguments.length<1?0:e,i=this;return i instanceof bn&&(Bn?h((function(){Tn.valueOf.call(i)})):"Number"!=E(i))?or(new wn(Sn(t)),i,bn):Sn(t)};for(var En,Mn=d?_n(wn):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger".split(","),In=0;Mn.length>In;In++)F(wn,En=Mn[In])&&!F(bn,En)&&vn(bn,En,yn(wn,En));bn.prototype=Tn,Tn.constructor=bn,k(r,"Number",bn)}O(O.S,"Number",{MIN_SAFE_INTEGER:-9007199254740991});var Pn=t((function(e){var t=a("meta"),i=y.f,r=0,n=Object.isExtensible||function(){return!0},o=!h((function(){return n(Object.preventExtensions({}))})),s=function(e){i(e,t,{value:{i:"O"+ ++r,w:{}}})},l=e.exports={KEY:t,NEED:!1,fastKey:function(e,i){if(!c(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!F(e,t)){if(!n(e))return"F";if(!i)return"E";s(e)}return e[t].i},getWeak:function(e,i){if(!F(e,t)){if(!n(e))return!0;if(!i)return!1;s(e)}return e[t].w},onFreeze:function(e){return o&&l.NEED&&n(e)&&!F(e,t)&&s(e),e}}})),Ln=(Pn.KEY,Pn.NEED,Pn.fastKey,Pn.getWeak,Pn.onFreeze,Pn.onFreeze);Fi("freeze",(function(e){return function(t){return e&&c(t)?e(Ln(t)):t}}));var Fn={functions:{},num_functions:0,num_cached:0};function kn(e,t){if("string"==typeof e)e=zn(e,t);else if(null!=e&&"object"==typeof e)for(var i in e)e[i]=kn(e[i],t);return e}function zn(e,t){var i="string"==typeof e&&e.match(/^\s*function[^(]*\(([^)]*)\)\s*?\{([\s\S]*)\}$/m);if(i&&i.length>2)try{var r=i[2],n="function"==typeof t?t(r):r,o=qr(n);if(void 0===Fn.functions[o]){var s=i[1].length>0&&i[1].split(",").map((function(e){return e.trim()})).filter((function(e){return e}));s=s.length>0?s:["context"],Fn.functions[o]=new Function(s.toString(),n),Fn.functions[o].source=r,Fn.num_functions++}else Fn.num_cached++;return Fn.functions[o]}catch(t){return e}return e}var Rn=t((function(e,t){var i={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function r(e){return(e=Math.round(e))<0?0:e>255?255:e}function n(e){return e<0?0:e>1?1:e}function o(e){return"%"===e[e.length-1]?r(parseFloat(e)/100*255):r(parseInt(e))}function s(e){return"%"===e[e.length-1]?n(parseFloat(e)/100):n(parseFloat(e))}function a(e,t,i){return i<0?i+=1:i>1&&(i-=1),6*i<1?e+(t-e)*i*6:2*i<1?t:3*i<2?e+(t-e)*(2/3-i)*6:e}try{t.parseCSSColor=function(e){var t,n=e.replace(/ /g,"").toLowerCase();if(n in i)return i[n].slice();if("#"===n[0])return 4===n.length?(t=parseInt(n.substr(1),16))>=0&&t<=4095?[(3840&t)>>4|(3840&t)>>8,240&t|(240&t)>>4,15&t|(15&t)<<4,1]:null:7===n.length&&(t=parseInt(n.substr(1),16))>=0&&t<=16777215?[(16711680&t)>>16,(65280&t)>>8,255&t,1]:null;var l=n.indexOf("("),c=n.indexOf(")");if(-1!==l&&c+1===n.length){var u=n.substr(0,l),h=n.substr(l+1,c-(l+1)).split(","),d=1;switch(u){case"rgba":if(4!==h.length)return null;d=s(h.pop());case"rgb":return 3!==h.length?null:[o(h[0]),o(h[1]),o(h[2]),d];case"hsla":if(4!==h.length)return null;d=s(h.pop());case"hsl":if(3!==h.length)return null;var p=(parseFloat(h[0])%360+360)%360/360,f=s(h[1]),A=s(h[2]),m=A<=.5?A*(f+1):A+f-A*f,g=2*A-m;return[r(255*a(g,m,p+1/3)),r(255*a(g,m,p)),r(255*a(g,m,p-1/3)),d];default:return null}}return null}}catch(e){}})),Dn=(Rn.parseCSSColor,{}),On=function(e){return Math.max(e,0)},Un=function(e){return isNaN(e)?0:e},Nn=function(e){return Array.isArray(e)?e.map(parseFloat).map(Un):Un(parseFloat(e))},Qn=function(e){return Array.isArray(e)?e.map(Nn).map(On):On(Nn(e))};Object.assign(Dn,{clampPositive:On,noNaN:Un,parseNumber:Nn,parsePositiveNumber:Qn}),Dn.wrapFunction=function(e){return"\n        var feature = context.feature.properties;\n        var global = context.global;\n        var $zoom = context.zoom;\n        var $layer = context.layer;\n        var $source = context.source;\n        var $geometry = context.geometry;\n        var $meters_per_pixel = context.meters_per_pixel;\n        var $id = context.id;\n\n        var val = (function(){ "+e+" }());\n\n        if (typeof val === 'number' && isNaN(val)) {\n            val = null; // convert NaNs to nulls\n        }\n\n        return val;\n    "},Dn.zeroPair=Object.freeze([0,0]),Dn.defaults={color:[1,1,1,1],width:1,size:1,extrude:!1,height:20,min_height:0,order:0,z:0,outline:{color:[0,0,0,0],width:0},material:{ambient:1,diffuse:1}},Dn.macros={"Style.color.pseudoRandomColor":function(){return[parseInt(feature.id,16)/100%1*.7,parseInt(feature.id,16)/1e4%1*.7,parseInt(feature.id,16)/1e6%1*.7,1]},"Style.color.randomColor":function(){return[.7*Math.random(),.7*Math.random(),.7*Math.random(),1]}},Dn.getFeatureParseContext=function(e,t,i){return{feature:e,id:e.id,tile:t,global:i,zoom:t.style_z,geometry:an.geometryType(e.geometry.type),meters_per_pixel:t.meters_per_pixel,meters_per_pixel_sq:t.meters_per_pixel_sq,units_per_meter_overzoom:t.units_per_meter_overzoom}};var jn={STATIC:0,DYNAMIC:1,ZOOM:2};Dn.CACHE_TYPE=jn,Dn.createPropertyCache=function(e,t,i){if(void 0===t&&(t=null),void 0===i&&(i=null),null!=e){if(e.value)return{value:e.value,zoom:e.zoom?{}:null,type:e.type};var r={value:e,type:jn.STATIC};return Array.isArray(r.value)&&Array.isArray(r.value[0])?(r.zoom={},r.type=jn.ZOOM):"function"==typeof r.value&&(r.type=jn.DYNAMIC,r.dynamic_transform="function"==typeof i?i:null),"function"==typeof t&&(r.zoom?r.value=r.value.map((function(e,i){return[e[0],t(e[1],i)]})):"function"!=typeof r.value&&(r.value=t(r.value,0))),r}},Dn.createColorPropertyCache=function(e){return Dn.createPropertyCache(e,(function(e){return"Style.color.pseudoRandomColor"===e?zn(Dn.wrapFunction(Dn.macros["Style.color.pseudoRandomColor"])):"Style.color.randomColor"===e?Dn.macros["Style.color.randomColor"]:e}))};var Vn=function(e){return"string"==typeof e&&"%"===e[e.length-1]},Hn=function(e){return"auto"===e},Gn=function(e){return Vn(e)||Hn(e)},$n="'size' can specify either width or height as derived from aspect ratio, but not both";function Zn(e,t){return Dn.createPropertyCache(e.value,(function(i,r){return Array.isArray(i)?(i=i.map((function(t,i){return e.has_ratio[r][i]?t:Qn(t)})).map((function(i,n){return e.has_pct[r][n]?t.css_size[n]*i/100:i})),e.has_ratio[r][0]?i[0]=i[1]*t.aspect:e.has_ratio[r][1]&&(i[1]=i[0]/t.aspect)):(i=Qn(i),i=e.has_pct[r]?t.css_size.map((function(e){return e*i/100})):[i,i]),i}))}function qn(e,t){try{return e(t)}catch(i){Ki("warn","Property function in layer '"+t.layers[t.layers.length-1]+"' failed with\n","error "+i.stack+"\n","function '"+e.source+"'\n",t.feature,t)}}Dn.createPointSizePropertyCache=function(e,t){var i=null,r=null;if(Vn(e))i=[!0];else if(Array.isArray(e)){if(Array.isArray(e[0])){if(e.some((function(e){return Array.isArray(e[1])?e[1].some((function(e){return Gn(e)})):Vn(e[1])}))&&(i=e.map((function(e){return Array.isArray(e[1])?e[1].map((function(e){return Vn(e)})):Vn(e[1])})),(r=e.map((function(e){return Array.isArray(e[1])&&e[1].map((function(e){return Hn(e)}))}))).some((function(e){return Array.isArray(e)&&e.every((function(e){return e}))}))))throw $n}else if(e.some(Gn)&&(i=[e.map(Vn)],(r=[e.map(Hn)])[0].every((function(e){return e}))))throw $n}else if(Hn(e))throw"this value only allowed as half of an array, eg [16px, auto]:";if(i||r){if(!t)throw"% or 'auto' keywords can only be used to specify point size when a texture is defined";(e={value:e}).has_pct=i,e.has_ratio=r,e.sprites={}}else e=Dn.createPropertyCache(e,Qn);return e},Dn.evalCachedPointSizeProperty=function(e,t,i,r){if(null!=e)return e.has_pct||e.has_ratio?t?(e.sprites[t.sprite]||(e.sprites[t.sprite]=Zn(e,t)),Dn.evalCachedProperty(e.sprites[t.sprite],r)):(e.texture=e.texture||Zn(e,i),Dn.evalCachedProperty(e.texture,r)):Dn.evalCachedProperty(e,r)},Dn.evalCachedProperty=function(e,t){return null==e?void 0:e.dynamic?qn(e.dynamic,t):e.static?e.static:e.zoom&&e.zoom[t.zoom]?e.zoom[t.zoom]:"function"==typeof e.value?(e.dynamic_transform?e.dynamic=function(t){return e.dynamic_transform(e.value(t))}:e.dynamic=e.value,qn(e.dynamic,t)):Array.isArray(e.value)&&Array.isArray(e.value[0])?(e.zoom=e.zoom||{},e.zoom[t.zoom]=Ji.interpolate(t.zoom,e.value),e.zoom[t.zoom]):(e.static=e.value,e.static)},Dn.convertUnits=function(e,t){if(null!=e.value)return"px"===e.units?e.value*an.metersPerPixel(t.zoom):e.value;if("string"==typeof e)"px"===e.trim().slice(-2)?(e=Nn(e),e*=an.metersPerPixel(t.zoom)):e=Nn(e);else if(Array.isArray(e))return Array.isArray(e[0])?e.map((function(e){return[e[0],Dn.convertUnits(e[1],t)]})):e.map((function(e){return Dn.convertUnits(e,t)}));return e},Dn.parseUnits=function(e){var t={value:Nn(e)};return 0!==t.value&&"string"==typeof e&&"px"===e.trim().slice(-2)&&(t.units="px"),t},Dn.evalCachedDistanceProperty=function(e,t){return null==e?void 0:e.dynamic?qn(e.dynamic,t):e.zoom&&e.zoom[t.zoom]?e.zoom[t.zoom]:"function"==typeof e.value?(e.dynamic=e.value,qn(e.dynamic,t)):e.zoom?(e.zoom[t.zoom]=Ji.interpolate(t.zoom,e.value,(function(e){return Dn.convertUnits(e,t)})),e.zoom[t.zoom]):Dn.convertUnits(e.value,t)},Dn.string_colors={},Dn.colorForString=function(e){if(Dn.string_colors[e])return Dn.string_colors[e];var t=Rn.parseCSSColor(e);return t&&4===t.length?(t[0]/=255,t[1]/=255,t[2]/=255):t=Dn.defaults.color,Dn.string_colors[e]=t,t},Dn.evalCachedColorProperty=function(e,t){if(void 0===t&&(t={}),null!=e){if(e.dynamic){var i=qn(e.dynamic,t);return"string"==typeof i&&(i=Dn.colorForString(i)),i&&null==i[3]&&(i[3]=1),i}if(e.static)return e.static;if(e.zoom&&e.zoom[t.zoom])return e.zoom[t.zoom];if("function"==typeof e.value){e.dynamic=e.value;var r=qn(e.dynamic,t);return"string"==typeof r&&(r=Dn.colorForString(r)),r&&null==r[3]&&(r[3]=1),r}if("string"==typeof e.value)return e.static=Dn.colorForString(e.value),e.static;if(e.zoom){if(!e.zoom_preprocessed){for(var n=0;n<e.value.length;n++){var o=e.value[n];o&&"string"==typeof o[1]&&(o[1]=Dn.colorForString(o[1]))}e.zoom_preprocessed=!0}return e.zoom[t.zoom]=Ji.interpolate(t.zoom,e.value),e.zoom[t.zoom][3]=e.zoom[t.zoom][3]||1,e.zoom[t.zoom]}return e.static=e.value.map((function(e){return e})),e.static&&null==e.static[3]&&(e.static[3]=1),e.static}},Dn.evalCachedColorPropertyWithAlpha=function(e,t,i){var r=Dn.evalCachedColorProperty(e,i);if(null!=r&&null!=t){var n=Dn.evalCachedProperty(t,i);if(null!=n)return[r[0],r[1],r[2],n]}return r},Dn.parseColor=function(e,t){if(void 0===t&&(t={}),"function"==typeof e&&(e=qn(e,t)),"string"==typeof e)e=Dn.colorForString(e);else if(Array.isArray(e)&&Array.isArray(e[0])){for(var i=0;i<e.length;i++){var r=e[i];"string"==typeof r[1]&&(r[1]=Dn.colorForString(r[1]))}t.zoom&&(e=Ji.interpolate(t.zoom,e))}return Array.isArray(e)?null==(e=e.map((function(e){return e})))[3]&&(e[3]=1):e=[0,0,0,1],e},Dn.calculateOrder=function(e,t){return"function"==typeof e?e=qn(e,t):"string"==typeof e&&(e=t.feature.properties[e]?t.feature.properties[e]:Qn(e)),e},Dn.evalProperty=function(e,t){return"function"==typeof e?qn(e,t):e},O(O.P,"Array",{fill:Rr}),T("fill");var Kn,Wn=function(){function e(e,t,i){this.gl=e,this.workers=t,this._lock_fn="function"==typeof i&&i,this.init()}var t=e.prototype;return t.init=function(){this.requests={},this.feature=null,this.read_delay=0,this.read_delay_timer=null,this.pixels=null,this.fbo=this.gl.createFramebuffer(),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.fbo),this.fbo_size={width:256,height:256};var e=Hr.create(this.gl,"__selection_fbo",{filtering:"nearest"});e.setData(this.fbo_size.width,this.fbo_size.height,null,{filtering:"nearest"}),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,e.texture,0);var t=this.gl.createRenderbuffer();this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,t),this.gl.renderbufferStorage(this.gl.RENDERBUFFER,this.gl.DEPTH_COMPONENT16,this.fbo_size.width,this.fbo_size.height),this.gl.framebufferRenderbuffer(this.gl.FRAMEBUFFER,this.gl.DEPTH_ATTACHMENT,this.gl.RENDERBUFFER,t),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null)},t.destroy=function(){this.gl&&this.fbo&&(this.gl.deleteFramebuffer(this.fbo),this.fbo=null,this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null))},t.bind=function(){var t;this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.fbo),this.gl.viewport(0,0,this.fbo_size.width,this.fbo_size.height),(t=this.gl).clearColor.apply(t,e.defaultColor)},t.getFeatureAt=function(e,t){var i=this,r=t.radius;return!e||e.x<0||e.y<0||e.x>1||e.y>1?Promise.resolve({feature:null,changed:!1}):new Promise((function(t,n){i.selection_request_id=i.selection_request_id+1||0,i.requests[i.selection_request_id]={id:i.selection_request_id,point:e,radius:r,resolve:t,reject:n}}))},t.pendingRequests=function(){return Object.keys(this.requests).length?this.requests:null},t.hasPendingRequests=function(){return null!=this.pendingRequests()},t.clearPendingRequests=function(){for(var e in this.requests){var t=this.requests[e];t.sent||(t.reject({request:t}),delete this.requests[e])}},t.read=function(){var e=this;null!=this.read_delay_timer&&clearTimeout(this.read_delay_timer),this.read_delay_timer=setTimeout((function(){if(!e.locked){var t=e.gl;for(var i in t.bindFramebuffer(t.FRAMEBUFFER,e.fbo),e.requests){var r=e.requests[i];if(!r.sent){var n=void 0,o=255,s=r.point,a=r.radius,l=void 0;if(a){var c=Math.min(e.fbo_size.width,e.fbo_size.height);l={x:Math.min(Math.ceil(2*a.x*e.fbo_size.width),c),y:Math.min(Math.ceil(2*a.y*e.fbo_size.height),c)}}else a={x:0,y:0},l={x:1,y:1};if((null==e.pixels||e.pixels.byteLength<l.x*l.y*4)&&(e.pixels=new Uint8Array(l.x*l.y*4)),e.pixels.fill instanceof Function)e.pixels.fill(0);else for(var u=0;u<e.pixels.length;u++)e.pixels[u]=0;t.readPixels(Math.round((s.x-a.x)*e.fbo_size.width),Math.round((1-s.y-a.y)*e.fbo_size.height),l.x,l.y,t.RGBA,t.UNSIGNED_BYTE,e.pixels);var h=4*(Math.round(l.y/2)*l.x+Math.round(l.x/2)),d=e.pixels[h]+(e.pixels[h+1]<<8)+(e.pixels[h+2]<<16);if(d>0)n=d+(e.pixels[h+3]<<24)>>>0,o=e.pixels[h+3];else{var p=-1>>>0;h=0;for(var f=0;f<l.y;f++)for(var A=0;A<l.x;A++,h+=4)if((d=e.pixels[h]+(e.pixels[h+1]<<8)+(e.pixels[h+2]<<16))>0){var m=(A-l.x/2)*(A-l.x/2)+(f-l.y/2)*(f-l.y/2);m<=p&&(n=d+(e.pixels[h+3]<<24)>>>0,o=e.pixels[h+3],p=m)}}255!==o?null!=e.workers[o]&&Qi.postMessage(e.workers[o],"self.getFeatureSelection",{id:r.id,key:n}).then((function(t){e.finishRead(t)})):e.finishRead({id:r.id}),r.sent=!0}}t.bindFramebuffer(t.FRAMEBUFFER,null)}}),this.read_delay)},t.finishRead=function(e){var t=this.requests[e.id];if(t){var i=e.feature,r=!1;(null!=i&&null==this.feature||null==i&&null!=this.feature||null!=i&&null!=this.feature&&JSON.stringify(i)!==JSON.stringify(this.feature))&&(r=!0),this.feature=i,t.resolve({feature:i,changed:r,request:t}),delete this.requests[e.id]}else Ki("error","FeatureSelection.finishRead(): could not find message",e)},e.makeEntry=function(e){this.map_entry++;var t=255&this.map_entry,i=this.map_entry>>8&255,r=this.map_entry>>16&255,n=this.map_prefix,o=t/255,s=i/255,a=r/255,l=n/255,c=t+(i<<8)+(r<<16)+(n<<24)>>>0;return this.map[c]={color:[o,s,a,l]},this.map_size++,this.tiles[e.key]||(this.tiles[e.key]={entries:[],tile:{key:e.key,coords:e.coords,style_z:e.style_z,source:e.source,generation:e.generation}}),this.tiles[e.key].entries.push(c),this.map[c]},e.makeColor=function(e,t,i){var r=this.makeEntry(t);return r.feature={id:e.id,properties:e.properties,source_name:i.source,source_layer:i.layer,layers:i.layers,tile:this.tiles[t.key].tile},r.color},e.reset=function(e){var t=this;Array.isArray(e)?e.forEach((function(e){return t.clearSource(e)})):(this.tiles={},this.map={},this.map_size=0,this.map_entry=0)},e.clearSource=function(e){for(var t in this.tiles)this.tiles[t].tile.source===e&&this.clearTile(t)},e.clearTile=function(e){var t=this;this.tiles[e]&&(this.tiles[e].entries.forEach((function(e){return delete t.map[e]})),this.map_size-=this.tiles[e].entries.length,delete this.tiles[e])},e.getMapSize=function(){return this.map_size},e.setPrefix=function(e){this.map_prefix=e},pt(e,[{key:"locked",get:function(){return this._lock_fn&&this._lock_fn()||!1}}]),e}();Wn.map={},Wn.tiles={},Wn.map_size=0,Wn.map_entry=0,Wn.map_prefix=0,Wn.defaultColor=[0,0,0,1];var Xn=Kn={};Kn.BYTE=5120,Kn.UNSIGNED_BYTE=5121,Kn.SHORT=5122,Kn.UNSIGNED_SHORT=5123,Kn.INT=5124,Kn.UNSIGNED_INT=5125,Kn.FLOAT=5126,Vr("Uint16",2,(function(e){return function(t,i,r){return e(this,t,i,r)}}));var Yn=function(){function e(e,t,i,r,n){n=n||{},this.gl=e,this.vertex_data=t,this.element_data=i,this.vertex_layout=r,this.vertex_buffer=this.gl.createBuffer(),this.buffer_size=this.vertex_data.byteLength,this.draw_mode=n.draw_mode||this.gl.TRIANGLES,this.data_usage=n.data_usage||this.gl.STATIC_DRAW,this.vertices_per_geometry=3,this.uniforms=n.uniforms,this.textures=n.textures,this.retain=n.retain||!1,this.created_at=+new Date,this.fade_in_time=n.fade_in_time||0,this.vertex_count=this.vertex_data.byteLength/this.vertex_layout.stride,this.element_count=0,this.vaos={},this.toggle_element_array=!1,this.element_data?(this.toggle_element_array=!0,this.element_count=this.element_data.length,this.geometry_count=this.element_count/this.vertices_per_geometry,this.element_type=this.element_data.constructor===Uint16Array?this.gl.UNSIGNED_SHORT:this.gl.UNSIGNED_INT,this.element_buffer=this.gl.createBuffer(),this.buffer_size+=this.element_data.byteLength,this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.element_buffer),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,this.element_data,this.data_usage)):this.geometry_count=this.vertex_count/this.vertices_per_geometry,this.upload(),this.retain||(delete this.vertex_data,delete this.element_data),this.valid=!0}var t=e.prototype;return t.render=function(e){if(void 0===e&&(e={}),!this.valid)return!1;var t=e.program||Yr.current;t.use(),this.uniforms&&(t.saveUniforms(this.uniforms),t.setUniforms(this.uniforms,!1));var i=(+new Date-this.created_at)/1e3;return t.uniform("1f","u_visible_time",i),this.bind(t),this.toggle_element_array?this.gl.drawElements(this.draw_mode,this.element_count,this.element_type,0):this.gl.drawArrays(this.draw_mode,0,this.vertex_count),Jr.bind(this.gl,null),this.uniforms&&t.restoreUniforms(this.uniforms),i<this.fade_in_time},t.bind=function(e){var t=this,i=this.vaos[e.id];i?Jr.bind(this.gl,i):this.vaos[e.id]=Jr.create(this.gl,(function(){t.gl.bindBuffer(t.gl.ARRAY_BUFFER,t.vertex_buffer),t.toggle_element_array&&t.gl.bindBuffer(t.gl.ELEMENT_ARRAY_BUFFER,t.element_buffer),t.vertex_layout.enableDynamicAttributes(t.gl,e)})),this.vertex_layout.enableStaticAttributes(this.gl,e)},t.upload=function(){this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertex_buffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,this.vertex_data,this.data_usage)},t.destroy=function(){if(!this.valid)return!1;for(var e in this.valid=!1,this.vaos)Jr.destroy(this.gl,this.vaos[e]);return this.gl.deleteBuffer(this.vertex_buffer),this.vertex_buffer=null,this.element_buffer&&(this.gl.deleteBuffer(this.element_buffer),this.element_buffer=null),delete this.vertex_data,delete this.element_data,this.textures&&this.textures.forEach((function(e){return Hr.release(e)})),!0},e}(),Jn=["emission","ambient","diffuse","specular"],eo=function(){function e(e){var t=this;e=e||{},Jn.forEach((function(i){var r=e[i];null!=r&&(r.texture?t[i]={texture:r.texture,mapping:r.mapping||"spheremap",scale:Gr.expandVec3(null!=r.scale?r.scale:1),amount:Gr.expandVec4(null!=r.amount?r.amount:1)}:"number"==typeof r||Array.isArray(r)?t[i]={amount:Gr.expandVec4(r)}:t[i]="string"==typeof r?{amount:Dn.parseColor(r)}:r)})),this.specular&&(this.specular.shininess=e.shininess?parseFloat(e.shininess):.2),null!=e.normal&&(this.normal={texture:e.normal.texture,mapping:e.normal.mapping||"triplanar",scale:Gr.expandVec3(null!=e.normal.scale?e.normal.scale:1),amount:null!=e.normal.amount?e.normal.amount:1})}e.isValid=function(e){return null!=e&&(null!=e.emission||null!=e.ambient||null!=e.diffuse||null!=e.specular)};var t=e.prototype;return t.inject=function(t){var i=this;Jn.forEach((function(e){var r="TANGRAM_MATERIAL_"+e.toUpperCase(),n=r+"_TEXTURE";t.defines[r]=null!=i[e],i[e]&&i[e].texture&&(t.defines[n]=!0,t.defines[n+"_"+i[e].mapping.toUpperCase()]=!0,t.defines["TANGRAM_MATERIAL_TEXTURE_"+i[e].mapping.toUpperCase()]=!0,t.texcoords=t.texcoords||"uv"===i[e].mapping)})),this.normal&&this.normal.texture&&(t.defines.TANGRAM_MATERIAL_NORMAL_TEXTURE=!0,t.defines["TANGRAM_MATERIAL_NORMAL_TEXTURE_"+this.normal.mapping.toUpperCase()]=!0,t.defines["TANGRAM_MATERIAL_TEXTURE_"+this.normal.mapping.toUpperCase()]=!0,t.texcoords=t.texcoords||"uv"===this.normal.mapping),t.replaceShaderBlock(e.block,"/*\n\nDefines globals:\nmaterial\nlight_accumulator_*\n\n*/\n\n\n// MATERIALS\n//\nstruct Material {\n    #ifdef TANGRAM_MATERIAL_EMISSION\n        vec4 emission;\n        #ifdef TANGRAM_MATERIAL_EMISSION_TEXTURE\n            vec3 emissionScale;\n        #endif\n    #endif\n\n    #ifdef TANGRAM_MATERIAL_AMBIENT\n        vec4 ambient;\n        #ifdef TANGRAM_MATERIAL_AMBIENT_TEXTURE\n            vec3 ambientScale;\n        #endif\n    #endif\n\n    #ifdef TANGRAM_MATERIAL_DIFFUSE\n        vec4 diffuse;\n        #ifdef TANGRAM_MATERIAL_DIFFUSE_TEXTURE\n            vec3 diffuseScale;\n        #endif\n    #endif\n\n    #ifdef TANGRAM_MATERIAL_SPECULAR\n        vec4 specular;\n        float shininess;\n        #ifdef TANGRAM_MATERIAL_SPECULAR_TEXTURE\n            vec3 specularScale;\n        #endif\n    #endif\n\n\n    #ifdef TANGRAM_MATERIAL_NORMAL_TEXTURE\n        vec3 normalScale;\n        float normalAmount;\n    #endif\n};\n\n// Note: uniform is copied to a global instance to allow modification\nuniform Material u_material;\nMaterial material;\n\n#ifdef TANGRAM_MATERIAL_EMISSION_TEXTURE\nuniform sampler2D u_material_emission_texture;\n#endif\n\n#ifdef TANGRAM_MATERIAL_AMBIENT_TEXTURE\nuniform sampler2D u_material_ambient_texture;\n#endif\n\n#ifdef TANGRAM_MATERIAL_DIFFUSE_TEXTURE\nuniform sampler2D u_material_diffuse_texture;\n#endif\n\n#ifdef TANGRAM_MATERIAL_SPECULAR_TEXTURE\nuniform sampler2D u_material_specular_texture;\n#endif\n\n#ifdef TANGRAM_MATERIAL_NORMAL_TEXTURE\nuniform sampler2D u_material_normal_texture;\n#endif\n\n// Global light accumulators for each property\nvec4 light_accumulator_ambient = vec4(vec3(0.0), 1.);\nvec4 light_accumulator_diffuse = vec4(vec3(0.0), 1.);\n#ifdef TANGRAM_MATERIAL_SPECULAR\n    vec4 light_accumulator_specular = vec4(vec3(0.0), 1.);\n#endif\n\n\n#ifdef TANGRAM_MATERIAL_TEXTURE_SPHEREMAP\nvec4 getSphereMap (in sampler2D _tex, in vec3 _eyeToPoint, in vec3 _normal, in vec2 _skew) {\n    // Normalized vector from camera to surface\n    vec3 eye = normalize(_eyeToPoint);\n\n    // Adjust for camera skew\n    eye.xy -= _skew;\n    eye = normalize(eye);\n\n    // Reflection of eye off of surface normal\n    vec3 r = reflect(eye, _normal);\n\n    // Map reflected vector onto the surface of a sphere\n    r.z += 1.0;\n    float m = 2. * length(r);\n\n    // Adjust xy to account for spherical shape, and center in middle of texture\n    vec2 uv = r.xy / m + .5;\n\n    // Sample the environment map\n    return texture2D(_tex, uv);\n}\n#endif\n\n\n#ifdef TANGRAM_MATERIAL_TEXTURE_TRIPLANAR\nvec3 getTriPlanarBlend (in vec3 _normal) {\n    vec3 blending = abs(_normal);\n    blending = normalize(max(blending, 0.00001));\n    float b = (blending.x + blending.y + blending.z);\n    return blending / b;\n}\n\nvec4 getTriPlanar (in sampler2D _tex, in vec3 _pos, in vec3 _normal, in vec3 _scale) {\n    vec3 blending = getTriPlanarBlend(_normal);\n    vec4 xaxis = texture2D(_tex, fract(_pos.yz * _scale.x));\n    vec4 yaxis = texture2D(_tex, fract(_pos.xz * _scale.y));\n    vec4 zaxis = texture2D(_tex, fract(_pos.xy * _scale.z));\n    return  xaxis * blending.x + yaxis * blending.y + zaxis * blending.z;\n}\n#endif\n\n\n#ifdef TANGRAM_MATERIAL_TEXTURE_PLANAR\nvec4 getPlanar (in sampler2D _tex, in vec3 _pos, in vec2 _scale) {\n    return texture2D( _tex, fract(_pos.xy * _scale.x) );\n}\n#endif\n\n\n#ifdef TANGRAM_MATERIAL_NORMAL_TEXTURE\nvoid calculateNormal (inout vec3 _normal) {\n    // Get NORMALMAP\n    //------------------------------------------------\n    #ifdef TANGRAM_MATERIAL_NORMAL_TEXTURE_UV\n    _normal += texture2D(u_material_normal_texture, fract(v_texcoord*material.normalScale.xy)).rgb*2.0-1.0;\n    #endif\n\n    #ifdef TANGRAM_MATERIAL_NORMAL_TEXTURE_PLANAR\n    vec3 normalTex = getPlanar(u_material_normal_texture, v_world_position.xyz, material.normalScale.xy).rgb*2.0-1.0;\n    _normal += normalTex;\n    #endif\n\n    #ifdef TANGRAM_MATERIAL_NORMAL_TEXTURE_TRIPLANAR\n    vec3 normalTex = getTriPlanar(u_material_normal_texture, v_world_position.xyz, _normal, material.normalScale).rgb*2.0-1.0;\n    _normal += normalTex;\n    #endif\n\n    _normal = normalize(_normal);\n}\n#endif\n\nvoid calculateMaterial (in vec3 _eyeToPoint, inout vec3 _normal) {\n    // get EMISSION TEXTUREMAP\n    //------------------------------------------------\n    #ifdef TANGRAM_MATERIAL_EMISSION_TEXTURE\n        #ifdef TANGRAM_MATERIAL_EMISSION_TEXTURE_UV\n        material.emission *= texture2D(u_material_emission_texture,v_texcoord);\n        #endif\n\n        #ifdef TANGRAM_MATERIAL_EMISSION_TEXTURE_PLANAR\n        material.emission *= getPlanar(u_material_emission_texture, v_world_position.xyz, material.emissionScale.xy);\n        #endif\n\n        #ifdef TANGRAM_MATERIAL_EMISSION_TEXTURE_TRIPLANAR\n        material.emission *= getTriPlanar(u_material_emission_texture, v_world_position.xyz, _normal, material.emissionScale);\n        #endif\n\n        #ifdef TANGRAM_MATERIAL_EMISSION_TEXTURE_SPHEREMAP\n        material.emission *= getSphereMap(u_material_emission_texture, _eyeToPoint, _normal, u_vanishing_point);\n        #endif\n    #endif\n\n    // get AMBIENT TEXTUREMAP\n    //------------------------------------------------\n    #ifdef TANGRAM_MATERIAL_AMBIENT_TEXTURE\n        #ifdef TANGRAM_MATERIAL_AMBIENT_TEXTURE_UV\n        material.ambient *= texture2D(u_material_ambient_texture,v_texcoord);\n        #endif\n\n        #ifdef TANGRAM_MATERIAL_AMBIENT_TEXTURE_PLANAR\n        material.ambient *= getPlanar(u_material_ambient_texture, v_world_position.xyz, material.ambientScale.xy);\n        #endif\n\n        #ifdef TANGRAM_MATERIAL_AMBIENT_TEXTURE_TRIPLANAR\n        material.ambient *= getTriPlanar(u_material_ambient_texture, v_world_position.xyz, _normal, material.ambientScale);\n        #endif\n\n        #ifdef TANGRAM_MATERIAL_AMBIENT_TEXTURE_SPHEREMAP\n        material.ambient *= getSphereMap(u_material_ambient_texture, _eyeToPoint, _normal, u_vanishing_point);\n        #endif\n    #endif\n\n    // get DIFFUSE TEXTUREMAP\n    //------------------------------------------------\n    #ifdef TANGRAM_MATERIAL_DIFFUSE_TEXTURE\n        #ifdef TANGRAM_MATERIAL_DIFFUSE_TEXTURE_UV\n        material.diffuse *= texture2D(u_material_diffuse_texture,v_texcoord);\n        #endif\n\n        #ifdef TANGRAM_MATERIAL_DIFFUSE_TEXTURE_PLANAR\n        material.diffuse *= getPlanar(u_material_diffuse_texture, v_world_position.xyz, material.diffuseScale.xy);\n        #endif\n\n        #ifdef TANGRAM_MATERIAL_DIFFUSE_TEXTURE_TRIPLANAR\n        material.diffuse *= getTriPlanar(u_material_diffuse_texture, v_world_position.xyz, _normal, material.diffuseScale);\n        #endif\n\n        #ifdef TANGRAM_MATERIAL_DIFFUSE_TEXTURE_SPHEREMAP\n        material.diffuse *= getSphereMap(u_material_diffuse_texture, _eyeToPoint, _normal, u_vanishing_point);\n        #endif\n    #endif\n\n    // get SPECULAR TEXTUREMAP\n    //------------------------------------------------\n    #ifdef TANGRAM_MATERIAL_SPECULAR_TEXTURE\n        #ifdef TANGRAM_MATERIAL_SPECULAR_TEXTURE_UV\n        material.specular *= texture2D(u_material_specular_texture,v_texcoord);\n        #endif\n\n        #ifdef TANGRAM_MATERIAL_SPECULAR_TEXTURE_PLANAR\n        material.specular *= getPlanar(u_material_specular_texture, v_world_position.xyz, material.specularScale.xy);\n        #endif\n\n        #ifdef TANGRAM_MATERIAL_SPECULAR_TEXTURE_TRIPLANAR\n        material.specular *= getTriPlanar(u_material_specular_texture, v_world_position.xyz, _normal, material.specularScale);\n        #endif\n\n        #ifdef TANGRAM_MATERIAL_SPECULAR_TEXTURE_SPHEREMAP\n        material.specular *= getSphereMap(u_material_specular_texture, _eyeToPoint, _normal, u_vanishing_point);\n        #endif\n    #endif\n}\n","Material"),t.addShaderBlock("setup","\nmaterial = u_material;\n","Material")},t.setupProgram=function(e){var t=this;Jn.forEach((function(i){t[i]&&(t[i].texture?(e.setTextureUniform("u_material_"+i+"_texture",t[i].texture),e.uniform("3fv","u_material."+i+"Scale",t[i].scale),e.uniform("4fv","u_material."+i,t[i].amount)):t[i].amount&&e.uniform("4fv","u_material."+i,t[i].amount))})),this.specular&&e.uniform("1f","u_material.shininess",this.specular.shininess),this.normal&&this.normal.texture&&(e.setTextureUniform("u_material_normal_texture",this.normal.texture),e.uniform("3fv","u_material.normalScale",this.normal.scale),e.uniform("1f","u_material.normalAmount",this.normal.amount))},e}();eo.block="material";var to,io=/"/g,ro=function(e,t,i,r){var n=String(I(e)),o="<"+t;return""!==i&&(o+=" "+i+'="'+String(r).replace(io,"&quot;")+'"'),o+">"+n+"</"+t+">"},no=function(e,t){var i={};i[e]=t(ro),O(O.P+O.F*h((function(){var t=""[e]('"');return t!==t.toLowerCase()||t.split('"').length>3})),"String",i)};no("sub",(function(e){return function(){return e(this,"sub","","")}}));var oo=to={};to.copy=function(e){for(var t=[],i=e.length,r=0;r<i;r++)t[r]=e[r];return t},to.neg=function(e){for(var t=[],i=e.length,r=0;r<i;r++)t[r]=-e[r];return t},to.add=function(e,t){for(var i=[],r=Math.min(e.length,t.length),n=0;n<r;n++)i[n]=e[n]+t[n];return i},to.sub=function(e,t){for(var i=[],r=Math.min(e.length,t.length),n=0;n<r;n++)i[n]=e[n]-t[n];return i},to.signed_area=function(e,t,i){return(t[0]-e[0])*(i[1]-e[1])-(i[0]-e[0])*(t[1]-e[1])},to.mult=function(e,t){var i,r=[],n=e.length;if("number"==typeof t)for(i=0;i<n;i++)r[i]=e[i]*t;else for(n=Math.min(e.length,t.length),i=0;i<n;i++)r[i]=e[i]*t[i];return r},to.div=function(e,t){var i,r=[];if("number"==typeof t)for(i=0;i<e.length;i++)r[i]=e[i]/t;else{var n=Math.min(e.length,t.length);for(i=0;i<n;i++)r[i]=e[i]/t[i]}return r},to.perp=function(e,t){return[t[1]-e[1],e[0]-t[0]]},to.rot=function(e,t){var i=Math.cos(t),r=Math.sin(t);return[e[0]*i-e[1]*r,e[0]*r+e[1]*i]},to.angle=function(e){var t=e[0],i=e[1];return Math.atan2(i,t)},to.angleBetween=function(e,t){var i=to.dot(to.normalize(to.copy(e)),to.normalize(to.copy(t)));return i>1&&(i=1),Math.acos(i)},to.isEqual=function(e,t){for(var i=e.length,r=0;r<i;r++)if(e[r]!==t[r])return!1;return!0},to.lengthSq=function(e){return 2===e.length?e[0]*e[0]+e[1]*e[1]:e.length>=3?e[0]*e[0]+e[1]*e[1]+e[2]*e[2]:0},to.length=function(e){return Math.sqrt(to.lengthSq(e))},to.normalize=function(e){var t;if(2===e.length){if(1==(t=e[0]*e[0]+e[1]*e[1]))return e;0!==(t=Math.sqrt(t))?(e[0]/=t,e[1]/=t):(e[0]=0,e[1]=0)}else if(e.length>=3){if(1==(t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2]))return e;0!==(t=Math.sqrt(t))?(e[0]/=t,e[1]/=t,e[2]/=t):(e[0]=0,e[1]=0,e[2]=0)}return e},to.cross=function(e,t){return 2===e.length?e[0]*t[1]-e[1]*t[0]:3===e.length?[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]:void 0},to.dot=function(e,t){for(var i=0,r=Math.min(e.length,t.length),n=0;n<r;n++)i+=e[n]*t[n];return i};var so=function(){function e(e,t){this.name=t.name,this.view=e,null==t.ambient||"number"==typeof t.ambient?this.ambient=Gr.expandVec3(t.ambient||0):this.ambient=Dn.parseColor(t.ambient).slice(0,3),null==t.diffuse||"number"==typeof t.diffuse?this.diffuse=Gr.expandVec3(null!=t.diffuse?t.diffuse:1):this.diffuse=Dn.parseColor(t.diffuse).slice(0,3),null==t.specular||"number"==typeof t.specular?this.specular=Gr.expandVec3(t.specular||0):this.specular=Dn.parseColor(t.specular).slice(0,3)}e.create=function(t,i){if(e.types[i.type])return new e.types[i.type](t,i)},e.setMode=function(t,i){!0===t&&(t="fragment"),t=e.enabled&&(null!=t?t:"fragment"),i.defines.TANGRAM_LIGHTING_FRAGMENT="fragment"===t,i.defines.TANGRAM_LIGHTING_VERTEX="vertex"===t},e.inject=function(t){if(Yr.removeBlock(e.block),e.enabled){var i="";if(t&&Object.keys(t).length>0){var r={};for(var n in t)r[t[n].type]=!0;for(var o in r)e.types[o].inject();for(var s in t)t[s].inject(),i+="calculateLight("+s+", _eyeToPoint, _normal);\n"}var a="\n            vec4 calculateLighting(in vec3 _eyeToPoint, in vec3 _normal, in vec4 _color) {\n\n                // Do initial material calculations over normal, emission, ambient, diffuse and specular values\n                calculateMaterial(_eyeToPoint,_normal);\n\n                // Un roll the loop of individual ligths to calculate\n                "+i+"\n\n                //  Final light intensity calculation\n                vec4 color = vec4(vec3(0.), _color.a); // start with vertex color alpha\n\n                #ifdef TANGRAM_MATERIAL_EMISSION\n                    color.rgb = material.emission.rgb;\n                    color.a *= material.emission.a;\n                #endif\n\n                #ifdef TANGRAM_MATERIAL_AMBIENT\n                    color.rgb += light_accumulator_ambient.rgb * _color.rgb * material.ambient.rgb;\n                    color.a *= material.ambient.a;\n                #else\n                    #ifdef TANGRAM_MATERIAL_DIFFUSE\n                        color.rgb += light_accumulator_ambient.rgb * _color.rgb * material.diffuse.rgb;\n                    #endif\n                #endif\n\n                #ifdef TANGRAM_MATERIAL_DIFFUSE\n                    color.rgb += light_accumulator_diffuse.rgb * _color.rgb * material.diffuse.rgb;\n                    color.a *= material.diffuse.a;\n                #endif\n\n                #ifdef TANGRAM_MATERIAL_SPECULAR\n                    color.rgb += light_accumulator_specular.rgb * material.specular.rgb;\n                    color.a *= material.specular.a;\n                #endif\n\n                // Clamp final color\n                color = clamp(color, 0.0, 1.0);\n\n                return color;\n            }";Yr.addBlock(e.block,a)}};var t=e.prototype;return t.inject=function(){var t="\n            uniform "+this.struct_name+" u_"+this.name+";\n            "+this.struct_name+" "+this.name+";\n            ",i="\n            "+this.name+" = u_"+this.name+";\n\n        ";Yr.addBlock(e.block,t),Yr.addBlock("setup",i)},t.update=function(){},t.setupProgram=function(e){e.uniform("3fv","u_"+this.name+".ambient",this.ambient),e.uniform("3fv","u_"+this.name+".diffuse",this.diffuse),e.uniform("3fv","u_"+this.name+".specular",this.specular)},e}();so.types={},so.block="lighting",so.enabled=!0;var ao=function(e){function t(t,i){var r;return(r=e.call(this,t,i)||this).type="ambient",r.struct_name="AmbientLight",r}return ft(t,e),t.inject=function(){Yr.addBlock(so.block,"/*\n\nExpected globals:\nlight_accumulator_*\n\n*/\n\nstruct AmbientLight {\n    vec3 ambient;\n};\n\nvoid calculateLight(in AmbientLight _light, in vec3 _eyeToPoint, in vec3 _normal) {\n    light_accumulator_ambient.rgb += _light.ambient;\n}\n")},t.prototype.setupProgram=function(e){e.uniform("3fv","u_"+this.name+".ambient",this.ambient)},t}(so);so.types.ambient=ao;var lo=function(e){function t(t,i){var r;if((r=e.call(this,t,i)||this).type="directional",r.struct_name="DirectionalLight",i.direction)r._direction=i.direction;else{var n=Math.sin(60*Math.PI/180);r._direction=[Math.cos(135*Math.PI/180)*n,Math.sin(135*Math.PI/180)*n,-.5],null==i.ambient&&(r.ambient=Gr.expandVec3(.5))}return r.direction=r._direction.map(parseFloat),r}return ft(t,e),t.inject=function(){Yr.addBlock(so.block,"/*\n\nExpected globals:\nmaterial\nlight_accumulator_*\n\n*/\n\nstruct DirectionalLight {\n    vec3 ambient;\n    vec3 diffuse;\n    vec3 specular;\n    vec3 direction;\n};\n\nvoid calculateLight(in DirectionalLight _light, in vec3 _eyeToPoint, in vec3 _normal) {\n\n    light_accumulator_ambient.rgb += _light.ambient;\n\n    float nDotVP = clamp(dot(_normal, -_light.direction), 0.0, 1.0);\n\n    #ifdef TANGRAM_MATERIAL_DIFFUSE\n        light_accumulator_diffuse.rgb += _light.diffuse * nDotVP;\n    #endif\n\n    #ifdef TANGRAM_MATERIAL_SPECULAR\n        float pf = 0.0;\n        if (nDotVP > 0.0) {\n            vec3 reflectVector = reflect(_light.direction, _normal);\n            float eyeDotR = max(dot(normalize(_eyeToPoint), reflectVector), 0.0);\n            pf = pow(eyeDotR, material.shininess);\n        }\n        light_accumulator_specular.rgb += _light.specular * pf;\n    #endif\n}\n")},t.prototype.setupProgram=function(t){e.prototype.setupProgram.call(this,t),t.uniform("3fv","u_"+this.name+".direction",this.direction)},pt(t,[{key:"direction",get:function(){return this._direction},set:function(e){this._direction=oo.normalize(oo.copy(e))}}]),t}(so);so.types.directional=lo;var co=function(e){function t(t,i){var r;return(r=e.call(this,t,i)||this).type="point",r.struct_name="PointLight",r.position=i.position||[0,0,"100px"],r.position_eye=[],r.origin=i.origin||"ground",r.attenuation=isNaN(parseFloat(i.attenuation))?0:parseFloat(i.attenuation),i.radius?Array.isArray(i.radius)&&2===i.radius.length?r.radius=i.radius:r.radius=[null,i.radius]:r.radius=null,r}ft(t,e),t.inject=function(){Yr.addBlock(so.block,"/*\n\nExpected globals:\nmaterial\nlight_accumulator_*\n\n*/\n\nstruct PointLight {\n    vec3 ambient;\n    vec3 diffuse;\n    vec3 specular;\n    vec4 position;\n\n#ifdef TANGRAM_POINTLIGHT_ATTENUATION_EXPONENT\n    float attenuationExponent;\n#endif\n\n#ifdef TANGRAM_POINTLIGHT_ATTENUATION_INNER_RADIUS\n    float innerRadius;\n#endif\n\n#ifdef TANGRAM_POINTLIGHT_ATTENUATION_OUTER_RADIUS\n    float outerRadius;\n#endif\n};\n\nvoid calculateLight(in PointLight _light, in vec3 _eyeToPoint, in vec3 _normal) {\n\n    float dist = length(_light.position.xyz - _eyeToPoint);\n\n    // Compute vector from surface to light position\n    vec3 VP = (_light.position.xyz - _eyeToPoint) / dist;\n\n    // Normalize the vector from surface to light position\n    float nDotVP = clamp(dot(VP, _normal), 0.0, 1.0);\n\n    // Attenuation defaults\n    float attenuation = 1.0;\n    #ifdef TANGRAM_POINTLIGHT_ATTENUATION_EXPONENT\n        float Rin = 1.0;\n        float e = _light.attenuationExponent;\n\n        #ifdef TANGRAM_POINTLIGHT_ATTENUATION_INNER_RADIUS\n            Rin = _light.innerRadius;\n        #endif\n\n        #ifdef TANGRAM_POINTLIGHT_ATTENUATION_OUTER_RADIUS\n            float Rdiff = _light.outerRadius-Rin;\n            float d = clamp(max(0.0,dist-Rin)/Rdiff, 0.0, 1.0);\n            attenuation = 1.0-(pow(d,e));\n        #else\n            // If no outer is provide behaves like:\n            // https://imdoingitwrong.wordpress.com/2011/01/31/light-attenuation/\n            float d = max(0.0,dist-Rin)/Rin+1.0;\n            attenuation = clamp(1.0/(pow(d,e)), 0.0, 1.0);\n        #endif\n    #else\n        float Rin = 0.0;\n\n        #ifdef TANGRAM_POINTLIGHT_ATTENUATION_INNER_RADIUS\n            Rin = _light.innerRadius;\n            #ifdef TANGRAM_POINTLIGHT_ATTENUATION_OUTER_RADIUS\n                float Rdiff = _light.outerRadius-Rin;\n                float d = clamp(max(0.0,dist-Rin)/Rdiff, 0.0, 1.0);\n                attenuation = 1.0-d*d;\n            #else\n                // If no outer is provide behaves like:\n                // https://imdoingitwrong.wordpress.com/2011/01/31/light-attenuation/\n                float d = max(0.0,dist-Rin)/Rin+1.0;\n                attenuation = clamp(1.0/d, 0.0, 1.0);\n            #endif\n        #else\n            #ifdef TANGRAM_POINTLIGHT_ATTENUATION_OUTER_RADIUS\n                float d = clamp(dist/_light.outerRadius, 0.0, 1.0);\n                attenuation = 1.0-d*d;\n            #else\n                attenuation = 1.0;\n            #endif\n        #endif\n    #endif\n\n    // Computer accumulators\n    light_accumulator_ambient.rgb += _light.ambient * attenuation;\n\n    #ifdef TANGRAM_MATERIAL_DIFFUSE\n        light_accumulator_diffuse.rgb += _light.diffuse * nDotVP * attenuation;\n    #endif\n\n    #ifdef TANGRAM_MATERIAL_SPECULAR\n        float pf = 0.0; // power factor for shiny speculars\n        if (nDotVP > 0.0) {\n            vec3 reflectVector = reflect(-VP, _normal);\n            float eyeDotR = max(0.0, dot(-normalize(_eyeToPoint), reflectVector));\n            pf = pow(eyeDotR, material.shininess);\n        }\n\n        light_accumulator_specular.rgb += _light.specular * pf * attenuation;\n    #endif\n}\n")};var i=t.prototype;return i.inject=function(){e.prototype.inject.call(this),Yr.defines.TANGRAM_POINTLIGHT_ATTENUATION_EXPONENT=0!==this.attenuation,Yr.defines.TANGRAM_POINTLIGHT_ATTENUATION_INNER_RADIUS=null!=this.radius&&null!=this.radius[0],Yr.defines.TANGRAM_POINTLIGHT_ATTENUATION_OUTER_RADIUS=null!=this.radius},i.update=function(){this.updateEyePosition()},i.updateEyePosition=function(){if("world"===this.origin){var e=an.latLngToMeters([].concat(this.position));this.position_eye[0]=e[0]-this.view.camera.position_meters[0],this.position_eye[1]=e[1]-this.view.camera.position_meters[1],this.position_eye[2]=Dn.convertUnits(this.position[2],{zoom:this.view.zoom,meters_per_pixel:an.metersPerPixel(this.view.zoom)}),this.position_eye[2]=this.position_eye[2]-this.view.camera.position_meters[2]}else"ground"!==this.origin&&"camera"!==this.origin||(this.position_eye=Dn.convertUnits(this.position,{zoom:this.view.zoom,meters_per_pixel:an.metersPerPixel(this.view.zoom)}),"ground"===this.origin&&(this.position_eye[2]=this.position_eye[2]-this.view.camera.position_meters[2]));this.position_eye[3]=1},i.setupProgram=function(t){e.prototype.setupProgram.call(this,t),t.uniform("4fv","u_"+this.name+".position",this.position_eye),Yr.defines.TANGRAM_POINTLIGHT_ATTENUATION_EXPONENT&&t.uniform("1f","u_"+this.name+".attenuationExponent",this.attenuation),Yr.defines.TANGRAM_POINTLIGHT_ATTENUATION_INNER_RADIUS&&t.uniform("1f","u_"+this.name+".innerRadius",Dn.convertUnits(this.radius[0],{zoom:this.view.zoom,meters_per_pixel:an.metersPerPixel(this.view.zoom)})),Yr.defines.TANGRAM_POINTLIGHT_ATTENUATION_OUTER_RADIUS&&t.uniform("1f","u_"+this.name+".outerRadius",Dn.convertUnits(this.radius[1],{zoom:this.view.zoom,meters_per_pixel:an.metersPerPixel(this.view.zoom)}))},t}(so);so.types.point=co;var uo=function(e){function t(t,i){var r;return(r=e.call(this,t,i)||this).type="spotlight",r.struct_name="SpotLight",r.direction=r._direction=(i.direction||[0,0,-1]).map(parseFloat),r.exponent=i.exponent?parseFloat(i.exponent):.2,r.angle=i.angle?parseFloat(i.angle):20,r}return ft(t,e),t.inject=function(){Yr.addBlock(so.block,"/*\n\nExpected globals:\nmaterial\nlight_accumulator_*\n\n*/\n\nstruct SpotLight {\n    vec3 ambient;\n    vec3 diffuse;\n    vec3 specular;\n    vec4 position;\n\n#ifdef TANGRAM_POINTLIGHT_ATTENUATION_EXPONENT\n    float attenuationExponent;\n#endif\n\n#ifdef TANGRAM_POINTLIGHT_ATTENUATION_INNER_RADIUS\n    float innerRadius;\n#endif\n\n#ifdef TANGRAM_POINTLIGHT_ATTENUATION_OUTER_RADIUS\n    float outerRadius;\n#endif\n\n    vec3 direction;\n    float spotCosCutoff;\n    float spotExponent;\n};\n\nvoid calculateLight(in SpotLight _light, in vec3 _eyeToPoint, in vec3 _normal) {\n\n    float dist = length(_light.position.xyz - _eyeToPoint);\n\n    // Compute vector from surface to light position\n    vec3 VP = (_light.position.xyz - _eyeToPoint) / dist;\n\n    // normal . light direction\n    float nDotVP = clamp(dot(_normal, VP), 0.0, 1.0);\n\n    // Attenuation defaults\n    float attenuation = 1.0;\n    #ifdef TANGRAM_POINTLIGHT_ATTENUATION_EXPONENT\n        float Rin = 1.0;\n        float e = _light.attenuationExponent;\n\n        #ifdef TANGRAM_POINTLIGHT_ATTENUATION_INNER_RADIUS\n            Rin = _light.innerRadius;\n        #endif\n\n        #ifdef TANGRAM_POINTLIGHT_ATTENUATION_OUTER_RADIUS\n            float Rdiff = _light.outerRadius-Rin;\n            float d = clamp(max(0.0,dist-Rin)/Rdiff, 0.0, 1.0);\n            attenuation = 1.0-(pow(d,e));\n        #else\n            // If no outer is provide behaves like:\n            // https://imdoingitwrong.wordpress.com/2011/01/31/light-attenuation/\n            float d = max(0.0,dist-Rin)/Rin+1.0;\n            attenuation = clamp(1.0/(pow(d,e)), 0.0, 1.0);\n        #endif\n    #else\n        float Rin = 0.0;\n\n        #ifdef TANGRAM_POINTLIGHT_ATTENUATION_INNER_RADIUS\n            Rin = _light.innerRadius;\n            #ifdef TANGRAM_POINTLIGHT_ATTENUATION_OUTER_RADIUS\n                float Rdiff = _light.outerRadius-Rin;\n                float d = clamp(max(0.0,dist-Rin)/Rdiff, 0.0, 1.0);\n                attenuation = 1.0-d*d;\n            #else\n                // If no outer is provide behaves like:\n                // https://imdoingitwrong.wordpress.com/2011/01/31/light-attenuation/\n                float d = max(0.0,dist-Rin)/Rin+1.0;\n                attenuation = clamp(1.0/d, 0.0, 1.0);\n            #endif\n        #else\n            #ifdef TANGRAM_POINTLIGHT_ATTENUATION_OUTER_RADIUS\n                float d = clamp(dist/_light.outerRadius, 0.0, 1.0);\n                attenuation = 1.0-d*d;\n            #else\n                attenuation = 1.0;\n            #endif\n        #endif\n    #endif\n\n    // spotlight attenuation factor\n    float spotAttenuation = 0.0;\n\n    // See if point on surface is inside cone of illumination\n    float spotDot = clamp(dot(-VP, _light.direction), 0.0, 1.0);\n\n    if (spotDot >= _light.spotCosCutoff) {\n        spotAttenuation = pow(spotDot, _light.spotExponent);\n    }\n\n    light_accumulator_ambient.rgb += _light.ambient * attenuation * spotAttenuation;\n\n    #ifdef TANGRAM_MATERIAL_DIFFUSE\n        light_accumulator_diffuse.rgb += _light.diffuse * nDotVP * attenuation * spotAttenuation;\n    #endif\n\n    #ifdef TANGRAM_MATERIAL_SPECULAR\n        // Power factor for shiny speculars\n        float pf = 0.0;\n        if (nDotVP > 0.0) {\n            vec3 reflectVector = reflect(-VP, _normal);\n            float eyeDotR = max(dot(-normalize(_eyeToPoint), reflectVector), 0.0);\n            pf = pow(eyeDotR, material.shininess);\n        }\n        light_accumulator_specular.rgb += _light.specular * pf * attenuation * spotAttenuation;\n    #endif\n}\n")},t.prototype.setupProgram=function(t){e.prototype.setupProgram.call(this,t),t.uniform("3fv","u_"+this.name+".direction",this.direction),t.uniform("1f","u_"+this.name+".spotCosCutoff",Math.cos(3.14159*this.angle/180)),t.uniform("1f","u_"+this.name+".spotExponent",this.exponent)},pt(t,[{key:"direction",get:function(){return this._direction},set:function(e){this._direction=oo.normalize(oo.copy(e))}}]),t}(co);so.types.spotlight=uo,O(O.S,"Math",{log2:function(e){return Math.log(e)/Math.LN2}});var ho=function(e){function t(t){var i;return(i=e.call(this)||this).name="MethodNotImplemented",i.message="Method "+t+" must be implemented in subclass",i}return ft(t,e),t}(_t(Error)),po=function(){function e(e,t){var i=this;this.validate(e),this.config=e,this.sources=t,this.id=e.id,this.name=e.name,this.pad_scale=e.pad_scale||1e-5,this.default_winding=null,this.rasters=[],Array.isArray(e.rasters)&&e.rasters.forEach((function(e){-1===i.rasters.indexOf(e)&&i.rasters.push(e)})),this.preprocess=e.preprocess,"function"==typeof this.preprocess&&this.preprocess.bind(this),this.transform=e.transform,"function"==typeof this.transform&&this.transform.bind(this),this.extra_data=e.extra_data,this.scripts=e.scripts,this.setZooms(e),this.zoom_offset=null!=e.zoom_offset?e.zoom_offset:0,this.zoom_offset<0&&(Ki({level:"warn",once:!0},"Data source '"+this.name+"' zoom_offset must not be negative  setting to 0."),this.zoom_offset=0),this.setTileSize(e.tile_size),this.min_display_zoom=Math.max(e.min_display_zoom||0,this.zooms[0]),this.max_display_zoom=null!=e.max_display_zoom?e.max_display_zoom:null}e.register=function(t,i){t&&i&&(e.types[t]=i)},e.create=function(t,i){if("function"==typeof e.types[t.type]){var r=e.types[t.type](t);if(r)return new r(t,i)}},e.tileLayoutChanged=function(e,t){if(!e||!t)return!0;var i=["max_zoom","zooms","min_display_zoom","max_display_zoom","bounds","tile_size","zoom_offset"],r=Cr(e.config,i),n=Cr(t.config,i);return JSON.stringify(r)!==JSON.stringify(n)},e.projectData=function(e){var t=+new Date;for(var i in e.layers)for(var r=e.layers[i].features.length,n=0;n<r;n++){var o=e.layers[i].features[n];an.transformGeometry(o.geometry,this.projectCoord)}void 0!==e.debug&&(e.debug.projection=+new Date-t)},e.projectCoord=function(e){an.latLngToMeters(e)},e.scaleData=function(e,t){var i=t.coords.z,r=t.min,n=an.unitsPerMeter(i);for(var o in e.layers)for(var s=e.layers[o].features.length,a=0;a<s;a++){var l=e.layers[o].features[a];an.transformGeometry(l.geometry,(function(e){e[0]=(e[0]-r.x)*n,e[1]=(e[1]-r.y)*n*-1}))}};var t=e.prototype;return t.load=function(e){var t=this;return e.source_data={},e.source_data.layers={},e.pad_scale=this.pad_scale,e.rasters=[].concat(this.rasters),this._load(e).then((function(e){for(var i in e.source_data.layers){var r=e.source_data.layers[i];r&&r.features&&r.features.forEach((function(e){an.transformGeometry(e.geometry,(function(e){e[1]=-e[1],t.pad_scale&&(e[0]=Math.round(e[0]*(1+t.pad_scale)-an.tile_scale*t.pad_scale/2),e[1]=Math.round(e[1]*(1+t.pad_scale)-an.tile_scale*t.pad_scale/2))})),t.updateDefaultWinding(e.geometry)}))}return e.default_winding=t.default_winding||"CCW",e}))},t._load=function(){throw new ho("_load")},t.copyTileData=function(e,t){return Ki("trace","Copy tile data from "+e.key+" to "+t.key),t.source_data={layers:e.source_data.layers},t.rasters=[].concat(e.rasters),t.pad_scale=e.pad_scale,t.default_winding=e.default_winding,t},t.setZooms=function(e){var t=e.max_zoom,i=e.zooms;if(this.max_zoom=null!=t?t:an.default_source_max_zoom,Array.isArray(i))this.zooms=i,this.max_zoom=this.zooms[this.zooms.length-1];else{this.zooms=[];for(var r=0;r<=this.max_zoom;r++)this.zooms[r]=r}},t.setTileSize=function(e){this.tile_size=e||256,("number"!=typeof this.tile_size||this.tile_size<256||!Ji.isPowerOf2(this.tile_size))&&(Ki({level:"warn",once:!0},"Data source '"+this.name+"': 'tile_size' parameter must be a number that is a power of 2 greater than or equal to 256, but was '"+e+"'"),this.tile_size=256),this.zoom_bias=Math.log2(this.tile_size)-8+this.zoom_offset},t.updateDefaultWinding=function(e){return null==this.default_winding&&("Polygon"===e.type?this.default_winding=an.ringWinding(e.coordinates[0]):"MultiPolygon"===e.type&&(this.default_winding=an.ringWinding(e.coordinates[0][0]))),this.default_winding},t.includesTile=function(e,t){if(e.z<this.min_display_zoom||null!=this.max_display_zoom&&t>this.max_display_zoom)return!1;for(var i=0;i<this.rasters.length;i++){var r=this.rasters[i];if(this.sources[r]&&this.sources[r]!==this&&!this.sources[r].includesTile(e,e.z))return!1}return!0},t.validate=function(){},e}();po.types={};var fo=0,Ao=function(e){function t(t,i){var r;(r=e.call(this,t,i)||this).response_type="";var n=function(e,t){if(!t||0===Object.keys(t).length)return[e,[]];var i=e.indexOf("?"),r=e.indexOf("#"),n="";r>-1&&(n=e.slice(r),e=e.slice(0,r)),-1===i&&(i=e.length,e+="?"),i++;var o="",s=[];for(var a in t)""===wr(a,e)?o+=a+"="+t[a]+"&":s.push([a,t[a]]);return[e=e.slice(0,i)+o+e.slice(i)+n,s]}(t.url,t.url_params),o=n[0],s=n[1];return r.url=o,s.forEach((function(e){var i=e[0],n=e[1];Ki({level:"warn",once:!0},"Data source '"+r.name+"': parameter '"+i+"' already present in URL '"+t.url+"', skipping value '"+i+"="+n+"' specified in 'url_params'")})),t.request_headers&&"object"==typeof t.request_headers&&(r.request_headers=t.request_headers),r}ft(t,e);var i=t.prototype;return i._load=function(e){var t=this,i=this.formatURL(this.url,e),r=e.source_data;return r.url=i,e.debug=e.debug||{},e.debug.network=+new Date,new Promise((function(n){var o=fo+++"-"+i,s=Ji.io(i,6e4,t.response_type,"GET",t.request_headers,o);r.request_id=o,r.error=null,s.then((function(i){var o=i.body;e.debug.response_size=o&&(o.length||o.byteLength),e.debug.network=+new Date-e.debug.network,e.debug.parsing=+new Date,null!=o&&"function"==typeof t.preprocess&&(o=t.preprocess(o)),(o=o instanceof Promise?o:Promise.resolve(o)).then((function(i){null!=i?t.parseSourceData(e,r,i):r.layers={},e.debug.parsing=+new Date-e.debug.parsing,n(e)}))})).catch((function(t){r.error=t.stack,n(e)}))}))},i.validate=function(e){if("string"!=typeof e.url)throw Error("Network data source must provide a string `url` property")},i.formatURL=function(){throw new ho("formatURL")},i.parseSourceData=function(){throw new ho("parseSourceData")},t}(po),mo=function(e){function t(t,i){var r;return(r=e.call(this,t,i)||this).tiled=!0,r.bounds=r.parseBounds(t),r.builds_geometry_tiles=!1,r.tms=!0===t.tms,r.url&&r.url.search("{s}")>-1&&(Array.isArray(t.url_subdomains)&&t.url_subdomains.length>0?(r.url_subdomains=t.url_subdomains,r.next_url_subdomain=0):Ki({level:"warn",once:!0},"Data source '"+r.name+"': source URL includes '{s}' subdomain marker ('"+r.url+"'), but no subdomains were specified in 'url_subdomains' parameter")),r.url&&r.url.search("{r}")>-1&&(Array.isArray(t.url_density_scales)&&t.url_density_scales.length>0?r.url_density_scales=t.url_density_scales:r.url_density_scales=[1,2]),r}ft(t,e);var i=t.prototype;return i.parseBounds=function(e){if(Array.isArray(e.bounds)&&4===e.bounds.length){var t=e.bounds,i=t[0],r=t[1],n=t[2],o=t[3];return{latlng:[].concat(e.bounds),meters:{min:an.latLngToMeters([i,o]),max:an.latLngToMeters([n,r])},tiles:{min:{},max:{}}}}},i.checkBounds=function(e,t){if(t){e=an.wrapTile(e);var i=t.tiles.min[e.z];i||(i=t.tiles.min[e.z]=an.tileForMeters(t.meters.min,e.z));var r=t.tiles.max[e.z];if(r||(r=t.tiles.max[e.z]=an.tileForMeters(t.meters.max,e.z)),e.y<i.y||e.y>r.y)return!1;if(i.x<=r.x){if(e.x<i.x||e.x>r.x)return!1}else if(e.x>r.x&&e.x<i.x)return!1}return!0},i.includesTile=function(t,i){return!!e.prototype.includesTile.call(this,t,i)&&!!this.checkBounds(t,this.bounds)},i.formatURL=function(e,t){var i=an.wrapTile(t.coords,{x:!0});this.tms&&(i.y=Math.pow(2,i.z)-1-i.y);var r=e.replace("{x}",i.x).replace("{y}",i.y).replace("{z}",i.z).replace("{r}",this.getDensityModifier()).replace("{q}",this.toQuadKey(i));return null!=this.url_subdomains&&(r=r.replace("{s}",this.url_subdomains[this.next_url_subdomain]),this.next_url_subdomain=(this.next_url_subdomain+1)%this.url_subdomains.length),r},i.getDensityModifier=function(){if(this.url_density_scales){var e=Ji.device_pixel_ratio,t=this.url_density_scales.filter((function(t){return e>=t})).reverse()[0];if((t=null!=t?t:this.url_density_scales[0])>1)return"@"+t+"x"}return""},i.toQuadKey=function(e){for(var t=e.x,i=e.y,r="",n=e.z;n>0;n--){var o=0,s=1<<n-1;!!(t&s)&&o++,!!(i&s)&&(o+=2),r+=o.toString()}return r},t.urlHasTilePattern=function(e){return e&&(e.search("{x}")>-1&&e.search("{y}")>-1&&e.search("{z}")>-1||e.search("{q}")>-1)},t}(Ao),go={coord:function(e){return{x:e.x,y:e.y,z:e.z,key:this.coordKey(e)}},coordKey:function(e){return e.x+"/"+e.y+"/"+e.z},key:function(e,t,i){if(!(e.y<0||e.y>=1<<e.z||e.z<0))return[t.name,e.x,e.y,e.z,i].join("/")},normalizedKey:function(e,t,i){return this.key(this.normalizedCoord(e,t),t,i)},normalizedCoord:function(e,t){return t.zoom_bias&&(e=this.coordAtZoom(e,Math.max(e.z-t.zoom_bias,t.zooms[0]))),this.coordForTileZooms(e,t.zooms)},coordAtZoom:function(e,t){var i=e.x,r=e.y,n=e.z;if(n!==(t=Math.max(0,t))){var o=Math.pow(2,n-t);i=Math.floor(i/o),r=Math.floor(r/o),n=t}return this.coord({x:i,y:r,z:n})},coordForTileZooms:function(e,t){var i=e.x,r=e.y,n=e.z,o=this.findZoomInRange(n,t);return o!==n?this.coordAtZoom({x:i,y:r,z:n},o):this.coord({x:i,y:r,z:n})},findZoomInRange:function(e,t){return t.filter((function(t){return e>=t})).reverse()[0]||t[0]},isDescendant:function(e,t){if(t.z>e.z){var i=this.coordAtZoom(t,e.z),r=i.x,n=i.y;return e.x===r&&e.y===n}return!1},parent:function(e){var t=e.coords,i=e.source,r=e.style_z;if(r>0){r--;var n=Math.max(r-i.zoom_bias,i.zooms[0]),o=this.coordForTileZooms(this.coordAtZoom(t,n),i.zooms);return o.z>r?null:{key:this.key(o,i,r),coords:o,style_z:r,source:i}}},children:function(e,t){var i=e.coords,r=e.source,n=e.style_z;void 0===t&&(t={}),n++;var o=this.coordForTileZooms(this.coordAtZoom(i,n-r.zoom_bias),r.zooms);if(o.z===i.z)return[{key:this.key(o,r,n),coords:o,style_z:n,source:r}];var s=this.key(o,r,n);if(t[r.id]=t[r.id]||{},null==t[r.id][s]){for(var a=Math.pow(2,o.z-i.z),l=i.x*a,c=i.y*a,u=[],h=l;h<l+a;h++)for(var d=c;d<c+a;d++){var p=this.coord({x:h,y:d,z:o.z});u.push({key:this.key(p,r,n),coords:p,style_z:n,source:r})}t[r.id][s]=u}return t[r.id][s]}},_o=function(e){function t(t,i){var r;return-1===(r=e.call(this,t,i)||this).rasters.indexOf(r.name)&&r.rasters.unshift(r.name),r.filtering=t.filtering,r.textures={},r}ft(t,e);var i=t.prototype;return i.load=function(e){return new Promise(function(t,i){e.source_data={},e.source_data.layers={},e.pad_scale=this.pad_scale,e.rasters=[].concat(this.rasters);var r=an.tile_scale;return e.source_data.layers={_default:{type:"FeatureCollection",features:[{geometry:{type:"Polygon",coordinates:[[[0,0],[r,0],[r,-r],[0,-r],[0,0]]]},properties:{}}]}},e.default_winding="CW",t(e)}.bind(this))},i.tileTexture=function(e){return new Promise(function(t,i){var r=this.adjustRasterTileZoom(e),n=r.key;if(!this.textures[n]){var o=this.formatURL(this.url,{coords:r});this.textures[n]={name:o,url:o,filtering:this.filtering,coords:r}}return t(this.textures[n])}.bind(this))},i.adjustRasterTileZoom=function(e){var t=e.coords,i=this.sources[e.source];if(i!==this){var r=this.zoom_bias-i.zoom_bias;r>0?t=go.normalizedCoord(e.coords,{zoom_bias:r,zooms:this.zooms}):(r<0&&Ki({level:"warn",once:!0},"Raster source '"+this.name+"' supports higher zoom detail than source '"+i.name+"' it's attached to. Downsampling this source "+-r+" extra zoom levels to match."),t=go.coordForTileZooms(t,this.zooms))}return t},t}(mo),yo=function(e){function t(t,i){var r;return(r=e.call(this,t,i)||this).load_image={},r.alpha=null!=t.alpha?Math.max(Math.min(t.alpha,1),0):null,r.mask_alpha=!0,r.preserve_tiles_within_zoom=0,r.max_display_density=t.max_display_density,Array.isArray(t.composite)?r.images=t.composite.map((function(e){return{url:e.url,bounds:r.parseBounds(e),alpha:null!=e.alpha?Math.max(Math.min(e.alpha,1),0):null}})):r.images=[{url:r.url,bounds:r.bounds,alpha:r.alpha}],r}ft(t,e);var i=t.prototype;return i.tileTexture=function(e,t){return new Promise(function(i,r){var n,o,s,a,l,c,u,h,d,p;return n=this,o=t.blend,s=t.generation,a=this.adjustRasterTileZoom(e),l="opaque"!==o,c="raster-"+this.name+"-"+a.key+"-"+(l?"alpha":"opaque")+"-"+s,Hr.textures[c]?i({name:c,coords:a,skip_create:!0}):(u=Ji.device_pixel_ratio,this.max_display_density&&(u=Math.min(u,this.max_display_density)),u*=2,h=document.createElement("canvas"),d=h.getContext("2d"),h.width=this.tile_size*u,h.height=this.tile_size*u,d.imageSmoothingEnabled="nearest"!==this.filtering,p=this.images.filter((function(t){return n.checkBounds(e.coords,t.bounds)})),Promise.resolve(Promise.all(p.map((function(t){var i=l?null!=t.alpha?t.alpha:n.alpha:1;return n.drawImage(t.url,t.bounds,i,e,u,d)})))).then(function(e){try{return i({name:c,element:h,filtering:this.filtering,coords:a})}catch(e){return r(e)}}.bind(this),r))}.bind(this))},i.drawImage=function(e,t,i,r,n,o){return new Promise(function(s,a){var l,c,u,h,d,p,f;return l=qr(e),this.load_image[l]=this.load_image[l]||this.loadImage(e),Promise.resolve(this.load_image[l]).then(function(e){try{return c=e,u=an.metersPerPixel(r.coords.z)/n/(this.tile_size/an.tile_size),h=(t.meters.min[0]-r.min.x)/u,d=-(t.meters.min[1]-r.min.y)/u,p=(t.meters.max[0]-t.meters.min[0])/u,f=-(t.meters.max[1]-t.meters.min[1])/u,o.globalAlpha=null!=i?i:1,o.drawImage(c,h,d,p,f),s()}catch(e){return a(e)}}.bind(this),a)}.bind(this))},i.loadImage=function(e){var t=this;return new Promise((function(i){var r=new Image;r.onload=function(){return i(r)},r.onerror=function(r){Ki("warn","Raster source '"+t.name+"': failed to load url: '"+e+"'",r),i(null)},Ji.isSafari()&&"data:"===e.slice(0,5)||(r.crossOrigin="anonymous"),r.src=e}))},i.includesTile=function(e,t){var i=this;return!!po.prototype.includesTile.call(this,e,t)&&this.images.some((function(t){return i.checkBounds(e,t.bounds)}))},i.validate=function(e){var t="Raster data source must provide a string `url` parameter, or an array of `composite` raster ";t+="image objects that each have a `url` parameter";var i="Raster data source must provide a `bounds` parameter, or an array of `composite` raster ";if(i+="image objects that each have a `bounds` parameter",Array.isArray(e.composite)){if(e.composite.some((function(e){return"string"!=typeof e.url})))throw Error(t);if(e.composite.some((function(e){return!(Array.isArray(e.bounds)&&4===e.bounds.length)})))throw Error(i);if(null!=e.url||null!=e.bounds)throw Error("Raster data source must have *either* a single image specified as `url` and `bounds `parameters, or an array of `composite` raster image objects, each with `url` and `bounds`.")}else{if("string"!=typeof e.url)throw Error(t);if(!Array.isArray(e.bounds)||4!==e.bounds.length)throw Error(i)}},t}(_o);po.register("Raster",(function(e){return _o.urlHasTilePattern(e.url)?_o:yo}));var vo={init:function(e){var t=void 0===e?{}:e,i=t.generation,r=t.styles,n=t.sources,o=void 0===n?{}:n,s=t.introspection;this.setGeneration(i),this.styles=r,this.sources=o,this.defines=Object.prototype.hasOwnProperty.call(this,"defines")&&this.defines||{},this.shaders=Object.prototype.hasOwnProperty.call(this,"shaders")&&this.shaders||{},this.introspection=s||!1,this.selection=this.selection||this.introspection||!1,this.compile_setup=!1,this.program=null,this.selection_program=null,this.feature_style={},this.vertex_template=[],this.tile_data={},this.stencil_proxy_tiles=!0,this.variants={},this.vertex_layouts={},this.defines.TANGRAM_WORLD_POSITION_WRAP=1e5,this.blend=this.blend||"opaque","opaque"!==this.blend?null==this.blend_order&&(this.blend_order=this.default_blend_orders[this.blend]):this.blend_order=this.default_blend_orders[this.blend],this.defines["TANGRAM_BLEND_"+this.blend.toUpperCase()]=!0,this.removeShaderBlock("setup"),this.material instanceof eo||(eo.isValid(this.material)||(this.material=Dn.defaults.material),this.material=new eo(this.material)),this.material.inject(this),so.setMode(this.lighting,this),this.setupRasters(),this.setupCustomAttributes(),this.initialized=!0},destroy:function(){this.program&&(this.program.destroy(),this.program=null),this.selection_program&&(this.selection_program.destroy(),this.selection_program=null),Qi.removeTarget(this.main_thread_target),this.gl=null,this.initialized=!1},reset:function(){},baseStyle:function(){return this.base||this.name},setGeneration:function(e){this.generation=e,this.main_thread_target=["Style",this.name,this.generation].join("_"),He.is_main&&Qi.addTarget(this.main_thread_target,this)},startData:function(e){this.tile_data[e.id]=this.tile_data[e.id]||{meshes:{},uniforms:{},textures:[]}},endData:function(e){return new Promise(function(t,i){var r=this.tile_data[e.id];if(this.tile_data[e.id]=null,r&&Object.keys(r.meshes).length>0){for(var n in r.meshes){var o=r.meshes[n];0!==o.vertex_data.vertex_count?(o.vertex_data.end(),o.vertex_elements=o.vertex_data.element_buffer,o.vertex_data=o.vertex_data.vertex_buffer):delete r.meshes[n]}return t(this.buildRasterTextures(e,r))}return t(null)}.bind(this))},hasDataForTile:function(e){return null!=this.tile_data[e.id]},getTileMesh:function(e,t){var i=this.tile_data[e.id].meshes;if(null==i[t.key]){var r=this.vertexLayoutForMeshVariant(t);i[t.key]={variant:t,vertex_data:r.createVertexData()}}return i[t.key]},vertexLayoutForMeshVariant:function(){},meshVariantTypeForDraw:function(){},addFeature:function(e,t,i){var r=i.tile;if(r.generation===this.generation){this.tile_data[r.id]||this.startData(r);var n=this.parseFeature(e,t,i);n&&this.buildGeometry(e.geometry,n,i)>0&&(e.generation=this.generation)}},buildGeometry:function(e,t,i){var r,n=this;if("Polygon"===e.type?r=this.buildPolygons([e.coordinates],t,i):"MultiPolygon"===e.type?r=this.buildPolygons(e.coordinates,t,i):"LineString"===e.type?r=this.buildLines([e.coordinates],t,i):"MultiLineString"===e.type?r=this.buildLines(e.coordinates,t,i):"Point"===e.type?r=this.buildPoints([e.coordinates],t,i):"MultiPoint"===e.type&&(r=this.buildPoints(e.coordinates,t,i)),r>0&&er.layer_stats){var o=i.tile;o.debug.layers=o.debug.layers||{list:{},tree:{}};var s=o.debug.layers.list,a=o.debug.layers.tree,l={};i.layers.forEach((function(e){var t,i;xo(s,e,1,r,((t={})[n.name]=r,t),((i={})[n.baseStyle()]=r,i));for(var o=a,c=l,u=e.split(":"),h=0;h<u.length;h++){var d,p,f=u[h];o[f]=o[f]||{features:0,geoms:0,styles:{},base:{}},null==c[f]&&(c[f]={},xo(o,f,1,r,((d={})[n.name]=r,d),((p={})[n.baseStyle()]=r,p))),h<u.length-1&&(o[f].layers=o[f].layers||{}),o=o[f].layers,c=c[f]}}))}return r},parseFeature:function(e,t,i){try{var r=this.feature_style;if(r.order=this.parseOrder(t.order,i),null==r.order&&"overlay"!==this.blend){var n="Layer '"+t.layers.join(", ")+"', draw group '"+t.group+"': ";return n+="'order' parameter is required unless blend mode is 'overlay'",null!=t.order&&(n+="; 'order' was set to a dynamic value (e.g. string tied to feature property, ",n+="or JS function), but evaluated to null for one or more features"),void Ki({level:"warn",once:!0},n)}if(!(r=this._parseFeature(e,t,i)))return;if(this.shaders.attributes)for(var o in r.attributes=r.attributes||{},this.shaders.attributes)r.attributes[o]=Dn.evalCachedProperty(t.attributes&&t.attributes[o],i),"number"!=typeof r.attributes[o]&&(r.attributes[o]=0);return this.selection?r.interactive=Dn.evalProperty(t.interactive,i):r.interactive=!1,!0===r.interactive?r.selection_color=Wn.makeColor(e,i.tile,i):r.selection_color=Wn.defaultColor,r}catch(t){Ki("error","Style.parseFeature: style parsing error",e,r,t.stack)}},_parseFeature:function(){return this.feature_style},preprocess:function(e){if(!e.preprocessed){if(this.draw)for(var t in this.draw){var i=this.draw[t];"object"!=typeof i||Array.isArray(i)?null==e[t]&&(e[t]=i):e[t]=sn({},i,e[t])}if(this.selection?this.introspection&&(e.interactive=!0):e.interactive=!1,!(e=this._preprocess(e)))return;if(this.shaders.attributes)for(var r in e.attributes=e.attributes||{},this.shaders.attributes)e.attributes[r]=Dn.createPropertyCache(null!=e.attributes[r]?e.attributes[r]:0);e.preprocessed=!0}return e},_preprocess:function(e){return e},parseOrder:function(e,t){return"number"!=typeof e?Dn.calculateOrder(e,t):e},scaleOrder:function(e){return 2*e},parseColor:function(e,t){return e?Dn.evalCachedColorProperty(e,t):this.shaders.blocks.color||this.shaders.blocks.filter?Dn.defaults.color:void 0},buildPolygons:function(){return 0},buildLines:function(){return 0},buildPoints:function(){return 0},setGL:function(e){this.gl=e,this.max_texture_size=Hr.getMaxTextureSize(this.gl)},makeMesh:function(e,t,i){void 0===i&&(i={});var r=this.vertexLayoutForMeshVariant(i.variant);return er.wireframe?(t=function(e){for(var t=new Uint16Array(2*e.length),i=0;i<e.length;i+=3)t.set([e[i],e[i+1],e[i+1],e[i+2],e[i+2],e[i]],2*i);return t}(t),new Yn(this.gl,e,t,r,Object.assign({},i,{draw_mode:this.gl.LINES}))):new Yn(this.gl,e,t,r,i)},render:function(e){return e.render()},getProgram:function(e){void 0===e&&(e="program"),this.compileSetup();var t=this[e];if(t&&!t.error){if(!t.compiled){Ki("debug","Compiling style '"+this.name+"', program key '"+e+"'");try{t.compile()}catch(t){throw Ki("error","Style: error compiling program for style '"+this.name+"' (program key '"+e+"')",this,t.stack,t.type,t.shader_errors),t}}return t}},compileSetup:function(){if(!this.compile_setup){if(!this.gl)throw new Error("style.compile(): skipping for "+this.name+" because no GL context");var e=this.buildDefineList();if(this.selection){var t=Object.assign({},e);t.TANGRAM_FEATURE_SELECTION=!0}var i=this.shaders&&this.shaders.blocks,r=this.shaders&&this.shaders.block_scopes,n=Object.assign({},this.shaders&&this.shaders.uniforms);for(var o in n)null==n[o]&&Ki({level:"warn",once:!0},"Style '"+this.name+"' has invalid uniform '"+o+"': uniform values must be non-null");var s=this.shaders&&this.shaders.extensions;"string"==typeof s&&(s=[s]),this.program=new Yr(this.gl,this.vertex_shader_src,this.fragment_shader_src,{name:this.name,defines:e,uniforms:n,blocks:i,block_scopes:r,extensions:s}),this.selection?this.selection_program=new Yr(this.gl,this.vertex_shader_src,"// Fragment shader for feature selection passes\n// Renders in silhouette according to selection (picking) color, or black if none defined\n\n#ifdef TANGRAM_FEATURE_SELECTION\n    varying vec4 v_selection_color;\n#endif\n\nvoid main (void) {\n    #ifdef TANGRAM_FEATURE_SELECTION\n        gl_FragColor = v_selection_color;\n    #else\n        gl_FragColor = vec4(0., 0., 0., 1.);\n    #endif\n}\n",{name:this.name+" (selection)",defines:t,uniforms:n,blocks:i,block_scopes:r,extensions:s}):this.selection_program=null,this.compile_setup=!0}},addShaderBlock:function(e,t,i){void 0===i&&(i=null),this.shaders.blocks=this.shaders.blocks||{},this.shaders.blocks[e]=this.shaders.blocks[e]||[],this.shaders.blocks[e].push(t),this.shaders.block_scopes=this.shaders.block_scopes||{},this.shaders.block_scopes[e]=this.shaders.block_scopes[e]||[],this.shaders.block_scopes[e].push(i)},removeShaderBlock:function(e){this.shaders.blocks&&(this.shaders.blocks[e]=null),this.shaders.block_scopes&&(this.shaders.block_scopes[e]=null)},replaceShaderBlock:function(e,t,i){void 0===i&&(i=null),this.removeShaderBlock(e),this.addShaderBlock(e,t,i)},buildDefineList:function(){var e={};if(null!=this.defines)for(var t in this.defines)e[t]=this.defines[t];if(null!=this.shaders&&null!=this.shaders.defines)for(t in this.shaders.defines)e[t]=this.shaders.defines[t];return e},hasRasters:function(){return["color","normal","custom"].indexOf(this.raster)>-1},setupRasters:function(){var e=this;if(this.hasRasters()){"color"===this.raster?this.defines.TANGRAM_RASTER_TEXTURE_COLOR=!0:"normal"===this.raster&&(this.defines.TANGRAM_RASTER_TEXTURE_NORMAL=!0);var t=Object.keys(this.sources).filter((function(t){return e.sources[t]instanceof _o})).length;if(this.defines.TANGRAM_NUM_RASTER_SOURCES=""+t,t>0){var i=Object.keys(this.sources).filter((function(t){return e.sources[t].mask_alpha})).length;this.defines.TANGRAM_HAS_MASKED_RASTERS=i>0,this.defines.TANGRAM_ALL_MASKED_RASTERS=i===t,this.defines.TANGRAM_MODEL_POSITION_BASE_ZOOM_VARYING=!0,this.replaceShaderBlock("raster","// Uniforms defining raster textures and macros for accessing them\n\n#ifdef TANGRAM_FRAGMENT_SHADER\nuniform sampler2D u_rasters[TANGRAM_NUM_RASTER_SOURCES];    // raster tile texture samplers\nuniform vec2 u_raster_sizes[TANGRAM_NUM_RASTER_SOURCES];    // raster tile texture sizes (width/height in pixels)\nuniform vec3 u_raster_offsets[TANGRAM_NUM_RASTER_SOURCES];  // raster tile texture UV starting offset for tile\n\n// Raster sources can optionally mask by the alpha channel (render with only full or no alpha, based on a threshold),\n// which is used for handling transparency outside the raster image when rendering with opaque blending\n#if defined(TANGRAM_HAS_MASKED_RASTERS) && !defined(TANGRAM_ALL_MASKED_RASTERS) // only add uniform if we need it\nuniform bool u_raster_mask_alpha;\n#endif\n\n// Note: the raster accessors below are #defines rather than functions to\n// avoid issues with constant integer expressions for array indices\n\n// Adjusts UVs in model space to account for raster tile texture overzooming\n// (applies scale and offset adjustments)\n#define adjustRasterUV(raster_index, uv) \\\n    ((uv) * u_raster_offsets[raster_index].z + u_raster_offsets[raster_index].xy)\n\n// Returns the UVs of the current model position for a raster sampler\n#define currentRasterUV(raster_index) \\\n    (adjustRasterUV(raster_index, v_modelpos_base_zoom.xy))\n\n// Returns pixel location in raster tile texture at current model position\n#define currentRasterPixel(raster_index) \\\n    (currentRasterUV(raster_index) * rasterPixelSize(raster_index))\n\n// Samples a raster tile texture for the current model position\n#define sampleRaster(raster_index) \\\n    (texture2D(u_rasters[raster_index], currentRasterUV(raster_index)))\n\n// Samples a raster tile texture for a given pixel\n#define sampleRasterAtPixel(raster_index, pixel) \\\n    (texture2D(u_rasters[raster_index], (pixel) / rasterPixelSize(raster_index)))\n\n// Returns size of raster sampler in pixels\n#define rasterPixelSize(raster_index) \\\n    (u_raster_sizes[raster_index])\n\n#endif\n","Raster")}}},buildRasterTextures:function(e,t){return new Promise(function(i,r){var n,o,s,a;if(!this.hasRasters())return i(t);if(0===e.rasters.length)return i(t);var l=function(){try{return!n||n.length<1?i(t):n.some((function(e){return!e.loaded}))?i(null):(t.uniforms.u_raster_mask_alpha=!0===this.sources[e.rasters[0]].mask_alpha,o=t.uniforms.u_rasters=[],s=t.uniforms.u_raster_sizes=[],a=t.uniforms.u_raster_offsets=[],n.forEach((function(i){var r=i.index;if(o[r]=i.name,t.textures.push(i.name),s[r]=[i.width,i.height],e.coords.z>i.coords.z){var n=e.coords.z-i.coords.z,l=Math.pow(2,n);a[r]=[(e.coords.x%l+l)%l/l,(l-1-e.coords.y%l)/l,1/l]}else a[r]=[0,0,1]})),i(t))}catch(e){return r(e)}}.bind(this),c=function(e){try{return i(t)}catch(e){return r(e)}};try{return Promise.resolve(Qi.postMessage(this.main_thread_target+".loadTextures",{coords:e.coords,source:e.source,rasters:e.rasters,min:e.min,max:e.max})).then((function(e){try{return n=e,l()}catch(e){return c()}}),c)}catch(e){c()}}.bind(this))},loadTextures:function(e){return new Promise(function(t,i){var r,n,o,s,a;return r=this,n={},o={},s=[],e.rasters.map((function(e){return r.sources[e]})).filter((function(e){return e})).forEach((function(t,i){t instanceof _o&&s.push(t.tileTexture(e,r).then((function(e){n[e.name]=e,o[e.name]=i})))})),Promise.resolve(Promise.all(s)).then(function(e){try{return Promise.resolve(Hr.createFromObject(this.gl,n)).then((function(e){try{return Promise.resolve(Promise.all(Object.keys(n).map((function(e){return Hr.textures[e]&&Hr.textures[e].load()})).filter((function(e){return e})))).then((function(e){try{return(a=e).forEach((function(e){return e.retain()})),t(a.map((function(e){return{name:e.name,width:e.width,height:e.height,loaded:e.loaded,index:o[e.name],coords:n[e.name].coords}})))}catch(e){return i(e)}}),i)}catch(e){return i(e)}}),i)}catch(e){return i(e)}}.bind(this),i)}.bind(this))},setupCustomAttributes:function(){if(this.shaders.attributes)for(var e=0,t=Object.entries(this.shaders.attributes);e<t.length;e++){var i=t[e],r=i[0],n=i[1];"float"===n.type&&(!1!==n.varying?(this.addShaderBlock("attributes","\n                            #ifdef TANGRAM_VERTEX_SHADER\n                                attribute float a_"+r+";\n                                varying float v_"+r+";\n                                #define "+r+" a_"+r+"\n                            #else\n                                varying float v_"+r+";\n                                #define "+r+" v_"+r+"\n                            #endif\n                        "),this.addShaderBlock("setup","#ifdef TANGRAM_VERTEX_SHADER\nv_"+r+" = a_"+r+";\n#endif")):this.addShaderBlock("attributes","\n                            #ifdef TANGRAM_VERTEX_SHADER\n                                attribute float a_"+r+";\n                                #define "+r+" a_"+r+"\n                            #endif\n                        "))}},addCustomAttributesToAttributeList:function(e){if(this.shaders.attributes)for(var t=0,i=Object.entries(this.shaders.attributes);t<i.length;t++){var r=i[t],n=r[0];"float"===r[1].type&&e.push({name:"a_"+n,size:1,type:Xn.FLOAT,normalized:!1})}return e},addCustomAttributesToVertexTemplate:function(e,t){if(this.shaders.attributes)for(var i in this.shaders.attributes)this.vertex_template[t++]=null!=e.attributes[i]?e.attributes[i]:0},setup:function(){this.setUniforms(),this.material.setupProgram(Yr.current)},setUniforms:function(){var e=Yr.current;e&&e.setUniforms(this.shaders&&this.shaders.uniforms,!0)},render_states:{opaque:{depth_test:!0,depth_write:!0},translucent:{depth_test:!0,depth_write:!0},add:{depth_test:!0,depth_write:!1},multiply:{depth_test:!0,depth_write:!1},inlay:{depth_test:!0,depth_write:!1},overlay:{depth_test:!1,depth_write:!1}},default_blend_orders:{opaque:Number.MIN_SAFE_INTEGER,add:1,multiply:2,inlay:3,translucent:4,overlay:5},getBlendOrderForDraw:function(e){return"opaque"!==this.blend&&null!=e.blend_order?e.blend_order:this.blend_order}};function xo(e,t,i,r,n,o){for(var s in e[t]=e[t]||{features:0,geoms:0,styles:{},base:{}},e[t].features+=i,e[t].geoms+=r,n)e[t].styles[s]=e[t].styles[s]||0,e[t].styles[s]+=n[s];for(var a in o)e[t].base[a]=e[t].base[a]||0,e[t].base[a]+=o[a]}Vr("Int16",2,(function(e){return function(t,i,r){return e(this,t,i,r)}})),Vr("Uint32",4,(function(e){return function(t,i,r){return e(this,t,i,r)}})),Vr("Int32",4,(function(e){return function(t,i,r){return e(this,t,i,r)}})),Vr("Int8",1,(function(e){return function(t,i,r){return e(this,t,i,r)}})),Vr("Float32",4,(function(e){return function(t,i,r){return e(this,t,i,r)}}));var bo,wo=Math.pow(2,16)-1,To=!1,Bo=function(){function e(){this.array=[],this.has_overflown=!1}var t=e.prototype;return t.push=function(e){this.has_overflown&&!To||e>wo&&(this.has_overflown=!0,!To)||this.array.push(e)},t.end=function(){if(this.array.length){var e=(t=this.array,new(this.has_overflown&&To?Uint32Array:Uint16Array)(t));return this.array=[],this.has_overflown=!1,e}return!1;var t},e}();Bo.setElementIndexUint=function(e){To=e};var Co=((bo={})[Xn.FLOAT]=Float32Array,bo[Xn.BYTE]=Int8Array,bo[Xn.UNSIGNED_BYTE]=Uint8Array,bo[Xn.INT]=Int32Array,bo[Xn.UNSIGNED_INT]=Uint32Array,bo[Xn.SHORT]=Int16Array,bo[Xn.UNSIGNED_SHORT]=Uint16Array,bo),So=function(){function e(t,i){var r=(void 0===i?{}:i).prealloc,n=void 0===r?500:r;this.vertex_layout=t,this.vertex_elements=new Bo,this.stride=this.vertex_layout.stride,e.array_pool.length>0?(this.vertex_buffer=e.array_pool.pop(),this.byte_length=this.vertex_buffer.byteLength,this.size=Math.floor(this.byte_length/this.stride),Ki("trace","VertexData: reused buffer of bytes "+this.byte_length+", "+this.size+" vertices")):(this.size=n,this.byte_length=this.stride*this.size,this.vertex_buffer=new Uint8Array(this.byte_length)),this.offset=0,this.vertex_count=0,this.realloc_count=0,this.setBufferViews(),this.setAddVertexFunction()}var t=e.prototype;return t.setBufferViews=function(){var e=this;this.views={},this.views[Xn.UNSIGNED_BYTE]=this.vertex_buffer,this.vertex_layout.dynamic_attribs.forEach((function(t){if(null==e.views[t.type]){var i=Co[t.type];e.views[t.type]=new i(e.vertex_buffer.buffer)}}))},t.checkBufferSize=function(){if(this.offset+this.stride>this.byte_length){this.size=Math.floor(1.5*this.size),this.size-=this.size%4,this.byte_length=this.stride*this.size;var t=new Uint8Array(this.byte_length);t.set(this.vertex_buffer),e.array_pool.push(this.vertex_buffer),this.vertex_buffer=t,this.setBufferViews(),this.realloc_count++}},t.setAddVertexFunction=function(){this.vertexLayoutAddVertex=this.vertex_layout.getAddVertexFunction()},t.addVertex=function(e){this.checkBufferSize(),this.vertexLayoutAddVertex(e,this.views,this.offset),this.offset+=this.stride,this.vertex_count++},t.end=function(){return this.vertex_buffer=this.vertex_buffer.subarray(0,this.offset),this.element_buffer=this.vertex_elements.end(),Ki("trace","VertexData: "+this.size+" vertices total, realloc count "+this.realloc_count),this},e}();So.array_pool=[];var Eo=function(){function e(e){this.attribs=e,this.dynamic_attribs=this.attribs.filter((function(e){return null==e.static})),this.static_attribs=this.attribs.filter((function(e){return null!=e.static})),this.components=[],this.index={},this.offset={},this.stride=0;for(var t=0,i=0,r=0;r<this.attribs.length;r++){var n=this.attribs[r];if(null==n.static){n.offset=this.stride,n.byte_size=n.size;var o=0;switch(n.type){case Xn.FLOAT:case Xn.INT:case Xn.UNSIGNED_INT:n.byte_size*=4,o=2;break;case Xn.SHORT:case Xn.UNSIGNED_SHORT:n.byte_size*=2,o=1}3&n.byte_size&&(n.byte_size+=4-(3&n.byte_size)),this.stride+=n.byte_size;for(var s=n.offset>>o,a=0;a<n.size;a++)this.components.push({type:n.type,shift:o,offset:s++,index:i++});this.index[n.name]=t,t+=n.size,this.offset[n.name]=n.offset}else n.static=Array.isArray(n.static)?n.static:[n.static],n.method="vertexAttrib"+n.static.length+"fv"}}var t=e.prototype;return t.enableDynamicAttributes=function(t,i){var r=this;for(var n in e.enabled_attribs)t.disableVertexAttribArray(n);e.enabled_attribs={},this.dynamic_attribs.forEach((function(n){var o=i.attribute(n.name).location;-1!==o&&(t.enableVertexAttribArray(o),t.vertexAttribPointer(o,n.size,n.type,n.normalized,r.stride,n.offset),e.enabled_attribs[o]=i)}))},t.enableStaticAttributes=function(e,t){this.static_attribs.forEach((function(i){var r=t.attribute(i.name).location;-1!==r&&e[i.method]instanceof Function&&(e.enableVertexAttribArray(r),e[i.method](r,i.static),e.disableVertexAttribArray(r))}))},t.createVertexData=function(){return new So(this)},t.getAddVertexFunction=function(){return null==this.addVertex&&this.createAddVertexFunction(),this.addVertex},t.createAddVertexFunction=function(){var t=qr(JSON.stringify(this.attribs));if(null==e.add_vertex_funcs[t]){var i,r=["var t, o;"],n=[].concat(this.components);n.sort((function(e,t){return e.type!==t.type?e.type-t.type:e.index-t.index}));for(var o=0;o<n.length;o++){var s=n[o];i!==s.type&&(r.push("t = vs["+s.type+"];"),r.push("o = off"+(s.shift?" >> "+s.shift:"")+";"),i=s.type),r.push("t[o + "+s.offset+"] = v["+s.index+"];")}r=r.join("\n");var a=new Function("v","vs","off",r);e.add_vertex_funcs[t]=a}this.addVertex=e.add_vertex_funcs[t]},e}();Eo.enabled_attribs={},Eo.add_vertex_funcs={};var Mo=[{x:0,y:0},{x:an.tile_scale,y:-an.tile_scale}],Io=[0,0,1,1];function Po(e,t,i){var r=Mo[0],n=Mo[1];return e[0]<=r.x+i&&t[0]<=r.x+i||e[0]>=n.x-i&&t[0]>=n.x-i||e[1]>=r.y-i&&t[1]>=r.y-i||e[1]<=n.y+i&&t[1]<=n.y+i}function Lo(e,t){t=t||0;var i=Mo[0],r=Mo[1];return e[0]<=i.x+t||e[0]>=r.x-t||e[1]>=i.y-t||e[1]<=r.y+t}var Fo=zo,ko=zo;function zo(e,t,i){i=i||2;var r,n,o,s,a,l,c,u=t&&t.length,h=u?t[0]*i:e.length,d=Ro(e,0,h,i,!0),p=[];if(!d||d.next===d.prev)return p;if(u&&(d=function(e,t,i,r){var n,o,s,a=[];for(n=0,o=t.length;n<o;n++)(s=Ro(e,t[n]*r,n<o-1?t[n+1]*r:e.length,r,!1))===s.next&&(s.steiner=!0),a.push(Zo(s));for(a.sort(Vo),n=0;n<a.length;n++)Ho(a[n],i),i=Do(i,i.next);return i}(e,t,d,i)),e.length>80*i){r=o=e[0],n=s=e[1];for(var f=i;f<h;f+=i)(a=e[f])<r&&(r=a),(l=e[f+1])<n&&(n=l),a>o&&(o=a),l>s&&(s=l);c=0!==(c=Math.max(o-r,s-n))?1/c:0}return Oo(d,p,i,r,n,c),p}function Ro(e,t,i,r,n){var o,s;if(n===ss(e,t,i,r)>0)for(o=t;o<i;o+=r)s=rs(o,e[o],e[o+1],s);else for(o=i-r;o>=t;o-=r)s=rs(o,e[o],e[o+1],s);return s&&Xo(s,s.next)&&(ns(s),s=s.next),s}function Do(e,t){if(!e)return e;t||(t=e);var i,r=e;do{if(i=!1,r.steiner||!Xo(r,r.next)&&0!==Wo(r.prev,r,r.next))r=r.next;else{if(ns(r),(r=t=r.prev)===r.next)break;i=!0}}while(i||r!==t);return t}function Oo(e,t,i,r,n,o,s){if(e){!s&&o&&function(e,t,i,r){var n=e;do{null===n.z&&(n.z=$o(n.x,n.y,t,i,r)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next}while(n!==e);n.prevZ.nextZ=null,n.prevZ=null,function(e){var t,i,r,n,o,s,a,l,c=1;do{for(i=e,e=null,o=null,s=0;i;){for(s++,r=i,a=0,t=0;t<c&&(a++,r=r.nextZ);t++);for(l=c;a>0||l>0&&r;)0!==a&&(0===l||!r||i.z<=r.z)?(n=i,i=i.nextZ,a--):(n=r,r=r.nextZ,l--),o?o.nextZ=n:e=n,n.prevZ=o,o=n;i=r}o.nextZ=null,c*=2}while(s>1)}(n)}(e,r,n,o);for(var a,l,c=e;e.prev!==e.next;)if(a=e.prev,l=e.next,o?No(e,r,n,o):Uo(e))t.push(a.i/i),t.push(e.i/i),t.push(l.i/i),ns(e),e=l.next,c=l.next;else if((e=l)===c){s?1===s?Oo(e=Qo(Do(e),t,i),t,i,r,n,o,2):2===s&&jo(e,t,i,r,n,o):Oo(Do(e),t,i,r,n,o,1);break}}}function Uo(e){var t=e.prev,i=e,r=e.next;if(Wo(t,i,r)>=0)return!1;for(var n=e.next.next;n!==e.prev;){if(qo(t.x,t.y,i.x,i.y,r.x,r.y,n.x,n.y)&&Wo(n.prev,n,n.next)>=0)return!1;n=n.next}return!0}function No(e,t,i,r){var n=e.prev,o=e,s=e.next;if(Wo(n,o,s)>=0)return!1;for(var a=n.x<o.x?n.x<s.x?n.x:s.x:o.x<s.x?o.x:s.x,l=n.y<o.y?n.y<s.y?n.y:s.y:o.y<s.y?o.y:s.y,c=n.x>o.x?n.x>s.x?n.x:s.x:o.x>s.x?o.x:s.x,u=n.y>o.y?n.y>s.y?n.y:s.y:o.y>s.y?o.y:s.y,h=$o(a,l,t,i,r),d=$o(c,u,t,i,r),p=e.prevZ,f=e.nextZ;p&&p.z>=h&&f&&f.z<=d;){if(p!==e.prev&&p!==e.next&&qo(n.x,n.y,o.x,o.y,s.x,s.y,p.x,p.y)&&Wo(p.prev,p,p.next)>=0)return!1;if(p=p.prevZ,f!==e.prev&&f!==e.next&&qo(n.x,n.y,o.x,o.y,s.x,s.y,f.x,f.y)&&Wo(f.prev,f,f.next)>=0)return!1;f=f.nextZ}for(;p&&p.z>=h;){if(p!==e.prev&&p!==e.next&&qo(n.x,n.y,o.x,o.y,s.x,s.y,p.x,p.y)&&Wo(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;f&&f.z<=d;){if(f!==e.prev&&f!==e.next&&qo(n.x,n.y,o.x,o.y,s.x,s.y,f.x,f.y)&&Wo(f.prev,f,f.next)>=0)return!1;f=f.nextZ}return!0}function Qo(e,t,i){var r=e;do{var n=r.prev,o=r.next.next;!Xo(n,o)&&Yo(n,r,r.next,o)&&ts(n,o)&&ts(o,n)&&(t.push(n.i/i),t.push(r.i/i),t.push(o.i/i),ns(r),ns(r.next),r=e=o),r=r.next}while(r!==e);return Do(r)}function jo(e,t,i,r,n,o){var s=e;do{for(var a=s.next.next;a!==s.prev;){if(s.i!==a.i&&Ko(s,a)){var l=is(s,a);return s=Do(s,s.next),l=Do(l,l.next),Oo(s,t,i,r,n,o),void Oo(l,t,i,r,n,o)}a=a.next}s=s.next}while(s!==e)}function Vo(e,t){return e.x-t.x}function Ho(e,t){if(t=function(e,t){var i,r=t,n=e.x,o=e.y,s=-1/0;do{if(o<=r.y&&o>=r.next.y&&r.next.y!==r.y){var a=r.x+(o-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(a<=n&&a>s){if(s=a,a===n){if(o===r.y)return r;if(o===r.next.y)return r.next}i=r.x<r.next.x?r:r.next}}r=r.next}while(r!==t);if(!i)return null;if(n===s)return i;var l,c=i,u=i.x,h=i.y,d=1/0;r=i;do{n>=r.x&&r.x>=u&&n!==r.x&&qo(o<h?n:s,o,u,h,o<h?s:n,o,r.x,r.y)&&(l=Math.abs(o-r.y)/(n-r.x),ts(r,e)&&(l<d||l===d&&(r.x>i.x||r.x===i.x&&Go(i,r)))&&(i=r,d=l)),r=r.next}while(r!==c);return i}(e,t)){var i=is(t,e);Do(t,t.next),Do(i,i.next)}}function Go(e,t){return Wo(e.prev,e,t.prev)<0&&Wo(t.next,e,e.next)<0}function $o(e,t,i,r,n){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)*n)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*n)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Zo(e){var t=e,i=e;do{(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next}while(t!==e);return i}function qo(e,t,i,r,n,o,s,a){return(n-s)*(t-a)-(e-s)*(o-a)>=0&&(e-s)*(r-a)-(i-s)*(t-a)>=0&&(i-s)*(o-a)-(n-s)*(r-a)>=0}function Ko(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==t.i&&i.next.i!==t.i&&Yo(i,i.next,e,t))return!0;i=i.next}while(i!==e);return!1}(e,t)&&(ts(e,t)&&ts(t,e)&&function(e,t){var i=e,r=!1,n=(e.x+t.x)/2,o=(e.y+t.y)/2;do{i.y>o!=i.next.y>o&&i.next.y!==i.y&&n<(i.next.x-i.x)*(o-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next}while(i!==e);return r}(e,t)&&(Wo(e.prev,e,t.prev)||Wo(e,t.prev,t))||Xo(e,t)&&Wo(e.prev,e,e.next)>0&&Wo(t.prev,t,t.next)>0)}function Wo(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function Xo(e,t){return e.x===t.x&&e.y===t.y}function Yo(e,t,i,r){var n=es(Wo(e,t,i)),o=es(Wo(e,t,r)),s=es(Wo(i,r,e)),a=es(Wo(i,r,t));return n!==o&&s!==a||!(0!==n||!Jo(e,i,t))||!(0!==o||!Jo(e,r,t))||!(0!==s||!Jo(i,e,r))||!(0!==a||!Jo(i,t,r))}function Jo(e,t,i){return t.x<=Math.max(e.x,i.x)&&t.x>=Math.min(e.x,i.x)&&t.y<=Math.max(e.y,i.y)&&t.y>=Math.min(e.y,i.y)}function es(e){return e>0?1:e<0?-1:0}function ts(e,t){return Wo(e.prev,e,e.next)<0?Wo(e,t,e.next)>=0&&Wo(e,e.prev,t)>=0:Wo(e,t,e.prev)<0||Wo(e,e.next,t)<0}function is(e,t){var i=new os(e.i,e.x,e.y),r=new os(t.i,t.x,t.y),n=e.next,o=t.prev;return e.next=t,t.prev=e,i.next=n,n.prev=i,r.next=i,i.prev=r,o.next=r,r.prev=o,r}function rs(e,t,i,r){var n=new os(e,t,i);return r?(n.next=r.next,n.prev=r,r.next.prev=n,r.next=n):(n.prev=n,n.next=n),n}function ns(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function os(e,t,i){this.i=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function ss(e,t,i,r){for(var n=0,o=t,s=i-r;o<i;o+=r)n+=(e[s]-e[o])*(e[o+1]+e[s+1]),s=o;return n}zo.deviation=function(e,t,i,r){var n=t&&t.length,o=n?t[0]*i:e.length,s=Math.abs(ss(e,0,o,i));if(n)for(var a=0,l=t.length;a<l;a++){var c=t[a]*i,u=a<l-1?t[a+1]*i:e.length;s-=Math.abs(ss(e,c,u,i))}var h=0;for(a=0;a<r.length;a+=3){var d=r[a]*i,p=r[a+1]*i,f=r[a+2]*i;h+=Math.abs((e[d]-e[f])*(e[p+1]-e[d+1])-(e[d]-e[p])*(e[f+1]-e[d+1]))}return 0===s&&0===h?0:Math.abs((h-s)/s)},zo.flatten=function(e){for(var t=e[0][0].length,i={vertices:[],holes:[],dimensions:t},r=0,n=0;n<e.length;n++){for(var o=0;o<e[n].length;o++)for(var s=0;s<t;s++)i.vertices.push(e[n][o][s]);n>0&&(r+=e[n-1].length,i.holes.push(r))}return i},Fo.default=ko;var as=[0,0,1];function ls(e,t,i,r){var n,o,s,a,l,c,u,h,d,p=r.texcoord_index,f=r.texcoord_scale,A=r.texcoord_normalize,m=t.vertex_elements,g=e.length,_=0;if(p){A=A||1;var y=f||Io;n=y[0],o=y[1],s=y[2],a=y[3]}for(var v=0;v<g;v++){var x=e[v],b=t.vertex_count,w=(d=Fo.flatten(x),Fo(d.vertices,d.holes,d.dimensions)),T=w.length;if(T){var B;p&&(l=(B=an.findBoundingBox(x))[0],c=B[1],u=(s-n)/(B[2]-l),h=(a-o)/(B[3]-c));for(var C=0;C<x.length;C++)for(var S=x[C],E=0;E<S.length;E++){var M=S[E];i[0]=M[0],i[1]=M[1],p&&(i[p+0]=((M[0]-l)*u+n)*A,i[p+1]=((M[1]-c)*h+o)*A),t.addVertex(i)}for(var I=0;I<T;I++)m.push(b+w[I]);_+=T/3}}return _}var cs='uniform vec2 u_resolution;\nuniform float u_time;\nuniform vec3 u_map_position;\nuniform vec4 u_tile_origin;\nuniform float u_tile_proxy_order_offset;\nuniform float u_meters_per_pixel;\nuniform float u_device_pixel_ratio;\n\nuniform mat4 u_model;\nuniform mat4 u_modelView;\nuniform mat3 u_normalMatrix;\nuniform mat3 u_inverseNormalMatrix;\n\nattribute vec4 a_position;\nattribute vec4 a_color;\n\n// Optional normal attribute, otherwise default to up\n#ifdef TANGRAM_NORMAL_ATTRIBUTE\n    attribute vec3 a_normal;\n    #define TANGRAM_NORMAL a_normal\n#else\n    #define TANGRAM_NORMAL vec3(0., 0., 1.)\n#endif\n\n// Optional dynamic line extrusion\n#ifdef TANGRAM_EXTRUDE_LINES\n    attribute vec2 a_extrude; // extrusion direction in xy plane\n    attribute vec2 a_offset;  // offset direction in xy plane\n\n    // Polygon and line styles have slightly different VBO layouts, saving memory by optimizing vertex packing.\n    // All lines have a width scaling factor, but only some have a height (position.z) or offset.\n    // The vertex height is stored in different attributes to account for this.\n    attribute vec2 a_z_and_offset_scale; // stores vertex height in x, and offset scaling factor in y\n    #define TANGRAM_POSITION_Z a_z_and_offset_scale.x // vertex height is stored in separate line-specific attrib\n    #define TANGRAM_OFFSET_SCALING a_z_and_offset_scale.y // zoom scaling factor for line offset\n    #define TANGRAM_WIDTH_SCALING a_position.z // zoom scaling factor for line width (stored in position attrib)\n\n    uniform float u_v_scale_adjust; // scales texture UVs for line dash patterns w/fractional pixel width\n#else\n    #define TANGRAM_POSITION_Z a_position.z // vertex height\n#endif\n\nvarying vec4 v_position;\nvarying vec3 v_normal;\nvarying vec4 v_color;\nvarying vec4 v_world_position;\n\n// Optional texture UVs\n#if defined(TANGRAM_TEXTURE_COORDS) || defined(TANGRAM_EXTRUDE_LINES)\n    attribute vec2 a_texcoord;\n    varying vec2 v_texcoord;\n#endif\n\n// Optional model position varying for tile coordinate zoom\n#ifdef TANGRAM_MODEL_POSITION_BASE_ZOOM_VARYING\n    varying vec4 v_modelpos_base_zoom;\n#endif\n\n#if defined(TANGRAM_LIGHTING_VERTEX)\n    varying vec4 v_lighting;\n#endif\n\n#define TANGRAM_UNPACK_SCALING(x) (x / 1024.)\n\n#pragma tangram: attributes\n#pragma tangram: camera\n#pragma tangram: material\n#pragma tangram: lighting\n#pragma tangram: raster\n#pragma tangram: global\n\nvoid main() {\n    // Initialize globals\n    #pragma tangram: setup\n\n    // Texture UVs\n    #ifdef TANGRAM_TEXTURE_COORDS\n        v_texcoord = a_texcoord;\n        #ifdef TANGRAM_EXTRUDE_LINES\n            v_texcoord.y *= u_v_scale_adjust;\n        #endif\n    #endif\n\n    // Pass model position to fragment shader\n    #ifdef TANGRAM_MODEL_POSITION_BASE_ZOOM_VARYING\n        v_modelpos_base_zoom = modelPositionBaseZoom();\n    #endif\n\n    // Position\n    vec4 position = vec4(a_position.xy, TANGRAM_POSITION_Z / TANGRAM_HEIGHT_SCALE, 1.); // convert height back to meters\n\n    #ifdef TANGRAM_EXTRUDE_LINES\n        vec2 _extrude = a_extrude.xy;\n        vec2 _offset = a_offset.xy;\n\n        // Adjust line width based on zoom level, to prevent proxied lines\n        // from being either too small or too big.\n        // "Flattens" the zoom between 1-2 to peg it to 1 (keeps lines from\n        // prematurely shrinking), then interpolate and clamp to 4 (keeps lines\n        // from becoming too small when far away).\n        float _dz = clamp(u_map_position.z - u_tile_origin.z, 0., 4.);\n        _dz += step(1., _dz) * (1. - _dz) + mix(0., 2., clamp((_dz - 2.) / 2., 0., 1.));\n\n        // Interpolate line width between zooms\n        float _mdz = (_dz - 0.5) * 2.; // zoom from mid-point\n        _extrude -= _extrude * TANGRAM_UNPACK_SCALING(TANGRAM_WIDTH_SCALING) * _mdz;\n\n        // Interpolate line offset between zooms\n        // Scales from the larger value to the smaller one\n        float _dwdz = TANGRAM_UNPACK_SCALING(TANGRAM_OFFSET_SCALING);\n        float _sdwdz = sign(step(0., _dwdz) - 0.5); // sign indicates "direction" of scaling\n        _offset -= _offset * abs(_dwdz) * ((1.-step(0., _sdwdz)) - (_dz * -_sdwdz)); // scale "up" or "down"\n\n        // Scale line width and offset to be consistent in screen space\n        float _ssz = exp2(-_dz - (u_tile_origin.z - u_tile_origin.w));\n        _extrude *= _ssz;\n        _offset *= _ssz;\n\n        // Modify line width before extrusion\n        #ifdef TANGRAM_BLOCK_WIDTH\n            float width = 1.;\n            #pragma tangram: width\n            _extrude *= width;\n        #endif\n\n        position.xy += _extrude + _offset;\n    #endif\n\n    // World coordinates for 3d procedural textures\n    v_world_position = wrapWorldPosition(u_model * position);\n\n    // Adjust for tile and view position\n    position = u_modelView * position;\n\n    // Modify position before camera projection\n    #pragma tangram: position\n\n    // Setup varyings\n    v_position = position;\n    v_normal = normalize(u_normalMatrix * TANGRAM_NORMAL);\n    v_color = a_color;\n\n    #if defined(TANGRAM_LIGHTING_VERTEX)\n        // Vertex lighting\n        vec3 normal = v_normal;\n\n        // Modify normal before lighting\n        #pragma tangram: normal\n\n        // Pass lighting intensity to fragment shader\n        v_lighting = calculateLighting(position.xyz - u_eye, normal, vec4(1.));\n    #endif\n\n    // Camera\n    cameraProjection(position);\n\n    // +1 is to keep all layers including proxies > 0\n    applyLayerOrder(a_position.w + u_tile_proxy_order_offset + 1., position);\n\n    gl_Position = position;\n}\n',us="uniform vec2 u_resolution;\nuniform float u_time;\nuniform vec3 u_map_position;\nuniform vec4 u_tile_origin;\nuniform float u_meters_per_pixel;\nuniform float u_device_pixel_ratio;\n\nuniform mat3 u_normalMatrix;\nuniform mat3 u_inverseNormalMatrix;\n\nvarying vec4 v_position;\nvarying vec3 v_normal;\nvarying vec4 v_color;\nvarying vec4 v_world_position;\n\n#ifdef TANGRAM_EXTRUDE_LINES\n    uniform bool u_has_line_texture;\n    uniform sampler2D u_texture;\n    uniform float u_texture_ratio;\n    uniform vec4 u_dash_background_color;\n    uniform float u_has_dash;\n#endif\n\n#define TANGRAM_NORMAL v_normal\n\n#if defined(TANGRAM_TEXTURE_COORDS) || defined(TANGRAM_EXTRUDE_LINES)\n    varying vec2 v_texcoord;\n#endif\n\n#ifdef TANGRAM_MODEL_POSITION_BASE_ZOOM_VARYING\n    varying vec4 v_modelpos_base_zoom;\n#endif\n\n#if defined(TANGRAM_LIGHTING_VERTEX)\n    varying vec4 v_lighting;\n#endif\n\n#pragma tangram: attributes\n#pragma tangram: camera\n#pragma tangram: material\n#pragma tangram: lighting\n#pragma tangram: raster\n#pragma tangram: global\n\nvoid main (void) {\n    // Initialize globals\n    #pragma tangram: setup\n\n    vec4 color = v_color;\n    vec3 normal = TANGRAM_NORMAL;\n\n    // Apply raster to vertex color\n    #ifdef TANGRAM_RASTER_TEXTURE_COLOR\n        vec4 _raster_color = sampleRaster(0);\n\n        #if defined(TANGRAM_BLEND_OPAQUE) || defined(TANGRAM_BLEND_TRANSLUCENT) || defined(TANGRAM_BLEND_MULTIPLY)\n            // Raster sources can optionally mask by the alpha channel, which will render with only full or no alpha.\n            // This is used for handling transparency outside the raster image in some blend modes,\n            // which either don't support alpha, or would cause transparent pixels to write to the depth buffer,\n            // obscuring geometry underneath.\n            #ifdef TANGRAM_HAS_MASKED_RASTERS   // skip masking logic if no masked raster sources\n            #ifndef TANGRAM_ALL_MASKED_RASTERS  // skip source check for masking if *all* raster sources are masked\n            if (u_raster_mask_alpha) {\n            #else\n            {\n            #endif\n                #if defined(TANGRAM_BLEND_TRANSLUCENT) || defined(TANGRAM_BLEND_MULTIPLY)\n                if (_raster_color.a < TANGRAM_EPSILON) {\n                    discard;\n                }\n                #else // TANGRAM_BLEND_OPAQUE\n                if (_raster_color.a < 1. - TANGRAM_EPSILON) {\n                    discard;\n                }\n                // only allow full alpha in opaque blend mode (avoids artifacts blending w/canvas tile background)\n                _raster_color.a = 1.;\n                #endif\n            }\n            #endif\n        #endif\n\n        color *= _raster_color; // multiplied to tint texture color\n    #endif\n\n    // Apply line texture\n    #ifdef TANGRAM_EXTRUDE_LINES\n    { // enclose in scope to avoid leakage of internal variables\n        if (u_has_line_texture) {\n            vec2 _line_st = vec2(v_texcoord.x, fract(v_texcoord.y / u_texture_ratio));\n            vec4 _line_color = texture2D(u_texture, _line_st);\n\n            // If the line has a dash pattern, the line texture indicates if the current fragment should be\n            // the dash foreground or background color. If the line doesn't have a dash pattern,\n            // the line texture color is used directly (but also tinted by the vertex color).\n            color = mix(\n                color * _line_color, // no dash: tint the line texture with the vertex color\n                mix(u_dash_background_color, color, _line_color.a), // choose dash foreground or background color\n                u_has_dash // 0 if no dash, 1 if has dash\n            );\n\n            // Use alpha discard test as a lower-quality substitute for blending\n            #if defined(TANGRAM_BLEND_OPAQUE)\n                if (color.a < TANGRAM_ALPHA_TEST) {\n                    discard;\n                }\n            #endif\n        }\n    }\n    #endif\n\n    // First, get normal from raster tile (if applicable)\n    #ifdef TANGRAM_RASTER_TEXTURE_NORMAL\n        normal = normalize(sampleRaster(0).rgb * 2. - 1.);\n    #endif\n\n    // Second, alter normal with normal map texture (if applicable)\n    #if defined(TANGRAM_LIGHTING_FRAGMENT) && defined(TANGRAM_MATERIAL_NORMAL_TEXTURE)\n        calculateNormal(normal);\n    #endif\n\n    // Normal modification applied here for fragment lighting or no lighting,\n    // and in vertex shader for vertex lighting\n    #if !defined(TANGRAM_LIGHTING_VERTEX)\n        #pragma tangram: normal\n    #endif\n\n    // Color modification before lighting is applied\n    #pragma tangram: color\n\n    #if defined(TANGRAM_LIGHTING_FRAGMENT)\n        // Calculate per-fragment lighting\n        color = calculateLighting(v_position.xyz - u_eye, normal, color);\n    #elif defined(TANGRAM_LIGHTING_VERTEX)\n        // Apply lighting intensity interpolated from vertex shader\n        color *= v_lighting;\n    #endif\n\n    // Post-processing effects (modify color after lighting)\n    #pragma tangram: filter\n\n    gl_FragColor = color;\n}\n",hs=Object.create(vo);Object.assign(hs,{name:"polygons",built_in:!0,vertex_shader_src:cs,fragment_shader_src:us,selection:!0,init:function(){vo.init.apply(this,arguments),this.defines.TANGRAM_NORMAL_ATTRIBUTE=!0,this.defines.TANGRAM_TEXTURE_COORDS=this.texcoords},_parseFeature:function(e,t,i){var r=this.feature_style;return r.color=this.parseColor(t.color,i),r.color?(r.alpha=Dn.evalCachedProperty(t.alpha,i),r.variant=t.variant,r.z=Dn.evalCachedDistanceProperty(t.z,i)||Dn.defaults.z,r.z*=an.height_scale,r.extrude=Dn.evalProperty(t.extrude,i),r.extrude&&(!0===r.extrude?(r.height=e.properties.height||Dn.defaults.height,r.min_height=e.properties.min_height||Dn.defaults.min_height):"number"==typeof r.extrude?(r.height=r.extrude,r.min_height=0):Array.isArray(r.extrude)&&(r.min_height=r.extrude[0],r.height=r.extrude[1]),r.height*=an.height_scale,r.min_height*=an.height_scale),r.tile_edges=t.tile_edges,r):null},_preprocess:function(e){return e.color=Dn.createColorPropertyCache(e.color),e.alpha=Dn.createPropertyCache(e.alpha),e.z=Dn.createPropertyCache(e.z,Dn.parseUnits),this.computeVariant(e),e},computeVariant:function(e){var t=e.interactive?1:0,i=null!=e.extrude?1:0,r=this.texcoords?1:0,n=this.getBlendOrderForDraw(e),o=[t,i,r,n].join("/");e.variant=o,null==this.variants[o]&&(this.variants[o]={key:o,blend_order:n,mesh_order:0,selection:t,normal:i,texcoords:r})},vertexLayoutForMeshVariant:function(e){if(null==this.vertex_layouts[e.key]){var t=[{name:"a_position",size:4,type:Xn.SHORT,normalized:!1},{name:"a_normal",size:3,type:Xn.BYTE,normalized:!0,static:e.normal?null:[0,0,1]},{name:"a_color",size:4,type:Xn.UNSIGNED_BYTE,normalized:!0},{name:"a_selection_color",size:4,type:Xn.UNSIGNED_BYTE,normalized:!0,static:e.selection?null:[0,0,0,0]},{name:"a_texcoord",size:2,type:Xn.UNSIGNED_SHORT,normalized:!0,static:e.texcoords?null:[0,0]}];this.addCustomAttributesToAttributeList(t),this.vertex_layouts[e.key]=new Eo(t)}return this.vertex_layouts[e.key]},meshVariantTypeForDraw:function(e){return this.variants[e.variant]},makeVertexTemplate:function(e,t){var i=0;return this.vertex_template[i++]=0,this.vertex_template[i++]=0,this.vertex_template[i++]=e.z||0,this.vertex_template[i++]=this.scaleOrder(e.order),t.variant.normal&&(this.vertex_template[i++]=0,this.vertex_template[i++]=0,this.vertex_template[i++]=127),this.vertex_template[i++]=255*e.color[0],this.vertex_template[i++]=255*e.color[1],this.vertex_template[i++]=255*e.color[2],this.vertex_template[i++]=255*(null!=e.alpha?e.alpha:e.color[3]),t.variant.selection&&(this.vertex_template[i++]=255*e.selection_color[0],this.vertex_template[i++]=255*e.selection_color[1],this.vertex_template[i++]=255*e.selection_color[2],this.vertex_template[i++]=255*e.selection_color[3]),t.variant.texcoords&&(this.vertex_template[i++]=0,this.vertex_template[i++]=0),this.addCustomAttributesToVertexTemplate(e,i),this.vertex_template},buildPolygons:function(e,t,i){var r=this.getTileMesh(i.tile,this.meshVariantTypeForDraw(t)),n=r.vertex_data,o=n.vertex_layout,s=this.makeVertexTemplate(t,r),a={texcoord_index:o.index.a_texcoord,texcoord_normalize:65535,remove_tile_edges:!t.tile_edges,tile_edge_tolerance:an.tile_scale*i.tile.pad_scale*4,winding:i.winding};return t.extrude&&t.height?function(e,t,i,r,n,o,s,a,l){var c=l.remove_tile_edges,u=l.tile_edge_tolerance,h=l.texcoord_index,d=l.texcoord_scale,p=l.texcoord_normalize,f=l.winding,A=t+(r||0),m=t+i;o[2]=m;var g=ls(e,n,o,{texcoord_index:h,texcoord_scale:d,texcoord_normalize:p}),_=n.vertex_elements,y=n.vertex_count;if(h){p=p||1;var v=d||Io,x=v[0],b=v[1],w=v[2],T=v[3],B=[[x,T],[x,b],[w,b],[w,T]]}for(var C=e.length,S=0;S<C;S++)for(var E=e[S],M=0;M<E.length;M++)for(var I=E[M],P=0;P<I.length-1;P++)if(!c||!Po(I[P],I[P+1],u)){var L=void 0,F=void 0;"CCW"===f?(L=P,F=P+1):(L=P+1,F=P);var k=[[I[F][0],I[F][1],m],[I[F][0],I[F][1],A],[I[L][0],I[L][1],A],[I[L][0],I[L][1],m]],z=oo.normalize([I[F][0]-I[L][0],I[F][1]-I[L][1],0]),R=oo.cross(as,z);o[s+0]=R[0]*a,o[s+1]=R[1]*a,o[s+2]=R[2]*a;for(var D=0;D<k.length;D++)o[0]=k[D][0],o[1]=k[D][1],o[2]=k[D][2],h&&(o[h+0]=B[D][0]*p,o[h+1]=B[D][1]*p),n.addVertex(o);_.push(y+0),_.push(y+1),_.push(y+2),_.push(y+2),_.push(y+3),_.push(y+0),y+=4,g+=2}return g}(e,t.z,t.height,t.min_height,n,s,o.index.a_normal,127,a):ls(e,n,s,a)}});var ds=[0,0],ps={butt:0,square:1,round:2},fs={miter:0,bevel:1,round:2},As=3,ms=5,gs=65535,_s=an.tile_scale,ys=[0,0],vs=[1,0],xs=[.5,0];function bs(e,t){if(!(e.length<2)){var i,r,n,o,s=t.join_type,a=t.cap_type,l=t.closed_polygon,c=t.remove_tile_edges,u=t.tile_edge_tolerance,h=t.v_scale,d=t.miter_len_sq,p=null!=t.texcoord_index,f=0;if(l&&s===fs.miter){var A=function(e){if(Lo(e[0]))return 0;for(var t=0;t<e.length;t++)if(Lo(e[e.length-1-t]))return e.length-1-t;return 0}(e);if(0!==A){var m=function(e,t){for(var i=[],r=0;r<e.length;r++){var n=(r+t)%e.length;0!==n&&i.push(e[n])}return i.push(i[0]),i}(e,A);return t.extra_lines=t.extra_lines||[],void t.extra_lines.push(m)}}var g=0,_=e.length-1,y=0;for(i=e[g],r=e[g+1];oo.isEqual(i,r);)if(i=r,r=e[1+ ++g],y++,g===e.length-1)return;for(;oo.isEqual(e[_],e[_-1]);)if(y++,0==--_)return;if(!(e.length<2+y))if(o=oo.normalize(oo.perp(i,r)),c&&Po(i,r,u)){var v=ws(e,g,u);v&&(t.extra_lines=t.extra_lines||[],t.extra_lines.push(v))}else{l?function(e,t,i,r,n){void 0===r||Lo(e)?(Es(e,i,i,1,0,n,1),Es(e,i,i,0,0,n,-1)):r===fs.miter?Bs(0,e,t,i,n.miter_len_sq,!0,n):Cs(r,0,e,t,i,!0,n)}(i,n=oo.normalize(oo.perp(e[_-1],i)),o,s,t):(Lo(i)||(Ps(i,f,o,a,!0,t),p&&a!==ps.butt&&(f+=.5*h*t.texcoord_width)),Es(i,o,o,1,f,t,1),Es(i,o,o,0,f,t,-1)),p&&(f+=h*oo.length(oo.sub(r,i)));for(var x=g+1;x<_;x++){var b=x,w=x+1;if(i=e[b],r=e[w],!oo.isEqual(i,r)){if(c&&Po(i,r,u)){Es(i,o,o,1,f,t,1),Es(i,o,o,0,f,t,-1),Ss(1,t);var T=ws(e,b+1,u);return void(T&&(t.extra_lines=t.extra_lines||[],t.extra_lines.push(T)))}n=o,o=oo.normalize(oo.perp(i,r)),s===fs.miter?Bs(f,i,n,o,d,!1,t):Cs(s,f,i,n,o,!1,t),p&&(f+=h*oo.length(oo.sub(r,i)))}}i=r,n=o,l?function(e,t,i,r,n,o){if(Lo(e))Es(e,t,t,1,n,o,1),Es(e,t,t,0,n,o,-1),Ss(1,o);else{var s=Ts(t,i);r===fs.miter&&oo.lengthSq(s)>o.miter_len_sq&&(r=fs.bevel),r===fs.miter?(Es(e,s,t,1,n,o,1),Es(e,s,t,0,n,o,-1),Ss(1,o)):(Es(e,t,t,1,n,o,1),Es(e,t,t,0,n,o,-1),Ss(1,o))}}(i,n,o=oo.normalize(oo.perp(i,e[1])),s,f,t):(Es(i,n,o,1,f,t,1),Es(i,n,o,0,f,t,-1),Ss(1,t),Lo(i)||Ps(i,f,n,a,!1,t))}}}function ws(e,t,i){for(var r=t;e[r+1]&&Po(e[r],e[r+1],i);)r++;return e.length-r>=2&&e.slice(r)}function Ts(e,t){var i=oo.normalize(oo.add(e,t)),r=2/(1+Math.abs(oo.dot(e,i)));return oo.mult(i,r*r)}function Bs(e,t,i,r,n,o,s){var a=Ts(i,r);oo.lengthSq(a)>n?Cs(fs.bevel,e,t,i,r,o,s):(Es(t,a,a,1,e,s,1),Es(t,a,a,0,e,s,-1),o||Ss(1,s))}function Cs(e,t,i,r,n,o,s){var a=Ts(r,n),l=n[0]*r[1]-n[1]*r[0]>0;null!=s.texcoord_index&&(ys[1]=t,vs[1]=t),l?(Es(i,a,a,1,t,s,1),Es(i,r,a,0,t,s,-1),o||Ss(1,s),Is(i,oo.neg(r),a,oo.neg(n),a,ys,vs,ys,!1,e===fs.bevel,s),Es(i,a,a,1,t,s,1),Es(i,n,a,0,t,s,-1)):(Es(i,r,a,1,t,s,1),Es(i,a,a,0,t,s,-1),o||Ss(1,s),Is(i,r,oo.neg(a),n,a,vs,ys,vs,!1,e===fs.bevel,s),Es(i,n,a,1,t,s,1),Es(i,a,a,0,t,s,-1))}function Ss(e,t){for(var i=t.vertex_data.vertex_elements,r=t.vertex_data.vertex_count-2*e-2,n=0;n<e;n++)i.push(r+2*n+2),i.push(r+2*n+1),i.push(r+2*n+0),i.push(r+2*n+2),i.push(r+2*n+3),i.push(r+2*n+1),t.geom_count+=2}function Es(e,t,i,r,n,o,s){var a=o.vertex_template,l=o.vertex_data;a[0]=e[0],a[1]=e[1];var c=o.half_width*s;a[o.extrude_index+0]=t[0]*c,a[o.extrude_index+1]=t[1]*c,o.offset&&(a[o.offset_index+0]=i[0]*o.offset,a[o.offset_index+1]=i[1]*o.offset),null!=o.texcoord_index&&(a[o.texcoord_index+0]=r*gs,a[o.texcoord_index+1]=n*gs),l.addVertex(a)}var Ms=[0,0];function Is(e,t,i,r,n,o,s,a,l,c,u){for(var h=t[0]*r[1]-t[1]*r[0],d=oo.dot(t,r),p=Math.atan2(h,d);p>=Math.PI;)p-=2*Math.PI;if(c)f=1;else{var f=function(e,t){e<0&&(e=-e);var i=t>2*ms?Math.log2(t/ms):1;return Math.ceil(e/Math.PI*i)}(p,u.half_width);if(f<1)return}var A=u.vertex_data.vertex_count,m=u.vertex_data.vertex_elements;Es(e,i,n,s[0],s[1],u,1),Es(e,t,n,o[0],o[1],u,1);var g=t,_=null!=u.texcoord_index;if(_)if(l)var y=oo.sub(o,s);else{Ms=oo.copy(o);var v=oo.div(oo.sub(a,o),f)}var x,b,w=p/f,T=p<0?-1:1;h>0?(x=2,b=1):(x=1,b=2);for(var B=0;B<f;B++)0===B&&p<0&&(g=oo.neg(g)),g=oo.rot(g,w),_&&(l?(y=oo.rot(y,w),Ms[0]=y[0]+s[0],Ms[1]=y[1]*u.texcoord_width*u.v_scale+s[1]):Ms=oo.add(Ms,v)),Es(e,g,n,Ms[0],Ms[1],u,T),m.push(A+B+x),m.push(A),m.push(A+B+b)}function Ps(e,t,i,r,n,o){var s=oo.neg(i),a=null!=o.texcoord_index;switch(r){case ps.square:var l;n?(l=[i[1],-i[0]],Es(e,oo.add(i,l),i,1,t,o,1),Es(e,oo.add(s,l),i,0,t,o,1),a&&(t+=.5*o.texcoord_width*o.v_scale),Es(e,i,i,1,t,o,1),Es(e,s,i,0,t,o,1)):(l=[-i[1],i[0]],Es(e,i,i,1,t,o,1),Es(e,s,i,0,t,o,1),a&&(t+=.5*o.texcoord_width*o.v_scale),Es(e,oo.add(i,l),i,1,t,o,1),Es(e,oo.add(s,l),i,0,t,o,1)),Ss(1,o);break;case ps.round:var c,u,h=ys,d=vs,p=xs;n?(c=i,u=s,a&&(t+=.5*o.texcoord_width*o.v_scale,h=vs,d=ys,p=xs)):(c=s,u=i),a&&(ys[1]=t,vs[1]=t,xs[1]=t),Is(e,c,ds,u,i,h,p,d,!0,!1,o);break;case ps.butt:return}}var Ls=[255,255,255,255],Fs=[0,0,0,0],ks=Object.create(vo);Object.assign(ks,{name:"lines",built_in:!0,vertex_shader_src:cs,fragment_shader_src:us,selection:!0,init:function(){vo.init.apply(this,arguments),this.defines.TANGRAM_EXTRUDE_LINES=!0,this.defines.TANGRAM_TEXTURE_COORDS=!0,this.outline_feature_style={},this.inline_feature_style=this.feature_style,this.dash_textures={}},calcDistance:function(e,t){return Dn.evalCachedDistanceProperty(e,t)||0},calcDistanceNextZoom:function(e,t){t.zoom++;var i=this.calcDistance(e,t);return t.zoom--,i},calcWidth:function(e,t,i){var r=this.calcDistance(e.width,i);if(!(r<0)){var n;if(n=e.next_width?this.calcDistanceNextZoom(e.next_width,i):r/2,0===r&&0===n||n<0)return!1;if(t.width_unscaled=r,t.next_width_unscaled=n,e.next_width){var o=.5*(r+(n*=2));t.width=o*i.units_per_meter_overzoom,t.width_scale=1-n/o}else t.width=r*i.units_per_meter_overzoom,t.width_scale=0;return e.texcoords&&(e.inline_texcoord_width?t.texcoord_width=e.inline_texcoord_width:t.texcoord_width=(t.width_unscaled||t.next_width_unscaled)*i.units_per_meter_overzoom/i.tile.overzoom2),!0}},calcOffset:function(e,t,i){if(e.offset_precalc)t.offset=e.offset_precalc,t.offset_scale=e.offset_scale_precalc;else if(e.offset){var r=this.calcDistance(e.offset,i);if(e.next_offset){var n=2*this.calcDistanceNextZoom(e.next_offset,i);Math.abs(r)>=Math.abs(n)?(t.offset=r*i.units_per_meter_overzoom,t.offset_scale=0!==r?1-n/r:0):(t.offset=n*i.units_per_meter_overzoom,t.offset_scale=0!==n?-1*(1-r/n):0)}else t.offset=r*i.units_per_meter_overzoom,t.offset_scale=0}else t.offset=0,t.offset_scale=0},_parseFeature:function(e,t,i){var r=this.feature_style;if(!1!==this.calcWidth(t,r,i)&&(this.calcOffset(t,r,i),r.color=this.parseColor(t.color,i),r.color)){if(r.alpha=Dn.evalCachedProperty(t.alpha,i),r.variant=t.variant,r.z=Dn.evalCachedDistanceProperty(t.z,i)||Dn.defaults.z,r.height=e.properties.height||Dn.defaults.height,r.extrude=Dn.evalProperty(t.extrude,i),r.extrude&&("number"==typeof r.extrude?r.height=r.extrude:Array.isArray(r.extrude)&&(r.height=r.extrude[1])),r.extrude&&r.height&&(r.z+=r.height),r.z*=an.height_scale,r.cap=t.cap,r.join=t.join,r.miter_limit=t.miter_limit,r.tile_edges=t.tile_edges,r.outline=r.outline||{width:{},next_width:{},preprocessed:!0},t.outline&&!1!==t.outline.visible&&t.outline.color&&t.outline.width){var n=2*this.calcDistance(t.outline.width,i),o=2*this.calcDistanceNextZoom(t.outline.next_width,i);0===n&&0===o||n<0||o<0?(r.outline.width.value=null,r.outline.next_width.value=null,r.outline.color=null,r.outline.inline_texcoord_width=null,r.outline.texcoords=!1):(r.outline.width.value=n+r.width_unscaled,r.outline.next_width.value=o+r.next_width_unscaled,r.outline.inline_texcoord_width=r.texcoord_width,r.outline.offset_precalc=r.offset,r.outline.offset_scale_precalc=r.offset_scale,r.outline.color=t.outline.color,r.outline.alpha=t.outline.alpha,r.outline.interactive=t.outline.interactive,r.outline.cap=t.outline.cap,r.outline.join=t.outline.join,r.outline.miter_limit=t.outline.miter_limit,r.outline.texcoords=t.outline.texcoords,r.outline.extrude=t.outline.extrude,r.outline.z=t.outline.z,r.outline.style=t.outline.style,r.outline.variant=t.outline.variant,t.outline.order?r.outline.order=this.parseOrder(t.outline.order,i):r.outline.order=r.order,r.outline.order>r.order&&(r.outline.order=r.order),r.outline.order-=.5)}else r.outline.width.value=null,r.outline.next_width.value=null,r.outline.color=null,r.outline.inline_texcoord_width=null;return r}},_preprocess:function(e){if(e.color=Dn.createColorPropertyCache(e.color),e.alpha=Dn.createPropertyCache(e.alpha),e.width=Dn.createPropertyCache(e.width,Dn.parseUnits),e.width&&e.width.type!==Dn.CACHE_TYPE.STATIC&&(e.next_width=Dn.createPropertyCache(e.width,Dn.parseUnits)),e.offset=e.offset&&Dn.createPropertyCache(e.offset,Dn.parseUnits),e.offset&&e.offset.type!==Dn.CACHE_TYPE.STATIC&&(e.next_offset=Dn.createPropertyCache(e.offset,Dn.parseUnits)),e.z=Dn.createPropertyCache(e.z,Dn.parseUnits),e.dash=void 0!==e.dash?e.dash:this.dash,e.dash_key=e.dash&&this.dashTextureKey(e.dash),e.dash_background_color=void 0!==e.dash_background_color?e.dash_background_color:this.dash_background_color,e.dash_background_color=e.dash_background_color&&Dn.parseColor(e.dash_background_color),e.texture_merged=e.dash_key||(void 0!==e.texture?e.texture:this.texture),e.texcoords=this.texcoords||e.texture_merged?1:0,this.computeVariant(e),e.outline){e.outline.is_outline=!0,e.outline.style=e.outline.style||this.name,e.outline.color=Dn.createColorPropertyCache(e.outline.color),e.outline.alpha=Dn.createPropertyCache(e.outline.alpha),e.outline.width=Dn.createPropertyCache(e.outline.width,Dn.parseUnits),e.outline.next_width=Dn.createPropertyCache(e.outline.width,Dn.parseUnits),e.outline.interactive=null!=e.outline.interactive?e.outline.interactive:e.interactive,e.outline.cap=e.outline.cap||e.cap,e.outline.join=e.outline.join||e.join,e.outline.miter_limit=null!=e.outline.miter_limit?e.outline.miter_limit:e.miter_limit,e.outline.offset=e.offset,e.outline.extrude=e.extrude,e.outline.z=e.z;var t=this.styles[e.outline.style];t?(e.outline.dash=void 0!==e.outline.dash?e.outline.dash:t.dash,e.outline.texture=void 0!==e.outline.texture?e.outline.texture:t.texture,null!=e.outline.dash?(e.outline.dash_key=e.outline.dash&&this.dashTextureKey(e.outline.dash),e.outline.texture_merged=e.outline.dash_key):null===e.outline.dash||null!=e.outline.texture?(e.outline.dash_key=null,e.outline.texture_merged=e.outline.texture):(e.outline.dash=e.dash,e.outline.dash_key=e.outline.dash&&this.dashTextureKey(e.outline.dash),e.outline.texture_merged=e.outline.dash_key),e.outline.dash_background_color=void 0!==e.outline.dash_background_color?e.outline.dash_background_color:t.dash_background_color,e.outline.dash_background_color=void 0!==e.outline.dash_background_color?e.outline.dash_background_color:e.dash_background_color,e.outline.dash_background_color=e.outline.dash_background_color&&Dn.parseColor(e.outline.dash_background_color),e.outline.texcoords=t.texcoords||e.outline.texture_merged?1:0,void 0===e.outline.blend_order&&null!=e.blend_order&&(e.outline.blend_order=e.blend_order),t.computeVariant(e.outline)):(Ki({level:"warn",once:!0},"Layer group '"+e.layers.join(", ")+"': line 'outline' specifies non-existent draw style '"+e.outline.style+"' (or maybe the style is defined but is missing a 'base' or has another error), skipping outlines for features matching this layer group"),e.outline=null)}return e},dashTextureKey:function(e){return"__dash_"+JSON.stringify(e)},getDashTexture:function(e){var t=this.dashTextureKey(e);if(null==this.dash_textures[t]){this.dash_textures[t]=!0;var i=function(e,t){void 0===t&&(t={});var i=t.dash_color||Ls,r=t.background_color||Fs,n=e,o=t.scale||1;n.length%2==1&&Array.prototype.push.apply(n,n);for(var s=!0,a=[],l=0;l<n.length;l++){for(var c=Math.floor(n[l]*o),u=0;u<c;u++)Array.prototype.push.apply(a,s?i:r);s=!s}return a.reverse(),{pixels:a=new Uint8Array(a),length:a.length/4}}(e,{scale:20});Hr.create(this.gl,t,{data:i.pixels,height:i.length,width:1,filtering:"nearest"})}},endData:function(e){return new Promise(function(t,i){var r,n,o,s;return r=this,Promise.resolve(vo.endData.call(this,e)).then(function(e){try{if(n=e){n.uniforms.u_has_line_texture=!1,n.uniforms.u_texture=Hr.default,n.uniforms.u_v_scale_adjust=an.tile_scale,o=[],s=function(e){return new Promise((function(t,i){var s,a,l;if((s=n.meshes[e].variant).texture){if((a=n.meshes[e].uniforms=n.meshes[e].uniforms||{}).u_has_line_texture=!0,a.u_texture=s.texture,a.u_texture_ratio=1,s.dash&&(a.u_v_scale_adjust=20*an.tile_scale,a.u_has_dash=null!=s.dash_background_color?1:0,a.u_dash_background_color=s.dash_background_color||[0,0,0,0]),s.dash_key&&null==r.dash_textures[s.dash_key]){r.dash_textures[s.dash_key]=!0;var c=function(){try{return d.call(this)}catch(e){return i(e)}}.bind(this),u=function(e){try{return Ki("trace",r.name+": line dash texture create failed because style no longer on main thread"),c()}catch(e){return i(e)}};try{return Promise.resolve(Qi.postMessage(r.main_thread_target+".getDashTexture",s.dash)).then((function(e){try{return c()}catch(e){return u()}}),u)}catch(p){u()}}function d(){return null==Hr.textures[s.texture]?o.push(Hr.syncTexturesToWorker([s.texture]).then((function(e){var t=e[s.texture];t&&(a.u_texture_ratio=t.height/t.width)}))):(l=Hr.textures[s.texture],a.u_texture_ratio=l.height/l.width),h.call(this)}return d.call(this)}function h(){return t()}return h.call(this)}))};var a,l,c,u=[];for(a in n.meshes)u.push(a);function d(){return u.length?(l=u.shift(),Promise.resolve(s(l)).then((function(e){try{return d}catch(e){return i(e)}}),i)):[1]}return(c=function(e){for(;e;){if(e.then)return void e.then(c,i);try{if(e.pop){if(e.length)return e.pop()?p.call(this):e;e=d}else e=e.call(this)}catch(e){return i(e)}}}.bind(this))(d);function p(){return Promise.resolve(Promise.all(o)).then(function(e){try{return h.call(this)}catch(e){return i(e)}}.bind(this),i)}}function h(){return t(n)}return h.call(this)}catch(e){return i(e)}}.bind(this),i)}.bind(this))},computeVariant:function(e){var t=e.offset?1:0;t+="/"+e.texcoords,t+="/"+(e.interactive?1:0),t+="/"+(e.extrude||e.z?1:0),t+="/"+e.is_outline,e.dash_key&&(t+=e.dash_key,e.dash_background_color&&(t+=e.dash_background_color)),e.texture_merged&&(t+=e.texture_merged);var i=this.getBlendOrderForDraw(e);t=qr(t+="/"+i),e.variant=t,null==this.variants[t]&&(this.variants[t]={key:t,blend_order:i,mesh_order:e.is_outline?0:1,selection:e.interactive?1:0,offset:e.offset?1:0,z_or_offset:e.offset||e.extrude||e.z?1:0,texcoords:e.texcoords,texture:e.texture_merged,dash:e.dash,dash_key:e.dash_key,dash_background_color:e.dash_background_color})},vertexLayoutForMeshVariant:function(e){if(null==this.vertex_layouts[e.key]){var t=[{name:"a_position",size:4,type:Xn.SHORT,normalized:!1},{name:"a_extrude",size:2,type:Xn.SHORT,normalized:!1},{name:"a_offset",size:2,type:Xn.SHORT,normalized:!1,static:e.offset?null:[0,0]},{name:"a_z_and_offset_scale",size:2,type:Xn.SHORT,normalized:!1,static:e.z_or_offset?null:[0,0]},{name:"a_texcoord",size:2,type:Xn.UNSIGNED_SHORT,normalized:!0,static:e.texcoords?null:[0,0]},{name:"a_color",size:4,type:Xn.UNSIGNED_BYTE,normalized:!0},{name:"a_selection_color",size:4,type:Xn.UNSIGNED_BYTE,normalized:!0,static:e.selection?null:[0,0,0,0]}];this.addCustomAttributesToAttributeList(t),this.vertex_layouts[e.key]=new Eo(t)}return this.vertex_layouts[e.key]},meshVariantTypeForDraw:function(e){return this.variants[e.variant]},makeVertexTemplate:function(e,t){var i=0;return this.vertex_template[i++]=0,this.vertex_template[i++]=0,this.vertex_template[i++]=1024*e.width_scale,this.vertex_template[i++]=this.scaleOrder(e.order),this.vertex_template[i++]=0,this.vertex_template[i++]=0,t.variant.offset&&(this.vertex_template[i++]=0,this.vertex_template[i++]=0),t.variant.z_or_offset&&(this.vertex_template[i++]=e.z||0,this.vertex_template[i++]=1024*e.offset_scale),t.variant.texcoords&&(this.vertex_template[i++]=0,this.vertex_template[i++]=0),this.vertex_template[i++]=255*e.color[0],this.vertex_template[i++]=255*e.color[1],this.vertex_template[i++]=255*e.color[2],this.vertex_template[i++]=255*(null!=e.alpha?e.alpha:e.color[3]),t.variant.selection&&(this.vertex_template[i++]=255*e.selection_color[0],this.vertex_template[i++]=255*e.selection_color[1],this.vertex_template[i++]=255*e.selection_color[2],this.vertex_template[i++]=255*e.selection_color[3]),this.addCustomAttributesToVertexTemplate(e,i),this.vertex_template},buildLines:function(e,t,i,r){if(this.feature_style=this.outline_feature_style,t.outline&&null!=t.outline.color&&null!=t.outline.width.value){var n=this.styles[t.outline.style];n&&n.addFeature(i.feature,t.outline,i)}this.feature_style=this.inline_feature_style;var o=this.getTileMesh(i.tile,this.meshVariantTypeForDraw(t)),s=o.vertex_data,a=s.vertex_layout;return function(e,t,i,r,n,o,s,a){var l,c=t.cap?ps[t.cap]:ps.butt,u=t.join?fs[t.join]:fs.miter;if(u===fs.miter)var h=t.miter_limit||As,d=h*h;n.a_texcoord&&(l=1/(t.texcoord_width*_s));for(var p={closed_polygon:o,remove_tile_edges:s,tile_edge_tolerance:a,miter_len_sq:d,join_type:u,cap_type:c,vertex_data:i,vertex_template:r,half_width:t.width/2,extrude_index:n.a_extrude,offset_index:n.a_offset,v_scale:l,texcoord_index:n.a_texcoord,texcoord_width:t.texcoord_width,offset:t.offset,geom_count:0},f=0;f<e.length;f++)bs(e[f],p);if(p.extra_lines)for(var A=0;A<p.extra_lines.length;A++)bs(p.extra_lines[A],p);return p.geom_count}(e,t,s,this.makeVertexTemplate(t,o),a.index,r&&r.closed_polygon,!t.tile_edges&&r&&r.remove_tile_edges,an.tile_scale*i.tile.pad_scale*2)},buildPolygons:function(e,t,i){for(var r=0,n=0;n<e.length;n++)r+=this.buildLines(e[n],t,i,{closed_polygon:!0,remove_tile_edges:!0});return r}}),no("anchor",(function(e){return function(t){return e(this,"a","name",t)}}));var zs=128/Math.PI,Rs=16384/Math.PI,Ds=64,Os=65535,Us=128,Ns=[0,2,2,0],Qs=[1,1,3,3],js=new Array(4),Vs=["left","top-left","bottom-left"],Hs=["right","top-right","bottom-right"],Gs=["top","top-left","top-right"],$s=["bottom","bottom-left","bottom-right"],Zs={computeOffset:function(e,t,i,r){if(void 0===r&&(r=null),!i||"center"===i)return e;var n=[e[0],e[1]];return r=r||this.default_buffer,this.isLeftAnchor(i)?(n[0]-=t[0]/2,"left"===i&&(n[0]-=r[0])):this.isRightAnchor(i)&&(n[0]+=t[0]/2,"right"===i&&(n[0]+=r[1])),this.isTopAnchor(i)?(n[1]-=t[1]/2,"top"===i&&(n[1]-=r[2])):this.isBottomAnchor(i)&&(n[1]+=t[1]/2,"bottom"===i&&(n[1]+=r[3])),n},alignForAnchor:function(e){if(e&&"center"!==e){if(this.isLeftAnchor(e))return"right";if(this.isRightAnchor(e))return"left"}return"center"},isLeftAnchor:function(e){return Vs.indexOf(e)>-1},isRightAnchor:function(e){return Hs.indexOf(e)>-1},isTopAnchor:function(e){return Gs.indexOf(e)>-1},isBottomAnchor:function(e){return $s.indexOf(e)>-1},default_buffer:[2.5,2.5,1.5,.75],zero_buffer:[0,0,0,0]};function qs(e,t){return!(e[2]<t[0]||e[0]>t[2]||e[3]<t[1]||e[1]>t[3])}var Ks,Ws,Xs,Ys,Js=[[1,0],[0,1]],ea=[],ta=[],ia=function(){function e(e,t,i,r,n){this.dimension=[r/2,n/2],this.angle=i,this.centroid=[e,t],this.quad=null,this.axis_0=null,this.axis_1=null,this.update()}var t=e.prototype;return t.toJSON=function(){return{x:this.centroid[0],y:this.centroid[1],a:this.angle,w:this.dimension[0],h:this.dimension[1]}},t.getExtent=function(){return 0===this.angle?[this.quad[0],this.quad[1],this.quad[4],this.quad[5]]:[Math.min(this.quad[0],this.quad[2],this.quad[4],this.quad[6]),Math.min(this.quad[1],this.quad[3],this.quad[5],this.quad[7]),Math.max(this.quad[0],this.quad[2],this.quad[4],this.quad[6]),Math.max(this.quad[1],this.quad[3],this.quad[5],this.quad[7])]},t.updateAxes=function(){this.axis_0=oo.normalize([this.quad[4]-this.quad[6],this.quad[5]-this.quad[7]]),this.axis_1=oo.normalize([this.quad[4]-this.quad[2],this.quad[5]-this.quad[3]])},t.update=function(){var e=this.centroid,t=this.dimension[0],i=this.dimension[1];if(0===this.angle)this.quad=[e[0]-t,e[1]-i,e[0]+t,e[1]-i,e[0]+t,e[1]+i,e[0]-t,e[1]+i],this.axis_0=Js[0],this.axis_1=Js[1];else{var r=Math.cos(this.angle)*t,n=Math.sin(this.angle)*t,o=-Math.sin(this.angle)*i,s=Math.cos(this.angle)*i;this.quad=[e[0]-r-o,e[1]-n-s,e[0]+r-o,e[1]+n-s,e[0]+r+o,e[1]+n+s,e[0]-r+o,e[1]-n+s],this.updateAxes()}},e.projectToAxis=function(e,t,i){var r=e.quad;return Ks=r[0]*t[0]+r[1]*t[1],Ws=r[2]*t[0]+r[3]*t[1],Xs=r[4]*t[0]+r[5]*t[1],Ys=r[6]*t[0]+r[7]*t[1],i[0]=Math.min(Ks,Ws,Xs,Ys),i[1]=Math.max(Ks,Ws,Xs,Ys),i},e.axisCollide=function(t,i,r,n){return e.projectToAxis(t,r,ea),e.projectToAxis(i,r,ta),!(ta[0]>ea[1]||ta[1]<ea[0]||(e.projectToAxis(t,n,ea),e.projectToAxis(i,n,ta),ta[0]>ea[1]||ta[1]<ea[0]))},e.intersect=function(t,i){return e.axisCollide(t,i,t.axis_0,t.axis_1)&&e.axisCollide(t,i,i.axis_0,i.axis_1)},e}(),ra=function(){function e(t,i){void 0===i&&(i={}),this.id=e.nextLabelId(),this.type="",this.size=t,this.layout=i,this.position=null,this.angle=0,this.anchor=Array.isArray(this.layout.anchor)?this.layout.anchor[0]:this.layout.anchor,this.placed=null,this.offset=i.offset,this.unit_scale=this.layout.units_per_pixel,this.aabb=null,this.obb=null,this.align="center",this.throw_away=!1}var t=e.prototype;return t.toJSON=function(){return{id:this.id,type:this.type,obb:this.obb.toJSON(),position:this.position,angle:this.angle,size:this.size,offset:this.offset,breach:this.breach,may_repeat_across_tiles:this.may_repeat_across_tiles,layout:na(this.layout)}},t.update=function(){this.align=this.layout.align||Zs.alignForAnchor(this.anchor)},t.occluded=function(e,t){var i=this;void 0===t&&(t=null);var r=!1,n=e.aabb,o=e.obb;return n.length>0&&function(e,t,i){for(var r=0;r<t.length&&(!qs(e,t[r])||null==i(r));r++);}(this.aabb,n,(function(e){if(!t||n[e]!==t.aabb)return 0===i.obb.angle&&0===o[e].angle||ia.intersect(i.obb,o[e])?(r=!0,!0):void 0})),r},t.inTileBounds=function(){return this.aabb[0]>=0&&this.aabb[1]>-an.tile_scale&&this.aabb[0]<an.tile_scale&&this.aabb[1]<=0||this.aabb[2]>=0&&this.aabb[3]>-an.tile_scale&&this.aabb[2]<an.tile_scale&&this.aabb[3]<=0},t.mayRepeatAcrossTiles=function(){if(this.layout.collide)return!0;var e=this.layout.repeat_distance;return 0!==e&&(Math.abs(this.position[0])<e||Math.abs(this.position[0]-an.tile_scale)<e||Math.abs(this.position[1])<e||Math.abs(-(this.position[1]-an.tile_scale))<e)},t.discard=function(e,t){return void 0===t&&(t=null),!!this.throw_away||this.occluded(e,t)},e}();function na(e){return{priority:e.priority,collide:e.collide,repeat_distance:e.repeat_distance,repeat_group:e.repeat_group,buffer:e.buffer,italic:e.italic}}ra.add=function(e,t){if(e.placed=!0,e.aabb&&(t.aabb.push(e.aabb),t.obb.push(e.obb)),e.aabbs)for(var i=0;i<e.aabbs.length;i++)t.aabb.push(e.aabbs[i]),t.obb.push(e.obbs[i])},ra.id=0,ra.id_prefix=0,ra.id_multiplier=0,ra.nextLabelId=function(){return ra.id_prefix+ra.id++*ra.id_multiplier},ra.epsilon=.9999;var oa=function(){function e(e,t){this.key=e,this.repeat_dist=t,this.repeat_dist_sq=this.repeat_dist*this.repeat_dist,this.positions=[]}var t=e.prototype;return t.check=function(e){for(var t=e.position,i=0;i<this.positions.length;i++){var r=this.positions[i],n=t[0]-r[0],o=t[1]-r[1];if(n*n+o*o<this.repeat_dist_sq)return!0}},t.add=function(e){e&&e.position&&this.positions.push(e.position)},e.clear=function(e){this.groups[e]={}},e.check=function(e,t,i){if(t.repeat_distance&&t.repeat_group&&this.groups[i][t.repeat_group])return this.groups[i][t.repeat_group].check(e)},e.add=function(t,i,r){i.repeat_distance&&i.repeat_group&&(null==this.groups[r][i.repeat_group]&&(this.groups[r][i.repeat_group]=new e(i.repeat_group,i.repeat_distance*i.repeat_scale)),this.groups[r][i.repeat_group].add(t))},e}();oa.groups={};var sa=function(){function e(e,t){this.anchor=e,this.span=t,this.cells={}}var t=e.prototype;return t.addLabel=function(e){var t=this;e.aabb&&this.addLabelBboxes(e,e.aabb),e.aabbs&&e.aabbs.forEach((function(i){return t.addLabelBboxes(e,i)}))},t.addLabelBboxes=function(e,t){var i=[Math.max(Math.floor((t[0]-this.anchor.x)/this.span),0),Math.max(Math.floor(-(t[1]-this.anchor.y)/this.span),0),Math.max(Math.floor((t[2]-this.anchor.x)/this.span),0),Math.max(Math.floor(-(t[3]-this.anchor.y)/this.span),0)];e.cells=[];for(var r=i[1];r<=i[3];r++){this.cells[r]=this.cells[r]||{};for(var n=i[0];n<=i[2];n++)this.cells[r][n]=this.cells[r][n]||{aabb:[],obb:[]},e.cells.push(this.cells[r][n])}},e}(),aa={tiles:{},grid:null,initGrid:function(e){this.grid=null==e?null:new sa(e.anchor,e.span)},startTile:function(e,t){var i=void 0===t?{}:t,r=i.apply_repeat_groups,n=void 0===r||r,o=i.return_hidden,s=void 0!==o&&o,a=this.tiles[e]={bboxes:{aabb:[],obb:[]},objects:{},labels:{},styles:{},repeat:n,return_hidden:s};null==a.complete&&(a.complete=new Promise((function(e,t){a.resolve=e,a.reject=t})))},resetTile:function(e){delete this.tiles[e]},abortTile:function(e){this.tiles[e]&&this.tiles[e].resolve&&this.tiles[e].resolve([]),this.resetTile(e)},addStyle:function(e,t){this.tiles[t].styles[e]=!0},collide:function(e,t,i){var r=this.tiles[i];if(!r)return Ki("trace","Collision.collide() called with null tile",i,this.tiles,t,e),Promise.resolve([]);for(var n=r.objects,o=0;o<e.length;o++){var s=e[o],a=s.label.layout.priority;n[a]=n[a]||{},n[a][t]=n[a][t]||[],n[a][t].push(s)}return delete r.styles[t],0===Object.keys(r.styles).length&&this.endTile(i),r.complete.then((function(){return r.resolve=null,r.labels[t]||[]}))},endTile:function(e){var t=this.tiles[e],i=t.labels;this.grid&&this.addLabelsToGrid(e),t.repeat&&oa.clear(e);for(var r=Object.keys(t.objects).sort((function(e,t){return e-t})),n=0;n<r.length;n++){var o=t.objects[r[n]];if(o)for(var s in o){var a=o[s];i[s]=i[s]||[];for(var l=0;l<a.length;l++){var c=a[l];this.canBePlaced(c,e,c.linked,t)?c.linked?this.canBePlaced(c.linked,e,c,t)?(c.show=!0,(c.label.breach||c.linked.label.breach)&&(c.label.breach=!0,c.linked.label.breach=!0),(c.label.may_repeat_across_tiles||c.linked.label.may_repeat_across_tiles)&&(c.label.may_repeat_across_tiles=!0,c.linked.label.may_repeat_across_tiles=!0),i[s].push(c),this.place(c,e,t),this.place(c.linked,e,t)):t.return_hidden&&(c.show=!1,i[s].push(c)):(c.show=!0,i[s].push(c),this.place(c,e,t)):t.return_hidden&&(c.show=!1,i[s].push(c))}}}delete this.tiles[e],t.resolve()},addLabelsToGrid:function(e){var t=this,i=this.tiles[e];for(var r in i.objects){var n=i.objects[r];if(n)for(var o in n)n[o].forEach((function(e){return t.grid.addLabel(e.label)}))}},canBePlaced:function(e,t,i,r){void 0===i&&(i=null);var n=(void 0===r?{}:r).repeat,o=void 0===n||n,s=e.label,a=e.label.layout;if(null!=s.placed)return s.placed;var l=!a.collide;if(l||(l=this.grid&&s.cells?s.cells.reduce((function(e,t){return e&&s.discard(t,i&&i.label)&&(e=!1),e}),!0):!s.discard(this.tiles[t].bboxes,i&&i.label)),l){if(!o||!oa.check(s,a,t))return!0;s.placed=!1}else a.collide&&(s.placed=!1);return s.placed},place:function(e,t,i){var r=e.label,n=i.repeat,o=void 0===n||n;null==r.placed&&(o&&oa.add(r,r.layout,t),this.grid&&r.cells?r.cells.forEach((function(e){return ra.add(r,e)})):ra.add(r,this.tiles[t].bboxes))}},la=function(e){function t(t,i,r,n){var o;return void 0===n&&(n=0),(o=e.call(this,i,r)||this).type="point",o.position=[t[0],t[1]],o.angle=n,o.parent=o.layout.parent,o.update(),o.start_anchor_index=1,o.degenerate=!(o.size[0]||o.size[1]||o.layout.buffer[0]||o.layout.buffer[1]),o.throw_away=!1,o}ft(t,e);var i=t.prototype;return i.update=function(){e.prototype.update.call(this),this.computeOffset(),this.updateBBoxes()},i.computeOffset=function(){if(this.offset=[this.layout.offset[0],this.layout.offset[1]],this.parent){var e=this.parent;this.offset=Zs.computeOffset(this.offset,e.size,e.anchor,Zs.zero_buffer),this.offset=Zs.computeOffset(this.offset,e.size,this.anchor,Zs.zero_buffer),e.offset!==Dn.zeroPair&&(this.offset===Dn.zeroPair?this.offset=e.offset:(this.offset[0]+=e.offset[0],this.offset[1]+=e.offset[1]))}this.offset=Zs.computeOffset(this.offset,this.size,this.anchor)},i.updateBBoxes=function(){var e=(this.size[0]+2*this.layout.buffer[0])*this.unit_scale*ra.epsilon,t=(this.size[1]+2*this.layout.buffer[1])*this.unit_scale*ra.epsilon;this.layout.italic&&(e+=5*this.unit_scale),this.obb=new ia(this.position[0]+this.offset[0]*this.unit_scale,this.position[1]-this.offset[1]*this.unit_scale,-this.angle,e,t),this.aabb=this.obb.getExtent(),this.inTileBounds&&(this.breach=!this.inTileBounds()),this.mayRepeatAcrossTiles&&(this.may_repeat_across_tiles=this.mayRepeatAcrossTiles())},i.discard=function(t,i){if(void 0===i&&(i=null),this.degenerate)return!1;if(e.prototype.discard.call(this,t,i)){if(Array.isArray(this.layout.anchor))for(var r=this.start_anchor_index;r<this.layout.anchor.length;r++)if(this.anchor=this.layout.anchor[r],this.update(),!e.prototype.discard.call(this,t,i))return!1;return!0}return!1},t}(ra);la.PLACEMENT={VERTEX:0,MIDPOINT:1,SPACED:2,CENTROID:3};var ca=la.PLACEMENT,ua=80;function ha(e,t,i){var r=[],n=i.placement,o=Math.max(t[0],t[1])*i.placement_min_length_ratio*i.units_per_pixel;if(n===ca.SPACED){var s=function(e,t,i){var r=i.units_per_pixel,n=(i.placement_spacing||ua)*r,o=function(e){for(var t=0,i=0;i<e.length-1;i++)t+=pa(e[i],e[i+1]);return t}(e);if(o<=t)return!1;for(var s=Math.max(Math.floor(o/n),1),a=[],l=[],c=.5*(o-(s-1)*n),u=0;u<s;u++){var h=fa(e,c,t,i),d=h.position,p=h.angle;null!=d&&null!=p&&(a.push(d),l.push(p)),c+=n}return{positions:a,angles:l}}(e,o,i);if(!s)return[];for(var a=s.positions,l=s.angles,c=0;c<a.length;c++){var u=a[c],h=l[c];!0!==i.tile_edges&&Lo(u)||r.push(new la(u,t,i,h))}}else if(n===ca.VERTEX){for(var d,p,f=0;f<e.length-1;f++)if(d=e[f],p=e[f+1],!0===i.tile_edges||!Lo(d)){var A=da(d,p,i.angle);r.push(new la(d,t,i,A))}var m=da(d,p,i.angle);r.push(new la(p,t,i,m))}else if(n===ca.MIDPOINT)for(var g=0;g<e.length-1;g++){var _=e[g],y=e[g+1],v=[.5*(_[0]+y[0]),.5*(_[1]+y[1])];if((!0===i.tile_edges||!Lo(v))&&(!o||pa(_,y)>o)){var x=da(_,y,i.angle);r.push(new la(v,t,i,x))}}return r}function da(e,t,i){return void 0===i&&(i=0),"auto"===i?Math.atan2(t[0]-e[0],t[1]-e[1]):i}function pa(e,t){return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2))}function fa(e,t,i,r){for(var n,o,s=0,a=0;a<e.length-1;a++){var l=e[a],c=e[a+1],u=pa(l,c);if(!(u<=i)&&(s+=u)>t){n=Aa(l,c,s-t),o=da(l,c,r.angle);break}}return{position:n,angle:o}}function Aa(e,t,i){var r=i/pa(e,t);return[r*e[0]+(1-r)*t[0],r*e[1]+(1-r)*t[1]]}var ma={key:function(e){return[e.style,e.weight,e.family,e.px_size,e.fill,e.stroke,e.stroke_width,e.underline_width,e.background_color,e.background_width,e.background_stroke_color,e.background_stroke_width,e.transform,e.text_wrap,e.max_lines,e.supersample,Ji.device_pixel_ratio].join("/")},defaults:{style:"normal",weight:"normal",size:"12px",px_size:12,family:"Helvetica",fill:[1,1,1,1],text_wrap:15,max_lines:5,align:"center"},compute:function(e,t){var i={};e.font=e.font||this.defaults,i.supersample=e.supersample_text?1.5:1,i.can_articulate=e.can_articulate,i.fill=Dn.evalCachedColorPropertyWithAlpha(e.font.fill,e.font.alpha,t),i.fill=Ji.toCSSColor(i.fill),e.font.stroke&&e.font.stroke.color&&(i.stroke=Dn.evalCachedColorPropertyWithAlpha(e.font.stroke.color,e.font.stroke.alpha,t),i.stroke=Ji.toCSSColor(i.stroke),i.stroke_width=Dn.evalCachedProperty(e.font.stroke.width,t)),!0!==e.font.underline||i.can_articulate||(i.underline_width=1.5*i.supersample),e.font.background&&!i.can_articulate&&(i.background_color=Dn.evalCachedColorPropertyWithAlpha(e.font.background.color,e.font.background.alpha,t),i.background_color=Ji.toCSSColor(i.background_color),i.background_color&&(i.background_width=Dn.evalCachedProperty(e.font.background.width,t)),i.background_stroke_color=e.font.background.stroke&&e.font.background.stroke.color&&Dn.evalCachedColorPropertyWithAlpha(e.font.background.stroke.color,e.font.background.stroke.alpha,t),i.background_stroke_color&&(i.background_stroke_color=Ji.toCSSColor(i.background_stroke_color),i.background_stroke_width=null!=e.font.background.stroke.width?Dn.evalCachedProperty(e.font.background.stroke.width,t):1)),i.weight=Dn.evalCachedProperty(e.font.weight,t)||this.defaults.weight,"number"==typeof i.weight&&(i.weight=Math.min(Math.max(i.weight,1),1e3)),e.font.family?(i.family=e.font.family,i.family!==this.defaults.family&&(i.family+=", "+this.defaults.family)):i.family=this.defaults.family,i.style=e.font.style||this.defaults.style,i.transform=e.font.transform,i.px_size=Dn.evalCachedProperty(e.font.px_size,t)*i.supersample,i.font_css=this.fontCSS(i);var r=e.text_wrap;return null!=r||i.can_articulate||(r=!0),!0===r&&(r=this.defaults.text_wrap),i.text_wrap=r,i.max_lines=e.max_lines||this.defaults.max_lines,i},fontCSS:function(e){return[e.style,e.weight,e.px_size+"px",e.family].filter((function(e){return e})).join(" ")}},ga=t((function(e){!function(){function t(e,t){document.addEventListener?e.addEventListener("scroll",t,!1):e.attachEvent("scroll",t)}function i(e){this.a=document.createElement("div"),this.a.setAttribute("aria-hidden","true"),this.a.appendChild(document.createTextNode(e)),this.b=document.createElement("span"),this.c=document.createElement("span"),this.h=document.createElement("span"),this.f=document.createElement("span"),this.g=-1,this.b.style.cssText="max-width:none;display:inline-block;position:absolute;height:100%;width:100%;overflow:scroll;font-size:16px;",this.c.style.cssText="max-width:none;display:inline-block;position:absolute;height:100%;width:100%;overflow:scroll;font-size:16px;",this.f.style.cssText="max-width:none;display:inline-block;position:absolute;height:100%;width:100%;overflow:scroll;font-size:16px;",this.h.style.cssText="display:inline-block;width:200%;height:200%;font-size:16px;max-width:none;",this.b.appendChild(this.h),this.c.appendChild(this.f),this.a.appendChild(this.b),this.a.appendChild(this.c)}function r(e,t){e.a.style.cssText="max-width:none;min-width:20px;min-height:20px;display:inline-block;overflow:hidden;position:absolute;width:auto;margin:0;padding:0;top:-999px;left:-999px;white-space:nowrap;font:"+t+";"}function n(e){var t=e.a.offsetWidth,i=t+100;return e.f.style.width=i+"px",e.c.scrollLeft=i,e.b.scrollLeft=e.b.scrollWidth+100,e.g!==t&&(e.g=t,!0)}function o(e,i){function r(){var e=o;n(e)&&e.a.parentNode&&i(e.g)}var o=e;t(e.b,r),t(e.c,r),n(e)}function s(e,t){var i=t||{};this.family=e,this.style=i.style||"normal",this.weight=i.weight||"normal",this.stretch=i.stretch||"normal"}var a=null,l=null,c=null,u=null;function h(){if(null===c){var e=document.createElement("div");try{e.style.font="condensed 100px sans-serif"}catch(e){}c=""!==e.style.font}return c}function d(e,t){return[e.style,e.weight,h()?e.stretch:"","100px",t].join(" ")}s.prototype.load=function(e,t){var n=this,s=e||"BESbswy",c=0,h=t||3e3,p=(new Date).getTime();return new Promise((function(e,t){var f;if(null===u&&(u=!!document.fonts),(f=u)&&(null===l&&(l=/OS X.*Version\/10\..*Safari/.test(navigator.userAgent)&&/Apple/.test(navigator.vendor)),f=!l),f){f=new Promise((function(e,t){!function i(){(new Date).getTime()-p>=h?t():document.fonts.load(d(n,'"'+n.family+'"'),s).then((function(t){1<=t.length?e():setTimeout(i,25)}),(function(){t()}))}()}));var A=new Promise((function(e,t){c=setTimeout(t,h)}));Promise.race([A,f]).then((function(){clearTimeout(c),e(n)}),(function(){t(n)}))}else!function(e){document.body?e():document.addEventListener?document.addEventListener("DOMContentLoaded",(function t(){document.removeEventListener("DOMContentLoaded",t),e()})):document.attachEvent("onreadystatechange",(function t(){"interactive"!=document.readyState&&"complete"!=document.readyState||(document.detachEvent("onreadystatechange",t),e())}))}((function(){function l(){var t;(t=-1!=m&&-1!=g||-1!=m&&-1!=_||-1!=g&&-1!=_)&&((t=m!=g&&m!=_&&g!=_)||(null===a&&(t=/AppleWebKit\/([0-9]+)(?:\.([0-9]+))/.exec(window.navigator.userAgent),a=!!t&&(536>parseInt(t[1],10)||536===parseInt(t[1],10)&&11>=parseInt(t[2],10))),t=a&&(m==y&&g==y&&_==y||m==v&&g==v&&_==v||m==x&&g==x&&_==x)),t=!t),t&&(b.parentNode&&b.parentNode.removeChild(b),clearTimeout(c),e(n))}var u=new i(s),f=new i(s),A=new i(s),m=-1,g=-1,_=-1,y=-1,v=-1,x=-1,b=document.createElement("div");b.dir="ltr",r(u,d(n,"sans-serif")),r(f,d(n,"serif")),r(A,d(n,"monospace")),b.appendChild(u.a),b.appendChild(f.a),b.appendChild(A.a),document.body.appendChild(b),y=u.a.offsetWidth,v=f.a.offsetWidth,x=A.a.offsetWidth,function e(){if((new Date).getTime()-p>=h)b.parentNode&&b.parentNode.removeChild(b),t(n);else{var i=document.hidden;!0!==i&&void 0!==i||(m=u.a.offsetWidth,g=f.a.offsetWidth,_=A.a.offsetWidth,l()),c=setTimeout(e,50)}}(),o(u,(function(e){m=e,l()})),r(u,d(n,'"'+n.family+'",sans-serif')),o(f,(function(e){g=e,l()})),r(f,d(n,'"'+n.family+'",serif')),o(A,(function(e){_=e,l()})),r(A,d(n,'"'+n.family+'",monospace'))}))}))},e.exports=s}()})),_a={fonts_loaded:Promise.resolve(),last_loaded:null,loadFonts:function(e){var t=this,i=JSON.stringify(e)===this.last_loaded;return e&&!i&&function(){var i=[],r=function(r){Array.isArray(e[r])?e[r].forEach((function(e){return i.push(t.loadFontFace(r,e))})):i.push(t.loadFontFace(r,e[r]))};for(var n in e)r(n);t.last_loaded=JSON.stringify(e),t.fonts_loaded=Promise.all(i.filter((function(e){return e})))}(),this.fonts_loaded},loadFontFace:function(e,t){return new Promise(function(i,r){var n,o;if(null==t||"object"!=typeof t&&"external"!==t)return i();if(n={family:e},"object"==typeof t){if(Object.assign(n,t),"string"==typeof t.url)return Promise.resolve(this.injectFontFace(n)).then(function(e){try{return a.call(this)}catch(e){return r(e)}}.bind(this),r);function a(){return s.call(this)}return a.call(this)}function s(){var t=function(){try{return i()}catch(e){return r(e)}},s=function(i){try{return Ki("warn","Font face '"+e+"' is NOT available",n,i),t()}catch(e){return r(e)}};try{return n.weight="string"==typeof n.weight?n.weight.split(" ")[0]:n.weight,o=new ga(e,n),Promise.resolve(o.load()).then((function(i){try{return Ki("debug","Font face '"+e+"' is available",n),t()}catch(e){return s(e)}}),s)}catch(e){s(e)}}return s.call(this)}.bind(this))},injectFontFace:function(e){return new Promise(function(t,i){var r,n,o,s,a,l,c,u,h,d,p;if(r=e.family,n=e.url,o=e.weight,s=e.style,void 0===this.supports_native_font_loading&&(this.supports_native_font_loading=void 0!==window.FontFace),a=n,"blob:"===n.slice(0,5))return Promise.resolve(Ji.io(n,6e4,"arraybuffer")).then(function(e){try{if(a=e.body,l=new Uint8Array(a),this.supports_native_font_loading)a=l;else{for(c="",u=0;u<l.length;u++)c+=String.fromCharCode(l[u]);a="data:font/opentype;base64,"+btoa(c)}return f.call(this)}catch(e){return i(e)}}.bind(this),i);function f(){return this.supports_native_font_loading?("string"==typeof a?h=new FontFace(r,"url("+encodeURI(a)+")",{weight:o,style:s}):a instanceof Uint8Array&&(h=new FontFace(r,a,{weight:o,style:s})),document.fonts.add(h),Ki("trace","Adding FontFace to document.fonts:",h)):(d="\n                @font-face {\n                    font-family: '"+r+"';\n                    font-weight: "+(o||"normal")+";\n                    font-style: "+(s||"normal")+";\n                    src: url("+encodeURI(a)+");\n                }",(p=document.createElement("style")).appendChild(document.createTextNode("")),document.head.appendChild(p),p.sheet.insertRule(d,0),Ki("trace","Injecting CSS font face:",d)),t()}return f.call(this)}.bind(this))}},ya=new RegExp("[---]");function va(e){return ya.test(e)}var xa="\0-/:-@[-`{----\u2029-",ba=new RegExp("["+xa+"]+");function wa(e){return ba.test(e)}var Ta=new RegExp("^["+xa+"-]+"),Ba=new RegExp("["+xa+"-----]"),Ca=new RegExp("^[-----]+"),Sa="[------------------------------------------]",Ea=new RegExp("^.(?:"+Sa+"+)?([]\\W(?:"+Sa+"+)?)*"),Ma={Mongolian:"-"},Ia=Object.keys(Ma).map((function(e){return Ma[e]})).join(""),Pa=new RegExp("["+Ia+"]"),La=2;function Fa(e,t,i){var r=t?1:La;if(e.length<r)return[e];var n=e;if(i.segment[n])return i.stats.segment_hits++,i.segment[n];var o=[];if(Ta.exec(e)){o=e.split(Ba);for(var s=-1,a=0;a<o.length-1;a++){if(a>0){var l=Ca.exec(o[a]);l&&(o[a]=o[a].substring(l[0].length),o[a-1]+=l[0],s+=l[0].length)}s+=1+o[a].length,o[a]+=e.slice(s,s+1)}e=""}for(;e.length;){for(var c="",u=e,h=0;h<r&&u.length;h++){var d=(Ea.exec(u)||u)[0];c+=d,u=u.substring(d.length)}o.push(c),e=e.substring(c.length)}return t&&o.reverse(),i.stats.segment_misses++,i.segment[n]=o,o}var ka=function(){function e(e,t,i){void 0===t&&(t=1/0),void 0===i&&(i=1/0),this.width=0,this.height=0,this.lines=[],this.max_lines=t,this.text_wrap=i,this.context=e}var t=e.prototype;return t.createLine=function(e){return this.lines.length<this.max_lines&&new za(e,this.text_wrap)},t.push=function(e){if(this.lines.length<this.max_lines){var t=this.context.measureText(e.text).width;return e.width=t,t>this.width&&(this.width=Math.ceil(t)),this.lines.push(e),this.height+=e.height,!0}return this.addEllipsis(),!1},t.advance=function(e,t){return!!this.push(e)&&this.createLine(t)},t.addEllipsis=function(){var t=this.lines[this.lines.length-1],i=Math.ceil(this.context.measureText(e.ellipsis).width);t.append(e.ellipsis),t.width+=i,t.width>this.width&&(this.width=t.width)},t.finish=function(e){e?this.push(e):this.addEllipsis()},e.parse=function(t,i,r,n,o){var s;s="number"==typeof i?t.split(" "):[t];for(var a=new e(o,r,i),l=a.createLine(n),c=0;c<s.length;c++){for(var u=s[c].split("\n"),h=0===c,d=0;d<u.length&&l;d++){var p=u[d];va(p)&&wa(p[p.length-1])&&(p+="");var f=h?p:" "+p;if(i&&c>0&&l.exceedsTextwrap(f)){if(!(l=a.advance(l,n)))break;l.append(p),h=!0}else l.append(f);d<u.length-1&&(l=a.advance(l,n),h=!0)}c===s.length-1&&a.finish(l)}return a},e}();ka.ellipsis="...";var za=function(){function e(e,t){void 0===e&&(e=0),void 0===t&&(t=0),this.chars=0,this.text="",this.height=Math.ceil(e),this.text_wrap=t}var t=e.prototype;return t.append=function(e){this.chars+=e.length,this.text+=e},t.exceedsTextwrap=function(e){return e.length+this.chars>this.text_wrap},e}(),Ra=function(){function e(){this.createCanvas(),this.vertical_text_buffer=8,this.horizontal_text_buffer=4,this.background_size=4}var t=e.prototype;return t.createCanvas=function(){this.canvas=document.createElement("canvas"),this.canvas.style.backgroundColor="transparent",this.context=this.canvas.getContext("2d")},t.resize=function(e,t){this.canvas.width=e,this.canvas.height=t,this.context.clearRect(0,0,e,t)},t.setFont=function(e){var t=e.font_css,i=e.fill,r=e.stroke,n=e.stroke_width,o=e.px_size,s=e.supersample;this.px_size=o;var a=this.context,l=Ji.device_pixel_ratio*s;r&&n>0&&(a.strokeStyle=r,a.lineWidth=n*l),a.fillStyle=i,a.font=t,a.miterLimit=2},t.textSizes=function(e,t){return new Promise(function(i,r){return Promise.resolve(_a.loadFonts()).then(function(n){try{return i(Tr.add({type:"textSizes",run:this.processTextSizesTask.bind(this),texts:t,tile_id:e,cursor:{styles:Object.keys(t),texts:null,style_idx:null,text_idx:null}}))}catch(e){return r(e)}}.bind(this),r)}.bind(this))},t.processTextSizesTask=function(t){var i,r=t.cursor,n=t.texts;for(r.style_idx=r.style_idx||0;r.style_idx<r.styles.length;){var o=r.styles[r.style_idx];null==r.text_idx&&(r.text_idx=0,r.texts=Object.keys(n[o]));for(var s=n[o],a=!0;r.text_idx<r.texts.length;){var l=r.texts[r.text_idx],c=s[l],u=c.text_settings;if(a&&(this.setFont(u),a=!1),c.size=this.textSize(o,l,u).size,u.can_articulate){var h=!1,d=!1;if(va(l)&&(wa(l)?h=!0:d=!0),c.isRTL=h,c.no_curving=d||(i=l,Pa.test(i)),c.vertical_buffer=this.vertical_text_buffer,c.segment_sizes=[],!c.no_curving){var p=Fa(l,h,e.cache);c.segments=p;for(var f=0;f<p.length;f++)c.segment_sizes.push(this.textSize(o,p[f],u).size)}}if(r.text_idx++,!Tr.shouldContinue(t))return!1}r.text_idx=null,r.style_idx++}return Tr.finish(t,n),!0},t.textSize=function(t,i,r){var n=r.transform,o=r.text_wrap,s=r.max_lines,a=r.stroke_width,l=void 0===a?0:a,c=r.background_color,u=r.background_stroke_width,h=void 0===u?0:u,d=r.background_width,p=r.underline_width,f=void 0===p?0:p,A=r.supersample;if(e.cache.text[t]=e.cache.text[t]||{},e.cache.text[t][i])return e.cache.stats.text_hits++,e.cache.text[t][i];e.cache.stats.text_misses++,e.cache.text_count++;var m=Ji.device_pixel_ratio*A,g=this.applyTextTransform(i,n),_=this.context,y=this.vertical_text_buffer*m,v=(l+this.horizontal_text_buffer)*m;d=null!=d?d:this.background_size;var x=c||h?(d+h)*m:0,b=(2+f+(f?l+1:0))*m,w=this.px_size+b,T=ka.parse(g,o,s,w,_),B=T.width,C=T.height,S=T.lines,E=[(B+=2*x)/m,(C+=2*x)/m],M=[B+2*v,C+2*y],I=[M[0]/m,M[1]/m];return e.cache.text[t][i]={lines:S,size:{collision_size:E,texture_size:M,logical_size:I,horizontal_buffer:v,vertical_buffer:y,dpr:m,line_height:w,background_size:x}},e.cache.text[t][i]},t.drawTextMultiLine=function(e,t,i,r,n){var o=t[0],s=t[1],a=i.dpr,l=i.collision_size,c=i.texture_size,u=i.line_height,h=i.horizontal_buffer,d=i.vertical_buffer;if(r.background_color||r.background_stroke_color){var p=r.background_stroke_color,f=(r.background_stroke_width||0)*a;this.context.save(),r.background_color&&(this.context.fillStyle=r.background_color,this.context.fillRect(o+h+("curved"===n?c[0]:0)+f,s+d+f,a*l[0]-2*f,a*l[1]-2*f)),p&&f&&(this.context.strokeStyle=p,this.context.lineWidth=f,this.context.strokeRect(o+h+("curved"===n?c[0]:0)+.5*f,s+d+.5*f,a*l[0]-f,a*l[1]-f)),this.context.restore()}for(var A=r.underline_width||0,m=r.stroke_width||0,g=s-(A?.5*(A+m+1)*a:0),_=0;_<e.length;_++){var y=e[_];this.drawTextLine(y,[o,g],i,r,n),g+=u}this.drawTextDebug([o,s],i,n)},t.drawTextLine=function(e,t,i,r,n){var o,s=t[0],a=t[1],l=r.stroke,c=r.stroke_width,u=r.transform,h=r.align,d=void 0===h?"center":h,p=i.horizontal_buffer,f=i.vertical_buffer,A=i.texture_size,m=i.background_size,g=i.line_height,_=i.dpr,y=(r.underline_width||0)*_,v=this.applyTextTransform(e.text,u);"left"===d?o=s+p+m:"center"===d?o=s+A[0]/2-e.width/2:"right"===d&&(o=s+A[0]-e.width-p-m);var x=a+.75*f+g+m-.5*y,b=l&&c>0&&"curved"===n?A[0]:0;if(y){this.context.save(),this.context.strokeStyle=this.context.fillStyle,this.context.lineWidth=y;var w=x+(.5*c+2)*_+.5*this.context.lineWidth;this.context.beginPath(),this.context.moveTo(o+b,w),this.context.lineTo(o+b+e.width,w),this.context.stroke(),this.context.restore()}l&&c>0&&this.context.strokeText(v,o+b,x),this.context.fillText(v,o,x)},t.drawTextDebug=function(e,t,i){var r=e[0],n=e[1],o=t.dpr,s=t.horizontal_buffer,a=t.vertical_buffer,l=t.texture_size,c=t.collision_size;er.draw_label_collision_boxes&&(this.context.save(),this.context.strokeStyle="blue",this.context.lineWidth=2,this.context.strokeRect(r+s,n+a,o*c[0],o*c[1]),"curved"===i&&this.context.strokeRect(r+l[0]+s,n+a,o*c[0],o*c[1]),this.context.restore()),er.draw_label_texture_boxes&&(this.context.save(),this.context.strokeStyle="green",this.context.lineWidth=2,this.context.strokeRect(r+2,n+2,l[0]-4,l[1]-4),"curved"===i&&this.context.strokeRect(r+2+l[0],n+2,l[0]-4,l[1]-4),this.context.restore())},t.rasterize=function(e,t,i,r,n){return Tr.add({type:"rasterizeLabels",run:this.processRasterizeTask.bind(this),cancel:this.cancelRasterizeTask.bind(this),pause_factor:2,user_moving_view:!1,texts:e,textures:t,texture_prefix:r,gl:n,tile_id:i,cursor:{styles:Object.keys(e),texts:null,style_idx:0,text_idx:null,texture_idx:0,texture_resize:!0,texture_names:[]}})},t.processRasterizeTask=function(e){for(var t,i=e.cursor,r=e.texts,n=e.textures;i.texture_idx<e.textures.length;){for(t=n[i.texture_idx],i.texture_resize&&(i.texture_resize=!1,this.resize.apply(this,t.texture_size));i.style_idx<i.styles.length;){var o=i.styles[i.style_idx];null==i.text_idx&&(i.text_idx=0,i.texts=Object.keys(r[o]));for(var s=r[o],a=!0;i.text_idx<i.texts.length;){var l=i.texts[i.text_idx],c=s[l],u=c.text_settings;if(a&&(this.setFont(u),a=!1),u.can_articulate){c.texcoords=c.texcoords||{};for(var h=0;h<c.type.length;h++){var d=c.type[h];if("straight"===d){if(c.textures[h]!==i.texture_idx)continue;var p=c.isRTL?l.split().reverse().join():l,f=t.texcoord_cache[o][p],A=void 0;if(f.texcoord)A=f.texcoord;else{var m=f.texture_position,g=this.textSize(o,p,u),_=g.size,y=g.lines;this.drawTextMultiLine(y,m,_,u,d),A=Hr.getTexcoordsForSprite(m,_.texture_size,t.texture_size),f.texcoord=A}c.texcoords[d]={texcoord:A,texture_id:f.texture_id}}else if("curved"===d){var v=c.segments;c.texcoords.curved=c.texcoords.curved||[],c.texcoords_stroke=c.texcoords_stroke||[];for(var x=0;x<v.length;x++)if(c.textures[h][x]===i.texture_idx){var b=v[x],w=t.texcoord_cache[o][b],T=void 0,B=void 0;if(w.texcoord)T=w.texcoord,B=w.texcoord_stroke,c.texcoords_stroke.push(B);else{var C=w.texture_position,S=this.textSize(o,b,u),E=S.size,M=S.lines;this.drawTextMultiLine(M,C,E,u,d),T=Hr.getTexcoordsForSprite(C,E.texture_size,t.texture_size);var I=[C[0]+E.texture_size[0],C[1]];B=Hr.getTexcoordsForSprite(I,E.texture_size,t.texture_size),w.texcoord=T,w.texcoord_stroke=B,c.texcoords_stroke.push(B)}c.texcoords.curved.push({texcoord:T,texture_id:w.texture_id})}}}}else{var P=this.textSize(o,l,u).lines,L=Object.assign({},u);for(var F in c.align)c.align[F].texture_id===i.texture_idx&&(L.align=F,this.drawTextMultiLine(P,c.align[F].texture_position,c.size,L),c.align[F].texcoords=Hr.getTexcoordsForSprite(c.align[F].texture_position,c.size.texture_size,t.texture_size))}if(i.text_idx++,!Tr.shouldContinue(e))return!1}i.text_idx=null,i.style_idx++}var k=e.texture_prefix+i.texture_idx;Hr.create(e.gl,k,{element:this.canvas,filtering:"linear",UNPACK_PREMULTIPLY_ALPHA_WEBGL:!0}),Hr.retain(k),i.texture_names.push(k),i.texture_idx++,i.texture_resize=!0,i.style_idx=0}return Tr.finish(e,i.texture_names),!0},t.cancelRasterizeTask=function(e){Ki("trace","RasterizeTask: release textures ["+e.cursor.texture_names.join(", ")+"]"),e.cursor.texture_names.forEach((function(e){return Hr.release(e)}))},t.setTextureTextPositions=function(e,t){var i={cx:0,cy:0,width:0,height:0,column_width:0,texture_id:0,texcoord_cache:{}},r=[];for(var n in e){var o=e[n];for(var s in o){var a=o[s],l=void 0;if(a.text_settings.can_articulate){a.textures=[],i.texcoord_cache[n]=i.texcoord_cache[n]||{};for(var c=0;c<a.type.length;c++){var u=a.type[c];if("straight"===u){var h=a.isRTL?s.split().reverse().join():s;if(!i.texcoord_cache[n][h]){var d=a.size.texture_size;l=this.placeText(d[0],d[1],n,i,r,t),i.texcoord_cache[n][h]={texture_id:i.texture_id,texture_position:l}}a.textures[c]=i.texture_id}else if("curved"===u){a.textures[c]=[];for(var p=0;p<a.segment_sizes.length;p++){var f=a.segments[p];if(!i.texcoord_cache[n][f]){var A=a.segment_sizes[p].texture_size,m=2*A[0];l=this.placeText(m,A[1],n,i,r,t),i.texcoord_cache[n][f]={texture_id:i.texture_id,texture_position:l}}a.textures[c].push(i.texture_id)}}}}else{var g=a.size.texture_size;for(var _ in a.align)l=this.placeText(g[0],g[1],n,i,r,t),a.align[_].texture_id=i.texture_id,a.align[_].texture_position=l}}}return i.column_width>0&&i.height>0&&(r[i.texture_id]={texture_size:[i.width,i.height],texcoord_cache:i.texcoord_cache}),r},t.placeText=function(e,t,i,r,n,o){var s;return r.cy+t>o?(r.cx+=r.column_width,r.cy=0,r.column_width=e):r.column_width=Math.max(r.column_width,e),r.cx+r.column_width<=o?(s=[r.cx,r.cy],r.cy+=t,r.height=Math.max(r.height,r.cy),r.width=Math.max(r.width,r.cx+r.column_width)):(n[r.texture_id]={texture_size:[r.width,r.height],texcoord_cache:r.texcoord_cache},r.texcoord_cache={},r.texcoord_cache[i]={},r.texture_id++,r.cx=0,r.cy=t,r.column_width=e,r.width=e,r.height=t,s=[0,0]),s},t.applyTextTransform=function(e,t){return"capitalize"===t?e.replace(/\w\S*/g,(function(e){return e.charAt(0).toUpperCase()+e.substr(1)})):"uppercase"===t?e.toUpperCase():"lowercase"===t?e.toLowerCase():e},e.fontPixelSize=function(t){if(null!=t){var i=(t="string"==typeof t?t:String(t)).match(e.font_size_re)||[],r=i[1],n=i[2];return"em"===(n=n||"px")?r*=16:"pt"===n?r/=.75:"%"===n&&(r/=6.25),(r=Dn.parsePositiveNumber(r))*Ji.device_pixel_ratio}},e.pruneTextCache=function(){e.cache.text_count>e.cache.text_count_max&&(e.cache.text={},e.cache.text_count=0,Ki("debug","TextCanvas: pruning text cache")),Object.keys(e.cache.segment).length>e.cache.segment_count_max&&(e.cache.segment={},Ki("debug","TextCanvas: pruning segment cache"))},e}();Ra.font_size_re=/((?:[0-9]*\.)?[0-9]+)\s*(px|pt|em|%)?/,Ra.cache={text:{},text_count:0,text_count_max:2e3,segment:{},segment_count_max:2e3,stats:{text_hits:0,text_misses:0,segment_hits:0,segment_misses:0}};var Da=0,Oa={resetText:function(){He.is_main?this.canvas=new Ra:He.is_worker&&(this.texts={})},freeText:function(e){delete this.texts[e.id]},parseTextFeature:function(e,t,i,r){var n=this.parseTextSource(e,t,i);if(null!=n&&""!==n){var o=ma.compute(t,i),s=ma.key(o);this.texts[r.id]=this.texts[r.id]||{};var a=this.texts[r.id][s]=this.texts[r.id][s]||{};if(n instanceof Object){var l=[],c=n.left+"-"+n.right;for(var u in n){var h=n[u];if(h){var d=this.computeTextLayout({},e,t,i,r,h,o,c,u);a[h]||(a[h]={text_settings:o,ref:0}),l.push({draw:t,text:h,text_settings_key:s,layout:d})}}return l.length>0&&l}var p=this.computeTextLayout({},e,t,i,r,n,o);return a[n]||(a[n]={text_settings:o,ref:0}),{draw:t,text:n,text_settings_key:s,layout:p}}},parseTextSource:function(e,t,i){var r,n=t.text_source||"name";if(null==n||Array.isArray(n)||"object"!=typeof n)r=this.parseTextSourceValue(n,e,i);else for(var o in r={},n)r[o]=this.parseTextSourceValue(n[o],e,i);return r},parseTextSourceValue:function(e,t,i){var r;if(Array.isArray(e)){for(var n=0;n<e.length;n++)if("string"==typeof e[n]?r=t.properties[e[n]]:"function"==typeof e[n]&&(r=e[n](i)),r)return r}else"string"==typeof e?r=t.properties[e]:e instanceof Function&&(r=e(i));return r},prepareTextLabels:function(e,t){return new Promise(function(i,r){var n;if(0===Object.keys(this.texts[e.id]||{}).length)return i([]);var o=function(t){try{return aa.abortTile(e.id),i([])}catch(e){return r(e)}};try{return Promise.resolve(Qi.postMessage(this.main_thread_target+".calcTextSizes",e.id,this.texts[e.id])).then(function(r){try{return n=r,e.canceled?(Ki("trace","Style "+this.name+": stop tile build because tile was canceled: "+e.key+", post-calcTextSizes()"),i([])):(this.texts[e.id]=n||[],n?i(this.buildTextLabels(e,t)):(aa.abortTile(e.id),i([])))}catch(e){return o()}}.bind(this),o)}catch(e){o()}}.bind(this))},collideAndRenderTextLabels:function(e,t,i){return new Promise(function(r,n){var o,s,a;return Promise.resolve(this.prepareTextLabels(e,i)).then(function(i){try{return 0===(o=i).length?(aa.collide([],t,e.id),r({})):Promise.resolve(aa.collide(o,t,e.id)).then(function(t){try{if(o=t,e.canceled)return Ki("trace","stop tile build because tile was canceled: "+e.key+", post-collide()"),r({});if(null==(s=this.texts[e.id])||0===o.length)return r({});this.cullTextStyles(s,o),o.forEach((function(e){var t=e.text_settings_key,i=s[t]&&s[t][e.text];i.text_settings.can_articulate?(i.type||(i.type=[]),-1===i.type.indexOf(e.label.type)&&i.type.push(e.label.type)):(i.align=i.align||{},i.align[e.label.align]={})}));var i=function(e){try{return r({})}catch(e){return n(e)}};try{return Promise.resolve(Qi.postMessage(this.main_thread_target+".rasterizeTexts",e.id,e.key,s)).then((function(t){try{return a=t,e.canceled?(Ki("trace","stop tile build because tile was canceled: "+e.key+", post-rasterizeTexts()"),r({})):r(Object.assign({labels:o},a))}catch(e){return i()}}),i)}catch(e){i()}}catch(e){return n(e)}}.bind(this),n)}catch(e){return n(e)}}.bind(this),n)}.bind(this))},cullTextStyles:function(e,t){for(var i=0;i<t.length;i++){var r=t[i];e[r.text_settings_key][r.text].ref++}for(var n in e)for(var o in e[n])e[n][o].ref<1&&delete e[n][o];for(var s in e)0===Object.keys(e[s]).length&&delete e[s]},calcTextSizes:function(e,t){return this.canvas.textSizes(e,t)},rasterizeTexts:function(e,t,i){return new Promise(function(r,n){var o,s,a,l;return o=new Ra,s=Math.min(this.max_texture_size,2048),a=o.setTextureTextPositions(i,s),l=["labels",this.name,t,e,Da,""].join("-"),Da++,Promise.resolve(o.rasterize(i,a,e,l,this.gl)).then((function(e){try{return r((a=e)?{texts:i,textures:a}:{})}catch(e){return n(e)}}),n)}.bind(this))},preprocessText:function(e){if(e&&e.font&&"object"==typeof e.font)return e.font.weight=Dn.createPropertyCache(e.font.weight),e.font.fill=Dn.createPropertyCache(e.font.fill||ma.defaults.fill),e.font.alpha=Dn.createPropertyCache(e.font.alpha),e.font.stroke&&(e.font.stroke.color=Dn.createPropertyCache(e.font.stroke.color),e.font.stroke.alpha=Dn.createPropertyCache(e.font.stroke.alpha)),e.font.background&&(e.font.background.color=Dn.createPropertyCache(e.font.background.color),e.font.background.alpha=Dn.createPropertyCache(e.font.background.alpha),e.font.background.width=Dn.createPropertyCache(e.font.background.width,Dn.parsePositiveNumber),e.font.background.stroke&&(e.font.background.stroke.color=Dn.createPropertyCache(e.font.background.stroke.color),e.font.background.stroke.alpha=Dn.createPropertyCache(e.font.background.stroke.alpha))),e.font.px_size=Dn.createPropertyCache(e.font.size||ma.defaults.size,Ra.fontPixelSize,Ra.fontPixelSize),e.font.stroke&&null!=e.font.stroke.width&&(e.font.stroke.width=Dn.createPropertyCache(e.font.stroke.width,Dn.parsePositiveNumber)),e.font.background&&e.font.background.stroke&&null!=e.font.background.stroke.width&&(e.font.background.stroke.width=Dn.createPropertyCache(e.font.background.stroke.width,Dn.parsePositiveNumber)),e.offset=Dn.createPropertyCache(e.offset,(function(e){return Array.isArray(e)&&e.map(Dn.parseNumber)})),e.buffer=Dn.createPropertyCache(e.buffer,(function(e){return(Array.isArray(e)?e:[e,e]).map(Dn.parsePositiveNumber)})),e.repeat_distance=Dn.createPropertyCache(e.repeat_distance,Dn.parsePositiveNumber),e},computeTextLayout:function(e,t,i,r,n,o,s,a,l){var c=e||{};return c=this.computeLayout(c,t,i,r,n),null==i.repeat_distance&&(c.repeat_distance="point"===r.geometry?0:an.tile_size,c.repeat_distance&&(c.repeat_distance*=c.units_per_pixel,c.repeat_scale=1,"function"==typeof i.repeat_group?c.repeat_group=i.repeat_group(r):c.repeat_group=i.repeat_group)),c.repeat_distance&&(a&&(c.repeat_group+="/"+a),c.repeat_group+="/"+o),c.subdiv=n.overzoom2,c.align=i.align,c.italic="normal"!==s.style,"right"===l?c.orientation=1:"left"===l&&(c.orientation=-1),c}};Vr("Float64",8,(function(e){return function(t,i,r){return e(this,t,i,r)}}));var Ua=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},Na=function(e,t,i){var r=new Float64Array(3);return r[0]=e,r[1]=t,r[2]=i,r},Qa={normalFromMat4:function(e,t){var i=t[0],r=t[1],n=t[2],o=t[3],s=t[4],a=t[5],l=t[6],c=t[7],u=t[8],h=t[9],d=t[10],p=t[11],f=t[12],A=t[13],m=t[14],g=t[15],_=i*a-r*s,y=i*l-n*s,v=i*c-o*s,x=r*l-n*a,b=r*c-o*a,w=n*c-o*l,T=u*A-h*f,B=u*m-d*f,C=u*g-p*f,S=h*m-d*A,E=h*g-p*A,M=d*g-p*m,I=_*M-y*E+v*S+x*C-b*B+w*T;return I?(I=1/I,e[0]=(a*M-l*E+c*S)*I,e[1]=(l*C-s*M-c*B)*I,e[2]=(s*E-a*C+c*T)*I,e[3]=(n*E-r*M-o*S)*I,e[4]=(i*M-n*C+o*B)*I,e[5]=(r*C-i*E-o*T)*I,e[6]=(A*w-m*b+g*x)*I,e[7]=(m*v-f*w-g*y)*I,e[8]=(f*b-A*v+g*_)*I,e):null},invert:function(e,t){var i=t[0],r=t[1],n=t[2],o=t[3],s=t[4],a=t[5],l=t[6],c=t[7],u=t[8],h=u*s-a*c,d=-u*o+a*l,p=c*o-s*l,f=i*h+r*d+n*p;return f?(f=1/f,e[0]=h*f,e[1]=(-u*r+n*c)*f,e[2]=(a*r-n*s)*f,e[3]=d*f,e[4]=(u*i-n*l)*f,e[5]=(-a*i+n*o)*f,e[6]=p*f,e[7]=(-c*i+r*l)*f,e[8]=(s*i-r*o)*f,e):null}},ja={multiply:function(e,t,i){var r=t[0],n=t[1],o=t[2],s=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=t[9],p=t[10],f=t[11],A=t[12],m=t[13],g=t[14],_=t[15],y=i[0],v=i[1],x=i[2],b=i[3];return e[0]=y*r+v*a+x*h+b*A,e[1]=y*n+v*l+x*d+b*m,e[2]=y*o+v*c+x*p+b*g,e[3]=y*s+v*u+x*f+b*_,y=i[4],v=i[5],x=i[6],b=i[7],e[4]=y*r+v*a+x*h+b*A,e[5]=y*n+v*l+x*d+b*m,e[6]=y*o+v*c+x*p+b*g,e[7]=y*s+v*u+x*f+b*_,y=i[8],v=i[9],x=i[10],b=i[11],e[8]=y*r+v*a+x*h+b*A,e[9]=y*n+v*l+x*d+b*m,e[10]=y*o+v*c+x*p+b*g,e[11]=y*s+v*u+x*f+b*_,y=i[12],v=i[13],x=i[14],b=i[15],e[12]=y*r+v*a+x*h+b*A,e[13]=y*n+v*l+x*d+b*m,e[14]=y*o+v*c+x*p+b*g,e[15]=y*s+v*u+x*f+b*_,e},translate:function(e,t,i){var r,n,o,s,a,l,c,u,h,d,p,f,A=i[0],m=i[1],g=i[2];return t===e?(e[12]=t[0]*A+t[4]*m+t[8]*g+t[12],e[13]=t[1]*A+t[5]*m+t[9]*g+t[13],e[14]=t[2]*A+t[6]*m+t[10]*g+t[14],e[15]=t[3]*A+t[7]*m+t[11]*g+t[15]):(r=t[0],n=t[1],o=t[2],s=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=t[9],p=t[10],f=t[11],e[0]=r,e[1]=n,e[2]=o,e[3]=s,e[4]=a,e[5]=l,e[6]=c,e[7]=u,e[8]=h,e[9]=d,e[10]=p,e[11]=f,e[12]=r*A+a*m+h*g+t[12],e[13]=n*A+l*m+d*g+t[13],e[14]=o*A+c*m+p*g+t[14],e[15]=s*A+u*m+f*g+t[15]),e},scale:function(e,t,i){var r=i[0],n=i[1],o=i[2];return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*o,e[9]=t[9]*o,e[10]=t[10]*o,e[11]=t[11]*o,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},perspective:function(e,t,i,r,n){var o=1/Math.tan(t/2),s=1/(r-n);return e[0]=o/i,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=(n+r)*s,e[11]=-1,e[12]=0,e[13]=0,e[14]=2*n*r*s,e[15]=0,e},lookAt:function(e,t,i,r){var n,o,s,a,l,c,u,h,d,p,f=t[0],A=t[1],m=t[2],g=r[0],_=r[1],y=r[2],v=i[0],x=i[1],b=i[2];return Math.abs(f-v)<1e-6&&Math.abs(A-x)<1e-6&&Math.abs(m-b)<1e-6?Ua(e):(u=f-v,h=A-x,d=m-b,n=_*(d*=p=1/Math.sqrt(u*u+h*h+d*d))-y*(h*=p),o=y*(u*=p)-g*d,s=g*h-_*u,(p=Math.sqrt(n*n+o*o+s*s))?(n*=p=1/p,o*=p,s*=p):(n=0,o=0,s=0),a=h*s-d*o,l=d*n-u*s,c=u*o-h*n,(p=Math.sqrt(a*a+l*l+c*c))?(a*=p=1/p,l*=p,c*=p):(a=0,l=0,c=0),e[0]=n,e[1]=a,e[2]=u,e[3]=0,e[4]=o,e[5]=l,e[6]=h,e[7]=0,e[8]=s,e[9]=c,e[10]=d,e[11]=0,e[12]=-(n*f+o*A+s*m),e[13]=-(a*f+l*A+c*m),e[14]=-(u*f+h*A+d*m),e[15]=1,e)},identity:Ua,copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}},Va=function(){function e(e,t,i){void 0===i&&(i={}),this.view=t,this.position=i.position,this.zoom=i.zoom}e.create=function(e,t,i){switch(i.type){case"isometric":return new Ga(e,t,i);case"flat":return new $a(e,t,i);default:return new Ha(e,t,i)}};var t=e.prototype;return t.update=function(){},t.setupProgram=function(){},t.updateView=function(){if(this.position||this.zoom){var e={};this.position&&(e={lng:this.position[0],lat:this.position[1],zoom:this.position[2]}),this.zoom&&(e.zoom=this.zoom),this.view.setView(e)}},t.setupMatrices=function(e,t){ja.multiply(e.model_view32,this.view_matrix,e.model),t.uniform("Matrix4fv","u_modelView",e.model_view32),Qa.normalFromMat4(e.normal32,e.model_view32),Qa.invert(e.inverse_normal32,e.normal32),t.uniform("Matrix3fv","u_normalMatrix",e.normal32),t.uniform("Matrix3fv","u_inverseNormalMatrix",e.inverse_normal32)},e}(),Ha=function(e){function t(t,i,r){var n;return void 0===r&&(r={}),(n=e.call(this,t,i,r)||this).type="perspective",n.focal_length=r.focal_length,n.fov=r.fov,n.focal_length||n.fov||(n.focal_length=[[16,2],[17,2.5],[18,3],[19,4],[20,6]]),n.vanishing_point=r.vanishing_point||[0,0],n.vanishing_point=n.vanishing_point.map(parseFloat),n.vanishing_point_skew=[],n.position_meters=null,n.view_matrix=new Float64Array(16),n.projection_matrix=new Float32Array(16),Yr.replaceBlock("camera","\n            uniform mat4 u_projection;\n            uniform vec3 u_eye;\n            uniform vec2 u_vanishing_point;\n\n            void cameraProjection (inout vec4 position) {\n                position = u_projection * position;\n            }"),n}ft(t,e);var i=t.prototype;return i.constrainCamera=function(e){var t=e.view_height,i=e.height,r=e.focal_length,n=e.fov;return i?(r=2*i/t,n=2*Math.atan(1/r)):(r?n=2*Math.atan(1/r):n&&(n=n*Math.PI/180,r=1/Math.tan(n/2)),i=t/2*r),{view_height:t,height:i,focal_length:r,fov:n}},i.updateMatrices=function(){var e=this.view.size.css.height*this.view.meters_per_pixel,t=this.constrainCamera({view_height:e,focal_length:Ji.interpolate(this.view.zoom,this.focal_length),fov:Ji.interpolate(this.view.zoom,this.fov)}),i=t.height,r=t.fov,n=[this.view.center.meters.x,this.view.center.meters.y,i];this.position_meters=n,ja.lookAt(this.view_matrix,Na(n[0],n[1],0),Na(n[0],n[1],-1),Na(0,1,0)),ja.perspective(this.projection_matrix,r,this.view.aspect,1,2*i),this.vanishing_point_skew[0]=this.vanishing_point[0]/this.view.size.css.width,this.vanishing_point_skew[1]=this.vanishing_point[1]/this.view.size.css.height,this.projection_matrix[8]=2*-this.vanishing_point_skew[0],this.projection_matrix[9]=2*-this.vanishing_point_skew[1],ja.translate(this.projection_matrix,this.projection_matrix,Na(e/2*this.view.aspect*(2*-this.vanishing_point_skew[0]),e/2*(2*-this.vanishing_point_skew[1]),0)),ja.translate(this.projection_matrix,this.projection_matrix,Na(0,0,-i))},i.update=function(){e.prototype.update.call(this),this.updateMatrices()},i.setupProgram=function(e){e.uniform("Matrix4fv","u_projection",this.projection_matrix),e.uniform("3f","u_eye",[0,0,this.position_meters[2]]),e.uniform("2fv","u_vanishing_point",this.vanishing_point_skew)},t}(Va),Ga=function(e){function t(t,i,r){var n;return void 0===r&&(r={}),(n=e.call(this,t,i,r)||this).type="isometric",n.axis=r.axis||{x:0,y:1},2===n.axis.length&&(n.axis={x:n.axis[0],y:n.axis[1]}),n.position_meters=null,n.viewport_height=null,n.view_matrix=new Float64Array(16),n.projection_matrix=new Float32Array(16),Yr.replaceBlock("camera","\n            uniform mat4 u_projection;\n            uniform vec3 u_eye;\n            uniform vec2 u_vanishing_point;\n\n            void cameraProjection (inout vec4 position) {\n                position = u_projection * position;\n                // position.xy += position.z * u_isometric_axis;\n\n                // Reverse z for depth buffer so up is negative,\n                // and scale down values so objects higher than one screen height will not get clipped\n                // pull forward slightly to avoid going past far clipping plane\n                position.z = -position.z / 100. + 1. - 0.001;\n            }"),n}ft(t,e);var i=t.prototype;return i.update=function(){e.prototype.update.call(this),this.viewport_height=this.view.size.css.height*this.view.meters_per_pixel;var t=[this.view.center.meters.x,this.view.center.meters.y,this.viewport_height];this.position_meters=t,ja.identity(this.view_matrix),ja.translate(this.view_matrix,this.view_matrix,Na(-t[0],-t[1],0)),ja.identity(this.projection_matrix),this.projection_matrix[8]=this.axis.x/this.view.aspect,this.projection_matrix[9]=this.axis.y,ja.scale(this.projection_matrix,this.projection_matrix,Na(2/this.view.size.meters.x,2/this.view.size.meters.y,2/this.view.size.meters.y))},i.setupProgram=function(e){e.uniform("Matrix4fv","u_projection",this.projection_matrix),e.uniform("3fv","u_eye",[0,0,this.viewport_height]),e.uniform("2fv","u_vanishing_point",[0,0])},t}(Va),$a=function(e){function t(t,i,r){var n;return void 0===r&&(r={}),(n=e.call(this,t,i,r)||this).type="flat",n}return ft(t,e),t.prototype.update=function(){this.axis.x=0,this.axis.y=0,e.prototype.update.call(this)},t}(Ga),Za=function(){function e(e,t){Br(this),this.scene=e,this.createMatrices(),this.zoom=null,this.center=null,this.bounds=null,this.meters_per_pixel=null,this.panning=!1,this.panning_stop_at=0,this.pan_snap_timer=0,this.zoom_direction=0,this.user_input_at=0,this.user_input_timeout=50,this.user_input_active=!1,this.size={css:{},device:{},meters:{}},this.aspect=null,this.buffer=0,this.continuous_zoom="boolean"!=typeof t.continuousZoom||t.continuousZoom,this.wrap=!1!==t.wrapView,this.preserve_tiles_within_zoom=1,this.reset()}var t=e.prototype;return t.reset=function(){this.createCamera()},t.createCamera=function(){var e=this.getActiveCamera();e&&(this.camera=Va.create(e,this,this.scene.config.cameras[e]),this.camera.updateView())},t.getActiveCamera=function(){if(this.scene.config&&this.scene.config.cameras){for(var e in this.scene.config.cameras)if(this.scene.config.cameras[e].active)return e;var t=Object.keys(this.scene.config.cameras);return t.length&&t[0]}},t.setActiveCamera=function(e){var t=this.getActiveCamera();return t===e?e:(this.scene.config.cameras[e]&&(this.scene.config.cameras[e].active=!0,t&&this.scene.config.cameras[t]&&delete this.scene.config.cameras[t].active),this.scene.updateConfig({rebuild:!1,normalize:!1}),this.getActiveCamera())},t.update=function(){null!=this.camera&&this.ready()&&this.camera.update(),this.pan_snap_timer=(+new Date-this.panning_stop_at)/1e3,this.user_input_active=+new Date-this.user_input_at<this.user_input_timeout},t.setViewportSize=function(e,t){this.size.css={width:e,height:t},this.size.device={width:Math.round(this.size.css.width*Ji.device_pixel_ratio),height:Math.round(this.size.css.height*Ji.device_pixel_ratio)},this.aspect=this.size.css.width/this.size.css.height,this.updateBounds()},t.setView=function(e){var t=void 0===e?{}:e,i=t.lng,r=t.lat,n=t.zoom,o=!1;return"number"==typeof i&&"number"==typeof r&&(this.center&&i===this.center.lng&&r===this.center.lat||(o=!0,this.center={lng:i,lat:r})),"number"==typeof n&&n!==this.zoom&&(o=!0,this.setZoom(n)),o&&this.updateBounds(),o},t.setZoom=function(e){var t=this.tile_zoom,i=this.baseZoom(e);this.continuous_zoom||(e=i),i!==t&&(this.zoom_direction=i>t?1:-1),this.zoom=e,this.tile_zoom=i,this.updateBounds(),this.scene.requestRedraw()},t.baseZoom=function(e){return Math.floor(e)},t.setPanning=function(e){this.panning=e,this.panning||(this.panning_stop_at=+new Date)},t.markUserInput=function(){this.user_input_at=+new Date},t.ready=function(){return"number"==typeof this.size.css.width&&"number"==typeof this.size.css.height&&null!=this.center&&"number"==typeof this.zoom},t.updateBounds=function(){if(this.ready()){this.meters_per_pixel=an.metersPerPixel(this.zoom),this.size.meters={x:this.size.css.width*this.meters_per_pixel,y:this.size.css.height*this.meters_per_pixel};var e=an.latLngToMeters([this.center.lng,this.center.lat]);this.center.meters={x:e[0],y:e[1]},this.center.tile=an.tileForMeters([this.center.meters.x,this.center.meters.y],this.tile_zoom),this.bounds={sw:{x:this.center.meters.x-this.size.meters.x/2,y:this.center.meters.y-this.size.meters.y/2},ne:{x:this.center.meters.x+this.size.meters.x/2,y:this.center.meters.y+this.size.meters.y/2}},this.scene.tile_manager.updateTilesForView(),this.trigger("move"),this.scene.requestRedraw()}},t.findVisibleTileCoordinates=function(){if(!this.bounds)return[];var e=this.tile_zoom,t=an.tileForMeters([this.bounds.sw.x,this.bounds.sw.y],e),i=an.tileForMeters([this.bounds.ne.x,this.bounds.ne.y],e),r=[t.x-this.buffer,i.x+this.buffer,i.y-this.buffer,t.y+this.buffer];if(!1===this.wrap){var n=(1<<e)-1;r=r.map((function(e){return Math.min(Math.max(0,e),n)}))}for(var o=[],s=r[0];s<=r[1];s++)for(var a=r[2];a<=r[3];a++)o.push(go.coord({x:s,y:a,z:e}));return o},t.pruneTilesForView=function(){var e=this;this.ready()&&this.scene.tile_manager.removeTiles((function(t){if(t.visible||t.isProxy())return!1;if(t.loading&&t.style_z!==e.tile_zoom)return!0;if(Math.abs(t.style_z-e.tile_zoom)>(null!=t.preserve_tiles_within_zoom?t.preserve_tiles_within_zoom:e.preserve_tiles_within_zoom))return!0;var i=e.meters_per_pixel*an.tile_size,r=go.coordAtZoom(an.tileForMeters([e.center.meters.x-e.size.meters.x/2-i,e.center.meters.y+e.size.meters.y/2+i],e.tile_zoom),t.coords.z),n=go.coordAtZoom(an.tileForMeters([e.center.meters.x+e.size.meters.x/2+i,e.center.meters.y-e.size.meters.y/2-i],e.tile_zoom),t.coords.z);return(t.coords.x<r.x||t.coords.x>n.x||t.coords.y<r.y||t.coords.y>n.y)&&(Ki("trace","View: remove tile "+t.key+" (as "+t.coords.key+") for being too far out of visible area ("+r.key+", "+n.key+")"),!0)}))},t.createMatrices=function(){this.matrices={},this.matrices.model=new Float64Array(16),this.matrices.model32=new Float32Array(16),this.matrices.model_view=new Float64Array(16),this.matrices.model_view32=new Float32Array(16),this.matrices.normal=new Float64Array(9),this.matrices.normal32=new Float32Array(9),this.matrices.inverse_normal32=new Float32Array(9)},t.setupTile=function(e,t){e.setupProgram(this.matrices,t),this.camera.setupMatrices(this.matrices,t)},t.setupProgram=function(e){e.uniform("2fv","u_resolution",[this.size.device.width,this.size.device.height]),e.uniform("3fv","u_map_position",[this.center.meters.x,this.center.meters.y,this.zoom]),e.uniform("1f","u_meters_per_pixel",this.meters_per_pixel),e.uniform("1f","u_device_pixel_ratio",Ji.device_pixel_ratio),e.uniform("1f","u_view_pan_snap_timer",this.pan_snap_timer),e.uniform("1i","u_view_panning",this.panning),this.camera.setupProgram(e)},t.isAnimating=function(){return this.pan_snap_timer<=.5},e}(),qa=la.PLACEMENT,Ka=Object.create(vo);Object.assign(Ka,Oa),Object.assign(Ka,{name:"points",built_in:!0,vertex_shader_src:"uniform vec2 u_resolution;\nuniform float u_time;\nuniform vec3 u_map_position;\nuniform vec4 u_tile_origin;\nuniform float u_tile_proxy_order_offset;\nuniform bool u_tile_fade_in;\nuniform float u_meters_per_pixel;\nuniform float u_device_pixel_ratio;\nuniform float u_visible_time;\nuniform bool u_view_panning;\nuniform float u_view_pan_snap_timer;\n\nuniform mat4 u_model;\nuniform mat4 u_modelView;\nuniform mat3 u_normalMatrix;\nuniform mat3 u_inverseNormalMatrix;\n\nattribute vec4 a_position;\nattribute vec4 a_shape;\nattribute vec4 a_color;\nattribute vec2 a_texcoord;\nattribute vec2 a_offset;\n\nuniform float u_point_type;\n\n#ifdef TANGRAM_CURVED_LABEL\n    attribute vec4 a_offsets;\n    attribute vec4 a_pre_angles;\n    attribute vec4 a_angles;\n#endif\n\nvarying vec4 v_color;\nvarying vec2 v_texcoord;\nvarying vec4 v_world_position;\nvarying float v_alpha_factor;\n\n#ifdef TANGRAM_HAS_SHADER_POINTS\n    attribute float a_outline_edge;\n    attribute vec4 a_outline_color;\n\n    varying float v_outline_edge;\n    varying vec4 v_outline_color;\n    varying float v_aa_offset;\n#endif\n\n#ifdef TANGRAM_SHOW_HIDDEN_LABELS\n    varying float v_label_hidden;\n#endif\n\n#define TANGRAM_PI 3.14159265359\n#define TANGRAM_NORMAL vec3(0., 0., 1.)\n\n#pragma tangram: attributes\n#pragma tangram: camera\n#pragma tangram: material\n#pragma tangram: lighting\n#pragma tangram: raster\n#pragma tangram: global\n\nvec2 rotate2D(vec2 _st, float _angle) {\n    return mat2(cos(_angle),-sin(_angle),\n                sin(_angle),cos(_angle)) * _st;\n}\n\n#ifdef TANGRAM_CURVED_LABEL\n    // Assumes stops are [0, 0.33, 0.66, 0.99];\n    float mix4linear(vec4 v, float x) {\n        x = clamp(x, 0., 1.);\n        return mix(mix(v[0], v[1], 3. * x),\n                   mix(v[1],\n                       mix(v[2], v[3], 3. * (max(x, .66) - .66)),\n                       3. * (clamp(x, .33, .66) - .33)),\n                   step(0.33, x)\n                );\n    }\n#endif\n\nvoid main() {\n    // Initialize globals\n    #pragma tangram: setup\n\n    // discard hidden labels by collapsing into degenerate triangle\n    #ifndef TANGRAM_SHOW_HIDDEN_LABELS\n        if (a_shape.w == 0.) {\n            gl_Position = vec4(0., 0., 0., 1.);\n            return;\n        }\n    #else\n        // highlight hidden label in fragment shader for debugging\n        if (a_shape.w == 0.) {\n            v_label_hidden = 1.; // label debug testing\n        }\n        else {\n            v_label_hidden = 0.;\n        }\n    #endif\n\n    v_alpha_factor = 1.0;\n    v_color = a_color;\n    v_texcoord = a_texcoord; // UV from vertex attribute\n\n    #ifdef TANGRAM_HAS_SHADER_POINTS\n        v_outline_color = a_outline_color;\n        v_outline_edge = a_outline_edge;\n\n        if (u_point_type == TANGRAM_POINT_TYPE_SHADER) { // shader point\n            // use point dimensions for UVs instead (ignore attribute), add antialiasing info for fragment shader\n            float _size = abs(a_shape.x / 128.); // radius in pixels\n            v_texcoord = sign(a_shape.xy) * (_size + 1.) / _size;\n            _size += 2.;\n            v_aa_offset = 2. / _size;\n        }\n    #endif\n\n    // Position\n    vec4 position = u_modelView * vec4(a_position.xyz, 1.);\n\n    // Apply positioning and scaling in screen space\n    vec2 _shape = a_shape.xy / 256.;                 // values have an 8-bit fraction\n    vec2 _offset = vec2(a_offset.x, -a_offset.y);    // flip y to make it point down\n    float _theta = a_shape.z / 4096.;\n\n    #ifdef TANGRAM_CURVED_LABEL\n        //TODO: potential bug? null is passed in for non-curved labels, otherwise the first offset will be 0\n        if (a_offsets[0] != 0.){\n            vec4 _angles_scaled = (TANGRAM_PI / 16384.) * a_angles;\n            vec4 _pre_angles_scaled = (TANGRAM_PI / 128.) * a_pre_angles;\n            vec4 _offsets_scaled = (1. / 64.) * a_offsets;\n\n            float _zoom = clamp(u_map_position.z - u_tile_origin.z, 0., 1.); //fract(u_map_position.z);\n            float _pre_angle = mix4linear(_pre_angles_scaled, _zoom);\n            float _angle = mix4linear(_angles_scaled, _zoom);\n            float _offset_curve = mix4linear(_offsets_scaled, _zoom);\n\n            _shape = rotate2D(_shape, _pre_angle); // rotate in place\n            _shape.x += _offset_curve;            // offset for curved label segment\n            _shape = rotate2D(_shape, _angle);     // rotate relative to curved label anchor\n            _shape += rotate2D(_offset, _theta);   // offset if specified in the scene file\n        }\n        else {\n            _shape = rotate2D(_shape + _offset, _theta);\n        }\n    #else\n        _shape = rotate2D(_shape + _offset, _theta);\n    #endif\n\n    // Fade in (if requested) based on time mesh has been visible.\n    // Value passed to fragment shader in the v_alpha_factor varying\n    #ifdef TANGRAM_FADE_IN_RATE\n        if (u_tile_fade_in) {\n            v_alpha_factor *= clamp(u_visible_time * TANGRAM_FADE_IN_RATE, 0., 1.);\n        }\n    #endif\n\n    // World coordinates for 3d procedural textures\n    v_world_position = u_model * position;\n    v_world_position.xy += _shape * u_meters_per_pixel;\n    v_world_position = wrapWorldPosition(v_world_position);\n\n    // Modify position before camera projection\n    #pragma tangram: position\n\n    cameraProjection(position);\n\n    #ifdef TANGRAM_LAYER_ORDER\n        // +1 is to keep all layers including proxies > 0\n        applyLayerOrder(a_position.w + u_tile_proxy_order_offset + 1., position);\n    #endif\n\n    // Apply pixel offset in screen-space\n    // Multiply by 2 is because screen is 2 units wide Normalized Device Coords (and u_resolution device pixels wide)\n    // Device pixel ratio adjustment is because shape is in logical pixels\n    position.xy += _shape * position.w * 2. * u_device_pixel_ratio / u_resolution;\n    #ifdef TANGRAM_HAS_SHADER_POINTS\n        if (u_point_type == TANGRAM_POINT_TYPE_SHADER) { // shader point\n            // enlarge by 1px to catch missed MSAA fragments\n            position.xy += sign(_shape) * position.w * u_device_pixel_ratio / u_resolution;\n        }\n    #endif\n\n    // Snap to pixel grid\n    // Only applied to fully upright sprites/labels (not shader-drawn points), while panning is not active\n    #ifdef TANGRAM_HAS_SHADER_POINTS\n    if (!u_view_panning && (abs(_theta) < TANGRAM_EPSILON) && u_point_type != TANGRAM_POINT_TYPE_SHADER) {\n    #else\n    if (!u_view_panning && (abs(_theta) < TANGRAM_EPSILON)) {\n    #endif\n        vec2 _position_fract = fract((((position.xy / position.w) + 1.) * .5) * u_resolution);\n        vec2 _position_snap = position.xy + ((step(0.5, _position_fract) - _position_fract) * position.w * 2. / u_resolution);\n\n        // Animate the snapping to smooth the transition and make it less noticeable\n        #ifdef TANGRAM_VIEW_PAN_SNAP_RATE\n            position.xy = mix(position.xy, _position_snap, clamp(u_view_pan_snap_timer * TANGRAM_VIEW_PAN_SNAP_RATE, 0., 1.));\n        #else\n            position.xy = _position_snap;\n        #endif\n    }\n\n    gl_Position = position;\n}\n",fragment_shader_src:"uniform vec2 u_resolution;\nuniform float u_time;\nuniform vec3 u_map_position;\nuniform vec4 u_tile_origin;\nuniform float u_meters_per_pixel;\nuniform float u_device_pixel_ratio;\nuniform float u_visible_time;\n\nuniform mat3 u_normalMatrix;\nuniform mat3 u_inverseNormalMatrix;\n\nuniform sampler2D u_texture;\nuniform float u_point_type;\nuniform bool u_apply_color_blocks;\n\nvarying vec4 v_color;\nvarying vec2 v_texcoord;\nvarying vec4 v_world_position;\nvarying float v_alpha_factor;\n\n#ifdef TANGRAM_HAS_SHADER_POINTS\n    varying vec4 v_outline_color;\n    varying float v_outline_edge;\n    varying float v_aa_offset;\n#endif\n\n#ifdef TANGRAM_SHOW_HIDDEN_LABELS\n    varying float v_label_hidden;\n#endif\n\n#define TANGRAM_NORMAL vec3(0., 0., 1.)\n\n#pragma tangram: attributes\n#pragma tangram: camera\n#pragma tangram: material\n#pragma tangram: lighting\n#pragma tangram: raster\n#pragma tangram: global\n\n#ifdef TANGRAM_HAS_SHADER_POINTS\n    //l is the distance from the center to the fragment, R is the radius of the drawn point\n    float _tangram_antialias(float l, float R){\n        float low  = R - v_aa_offset;\n        float high = R + v_aa_offset;\n        return 1. - smoothstep(low, high, l);\n    }\n#endif\n\nvoid main (void) {\n    // Initialize globals\n    #pragma tangram: setup\n\n    vec4 color = v_color;\n\n    #ifdef TANGRAM_HAS_SHADER_POINTS\n        // Only apply shader blocks to point, not to attached text (N.B.: for compatibility with ES)\n        if (u_point_type == TANGRAM_POINT_TYPE_TEXTURE) { // sprite texture\n            color *= texture2D(u_texture, v_texcoord);\n        }\n        else if (u_point_type == TANGRAM_POINT_TYPE_LABEL) { // label texture\n            color = texture2D(u_texture, v_texcoord);\n            color.rgb /= max(color.a, 0.001); // un-multiply canvas texture\n        }\n        else if (u_point_type == TANGRAM_POINT_TYPE_SHADER) { // shader point\n            // Mask of outermost circle, either outline or point boundary\n            float _d = length(v_texcoord); // distance to this fragment from the point center\n            float _outer_alpha = _tangram_antialias(_d, 1.);\n            float _fill_alpha = _tangram_antialias(_d, 1. - (v_outline_edge * 0.5)) * color.a;\n            float _stroke_alpha = (_outer_alpha - _tangram_antialias(_d, 1. - v_outline_edge)) * v_outline_color.a;\n\n            // Apply alpha compositing with stroke 'over' fill.\n            #ifdef TANGRAM_BLEND_ADD\n                color.a = _stroke_alpha + _fill_alpha;\n                color.rgb = color.rgb * _fill_alpha + v_outline_color.rgb * _stroke_alpha;\n            #else // TANGRAM_BLEND_OVERLAY (and fallback for not implemented blending modes)\n                color.a = _stroke_alpha + _fill_alpha * (1. - _stroke_alpha);\n                color.rgb = mix(color.rgb * _fill_alpha, v_outline_color.rgb, _stroke_alpha) / max(color.a, 0.001); // avoid divide by zero\n            #endif\n        }\n    #else\n        // If shader points not supported, assume label texture\n        color = texture2D(u_texture, v_texcoord);\n        color.rgb /= max(color.a, 0.001); // un-multiply canvas texture\n    #endif\n\n    // Shader blocks for color/filter are only applied for sprites, shader points, and standalone text,\n    // NOT for text attached to a point (N.B.: for compatibility with ES)\n    if (u_apply_color_blocks) {\n        #pragma tangram: color\n        #pragma tangram: filter\n    }\n\n    color.a *= v_alpha_factor;\n\n    // highlight hidden label in fragment shader for debugging\n    #ifdef TANGRAM_SHOW_HIDDEN_LABELS\n        if (v_label_hidden > 0.) {\n            color.a *= 0.5;\n            color.rgb = vec3(1., 0., 0.);\n        }\n    #endif\n\n    // Use alpha test as a lower-quality substitute\n    // For opaque and translucent: avoid transparent pixels writing to depth buffer, obscuring geometry underneath\n    // For multiply: avoid transparent pixels multiplying geometry underneath to zero/full black\n    #if defined(TANGRAM_BLEND_OPAQUE) || defined(TANGRAM_BLEND_TRANSLUCENT) || defined(TANGRAM_BLEND_MULTIPLY)\n        if (color.a < TANGRAM_ALPHA_TEST) {\n            discard;\n        }\n    #endif\n\n    // Make points more visible in wireframe debug mode\n    #ifdef TANGRAM_WIREFRAME\n        color = vec4(vec3(0.5), 1.); // use gray outline for textured points\n        #ifdef TANGRAM_HAS_SHADER_POINTS\n            if (u_point_type == TANGRAM_POINT_TYPE_SHADER) {\n                color = vec4(v_color.rgb, 1.); // use original vertex color outline for shader points\n            }\n        #endif\n    #endif\n\n    gl_FragColor = color;\n}\n",selection:!0,collision:!0,blend:"overlay",init:function(e){void 0===e&&(e={}),vo.init.call(this,e),this.setupDefines(),this.defines.TANGRAM_HAS_SHADER_POINTS=!0,this.defines.TANGRAM_POINT_TYPE_TEXTURE=1,this.defines.TANGRAM_POINT_TYPE_LABEL=2,this.defines.TANGRAM_POINT_TYPE_SHADER=3,this.collision_group_points=this.name+"-points",this.collision_group_text=this.name+"-text",this.stencil_proxy_tiles=!1,this.reset()},setupDefines:function(){"overlay"!==this.blend&&(this.defines.TANGRAM_LAYER_ORDER=!0),!0===er.suppress_label_fade_in?(this.fade_in_time=0,this.defines.TANGRAM_FADE_IN_RATE=null):(this.fade_in_time=.15,this.defines.TANGRAM_FADE_IN_RATE=1/this.fade_in_time),!0!==er.suppress_label_snap_animation&&(this.defines.TANGRAM_VIEW_PAN_SNAP_RATE=2),!0===er.show_hidden_labels&&(this.defines.TANGRAM_SHOW_HIDDEN_LABELS=!0),!0===er.wireframe&&(this.defines.TANGRAM_WIREFRAME=!0)},reset:function(){this.queues={},this.resetText(),this.texture_missing_sprites={}},addFeature:function(e,t,i){var r=i.tile;if(r.generation===this.generation){var n={};if(n.color=this.parseColor(t.color,i),n.texture=t.texture,n.label_texture=null,n.blend_order=t.blend_order,n.color||n.texture){var o;if(n.alpha=Dn.evalCachedProperty(t.alpha,i),this.hasSprites(n)){if(!(o=this.parseSprite(n,t,i)))return void Ki({level:"debug",once:!0},"Layer group '"+t.layers.join(", ")+"' uses a texture '"+n.texture+"', but doesn't specify which sprite to draw. Features that match this layer group won't be drawn without specifying the sprite with the 'sprite' or 'sprite_default' properties. The merged draw parameters for this layer group are:",t).then((function(i){i&&Ki("debug","Example feature for layer group '"+t.layers.join(", ")+"'",e)}));n.texcoords=o.texcoords}else if(t.sprite)return void Ki({level:"warn",once:!0},"Layer group '"+t.layers.join(", ")+"' specifies sprite '"+t.sprite+"', but the texture '"+t.texture+"' doesn't define any sprites. Features that match this layer group won't be drawn. The merged draw parameters for this layer group are:",t);if(this.calcSize(t,n,o,i),t.outline&&(n.outline_width=Dn.evalCachedProperty(t.outline.width,i)||Dn.defaults.outline.width,n.outline_color=this.parseColor(t.outline.color,i)),n.outline_edge_pct=0,n.outline_width&&n.outline_color){var s=n.outline_width;n.size[0]+=s,n.size[1]+=s,n.outline_edge_pct=s/Math.min(n.size[0],n.size[1])*2,n.outline_alpha=Dn.evalCachedProperty(t.outline.alpha,i)}n.size[0]=Math.min(n.size[0],256),n.size[1]=Math.min(n.size[1],256),n.placement=t.placement,n.placement_min_length_ratio=Dn.evalCachedProperty(t.placement_min_length_ratio,i),n.placement===qa.SPACED&&t.placement_spacing&&(n.placement_spacing=Dn.evalCachedProperty(t.placement_spacing,i)),n.angle=Dn.evalProperty(t.angle,i)||0,n.z=Dn.evalCachedDistanceProperty(t.z,i)||Dn.defaults.z,n.tile_edges=t.tile_edges,this.computeLayout(n,e,t,i,r);var a=t.text&&!1!==t.text.visible&&this.parseTextFeature(e,t.text,i,r);Array.isArray(a)&&(a=null,Ki({level:"warn",once:!0},"Layer group '"+t.layers.join(", ")+"': cannot use boundary labels (e.g. 'text_source: { left: ..., right: ... }') for 'text' labels attached to 'points'; provided 'text_source' value was "+JSON.stringify(t.text.text_source))),a&&(a.layout.parent=n,a.layout.priority=t.text.priority?Math.max(a.layout.priority,n.priority+.5):n.priority+.5,aa.addStyle(this.collision_group_text,r.id)),this.queueFeature({feature:e,draw:t,context:i,style:n,text_feature:a},r),aa.addStyle(this.collision_group_points,r.id)}}},calcSize:function(e,t,i,r){if(t.size=e.size,t.size){if(t.size=Dn.evalCachedPointSizeProperty(e.size,i,Hr.textures[t.texture],r),null==t.size)return void Ki({level:"warn",once:!0},"Layer group '"+e.layers.join(", ")+"': 'size' ("+JSON.stringify(e.size.value)+") couldn't be interpreted, features that match this layer group won't be drawn");"number"==typeof t.size&&(t.size=[t.size,t.size])}else t.size=i&&i.css_size||[16,16]},hasSprites:function(e){return e.texture&&Hr.textures[e.texture]&&Hr.textures[e.texture].sprites},getSpriteInfo:function(e,t){var i=Hr.textures[e.texture].sprites[t]&&Hr.getSpriteInfo(e.texture,t);return t&&!i?(this.texture_missing_sprites[e.texture]=this.texture_missing_sprites[e.texture]||{},this.texture_missing_sprites[e.texture][t]||(Ki("debug","Style: in style '"+this.name+"', could not find sprite '"+t+"' for texture '"+e.texture+"'"),this.texture_missing_sprites[e.texture][t]=!0)):i&&(i.sprite=t),i},parseSprite:function(e,t,i){var r=Dn.evalProperty(t.sprite,i);return this.getSpriteInfo(e,r)||this.getSpriteInfo(e,t.sprite_default)},queueFeature:function(e,t){this.tile_data[t.id]&&this.queues[t.id]||this.startData(t),this.queues[t.id]=this.queues[t.id]||[],this.queues[t.id].push(e)},endData:function(e){return new Promise(function(t,i){var r,n,o,s,a,l,c,u,h,d;return r=this,e.canceled?(Ki("trace","Style "+this.name+": stop tile build because tile was canceled: "+e.key),t(null)):(n=this.queues[e.id],delete this.queues[e.id],o=[],s=[],n.forEach((function(e){for(var t=e.style,i=e.feature,n=i.geometry,a=r.buildLabels(t.size,n,t),l=0;l<a.length;l++){var c=a[l],u={feature:i,draw:e.draw,context:e.context,style:t,label:c};if(s.push(u),e.text_feature){var h={feature:i,draw:e.text_feature.draw,context:e.context,text:e.text_feature.text,text_settings_key:e.text_feature.text_settings_key,layout:e.text_feature.layout,point_label:c,linked:u};o.push(h),e.draw.text.optional||(u.linked=h)}}})),Promise.resolve(Promise.all([aa.collide(s,this.collision_group_points,e.id).then((function(e){e.forEach((function(e){r.feature_style=e.style,r.feature_style.label=e.label,r.feature_style.linked=e.linked,vo.addFeature.call(r,e.feature,e.draw,e.context)}))})),this.collideAndRenderTextLabels(e,this.collision_group_text,o)])).then(function(n){try{return a=n[1],l=a.labels,c=a.texts,u=a.textures,l&&c&&l.forEach((function(e){var t=e.text_settings_key,i=c[t]&&c[t][e.text],n=r.feature_style;n.label=e.label,n.linked=e.linked,n.size=i.size.logical_size,n.texcoords=i.align[e.label.align].texcoords,n.label_texture=u[i.align[e.label.align].texture_id],n.blend_order=e.draw.blend_order,vo.addFeature.call(r,e.feature,e.draw,e.context)})),this.freeText(e),Promise.resolve(vo.endData.call(this,e)).then((function(e){try{return(h=e)&&u&&u.length&&(h.textures=h.textures||[],(d=h.textures).push.apply(d,u)),t(h)}catch(e){return i(e)}}),i)}catch(e){return i(e)}}.bind(this),i))}.bind(this))},_preprocess:function(e){e.color=Dn.createColorPropertyCache(e.color),e.alpha=Dn.createPropertyCache(e.alpha),e.texture=void 0!==e.texture?e.texture:this.texture,e.blend_order=this.getBlendOrderForDraw(e),e.outline&&(e.outline.color=Dn.createColorPropertyCache(e.outline.color),e.outline.alpha=Dn.createPropertyCache(e.outline.alpha),e.outline.width=Dn.createPropertyCache(e.outline.width,Dn.parsePositiveNumber)),e.z=Dn.createPropertyCache(e.z,Dn.parseUnits);try{e.size=Dn.createPointSizePropertyCache(e.size,e.texture)}catch(t){return Ki({level:"warn",once:!0},"Layer group '"+e.layers.join(", ")+"': "+t+" ("+JSON.stringify(e.size)+"), features that match this layer group won't be drawn."),null}if(e.offset=Dn.createPropertyCache(e.offset,(function(e){return Array.isArray(e)&&e.map(Dn.parseNumber)})),e.buffer=Dn.createPropertyCache(e.buffer,(function(e){return(Array.isArray(e)?e:[e,e]).map(Dn.parsePositiveNumber)})),e.repeat_distance=Dn.createPropertyCache(e.repeat_distance,Dn.parseNumber),e.placement=qa[e.placement&&e.placement.toUpperCase()],null==e.placement&&(e.placement=qa.VERTEX),e.placement_spacing=null!=e.placement_spacing?e.placement_spacing:80,e.placement_spacing=Dn.createPropertyCache(e.placement_spacing,Dn.parsePositiveNumber),e.placement_min_length_ratio=null!=e.placement_min_length_ratio?e.placement_min_length_ratio:1,e.placement_min_length_ratio=Dn.createPropertyCache(e.placement_min_length_ratio,Dn.parsePositiveNumber),"number"==typeof e.angle)e.angle=e.angle*Math.PI/180;else if("function"==typeof e.angle){var t=e.angle;e.angle=function(e){return t(e)*Math.PI/180}}else e.angle=e.angle||0;return e.text=this.preprocessText(e.text),e.text&&(e.text.key=e.key,e.text.group=e.group,e.text.layers=e.layers,e.text.order=e.order,e.text.blend_order=e.blend_order,e.text.repeat_group=null!=e.text.repeat_group?e.text.repeat_group:e.repeat_group,e.text.anchor=e.text.anchor||this.default_anchor,e.text.optional="boolean"==typeof e.text.optional&&e.text.optional,e.text.interactive=e.text.interactive||e.interactive),e},default_anchor:["bottom","top","right","left"],computeLayout:function(e,t,i,r,n){var o=e||{};o.id=t,o.units_per_pixel=n.units_per_pixel||1,o.collide=!1!==i.collide,o.anchor=i.anchor,o.offset=Dn.evalCachedProperty(i.offset,r)||Dn.zeroPair,o.buffer=Dn.evalCachedProperty(i.buffer,r)||Dn.zeroPair,o.repeat_distance=Dn.evalCachedProperty(i.repeat_distance,r),o.repeat_distance&&(o.repeat_distance*=o.units_per_pixel,o.repeat_scale=1,"function"==typeof i.repeat_group?o.repeat_group=i.repeat_group(r):o.repeat_group=i.repeat_group||r.layer);var s=i.priority;return null!=s?"function"==typeof s&&(s=s(r)):s=-1>>>0,o.priority=s,o},buildTextLabels:function(e,t){for(var i=[],r=0;r<t.length;r++){var n=t[r],o=this.texts[e.id][n.text_settings_key][n.text].size.collision_size;n.label=new la(n.point_label.position,o,n.layout),i.push(n)}return i},buildLabels:function(e,t,i){var r=[];if("Point"===t.type)r.push(new la(t.coordinates,e,i,i.angle));else if("MultiPoint"===t.type)for(var n=t.coordinates,o=0;o<n.length;++o){var s=n[o];r.push(new la(s,e,i,i.angle))}else if("LineString"===t.type)for(var a=ha(t.coordinates,e,i),l=0;l<a.length;++l)r.push(a[l]);else if("MultiLineString"===t.type)for(var c=t.coordinates,u=0;u<c.length;u++)for(var h=ha(c[u],e,i),d=0;d<h.length;++d)r.push(h[d]);else if("Polygon"===t.type)if(i.placement===qa.CENTROID){var p=an.centroid(t.coordinates);p&&r.push(new la(p,e,i,i.angle))}else for(var f=t.coordinates,A=0;A<f.length;A++)for(var m=ha(f[A],e,i),g=0;g<m.length;++g)r.push(m[g]);else if("MultiPolygon"===t.type)if(i.placement===qa.CENTROID){var _=an.multiCentroid(t.coordinates);_&&r.push(new la(_,e,i,i.angle))}else for(var y=t.coordinates,v=0;v<y.length;v++)for(var x=y[v],b=0;b<x.length;b++)for(var w=ha(x[b],e,i),T=0;T<w.length;++T)r.push(w[T]);return r},makeVertexTemplate:function(e,t,i){void 0===i&&(i=!0);var r=0;this.vertex_template[r++]=0,this.vertex_template[r++]=0,this.vertex_template[r++]=e.z||0,this.vertex_template[r++]=this.scaleOrder(e.order),this.vertex_template[r++]=0,this.vertex_template[r++]=0,this.vertex_template[r++]=0,this.vertex_template[r++]=e.label.layout.collide?0:1,t.variant.shader_point||(this.vertex_template[r++]=0,this.vertex_template[r++]=0),this.vertex_template[r++]=0,this.vertex_template[r++]=0;var n=e.color||Dn.defaults.color;if(this.vertex_template[r++]=255*n[0],this.vertex_template[r++]=255*n[1],this.vertex_template[r++]=255*n[2],this.vertex_template[r++]=255*(null!=e.alpha?e.alpha:n[3]),t.variant.selection&&(this.vertex_template[r++]=255*e.selection_color[0],this.vertex_template[r++]=255*e.selection_color[1],this.vertex_template[r++]=255*e.selection_color[2],this.vertex_template[r++]=255*e.selection_color[3]),t.variant.shader_point){var o=e.outline_color||Dn.defaults.outline.color;this.vertex_template[r++]=255*o[0],this.vertex_template[r++]=255*o[1],this.vertex_template[r++]=255*o[2],this.vertex_template[r++]=255*(null!=e.outline_alpha?e.outline_alpha:o[3]),this.vertex_template[r++]=e.outline_edge_pct||Dn.defaults.outline.width}return i&&this.addCustomAttributesToVertexTemplate(e,r),this.vertex_template},buildQuad:function(e,t,i,r,n,o,s,a,l,c,u){return t[0]<=0||t[1]<=0?0:function(e,t,i,r,n,o,s,a,l,c,u,h){var d=n[0]*Us,p=n[1]*Us;js[0]=-d,js[1]=-p,js[2]=d,js[3]=p;for(var f=u||Io,A=t.vertex_elements,m=t.vertex_count,g=0;g<4;g++)i[r.a_position+0]=e[0],i[r.a_position+1]=e[1],i[r.a_shape+0]=js[Ns[g]],i[r.a_shape+1]=js[Qs[g]],i[r.a_shape+2]=l,i[r.a_offset+0]=o[0],i[r.a_offset+1]=o[1],r.a_texcoord&&(i[r.a_texcoord+0]=f[Ns[g]]*Os,i[r.a_texcoord+1]=f[Qs[g]]*Os),h&&(i[r.a_pre_angles+0]=zs*a[0],i[r.a_pre_angles+1]=zs*a[1],i[r.a_pre_angles+2]=zs*a[2],i[r.a_pre_angles+3]=zs*a[3],i[r.a_angles+0]=Rs*c[0],i[r.a_angles+1]=Rs*c[1],i[r.a_angles+2]=Rs*c[2],i[r.a_angles+3]=Rs*c[3],i[r.a_offsets+0]=Ds*s[0],i[r.a_offsets+1]=Ds*s[1],i[r.a_offsets+2]=Ds*s[2],i[r.a_offsets+3]=Ds*s[3]),t.addVertex(i);return A.push(m+0),A.push(m+1),A.push(m+2),A.push(m+2),A.push(m+3),A.push(m+0),2}(e,c,u,c.vertex_layout.index,t,o,s,n,4096*i,r,a,l)},build:function(e,t){var i=e.label;return"curved"===i.type?this.buildCurvedLabel(i,e,t):this.buildStraightLabel(i,e,t)},buildStraightLabel:function(e,t,i){var r,n,o=this.getTileMesh(i.tile,this.meshVariantTypeForDraw(t)),s=this.makeVertexTemplate(t,o);"point"!==e.type?(r=t.size[e.type],n=t.texcoords[e.type].texcoord):(r=t.size,n=t.texcoords),o.uniforms=o.uniforms||{},t.label_texture?(o.uniforms.u_texture=t.label_texture,o.uniforms.u_point_type=2,o.uniforms.u_apply_color_blocks=!1):t.texture?(o.uniforms.u_texture=t.texture,o.uniforms.u_point_type=1,o.uniforms.u_apply_color_blocks=!0):(o.uniforms.u_texture=Hr.default,o.uniforms.u_point_type=3,o.uniforms.u_apply_color_blocks=!0);var a=e.offset,l=this.buildQuad(e.position,r,e.angle,null,null,a,null,n,!1,o.vertex_data,s),c=t.linked&&t.linked.label.id;return this.trackLabel(e,c,o,l,i),l},buildCurvedLabel:function(e,t,i){for(var r,n,o=0,s=0;s<e.num_segments;s++){var a=t.size[e.type][s],l=t.texcoords_stroke[s];t.label_texture=t.label_textures[s],r=this.getTileMesh(i.tile,this.meshVariantTypeForDraw(t)),n=this.makeVertexTemplate(t,r),r.uniforms=r.uniforms||{},r.uniforms.u_texture=t.label_texture,r.uniforms.u_point_type=2,r.uniforms.u_apply_color_blocks=!1;var c=e.offset||[0,0],u=e.position,h=e.angles[s],d=e.offsets[s],p=e.pre_angles[s],f=this.buildQuad(u,a,e.angle,h,p,c,d,l,!0,r.vertex_data,n);o+=f;var A=t.linked&&t.linked.label.id;this.trackLabel(e,A,r,f,i)}for(var m=0;m<e.num_segments;m++){var g=t.size[e.type][m],_=t.texcoords[e.type][m].texcoord;t.label_texture=t.label_textures[m],r=this.getTileMesh(i.tile,this.meshVariantTypeForDraw(t)),n=this.makeVertexTemplate(t,r),r.uniforms=r.uniforms||{},r.uniforms.u_texture=t.label_texture,r.uniforms.u_point_type=2,r.uniforms.u_apply_color_blocks=!1;var y=e.offset||[0,0],v=e.position,x=e.angles[m],b=e.offsets[m],w=e.pre_angles[m],T=this.buildQuad(v,g,e.angle,x,w,y,b,_,!0,r.vertex_data,n);o+=T;var B=t.linked&&t.linked.label.id;this.trackLabel(e,B,r,T,i)}return o},trackLabel:function(e,t,i,r){if(e.layout.collide||e.may_repeat_across_tiles){i.labels=i.labels||{},i.labels[e.id]=i.labels[e.id]||{container:{label:e.toJSON(),linked:t},ranges:[]};var n=2*r,o=i.vertex_data.offset-i.vertex_data.stride*n;i.labels[e.id].ranges.push([o,n])}},buildLines:function(e,t,i){return this.build(t,i)},buildPoints:function(e,t,i){return this.build(t,i)},buildPolygons:function(e,t,i){return this.build(t,i)},vertexLayoutForMeshVariant:function(e){if(null==this.vertex_layouts[e.shader_point]){var t=[{name:"a_position",size:4,type:Xn.SHORT,normalized:!1},{name:"a_shape",size:4,type:Xn.SHORT,normalized:!1},{name:"a_texcoord",size:2,type:Xn.UNSIGNED_SHORT,normalized:!0,static:e.shader_point?[0,0]:null},{name:"a_offset",size:2,type:Xn.SHORT,normalized:!1},{name:"a_color",size:4,type:Xn.UNSIGNED_BYTE,normalized:!0},{name:"a_selection_color",size:4,type:Xn.UNSIGNED_BYTE,normalized:!0,static:e.selection?null:[0,0,0,0]},{name:"a_outline_color",size:4,type:Xn.UNSIGNED_BYTE,normalized:!0,static:e.shader_point?null:[0,0,0,0]},{name:"a_outline_edge",size:1,type:Xn.FLOAT,normalized:!1,static:e.shader_point?null:0}];this.addCustomAttributesToAttributeList(t),this.vertex_layouts[e.shader_point]=new Eo(t)}return this.vertex_layouts[e.shader_point]},meshVariantTypeForDraw:function(e){var t=e.label_texture||e.texture||"__shader_point",i=t+"/"+e.blend_order;return null==this.variants[i]&&(this.variants[i]={key:i,selection:1,shader_point:"__shader_point"===t,blend_order:e.blend_order,mesh_order:e.label_texture?1:0}),this.variants[i]},makeMesh:function(e,t,i){return void 0===i&&(i={}),i=Object.assign({},i,{fade_in_time:this.fade_in_time}),vo.makeMesh.call(this,e,t,i)}});var Wa=Math.abs;O(O.S,"Math",{hypot:function(e,t){for(var i,r,n=0,o=0,s=arguments.length,a=0;o<s;)a<(i=Wa(arguments[o++]))?(n=n*(r=a/i)*r+1,a=i):n+=i>0?(r=i/a)*r:i;return a===1/0?1/0:a*Math.sqrt(n)}});var Xa=[0,.33,.66,.99],Ya=function(e,t,i,r){for(var n=[{type:"straight",tolerance:r.no_curving?1.8:1.5},{type:"curved"},{type:"straight",tolerance:2.3}],o=0;o<n.length;o++){var s=n[o],a=void 0;if("straight"===s.type?a=new el(t,i,r,s.tolerance):"curved"===s.type&&!r.no_curving&&i.length>2&&(a=new tl(e,i,r)),a&&!a.throw_away)return a}return!1},Ja=function(){function e(e){this.id=ra.nextLabelId(),this.layout=e,this.position=[],this.angle=0,this.offset=e.offset.slice(),this.unit_scale=this.layout.units_per_pixel,this.obbs=[],this.aabbs=[],this.type="",this.throw_away=!1}var t=e.prototype;return t.toJSON=function(){return{id:this.id,type:this.type,position:this.position,size:this.size,offset:this.offset,angle:this.angle,breach:this.breach,may_repeat_across_tiles:this.may_repeat_across_tiles,layout:na(this.layout)}},e.splitLineByOrientation=function(e){for(var t=[e[0]],i=0,r=0,n=0,o=t,s=!1,a=1;a<e.length;a++){var l=e[a],c=e[a-1],u=oo.length(oo.sub(l,c));l[0]>c[0]?1===n?(t.push(l),(i+=u)>r&&(o=t,r=i,s=!1)):(t=[c,l],(i=u)>r&&(o=t,r=i,s=!1),n=1):l[0]<c[0]?-1===n?(t.unshift(l),(i+=u)>r&&(o=t,r=i,s=!0)):(t=[l,c],(i=u)>r&&(o=t,r=i,s=!0),n=-1):(-1===n?t.unshift(l):(t.push(l),n=1),(i+=u)>r&&(o=t,r=i,s=-1===n))}return[o,s]},t.discard=function(e,t){if(void 0===t&&(t=null),this.throw_away)return!0;for(var i=0;i<this.obbs.length;i++){var r={aabb:this.aabbs[i],obb:this.obbs[i]};if(ra.prototype.occluded.call(r,e,t))return!0}return!1},t.inTileBounds=function(){for(var e=0;e<this.aabbs.length;e++){var t={aabb:this.aabbs[e]};if(!ra.prototype.inTileBounds.call(t))return!1}return!0},e.createOBB=function(e,t,i,r,n,o,s){var a=e[0],l=e[1];return!o||0===o[0]&&0===o[1]||(a+=(o=oo.rot(o,n))[0]*s,l-=o[1]*s),new ia(a,l,-r,t,i)},e}(),el=function(e){function t(t,i,r,n){var o;return(o=e.call(this,r)||this).type="straight",o.size=t,o.throw_away=!o.fit(t,i,r,n),o}ft(t,e);var i=t.prototype;return i.fit=function(e,t,i,r){var n,o=this.unit_scale,s=Ja.splitLineByOrientation(t);t=s[0],n=s[1],"number"==typeof i.orientation&&(this.offset[1]+=1.2*(e[1]-i.vertical_buffer),n&&(this.offset[1]*=-1),-1===i.orientation&&(this.offset[1]*=-1));for(var a=nl(t),l=e[0]*o,c=0;c<t.length-1;c++)for(var u=t[c],h=0,d=0,p=c+1,f=void 0;p<t.length;){var A=t[p-1],m=t[p],g=rl(A,m);if(p!==c+1&&(h+=ol(g,f)),Math.abs(h)>.1)break;if(il(d+=a[p-1],l)<r){var _=oo.mult(oo.add(u,m),.5);return this.angle=-g,Math.abs(this.angle-Math.PI/2)<.01&&(this.angle=-Math.PI/2,"number"==typeof i.orientation&&(this.offset[1]*=-1)),this.position=_,this.updateBBoxes(this.position,e,this.angle,this.angle,this.offset),!0}f=g,p++}return!1},i.updateBBoxes=function(e,t,i,r,n){var o=this.unit_scale;this.obbs=[],this.aabbs=[];var s=(t[0]+2*this.layout.buffer[0])*o*ra.epsilon,a=(t[1]+2*this.layout.buffer[1])*o*ra.epsilon,l=Ja.createOBB(e,s,a,i,r,n,o),c=l.getExtent();this.obbs.push(l),this.aabbs.push(c),this.inTileBounds&&(this.breach=!this.inTileBounds()),this.mayRepeatAcrossTiles&&(this.may_repeat_across_tiles=this.mayRepeatAcrossTiles())},t}(Ja),tl=function(e){function t(t,i,r){var n;return(n=e.call(this,r)||this).type="curved",n.angles=[],n.pre_angles=[],n.offsets=[],n.num_segments=t.length,n.sizes=t,n.throw_away=!n.fit(n.sizes,i,r),n}ft(t,e);var i=t.prototype;return i.toJSON=function(){return{id:this.id,type:this.type,obbs:this.obbs.map((function(e){return e.toJSON()})),position:this.position,breach:this.breach,may_repeat_across_tiles:this.may_repeat_across_tiles,layout:na(this.layout)}},i.fit=function(e,i,r){var n,o=this.unit_scale,s=Math.max.apply(Math,e.map((function(e){return e[1]}))),a=s*o,l=Ja.splitLineByOrientation(i);i=l[0],n=l[1],"number"==typeof r.orientation&&(this.offset[1]+=1.2*(s-r.vertical_buffer),n&&(this.offset[1]*=-1),-1===r.orientation&&(this.offset[1]*=-1));var c=nl(i),u=e.map((function(e){return e[0]*o})),h=c.reduce((function(e,t){return e+t}),0),d=u.reduce((function(e,t){return e+t}),0);if(d>h)return!1;var p=i.length-1;if(p-0<2)return!1;var f=t.curvaturePlacement(i,h,c,d,0,p),A=i[f];if(-1===f||p-f<2)return!1;this.position=A;for(var m=0;m<u.length;m++){this.offsets[m]=[],this.angles[m]=[],this.pre_angles[m]=[];for(var g=0;g<Xa.length;g++){var _=Xa[g],y=t.scaleLine(_,i),v=y[0],x=y[1];A=v[f];var b=t.placeAtIndex(f,v,x,u),w=b.positions,T=b.offsets,B=b.angles,C=b.pre_angles,S=T.map((function(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])/o}));if(0===_){this.angle=1/B.length*B.reduce((function(e,t){return e+t}));for(var E=0;E<w.length;E++){var M=w[E],I=C[E],P=u[E],L=I+B[E],F=this.angle,k=Ja.createOBB(M,P,a,L,F,this.offset,o),z=k.getExtent();this.obbs.push(k),this.aabbs.push(z)}}this.offsets[m].push(S[m]),this.angles[m].push(B[m]),this.pre_angles[m].push(C[m])}}return!0},t.curvaturePlacement=function(e,t,i,r,n,o){n=n||0,o=o||e.length-1;for(var s=[],a=n+1;a<o;a++){var l=e[a-1],c=e[a],u=e[a+1],h=oo.perp(c,l),d=oo.perp(u,c),p=oo.angleBetween(h,d);p>1&&(p=1/0),s.push(p)}s.push(1/0);for(var f=[],A=[],m=n,g=0,_=0;_<n;_++)g+=i[_];for(;g+r<t;){for(var y=g+r,v=g,x=m,b=0;x<o&&v+i[x]<y&&(b+=s[x])!==1/0;)v+=i[x],x++;if(0===b)return m;var w=b/(x-m);f.push(b),A.push(w),g+=i[m],m++}if(0===f.length)return-1;var T=Math.min.apply(null,f),B=A[f.indexOf(T)];return T<1.3&&B<.4?f.indexOf(T):-1},t.scaleLine=function(e,t){var i=[t[0]],r=[];return t.forEach((function(n,o){if(o!==t.length-1){var s=oo.sub(t[o+1],t[o]),a=oo.mult(s,1+e);i.push(oo.add(i[o],a)),r.push(oo.length(a))}})),[i,r]},t.placeAtIndex=function(e,i,r,n){var o=i[e],s=t.getIndicesAndOffsets(e,r,n),a=s[0],l=s[1],c=t.getPositionsFromIndicesAndOffsets(i,a,l),u=t.getAnglesFromIndicesAndOffsets(o,a,i,c);return{positions:c,offsets:u[0],angles:u[1],pre_angles:u[2]}},t.getIndicesAndOffsets=function(e,t,i){for(var r=i.length,n=[],o=[],s=0,a=0,l=0;s<r;){for(var c=i[s];s<r&&a+.5*c<=l+t[e];){var u=a-l+.5*c;o.push(u),n.push(e),a+=c,c=i[++s]}l+=t[e],e++}return[n,o]},t.getPositionsFromIndicesAndOffsets=function(e,t,i){for(var r=[],n=0;n<t.length;n++){var o=t[n],s=i[n],a=rl(e[o],e[o+1]),l=oo.rot([s,0],a),c=oo.add(e[o],l);r.push(c)}return r},t.getAnglesFromIndicesAndOffsets=function(e,t,i,r){for(var n=[],o=[],s=[],a=0;a<r.length;a++){var l=r[a],c=t[a],u=oo.sub(l,e),h=-oo.angle(u),d=-rl(i[c],i[c+1])-h;if(a>0){var p=n[a-1],f=o[a-1];Math.abs(h-p)>Math.PI&&(h+=h>p?-2*Math.PI:2*Math.PI),Math.abs(f-d)>Math.PI&&(d+=d>f?-2*Math.PI:2*Math.PI)}n.push(h),o.push(d),s.push(u)}return[s,n,o]},t}(Ja);function il(e,t){return t/e}function rl(e,t){var i=oo.sub(t,e);return oo.angle(i)}function nl(e){for(var t=[],i=0;i<e.length-1;i++){var r=e[i],n=e[i+1],o=Math.hypot(r[0]-n[0],r[1]-n[1]);t.push(o)}return t}function ol(e,t){var i,r;for(e>t?(i=t,r=e):(i=e,r=t);r-i>Math.PI;)i+=2*Math.PI;return Math.abs(r-i)}var sl=Object.create(Ka);Object.assign(sl,{name:"text",super:Ka,built_in:!0,init:function(e){void 0===e&&(e={}),vo.init.call(this,e),this.setupDefines(),this.defines.TANGRAM_HAS_SHADER_POINTS=!1,this.defines.TANGRAM_CURVED_LABEL=!0,this.reset()},makeVertexTemplate:function(e,t){this.super.makeVertexTemplate.call(this,e,t,!1);for(var i=t.vertex_data.vertex_layout.index.a_pre_angles,r=0;r<12;r++)this.vertex_template[i++]=0;return this.addCustomAttributesToVertexTemplate(e,i),this.vertex_template},reset:function(){this.queues={},this.resetText()},addFeature:function(e,t,i){var r=this,n=i.tile;if(n.generation===this.generation){var o=e.geometry.type;t.can_articulate="LineString"===o||"MultiLineString"===o,t.supersample_text="LineString"===o||"MultiLineString"===o;var s=this.parseTextFeature(e,t,i,n);s&&(s instanceof Array?s.forEach((function(t){t.feature=e,t.context=i,t.layout.vertex=!1,r.queueFeature(t,n)})):(s.feature=e,s.context=i,s.layout.vertex=!1,this.queueFeature(s,n)),aa.addStyle(this.name,n.id))}},endData:function(e){return new Promise(function(t,i){var r,n,o,s,a,l,c,u;return r=this,n=this.queues[e.id],delete this.queues[e.id],Promise.resolve(this.collideAndRenderTextLabels(e,this.name,n)).then(function(n){try{return s=(o=n).labels,a=o.texts,l=o.textures,s&&a&&(this.texts[e.id]=a,s.forEach((function(t){var i=t.text_settings_key,n=r.texts[e.id][i]&&r.texts[e.id][i][t.text],o=r.feature_style;o.label=t.label,n.text_settings.can_articulate?(o.size={},o.texcoords={},"straight"===t.label.type?(o.size.straight=n.size.logical_size,o.texcoords.straight=n.texcoords.straight,o.label_texture=l[n.texcoords.straight.texture_id]):(o.size.curved=n.segment_sizes.map((function(e){return e.logical_size})),o.texcoords_stroke=n.texcoords_stroke,o.texcoords.curved=n.texcoords.curved,o.label_textures=n.texcoords.curved.map((function(e){return l[e.texture_id]})))):(o.size=n.size.logical_size,o.texcoords=n.align[t.label.align].texcoords,o.label_texture=l[n.align[t.label.align].texture_id]),o.blend_order=t.draw.blend_order,vo.addFeature.call(r,t.feature,t.draw,t.context)}))),this.freeText(e),Promise.resolve(vo.endData.call(this,e)).then((function(e){try{if(c=e)for(var r in l&&l.length&&(u=c.textures).push.apply(u,l),c.meshes)c.meshes[r].uniforms.u_apply_color_blocks=!0;return t(c)}catch(e){return i(e)}}),i)}catch(e){return i(e)}}.bind(this),i)}.bind(this))},_preprocess:function(e){return e.blend_order=this.getBlendOrderForDraw(e),this.preprocessText(e)},buildTextLabels:function(e,t){for(var i=[],r=0;r<t.length;r++){var n=t[r],o=this.texts[e.id][n.text_settings_key][n.text],s=void 0;if(n.layout.vertical_buffer=o.vertical_buffer,o.text_settings.can_articulate){var a=o.segment_sizes.map((function(e){return e.collision_size}));n.layout.no_curving=o.no_curving,s=this.buildLabels(a,n.feature.geometry,n.layout,o.size.collision_size)}else s=this.buildLabels(o.size.collision_size,n.feature.geometry,n.layout);for(var l=0;l<s.length;l++){var c=Object.create(n);c.label=s[l],i.push(c)}}return i},buildLabels:function(e,t,i,r){var n=[];if("LineString"===t.type)Array.prototype.push.apply(n,this.buildLineLabels(t.coordinates,e,i,r));else if("MultiLineString"===t.type)for(var o=t.coordinates,s=0;s<o.length;++s)Array.prototype.push.apply(n,this.buildLineLabels(o[s],e,i,r));else if("Point"===t.type)n.push(new la(t.coordinates,e,i));else if("MultiPoint"===t.type)for(var a=t.coordinates,l=0;l<a.length;++l)n.push(new la(a[l],e,i));else if("Polygon"===t.type){var c=an.centroid(t.coordinates);c&&n.push(new la(c,e,i))}else if("MultiPolygon"===t.type){var u=an.multiCentroid(t.coordinates);u&&n.push(new la(u,e,i))}return n},buildLineLabels:function(e,t,i,r){var n=[],o=Math.min(i.subdiv,e.length-1);if(o>1)for(var s=(e.length-1)/o,a=0;a<o;a++){var l=Math.floor(a*s),c=Math.floor((a+1)*s)+1,u=e.slice(l,c),h=Ya(t,r,u,i);h&&n.push(h)}if(n.length<o){var d=Ya(t,r,e,i);d&&n.push(d)}return n},vertexLayoutForMeshVariant:function(e){if(null==this.vertex_layouts[e.shader_point]){var t=[{name:"a_position",size:4,type:Xn.SHORT,normalized:!1},{name:"a_shape",size:4,type:Xn.SHORT,normalized:!1},{name:"a_texcoord",size:2,type:Xn.UNSIGNED_SHORT,normalized:!0},{name:"a_offset",size:2,type:Xn.SHORT,normalized:!1},{name:"a_color",size:4,type:Xn.UNSIGNED_BYTE,normalized:!0},{name:"a_selection_color",size:4,type:Xn.UNSIGNED_BYTE,normalized:!0,static:e.selection?null:[0,0,0,0]},{name:"a_pre_angles",size:4,type:Xn.BYTE,normalized:!1},{name:"a_angles",size:4,type:Xn.SHORT,normalized:!1},{name:"a_offsets",size:4,type:Xn.UNSIGNED_SHORT,normalized:!1}];this.addCustomAttributesToAttributeList(t),this.vertex_layouts[e.shader_point]=new Eo(t)}return this.vertex_layouts[e.shader_point]}}),sl.texture_id=0;var al=Object.create(hs);Object.assign(al,{name:"raster",super:hs,built_in:!0,init:function(){this.raster=this.raster||"color",this.super.init.apply(this,arguments),this.selection=!1},_preprocess:function(e){return e.color=e.color||Dn.defaults.color,this.super._preprocess.apply(this,arguments)}});var ll=function(){function e(){this.styles={},this.base_styles={},this.active_styles=[],this.active_blend_orders=[],this.register(Object.create(hs)),this.register(Object.create(ks)),this.register(Object.create(Ka)),this.register(Object.create(sl)),this.register(Object.create(al))}var t=e.prototype;return t.init=function(){Yr.removeBlock("global"),Yr.removeBlock("setup"),Yr.addBlock("global","#ifdef TANGRAM_VERTEX_SHADER\n\n// Apply layer ordering to avoid z-fighting\nvoid applyLayerOrder (float layer, inout vec4 position) {\n    position.z -= layer * TANGRAM_LAYER_DELTA * position.w;\n}\n\n// Vertex position in model space: [0, 1] range over the local tile\n// Note positions can be outside that range due to unclipped geometry, geometry higher than a unit cube, etc.\nvec4 modelPosition() {\n    return\n        vec4(\n            a_position.xyz / TANGRAM_TILE_SCALE         // scale coords to ~0-1 range\n            * exp2(u_tile_origin.z - u_tile_origin.w),  // adjust for tile overzooming\n        1.)\n        + vec4(0., 1., 0., 0.);\n        // NB: additional offset to account for unusual Tangram JS y coords,\n        // should be refactored to remove\n}\n\n// Position in model space as above, but according to tile coordinate (as opposed to style) zoom\n// e.g. unadjusted for tile overzooming\nvec4 modelPositionBaseZoom() {\n    return\n        vec4(\n            a_position.xyz / TANGRAM_TILE_SCALE,    // scale coords to ~0-1 range\n        1.)\n        + vec4(0., 1., 0., 0.); // see note on offset above\n}\n\n#endif\n\n// Vertex position in world coordinates, useful for 3d procedural textures, etc.\nvec4 worldPosition() {\n    return v_world_position;\n}\n\n// Optionally wrap world coordinates (allows more precision at higher zooms)\n// e.g. at wrap 1000, the world space will wrap every 1000 meters\n#ifdef TANGRAM_VERTEX_SHADER\n\nvec4 wrapWorldPosition(vec4 world_position) {\n    #if defined(TANGRAM_WORLD_POSITION_WRAP)\n    vec2 anchor = u_tile_origin.xy - mod(u_tile_origin.xy, TANGRAM_WORLD_POSITION_WRAP);\n        world_position.xy -= anchor;\n    #endif\n    return world_position;\n}\n\n#endif\n\n// Normal in world space\n#if defined(TANGRAM_VERTEX_SHADER)\n\nvec3 worldNormal() {\n    return TANGRAM_NORMAL;\n}\n\n#elif defined(TANGRAM_FRAGMENT_SHADER)\n\nvec3 worldNormal() {\n    return u_inverseNormalMatrix * TANGRAM_NORMAL;\n}\n\n#endif\n"),Yr.addBlock("global","// Vertex attribute + varying for feature selection\n#if defined(TANGRAM_FEATURE_SELECTION) && defined(TANGRAM_VERTEX_SHADER)\n    attribute vec4 a_selection_color;\n    varying vec4 v_selection_color;\n#endif\n"),Yr.replaceBlock("setup","// Selection pass-specific rendering\n#if defined(TANGRAM_FEATURE_SELECTION) && defined(TANGRAM_VERTEX_SHADER)\n    if (a_selection_color.rgb == vec3(0.)) {\n        // Discard by forcing invalid triangle if we're in the feature\n        // selection pass but have no selection info\n        // TODO: in some cases we may actually want non-selectable features to occlude selectable ones?\n        gl_Position = vec4(0., 0., 0., 1.);\n        return;\n    }\n    v_selection_color = a_selection_color;\n#endif\n"),Yr.defines.TANGRAM_EPSILON=1e-5,Yr.defines.TANGRAM_LAYER_DELTA=1/16384,Yr.defines.TANGRAM_TILE_SCALE="vec3("+an.tile_scale+"., "+an.tile_scale+"., u_meters_per_pixel * "+an.tile_size+".)",Yr.defines.TANGRAM_HEIGHT_SCALE=an.height_scale,Yr.defines.TANGRAM_ALPHA_TEST=.5},t.destroy=function(e){var t=this;Object.keys(this.styles).forEach((function(i){var r=t.styles[i];r.gl===e&&(Ki("trace","StyleManager.destroy: destroying render style "+r.name),r.base&&t.remove(r.name),r.destroy())}))},t.register=function(e){this.styles[e.name]=e,this.base_styles[e.name]=e},t.remove=function(e){delete this.styles[e]},t.getActiveStyles=function(){return this.active_styles},t.updateActiveStyles=function(e){return this.active_styles=Object.keys(e.reduce((function(e,t){return Object.keys(t.meshes).forEach((function(t){return e[t]=!0})),e}),{})),this.active_styles},t.getActiveBlendOrders=function(){return this.active_blend_orders},t.updateActiveBlendOrders=function(e){var t=[];e.forEach((function(e){Object.entries(e.meshes).forEach((function(e){var i=e[0];e[1].forEach((function(e){var r=e.variant.blend_order,n=t.findIndex((function(e){return e.blend_order===r}));n=n>-1?n:t.push({blend_order:r,styles:[]})-1,-1===t[n].styles.indexOf(i)&&t[n].styles.push(i)}))}))})),this.active_blend_orders=t.sort((function(e,t){return e.blend_order-t.blend_order}))},t.mix=function(e,t){if(e.mixed)return e;e.mixed={};var i,r=[];e.mix&&(Array.isArray(e.mix)?(i=r).push.apply(i,e.mix):r.push(e.mix),(r=r.map((function(e){return t[e]})).filter((function(t){return t&&t!==e}))).forEach((function(t){return e.mixed[t.name]=!0}))),r.push(e),e.animated=r.some((function(e){return e&&e.animated})),e.texcoords=r.some((function(e){return e&&e.texcoords})),e.base=r.map((function(e){return e.base})).filter((function(e){return e})).pop(),e.lighting=r.map((function(e){return e.lighting})).filter((function(e){return null!=e})).pop(),e.texture=r.map((function(e){return e.texture})).filter((function(e){return e})).pop(),e.raster=r.map((function(e){return e.raster})).filter((function(e){return null!=e})).pop(),e.dash=r.map((function(e){return e.dash})).filter((function(e){return null!=e})).pop(),e.dash_background_color=r.map((function(e){return e.dash_background_color})).filter((function(e){return null!=e})).pop(),r.some((function(e){return Object.prototype.hasOwnProperty.call(e,"blend")&&e.blend}))&&(e.blend=r.map((function(e){return Object.prototype.hasOwnProperty.call(e,"blend")&&e.blend})).filter((function(e){return e})).pop()),e.blend_order=r.map((function(e){return e.blend_order})).filter((function(e){return null!=e})).pop(),e.defines=Object.assign.apply(Object,[{}].concat(r.map((function(e){return e.defines})).filter((function(e){return e})))),e.material=Object.assign.apply(Object,[{}].concat(r.map((function(e){return e.material})).filter((function(e){return e}))));var n=r.map((function(e){return e.draw})).filter((function(e){return e}));return n.length>0&&(e.draw=sn.apply(void 0,[{}].concat(n))),this.mixShaders(e,t,r),e},t.mixShaders=function(e,t,i){var r={},n=i.map((function(e){return e.shaders})).filter((function(e){return e}));if(r.defines=Object.assign.apply(Object,[{}].concat(n.map((function(e){return e.defines})).filter((function(e){return e})))),r.attributes=Object.assign.apply(Object,[{}].concat(n.map((function(e){return e.attributes})).filter((function(e){return e})))),r.uniforms={},r._uniforms=e.shaders&&e.shaders.uniforms||{},r._uniform_scopes={},i.filter((function(e){return e.shaders&&e.shaders.uniforms})).forEach((function(e){var i=function(i){r._uniform_scopes[i]=e.name,Object.defineProperty(r.uniforms,i,{enumerable:!0,configurable:!0,get:function(){return void 0!==r._uniforms[i]?r._uniforms[i]:t[r._uniform_scopes[i]].shaders.uniforms!==r.uniforms?t[r._uniform_scopes[i]].shaders.uniforms[i]:void 0},set:function(e){r._uniforms[i]=e}})};for(var n in e.shaders.uniforms)i(n)})),r.extensions=Object.keys(n.map((function(e){return e.extensions})).filter((function(e){return e})).reduce((function(e,t){return"string"==typeof t?e[t]=!0:t.forEach((function(t){return e[t]=!0})),e}),{})||{}),e.shaders&&e.shaders.blocks)for(var o in e.shaders.block_scopes=e.shaders.block_scopes||{},e.shaders.blocks){var s,a=e.shaders.blocks[o];e.shaders.block_scopes[o]=e.shaders.block_scopes[o]||[],Array.isArray(a)?(s=e.shaders.block_scopes[o]).push.apply(s,a.map((function(){return e.name}))):e.shaders.block_scopes[o].push(e.name)}var l={};return n.forEach((function(e){if(e.blocks){r.blocks=r.blocks||{},r.block_scopes=r.block_scopes||{};var t={};for(var i in e.blocks){var n=e.blocks[i],o=e.block_scopes[i];r.blocks[i]=r.blocks[i]||[],r.block_scopes[i]=r.block_scopes[i]||[],n=Array.isArray(n)?n:[n],o=Array.isArray(o)?o:[o];for(var s=0;s<n.length;s++)l[o[s]]||(t[o[s]]=!0,r.blocks[i].push(n[s]),r.block_scopes[i].push(o[s]))}Object.assign(l,t)}})),Object.assign(e.mixed,l),e.shaders=r,e},t.create=function(e,t,i){void 0===i&&(i={});var r=sn({},t);return r.name=e,(r=this.mix(r,i)).base&&this.base_styles[r.base]?this.styles[e]=r=Object.assign(Object.create(this.base_styles[r.base]),r):r.base=null,r},t.build=function(e){var t=this,i=Object.assign({},e);this.styles&&Object.values(this.styles).forEach((function(e){return Qi.removeTarget(e.main_thread_target)}));for(var r=["polygons","lines","points","text","raster"],n=0,o=["opaque","add","multiply","overlay","inlay","translucent"];n<o.length;n++)for(var s,a=o[n],l=vt(r);!(s=l()).done;){var c=s.value,u=a+"_"+c;null==i[u]&&(i[u]={base:c,blend:a})}var h=Object.keys(i).sort((function(e,r){return t.inheritanceDepth(e,i)-t.inheritanceDepth(r,i)}));for(var d in this.styles)this.base_styles[d]?this.styles[d].reset():delete this.styles[d];var p={};return h.forEach((function(e){p[e]=t.create(e,i[e],p)})),this.styles},t.initStyles=function(e){for(var t in void 0===e&&(e={}),this.styles)this.styles[t].init(e)},t.inheritanceDepth=function(e,t){for(var i=this,r=0;;){var n=t[e];if(!n)break;if(!n.mix)break;if(r++,Array.isArray(n.mix)){r+=Math.max.apply(Math,n.mix.map((function(r){if(e!==r)return i.inheritanceDepth(r,t)})));break}if(e===n.mix)break;e=n.mix}return r},e}();function cl(e){return null!=e}function ul(e){return"("+e+")"}function hl(e){return"string"==typeof e?'"'+e+'"':e}function dl(e){return"$"===e[0]?"context['"+e.substring(1)+"']":e.indexOf(".")>-1?-1===e.indexOf("\\.")?"context.feature.properties"+e.split(".").map((function(e){return"['"+e+"']"})).join(""):"context.feature.properties"+e.replace(/\\\./g,"__TANGRAM_DELIMITER__").split(".").map((function(e){return e.replace(/__TANGRAM_DELIMITER__/g,".")})).map((function(e){return"['"+e+"']"})).join(""):"context.feature.properties['"+e+"']"}function pl(e,t){return ul(hl(t)+" === "+dl(e))}function fl(e,t){return ul("["+t.map(hl).join(",")+"].indexOf("+dl(e)+") > -1")}function Al(e,t){return ul(e.filter(cl).map((function(e){return ul(e.join(" && "))})).join(" "+t+" "))}function ml(e,t,i){return t&&t.length>0?Al(t.map((function(e){return wl(e,i)})),"||"):"true"}function gl(e,t,i){return t&&t.length>0?Al(t.map((function(e){return wl(e,i)})),"&&"):"true"}function _l(e,t,i){return"!"+ul(wl(t,i).join(" && "))}function yl(e,t,i){return"!"+ul(ml(0,t,i))}function vl(e,t){return ul(dl(e)+(t?" != ":" == ")+"null")}function xl(e,t,i){var r=[],n=i&&"function"==typeof i.rangeTransform&&i.rangeTransform;if(t.max){var o=n?n(t.max):t.max;r.push(dl(e)+" < "+o)}if(t.min){var s=n?s=n(t.min):t.min;r.push(dl(e)+" >= "+s)}return ul(r.join(" && "))}function bl(e,t){var i=[];if(t.includes_any){var r="["+(Array.isArray(t.includes_any)?t.includes_any:[t.includes_any]).map(hl).join(",")+"]";i.push(dl(e)+" != null && "+r+".some(function(v) { return "+dl(e)+".indexOf(v) > -1 })")}if(t.includes_all){var n="["+(Array.isArray(t.includes_all)?t.includes_all:[t.includes_all]).map(hl).join(",")+"]";i.push(dl(e)+" != null && "+n+".every(function(v) { return "+dl(e)+".indexOf(v) > -1 })")}return ul(i.join(" && "))}function wl(e,t){var i=[];if("function"==typeof e)return[ul(e.toString()+"(context)")];if(Array.isArray(e))return[ml(0,e,t)];if(null==e)return["true"];for(var r=Object.keys(e),n=0;n<r.length;n++){var o=r[n],s=e[o],a=typeof s;if("string"===a||"number"===a)i.push(pl(o,s));else if("boolean"===a)i.push(vl(o,s));else if("not"===o)i.push(_l(0,s,t));else if("any"===o)i.push(ml(0,s,t));else if("all"===o)i.push(gl(0,s,t));else if("none"===o)i.push(yl(0,s,t));else if(Array.isArray(s))i.push(fl(o,s));else if("object"===a&&null!=s)s.max||s.min?i.push(xl(o,s,t)):(s.includes_any||s.includes_all)&&i.push(bl(o,s));else{if(null!=s)throw new Error("Unknown Query syntax: "+s);i.push(" true ")}}return 0===r.length?["true"]:i}function Tl(e,t){return null==e?function(){return!0}:new Function("context","return "+ul(wl(e,t).join(" && "))+";")}O(O.S,"Number",{MAX_SAFE_INTEGER:9007199254740991});var Bl=["filter","draw","visible","enabled","data","exclusive","priority"],Cl={};function Sl(e,t){for(var i,r=0,n=0;n<e.length;n++)e[n].length>r&&(r=e[n].length);if(0===r)return null;for(var o={visible:!0},s=function(r){if(i=[],e.forEach((function(e){e[r]&&e[r][t]&&-1===i.indexOf(e[r][t])&&i.push(e[r][t])})),0===i.length)return"continue";sn.apply(void 0,[o].concat(i))},a=0;a<r;a++)s(a);return!1===o.visible?null:o}var El=["any","all","not","none"],Ml=function(){function e(t){var i=t.layer,r=t.name,n=t.parent,o=t.draw,s=t.visible,a=t.enabled,l=t.filter,c=t.exclusive,u=t.priority,h=t.styles;if(this.id=e.id++,this.config_data=i.data,this.parent=n,this.name=r,this.full_name=this.parent?this.parent.full_name+":"+this.name:this.name,this.draw=o,this.filter=l,this.exclusive=!0===c,this.priority=null!=u?u:Number.MAX_SAFE_INTEGER,this.styles=h,this.is_built=!1,a=void 0===a?s:a,this.enabled=!1!==a,this.draw)for(var d in this.draw)if(this.draw[d]=null==this.draw[d]?{}:this.draw[d],"object"!=typeof this.draw[d]){var p="Draw group '"+d+"' for layer "+this.full_name+" is invalid, must be an object, ";Ki("warn",p+="but was set to `"+d+": "+this.draw[d]+"` instead"),delete this.draw[d]}}var t=e.prototype;return t.build=function(){Ki("trace","Building layer '"+this.full_name+"'"),this.buildFilter(),this.buildDraw(),this.is_built=!0},t.buildDraw=function(){this.draw=kn(this.draw,Dn.wrapFunction),this.calculatedDraw=function(e){var t=[];if(e.parent){var i=e.parent.calculatedDraw||[];t.push.apply(t,i)}return t.push(e.draw),t}(this)},t.buildFilter=function(){this.filter_original=this.filter,this.filter=kn(this.filter,Dn.wrapFunction);var e=typeof this.filter;if(null==this.filter||"object"===e||"function"===e)try{this.buildZooms(),this.buildPropMatches(),null!=this.filter&&("function"==typeof this.filter||Object.keys(this.filter).length>0)?this.filter=Tl(this.filter,Ll):this.filter=null}catch(e){var t="Filter for layer "+this.full_name+" is invalid, `filter: "+JSON.stringify(this.filter)+"` ";Ki("warn",t+="failed with error '"+e.message+"', stack trace: "+e.stack)}else{var i="Filter for layer "+this.full_name+" is invalid, filter value must be an object or function, ";Ki("warn",i+="but was set to `filter: "+this.filter+"` instead")}},t.buildZooms=function(){var e=this.filter&&this.filter.$zoom,t=typeof e;if(null!=e){if(this.zooms={},"number"===t)this.zooms[e]=!0;else if(Array.isArray(e))for(var i=0;i<e.length;i++)this.zooms[e[i]]=!0;else if("object"===t&&(null!=e.min||null!=e.max))for(var r=e.min||0,n=e.max||an.max_style_zoom,o=r;o<n;o++)this.zooms[o]=!0;delete this.filter.$zoom}},t.buildPropMatches=function(){var e=this;this.filter&&!Array.isArray(this.filter)&&"function"!=typeof this.filter&&Object.keys(this.filter).forEach((function(t){if(-1===El.indexOf(t)){var i=e.filter[t],r=typeof i,n=Array.isArray(i);if(!n&&"string"!==r&&"number"!==r)return;"$"===t[0]?(e.context_prop_matches=e.context_prop_matches||[],e.context_prop_matches.push([t.substring(1),n?i:[i]]),delete e.filter[t]):-1===t.indexOf(".")&&(e.feature_prop_matches=e.feature_prop_matches||[],e.feature_prop_matches.push([t,n?i:[i]]),delete e.filter[t])}}))},t.doPropMatches=function(e){if(this.feature_prop_matches)for(var t=0;t<this.feature_prop_matches.length;t++){var i=this.feature_prop_matches[t],r=e.feature.properties[i[0]];if(null==r||-1===i[1].indexOf(r))return!1}if(this.context_prop_matches)for(var n=0;n<this.context_prop_matches.length;n++){var o=this.context_prop_matches[n],s=e[o[0]];if(null==s||-1===o[1].indexOf(s))return!1}return!0},t.doesMatch=function(e){if(!this.enabled)return!1;if(this.is_built||this.build(),null!=this.zooms&&!this.zooms[e.zoom])return!1;if(!this.doPropMatches(e))return!1;var t;if(this.filter instanceof Function)try{t=this.filter(e)}catch(t){var i="Filter for this "+this.full_name+": `filter: "+this.filter_original+"` ";Ki("error",i+="failed with error '"+t.message+"', stack trace: "+t.stack,e.feature)}else t=null==this.filter;return!!t&&(this.children_to_parse&&(function(e,t,i){for(var r in t){var n=t[r];if("object"!=typeof n||Array.isArray(n)){var o="Layer value must be an object: cannot create layer '"+r+": "+JSON.stringify(n)+"'";o+=", under parent layer '"+e.full_name+"'.",i[e.name]&&(o+=" The parent name '"+e.name+"' is also the name of a style, did you mean to create a 'draw' group",e.parent&&(o+=" under '"+e.parent.name+"'"),o+=" instead?"),Ki("warn",o)}else kl(r,n,e,i)}e.layers.sort((function(e,t){if(e.exclusive<t.exclusive)return 1;if(e.exclusive>t.exclusive)return-1;var i=e.exclusive?1:-1;return e.priority>t.priority?i:e.priority<t.priority?-i:e.full_name<t.full_name?i:e.full_name>t.full_name?-i:void 0}))}(this,this.children_to_parse,this.styles),delete this.children_to_parse),!0)},e}();Ml.id=0;var Il=function(e){function t(t){var i;return(i=e.call(this,t)||this).is_leaf=!0,i}return ft(t,e),t}(Ml),Pl=function(e){function t(t){var i;return(i=e.call(this,t)||this).is_tree=!0,i.layers=t.layers||[],i}ft(t,e);var i=t.prototype;return i.addLayer=function(e){this.layers.push(e)},i.buildDrawGroups=function(e){var t=[],i=[];if(function e(t,i,r,n){var o=!1;if(0!==i.length){for(var s=0;s<i.length;s++){var a=i[s];if(a.is_leaf){if(a.doesMatch(t)&&(o=!0,r.push(a),n.push(a.id),a.exclusive))break}else if(a.is_tree&&a.doesMatch(t)&&(o=!0,e(t,a.layers,r,n)||(r.push(a),n.push(a.id)),a.exclusive))break}return o}}(e,[this],t,i),t.length>0){var r=function(e){if(e.length>1){for(var t=e[0],i=1;i<e.length;i++)t+="/"+e[i];return t}return e[0]}(i);if(void 0===Cl[r]){for(var n=t.map((function(e){return e&&!1!==e.visible&&e.calculatedDraw})),o={},s=0;s<n.length;s++){var a=n[s];if(a)for(var l=0;l<a.length;l++){var c=a[l];for(var u in c)o[u]=!0}}for(var h in o)Cl[r]=Cl[r]||{},Cl[r][h]=Sl(n,h),Cl[r][h]?(Cl[r][h].key=r+"/"+h,Cl[r][h].layers=t.map((function(e){return e&&e.full_name})),Cl[r][h].group=h):delete Cl[r][h];Cl[r]&&0===Object.keys(Cl[r]).length&&(Cl[r]=null)}return Cl[r]}},t}(Ml),Ll={rangeTransform:function(e){return"string"==typeof e&&"px2"===e.trim().slice(-3)?parseFloat(e)+" * context.meters_per_pixel_sq":e}};function Fl(e){return Bl.indexOf(e)>-1}function kl(e,t,i,r){var n,o={name:e,layer:t=null==t?{}:t,parent:i,styles:r},s=function(e){var t={},i={};for(var r in e)Fl(r)?t[r]=e[r]:i[r]=e[r];return[t,i]}(t),a=s[0],l=s[1],c=(n=l,0===Object.keys(n).length),u=new(c&&null!=i?Il:Pl)(Object.assign(o,a));return u.enabled&&(i&&i.addLayer(u),u.children_to_parse=c?null:l),u}var zl=0,Rl=0,Dl=function(){function e(e){var t=e.coords,i=e.style_z,r=e.source,n=e.workers,o=e.view;this.id=zl++,this.view=o,this.source=r,this.generation=null,this.valid=!0,this.visible=!1,this.proxy_for=null,this.proxied_as=null,this.proxy_level=0,this.proxy_order_offset=0,this.fade_in=!0,this.loading=!1,this.loaded=!1,this.built=!1,this.labeled=!1,this.error=null,this.debug={},this.style_z=i,this.coords=go.normalizedCoord(t,this.source),this.key=go.key(this.coords,this.source,this.style_z),this.overzoom=Math.max(this.style_z-this.coords.z,0),this.overzoom2=Math.pow(2,this.overzoom),this.min=an.metersForTile(this.coords),this.max=an.metersForTile({x:this.coords.x+1,y:this.coords.y+1,z:this.coords.z}),this.span={x:this.max.x-this.min.x,y:-(this.max.y-this.min.y)},this.bounds={sw:{x:this.min.x,y:this.max.y},ne:{x:this.max.x,y:this.min.y}},this.meters_per_pixel=an.metersPerPixel(this.style_z),this.meters_per_pixel_sq=this.meters_per_pixel*this.meters_per_pixel,this.units_per_pixel=an.units_per_pixel/this.overzoom2,this.units_per_meter_overzoom=an.unitsPerMeter(this.coords.z)*this.overzoom2,this.preserve_tiles_within_zoom=this.source.preserve_tiles_within_zoom,this.meshes={},this.new_mesh_styles=[],this.pending_label_meshes=null,this.setWorker(n)}var t=e.prototype;return t.freeResources=function(){for(var e in this.meshes)this.meshes[e].forEach((function(e){return e.destroy()}));if(this.meshes={},this.pending_label_meshes)for(var t in this.pending_label_meshes)this.pending_label_meshes[t].forEach((function(e){return e.destroy()}));this.pending_label_meshes=null},t.destroy=function(){Tr.removeForTile(this.id),this.workerMessage("self.removeTile",this.key),this.freeResources(),this.worker=null,this.valid=!1},t.buildAsMessage=function(){return{id:this.id,key:this.key,source:this.source.name,coords:this.coords,min:this.min,max:this.max,units_per_pixel:this.units_per_pixel,meters_per_pixel:this.meters_per_pixel,meters_per_pixel_sq:this.meters_per_pixel_sq,units_per_meter_overzoom:this.units_per_meter_overzoom,style_z:this.style_z,overzoom:this.overzoom,overzoom2:this.overzoom2,generation:this.generation,debug:this.debug}},t.setWorker=function(e){this.source.tiled?this.worker_id=Math.abs(this.coords.x+this.coords.y+this.coords.z)%e.length:this.worker_id=this.source.id%e.length,this.worker=e[this.worker_id]},t.workerMessage=function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return Qi.postMessage.apply(Qi,[this.worker].concat(t))},t.build=function(e,t){var i=(void 0===t?{}:t).fade_in,r=void 0===i||i;return this.generation=e,this.fade_in=r,this.loaded||(this.loading=!0,this.built=!1,this.labeled=!1),this.workerMessage("self.buildTile",{tile:this.buildAsMessage()}).catch((function(e){throw e}))},e.cancel=function(t){t&&(t.canceled=!0,t.source_data&&t.source_data.request_id&&(Ji.cancelRequest(t.source_data.request_id),t.source_data.request_id=null),e.abortBuild(t))},e.buildGeometry=function(t,i){var r=i.scene_id,n=i.layers,o=i.styles,s=i.global,a=t.source_data;for(var l in t.debug.building=+new Date,t.debug.feature_count=0,t.debug.layers=null,aa.startTile(t.id,{apply_repeat_groups:!0}),n){var c=n[l];if(c&&c.config_data){if(c.config_data.source===t.source)for(var u=e.getDataForSource(a,c.config_data,l),h=0;h<u.length;h++){var d=u[h],p=d.geom;if(p)for(var f=0;f<p.features.length;f++){var A=p.features[f];if(null!=A.geometry){var m=Dn.getFeatureParseContext(A,t,s);m.winding=t.default_winding,m.source=t.source,m.layer=d.layer;var g=c.buildDrawGroups(m,!0);if(g){for(var _ in g){var y=g[_],v=y.style||_,x=o[v];x?null!=(y=x.preprocess(y))&&!1!==y.visible&&(m.layers=y.layers,x.addFeature(A,y,m)):Ki("warn","Style '"+v+"' not found, skipping layer '"+l+"':",y,A)}t.debug.feature_count++}}}}}else Ki("warn","Layer "+l+" was defined without a geometry data source and will not be rendered.")}t.debug.building=+new Date-t.debug.building;var b=this.stylesForTile(t,o).map((function(e){return o[e]}));e.buildStyleGroups(t,b,r,(function(e){return e.collision?"collision":"non-collision"}))},e.stylesForTile=function(e,t){var i=[];for(var r in t)t[r].hasDataForTile(e)&&i.push(r);return i},e.buildStyleGroups=function(t,i,r,n){var o=i.reduce((function(e,t){var i=n(t);return e[i]=e[i]||[],e[i].push(t),e}),{});if(0===Object.keys(o).length)return Qi.postMessage("TileManager_"+r+".buildTileStylesCompleted",Qi.withTransferables({tile:e.slice(t),progress:{start:!0,done:!0}})),void aa.resetTile(t.id);var s={};for(var a in o)e.buildStyleGroup({group_name:a,groups:o,tile:t,progress:s,scene_id:r})},e.buildStyleGroup=function(t){return new Promise((function(i,r){var n,o,s,a,l,c,u;n=t.group_name,o=t.groups,s=t.tile,a=t.progress,l=t.scene_id,c=o[n],u={};var h=function(){try{return i()}catch(e){return r(e)}},d=function(e){try{return Ki("error","Error for style group '"+n+"' for tile "+s.key,e&&e.stack||e),h()}catch(e){return r(e)}};try{return Promise.resolve(Promise.all(c.map((function(e){return new Promise((function(t,i){var r;return Promise.resolve(e.endData(s)).then((function(n){try{return(r=n)&&(u[e.name]=r),t()}catch(e){return i(e)}}),i)}))})))).then((function(t){try{return Ki("trace","Finished style group '"+n+"' for tile "+s.key),o[n]=null,Object.keys(o).every((function(e){return null==o[e]}))&&(a.done=!0),Qi.postMessage("TileManager_"+l+".buildTileStylesCompleted",Qi.withTransferables({tile:Object.assign({},e.slice(s),{mesh_data:u}),progress:a})),a.done&&aa.resetTile(s.id),h()}catch(e){return d(e)}}),d)}catch(e){d(e)}}))},e.getDataForSource=function(e,t,i){var r=[];if(null!=t&&null!=e&&null!=e.layers)if(!0===t.all_layers)for(var n in null!=t.layer&&Ki({level:"warn",once:!0},"Layer "+i+" includes both 'all_layers: true' and an explicit 'layer' keyword in its 'data' block. 'all_layers: true' takes precedence, 'layer' will be ignored."),e.layers)r.push({layer:n,geom:e.layers[n]});else!t.layer&&e.layers._default?r.push({geom:e.layers._default}):!t.layer&&i?r.push({layer:i,geom:e.layers[i]}):"string"==typeof t.layer?r.push({layer:t.layer,geom:e.layers[t.layer]}):Array.isArray(t.layer)&&t.layer.forEach((function(t){r.push({layer:t,geom:e.layers[t]})}));return r},t.buildMeshes=function(e,t){if(!this.error){this.build_id=Rl++,t.start&&(this.debug.geometry_count=0,this.debug.buffer_size=0);var i={},r=this.mesh_data;if(r)for(var n in r){for(var o in r[n].meshes){var s=r[n].meshes[o];if(s.vertex_data){if(!e[n]){Ki("warn","Could not create mesh because style '"+n+"' not found, for tile "+this.key+", aborting tile");break}var a=Object.assign({},r[n]);a.uniforms=Object.assign({},a.uniforms,s.uniforms),a.variant=s.variant,s.labels&&(a.retain=!0);var l=e[n].makeMesh(s.vertex_data,s.vertex_elements,a);l.variant=a.variant,l.labels=s.labels,i[n]=i[n]||[],i[n].push(l),null==l.variant.mesh_order&&(l.variant.mesh_order=i[n].length-1),this.debug.buffer_size+=l.buffer_size,this.debug.geometry_count+=l.geometry_count}}i[n]&&i[n].sort((function(e,t){var i=e.variant.mesh_order,r=t.variant.mesh_order;return null==i?1:null==r||i<r?-1:1}))}for(var c in delete this.mesh_data,i)e[c].collision?(this.pending_label_meshes=this.pending_label_meshes||{},this.pending_label_meshes[c]=i[c]):(this.meshes[c]&&this.meshes[c].forEach((function(e){return e.destroy()})),this.meshes[c]=i[c],this.new_mesh_styles.push(c));if(t.done){for(var u in this.meshes)-1!==this.new_mesh_styles.indexOf(u)||this.pending_label_meshes&&null!=this.pending_label_meshes[u]||(this.meshes[u].forEach((function(e){return e.destroy()})),delete this.meshes[u]);this.new_mesh_styles=[],this.debug.geometry_ratio=(this.debug.geometry_count/this.debug.feature_count).toFixed(1)}this.printDebug(t)}},t.pendingLabelStyleCount=function(){return this.pending_label_meshes?Object.keys(this.pending_label_meshes).length:0},t.swapPendingLabels=function(){if(this.labeled=!0,this.pending_label_meshes){for(var e in this.pending_label_meshes)this.meshes[e]&&this.meshes[e].forEach((function(e){return e.destroy()})),this.meshes[e]=this.pending_label_meshes[e];this.pending_label_meshes=null}},e.abortBuild=function(e){if(Tr.removeForTile(e.id),aa.abortTile(e.id),e.mesh_data)for(var t in e.mesh_data){var i=e.mesh_data[t].textures;i&&i.forEach((function(t){var i=Hr.textures[t];i&&(Ki("trace","releasing texture "+t+" for tile "+e.key),i.release())}))}},t.setProxyFor=function(e){e?(this.visible=!0,this.proxy_for=this.proxy_for||[],this.proxy_for.push(e),this.proxy_order_offset=1,e.proxied_as=e.style_z>this.style_z?"child":"parent",this.proxy_level=Math.abs(e.style_z-this.style_z)):(this.proxy_for=null,this.proxy_order_offset=0,this.proxy_level=0)},t.isProxy=function(){return null!=this.proxy_for},t.shouldProxyForStyle=function(e){return!this.proxy_for||this.proxy_for.some((function(t){return null==t.meshes[e]}))},t.setupProgram=function(e,t){var i=e.model,r=e.model32;t.uniform("4fv","u_tile_origin",[this.min.x,this.min.y,this.style_z,this.coords.z]),t.uniform("1f","u_tile_proxy_order_offset",this.proxy_order_offset),ja.identity(i),ja.translate(i,i,Na(this.min.x,this.min.y,0)),ja.scale(i,i,Na(this.span.x/an.tile_scale,this.span.y/an.tile_scale,1)),ja.copy(r,i),t.uniform("Matrix4fv","u_model",r),t.uniform("1i","u_tile_fade_in",this.fade_in&&"child"!==this.proxied_as)},e.slice=function(e,t){var i=["id","key","loading","loaded","generation","error","debug"];Array.isArray(t)&&i.push.apply(i,t);for(var r={},n=0;n<i.length;n++){var o=i[n];r[o]=e[o]}return r},t.merge=function(e){return this.loading=e.loading,this.loaded=e.loaded,this.generation=e.generation,this.error=e.error,this.mesh_data=e.mesh_data,this.debug=sn(this.debug,e.debug),this},t.printDebug=function(e){var t=["layers"],i={};for(var r in this.debug)-1===t.indexOf(r)&&(i[r]=this.debug[r]);Ki("debug","Tile "+(e.done?"(done)":"")+": debug for "+this.key+": [  "+JSON.stringify(i)+" ]")},e}();Dl.coord_children={};var Ol=function(e,t,i,r,n){var o,s,a=8*n-r-1,l=(1<<a)-1,c=l>>1,u=-7,h=i?n-1:0,d=i?-1:1,p=e[t+h];for(h+=d,o=p&(1<<-u)-1,p>>=-u,u+=a;u>0;o=256*o+e[t+h],h+=d,u-=8);for(s=o&(1<<-u)-1,o>>=-u,u+=r;u>0;s=256*s+e[t+h],h+=d,u-=8);if(0===o)o=1-c;else{if(o===l)return s?NaN:1/0*(p?-1:1);s+=Math.pow(2,r),o-=c}return(p?-1:1)*s*Math.pow(2,o-r)},Ul=function(e,t,i,r,n,o){var s,a,l,c=8*o-n-1,u=(1<<c)-1,h=u>>1,d=23===n?Math.pow(2,-24)-Math.pow(2,-77):0,p=r?0:o-1,f=r?1:-1,A=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,s=u):(s=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-s))<1&&(s--,l*=2),(t+=s+h>=1?d/l:d*Math.pow(2,1-h))*l>=2&&(s++,l/=2),s+h>=u?(a=0,s=u):s+h>=1?(a=(t*l-1)*Math.pow(2,n),s+=h):(a=t*Math.pow(2,h-1)*Math.pow(2,n),s=0));n>=8;e[i+p]=255&a,p+=f,a/=256,n-=8);for(s=s<<n|a,c+=n;c>0;e[i+p]=255&s,p+=f,s/=256,c-=8);e[i+p-f]|=128*A},Nl=Ql;function Ql(e){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(e)?e:new Uint8Array(e||0),this.pos=0,this.type=0,this.length=this.buf.length}function jl(e){return e.type===Ql.Bytes?e.readVarint()+e.pos:e.pos+1}function Vl(e,t,i){return i?4294967296*t+(e>>>0):4294967296*(t>>>0)+(e>>>0)}function Hl(e,t,i){var r=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.ceil(Math.log(t)/(7*Math.LN2));i.realloc(r);for(var n=i.pos-1;n>=e;n--)i.buf[n+r]=i.buf[n]}function Gl(e,t){for(var i=0;i<e.length;i++)t.writeVarint(e[i])}function $l(e,t){for(var i=0;i<e.length;i++)t.writeSVarint(e[i])}function Zl(e,t){for(var i=0;i<e.length;i++)t.writeFloat(e[i])}function ql(e,t){for(var i=0;i<e.length;i++)t.writeDouble(e[i])}function Kl(e,t){for(var i=0;i<e.length;i++)t.writeBoolean(e[i])}function Wl(e,t){for(var i=0;i<e.length;i++)t.writeFixed32(e[i])}function Xl(e,t){for(var i=0;i<e.length;i++)t.writeSFixed32(e[i])}function Yl(e,t){for(var i=0;i<e.length;i++)t.writeFixed64(e[i])}function Jl(e,t){for(var i=0;i<e.length;i++)t.writeSFixed64(e[i])}function ec(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+16777216*e[t+3]}function tc(e,t,i){e[i]=t,e[i+1]=t>>>8,e[i+2]=t>>>16,e[i+3]=t>>>24}function ic(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+(e[t+3]<<24)}Ql.Varint=0,Ql.Fixed64=1,Ql.Bytes=2,Ql.Fixed32=5,Ql.prototype={destroy:function(){this.buf=null},readFields:function(e,t,i){for(i=i||this.length;this.pos<i;){var r=this.readVarint(),n=r>>3,o=this.pos;this.type=7&r,e(n,t,this),this.pos===o&&this.skip(r)}return t},readMessage:function(e,t){return this.readFields(e,t,this.readVarint()+this.pos)},readFixed32:function(){var e=ec(this.buf,this.pos);return this.pos+=4,e},readSFixed32:function(){var e=ic(this.buf,this.pos);return this.pos+=4,e},readFixed64:function(){var e=ec(this.buf,this.pos)+4294967296*ec(this.buf,this.pos+4);return this.pos+=8,e},readSFixed64:function(){var e=ec(this.buf,this.pos)+4294967296*ic(this.buf,this.pos+4);return this.pos+=8,e},readFloat:function(){var e=Ol(this.buf,this.pos,!0,23,4);return this.pos+=4,e},readDouble:function(){var e=Ol(this.buf,this.pos,!0,52,8);return this.pos+=8,e},readVarint:function(e){var t,i,r=this.buf;return t=127&(i=r[this.pos++]),i<128?t:(t|=(127&(i=r[this.pos++]))<<7,i<128?t:(t|=(127&(i=r[this.pos++]))<<14,i<128?t:(t|=(127&(i=r[this.pos++]))<<21,i<128?t:function(e,t,i){var r,n,o=i.buf;if(r=(112&(n=o[i.pos++]))>>4,n<128)return Vl(e,r,t);if(r|=(127&(n=o[i.pos++]))<<3,n<128)return Vl(e,r,t);if(r|=(127&(n=o[i.pos++]))<<10,n<128)return Vl(e,r,t);if(r|=(127&(n=o[i.pos++]))<<17,n<128)return Vl(e,r,t);if(r|=(127&(n=o[i.pos++]))<<24,n<128)return Vl(e,r,t);if(r|=(1&(n=o[i.pos++]))<<31,n<128)return Vl(e,r,t);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(i=r[this.pos]))<<28,e,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var e=this.readVarint();return e%2==1?(e+1)/-2:e/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var e=this.readVarint()+this.pos,t=function(e,t,i){for(var r="",n=t;n<i;){var o,s,a,l=e[n],c=null,u=l>239?4:l>223?3:l>191?2:1;if(n+u>i)break;1===u?l<128&&(c=l):2===u?128==(192&(o=e[n+1]))&&(c=(31&l)<<6|63&o)<=127&&(c=null):3===u?(o=e[n+1],s=e[n+2],128==(192&o)&&128==(192&s)&&((c=(15&l)<<12|(63&o)<<6|63&s)<=2047||c>=55296&&c<=57343)&&(c=null)):4===u&&(o=e[n+1],s=e[n+2],a=e[n+3],128==(192&o)&&128==(192&s)&&128==(192&a)&&((c=(15&l)<<18|(63&o)<<12|(63&s)<<6|63&a)<=65535||c>=1114112)&&(c=null)),null===c?(c=65533,u=1):c>65535&&(c-=65536,r+=String.fromCharCode(c>>>10&1023|55296),c=56320|1023&c),r+=String.fromCharCode(c),n+=u}return r}(this.buf,this.pos,e);return this.pos=e,t},readBytes:function(){var e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t},readPackedVarint:function(e,t){var i=jl(this);for(e=e||[];this.pos<i;)e.push(this.readVarint(t));return e},readPackedSVarint:function(e){var t=jl(this);for(e=e||[];this.pos<t;)e.push(this.readSVarint());return e},readPackedBoolean:function(e){var t=jl(this);for(e=e||[];this.pos<t;)e.push(this.readBoolean());return e},readPackedFloat:function(e){var t=jl(this);for(e=e||[];this.pos<t;)e.push(this.readFloat());return e},readPackedDouble:function(e){var t=jl(this);for(e=e||[];this.pos<t;)e.push(this.readDouble());return e},readPackedFixed32:function(e){var t=jl(this);for(e=e||[];this.pos<t;)e.push(this.readFixed32());return e},readPackedSFixed32:function(e){var t=jl(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed32());return e},readPackedFixed64:function(e){var t=jl(this);for(e=e||[];this.pos<t;)e.push(this.readFixed64());return e},readPackedSFixed64:function(e){var t=jl(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed64());return e},skip:function(e){var t=7&e;if(t===Ql.Varint)for(;this.buf[this.pos++]>127;);else if(t===Ql.Bytes)this.pos=this.readVarint()+this.pos;else if(t===Ql.Fixed32)this.pos+=4;else{if(t!==Ql.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(e,t){this.writeVarint(e<<3|t)},realloc:function(e){for(var t=this.length||16;t<this.pos+e;)t*=2;if(t!==this.length){var i=new Uint8Array(t);i.set(this.buf),this.buf=i,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(e){this.realloc(4),tc(this.buf,e,this.pos),this.pos+=4},writeSFixed32:function(e){this.realloc(4),tc(this.buf,e,this.pos),this.pos+=4},writeFixed64:function(e){this.realloc(8),tc(this.buf,-1&e,this.pos),tc(this.buf,Math.floor(e*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(e){this.realloc(8),tc(this.buf,-1&e,this.pos),tc(this.buf,Math.floor(e*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(e){(e=+e||0)>268435455||e<0?function(e,t){var i,r;if(e>=0?(i=e%4294967296|0,r=e/4294967296|0):(r=~(-e/4294967296),4294967295^(i=~(-e%4294967296))?i=i+1|0:(i=0,r=r+1|0)),e>=0x10000000000000000||e<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");t.realloc(10),function(e,t,i){i.buf[i.pos++]=127&e|128,e>>>=7,i.buf[i.pos++]=127&e|128,e>>>=7,i.buf[i.pos++]=127&e|128,e>>>=7,i.buf[i.pos++]=127&e|128,e>>>=7,i.buf[i.pos]=127&e}(i,0,t),function(e,t){var i=(7&e)<<4;t.buf[t.pos++]|=i|((e>>>=3)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e)))))}(r,t)}(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))},writeSVarint:function(e){this.writeVarint(e<0?2*-e-1:2*e)},writeBoolean:function(e){this.writeVarint(Boolean(e))},writeString:function(e){e=String(e),this.realloc(4*e.length),this.pos++;var t=this.pos;this.pos=function(e,t,i){for(var r,n,o=0;o<t.length;o++){if((r=t.charCodeAt(o))>55295&&r<57344){if(!n){r>56319||o+1===t.length?(e[i++]=239,e[i++]=191,e[i++]=189):n=r;continue}if(r<56320){e[i++]=239,e[i++]=191,e[i++]=189,n=r;continue}r=n-55296<<10|r-56320|65536,n=null}else n&&(e[i++]=239,e[i++]=191,e[i++]=189,n=null);r<128?e[i++]=r:(r<2048?e[i++]=r>>6|192:(r<65536?e[i++]=r>>12|224:(e[i++]=r>>18|240,e[i++]=r>>12&63|128),e[i++]=r>>6&63|128),e[i++]=63&r|128)}return i}(this.buf,e,this.pos);var i=this.pos-t;i>=128&&Hl(t,i,this),this.pos=t-1,this.writeVarint(i),this.pos+=i},writeFloat:function(e){this.realloc(4),Ul(this.buf,e,this.pos,!0,23,4),this.pos+=4},writeDouble:function(e){this.realloc(8),Ul(this.buf,e,this.pos,!0,52,8),this.pos+=8},writeBytes:function(e){var t=e.length;this.writeVarint(t),this.realloc(t);for(var i=0;i<t;i++)this.buf[this.pos++]=e[i]},writeRawMessage:function(e,t){this.pos++;var i=this.pos;e(t,this);var r=this.pos-i;r>=128&&Hl(i,r,this),this.pos=i-1,this.writeVarint(r),this.pos+=r},writeMessage:function(e,t,i){this.writeTag(e,Ql.Bytes),this.writeRawMessage(t,i)},writePackedVarint:function(e,t){this.writeMessage(e,Gl,t)},writePackedSVarint:function(e,t){this.writeMessage(e,$l,t)},writePackedBoolean:function(e,t){this.writeMessage(e,Kl,t)},writePackedFloat:function(e,t){this.writeMessage(e,Zl,t)},writePackedDouble:function(e,t){this.writeMessage(e,ql,t)},writePackedFixed32:function(e,t){this.writeMessage(e,Wl,t)},writePackedSFixed32:function(e,t){this.writeMessage(e,Xl,t)},writePackedFixed64:function(e,t){this.writeMessage(e,Yl,t)},writePackedSFixed64:function(e,t){this.writeMessage(e,Jl,t)},writeBytesField:function(e,t){this.writeTag(e,Ql.Bytes),this.writeBytes(t)},writeFixed32Field:function(e,t){this.writeTag(e,Ql.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(e,t){this.writeTag(e,Ql.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(e,t){this.writeTag(e,Ql.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(e,t){this.writeTag(e,Ql.Fixed64),this.writeSFixed64(t)},writeVarintField:function(e,t){this.writeTag(e,Ql.Varint),this.writeVarint(t)},writeSVarintField:function(e,t){this.writeTag(e,Ql.Varint),this.writeSVarint(t)},writeStringField:function(e,t){this.writeTag(e,Ql.Bytes),this.writeString(t)},writeFloatField:function(e,t){this.writeTag(e,Ql.Fixed32),this.writeFloat(t)},writeDoubleField:function(e,t){this.writeTag(e,Ql.Fixed64),this.writeDouble(t)},writeBooleanField:function(e,t){this.writeVarintField(e,Boolean(t))}};var rc=nc;function nc(e,t){this.x=e,this.y=t}nc.prototype={clone:function(){return new nc(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,t){return this.clone()._rotateAround(e,t)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var t=e.x-this.x,i=e.y-this.y;return t*t+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult:function(e){var t=e[0]*this.x+e[1]*this.y,i=e[2]*this.x+e[3]*this.y;return this.x=t,this.y=i,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var t=Math.cos(e),i=Math.sin(e),r=t*this.x-i*this.y,n=i*this.x+t*this.y;return this.x=r,this.y=n,this},_rotateAround:function(e,t){var i=Math.cos(e),r=Math.sin(e),n=t.x+i*(this.x-t.x)-r*(this.y-t.y),o=t.y+r*(this.x-t.x)+i*(this.y-t.y);return this.x=n,this.y=o,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},nc.convert=function(e){return e instanceof nc?e:Array.isArray(e)?new nc(e[0],e[1]):e};var oc=sc;function sc(e,t,i,r,n){this.properties={},this.extent=i,this.type=0,this._pbf=e,this._geometry=-1,this._keys=r,this._values=n,e.readFields(ac,this,t)}function ac(e,t,i){1==e?t.id=i.readVarint():2==e?function(e,t){for(var i=e.readVarint()+e.pos;e.pos<i;){var r=t._keys[e.readVarint()],n=t._values[e.readVarint()];t.properties[r]=n}}(i,t):3==e?t.type=i.readVarint():4==e&&(t._geometry=i.pos)}function lc(e){for(var t,i,r=0,n=0,o=e.length,s=o-1;n<o;s=n++)t=e[n],r+=((i=e[s]).x-t.x)*(t.y+i.y);return r}sc.types=["Unknown","Point","LineString","Polygon"],sc.prototype.loadGeometry=function(){var e=this._pbf;e.pos=this._geometry;for(var t,i=e.readVarint()+e.pos,r=1,n=0,o=0,s=0,a=[];e.pos<i;){if(!n){var l=e.readVarint();r=7&l,n=l>>3}if(n--,1===r||2===r)o+=e.readSVarint(),s+=e.readSVarint(),1===r&&(t&&a.push(t),t=[]),t.push(new rc(o,s));else{if(7!==r)throw new Error("unknown command "+r);t&&t.push(t[0].clone())}}return t&&a.push(t),a},sc.prototype.bbox=function(){var e=this._pbf;e.pos=this._geometry;for(var t=e.readVarint()+e.pos,i=1,r=0,n=0,o=0,s=1/0,a=-1/0,l=1/0,c=-1/0;e.pos<t;){if(!r){var u=e.readVarint();i=7&u,r=u>>3}if(r--,1===i||2===i)(n+=e.readSVarint())<s&&(s=n),n>a&&(a=n),(o+=e.readSVarint())<l&&(l=o),o>c&&(c=o);else if(7!==i)throw new Error("unknown command "+i)}return[s,l,a,c]},sc.prototype.toGeoJSON=function(e,t,i){var r,n,o=this.extent*Math.pow(2,i),s=this.extent*e,a=this.extent*t,l=this.loadGeometry(),c=sc.types[this.type];function u(e){for(var t=0;t<e.length;t++){var i=e[t],r=180-360*(i.y+a)/o;e[t]=[360*(i.x+s)/o-180,360/Math.PI*Math.atan(Math.exp(r*Math.PI/180))-90]}}switch(this.type){case 1:var h=[];for(r=0;r<l.length;r++)h[r]=l[r][0];u(l=h);break;case 2:for(r=0;r<l.length;r++)u(l[r]);break;case 3:for(l=function(e){var t=e.length;if(t<=1)return[e];for(var i,r,n=[],o=0;o<t;o++){var s=lc(e[o]);0!==s&&(void 0===r&&(r=s<0),r===s<0?(i&&n.push(i),i=[e[o]]):i.push(e[o]))}return i&&n.push(i),n}(l),r=0;r<l.length;r++)for(n=0;n<l[r].length;n++)u(l[r][n])}1===l.length?l=l[0]:c="Multi"+c;var d={type:"Feature",geometry:{type:c,coordinates:l},properties:this.properties};return"id"in this&&(d.id=this.id),d};var cc=uc;function uc(e,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(hc,this,t),this.length=this._features.length}function hc(e,t,i){15===e?t.version=i.readVarint():1===e?t.name=i.readString():5===e?t.extent=i.readVarint():2===e?t._features.push(i.pos):3===e?t._keys.push(i.readString()):4===e&&t._values.push(function(e){for(var t=null,i=e.readVarint()+e.pos;e.pos<i;){var r=e.readVarint()>>3;t=1===r?e.readString():2===r?e.readFloat():3===r?e.readDouble():4===r?e.readVarint64():5===r?e.readVarint():6===r?e.readSVarint():7===r?e.readBoolean():null}return t}(i))}function dc(e,t,i){if(3===e){var r=new cc(i,i.readVarint()+i.pos);r.length&&(t[r.name]=r)}}uc.prototype.feature=function(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];var t=this._pbf.readVarint()+this._pbf.pos;return new oc(this._pbf,t,this.extent,this._keys,this._values)};var pc=function(e,t){this.layers=e.readFields(dc,{},t)},fc=oc,Ac={NONE:0,ALL:1,SOME:2},mc=["{","["],gc=function(e){function t(t,i){var r;return(r=e.call(this,t,i)||this).response_type="arraybuffer",!0===t.parse_json?r.parse_json_type=Ac.ALL:Array.isArray(t.parse_json)?(r.parse_json_type=Ac.SOME,r.parse_json_prop_list=t.parse_json):(null!=t.parse_json&&Ki({level:"warn",once:!0},"Data source '"+r.name+"': 'parse_json' parameter should be 'true', or an array of property names (was '"+JSON.stringify(t.parse_json)+"')"),r.parse_json_type=Ac.NONE),r}ft(t,e);var i=t.prototype;return i.parseSourceData=function(e,t,i){var r=new Uint8Array(i),n=new Nl(r);if(t.data=new pc(n),t.layers=this.toGeoJSON(t.data),"function"==typeof this.transform){var o={min:Object.assign({},e.min),max:Object.assign({},e.max),coords:Object.assign({},e.coords)};t.layers=this.transform(t.layers,this.extra_data,o)}delete t.data},i.toGeoJSON=function(e){var t={};for(var i in e.layers){for(var r=e.layers[i],n=an.tile_scale/r.extent,o={type:"FeatureCollection",features:[]},s=0;s<r.length;s++){var a=r.feature(s),l={type:"Feature",geometry:{},id:a.id,properties:a.properties};this.parseJSONProperties(l);for(var c=l.geometry,u=a.loadGeometry(),h=0;h<u.length;h++)for(var d=u[h],p=0;p<d.length;p++)d[p]=[d[p].x*n,d[p].y*n];c.coordinates=u,"Point"===fc.types[a.type]?1===u.length?(c.type="Point",c.coordinates=c.coordinates[0][0]):(c.type="MultiPoint",c.coordinates=c.coordinates[0]):"LineString"===fc.types[a.type]?1===u.length?(c.type="LineString",c.coordinates=c.coordinates[0]):c.type="MultiLineString":"Polygon"===fc.types[a.type]&&(c=_c(c)),o.features.push(l)}t[i]=o}return t},i.parseJSONProperties=function(e){if(this.parse_json_type!==Ac.NONE){var t=e.properties;if(this.parse_json_type===Ac.SOME)this.parse_json_prop_list.forEach((function(e){try{t[e]=JSON.parse(t[e])}catch(e){}}));else for(var i in t)if(mc.indexOf(t[i][0])>-1)try{t[i]=JSON.parse(t[i])}catch(e){}}},t}(mo);function _c(e){for(var t,i=[],r=[],n=0;n<e.coordinates.length;n++){var o=e.coordinates[n],s=an.ringWinding(o);null!=s&&(s===(t=t||s)&&r.length>0&&(i.push(r),r=[]),r.push(o))}return r.length>0&&i.push(r),1===i.length?(e.type="Polygon",e.coordinates=i[0]):i.length>1?(e.type="MultiPolygon",e.coordinates=i):e=null,e}function yc(e,t,i,r,n,o){var s=n-i,a=o-r;if(0!==s||0!==a){var l=((e-i)*s+(t-r)*a)/(s*s+a*a);l>1?(i=n,r=o):l>0&&(i+=s*l,r+=a*l)}return(s=e-i)*s+(a=t-r)*a}function vc(e,t,i,r){var n={id:void 0===e?null:e,type:t,geometry:i,tags:r,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(e){var t=e.geometry,i=e.type;if("Point"===i||"MultiPoint"===i||"LineString"===i)xc(e,t);else if("Polygon"===i||"MultiLineString"===i)for(var r=0;r<t.length;r++)xc(e,t[r]);else if("MultiPolygon"===i)for(r=0;r<t.length;r++)for(var n=0;n<t[r].length;n++)xc(e,t[r][n])}(n),n}function xc(e,t){for(var i=0;i<t.length;i+=3)e.minX=Math.min(e.minX,t[i]),e.minY=Math.min(e.minY,t[i+1]),e.maxX=Math.max(e.maxX,t[i]),e.maxY=Math.max(e.maxY,t[i+1])}function bc(e,t,i,r){if(t.geometry){var n=t.geometry.coordinates,o=t.geometry.type,s=Math.pow(i.tolerance/((1<<i.maxZoom)*i.extent),2),a=[],l=t.id;if(i.promoteId?l=t.properties[i.promoteId]:i.generateId&&(l=r||0),"Point"===o)wc(n,a);else if("MultiPoint"===o)for(var c=0;c<n.length;c++)wc(n[c],a);else if("LineString"===o)Tc(n,a,s,!1);else if("MultiLineString"===o){if(i.lineMetrics){for(c=0;c<n.length;c++)a=[],Tc(n[c],a,s,!1),e.push(vc(l,"LineString",a,t.properties));return}Bc(n,a,s,!1)}else if("Polygon"===o)Bc(n,a,s,!0);else{if("MultiPolygon"!==o){if("GeometryCollection"===o){for(c=0;c<t.geometry.geometries.length;c++)bc(e,{id:l,geometry:t.geometry.geometries[c],properties:t.properties},i,r);return}throw new Error("Input data is not a valid GeoJSON object.")}for(c=0;c<n.length;c++){var u=[];Bc(n[c],u,s,!0),a.push(u)}}e.push(vc(l,o,a,t.properties))}}function wc(e,t){t.push(Cc(e[0])),t.push(Sc(e[1])),t.push(0)}function Tc(e,t,i,r){for(var n,o,s=0,a=0;a<e.length;a++){var l=Cc(e[a][0]),c=Sc(e[a][1]);t.push(l),t.push(c),t.push(0),a>0&&(s+=r?(n*c-l*o)/2:Math.sqrt(Math.pow(l-n,2)+Math.pow(c-o,2))),n=l,o=c}var u=t.length-3;t[2]=1,function e(t,i,r,n){for(var o,s=n,a=r-i>>1,l=r-i,c=t[i],u=t[i+1],h=t[r],d=t[r+1],p=i+3;p<r;p+=3){var f=yc(t[p],t[p+1],c,u,h,d);if(f>s)o=p,s=f;else if(f===s){var A=Math.abs(p-a);A<l&&(o=p,l=A)}}s>n&&(o-i>3&&e(t,i,o,n),t[o+2]=s,r-o>3&&e(t,o,r,n))}(t,0,u,i),t[u+2]=1,t.size=Math.abs(s),t.start=0,t.end=t.size}function Bc(e,t,i,r){for(var n=0;n<e.length;n++){var o=[];Tc(e[n],o,i,r),t.push(o)}}function Cc(e){return e/360+.5}function Sc(e){var t=Math.sin(e*Math.PI/180),i=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return i<0?0:i>1?1:i}function Ec(e,t,i,r,n,o,s,a){if(r/=t,o>=(i/=t)&&s<r)return e;if(s<i||o>=r)return null;for(var l=[],c=0;c<e.length;c++){var u=e[c],h=u.geometry,d=u.type,p=0===n?u.minX:u.minY,f=0===n?u.maxX:u.maxY;if(p>=i&&f<r)l.push(u);else if(!(f<i||p>=r)){var A=[];if("Point"===d||"MultiPoint"===d)Mc(h,A,i,r,n);else if("LineString"===d)Ic(h,A,i,r,n,!1,a.lineMetrics);else if("MultiLineString"===d)Lc(h,A,i,r,n,!1);else if("Polygon"===d)Lc(h,A,i,r,n,!0);else if("MultiPolygon"===d)for(var m=0;m<h.length;m++){var g=[];Lc(h[m],g,i,r,n,!0),g.length&&A.push(g)}if(A.length){if(a.lineMetrics&&"LineString"===d){for(m=0;m<A.length;m++)l.push(vc(u.id,d,A[m],u.tags));continue}"LineString"!==d&&"MultiLineString"!==d||(1===A.length?(d="LineString",A=A[0]):d="MultiLineString"),"Point"!==d&&"MultiPoint"!==d||(d=3===A.length?"Point":"MultiPoint"),l.push(vc(u.id,d,A,u.tags))}}}return l.length?l:null}function Mc(e,t,i,r,n){for(var o=0;o<e.length;o+=3){var s=e[o+n];s>=i&&s<=r&&(t.push(e[o]),t.push(e[o+1]),t.push(e[o+2]))}}function Ic(e,t,i,r,n,o,s){for(var a,l,c=Pc(e),u=0===n?kc:zc,h=e.start,d=0;d<e.length-3;d+=3){var p=e[d],f=e[d+1],A=e[d+2],m=e[d+3],g=e[d+4],_=0===n?p:f,y=0===n?m:g,v=!1;s&&(a=Math.sqrt(Math.pow(p-m,2)+Math.pow(f-g,2))),_<i?y>i&&(l=u(c,p,f,m,g,i),s&&(c.start=h+a*l)):_>r?y<r&&(l=u(c,p,f,m,g,r),s&&(c.start=h+a*l)):Fc(c,p,f,A),y<i&&_>=i&&(l=u(c,p,f,m,g,i),v=!0),y>r&&_<=r&&(l=u(c,p,f,m,g,r),v=!0),!o&&v&&(s&&(c.end=h+a*l),t.push(c),c=Pc(e)),s&&(h+=a)}var x=e.length-3;p=e[x],f=e[x+1],A=e[x+2],(_=0===n?p:f)>=i&&_<=r&&Fc(c,p,f,A),x=c.length-3,o&&x>=3&&(c[x]!==c[0]||c[x+1]!==c[1])&&Fc(c,c[0],c[1],c[2]),c.length&&t.push(c)}function Pc(e){var t=[];return t.size=e.size,t.start=e.start,t.end=e.end,t}function Lc(e,t,i,r,n,o){for(var s=0;s<e.length;s++)Ic(e[s],t,i,r,n,o,!1)}function Fc(e,t,i,r){e.push(t),e.push(i),e.push(r)}function kc(e,t,i,r,n,o){var s=(o-t)/(r-t);return e.push(o),e.push(i+(n-i)*s),e.push(1),s}function zc(e,t,i,r,n,o){var s=(o-i)/(n-i);return e.push(t+(r-t)*s),e.push(o),e.push(1),s}function Rc(e,t){for(var i=[],r=0;r<e.length;r++){var n,o=e[r],s=o.type;if("Point"===s||"MultiPoint"===s||"LineString"===s)n=Dc(o.geometry,t);else if("MultiLineString"===s||"Polygon"===s){n=[];for(var a=0;a<o.geometry.length;a++)n.push(Dc(o.geometry[a],t))}else if("MultiPolygon"===s)for(n=[],a=0;a<o.geometry.length;a++){for(var l=[],c=0;c<o.geometry[a].length;c++)l.push(Dc(o.geometry[a][c],t));n.push(l)}i.push(vc(o.id,s,n,o.tags))}return i}function Dc(e,t){var i=[];i.size=e.size,void 0!==e.start&&(i.start=e.start,i.end=e.end);for(var r=0;r<e.length;r+=3)i.push(e[r]+t,e[r+1],e[r+2]);return i}function Oc(e,t){if(e.transformed)return e;var i,r,n,o=1<<e.z,s=e.x,a=e.y;for(i=0;i<e.features.length;i++){var l=e.features[i],c=l.geometry,u=l.type;if(l.geometry=[],1===u)for(r=0;r<c.length;r+=2)l.geometry.push(Uc(c[r],c[r+1],t,o,s,a));else for(r=0;r<c.length;r++){var h=[];for(n=0;n<c[r].length;n+=2)h.push(Uc(c[r][n],c[r][n+1],t,o,s,a));l.geometry.push(h)}}return e.transformed=!0,e}function Uc(e,t,i,r,n,o){return[Math.round(i*(e*r-n)),Math.round(i*(t*r-o))]}function Nc(e,t,i,r,n){for(var o=t===n.maxZoom?0:n.tolerance/((1<<t)*n.extent),s={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:i,y:r,z:t,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},a=0;a<e.length;a++){s.numFeatures++,Qc(s,e[a],o,n);var l=e[a].minX,c=e[a].minY,u=e[a].maxX,h=e[a].maxY;l<s.minX&&(s.minX=l),c<s.minY&&(s.minY=c),u>s.maxX&&(s.maxX=u),h>s.maxY&&(s.maxY=h)}return s}function Qc(e,t,i,r){var n=t.geometry,o=t.type,s=[];if("Point"===o||"MultiPoint"===o)for(var a=0;a<n.length;a+=3)s.push(n[a]),s.push(n[a+1]),e.numPoints++,e.numSimplified++;else if("LineString"===o)jc(s,n,e,i,!1,!1);else if("MultiLineString"===o||"Polygon"===o)for(a=0;a<n.length;a++)jc(s,n[a],e,i,"Polygon"===o,0===a);else if("MultiPolygon"===o)for(var l=0;l<n.length;l++){var c=n[l];for(a=0;a<c.length;a++)jc(s,c[a],e,i,!0,0===a)}if(s.length){var u=t.tags||null;if("LineString"===o&&r.lineMetrics){for(var h in u={},t.tags)u[h]=t.tags[h];u.mapbox_clip_start=n.start/n.size,u.mapbox_clip_end=n.end/n.size}var d={geometry:s,type:"Polygon"===o||"MultiPolygon"===o?3:"LineString"===o||"MultiLineString"===o?2:1,tags:u};null!==t.id&&(d.id=t.id),e.features.push(d)}}function jc(e,t,i,r,n,o){var s=r*r;if(r>0&&t.size<(n?s:r))i.numPoints+=t.length/3;else{for(var a=[],l=0;l<t.length;l+=3)(0===r||t[l+2]>s)&&(i.numSimplified++,a.push(t[l]),a.push(t[l+1])),i.numPoints++;n&&function(e,t){for(var i=0,r=0,n=e.length,o=n-2;r<n;o=r,r+=2)i+=(e[r]-e[o])*(e[r+1]+e[o+1]);if(i>0===t)for(r=0,n=e.length;r<n/2;r+=2){var s=e[r],a=e[r+1];e[r]=e[n-2-r],e[r+1]=e[n-1-r],e[n-2-r]=s,e[n-1-r]=a}}(a,o),e.push(a)}}function Vc(e,t){return new Hc(e,t)}function Hc(e,t){var i=(t=this.options=function(e,t){for(var i in t)e[i]=t[i];return e}(Object.create(this.options),t)).debug;if(i&&console.time("preprocess data"),t.maxZoom<0||t.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(t.promoteId&&t.generateId)throw new Error("promoteId and generateId cannot be used together.");var r=function(e,t){var i=[];if("FeatureCollection"===e.type)for(var r=0;r<e.features.length;r++)bc(i,e.features[r],t,r);else"Feature"===e.type?bc(i,e,t):bc(i,{geometry:e},t);return i}(e,t);this.tiles={},this.tileCoords=[],i&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",t.indexMaxZoom,t.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(r=function(e,t){var i=t.buffer/t.extent,r=e,n=Ec(e,1,-1-i,i,0,-1,2,t),o=Ec(e,1,1-i,2+i,0,-1,2,t);return(n||o)&&(r=Ec(e,1,-i,1+i,0,-1,2,t)||[],n&&(r=Rc(n,1).concat(r)),o&&(r=r.concat(Rc(o,-1)))),r}(r,t)).length&&this.splitTile(r,0,0,0),i&&(r.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Gc(e,t,i){return 32*((1<<e)*i+t)+e}po.register("MVT",(function(){return gc})),Hc.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Hc.prototype.splitTile=function(e,t,i,r,n,o,s){for(var a=[e,t,i,r],l=this.options,c=l.debug;a.length;){r=a.pop(),i=a.pop(),t=a.pop(),e=a.pop();var u=1<<t,h=Gc(t,i,r),d=this.tiles[h];if(!d&&(c>1&&console.time("creation"),d=this.tiles[h]=Nc(e,t,i,r,l),this.tileCoords.push({z:t,x:i,y:r}),c)){c>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",t,i,r,d.numFeatures,d.numPoints,d.numSimplified),console.timeEnd("creation"));var p="z"+t;this.stats[p]=(this.stats[p]||0)+1,this.total++}if(d.source=e,n){if(t===l.maxZoom||t===n)continue;var f=1<<n-t;if(i!==Math.floor(o/f)||r!==Math.floor(s/f))continue}else if(t===l.indexMaxZoom||d.numPoints<=l.indexMaxPoints)continue;if(d.source=null,0!==e.length){c>1&&console.time("clipping");var A,m,g,_,y,v,x=.5*l.buffer/l.extent,b=.5-x,w=.5+x,T=1+x;A=m=g=_=null,y=Ec(e,u,i-x,i+w,0,d.minX,d.maxX,l),v=Ec(e,u,i+b,i+T,0,d.minX,d.maxX,l),e=null,y&&(A=Ec(y,u,r-x,r+w,1,d.minY,d.maxY,l),m=Ec(y,u,r+b,r+T,1,d.minY,d.maxY,l),y=null),v&&(g=Ec(v,u,r-x,r+w,1,d.minY,d.maxY,l),_=Ec(v,u,r+b,r+T,1,d.minY,d.maxY,l),v=null),c>1&&console.timeEnd("clipping"),a.push(A||[],t+1,2*i,2*r),a.push(m||[],t+1,2*i,2*r+1),a.push(g||[],t+1,2*i+1,2*r),a.push(_||[],t+1,2*i+1,2*r+1)}}},Hc.prototype.getTile=function(e,t,i){var r=this.options,n=r.extent,o=r.debug;if(e<0||e>24)return null;var s=1<<e,a=Gc(e,t=(t%s+s)%s,i);if(this.tiles[a])return Oc(this.tiles[a],n);o>1&&console.log("drilling down to z%d-%d-%d",e,t,i);for(var l,c=e,u=t,h=i;!l&&c>0;)c--,u=Math.floor(u/2),h=Math.floor(h/2),l=this.tiles[Gc(c,u,h)];return l&&l.source?(o>1&&console.log("found parent tile z%d-%d-%d",c,u,h),o>1&&console.time("drilling down"),this.splitTile(l.source,c,u,h,e,t,i),o>1&&console.timeEnd("drilling down"),this.tiles[a]?Oc(this.tiles[a],n):null):null};var $c=function(e){function t(t,i){var r;return(r=e.call(this,t,i)||this).load_data=null,r.tile_indexes={},r.setTileSize(512),r.pad_scale=0,r}ft(t,e);var i=t.prototype;return i._load=function(t){var i=this;return this.load_data||(this.load_data=e.prototype._load.call(this,{source_data:{layers:{}}}).then((function(e){e.source_data.error&&Ki("warn","data source load error(s) for source '"+i.name+"', URL '"+i.url+"': "+e.source_data.error);var t=e.source_data.layers;for(var r in t)i.tile_indexes[r]=Vc(t[r],{maxZoom:i.max_zoom,tolerance:1.5,extent:an.tile_scale,buffer:1e-4});return i.loaded=!0,e}))),this.load_data.then((function(){for(var e in i.tile_indexes)t.source_data.layers[e]=i.getTileFeatures(t,e);return t}))},i.getTileFeatures=function(e,t){var i,r=an.wrapTile(e.coords,{x:!0}),n=this.tile_indexes[t].getTile(r.z,r.x,r.y);if(n&&n.features){i={type:"FeatureCollection",features:[]};for(var o=0;o<n.features.length;o++){var s=n.features[o],a={type:"Feature",geometry:{},id:s.id,properties:s.tags};if(1===s.type)a.geometry.coordinates=s.geometry.map((function(e){return[e[0],e[1]]})),a.geometry.type="MultiPoint";else{if(2!==s.type&&3!==s.type)continue;if(a.geometry.coordinates=s.geometry.map((function(e){return e.map((function(e){return[e[0],e[1]]}))})),2===s.type)a.geometry.type="MultiLineString";else if(a.geometry=_c(a.geometry),null==a.geometry)continue}i.features.push(a)}}return i},i.formatURL=function(){return this.url},i.parseSourceData=function(e,t,i){var r="string"==typeof i?JSON.parse(i):i,n=this.getLayers(r);t.layers=this.preprocessLayers(n,e)},i.preprocessLayers=function(e,t){for(var i in e){var r=e[i];r.features=this.preprocessFeatures(r.features)}if("function"==typeof this.transform){var n={min:Object.assign({},t.min),max:Object.assign({},t.max),coords:Object.assign({},t.coords)};1===Object.keys(e).length&&e._default?e._default=this.transform(e._default,this.extra_data,n):e=this.transform(e,this.extra_data,n)}return e},i.preprocessFeatures=function(e){if(e=e.filter((function(e){return null!=e.geometry})),this.config.generate_label_centroids){var t=[],i={label_placement:!0};e.forEach((function(e){var r,n;if("Polygon"===e.geometry.type)n=qc(r=e.geometry.coordinates,e.id,e.properties,i),t.push(n);else if("MultiPolygon"===e.geometry.type){r=e.geometry.coordinates;for(var o=-1/0,s=0,a=0;a<r.length;a++){var l=an.polygonArea(r[a]);l>o&&(o=l,s=a)}n=qc(r[s],e.id,e.properties,i),t.push(n)}})),t=t.filter((function(e){return e})),Array.prototype.push.apply(e,t)}return e},i.getLayers=function(e){return"Feature"===e.type?{_default:{type:"FeatureCollection",features:[e]}}:"FeatureCollection"===e.type?{_default:e}:e},t}(Ao),Zc=function(e){function t(t,i){return e.call(this,t,i)||this}ft(t,e);var i=t.prototype;return i.parseSourceData=function(e,t,i){var r="string"==typeof i?JSON.parse(i):i;this.prepareGeoJSON(r,e,t)},i.prepareGeoJSON=function(e,t,i){if("function"==typeof this.transform){var r={min:Object.assign({},t.min),max:Object.assign({},t.max),coords:Object.assign({},t.coords)};e=this.transform(e,this.extra_data,r)}i.layers=$c.prototype.getLayers(e);var n={coords:t.coords,min:an.metersForTile(an.wrapTile(t.coords,{x:!0}))};po.projectData(i),po.scaleData(i,n)},t}(mo);function qc(e,t,i,r){var n=an.centroid(e);if(n){var o={};return Object.assign(o,i,r),{type:"Feature",id:t,properties:o,geometry:{type:"Point",coordinates:n}}}}function Kc(e){return e}function Wc(e,t){var i=t.id,r=t.bbox,n=null==t.properties?{}:t.properties,o=function(e,t){var i=function(e){if(null==(t=e.transform))return Kc;var t,i,r,n=t.scale[0],o=t.scale[1],s=t.translate[0],a=t.translate[1];return function(e,t){return t||(i=r=0),e[0]=(i+=e[0])*n+s,e[1]=(r+=e[1])*o+a,e}}(e),r=e.arcs;function n(e,t){t.length&&t.pop();for(var n=r[e<0?~e:e],o=0,s=n.length;o<s;++o)t.push(i(n[o].slice(),o));e<0&&function(e,t){for(var i,r=e.length,n=r-t;n<--r;)i=e[n],e[n++]=e[r],e[r]=i}(t,s)}function o(e){return i(e.slice())}function s(e){for(var t=[],i=0,r=e.length;i<r;++i)n(e[i],t);return t.length<2&&t.push(t[0].slice()),t}function a(e){for(var t=s(e);t.length<4;)t.push(t[0].slice());return t}function l(e){return e.map(a)}return function e(t){var i,r=t.type;switch(r){case"GeometryCollection":return{type:r,geometries:t.geometries.map(e)};case"Point":i=o(t.coordinates);break;case"MultiPoint":i=t.coordinates.map(o);break;case"LineString":i=s(t.arcs);break;case"MultiLineString":i=t.arcs.map(s);break;case"Polygon":i=l(t.arcs);break;case"MultiPolygon":i=t.arcs.map(l);break;default:return null}return{type:r,coordinates:i}}(t)}(e,t);return null==i&&null==r?{type:"Feature",properties:n,geometry:o}:null==r?{type:"Feature",id:i,properties:n,geometry:o}:{type:"Feature",id:i,bbox:r,properties:n,geometry:o}}po.register("GeoJSON",(function(e){return Zc.urlHasTilePattern(e.url)?Zc:$c}));var Xc=function(e){function t(){return e.apply(this,arguments)||this}ft(t,e);var i=t.prototype;return i.parseSourceData=function(t,i,r){var n="string"==typeof r?JSON.parse(r):r;n=this.toGeoJSON(n);var o=this.getLayers(n);e.prototype.preprocessLayers.call(this,o,t),i.layers=o},i.toGeoJSON=function(e){if(e.objects&&1===Object.keys(e.objects).length){var t=Object.keys(e.objects)[0];e=Yc(e,e.objects[t])}else{var i={};for(var r in e.objects)i[r]=Yc(e,e.objects[r]);e=i}return e},t}($c);function Yc(e,t){var i=function(e,t){return"GeometryCollection"===t.type?{type:"FeatureCollection",features:t.geometries.map((function(t){return Wc(e,t)}))}:Wc(e,t)}(e,t);return"Feature"===i.type&&(i={type:"FeatureCollection",features:[i]}),i}var Jc=function(e){function t(t,i){return e.call(this,t,i)||this}return ft(t,e),t.prototype.parseSourceData=function(e,t,i){var r="string"==typeof i?JSON.parse(i):i;r=Xc.prototype.toGeoJSON(r),this.prepareGeoJSON(r,e,t)},t}(Zc);po.register("TopoJSON",(function(e){return Jc.urlHasTilePattern(e.url)?Jc:Xc})),e.Collision=aa,e.DataSource=po,e.FeatureSelection=Wn,e.FilterOptions=Ll,e.FontManager=_a,e.GLSL=Gr,e.Geo=an,e.Label=ra,e.LabelLineStraight=el,e.LabelPoint=la,e.Light=so,e.Material=eo,e.OBB=ia,e.ShaderProgram=Yr,e.Style=vo,e.StyleManager=ll,e.StyleParser=Dn,e.Task=Tr,e.TextCanvas=Ra,e.Texture=Hr,e.Thread=He,e.Tile=Dl,e.TileID=go,e.Utils=Ji,e.Vector=oo,e.VertexArrayObject=Jr,e.VertexData=So,e.VertexElements=Bo,e.View=Za,e.WorkerBroker=Qi,e._createClass=pt,e._createForOfIteratorHelperLoose=vt,e._inheritsLoose=ft,e.addBaseURL=function(e,t){if(!e||!br(e))return e;var i,r="/"!==e[0];if(t?(i=document.createElement("a")).href=t:i=window.location,r)e=xr(i.href)+e;else{var n=i.origin;n||(n=i.protocol+"//"+i.host),e=n+e}return e},e.buildFilter=Tl,e.cache=Fn,e.clearFunctionStringCache=function(){Fn.functions={},Fn.num_functions=0,Fn.num_cached=0},e.commonjsRequire=function(){throw new Error("Dynamic requires are not currently supported by rollup-plugin-commonjs")},e.compileFunctionStrings=kn,e.createCommonjsModule=t,e.createObjectURL=function(e){return void 0===yr&&"function"!=typeof(yr=window.URL&&window.URL.createObjectURL||window.webkitURL&&window.webkitURL.createObjectURL)&&(yr=null,Ki("warn","window.URL.createObjectURL (or vendor prefix) not found, unable to create local blob URLs")),yr?yr(e):e},e.debugSettings=er,e.debugSumLayerStats=function(e){var t={},i={};return e.filter((function(e){return e.debug.layers})).forEach((function(e){Object.keys(e.debug.layers.list).forEach((function(i){var r=e.debug.layers.list[i];xo(t,i,r.features,r.geoms,r.styles,r.base)})),function e(t,i){for(var r in t){var n=t[r];xo(i,r,n.features,n.geoms,n.styles,n.base),n.layers&&(i[r].layers=i[r].layers||{},e(n.layers,i[r].layers))}}(e.debug.layers.tree,i)})),{list:t,tree:i}},e.extensionForURL=function(e){var t=(e=e.split("/").pop()).lastIndexOf(".");if(t>-1)return e.substring(t+1)},e.flattenRelativeURL=function(e){for(var t=(e||"").split("/"),i=1;i<t.length;i++)"."===t[i]?(t.splice(i,1),i--):".."===t[i]&&(i+=0,t.splice(i-1,2),i--);return t.join("/")},e.isLocalURL=function(e){if("string"==typeof e)return e.search(/^(data|blob):/)>-1},e.isRelativeURL=br,e.isReserved=Fl,e.layerCache=function(){return Cl},e.log=Ki,e.mergeDebugSettings=function(e){Object.assign(Yi,e)},e.mergeObjects=sn,e.parseLayers=function(e,t){Cl={};var i={};for(var r in e){var n=e[r];n&&(i[r]=kl(r,n,null,t))}return i},e.pathForURL=xr,e.require$$0=Vr,e.sliceObject=Cr,e.subscribeMixin=Br,e.version=zi})),r(["./shared"],(function(e){var t=Object.assign(self,{FeatureSelection:e.FeatureSelection,sources:{},styles:{},layers:{},tiles:{},init:function(t,i,r,n,o,s,a){return this.scene_id=t,this._worker_id=i,this.num_workers=r,e.log.setLevel(n),e.Utils.device_pixel_ratio=o,e.VertexElements.setElementIndexUint(s),e.FeatureSelection.setPrefix(this._worker_id),this.style_manager=new e.StyleManager,this.importExternalScripts(a),e.Label.id_prefix=i,e.Label.id_multiplier=r,i},importExternalScripts:function(t){var i=this;if(0!==t.length){e.log("debug","loading custom data source scripts in worker:",t);var r=Object.getOwnPropertyNames(window);importScripts.apply(void 0,t),Object.getOwnPropertyNames(window).forEach((function(e){-1===r.indexOf(e)&&(i[e]=window[e])}))}},updateConfig:function(t,i){var r=t.config,n=t.generation,o=t.introspection;return r=JSON.parse(r),e.mergeDebugSettings(i),this.generation=n,this.introspection=o,this.global=e.compileFunctionStrings(r.global),this.createDataSources(r),r.styles=e.compileFunctionStrings(r.styles,e.StyleParser.wrapFunction),this.styles=this.style_manager.build(r.styles),this.style_manager.initStyles({generation:this.generation,styles:this.styles,sources:this.sources,introspection:this.introspection}),this.layers=e.parseLayers(r.layers,this.style_manager.styles),this.syncing_textures=this.syncTextures(r.textures),this.configuring=this.syncing_textures.then((function(){e.log("debug","updated config")})),this.configuring},createDataSources:function(t){var i=this;this.last_config_sources=this.config_sources||{},this.config_sources=t.sources;var r=this.sources,n=[];for(var o in this.sources={},t.sources)if(JSON.stringify(this.last_config_sources[o])!==JSON.stringify(t.sources[o])){t.sources[o]=e.compileFunctionStrings(t.sources[o]);var s=void 0;try{s=e.DataSource.create(Object.assign({},t.sources[o],{name:o}),this.sources)}catch(e){continue}s&&(this.sources[o]=s,n.push(o))}else this.sources[o]=r[o];n.forEach((function(e){for(var t in i.tiles)i.tiles[t].source===e&&delete i.tiles[t]}))},awaitConfiguration:function(){return this.configuring},buildTile:function(t){var i=this,r=t.tile;if(null==this.getTile(r.key)||!0!==this.getTile(r.key).loading)return r=this.tiles[r.key]=Object.assign(this.getTile(r.key)||{},r),this.awaitConfiguration().then((function(){if(!0!==r.loaded)r.loading=!0,r.loaded=!1,r.error=null,i.loadTileSourceData(r).then((function(){i.getTile(r.key)?(r.source_data.error&&e.log("warn","tile load error(s) for "+r.key+": "+r.source_data.error),r.loading=!1,r.loaded=!0,e.Tile.buildGeometry(r,i)):e.log("trace","stop tile build after data source load because tile was removed: "+r.key)})).catch((function(t){r.loading=!1,r.loaded=!1,r.error=t.stack,e.log("error","tile load error for "+r.key+": "+r.error),e.WorkerBroker.postMessage("TileManager_"+i.scene_id+".buildTileError",e.Tile.slice(r))}));else{e.log("trace","used worker cache for tile "+r.key);try{e.Tile.buildGeometry(r,i)}catch(t){r.error=t.toString(),e.WorkerBroker.postMessage("TileManager_"+i.scene_id+".buildTileError",e.Tile.slice(r))}}}))},loadTileSourceData:function(e){var t=this.sources[e.source];if(t){for(var i in this.tiles){var r=this.tiles[i];if(r.source===e.source&&r.coords.key===e.coords.key&&r.loaded)return Promise.resolve(t.copyTileData(r,e))}return t.load(e)}return e.source_data={},Promise.resolve(e)},getTile:function(e){return this.tiles[e]},removeTile:function(t){var i=this.tiles[t];null!=i&&(!0===i.loading&&(e.log("trace","cancel tile load for "+t),i.loading=!1,e.Tile.cancel(i)),e.FeatureSelection.clearTile(t),delete this.tiles[t],e.log("trace","remove tile from cache for "+t))},queryFeatures:function(t){var i=this,r=t.filter,n=t.visible,o=t.geometry,s=t.tile_keys,a=[],l=s.map((function(e){return i.tiles[e]})).filter((function(e){return e&&e.loaded}));return null!=r&&(r=["{","["].indexOf(r[0])>-1?JSON.parse(r):r,r=e.compileFunctionStrings(r,e.StyleParser.wrapFunction)),r=e.buildFilter(r,e.FilterOptions),l.forEach((function(t){var s=function(s){var l=t.source_data.layers[s];if(null==l)return{v:void 0};l.features.forEach((function(l){var c=l.generation===i.generation;if(!(!0===n&&!c||!1===n&&c)){var u=e.StyleParser.getFeatureParseContext(l,t,i.global);if(u.source=t.source,u.layer=s,u.id=l.id,r(u)){var h={type:l.type,id:l.id,properties:Object.assign({},l.properties,{$source:u.source,$layer:u.layer,$geometry:u.geometry,$visible:c})};!0===o&&(h.geometry=e.Geo.copyGeometry(l.geometry),e.Geo.tileSpaceToLatlng(h.geometry,t.coords.z,t.min)),a.push(h)}}}))};for(var l in t.source_data.layers){var c=s(l);if("object"==typeof c)return c.v}})),a},getFeatureSelection:function(t){var i=void 0===t?{}:t,r=i.id,n=i.key,o=e.FeatureSelection.map[n];return{id:r,feature:o&&o.feature}},resetFeatureSelection:function(t){void 0===t&&(t=null),e.FeatureSelection.reset(t)},getFeatureSelectionMapSize:function(){return e.FeatureSelection.getMapSize()},syncTextures:function(t){var i=[];return t&&i.push.apply(i,Object.keys(t)),e.log("trace","sync textures to worker:",i),i.length>0?e.Texture.syncTexturesToWorker(i):Promise.resolve()},updateDevicePixelRatio:function(t){e.Utils.device_pixel_ratio=t},clearFunctionStringCache:function(){e.clearFunctionStringCache()},profile:function(e){console.profile("worker "+this._worker_id+": "+e)},profileEnd:function(e){console.profileEnd("worker "+this._worker_id+": "+e)},debug:{debugSettings:e.debugSettings,layerCache:e.layerCache,functionStringCache:e.cache}});e.WorkerBroker.addTarget("self",t)})),r(["./shared"],(function(e){var t,r=t={},n=0;function o(e,t){var i,r=t[t.length-1];return null==(i=a(e,t))?void 0:i[r]}function s(e,t,i){var r=t[t.length-1],n=a(e,t);n&&(n[r]=i)}function a(e,t){if(0!==t.length){for(var i=e,r=0;r<t.length-1;r++)if(null==(i=i[t[r]]))return;return i}}t.getContext=function(e,i){var r=!1;null==e&&((e=document.createElement("canvas")).style.position="absolute",e.style.top=0,e.style.left=0,e.style.zIndex=-1,document.body.appendChild(e),r=!0),e.addEventListener("webglcontextlost",(function(){})),e.addEventListener("webglcontextrestored",(function(){}));var o=e.getContext("webgl",i)||e.getContext("experimental-webgl",i);if(!o)throw new Error("Couldn't create WebGL context.");return o._tangram_id=n++,r?(t.resize(o,window.innerWidth,window.innerHeight,i.device_pixel_ratio),window.addEventListener("resize",(function(){t.resize(o,window.innerWidth,window.innerHeight,i.device_pixel_ratio)}))):t.resize(o,parseFloat(e.style.width),parseFloat(e.style.height),i.device_pixel_ratio),o},t.resize=function(e,t,i,r){r=r||window.devicePixelRatio||1,e.canvas.style.width=t+"px",e.canvas.style.height=i+"px",e.canvas.width=Math.round(t*r),e.canvas.height=Math.round(i*r),e.bindFramebuffer(e.FRAMEBUFFER,null),e.viewport(0,0,e.canvas.width,e.canvas.height)};var l="global.",c=l.length,u="__global_prop";function h(e){return(null==e?void 0:e.slice(0,c))===l}function d(e,t){var i,r=Array.isArray(t)?t:[t],n=a(e,r),o=r[r.length-1];return void 0!==(null==n||null==(i=n[u])?void 0:i[o])}var p=void 0!==Ve?Ve:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},f=[],A=[],m="undefined"!=typeof Uint8Array?Uint8Array:Array,g=!1;function _(){g=!0;for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",t=0,i=e.length;t<i;++t)f[t]=e[t],A[e.charCodeAt(t)]=t;A["-".charCodeAt(0)]=62,A["_".charCodeAt(0)]=63}function y(e,t,i){for(var r,n,o=[],s=t;s<i;s+=3)r=(e[s]<<16)+(e[s+1]<<8)+e[s+2],o.push(f[(n=r)>>18&63]+f[n>>12&63]+f[n>>6&63]+f[63&n]);return o.join("")}function v(e){var t;g||_();for(var i=e.length,r=i%3,n="",o=[],s=0,a=i-r;s<a;s+=16383)o.push(y(e,s,s+16383>a?a:s+16383));return 1===r?(t=e[i-1],n+=f[t>>2],n+=f[t<<4&63],n+="=="):2===r&&(t=(e[i-2]<<8)+e[i-1],n+=f[t>>10],n+=f[t>>4&63],n+=f[t<<2&63],n+="="),o.push(n),o.join("")}function x(e,t,i,r,n){var o,s,a=8*n-r-1,l=(1<<a)-1,c=l>>1,u=-7,h=i?n-1:0,d=i?-1:1,p=e[t+h];for(h+=d,o=p&(1<<-u)-1,p>>=-u,u+=a;u>0;o=256*o+e[t+h],h+=d,u-=8);for(s=o&(1<<-u)-1,o>>=-u,u+=r;u>0;s=256*s+e[t+h],h+=d,u-=8);if(0===o)o=1-c;else{if(o===l)return s?NaN:1/0*(p?-1:1);s+=Math.pow(2,r),o-=c}return(p?-1:1)*s*Math.pow(2,o-r)}function b(e,t,i,r,n,o){var s,a,l,c=8*o-n-1,u=(1<<c)-1,h=u>>1,d=23===n?Math.pow(2,-24)-Math.pow(2,-77):0,p=r?0:o-1,f=r?1:-1,A=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,s=u):(s=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-s))<1&&(s--,l*=2),(t+=s+h>=1?d/l:d*Math.pow(2,1-h))*l>=2&&(s++,l/=2),s+h>=u?(a=0,s=u):s+h>=1?(a=(t*l-1)*Math.pow(2,n),s+=h):(a=t*Math.pow(2,h-1)*Math.pow(2,n),s=0));n>=8;e[i+p]=255&a,p+=f,a/=256,n-=8);for(s=s<<n|a,c+=n;c>0;e[i+p]=255&s,p+=f,s/=256,c-=8);e[i+p-f]|=128*A}var w={}.toString,T=Array.isArray||function(e){return"[object Array]"==w.call(e)};E.TYPED_ARRAY_SUPPORT=void 0===p.TYPED_ARRAY_SUPPORT||p.TYPED_ARRAY_SUPPORT;var B=C();function C(){return E.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function S(e,t){if(C()<t)throw new RangeError("Invalid typed array length");return E.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=E.prototype:(null===e&&(e=new E(t)),e.length=t),e}function E(e,t,i){if(!(E.TYPED_ARRAY_SUPPORT||this instanceof E))return new E(e,t,i);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return P(this,e)}return M(this,e,t,i)}function M(e,t,i,r){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,i,r){if(t.byteLength,i<0||t.byteLength<i)throw new RangeError("'offset' is out of bounds");if(t.byteLength<i+(r||0))throw new RangeError("'length' is out of bounds");return t=void 0===i&&void 0===r?new Uint8Array(t):void 0===r?new Uint8Array(t,i):new Uint8Array(t,i,r),E.TYPED_ARRAY_SUPPORT?(e=t).__proto__=E.prototype:e=L(e,t),e}(e,t,i,r):"string"==typeof t?function(e,t,i){if("string"==typeof i&&""!==i||(i="utf8"),!E.isEncoding(i))throw new TypeError('"encoding" must be a valid string encoding');var r=0|z(t,i),n=(e=S(e,r)).write(t,i);return n!==r&&(e=e.slice(0,n)),e}(e,t,i):function(e,t){if(k(t)){var i=0|F(t.length);return 0===(e=S(e,i)).length||t.copy(e,0,0,i),e}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||(r=t.length)!=r?S(e,0):L(e,t);if("Buffer"===t.type&&T(t.data))return L(e,t.data)}var r;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function I(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function P(e,t){if(I(t),e=S(e,t<0?0:0|F(t)),!E.TYPED_ARRAY_SUPPORT)for(var i=0;i<t;++i)e[i]=0;return e}function L(e,t){var i=t.length<0?0:0|F(t.length);e=S(e,i);for(var r=0;r<i;r+=1)e[r]=255&t[r];return e}function F(e){if(e>=C())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+C().toString(16)+" bytes");return 0|e}function k(e){return!(null==e||!e._isBuffer)}function z(e,t){if(k(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var i=e.length;if(0===i)return 0;for(var r=!1;;)switch(t){case"ascii":case"latin1":case"binary":return i;case"utf8":case"utf-8":case void 0:return ae(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*i;case"hex":return i>>>1;case"base64":return le(e).length;default:if(r)return ae(e).length;t=(""+t).toLowerCase(),r=!0}}function R(e,t,i){var r=e[t];e[t]=e[i],e[i]=r}function D(e,t,i,r,n){if(0===e.length)return-1;if("string"==typeof i?(r=i,i=0):i>2147483647?i=2147483647:i<-2147483648&&(i=-2147483648),i=+i,isNaN(i)&&(i=n?0:e.length-1),i<0&&(i=e.length+i),i>=e.length){if(n)return-1;i=e.length-1}else if(i<0){if(!n)return-1;i=0}if("string"==typeof t&&(t=E.from(t,r)),k(t))return 0===t.length?-1:O(e,t,i,r,n);if("number"==typeof t)return t&=255,E.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?n?Uint8Array.prototype.indexOf.call(e,t,i):Uint8Array.prototype.lastIndexOf.call(e,t,i):O(e,[t],i,r,n);throw new TypeError("val must be string, number or Buffer")}function O(e,t,i,r,n){var o,s=1,a=e.length,l=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return-1;s=2,a/=2,l/=2,i/=2}function c(e,t){return 1===s?e[t]:e.readUInt16BE(t*s)}if(n){var u=-1;for(o=i;o<a;o++)if(c(e,o)===c(t,-1===u?0:o-u)){if(-1===u&&(u=o),o-u+1===l)return u*s}else-1!==u&&(o-=o-u),u=-1}else for(i+l>a&&(i=a-l),o=i;o>=0;o--){for(var h=!0,d=0;d<l;d++)if(c(e,o+d)!==c(t,d)){h=!1;break}if(h)return o}return-1}function U(e,t,i,r){i=Number(i)||0;var n=e.length-i;r?(r=Number(r))>n&&(r=n):r=n;var o=t.length;if(o%2!=0)throw new TypeError("Invalid hex string");r>o/2&&(r=o/2);for(var s=0;s<r;++s){var a=parseInt(t.substr(2*s,2),16);if(isNaN(a))return s;e[i+s]=a}return s}function N(e,t,i,r){return ce(ae(t,e.length-i),e,i,r)}function Q(e,t,i,r){return ce(function(e){for(var t=[],i=0;i<e.length;++i)t.push(255&e.charCodeAt(i));return t}(t),e,i,r)}function j(e,t,i,r){return Q(e,t,i,r)}function V(e,t,i,r){return ce(le(t),e,i,r)}function H(e,t,i,r){return ce(function(e,t){for(var i,r,n,o=[],s=0;s<e.length&&!((t-=2)<0);++s)r=(i=e.charCodeAt(s))>>8,n=i%256,o.push(n),o.push(r);return o}(t,e.length-i),e,i,r)}function G(e,t,i){return 0===t&&i===e.length?v(e):v(e.slice(t,i))}function $(e,t,i){i=Math.min(e.length,i);for(var r=[],n=t;n<i;){var o,s,a,l,c=e[n],u=null,h=c>239?4:c>223?3:c>191?2:1;if(n+h<=i)switch(h){case 1:c<128&&(u=c);break;case 2:128==(192&(o=e[n+1]))&&(l=(31&c)<<6|63&o)>127&&(u=l);break;case 3:o=e[n+1],s=e[n+2],128==(192&o)&&128==(192&s)&&(l=(15&c)<<12|(63&o)<<6|63&s)>2047&&(l<55296||l>57343)&&(u=l);break;case 4:o=e[n+1],s=e[n+2],a=e[n+3],128==(192&o)&&128==(192&s)&&128==(192&a)&&(l=(15&c)<<18|(63&o)<<12|(63&s)<<6|63&a)>65535&&l<1114112&&(u=l)}null===u?(u=65533,h=1):u>65535&&(u-=65536,r.push(u>>>10&1023|55296),u=56320|1023&u),r.push(u),n+=h}return function(e){var t=e.length;if(t<=Z)return String.fromCharCode.apply(String,e);for(var i="",r=0;r<t;)i+=String.fromCharCode.apply(String,e.slice(r,r+=Z));return i}(r)}E.poolSize=8192,E._augment=function(e){return e.__proto__=E.prototype,e},E.from=function(e,t,i){return M(null,e,t,i)},E.TYPED_ARRAY_SUPPORT&&(E.prototype.__proto__=Uint8Array.prototype,E.__proto__=Uint8Array),E.alloc=function(e,t,i){return function(e,t,i,r){return I(t),t<=0?S(e,t):void 0!==i?"string"==typeof r?S(e,t).fill(i,r):S(e,t).fill(i):S(e,t)}(null,e,t,i)},E.allocUnsafe=function(e){return P(null,e)},E.allocUnsafeSlow=function(e){return P(null,e)},E.isBuffer=ue,E.compare=function(e,t){if(!k(e)||!k(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var i=e.length,r=t.length,n=0,o=Math.min(i,r);n<o;++n)if(e[n]!==t[n]){i=e[n],r=t[n];break}return i<r?-1:r<i?1:0},E.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},E.concat=function(e,t){if(!T(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return E.alloc(0);var i;if(void 0===t)for(t=0,i=0;i<e.length;++i)t+=e[i].length;var r=E.allocUnsafe(t),n=0;for(i=0;i<e.length;++i){var o=e[i];if(!k(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(r,n),n+=o.length}return r},E.byteLength=z,E.prototype._isBuffer=!0,E.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)R(this,t,t+1);return this},E.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)R(this,t,t+3),R(this,t+1,t+2);return this},E.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)R(this,t,t+7),R(this,t+1,t+6),R(this,t+2,t+5),R(this,t+3,t+4);return this},E.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?$(this,0,e):function(e,t,i){var r=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===i||i>this.length)&&(i=this.length),i<=0)return"";if((i>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return W(this,t,i);case"utf8":case"utf-8":return $(this,t,i);case"ascii":return q(this,t,i);case"latin1":case"binary":return K(this,t,i);case"base64":return G(this,t,i);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return X(this,t,i);default:if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}}.apply(this,arguments)},E.prototype.equals=function(e){if(!k(e))throw new TypeError("Argument must be a Buffer");return this===e||0===E.compare(this,e)},E.prototype.inspect=function(){var e="";return this.length>0&&(e=this.toString("hex",0,50).match(/.{2}/g).join(" "),this.length>50&&(e+=" ... ")),"<Buffer "+e+">"},E.prototype.compare=function(e,t,i,r,n){if(!k(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===i&&(i=e?e.length:0),void 0===r&&(r=0),void 0===n&&(n=this.length),t<0||i>e.length||r<0||n>this.length)throw new RangeError("out of range index");if(r>=n&&t>=i)return 0;if(r>=n)return-1;if(t>=i)return 1;if(this===e)return 0;for(var o=(n>>>=0)-(r>>>=0),s=(i>>>=0)-(t>>>=0),a=Math.min(o,s),l=this.slice(r,n),c=e.slice(t,i),u=0;u<a;++u)if(l[u]!==c[u]){o=l[u],s=c[u];break}return o<s?-1:s<o?1:0},E.prototype.includes=function(e,t,i){return-1!==this.indexOf(e,t,i)},E.prototype.indexOf=function(e,t,i){return D(this,e,t,i,!0)},E.prototype.lastIndexOf=function(e,t,i){return D(this,e,t,i,!1)},E.prototype.write=function(e,t,i,r){if(void 0===t)r="utf8",i=this.length,t=0;else if(void 0===i&&"string"==typeof t)r=t,i=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(i)?(i|=0,void 0===r&&(r="utf8")):(r=i,i=void 0)}var n=this.length-t;if((void 0===i||i>n)&&(i=n),e.length>0&&(i<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var o=!1;;)switch(r){case"hex":return U(this,e,t,i);case"utf8":case"utf-8":return N(this,e,t,i);case"ascii":return Q(this,e,t,i);case"latin1":case"binary":return j(this,e,t,i);case"base64":return V(this,e,t,i);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return H(this,e,t,i);default:if(o)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),o=!0}},E.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var Z=4096;function q(e,t,i){var r="";i=Math.min(e.length,i);for(var n=t;n<i;++n)r+=String.fromCharCode(127&e[n]);return r}function K(e,t,i){var r="";i=Math.min(e.length,i);for(var n=t;n<i;++n)r+=String.fromCharCode(e[n]);return r}function W(e,t,i){var r=e.length;(!t||t<0)&&(t=0),(!i||i<0||i>r)&&(i=r);for(var n="",o=t;o<i;++o)n+=se(e[o]);return n}function X(e,t,i){for(var r=e.slice(t,i),n="",o=0;o<r.length;o+=2)n+=String.fromCharCode(r[o]+256*r[o+1]);return n}function Y(e,t,i){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>i)throw new RangeError("Trying to access beyond buffer length")}function J(e,t,i,r,n,o){if(!k(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>n||t<o)throw new RangeError('"value" argument is out of bounds');if(i+r>e.length)throw new RangeError("Index out of range")}function ee(e,t,i,r){t<0&&(t=65535+t+1);for(var n=0,o=Math.min(e.length-i,2);n<o;++n)e[i+n]=(t&255<<8*(r?n:1-n))>>>8*(r?n:1-n)}function te(e,t,i,r){t<0&&(t=4294967295+t+1);for(var n=0,o=Math.min(e.length-i,4);n<o;++n)e[i+n]=t>>>8*(r?n:3-n)&255}function ie(e,t,i,r,n,o){if(i+r>e.length)throw new RangeError("Index out of range");if(i<0)throw new RangeError("Index out of range")}function re(e,t,i,r,n){return n||ie(e,0,i,4),b(e,t,i,r,23,4),i+4}function ne(e,t,i,r,n){return n||ie(e,0,i,8),b(e,t,i,r,52,8),i+8}E.prototype.slice=function(e,t){var i,r=this.length;if((e=~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),(t=void 0===t?r:~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e),E.TYPED_ARRAY_SUPPORT)(i=this.subarray(e,t)).__proto__=E.prototype;else{var n=t-e;i=new E(n,void 0);for(var o=0;o<n;++o)i[o]=this[o+e]}return i},E.prototype.readUIntLE=function(e,t,i){e|=0,t|=0,i||Y(e,t,this.length);for(var r=this[e],n=1,o=0;++o<t&&(n*=256);)r+=this[e+o]*n;return r},E.prototype.readUIntBE=function(e,t,i){e|=0,t|=0,i||Y(e,t,this.length);for(var r=this[e+--t],n=1;t>0&&(n*=256);)r+=this[e+--t]*n;return r},E.prototype.readUInt8=function(e,t){return t||Y(e,1,this.length),this[e]},E.prototype.readUInt16LE=function(e,t){return t||Y(e,2,this.length),this[e]|this[e+1]<<8},E.prototype.readUInt16BE=function(e,t){return t||Y(e,2,this.length),this[e]<<8|this[e+1]},E.prototype.readUInt32LE=function(e,t){return t||Y(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},E.prototype.readUInt32BE=function(e,t){return t||Y(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},E.prototype.readIntLE=function(e,t,i){e|=0,t|=0,i||Y(e,t,this.length);for(var r=this[e],n=1,o=0;++o<t&&(n*=256);)r+=this[e+o]*n;return r>=(n*=128)&&(r-=Math.pow(2,8*t)),r},E.prototype.readIntBE=function(e,t,i){e|=0,t|=0,i||Y(e,t,this.length);for(var r=t,n=1,o=this[e+--r];r>0&&(n*=256);)o+=this[e+--r]*n;return o>=(n*=128)&&(o-=Math.pow(2,8*t)),o},E.prototype.readInt8=function(e,t){return t||Y(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},E.prototype.readInt16LE=function(e,t){t||Y(e,2,this.length);var i=this[e]|this[e+1]<<8;return 32768&i?4294901760|i:i},E.prototype.readInt16BE=function(e,t){t||Y(e,2,this.length);var i=this[e+1]|this[e]<<8;return 32768&i?4294901760|i:i},E.prototype.readInt32LE=function(e,t){return t||Y(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},E.prototype.readInt32BE=function(e,t){return t||Y(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},E.prototype.readFloatLE=function(e,t){return t||Y(e,4,this.length),x(this,e,!0,23,4)},E.prototype.readFloatBE=function(e,t){return t||Y(e,4,this.length),x(this,e,!1,23,4)},E.prototype.readDoubleLE=function(e,t){return t||Y(e,8,this.length),x(this,e,!0,52,8)},E.prototype.readDoubleBE=function(e,t){return t||Y(e,8,this.length),x(this,e,!1,52,8)},E.prototype.writeUIntLE=function(e,t,i,r){e=+e,t|=0,i|=0,r||J(this,e,t,i,Math.pow(2,8*i)-1,0);var n=1,o=0;for(this[t]=255&e;++o<i&&(n*=256);)this[t+o]=e/n&255;return t+i},E.prototype.writeUIntBE=function(e,t,i,r){e=+e,t|=0,i|=0,r||J(this,e,t,i,Math.pow(2,8*i)-1,0);var n=i-1,o=1;for(this[t+n]=255&e;--n>=0&&(o*=256);)this[t+n]=e/o&255;return t+i},E.prototype.writeUInt8=function(e,t,i){return e=+e,t|=0,i||J(this,e,t,1,255,0),E.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},E.prototype.writeUInt16LE=function(e,t,i){return e=+e,t|=0,i||J(this,e,t,2,65535,0),E.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):ee(this,e,t,!0),t+2},E.prototype.writeUInt16BE=function(e,t,i){return e=+e,t|=0,i||J(this,e,t,2,65535,0),E.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):ee(this,e,t,!1),t+2},E.prototype.writeUInt32LE=function(e,t,i){return e=+e,t|=0,i||J(this,e,t,4,4294967295,0),E.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):te(this,e,t,!0),t+4},E.prototype.writeUInt32BE=function(e,t,i){return e=+e,t|=0,i||J(this,e,t,4,4294967295,0),E.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):te(this,e,t,!1),t+4},E.prototype.writeIntLE=function(e,t,i,r){if(e=+e,t|=0,!r){var n=Math.pow(2,8*i-1);J(this,e,t,i,n-1,-n)}var o=0,s=1,a=0;for(this[t]=255&e;++o<i&&(s*=256);)e<0&&0===a&&0!==this[t+o-1]&&(a=1),this[t+o]=(e/s|0)-a&255;return t+i},E.prototype.writeIntBE=function(e,t,i,r){if(e=+e,t|=0,!r){var n=Math.pow(2,8*i-1);J(this,e,t,i,n-1,-n)}var o=i-1,s=1,a=0;for(this[t+o]=255&e;--o>=0&&(s*=256);)e<0&&0===a&&0!==this[t+o+1]&&(a=1),this[t+o]=(e/s|0)-a&255;return t+i},E.prototype.writeInt8=function(e,t,i){return e=+e,t|=0,i||J(this,e,t,1,127,-128),E.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},E.prototype.writeInt16LE=function(e,t,i){return e=+e,t|=0,i||J(this,e,t,2,32767,-32768),E.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):ee(this,e,t,!0),t+2},E.prototype.writeInt16BE=function(e,t,i){return e=+e,t|=0,i||J(this,e,t,2,32767,-32768),E.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):ee(this,e,t,!1),t+2},E.prototype.writeInt32LE=function(e,t,i){return e=+e,t|=0,i||J(this,e,t,4,2147483647,-2147483648),E.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):te(this,e,t,!0),t+4},E.prototype.writeInt32BE=function(e,t,i){return e=+e,t|=0,i||J(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),E.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):te(this,e,t,!1),t+4},E.prototype.writeFloatLE=function(e,t,i){return re(this,e,t,!0,i)},E.prototype.writeFloatBE=function(e,t,i){return re(this,e,t,!1,i)},E.prototype.writeDoubleLE=function(e,t,i){return ne(this,e,t,!0,i)},E.prototype.writeDoubleBE=function(e,t,i){return ne(this,e,t,!1,i)},E.prototype.copy=function(e,t,i,r){if(i||(i=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<i&&(r=i),r===i)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(i<0||i>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-i&&(r=e.length-t+i);var n,o=r-i;if(this===e&&i<t&&t<r)for(n=o-1;n>=0;--n)e[n+t]=this[n+i];else if(o<1e3||!E.TYPED_ARRAY_SUPPORT)for(n=0;n<o;++n)e[n+t]=this[n+i];else Uint8Array.prototype.set.call(e,this.subarray(i,i+o),t);return o},E.prototype.fill=function(e,t,i,r){if("string"==typeof e){if("string"==typeof t?(r=t,t=0,i=this.length):"string"==typeof i&&(r=i,i=this.length),1===e.length){var n=e.charCodeAt(0);n<256&&(e=n)}if(void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!E.isEncoding(r))throw new TypeError("Unknown encoding: "+r)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<i)throw new RangeError("Out of range index");if(i<=t)return this;var o;if(t>>>=0,i=void 0===i?this.length:i>>>0,e||(e=0),"number"==typeof e)for(o=t;o<i;++o)this[o]=e;else{var s=k(e)?e:ae(new E(e,r).toString()),a=s.length;for(o=0;o<i-t;++o)this[o+t]=s[o%a]}return this};var oe=/[^+\/0-9A-Za-z-_]/g;function se(e){return e<16?"0"+e.toString(16):e.toString(16)}function ae(e,t){var i;t=t||1/0;for(var r=e.length,n=null,o=[],s=0;s<r;++s){if((i=e.charCodeAt(s))>55295&&i<57344){if(!n){if(i>56319){(t-=3)>-1&&o.push(239,191,189);continue}if(s+1===r){(t-=3)>-1&&o.push(239,191,189);continue}n=i;continue}if(i<56320){(t-=3)>-1&&o.push(239,191,189),n=i;continue}i=65536+(n-55296<<10|i-56320)}else n&&(t-=3)>-1&&o.push(239,191,189);if(n=null,i<128){if((t-=1)<0)break;o.push(i)}else if(i<2048){if((t-=2)<0)break;o.push(i>>6|192,63&i|128)}else if(i<65536){if((t-=3)<0)break;o.push(i>>12|224,i>>6&63|128,63&i|128)}else{if(!(i<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(i>>18|240,i>>12&63|128,i>>6&63|128,63&i|128)}}return o}function le(e){return function(e){var t,i,r,n,o,s;g||_();var a=e.length;if(a%4>0)throw new Error("Invalid string. Length must be a multiple of 4");o="="===e[a-2]?2:"="===e[a-1]?1:0,s=new m(3*a/4-o),r=o>0?a-4:a;var l=0;for(t=0,i=0;t<r;t+=4,i+=3)n=A[e.charCodeAt(t)]<<18|A[e.charCodeAt(t+1)]<<12|A[e.charCodeAt(t+2)]<<6|A[e.charCodeAt(t+3)],s[l++]=n>>16&255,s[l++]=n>>8&255,s[l++]=255&n;return 2===o?(n=A[e.charCodeAt(t)]<<2|A[e.charCodeAt(t+1)]>>4,s[l++]=255&n):1===o&&(n=A[e.charCodeAt(t)]<<10|A[e.charCodeAt(t+1)]<<4|A[e.charCodeAt(t+2)]>>2,s[l++]=n>>8&255,s[l++]=255&n),s}(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(oe,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function ce(e,t,i,r){for(var n=0;n<r&&!(n+i>=t.length||n>=e.length);++n)t[n+i]=e[n];return n}function ue(e){return null!=e&&(!!e._isBuffer||he(e)||function(e){return"function"==typeof e.readFloatLE&&"function"==typeof e.slice&&he(e.slice(0,0))}(e))}function he(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}var de=Object.freeze({__proto__:null,INSPECT_MAX_BYTES:50,kMaxLength:B,Buffer:E,SlowBuffer:function(e){return+e!=e&&(e=0),E.alloc(+e)},isBuffer:ue});function pe(){}function fe(){fe.init.call(this)}function Ae(e){return void 0===e._maxListeners?fe.defaultMaxListeners:e._maxListeners}function me(e,t,i,r){var n,o,s,a;if("function"!=typeof i)throw new TypeError('"listener" argument must be a function');if((o=e._events)?(o.newListener&&(e.emit("newListener",t,i.listener?i.listener:i),o=e._events),s=o[t]):(o=e._events=new pe,e._eventsCount=0),s){if("function"==typeof s?s=o[t]=r?[i,s]:[s,i]:r?s.unshift(i):s.push(i),!s.warned&&(n=Ae(e))&&n>0&&s.length>n){s.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+t+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",l.emitter=e,l.type=t,l.count=s.length,a=l,"function"==typeof console.warn?console.warn(a):console.log(a)}}else s=o[t]=i,++e._eventsCount;return e}function ge(e,t,i){var r=!1;function n(){e.removeListener(t,n),r||(r=!0,i.apply(e,arguments))}return n.listener=i,n}function _e(e){var t=this._events;if(t){var i=t[e];if("function"==typeof i)return 1;if(i)return i.length}return 0}function ye(e,t){for(var i=new Array(t);t--;)i[t]=e[t];return i}function ve(){throw new Error("setTimeout has not been defined")}function xe(){throw new Error("clearTimeout has not been defined")}pe.prototype=Object.create(null),fe.EventEmitter=fe,fe.usingDomains=!1,fe.prototype.domain=void 0,fe.prototype._events=void 0,fe.prototype._maxListeners=void 0,fe.defaultMaxListeners=10,fe.init=function(){this.domain=null,fe.usingDomains&&(void 0).active,this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=new pe,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},fe.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=e,this},fe.prototype.getMaxListeners=function(){return Ae(this)},fe.prototype.emit=function(e){var t,i,r,n,o,s,a,l="error"===e;if(s=this._events)l=l&&null==s.error;else if(!l)return!1;if(a=this.domain,l){if(t=arguments[1],!a){if(t instanceof Error)throw t;var c=new Error('Uncaught, unspecified "error" event. ('+t+")");throw c.context=t,c}return t||(t=new Error('Uncaught, unspecified "error" event')),t.domainEmitter=this,t.domain=a,t.domainThrown=!1,a.emit("error",t),!1}if(!(i=s[e]))return!1;var u="function"==typeof i;switch(r=arguments.length){case 1:!function(e,t,i){if(t)e.call(i);else for(var r=e.length,n=ye(e,r),o=0;o<r;++o)n[o].call(i)}(i,u,this);break;case 2:!function(e,t,i,r){if(t)e.call(i,r);else for(var n=e.length,o=ye(e,n),s=0;s<n;++s)o[s].call(i,r)}(i,u,this,arguments[1]);break;case 3:!function(e,t,i,r,n){if(t)e.call(i,r,n);else for(var o=e.length,s=ye(e,o),a=0;a<o;++a)s[a].call(i,r,n)}(i,u,this,arguments[1],arguments[2]);break;case 4:!function(e,t,i,r,n,o){if(t)e.call(i,r,n,o);else for(var s=e.length,a=ye(e,s),l=0;l<s;++l)a[l].call(i,r,n,o)}(i,u,this,arguments[1],arguments[2],arguments[3]);break;default:for(n=new Array(r-1),o=1;o<r;o++)n[o-1]=arguments[o];!function(e,t,i,r){if(t)e.apply(i,r);else for(var n=e.length,o=ye(e,n),s=0;s<n;++s)o[s].apply(i,r)}(i,u,this,n)}return!0},fe.prototype.addListener=function(e,t){return me(this,e,t,!1)},fe.prototype.on=fe.prototype.addListener,fe.prototype.prependListener=function(e,t){return me(this,e,t,!0)},fe.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.on(e,ge(this,e,t)),this},fe.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.prependListener(e,ge(this,e,t)),this},fe.prototype.removeListener=function(e,t){var i,r,n,o,s;if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');if(!(r=this._events))return this;if(!(i=r[e]))return this;if(i===t||i.listener&&i.listener===t)0==--this._eventsCount?this._events=new pe:(delete r[e],r.removeListener&&this.emit("removeListener",e,i.listener||t));else if("function"!=typeof i){for(n=-1,o=i.length;o-- >0;)if(i[o]===t||i[o].listener&&i[o].listener===t){s=i[o].listener,n=o;break}if(n<0)return this;if(1===i.length){if(i[0]=void 0,0==--this._eventsCount)return this._events=new pe,this;delete r[e]}else!function(e,t){for(var i=t,r=i+1,n=e.length;r<n;i+=1,r+=1)e[i]=e[r];e.pop()}(i,n);r.removeListener&&this.emit("removeListener",e,s||t)}return this},fe.prototype.removeAllListeners=function(e){var t,i;if(!(i=this._events))return this;if(!i.removeListener)return 0===arguments.length?(this._events=new pe,this._eventsCount=0):i[e]&&(0==--this._eventsCount?this._events=new pe:delete i[e]),this;if(0===arguments.length){for(var r,n=Object.keys(i),o=0;o<n.length;++o)"removeListener"!==(r=n[o])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=new pe,this._eventsCount=0,this}if("function"==typeof(t=i[e]))this.removeListener(e,t);else if(t)do{this.removeListener(e,t[t.length-1])}while(t[0]);return this},fe.prototype.listeners=function(e){var t,i=this._events;return i&&(t=i[e])?"function"==typeof t?[t.listener||t]:function(e){for(var t=new Array(e.length),i=0;i<t.length;++i)t[i]=e[i].listener||e[i];return t}(t):[]},fe.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):_e.call(e,t)},fe.prototype.listenerCount=_e,fe.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};var be=ve,we=xe;function Te(e){if(be===setTimeout)return setTimeout(e,0);if((be===ve||!be)&&setTimeout)return be=setTimeout,setTimeout(e,0);try{return be(e,0)}catch(t){try{return be.call(null,e,0)}catch(t){return be.call(this,e,0)}}}"function"==typeof p.setTimeout&&(be=setTimeout),"function"==typeof p.clearTimeout&&(we=clearTimeout);var Be,Ce=[],Se=!1,Ee=-1;function Me(){Se&&Be&&(Se=!1,Be.length?Ce=Be.concat(Ce):Ee=-1,Ce.length&&Ie())}function Ie(){if(!Se){var e=Te(Me);Se=!0;for(var t=Ce.length;t;){for(Be=Ce,Ce=[];++Ee<t;)Be&&Be[Ee].run();Ee=-1,t=Ce.length}Be=null,Se=!1,function(e){if(we===clearTimeout)return clearTimeout(e);if((we===xe||!we)&&clearTimeout)return we=clearTimeout,clearTimeout(e);try{we(e)}catch(t){try{return we.call(null,e)}catch(t){return we.call(this,e)}}}(e)}}function Pe(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)t[i-1]=arguments[i];Ce.push(new Le(e,t)),1!==Ce.length||Se||Te(Ie)}function Le(e,t){this.fun=e,this.array=t}function Fe(){}Le.prototype.run=function(){this.fun.apply(null,this.array)};var ke=Fe,ze=Fe,Re=Fe,De=Fe,Oe=Fe,Ue=Fe,Ne=Fe,Qe=p.performance||{},je=Qe.now||Qe.mozNow||Qe.msNow||Qe.oNow||Qe.webkitNow||function(){return(new Date).getTime()},He=new Date,Ge={nextTick:Pe,title:"browser",browser:!0,env:{},argv:[],version:"",versions:{},on:ke,addListener:ze,once:Re,off:De,removeListener:Oe,removeAllListeners:Ue,emit:Ne,binding:function(e){throw new Error("process.binding is not supported")},cwd:function(){return"/"},chdir:function(e){throw new Error("process.chdir is not supported")},umask:function(){return 0},hrtime:function(e){var t=.001*je.call(Qe),i=Math.floor(t),r=Math.floor(t%1*1e9);return e&&(i-=e[0],(r-=e[1])<0&&(i--,r+=1e9)),[i,r]},platform:"browser",release:{},config:{},uptime:function(){return(new Date-He)/1e3}},$e=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8},Ze=e.createCommonjsModule((function(e){"function"==typeof Object.create?e.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:e.exports=function(e,t){e.super_=t;var i=function(){};i.prototype=t.prototype,e.prototype=new i,e.prototype.constructor=e}})),qe=e.createCommonjsModule((function(e,t){var i=/%[sdj%]/g;t.format=function(e){if(!m(e)){for(var t=[],r=0;r<arguments.length;r++)t.push(o(arguments[r]));return t.join(" ")}r=1;for(var n=arguments,s=n.length,a=String(e).replace(i,(function(e){if("%%"===e)return"%";if(r>=s)return e;switch(e){case"%s":return String(n[r++]);case"%d":return Number(n[r++]);case"%j":try{return JSON.stringify(n[r++])}catch(e){return"[Circular]"}default:return e}})),l=n[r];r<s;l=n[++r])f(l)||!y(l)?a+=" "+l:a+=" "+o(l);return a},t.deprecate=function(e,i){if(g(p.process))return function(){return t.deprecate(e,i).apply(this,arguments)};var r=!1;return function(){return r||(console.error(i),r=!0),e.apply(this,arguments)}};var r,n={};function o(e,i){var r={seen:[],stylize:a};return arguments.length>=3&&(r.depth=arguments[2]),arguments.length>=4&&(r.colors=arguments[3]),d(i)?r.showHidden=i:i&&t._extend(r,i),g(r.showHidden)&&(r.showHidden=!1),g(r.depth)&&(r.depth=2),g(r.colors)&&(r.colors=!1),g(r.customInspect)&&(r.customInspect=!0),r.colors&&(r.stylize=s),l(r,e,r.depth)}function s(e,t){var i=o.styles[t];return i?"["+o.colors[i][0]+"m"+e+"["+o.colors[i][1]+"m":e}function a(e,t){return e}function l(e,i,r){if(e.customInspect&&i&&b(i.inspect)&&i.inspect!==t.inspect&&(!i.constructor||i.constructor.prototype!==i)){var n=i.inspect(r,e);return m(n)||(n=l(e,n,r)),n}var o=function(e,t){if(g(t))return e.stylize("undefined","undefined");if(m(t)){var i="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(i,"string")}return A(t)?e.stylize(""+t,"number"):d(t)?e.stylize(""+t,"boolean"):f(t)?e.stylize("null","null"):void 0}(e,i);if(o)return o;var s=Object.keys(i),a=function(e){var t={};return e.forEach((function(e,i){t[e]=!0})),t}(s);if(e.showHidden&&(s=Object.getOwnPropertyNames(i)),x(i)&&(s.indexOf("message")>=0||s.indexOf("description")>=0))return c(i);if(0===s.length){if(b(i)){var p=i.name?": "+i.name:"";return e.stylize("[Function"+p+"]","special")}if(_(i))return e.stylize(RegExp.prototype.toString.call(i),"regexp");if(v(i))return e.stylize(Date.prototype.toString.call(i),"date");if(x(i))return c(i)}var y,w="",T=!1,B=["{","}"];return h(i)&&(T=!0,B=["[","]"]),b(i)&&(w=" [Function"+(i.name?": "+i.name:"")+"]"),_(i)&&(w=" "+RegExp.prototype.toString.call(i)),v(i)&&(w=" "+Date.prototype.toUTCString.call(i)),x(i)&&(w=" "+c(i)),0!==s.length||T&&0!=i.length?r<0?_(i)?e.stylize(RegExp.prototype.toString.call(i),"regexp"):e.stylize("[Object]","special"):(e.seen.push(i),y=T?function(e,t,i,r,n){for(var o=[],s=0,a=t.length;s<a;++s)C(t,String(s))?o.push(u(e,t,i,r,String(s),!0)):o.push("");return n.forEach((function(n){n.match(/^\d+$/)||o.push(u(e,t,i,r,n,!0))})),o}(e,i,r,a,s):s.map((function(t){return u(e,i,r,a,t,T)})),e.seen.pop(),function(e,t,i){return e.reduce((function(e,t){return t.indexOf("\n"),e+t.replace(/\u001b\[\d\d?m/g,"").length+1}),0)>60?i[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+i[1]:i[0]+t+" "+e.join(", ")+" "+i[1]}(y,w,B)):B[0]+w+B[1]}function c(e){return"["+Error.prototype.toString.call(e)+"]"}function u(e,t,i,r,n,o){var s,a,c;if((c=Object.getOwnPropertyDescriptor(t,n)||{value:t[n]}).get?a=c.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):c.set&&(a=e.stylize("[Setter]","special")),C(r,n)||(s="["+n+"]"),a||(e.seen.indexOf(c.value)<0?(a=f(i)?l(e,c.value,null):l(e,c.value,i-1)).indexOf("\n")>-1&&(a=o?a.split("\n").map((function(e){return"  "+e})).join("\n").substr(2):"\n"+a.split("\n").map((function(e){return"   "+e})).join("\n")):a=e.stylize("[Circular]","special")),g(s)){if(o&&n.match(/^\d+$/))return a;(s=JSON.stringify(""+n)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(s=s.substr(1,s.length-2),s=e.stylize(s,"name")):(s=s.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),s=e.stylize(s,"string"))}return s+": "+a}function h(e){return Array.isArray(e)}function d(e){return"boolean"==typeof e}function f(e){return null===e}function A(e){return"number"==typeof e}function m(e){return"string"==typeof e}function g(e){return void 0===e}function _(e){return y(e)&&"[object RegExp]"===w(e)}function y(e){return"object"==typeof e&&null!==e}function v(e){return y(e)&&"[object Date]"===w(e)}function x(e){return y(e)&&("[object Error]"===w(e)||e instanceof Error)}function b(e){return"function"==typeof e}function w(e){return Object.prototype.toString.call(e)}function T(e){return e<10?"0"+e.toString(10):e.toString(10)}t.debuglog=function(e){if(g(r)&&(r=""),e=e.toUpperCase(),!n[e])if(new RegExp("\\b"+e+"\\b","i").test(r)){var i=Ge.pid;n[e]=function(){var r=t.format.apply(t,arguments);console.error("%s %d: %s",e,i,r)}}else n[e]=function(){};return n[e]},t.inspect=o,o.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},o.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},t.isArray=h,t.isBoolean=d,t.isNull=f,t.isNullOrUndefined=function(e){return null==e},t.isNumber=A,t.isString=m,t.isSymbol=function(e){return"symbol"==typeof e},t.isUndefined=g,t.isRegExp=_,t.isObject=y,t.isDate=v,t.isError=x,t.isFunction=b,t.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},t.isBuffer=$e;var B=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function C(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.log=function(){var e,i;console.log("%s - %s",(i=[T((e=new Date).getHours()),T(e.getMinutes()),T(e.getSeconds())].join(":"),[e.getDate(),B[e.getMonth()],i].join(" ")),t.format.apply(t,arguments))},t.inherits=Ze,t._extend=function(e,t){if(!t||!y(t))return e;for(var i=Object.keys(t),r=i.length;r--;)e[i[r]]=t[i[r]];return e}})),Ke=(qe.format,qe.deprecate),We=qe.debuglog,Xe=(qe.inspect,qe.isArray,qe.isBoolean,qe.isNull,qe.isNullOrUndefined,qe.isNumber,qe.isString,qe.isSymbol,qe.isUndefined,qe.isRegExp,qe.isObject,qe.isDate,qe.isError,qe.isFunction,qe.isPrimitive,qe.isBuffer,qe.log,qe.inherits);function Ye(){this.head=null,this.tail=null,this.length=0}qe._extend,Ye.prototype.push=function(e){var t={data:e,next:null};this.length>0?this.tail.next=t:this.head=t,this.tail=t,++this.length},Ye.prototype.unshift=function(e){var t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length},Ye.prototype.shift=function(){if(0!==this.length){var e=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e}},Ye.prototype.clear=function(){this.head=this.tail=null,this.length=0},Ye.prototype.join=function(e){if(0===this.length)return"";for(var t=this.head,i=""+t.data;t=t.next;)i+=e+t.data;return i},Ye.prototype.concat=function(e){if(0===this.length)return E.alloc(0);if(1===this.length)return this.head.data;for(var t=E.allocUnsafe(e>>>0),i=this.head,r=0;i;)i.data.copy(t,r),r+=i.data.length,i=i.next;return t};var Je=e.createCommonjsModule((function(e,t){var i=de.Buffer;function r(e,t){for(var i in e)t[i]=e[i]}function n(e,t,r){return i(e,t,r)}i.from&&i.alloc&&i.allocUnsafe&&i.allocUnsafeSlow?e.exports=de:(r(de,t),t.Buffer=n),r(i,n),n.from=function(e,t,r){if("number"==typeof e)throw new TypeError("Argument must not be a number");return i(e,t,r)},n.alloc=function(e,t,r){if("number"!=typeof e)throw new TypeError("Argument must be a number");var n=i(e);return void 0!==t?"string"==typeof r?n.fill(t,r):n.fill(t):n.fill(0),n},n.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return i(e)},n.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return de.SlowBuffer(e)}})),et=(Je.Buffer,Je.Buffer),tt=et.isEncoding||function(e){switch((e=""+e)&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}},it=rt;function rt(e){var t;switch(this.encoding=function(e){var t=function(e){if(!e)return"utf8";for(var t;;)switch(e){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return e;default:if(t)return;e=(""+e).toLowerCase(),t=!0}}(e);if("string"!=typeof t&&(et.isEncoding===tt||!tt(e)))throw new Error("Unknown encoding: "+e);return t||e}(e),this.encoding){case"utf16le":this.text=st,this.end=at,t=4;break;case"utf8":this.fillLast=ot,t=4;break;case"base64":this.text=lt,this.end=ct,t=3;break;default:return this.write=ut,void(this.end=ht)}this.lastNeed=0,this.lastTotal=0,this.lastChar=et.allocUnsafe(t)}function nt(e){return e<=127?0:e>>5==6?2:e>>4==14?3:e>>3==30?4:-1}function ot(e){var t=this.lastTotal-this.lastNeed,i=function(e,t,i){if(128!=(192&t[0]))return e.lastNeed=0,"".repeat(i);if(e.lastNeed>1&&t.length>1){if(128!=(192&t[1]))return e.lastNeed=1,"".repeat(i+1);if(e.lastNeed>2&&t.length>2&&128!=(192&t[2]))return e.lastNeed=2,"".repeat(i+2)}}(this,e,t);return void 0!==i?i:this.lastNeed<=e.length?(e.copy(this.lastChar,t,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(e.copy(this.lastChar,t,0,e.length),void(this.lastNeed-=e.length))}function st(e,t){if((e.length-t)%2==0){var i=e.toString("utf16le",t);if(i){var r=i.charCodeAt(i.length-1);if(r>=55296&&r<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1],i.slice(0,-1)}return i}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=e[e.length-1],e.toString("utf16le",t,e.length-1)}function at(e){var t=e&&e.length?this.write(e):"";if(this.lastNeed){var i=this.lastTotal-this.lastNeed;return t+this.lastChar.toString("utf16le",0,i)}return t}function lt(e,t){var i=(e.length-t)%3;return 0===i?e.toString("base64",t):(this.lastNeed=3-i,this.lastTotal=3,1===i?this.lastChar[0]=e[e.length-1]:(this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1]),e.toString("base64",t,e.length-i))}function ct(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+this.lastChar.toString("base64",0,3-this.lastNeed):t}function ut(e){return e.toString(this.encoding)}function ht(e){return e&&e.length?this.write(e):""}rt.prototype.write=function(e){if(0===e.length)return"";var t,i;if(this.lastNeed){if(void 0===(t=this.fillLast(e)))return"";i=this.lastNeed,this.lastNeed=0}else i=0;return i<e.length?t?t+this.text(e,i):this.text(e,i):t||""},rt.prototype.end=function(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+"".repeat(this.lastTotal-this.lastNeed):t},rt.prototype.text=function(e,t){var i=function(e,t,i){var r=t.length-1;if(r<i)return 0;var n=nt(t[r]);return n>=0?(n>0&&(e.lastNeed=n-1),n):--r<i?0:(n=nt(t[r]))>=0?(n>0&&(e.lastNeed=n-2),n):--r<i?0:(n=nt(t[r]))>=0?(n>0&&(2===n?n=0:e.lastNeed=n-3),n):0}(this,e,t);if(!this.lastNeed)return e.toString("utf8",t);this.lastTotal=i;var r=e.length-(i-this.lastNeed);return e.copy(this.lastChar,0,r),e.toString("utf8",t,r)},rt.prototype.fillLast=function(e){if(this.lastNeed<=e.length)return e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,e.length),this.lastNeed-=e.length},ft.ReadableState=pt;var dt=We("stream");function pt(e,t){e=e||{},this.objectMode=!!e.objectMode,t instanceof jt&&(this.objectMode=this.objectMode||!!e.readableObjectMode);var i=e.highWaterMark,r=this.objectMode?16:16384;this.highWaterMark=i||0===i?i:r,this.highWaterMark=~~this.highWaterMark,this.buffer=new Ye,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.defaultEncoding=e.defaultEncoding||"utf8",this.ranOut=!1,this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(this.decoder=new it(e.encoding),this.encoding=e.encoding)}function ft(e){if(!(this instanceof ft))return new ft(e);this._readableState=new pt(e,this),this.readable=!0,e&&"function"==typeof e.read&&(this._read=e.read),fe.call(this)}function At(e,t,i,r,n){var o=function(e,t){var i=null;return ue(t)||"string"==typeof t||null==t||e.objectMode||(i=new TypeError("Invalid non-string/buffer chunk")),i}(t,i);if(o)e.emit("error",o);else if(null===i)t.reading=!1,function(e,t){if(!t.ended){if(t.decoder){var i=t.decoder.end();i&&i.length&&(t.buffer.push(i),t.length+=t.objectMode?1:i.length)}t.ended=!0,_t(e)}}(e,t);else if(t.objectMode||i&&i.length>0)if(t.ended&&!n){var s=new Error("stream.push() after EOF");e.emit("error",s)}else if(t.endEmitted&&n){var a=new Error("stream.unshift() after end event");e.emit("error",a)}else{var l;!t.decoder||n||r||(i=t.decoder.write(i),l=!t.objectMode&&0===i.length),n||(t.reading=!1),l||(t.flowing&&0===t.length&&!t.sync?(e.emit("data",i),e.read(0)):(t.length+=t.objectMode?1:i.length,n?t.buffer.unshift(i):t.buffer.push(i),t.needReadable&&_t(e))),function(e,t){t.readingMore||(t.readingMore=!0,Pe(vt,e,t))}(e,t)}else n||(t.reading=!1);return function(e){return!e.ended&&(e.needReadable||e.length<e.highWaterMark||0===e.length)}(t)}Xe(ft,fe),ft.prototype.push=function(e,t){var i=this._readableState;return i.objectMode||"string"!=typeof e||(t=t||i.defaultEncoding)!==i.encoding&&(e=E.from(e,t),t=""),At(this,i,e,t,!1)},ft.prototype.unshift=function(e){return At(this,this._readableState,e,"",!0)},ft.prototype.isPaused=function(){return!1===this._readableState.flowing},ft.prototype.setEncoding=function(e){return this._readableState.decoder=new it(e),this._readableState.encoding=e,this};var mt=8388608;function gt(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!=e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=function(e){return e>=mt?e=mt:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}(e)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0))}function _t(e){var t=e._readableState;t.needReadable=!1,t.emittedReadable||(dt("emitReadable",t.flowing),t.emittedReadable=!0,t.sync?Pe(yt,e):yt(e))}function yt(e){dt("emit readable"),e.emit("readable"),wt(e)}function vt(e,t){for(var i=t.length;!t.reading&&!t.flowing&&!t.ended&&t.length<t.highWaterMark&&(dt("maybeReadMore read 0"),e.read(0),i!==t.length);)i=t.length;t.readingMore=!1}function xt(e){dt("readable nexttick read 0"),e.read(0)}function bt(e,t){t.reading||(dt("resume read 0"),e.read(0)),t.resumeScheduled=!1,t.awaitDrain=0,e.emit("resume"),wt(e),t.flowing&&!t.reading&&e.read(0)}function wt(e){var t=e._readableState;for(dt("flow",t.flowing);t.flowing&&null!==e.read(););}function Tt(e,t){return 0===t.length?null:(t.objectMode?i=t.buffer.shift():!e||e>=t.length?(i=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.head.data:t.buffer.concat(t.length),t.buffer.clear()):i=function(e,t,i){var r;return e<t.head.data.length?(r=t.head.data.slice(0,e),t.head.data=t.head.data.slice(e)):r=e===t.head.data.length?t.shift():i?function(e,t){var i=t.head,r=1,n=i.data;for(e-=n.length;i=i.next;){var o=i.data,s=e>o.length?o.length:e;if(s===o.length?n+=o:n+=o.slice(0,e),0==(e-=s)){s===o.length?(++r,i.next?t.head=i.next:t.head=t.tail=null):(t.head=i,i.data=o.slice(s));break}++r}return t.length-=r,n}(e,t):function(e,t){var i=E.allocUnsafe(e),r=t.head,n=1;for(r.data.copy(i),e-=r.data.length;r=r.next;){var o=r.data,s=e>o.length?o.length:e;if(o.copy(i,i.length-e,0,s),0==(e-=s)){s===o.length?(++n,r.next?t.head=r.next:t.head=t.tail=null):(t.head=r,r.data=o.slice(s));break}++n}return t.length-=n,i}(e,t),r}(e,t.buffer,t.decoder),i);var i}function Bt(e){var t=e._readableState;if(t.length>0)throw new Error('"endReadable()" called on non-empty stream');t.endEmitted||(t.ended=!0,Pe(Ct,t,e))}function Ct(e,t){e.endEmitted||0!==e.length||(e.endEmitted=!0,t.readable=!1,t.emit("end"))}function St(e,t){for(var i=0,r=e.length;i<r;i++)if(e[i]===t)return i;return-1}function Et(){}function Mt(e,t,i){this.chunk=e,this.encoding=t,this.callback=i,this.next=null}function It(e,t){Object.defineProperty(this,"buffer",{get:Ke((function(){return this.getBuffer()}),"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.")}),e=e||{},this.objectMode=!!e.objectMode,t instanceof jt&&(this.objectMode=this.objectMode||!!e.writableObjectMode);var i=e.highWaterMark,r=this.objectMode?16:16384;this.highWaterMark=i||0===i?i:r,this.highWaterMark=~~this.highWaterMark,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1;var n=!1===e.decodeStrings;this.decodeStrings=!n,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){!function(e,t){var i=e._writableState,r=i.sync,n=i.writecb;if(function(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}(i),t)!function(e,t,i,r,n){--t.pendingcb,i?Pe(n,r):n(r),e._writableState.errorEmitted=!0,e.emit("error",r)}(e,i,r,t,n);else{var o=zt(i);o||i.corked||i.bufferProcessing||!i.bufferedRequest||kt(e,i),r?Pe(Ft,e,i,o,n):Ft(e,i,o,n)}}(t,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new Ot(this)}function Pt(e){if(!(this instanceof Pt||this instanceof jt))return new Pt(e);this._writableState=new It(e,this),this.writable=!0,e&&("function"==typeof e.write&&(this._write=e.write),"function"==typeof e.writev&&(this._writev=e.writev)),fe.call(this)}function Lt(e,t,i,r,n,o,s){t.writelen=r,t.writecb=s,t.writing=!0,t.sync=!0,i?e._writev(n,t.onwrite):e._write(n,o,t.onwrite),t.sync=!1}function Ft(e,t,i,r){i||function(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}(e,t),t.pendingcb--,r(),Dt(e,t)}function kt(e,t){t.bufferProcessing=!0;var i=t.bufferedRequest;if(e._writev&&i&&i.next){var r=t.bufferedRequestCount,n=new Array(r),o=t.corkedRequestsFree;o.entry=i;for(var s=0;i;)n[s]=i,i=i.next,s+=1;Lt(e,t,!0,t.length,n,"",o.finish),t.pendingcb++,t.lastBufferedRequest=null,o.next?(t.corkedRequestsFree=o.next,o.next=null):t.corkedRequestsFree=new Ot(t)}else{for(;i;){var a=i.chunk,l=i.encoding,c=i.callback;if(Lt(e,t,!1,t.objectMode?1:a.length,a,l,c),i=i.next,t.writing)break}null===i&&(t.lastBufferedRequest=null)}t.bufferedRequestCount=0,t.bufferedRequest=i,t.bufferProcessing=!1}function zt(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function Rt(e,t){t.prefinished||(t.prefinished=!0,e.emit("prefinish"))}function Dt(e,t){var i=zt(t);return i&&(0===t.pendingcb?(Rt(e,t),t.finished=!0,e.emit("finish")):Rt(e,t)),i}function Ot(e){var t=this;this.next=null,this.entry=null,this.finish=function(i){var r=t.entry;for(t.entry=null;r;){var n=r.callback;e.pendingcb--,n(i),r=r.next}e.corkedRequestsFree?e.corkedRequestsFree.next=t:e.corkedRequestsFree=t}}ft.prototype.read=function(e){dt("read",e),e=parseInt(e,10);var t=this._readableState,i=e;if(0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&(t.length>=t.highWaterMark||t.ended))return dt("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?Bt(this):_t(this),null;if(0===(e=gt(e,t))&&t.ended)return 0===t.length&&Bt(this),null;var r,n=t.needReadable;return dt("need readable",n),(0===t.length||t.length-e<t.highWaterMark)&&dt("length less than watermark",n=!0),t.ended||t.reading?dt("reading or ended",n=!1):n&&(dt("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=gt(i,t))),null===(r=e>0?Tt(e,t):null)?(t.needReadable=!0,e=0):t.length-=e,0===t.length&&(t.ended||(t.needReadable=!0),i!==e&&t.ended&&Bt(this)),null!==r&&this.emit("data",r),r},ft.prototype._read=function(e){this.emit("error",new Error("not implemented"))},ft.prototype.pipe=function(e,t){var i=this,r=this._readableState;switch(r.pipesCount){case 0:r.pipes=e;break;case 1:r.pipes=[r.pipes,e];break;default:r.pipes.push(e)}r.pipesCount+=1,dt("pipe count=%d opts=%j",r.pipesCount,t);var n=t&&!1===t.end?c:s;function o(e){dt("onunpipe"),e===i&&c()}function s(){dt("onend"),e.end()}r.endEmitted?Pe(n):i.once("end",n),e.on("unpipe",o);var a=function(e){return function(){var t=e._readableState;dt("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&e.listeners("data").length&&(t.flowing=!0,wt(e))}}(i);e.on("drain",a);var l=!1;function c(){dt("cleanup"),e.removeListener("close",p),e.removeListener("finish",f),e.removeListener("drain",a),e.removeListener("error",d),e.removeListener("unpipe",o),i.removeListener("end",s),i.removeListener("end",c),i.removeListener("data",h),l=!0,!r.awaitDrain||e._writableState&&!e._writableState.needDrain||a()}var u=!1;function h(t){dt("ondata"),u=!1,!1!==e.write(t)||u||((1===r.pipesCount&&r.pipes===e||r.pipesCount>1&&-1!==St(r.pipes,e))&&!l&&(dt("false write response, pause",i._readableState.awaitDrain),i._readableState.awaitDrain++,u=!0),i.pause())}function d(t){var i;dt("onerror",t),A(),e.removeListener("error",d),0===(i="error",e.listeners(i).length)&&e.emit("error",t)}function p(){e.removeListener("finish",f),A()}function f(){dt("onfinish"),e.removeListener("close",p),A()}function A(){dt("unpipe"),i.unpipe(e)}return i.on("data",h),function(e,t,i){if("function"==typeof e.prependListener)return e.prependListener(t,i);e._events&&e._events[t]?Array.isArray(e._events[t])?e._events[t].unshift(i):e._events[t]=[i,e._events[t]]:e.on(t,i)}(e,"error",d),e.once("close",p),e.once("finish",f),e.emit("pipe",i),r.flowing||(dt("pipe resume"),i.resume()),e},ft.prototype.unpipe=function(e){var t=this._readableState;if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes||(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this)),this;if(!e){var i=t.pipes,r=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var n=0;n<r;n++)i[n].emit("unpipe",this);return this}var o=St(t.pipes,e);return-1===o||(t.pipes.splice(o,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this)),this},ft.prototype.on=function(e,t){var i=fe.prototype.on.call(this,e,t);if("data"===e)!1!==this._readableState.flowing&&this.resume();else if("readable"===e){var r=this._readableState;r.endEmitted||r.readableListening||(r.readableListening=r.needReadable=!0,r.emittedReadable=!1,r.reading?r.length&&_t(this):Pe(xt,this))}return i},ft.prototype.addListener=ft.prototype.on,ft.prototype.resume=function(){var e=this._readableState;return e.flowing||(dt("resume"),e.flowing=!0,function(e,t){t.resumeScheduled||(t.resumeScheduled=!0,Pe(bt,e,t))}(this,e)),this},ft.prototype.pause=function(){return dt("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(dt("pause"),this._readableState.flowing=!1,this.emit("pause")),this},ft.prototype.wrap=function(e){var t=this._readableState,i=!1,r=this;for(var n in e.on("end",(function(){if(dt("wrapped end"),t.decoder&&!t.ended){var e=t.decoder.end();e&&e.length&&r.push(e)}r.push(null)})),e.on("data",(function(n){dt("wrapped data"),t.decoder&&(n=t.decoder.write(n)),t.objectMode&&null==n||(t.objectMode||n&&n.length)&&(r.push(n)||(i=!0,e.pause()))})),e)void 0===this[n]&&"function"==typeof e[n]&&(this[n]=function(t){return function(){return e[t].apply(e,arguments)}}(n));return function(e,t){for(var i=0,r=e.length;i<r;i++)t(e[i],i)}(["error","close","destroy","pause","resume"],(function(t){e.on(t,r.emit.bind(r,t))})),r._read=function(t){dt("wrapped _read",t),i&&(i=!1,e.resume())},r},ft._fromList=Tt,Pt.WritableState=It,Xe(Pt,fe),It.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},Pt.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},Pt.prototype.write=function(e,t,i){var r=this._writableState,n=!1;return"function"==typeof t&&(i=t,t=null),E.isBuffer(e)?t="buffer":t||(t=r.defaultEncoding),"function"!=typeof i&&(i=Et),r.ended?function(e,t){var i=new Error("write after end");e.emit("error",i),Pe(t,i)}(this,i):function(e,t,i,r){var n=!0,o=!1;return null===i?o=new TypeError("May not write null values to stream"):E.isBuffer(i)||"string"==typeof i||void 0===i||t.objectMode||(o=new TypeError("Invalid non-string/buffer chunk")),o&&(e.emit("error",o),Pe(r,o),n=!1),n}(this,r,e,i)&&(r.pendingcb++,n=function(e,t,i,r,n){i=function(e,t,i){return e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=E.from(t,i)),t}(t,i,r),E.isBuffer(i)&&(r="buffer");var o=t.objectMode?1:i.length;t.length+=o;var s=t.length<t.highWaterMark;if(s||(t.needDrain=!0),t.writing||t.corked){var a=t.lastBufferedRequest;t.lastBufferedRequest=new Mt(i,r,n),a?a.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else Lt(e,t,!1,o,i,r,n);return s}(this,r,e,t,i)),n},Pt.prototype.cork=function(){this._writableState.corked++},Pt.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.finished||e.bufferProcessing||!e.bufferedRequest||kt(this,e))},Pt.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+e);return this._writableState.defaultEncoding=e,this},Pt.prototype._write=function(e,t,i){i(new Error("not implemented"))},Pt.prototype._writev=null,Pt.prototype.end=function(e,t,i){var r=this._writableState;"function"==typeof e?(i=e,e=null,t=null):"function"==typeof t&&(i=t,t=null),null!=e&&this.write(e,t),r.corked&&(r.corked=1,this.uncork()),r.ending||r.finished||function(e,t,i){t.ending=!0,Dt(e,t),i&&(t.finished?Pe(i):e.once("finish",i)),t.ended=!0,e.writable=!1}(this,r,i)},Xe(jt,ft);for(var Ut=Object.keys(Pt.prototype),Nt=0;Nt<Ut.length;Nt++){var Qt=Ut[Nt];jt.prototype[Qt]||(jt.prototype[Qt]=Pt.prototype[Qt])}function jt(e){if(!(this instanceof jt))return new jt(e);ft.call(this,e),Pt.call(this,e),e&&!1===e.readable&&(this.readable=!1),e&&!1===e.writable&&(this.writable=!1),this.allowHalfOpen=!0,e&&!1===e.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",Vt)}function Vt(){this.allowHalfOpen||this._writableState.ended||Pe(Ht,this)}function Ht(e){e.end()}function Gt(e){this.afterTransform=function(t,i){return function(e,t,i){var r=e._transformState;r.transforming=!1;var n=r.writecb;if(!n)return e.emit("error",new Error("no writecb in Transform class"));r.writechunk=null,r.writecb=null,null!=i&&e.push(i),n(t);var o=e._readableState;o.reading=!1,(o.needReadable||o.length<o.highWaterMark)&&e._read(o.highWaterMark)}(e,t,i)},this.needTransform=!1,this.transforming=!1,this.writecb=null,this.writechunk=null,this.writeencoding=null}function $t(e){if(!(this instanceof $t))return new $t(e);jt.call(this,e),this._transformState=new Gt(this);var t=this;this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.once("prefinish",(function(){"function"==typeof this._flush?this._flush((function(e){Zt(t,e)})):Zt(t)}))}function Zt(e,t){if(t)return e.emit("error",t);var i=e._writableState,r=e._transformState;if(i.length)throw new Error("Calling transform done when ws.length != 0");if(r.transforming)throw new Error("Calling transform done when still transforming");return e.push(null)}function qt(e){if(!(this instanceof qt))return new qt(e);$t.call(this,e)}function Kt(){fe.call(this)}Xe($t,jt),$t.prototype.push=function(e,t){return this._transformState.needTransform=!1,jt.prototype.push.call(this,e,t)},$t.prototype._transform=function(e,t,i){throw new Error("Not implemented")},$t.prototype._write=function(e,t,i){var r=this._transformState;if(r.writecb=i,r.writechunk=e,r.writeencoding=t,!r.transforming){var n=this._readableState;(r.needTransform||n.needReadable||n.length<n.highWaterMark)&&this._read(n.highWaterMark)}},$t.prototype._read=function(e){var t=this._transformState;null!==t.writechunk&&t.writecb&&!t.transforming?(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform)):t.needTransform=!0},Xe(qt,$t),qt.prototype._transform=function(e,t,i){i(null,e)},Xe(Kt,fe),Kt.Readable=ft,Kt.Writable=Pt,Kt.Duplex=jt,Kt.Transform=$t,Kt.PassThrough=qt,Kt.Stream=Kt,Kt.prototype.pipe=function(e,t){var i=this;function r(t){e.writable&&!1===e.write(t)&&i.pause&&i.pause()}function n(){i.readable&&i.resume&&i.resume()}i.on("data",r),e.on("drain",n),e._isStdio||t&&!1===t.end||(i.on("end",s),i.on("close",a));var o=!1;function s(){o||(o=!0,e.end())}function a(){o||(o=!0,"function"==typeof e.destroy&&e.destroy())}function l(e){if(c(),0===fe.listenerCount(this,"error"))throw e}function c(){i.removeListener("data",r),e.removeListener("drain",n),i.removeListener("end",s),i.removeListener("close",a),i.removeListener("error",l),e.removeListener("error",l),i.removeListener("end",c),i.removeListener("close",c),e.removeListener("close",c)}return i.on("error",l),e.on("error",l),i.on("end",c),i.on("close",c),e.on("close",c),e.emit("pipe",i),e};var Wt=Kt,Xt=e.createCommonjsModule((function(e,t){if(t.base64=!0,t.array=!0,t.string=!0,t.arraybuffer="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array,t.nodebuffer=!0,t.uint8array="undefined"!=typeof Uint8Array,"undefined"==typeof ArrayBuffer)t.blob=!1;else{var i=new ArrayBuffer(0);try{t.blob=0===new Blob([i],{type:"application/zip"}).size}catch(e){try{var r=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);r.append(i),t.blob=0===r.getBlob("application/zip").size}catch(e){t.blob=!1}}}try{t.nodestream=!!Wt.Readable}catch(e){t.nodestream=!1}})),Yt=(Xt.base64,Xt.array,Xt.string,Xt.arraybuffer,Xt.nodebuffer,Xt.uint8array,Xt.blob,Xt.nodestream,"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="),Jt={encode:function(e){for(var t,i,r,n,o,s,a,l=[],c=0,u=e.length,h=u,d="string"!==or.getTypeOf(e);c<e.length;)h=u-c,d?(t=e[c++],i=c<u?e[c++]:0,r=c<u?e[c++]:0):(t=e.charCodeAt(c++),i=c<u?e.charCodeAt(c++):0,r=c<u?e.charCodeAt(c++):0),n=t>>2,o=(3&t)<<4|i>>4,s=h>1?(15&i)<<2|r>>6:64,a=h>2?63&r:64,l.push(Yt.charAt(n)+Yt.charAt(o)+Yt.charAt(s)+Yt.charAt(a));return l.join("")},decode:function(e){var t,i,r,n,o,s,a=0,l=0;if("data:"===e.substr(0,5))throw new Error("Invalid base64 input, it looks like a data url.");var c,u=3*(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"")).length/4;if(e.charAt(e.length-1)===Yt.charAt(64)&&u--,e.charAt(e.length-2)===Yt.charAt(64)&&u--,u%1!=0)throw new Error("Invalid base64 input, bad content length.");for(c=Xt.uint8array?new Uint8Array(0|u):new Array(0|u);a<e.length;)t=Yt.indexOf(e.charAt(a++))<<2|(n=Yt.indexOf(e.charAt(a++)))>>4,i=(15&n)<<4|(o=Yt.indexOf(e.charAt(a++)))>>2,r=(3&o)<<6|(s=Yt.indexOf(e.charAt(a++))),c[l++]=t,64!==o&&(c[l++]=i),64!==s&&(c[l++]=r);return c}},ei=function(e,t){return new E(e,t)},ti=function(e){return E.alloc?E.alloc(e):new E(e)},ii=function(e){return ue(e)},ri=function(e){return e&&"function"==typeof e.on&&"function"==typeof e.pause&&"function"==typeof e.resume},ni=e.createCommonjsModule((function(e){var t=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=t)})),oi=e.createCommonjsModule((function(e){var t=e.exports={version:"2.3.0"};"number"==typeof __e&&(__e=t)})),si=(oi.version,function(e,t,i){if(function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!")}(e),void 0===t)return e;switch(i){case 1:return function(i){return e.call(t,i)};case 2:return function(i,r){return e.call(t,i,r)};case 3:return function(i,r,n){return e.call(t,i,r,n)}}return function(){return e.apply(t,arguments)}}),ai=function(e){return"object"==typeof e?null!==e:"function"==typeof e},li=function(e){if(!ai(e))throw TypeError(e+" is not an object!");return e},ci=function(e){try{return!!e()}catch(e){return!0}},ui=!ci((function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})),hi=ni.document,di=ai(hi)&&ai(hi.createElement),pi=function(e){return di?hi.createElement(e):{}},fi=!ui&&!ci((function(){return 7!=Object.defineProperty(pi("div"),"a",{get:function(){return 7}}).a})),Ai=Object.defineProperty,mi={f:ui?Object.defineProperty:function(e,t,i){if(li(e),t=function(e,t){if(!ai(e))return e;var i,r;if(t&&"function"==typeof(i=e.toString)&&!ai(r=i.call(e)))return r;if("function"==typeof(i=e.valueOf)&&!ai(r=i.call(e)))return r;if(!t&&"function"==typeof(i=e.toString)&&!ai(r=i.call(e)))return r;throw TypeError("Can't convert object to primitive value")}(t,!0),li(i),fi)try{return Ai(e,t,i)}catch(e){}if("get"in i||"set"in i)throw TypeError("Accessors not supported!");return"value"in i&&(e[t]=i.value),e}},gi=ui?function(e,t,i){return mi.f(e,t,function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}(1,i))}:function(e,t,i){return e[t]=i,e},_i=function(e,t,i){var r,n,o,s=e&_i.F,a=e&_i.G,l=e&_i.S,c=e&_i.P,u=e&_i.B,h=e&_i.W,d=a?oi:oi[t]||(oi[t]={}),p=d.prototype,f=a?ni:l?ni[t]:(ni[t]||{}).prototype;for(r in a&&(i=t),i)(n=!s&&f&&void 0!==f[r])&&r in d||(o=n?f[r]:i[r],d[r]=a&&"function"!=typeof f[r]?i[r]:u&&n?si(o,ni):h&&f[r]==o?function(e){var t=function(t,i,r){if(this instanceof e){switch(arguments.length){case 0:return new e;case 1:return new e(t);case 2:return new e(t,i)}return new e(t,i,r)}return e.apply(this,arguments)};return t.prototype=e.prototype,t}(o):c&&"function"==typeof o?si(Function.call,o):o,c&&((d.virtual||(d.virtual={}))[r]=o,e&_i.R&&p&&!p[r]&&gi(p,r,o)))};_i.F=1,_i.G=2,_i.S=4,_i.P=8,_i.B=16,_i.W=32,_i.U=64,_i.R=128;var yi,vi,xi,bi,wi=_i,Ti=ni.document&&document.documentElement,Bi={}.toString,Ci=ni.process,Si=ni.setImmediate,Ei=ni.clearImmediate,Mi=ni.MessageChannel,Ii=0,Pi={},Li=function(){var e=+this;if(Pi.hasOwnProperty(e)){var t=Pi[e];delete Pi[e],t()}},Fi=function(e){Li.call(e.data)};Si&&Ei||(Si=function(e){for(var t=[],i=1;arguments.length>i;)t.push(arguments[i++]);return Pi[++Ii]=function(){!function(e,t,i){var r=void 0===i;switch(t.length){case 0:return r?e():e.call(i);case 1:return r?e(t[0]):e.call(i,t[0]);case 2:return r?e(t[0],t[1]):e.call(i,t[0],t[1]);case 3:return r?e(t[0],t[1],t[2]):e.call(i,t[0],t[1],t[2]);case 4:return r?e(t[0],t[1],t[2],t[3]):e.call(i,t[0],t[1],t[2],t[3])}e.apply(i,t)}("function"==typeof e?e:Function(e),t)},yi(Ii),Ii},Ei=function(e){delete Pi[e]},"process"==(bi=Ci,Bi.call(bi).slice(8,-1))?yi=function(e){Ci.nextTick(si(Li,e,1))}:Mi?(xi=(vi=new Mi).port2,vi.port1.onmessage=Fi,yi=si(xi.postMessage,xi,1)):ni.addEventListener&&"function"==typeof postMessage&&!ni.importScripts?(yi=function(e){ni.postMessage(e+"","*")},ni.addEventListener("message",Fi,!1)):yi="onreadystatechange"in pi("script")?function(e){Ti.appendChild(pi("script")).onreadystatechange=function(){Ti.removeChild(this),Li.call(e)}}:function(e){setTimeout(si(Li,e,1),0)});var ki={set:Si,clear:Ei};wi(wi.G+wi.B,{setImmediate:ki.set,clearImmediate:ki.clear});var zi,Ri,Di=oi.setImmediate,Oi=p.MutationObserver||p.WebKitMutationObserver;if(Oi){var Ui=0,Ni=new Oi(Hi),Qi=p.document.createTextNode("");Ni.observe(Qi,{characterData:!0}),zi=function(){Qi.data=Ui=++Ui%2}}else if(p.setImmediate||void 0===p.MessageChannel)zi="document"in p&&"onreadystatechange"in p.document.createElement("script")?function(){var e=p.document.createElement("script");e.onreadystatechange=function(){Hi(),e.onreadystatechange=null,e.parentNode.removeChild(e),e=null},p.document.documentElement.appendChild(e)}:function(){setTimeout(Hi,0)};else{var ji=new p.MessageChannel;ji.port1.onmessage=Hi,zi=function(){ji.port2.postMessage(0)}}var Vi=[];function Hi(){var e,t;Ri=!0;for(var i=Vi.length;i;){for(t=Vi,Vi=[],e=-1;++e<i;)t[e]();i=Vi.length}Ri=!1}var Gi=function(e){1!==Vi.push(e)||Ri||zi()};function $i(){}var Zi={},qi=["REJECTED"],Ki=["FULFILLED"],Wi=["PENDING"],Xi=Yi;function Yi(e){if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=Wi,this.queue=[],this.outcome=void 0,e!==$i&&ir(this,e)}function Ji(e,t,i){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof i&&(this.onRejected=i,this.callRejected=this.otherCallRejected)}function er(e,t,i){Gi((function(){var r;try{r=t(i)}catch(t){return Zi.reject(e,t)}r===e?Zi.reject(e,new TypeError("Cannot resolve promise with itself")):Zi.resolve(e,r)}))}function tr(e){var t=e&&e.then;if(e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof t)return function(){t.apply(e,arguments)}}function ir(e,t){var i=!1;function r(t){i||(i=!0,Zi.reject(e,t))}function n(t){i||(i=!0,Zi.resolve(e,t))}var o=rr((function(){t(n,r)}));"error"===o.status&&r(o.value)}function rr(e,t){var i={};try{i.value=e(t),i.status="success"}catch(e){i.status="error",i.value=e}return i}Yi.prototype.catch=function(e){return this.then(null,e)},Yi.prototype.then=function(e,t){if("function"!=typeof e&&this.state===Ki||"function"!=typeof t&&this.state===qi)return this;var i=new this.constructor($i);return this.state!==Wi?er(i,this.state===Ki?e:t,this.outcome):this.queue.push(new Ji(i,e,t)),i},Ji.prototype.callFulfilled=function(e){Zi.resolve(this.promise,e)},Ji.prototype.otherCallFulfilled=function(e){er(this.promise,this.onFulfilled,e)},Ji.prototype.callRejected=function(e){Zi.reject(this.promise,e)},Ji.prototype.otherCallRejected=function(e){er(this.promise,this.onRejected,e)},Zi.resolve=function(e,t){var i=rr(tr,t);if("error"===i.status)return Zi.reject(e,i.value);var r=i.value;if(r)ir(e,r);else{e.state=Ki,e.outcome=t;for(var n=-1,o=e.queue.length;++n<o;)e.queue[n].callFulfilled(t)}return e},Zi.reject=function(e,t){e.state=qi,e.outcome=t;for(var i=-1,r=e.queue.length;++i<r;)e.queue[i].callRejected(t);return e},Yi.resolve=function(e){return e instanceof this?e:Zi.resolve(new this($i),e)},Yi.reject=function(e){var t=new this($i);return Zi.reject(t,e)},Yi.all=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var i=e.length,r=!1;if(!i)return this.resolve([]);for(var n=new Array(i),o=0,s=-1,a=new this($i);++s<i;)l(e[s],s);return a;function l(e,s){t.resolve(e).then((function(e){n[s]=e,++o!==i||r||(r=!0,Zi.resolve(a,n))}),(function(e){r||(r=!0,Zi.reject(a,e))}))}},Yi.race=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var i=e.length,r=!1;if(!i)return this.resolve([]);for(var n,o=-1,s=new this($i);++o<i;)n=e[o],t.resolve(n).then((function(e){r||(r=!0,Zi.resolve(s,e))}),(function(e){r||(r=!0,Zi.reject(s,e))}));return s};var nr={Promise:"undefined"!=typeof Promise?Promise:Xi},or=e.createCommonjsModule((function(e,t){function i(e){return e}function r(e,t){for(var i=0;i<e.length;++i)t[i]=255&e.charCodeAt(i);return t}t.newBlob=function(e,i){t.checkSupport("blob");try{return new Blob([e],{type:i})}catch(t){try{var r=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return r.append(e),r.getBlob(i)}catch(e){throw new Error("Bug : can't construct the Blob.")}}};var n={stringifyByChunk:function(e,t,i){var r=[],n=0,o=e.length;if(o<=i)return String.fromCharCode.apply(null,e);for(;n<o;)"array"===t||"nodebuffer"===t?r.push(String.fromCharCode.apply(null,e.slice(n,Math.min(n+i,o)))):r.push(String.fromCharCode.apply(null,e.subarray(n,Math.min(n+i,o)))),n+=i;return r.join("")},stringifyByChar:function(e){for(var t="",i=0;i<e.length;i++)t+=String.fromCharCode(e[i]);return t},applyCanBeUsed:{uint8array:function(){try{return Xt.uint8array&&1===String.fromCharCode.apply(null,new Uint8Array(1)).length}catch(e){return!1}}(),nodebuffer:function(){try{return Xt.nodebuffer&&1===String.fromCharCode.apply(null,ti(1)).length}catch(e){return!1}}()}};function o(e){var i=65536,r=t.getTypeOf(e),o=!0;if("uint8array"===r?o=n.applyCanBeUsed.uint8array:"nodebuffer"===r&&(o=n.applyCanBeUsed.nodebuffer),o)for(;i>1;)try{return n.stringifyByChunk(e,r,i)}catch(e){i=Math.floor(i/2)}return n.stringifyByChar(e)}function s(e,t){for(var i=0;i<e.length;i++)t[i]=e[i];return t}t.applyFromCharCode=o;var a={};a.string={string:i,array:function(e){return r(e,new Array(e.length))},arraybuffer:function(e){return a.string.uint8array(e).buffer},uint8array:function(e){return r(e,new Uint8Array(e.length))},nodebuffer:function(e){return r(e,ti(e.length))}},a.array={string:o,array:i,arraybuffer:function(e){return new Uint8Array(e).buffer},uint8array:function(e){return new Uint8Array(e)},nodebuffer:function(e){return ei(e)}},a.arraybuffer={string:function(e){return o(new Uint8Array(e))},array:function(e){return s(new Uint8Array(e),new Array(e.byteLength))},arraybuffer:i,uint8array:function(e){return new Uint8Array(e)},nodebuffer:function(e){return ei(new Uint8Array(e))}},a.uint8array={string:o,array:function(e){return s(e,new Array(e.length))},arraybuffer:function(e){return e.buffer},uint8array:i,nodebuffer:function(e){return ei(e)}},a.nodebuffer={string:o,array:function(e){return s(e,new Array(e.length))},arraybuffer:function(e){return a.nodebuffer.uint8array(e).buffer},uint8array:function(e){return s(e,new Uint8Array(e.length))},nodebuffer:i},t.transformTo=function(e,i){if(i||(i=""),!e)return i;t.checkSupport(e);var r=t.getTypeOf(i);return a[r][e](i)},t.getTypeOf=function(e){return"string"==typeof e?"string":"[object Array]"===Object.prototype.toString.call(e)?"array":Xt.nodebuffer&&ii(e)?"nodebuffer":Xt.uint8array&&e instanceof Uint8Array?"uint8array":Xt.arraybuffer&&e instanceof ArrayBuffer?"arraybuffer":void 0},t.checkSupport=function(e){if(!Xt[e.toLowerCase()])throw new Error(e+" is not supported by this platform")},t.MAX_VALUE_16BITS=65535,t.MAX_VALUE_32BITS=-1,t.pretty=function(e){var t,i,r="";for(i=0;i<(e||"").length;i++)r+="\\x"+((t=e.charCodeAt(i))<16?"0":"")+t.toString(16).toUpperCase();return r},t.delay=function(e,t,i){Di((function(){e.apply(i||null,t||[])}))},t.inherits=function(e,t){var i=function(){};i.prototype=t.prototype,e.prototype=new i},t.extend=function(){var e,t,i={};for(e=0;e<arguments.length;e++)for(t in arguments[e])arguments[e].hasOwnProperty(t)&&void 0===i[t]&&(i[t]=arguments[e][t]);return i},t.prepareContent=function(e,i,n,o,s){return nr.Promise.resolve(i).then((function(e){return Xt.blob&&(e instanceof Blob||-1!==["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(e)))&&"undefined"!=typeof FileReader?new nr.Promise((function(t,i){var r=new FileReader;r.onload=function(e){t(e.target.result)},r.onerror=function(e){i(e.target.error)},r.readAsArrayBuffer(e)})):e})).then((function(i){var a,l=t.getTypeOf(i);return l?("arraybuffer"===l?i=t.transformTo("uint8array",i):"string"===l&&(s?i=Jt.decode(i):n&&!0!==o&&(i=r(a=i,Xt.uint8array?new Uint8Array(a.length):new Array(a.length)))),i):nr.Promise.reject(new Error("Can't read the data of '"+e+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))}))}}));function sr(e){this.name=e||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}or.newBlob,or.applyFromCharCode,or.transformTo,or.getTypeOf,or.checkSupport,or.MAX_VALUE_16BITS,or.MAX_VALUE_32BITS,or.pretty,or.delay,or.inherits,or.extend,or.prepareContent,sr.prototype={push:function(e){this.emit("data",e)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(e){this.emit("error",e)}return!0},error:function(e){return!this.isFinished&&(this.isPaused?this.generatedError=e:(this.isFinished=!0,this.emit("error",e),this.previous&&this.previous.error(e),this.cleanUp()),!0)},on:function(e,t){return this._listeners[e].push(t),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(e,t){if(this._listeners[e])for(var i=0;i<this._listeners[e].length;i++)this._listeners[e][i].call(this,t)},pipe:function(e){return e.registerPrevious(this)},registerPrevious:function(e){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=e.streamInfo,this.mergeStreamInfo(),this.previous=e;var t=this;return e.on("data",(function(e){t.processChunk(e)})),e.on("end",(function(){t.end()})),e.on("error",(function(e){t.error(e)})),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;this.isPaused=!1;var e=!1;return this.generatedError&&(this.error(this.generatedError),e=!0),this.previous&&this.previous.resume(),!e},flush:function(){},processChunk:function(e){this.push(e)},withStreamInfo:function(e,t){return this.extraStreamInfo[e]=t,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var e in this.extraStreamInfo)this.extraStreamInfo.hasOwnProperty(e)&&(this.streamInfo[e]=this.extraStreamInfo[e])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var e="Worker "+this.name;return this.previous?this.previous+" -> "+e:e}};var ar=sr,lr=e.createCommonjsModule((function(e,t){for(var i=new Array(256),r=0;r<256;r++)i[r]=r>=252?6:r>=248?5:r>=240?4:r>=224?3:r>=192?2:1;function n(){ar.call(this,"utf-8 decode"),this.leftOver=null}function o(){ar.call(this,"utf-8 encode")}i[254]=i[254]=1,t.utf8encode=function(e){return Xt.nodebuffer?ei(e,"utf-8"):function(e){var t,i,r,n,o,s=e.length,a=0;for(n=0;n<s;n++)55296==(64512&(i=e.charCodeAt(n)))&&n+1<s&&56320==(64512&(r=e.charCodeAt(n+1)))&&(i=65536+(i-55296<<10)+(r-56320),n++),a+=i<128?1:i<2048?2:i<65536?3:4;for(t=Xt.uint8array?new Uint8Array(a):new Array(a),o=0,n=0;o<a;n++)55296==(64512&(i=e.charCodeAt(n)))&&n+1<s&&56320==(64512&(r=e.charCodeAt(n+1)))&&(i=65536+(i-55296<<10)+(r-56320),n++),i<128?t[o++]=i:i<2048?(t[o++]=192|i>>>6,t[o++]=128|63&i):i<65536?(t[o++]=224|i>>>12,t[o++]=128|i>>>6&63,t[o++]=128|63&i):(t[o++]=240|i>>>18,t[o++]=128|i>>>12&63,t[o++]=128|i>>>6&63,t[o++]=128|63&i);return t}(e)},t.utf8decode=function(e){return Xt.nodebuffer?or.transformTo("nodebuffer",e).toString("utf-8"):function(e){var t,r,n,o,s=e.length,a=new Array(2*s);for(r=0,t=0;t<s;)if((n=e[t++])<128)a[r++]=n;else if((o=i[n])>4)a[r++]=65533,t+=o-1;else{for(n&=2===o?31:3===o?15:7;o>1&&t<s;)n=n<<6|63&e[t++],o--;o>1?a[r++]=65533:n<65536?a[r++]=n:(n-=65536,a[r++]=55296|n>>10&1023,a[r++]=56320|1023&n)}return a.length!==r&&(a.subarray?a=a.subarray(0,r):a.length=r),or.applyFromCharCode(a)}(e=or.transformTo(Xt.uint8array?"uint8array":"array",e))},or.inherits(n,ar),n.prototype.processChunk=function(e){var r=or.transformTo(Xt.uint8array?"uint8array":"array",e.data);if(this.leftOver&&this.leftOver.length){if(Xt.uint8array){var n=r;(r=new Uint8Array(n.length+this.leftOver.length)).set(this.leftOver,0),r.set(n,this.leftOver.length)}else r=this.leftOver.concat(r);this.leftOver=null}var o=function(e,t){var r;for((t=t||e.length)>e.length&&(t=e.length),r=t-1;r>=0&&128==(192&e[r]);)r--;return r<0||0===r?t:r+i[e[r]]>t?r:t}(r),s=r;o!==r.length&&(Xt.uint8array?(s=r.subarray(0,o),this.leftOver=r.subarray(o,r.length)):(s=r.slice(0,o),this.leftOver=r.slice(o,r.length))),this.push({data:t.utf8decode(s),meta:e.meta})},n.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:t.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},t.Utf8DecodeWorker=n,or.inherits(o,ar),o.prototype.processChunk=function(e){this.push({data:t.utf8encode(e.data),meta:e.meta})},t.Utf8EncodeWorker=o}));function cr(e){ar.call(this,"ConvertWorker to "+e),this.destType=e}lr.utf8encode,lr.utf8decode,lr.Utf8DecodeWorker,lr.Utf8EncodeWorker,or.inherits(cr,ar),cr.prototype.processChunk=function(e){this.push({data:or.transformTo(this.destType,e.data),meta:e.meta})};var ur=cr,hr=Wt.Readable;function dr(e,t,i){hr.call(this,t),this._helper=e;var r=this;e.on("data",(function(e,t){r.push(e)||r._helper.pause(),i&&i(t)})).on("error",(function(e){r.emit("error",e)})).on("end",(function(){r.push(null)}))}or.inherits(dr,hr),dr.prototype._read=function(){this._helper.resume()};var pr=dr,fr=null;if(Xt.nodestream)try{fr=pr}catch(e){}function Ar(e,t){return new nr.Promise((function(i,r){var n=[],o=e._internalType,s=e._outputType,a=e._mimeType;e.on("data",(function(e,i){n.push(e),t&&t(i)})).on("error",(function(e){n=[],r(e)})).on("end",(function(){try{var e=function(e,t,i){switch(e){case"blob":return or.newBlob(or.transformTo("arraybuffer",t),i);case"base64":return Jt.encode(t);default:return or.transformTo(e,t)}}(s,function(e,t){var i,r=0,n=null,o=0;for(i=0;i<t.length;i++)o+=t[i].length;switch(e){case"string":return t.join("");case"array":return Array.prototype.concat.apply([],t);case"uint8array":for(n=new Uint8Array(o),i=0;i<t.length;i++)n.set(t[i],r),r+=t[i].length;return n;case"nodebuffer":return E.concat(t);default:throw new Error("concat : unsupported type '"+e+"'")}}(o,n),a);i(e)}catch(e){r(e)}n=[]})).resume()}))}function mr(e,t,i){var r=t;switch(t){case"blob":case"arraybuffer":r="uint8array";break;case"base64":r="string"}try{this._internalType=r,this._outputType=t,this._mimeType=i,or.checkSupport(r),this._worker=e.pipe(new ur(r)),e.lock()}catch(e){this._worker=new ar("error"),this._worker.error(e)}}mr.prototype={accumulate:function(e){return Ar(this,e)},on:function(e,t){var i=this;return"data"===e?this._worker.on(e,(function(e){t.call(i,e.data,e.meta)})):this._worker.on(e,(function(){or.delay(t,arguments,i)})),this},resume:function(){return or.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(e){if(or.checkSupport("nodestream"),"nodebuffer"!==this._outputType)throw new Error(this._outputType+" is not supported by this method");return new fr(this,{objectMode:"nodebuffer"!==this._outputType},e)}};var gr=mr,_r={base64:!1,binary:!1,dir:!1,createFolders:!0,date:null,compression:null,compressionOptions:null,comment:null,unixPermissions:null,dosPermissions:null};function yr(e){ar.call(this,"DataWorker");var t=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,e.then((function(e){t.dataIsReady=!0,t.data=e,t.max=e&&e.length||0,t.type=or.getTypeOf(e),t.isPaused||t._tickAndRepeat()}),(function(e){t.error(e)}))}or.inherits(yr,ar),yr.prototype.cleanUp=function(){ar.prototype.cleanUp.call(this),this.data=null},yr.prototype.resume=function(){return!!ar.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,or.delay(this._tickAndRepeat,[],this)),!0)},yr.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(or.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},yr.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var e=null,t=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":e=this.data.substring(this.index,t);break;case"uint8array":e=this.data.subarray(this.index,t);break;case"array":case"nodebuffer":e=this.data.slice(this.index,t)}return this.index=t,this.push({data:e,meta:{percent:this.max?this.index/this.max*100:0}})};var vr=yr;function xr(e){ar.call(this,"DataLengthProbe for "+e),this.propName=e,this.withStreamInfo(e,0)}or.inherits(xr,ar),xr.prototype.processChunk=function(e){if(e){var t=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=t+e.data.length}ar.prototype.processChunk.call(this,e)};var br=xr,wr=function(){for(var e,t=[],i=0;i<256;i++){e=i;for(var r=0;r<8;r++)e=1&e?3988292384^e>>>1:e>>>1;t[i]=e}return t}(),Tr=function(e,t){return void 0!==e&&e.length?"string"!==or.getTypeOf(e)?function(e,t,i,r){var n=wr,o=r+i;e^=-1;for(var s=r;s<o;s++)e=e>>>8^n[255&(e^t[s])];return~e}(0|t,e,e.length,0):function(e,t,i,r){var n=wr,o=r+i;e^=-1;for(var s=r;s<o;s++)e=e>>>8^n[255&(e^t.charCodeAt(s))];return~e}(0|t,e,e.length,0):0};function Br(){ar.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}or.inherits(Br,ar),Br.prototype.processChunk=function(e){this.streamInfo.crc32=Tr(e.data,this.streamInfo.crc32||0),this.push(e)};var Cr=Br;function Sr(e,t,i,r,n){this.compressedSize=e,this.uncompressedSize=t,this.crc32=i,this.compression=r,this.compressedContent=n}Sr.prototype={getContentWorker:function(){var e=new vr(nr.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new br("data_length")),t=this;return e.on("end",(function(){if(this.streamInfo.data_length!==t.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")})),e},getCompressedWorker:function(){return new vr(nr.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},Sr.createWorkerFrom=function(e,t,i){return e.pipe(new Cr).pipe(new br("uncompressedSize")).pipe(t.compressWorker(i)).pipe(new br("compressedSize")).withStreamInfo("compression",t)};var Er=Sr,Mr=function(e,t,i){this.name=e,this.dir=i.dir,this.date=i.date,this.comment=i.comment,this.unixPermissions=i.unixPermissions,this.dosPermissions=i.dosPermissions,this._data=t,this._dataBinary=i.binary,this.options={compression:i.compression,compressionOptions:i.compressionOptions}};Mr.prototype={internalStream:function(e){var t=null,i="string";try{if(!e)throw new Error("No output type specified.");var r="string"===(i=e.toLowerCase())||"text"===i;"binarystring"!==i&&"text"!==i||(i="string"),t=this._decompressWorker();var n=!this._dataBinary;n&&!r&&(t=t.pipe(new lr.Utf8EncodeWorker)),!n&&r&&(t=t.pipe(new lr.Utf8DecodeWorker))}catch(e){(t=new ar("error")).error(e)}return new gr(t,i,"")},async:function(e,t){return this.internalStream(e).accumulate(t)},nodeStream:function(e,t){return this.internalStream(e||"nodebuffer").toNodejsStream(t)},_compressWorker:function(e,t){if(this._data instanceof Er&&this._data.compression.magic===e.magic)return this._data.getCompressedWorker();var i=this._decompressWorker();return this._dataBinary||(i=i.pipe(new lr.Utf8EncodeWorker)),Er.createWorkerFrom(i,e,t)},_decompressWorker:function(){return this._data instanceof Er?this._data.getContentWorker():this._data instanceof ar?this._data:new vr(this._data)}};for(var Ir=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],Pr=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},Lr=0;Lr<Ir.length;Lr++)Mr.prototype[Ir[Lr]]=Pr;var Fr=Mr,kr=e.createCommonjsModule((function(e,t){var i="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;function r(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var i=t.shift();if(i){if("object"!=typeof i)throw new TypeError(i+"must be non-object");for(var n in i)r(i,n)&&(e[n]=i[n])}}return e},t.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var n={arraySet:function(e,t,i,r,n){if(t.subarray&&e.subarray)e.set(t.subarray(i,i+r),n);else for(var o=0;o<r;o++)e[n+o]=t[i+o]},flattenChunks:function(e){var t,i,r,n,o,s;for(r=0,t=0,i=e.length;t<i;t++)r+=e[t].length;for(s=new Uint8Array(r),n=0,t=0,i=e.length;t<i;t++)o=e[t],s.set(o,n),n+=o.length;return s}},o={arraySet:function(e,t,i,r,n){for(var o=0;o<r;o++)e[n+o]=t[i+o]},flattenChunks:function(e){return[].concat.apply([],e)}};t.setTyped=function(e){e?(t.Buf8=Uint8Array,t.Buf16=Uint16Array,t.Buf32=Int32Array,t.assign(t,n)):(t.Buf8=Array,t.Buf16=Array,t.Buf32=Array,t.assign(t,o))},t.setTyped(i)})),zr=(kr.assign,kr.shrinkBuf,kr.setTyped,kr.Buf8,kr.Buf16,kr.Buf32,4),Rr=0,Dr=1,Or=2;function Ur(e){for(var t=e.length;--t>=0;)e[t]=0}var Nr=0,Qr=1,jr=2,Vr=29,Hr=256,Gr=Hr+1+Vr,$r=30,Zr=19,qr=2*Gr+1,Kr=15,Wr=16,Xr=7,Yr=256,Jr=16,en=17,tn=18,rn=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],nn=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],on=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],sn=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],an=new Array(2*(Gr+2));Ur(an);var ln=new Array(2*$r);Ur(ln);var cn=new Array(512);Ur(cn);var un=new Array(256);Ur(un);var hn=new Array(Vr);Ur(hn);var dn,pn,fn,An=new Array($r);function mn(e,t,i,r,n){this.static_tree=e,this.extra_bits=t,this.extra_base=i,this.elems=r,this.max_length=n,this.has_stree=e&&e.length}function gn(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function _n(e){return e<256?cn[e]:cn[256+(e>>>7)]}function yn(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function vn(e,t,i){e.bi_valid>Wr-i?(e.bi_buf|=t<<e.bi_valid&65535,yn(e,e.bi_buf),e.bi_buf=t>>Wr-e.bi_valid,e.bi_valid+=i-Wr):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=i)}function xn(e,t,i){vn(e,i[2*t],i[2*t+1])}function bn(e,t){var i=0;do{i|=1&e,e>>>=1,i<<=1}while(--t>0);return i>>>1}function wn(e,t,i){var r,n,o=new Array(Kr+1),s=0;for(r=1;r<=Kr;r++)o[r]=s=s+i[r-1]<<1;for(n=0;n<=t;n++){var a=e[2*n+1];0!==a&&(e[2*n]=bn(o[a]++,a))}}function Tn(e){var t;for(t=0;t<Gr;t++)e.dyn_ltree[2*t]=0;for(t=0;t<$r;t++)e.dyn_dtree[2*t]=0;for(t=0;t<Zr;t++)e.bl_tree[2*t]=0;e.dyn_ltree[2*Yr]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function Bn(e){e.bi_valid>8?yn(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function Cn(e,t,i,r){var n=2*t,o=2*i;return e[n]<e[o]||e[n]===e[o]&&r[t]<=r[i]}function Sn(e,t,i){for(var r=e.heap[i],n=i<<1;n<=e.heap_len&&(n<e.heap_len&&Cn(t,e.heap[n+1],e.heap[n],e.depth)&&n++,!Cn(t,r,e.heap[n],e.depth));)e.heap[i]=e.heap[n],i=n,n<<=1;e.heap[i]=r}function En(e,t,i){var r,n,o,s,a=0;if(0!==e.last_lit)do{r=e.pending_buf[e.d_buf+2*a]<<8|e.pending_buf[e.d_buf+2*a+1],n=e.pending_buf[e.l_buf+a],a++,0===r?xn(e,n,t):(xn(e,(o=un[n])+Hr+1,t),0!==(s=rn[o])&&vn(e,n-=hn[o],s),xn(e,o=_n(--r),i),0!==(s=nn[o])&&vn(e,r-=An[o],s))}while(a<e.last_lit);xn(e,Yr,t)}function Mn(e,t){var i,r,n,o=t.dyn_tree,s=t.stat_desc.static_tree,a=t.stat_desc.has_stree,l=t.stat_desc.elems,c=-1;for(e.heap_len=0,e.heap_max=qr,i=0;i<l;i++)0!==o[2*i]?(e.heap[++e.heap_len]=c=i,e.depth[i]=0):o[2*i+1]=0;for(;e.heap_len<2;)o[2*(n=e.heap[++e.heap_len]=c<2?++c:0)]=1,e.depth[n]=0,e.opt_len--,a&&(e.static_len-=s[2*n+1]);for(t.max_code=c,i=e.heap_len>>1;i>=1;i--)Sn(e,o,i);n=l;do{i=e.heap[1],e.heap[1]=e.heap[e.heap_len--],Sn(e,o,1),r=e.heap[1],e.heap[--e.heap_max]=i,e.heap[--e.heap_max]=r,o[2*n]=o[2*i]+o[2*r],e.depth[n]=(e.depth[i]>=e.depth[r]?e.depth[i]:e.depth[r])+1,o[2*i+1]=o[2*r+1]=n,e.heap[1]=n++,Sn(e,o,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],function(e,t){var i,r,n,o,s,a,l=t.dyn_tree,c=t.max_code,u=t.stat_desc.static_tree,h=t.stat_desc.has_stree,d=t.stat_desc.extra_bits,p=t.stat_desc.extra_base,f=t.stat_desc.max_length,A=0;for(o=0;o<=Kr;o++)e.bl_count[o]=0;for(l[2*e.heap[e.heap_max]+1]=0,i=e.heap_max+1;i<qr;i++)(o=l[2*l[2*(r=e.heap[i])+1]+1]+1)>f&&(o=f,A++),l[2*r+1]=o,r>c||(e.bl_count[o]++,s=0,r>=p&&(s=d[r-p]),a=l[2*r],e.opt_len+=a*(o+s),h&&(e.static_len+=a*(u[2*r+1]+s)));if(0!==A){do{for(o=f-1;0===e.bl_count[o];)o--;e.bl_count[o]--,e.bl_count[o+1]+=2,e.bl_count[f]--,A-=2}while(A>0);for(o=f;0!==o;o--)for(r=e.bl_count[o];0!==r;)(n=e.heap[--i])>c||(l[2*n+1]!==o&&(e.opt_len+=(o-l[2*n+1])*l[2*n],l[2*n+1]=o),r--)}}(e,t),wn(o,c,e.bl_count)}function In(e,t,i){var r,n,o=-1,s=t[1],a=0,l=7,c=4;for(0===s&&(l=138,c=3),t[2*(i+1)+1]=65535,r=0;r<=i;r++)n=s,s=t[2*(r+1)+1],++a<l&&n===s||(a<c?e.bl_tree[2*n]+=a:0!==n?(n!==o&&e.bl_tree[2*n]++,e.bl_tree[2*Jr]++):a<=10?e.bl_tree[2*en]++:e.bl_tree[2*tn]++,a=0,o=n,0===s?(l=138,c=3):n===s?(l=6,c=3):(l=7,c=4))}function Pn(e,t,i){var r,n,o=-1,s=t[1],a=0,l=7,c=4;for(0===s&&(l=138,c=3),r=0;r<=i;r++)if(n=s,s=t[2*(r+1)+1],!(++a<l&&n===s)){if(a<c)do{xn(e,n,e.bl_tree)}while(0!=--a);else 0!==n?(n!==o&&(xn(e,n,e.bl_tree),a--),xn(e,Jr,e.bl_tree),vn(e,a-3,2)):a<=10?(xn(e,en,e.bl_tree),vn(e,a-3,3)):(xn(e,tn,e.bl_tree),vn(e,a-11,7));a=0,o=n,0===s?(l=138,c=3):n===s?(l=6,c=3):(l=7,c=4)}}Ur(An);var Ln=!1;function Fn(e,t,i,r){vn(e,(Nr<<1)+(r?1:0),3),function(e,t,i,r){Bn(e),r&&(yn(e,i),yn(e,~i)),kr.arraySet(e.pending_buf,e.window,t,i,e.pending),e.pending+=i}(e,t,i,!0)}var kn,zn={_tr_init:function(e){Ln||(function(){var e,t,i,r,n,o=new Array(Kr+1);for(i=0,r=0;r<Vr-1;r++)for(hn[r]=i,e=0;e<1<<rn[r];e++)un[i++]=r;for(un[i-1]=r,n=0,r=0;r<16;r++)for(An[r]=n,e=0;e<1<<nn[r];e++)cn[n++]=r;for(n>>=7;r<$r;r++)for(An[r]=n<<7,e=0;e<1<<nn[r]-7;e++)cn[256+n++]=r;for(t=0;t<=Kr;t++)o[t]=0;for(e=0;e<=143;)an[2*e+1]=8,e++,o[8]++;for(;e<=255;)an[2*e+1]=9,e++,o[9]++;for(;e<=279;)an[2*e+1]=7,e++,o[7]++;for(;e<=287;)an[2*e+1]=8,e++,o[8]++;for(wn(an,Gr+1,o),e=0;e<$r;e++)ln[2*e+1]=5,ln[2*e]=bn(e,5);dn=new mn(an,rn,Hr+1,Gr,Kr),pn=new mn(ln,nn,0,$r,Kr),fn=new mn(new Array(0),on,0,Zr,Xr)}(),Ln=!0),e.l_desc=new gn(e.dyn_ltree,dn),e.d_desc=new gn(e.dyn_dtree,pn),e.bl_desc=new gn(e.bl_tree,fn),e.bi_buf=0,e.bi_valid=0,Tn(e)},_tr_stored_block:Fn,_tr_flush_block:function(e,t,i,r){var n,o,s=0;e.level>0?(e.strm.data_type===Or&&(e.strm.data_type=function(e){var t,i=4093624447;for(t=0;t<=31;t++,i>>>=1)if(1&i&&0!==e.dyn_ltree[2*t])return Rr;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return Dr;for(t=32;t<Hr;t++)if(0!==e.dyn_ltree[2*t])return Dr;return Rr}(e)),Mn(e,e.l_desc),Mn(e,e.d_desc),s=function(e){var t;for(In(e,e.dyn_ltree,e.l_desc.max_code),In(e,e.dyn_dtree,e.d_desc.max_code),Mn(e,e.bl_desc),t=Zr-1;t>=3&&0===e.bl_tree[2*sn[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}(e),n=e.opt_len+3+7>>>3,(o=e.static_len+3+7>>>3)<=n&&(n=o)):n=o=i+5,i+4<=n&&-1!==t?Fn(e,t,i,r):e.strategy===zr||o===n?(vn(e,(Qr<<1)+(r?1:0),3),En(e,an,ln)):(vn(e,(jr<<1)+(r?1:0),3),function(e,t,i,r){var n;for(vn(e,t-257,5),vn(e,i-1,5),vn(e,r-4,4),n=0;n<r;n++)vn(e,e.bl_tree[2*sn[n]+1],3);Pn(e,e.dyn_ltree,t-1),Pn(e,e.dyn_dtree,i-1)}(e,e.l_desc.max_code+1,e.d_desc.max_code+1,s+1),En(e,e.dyn_ltree,e.dyn_dtree)),Tn(e),r&&Bn(e)},_tr_tally:function(e,t,i){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&i,e.last_lit++,0===t?e.dyn_ltree[2*i]++:(e.matches++,t--,e.dyn_ltree[2*(un[i]+Hr+1)]++,e.dyn_dtree[2*_n(t)]++),e.last_lit===e.lit_bufsize-1},_tr_align:function(e){vn(e,Qr<<1,3),xn(e,Yr,an),function(e){16===e.bi_valid?(yn(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}(e)}},Rn=function(e,t,i,r){for(var n=65535&e,o=e>>>16&65535,s=0;0!==i;){i-=s=i>2e3?2e3:i;do{o=o+(n=n+t[r++]|0)|0}while(--s);n%=65521,o%=65521}return n|o<<16},Dn=function(){for(var e,t=[],i=0;i<256;i++){e=i;for(var r=0;r<8;r++)e=1&e?3988292384^e>>>1:e>>>1;t[i]=e}return t}(),On=function(e,t,i,r){var n=Dn,o=r+i;e^=-1;for(var s=r;s<o;s++)e=e>>>8^n[255&(e^t[s])];return~e},Un={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},Nn=0,Qn=1,jn=3,Vn=4,Hn=5,Gn=0,$n=1,Zn=-2,qn=-3,Kn=-5,Wn=-1,Xn=1,Yn=2,Jn=3,eo=4,to=0,io=2,ro=8,no=9,oo=15,so=8,ao=286,lo=30,co=19,uo=2*ao+1,ho=15,po=3,fo=258,Ao=fo+po+1,mo=32,go=42,_o=69,yo=73,vo=91,xo=103,bo=113,wo=666,To=1,Bo=2,Co=3,So=4,Eo=3;function Mo(e,t){return e.msg=Un[t],t}function Io(e){return(e<<1)-(e>4?9:0)}function Po(e){for(var t=e.length;--t>=0;)e[t]=0}function Lo(e){var t=e.state,i=t.pending;i>e.avail_out&&(i=e.avail_out),0!==i&&(kr.arraySet(e.output,t.pending_buf,t.pending_out,i,e.next_out),e.next_out+=i,t.pending_out+=i,e.total_out+=i,e.avail_out-=i,t.pending-=i,0===t.pending&&(t.pending_out=0))}function Fo(e,t){zn._tr_flush_block(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,Lo(e.strm)}function ko(e,t){e.pending_buf[e.pending++]=t}function zo(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function Ro(e,t){var i,r,n=e.max_chain_length,o=e.strstart,s=e.prev_length,a=e.nice_match,l=e.strstart>e.w_size-Ao?e.strstart-(e.w_size-Ao):0,c=e.window,u=e.w_mask,h=e.prev,d=e.strstart+fo,p=c[o+s-1],f=c[o+s];e.prev_length>=e.good_match&&(n>>=2),a>e.lookahead&&(a=e.lookahead);do{if(c[(i=t)+s]===f&&c[i+s-1]===p&&c[i]===c[o]&&c[++i]===c[o+1]){o+=2,i++;do{}while(c[++o]===c[++i]&&c[++o]===c[++i]&&c[++o]===c[++i]&&c[++o]===c[++i]&&c[++o]===c[++i]&&c[++o]===c[++i]&&c[++o]===c[++i]&&c[++o]===c[++i]&&o<d);if(r=fo-(d-o),o=d-fo,r>s){if(e.match_start=t,s=r,r>=a)break;p=c[o+s-1],f=c[o+s]}}}while((t=h[t&u])>l&&0!=--n);return s<=e.lookahead?s:e.lookahead}function Do(e){var t,i,r,n,o,s,a,l,c,u,h=e.w_size;do{if(n=e.window_size-e.lookahead-e.strstart,e.strstart>=h+(h-Ao)){kr.arraySet(e.window,e.window,h,h,0),e.match_start-=h,e.strstart-=h,e.block_start-=h,t=i=e.hash_size;do{r=e.head[--t],e.head[t]=r>=h?r-h:0}while(--i);t=i=h;do{r=e.prev[--t],e.prev[t]=r>=h?r-h:0}while(--i);n+=h}if(0===e.strm.avail_in)break;if(s=e.strm,a=e.window,l=e.strstart+e.lookahead,c=n,u=void 0,(u=s.avail_in)>c&&(u=c),i=0===u?0:(s.avail_in-=u,kr.arraySet(a,s.input,s.next_in,u,l),1===s.state.wrap?s.adler=Rn(s.adler,a,u,l):2===s.state.wrap&&(s.adler=On(s.adler,a,u,l)),s.next_in+=u,s.total_in+=u,u),e.lookahead+=i,e.lookahead+e.insert>=po)for(o=e.strstart-e.insert,e.ins_h=e.window[o],e.ins_h=(e.ins_h<<e.hash_shift^e.window[o+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[o+po-1])&e.hash_mask,e.prev[o&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=o,o++,e.insert--,!(e.lookahead+e.insert<po)););}while(e.lookahead<Ao&&0!==e.strm.avail_in)}function Oo(e,t){for(var i,r;;){if(e.lookahead<Ao){if(Do(e),e.lookahead<Ao&&t===Nn)return To;if(0===e.lookahead)break}if(i=0,e.lookahead>=po&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+po-1])&e.hash_mask,i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==i&&e.strstart-i<=e.w_size-Ao&&(e.match_length=Ro(e,i)),e.match_length>=po)if(r=zn._tr_tally(e,e.strstart-e.match_start,e.match_length-po),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=po){e.match_length--;do{e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+po-1])&e.hash_mask,i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else r=zn._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(r&&(Fo(e,!1),0===e.strm.avail_out))return To}return e.insert=e.strstart<po-1?e.strstart:po-1,t===Vn?(Fo(e,!0),0===e.strm.avail_out?Co:So):e.last_lit&&(Fo(e,!1),0===e.strm.avail_out)?To:Bo}function Uo(e,t){for(var i,r,n;;){if(e.lookahead<Ao){if(Do(e),e.lookahead<Ao&&t===Nn)return To;if(0===e.lookahead)break}if(i=0,e.lookahead>=po&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+po-1])&e.hash_mask,i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=po-1,0!==i&&e.prev_length<e.max_lazy_match&&e.strstart-i<=e.w_size-Ao&&(e.match_length=Ro(e,i),e.match_length<=5&&(e.strategy===Xn||e.match_length===po&&e.strstart-e.match_start>4096)&&(e.match_length=po-1)),e.prev_length>=po&&e.match_length<=e.prev_length){n=e.strstart+e.lookahead-po,r=zn._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-po),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=n&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+po-1])&e.hash_mask,i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=po-1,e.strstart++,r&&(Fo(e,!1),0===e.strm.avail_out))return To}else if(e.match_available){if((r=zn._tr_tally(e,0,e.window[e.strstart-1]))&&Fo(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return To}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(r=zn._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<po-1?e.strstart:po-1,t===Vn?(Fo(e,!0),0===e.strm.avail_out?Co:So):e.last_lit&&(Fo(e,!1),0===e.strm.avail_out)?To:Bo}function No(e,t,i,r,n){this.good_length=e,this.max_lazy=t,this.nice_length=i,this.max_chain=r,this.func=n}function Qo(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=ro,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new kr.Buf16(2*uo),this.dyn_dtree=new kr.Buf16(2*(2*lo+1)),this.bl_tree=new kr.Buf16(2*(2*co+1)),Po(this.dyn_ltree),Po(this.dyn_dtree),Po(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new kr.Buf16(ho+1),this.heap=new kr.Buf16(2*ao+1),Po(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new kr.Buf16(2*ao+1),Po(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function jo(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=io,(t=e.state).pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?go:bo,e.adler=2===t.wrap?0:1,t.last_flush=Nn,zn._tr_init(t),Gn):Mo(e,Zn)}function Vo(e){var t,i=jo(e);return i===Gn&&((t=e.state).window_size=2*t.w_size,Po(t.head),t.max_lazy_match=kn[t.level].max_lazy,t.good_match=kn[t.level].good_length,t.nice_match=kn[t.level].nice_length,t.max_chain_length=kn[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=po-1,t.match_available=0,t.ins_h=0),i}function Ho(e,t,i,r,n,o){if(!e)return Zn;var s=1;if(t===Wn&&(t=6),r<0?(s=0,r=-r):r>15&&(s=2,r-=16),n<1||n>no||i!==ro||r<8||r>15||t<0||t>9||o<0||o>eo)return Mo(e,Zn);8===r&&(r=9);var a=new Qo;return e.state=a,a.strm=e,a.wrap=s,a.gzhead=null,a.w_bits=r,a.w_size=1<<a.w_bits,a.w_mask=a.w_size-1,a.hash_bits=n+7,a.hash_size=1<<a.hash_bits,a.hash_mask=a.hash_size-1,a.hash_shift=~~((a.hash_bits+po-1)/po),a.window=new kr.Buf8(2*a.w_size),a.head=new kr.Buf16(a.hash_size),a.prev=new kr.Buf16(a.w_size),a.lit_bufsize=1<<n+6,a.pending_buf_size=4*a.lit_bufsize,a.pending_buf=new kr.Buf8(a.pending_buf_size),a.d_buf=1*a.lit_bufsize,a.l_buf=3*a.lit_bufsize,a.level=t,a.strategy=o,a.method=i,Vo(e)}kn=[new No(0,0,0,0,(function(e,t){var i=65535;for(i>e.pending_buf_size-5&&(i=e.pending_buf_size-5);;){if(e.lookahead<=1){if(Do(e),0===e.lookahead&&t===Nn)return To;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var r=e.block_start+i;if((0===e.strstart||e.strstart>=r)&&(e.lookahead=e.strstart-r,e.strstart=r,Fo(e,!1),0===e.strm.avail_out))return To;if(e.strstart-e.block_start>=e.w_size-Ao&&(Fo(e,!1),0===e.strm.avail_out))return To}return e.insert=0,t===Vn?(Fo(e,!0),0===e.strm.avail_out?Co:So):(e.strstart>e.block_start&&(Fo(e,!1),e.strm.avail_out),To)})),new No(4,4,8,4,Oo),new No(4,5,16,8,Oo),new No(4,6,32,32,Oo),new No(4,4,16,16,Uo),new No(8,16,32,32,Uo),new No(8,16,128,128,Uo),new No(8,32,128,256,Uo),new No(32,128,258,1024,Uo),new No(32,258,258,4096,Uo)];var Go={deflateInit:function(e,t){return Ho(e,t,ro,oo,so,to)},deflateInit2:Ho,deflateReset:Vo,deflateResetKeep:jo,deflateSetHeader:function(e,t){return e&&e.state?2!==e.state.wrap?Zn:(e.state.gzhead=t,Gn):Zn},deflate:function(e,t){var i,r,n,o;if(!e||!e.state||t>Hn||t<0)return e?Mo(e,Zn):Zn;if(r=e.state,!e.output||!e.input&&0!==e.avail_in||r.status===wo&&t!==Vn)return Mo(e,0===e.avail_out?Kn:Zn);if(r.strm=e,i=r.last_flush,r.last_flush=t,r.status===go)if(2===r.wrap)e.adler=0,ko(r,31),ko(r,139),ko(r,8),r.gzhead?(ko(r,(r.gzhead.text?1:0)+(r.gzhead.hcrc?2:0)+(r.gzhead.extra?4:0)+(r.gzhead.name?8:0)+(r.gzhead.comment?16:0)),ko(r,255&r.gzhead.time),ko(r,r.gzhead.time>>8&255),ko(r,r.gzhead.time>>16&255),ko(r,r.gzhead.time>>24&255),ko(r,9===r.level?2:r.strategy>=Yn||r.level<2?4:0),ko(r,255&r.gzhead.os),r.gzhead.extra&&r.gzhead.extra.length&&(ko(r,255&r.gzhead.extra.length),ko(r,r.gzhead.extra.length>>8&255)),r.gzhead.hcrc&&(e.adler=On(e.adler,r.pending_buf,r.pending,0)),r.gzindex=0,r.status=_o):(ko(r,0),ko(r,0),ko(r,0),ko(r,0),ko(r,0),ko(r,9===r.level?2:r.strategy>=Yn||r.level<2?4:0),ko(r,Eo),r.status=bo);else{var s=ro+(r.w_bits-8<<4)<<8;s|=(r.strategy>=Yn||r.level<2?0:r.level<6?1:6===r.level?2:3)<<6,0!==r.strstart&&(s|=mo),s+=31-s%31,r.status=bo,zo(r,s),0!==r.strstart&&(zo(r,e.adler>>>16),zo(r,65535&e.adler)),e.adler=1}if(r.status===_o)if(r.gzhead.extra){for(n=r.pending;r.gzindex<(65535&r.gzhead.extra.length)&&(r.pending!==r.pending_buf_size||(r.gzhead.hcrc&&r.pending>n&&(e.adler=On(e.adler,r.pending_buf,r.pending-n,n)),Lo(e),n=r.pending,r.pending!==r.pending_buf_size));)ko(r,255&r.gzhead.extra[r.gzindex]),r.gzindex++;r.gzhead.hcrc&&r.pending>n&&(e.adler=On(e.adler,r.pending_buf,r.pending-n,n)),r.gzindex===r.gzhead.extra.length&&(r.gzindex=0,r.status=yo)}else r.status=yo;if(r.status===yo)if(r.gzhead.name){n=r.pending;do{if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>n&&(e.adler=On(e.adler,r.pending_buf,r.pending-n,n)),Lo(e),n=r.pending,r.pending===r.pending_buf_size)){o=1;break}o=r.gzindex<r.gzhead.name.length?255&r.gzhead.name.charCodeAt(r.gzindex++):0,ko(r,o)}while(0!==o);r.gzhead.hcrc&&r.pending>n&&(e.adler=On(e.adler,r.pending_buf,r.pending-n,n)),0===o&&(r.gzindex=0,r.status=vo)}else r.status=vo;if(r.status===vo)if(r.gzhead.comment){n=r.pending;do{if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>n&&(e.adler=On(e.adler,r.pending_buf,r.pending-n,n)),Lo(e),n=r.pending,r.pending===r.pending_buf_size)){o=1;break}o=r.gzindex<r.gzhead.comment.length?255&r.gzhead.comment.charCodeAt(r.gzindex++):0,ko(r,o)}while(0!==o);r.gzhead.hcrc&&r.pending>n&&(e.adler=On(e.adler,r.pending_buf,r.pending-n,n)),0===o&&(r.status=xo)}else r.status=xo;if(r.status===xo&&(r.gzhead.hcrc?(r.pending+2>r.pending_buf_size&&Lo(e),r.pending+2<=r.pending_buf_size&&(ko(r,255&e.adler),ko(r,e.adler>>8&255),e.adler=0,r.status=bo)):r.status=bo),0!==r.pending){if(Lo(e),0===e.avail_out)return r.last_flush=-1,Gn}else if(0===e.avail_in&&Io(t)<=Io(i)&&t!==Vn)return Mo(e,Kn);if(r.status===wo&&0!==e.avail_in)return Mo(e,Kn);if(0!==e.avail_in||0!==r.lookahead||t!==Nn&&r.status!==wo){var a=r.strategy===Yn?function(e,t){for(var i;;){if(0===e.lookahead&&(Do(e),0===e.lookahead)){if(t===Nn)return To;break}if(e.match_length=0,i=zn._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,i&&(Fo(e,!1),0===e.strm.avail_out))return To}return e.insert=0,t===Vn?(Fo(e,!0),0===e.strm.avail_out?Co:So):e.last_lit&&(Fo(e,!1),0===e.strm.avail_out)?To:Bo}(r,t):r.strategy===Jn?function(e,t){for(var i,r,n,o,s=e.window;;){if(e.lookahead<=fo){if(Do(e),e.lookahead<=fo&&t===Nn)return To;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=po&&e.strstart>0&&(r=s[n=e.strstart-1])===s[++n]&&r===s[++n]&&r===s[++n]){o=e.strstart+fo;do{}while(r===s[++n]&&r===s[++n]&&r===s[++n]&&r===s[++n]&&r===s[++n]&&r===s[++n]&&r===s[++n]&&r===s[++n]&&n<o);e.match_length=fo-(o-n),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=po?(i=zn._tr_tally(e,1,e.match_length-po),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(i=zn._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),i&&(Fo(e,!1),0===e.strm.avail_out))return To}return e.insert=0,t===Vn?(Fo(e,!0),0===e.strm.avail_out?Co:So):e.last_lit&&(Fo(e,!1),0===e.strm.avail_out)?To:Bo}(r,t):kn[r.level].func(r,t);if(a!==Co&&a!==So||(r.status=wo),a===To||a===Co)return 0===e.avail_out&&(r.last_flush=-1),Gn;if(a===Bo&&(t===Qn?zn._tr_align(r):t!==Hn&&(zn._tr_stored_block(r,0,0,!1),t===jn&&(Po(r.head),0===r.lookahead&&(r.strstart=0,r.block_start=0,r.insert=0))),Lo(e),0===e.avail_out))return r.last_flush=-1,Gn}return t!==Vn?Gn:r.wrap<=0?$n:(2===r.wrap?(ko(r,255&e.adler),ko(r,e.adler>>8&255),ko(r,e.adler>>16&255),ko(r,e.adler>>24&255),ko(r,255&e.total_in),ko(r,e.total_in>>8&255),ko(r,e.total_in>>16&255),ko(r,e.total_in>>24&255)):(zo(r,e.adler>>>16),zo(r,65535&e.adler)),Lo(e),r.wrap>0&&(r.wrap=-r.wrap),0!==r.pending?Gn:$n)},deflateEnd:function(e){var t;return e&&e.state?(t=e.state.status)!==go&&t!==_o&&t!==yo&&t!==vo&&t!==xo&&t!==bo&&t!==wo?Mo(e,Zn):(e.state=null,t===bo?Mo(e,qn):Gn):Zn},deflateSetDictionary:function(e,t){var i,r,n,o,s,a,l,c,u=t.length;if(!e||!e.state)return Zn;if(2===(o=(i=e.state).wrap)||1===o&&i.status!==go||i.lookahead)return Zn;for(1===o&&(e.adler=Rn(e.adler,t,u,0)),i.wrap=0,u>=i.w_size&&(0===o&&(Po(i.head),i.strstart=0,i.block_start=0,i.insert=0),c=new kr.Buf8(i.w_size),kr.arraySet(c,t,u-i.w_size,i.w_size,0),t=c,u=i.w_size),s=e.avail_in,a=e.next_in,l=e.input,e.avail_in=u,e.next_in=0,e.input=t,Do(i);i.lookahead>=po;){r=i.strstart,n=i.lookahead-(po-1);do{i.ins_h=(i.ins_h<<i.hash_shift^i.window[r+po-1])&i.hash_mask,i.prev[r&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=r,r++}while(--n);i.strstart=r,i.lookahead=po-1,Do(i)}return i.strstart+=i.lookahead,i.block_start=i.strstart,i.insert=i.lookahead,i.lookahead=0,i.match_length=i.prev_length=po-1,i.match_available=0,e.next_in=a,e.input=l,e.avail_in=s,i.wrap=o,Gn},deflateInfo:"pako deflate (from Nodeca project)"},$o=!0,Zo=!0;try{String.fromCharCode.apply(null,[0])}catch(e){$o=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){Zo=!1}for(var qo=new kr.Buf8(256),Ko=0;Ko<256;Ko++)qo[Ko]=Ko>=252?6:Ko>=248?5:Ko>=240?4:Ko>=224?3:Ko>=192?2:1;function Wo(e,t){if(t<65537&&(e.subarray&&Zo||!e.subarray&&$o))return String.fromCharCode.apply(null,kr.shrinkBuf(e,t));for(var i="",r=0;r<t;r++)i+=String.fromCharCode(e[r]);return i}qo[254]=qo[254]=1;var Xo={string2buf:function(e){var t,i,r,n,o,s=e.length,a=0;for(n=0;n<s;n++)55296==(64512&(i=e.charCodeAt(n)))&&n+1<s&&56320==(64512&(r=e.charCodeAt(n+1)))&&(i=65536+(i-55296<<10)+(r-56320),n++),a+=i<128?1:i<2048?2:i<65536?3:4;for(t=new kr.Buf8(a),o=0,n=0;o<a;n++)55296==(64512&(i=e.charCodeAt(n)))&&n+1<s&&56320==(64512&(r=e.charCodeAt(n+1)))&&(i=65536+(i-55296<<10)+(r-56320),n++),i<128?t[o++]=i:i<2048?(t[o++]=192|i>>>6,t[o++]=128|63&i):i<65536?(t[o++]=224|i>>>12,t[o++]=128|i>>>6&63,t[o++]=128|63&i):(t[o++]=240|i>>>18,t[o++]=128|i>>>12&63,t[o++]=128|i>>>6&63,t[o++]=128|63&i);return t},buf2binstring:function(e){return Wo(e,e.length)},binstring2buf:function(e){for(var t=new kr.Buf8(e.length),i=0,r=t.length;i<r;i++)t[i]=e.charCodeAt(i);return t},buf2string:function(e,t){var i,r,n,o,s=t||e.length,a=new Array(2*s);for(r=0,i=0;i<s;)if((n=e[i++])<128)a[r++]=n;else if((o=qo[n])>4)a[r++]=65533,i+=o-1;else{for(n&=2===o?31:3===o?15:7;o>1&&i<s;)n=n<<6|63&e[i++],o--;o>1?a[r++]=65533:n<65536?a[r++]=n:(n-=65536,a[r++]=55296|n>>10&1023,a[r++]=56320|1023&n)}return Wo(a,r)},utf8border:function(e,t){var i;for((t=t||e.length)>e.length&&(t=e.length),i=t-1;i>=0&&128==(192&e[i]);)i--;return i<0||0===i?t:i+qo[e[i]]>t?i:t}},Yo=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0},Jo=Object.prototype.toString,es=0,ts=-1,is=0,rs=8;function ns(e){if(!(this instanceof ns))return new ns(e);this.options=kr.assign({level:ts,method:rs,chunkSize:16384,windowBits:15,memLevel:8,strategy:is,to:""},e||{});var t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Yo,this.strm.avail_out=0;var i=Go.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(i!==es)throw new Error(Un[i]);if(t.header&&Go.deflateSetHeader(this.strm,t.header),t.dictionary){var r;if(r="string"==typeof t.dictionary?Xo.string2buf(t.dictionary):"[object ArrayBuffer]"===Jo.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,(i=Go.deflateSetDictionary(this.strm,r))!==es)throw new Error(Un[i]);this._dict_set=!0}}function os(e,t){var i=new ns(t);if(i.push(e,!0),i.err)throw i.msg||Un[i.err];return i.result}ns.prototype.push=function(e,t){var i,r,n=this.strm,o=this.options.chunkSize;if(this.ended)return!1;r=t===~~t?t:!0===t?4:0,"string"==typeof e?n.input=Xo.string2buf(e):"[object ArrayBuffer]"===Jo.call(e)?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;do{if(0===n.avail_out&&(n.output=new kr.Buf8(o),n.next_out=0,n.avail_out=o),1!==(i=Go.deflate(n,r))&&i!==es)return this.onEnd(i),this.ended=!0,!1;0!==n.avail_out&&(0!==n.avail_in||4!==r&&2!==r)||("string"===this.options.to?this.onData(Xo.buf2binstring(kr.shrinkBuf(n.output,n.next_out))):this.onData(kr.shrinkBuf(n.output,n.next_out)))}while((n.avail_in>0||0===n.avail_out)&&1!==i);return 4===r?(i=Go.deflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===es):2!==r||(this.onEnd(es),n.avail_out=0,!0)},ns.prototype.onData=function(e){this.chunks.push(e)},ns.prototype.onEnd=function(e){e===es&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=kr.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var ss={Deflate:ns,deflate:os,deflateRaw:function(e,t){return(t=t||{}).raw=!0,os(e,t)},gzip:function(e,t){return(t=t||{}).gzip=!0,os(e,t)}},as=function(e,t){var i,r,n,o,s,a,l,c,u,h,d,p,f,A,m,g,_,y,v,x,b,w,T,B,C;i=e.state,r=e.next_in,B=e.input,n=r+(e.avail_in-5),o=e.next_out,C=e.output,s=o-(t-e.avail_out),a=o+(e.avail_out-257),l=i.dmax,c=i.wsize,u=i.whave,h=i.wnext,d=i.window,p=i.hold,f=i.bits,A=i.lencode,m=i.distcode,g=(1<<i.lenbits)-1,_=(1<<i.distbits)-1;e:do{f<15&&(p+=B[r++]<<f,f+=8,p+=B[r++]<<f,f+=8),y=A[p&g];t:for(;;){if(p>>>=v=y>>>24,f-=v,0==(v=y>>>16&255))C[o++]=65535&y;else{if(!(16&v)){if(!(64&v)){y=A[(65535&y)+(p&(1<<v)-1)];continue t}if(32&v){i.mode=12;break e}e.msg="invalid literal/length code",i.mode=30;break e}x=65535&y,(v&=15)&&(f<v&&(p+=B[r++]<<f,f+=8),x+=p&(1<<v)-1,p>>>=v,f-=v),f<15&&(p+=B[r++]<<f,f+=8,p+=B[r++]<<f,f+=8),y=m[p&_];i:for(;;){if(p>>>=v=y>>>24,f-=v,!(16&(v=y>>>16&255))){if(!(64&v)){y=m[(65535&y)+(p&(1<<v)-1)];continue i}e.msg="invalid distance code",i.mode=30;break e}if(b=65535&y,f<(v&=15)&&(p+=B[r++]<<f,(f+=8)<v&&(p+=B[r++]<<f,f+=8)),(b+=p&(1<<v)-1)>l){e.msg="invalid distance too far back",i.mode=30;break e}if(p>>>=v,f-=v,b>(v=o-s)){if((v=b-v)>u&&i.sane){e.msg="invalid distance too far back",i.mode=30;break e}if(w=0,T=d,0===h){if(w+=c-v,v<x){x-=v;do{C[o++]=d[w++]}while(--v);w=o-b,T=C}}else if(h<v){if(w+=c+h-v,(v-=h)<x){x-=v;do{C[o++]=d[w++]}while(--v);if(w=0,h<x){x-=v=h;do{C[o++]=d[w++]}while(--v);w=o-b,T=C}}}else if(w+=h-v,v<x){x-=v;do{C[o++]=d[w++]}while(--v);w=o-b,T=C}for(;x>2;)C[o++]=T[w++],C[o++]=T[w++],C[o++]=T[w++],x-=3;x&&(C[o++]=T[w++],x>1&&(C[o++]=T[w++]))}else{w=o-b;do{C[o++]=C[w++],C[o++]=C[w++],C[o++]=C[w++],x-=3}while(x>2);x&&(C[o++]=C[w++],x>1&&(C[o++]=C[w++]))}break}}break}}while(r<n&&o<a);r-=x=f>>3,p&=(1<<(f-=x<<3))-1,e.next_in=r,e.next_out=o,e.avail_in=r<n?n-r+5:5-(r-n),e.avail_out=o<a?a-o+257:257-(o-a),i.hold=p,i.bits=f},ls=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],cs=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],us=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],hs=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64],ds=function(e,t,i,r,n,o,s,a){var l,c,u,h,d,p,f,A,m,g=a.bits,_=0,y=0,v=0,x=0,b=0,w=0,T=0,B=0,C=0,S=0,E=null,M=0,I=new kr.Buf16(16),P=new kr.Buf16(16),L=null,F=0;for(_=0;_<=15;_++)I[_]=0;for(y=0;y<r;y++)I[t[i+y]]++;for(b=g,x=15;x>=1&&0===I[x];x--);if(b>x&&(b=x),0===x)return n[o++]=20971520,n[o++]=20971520,a.bits=1,0;for(v=1;v<x&&0===I[v];v++);for(b<v&&(b=v),B=1,_=1;_<=15;_++)if(B<<=1,(B-=I[_])<0)return-1;if(B>0&&(0===e||1!==x))return-1;for(P[1]=0,_=1;_<15;_++)P[_+1]=P[_]+I[_];for(y=0;y<r;y++)0!==t[i+y]&&(s[P[t[i+y]]++]=y);if(0===e?(E=L=s,p=19):1===e?(E=ls,M-=257,L=cs,F-=257,p=256):(E=us,L=hs,p=-1),S=0,y=0,_=v,d=o,w=b,T=0,u=-1,h=(C=1<<b)-1,1===e&&C>852||2===e&&C>592)return 1;for(;;){f=_-T,s[y]<p?(A=0,m=s[y]):s[y]>p?(A=L[F+s[y]],m=E[M+s[y]]):(A=96,m=0),l=1<<_-T,v=c=1<<w;do{n[d+(S>>T)+(c-=l)]=f<<24|A<<16|m}while(0!==c);for(l=1<<_-1;S&l;)l>>=1;if(0!==l?(S&=l-1,S+=l):S=0,y++,0==--I[_]){if(_===x)break;_=t[i+s[y]]}if(_>b&&(S&h)!==u){for(0===T&&(T=b),d+=v,B=1<<(w=_-T);w+T<x&&!((B-=I[w+T])<=0);)w++,B<<=1;if(C+=1<<w,1===e&&C>852||2===e&&C>592)return 1;n[u=S&h]=b<<24|w<<16|d-o}}return 0!==S&&(n[d+S]=_-T<<24|64<<16),a.bits=b,0},ps=0,fs=1,As=2,ms=4,gs=5,_s=6,ys=0,vs=1,xs=2,bs=-2,ws=-3,Ts=-4,Bs=-5,Cs=8,Ss=1,Es=2,Ms=3,Is=4,Ps=5,Ls=6,Fs=7,ks=8,zs=9,Rs=10,Ds=11,Os=12,Us=13,Ns=14,Qs=15,js=16,Vs=17,Hs=18,Gs=19,$s=20,Zs=21,qs=22,Ks=23,Ws=24,Xs=25,Ys=26,Js=27,ea=28,ta=29,ia=30,ra=31,na=852,oa=592,sa=15;function aa(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function la(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new kr.Buf16(320),this.work=new kr.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function ca(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=Ss,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new kr.Buf32(na),t.distcode=t.distdyn=new kr.Buf32(oa),t.sane=1,t.back=-1,ys):bs}function ua(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,ca(e)):bs}function ha(e,t){var i,r;return e&&e.state?(r=e.state,t<0?(i=0,t=-t):(i=1+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?bs:(null!==r.window&&r.wbits!==t&&(r.window=null),r.wrap=i,r.wbits=t,ua(e))):bs}function da(e,t){var i,r;return e?(r=new la,e.state=r,r.window=null,(i=ha(e,t))!==ys&&(e.state=null),i):bs}var pa,fa,Aa=!0;function ma(e){if(Aa){var t;for(pa=new kr.Buf32(512),fa=new kr.Buf32(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(ds(fs,e.lens,0,288,pa,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;ds(As,e.lens,0,32,fa,0,e.work,{bits:5}),Aa=!1}e.lencode=pa,e.lenbits=9,e.distcode=fa,e.distbits=5}function ga(e,t,i,r){var n,o=e.state;return null===o.window&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new kr.Buf8(o.wsize)),r>=o.wsize?(kr.arraySet(o.window,t,i-o.wsize,o.wsize,0),o.wnext=0,o.whave=o.wsize):((n=o.wsize-o.wnext)>r&&(n=r),kr.arraySet(o.window,t,i-r,n,o.wnext),(r-=n)?(kr.arraySet(o.window,t,i-r,r,0),o.wnext=r,o.whave=o.wsize):(o.wnext+=n,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=n))),0}var _a={inflateReset:ua,inflateReset2:ha,inflateResetKeep:ca,inflateInit:function(e){return da(e,sa)},inflateInit2:da,inflate:function(e,t){var i,r,n,o,s,a,l,c,u,h,d,p,f,A,m,g,_,y,v,x,b,w,T,B,C=0,S=new kr.Buf8(4),E=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return bs;(i=e.state).mode===Os&&(i.mode=Us),s=e.next_out,n=e.output,l=e.avail_out,o=e.next_in,r=e.input,a=e.avail_in,c=i.hold,u=i.bits,h=a,d=l,w=ys;e:for(;;)switch(i.mode){case Ss:if(0===i.wrap){i.mode=Us;break}for(;u<16;){if(0===a)break e;a--,c+=r[o++]<<u,u+=8}if(2&i.wrap&&35615===c){i.check=0,S[0]=255&c,S[1]=c>>>8&255,i.check=On(i.check,S,2,0),c=0,u=0,i.mode=Es;break}if(i.flags=0,i.head&&(i.head.done=!1),!(1&i.wrap)||(((255&c)<<8)+(c>>8))%31){e.msg="incorrect header check",i.mode=ia;break}if((15&c)!==Cs){e.msg="unknown compression method",i.mode=ia;break}if(u-=4,b=8+(15&(c>>>=4)),0===i.wbits)i.wbits=b;else if(b>i.wbits){e.msg="invalid window size",i.mode=ia;break}i.dmax=1<<b,e.adler=i.check=1,i.mode=512&c?Rs:Os,c=0,u=0;break;case Es:for(;u<16;){if(0===a)break e;a--,c+=r[o++]<<u,u+=8}if(i.flags=c,(255&i.flags)!==Cs){e.msg="unknown compression method",i.mode=ia;break}if(57344&i.flags){e.msg="unknown header flags set",i.mode=ia;break}i.head&&(i.head.text=c>>8&1),512&i.flags&&(S[0]=255&c,S[1]=c>>>8&255,i.check=On(i.check,S,2,0)),c=0,u=0,i.mode=Ms;case Ms:for(;u<32;){if(0===a)break e;a--,c+=r[o++]<<u,u+=8}i.head&&(i.head.time=c),512&i.flags&&(S[0]=255&c,S[1]=c>>>8&255,S[2]=c>>>16&255,S[3]=c>>>24&255,i.check=On(i.check,S,4,0)),c=0,u=0,i.mode=Is;case Is:for(;u<16;){if(0===a)break e;a--,c+=r[o++]<<u,u+=8}i.head&&(i.head.xflags=255&c,i.head.os=c>>8),512&i.flags&&(S[0]=255&c,S[1]=c>>>8&255,i.check=On(i.check,S,2,0)),c=0,u=0,i.mode=Ps;case Ps:if(1024&i.flags){for(;u<16;){if(0===a)break e;a--,c+=r[o++]<<u,u+=8}i.length=c,i.head&&(i.head.extra_len=c),512&i.flags&&(S[0]=255&c,S[1]=c>>>8&255,i.check=On(i.check,S,2,0)),c=0,u=0}else i.head&&(i.head.extra=null);i.mode=Ls;case Ls:if(1024&i.flags&&((p=i.length)>a&&(p=a),p&&(i.head&&(b=i.head.extra_len-i.length,i.head.extra||(i.head.extra=new Array(i.head.extra_len)),kr.arraySet(i.head.extra,r,o,p,b)),512&i.flags&&(i.check=On(i.check,r,p,o)),a-=p,o+=p,i.length-=p),i.length))break e;i.length=0,i.mode=Fs;case Fs:if(2048&i.flags){if(0===a)break e;p=0;do{b=r[o+p++],i.head&&b&&i.length<65536&&(i.head.name+=String.fromCharCode(b))}while(b&&p<a);if(512&i.flags&&(i.check=On(i.check,r,p,o)),a-=p,o+=p,b)break e}else i.head&&(i.head.name=null);i.length=0,i.mode=ks;case ks:if(4096&i.flags){if(0===a)break e;p=0;do{b=r[o+p++],i.head&&b&&i.length<65536&&(i.head.comment+=String.fromCharCode(b))}while(b&&p<a);if(512&i.flags&&(i.check=On(i.check,r,p,o)),a-=p,o+=p,b)break e}else i.head&&(i.head.comment=null);i.mode=zs;case zs:if(512&i.flags){for(;u<16;){if(0===a)break e;a--,c+=r[o++]<<u,u+=8}if(c!==(65535&i.check)){e.msg="header crc mismatch",i.mode=ia;break}c=0,u=0}i.head&&(i.head.hcrc=i.flags>>9&1,i.head.done=!0),e.adler=i.check=0,i.mode=Os;break;case Rs:for(;u<32;){if(0===a)break e;a--,c+=r[o++]<<u,u+=8}e.adler=i.check=aa(c),c=0,u=0,i.mode=Ds;case Ds:if(0===i.havedict)return e.next_out=s,e.avail_out=l,e.next_in=o,e.avail_in=a,i.hold=c,i.bits=u,xs;e.adler=i.check=1,i.mode=Os;case Os:if(t===gs||t===_s)break e;case Us:if(i.last){c>>>=7&u,u-=7&u,i.mode=Js;break}for(;u<3;){if(0===a)break e;a--,c+=r[o++]<<u,u+=8}switch(i.last=1&c,u-=1,3&(c>>>=1)){case 0:i.mode=Ns;break;case 1:if(ma(i),i.mode=$s,t===_s){c>>>=2,u-=2;break e}break;case 2:i.mode=Vs;break;case 3:e.msg="invalid block type",i.mode=ia}c>>>=2,u-=2;break;case Ns:for(c>>>=7&u,u-=7&u;u<32;){if(0===a)break e;a--,c+=r[o++]<<u,u+=8}if((65535&c)!=(c>>>16^65535)){e.msg="invalid stored block lengths",i.mode=ia;break}if(i.length=65535&c,c=0,u=0,i.mode=Qs,t===_s)break e;case Qs:i.mode=js;case js:if(p=i.length){if(p>a&&(p=a),p>l&&(p=l),0===p)break e;kr.arraySet(n,r,o,p,s),a-=p,o+=p,l-=p,s+=p,i.length-=p;break}i.mode=Os;break;case Vs:for(;u<14;){if(0===a)break e;a--,c+=r[o++]<<u,u+=8}if(i.nlen=257+(31&c),c>>>=5,u-=5,i.ndist=1+(31&c),c>>>=5,u-=5,i.ncode=4+(15&c),c>>>=4,u-=4,i.nlen>286||i.ndist>30){e.msg="too many length or distance symbols",i.mode=ia;break}i.have=0,i.mode=Hs;case Hs:for(;i.have<i.ncode;){for(;u<3;){if(0===a)break e;a--,c+=r[o++]<<u,u+=8}i.lens[E[i.have++]]=7&c,c>>>=3,u-=3}for(;i.have<19;)i.lens[E[i.have++]]=0;if(i.lencode=i.lendyn,i.lenbits=7,T={bits:i.lenbits},w=ds(ps,i.lens,0,19,i.lencode,0,i.work,T),i.lenbits=T.bits,w){e.msg="invalid code lengths set",i.mode=ia;break}i.have=0,i.mode=Gs;case Gs:for(;i.have<i.nlen+i.ndist;){for(;g=(C=i.lencode[c&(1<<i.lenbits)-1])>>>16&255,_=65535&C,!((m=C>>>24)<=u);){if(0===a)break e;a--,c+=r[o++]<<u,u+=8}if(_<16)c>>>=m,u-=m,i.lens[i.have++]=_;else{if(16===_){for(B=m+2;u<B;){if(0===a)break e;a--,c+=r[o++]<<u,u+=8}if(c>>>=m,u-=m,0===i.have){e.msg="invalid bit length repeat",i.mode=ia;break}b=i.lens[i.have-1],p=3+(3&c),c>>>=2,u-=2}else if(17===_){for(B=m+3;u<B;){if(0===a)break e;a--,c+=r[o++]<<u,u+=8}u-=m,b=0,p=3+(7&(c>>>=m)),c>>>=3,u-=3}else{for(B=m+7;u<B;){if(0===a)break e;a--,c+=r[o++]<<u,u+=8}u-=m,b=0,p=11+(127&(c>>>=m)),c>>>=7,u-=7}if(i.have+p>i.nlen+i.ndist){e.msg="invalid bit length repeat",i.mode=ia;break}for(;p--;)i.lens[i.have++]=b}}if(i.mode===ia)break;if(0===i.lens[256]){e.msg="invalid code -- missing end-of-block",i.mode=ia;break}if(i.lenbits=9,T={bits:i.lenbits},w=ds(fs,i.lens,0,i.nlen,i.lencode,0,i.work,T),i.lenbits=T.bits,w){e.msg="invalid literal/lengths set",i.mode=ia;break}if(i.distbits=6,i.distcode=i.distdyn,T={bits:i.distbits},w=ds(As,i.lens,i.nlen,i.ndist,i.distcode,0,i.work,T),i.distbits=T.bits,w){e.msg="invalid distances set",i.mode=ia;break}if(i.mode=$s,t===_s)break e;case $s:i.mode=Zs;case Zs:if(a>=6&&l>=258){e.next_out=s,e.avail_out=l,e.next_in=o,e.avail_in=a,i.hold=c,i.bits=u,as(e,d),s=e.next_out,n=e.output,l=e.avail_out,o=e.next_in,r=e.input,a=e.avail_in,c=i.hold,u=i.bits,i.mode===Os&&(i.back=-1);break}for(i.back=0;g=(C=i.lencode[c&(1<<i.lenbits)-1])>>>16&255,_=65535&C,!((m=C>>>24)<=u);){if(0===a)break e;a--,c+=r[o++]<<u,u+=8}if(g&&!(240&g)){for(y=m,v=g,x=_;g=(C=i.lencode[x+((c&(1<<y+v)-1)>>y)])>>>16&255,_=65535&C,!(y+(m=C>>>24)<=u);){if(0===a)break e;a--,c+=r[o++]<<u,u+=8}c>>>=y,u-=y,i.back+=y}if(c>>>=m,u-=m,i.back+=m,i.length=_,0===g){i.mode=Ys;break}if(32&g){i.back=-1,i.mode=Os;break}if(64&g){e.msg="invalid literal/length code",i.mode=ia;break}i.extra=15&g,i.mode=qs;case qs:if(i.extra){for(B=i.extra;u<B;){if(0===a)break e;a--,c+=r[o++]<<u,u+=8}i.length+=c&(1<<i.extra)-1,c>>>=i.extra,u-=i.extra,i.back+=i.extra}i.was=i.length,i.mode=Ks;case Ks:for(;g=(C=i.distcode[c&(1<<i.distbits)-1])>>>16&255,_=65535&C,!((m=C>>>24)<=u);){if(0===a)break e;a--,c+=r[o++]<<u,u+=8}if(!(240&g)){for(y=m,v=g,x=_;g=(C=i.distcode[x+((c&(1<<y+v)-1)>>y)])>>>16&255,_=65535&C,!(y+(m=C>>>24)<=u);){if(0===a)break e;a--,c+=r[o++]<<u,u+=8}c>>>=y,u-=y,i.back+=y}if(c>>>=m,u-=m,i.back+=m,64&g){e.msg="invalid distance code",i.mode=ia;break}i.offset=_,i.extra=15&g,i.mode=Ws;case Ws:if(i.extra){for(B=i.extra;u<B;){if(0===a)break e;a--,c+=r[o++]<<u,u+=8}i.offset+=c&(1<<i.extra)-1,c>>>=i.extra,u-=i.extra,i.back+=i.extra}if(i.offset>i.dmax){e.msg="invalid distance too far back",i.mode=ia;break}i.mode=Xs;case Xs:if(0===l)break e;if(p=d-l,i.offset>p){if((p=i.offset-p)>i.whave&&i.sane){e.msg="invalid distance too far back",i.mode=ia;break}p>i.wnext?(p-=i.wnext,f=i.wsize-p):f=i.wnext-p,p>i.length&&(p=i.length),A=i.window}else A=n,f=s-i.offset,p=i.length;p>l&&(p=l),l-=p,i.length-=p;do{n[s++]=A[f++]}while(--p);0===i.length&&(i.mode=Zs);break;case Ys:if(0===l)break e;n[s++]=i.length,l--,i.mode=Zs;break;case Js:if(i.wrap){for(;u<32;){if(0===a)break e;a--,c|=r[o++]<<u,u+=8}if(d-=l,e.total_out+=d,i.total+=d,d&&(e.adler=i.check=i.flags?On(i.check,n,d,s-d):Rn(i.check,n,d,s-d)),d=l,(i.flags?c:aa(c))!==i.check){e.msg="incorrect data check",i.mode=ia;break}c=0,u=0}i.mode=ea;case ea:if(i.wrap&&i.flags){for(;u<32;){if(0===a)break e;a--,c+=r[o++]<<u,u+=8}if(c!==(4294967295&i.total)){e.msg="incorrect length check",i.mode=ia;break}c=0,u=0}i.mode=ta;case ta:w=vs;break e;case ia:w=ws;break e;case ra:return Ts;default:return bs}return e.next_out=s,e.avail_out=l,e.next_in=o,e.avail_in=a,i.hold=c,i.bits=u,(i.wsize||d!==e.avail_out&&i.mode<ia&&(i.mode<Js||t!==ms))&&ga(e,e.output,e.next_out,d-e.avail_out),h-=e.avail_in,d-=e.avail_out,e.total_in+=h,e.total_out+=d,i.total+=d,i.wrap&&d&&(e.adler=i.check=i.flags?On(i.check,n,d,e.next_out-d):Rn(i.check,n,d,e.next_out-d)),e.data_type=i.bits+(i.last?64:0)+(i.mode===Os?128:0)+(i.mode===$s||i.mode===Qs?256:0),(0===h&&0===d||t===ms)&&w===ys&&(w=Bs),w},inflateEnd:function(e){if(!e||!e.state)return bs;var t=e.state;return t.window&&(t.window=null),e.state=null,ys},inflateGetHeader:function(e,t){var i;return e&&e.state&&2&(i=e.state).wrap?(i.head=t,t.done=!1,ys):bs},inflateSetDictionary:function(e,t){var i,r=t.length;return e&&e.state?0!==(i=e.state).wrap&&i.mode!==Ds?bs:i.mode===Ds&&Rn(1,t,r,0)!==i.check?ws:ga(e,t,r,r)?(i.mode=ra,Ts):(i.havedict=1,ys):bs},inflateInfo:"pako inflate (from Nodeca project)"},ya={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8},va=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1},xa=Object.prototype.toString;function ba(e){if(!(this instanceof ba))return new ba(e);this.options=kr.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&!(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Yo,this.strm.avail_out=0;var i=_a.inflateInit2(this.strm,t.windowBits);if(i!==ya.Z_OK)throw new Error(Un[i]);this.header=new va,_a.inflateGetHeader(this.strm,this.header)}function wa(e,t){var i=new ba(t);if(i.push(e,!0),i.err)throw i.msg||Un[i.err];return i.result}ba.prototype.push=function(e,t){var i,r,n,o,s,a,l=this.strm,c=this.options.chunkSize,u=this.options.dictionary,h=!1;if(this.ended)return!1;r=t===~~t?t:!0===t?ya.Z_FINISH:ya.Z_NO_FLUSH,"string"==typeof e?l.input=Xo.binstring2buf(e):"[object ArrayBuffer]"===xa.call(e)?l.input=new Uint8Array(e):l.input=e,l.next_in=0,l.avail_in=l.input.length;do{if(0===l.avail_out&&(l.output=new kr.Buf8(c),l.next_out=0,l.avail_out=c),(i=_a.inflate(l,ya.Z_NO_FLUSH))===ya.Z_NEED_DICT&&u&&(a="string"==typeof u?Xo.string2buf(u):"[object ArrayBuffer]"===xa.call(u)?new Uint8Array(u):u,i=_a.inflateSetDictionary(this.strm,a)),i===ya.Z_BUF_ERROR&&!0===h&&(i=ya.Z_OK,h=!1),i!==ya.Z_STREAM_END&&i!==ya.Z_OK)return this.onEnd(i),this.ended=!0,!1;l.next_out&&(0!==l.avail_out&&i!==ya.Z_STREAM_END&&(0!==l.avail_in||r!==ya.Z_FINISH&&r!==ya.Z_SYNC_FLUSH)||("string"===this.options.to?(n=Xo.utf8border(l.output,l.next_out),o=l.next_out-n,s=Xo.buf2string(l.output,n),l.next_out=o,l.avail_out=c-o,o&&kr.arraySet(l.output,l.output,n,o,0),this.onData(s)):this.onData(kr.shrinkBuf(l.output,l.next_out)))),0===l.avail_in&&0===l.avail_out&&(h=!0)}while((l.avail_in>0||0===l.avail_out)&&i!==ya.Z_STREAM_END);return i===ya.Z_STREAM_END&&(r=ya.Z_FINISH),r===ya.Z_FINISH?(i=_a.inflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===ya.Z_OK):r!==ya.Z_SYNC_FLUSH||(this.onEnd(ya.Z_OK),l.avail_out=0,!0)},ba.prototype.onData=function(e){this.chunks.push(e)},ba.prototype.onEnd=function(e){e===ya.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=kr.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var Ta={Inflate:ba,inflate:wa,inflateRaw:function(e,t){return(t=t||{}).raw=!0,wa(e,t)},ungzip:wa},Ba={};(0,kr.assign)(Ba,ss,Ta,ya);var Ca=Ba,Sa="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array?"uint8array":"array";function Ea(e,t){ar.call(this,"FlateWorker/"+e),this._pako=null,this._pakoAction=e,this._pakoOptions=t,this.meta={}}or.inherits(Ea,ar),Ea.prototype.processChunk=function(e){this.meta=e.meta,null===this._pako&&this._createPako(),this._pako.push(or.transformTo(Sa,e.data),!1)},Ea.prototype.flush=function(){ar.prototype.flush.call(this),null===this._pako&&this._createPako(),this._pako.push([],!0)},Ea.prototype.cleanUp=function(){ar.prototype.cleanUp.call(this),this._pako=null},Ea.prototype._createPako=function(){this._pako=new Ca[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var e=this;this._pako.onData=function(t){e.push({data:t,meta:e.meta})}};var Ma={STORE:{magic:"\0\0",compressWorker:function(e){return new ar("STORE compression")},uncompressWorker:function(){return new ar("STORE decompression")}},DEFLATE:{magic:"\b\0",compressWorker:function(e){return new Ea("Deflate",e)},uncompressWorker:function(){return new Ea("Inflate",{})}}},Ia="PK",Pa="PK",La="PK",Fa="PK",ka="PK",za="PK\b",Ra=function(e,t){var i,r="";for(i=0;i<t;i++)r+=String.fromCharCode(255&e),e>>>=8;return r},Da=function(e,t,i,r,n,o){var s,a,l=e.file,c=e.compression,u=o!==lr.utf8encode,h=or.transformTo("string",o(l.name)),d=or.transformTo("string",lr.utf8encode(l.name)),p=l.comment,f=or.transformTo("string",o(p)),A=or.transformTo("string",lr.utf8encode(p)),m=d.length!==l.name.length,g=A.length!==p.length,_="",y="",v="",x=l.dir,b=l.date,w={crc32:0,compressedSize:0,uncompressedSize:0};t&&!i||(w.crc32=e.crc32,w.compressedSize=e.compressedSize,w.uncompressedSize=e.uncompressedSize);var T=0;t&&(T|=8),u||!m&&!g||(T|=2048);var B,C,S=0,E=0;x&&(S|=16),"UNIX"===n?(E=798,S|=(C=B=l.unixPermissions,B||(C=x?16893:33204),(65535&C)<<16)):(E=20,S|=63&(l.dosPermissions||0)),s=b.getUTCHours(),s<<=6,s|=b.getUTCMinutes(),s<<=5,s|=b.getUTCSeconds()/2,a=b.getUTCFullYear()-1980,a<<=4,a|=b.getUTCMonth()+1,a<<=5,a|=b.getUTCDate(),m&&(y=Ra(1,1)+Ra(Tr(h),4)+d,_+="up"+Ra(y.length,2)+y),g&&(v=Ra(1,1)+Ra(Tr(f),4)+A,_+="uc"+Ra(v.length,2)+v);var M="";return M+="\n\0",M+=Ra(T,2),M+=c.magic,M+=Ra(s,2),M+=Ra(a,2),M+=Ra(w.crc32,4),M+=Ra(w.compressedSize,4),M+=Ra(w.uncompressedSize,4),M+=Ra(h.length,2),M+=Ra(_.length,2),{fileRecord:Ia+M+h+_,dirRecord:Pa+Ra(E,2)+M+Ra(f.length,2)+"\0\0\0\0"+Ra(S,4)+Ra(r,4)+h+_+f}},Oa=function(e){return za+Ra(e.crc32,4)+Ra(e.compressedSize,4)+Ra(e.uncompressedSize,4)};function Ua(e,t,i,r){ar.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=t,this.zipPlatform=i,this.encodeFileName=r,this.streamFiles=e,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}or.inherits(Ua,ar),Ua.prototype.push=function(e){var t=e.meta.percent||0,i=this.entriesCount,r=this._sources.length;this.accumulate?this.contentBuffer.push(e):(this.bytesWritten+=e.data.length,ar.prototype.push.call(this,{data:e.data,meta:{currentFile:this.currentFile,percent:i?(t+100*(i-r-1))/i:100}}))},Ua.prototype.openedSource=function(e){this.currentSourceOffset=this.bytesWritten,this.currentFile=e.file.name;var t=this.streamFiles&&!e.file.dir;if(t){var i=Da(e,t,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:i.fileRecord,meta:{percent:0}})}else this.accumulate=!0},Ua.prototype.closedSource=function(e){this.accumulate=!1;var t=this.streamFiles&&!e.file.dir,i=Da(e,t,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(i.dirRecord),t)this.push({data:Oa(e),meta:{percent:100}});else for(this.push({data:i.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},Ua.prototype.flush=function(){for(var e=this.bytesWritten,t=0;t<this.dirRecords.length;t++)this.push({data:this.dirRecords[t],meta:{percent:100}});var i=this.bytesWritten-e,r=function(e,t,i,r,n){var o=or.transformTo("string",n(r));return La+"\0\0\0\0"+Ra(e,2)+Ra(e,2)+Ra(t,4)+Ra(i,4)+Ra(o.length,2)+o}(this.dirRecords.length,i,e,this.zipComment,this.encodeFileName);this.push({data:r,meta:{percent:100}})},Ua.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},Ua.prototype.registerPrevious=function(e){this._sources.push(e);var t=this;return e.on("data",(function(e){t.processChunk(e)})),e.on("end",(function(){t.closedSource(t.previous.streamInfo),t._sources.length?t.prepareNextSource():t.end()})),e.on("error",(function(e){t.error(e)})),this},Ua.prototype.resume=function(){return!!ar.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},Ua.prototype.error=function(e){var t=this._sources;if(!ar.prototype.error.call(this,e))return!1;for(var i=0;i<t.length;i++)try{t[i].error(e)}catch(e){}return!0},Ua.prototype.lock=function(){ar.prototype.lock.call(this);for(var e=this._sources,t=0;t<e.length;t++)e[t].lock()};var Na=Ua,Qa=function(e,t,i){var r=new Na(t.streamFiles,i,t.platform,t.encodeFileName),n=0;try{e.forEach((function(e,i){n++;var o=function(e,t){var i=e||t,r=Ma[i];if(!r)throw new Error(i+" is not a valid compression method !");return r}(i.options.compression,t.compression),s=i.options.compressionOptions||t.compressionOptions||{},a=i.dir,l=i.date;i._compressWorker(o,s).withStreamInfo("file",{name:e,dir:a,date:l,comment:i.comment||"",unixPermissions:i.unixPermissions,dosPermissions:i.dosPermissions}).pipe(r)})),r.entriesCount=n}catch(e){r.error(e)}return r};function ja(e,t){ar.call(this,"Nodejs stream input adapter for "+e),this._upstreamEnded=!1,this._bindStream(t)}or.inherits(ja,ar),ja.prototype._bindStream=function(e){var t=this;this._stream=e,e.pause(),e.on("data",(function(e){t.push({data:e,meta:{percent:0}})})).on("error",(function(e){t.isPaused?this.generatedError=e:t.error(e)})).on("end",(function(){t.isPaused?t._upstreamEnded=!0:t.end()}))},ja.prototype.pause=function(){return!!ar.prototype.pause.call(this)&&(this._stream.pause(),!0)},ja.prototype.resume=function(){return!!ar.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)};var Va=ja,Ha=function(e,t,i){var r,n=or.getTypeOf(t),o=or.extend(i||{},_r);o.date=o.date||new Date,null!==o.compression&&(o.compression=o.compression.toUpperCase()),"string"==typeof o.unixPermissions&&(o.unixPermissions=parseInt(o.unixPermissions,8)),o.unixPermissions&&16384&o.unixPermissions&&(o.dir=!0),o.dosPermissions&&16&o.dosPermissions&&(o.dir=!0),o.dir&&(e=$a(e)),o.createFolders&&(r=Ga(e))&&Za.call(this,r,!0);var s="string"===n&&!1===o.binary&&!1===o.base64;i&&void 0!==i.binary||(o.binary=!s),(t instanceof Er&&0===t.uncompressedSize||o.dir||!t||0===t.length)&&(o.base64=!1,o.binary=!0,t="",o.compression="STORE",n="string");var a=null;a=t instanceof Er||t instanceof ar?t:ri(t)?new Va(e,t):or.prepareContent(e,t,o.binary,o.optimizedBinaryString,o.base64);var l=new Fr(e,a,o);this.files[e]=l},Ga=function(e){"/"===e.slice(-1)&&(e=e.substring(0,e.length-1));var t=e.lastIndexOf("/");return t>0?e.substring(0,t):""},$a=function(e){return"/"!==e.slice(-1)&&(e+="/"),e},Za=function(e,t){return t=void 0!==t?t:_r.createFolders,e=$a(e),this.files[e]||Ha.call(this,e,null,{dir:!0,createFolders:t}),this.files[e]};function qa(e){return"[object RegExp]"===Object.prototype.toString.call(e)}var Ka={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(e){var t,i,r;for(t in this.files)this.files.hasOwnProperty(t)&&(r=this.files[t],(i=t.slice(this.root.length,t.length))&&t.slice(0,this.root.length)===this.root&&e(i,r))},filter:function(e){var t=[];return this.forEach((function(i,r){e(i,r)&&t.push(r)})),t},file:function(e,t,i){if(1===arguments.length){if(qa(e)){var r=e;return this.filter((function(e,t){return!t.dir&&r.test(e)}))}var n=this.files[this.root+e];return n&&!n.dir?n:null}return e=this.root+e,Ha.call(this,e,t,i),this},folder:function(e){if(!e)return this;if(qa(e))return this.filter((function(t,i){return i.dir&&e.test(t)}));var t=this.root+e,i=Za.call(this,t),r=this.clone();return r.root=i.name,r},remove:function(e){e=this.root+e;var t=this.files[e];if(t||("/"!==e.slice(-1)&&(e+="/"),t=this.files[e]),t&&!t.dir)delete this.files[e];else for(var i=this.filter((function(t,i){return i.name.slice(0,e.length)===e})),r=0;r<i.length;r++)delete this.files[i[r].name];return this},generate:function(e){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(e){var t,i={};try{if((i=or.extend(e||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:lr.utf8encode})).type=i.type.toLowerCase(),i.compression=i.compression.toUpperCase(),"binarystring"===i.type&&(i.type="string"),!i.type)throw new Error("No output type specified.");or.checkSupport(i.type),"darwin"!==i.platform&&"freebsd"!==i.platform&&"linux"!==i.platform&&"sunos"!==i.platform||(i.platform="UNIX"),"win32"===i.platform&&(i.platform="DOS");var r=i.comment||this.comment||"";t=Qa(this,i,r)}catch(e){(t=new ar("error")).error(e)}return new gr(t,i.type||"string",i.mimeType)},generateAsync:function(e,t){return this.generateInternalStream(e).accumulate(t)},generateNodeStream:function(e,t){return(e=e||{}).type||(e.type="nodebuffer"),this.generateInternalStream(e).toNodejsStream(t)}};function Wa(e){this.data=e,this.length=e.length,this.index=0,this.zero=0}Wa.prototype={checkOffset:function(e){this.checkIndex(this.index+e)},checkIndex:function(e){if(this.length<this.zero+e||e<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+e+"). Corrupted zip ?")},setIndex:function(e){this.checkIndex(e),this.index=e},skip:function(e){this.setIndex(this.index+e)},byteAt:function(e){},readInt:function(e){var t,i=0;for(this.checkOffset(e),t=this.index+e-1;t>=this.index;t--)i=(i<<8)+this.byteAt(t);return this.index+=e,i},readString:function(e){return or.transformTo("string",this.readData(e))},readData:function(e){},lastIndexOfSignature:function(e){},readAndCheckSignature:function(e){},readDate:function(){var e=this.readInt(4);return new Date(Date.UTC(1980+(e>>25&127),(e>>21&15)-1,e>>16&31,e>>11&31,e>>5&63,(31&e)<<1))}};var Xa=Wa;function Ya(e){Xa.call(this,e);for(var t=0;t<this.data.length;t++)e[t]=255&e[t]}or.inherits(Ya,Xa),Ya.prototype.byteAt=function(e){return this.data[this.zero+e]},Ya.prototype.lastIndexOfSignature=function(e){for(var t=e.charCodeAt(0),i=e.charCodeAt(1),r=e.charCodeAt(2),n=e.charCodeAt(3),o=this.length-4;o>=0;--o)if(this.data[o]===t&&this.data[o+1]===i&&this.data[o+2]===r&&this.data[o+3]===n)return o-this.zero;return-1},Ya.prototype.readAndCheckSignature=function(e){var t=e.charCodeAt(0),i=e.charCodeAt(1),r=e.charCodeAt(2),n=e.charCodeAt(3),o=this.readData(4);return t===o[0]&&i===o[1]&&r===o[2]&&n===o[3]},Ya.prototype.readData=function(e){if(this.checkOffset(e),0===e)return[];var t=this.data.slice(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t};var Ja=Ya;function el(e){Xa.call(this,e)}or.inherits(el,Xa),el.prototype.byteAt=function(e){return this.data.charCodeAt(this.zero+e)},el.prototype.lastIndexOfSignature=function(e){return this.data.lastIndexOf(e)-this.zero},el.prototype.readAndCheckSignature=function(e){return e===this.readData(4)},el.prototype.readData=function(e){this.checkOffset(e);var t=this.data.slice(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t};var tl=el;function il(e){Ja.call(this,e)}or.inherits(il,Ja),il.prototype.readData=function(e){if(this.checkOffset(e),0===e)return new Uint8Array(0);var t=this.data.subarray(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t};var rl=il;function nl(e){rl.call(this,e)}or.inherits(nl,rl),nl.prototype.readData=function(e){this.checkOffset(e);var t=this.data.slice(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t};var ol=nl,sl=function(e){var t=or.getTypeOf(e);return or.checkSupport(t),"string"!==t||Xt.uint8array?"nodebuffer"===t?new ol(e):Xt.uint8array?new rl(or.transformTo("uint8array",e)):new Ja(or.transformTo("array",e)):new tl(e)};function al(e,t){this.options=e,this.loadOptions=t}al.prototype={isEncrypted:function(){return!(1&~this.bitFlag)},useUTF8:function(){return!(2048&~this.bitFlag)},readLocalPart:function(e){var t,i;if(e.skip(22),this.fileNameLength=e.readInt(2),i=e.readInt(2),this.fileName=e.readData(this.fileNameLength),e.skip(i),-1===this.compressedSize||-1===this.uncompressedSize)throw new Error("Bug or corrupted zip : didn't get enough informations from the central directory (compressedSize === -1 || uncompressedSize === -1)");if(null===(t=function(e){for(var t in Ma)if(Ma.hasOwnProperty(t)&&Ma[t].magic===e)return Ma[t];return null}(this.compressionMethod)))throw new Error("Corrupted zip : compression "+or.pretty(this.compressionMethod)+" unknown (inner file : "+or.transformTo("string",this.fileName)+")");this.decompressed=new Er(this.compressedSize,this.uncompressedSize,this.crc32,t,e.readData(this.compressedSize))},readCentralPart:function(e){this.versionMadeBy=e.readInt(2),e.skip(2),this.bitFlag=e.readInt(2),this.compressionMethod=e.readString(2),this.date=e.readDate(),this.crc32=e.readInt(4),this.compressedSize=e.readInt(4),this.uncompressedSize=e.readInt(4);var t=e.readInt(2);if(this.extraFieldsLength=e.readInt(2),this.fileCommentLength=e.readInt(2),this.diskNumberStart=e.readInt(2),this.internalFileAttributes=e.readInt(2),this.externalFileAttributes=e.readInt(4),this.localHeaderOffset=e.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");e.skip(t),this.readExtraFields(e),this.parseZIP64ExtraField(e),this.fileComment=e.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var e=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),0===e&&(this.dosPermissions=63&this.externalFileAttributes),3===e&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||"/"!==this.fileNameStr.slice(-1)||(this.dir=!0)},parseZIP64ExtraField:function(e){if(this.extraFields[1]){var t=sl(this.extraFields[1].value);this.uncompressedSize===or.MAX_VALUE_32BITS&&(this.uncompressedSize=t.readInt(8)),this.compressedSize===or.MAX_VALUE_32BITS&&(this.compressedSize=t.readInt(8)),this.localHeaderOffset===or.MAX_VALUE_32BITS&&(this.localHeaderOffset=t.readInt(8)),this.diskNumberStart===or.MAX_VALUE_32BITS&&(this.diskNumberStart=t.readInt(4))}},readExtraFields:function(e){var t,i,r,n=e.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});e.index<n;)t=e.readInt(2),i=e.readInt(2),r=e.readData(i),this.extraFields[t]={id:t,length:i,value:r}},handleUTF8:function(){var e=Xt.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=lr.utf8decode(this.fileName),this.fileCommentStr=lr.utf8decode(this.fileComment);else{var t=this.findExtraFieldUnicodePath();if(null!==t)this.fileNameStr=t;else{var i=or.transformTo(e,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(i)}var r=this.findExtraFieldUnicodeComment();if(null!==r)this.fileCommentStr=r;else{var n=or.transformTo(e,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(n)}}},findExtraFieldUnicodePath:function(){var e=this.extraFields[28789];if(e){var t=sl(e.value);return 1!==t.readInt(1)||Tr(this.fileName)!==t.readInt(4)?null:lr.utf8decode(t.readData(e.length-5))}return null},findExtraFieldUnicodeComment:function(){var e=this.extraFields[25461];if(e){var t=sl(e.value);return 1!==t.readInt(1)||Tr(this.fileComment)!==t.readInt(4)?null:lr.utf8decode(t.readData(e.length-5))}return null}};var ll=al;function cl(e){this.files=[],this.loadOptions=e}cl.prototype={checkSignature:function(e){if(!this.reader.readAndCheckSignature(e)){this.reader.index-=4;var t=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+or.pretty(t)+", expected "+or.pretty(e)+")")}},isSignature:function(e,t){var i=this.reader.index;this.reader.setIndex(e);var r=this.reader.readString(4)===t;return this.reader.setIndex(i),r},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var e=this.reader.readData(this.zipCommentLength),t=Xt.uint8array?"uint8array":"array",i=or.transformTo(t,e);this.zipComment=this.loadOptions.decodeFileName(i)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var e,t,i,r=this.zip64EndOfCentralSize-44;0<r;)e=this.reader.readInt(2),t=this.reader.readInt(4),i=this.reader.readData(t),this.zip64ExtensibleData[e]={id:e,length:t,value:i}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),this.disksCount>1)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var e,t;for(e=0;e<this.files.length;e++)t=this.files[e],this.reader.setIndex(t.localHeaderOffset),this.checkSignature(Ia),t.readLocalPart(this.reader),t.handleUTF8(),t.processAttributes()},readCentralDir:function(){var e;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(Pa);)(e=new ll({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(e);if(this.centralDirRecords!==this.files.length&&0!==this.centralDirRecords&&0===this.files.length)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var e=this.reader.lastIndexOfSignature(La);if(e<0)throw this.isSignature(0,Ia)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(e);var t=e;if(this.checkSignature(La),this.readBlockEndOfCentral(),this.diskNumber===or.MAX_VALUE_16BITS||this.diskWithCentralDirStart===or.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===or.MAX_VALUE_16BITS||this.centralDirRecords===or.MAX_VALUE_16BITS||this.centralDirSize===or.MAX_VALUE_32BITS||this.centralDirOffset===or.MAX_VALUE_32BITS){if(this.zip64=!0,(e=this.reader.lastIndexOfSignature(Fa))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(e),this.checkSignature(Fa),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,ka)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(ka),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(ka),this.readBlockZip64EndOfCentral()}var i=this.centralDirOffset+this.centralDirSize;this.zip64&&(i+=20,i+=12+this.zip64EndOfCentralSize);var r=t-i;if(r>0)this.isSignature(t,Pa)||(this.reader.zero=r);else if(r<0)throw new Error("Corrupted zip: missing "+Math.abs(r)+" bytes.")},prepareReader:function(e){this.reader=sl(e)},load:function(e){this.prepareReader(e),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}};var ul=cl;function hl(e){return new nr.Promise((function(t,i){var r=e.decompressed.getContentWorker().pipe(new Cr);r.on("error",(function(e){i(e)})).on("end",(function(){r.streamInfo.crc32!==e.decompressed.crc32?i(new Error("Corrupted zip : CRC32 mismatch")):t()})).resume()}))}function dl(){if(!(this instanceof dl))return new dl;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files={},this.comment=null,this.root="",this.clone=function(){var e=new dl;for(var t in this)"function"!=typeof this[t]&&(e[t]=this[t]);return e}}dl.prototype=Ka,dl.prototype.loadAsync=function(e,t){var i=this;return t=or.extend(t||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:lr.utf8decode}),ri(e)?nr.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):or.prepareContent("the loaded zip file",e,!0,t.optimizedBinaryString,t.base64).then((function(e){var i=new ul(t);return i.load(e),i})).then((function(e){var i=[nr.Promise.resolve(e)],r=e.files;if(t.checkCRC32)for(var n=0;n<r.length;n++)i.push(hl(r[n]));return nr.Promise.all(i)})).then((function(e){for(var r=e.shift(),n=r.files,o=0;o<n.length;o++){var s=n[o];i.file(s.fileNameStr,s.decompressed,{binary:!0,optimizedBinaryString:!0,date:s.date,dir:s.dir,comment:s.fileCommentStr.length?s.fileCommentStr:null,unixPermissions:s.unixPermissions,dosPermissions:s.dosPermissions,createFolders:t.createFolders})}return r.zipComment.length&&(i.comment=r.zipComment),i}))},dl.support=Xt,dl.defaults=_r,dl.version="3.1.5",dl.loadAsync=function(e,t){return(new dl).loadAsync(e,t)},dl.external=nr;var pl=dl;function fl(e){return null==e}var Al={isNothing:fl,isObject:function(e){return"object"==typeof e&&null!==e},toArray:function(e){return Array.isArray(e)?e:fl(e)?[]:[e]},repeat:function(e,t){var i,r="";for(i=0;i<t;i+=1)r+=e;return r},isNegativeZero:function(e){return 0===e&&Number.NEGATIVE_INFINITY===1/e},extend:function(e,t){var i,r,n,o;if(t)for(i=0,r=(o=Object.keys(t)).length;i<r;i+=1)e[n=o[i]]=t[n];return e}};function ml(e,t){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack||"",this.name="YAMLException",this.reason=e,this.mark=t,this.message=(this.reason||"(unknown reason)")+(this.mark?" "+this.mark.toString():"")}ml.prototype=Object.create(Error.prototype),ml.prototype.constructor=ml,ml.prototype.toString=function(e){var t=this.name+": ";return t+=this.reason||"(unknown reason)",!e&&this.mark&&(t+=" "+this.mark.toString()),t};var gl=ml;function _l(e,t,i,r,n){this.name=e,this.buffer=t,this.position=i,this.line=r,this.column=n}_l.prototype.getSnippet=function(e,t){var i,r,n,o,s;if(!this.buffer)return null;for(e=e||4,t=t||75,i="",r=this.position;r>0&&-1==="\0\r\n\u2028\u2029".indexOf(this.buffer.charAt(r-1));)if(r-=1,this.position-r>t/2-1){i=" ... ",r+=5;break}for(n="",o=this.position;o<this.buffer.length&&-1==="\0\r\n\u2028\u2029".indexOf(this.buffer.charAt(o));)if((o+=1)-this.position>t/2-1){n=" ... ",o-=5;break}return s=this.buffer.slice(r,o),Al.repeat(" ",e)+i+s+n+"\n"+Al.repeat(" ",e+this.position-r+i.length)+"^"},_l.prototype.toString=function(e){var t,i="";return this.name&&(i+='in "'+this.name+'" '),i+="at line "+(this.line+1)+", column "+(this.column+1),e||(t=this.getSnippet())&&(i+=":\n"+t),i};var yl=_l,vl=["kind","resolve","construct","instanceOf","predicate","represent","defaultStyle","styleAliases"],xl=["scalar","sequence","mapping"],bl=function(e,t){var i,r;if(t=t||{},Object.keys(t).forEach((function(t){if(-1===vl.indexOf(t))throw new gl('Unknown option "'+t+'" is met in definition of "'+e+'" YAML type.')})),this.tag=e,this.kind=t.kind||null,this.resolve=t.resolve||function(){return!0},this.construct=t.construct||function(e){return e},this.instanceOf=t.instanceOf||null,this.predicate=t.predicate||null,this.represent=t.represent||null,this.defaultStyle=t.defaultStyle||null,this.styleAliases=(i=t.styleAliases||null,r={},null!==i&&Object.keys(i).forEach((function(e){i[e].forEach((function(t){r[String(t)]=e}))})),r),-1===xl.indexOf(this.kind))throw new gl('Unknown kind "'+this.kind+'" is specified for "'+e+'" YAML type.')};function wl(e,t,i){var r=[];return e.include.forEach((function(e){i=wl(e,t,i)})),e[t].forEach((function(e){i.forEach((function(t,i){t.tag===e.tag&&r.push(i)})),i.push(e)})),i.filter((function(e,t){return-1===r.indexOf(t)}))}function Tl(e){this.include=e.include||[],this.implicit=e.implicit||[],this.explicit=e.explicit||[],this.implicit.forEach((function(e){if(e.loadKind&&"scalar"!==e.loadKind)throw new gl("There is a non-scalar type in the implicit list of a schema. Implicit resolving of such types is not supported.")})),this.compiledImplicit=wl(this,"implicit",[]),this.compiledExplicit=wl(this,"explicit",[]),this.compiledTypeMap=function(){var e,t,i={};function r(e){i[e.tag]=e}for(e=0,t=arguments.length;e<t;e+=1)arguments[e].forEach(r);return i}(this.compiledImplicit,this.compiledExplicit)}Tl.DEFAULT=null,Tl.create=function(){var e,t;switch(arguments.length){case 1:e=Tl.DEFAULT,t=arguments[0];break;case 2:e=arguments[0],t=arguments[1];break;default:throw new gl("Wrong number of arguments for Schema.create function")}if(e=Al.toArray(e),t=Al.toArray(t),!e.every((function(e){return e instanceof Tl})))throw new gl("Specified list of super schemas (or a single Schema object) contains a non-Schema object.");if(!t.every((function(e){return e instanceof bl})))throw new gl("Specified list of YAML types (or a single Type object) contains a non-Type object.");return new Tl({include:e,explicit:t})};var Bl=Tl,Cl=new Bl({explicit:[new bl("tag:yaml.org,2002:str",{kind:"scalar",construct:function(e){return null!==e?e:""}}),new bl("tag:yaml.org,2002:seq",{kind:"sequence",construct:function(e){return null!==e?e:[]}}),new bl("tag:yaml.org,2002:map",{kind:"mapping",construct:function(e){return null!==e?e:{}}})]}),Sl=new bl("tag:yaml.org,2002:null",{kind:"scalar",resolve:function(e){if(null===e)return!0;var t=e.length;return 1===t&&"~"===e||4===t&&("null"===e||"Null"===e||"NULL"===e)},construct:function(){return null},predicate:function(e){return null===e},represent:{canonical:function(){return"~"},lowercase:function(){return"null"},uppercase:function(){return"NULL"},camelcase:function(){return"Null"}},defaultStyle:"lowercase"}),El=new bl("tag:yaml.org,2002:bool",{kind:"scalar",resolve:function(e){if(null===e)return!1;var t=e.length;return 4===t&&("true"===e||"True"===e||"TRUE"===e)||5===t&&("false"===e||"False"===e||"FALSE"===e)},construct:function(e){return"true"===e||"True"===e||"TRUE"===e},predicate:function(e){return"[object Boolean]"===Object.prototype.toString.call(e)},represent:{lowercase:function(e){return e?"true":"false"},uppercase:function(e){return e?"TRUE":"FALSE"},camelcase:function(e){return e?"True":"False"}},defaultStyle:"lowercase"});function Ml(e){return 48<=e&&e<=55}function Il(e){return 48<=e&&e<=57}var Pl,Ll=new bl("tag:yaml.org,2002:int",{kind:"scalar",resolve:function(e){if(null===e)return!1;var t,i,r=e.length,n=0,o=!1;if(!r)return!1;if("-"!==(t=e[n])&&"+"!==t||(t=e[++n]),"0"===t){if(n+1===r)return!0;if("b"===(t=e[++n])){for(n++;n<r;n++)if("_"!==(t=e[n])){if("0"!==t&&"1"!==t)return!1;o=!0}return o}if("x"===t){for(n++;n<r;n++)if("_"!==(t=e[n])){if(!(48<=(i=e.charCodeAt(n))&&i<=57||65<=i&&i<=70||97<=i&&i<=102))return!1;o=!0}return o}for(;n<r;n++)if("_"!==(t=e[n])){if(!Ml(e.charCodeAt(n)))return!1;o=!0}return o}for(;n<r;n++)if("_"!==(t=e[n])){if(":"===t)break;if(!Il(e.charCodeAt(n)))return!1;o=!0}return!!o&&(":"!==t||/^(:[0-5]?[0-9])+$/.test(e.slice(n)))},construct:function(e){var t,i,r=e,n=1,o=[];return-1!==r.indexOf("_")&&(r=r.replace(/_/g,"")),"-"!==(t=r[0])&&"+"!==t||("-"===t&&(n=-1),t=(r=r.slice(1))[0]),"0"===r?0:"0"===t?"b"===r[1]?n*parseInt(r.slice(2),2):"x"===r[1]?n*parseInt(r,16):n*parseInt(r,8):-1!==r.indexOf(":")?(r.split(":").forEach((function(e){o.unshift(parseInt(e,10))})),r=0,i=1,o.forEach((function(e){r+=e*i,i*=60})),n*r):n*parseInt(r,10)},predicate:function(e){return"[object Number]"===Object.prototype.toString.call(e)&&e%1==0&&!Al.isNegativeZero(e)},represent:{binary:function(e){return"0b"+e.toString(2)},octal:function(e){return"0"+e.toString(8)},decimal:function(e){return e.toString(10)},hexadecimal:function(e){return"0x"+e.toString(16).toUpperCase()}},defaultStyle:"decimal",styleAliases:{binary:[2,"bin"],octal:[8,"oct"],decimal:[10,"dec"],hexadecimal:[16,"hex"]}}),Fl=new RegExp("^(?:[-+]?(?:[0-9][0-9_]*)\\.[0-9_]*(?:[eE][-+][0-9]+)?|\\.[0-9_]+(?:[eE][-+][0-9]+)?|[-+]?[0-9][0-9_]*(?::[0-5]?[0-9])+\\.[0-9_]*|[-+]?\\.(?:inf|Inf|INF)|\\.(?:nan|NaN|NAN))$"),kl=/^[-+]?[0-9]+e/,zl=new Bl({include:[Cl],implicit:[Sl,El,Ll,new bl("tag:yaml.org,2002:float",{kind:"scalar",resolve:function(e){return null!==e&&!!Fl.test(e)},construct:function(e){var t,i,r,n;return i="-"===(t=e.replace(/_/g,"").toLowerCase())[0]?-1:1,n=[],"+-".indexOf(t[0])>=0&&(t=t.slice(1)),".inf"===t?1===i?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY:".nan"===t?NaN:t.indexOf(":")>=0?(t.split(":").forEach((function(e){n.unshift(parseFloat(e,10))})),t=0,r=1,n.forEach((function(e){t+=e*r,r*=60})),i*t):i*parseFloat(t,10)},predicate:function(e){return"[object Number]"===Object.prototype.toString.call(e)&&(e%1!=0||Al.isNegativeZero(e))},represent:function(e,t){var i;if(isNaN(e))switch(t){case"lowercase":return".nan";case"uppercase":return".NAN";case"camelcase":return".NaN"}else if(Number.POSITIVE_INFINITY===e)switch(t){case"lowercase":return".inf";case"uppercase":return".INF";case"camelcase":return".Inf"}else if(Number.NEGATIVE_INFINITY===e)switch(t){case"lowercase":return"-.inf";case"uppercase":return"-.INF";case"camelcase":return"-.Inf"}else if(Al.isNegativeZero(e))return"-0.0";return i=e.toString(10),kl.test(i)?i.replace("e",".e"):i},defaultStyle:"lowercase"})]}),Rl=new Bl({include:[zl]}),Dl=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9]?)-([0-9][0-9]?)(?:(?:[Tt]|[ \\t]+)([0-9][0-9]?):([0-9][0-9]):([0-9][0-9])(?:\\.([0-9]*))?(?:[ \\t]*(Z|([-+])([0-9][0-9]?)(?::([0-9][0-9]))?))?)?$"),Ol=new bl("tag:yaml.org,2002:timestamp",{kind:"scalar",resolve:function(e){return null!==e&&null!==Dl.exec(e)},construct:function(e){var t,i,r,n,o,s,a,l,c=0,u=null;if(null===(t=Dl.exec(e)))throw new Error("Date resolve error");if(i=+t[1],r=+t[2]-1,n=+t[3],!t[4])return new Date(Date.UTC(i,r,n));if(o=+t[4],s=+t[5],a=+t[6],t[7]){for(c=t[7].slice(0,3);c.length<3;)c+="0";c=+c}return t[9]&&(u=6e4*(60*+t[10]+ +(t[11]||0)),"-"===t[9]&&(u=-u)),l=new Date(Date.UTC(i,r,n,o,s,a,c)),u&&l.setTime(l.getTime()-u),l},instanceOf:Date,represent:function(e){return e.toISOString()}}),Ul=new bl("tag:yaml.org,2002:merge",{kind:"scalar",resolve:function(e){return"<<"===e||null===e}}),Nl={}.Buffer,Ql="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\n\r",jl=new bl("tag:yaml.org,2002:binary",{kind:"scalar",resolve:function(e){if(null===e)return!1;var t,i,r=0,n=e.length,o=Ql;for(i=0;i<n;i++)if(!((t=o.indexOf(e.charAt(i)))>64)){if(t<0)return!1;r+=6}return r%8==0},construct:function(e){var t,i,r=e.replace(/[\r\n=]/g,""),n=r.length,o=Ql,s=0,a=[];for(t=0;t<n;t++)t%4==0&&t&&(a.push(s>>16&255),a.push(s>>8&255),a.push(255&s)),s=s<<6|o.indexOf(r.charAt(t));return 0==(i=n%4*6)?(a.push(s>>16&255),a.push(s>>8&255),a.push(255&s)):18===i?(a.push(s>>10&255),a.push(s>>2&255)):12===i&&a.push(s>>4&255),a},predicate:function(e){return Nl},represent:function(e){var t,i,r="",n=0,o=e.length,s=Ql;for(t=0;t<o;t++)t%3==0&&t&&(r+=s[n>>18&63],r+=s[n>>12&63],r+=s[n>>6&63],r+=s[63&n]),n=(n<<8)+e[t];return 0==(i=o%3)?(r+=s[n>>18&63],r+=s[n>>12&63],r+=s[n>>6&63],r+=s[63&n]):2===i?(r+=s[n>>10&63],r+=s[n>>4&63],r+=s[n<<2&63],r+=s[64]):1===i&&(r+=s[n>>2&63],r+=s[n<<4&63],r+=s[64],r+=s[64]),r}}),Vl=Object.prototype.hasOwnProperty,Hl=Object.prototype.toString,Gl=new bl("tag:yaml.org,2002:omap",{kind:"sequence",resolve:function(e){if(null===e)return!0;var t,i,r,n,o,s=[],a=e;for(t=0,i=a.length;t<i;t+=1){if(r=a[t],o=!1,"[object Object]"!==Hl.call(r))return!1;for(n in r)if(Vl.call(r,n)){if(o)return!1;o=!0}if(!o)return!1;if(-1!==s.indexOf(n))return!1;s.push(n)}return!0},construct:function(e){return null!==e?e:[]}}),$l=Object.prototype.toString,Zl=new bl("tag:yaml.org,2002:pairs",{kind:"sequence",resolve:function(e){if(null===e)return!0;var t,i,r,n,o,s=e;for(o=new Array(s.length),t=0,i=s.length;t<i;t+=1){if(r=s[t],"[object Object]"!==$l.call(r))return!1;if(1!==(n=Object.keys(r)).length)return!1;o[t]=[n[0],r[n[0]]]}return!0},construct:function(e){if(null===e)return[];var t,i,r,n,o,s=e;for(o=new Array(s.length),t=0,i=s.length;t<i;t+=1)r=s[t],n=Object.keys(r),o[t]=[n[0],r[n[0]]];return o}}),ql=Object.prototype.hasOwnProperty,Kl=new Bl({include:[Rl],implicit:[Ol,Ul],explicit:[jl,Gl,Zl,new bl("tag:yaml.org,2002:set",{kind:"mapping",resolve:function(e){if(null===e)return!0;var t,i=e;for(t in i)if(ql.call(i,t)&&null!==i[t])return!1;return!0},construct:function(e){return null!==e?e:{}}})]}),Wl=new bl("tag:yaml.org,2002:js/undefined",{kind:"scalar",resolve:function(){return!0},construct:function(){},predicate:function(e){return void 0===e},represent:function(){return""}}),Xl=new bl("tag:yaml.org,2002:js/regexp",{kind:"scalar",resolve:function(e){if(null===e)return!1;if(0===e.length)return!1;var t=e,i=/\/([gim]*)$/.exec(e),r="";if("/"===t[0]){if(i&&(r=i[1]),r.length>3)return!1;if("/"!==t[t.length-r.length-1])return!1}return!0},construct:function(e){var t=e,i=/\/([gim]*)$/.exec(e),r="";return"/"===t[0]&&(i&&(r=i[1]),t=t.slice(1,t.length-r.length-1)),new RegExp(t,r)},predicate:function(e){return"[object RegExp]"===Object.prototype.toString.call(e)},represent:function(e){var t="/"+e.source+"/";return e.global&&(t+="g"),e.multiline&&(t+="m"),e.ignoreCase&&(t+="i"),t}});try{var Yl=e.commonjsRequire;Pl=Yl("esprima")}catch(e){"undefined"!=typeof window&&(Pl=window.esprima)}var Jl=new bl("tag:yaml.org,2002:js/function",{kind:"scalar",resolve:function(e){if(null===e)return!1;try{var t="("+e+")",i=Pl.parse(t,{range:!0});return"Program"===i.type&&1===i.body.length&&"ExpressionStatement"===i.body[0].type&&"FunctionExpression"===i.body[0].expression.type}catch(e){return!1}},construct:function(e){var t,i="("+e+")",r=Pl.parse(i,{range:!0}),n=[];if("Program"!==r.type||1!==r.body.length||"ExpressionStatement"!==r.body[0].type||"FunctionExpression"!==r.body[0].expression.type)throw new Error("Failed to resolve function");return r.body[0].expression.params.forEach((function(e){n.push(e.name)})),t=r.body[0].expression.body.range,new Function(n,i.slice(t[0]+1,t[1]-1))},predicate:function(e){return"[object Function]"===Object.prototype.toString.call(e)},represent:function(e){return e.toString()}}),ec=Bl.DEFAULT=new Bl({include:[Kl],explicit:[Wl,Xl,Jl]}),tc=Object.prototype.hasOwnProperty,ic=1,rc=2,nc=3,oc=4,sc=1,ac=2,lc=3,cc=/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F-\x84\x86-\x9F\uFFFE\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/,uc=/[\x85\u2028\u2029]/,hc=/[,\[\]\{\}]/,dc=/^(?:!|!!|![a-z\-]+!)$/i,pc=/^(?:!|[^,\[\]\{\}])(?:%[0-9a-f]{2}|[0-9a-z\-#;\/\?:@&=\+\$,_\.!~\*'\(\)\[\]])*$/i;function fc(e){return 10===e||13===e}function Ac(e){return 9===e||32===e}function mc(e){return 9===e||32===e||10===e||13===e}function gc(e){return 44===e||91===e||93===e||123===e||125===e}function _c(e){var t;return 48<=e&&e<=57?e-48:97<=(t=32|e)&&t<=102?t-97+10:-1}function yc(e){return 48===e?"\0":97===e?"":98===e?"\b":116===e||9===e?"\t":110===e?"\n":118===e?"\v":102===e?"\f":114===e?"\r":101===e?"":32===e?" ":34===e?'"':47===e?"/":92===e?"\\":78===e?"":95===e?"":76===e?"\u2028":80===e?"\u2029":""}function vc(e){return e<=65535?String.fromCharCode(e):String.fromCharCode(55296+(e-65536>>10),56320+(e-65536&1023))}for(var xc=new Array(256),bc=new Array(256),wc=0;wc<256;wc++)xc[wc]=yc(wc)?1:0,bc[wc]=yc(wc);function Tc(e,t){this.input=e,this.filename=t.filename||null,this.schema=t.schema||ec,this.onWarning=t.onWarning||null,this.legacy=t.legacy||!1,this.json=t.json||!1,this.listener=t.listener||null,this.implicitTypes=this.schema.compiledImplicit,this.typeMap=this.schema.compiledTypeMap,this.length=e.length,this.position=0,this.line=0,this.lineStart=0,this.lineIndent=0,this.documents=[]}function Bc(e,t){return new gl(t,new yl(e.filename,e.input,e.position,e.line,e.position-e.lineStart))}function Cc(e,t){throw Bc(e,t)}function Sc(e,t){e.onWarning&&e.onWarning.call(null,Bc(e,t))}var Ec={YAML:function(e,t,i){var r,n,o;null!==e.version&&Cc(e,"duplication of %YAML directive"),1!==i.length&&Cc(e,"YAML directive accepts exactly one argument"),null===(r=/^([0-9]+)\.([0-9]+)$/.exec(i[0]))&&Cc(e,"ill-formed argument of the YAML directive"),n=parseInt(r[1],10),o=parseInt(r[2],10),1!==n&&Cc(e,"unacceptable YAML version of the document"),e.version=i[0],e.checkLineBreaks=o<2,1!==o&&2!==o&&Sc(e,"unsupported YAML version of the document")},TAG:function(e,t,i){var r,n;2!==i.length&&Cc(e,"TAG directive accepts exactly two arguments"),r=i[0],n=i[1],dc.test(r)||Cc(e,"ill-formed tag handle (first argument) of the TAG directive"),tc.call(e.tagMap,r)&&Cc(e,'there is a previously declared suffix for "'+r+'" tag handle'),pc.test(n)||Cc(e,"ill-formed tag prefix (second argument) of the TAG directive"),e.tagMap[r]=n}};function Mc(e,t,i,r){var n,o,s,a;if(t<i){if(a=e.input.slice(t,i),r)for(n=0,o=a.length;n<o;n+=1)9===(s=a.charCodeAt(n))||32<=s&&s<=1114111||Cc(e,"expected valid JSON character");else cc.test(a)&&Cc(e,"the stream contains non-printable characters");e.result+=a}}function Ic(e,t,i,r){var n,o,s,a;for(Al.isObject(i)||Cc(e,"cannot merge mappings; the provided source object is unacceptable"),s=0,a=(n=Object.keys(i)).length;s<a;s+=1)o=n[s],tc.call(t,o)||(t[o]=i[o],r[o]=!0)}function Pc(e,t,i,r,n,o){var s,a;if(n=String(n),null===t&&(t={}),"tag:yaml.org,2002:merge"===r)if(Array.isArray(o))for(s=0,a=o.length;s<a;s+=1)Ic(e,t,o[s],i);else Ic(e,t,o,i);else e.json||tc.call(i,n)||!tc.call(t,n)||Cc(e,"duplicated mapping key"),t[n]=o,delete i[n];return t}function Lc(e){var t;10===(t=e.input.charCodeAt(e.position))?e.position++:13===t?(e.position++,10===e.input.charCodeAt(e.position)&&e.position++):Cc(e,"a line break is expected"),e.line+=1,e.lineStart=e.position}function Fc(e,t,i){for(var r=0,n=e.input.charCodeAt(e.position);0!==n;){for(;Ac(n);)n=e.input.charCodeAt(++e.position);if(t&&35===n)do{n=e.input.charCodeAt(++e.position)}while(10!==n&&13!==n&&0!==n);if(!fc(n))break;for(Lc(e),n=e.input.charCodeAt(e.position),r++,e.lineIndent=0;32===n;)e.lineIndent++,n=e.input.charCodeAt(++e.position)}return-1!==i&&0!==r&&e.lineIndent<i&&Sc(e,"deficient indentation"),r}function kc(e){var t,i=e.position;return!(45!==(t=e.input.charCodeAt(i))&&46!==t||t!==e.input.charCodeAt(i+1)||t!==e.input.charCodeAt(i+2)||(i+=3,0!==(t=e.input.charCodeAt(i))&&!mc(t)))}function zc(e,t){1===t?e.result+=" ":t>1&&(e.result+=Al.repeat("\n",t-1))}function Rc(e,t){var i,r,n=e.tag,o=e.anchor,s=[],a=!1;for(null!==e.anchor&&(e.anchorMap[e.anchor]=s),r=e.input.charCodeAt(e.position);0!==r&&45===r&&mc(e.input.charCodeAt(e.position+1));)if(a=!0,e.position++,Fc(e,!0,-1)&&e.lineIndent<=t)s.push(null),r=e.input.charCodeAt(e.position);else if(i=e.line,Uc(e,t,nc,!1,!0),s.push(e.result),Fc(e,!0,-1),r=e.input.charCodeAt(e.position),(e.line===i||e.lineIndent>t)&&0!==r)Cc(e,"bad indentation of a sequence entry");else if(e.lineIndent<t)break;return!!a&&(e.tag=n,e.anchor=o,e.kind="sequence",e.result=s,!0)}function Dc(e){var t,i,r,n,o=!1,s=!1;if(33!==(n=e.input.charCodeAt(e.position)))return!1;if(null!==e.tag&&Cc(e,"duplication of a tag property"),60===(n=e.input.charCodeAt(++e.position))?(o=!0,n=e.input.charCodeAt(++e.position)):33===n?(s=!0,i="!!",n=e.input.charCodeAt(++e.position)):i="!",t=e.position,o){do{n=e.input.charCodeAt(++e.position)}while(0!==n&&62!==n);e.position<e.length?(r=e.input.slice(t,e.position),n=e.input.charCodeAt(++e.position)):Cc(e,"unexpected end of the stream within a verbatim tag")}else{for(;0!==n&&!mc(n);)33===n&&(s?Cc(e,"tag suffix cannot contain exclamation marks"):(i=e.input.slice(t-1,e.position+1),dc.test(i)||Cc(e,"named tag handle cannot contain such characters"),s=!0,t=e.position+1)),n=e.input.charCodeAt(++e.position);r=e.input.slice(t,e.position),hc.test(r)&&Cc(e,"tag suffix cannot contain flow indicator characters")}return r&&!pc.test(r)&&Cc(e,"tag name cannot contain such characters: "+r),o?e.tag=r:tc.call(e.tagMap,i)?e.tag=e.tagMap[i]+r:"!"===i?e.tag="!"+r:"!!"===i?e.tag="tag:yaml.org,2002:"+r:Cc(e,'undeclared tag handle "'+i+'"'),!0}function Oc(e){var t,i;if(38!==(i=e.input.charCodeAt(e.position)))return!1;for(null!==e.anchor&&Cc(e,"duplication of an anchor property"),i=e.input.charCodeAt(++e.position),t=e.position;0!==i&&!mc(i)&&!gc(i);)i=e.input.charCodeAt(++e.position);return e.position===t&&Cc(e,"name of an anchor node must contain at least one character"),e.anchor=e.input.slice(t,e.position),!0}function Uc(e,t,i,r,n){var o,s,a,l,c,u,h,d,p=1,f=!1,A=!1;if(null!==e.listener&&e.listener("open",e),e.tag=null,e.anchor=null,e.kind=null,e.result=null,o=s=a=oc===i||nc===i,r&&Fc(e,!0,-1)&&(f=!0,e.lineIndent>t?p=1:e.lineIndent===t?p=0:e.lineIndent<t&&(p=-1)),1===p)for(;Dc(e)||Oc(e);)Fc(e,!0,-1)?(f=!0,a=o,e.lineIndent>t?p=1:e.lineIndent===t?p=0:e.lineIndent<t&&(p=-1)):a=!1;if(a&&(a=f||n),1!==p&&oc!==i||(h=ic===i||rc===i?t:t+1,d=e.position-e.lineStart,1===p?a&&(Rc(e,d)||function(e,t,i){var r,n,o,s,a=e.tag,l=e.anchor,c={},u={},h=null,d=null,p=null,f=!1,A=!1;for(null!==e.anchor&&(e.anchorMap[e.anchor]=c),s=e.input.charCodeAt(e.position);0!==s;){if(r=e.input.charCodeAt(e.position+1),o=e.line,63!==s&&58!==s||!mc(r)){if(!Uc(e,i,rc,!1,!0))break;if(e.line===o){for(s=e.input.charCodeAt(e.position);Ac(s);)s=e.input.charCodeAt(++e.position);if(58===s)mc(s=e.input.charCodeAt(++e.position))||Cc(e,"a whitespace character is expected after the key-value separator within a block mapping"),f&&(Pc(e,c,u,h,d,null),h=d=p=null),A=!0,f=!1,n=!1,h=e.tag,d=e.result;else{if(!A)return e.tag=a,e.anchor=l,!0;Cc(e,"can not read an implicit mapping pair; a colon is missed")}}else{if(!A)return e.tag=a,e.anchor=l,!0;Cc(e,"can not read a block mapping entry; a multiline key may not be an implicit key")}}else 63===s?(f&&(Pc(e,c,u,h,d,null),h=d=p=null),A=!0,f=!0,n=!0):f?(f=!1,n=!0):Cc(e,"incomplete explicit mapping pair; a key node is missed"),e.position+=1,s=r;if((e.line===o||e.lineIndent>t)&&(Uc(e,t,oc,!0,n)&&(f?d=e.result:p=e.result),f||(Pc(e,c,u,h,d,p),h=d=p=null),Fc(e,!0,-1),s=e.input.charCodeAt(e.position)),e.lineIndent>t&&0!==s)Cc(e,"bad indentation of a mapping entry");else if(e.lineIndent<t)break}return f&&Pc(e,c,u,h,d,null),A&&(e.tag=a,e.anchor=l,e.kind="mapping",e.result=c),A}(e,d,h))||function(e,t){var i,r,n,o,s,a,l,c,u,h,d=!0,p=e.tag,f=e.anchor,A={};if(91===(h=e.input.charCodeAt(e.position)))n=93,a=!1,r=[];else{if(123!==h)return!1;n=125,a=!0,r={}}for(null!==e.anchor&&(e.anchorMap[e.anchor]=r),h=e.input.charCodeAt(++e.position);0!==h;){if(Fc(e,!0,t),(h=e.input.charCodeAt(e.position))===n)return e.position++,e.tag=p,e.anchor=f,e.kind=a?"mapping":"sequence",e.result=r,!0;d||Cc(e,"missed comma between flow collection entries"),u=null,o=s=!1,63===h&&mc(e.input.charCodeAt(e.position+1))&&(o=s=!0,e.position++,Fc(e,!0,t)),i=e.line,Uc(e,t,ic,!1,!0),c=e.tag,l=e.result,Fc(e,!0,t),h=e.input.charCodeAt(e.position),!s&&e.line!==i||58!==h||(o=!0,h=e.input.charCodeAt(++e.position),Fc(e,!0,t),Uc(e,t,ic,!1,!0),u=e.result),a?Pc(e,r,A,c,l,u):o?r.push(Pc(e,null,A,c,l,u)):r.push(l),Fc(e,!0,t),44===(h=e.input.charCodeAt(e.position))?(d=!0,h=e.input.charCodeAt(++e.position)):d=!1}Cc(e,"unexpected end of the stream within a flow collection")}(e,h)?A=!0:(s&&function(e,t){var i,r,n,o,s,a=sc,l=!1,c=t,u=0,h=!1;if(124===(o=e.input.charCodeAt(e.position)))r=!1;else{if(62!==o)return!1;r=!0}for(e.kind="scalar",e.result="";0!==o;)if(43===(o=e.input.charCodeAt(++e.position))||45===o)sc===a?a=43===o?lc:ac:Cc(e,"repeat of a chomping mode identifier");else{if(!((n=48<=(s=o)&&s<=57?s-48:-1)>=0))break;0===n?Cc(e,"bad explicit indentation width of a block scalar; it cannot be less than one"):l?Cc(e,"repeat of an indentation width identifier"):(c=t+n-1,l=!0)}if(Ac(o)){do{o=e.input.charCodeAt(++e.position)}while(Ac(o));if(35===o)do{o=e.input.charCodeAt(++e.position)}while(!fc(o)&&0!==o)}for(;0!==o;){for(Lc(e),e.lineIndent=0,o=e.input.charCodeAt(e.position);(!l||e.lineIndent<c)&&32===o;)e.lineIndent++,o=e.input.charCodeAt(++e.position);if(!l&&e.lineIndent>c&&(c=e.lineIndent),fc(o))u++;else{if(e.lineIndent<c){a===lc?e.result+=Al.repeat("\n",u):a===sc&&l&&(e.result+="\n");break}for(r?Ac(o)?(h=!0,e.result+=Al.repeat("\n",u+1)):h?(h=!1,e.result+=Al.repeat("\n",u+1)):0===u?l&&(e.result+=" "):e.result+=Al.repeat("\n",u):e.result+=l?Al.repeat("\n",u+1):Al.repeat("\n",u),l=!0,u=0,i=e.position;!fc(o)&&0!==o;)o=e.input.charCodeAt(++e.position);Mc(e,i,e.position,!1)}}return!0}(e,h)||function(e,t){var i,r,n;if(39!==(i=e.input.charCodeAt(e.position)))return!1;for(e.kind="scalar",e.result="",e.position++,r=n=e.position;0!==(i=e.input.charCodeAt(e.position));)if(39===i){if(Mc(e,r,e.position,!0),39!==(i=e.input.charCodeAt(++e.position)))return!0;r=n=e.position,e.position++}else fc(i)?(Mc(e,r,n,!0),zc(e,Fc(e,!1,t)),r=n=e.position):e.position===e.lineStart&&kc(e)?Cc(e,"unexpected end of the document within a single quoted scalar"):(e.position++,n=e.position);Cc(e,"unexpected end of the stream within a single quoted scalar")}(e,h)||function(e,t){var i,r,n,o,s,a,l;if(34!==(a=e.input.charCodeAt(e.position)))return!1;for(e.kind="scalar",e.result="",e.position++,i=r=e.position;0!==(a=e.input.charCodeAt(e.position));){if(34===a)return Mc(e,i,e.position,!0),e.position++,!0;if(92===a){if(Mc(e,i,e.position,!0),fc(a=e.input.charCodeAt(++e.position)))Fc(e,!1,t);else if(a<256&&xc[a])e.result+=bc[a],e.position++;else if((s=120===(l=a)?2:117===l?4:85===l?8:0)>0){for(n=s,o=0;n>0;n--)(s=_c(a=e.input.charCodeAt(++e.position)))>=0?o=(o<<4)+s:Cc(e,"expected hexadecimal character");e.result+=vc(o),e.position++}else Cc(e,"unknown escape sequence");i=r=e.position}else fc(a)?(Mc(e,i,r,!0),zc(e,Fc(e,!1,t)),i=r=e.position):e.position===e.lineStart&&kc(e)?Cc(e,"unexpected end of the document within a double quoted scalar"):(e.position++,r=e.position)}Cc(e,"unexpected end of the stream within a double quoted scalar")}(e,h)?A=!0:function(e){var t,i,r;if(42!==(r=e.input.charCodeAt(e.position)))return!1;for(r=e.input.charCodeAt(++e.position),t=e.position;0!==r&&!mc(r)&&!gc(r);)r=e.input.charCodeAt(++e.position);return e.position===t&&Cc(e,"name of an alias node must contain at least one character"),i=e.input.slice(t,e.position),e.anchorMap.hasOwnProperty(i)||Cc(e,'unidentified alias "'+i+'"'),e.result=e.anchorMap[i],Fc(e,!0,-1),!0}(e)?(A=!0,null===e.tag&&null===e.anchor||Cc(e,"alias node should not have any properties")):function(e,t,i){var r,n,o,s,a,l,c,u,h=e.kind,d=e.result;if(mc(u=e.input.charCodeAt(e.position))||gc(u)||35===u||38===u||42===u||33===u||124===u||62===u||39===u||34===u||37===u||64===u||96===u)return!1;if((63===u||45===u)&&(mc(r=e.input.charCodeAt(e.position+1))||i&&gc(r)))return!1;for(e.kind="scalar",e.result="",n=o=e.position,s=!1;0!==u;){if(58===u){if(mc(r=e.input.charCodeAt(e.position+1))||i&&gc(r))break}else if(35===u){if(mc(e.input.charCodeAt(e.position-1)))break}else{if(e.position===e.lineStart&&kc(e)||i&&gc(u))break;if(fc(u)){if(a=e.line,l=e.lineStart,c=e.lineIndent,Fc(e,!1,-1),e.lineIndent>=t){s=!0,u=e.input.charCodeAt(e.position);continue}e.position=o,e.line=a,e.lineStart=l,e.lineIndent=c;break}}s&&(Mc(e,n,o,!1),zc(e,e.line-a),n=o=e.position,s=!1),Ac(u)||(o=e.position+1),u=e.input.charCodeAt(++e.position)}return Mc(e,n,o,!1),!!e.result||(e.kind=h,e.result=d,!1)}(e,h,ic===i)&&(A=!0,null===e.tag&&(e.tag="?")),null!==e.anchor&&(e.anchorMap[e.anchor]=e.result)):0===p&&(A=a&&Rc(e,d))),null!==e.tag&&"!"!==e.tag)if("?"===e.tag){for(l=0,c=e.implicitTypes.length;l<c;l+=1)if((u=e.implicitTypes[l]).resolve(e.result)){e.result=u.construct(e.result),e.tag=u.tag,null!==e.anchor&&(e.anchorMap[e.anchor]=e.result);break}}else tc.call(e.typeMap,e.tag)?(u=e.typeMap[e.tag],null!==e.result&&u.kind!==e.kind&&Cc(e,"unacceptable node kind for !<"+e.tag+'> tag; it should be "'+u.kind+'", not "'+e.kind+'"'),u.resolve(e.result)?(e.result=u.construct(e.result),null!==e.anchor&&(e.anchorMap[e.anchor]=e.result)):Cc(e,"cannot resolve a node with !<"+e.tag+"> explicit tag")):Cc(e,"unknown tag !<"+e.tag+">");return null!==e.listener&&e.listener("close",e),null!==e.tag||null!==e.anchor||A}function Nc(e){var t,i,r,n,o=e.position,s=!1;for(e.version=null,e.checkLineBreaks=e.legacy,e.tagMap={},e.anchorMap={};0!==(n=e.input.charCodeAt(e.position))&&(Fc(e,!0,-1),n=e.input.charCodeAt(e.position),!(e.lineIndent>0||37!==n));){for(s=!0,n=e.input.charCodeAt(++e.position),t=e.position;0!==n&&!mc(n);)n=e.input.charCodeAt(++e.position);for(r=[],(i=e.input.slice(t,e.position)).length<1&&Cc(e,"directive name must not be less than one character in length");0!==n;){for(;Ac(n);)n=e.input.charCodeAt(++e.position);if(35===n){do{n=e.input.charCodeAt(++e.position)}while(0!==n&&!fc(n));break}if(fc(n))break;for(t=e.position;0!==n&&!mc(n);)n=e.input.charCodeAt(++e.position);r.push(e.input.slice(t,e.position))}0!==n&&Lc(e),tc.call(Ec,i)?Ec[i](e,i,r):Sc(e,'unknown document directive "'+i+'"')}Fc(e,!0,-1),0===e.lineIndent&&45===e.input.charCodeAt(e.position)&&45===e.input.charCodeAt(e.position+1)&&45===e.input.charCodeAt(e.position+2)?(e.position+=3,Fc(e,!0,-1)):s&&Cc(e,"directives end mark is expected"),Uc(e,e.lineIndent-1,oc,!1,!0),Fc(e,!0,-1),e.checkLineBreaks&&uc.test(e.input.slice(o,e.position))&&Sc(e,"non-ASCII line breaks are interpreted as content"),e.documents.push(e.result),e.position===e.lineStart&&kc(e)?46===e.input.charCodeAt(e.position)&&(e.position+=3,Fc(e,!0,-1)):e.position<e.length-1&&Cc(e,"end of the stream or a document separator is expected")}function Qc(e,t){t=t||{},0!==(e=String(e)).length&&(10!==e.charCodeAt(e.length-1)&&13!==e.charCodeAt(e.length-1)&&(e+="\n"),65279===e.charCodeAt(0)&&(e=e.slice(1)));var i=new Tc(e,t);for(i.input+="\0";32===i.input.charCodeAt(i.position);)i.lineIndent+=1,i.position+=1;for(;i.position<i.length-1;)Nc(i);return i.documents}function jc(e,t,i){var r,n,o=Qc(e,i);for(r=0,n=o.length;r<n;r+=1)t(o[r])}function Vc(e,t){var i=Qc(e,t);if(0!==i.length){if(1===i.length)return i[0];throw new gl("expected a single document in the stream, but found more")}}var Hc={loadAll:jc,load:Vc,safeLoadAll:function(e,t,i){jc(e,t,Al.extend({schema:Kl},i))},safeLoad:function(e,t){return Vc(e,Al.extend({schema:Kl},t))}};function Gc(e){return function(){throw new Error("Function "+e+" is deprecated and cannot be used.")}}var $c={Type:bl,Schema:Bl,FAILSAFE_SCHEMA:Cl,JSON_SCHEMA:zl,CORE_SCHEMA:Rl,DEFAULT_SAFE_SCHEMA:Kl,DEFAULT_FULL_SCHEMA:ec,load:Hc.load,loadAll:Hc.loadAll,safeLoad:Hc.safeLoad,safeLoadAll:Hc.safeLoadAll,YAMLException:gl,MINIMAL_SCHEMA:Cl,SAFE_SCHEMA:Kl,DEFAULT_SCHEMA:ec,scan:Gc("scan"),parse:Gc("parse"),compose:Gc("compose"),addConstructor:Gc("addConstructor")},Zc=function(){function t(t,i,r){void 0===r&&(r=null),this.url=t,!i||e.isRelativeURL(i)&&!e.isRelativeURL(this.url)?this.path=e.pathForURL(this.url):this.path=i,this.path_for_parent=i||this.path,this.parent=r,this.container=null,this.parent&&(this.parent.container?this.container=this.parent.container:this.parent.isContainer()&&(this.container=this.parent))}var i=t.prototype;return i.load=function(){return Kc(this.url)},i.resourceFor=function(e){return{url:this.urlFor(e),path:this.pathFor(e),type:this.typeFor(e)}},i.urlFor=function(t){return h(t)?t:e.isRelativeURL(t)&&this.container?this.parent.urlFor(this.path_for_parent+t):e.addBaseURL(t,this.path)},i.pathFor=function(t){return e.pathForURL(t)},i.typeFor=function(t){return e.extensionForURL(t)},i.isContainer=function(){return!1},t}(),qc=function(t){function i(e,i,r){var n;return(n=t.call(this,e,i,r)||this).zip=null,n.files={},n.root=null,n.path="",n}e._inheritsLoose(i,t);var r=i.prototype;return r.isContainer=function(){return!0},r.load=function(){return new Promise(function(t,i){var r;return this.zip=new pl,"string"==typeof this.url?Promise.resolve(e.Utils.io(this.url,6e4,"arraybuffer")).then(function(e){try{return r=e.body,Promise.resolve(this.zip.loadAsync(r)).then(function(e){try{return Promise.resolve(this.parseZipFiles()).then(function(e){try{return t(this.loadRoot())}catch(e){return i(e)}}.bind(this),i)}catch(e){return i(e)}}.bind(this),i)}catch(e){return i(e)}}.bind(this),i):t(this)}.bind(this))},r.urlFor=function(i){return h(i)?i:e.isRelativeURL(i)?this.urlForZipFile(e.flattenRelativeURL(i)):t.prototype.urlFor.call(this,i)},r.typeFor=function(i){return e.isRelativeURL(i)?this.typeForZipFile(i):t.prototype.typeFor.call(this,i)},r.loadRoot=function(){return this.findRoot(),Kc(this.urlForZipFile(this.root))},r.findRoot=function(){var t=this,i=Object.keys(this.files).filter((function(e){return 0===t.files[e].depth})).filter((function(t){return"yaml"===e.extensionForURL(t)}));if(1===i.length&&(this.root=i[0]),!this.root){var r="Could not find root scene for bundle '"+this.url+"': ";throw r+="The zip archive's root level must contain a single scene file with the '.yaml' extension. ",i.length>0?r+="Found multiple YAML files at the root level: "+i.map((function(e){return"'"+e+"'"})).join(", ")+".":r+="Found NO YAML files at the root level.",Error(r)}},r.parseZipFiles=function(){return new Promise(function(t,i){var r,n,o,s,a,l;return r=[],n=[],this.zip.forEach((function(e,t){t.dir||(r.push(e),n.push(t.async("arraybuffer")))})),Promise.resolve(Promise.all(n)).then(function(n){try{for(o=n,s=0;s<o.length;s++)a=r[s],l=a.split("/").length-1,this.files[a]={data:o[s],type:e.extensionForURL(a),depth:l};return t()}catch(e){return i(e)}}.bind(this),i)}.bind(this))},r.urlForZipFile=function(t){if(this.files[t])return this.files[t].url||(this.files[t].url=e.createObjectURL(new Blob([this.files[t].data]))),this.files[t].url},r.typeForZipFile=function(e){return this.files[e]&&this.files[e].type},i}(Zc);function Kc(t){return new Promise((function(i,r){"string"==typeof t?e.Utils.io(t).then((function(e){var t=e.body;try{i(function(e){return $c.safeLoad(e,{json:!0})}(t))}catch(e){r(e)}}),r):(t=Object.assign({},t),i(t))}))}var Wc={loadScene:function(t,i){return new Promise(function(r,n){var o,s,a,l,c,u,h,d,p,f;return o=this,a=(s=void 0===i?{}:i).path,l=s.type,c=[],u={},Promise.resolve(this.loadSceneRecursive({url:t,path:a,type:l},null,u,c)).then(function(t){try{return h=t,d=this.finalize(h),p=d.config,f=d.bundle,p?(c.length>0&&c.forEach((function(t){var i="Failed to import scene: "+t.url;e.log("error",i,t),o.trigger("error",{type:"scene_import",message:i,error:t,url:t.url})})),r({config:p,bundle:f,texture_nodes:u})):n(c[0])}catch(e){return n(e)}}.bind(this),n)}.bind(this))},loadSceneRecursive:function(t,i,r,n){return new Promise(function(o,s){var a,l,c,u,h,d,p,f,A;if(a=this,l=t.url,c=t.path,u=t.type,void 0===r&&(r={}),void 0===n&&(n=[]),!l)return o({});h=function(t,i,r,n){return void 0===n&&(n=null),null!=n&&"zip"===n||"string"==typeof t&&!e.isLocalURL(t)&&"zip"===e.extensionForURL(t)?new qc(t,i,r):new Zc(t,i,r)}(l,c,i,u);var m=function(e){try{return e.url=l,n.push(e),o({})}catch(e){return s(e)}};try{return Promise.resolve(h.load()).then(function(t){try{return null==(d=t).import?(this.normalize(d,h,r),o({config:d,bundle:h})):(Array.isArray(d.import)||(d.import=[d.import]),p=[],d.import.forEach((function(t){"object"==typeof t&&(t=e.createObjectURL(new Blob([JSON.stringify(t)]))),p.push(h.resourceFor(t))})),delete d.import,f=p.map((function(e){return a.loadSceneRecursive(e,h,r,n)})),Promise.resolve(Promise.all(f)).then(function(t){try{return A=t.map((function(e){return a.normalize(e.config,e.bundle,r)})).map((function(e){return e.config})),this.normalize(d,h,r),d=e.mergeObjects.apply(void 0,A.concat([d])),o({config:d,bundle:h,texture_nodes:r})}catch(e){return m(e)}}.bind(this),m))}catch(e){return m(e)}}.bind(this),m)}catch(e){m(e)}}.bind(this))},normalize:function(e,t,i){return void 0===i&&(i={}),this.normalizeDataSources(e,t),this.normalizeFonts(e,t),this.normalizeTextures(e,t),this.collectTextures(e,t,i),{config:e,bundle:t,texture_nodes:i}},normalizeDataSources:function(e,t){for(var i in e.sources=e.sources||{},e.sources)this.normalizeDataSource(e.sources[i],t);return e},normalizeDataSource:function(e,t){if(e.url=t.urlFor(e.url),Array.isArray(e.composite)&&e.composite.forEach((function(e){return e.url=t.urlFor(e.url)})),e.scripts)for(var i in Array.isArray(e.scripts)&&(e.scripts=e.scripts.reduce((function(e,t){return e[t]=t,e}),{})),e.scripts)e.scripts[i]=t.urlFor(e.scripts[i]);return e},normalizeFonts:function(e,t){for(var i in e.fonts=e.fonts||{},e.fonts)if(Array.isArray(e.fonts[i]))e.fonts[i].forEach((function(e){e.url=e.url&&t.urlFor(e.url)}));else{var r=e.fonts[i];r.url=r.url&&t.urlFor(r.url)}return e},normalizeTextures:function(e,t){if(e.textures=e.textures||{},e.textures)for(var i in e.textures){var r=e.textures[i];r.url&&(r.url=t.urlFor(r.url))}},collectTextures:function(t,i,r){var n=this;if(t.styles){var o=function(e){var o=t.styles[e],s=o.texture;if("string"==typeof s&&!t.textures[s]){var a=["styles",e,"texture"];n.addTextureNode(a,i,r)}o.material&&["emission","ambient","diffuse","specular","normal"].forEach((function(s){var a=null!=o.material[s]&&o.material[s].texture;if("string"==typeof a&&!t.textures[a]){var l=["styles",e,"material",s,"texture"];n.addTextureNode(l,i,r)}}))};for(var s in t.styles)o(s)}if(t.styles){var a=function(o){var s=t.styles[o];s.shaders&&s.shaders.uniforms&&e.GLSL.parseUniforms(s.shaders.uniforms).forEach((function(e){var s=e.type,a=e.value,l=e.key;if("sampler2D"===s&&"string"==typeof a&&!t.textures[a]){var c=["styles",o,"shaders","uniforms",l];n.addTextureNode(c,i,r)}}))};for(var l in t.styles)a(l)}if(t.layers)for(var c=[t.layers],u=[["layers"]];c.length>0;){var h=c.pop(),d=u.pop();if("object"==typeof h&&!Array.isArray(h))for(var p in h)if("draw"===p){var f=h[p];for(var A in f){if(f[A].texture){var m=f[A].texture;if("string"==typeof m&&!t.textures[m]){var g=[].concat(d,[p,"draw",A,"texture"]);this.addTextureNode(g,i,r)}}if(f[A].outline&&f[A].outline.texture){var _=f[A].outline.texture;if("string"==typeof _&&!t.textures[_]){var y=[].concat(d,[p,"draw",A,"outline","texture"]);this.addTextureNode(y,i,r)}}}}else{if(e.isReserved(p))continue;c.push(h[p]),u.push([].concat(d,[p]))}}},addTextureNode:function(e,t,i){i[JSON.stringify(e)]={path:e,bundle:t}},hoistTextureNodes:function(e,t,i){void 0===i&&(i={});for(var r=0,n=Object.values(i);r<n.length;r++){var a=n[r],l=a.path,c=a.bundle,u=o(e,l);if("string"==typeof u&&null==e.textures[u])if(d(e,l)){var h=t.urlFor(u);e.textures[u]={url:h}}else{var p=c.urlFor(u);e.textures[p]={url:p},s(e,l,p)}}},applyGlobalProperties:function(t){return t.global&&0!==Object.keys(t.global).length?function t(i,r,n,o){var s,a;if((null==n||null==(s=n[u])?void 0:s[o])?a=n[u][o]:"string"==typeof r&&r.slice(0,c)===l&&(a=r),a){null==n[u]&&Object.defineProperty(n,u,{value:{}}),n[u][o]=a;for(var h,d=i[a];"string"==typeof d&&d.slice(0,c)===l;){if((h=h||[a]).indexOf(d)>-1){e.log({level:"warn",once:!0},"Global properties: cyclical reference detected",h),d=null;break}h.push(d),d=i[d]}Object.defineProperty(n,o,{enumerable:!0,get:function(){return d},set:function(e){delete n[u][o],delete n[o],n[o]=e}})}else if(Array.isArray(r))for(var p=0;p<r.length;p++)t(i,r[p],r,p);else if("object"==typeof r)for(var f in r)t(i,r[f],r,f);return r}(function e(t,i,r){for(var n in void 0===i&&(i=null),void 0===r&&(r={}),i=i?i+".":l,t){var o=i+n,s=t[n];r[o]=s,"object"!=typeof s||Array.isArray(s)||e(s,o,r)}return r}(t.global),t):t},finalize:function(e){var t=e.config,i=e.bundle;return t?(t.global=t.global||{},t.scene=t.scene||{},t.cameras=t.cameras||{},t.lights=t.lights||{},t.styles=t.styles||{},t.layers=t.layers||{},t.camera&&(t.cameras.default=t.camera),0===Object.keys(t.cameras).length&&(t.cameras.default={}),(0===Object.keys(t.lights).length||Object.keys(t.lights).every((function(e){return!1===t.lights[e].visible})))&&(t.lights.default_light={type:"directional"}),{config:t,bundle:i}):{}}};e.subscribeMixin(Wc);var Xc=function(){function t(){this.tiles={},this.max_proxy_descendant_depth=6,this.max_proxy_ancestor_depth=7,this.children_cache={}}var i=t.prototype;return i.addTile=function(t){for(this.tiles[t.key]=this.tiles[t.key]||{descendants:0},this.tiles[t.key].tile=t;t.style_z>=0;){if(!(t=e.TileID.parent(t)))return;this.tiles[t.key]||(this.tiles[t.key]={descendants:0}),this.tiles[t.key].descendants++}},i.removeTile=function(t){for(this.tiles[t.key]&&(delete this.tiles[t.key].tile,0===this.tiles[t.key].descendants&&delete this.tiles[t.key]);t.style_z>=0;){if(!(t=e.TileID.parent(t)))return;this.tiles[t.key]&&this.tiles[t.key].descendants>0&&(this.tiles[t.key].descendants--,0!==this.tiles[t.key].descendants||this.tiles[t.key].tile||delete this.tiles[t.key])}},i.getAncestor=function(t){for(var i=0;i<this.max_proxy_ancestor_depth;){if(!(t=e.TileID.parent(t)))return;if(this.tiles[t.key]&&this.tiles[t.key].tile&&this.tiles[t.key].tile.loaded)return this.tiles[t.key].tile;i++}},i.getDescendants=function(t,i){var r=this;void 0===i&&(i=0);var n=[];if(i<this.max_proxy_descendant_depth){var o=e.TileID.children(t,this.children_cache);if(!o)return;o.forEach((function(e){r.tiles[e.key]&&(r.tiles[e.key].tile&&r.tiles[e.key].tile.loaded?n.push(r.tiles[e.key].tile):r.tiles[e.key].descendants>0&&n.push.apply(n,r.getDescendants(e,i+1)))}))}return n},t}(),Yc={},Jc={};function eu(t,i,r){return new Promise((function(n,o){var s,a,l,c,u;return void 0===r&&(r=!1),Jc=Yc,Yc={},s=function(t,i){var r={};for(var n in t.forEach((function(t){var n=e.Geo.unitsPerMeter(t.coords.z),o=Math.pow(2,i-t.style_z),s=n*o,a=e.Geo.metersPerPixel(i),l=Object.assign({},t.meshes,t.pending_label_meshes);for(var c in l)l[c].forEach((function(i){if(i.labels)for(var o in i.labels)if(!t.isProxy()||Jc[o]){var l=i.labels[o].container.label,c=i.labels[o].container.linked,u=i.labels[o].ranges,h={};if(h.discard=tu.bind(h),h.build_id=t.build_id,Object.assign(h,l),h.layout=Object.assign({},l.layout),h.layout.repeat_scale=.75,h.layout.repeat_distance=h.layout.repeat_distance||0,h.layout.repeat_distance/=s,h.position=[h.position[0]/n+t.min.x,h.position[1]/n+t.min.y],h.unit_scale=a,"point"===h.type)e.LabelPoint.prototype.updateBBoxes.call(h);else if("straight"===h.type)e.LabelLineStraight.prototype.updateBBoxes.call(h,h.position,h.size,h.angle,h.angle,h.offset);else if(l.obbs){var d=l.obbs.map((function(i){var r=i.x,o=i.y,a=i.a,l=i.w,c=i.h;return r=r/n+t.min.x,o=o/n+t.min.y,l/=s,c/=s,new e.OBB(r,o,a,l,c)}));h.obbs=d,h.aabbs=d.map((function(e){return e.getExtent()}))}r[o]={label:h,linked:c,ranges:u,mesh:i}}}))})),r){var o=r[n];o.linked&&(o.linked=r[o.linked])}return r=Object.keys(r).map((function(e){return r[e]}))}(t,i),e.Collision.startTile("main",{apply_repeat_groups:!0,return_hidden:!0}),e.Collision.addStyle("main","main"),a=Math.max.apply(Math,[0].concat(Object.values(t).map((function(e){return Object.values(e.meshes)})).flat().map((function(e){return Math.max.apply(Math,[0].concat(e.map((function(e){return e.labels?Object.keys(e.labels).length:0}))))})))),(l=Math.floor(a/e.Geo.tile_size))>0?e.Collision.initGrid({anchor:{x:Math.min.apply(Math,t.map((function(e){return e.min.x}))),y:Math.min.apply(Math,t.map((function(e){return e.min.y})))},span:t[0].span.x/l}):e.Collision.initGrid(),Promise.resolve(e.Collision.collide(s,"main","main")).then((function(e){try{return u=[],(c=e).forEach((function(e){var t=0;!0!==e.show||r&&e.label.breach&&!Jc[e.label.id]||(t=1),t&&(Yc[e.label.id]=!0);var i=!0;e.ranges.forEach((function(r){if(i){var n=e.mesh;if(n.valid){for(var o=n.vertex_layout.offset.a_shape,s=n.vertex_layout.stride,a=0;a<r[1];a++){if(n.vertex_data[r[0]+a*s+o+6]===t)return void(i=!1);n.vertex_data[r[0]+a*s+o+6]=t}-1===u.indexOf(n)&&u.push(n)}}}))})),u.forEach((function(e){return e.upload()})),t.forEach((function(e){return e.swapPendingLabels()})),n({labels:c,containers:s})}catch(e){return o(e)}}),o)}))}function tu(t,i){if(void 0===i&&(i=null),this.obb)return e.Label.prototype.occluded.call(this,t,i);if(this.obbs)for(var r=0;r<this.obbs.length;r++){var n={aabb:this.aabbs[r],obb:this.obbs[r]};if(e.Label.prototype.occluded.call(n,t,i))return!0}return!1}var iu=function(){function t(t){var i=t.scene;this.scene=i,this.tiles={},this.pyramid=new Xc,this.visible_coords={},this.queued_coords=[],this.building_tiles=null,this.renderable_tiles=[],this.collision={tile_keys:null,mesh_set:null,zoom:null,zoom_steps:3},this.main_thread_target=["TileManager",this.scene.id].join("_"),e.WorkerBroker.addTarget(this.main_thread_target,this)}var i=t.prototype;return i.destroy=function(){this.forEachTile((function(e){return e.destroy()})),this.tiles={},this.pyramid=null,this.visible_coords={},this.queued_coords=[],this.scene=null,e.WorkerBroker.removeTarget(this.main_thread_target)},i.keepTile=function(e){this.tiles[e.key]=e,this.pyramid.addTile(e)},i.hasTile=function(e){return void 0!==this.tiles[e]},i.forgetTile=function(e){if(this.hasTile(e)){var t=this.tiles[e];this.pyramid.removeTile(t)}delete this.tiles[e],this.tileBuildStop(e)},i.removeTile=function(t){e.log("trace","tile unload for "+t);var i=this.tiles[t];null!=i&&i.destroy(),this.forgetTile(i.key),this.scene.requestRedraw()},i.forEachTile=function(e){for(var t in this.tiles)e(this.tiles[t])},i.removeTiles=function(e){var t=[];for(var i in this.tiles)e(this.tiles[i])&&t.push(i);for(var r=0;r<t.length;r++){var n=t[r];this.removeTile(n)}},i.updateTilesForView=function(){this.visible_coords={};for(var e=this.view.findVisibleTileCoordinates(),t=0;t<e.length;t++){var i=e[t];this.queueCoordinate(i),this.visible_coords[i.key]=i}this.updateTileStates()},i.updateTileStates=function(){var e=this;return this.forEachTile((function(t){e.updateVisibility(t)})),this.loadQueuedCoordinates(),this.updateProxyTiles(),this.view.pruneTilesForView(),this.updateRenderableTiles(),this.style_manager.updateActiveStyles(this.renderable_tiles),this.style_manager.updateActiveBlendOrders(this.renderable_tiles),this.updateLabels()},i.updateLabels=function(){var t=this;if(this.scene.building&&!this.scene.building.initial)return Promise.resolve({});var i=this.renderable_tiles.filter((function(e){return e.valid})).filter((function(e){return e.built}));return 0===i.length?Promise.resolve({}):(i.sort((function(e,t){return e.build_id<t.build_id?-1:e.build_id>t.build_id?1:0})),this.collision.zoom===ru(this.view.zoom,this.collision.zoom_steps)&&this.collision.tile_keys===JSON.stringify(i.map((function(e){return e.key})))&&this.collision.mesh_set===nu(i)?Promise.resolve({}):(this.collision.task||(this.collision.zoom=ru(this.view.zoom,this.collision.zoom_steps),this.collision.tile_keys=JSON.stringify(i.map((function(e){return e.key}))),this.collision.mesh_set=nu(i),this.collision.task={type:"tileManagerUpdateLabels",run:function(r){return new Promise((function(n,o){var s;return Promise.resolve(eu(i,t.collision.zoom,t.isLoadingVisibleTiles())).then((function(i){try{return s=i,t.scene.requestRedraw(),t.collision.task=null,e.Task.finish(r,s),t.updateTileStates(),n()}catch(e){return o(e)}}),o)}))},immediate:!0},e.Task.add(this.collision.task)),this.collision.task.promise))},i.updateProxyTiles=function(){var e=this;if(0!==this.view.zoom_direction){this.forEachTile((function(e){return e.setProxyFor(null)}));var t=!1;this.forEachTile((function(i){if(i.visible&&!i.labeled){var r=e.pyramid.getAncestor(i);if(r)r.setProxyFor(i),t=!0;else for(var n=e.pyramid.getDescendants(i),o=0;o<n.length;o++)n[o].setProxyFor(i),t=!0}})),t||(this.view.zoom_direction=0)}},i.updateVisibility=function(t){if(t.visible=!1,t.style_z===this.view.tile_zoom)if(this.visible_coords[t.coords.key])t.visible=!0;else for(var i in this.visible_coords)if(e.TileID.isDescendant(t.coords,this.visible_coords[i])){t.visible=!0;break}},i.pruneToVisibleTiles=function(){this.removeTiles((function(e){return!e.visible}))},i.getRenderableTiles=function(){return this.renderable_tiles},i.updateRenderableTiles=function(){for(var e in this.renderable_tiles=[],this.tiles){var t=this.tiles[e];t.visible&&t.loaded&&this.renderable_tiles.push(t)}return this.renderable_tiles},i.isLoadingVisibleTiles=function(){var e=this;return Object.keys(this.tiles).some((function(t){return e.tiles[t].visible&&!e.tiles[t].built}))},i.allVisibleTilesLabeled=function(){return this.renderable_tiles.every((function(e){return e.labeled}))},i.queueCoordinate=function(e){this.queued_coords[this.queued_coords.length]=e},i.loadQueuedCoordinates=function(){var t=this;0!==this.queued_coords.length&&(this.queued_coords.sort((function(i,r){var n=t.view.center.meters,o=e.Geo.metersPerTile(i.z)/2,s=e.Geo.metersForTile(i);s.x+=o,s.y-=o;var a=e.Geo.metersForTile(r);a.x+=o,a.y-=o;var l=Math.abs(n.x-s.x)+Math.abs(n.y-s.y),c=Math.abs(n.x-a.x)+Math.abs(n.y-a.y);return i.center_dist=l,r.center_dist=c,c>l?-1:c===l?0:1})),this.queued_coords.forEach((function(e){return t.loadCoordinate(e)})),this.queued_coords=[])},i.loadCoordinate=function(t){if(t.z===this.view.center.tile.z)for(var i in this.scene.sources){var r=this.scene.sources[i];if(r.builds_geometry_tiles&&r.includesTile(t,this.view.tile_zoom)){var n=e.TileID.normalizedKey(t,r,this.view.tile_zoom);if(n&&!this.hasTile(n)){e.log("trace","load tile "+n+", distance from view center: "+t.center_dist);var o=new e.Tile({source:r,coords:t,workers:this.scene.workers,style_z:this.view.baseZoom(t.z),view:this.view});this.keepTile(o),this.buildTile(o)}}}},i.buildTile=function(e,t){this.tileBuildStart(e.key),this.updateVisibility(e),e.build(this.scene.generation,t)},i.buildTileStylesCompleted=function(t){var i=t.tile,r=t.progress;if(null==this.tiles[i.key])e.log("trace","discarded tile "+i.key+" in TileManager.buildTileStylesCompleted because previously removed"),e.Tile.abortBuild(i),this.updateTileStates();else if(i.generation!==this.scene.generation)e.log("trace","discarded tile "+i.key+" in TileManager.buildTileStylesCompleted because built with scene config gen "+i.generation+", current "+this.scene.generation),e.Tile.abortBuild(i),this.updateTileStates();else{if(this.tiles[i.key]){if(i.id<this.tiles[i.key].id)return e.log("trace","discarded tile "+i.key+" for id "+i.id+" in TileManager.buildTileStylesCompleted because built for discarded tile id"),void e.Tile.abortBuild(i);i=this.tiles[i.key].merge(i)}r.done&&(i.built=!0),i.buildMeshes(this.scene.styles,r),this.updateTileStates(),this.scene.requestRedraw()}r.done&&this.tileBuildStop(i.key)},i.buildTileError=function(t){e.log("error","Error building tile "+t.key+":",t.error),this.forgetTile(t.key),e.Tile.abortBuild(t)},i.tileBuildStart=function(t){this.building_tiles=this.building_tiles||{},this.building_tiles[t]=!0,e.log("trace","tileBuildStart for "+t+": "+Object.keys(this.building_tiles).length)},i.tileBuildStop=function(t){this.building_tiles&&(e.log("trace","tileBuildStop for "+t+": "+Object.keys(this.building_tiles).length),delete this.building_tiles[t],this.checkBuildQueue())},i.checkBuildQueue=function(){this.building_tiles&&0!==Object.keys(this.building_tiles).length||(this.building_tiles=null,this.scene.tileManagerBuildDone())},i.getDebugProp=function(e,t){var i=[];for(var r in this.tiles)null==this.tiles[r].debug[e]||"function"==typeof t&&!0!==t(this.tiles[r])||i.push(this.tiles[r].debug[e]);return i},i.getDebugSum=function(e,t){var i=0;for(var r in this.tiles)null==this.tiles[r].debug[e]||"function"==typeof t&&!0!==t(this.tiles[r])||(i+=this.tiles[r].debug[e]);return i},i.getDebugAverage=function(e,t){return this.getDebugSum(e,t)/Object.keys(this.tiles).length},e._createClass(t,[{key:"view",get:function(){return this.scene.view}},{key:"style_manager",get:function(){return this.scene.style_manager}}]),t}();function ru(e,t,i){return void 0===i&&(i=2),(Math.floor(e*t)/t).toFixed(i)}function nu(e){return JSON.stringify(Object.entries(e).map((function(e){var t=e[1];return Object.entries(t.meshes).map((function(e){return e[1].map((function(e){return e.created_at}))}))})))}var ou=function(){function e(e,t){t(e),this.value=e,this.setup=t}return e.prototype.set=function(e){JSON.stringify(this.value)!==JSON.stringify(e)&&(this.setup(e),this.value=e)},e}(),su=function(e){this.defaults={},this.defaults.culling=!0,this.defaults.culling_face=e.BACK,this.defaults.blending=!1,this.defaults.blending_src=e.ONE_MINUS_SRC_ALPHA,this.defaults.blending_dst=e.ONE_MINUS_SRC_ALPHA,this.defaults.blending_src_alpha=e.ONE,this.defaults.blending_dst_alpha=e.ONE_MINUS_SRC_ALPHA,this.defaults.depth_write=!0,this.defaults.depth_test=!0,e.depthFunc(e.LESS),this.culling=new ou({cull:this.defaults.culling,face:this.defaults.culling_face},(function(t){t.cull?(e.enable(e.CULL_FACE),e.cullFace(t.face)):e.disable(e.CULL_FACE)})),this.blending=new ou({blend:this.defaults.blending,src:this.defaults.blending_src,dst:this.defaults.blending_dst,src_alpha:this.defaults.blending_src_alpha,dst_alpha:this.defaults.blending_dst_alpha},(function(t){t.blend?(e.enable(e.BLEND),t.src_alpha&&t.dst_alpha?e.blendFuncSeparate(t.src,t.dst,t.src_alpha,t.dst_alpha):e.blendFunc(t.src,t.dst)):e.disable(e.BLEND)})),this.depth_write=new ou({depth_write:this.defaults.depth_write},(function(t){e.depthMask(t.depth_write)})),this.depth_test=new ou({depth_test:this.defaults.depth_test},(function(t){t.depth_test?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST)}))};e.require$$0("Uint8",1,(function(e){return function(t,i,r){return e(this,t,i,r)}}),!0);var au,lu=function(){function t(){this.canvas=null,this.gl=null,this.screenshot_canvas=null,this.screenshot_context=null,this.queue_screenshot=null,this.video_capture=null}var i=t.prototype;return i.setCanvas=function(e,t){this.canvas=e,this.gl=t},i.screenshot=function(e){var t=this,i=(void 0===e?{}:e).background;return null!=this.queue_screenshot||(this.queue_screenshot={background:i},this.queue_screenshot.promise=new Promise((function(e,i){t.queue_screenshot.resolve=e,t.queue_screenshot.reject=i}))),this.queue_screenshot.promise},i.completeScreenshot=function(){if(null!=this.queue_screenshot){var t=this.canvas.width,i=this.canvas.height,r=new Uint8Array(t*i*4);this.gl.readPixels(0,0,t,i,this.gl.RGBA,this.gl.UNSIGNED_BYTE,r);var n=this.queue_screenshot.background;n=n&&"transparent"!==n?e.StyleParser.parseColor(n).slice(0,3).map((function(e){return 255*e})):null;for(var o=new Uint8ClampedArray(t*i*4),s=0;s<i;s++)for(var a=0;a<t;a++){var l=4*((i-s-1)*t+a),c=4*(s*t+a),u=r[l+3];o[c+0]=255*r[l+0]/u,o[c+1]=255*r[l+1]/u,o[c+2]=255*r[l+2]/u,o[c+3]=u,n&&(u/=255,o[c+0]=o[c+0]*u+n[0]*(1-u),o[c+1]=o[c+1]*u+n[1]*(1-u),o[c+2]=o[c+2]*u+n[2]*(1-u),o[c+3]=255)}this.screenshot_canvas=this.screenshot_canvas||document.createElement("canvas");var h=this.screenshot_canvas;h.width=t,h.height=i,this.screenshot_context=this.screenshot_context||h.getContext("2d");var d=this.screenshot_context,p=new ImageData(o,t,i);d.putImageData(p,0,0);for(var f=h.toDataURL("image/png"),A=atob(f.slice(22)),m=new Uint8Array(A.length),g=0;g<A.length;++g)m[g]=A.charCodeAt(g);var _=new Blob([m],{type:"image/png"});this.queue_screenshot.resolve({url:f,blob:_,type:"png"}),this.queue_screenshot=null}},i.startVideoCapture=function(){var t=this;if("function"!=typeof window.MediaRecorder||!this.canvas||"function"!=typeof this.canvas.captureStream)return e.log("warn","Video capture (Canvas.captureStream and/or MediaRecorder APIs) not supported by browser"),!1;if(this.video_capture)return e.log("warn","Video capture already in progress, call Scene.stopVideoCapture() first"),!1;try{var i=this.video_capture={};i.chunks=[],i.stream=this.canvas.captureStream(),i.options={mimeType:"video/webm"},i.media_recorder=new MediaRecorder(i.stream,i.options),i.media_recorder.ondataavailable=function(r){if(r.data.size>0&&i.chunks.push(r.data),i.resolve){var n=new Blob(i.chunks,{type:i.options.mimeType}),o=e.createObjectURL(n);i.stream&&(i.stream.getTracks()||[]).forEach((function(e){e.stop(),i.stream.removeTrack(e)})),i.stream=null,i.media_recorder=null,t.video_capture=null,i.resolve({url:o,blob:n,type:"webm"})}},i.media_recorder.start()}catch(t){return this.video_capture=null,e.log("error","Scene video capture failed",t),!1}return!0},i.stopVideoCapture=function(){var t=this;return this.video_capture?(this.video_capture.promise=new Promise((function(e,i){t.video_capture.resolve=e,t.video_capture.reject=i})),this.video_capture.media_recorder.stop(),this.video_capture.promise):(e.log("warn","No scene video capture in progress, call Scene.startVideoCapture() first"),Promise.resolve({}))},t}(),cu=function(){function t(i,r){var n;r=r||{},e.subscribeMixin(this),this.id=t.id++,this.initialized=!1,this.initializing=null,this.sources={},this.view=new e.View(this,r),this.tile_manager=new iu({scene:this}),this.num_workers=r.numWorkers||2,!0===r.disableVertexArrayObjects&&(e.VertexArrayObject.disabled=!0),e.Utils.use_high_density_display=void 0===r.highDensityDisplay||r.highDensityDisplay,e.Utils.updateDevicePixelRatio(),this.config=null,this.config_source=i,this.config_bundle=null,this.last_valid_config_source=null,this.styles=null,this.style_manager=new e.StyleManager,this.building=null,this.dirty=!0,r.preUpdate&&this.subscribe({pre_update:r.preUpdate}),r.postUpdate&&this.subscribe({post_update:r.postUpdate}),this.render_loop=!r.disableRenderLoop,this.render_loop_active=!1,this.render_loop_stop=!1,this.render_count=0,this.last_render_count=0,this.render_count_changed=!1,this.frame=0,this.last_main_render=-1,this.last_selection_render=-1,this.media_capture=new lu,this.selection=null,this.selection_feature_count=0,this.fetching_selection_map=null,this.prev_textures=null,this.introspection=!0===r.introspection,this.times={},this.resetTime(),this.container=r.container,this.canvas=null,this.contextOptions=r.webGLContextOptions,this.lights=null,this.background=null,this.createListeners(),this.updating=0,this.generation=t.generation,this.last_complete_generation=t.generation,(n=this).debug={profile:function(t){console.profile("main thread: "+t),e.WorkerBroker.postMessage(n.workers,"self.profile",t)},profileEnd:function(t){console.profileEnd("main thread: "+t),e.WorkerBroker.postMessage(n.workers,"self.profileEnd",t)},timeRebuild:function(t,i){void 0===t&&(t=1),void 0===i&&(i={});var r=[];!function o(){var s=+new Date;n.rebuild(i).then((function(){if(r.push(+new Date-s),r.length<t)o();else{var i=~~(r.reduce((function(e,t){return e+t}))/r.length);e.log("info","Profiled rebuild "+t+" times: "+i+" avg ("+Math.min.apply(Math,r)+" min, "+Math.max.apply(Math,r)+" max)")}}))}()},geometryCountByStyle:function(){var e={};return n.tile_manager.getRenderableTiles().forEach((function(t){var i=function(i){e[i]=e[i]||0,t.meshes[i].forEach((function(t){e[i]+=t.geometry_count}))};for(var r in t.meshes)i(r)})),e},geometryCountByBaseStyle:function(){var e=n.debug.geometryCountByStyle(),t={};for(var i in e){var r=n.styles[i].baseStyle();t[r]=t[r]||0,t[r]+=e[i]}return t},geometryCountTotal:function(){var e=n.debug.geometryCountByStyle();return Object.keys(e).reduce((function(t,i){return e[i]+t}),0)},geometrySizeByStyle:function(){var e={};return n.tile_manager.getRenderableTiles().forEach((function(t){var i=function(i){e[i]=e[i]||0,t.meshes[i].forEach((function(t){e[i]+=t.buffer_size}))};for(var r in t.meshes)i(r)})),e},geometrySizeByBaseStyle:function(){var e=n.debug.geometrySizeByStyle(),t={};for(var i in e){var r=n.styles[i].baseStyle();t[r]=t[r]||0,t[r]+=e[i]}return t},geometrySizeTotal:function(){var e=n.debug.geometrySizeByStyle();return Object.keys(e).reduce((function(t,i){return e[i]+t}),0)},textureSizeTotal:function(){return Object.values(e.Texture.textures).map((function(e){return e.byteSize()})).reduce((function(e,t){return e+t}))},layerStats:function(){return e.debugSettings.layer_stats?e.debugSumLayerStats(n.tile_manager.getRenderableTiles()):(e.log("warn","Enable the 'layer_stats' debug setting to collect layer stats"),{})},renderableTilesCount:function(){return n.tile_manager.getRenderableTiles().length}},this.log_level=r.logLevel||"warn",e.log.setLevel(this.log_level),e.log.reset()}t.create=function(e,i){return void 0===i&&(i={}),new t(e,i)};var n=t.prototype;return n.load=function(t,i){var r=this;return void 0===t&&(t=null),void 0===i&&(i={}),this.initializing||(e.log.reset(),this.updating++,this.initialized=!1,this.view_complete=!1,this.times.frame=null,this.times.build=null,(i="string"==typeof i?{base_path:i}:i).blocking=void 0===i.blocking||i.blocking,!1!==this.render_loop&&this.setupRenderLoop(),this.createCanvas(),this.prev_textures=this.config&&Object.keys(this.config.textures),this.initializing=this.loadScene(t,i).then((function(t){return new Promise((function(n,o){var s,a,l;return s=t.texture_nodes,Promise.resolve(r.createWorkers()).then(function(t){try{if(r.destroyFeatureSelection(),e.WorkerBroker.postMessage(r.workers,"self.clearFunctionStringCache"),a="object"==typeof r.config_source||r.hasSubscribersFor("load"),l=r.updateConfig({texture_nodes:s,serialize_funcs:a,normalize:!1,loading:!0,fade_in:!0}),!0===i.blocking)return Promise.resolve(l).then(function(e){try{return c.call(this)}catch(e){return o(e)}}.bind(this),o);function c(){return r.freePreviousTextures(),r.updating--,r.initializing=null,r.initialized=!0,r.last_valid_config_source=r.config_source,r.last_valid_options={base_path:i.base_path,file_type:i.file_type},r.requestRedraw(),n()}return c.call(this)}catch(u){return o(u)}}.bind(this),o)}))})).catch((function(t){var i,n;if(r.initializing=null,r.updating=0,"YAMLException"===t.name?(i="yaml",n="Error parsing scene YAML"):n="Error initializing scene",r.trigger("error",{type:i,message:n,error:t,url:r.config_source}),n="Scene.load() failed to load "+JSON.stringify(r.config_source)+": "+t.message,r.last_valid_config_source)return e.log("warn",n,t),e.log("info","Scene.load() reverting to last valid configuration"),r.load(r.last_valid_config_source,r.last_valid_base_path);throw e.log("error",n,t),t}))),this.initializing},n.destroy=function(){if(this.initialized=!1,this.render_loop_stop=!0,this.destroyListeners(),this.destroyFeatureSelection(),this.canvas&&this.canvas.parentNode&&(this.canvas.parentNode.removeChild(this.canvas),this.canvas=null),this.container=null,this.gl){e.Texture.destroy(this.gl),this.style_manager.destroy(this.gl),this.styles={},e.ShaderProgram.reset();var t=this.gl.getExtension("WEBGL_lose_context");t&&t.loseContext(),this.gl=null}this.sources={},this.destroyWorkers(),this.tile_manager.destroy(),this.tile_manager=null,e.log.reset()},n.createCanvas=function(){if(!this.canvas){this.container=this.container||document.body,this.canvas=document.createElement("canvas"),this.canvas.style.position="absolute",this.canvas.style.top=0,this.canvas.style.left=0,this.container.style.backgroundColor="transparent",this.container.appendChild(this.canvas);try{this.gl=r.getContext(this.canvas,Object.assign({alpha:!0,premultipliedAlpha:!0,stencil:!0,device_pixel_ratio:e.Utils.device_pixel_ratio,powerPreference:"high-performance"},this.contextOptions))}catch(e){throw new Error("Couldn't create WebGL context. Your browser may not support WebGL, or it's turned off? Visit http://webglreport.com/ for more info.")}this.resizeMap(this.container.clientWidth,this.container.clientHeight),e.VertexArrayObject.init(this.gl),this.render_states=new su(this.gl),this.media_capture.setCanvas(this.canvas,this.gl)}},n.updateExternalScripts=function(){var e=[].concat(this.external_scripts||[]),t=[];if(this.config.scene.scripts)for(var i in this.config.scene.scripts)-1===t.indexOf(this.config.scene.scripts[i])&&t.push(this.config.scene.scripts[i]);for(var r in this.config.sources){var n=this.config.sources[r];if(n.scripts)for(var o in n.scripts)-1===t.indexOf(n.scripts[o])&&t.push(n.scripts[o])}return this.external_scripts=t,!(this.external_scripts.length===e.length&&this.external_scripts.every((function(t,i){return t===e[i]})))},n.createWorkers=function(){return this.updateExternalScripts()&&this.destroyWorkers(),this.workers?Promise.resolve():this.makeWorkers()},n.makeWorkers=function(){var t=this,r=!!this.gl.getExtension("OES_element_index_uint"),n=[];this.workers=[];for(var o=function(o){var s=new Worker(i.workerURL);t.workers[o]=s,e.WorkerBroker.addWorker(s),e.log("debug","Scene.makeWorkers: initializing worker "+o);var a=o;n.push(e.WorkerBroker.postMessage(s,"self.init",t.id,o,t.num_workers,t.log_level,e.Utils.device_pixel_ratio,r,t.external_scripts).then((function(t){return e.log("debug","Scene.makeWorkers: initialized worker "+t),t}),(function(t){return e.log("error","Scene.makeWorkers: failed to initialize worker "+a+":",t),Promise.reject(t)})))},s=0;s<this.num_workers;s++)o(s);return this.next_worker=0,Promise.all(n).then((function(){e.log.setWorkers(t.workers)}))},n.destroyWorkers=function(){this.selection=null,Array.isArray(this.workers)&&(e.log.setWorkers(null),this.workers.forEach((function(e){e.terminate()})),this.workers=null)},n.ready=function(){return!(!this.view.ready()||0===Object.keys(this.sources).length)},n.updateDevicePixelRatio=function(){var t=this;e.Utils.updateDevicePixelRatio()&&e.WorkerBroker.postMessage(this.workers,"self.updateDevicePixelRatio",e.Utils.device_pixel_ratio).then((function(){return t.rebuild()})).then((function(){return t.resizeMap(t.view.size.css.width,t.view.size.css.height)}))},n.resizeMap=function(t,i){0===t&&0===i||(this.dirty=!0,this.view.setViewportSize(t,i),this.gl&&r.resize(this.gl,t,i,e.Utils.device_pixel_ratio))},n.requestRedraw=function(){this.dirty=!0},n.immediateRedraw=function(){this.dirty=!0,this.update()},n.renderLoop=function(){this.render_loop_active=!0,this.update(),e.Task.setState({user_moving_view:this.view.user_input_active}),e.Task.processAll(),this.render_loop_stop?(this.render_loop_stop=!1,this.render_loop_active=!1):window.requestAnimationFrame(this.renderLoop.bind(this))},n.setupRenderLoop=function(){var e=this;this.render_loop_active||setTimeout((function(){e.renderLoop()}),0)},n.update=function(){var t=this.dirty,i=!!this.selection&&this.selection.hasPendingRequests(),r=!(!1===t&&!1===i||!1===this.initialized||this.updating>0||!1===this.ready());return this.trigger("pre_update",r),this.view.update(),!!r&&(this.dirty=!1,this.updateDevicePixelRatio(),this.render({main:t,selection:i}),this.updateViewComplete(),this.media_capture.completeScreenshot(),this.trigger("post_update",r),(!0===this.animated||this.view.isAnimating())&&(this.dirty=!0),this.frame++,e.log("trace","Scene.render()"),!0)},n.render=function(t){var i=this,r=t.main,n=t.selection,o=this.gl;if(this.updateBackground(),Object.keys(this.lights).forEach((function(e){return i.lights[e].update()})),this.render_count_changed=!1,r&&(this.render_count=this.renderPass(),this.last_main_render=this.frame,this.render_count!==this.last_render_count&&(this.render_count_changed=!0,this.logFirstFrame(),this.getFeatureSelectionMapSize().then((function(t){i.selection_feature_count=t,e.log("info","Scene: rendered "+i.render_count+" primitives ("+t+" features in selection map)")}))),this.last_render_count=this.render_count),n){if(this.view.panning||this.view.user_input_active)return void this.selection.clearPendingRequests();!this.selection.locked&&this.last_selection_render<this.last_main_render&&(this.selection.bind(),this.renderPass("selection_program",{allow_blend:!1}),o.bindFramebuffer(o.FRAMEBUFFER,null),o.viewport(0,0,this.canvas.width,this.canvas.height),o.clearColor.apply(o,this.background.computed_color),this.last_selection_render=this.frame),this.selection.read()}return!0},n.renderPass=function(t,i){var r=this;void 0===t&&(t="program");var n=(void 0===i?{}:i).allow_blend;n=null==n||n,this.clearFrame();for(var o,s,a=0,l=this.style_manager.getActiveBlendOrders(),c=e._createForOfIteratorHelperLoose(l);!(s=c()).done;)for(var u=s.value,h=u.blend_order,d=u.styles,p=function(i){var s=r.styles[d[i]];if(null==s)return"continue";if(s.blend!==o){var l=Object.assign({},e.Style.render_states[s.blend],{blend:n&&s.blend});r.setRenderState(l)}var c=n&&s.blend;if("translucent"===c)r.gl.colorMask(!1,!1,!1,!1),r.renderStyle(s.name,t,h),r.gl.colorMask(!0,!0,!0,!0),r.gl.depthFunc(r.gl.EQUAL),r.gl.enable(r.gl.STENCIL_TEST),r.gl.clearStencil(0),r.gl.clear(r.gl.STENCIL_BUFFER_BIT),r.gl.stencilFunc(r.gl.EQUAL,r.gl.ZERO,255),r.gl.stencilOp(r.gl.KEEP,r.gl.KEEP,r.gl.INCR),a+=r.renderStyle(s.name,t,h),r.gl.disable(r.gl.STENCIL_TEST),r.gl.depthFunc(r.gl.LESS);else if("opaque"!==c&&!0===s.stencil_proxy_tiles){var u=r.tile_manager.getRenderableTiles().filter((function(e){return e.meshes[s.name]})).map((function(e){return e.proxy_level})).reduce((function(e,t){return e.indexOf(t)>-1||e.push(t),e}),[]).sort();if(u.length>1){r.gl.enable(r.gl.STENCIL_TEST),r.gl.clearStencil(0),r.gl.clear(r.gl.STENCIL_BUFFER_BIT),r.gl.stencilOp(r.gl.KEEP,r.gl.KEEP,r.gl.REPLACE);for(var p=0;p<u.length;p++)r.gl.stencilFunc(r.gl.GEQUAL,u.length-p,255),a+=r.renderStyle(s.name,t,h,u[p]);r.gl.disable(r.gl.STENCIL_TEST)}else a+=r.renderStyle(s.name,t,h)}else a+=r.renderStyle(s.name,t,h);o=s.blend},f=0;f<d.length;f++)p(f);return a},n.renderStyle=function(t,i,r,n){var o=this;void 0===n&&(n=null);for(var s,a=this.styles[t],l=!0,c=0,u=this.tile_manager.getRenderableTiles().filter((function(e){return"number"!=typeof n||e.proxy_level===n})).map((function(e){if(e.meshes[t])return[e,e.meshes[t].filter((function(e){return e.variant.blend_order===r}))]})).filter((function(e){return e})),h=Math.max.apply(Math,u.map((function(e){var t=e[1];return Math.max.apply(Math,t.map((function(e){return e.variant.mesh_order})))}))),d=function(r){for(var n,h=function(){var e=n.value,u=e[0],h=e[1],d=!0;if(!u.shouldProxyForStyle(t))return"continue";var p=h.filter((function(e){return e.variant.mesh_order===r}));return 0===p.length?"continue":!0!==l||(l=!1,s=o.setupStyle(a,i))?void p.forEach((function(e){!0===d&&(d=!1,o.view.setupTile(u,s)),a.render(e)&&o.requestRedraw(),c+=e.geometry_count})):{v:{v:0}}},d=e._createForOfIteratorHelperLoose(u);!(n=d()).done;){var p=h();if("continue"!==p&&"object"==typeof p)return p.v}},p=0;p<h+1;p++){var f=d(p);if("object"==typeof f)return f.v}return c},n.setupStyle=function(e,t){var i;try{if(!(i=e.getProgram(t)))return}catch(t){return void this.trigger("warning",{type:"styles",message:"Error compiling style "+e.name,style:e,shader_errors:e.program&&e.program.shader_errors})}for(var r in i.use(),e.setup(),i.uniform("1f","u_time",this.animated?(+new Date-this.start_time)/1e3:0),this.view.setupProgram(i),this.lights)this.lights[r].setupProgram(i);return i},n.clearFrame=function(){this.initialized&&(this.render_states.depth_write.set({depth_write:!0}),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT|this.gl.STENCIL_BUFFER_BIT))},n.setRenderState=function(e){var t=void 0===e?{}:e,i=t.depth_test,r=t.depth_write,n=t.cull_face,o=t.blend;if(this.initialized){var s=this.render_states;i=!1!==i&&s.defaults.depth_test,r=!1!==r&&s.defaults.depth_write,n=!1!==n&&s.defaults.culling,o=null!=o?o:s.defaults.blending;var a=this.gl;s.depth_test.set({depth_test:i}),s.depth_write.set({depth_write:r}),s.culling.set({cull:n,face:s.defaults.culling_face}),o?"opaque"===o?s.blending.set({blend:!1}):"overlay"===o||"inlay"===o||"translucent"===o?s.blending.set({blend:!0,src:a.SRC_ALPHA,dst:a.ONE_MINUS_SRC_ALPHA,src_alpha:a.ONE,dst_alpha:a.ONE_MINUS_SRC_ALPHA}):"add"===o?s.blending.set({blend:!0,src:a.ONE,dst:a.ONE}):"multiply"===o&&s.blending.set({blend:!0,src:a.ZERO,dst:a.SRC_COLOR}):s.blending.set({blend:!1})}},n.getFeatureAt=function(t,i){var r=(void 0===i?{}:i).radius;if(!this.initialized)return e.log("debug","Scene.getFeatureAt() called before scene was initialized"),Promise.resolve();if(0===this.selection_feature_count)return Promise.resolve();this.selection||this.resetFeatureSelection();var n={x:t.x/this.view.size.css.width,y:t.y/this.view.size.css.height};return r=r>0?{x:r/this.view.size.css.width,y:r/this.view.size.css.height}:null,this.selection.getFeatureAt(n,{radius:r}).then((function(e){return Object.assign(e,{pixel:t})})).catch((function(e){return Promise.resolve({error:e})}))},n.queryFeatures=function(t){return new Promise(function(i,r){var n,o,s,a,l,c,u,h,d,p,f,A,m,g,_,y,v;return o=(n=void 0===t?{}:t).filter,s=n.unique,a=void 0===s||s,l=n.group_by,c=void 0===l?null:l,h=void 0===(u=n.visible)?null:u,d=n.geometry,p=void 0!==d&&d,this.initialized?(o=e.Utils.serializeWithFunctions(o),f=!0===(a="string"==typeof a?[a]:a)||Array.isArray(a)&&a.indexOf("$id")>-1,A=a&&function(t){var i=Array.isArray(a)?e.sliceObject(t.properties,a):t.properties,r=f?t.id:null;return p?JSON.stringify({geometry:t.geometry,properties:i,id:r}):JSON.stringify({properties:i,id:r})},c=("string"==typeof c||Array.isArray(c))&&c,m=c&&function(t){return Array.isArray(c)?JSON.stringify(e.sliceObject(t,c)):t[c]},g=this.tile_manager.getRenderableTiles().map((function(e){return e.key})),Promise.resolve(e.WorkerBroker.postMessage(this.workers,"self.queryFeatures",{filter:o,visible:h,geometry:p,tile_keys:g})).then((function(e){try{return _=[],y={},v={},e.forEach((function(e){return e.forEach((function(e){if(A){var t=A(e);if(y[t])return;y[t]=!0}if(m){var i=m(e.properties);v[i]=v[i]||[],v[i].push(e)}else _.push(e)}))})),i(m?v:_)}catch(e){return r(e)}}),r)):i([])}.bind(this))},n.rebuild=function(i){var r=this,n=void 0===i?{}:i,o=n.initial,s=void 0!==o&&o,a=n.new_generation,l=void 0===a||a,c=n.sources,u=void 0===c?null:c,h=n.serialize_funcs,d=n.profile,p=void 0!==d&&d,f=n.fade_in,A=void 0!==f&&f;return new Promise((function(i,n){if(r.building){r.building.queued&&r.building.queued.reject&&(e.log("debug","Scene.rebuild: request superceded by a newer call"),r.building.queued.resolve(!1));var o={initial:s,new_generation:l,sources:u,serialize_funcs:h,profile:p,fade_in:A};return r.building.queued={resolve:i,reject:n,options:o},void e.log("trace","Scene.rebuild(): queuing request")}if(r.building={resolve:i,reject:n,initial:s},p&&r.debug.profile("Scene.rebuild"),l)for(var a in r.generation=++t.generation,r.styles)r.styles[a].setGeneration(r.generation);r.syncConfigToWorker({serialize_funcs:h}),r.resetWorkerFeatureSelection(u),r.resetTime(),r.tile_manager.pruneToVisibleTiles(),r.tile_manager.forEachTile((function(e){(!u||u.indexOf(e.source.name)>-1)&&r.tile_manager.buildTile(e,{fade_in:A})})),r.tile_manager.updateTilesForView(),r.tile_manager.checkBuildQueue()})).then((function(){p&&r.debug.profileEnd("Scene.rebuild")}))},n.tileManagerBuildDone=function(){if(e.TextCanvas.pruneTextCache(),this.building){e.log("info","Scene: build geometry finished"),this.building.resolve&&(this.logFirstBuild(),this.building.resolve(!0));var t=this.building.queued;this.building=null,t?(e.log("debug","Scene: starting queued rebuild() request"),this.rebuild(t.options).then(t.resolve,t.reject)):this.tile_manager.updateLabels()}},n.loadScene=function(t,i){return new Promise(function(r,n){var o,s,a,l,c,u,h;return void 0===t&&(t=null),s=(o=void 0===i?{}:i).base_path,a=o.file_type,this.config_source=t||this.config_source,"string"==typeof this.config_source?this.base_path=e.pathForURL(s||this.config_source):this.base_path=e.pathForURL(s),this.config_path=this.base_path,Promise.resolve(Wc.loadScene(this.config_source,{path:this.base_path,type:a})).then(function(e){try{return c=(l=e).config,u=l.bundle,h=l.texture_nodes,this.config=c,this.config_bundle=u,r({texture_nodes:h})}catch(e){return n(e)}}.bind(this),n)}.bind(this))},n.setDataSource=function(t,i){if(t&&i&&i.type&&(i.url||i.data)){var r=null==this.config.sources[t],n=this.config.sources[t]=Object.assign({},i);return n.data&&"object"==typeof n.data&&(n.url=e.createObjectURL(new Blob([JSON.stringify(n.data)])),delete n.data),r?this.updateConfig({rebuild:{sources:[t]}}):this.rebuild({sources:[t]})}e.log("error","No name provided or not a valid config:",t,i)},n.createDataSources=function(t){var i=this;void 0===t&&(t=!1);var r=[],n=Object.keys(this.sources),o=0;for(var s in this.config.sources){var a=this.config.sources[s],l=this.sources[s];try{var c=Object.assign({},a,{name:s,id:o++});if(this.sources[s]=e.DataSource.create(c,this.sources),!this.sources[s])throw{}}catch(t){delete this.sources[s];var u="Could not create data source: "+t.message;e.log("warn","Scene: "+u,a),this.trigger("warning",{type:"sources",source:a,message:u})}(t||e.DataSource.tileLayoutChanged(this.sources[s],l))&&r.push(s)}for(var h in n.forEach((function(e){i.config.sources[e]||(delete i.sources[e],r.push(e))})),r.length>0&&this.tile_manager.removeTiles((function(e){return r.indexOf(e.source.name)>-1})),this.config.layers){var d=this.config.layers[h];!1!==d.enabled&&d.data&&this.sources[d.data.source]&&(this.sources[d.data.source].builds_geometry_tiles=!0)}},n.loadTextures=function(){var t=this;return e.Texture.createFromObject(this.gl,this.config.textures).then((function(){return e.Texture.createDefault(t.gl)}))},n.freePreviousTextures=function(){var t=this;this.prev_textures&&(this.prev_textures.forEach((function(i){!t.config.textures[i]&&e.Texture.textures[i]&&e.Texture.textures[i].destroy()})),this.prev_textures=null)},n.updateStyles=function(){if(!this.initialized&&!this.initializing)throw new Error("Scene.updateStyles() called before scene was initialized");for(var e in this.styles=this.style_manager.build(this.config.styles),this.style_manager.initStyles(this),this.styles)this.styles[e].setGL(this.gl);this.dirty=!0},n.getActiveCamera=function(){return this.view.getActiveCamera()},n.setActiveCamera=function(e){return this.view.setActiveCamera(e)},n.createLights=function(){for(var t in this.lights={},e.debugSettings.wireframe&&(e.Light.enabled=!1),this.config.lights)if(this.config.lights[t]&&"object"==typeof this.config.lights[t]){var i=this.config.lights[t];i.name=t.replace("-","_"),i.visible=!1!==i.visible,i.visible&&(this.lights[i.name]=e.Light.create(this.view,i))}e.Light.inject(this.lights)},n.setBackground=function(){var t=this.config.scene.background;this.background={},t&&t.color&&(this.background.color=e.StyleParser.createColorPropertyCache(t.color)),this.background.color||(this.background.color=e.StyleParser.createColorPropertyCache([0,0,0,0]))},n.updateBackground=function(){var t,i=this.background.computed_color,r=this.background.computed_color=e.StyleParser.evalCachedColorProperty(this.background.color,{zoom:this.view.tile_zoom});i&&!r.some((function(e,t){return i[t]!==e}))||(1===r[3]?this.canvas.style.backgroundColor="rgba("+r.map((function(e){return Math.floor(255*e)})).join(", ")+")":this.canvas.style.backgroundColor="transparent",(t=this.gl).clearColor.apply(t,r))},n.setIntrospection=function(e){var t=this;return e!==this.introspection?(this.introspection=null!=e&&e,this.updating++,this.updateConfig({normalize:!1}).then((function(){return t.updating--}))):Promise.resolve()},n.updateConfig=function(i){var r=this,n=void 0===i?{}:i,o=n.loading,s=void 0!==o&&o,a=n.rebuild,l=void 0===a||a,c=n.serialize_funcs,u=n.texture_nodes,h=void 0===u?{}:u,d=n.normalize,p=void 0===d||d,f=n.fade_in,A=void 0!==f&&f;this.generation=++t.generation,this.updating++,this.config=Wc.applyGlobalProperties(this.config),p&&Wc.normalize(this.config,this.config_bundle,h),Wc.hoistTextureNodes(this.config,this.config_bundle,h),this.trigger(s?"load":"update",{config:this.config}),this.style_manager.init(),this.view.reset(),this.createLights(),this.createDataSources(s),this.loadTextures(),this.setBackground(),e.FontManager.loadFonts(this.config.fonts),this.updateStyles();var m=l?this.rebuild(Object.assign({initial:s,new_generation:!1,serialize_funcs:c,fade_in:A},"object"==typeof l&&l)):this.syncConfigToWorker({serialize_funcs:c});return this.updating--,this.view.updateBounds(),this.requestRedraw(),m.then((function(){r.last_render_count=0,r.requestRedraw()}))},n.syncConfigToWorker=function(t){var i=(void 0===t?{}:t).serialize_funcs,r=void 0===i||i?e.Utils.serializeWithFunctions(this.config):JSON.stringify(this.config);return e.WorkerBroker.postMessage(this.workers,"self.updateConfig",{config:r,generation:this.generation,introspection:this.introspection},e.debugSettings)},n.createListeners=function(){var t=this;this.listeners={},this.listeners.view={move:function(){return t.trigger("move")}},this.view.subscribe(this.listeners.view),this.listeners.texture={update:function(){return t.dirty=!0},warning:function(e){return t.trigger("warning",Object.assign({type:"textures"},e))}},e.Texture.subscribe(this.listeners.texture),this.listeners.scene_loader={error:function(e){return t.trigger("error",Object.assign({type:"scene"},e))}},Wc.subscribe(this.listeners.scene_loader)},n.destroyListeners=function(){this.unsubscribeAll(),this.view.unsubscribe(this.listeners.view),e.Texture.unsubscribe(this.listeners.texture),Wc.unsubscribe(this.listeners.scene_loader),this.listeners=null},n.destroyFeatureSelection=function(){this.selection&&(this.selection.destroy(),this.selection=null)},n.resetFeatureSelection=function(){var t=this;this.selection=new e.FeatureSelection(this.gl,this.workers,(function(){return t.building})),this.last_render_count=0},n.resetWorkerFeatureSelection=function(t){void 0===t&&(t=null),this.workers&&e.WorkerBroker.postMessage(this.workers,"self.resetFeatureSelection",t)},n.getFeatureSelectionMapSize=function(){var t=this;return null==this.fetching_selection_map&&(this.fetching_selection_map=e.WorkerBroker.postMessage(this.workers,"self.getFeatureSelectionMapSize").then((function(e){return t.fetching_selection_map=null,e.reduce((function(e,t){return e+t}))}))),this.fetching_selection_map},n.resetTime=function(){this.start_time=+new Date},n.updateViewComplete=function(){!this.render_count_changed&&this.generation===this.last_complete_generation||this.building||this.tile_manager.isLoadingVisibleTiles()||!this.tile_manager.allVisibleTilesLabeled()||(this.tile_manager.updateLabels(),this.last_complete_generation=this.generation,this.trigger("view_complete",{first:!0!==this.view_complete}),this.view_complete=!0)},n.resetViewComplete=function(){this.last_complete_generation=null},n.screenshot=function(e){var t=(void 0===e?{}:e).background,i=void 0===t?"white":t;return this.requestRedraw(),this.media_capture.screenshot({background:i})},n.startVideoCapture=function(){return this.requestRedraw(),this.media_capture.startVideoCapture()},n.stopVideoCapture=function(){return this.media_capture.stopVideoCapture()},n.logFirstFrame=function(){0!==this.last_render_count||this.times.first_frame||(this.times.first_frame=+new Date-this.start_time,e.log("debug","Scene: initial frame time: "+this.times.first_frame))},n.logFirstBuild=function(){null==this.times.first_build&&(this.times.first_build=+new Date-this.start_time,e.log("debug","Scene: initial build time: "+this.times.first_build))},e._createClass(t,[{key:"animated",get:function(){var e=this;return!1!==this.config.scene.animated&&this.style_manager.getActiveStyles().some((function(t){return e.styles[t].animated}))}}]),t}();cu.id=0,cu.generation=0;var uu={map:{},scrollWheelZoom:{},doubleClickZoom:{}};return{leafletLayer:function(t){return function(t){if(void 0!==au)return new au(t);if(e.Thread.is_main){var i,r=t.leaflet||window.L,n=r.GridLayer?r.GridLayer:r.TileLayer,o=n===r.GridLayer?"1.x":"0.7.x",s={};return n===r.TileLayer&&(s._addTile=function(){},s._removeTile=function(){},s._reset=function(){n.prototype._reset.apply(this,arguments),this.scene&&this.scene.container&&this.scene.canvas&&this.scene.container.appendChild(this.scene.canvas)}),Object.assign(s,{initialize:function(e){e.showDebug=!!e.showDebug,r.setOptions(this,e),this.updateTangramDebugSettings(),this.createScene(),this.hooks={},this._updating_tangram=!1},createScene:function(){this.scene=cu.create(this.options.scene,{numWorkers:this.options.numWorkers,preUpdate:this.options.preUpdate,postUpdate:this.options.postUpdate,continuousZoom:"1.x"===au.leafletVersion,wrapView:!0!==this.options.noWrap,highDensityDisplay:this.options.highDensityDisplay,logLevel:this.options.logLevel,introspection:this.options.introspection,webGLContextOptions:this.options.webGLContextOptions,disableRenderLoop:this.options.disableRenderLoop})},onAdd:function(t){var i=this;this.scene||this.createScene(),n.prototype.onAdd.apply(this,arguments),this.hooks.resize=function(){i._updating_tangram=!0,i.updateSize(),i._updating_tangram=!1},t.on("resize",this.hooks.resize),this.hooks.move=function(){if(!i._updating_tangram){i._updating_tangram=!0,i.scene.view.setPanning(!0);var r=t.getCenter();r.zoom=Math.max(Math.min(t.getZoom(),t.getMaxZoom()||e.Geo.default_view_max_zoom),t.getMinZoom()),i.scene.view.setView(r),i._mapLayerCount>1&&i.scene.immediateRedraw(),i._updating_tangram=!1}},t.on("move",this.hooks.move),this.hooks.moveend=function(){i.scene.view.setPanning(!1),i.scene.requestRedraw()},t.on("moveend",this.hooks.moveend),this.hooks.drag=function(){i.scene.view.markUserInput()},t.on("drag",this.hooks.drag),this._map_pane_observer=new MutationObserver((function(e){e.forEach((function(){return i.reverseTransform()}))})),this._map_pane_observer.observe(t.getPanes().mapPane,{attributes:!0}),this.modifyScrollWheelBehavior(t),this.modifyZoomBehavior(t),this.trackMapLayerCounts(t),this.setupSelectionEventHandlers(t),this.setSelectionEvents(this.options.events,{radius:this.options.selectionRadius}),this.scene.container=this.getContainer(),this.updateSize(),this.updateView(),this.resizeOnFirstVisible(),this.scene.subscribe({move:this.onTangramViewUpdate.bind(this)}),this.scene.load(this.options.scene,{base_path:this.options.sceneBasePath,file_type:this.options.sceneFileType,blocking:!1}).then((function(){if(!i.options.attribution)for(var e=0,r=Object.entries(i.scene.config.sources);e<r.length;e++){var n=r[e][1];n.attribution&&t.attributionControl.addAttribution(n.attribution)}i._updating_tangram=!0,i.updateSize(),i.updateView(),i.reverseTransform(),i._updating_tangram=!1,i.fire("init")})).catch((function(e){i.fire("error",e)}))},onRemove:function(e){n.prototype.onRemove.apply(this,arguments),e.off("layeradd layerremove overlayadd overlayremove",this._updateMapLayerCount),e.off("resize",this.hooks.resize),e.off("move",this.hooks.move),e.off("moveend",this.hooks.moveend),e.off("drag",this.hooks.drag),e.off("click",this.hooks.click),e.off("mousemove",this.hooks.mousemove),e.off("mouseout",this.hooks.mouseout),document.removeEventListener("visibilitychange",this.hooks.visibilitychange),this.hooks={},this._map_pane_observer.disconnect(),this.scene&&(this.scene.destroy(),this.scene=null)},createTile:function(e){var t=e.x+"/"+e.y+"/"+e.z,i=document.createElement("div");if(i.setAttribute("data-tile-key",t),i.style.width="256px",i.style.height="256px",this.options.showDebug){var r=document.createElement("div");r.textContent=t,r.style.position="absolute",r.style.left=0,r.style.top=0,r.style.color="white",r.style.fontSize="16px",r.style.textOutline="1px #000000",r.style.padding="8px",i.appendChild(r),i.style.borderStyle="solid",i.style.borderColor="white",i.style.borderWidth="1px"}return i},modifyScrollWheelBehavior:function(e){if(this.scene.view.continuous_zoom&&e.scrollWheelZoom&&!1!==this.options.modifyScrollWheel){e.options.zoomSnap=0;var t=e.scrollWheelZoom.enabled();e.scrollWheelZoom.disable(),r.Browser.chrome||r.Browser.safari?e.scrollWheelZoom._onWheelScroll=function(e){var t=r.DomEvent.getWheelDelta(e);this._delta+=t,this._lastMousePos=this._map.mouseEventToContainerPoint(e),this._performZoom(),r.DomEvent.stop(e)}:e.options.wheelDebounceTime=20;var n=(s=function(e){e._moveEnd(!0),e.fire("viewreset")},a=2*e.options.wheelDebounceTime,function(){var e=this,t=arguments;clearTimeout(l),l=setTimeout((function(){l=null,s.apply(e,t)}),a)});uu.scrollWheelZoom._performZoom||(uu.scrollWheelZoom._performZoom=e.scrollWheelZoom._performZoom);var o=this;e.scrollWheelZoom._performZoom=function(){if(this._map===o._map){var e=this._map,t=e.getZoom();e._stop();var r=this._delta/(4*this._map.options.wheelPxPerZoomLevel);this._delta=0,t+r>=this._map.getMaxZoom()?r=this._map.getMaxZoom()-t:t+r<=this._map.getMinZoom()&&(r=this._map.getMinZoom()-t),r&&("center"===e.options.scrollWheelZoom?i(o,e.getCenter(),t+r):i(o,this._lastMousePos,t+r),n(e))}else uu.scrollWheelZoom._performZoom.call(this)},t&&e.scrollWheelZoom.enable()}var s,a,l},modifyZoomBehavior:function(e){if(this.scene.view.continuous_zoom&&!1!==this.options.modifyZoomBehavior){var t=this,n=function(t,n,o){e._stop();var s=e._zoom;n=r.latLng(n),o=void 0===o?s:o,o=Math.min(o,e.getMaxZoom());var a=Date.now(),l=75;return e._moveStart(!0),function c(){var u=(Date.now()-a)/l;u<=1?(e._flyToFrame=r.Util.requestAnimFrame(c,e),i(t,n,s+(o-s)*u)):i(t,n,o)._moveEnd(!0)}.call(e),e};if(e.doubleClickZoom){var o=e.doubleClickZoom.enabled();e.doubleClickZoom.disable(),uu.doubleClickZoom._onDoubleClick||(uu.doubleClickZoom._onDoubleClick=e.doubleClickZoom._onDoubleClick),e.doubleClickZoom._onDoubleClick=function(e){if(this._map===t._map){var i=this._map,r=i.getZoom(),o=i.options.zoomDelta,s=e.originalEvent.shiftKey?r-o:r+o;"center"===i.options.doubleClickZoom?n(t,i.getCenter(),s):n(t,i.containerPointToLatLng(e.containerPoint),s)}else uu.doubleClickZoom._onDoubleClick.call(this,e)},o&&e.doubleClickZoom.enable()}e._zoomAnimated&&(uu.map._animateZoom||(uu.map._animateZoom=e._animateZoom),e._animateZoom=function(e,i,o,s){this===t._map?(o&&(this._animatingZoom=!0,this._animateToCenter=e,this._animateToZoom=i,n(t,e,i)),setTimeout(r.Util.bind(this._onZoomTransitionEnd,this),250)):uu.map._animateZoom.call(this,e,i,o,s)})}},updateView:function(){var t=this._map.getCenter();t.zoom=Math.max(Math.min(this._map.getZoom(),this._map.getMaxZoom()||e.Geo.default_view_max_zoom),this._map.getMinZoom()),this.scene.view.setView(t)},updateSize:function(){var e=this._map.getSize();this.scene.resizeMap(e.x,e.y)},resizeOnFirstVisible:function(){var e=this,t=!0;this.hooks.visibilitychange=function(){t&&(t=!1,e.updateSize())},document.addEventListener("visibilitychange",this.hooks.visibilitychange)},onTangramViewUpdate:function(){if(this._map&&!this._updating_tangram){var e=this._map.getCenter(),t=this.scene.view.center;e.lng===t.lng&&e.lat===t.lat&&this._map.getZoom()===this.scene.view.zoom||(this._updating_tangram=!0,this._map.setView([this.scene.view.center.lat,this.scene.view.center.lng],this.scene.view.zoom,{animate:!1}),this._updating_tangram=!1)}},render:function(){this.scene&&this.scene.update()},reverseTransform:function(){if(this._map&&this.scene&&this.scene.container){var e=this._map.containerPointToLayerPoint([0,0]);r.DomUtil.setPosition(this.scene.container,e)}},setupSelectionEventHandlers:function(e){var t=this;this._selection_events={},this._selection_radius=null,this.hooks.click=function(e){"function"==typeof t._selection_events.click&&t.scene.getFeatureAt(e.containerPoint,{radius:t._selection_radius}).then((function(i){var r=Object.assign({},i,{leaflet_event:e});t._selection_events.click(r)}))},e.on("click",this.hooks.click),this.hooks.mousemove=function(e){"function"==typeof t._selection_events.hover&&t.scene.getFeatureAt(e.containerPoint,{radius:t._selection_radius}).then((function(i){var r=Object.assign({},i,{leaflet_event:e});t._selection_events.hover(r)}))},e.on("mousemove",this.hooks.mousemove),this.hooks.mouseout=function(e){"function"==typeof t._selection_events.hover&&t._selection_events.hover({changed:!0,leaflet_event:e})},e.on("mouseout",this.hooks.mouseout)},setSelectionEvents:function(e,t){var i=(void 0===t?{}:t).radius;this._selection_events=Object.assign(this._selection_events,e),this._selection_radius=void 0!==i?i:this._selection_radius},trackMapLayerCounts:function(e){var t=this;this._updateMapLayerCount=function(){var i=e.getPanes().mapPane.childNodes;t._mapLayerCount=0;for(var r=0;r<i.length;r++)t._mapLayerCount+=i[r].childNodes.length},e.on("layeradd layerremove overlayadd overlayremove",this._updateMapLayerCount),this._updateMapLayerCount()},updateTangramDebugSettings:function(){e.mergeDebugSettings(this.options.debug||{})}}),i=function(e,t,i){var n=e._map,o=e.scene,s=n.getZoomScale(i),a=n.getSize().divideBy(2),l=(t instanceof r.Point?t:n.latLngToContainerPoint(t)).subtract(a).multiplyBy(1-1/s),c=n.containerPointToLatLng(a.add(l));return o&&o.view.markUserInput(),n._move(c,i,{flyTo:!0})},"function"!=typeof(au=n.extend(s)).remove&&(au.prototype.remove=function(){this._map&&this._map.removeLayer(this),this.fire("remove")}),au.layerBaseClass=n,au.leafletVersion=o,new au(t)}}(t)},debug:{log:e.log,yaml:$c,Utils:e.Utils,Geo:e.Geo,Vector:e.Vector,DataSource:e.DataSource,GLSL:e.GLSL,ShaderProgram:e.ShaderProgram,VertexData:e.VertexData,Texture:e.Texture,Material:e.Material,Light:e.Light,Scene:cu,WorkerBroker:e.WorkerBroker,Task:e.Task,StyleManager:e.StyleManager,StyleParser:e.StyleParser,TileID:e.TileID,Collision:e.Collision,FeatureSelection:e.FeatureSelection,TextCanvas:e.TextCanvas,debugSettings:e.debugSettings},version:e.version}}));try{i.debug.ESM=!1,i.debug.SHA="81ee5a1ddf14547d5653c42972e0a66fa999d545"}catch(e){}return i}();class Mu extends me{constructor(e){super(),Ae(this,e,Eu,Su,a,{mapStyle:0})}}
/*!
 * Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com
 * License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License)
 * Copyright 2024 Fonticons, Inc.
 */const Iu={prefix:"fas",iconName:"compress",icon:[448,512,[],"f066","M160 64c0-17.7-14.3-32-32-32s-32 14.3-32 32l0 64-64 0c-17.7 0-32 14.3-32 32s14.3 32 32 32l96 0c17.7 0 32-14.3 32-32l0-96zM32 320c-17.7 0-32 14.3-32 32s14.3 32 32 32l64 0 0 64c0 17.7 14.3 32 32 32s32-14.3 32-32l0-96c0-17.7-14.3-32-32-32l-96 0zM352 64c0-17.7-14.3-32-32-32s-32 14.3-32 32l0 96c0 17.7 14.3 32 32 32l96 0c17.7 0 32-14.3 32-32s-14.3-32-32-32l-64 0 0-64zM320 320c-17.7 0-32 14.3-32 32l0 96c0 17.7 14.3 32 32 32s32-14.3 32-32l0-64 64 0c17.7 0 32-14.3 32-32s-14.3-32-32-32l-96 0z"]},Pu={prefix:"fas",iconName:"camera",icon:[512,512,[62258,"camera-alt"],"f030","M149.1 64.8L138.7 96 64 96C28.7 96 0 124.7 0 160L0 416c0 35.3 28.7 64 64 64l384 0c35.3 0 64-28.7 64-64l0-256c0-35.3-28.7-64-64-64l-74.7 0L362.9 64.8C356.4 45.2 338.1 32 317.4 32L194.6 32c-20.7 0-39 13.2-45.5 32.8zM256 192a96 96 0 1 1 0 192 96 96 0 1 1 0-192z"]},Lu={prefix:"fas",iconName:"link",icon:[640,512,[128279,"chain"],"f0c1","M579.8 267.7c56.5-56.5 56.5-148 0-204.5c-50-50-128.8-56.5-186.3-15.4l-1.6 1.1c-14.4 10.3-17.7 30.3-7.4 44.6s30.3 17.7 44.6 7.4l1.6-1.1c32.1-22.9 76-19.3 103.8 8.6c31.5 31.5 31.5 82.5 0 114L422.3 334.8c-31.5 31.5-82.5 31.5-114 0c-27.9-27.9-31.5-71.8-8.6-103.8l1.1-1.6c10.3-14.4 6.9-34.4-7.4-44.6s-34.4-6.9-44.6 7.4l-1.1 1.6C206.5 251.2 213 330 263 380c56.5 56.5 148 56.5 204.5 0L579.8 267.7zM60.2 244.3c-56.5 56.5-56.5 148 0 204.5c50 50 128.8 56.5 186.3 15.4l1.6-1.1c14.4-10.3 17.7-30.3 7.4-44.6s-30.3-17.7-44.6-7.4l-1.6 1.1c-32.1 22.9-76 19.3-103.8-8.6C74 372 74 321 105.5 289.5L217.7 177.2c31.5-31.5 82.5-31.5 114 0c27.9 27.9 31.5 71.8 8.6 103.9l-1.1 1.6c-10.3 14.4-6.9 34.4 7.4 44.6s34.4 6.9 44.6-7.4l1.1-1.6C433.5 260.8 427 182 377 132c-56.5-56.5-148-56.5-204.5 0L60.2 244.3z"]},Fu={prefix:"fas",iconName:"plus",icon:[448,512,[10133,61543,"add"],"2b","M256 80c0-17.7-14.3-32-32-32s-32 14.3-32 32l0 144L48 224c-17.7 0-32 14.3-32 32s14.3 32 32 32l144 0 0 144c0 17.7 14.3 32 32 32s32-14.3 32-32l0-144 144 0c17.7 0 32-14.3 32-32s-14.3-32-32-32l-144 0 0-144z"]},ku={prefix:"fas",iconName:"expand",icon:[448,512,[],"f065","M32 32C14.3 32 0 46.3 0 64l0 96c0 17.7 14.3 32 32 32s32-14.3 32-32l0-64 64 0c17.7 0 32-14.3 32-32s-14.3-32-32-32L32 32zM64 352c0-17.7-14.3-32-32-32s-32 14.3-32 32l0 96c0 17.7 14.3 32 32 32l96 0c17.7 0 32-14.3 32-32s-14.3-32-32-32l-64 0 0-64zM320 32c-17.7 0-32 14.3-32 32s14.3 32 32 32l64 0 0 64c0 17.7 14.3 32 32 32s32-14.3 32-32l0-96c0-17.7-14.3-32-32-32l-96 0zM448 352c0-17.7-14.3-32-32-32s-32 14.3-32 32l0 64-64 0c-17.7 0-32 14.3-32 32s14.3 32 32 32l96 0c17.7 0 32-14.3 32-32l0-96z"]},zu={prefix:"fas",iconName:"xmark",icon:[384,512,[128473,10005,10006,10060,215,"close","multiply","remove","times"],"f00d","M342.6 150.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L192 210.7 86.6 105.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L146.7 256 41.4 361.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L192 301.3 297.4 406.6c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L237.3 256 342.6 150.6z"]},Ru={prefix:"fas",iconName:"link-slash",icon:[640,512,["chain-broken","chain-slash","unlink"],"f127","M38.8 5.1C28.4-3.1 13.3-1.2 5.1 9.2S-1.2 34.7 9.2 42.9l592 464c10.4 8.2 25.5 6.3 33.7-4.1s6.3-25.5-4.1-33.7L489.3 358.2l90.5-90.5c56.5-56.5 56.5-148 0-204.5c-50-50-128.8-56.5-186.3-15.4l-1.6 1.1c-14.4 10.3-17.7 30.3-7.4 44.6s30.3 17.7 44.6 7.4l1.6-1.1c32.1-22.9 76-19.3 103.8 8.6c31.5 31.5 31.5 82.5 0 114l-96 96-31.9-25C430.9 239.6 420.1 175.1 377 132c-52.2-52.3-134.5-56.2-191.3-11.7L38.8 5.1zM239 162c30.1-14.9 67.7-9.9 92.8 15.3c20 20 27.5 48.3 21.7 74.5L239 162zM406.6 416.4L220.9 270c-2.1 39.8 12.2 80.1 42.2 110c38.9 38.9 94.4 51 143.6 36.3zm-290-228.5L60.2 244.3c-56.5 56.5-56.5 148 0 204.5c50 50 128.8 56.5 186.3 15.4l1.6-1.1c14.4-10.3 17.7-30.3 7.4-44.6s-30.3-17.7-44.6-7.4l-1.6 1.1c-32.1 22.9-76 19.3-103.8-8.6C74 372 74 321 105.5 289.5l61.8-61.8-50.6-39.9z"]},Du=parseFloat;function Ou(e,t=";"){let i;if(Array.isArray(e))i=e.filter((e=>e));else{i=[];for(const t in e)e[t]&&i.push(`${t}:${e[t]}`)}return i.join(t)}function Uu(e){let t,i,r,n,o,s,a;function l(e,t){return"string"==typeof e[7][4]?Qu:Nu}let c=l(e),u=c(e);return{c(){t=w("svg"),i=w("g"),r=w("g"),u.c(),E(r,"transform",e[10]),E(i,"transform",n=`translate(${e[7][0]/2} ${e[7][1]/2})`),E(i,"transform-origin",o=e[7][0]/4+" 0"),E(t,"id",e[0]),E(t,"class",s=m(e[8])+" svelte-1cj2gr0"),E(t,"style",e[9]),E(t,"viewBox",a=`0 0 ${e[7][0]} ${e[7][1]}`),E(t,"aria-hidden","true"),E(t,"role","img"),E(t,"xmlns","http://www.w3.org/2000/svg")},m(e,n){y(e,t,n),_(t,i),_(i,r),u.m(r,null)},p(e,h){c===(c=l(e))&&u?u.p(e,h):(u.d(1),u=c(e),u&&(u.c(),u.m(r,null))),1024&h&&E(r,"transform",e[10]),128&h&&n!==(n=`translate(${e[7][0]/2} ${e[7][1]/2})`)&&E(i,"transform",n),128&h&&o!==(o=e[7][0]/4+" 0")&&E(i,"transform-origin",o),1&h&&E(t,"id",e[0]),256&h&&s!==(s=m(e[8])+" svelte-1cj2gr0")&&E(t,"class",s),512&h&&E(t,"style",e[9]),128&h&&a!==(a=`0 0 ${e[7][0]} ${e[7][1]}`)&&E(t,"viewBox",a)},d(e){e&&v(t),u.d()}}}function Nu(e){let t,i,r,n,o,s,a,l,c,u;return{c(){t=w("path"),s=w("path"),E(t,"d",i=e[7][4][0]),E(t,"fill",r=e[3]||e[1]||"currentColor"),E(t,"fill-opacity",n=0!=e[6]?e[4]:e[5]),E(t,"transform",o=`translate(${e[7][0]/-2} ${e[7][1]/-2})`),E(s,"d",a=e[7][4][1]),E(s,"fill",l=e[2]||e[1]||"currentColor"),E(s,"fill-opacity",c=0!=e[6]?e[5]:e[4]),E(s,"transform",u=`translate(${e[7][0]/-2} ${e[7][1]/-2})`)},m(e,i){y(e,t,i),y(e,s,i)},p(e,h){128&h&&i!==(i=e[7][4][0])&&E(t,"d",i),10&h&&r!==(r=e[3]||e[1]||"currentColor")&&E(t,"fill",r),112&h&&n!==(n=0!=e[6]?e[4]:e[5])&&E(t,"fill-opacity",n),128&h&&o!==(o=`translate(${e[7][0]/-2} ${e[7][1]/-2})`)&&E(t,"transform",o),128&h&&a!==(a=e[7][4][1])&&E(s,"d",a),6&h&&l!==(l=e[2]||e[1]||"currentColor")&&E(s,"fill",l),112&h&&c!==(c=0!=e[6]?e[5]:e[4])&&E(s,"fill-opacity",c),128&h&&u!==(u=`translate(${e[7][0]/-2} ${e[7][1]/-2})`)&&E(s,"transform",u)},d(e){e&&v(t),e&&v(s)}}}function Qu(e){let t,i,r,n;return{c(){t=w("path"),E(t,"d",i=e[7][4]),E(t,"fill",r=e[1]||e[2]||"currentColor"),E(t,"transform",n=`translate(${e[7][0]/-2} ${e[7][1]/-2})`)},m(e,i){y(e,t,i)},p(e,o){128&o&&i!==(i=e[7][4])&&E(t,"d",i),6&o&&r!==(r=e[1]||e[2]||"currentColor")&&E(t,"fill",r),128&o&&n!==(n=`translate(${e[7][0]/-2} ${e[7][1]/-2})`)&&E(t,"transform",n)},d(e){e&&v(t)}}}function ju(e){let i,r=e[7][4]&&Uu(e);return{c(){r&&r.c(),i=C()},m(e,t){r&&r.m(e,t),y(e,i,t)},p(e,[t]){e[7][4]?r?r.p(e,t):(r=Uu(e),r.c(),r.m(i.parentNode,i)):r&&(r.d(1),r=null)},i:t,o:t,d(e){r&&r.d(e),e&&v(i)}}}function Vu(e,t,i){let r,n,o,s,{class:a=""}=t,{id:l=""}=t,{style:c=""}=t,{icon:u}=t,{size:h=""}=t,{color:d=""}=t,{fw:p=!1}=t,{pull:f=""}=t,{scale:A=1}=t,{translateX:m=0}=t,{translateY:g=0}=t,{rotate:_=""}=t,{flip:y=!1}=t,{spin:v=!1}=t,{pulse:x=!1}=t,{primaryColor:b=""}=t,{secondaryColor:w=""}=t,{primaryOpacity:T=1}=t,{secondaryOpacity:B=.4}=t,{swapOpacity:C=!1}=t;return e.$$set=e=>{"class"in e&&i(11,a=e.class),"id"in e&&i(0,l=e.id),"style"in e&&i(12,c=e.style),"icon"in e&&i(13,u=e.icon),"size"in e&&i(14,h=e.size),"color"in e&&i(1,d=e.color),"fw"in e&&i(15,p=e.fw),"pull"in e&&i(16,f=e.pull),"scale"in e&&i(17,A=e.scale),"translateX"in e&&i(18,m=e.translateX),"translateY"in e&&i(19,g=e.translateY),"rotate"in e&&i(20,_=e.rotate),"flip"in e&&i(21,y=e.flip),"spin"in e&&i(22,v=e.spin),"pulse"in e&&i(23,x=e.pulse),"primaryColor"in e&&i(2,b=e.primaryColor),"secondaryColor"in e&&i(3,w=e.secondaryColor),"primaryOpacity"in e&&i(4,T=e.primaryOpacity),"secondaryOpacity"in e&&i(5,B=e.secondaryOpacity),"swapOpacity"in e&&i(6,C=e.swapOpacity)},e.$$.update=()=>{8192&e.$$.dirty&&i(7,r=u&&u.icon||[0,0,"",[],""]),12584960&e.$$.dirty&&i(8,n=Ou([a,"svelte-fa",v&&"spin",x&&"pulse"]," ")),118784&e.$$.dirty&&i(9,o=function(e,t,i,r){let n,o,s,a,l,c="-.125em";return r&&(l="center",o="1.25em"),i&&(n=i),t&&("lg"==t?(a="1.33333em",s=".75em",c="-.225em"):a="xs"==t?".75em":"sm"==t?".875em":t.replace("x","em")),Ou([Ou({float:n,width:o,height:"1em","line-height":s,"font-size":a,"text-align":l,"vertical-align":c,"transform-origin":"center",overflow:"visible"}),e])}(c,h,f,p)),4063232&e.$$.dirty&&i(10,s=function(e,t,i,r,n,o=1,s="",a=""){let l=1,c=1;return n&&("horizontal"==n?l=-1:"vertical"==n?c=-1:l=c=-1),Ou([`translate(${Du(t)*o}${s},${Du(i)*o}${s})`,`scale(${l*Du(e)},${c*Du(e)})`,r&&`rotate(${r}${a})`]," ")}(A,m,g,_,y,512))},[l,d,b,w,T,B,C,r,n,o,s,a,c,u,h,p,f,A,m,g,_,y,v,x]}var Hu=class extends me{constructor(e){super(),Ae(this,e,Vu,ju,a,{class:11,id:0,style:12,icon:13,size:14,color:1,fw:15,pull:16,scale:17,translateX:18,translateY:19,rotate:20,flip:21,spin:22,pulse:23,primaryColor:2,secondaryColor:3,primaryOpacity:4,secondaryOpacity:5,swapOpacity:6})}},Gu={exports:{}},$u=Gu.exports=function(e,t){if(t||(t=16),void 0===e&&(e=128),e<=0)return"0";for(var i=Math.log(Math.pow(2,e))/Math.log(t),r=2;i===1/0;r*=2)i=Math.log(Math.pow(2,e/r))/Math.log(t)*r;var n=i-Math.floor(i),o="";for(r=0;r<Math.floor(i);r++){o=Math.floor(Math.random()*t).toString(t)+o}if(n){var s=Math.pow(t,n);o=Math.floor(Math.random()*s).toString(t)+o}var a=parseInt(o,t);return a!==1/0&&a>=Math.pow(2,e)?$u(e,t):o};$u.rack=function(e,t,i){var r=function(r){var o=0;do{if(o++>10){if(!i)throw new Error("too many ID collisions, use more bits");e+=i}var s=$u(e,t)}while(Object.hasOwnProperty.call(n,s));return n[s]=r,s},n=r.hats={};return r.get=function(e){return r.hats[e]},r.set=function(e,t){return r.hats[e]=t,r},r.bits=e||128,r.base=t||16,r};var Zu=Gu.exports;const qu=e=>{if("string"!=typeof e)return!1;return e.startsWith("mapbox://")},Ku={name:"Mapbox GL JS",value:"mapbox-gl"},Wu=[Ku,{name:"Maplibre GL JS",value:"maplibre-gl"},{name:"MapTiler SDK",value:"maptiler-sdk"}],Xu={google:[{name:"Google Maps",value:"google"}],leaflet:[{name:"Leaflet",value:"leaflet"}],tangram:[{name:"Tangram (Leaflet)",value:"tangram"}],"vector-gl":Wu,"mapbox-gl":Wu,"maplibre-gl":Wu,"maptiler-sdk":Wu},Yu=(e,t)=>{let i=!1;return"mapbox-gl"!==e.type?Xu[e.type]:(e.url&&qu(e.url)?i=!0:t&&(i=Object.values(t).some((e=>qu(e?.url)||(e?.tiles??[]).some((e=>qu(e)))))),i?[Ku]:Xu[e.type])},Ju=(e,t)=>{let i;const r=()=>window.removeEventListener("keydown",i),n=()=>{r(),t&&(i=i=>{!!t.alt==i.altKey&&!!t.shift==i.shiftKey&&!!t.control==(i.ctrlKey||i.metaKey)&&t.code==i.code&&(i.preventDefault(),t.callback?t.callback():e.click())},window.addEventListener("keydown",i))};return n(),{update:n,destroy:r}};function eh(e){let i,r,n,a,l,c,u,h,d,p,f,A=(e[2]??e[3])+"";return{c(){i=b("div"),r=b("div"),n=b("div"),l=B(),c=b("div"),u=b("div"),h=T(A),E(n,"class",a=m(e[1]?`caret-${e[4]}`:"caret-right")+" svelte-1q5ddxk"),E(r,"class","caret-container svelte-1q5ddxk"),E(u,"class","label svelte-1q5ddxk"),E(c,"class","label-container svelte-1q5ddxk"),E(i,"class",d=m(`toggle ${e[1]&&("up"===e[4]?"active-toggle-top":"active-toggle-bottom")}`)+" svelte-1q5ddxk")},m(t,o){y(t,i,o),_(i,r),_(r,n),_(i,l),_(i,c),_(c,u),_(u,h),p||(f=[S(i,"click",(function(){s(e[0])&&e[0].apply(this,arguments)})),S(i,"keydown",e[5])],p=!0)},p(t,[r]){e=t,18&r&&a!==(a=m(e[1]?`caret-${e[4]}`:"caret-right")+" svelte-1q5ddxk")&&E(n,"class",a),12&r&&A!==(A=(e[2]??e[3])+"")&&I(h,A),18&r&&d!==(d=m(`toggle ${e[1]&&("up"===e[4]?"active-toggle-top":"active-toggle-bottom")}`)+" svelte-1q5ddxk")&&E(i,"class",d)},i:t,o:t,d(e){e&&v(i),p=!1,o(f)}}}function th(e,t,i){let{openTopLevel:r}=t,{topLevelOpen:n}=t,{activeLabel:o}=t,{placeholder:s}=t,{direction:a}=t;return e.$$set=e=>{"openTopLevel"in e&&i(0,r=e.openTopLevel),"topLevelOpen"in e&&i(1,n=e.topLevelOpen),"activeLabel"in e&&i(2,o=e.activeLabel),"placeholder"in e&&i(3,s=e.placeholder),"direction"in e&&i(4,a=e.direction)},[r,n,o,s,a,()=>!1]}class ih extends me{constructor(e){super(),Ae(this,e,th,eh,a,{openTopLevel:0,topLevelOpen:1,activeLabel:2,placeholder:3,direction:4})}}function rh(e,t,i){const r=e.slice();return r[16]=t[i],r}function nh(e,t,i){const r=e.slice();return r[19]=t[i],r}function oh(e){let t,i;return t=new ih({props:{openTopLevel:e[7],topLevelOpen:e[4],activeLabel:e[6],direction:e[1],placeholder:e[2]}}),{c(){de(t.$$.fragment)},m(e,r){pe(t,e,r),i=!0},p(e,i){const r={};16&i&&(r.topLevelOpen=e[4]),64&i&&(r.activeLabel=e[6]),2&i&&(r.direction=e[1]),4&i&&(r.placeholder=e[2]),t.$set(r)},i(e){i||(le(t.$$.fragment,e),i=!0)},o(e){ce(t.$$.fragment,e),i=!1},d(e){fe(t,e)}}}function sh(e){let t,i,r=e[3],n=[];for(let t=0;t<r.length;t+=1)n[t]=dh(rh(e,r,t));return{c(){t=b("div");for(let e=0;e<n.length;e+=1)n[e].c();E(t,"class",i=m("menu "+("up"===e[1]?"menu-top":"menu-bottom"))+" svelte-hi8y1b")},m(e,i){y(e,t,i);for(let e=0;e<n.length;e+=1)n[e]&&n[e].m(t,null)},p(e,o){if(1833&o){let i;for(r=e[3],i=0;i<r.length;i+=1){const s=rh(e,r,i);n[i]?n[i].p(s,o):(n[i]=dh(s),n[i].c(),n[i].m(t,null))}for(;i<n.length;i+=1)n[i].d(1);n.length=r.length}2&o&&i!==(i=m("menu "+("up"===e[1]?"menu-top":"menu-bottom"))+" svelte-hi8y1b")&&E(t,"class",i)},d(e){e&&v(t),x(n,e)}}}function ah(e){let t,i,r,n,s,a,l,c,u,h,d,p=e[16].label+"";function f(){return e[15](e[16])}return{c(){t=b("div"),i=b("div"),r=B(),n=b("div"),s=b("div"),a=T(p),l=B(),E(i,"class","caret-container svelte-hi8y1b"),E(s,"class","label svelte-hi8y1b"),E(n,"class","label-container svelte-hi8y1b"),E(t,"class",c=m(`menu-item ${e[0]===e[16].value&&"active"}`)+" svelte-hi8y1b"),E(t,"title",u=e[16].label)},m(o,c){y(o,t,c),_(t,i),_(t,r),_(t,n),_(n,s),_(s,a),_(t,l),h||(d=[S(t,"click",f),S(t,"keydown",e[9])],h=!0)},p(i,r){e=i,8&r&&p!==(p=e[16].label+"")&&I(a,p),9&r&&c!==(c=m(`menu-item ${e[0]===e[16].value&&"active"}`)+" svelte-hi8y1b")&&E(t,"class",c),8&r&&u!==(u=e[16].label)&&E(t,"title",u)},d(e){e&&v(t),h=!1,o(d)}}}function lh(e){let t,i,r,n,s,a,l,c,u,h,d,p,f,A,g,x=e[16].label+"";function w(){return e[13](e[16])}let C=e[5]===e[16].id&&uh(e);return{c(){t=b("div"),i=b("div"),r=b("div"),n=b("div"),a=B(),l=b("div"),c=b("div"),u=T(x),p=B(),C&&C.c(),f=B(),E(n,"class",s=m(e[5]===e[16].id?"caret-down":"caret-right")+" svelte-hi8y1b"),E(r,"class","caret-container svelte-hi8y1b"),E(c,"class","label svelte-hi8y1b"),E(l,"class","label-container svelte-hi8y1b"),E(i,"class",h=m(`menu-item ${e[0]===e[16].value&&"active"}`)+" svelte-hi8y1b"),E(i,"title",d=e[16].label),E(t,"class","dropdown svelte-hi8y1b")},m(o,s){y(o,t,s),_(t,i),_(i,r),_(r,n),_(i,a),_(i,l),_(l,c),_(c,u),_(t,p),C&&C.m(t,null),_(t,f),A||(g=[S(i,"click",w),S(i,"keydown",e[9])],A=!0)},p(r,o){e=r,40&o&&s!==(s=m(e[5]===e[16].id?"caret-down":"caret-right")+" svelte-hi8y1b")&&E(n,"class",s),8&o&&x!==(x=e[16].label+"")&&I(u,x),9&o&&h!==(h=m(`menu-item ${e[0]===e[16].value&&"active"}`)+" svelte-hi8y1b")&&E(i,"class",h),8&o&&d!==(d=e[16].label)&&E(i,"title",d),e[5]===e[16].id?C?C.p(e,o):(C=uh(e),C.c(),C.m(t,f)):C&&(C.d(1),C=null)},d(e){e&&v(t),C&&C.d(),A=!1,o(g)}}}function ch(e){let t,i,r,n,o,s=e[16]?.header+"";return{c(){t=b("div"),i=b("div"),r=b("div"),n=T(s),o=B(),E(r,"class","label svelte-hi8y1b"),E(i,"class","label-container svelte-hi8y1b"),E(t,"class","header svelte-hi8y1b")},m(e,s){y(e,t,s),_(t,i),_(i,r),_(r,n),y(e,o,s)},p(e,t){8&t&&s!==(s=e[16]?.header+"")&&I(n,s)},d(e){e&&v(t),e&&v(o)}}}function uh(e){let t,i=e[16]?.options,r=[];for(let t=0;t<i.length;t+=1)r[t]=hh(nh(e,i,t));return{c(){t=b("div");for(let e=0;e<r.length;e+=1)r[e].c();E(t,"class","submenu svelte-hi8y1b")},m(e,i){y(e,t,i);for(let e=0;e<r.length;e+=1)r[e]&&r[e].m(t,null)},p(e,n){if(1545&n){let o;for(i=e[16]?.options,o=0;o<i.length;o+=1){const s=nh(e,i,o);r[o]?r[o].p(s,n):(r[o]=hh(s),r[o].c(),r[o].m(t,null))}for(;o<r.length;o+=1)r[o].d(1);r.length=i.length}},d(e){e&&v(t),x(r,e)}}}function hh(e){let t,i,r,n,s,a,l,c,u,h=e[19].label+"";function d(){return e[14](e[19])}return{c(){t=b("div"),i=b("div"),r=b("div"),n=T(h),s=B(),E(r,"class","label svelte-hi8y1b"),E(i,"class","label-container svelte-hi8y1b"),E(t,"class",a=m(`menu-item ${e[0]===e[19].value&&"active"}`)+" svelte-hi8y1b"),E(t,"title",l=e[19].label)},m(o,a){y(o,t,a),_(t,i),_(i,r),_(r,n),_(t,s),c||(u=[S(t,"click",d),S(t,"keydown",e[9])],c=!0)},p(i,r){e=i,8&r&&h!==(h=e[19].label+"")&&I(n,h),9&r&&a!==(a=m(`menu-item ${e[0]===e[19].value&&"active"}`)+" svelte-hi8y1b")&&E(t,"class",a),8&r&&l!==(l=e[19].label)&&E(t,"title",l)},d(e){e&&v(t),c=!1,o(u)}}}function dh(e){let t;function i(e,t){return e[16]?.header?ch:e[16]?.options?lh:ah}let r=i(e),n=r(e);return{c(){n.c(),t=C()},m(e,i){n.m(e,i),y(e,t,i)},p(e,o){r===(r=i(e))&&n?n.p(e,o):(n.d(1),n=r(e),n&&(n.c(),n.m(t.parentNode,t)))},d(e){n.d(e),e&&v(t)}}}function ph(e){let t,i;return t=new ih({props:{openTopLevel:e[7],topLevelOpen:e[4],activeLabel:e[6],direction:e[1],placeholder:e[2]}}),{c(){de(t.$$.fragment)},m(e,r){pe(t,e,r),i=!0},p(e,i){const r={};16&i&&(r.topLevelOpen=e[4]),64&i&&(r.activeLabel=e[6]),2&i&&(r.direction=e[1]),4&i&&(r.placeholder=e[2]),t.$set(r)},i(e){i||(le(t.$$.fragment,e),i=!0)},o(e){ce(t.$$.fragment,e),i=!1},d(e){fe(t,e)}}}function fh(e){let t,i,r,n,o="down"===e[1]&&oh(e),s=e[4]&&sh(e),a="up"===e[1]&&ph(e);return{c(){t=b("div"),o&&o.c(),i=B(),s&&s.c(),r=B(),a&&a.c(),E(t,"class","dropdown svelte-hi8y1b")},m(e,l){y(e,t,l),o&&o.m(t,null),_(t,i),s&&s.m(t,null),_(t,r),a&&a.m(t,null),n=!0},p(e,[n]){"down"===e[1]?o?(o.p(e,n),2&n&&le(o,1)):(o=oh(e),o.c(),le(o,1),o.m(t,i)):o&&(se(),ce(o,1,1,(()=>{o=null})),ae()),e[4]?s?s.p(e,n):(s=sh(e),s.c(),s.m(t,r)):s&&(s.d(1),s=null),"up"===e[1]?a?(a.p(e,n),2&n&&le(a,1)):(a=ph(e),a.c(),le(a,1),a.m(t,null)):a&&(se(),ce(a,1,1,(()=>{a=null})),ae())},i(e){n||(le(o),le(a),n=!0)},o(e){ce(o),ce(a),n=!1},d(e){e&&v(t),o&&o.d(),s&&s.d(),a&&a.d()}}}function Ah(e,t,i){let r,n,{options:o}=t,{activeValue:s}=t,{onSelect:a}=t,{direction:l="up"}=t,{placeholder:c=""}=t,u=!1,h=null;const d=e=>{i(5,h=h===e?null:e)},p=e=>{a(e),i(4,u=!1),i(5,h=null)};return e.$$set=e=>{"options"in e&&i(11,o=e.options),"activeValue"in e&&i(0,s=e.activeValue),"onSelect"in e&&i(12,a=e.onSelect),"direction"in e&&i(1,l=e.direction),"placeholder"in e&&i(2,c=e.placeholder)},e.$$.update=()=>{2048&e.$$.dirty&&i(3,r=o.map(((e,t)=>{let i={...e,id:`${t}`};return i.options&&(i.options=i.options.map(((e,i)=>({...e,id:`${t}-${i}`})))),i}))),9&e.$$.dirty&&i(6,n=r.filter((e=>!e?.header)).map((e=>e?.options?e?.options:e)).flat().find((e=>e.value===s))?.label)},[s,l,c,r,u,h,n,()=>{if(i(4,u=!u),u){const e=r.filter((e=>e.options)).find((e=>e.options.some((e=>e.value===s))));e&&i(5,h=e.id)}else i(5,h=null)},d,()=>!1,p,o,a,e=>d(e.id),e=>p(e.value),e=>p(e.value)]}class mh extends me{constructor(e){super(),Ae(this,e,Ah,fh,a,{options:11,activeValue:0,onSelect:12,direction:1,placeholder:2})}}function gh(e){let t,i,r,n;return i=new mh({props:{options:e[4],activeValue:e[0].dropdownId,onSelect:e[1],direction:e[3]}}),{c(){t=b("div"),de(i.$$.fragment),E(t,"id",r=`styles-dropdown-${e[2]}`)},m(e,r){y(e,t,r),pe(i,t,null),n=!0},p(e,[o]){const s={};16&o&&(s.options=e[4]),1&o&&(s.activeValue=e[0].dropdownId),2&o&&(s.onSelect=e[1]),8&o&&(s.direction=e[3]),i.$set(s),(!n||4&o&&r!==(r=`styles-dropdown-${e[2]}`))&&E(t,"id",r)},i(e){n||(le(i.$$.fragment,e),n=!0)},o(e){ce(i.$$.fragment,e),n=!1},d(e){e&&v(t),fe(i)}}}function _h(e,t,i){let r,{dropdownDisplayOptions:n}=t,{dropdownValue:o}=t,{onSelect:s}=t,{index:a}=t,l="up";return j((()=>{const e=document?.body?.clientHeight,t=document?.getElementById(`styles-dropdown-${a}`),r=t?.getBoundingClientRect(),n=r?.top;n&&e&&i(3,l=n<e/2?"down":"up")})),e.$$set=e=>{"dropdownDisplayOptions"in e&&i(5,n=e.dropdownDisplayOptions),"dropdownValue"in e&&i(0,o=e.dropdownValue),"onSelect"in e&&i(1,s=e.onSelect),"index"in e&&i(2,a=e.index)},e.$$.update=()=>{32&e.$$.dirty&&i(4,r=Object.entries(n).reduce(((e,[t,i])=>{e.push({header:t});for(const t of i)"sublist"===t.type?e.push({label:t.text,options:t.presets.map((e=>({label:e.text,value:e.dropdownId})))}):e.push({label:t.text,value:t.dropdownId});return e}),[]))},[o,s,a,l,r,n]}class yh extends me{constructor(e){super(),Ae(this,e,_h,gh,a,{dropdownDisplayOptions:5,dropdownValue:0,onSelect:1,index:2})}}function vh(e,t,i){const r=e.slice();return r[29]=t[i],r[31]=i,r}function xh(e){let t,i,r,n,s,a,l,c,u;return{c(){t=b("div"),i=b("input"),n=B(),s=b("button"),a=T("Submit"),E(i,"placeholder",r="branch"===e[7].dropdownType?"enter a branch name":"enter a url to a style"),E(i,"class","svelte-146mfz9"),O(i,"input-error",e[8]),s.disabled=l=e[7]?.url===e[6],E(t,"class","custom-input svelte-146mfz9")},m(r,o){y(r,t,o),_(t,i),P(i,e[6]),_(t,n),_(t,s),_(s,a),c||(u=[S(i,"input",e[18]),S(i,"focus",e[13]),S(i,"blur",e[14]),g(Ju.call(null,s,{code:"Enter",callback:e[12]})),S(s,"click",e[11])],c=!0)},p(e,t){128&t[0]&&r!==(r="branch"===e[7].dropdownType?"enter a branch name":"enter a url to a style")&&E(i,"placeholder",r),64&t[0]&&i.value!==e[6]&&P(i,e[6]),256&t[0]&&O(i,"input-error",e[8]),192&t[0]&&l!==(l=e[7]?.url===e[6])&&(s.disabled=l)},d(e){e&&v(t),c=!1,o(u)}}}function bh(e){let t,i;return{c(){t=b("div"),i=T(e[8]),E(t,"class","error-message svelte-146mfz9")},m(e,r){y(e,t,r),_(t,i)},p(e,t){256&t[0]&&I(i,e[8])},d(e){e&&v(t)}}}function wh(e){let t,i=e[9].values.length&&Th(e);return{c(){i&&i.c(),t=C()},m(e,r){i&&i.m(e,r),y(e,t,r)},p(e,r){e[9].values.length?i?i.p(e,r):(i=Th(e),i.c(),i.m(t.parentNode,t)):i&&(i.d(1),i=null)},d(e){i&&i.d(e),e&&v(t)}}}function Th(e){let t,i,r,n,o=e[9].values,s=[];for(let t=0;t<o.length;t+=1)s[t]=Bh(vh(e,o,t));return{c(){t=b("div"),i=b("div"),r=b("div"),r.textContent="Compile options:",n=B();for(let e=0;e<s.length;e+=1)s[e].c();E(r,"class","checkbox-label svelte-146mfz9"),E(i,"class","checkbox-options svelte-146mfz9"),E(t,"class","checkbox-container svelte-146mfz9")},m(e,o){y(e,t,o),_(t,i),_(i,r),_(i,n);for(let e=0;e<s.length;e+=1)s[e]&&s[e].m(i,null)},p(e,t){if(33440&t[0]){let r;for(o=e[9].values,r=0;r<o.length;r+=1){const n=vh(e,o,r);s[r]?s[r].p(n,t):(s[r]=Bh(n),s[r].c(),s[r].m(i,null))}for(;r<s.length;r+=1)s[r].d(1);s.length=o.length}},d(e){e&&v(t),x(s,e)}}}function Bh(e){let t,i,r,n,o,s,a,l,c,u,h,d=(e[29]?.label??e[29].value)+"";function p(){return e[20](e[29])}return{c(){t=b("div"),i=b("input"),o=B(),s=b("label"),a=T(d),c=B(),E(i,"type","checkbox"),E(i,"id",r=`${e[5]}-${e[31]}`),i.checked=n=e[7]?.selectedPrecompileOption&&e[7].selectedPrecompileOption.includes(e[29].value),E(s,"for",l=`${e[5]}-${e[31]}`),E(t,"class","checkbox-row svelte-146mfz9")},m(e,r){y(e,t,r),_(t,i),_(t,o),_(t,s),_(s,a),_(t,c),u||(h=S(i,"click",p),u=!0)},p(t,o){e=t,32&o[0]&&r!==(r=`${e[5]}-${e[31]}`)&&E(i,"id",r),640&o[0]&&n!==(n=e[7]?.selectedPrecompileOption&&e[7].selectedPrecompileOption.includes(e[29].value))&&(i.checked=n),512&o[0]&&d!==(d=(e[29]?.label??e[29].value)+"")&&I(a,d),32&o[0]&&l!==(l=`${e[5]}-${e[31]}`)&&E(s,"for",l)},d(e){e&&v(t),u=!1,h()}}}function Ch(e){let t,i="checkbox"===e[9]?.type&&wh(e);return{c(){i&&i.c(),t=C()},m(e,r){i&&i.m(e,r),y(e,t,r)},p(e,r){"checkbox"===e[9]?.type?i?i.p(e,r):(i=wh(e),i.c(),i.m(t.parentNode,t)):i&&(i.d(1),i=null)},d(e){i&&i.d(e),e&&v(t)}}}function Sh(e){let t,i,r,n,o,s,l,c,u,h,d,p=e[5];i=new yh({props:{dropdownDisplayOptions:e[0],dropdownValue:e[1],index:e[4],onSelect:e[17]}});let f=("custom"===e[7]?.dropdownType||"branch"===e[7]?.dropdownType)&&xh(e),A=!!e[8]&&bh(e);u=new mh({props:{options:e[2].map(Eh),activeValue:e[3],onSelect:e[19],direction:"up"}});let m=Ch(e);return{c(){t=b("div"),de(i.$$.fragment),r=B(),f&&f.c(),n=B(),A&&A.c(),o=B(),s=b("div"),l=b("span"),l.textContent="Rendered with",c=B(),de(u.$$.fragment),h=B(),m.c(),E(l,"class","nowrap svelte-146mfz9"),E(s,"class","renderer-control svelte-146mfz9"),E(t,"class","map-style-input svelte-146mfz9")},m(e,a){y(e,t,a),pe(i,t,null),_(t,r),f&&f.m(t,null),_(t,n),A&&A.m(t,null),_(t,o),_(t,s),_(s,l),_(s,c),pe(u,s,null),_(t,h),m.m(t,null),d=!0},p(e,r){const s={};1&r[0]&&(s.dropdownDisplayOptions=e[0]),2&r[0]&&(s.dropdownValue=e[1]),16&r[0]&&(s.index=e[4]),i.$set(s),"custom"===e[7]?.dropdownType||"branch"===e[7]?.dropdownType?f?f.p(e,r):(f=xh(e),f.c(),f.m(t,n)):f&&(f.d(1),f=null),e[8]?A?A.p(e,r):(A=bh(e),A.c(),A.m(t,o)):A&&(A.d(1),A=null);const l={};4&r[0]&&(l.options=e[2].map(Eh)),8&r[0]&&(l.activeValue=e[3]),u.$set(l),32&r[0]&&a(p,p=e[5])?(m.d(1),m=Ch(e),m.c(),m.m(t,null)):m.p(e,r)},i(e){d||(le(i.$$.fragment,e),le(u.$$.fragment,e),d=!0)},o(e){ce(i.$$.fragment,e),ce(u.$$.fragment,e),d=!1},d(e){e&&v(t),fe(i),f&&f.d(),A&&A.d(),fe(u),m.d(e)}}}const Eh=e=>({label:e.name,value:e.value});function Mh(e,t,i){let r;const n=H();let o,s,{dropdownDisplayOptions:a}=t,{dropdownValue:l}=t,{rendererOptions:c}=t,{rendererValue:u}=t,{activeUrl:h}=t,{index:d}=t,{mapIdIndex:p}=t,f=!1,A=null,m=!0;V((()=>{m=!1})),j((()=>{i(7,o=l),i(6,s=o.defaultText),g(o.url)}));const g=e=>{const t=e=>{if(!m||!e||h!==e)return!1;const t=new RegExp("^(?:[a-z+]+:)?//","i");return e.includes("localhost")||!t.test(e)};t(e)&&setTimeout((()=>t(e)&&y(e,!0)),3e3)},_=e=>{const t=["dropdownType","selected","defaultText"];let i={...Object.fromEntries(Object.entries(e).filter((([e,i])=>!t.includes(e))))};"branch"===o.dropdownType&&(i.branch=s),e&&(i.id=e.id??e?.style?.id,i.name=e.name??e?.style?.name),n("updateMapStore",{value:i})},y=async(e,t=!1)=>{let r;try{const i=await gu(e);if(i&&"object"==typeof i)return r=i,g(e),t?n("updateMapStore",{value:{style:r,isPolling:t}}):_({...o,style:r,url:e,isPolling:t}),{status:"200"}}catch(e){const{status:t,message:r}=e;return i(8,A=new Error(r)),{status:t}}},v=async e=>{const{status:t}=await y(e);"200"===t&&(i(7,o.url=e,o),g(e)),n("setUrl",{value:e})},x=async()=>{const{dropdownType:e,pattern:t}=o;let i="branch"===e?_u(t,s,o.id):s;if(o?.url!==i){if(i.includes("localhost")){const[e,t]=i.split("localhost");e||(i=`http://localhost${t}`)}v(i)}},b=e=>{let t=o?.selectedPrecompileOption??[];t=t.includes(e)?t.filter((t=>t!==e)):t.concat([e]),i(7,o={...o,selectedPrecompileOption:t}),_(o)};return e.$$set=e=>{"dropdownDisplayOptions"in e&&i(0,a=e.dropdownDisplayOptions),"dropdownValue"in e&&i(1,l=e.dropdownValue),"rendererOptions"in e&&i(2,c=e.rendererOptions),"rendererValue"in e&&i(3,u=e.rendererValue),"activeUrl"in e&&i(16,h=e.activeUrl),"index"in e&&i(4,d=e.index),"mapIdIndex"in e&&i(5,p=e.mapIdIndex)},e.$$.update=()=>{2&e.$$.dirty[0]&&i(9,r=l?.precompile?l?.precompile?.options:null),64&e.$$.dirty[0]&&(e=>{A&&void 0!==e&&i(8,A=null)})(s),2&e.$$.dirty[0]&&(()=>{const e=Object.entries(l).every((e=>{const[t,i]=e;return"url"===t||!(!o||o[t]!==i)||void 0}));if(e)return;const t=o?.dropdownType;i(7,o=l),i(8,A=null);const{dropdownType:r}=o;switch(r){case"preset":{const{type:e,url:t}=o;if(["google","leaflet"].includes(e)){_(o);break}v(t);break}case"branch":s&&"branch"===t&&x()}i(6,s=o.defaultText)})()},[a,l,c,u,d,p,s,o,A,r,n,x,()=>{f&&x()},()=>{f=!0},()=>{f=!1,A&&i(6,s=o.defaultText)},b,h,e=>n("selectOption",{dropdownId:e}),function(){s=this.value,i(6,s)},e=>n("selectRenderer",{value:e}),e=>b(e.value)]}class Ih extends me{constructor(e){super(),Ae(this,e,Mh,Sh,a,{dropdownDisplayOptions:0,dropdownValue:1,rendererOptions:2,rendererValue:3,activeUrl:16,index:4,mapIdIndex:5},null,[-1,-1])}}function Ph(e,t,i){const r=e.slice();return r[15]=t[i],r[17]=i,r}function Lh(e,t,i){const r=e.slice();return r[18]=t[i],r[20]=i,r}function Fh(e,t,i){const r=e.slice();return r[21]=t[i],r[17]=i,r}function kh(e,t,i){const r=e.slice();return r[23]=t[i],r[20]=i,r}function zh(e){let t,i,r,n=e[2].length&&Rh(),o=e[1].length&&Dh(e),s=e[5].length&&Nh(e);return{c(){n&&n.c(),t=B(),i=b("div"),o&&o.c(),r=B(),s&&s.c(),E(i,"class","controls svelte-1cgcqsn")},m(e,a){n&&n.m(e,a),y(e,t,a),y(e,i,a),o&&o.m(i,null),_(i,r),s&&s.m(i,null)},p(e,a){e[2].length?n||(n=Rh(),n.c(),n.m(t.parentNode,t)):n&&(n.d(1),n=null),e[1].length?o?o.p(e,a):(o=Dh(e),o.c(),o.m(i,r)):o&&(o.d(1),o=null),e[5].length?s?s.p(e,a):(s=Nh(e),s.c(),s.m(i,null)):s&&(s.d(1),s=null)},d(e){n&&n.d(e),e&&v(t),e&&v(i),o&&o.d(),s&&s.d()}}}function Rh(e){let t;return{c(){t=b("div"),t.textContent="Custom actions:",E(t,"class","action-dropdown svelte-1cgcqsn")},m(e,i){y(e,t,i)},d(e){e&&v(t)}}}function Dh(e){let t,i,r,n=e[1],s=[];for(let t=0;t<n.length;t+=1)s[t]=Uh(Fh(e,n,t));return{c(){t=b("select");for(let e=0;e<s.length;e+=1)s[e].c();E(t,"id","custom-actions"),void 0===e[4]&&J((()=>e[11].call(t)))},m(n,o){y(n,t,o);for(let e=0;e<s.length;e+=1)s[e]&&s[e].m(t,null);k(t,e[4],!0),i||(r=[S(t,"change",e[11]),S(t,"change",e[6])],i=!0)},p(e,i){if(2&i){let r;for(n=e[1],r=0;r<n.length;r+=1){const o=Fh(e,n,r);s[r]?s[r].p(o,i):(s[r]=Uh(o),s[r].c(),s[r].m(t,null))}for(;r<s.length;r+=1)s[r].d(1);s.length=n.length}16&i&&k(t,e[4])},d(e){e&&v(t),x(s,e),i=!1,o(r)}}}function Oh(e){let t,i,r,n=e[23]?.label+"";return{c(){t=b("option"),i=T(n),r=B(),t.__value=JSON.stringify({dropdown:e[17],option:e[20]}),t.value=t.__value},m(e,n){y(e,t,n),_(t,i),_(t,r)},p(e,t){2&t&&n!==(n=e[23]?.label+"")&&I(i,n)},d(e){e&&v(t)}}}function Uh(e){let t,i,r,n=e[21]?.options,o=[];for(let t=0;t<n.length;t+=1)o[t]=Oh(kh(e,n,t));return{c(){t=b("optgroup"),i=b("option"),i.textContent="Select action...";for(let e=0;e<o.length;e+=1)o[e].c();i.__value=null,i.value=i.__value,i.disabled=!0,i.selected=!0,i.hidden=!0,E(t,"label",r=e[21]?.label)},m(e,r){y(e,t,r),_(t,i);for(let e=0;e<o.length;e+=1)o[e]&&o[e].m(t,null)},p(e,i){if(2&i){let r;for(n=e[21]?.options,r=0;r<n.length;r+=1){const s=kh(e,n,r);o[r]?o[r].p(s,i):(o[r]=Oh(s),o[r].c(),o[r].m(t,null))}for(;r<o.length;r+=1)o[r].d(1);o.length=n.length}2&i&&r!==(r=e[21]?.label)&&E(t,"label",r)},d(e){e&&v(t),x(o,e)}}}function Nh(e){let t,i=e[5],r=[];for(let t=0;t<i.length;t+=1)r[t]=Vh(Ph(e,i,t));return{c(){t=b("div");for(let e=0;e<r.length;e+=1)r[e].c();E(t,"class","checkbox-container svelte-1cgcqsn")},m(e,i){y(e,t,i);for(let e=0;e<r.length;e+=1)r[e]&&r[e].m(t,null)},p(e,n){if(417&n){let o;for(i=e[5],o=0;o<i.length;o+=1){const s=Ph(e,i,o);r[o]?r[o].p(s,n):(r[o]=Vh(s),r[o].c(),r[o].m(t,null))}for(;o<r.length;o+=1)r[o].d(1);r.length=i.length}},d(e){e&&v(t),x(r,e)}}}function Qh(e){let t,i,r,n,o,s,a,l=e[18]?.label+"";function c(){return e[12](e[18])}return{c(){t=b("input"),r=B(),n=b("label"),o=T(l),E(t,"type","checkbox"),E(t,"id",e[20]),t.checked=i=e[8](e[18]?.checked),E(n,"for",e[20])},m(e,i){y(e,t,i),y(e,r,i),y(e,n,i),_(n,o),s||(a=S(t,"click",c),s=!0)},p(r,n){e=r,32&n&&i!==(i=e[8](e[18]?.checked))&&(t.checked=i),32&n&&l!==(l=e[18]?.label+"")&&I(o,l)},d(e){e&&v(t),e&&v(r),e&&v(n),s=!1,a()}}}function jh(e){let t,i=e[18]?.script(e[0]),r=i&&Qh(e);return{c(){r&&r.c(),t=C()},m(e,i){r&&r.m(e,i),y(e,t,i)},p(e,n){33&n&&(i=e[18]?.script(e[0])),i?r?r.p(e,n):(r=Qh(e),r.c(),r.m(t.parentNode,t)):r&&(r.d(1),r=null)},d(e){r&&r.d(e),e&&v(t)}}}function Vh(e){let t,i,r,n,o,s,a=e[15]?.label+"",l=e[15]?.options,c=[];for(let t=0;t<l.length;t+=1)c[t]=jh(Lh(e,l,t));return{c(){t=b("div"),i=b("div"),r=T(a),n=T(":"),o=B();for(let e=0;e<c.length;e+=1)c[e].c();s=B(),E(i,"class","checkbox-label"),E(t,"class","checkbox-options svelte-1cgcqsn")},m(e,a){y(e,t,a),_(t,i),_(i,r),_(i,n),_(t,o);for(let e=0;e<c.length;e+=1)c[e]&&c[e].m(t,null);_(t,s)},p(e,i){if(32&i&&a!==(a=e[15]?.label+"")&&I(r,a),417&i){let r;for(l=e[15]?.options,r=0;r<l.length;r+=1){const n=Lh(e,l,r);c[r]?c[r].p(n,i):(c[r]=jh(n),c[r].c(),c[r].m(t,s))}for(;r<c.length;r+=1)c[r].d(1);c.length=l.length}},d(e){e&&v(t),x(c,e)}}}function Hh(e){let i,r=e[3]&&zh(e);return{c(){r&&r.c(),i=C()},m(e,t){r&&r.m(e,t),y(e,i,t)},p(e,[t]){e[3]?r?r.p(e,t):(r=zh(e),r.c(),r.m(i.parentNode,i)):r&&(r.d(1),r=null)},i:t,o:t,d(e){r&&r.d(e),e&&v(i)}}}function Gh(e,t,i){let r,n,o,s;l(e,it,(e=>i(13,s=e)));let a,{mapId:c}=t,{mapIdIndex:u}=t,h=!1;st.subscribe((e=>{const t=u.split("-").pop();i(0,a=e?.[t])}));const{customJs:d=[]}=s;let p=null;const f=e=>{if(u.split("-").pop(),!a||!e)return;e(a)()};return e.$$set=e=>{"mapId"in e&&i(9,c=e.mapId),"mapIdIndex"in e&&i(10,u=e.mapIdIndex)},e.$$.update=()=>{if(512&e.$$.dirty&&i(2,r=d.filter((e=>e.mapIds.includes(c)))),4&e.$$.dirty&&i(1,n=r.filter((e=>"dropdown"===e.type))),4&e.$$.dirty&&i(5,o=r.filter((e=>"checkbox"===e.type))),2&e.$$.dirty&&(n.length||i(4,p=null)),1&e.$$.dirty&&a){a.isStyleLoaded?.()??!0?i(3,h=!0):a.on("style.load",(()=>{i(3,h=!0)}))}},[a,n,r,h,p,o,e=>{const{dropdown:t,option:i}=JSON.parse(e.target.value),r=n?.[t]?.options?.[i];if(!a||!r)return;const{script:o}=r;o(a)()},f,e=>{if("boolean"==typeof e)return e;if(!a||!e)return;return e(a)()},c,u,function(){p=function(e){const t=e.querySelector(":checked");return t&&t.__value}(this),i(4,p),i(1,n),i(2,r),i(9,c)},e=>f(e?.script)]}class $h extends me{constructor(e){super(),Ae(this,e,Gh,Hh,a,{mapId:9,mapIdIndex:10})}}function Zh(e){let t,i;return t=new Ih({props:{dropdownValue:e[6],dropdownDisplayOptions:e[4],rendererOptions:e[7],rendererValue:e[2],index:e[0],mapIdIndex:e[1],activeUrl:e[3]}}),t.$on("setUrl",e[9]),t.$on("selectOption",e[10]),t.$on("selectRenderer",e[11]),t.$on("updateMapStore",e[12]),{c(){de(t.$$.fragment)},m(e,r){pe(t,e,r),i=!0},p(e,i){const r={};64&i&&(r.dropdownValue=e[6]),16&i&&(r.dropdownDisplayOptions=e[4]),128&i&&(r.rendererOptions=e[7]),4&i&&(r.rendererValue=e[2]),1&i&&(r.index=e[0]),2&i&&(r.mapIdIndex=e[1]),8&i&&(r.activeUrl=e[3]),t.$set(r)},i(e){i||(le(t.$$.fragment,e),i=!0)},o(e){ce(t.$$.fragment,e),i=!1},d(e){fe(t,e)}}}function qh(e){let t,i,r,n,o=e[5]&&Zh(e);return r=new $h({props:{mapId:e[8],mapIdIndex:e[1]}}),{c(){t=b("div"),o&&o.c(),i=B(),de(r.$$.fragment),E(t,"class","map-style-input-wrapper svelte-7abtsv")},m(e,s){y(e,t,s),o&&o.m(t,null),_(t,i),pe(r,t,null),n=!0},p(e,[n]){e[5]?o?(o.p(e,n),32&n&&le(o,1)):(o=Zh(e),o.c(),le(o,1),o.m(t,i)):o&&(se(),ce(o,1,1,(()=>{o=null})),ae());const s={};256&n&&(s.mapId=e[8]),2&n&&(s.mapIdIndex=e[1]),r.$set(s)},i(e){n||(le(o),le(r.$$.fragment,e),n=!0)},o(e){ce(o),ce(r.$$.fragment,e),n=!1},d(e){e&&v(t),o&&o.d(),fe(r)}}}function Kh(e,t,i){let r,n,o,s,a,l,{index:c}=t,{stylesheet:u}=t,{mapIdIndex:h}=t;it.subscribe((e=>({branchPatterns:r}=e)));let d=[];et.subscribe((e=>{i(14,n=e.find((e=>e.index===c))),n&&(o=n.branch,s=n.renderer,a=n.type,i(3,l=n.url))}));let p,f,A={},m=[],g=[];const _=()=>{let e;for(const t of m)if(t?.selected&&(e=t),"sublist"===t?.type)for(const i of t?.presets)i?.selected&&(e=i);if(e){switch(e=je(e),e.dropdownType){case"preset":e={...e,defaultText:""};break;case"branch":e={...e,defaultText:o??""};break;case"custom":e={...e,defaultText:l,url:l}}i(6,p=e)}},y=()=>{i(7,g=Yu(p,u?.sources)),v()},v=()=>{let e=s;const t=Yu(p,u?.sources).map((e=>e.value));e&&t.includes(e)||(e=t.includes(p.type)?p.type:t[0]),i(2,f=e)},x=()=>{(()=>{if(i(4,A={}),i(5,m=[]),d.length){const e=d.map(((e,t)=>{let i;return n.id===e.id&&(i=n?.selectedPrecompileOption),{...e,dropdownType:"preset",selected:l===e?.url&&a===e?.type,dropdownId:Zu(),...e.precompile&&{selectedPrecompileOption:i??e.precompile.options.default},..."sublist"===e.type&&{presets:e.presets.map((t=>({...t,dropdownType:"preset",selected:l===t?.url&&a===t?.type,dropdownId:Zu(),...e.precompile&&{selectedPrecompileOption:i??e.precompile.options.default}})))}}}));i(5,m=m.concat(e)),i(4,A.Presets=e.map((e=>({text:e.name,..."sublist"!==e.type&&{dropdownId:e.dropdownId},..."sublist"===e.type&&{type:"sublist",presets:e.presets.map((t=>({text:t.name,dropdownId:t.dropdownId,...e.precompile&&{selectedPrecompileOption:selectedPrecompileOption??e.precompile.options.default}})))}}))),A)}if(r){let e=[];for(const t of r){let r;n.id===t.id&&(r=n?.selectedPrecompileOption);let s={name:t.name??t.id,type:"sublist",dropdownId:Zu(),presets:[],...t.precompile&&{precompile:t.precompile,selectedPrecompileOption:r??t.precompile.options.default}};if(t?.styles?.length){const e=t?.styles.map((e=>({screenshotName:`${t.name??t.id}: ${e} on`,name:`${t.name??t.id}: ${e} on...`,branchId:t?.id,id:e,branchStyle:e,type:t.type,dropdownType:"branch",selected:!(!o||_u(t.pattern,o,e)!==l||t.type!==a),pattern:t.pattern,dropdownId:Zu(),...t.precompile&&{precompile:t.precompile,selectedPrecompileOption:r??t.precompile.options.default}})));s.presets=s.presets.concat(e)}e.push(s),i(5,m=m.concat(e)),i(4,A["Styles on a branch"]=e.map((e=>({text:e.name,..."sublist"!==e.type&&{dropdownId:e.dropdownId},..."sublist"===e.type&&{type:"sublist",presets:e.presets.map((e=>({text:e.name,dropdownId:e.dropdownId})))}}))),A)}}const e=[{name:"Fetch URL at...",dropdownType:"custom",selected:!m.some((e=>!!e?.selected||e?.presets?.some((e=>!!e.selected)))),type:"mapbox-gl",renderer:"mapbox-gl",dropdownId:Zu()}];i(5,m=m.concat(e)),i(4,A.Custom=e.map((e=>({text:e.name,dropdownId:e.dropdownId}))),A)})(),_()};tt.subscribe((e=>{d=e,x(),y()}));let b;return e.$$set=e=>{"index"in e&&i(0,c=e.index),"stylesheet"in e&&i(13,u=e.stylesheet),"mapIdIndex"in e&&i(1,h=e.mapIdIndex)},e.$$.update=()=>{var t;16384&e.$$.dirty&&(!(t=n)||"branch"===p?.dropdownType&&!p?.url&&n.isPolling||t.type===p.type&&t.url===p.url||x()),4&e.$$.dirty&&(e=>{et.update((t=>t.map(((t,i)=>i!==c?t:{...t,renderer:e}))))})(f),16384&e.$$.dirty&&n&&i(8,b=n?.branchId??n?.id??null)},[c,h,f,l,A,m,p,g,b,e=>{i(6,p.url=e.detail.value,p),y()},e=>{const{dropdownId:t}=e.detail;i(5,m=m.reduce(((e,i)=>{let r=i;return"sublist"===r?.type?r.presets=r.presets.map((e=>({...e,selected:e.dropdownId===t}))):r={...r,selected:i.dropdownId===t},r?.selected&&r?.selectedPrecompileOption&&(r.selectedPrecompileOption=r.precompile.options.default),e.push(r),e}),[])),_(),y()},e=>{i(2,f=e.detail.value)},e=>{const{value:t}=e.detail;if(t.isPolling)et.update((e=>e.map(((e,i)=>i===c?{...e,...t}:e))));else{const e={...t,index:c,renderer:s};delete e.dropdownId,et.update((t=>t.map(((t,i)=>i===c?e:t))))}},u,n]}class Wh extends me{constructor(e){super(),Ae(this,e,Kh,qh,a,{index:0,stylesheet:13,mapIdIndex:1})}}function Xh(e){let t,i,r,n;const o=e[1].default,s=c(o,e,e[0],null);return{c(){t=b("button"),s&&s.c(),E(t,"class","svelte-d9bm20")},m(o,a){y(o,t,a),s&&s.m(t,null),i=!0,r||(n=S(t,"click",e[2]),r=!0)},p(e,[t]){s&&s.p&&(!i||1&t)&&d(s,o,e,e[0],i?h(o,e[0],t,null):p(e[0]),null)},i(e){i||(le(s,e),i=!0)},o(e){ce(s,e),i=!1},d(e){e&&v(t),s&&s.d(e),r=!1,n()}}}function Yh(e,t,i){let{$$slots:r={},$$scope:n}=t;return e.$$set=e=>{"$$scope"in e&&i(0,n=e.$$scope)},[n,r,function(t){G.call(this,e,t)}]}class Jh extends me{constructor(e){super(),Ae(this,e,Yh,Xh,a,{})}}function ed(e){let t,i,r,n,o,s,a,l,c,u,h,d,p;return a=new Jh({props:{$$slots:{default:[id]},$$scope:{ctx:e}}}),a.$on("click",e[6]),u=new Jh({props:{$$slots:{default:[rd]},$$scope:{ctx:e}}}),u.$on("click",e[5]),{c(){t=b("div"),i=b("div"),r=T(e[2]),n=B(),o=b("div"),s=b("div"),de(a.$$.fragment),l=B(),c=b("div"),de(u.$$.fragment),E(i,"class","map-state svelte-1nshzal"),E(s,"class","svelte-1nshzal"),E(c,"class","svelte-1nshzal"),E(o,"class","location-actions svelte-1nshzal"),E(t,"class","map-state-container svelte-1nshzal")},m(f,A){y(f,t,A),_(t,i),_(i,r),_(t,n),_(t,o),_(o,s),pe(a,s,null),_(o,l),_(o,c),pe(u,c,null),h=!0,d||(p=S(i,"click",e[5]),d=!0)},p(e,t){(!h||4&t)&&I(r,e[2]);const i={};2097152&t&&(i.$$scope={dirty:t,ctx:e}),a.$set(i);const n={};2097153&t&&(n.$$scope={dirty:t,ctx:e}),u.$set(n)},i(e){h||(le(a.$$.fragment,e),le(u.$$.fragment,e),h=!0)},o(e){ce(a.$$.fragment,e),ce(u.$$.fragment,e),h=!1},d(e){e&&v(t),fe(a),fe(u),d=!1,p()}}}function td(e){let i,r,n,s,a;return{c(){i=b("div"),r=b("input"),n=b("label"),n.textContent="enter zoom/lat/lng[/pitch/bearing]",F(r,"height","18px"),E(r,"type","text"),E(n,"class","input-label svelte-1nshzal"),E(i,"class","state-record svelte-1nshzal")},m(t,o){y(t,i,o),_(i,r),P(r,e[3]),e[17](r),_(i,n),s||(a=[S(r,"input",e[15]),S(r,"keydown",e[16]),S(r,"focus",od)],s=!0)},p(e,t){8&t&&r.value!==e[3]&&P(r,e[3])},i:t,o:t,d(t){t&&v(i),e[17](null),s=!1,o(a)}}}function id(e){let t;return{c(){t=T("change")},m(e,i){y(e,t,i)},d(e){e&&v(t)}}}function rd(e){let t,i=e[0]?"copied":"copy";return{c(){t=T(i)},m(e,i){y(e,t,i)},p(e,r){1&r&&i!==(i=e[0]?"copied":"copy")&&I(t,i)},d(e){e&&v(t)}}}function nd(e){let t,i,r,n;const o=[td,ed],s=[];function a(e,t){return e[1]?0:1}return i=a(e),r=s[i]=o[i](e),{c(){t=b("div"),r.c()},m(e,r){y(e,t,r),s[i].m(t,null),n=!0},p(e,[n]){let l=i;i=a(e),i===l?s[i].p(e,n):(se(),ce(s[l],1,1,(()=>{s[l]=null})),ae(),r=s[i],r?r.p(e,n):(r=s[i]=o[i](e),r.c()),le(r,1),r.m(t,null))},i(e){n||(le(r),n=!0)},o(e){ce(r),n=!1},d(e){e&&v(t),s[i].d()}}}const od=e=>e.target.select();function sd(e,t,i){let r,n,{bearing:o}=t,{center:s}=t,{pitch:a}=t,{zoom:l}=t;const c=H();let u,h=!1,d=!1,p="",f="";const A=()=>{i(1,d=!1)},m=()=>{i(1,d=!1),i(0,h=!1);const[e,t,r,n,o]=f.split("/"),s=(({zoom:e,lat:t,lng:i,pitch:r,bearing:n})=>{let o=!0;return[e,t,i,r,n].filter(Boolean).every((e=>!isNaN(Number(e))))||(o=!1),(+e<0||+e>24)&&(o=!1),(+t<-90||+t>90)&&(o=!1),(+i<-180||+i>180)&&(o=!1),void 0!==r&&(+r<0||+r>85)&&(o=!1),void 0!==n&&isNaN(+n)&&(o=!1),o})({zoom:e,lat:t,lng:r,pitch:n,bearing:o});if(!s)return;const a={mapStateUpdateOrigin:"controls"};void 0!==e&&(a.zoom=+e),void 0!==t&&void 0!==r&&(a.center={lng:+r,lat:+t}),void 0!==n&&(a.pitch=+n),void 0!==o&&(a.bearing=+o),c("mapState",{options:a})};return e.$$set=e=>{"bearing"in e&&i(9,o=e.bearing),"center"in e&&i(10,s=e.center),"pitch"in e&&i(11,a=e.pitch),"zoom"in e&&i(12,l=e.zoom)},e.$$.update=()=>{1024&e.$$.dirty&&i(14,r=s.lat),1024&e.$$.dirty&&i(13,n=s.lng),31232&e.$$.dirty&&((e,t,r,n,o)=>{let s=[lt(r,2),lt(e,5),lt(t,5)];(n||o)&&(s.push(lt(n,1)),s.push(lt(o,1))),i(2,p=s.join("/")),i(0,h=!1)})(r,n,l,a,o)},[h,d,p,f,u,()=>{i(0,h=!0),navigator.clipboard.writeText(p)},async()=>{i(1,d=!0),i(3,f=p),await(Y(),W),u.focus()},A,m,o,s,a,l,n,r,function(){f=this.value,i(3,f)},e=>{"Enter"===e.key&&m(),"Escape"===e.key&&A()},function(e){Z[e?"unshift":"push"]((()=>{u=e,i(4,u)}))}]}class ad extends me{constructor(e){super(),Ae(this,e,sd,nd,a,{bearing:9,center:10,pitch:11,zoom:12})}}function ld(e){let t,i,r,n,o,a,l,c,u,h,d,p,f,A=!e[8]&&Object.keys(e[6]).length;r=new Hu({props:{icon:zu}}),u=new Wh({props:{index:e[0],stylesheet:e[4],mapIdIndex:e[5]}});let m=A&&cd(e);return{c(){t=b("div"),i=b("button"),de(r.$$.fragment),n=B(),o=b("div"),a=T(e[1]),l=B(),c=b("div"),de(u.$$.fragment),h=B(),m&&m.c(),E(i,"class","close-button svelte-1mnw17n"),i.disabled=e[3],E(o,"class","map-name svelte-1mnw17n"),E(c,"class","options-container svelte-1mnw17n"),E(t,"class","map-label svelte-1mnw17n")},m(A,g){y(A,t,g),_(t,i),pe(r,i,null),_(t,n),_(t,o),_(o,a),_(t,l),_(t,c),pe(u,c,null),_(c,h),m&&m.m(c,null),d=!0,p||(f=S(i,"click",(function(){s(e[2])&&e[2].apply(this,arguments)})),p=!0)},p(t,r){e=t,(!d||8&r)&&(i.disabled=e[3]),(!d||2&r)&&I(a,e[1]);const n={};1&r&&(n.index=e[0]),16&r&&(n.stylesheet=e[4]),32&r&&(n.mapIdIndex=e[5]),u.$set(n),320&r&&(A=!e[8]&&Object.keys(e[6]).length),A?m?(m.p(e,r),320&r&&le(m,1)):(m=cd(e),m.c(),le(m,1),m.m(c,null)):m&&(se(),ce(m,1,1,(()=>{m=null})),ae())},i(e){d||(le(r.$$.fragment,e),le(u.$$.fragment,e),le(m),d=!0)},o(e){ce(r.$$.fragment,e),ce(u.$$.fragment,e),ce(m),d=!1},d(e){e&&v(t),fe(r),fe(u),m&&m.d(),p=!1,f()}}}function cd(e){let t,r,n;const o=[e[6]];let s={};for(let e=0;e<o.length;e+=1)s=i(s,o[e]);return r=new ad({props:s}),r.$on("mapState",e[10]),{c(){t=b("div"),de(r.$$.fragment),E(t,"class","location-control svelte-1mnw17n")},m(e,i){y(e,t,i),pe(r,t,null),n=!0},p(e,t){const i=64&t?ue(o,[he(e[6])]):{};r.$set(i)},i(e){n||(le(r.$$.fragment,e),n=!0)},o(e){ce(r.$$.fragment,e),n=!1},d(e){e&&v(t),fe(r)}}}function ud(e){let t,i,r=e[7]&&ld(e);return{c(){r&&r.c(),t=C()},m(e,n){r&&r.m(e,n),y(e,t,n),i=!0},p(e,[i]){e[7]?r?(r.p(e,i),128&i&&le(r,1)):(r=ld(e),r.c(),le(r,1),r.m(t.parentNode,t)):r&&(se(),ce(r,1,1,(()=>{r=null})),ae())},i(e){i||(le(r),i=!0)},o(e){ce(r),i=!1},d(e){r&&r.d(e),e&&v(t)}}}function hd(e,t,i){let r,n,o,s;l(e,rt,(e=>i(7,o=e))),l(e,nt,(e=>i(8,s=e)));let a,{index:c}=t,{name:u}=t,{onClose:h}=t,{disableClose:d}=t,{mapState:p}=t,{stylesheet:f}=t,{mapIdIndex:A}=t;return e.$$set=e=>{"index"in e&&i(0,c=e.index),"name"in e&&i(1,u=e.name),"onClose"in e&&i(2,h=e.onClose),"disableClose"in e&&i(3,d=e.disableClose),"mapState"in e&&i(9,p=e.mapState),"stylesheet"in e&&i(4,f=e.stylesheet),"mapIdIndex"in e&&i(5,A=e.mapIdIndex)},e.$$.update=()=>{512&e.$$.dirty&&i(6,({showBoundaries:r,showCollisions:n,...a}=p),a)},[c,u,h,d,f,A,a,o,s,p,function(t){G.call(this,e,t)}]}class dd extends me{constructor(e){super(),Ae(this,e,hd,ud,a,{index:0,name:1,onClose:2,disableClose:3,mapState:9,stylesheet:4,mapIdIndex:5})}}const pd=["swipe","mirror","phone","responsive"],fd=(e,t)=>{const i=t.some((({type:e})=>"google"===e));return i?e.zoom<12?35:45:60},Ad=(e,t)=>{const i={...e};if((e=>e.some((({type:e})=>"google"===e)))(t)){const r=fd(e,t);i.pitch>r&&(i.pitch=r)}return i};var md={exports:{}};!function(e,t){var i="__lodash_hash_undefined__",r=9007199254740991,n="[object Arguments]",o="[object Array]",s="[object Boolean]",a="[object Date]",l="[object Error]",c="[object Function]",u="[object Map]",h="[object Number]",d="[object Object]",p="[object Promise]",f="[object RegExp]",A="[object Set]",m="[object String]",g="[object Symbol]",_="[object WeakMap]",y="[object ArrayBuffer]",v="[object DataView]",x=/^\[object .+?Constructor\]$/,b=/^(?:0|[1-9]\d*)$/,w={};w["[object Float32Array]"]=w["[object Float64Array]"]=w["[object Int8Array]"]=w["[object Int16Array]"]=w["[object Int32Array]"]=w["[object Uint8Array]"]=w["[object Uint8ClampedArray]"]=w["[object Uint16Array]"]=w["[object Uint32Array]"]=!0,w[n]=w[o]=w[y]=w[s]=w[v]=w[a]=w[l]=w[c]=w[u]=w[h]=w[d]=w[f]=w[A]=w[m]=w[_]=!1;var T="object"==typeof Ve&&Ve&&Ve.Object===Object&&Ve,B="object"==typeof self&&self&&self.Object===Object&&self,C=T||B||Function("return this")(),S=t&&!t.nodeType&&t,E=S&&e&&!e.nodeType&&e,M=E&&E.exports===S,I=M&&T.process,P=function(){try{return I&&I.binding&&I.binding("util")}catch(e){}}(),L=P&&P.isTypedArray;function F(e,t){for(var i=-1,r=null==e?0:e.length;++i<r;)if(t(e[i],i,e))return!0;return!1}function k(e,t){return e.has(t)}function z(e){var t=-1,i=Array(e.size);return e.forEach((function(e,r){i[++t]=[r,e]})),i}function R(e){var t=-1,i=Array(e.size);return e.forEach((function(e){i[++t]=e})),i}var D,O=Array.prototype,U=Function.prototype,N=Object.prototype,Q=C["__core-js_shared__"],j=U.toString,V=N.hasOwnProperty,H=(D=/[^.]+$/.exec(Q&&Q.keys&&Q.keys.IE_PROTO||""))?"Symbol(src)_1."+D:"",G=N.toString,$=RegExp("^"+j.call(V).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Z=M?C.Buffer:void 0,q=C.Symbol,K=C.Uint8Array,W=N.propertyIsEnumerable,X=O.splice,Y=q?q.toStringTag:void 0,J=Object.getOwnPropertySymbols,ee=Z?Z.isBuffer:void 0,te=function(e,t){return function(i){return e(t(i))}}(Object.keys,Object),ie=Ie(C,"DataView"),re=Ie(C,"Map"),ne=Ie(C,"Promise"),oe=Ie(C,"Set"),se=Ie(C,"WeakMap"),ae=Ie(Object,"create"),le=ke(ie),ce=ke(re),ue=ke(ne),he=ke(oe),de=ke(se),pe=q?q.prototype:void 0,fe=pe?pe.valueOf:void 0;function Ae(e){var t=-1,i=null==e?0:e.length;for(this.clear();++t<i;){var r=e[t];this.set(r[0],r[1])}}function me(e){var t=-1,i=null==e?0:e.length;for(this.clear();++t<i;){var r=e[t];this.set(r[0],r[1])}}function ge(e){var t=-1,i=null==e?0:e.length;for(this.clear();++t<i;){var r=e[t];this.set(r[0],r[1])}}function _e(e){var t=-1,i=null==e?0:e.length;for(this.__data__=new ge;++t<i;)this.add(e[t])}function ye(e){var t=this.__data__=new me(e);this.size=t.size}function ve(e,t){var i=De(e),r=!i&&Re(e),n=!i&&!r&&Oe(e),o=!i&&!r&&!n&&He(e),s=i||r||n||o,a=s?function(e,t){for(var i=-1,r=Array(e);++i<e;)r[i]=t(i);return r}(e.length,String):[],l=a.length;for(var c in e)!t&&!V.call(e,c)||s&&("length"==c||n&&("offset"==c||"parent"==c)||o&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||Fe(c,l))||a.push(c);return a}function xe(e,t){for(var i=e.length;i--;)if(ze(e[i][0],t))return i;return-1}function be(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":Y&&Y in Object(e)?function(e){var t=V.call(e,Y),i=e[Y];try{e[Y]=void 0;var r=!0}catch(e){}var n=G.call(e);r&&(t?e[Y]=i:delete e[Y]);return n}(e):function(e){return G.call(e)}(e)}function we(e){return je(e)&&be(e)==n}function Te(e,t,i,r,c){return e===t||(null==e||null==t||!je(e)&&!je(t)?e!=e&&t!=t:function(e,t,i,r,c,p){var _=De(e),x=De(t),b=_?o:Le(e),w=x?o:Le(t),T=(b=b==n?d:b)==d,B=(w=w==n?d:w)==d,C=b==w;if(C&&Oe(e)){if(!Oe(t))return!1;_=!0,T=!1}if(C&&!T)return p||(p=new ye),_||He(e)?Se(e,t,i,r,c,p):function(e,t,i,r,n,o,c){switch(i){case v:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case y:return!(e.byteLength!=t.byteLength||!o(new K(e),new K(t)));case s:case a:case h:return ze(+e,+t);case l:return e.name==t.name&&e.message==t.message;case f:case m:return e==t+"";case u:var d=z;case A:var p=1&r;if(d||(d=R),e.size!=t.size&&!p)return!1;var _=c.get(e);if(_)return _==t;r|=2,c.set(e,t);var x=Se(d(e),d(t),r,n,o,c);return c.delete(e),x;case g:if(fe)return fe.call(e)==fe.call(t)}return!1}(e,t,b,i,r,c,p);if(!(1&i)){var S=T&&V.call(e,"__wrapped__"),E=B&&V.call(t,"__wrapped__");if(S||E){var M=S?e.value():e,I=E?t.value():t;return p||(p=new ye),c(M,I,i,r,p)}}if(!C)return!1;return p||(p=new ye),function(e,t,i,r,n,o){var s=1&i,a=Ee(e),l=a.length,c=Ee(t),u=c.length;if(l!=u&&!s)return!1;var h=l;for(;h--;){var d=a[h];if(!(s?d in t:V.call(t,d)))return!1}var p=o.get(e);if(p&&o.get(t))return p==t;var f=!0;o.set(e,t),o.set(t,e);var A=s;for(;++h<l;){var m=e[d=a[h]],g=t[d];if(r)var _=s?r(g,m,d,t,e,o):r(m,g,d,e,t,o);if(!(void 0===_?m===g||n(m,g,i,r,o):_)){f=!1;break}A||(A="constructor"==d)}if(f&&!A){var y=e.constructor,v=t.constructor;y==v||!("constructor"in e)||!("constructor"in t)||"function"==typeof y&&y instanceof y&&"function"==typeof v&&v instanceof v||(f=!1)}return o.delete(e),o.delete(t),f}(e,t,i,r,c,p)}(e,t,i,r,Te,c))}function Be(e){return!(!Qe(e)||function(e){return!!H&&H in e}(e))&&(Ue(e)?$:x).test(ke(e))}function Ce(e){if(i=(t=e)&&t.constructor,r="function"==typeof i&&i.prototype||N,t!==r)return te(e);var t,i,r,n=[];for(var o in Object(e))V.call(e,o)&&"constructor"!=o&&n.push(o);return n}function Se(e,t,i,r,n,o){var s=1&i,a=e.length,l=t.length;if(a!=l&&!(s&&l>a))return!1;var c=o.get(e);if(c&&o.get(t))return c==t;var u=-1,h=!0,d=2&i?new _e:void 0;for(o.set(e,t),o.set(t,e);++u<a;){var p=e[u],f=t[u];if(r)var A=s?r(f,p,u,t,e,o):r(p,f,u,e,t,o);if(void 0!==A){if(A)continue;h=!1;break}if(d){if(!F(t,(function(e,t){if(!k(d,t)&&(p===e||n(p,e,i,r,o)))return d.push(t)}))){h=!1;break}}else if(p!==f&&!n(p,f,i,r,o)){h=!1;break}}return o.delete(e),o.delete(t),h}function Ee(e){return function(e,t,i){var r=t(e);return De(e)?r:function(e,t){for(var i=-1,r=t.length,n=e.length;++i<r;)e[n+i]=t[i];return e}(r,i(e))}(e,Ge,Pe)}function Me(e,t){var i=e.__data__;return function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}(t)?i["string"==typeof t?"string":"hash"]:i.map}function Ie(e,t){var i=function(e,t){return null==e?void 0:e[t]}(e,t);return Be(i)?i:void 0}Ae.prototype.clear=function(){this.__data__=ae?ae(null):{},this.size=0},Ae.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},Ae.prototype.get=function(e){var t=this.__data__;if(ae){var r=t[e];return r===i?void 0:r}return V.call(t,e)?t[e]:void 0},Ae.prototype.has=function(e){var t=this.__data__;return ae?void 0!==t[e]:V.call(t,e)},Ae.prototype.set=function(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=ae&&void 0===t?i:t,this},me.prototype.clear=function(){this.__data__=[],this.size=0},me.prototype.delete=function(e){var t=this.__data__,i=xe(t,e);return!(i<0)&&(i==t.length-1?t.pop():X.call(t,i,1),--this.size,!0)},me.prototype.get=function(e){var t=this.__data__,i=xe(t,e);return i<0?void 0:t[i][1]},me.prototype.has=function(e){return xe(this.__data__,e)>-1},me.prototype.set=function(e,t){var i=this.__data__,r=xe(i,e);return r<0?(++this.size,i.push([e,t])):i[r][1]=t,this},ge.prototype.clear=function(){this.size=0,this.__data__={hash:new Ae,map:new(re||me),string:new Ae}},ge.prototype.delete=function(e){var t=Me(this,e).delete(e);return this.size-=t?1:0,t},ge.prototype.get=function(e){return Me(this,e).get(e)},ge.prototype.has=function(e){return Me(this,e).has(e)},ge.prototype.set=function(e,t){var i=Me(this,e),r=i.size;return i.set(e,t),this.size+=i.size==r?0:1,this},_e.prototype.add=_e.prototype.push=function(e){return this.__data__.set(e,i),this},_e.prototype.has=function(e){return this.__data__.has(e)},ye.prototype.clear=function(){this.__data__=new me,this.size=0},ye.prototype.delete=function(e){var t=this.__data__,i=t.delete(e);return this.size=t.size,i},ye.prototype.get=function(e){return this.__data__.get(e)},ye.prototype.has=function(e){return this.__data__.has(e)},ye.prototype.set=function(e,t){var i=this.__data__;if(i instanceof me){var r=i.__data__;if(!re||r.length<199)return r.push([e,t]),this.size=++i.size,this;i=this.__data__=new ge(r)}return i.set(e,t),this.size=i.size,this};var Pe=J?function(e){return null==e?[]:(e=Object(e),function(e,t){for(var i=-1,r=null==e?0:e.length,n=0,o=[];++i<r;){var s=e[i];t(s,i,e)&&(o[n++]=s)}return o}(J(e),(function(t){return W.call(e,t)})))}:function(){return[]},Le=be;function Fe(e,t){return!!(t=null==t?r:t)&&("number"==typeof e||b.test(e))&&e>-1&&e%1==0&&e<t}function ke(e){if(null!=e){try{return j.call(e)}catch(e){}try{return e+""}catch(e){}}return""}function ze(e,t){return e===t||e!=e&&t!=t}(ie&&Le(new ie(new ArrayBuffer(1)))!=v||re&&Le(new re)!=u||ne&&Le(ne.resolve())!=p||oe&&Le(new oe)!=A||se&&Le(new se)!=_)&&(Le=function(e){var t=be(e),i=t==d?e.constructor:void 0,r=i?ke(i):"";if(r)switch(r){case le:return v;case ce:return u;case ue:return p;case he:return A;case de:return _}return t});var Re=we(function(){return arguments}())?we:function(e){return je(e)&&V.call(e,"callee")&&!W.call(e,"callee")},De=Array.isArray;var Oe=ee||function(){return!1};function Ue(e){if(!Qe(e))return!1;var t=be(e);return t==c||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t}function Ne(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=r}function Qe(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}function je(e){return null!=e&&"object"==typeof e}var He=L?function(e){return function(t){return e(t)}}(L):function(e){return je(e)&&Ne(e.length)&&!!w[be(e)]};function Ge(e){return null!=(t=e)&&Ne(t.length)&&!Ue(t)?ve(e):Ce(e);var t}e.exports=function(e,t){return Te(e,t)}}(md,md.exports);var gd=md.exports;function _d(e){let t,i=(e[0].name??e[0].id)+"";return{c(){t=T(i)},m(e,i){y(e,t,i)},p(e,r){1&r&&i!==(i=(e[0].name??e[0].id)+"")&&I(t,i)},d(e){e&&v(t)}}}function yd(e){let t,i,r,n,o,s,a=(e[0].screenshotName??e[0].name??e[0].id)+"",l=e[0].branch+"";return{c(){t=b("div"),i=T(a),r=B(),n=b("span"),o=T(""),s=T(l),E(n,"class","screenshot-label-bold svelte-14y9jxq"),E(t,"class","screenshot-text svelte-14y9jxq")},m(e,a){y(e,t,a),_(t,i),_(t,r),_(t,n),_(n,o),_(n,s)},p(e,t){1&t&&a!==(a=(e[0].screenshotName??e[0].name??e[0].id)+"")&&I(i,a),1&t&&l!==(l=e[0].branch+"")&&I(s,l)},d(e){e&&v(t)}}}function vd(e){let t,r,n;const o=[{onMapMount:e[12]},e[8],e[9]];var s=e[7];function a(e){let t={};for(let e=0;e<o.length;e+=1)t=i(t,o[e]);return{props:t}}return s&&(r=U(s,a()),r.$on("mapMove",e[11])),{c(){t=b("div"),r&&de(r.$$.fragment),E(t,"class","map svelte-14y9jxq"),O(t,"highlight-diff",e[2])},m(e,i){y(e,t,i),r&&pe(r,t,null),n=!0},p(e,i){const l=4864&i?ue(o,[4096&i&&{onMapMount:e[12]},256&i&&he(e[8]),512&i&&he(e[9])]):{};if(128&i&&s!==(s=e[7])){if(r){se();const e=r;ce(e.$$.fragment,1,0,(()=>{fe(e,1)})),ae()}s?(r=U(s,a()),r.$on("mapMove",e[11]),de(r.$$.fragment),le(r.$$.fragment,1),pe(r,t,null)):r=null}else s&&r.$set(l);(!n||4&i)&&O(t,"highlight-diff",e[2])},i(e){n||(r&&le(r.$$.fragment,e),n=!0)},o(e){r&&ce(r.$$.fragment,e),n=!1},d(e){e&&v(t),r&&fe(r)}}}function xd(e){let t,i,r,n,o;return i=new dd({props:{index:e[0].index,mapIdIndex:e[6],name:e[0].name,onClose:e[10],disableClose:e[1]<=1,mapState:e[9],stylesheet:e[4]}}),i.$on("mapState",e[11]),{c(){t=b("div"),de(i.$$.fragment),E(t,"id",r=e[0].id),E(t,"class",n=m("map-label-container "+(2===e[1]?`map-label-container-${e[0].index}`:""))+" svelte-14y9jxq"),E(t,"style",e[3])},m(e,r){y(e,t,r),pe(i,t,null),o=!0},p(e,s){const a={};1&s&&(a.index=e[0].index),64&s&&(a.mapIdIndex=e[6]),1&s&&(a.name=e[0].name),2&s&&(a.disableClose=e[1]<=1),512&s&&(a.mapState=e[9]),16&s&&(a.stylesheet=e[4]),i.$set(a),(!o||1&s&&r!==(r=e[0].id))&&E(t,"id",r),(!o||3&s&&n!==(n=m("map-label-container "+(2===e[1]?`map-label-container-${e[0].index}`:""))+" svelte-14y9jxq"))&&E(t,"class",n),(!o||8&s)&&E(t,"style",e[3])},i(e){o||(le(i.$$.fragment,e),o=!0)},o(e){ce(i.$$.fragment,e),o=!1},d(e){e&&v(t),fe(i)}}}function bd(e){let i,r,n,o,s,l=e[5],c=`${e[1]}-${e[0].index}`;function u(e,t){return e[0]?.branch?yd:_d}let h=u(e),d=h(e),p=vd(e),f=xd(e);return{c(){i=b("div"),r=b("div"),d.c(),n=B(),p.c(),o=B(),f.c(),E(r,"class","screenshot-label-transparent svelte-14y9jxq"),E(i,"class","map-container svelte-14y9jxq")},m(e,t){y(e,i,t),_(i,r),d.m(r,null),_(i,n),p.m(i,null),_(i,o),f.m(i,null),s=!0},p(e,[n]){h===(h=u(e))&&d?d.p(e,n):(d.d(1),d=h(e),d&&(d.c(),d.m(r,null))),32&n&&a(l,l=e[5])?(se(),ce(p,1,1,t),ae(),p=vd(e),p.c(),le(p,1),p.m(i,o)):p.p(e,n),3&n&&a(c,c=`${e[1]}-${e[0].index}`)?(se(),ce(f,1,1,t),ae(),f=xd(e),f.c(),le(f,1),f.m(i,null)):f.p(e,n)},i(e){s||(le(p),le(f),s=!0)},o(e){ce(p),ce(f),s=!1},d(e){e&&v(i),d.d(),p.d(e),f.d(e)}}}function wd(e,t,r){let n,o,s,a,c;const u=["map","numberOfMaps","highlightDifferences","labelStyle"];let h,d,p,m=A(t,u);l(e,nt,(e=>r(16,h=e))),l(e,it,(e=>r(17,d=e))),l(e,ot,(e=>r(14,p=e)));let{map:g}=t,{numberOfMaps:_}=t,{highlightDifferences:y=!1}=t,{labelStyle:v=""}=t;const x=H();let b,w={},T={};const B=e=>{switch(e){case"google":r(7,b=hu);break;case"leaflet":r(7,b=Bu);break;case"tangram":r(7,b=Mu);break;default:r(7,b=xu),r(8,w.mapRenderer=e,w)}};return e.$$set=e=>{t=i(i({},t),f(e)),r(22,m=A(t,u)),"map"in e&&r(0,g=e.map),"numberOfMaps"in e&&r(1,_=e.numberOfMaps),"highlightDifferences"in e&&r(2,y=e.highlightDifferences),"labelStyle"in e&&r(3,v=e.labelStyle)},e.$$.update=()=>{16385&e.$$.dirty&&(n=p?.[g.index]??{}),1&e.$$.dirty&&r(6,o=`${g.id}-${g.index}`),1&e.$$.dirty&&r(13,s=g?.selectedPrecompileOption),17&e.$$.dirty&&(gd(T,g?.style)||r(4,T=g?.style)),1&e.$$.dirty&&r(5,a=g.renderer),8274&e.$$.dirty&&((e,t)=>{const i={mapboxKey:d.mapboxGlAccessToken,maptilerKey:d.maptilerApiKey};r(8,w={id:e,mapStyle:{...g,url:fu(g.url,i)},numberOfMaps:t}),B(a)})(o,_),32&e.$$.dirty&&B(a),r(9,c=(e=>{if(h)return e;const{bearing:t,center:i,pitch:r,zoom:o,...s}=e;let a={...s,...{bearing:t,center:i,pitch:r,zoom:o,...n}};return a=Ad(a,[g]),a})(m))},[g,_,y,v,T,a,o,b,w,c,()=>{et.update((e=>e.filter(((e,t)=>t!==g.index)).map(((e,t)=>({...e,index:t}))))),h||ot.update((e=>e.filter(((e,t)=>t!==g.index))))},e=>{if(h)x("mapMove",e.detail);else{const{options:t}=e.detail;ot.update((e=>e.map(((e,i)=>i===g.index?t:e))))}},e=>{st.update((t=>({...t,[g.index]:e})))},s,p]}class Td extends me{constructor(e){super(),Ae(this,e,wd,bd,a,{map:0,numberOfMaps:1,highlightDifferences:2,labelStyle:3})}}function Bd(e,t,i){const r=e.slice();return r[1]=t[i],r}function Cd(e,t,i){const r=e.slice();return r[10]=t[i],r}function Sd(e){let t,r,n;const o=[{map:e[10]},e[0],{numberOfMaps:e[2]}];let s={};for(let e=0;e<o.length;e+=1)s=i(s,o[e]);return r=new Td({props:s}),r.$on("mapMove",e[5]),{c(){t=b("div"),de(r.$$.fragment),E(t,"class","map-container map-container-border svelte-1xkn139")},m(e,i){y(e,t,i),pe(r,t,null),n=!0},p(e,t){const i=13&t?ue(o,[8&t&&{map:e[10]},1&t&&he(e[0]),4&t&&{numberOfMaps:e[2]}]):{};r.$set(i)},i(e){n||(le(r.$$.fragment,e),n=!0)},o(e){ce(r.$$.fragment,e),n=!1},d(e){e&&v(t),fe(r)}}}function Ed(e){let t,i,r,n=e[1],o=[];for(let t=0;t<n.length;t+=1)o[t]=Sd(Cd(e,n,t));const s=e=>ce(o[e],1,1,(()=>{o[e]=null}));return{c(){t=b("div");for(let e=0;e<o.length;e+=1)o[e].c();i=B(),E(t,"class","section svelte-1xkn139")},m(e,n){y(e,t,n);for(let e=0;e<o.length;e+=1)o[e]&&o[e].m(t,null);_(t,i),r=!0},p(e,r){if(13&r){let a;for(n=e[1],a=0;a<n.length;a+=1){const s=Cd(e,n,a);o[a]?(o[a].p(s,r),le(o[a],1)):(o[a]=Sd(s),o[a].c(),le(o[a],1),o[a].m(t,i))}for(se(),a=n.length;a<o.length;a+=1)s(a);ae()}},i(e){if(!r){for(let e=0;e<n.length;e+=1)le(o[e]);r=!0}},o(e){o=o.filter(Boolean);for(let e=0;e<o.length;e+=1)ce(o[e]);r=!1},d(e){e&&v(t),x(o,e)}}}function Md(e){let t,i,r,n,o=e[3],s=[];for(let t=0;t<o.length;t+=1)s[t]=Ed(Bd(e,o,t));const a=e=>ce(s[e],1,1,(()=>{s[e]=null}));return{c(){t=b("div"),i=b("div");for(let e=0;e<s.length;e+=1)s[e].c();E(i,"class","maps svelte-1xkn139"),E(t,"class",r=m(`mirror mirror-${e[4]}-orientation`)+" svelte-1xkn139")},m(e,r){y(e,t,r),_(t,i);for(let e=0;e<s.length;e+=1)s[e]&&s[e].m(i,null);n=!0},p(e,[l]){if(13&l){let t;for(o=e[3],t=0;t<o.length;t+=1){const r=Bd(e,o,t);s[t]?(s[t].p(r,l),le(s[t],1)):(s[t]=Ed(r),s[t].c(),le(s[t],1),s[t].m(i,null))}for(se(),t=o.length;t<s.length;t+=1)a(t);ae()}(!n||16&l&&r!==(r=m(`mirror mirror-${e[4]}-orientation`)+" svelte-1xkn139"))&&E(t,"class",r)},i(e){if(!n){for(let e=0;e<o.length;e+=1)le(s[e]);n=!0}},o(e){s=s.filter(Boolean);for(let e=0;e<s.length;e+=1)ce(s[e]);n=!1},d(e){e&&v(t),x(s,e)}}}function Id(e,t,i){let{maps:r=[]}=t,{mapState:n}=t,o=[],s=0;const a=[2,6];let l;return e.$$set=e=>{"maps"in e&&i(1,r=e.maps),"mapState"in e&&i(0,n=e.mapState)},e.$$.update=()=>{2&e.$$.dirty&&i(2,s=r.length),4&e.$$.dirty&&i(4,l=a.includes(s)?"row":"column"),2&e.$$.dirty&&(e=>{const t=Math.round(Math.sqrt(s)),r=Math.floor(s/t);let n=je(e),a=[];for(;n.length;)a.push(n.slice(0,r)),n=n.slice(r);i(3,o=a)})(r)},[n,r,s,o,l,function(t){G.call(this,e,t)}]}class Pd extends me{constructor(e){super(),Ae(this,e,Id,Md,a,{maps:1,mapState:0})}}function Ld(e,t,i){const r=e.slice();return r[3]=t[i],r}function Fd(e){let t,r,n,o;const s=[{map:e[3]},e[1],{labelStyle:"position: absolute; margin-top: 48px; left: 0; right: 0; bottom: unset; max-width: unset;"},{numberOfMaps:e[0].length}];let a={};for(let e=0;e<s.length;e+=1)a=i(a,s[e]);return r=new Td({props:a}),r.$on("mapMove",e[2]),{c(){t=b("div"),de(r.$$.fragment),n=B(),E(t,"class","map-container svelte-1hvjgnk")},m(e,i){y(e,t,i),pe(r,t,null),_(t,n),o=!0},p(e,t){const i=3&t?ue(s,[1&t&&{map:e[3]},2&t&&he(e[1]),s[2],1&t&&{numberOfMaps:e[0].length}]):{};r.$set(i)},i(e){o||(le(r.$$.fragment,e),o=!0)},o(e){ce(r.$$.fragment,e),o=!1},d(e){e&&v(t),fe(r)}}}function kd(e){let t,i,r,n=e[0],o=[];for(let t=0;t<n.length;t+=1)o[t]=Fd(Ld(e,n,t));const s=e=>ce(o[e],1,1,(()=>{o[e]=null}));return{c(){t=b("div"),i=b("div");for(let e=0;e<o.length;e+=1)o[e].c();E(i,"class","maps phone svelte-1hvjgnk"),E(t,"class","viewer-container svelte-1hvjgnk")},m(e,n){y(e,t,n),_(t,i);for(let e=0;e<o.length;e+=1)o[e]&&o[e].m(i,null);r=!0},p(e,[t]){if(3&t){let r;for(n=e[0],r=0;r<n.length;r+=1){const s=Ld(e,n,r);o[r]?(o[r].p(s,t),le(o[r],1)):(o[r]=Fd(s),o[r].c(),le(o[r],1),o[r].m(i,null))}for(se(),r=n.length;r<o.length;r+=1)s(r);ae()}},i(e){if(!r){for(let e=0;e<n.length;e+=1)le(o[e]);r=!0}},o(e){o=o.filter(Boolean);for(let e=0;e<o.length;e+=1)ce(o[e]);r=!1},d(e){e&&v(t),x(o,e)}}}function zd(e,t,i){let{maps:r}=t,{mapState:n}=t;return e.$$set=e=>{"maps"in e&&i(0,r=e.maps),"mapState"in e&&i(1,n=e.mapState)},[r,n,function(t){G.call(this,e,t)}]}class Rd extends me{constructor(e){super(),Ae(this,e,zd,kd,a,{maps:0,mapState:1})}}function Dd(e,t,i){const r=e.slice();return r[15]=t[i],r}function Od(e){let t,r,n,o;const s=[{map:e[15]},e[1],{numberOfMaps:e[0].length},{highlightDifferences:1===e[15].index&&e[1]?.showDiff},{labelStyle:0===e[15].index?e[7]:e[6]}];let a={};for(let e=0;e<s.length;e+=1)a=i(a,s[e]);return r=new Td({props:a}),r.$on("mapMove",e[13]),{c(){t=b("div"),de(r.$$.fragment),E(t,"class","map-container svelte-myzk36"),E(t,"style",n=1===e[15].index&&e[2]?`clip: rect(0px, ${e[3]}px, ${e[5]}px, ${e[2]}px)`:null)},m(e,i){y(e,t,i),pe(r,t,null),o=!0},p(e,i){const a=195&i?ue(s,[1&i&&{map:e[15]},2&i&&he(e[1]),1&i&&{numberOfMaps:e[0].length},3&i&&{highlightDifferences:1===e[15].index&&e[1]?.showDiff},193&i&&{labelStyle:0===e[15].index?e[7]:e[6]}]):{};r.$set(a),(!o||45&i&&n!==(n=1===e[15].index&&e[2]?`clip: rect(0px, ${e[3]}px, ${e[5]}px, ${e[2]}px)`:null))&&E(t,"style",n)},i(e){o||(le(r.$$.fragment,e),o=!0)},o(e){ce(r.$$.fragment,e),o=!1},d(e){e&&v(t),fe(r)}}}function Ud(e){let t,i,r,n,s,a,l,c=e[0],u=[];for(let t=0;t<c.length;t+=1)u[t]=Od(Dd(e,c,t));const h=e=>ce(u[e],1,1,(()=>{u[e]=null}));return{c(){t=b("div");for(let e=0;e<u.length;e+=1)u[e].c();i=B(),r=b("div"),E(r,"class","slider svelte-myzk36"),F(r,"left",e[2]+"px"),F(r,"width",Nd+"px"),E(t,"class","maps svelte-myzk36"),J((()=>e[14].call(t))),O(t,"dragging",e[4])},m(o,c){y(o,t,c);for(let e=0;e<u.length;e+=1)u[e]&&u[e].m(t,null);_(t,i),_(t,r),n=function(e,t){"static"===getComputedStyle(e).position&&(e.style.position="relative");const i=b("iframe");i.setAttribute("style","display: block; position: absolute; top: 0; left: 0; width: 100%; height: 100%; overflow: hidden; border: 0; opacity: 0; pointer-events: none; z-index: -1;"),i.setAttribute("aria-hidden","true"),i.tabIndex=-1;const r=D();let n;return r?(i.src="data:text/html,<script>onresize=function(){parent.postMessage(0,'*')}<\/script>",n=S(window,"message",(e=>{e.source===i.contentWindow&&t()}))):(i.src="about:blank",i.onload=()=>{n=S(i.contentWindow,"resize",t),t()}),_(e,i),()=>{(r||n&&i.contentWindow)&&n(),v(i)}}(t,e[14].bind(t)),s=!0,a||(l=[S(r,"mousedown",e[8]),S(t,"mousemove",e[10]),S(t,"mouseup",e[9])],a=!0)},p(e,[n]){if(239&n){let r;for(c=e[0],r=0;r<c.length;r+=1){const o=Dd(e,c,r);u[r]?(u[r].p(o,n),le(u[r],1)):(u[r]=Od(o),u[r].c(),le(u[r],1),u[r].m(t,i))}for(se(),r=c.length;r<u.length;r+=1)h(r);ae()}(!s||4&n)&&F(r,"left",e[2]+"px"),(!s||16&n)&&O(t,"dragging",e[4])},i(e){if(!s){for(let e=0;e<c.length;e+=1)le(u[e]);s=!0}},o(e){u=u.filter(Boolean);for(let e=0;e<u.length;e+=1)ce(u[e]);s=!1},d(e){e&&v(t),x(u,e),n(),a=!1,o(l)}}}const Nd=5;function Qd(e,t,i){let r,n,o,s,a,l,{maps:c}=t,{mapState:u}=t,h=!1,d=0;return e.$$set=e=>{"maps"in e&&i(0,c=e.maps),"mapState"in e&&i(1,u=e.mapState)},e.$$.update=()=>{8&e.$$.dirty&&i(2,d=a/2),12&e.$$.dirty&&i(11,r=a-d),2056&e.$$.dirty&&i(12,n=a-r),4096&e.$$.dirty&&i(7,o=`right: unset; margin-right:unset; left:0; margin-left:1em; max-width:calc(${n}px - 6em)`),2048&e.$$.dirty&&i(6,s=`max-width:calc(${r}px - 6em)`)},[c,u,d,a,h,l,s,o,()=>i(4,h=!0),()=>i(4,h=!1),e=>{h&&0!==e.clientX&&i(2,d=e.clientX-Nd/2)},r,n,function(t){G.call(this,e,t)},function(){l=this.clientHeight,a=this.clientWidth,i(5,l),i(3,a)}]}class jd extends me{constructor(e){super(),Ae(this,e,Qd,Ud,a,{maps:0,mapState:1})}}function Vd(e){let t,r;const n=[{map:e[8]},e[6],{numberOfMaps:e[7]},{labelStyle:"position: fixed;"}];let o={};for(let e=0;e<n.length;e+=1)o=i(o,n[e]);return t=new Td({props:o}),t.$on("mapMove",e[14]),{c(){de(t.$$.fragment)},m(e,i){pe(t,e,i),r=!0},p(e,i){const r=448&i?ue(n,[256&i&&{map:e[8]},64&i&&he(e[6]),128&i&&{numberOfMaps:e[7]},n[3]]):{};t.$set(r)},i(e){r||(le(t.$$.fragment,e),r=!0)},o(e){ce(t.$$.fragment,e),r=!1},d(e){fe(t,e)}}}function Hd(e){let t,i,r,n,s,a,l,c,u,h,d,p,f,A,m,x,w,C,I,L,F,k,z,R,D,O,U,N,Q=e[8]&&Vd(e);return{c(){t=b("div"),i=b("div"),Q&&Q.c(),n=B(),s=b("div"),a=b("div"),l=b("span"),l.textContent="Height:",c=B(),u=b("div"),h=b("input"),d=B(),p=b("div"),f=b("span"),f.textContent="Width:",A=B(),m=b("div"),x=b("input"),w=B(),C=b("div"),I=b("button"),L=T("Set Dimensions"),k=B(),z=b("button"),R=T("Reset"),E(i,"class","map-container svelte-1pk77jp"),E(i,"style",r=`height:${e[0]}px; width:${e[1]}px`),E(h,"type","number"),E(h,"class","input svelte-1pk77jp"),E(u,"class","input-container svelte-1pk77jp"),E(a,"class","dimension-input svelte-1pk77jp"),E(x,"type","number"),E(x,"class","input svelte-1pk77jp"),E(m,"class","input-container svelte-1pk77jp"),E(p,"class","dimension-input svelte-1pk77jp"),I.disabled=F=!e[3]||!e[2],z.disabled=D="100%"===e[0]&&"100%"===e[1],E(C,"class","buttons svelte-1pk77jp"),E(s,"class","responsive-input svelte-1pk77jp"),E(t,"class","maps responsive svelte-1pk77jp")},m(r,o){y(r,t,o),_(t,i),Q&&Q.m(i,null),_(t,n),_(t,s),_(s,a),_(a,l),_(a,c),_(a,u),_(u,h),P(h,e[2]),_(s,d),_(s,p),_(p,f),_(p,A),_(p,m),_(m,x),P(x,e[3]),_(s,w),_(s,C),_(C,I),_(I,L),_(C,k),_(C,z),_(z,R),O=!0,U||(N=[S(h,"input",e[15]),S(h,"focus",e[16]),S(h,"blur",e[17]),S(x,"input",e[18]),S(x,"focus",e[19]),S(x,"blur",e[20]),S(I,"click",e[10]),g(Ju.call(null,I,{code:"Enter",callback:e[9]})),S(z,"click",e[11])],U=!0)},p(e,[t]){e[8]?Q?(Q.p(e,t),256&t&&le(Q,1)):(Q=Vd(e),Q.c(),le(Q,1),Q.m(i,null)):Q&&(se(),ce(Q,1,1,(()=>{Q=null})),ae()),(!O||3&t&&r!==(r=`height:${e[0]}px; width:${e[1]}px`))&&E(i,"style",r),4&t&&M(h.value)!==e[2]&&P(h,e[2]),8&t&&M(x.value)!==e[3]&&P(x,e[3]),(!O||12&t&&F!==(F=!e[3]||!e[2]))&&(I.disabled=F),(!O||3&t&&D!==(D="100%"===e[0]&&"100%"===e[1]))&&(z.disabled=D)},i(e){O||(le(Q),O=!0)},o(e){ce(Q),O=!1},d(e){e&&v(t),Q&&Q.d(),U=!1,o(N)}}}function Gd(e,t,i){let r,n,{maps:o}=t,{mapState:s}=t;const a=H();let l=s.height||"100%",c=s.width||"100%",u=s.height||"",h=s.width||"",d=!1,p=!1,f=s;delete f.width,delete f.height;const A=()=>{i(0,l=u),i(1,c=h),a("mapSetDimensions",{options:{height:l,width:c}})};return e.$$set=e=>{"maps"in e&&i(12,o=e.maps),"mapState"in e&&i(13,s=e.mapState)},e.$$.update=()=>{if(4096&e.$$.dirty&&i(8,r=o[0]),4096&e.$$.dirty&&i(7,n=o?.length??0),8192&e.$$.dirty){let{width:e,height:t,...r}=s;i(6,f=r)}},[l,c,u,h,d,p,f,n,r,()=>{(d||p)&&!(!h||!u)&&A()},A,()=>{i(0,l="100%"),i(1,c="100%"),i(2,u=""),i(3,h=""),a("mapSetDimensions",{options:{height:null,width:null}})},o,s,function(t){G.call(this,e,t)},function(){u=M(this.value),i(2,u)},()=>i(4,d=!0),()=>i(4,d=!1),function(){h=M(this.value),i(3,h)},()=>i(5,p=!0),()=>i(5,p=!1)]}class $d extends me{constructor(e){super(),Ae(this,e,Gd,Hd,a,{maps:12,mapState:13})}}function Zd(e){let t,i,r;var n=e[2];function o(e){return{props:{maps:e[0],mapState:e[1]}}}return n&&(t=U(n,o(e)),t.$on("mapMove",e[3]),t.$on("mapSetDimensions",e[4])),{c(){t&&de(t.$$.fragment),i=C()},m(e,n){t&&pe(t,e,n),y(e,i,n),r=!0},p(e,[r]){const s={};if(1&r&&(s.maps=e[0]),2&r&&(s.mapState=e[1]),4&r&&n!==(n=e[2])){if(t){se();const e=t;ce(e.$$.fragment,1,0,(()=>{fe(e,1)})),ae()}n?(t=U(n,o(e)),t.$on("mapMove",e[3]),t.$on("mapSetDimensions",e[4]),de(t.$$.fragment),le(t.$$.fragment,1),pe(t,i.parentNode,i)):t=null}else n&&t.$set(s)},i(e){r||(t&&le(t.$$.fragment,e),r=!0)},o(e){t&&ce(t.$$.fragment,e),r=!1},d(e){e&&v(i),t&&fe(t,e)}}}function qd(e,t,i){let r,n,{maps:o}=t,{mapState:s}=t,{viewMode:a}=t;const l=H();let c;const u=e=>{l("setDimensions",{...e.detail.options})};return e.$$set=e=>{"maps"in e&&i(0,o=e.maps),"mapState"in e&&i(1,s=e.mapState),"viewMode"in e&&i(5,a=e.viewMode)},e.$$.update=()=>{2&e.$$.dirty&&i(7,r=s.height),2&e.$$.dirty&&i(6,n=s.width),32&e.$$.dirty&&(e=>{switch(e){case"phone":i(2,c=Rd);break;case"mirror":i(2,c=Pd);break;case"responsive":i(2,c=$d);break;default:i(2,c=jd)}})(a),224&e.$$.dirty&&"responsive"!==a&&(r||n)&&u({detail:{options:{height:null,width:null}}})},[o,s,c,e=>{l("mapState",{options:e.detail.options})},u,a,n,r]}class Kd extends me{constructor(e){super(),Ae(this,e,qd,Zd,a,{maps:0,mapState:1,viewMode:5})}}var Wd={exports:{}};
/*!
 * html2canvas 1.4.1 <https://html2canvas.hertzen.com>
 * Copyright (c) 2022 Niklas von Hertzen <https://hertzen.com>
 * Released under MIT License
 */Wd.exports=function(){
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */
var e=function(t,i){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])},e(t,i)};function t(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}var i=function(){return i=Object.assign||function(e){for(var t,i=1,r=arguments.length;i<r;i++)for(var n in t=arguments[i])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e},i.apply(this,arguments)};function r(e,t,i,r){function n(e){return e instanceof i?e:new i((function(t){t(e)}))}return new(i||(i=Promise))((function(i,o){function s(e){try{l(r.next(e))}catch(e){o(e)}}function a(e){try{l(r.throw(e))}catch(e){o(e)}}function l(e){e.done?i(e.value):n(e.value).then(s,a)}l((r=r.apply(e,t||[])).next())}))}function n(e,t){var i,r,n,o,s={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(e){return function(t){return l([e,t])}}function l(o){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,r&&(n=2&o[0]?r.return:o[0]?r.throw||((n=r.return)&&n.call(r),0):r.next)&&!(n=n.call(r,o[1])).done)return n;switch(r=0,n&&(o=[2&o[0],n.value]),o[0]){case 0:case 1:n=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!((n=(n=s.trys).length>0&&n[n.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!n||o[1]>n[0]&&o[1]<n[3])){s.label=o[1];break}if(6===o[0]&&s.label<n[1]){s.label=n[1],n=o;break}if(n&&s.label<n[2]){s.label=n[2],s.ops.push(o);break}n[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],r=0}finally{i=n=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}}function o(e,t,i){if(i||2===arguments.length)for(var r,n=0,o=t.length;n<o;n++)!r&&n in t||(r||(r=Array.prototype.slice.call(t,0,n)),r[n]=t[n]);return e.concat(r||t)}for(var s=function(){function e(e,t,i,r){this.left=e,this.top=t,this.width=i,this.height=r}return e.prototype.add=function(t,i,r,n){return new e(this.left+t,this.top+i,this.width+r,this.height+n)},e.fromClientRect=function(t,i){return new e(i.left+t.windowBounds.left,i.top+t.windowBounds.top,i.width,i.height)},e.fromDOMRectList=function(t,i){var r=Array.from(i).find((function(e){return 0!==e.width}));return r?new e(r.left+t.windowBounds.left,r.top+t.windowBounds.top,r.width,r.height):e.EMPTY},e.EMPTY=new e(0,0,0,0),e}(),a=function(e,t){return s.fromClientRect(e,t.getBoundingClientRect())},l=function(e){var t=e.body,i=e.documentElement;if(!t||!i)throw new Error("Unable to get document size");var r=Math.max(Math.max(t.scrollWidth,i.scrollWidth),Math.max(t.offsetWidth,i.offsetWidth),Math.max(t.clientWidth,i.clientWidth)),n=Math.max(Math.max(t.scrollHeight,i.scrollHeight),Math.max(t.offsetHeight,i.offsetHeight),Math.max(t.clientHeight,i.clientHeight));return new s(0,0,r,n)},c=function(e){for(var t=[],i=0,r=e.length;i<r;){var n=e.charCodeAt(i++);if(n>=55296&&n<=56319&&i<r){var o=e.charCodeAt(i++);56320==(64512&o)?t.push(((1023&n)<<10)+(1023&o)+65536):(t.push(n),i--)}else t.push(n)}return t},u=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(String.fromCodePoint)return String.fromCodePoint.apply(String,e);var i=e.length;if(!i)return"";for(var r=[],n=-1,o="";++n<i;){var s=e[n];s<=65535?r.push(s):(s-=65536,r.push(55296+(s>>10),s%1024+56320)),(n+1===i||r.length>16384)&&(o+=String.fromCharCode.apply(String,r),r.length=0)}return o},h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",d="undefined"==typeof Uint8Array?[]:new Uint8Array(256),p=0;p<h.length;p++)d[h.charCodeAt(p)]=p;for(var f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",A="undefined"==typeof Uint8Array?[]:new Uint8Array(256),m=0;m<f.length;m++)A[f.charCodeAt(m)]=m;for(var g=function(e){var t,i,r,n,o,s=.75*e.length,a=e.length,l=0;"="===e[e.length-1]&&(s--,"="===e[e.length-2]&&s--);var c="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array&&void 0!==Uint8Array.prototype.slice?new ArrayBuffer(s):new Array(s),u=Array.isArray(c)?c:new Uint8Array(c);for(t=0;t<a;t+=4)i=A[e.charCodeAt(t)],r=A[e.charCodeAt(t+1)],n=A[e.charCodeAt(t+2)],o=A[e.charCodeAt(t+3)],u[l++]=i<<2|r>>4,u[l++]=(15&r)<<4|n>>2,u[l++]=(3&n)<<6|63&o;return c},_=function(e){for(var t=e.length,i=[],r=0;r<t;r+=2)i.push(e[r+1]<<8|e[r]);return i},y=function(e){for(var t=e.length,i=[],r=0;r<t;r+=4)i.push(e[r+3]<<24|e[r+2]<<16|e[r+1]<<8|e[r]);return i},v=5,x=11,b=2,w=65536>>v,T=(1<<v)-1,B=w+(1024>>v)+32,C=65536>>x,S=(1<<x-v)-1,E=function(e,t,i){return e.slice?e.slice(t,i):new Uint16Array(Array.prototype.slice.call(e,t,i))},M=function(e,t,i){return e.slice?e.slice(t,i):new Uint32Array(Array.prototype.slice.call(e,t,i))},I=function(e,t){var i=g(e),r=Array.isArray(i)?y(i):new Uint32Array(i),n=Array.isArray(i)?_(i):new Uint16Array(i),o=24,s=E(n,o/2,r[4]/2),a=2===r[5]?E(n,(o+r[4])/2):M(r,Math.ceil((o+r[4])/4));return new P(r[0],r[1],r[2],r[3],s,a)},P=function(){function e(e,t,i,r,n,o){this.initialValue=e,this.errorValue=t,this.highStart=i,this.highValueIndex=r,this.index=n,this.data=o}return e.prototype.get=function(e){var t;if(e>=0){if(e<55296||e>56319&&e<=65535)return t=((t=this.index[e>>v])<<b)+(e&T),this.data[t];if(e<=65535)return t=((t=this.index[w+(e-55296>>v)])<<b)+(e&T),this.data[t];if(e<this.highStart)return t=B-C+(e>>x),t=this.index[t],t+=e>>v&S,t=((t=this.index[t])<<b)+(e&T),this.data[t];if(e<=1114111)return this.data[this.highValueIndex]}return this.errorValue},e}(),L="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",F="undefined"==typeof Uint8Array?[]:new Uint8Array(256),k=0;k<L.length;k++)F[L.charCodeAt(k)]=k;var z=50,R=1,D=2,O=3,U=4,N=5,Q=7,j=8,V=9,H=10,G=11,$=12,Z=13,q=14,K=15,W=16,X=17,Y=18,J=19,ee=20,te=21,ie=22,re=23,ne=24,oe=25,se=26,ae=27,le=28,ce=29,ue=30,he=31,de=32,pe=33,fe=34,Ae=35,me=36,ge=37,_e=38,ye=39,ve=40,xe=41,be=42,we=43,Te=[9001,65288],Be="!",Ce="",Se="",Ee=I("KwAAAAAAAAAACA4AUD0AADAgAAACAAAAAAAIABAAGABAAEgAUABYAGAAaABgAGgAYgBqAF8AZwBgAGgAcQB5AHUAfQCFAI0AlQCdAKIAqgCyALoAYABoAGAAaABgAGgAwgDKAGAAaADGAM4A0wDbAOEA6QDxAPkAAQEJAQ8BFwF1AH0AHAEkASwBNAE6AUIBQQFJAVEBWQFhAWgBcAF4ATAAgAGGAY4BlQGXAZ8BpwGvAbUBvQHFAc0B0wHbAeMB6wHxAfkBAQIJAvEBEQIZAiECKQIxAjgCQAJGAk4CVgJeAmQCbAJ0AnwCgQKJApECmQKgAqgCsAK4ArwCxAIwAMwC0wLbAjAA4wLrAvMC+AIAAwcDDwMwABcDHQMlAy0DNQN1AD0DQQNJA0kDSQNRA1EDVwNZA1kDdQB1AGEDdQBpA20DdQN1AHsDdQCBA4kDkQN1AHUAmQOhA3UAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AKYDrgN1AHUAtgO+A8YDzgPWAxcD3gPjA+sD8wN1AHUA+wMDBAkEdQANBBUEHQQlBCoEFwMyBDgEYABABBcDSARQBFgEYARoBDAAcAQzAXgEgASIBJAEdQCXBHUAnwSnBK4EtgS6BMIEyAR1AHUAdQB1AHUAdQCVANAEYABgAGAAYABgAGAAYABgANgEYADcBOQEYADsBPQE/AQEBQwFFAUcBSQFLAU0BWQEPAVEBUsFUwVbBWAAYgVgAGoFcgV6BYIFigWRBWAAmQWfBaYFYABgAGAAYABgAKoFYACxBbAFuQW6BcEFwQXHBcEFwQXPBdMF2wXjBeoF8gX6BQIGCgYSBhoGIgYqBjIGOgZgAD4GRgZMBmAAUwZaBmAAYABgAGAAYABgAGAAYABgAGAAYABgAGIGYABpBnAGYABgAGAAYABgAGAAYABgAGAAYAB4Bn8GhQZgAGAAYAB1AHcDFQSLBmAAYABgAJMGdQA9A3UAmwajBqsGqwaVALMGuwbDBjAAywbSBtIG1QbSBtIG0gbSBtIG0gbdBuMG6wbzBvsGAwcLBxMHAwcbByMHJwcsBywHMQcsB9IGOAdAB0gHTgfSBkgHVgfSBtIG0gbSBtIG0gbSBtIG0gbSBiwHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAdgAGAALAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAdbB2MHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsB2kH0gZwB64EdQB1AHUAdQB1AHUAdQB1AHUHfQdgAIUHjQd1AHUAlQedB2AAYAClB6sHYACzB7YHvgfGB3UAzgfWBzMB3gfmB1EB7gf1B/0HlQENAQUIDQh1ABUIHQglCBcDLQg1CD0IRQhNCEEDUwh1AHUAdQBbCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIcAh3CHoIMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIgggwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAALAcsBywHLAcsBywHLAcsBywHLAcsB4oILAcsB44I0gaWCJ4Ipgh1AHUAqgiyCHUAdQB1AHUAdQB1AHUAdQB1AHUAtwh8AXUAvwh1AMUIyQjRCNkI4AjoCHUAdQB1AO4I9gj+CAYJDgkTCS0HGwkjCYIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiAAIAAAAFAAYABgAGIAXwBgAHEAdQBFAJUAogCyAKAAYABgAEIA4ABGANMA4QDxAMEBDwE1AFwBLAE6AQEBUQF4QkhCmEKoQrhCgAHIQsAB0MLAAcABwAHAAeDC6ABoAHDCwMMAAcABwAHAAdDDGMMAAcAB6MM4wwjDWMNow3jDaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAEjDqABWw6bDqABpg6gAaABoAHcDvwOPA+gAaABfA/8DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DpcPAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcAB9cPKwkyCToJMAB1AHUAdQBCCUoJTQl1AFUJXAljCWcJawkwADAAMAAwAHMJdQB2CX4JdQCECYoJjgmWCXUAngkwAGAAYABxAHUApgn3A64JtAl1ALkJdQDACTAAMAAwADAAdQB1AHUAdQB1AHUAdQB1AHUAowYNBMUIMAAwADAAMADICcsJ0wnZCRUE4QkwAOkJ8An4CTAAMAB1AAAKvwh1AAgKDwoXCh8KdQAwACcKLgp1ADYKqAmICT4KRgowADAAdQB1AE4KMAB1AFYKdQBeCnUAZQowADAAMAAwADAAMAAwADAAMAAVBHUAbQowADAAdQC5CXUKMAAwAHwBxAijBogEMgF9CoQKiASMCpQKmgqIBKIKqgquCogEDQG2Cr4KxgrLCjAAMADTCtsKCgHjCusK8Qr5CgELMAAwADAAMAB1AIsECQsRC3UANAEZCzAAMAAwADAAMAB1ACELKQswAHUANAExCzkLdQBBC0kLMABRC1kLMAAwADAAMAAwADAAdQBhCzAAMAAwAGAAYABpC3ELdwt/CzAAMACHC4sLkwubC58Lpwt1AK4Ltgt1APsDMAAwADAAMAAwADAAMAAwAL4LwwvLC9IL1wvdCzAAMADlC+kL8Qv5C/8LSQswADAAMAAwADAAMAAwADAAMAAHDDAAMAAwADAAMAAODBYMHgx1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1ACYMMAAwADAAdQB1AHUALgx1AHUAdQB1AHUAdQA2DDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AD4MdQBGDHUAdQB1AHUAdQB1AEkMdQB1AHUAdQB1AFAMMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQBYDHUAdQB1AF8MMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUA+wMVBGcMMAAwAHwBbwx1AHcMfwyHDI8MMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAYABgAJcMMAAwADAAdQB1AJ8MlQClDDAAMACtDCwHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsB7UMLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AA0EMAC9DDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAsBywHLAcsBywHLAcsBywHLQcwAMEMyAwsBywHLAcsBywHLAcsBywHLAcsBywHzAwwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1ANQM2QzhDDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMABgAGAAYABgAGAAYABgAOkMYADxDGAA+AwADQYNYABhCWAAYAAODTAAMAAwADAAFg1gAGAAHg37AzAAMAAwADAAYABgACYNYAAsDTQNPA1gAEMNPg1LDWAAYABgAGAAYABgAGAAYABgAGAAUg1aDYsGVglhDV0NcQBnDW0NdQ15DWAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAlQCBDZUAiA2PDZcNMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAnw2nDTAAMAAwADAAMAAwAHUArw23DTAAMAAwADAAMAAwADAAMAAwADAAMAB1AL8NMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAB1AHUAdQB1AHUAdQDHDTAAYABgAM8NMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAA1w11ANwNMAAwAD0B5A0wADAAMAAwADAAMADsDfQN/A0EDgwOFA4wABsOMAAwADAAMAAwADAAMAAwANIG0gbSBtIG0gbSBtIG0gYjDigOwQUuDsEFMw7SBjoO0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGQg5KDlIOVg7SBtIGXg5lDm0OdQ7SBtIGfQ6EDooOjQ6UDtIGmg6hDtIG0gaoDqwO0ga0DrwO0gZgAGAAYADEDmAAYAAkBtIGzA5gANIOYADaDokO0gbSBt8O5w7SBu8O0gb1DvwO0gZgAGAAxA7SBtIG0gbSBtIGYABgAGAAYAAED2AAsAUMD9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGFA8sBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAccD9IGLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHJA8sBywHLAcsBywHLAccDywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywPLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAc0D9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAccD9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGFA8sBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHPA/SBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gYUD0QPlQCVAJUAMAAwADAAMACVAJUAlQCVAJUAlQCVAEwPMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAA//8EAAQABAAEAAQABAAEAAQABAANAAMAAQABAAIABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQACgATABcAHgAbABoAHgAXABYAEgAeABsAGAAPABgAHABLAEsASwBLAEsASwBLAEsASwBLABgAGAAeAB4AHgATAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQABYAGwASAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAWAA0AEQAeAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAFAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAJABYAGgAbABsAGwAeAB0AHQAeAE8AFwAeAA0AHgAeABoAGwBPAE8ADgBQAB0AHQAdAE8ATwAXAE8ATwBPABYAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAFAAUABQAFAAUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAB4AHgAeAFAATwBAAE8ATwBPAEAATwBQAFAATwBQAB4AHgAeAB4AHgAeAB0AHQAdAB0AHgAdAB4ADgBQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgBQAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAJAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAkACQAJAAkACQAJAAkABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAFAAHgAeAB4AKwArAFAAUABQAFAAGABQACsAKwArACsAHgAeAFAAHgBQAFAAUAArAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAUAAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAYAA0AKwArAB4AHgAbACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQADQAEAB4ABAAEAB4ABAAEABMABAArACsAKwArACsAKwArACsAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAKwArACsAKwBWAFYAVgBWAB4AHgArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AGgAaABoAGAAYAB4AHgAEAAQABAAEAAQABAAEAAQABAAEAAQAEwAEACsAEwATAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABLAEsASwBLAEsASwBLAEsASwBLABoAGQAZAB4AUABQAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQABMAUAAEAAQABAAEAAQABAAEAB4AHgAEAAQABAAEAAQABABQAFAABAAEAB4ABAAEAAQABABQAFAASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUAAeAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAFAABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQAUABQAB4AHgAYABMAUAArACsABAAbABsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAFAABAAEAAQABAAEAFAABAAEAAQAUAAEAAQABAAEAAQAKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAArACsAHgArAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAUAAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAABAAEAA0ADQBLAEsASwBLAEsASwBLAEsASwBLAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUAArACsAKwBQAFAAUABQACsAKwAEAFAABAAEAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABABQACsAKwArACsAKwArACsAKwAEACsAKwArACsAUABQACsAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAFAAUAAaABoAUABQAFAAUABQAEwAHgAbAFAAHgAEACsAKwAEAAQABAArAFAAUABQAFAAUABQACsAKwArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQACsAUABQACsAKwAEACsABAAEAAQABAAEACsAKwArACsABAAEACsAKwAEAAQABAArACsAKwAEACsAKwArACsAKwArACsAUABQAFAAUAArAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLAAQABABQAFAAUAAEAB4AKwArACsAKwArACsAKwArACsAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQACsAKwAEAFAABAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAArACsAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAB4AGwArACsAKwArACsAKwArAFAABAAEAAQABAAEAAQAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABAArACsAKwArACsAKwArAAQABAAEACsAKwArACsAUABQACsAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAB4AUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAAQAUAArAFAAUABQAFAAUABQACsAKwArAFAAUABQACsAUABQAFAAUAArACsAKwBQAFAAKwBQACsAUABQACsAKwArAFAAUAArACsAKwBQAFAAUAArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArAAQABAAEAAQABAArACsAKwAEAAQABAArAAQABAAEAAQAKwArAFAAKwArACsAKwArACsABAArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAHgAeAB4AHgAeAB4AGwAeACsAKwArACsAKwAEAAQABAAEAAQAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAUAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAAEACsAKwArACsAKwArACsABAAEACsAUABQAFAAKwArACsAKwArAFAAUAAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAKwAOAFAAUABQAFAAUABQAFAAHgBQAAQABAAEAA4AUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAKwArAAQAUAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAAEACsAKwArACsAKwArACsABAAEACsAKwArACsAKwArACsAUAArAFAAUAAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwBQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAFAABAAEAAQABAAEAAQABAArAAQABAAEACsABAAEAAQABABQAB4AKwArACsAKwBQAFAAUAAEAFAAUABQAFAAUABQAFAAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAFAAUABQAFAAUABQAFAAUABQABoAUABQAFAAUABQAFAAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQACsAUAArACsAUABQAFAAUABQAFAAUAArACsAKwAEACsAKwArACsABAAEAAQABAAEAAQAKwAEACsABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArAAQABAAeACsAKwArACsAKwArACsAKwArACsAKwArAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAAqAFwAXAAqACoAKgAqACoAKgAqACsAKwArACsAGwBcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAeAEsASwBLAEsASwBLAEsASwBLAEsADQANACsAKwArACsAKwBcAFwAKwBcACsAXABcAFwAXABcACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACsAXAArAFwAXABcAFwAXABcAFwAXABcAFwAKgBcAFwAKgAqACoAKgAqACoAKgAqACoAXAArACsAXABcAFwAXABcACsAXAArACoAKgAqACoAKgAqACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwBcAFwAXABcAFAADgAOAA4ADgAeAA4ADgAJAA4ADgANAAkAEwATABMAEwATAAkAHgATAB4AHgAeAAQABAAeAB4AHgAeAB4AHgBLAEsASwBLAEsASwBLAEsASwBLAFAAUABQAFAAUABQAFAAUABQAFAADQAEAB4ABAAeAAQAFgARABYAEQAEAAQAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQADQAEAAQABAAEAAQADQAEAAQAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArAA0ADQAeAB4AHgAeAB4AHgAEAB4AHgAeAB4AHgAeACsAHgAeAA4ADgANAA4AHgAeAB4AHgAeAAkACQArACsAKwArACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgBcAEsASwBLAEsASwBLAEsASwBLAEsADQANAB4AHgAeAB4AXABcAFwAXABcAFwAKgAqACoAKgBcAFwAXABcACoAKgAqAFwAKgAqACoAXABcACoAKgAqACoAKgAqACoAXABcAFwAKgAqACoAKgBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKgAqAFwAKgBLAEsASwBLAEsASwBLAEsASwBLACoAKgAqACoAKgAqAFAAUABQAFAAUABQACsAUAArACsAKwArACsAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgBQAFAAUABQAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUAArACsAUABQAFAAUABQAFAAUAArAFAAKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAKwBQACsAUABQAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsABAAEAAQAHgANAB4AHgAeAB4AHgAeAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUAArACsADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAANAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAWABEAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAA0ADQANAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAANAA0AKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUAArAAQABAArACsAKwArACsAKwArACsAKwArACsAKwBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqAA0ADQAVAFwADQAeAA0AGwBcACoAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwAeAB4AEwATAA0ADQAOAB4AEwATAB4ABAAEAAQACQArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUAAEAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAHgArACsAKwATABMASwBLAEsASwBLAEsASwBLAEsASwBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAArACsAXABcAFwAXABcACsAKwArACsAKwArACsAKwArACsAKwBcAFwAXABcAFwAXABcAFwAXABcAFwAXAArACsAKwArAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAXAArACsAKwAqACoAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAArACsAHgAeAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKwAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKwArAAQASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArACoAKgAqACoAKgAqACoAXAAqACoAKgAqACoAKgArACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABABQAFAAUABQAFAAUABQACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwANAA0AHgANAA0ADQANAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAEAAQAHgAeAB4AHgAeAB4AHgAeAB4AKwArACsABAAEAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwAeAB4AHgAeAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArAA0ADQANAA0ADQBLAEsASwBLAEsASwBLAEsASwBLACsAKwArAFAAUABQAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAA0ADQBQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUAAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArAAQABAAEAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAAQAUABQAFAAUABQAFAABABQAFAABAAEAAQAUAArACsAKwArACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsABAAEAAQABAAEAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAKwBQACsAUAArAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgBQAB4AHgAeAFAAUABQACsAHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQACsAKwAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQACsAHgAeAB4AHgAeAB4AHgAOAB4AKwANAA0ADQANAA0ADQANAAkADQANAA0ACAAEAAsABAAEAA0ACQANAA0ADAAdAB0AHgAXABcAFgAXABcAFwAWABcAHQAdAB4AHgAUABQAFAANAAEAAQAEAAQABAAEAAQACQAaABoAGgAaABoAGgAaABoAHgAXABcAHQAVABUAHgAeAB4AHgAeAB4AGAAWABEAFQAVABUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ADQAeAA0ADQANAA0AHgANAA0ADQAHAB4AHgAeAB4AKwAEAAQABAAEAAQABAAEAAQABAAEAFAAUAArACsATwBQAFAAUABQAFAAHgAeAB4AFgARAE8AUABPAE8ATwBPAFAAUABQAFAAUAAeAB4AHgAWABEAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArABsAGwAbABsAGwAbABsAGgAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGgAbABsAGwAbABoAGwAbABoAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAHgAeAFAAGgAeAB0AHgBQAB4AGgAeAB4AHgAeAB4AHgAeAB4AHgBPAB4AUAAbAB4AHgBQAFAAUABQAFAAHgAeAB4AHQAdAB4AUAAeAFAAHgBQAB4AUABPAFAAUAAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAHgBQAFAAUABQAE8ATwBQAFAAUABQAFAATwBQAFAATwBQAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAFAAUABQAFAATwBPAE8ATwBPAE8ATwBPAE8ATwBQAFAAUABQAFAAUABQAFAAUAAeAB4AUABQAFAAUABPAB4AHgArACsAKwArAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB4AHQAdAB4AHgAeAB0AHQAeAB4AHQAeAB4AHgAdAB4AHQAbABsAHgAdAB4AHgAeAB4AHQAeAB4AHQAdAB0AHQAeAB4AHQAeAB0AHgAdAB0AHQAdAB0AHQAeAB0AHgAeAB4AHgAeAB0AHQAdAB0AHgAeAB4AHgAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB4AHgAeAB0AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHgAeAB0AHQAdAB0AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAeAB4AHgAdAB4AHgAeAB4AHgAeAB4AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABYAEQAWABEAHgAeAB4AHgAeAB4AHQAeAB4AHgAeAB4AHgAeACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAWABEAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAFAAHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAeAB4AHQAdAB0AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHQAdAB4AHgAeAB4AHQAdAB0AHgAeAB0AHgAeAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlAB4AHQAdAB4AHgAdAB4AHgAeAB4AHQAdAB4AHgAeAB4AJQAlAB0AHQAlAB4AJQAlACUAIAAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAeAB4AHgAeAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHgAdAB0AHQAeAB0AJQAdAB0AHgAdAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAdAB0AHQAdACUAHgAlACUAJQAdACUAJQAdAB0AHQAlACUAHQAdACUAHQAdACUAJQAlAB4AHQAeAB4AHgAeAB0AHQAlAB0AHQAdAB0AHQAdACUAJQAlACUAJQAdACUAJQAgACUAHQAdACUAJQAlACUAJQAlACUAJQAeAB4AHgAlACUAIAAgACAAIAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AFwAXABcAFwAXABcAHgATABMAJQAeAB4AHgAWABEAFgARABYAEQAWABEAFgARABYAEQAWABEATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABYAEQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAWABEAFgARABYAEQAWABEAFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFgARABYAEQAWABEAFgARABYAEQAWABEAFgARABYAEQAWABEAFgARABYAEQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAWABEAFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAEAAQABAAeAB4AKwArACsAKwArABMADQANAA0AUAATAA0AUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAUAANACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAA0ADQANAA0ADQANAA0ADQAeAA0AFgANAB4AHgAXABcAHgAeABcAFwAWABEAFgARABYAEQAWABEADQANAA0ADQATAFAADQANAB4ADQANAB4AHgAeAB4AHgAMAAwADQANAA0AHgANAA0AFgANAA0ADQANAA0ADQANAA0AHgANAB4ADQANAB4AHgAeACsAKwArACsAKwArACsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwArACsAKwArACsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArAA0AEQARACUAJQBHAFcAVwAWABEAFgARABYAEQAWABEAFgARACUAJQAWABEAFgARABYAEQAWABEAFQAWABEAEQAlAFcAVwBXAFcAVwBXAFcAVwBXAAQABAAEAAQABAAEACUAVwBXAFcAVwA2ACUAJQBXAFcAVwBHAEcAJQAlACUAKwBRAFcAUQBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFEAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBRAFcAUQBXAFEAVwBXAFcAVwBXAFcAUQBXAFcAVwBXAFcAVwBRAFEAKwArAAQABAAVABUARwBHAFcAFQBRAFcAUQBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBRAFcAVwBXAFcAVwBXAFEAUQBXAFcAVwBXABUAUQBHAEcAVwArACsAKwArACsAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwAlACUAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACsAKwArACsAKwArACsAKwArACsAKwArAFEAUQBRAFEAUQBRAFEAUQBRAFEAUQBRAFEAUQBRAFEAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBPAE8ATwBPAE8ATwBPAE8AJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQAlAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAEcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAADQATAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABLAEsASwBLAEsASwBLAEsASwBLAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAABAAEAAQABAAeAAQABAAEAAQABAAEAAQABAAEAAQAHgBQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUABQAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAeAA0ADQANAA0ADQArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAB4AHgAeAB4AHgAeAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAeAB4AUABQAFAAUABQAFAAUABQAFAAUABQAAQAUABQAFAABABQAFAAUABQAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAeAB4AHgAeAAQAKwArACsAUABQAFAAUABQAFAAHgAeABoAHgArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAADgAOABMAEwArACsAKwArACsAKwArACsABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwANAA0ASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAFAAUAAeAB4AHgBQAA4AUABQAAQAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAA0ADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArAB4AWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYACsAKwArAAQAHgAeAB4AHgAeAB4ADQANAA0AHgAeAB4AHgArAFAASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArAB4AHgBcAFwAXABcAFwAKgBcAFwAXABcAFwAXABcAFwAXABcAEsASwBLAEsASwBLAEsASwBLAEsAXABcAFwAXABcACsAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArAFAAUABQAAQAUABQAFAAUABQAFAAUABQAAQABAArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAHgANAA0ADQBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKgAqACoAXAAqACoAKgBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAAqAFwAKgAqACoAXABcACoAKgBcAFwAXABcAFwAKgAqAFwAKgBcACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFwAXABcACoAKgBQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAA0ADQBQAFAAUAAEAAQAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUAArACsAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQADQAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAVABVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBUAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVACsAKwArACsAKwArACsAKwArACsAKwArAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAKwArACsAKwBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAKwArACsAKwAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAKwArACsAKwArAFYABABWAFYAVgBWAFYAVgBWAFYAVgBWAB4AVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgArAFYAVgBWAFYAVgArAFYAKwBWAFYAKwBWAFYAKwBWAFYAVgBWAFYAVgBWAFYAVgBWAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAEQAWAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAaAB4AKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAGAARABEAGAAYABMAEwAWABEAFAArACsAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACUAJQAlACUAJQAWABEAFgARABYAEQAWABEAFgARABYAEQAlACUAFgARACUAJQAlACUAJQAlACUAEQAlABEAKwAVABUAEwATACUAFgARABYAEQAWABEAJQAlACUAJQAlACUAJQAlACsAJQAbABoAJQArACsAKwArAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAcAKwATACUAJQAbABoAJQAlABYAEQAlACUAEQAlABEAJQBXAFcAVwBXAFcAVwBXAFcAVwBXABUAFQAlACUAJQATACUAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXABYAJQARACUAJQAlAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAWACUAEQAlABYAEQARABYAEQARABUAVwBRAFEAUQBRAFEAUQBRAFEAUQBRAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAEcARwArACsAVwBXAFcAVwBXAFcAKwArAFcAVwBXAFcAVwBXACsAKwBXAFcAVwBXAFcAVwArACsAVwBXAFcAKwArACsAGgAbACUAJQAlABsAGwArAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwAEAAQABAAQAB0AKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsADQANAA0AKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAAQAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAA0AUABQAFAAUAArACsAKwArAFAAUABQAFAAUABQAFAAUAANAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwAeACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAKwArAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUAArACsAKwBQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwANAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAB4AUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAUABQAFAAUABQAAQABAAEACsABAAEACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAKwBQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEACsAKwArACsABABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAA0ADQANAA0ADQANAA0ADQAeACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAArACsAKwArAFAAUABQAFAAUAANAA0ADQANAA0ADQAUACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsADQANAA0ADQANAA0ADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAAQABAAEAAQAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArAAQABAANACsAKwBQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAB4AHgAeAB4AHgArACsAKwArACsAKwAEAAQABAAEAAQABAAEAA0ADQAeAB4AHgAeAB4AKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgANAA0ADQANACsAKwArACsAKwArACsAKwArACsAKwAeACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsASwBLAEsASwBLAEsASwBLAEsASwANAA0ADQANAFAABAAEAFAAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAeAA4AUAArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAADQANAB4ADQAEAAQABAAEAB4ABAAEAEsASwBLAEsASwBLAEsASwBLAEsAUAAOAFAADQANAA0AKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAANAA0AHgANAA0AHgAEACsAUABQAFAAUABQAFAAUAArAFAAKwBQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAA0AKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsABAAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQACsABAAEAFAABAAEAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABAArACsAUAArACsAKwArACsAKwAEACsAKwArACsAKwBQAFAAUABQAFAABAAEACsAKwAEAAQABAAEAAQABAAEACsAKwArAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwArACsABAAEAAQABAAEAAQABABQAFAAUABQAA0ADQANAA0AHgBLAEsASwBLAEsASwBLAEsASwBLAA0ADQArAB4ABABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAFAAUAAeAFAAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAArACsABAAEAAQABAAEAAQABAAEAAQADgANAA0AEwATAB4AHgAeAA0ADQANAA0ADQANAA0ADQANAA0ADQANAA0ADQANAFAAUABQAFAABAAEACsAKwAEAA0ADQAeAFAAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKwArACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBcAFwADQANAA0AKgBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAKwArAFAAKwArAFAAUABQAFAAUABQAFAAUAArAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQAKwAEAAQAKwArAAQABAAEAAQAUAAEAFAABAAEAA0ADQANACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAArACsABAAEAAQABAAEAAQABABQAA4AUAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAFAABAAEAAQABAAOAB4ADQANAA0ADQAOAB4ABAArACsAKwArACsAKwArACsAUAAEAAQABAAEAAQABAAEAAQABAAEAAQAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAA0ADQANAFAADgAOAA4ADQANACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEACsABAAEAAQABAAEAAQABAAEAFAADQANAA0ADQANACsAKwArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwAOABMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAArACsAKwAEACsABAAEACsABAAEAAQABAAEAAQABABQAAQAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAKwBQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQAKwAEAAQAKwAEAAQABAAEAAQAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAaABoAGgAaAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsADQANAA0ADQANACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAASABIAEgAQwBDAEMAUABQAFAAUABDAFAAUABQAEgAQwBIAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAASABDAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwAJAAkACQAJAAkACQAJABYAEQArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABIAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwANAA0AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEAAQABAANACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAA0ADQANAB4AHgAeAB4AHgAeAFAAUABQAFAADQAeACsAKwArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAANAA0AHgAeACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwAEAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAARwBHABUARwAJACsAKwArACsAKwArACsAKwArACsAKwAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACsAKwArACsAKwArACsAKwBXAFcAVwBXAFcAVwBXAFcAVwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUQBRAFEAKwArACsAKwArACsAKwArACsAKwArACsAKwBRAFEAUQBRACsAKwArACsAKwArACsAKwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArACsAHgAEAAQADQAEAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArAB4AHgAeAB4AHgAeAB4AKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAAQABAAEAAQABAAeAB4AHgAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAB4AHgAEAAQABAAEAAQABAAEAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQAHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwBQAFAAKwArAFAAKwArAFAAUAArACsAUABQAFAAUAArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAUAArAFAAUABQAFAAUABQAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAHgAeAFAAUABQAFAAUAArAFAAKwArACsAUABQAFAAUABQAFAAUAArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeACsAKwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4ABAAeAB4AHgAeAB4AHgAeAB4AHgAeAAQAHgAeAA0ADQANAA0AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAAQAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArAAQABAAEAAQABAAEAAQAKwAEAAQAKwAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwBQAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArABsAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArAB4AHgAeAB4ABAAEAAQABAAEAAQABABQACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArABYAFgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAGgBQAFAAUAAaAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAKwBQACsAKwBQACsAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwBQACsAUAArACsAKwArACsAKwBQACsAKwArACsAUAArAFAAKwBQACsAUABQAFAAKwBQAFAAKwBQACsAKwBQACsAUAArAFAAKwBQACsAUAArAFAAUAArAFAAKwArAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUAArAFAAUABQAFAAKwBQACsAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAUABQAFAAKwBQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8AJQAlACUAHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB4AHgAeACUAJQAlAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAB4AHgAlACUAJQAlACUAHgAlACUAJQAlACUAIAAgACAAJQAlACAAJQAlACAAIAAgACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACEAIQAhACEAIQAlACUAIAAgACUAJQAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlACUAIAAlACUAJQAlACAAIAAgACUAIAAgACAAJQAlACUAJQAlACUAJQAgACUAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAlAB4AJQAeACUAJQAlACUAJQAgACUAJQAlACUAHgAlAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAgACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACAAIAAgACUAJQAlACAAIAAgACAAIAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABcAFwAXABUAFQAVAB4AHgAeAB4AJQAlACUAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAgACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAgACUAJQAgACUAJQAlACUAJQAlACUAJQAgACAAIAAgACAAIAAgACAAJQAlACUAJQAlACUAIAAlACUAJQAlACUAJQAlACUAJQAgACAAIAAgACAAIAAgACAAIAAgACUAJQAgACAAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAgACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAlACAAIAAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAgACAAIAAlACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwArAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACUAVwBXACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAA=="),Me=[ue,me],Ie=[R,D,O,N],Pe=[H,j],Le=[ae,se],Fe=Ie.concat(Pe),ke=[_e,ye,ve,fe,Ae],ze=[K,Z],Re=function(e,t){void 0===t&&(t="strict");var i=[],r=[],n=[];return e.forEach((function(e,o){var s=Ee.get(e);if(s>z?(n.push(!0),s-=z):n.push(!1),-1!==["normal","auto","loose"].indexOf(t)&&-1!==[8208,8211,12316,12448].indexOf(e))return r.push(o),i.push(W);if(s===U||s===G){if(0===o)return r.push(o),i.push(ue);var a=i[o-1];return-1===Fe.indexOf(a)?(r.push(r[o-1]),i.push(a)):(r.push(o),i.push(ue))}return r.push(o),s===he?i.push("strict"===t?te:ge):s===be||s===ce?i.push(ue):s===we?e>=131072&&e<=196605||e>=196608&&e<=262141?i.push(ge):i.push(ue):void i.push(s)})),[r,i,n]},De=function(e,t,i,r){var n=r[i];if(Array.isArray(e)?-1!==e.indexOf(n):e===n)for(var o=i;o<=r.length;){if((l=r[++o])===t)return!0;if(l!==H)break}if(n===H)for(o=i;o>0;){var s=r[--o];if(Array.isArray(e)?-1!==e.indexOf(s):e===s)for(var a=i;a<=r.length;){var l;if((l=r[++a])===t)return!0;if(l!==H)break}if(s!==H)break}return!1},Oe=function(e,t){for(var i=e;i>=0;){var r=t[i];if(r!==H)return r;i--}return 0},Ue=function(e,t,i,r,n){if(0===i[r])return Ce;var o=r-1;if(Array.isArray(n)&&!0===n[o])return Ce;var s=o-1,a=o+1,l=t[o],c=s>=0?t[s]:0,u=t[a];if(l===D&&u===O)return Ce;if(-1!==Ie.indexOf(l))return Be;if(-1!==Ie.indexOf(u))return Ce;if(-1!==Pe.indexOf(u))return Ce;if(Oe(o,t)===j)return Se;if(Ee.get(e[o])===G)return Ce;if((l===de||l===pe)&&Ee.get(e[a])===G)return Ce;if(l===Q||u===Q)return Ce;if(l===V)return Ce;if(-1===[H,Z,K].indexOf(l)&&u===V)return Ce;if(-1!==[X,Y,J,ne,le].indexOf(u))return Ce;if(Oe(o,t)===ie)return Ce;if(De(re,ie,o,t))return Ce;if(De([X,Y],te,o,t))return Ce;if(De($,$,o,t))return Ce;if(l===H)return Se;if(l===re||u===re)return Ce;if(u===W||l===W)return Se;if(-1!==[Z,K,te].indexOf(u)||l===q)return Ce;if(c===me&&-1!==ze.indexOf(l))return Ce;if(l===le&&u===me)return Ce;if(u===ee)return Ce;if(-1!==Me.indexOf(u)&&l===oe||-1!==Me.indexOf(l)&&u===oe)return Ce;if(l===ae&&-1!==[ge,de,pe].indexOf(u)||-1!==[ge,de,pe].indexOf(l)&&u===se)return Ce;if(-1!==Me.indexOf(l)&&-1!==Le.indexOf(u)||-1!==Le.indexOf(l)&&-1!==Me.indexOf(u))return Ce;if(-1!==[ae,se].indexOf(l)&&(u===oe||-1!==[ie,K].indexOf(u)&&t[a+1]===oe)||-1!==[ie,K].indexOf(l)&&u===oe||l===oe&&-1!==[oe,le,ne].indexOf(u))return Ce;if(-1!==[oe,le,ne,X,Y].indexOf(u))for(var h=o;h>=0;){if((d=t[h])===oe)return Ce;if(-1===[le,ne].indexOf(d))break;h--}if(-1!==[ae,se].indexOf(u))for(h=-1!==[X,Y].indexOf(l)?s:o;h>=0;){var d;if((d=t[h])===oe)return Ce;if(-1===[le,ne].indexOf(d))break;h--}if(_e===l&&-1!==[_e,ye,fe,Ae].indexOf(u)||-1!==[ye,fe].indexOf(l)&&-1!==[ye,ve].indexOf(u)||-1!==[ve,Ae].indexOf(l)&&u===ve)return Ce;if(-1!==ke.indexOf(l)&&-1!==[ee,se].indexOf(u)||-1!==ke.indexOf(u)&&l===ae)return Ce;if(-1!==Me.indexOf(l)&&-1!==Me.indexOf(u))return Ce;if(l===ne&&-1!==Me.indexOf(u))return Ce;if(-1!==Me.concat(oe).indexOf(l)&&u===ie&&-1===Te.indexOf(e[a])||-1!==Me.concat(oe).indexOf(u)&&l===Y)return Ce;if(l===xe&&u===xe){for(var p=i[o],f=1;p>0&&t[--p]===xe;)f++;if(f%2!=0)return Ce}return l===de&&u===pe?Ce:Se},Ne=function(e,t){t||(t={lineBreak:"normal",wordBreak:"normal"});var i=Re(e,t.lineBreak),r=i[0],n=i[1],o=i[2];"break-all"!==t.wordBreak&&"break-word"!==t.wordBreak||(n=n.map((function(e){return-1!==[oe,ue,be].indexOf(e)?ge:e})));var s="keep-all"===t.wordBreak?o.map((function(t,i){return t&&e[i]>=19968&&e[i]<=40959})):void 0;return[r,n,s]},Qe=function(){function e(e,t,i,r){this.codePoints=e,this.required=t===Be,this.start=i,this.end=r}return e.prototype.slice=function(){return u.apply(void 0,this.codePoints.slice(this.start,this.end))},e}(),je=function(e,t){var i=c(e),r=Ne(i,t),n=r[0],o=r[1],s=r[2],a=i.length,l=0,u=0;return{next:function(){if(u>=a)return{done:!0,value:null};for(var e=Ce;u<a&&(e=Ue(i,o,n,++u,s))===Ce;);if(e!==Ce||u===a){var t=new Qe(i,e,l,u);return l=u,{value:t,done:!1}}return{done:!0,value:null}}}},Ve=1,He=2,Ge=4,$e=8,Ze=10,qe=47,Ke=92,We=9,Xe=32,Ye=34,Je=61,et=35,tt=36,it=37,rt=39,nt=40,ot=41,st=95,at=45,lt=33,ct=60,ut=62,ht=64,dt=91,pt=93,ft=61,At=123,mt=63,gt=125,_t=124,yt=126,vt=128,xt=65533,bt=42,wt=43,Tt=44,Bt=58,Ct=59,St=46,Et=0,Mt=8,It=11,Pt=14,Lt=31,Ft=127,kt=-1,zt=48,Rt=97,Dt=101,Ot=102,Ut=117,Nt=122,Qt=65,jt=69,Vt=70,Ht=85,Gt=90,$t=function(e){return e>=zt&&e<=57},Zt=function(e){return e>=55296&&e<=57343},qt=function(e){return $t(e)||e>=Qt&&e<=Vt||e>=Rt&&e<=Ot},Kt=function(e){return e>=Rt&&e<=Nt},Wt=function(e){return e>=Qt&&e<=Gt},Xt=function(e){return Kt(e)||Wt(e)},Yt=function(e){return e>=vt},Jt=function(e){return e===Ze||e===We||e===Xe},ei=function(e){return Xt(e)||Yt(e)||e===st},ti=function(e){return ei(e)||$t(e)||e===at},ii=function(e){return e>=Et&&e<=Mt||e===It||e>=Pt&&e<=Lt||e===Ft},ri=function(e,t){return e===Ke&&t!==Ze},ni=function(e,t,i){return e===at?ei(t)||ri(t,i):!!ei(e)||!(e!==Ke||!ri(e,t))},oi=function(e,t,i){return e===wt||e===at?!!$t(t)||t===St&&$t(i):$t(e===St?t:e)},si=function(e){var t=0,i=1;e[t]!==wt&&e[t]!==at||(e[t]===at&&(i=-1),t++);for(var r=[];$t(e[t]);)r.push(e[t++]);var n=r.length?parseInt(u.apply(void 0,r),10):0;e[t]===St&&t++;for(var o=[];$t(e[t]);)o.push(e[t++]);var s=o.length,a=s?parseInt(u.apply(void 0,o),10):0;e[t]!==jt&&e[t]!==Dt||t++;var l=1;e[t]!==wt&&e[t]!==at||(e[t]===at&&(l=-1),t++);for(var c=[];$t(e[t]);)c.push(e[t++]);var h=c.length?parseInt(u.apply(void 0,c),10):0;return i*(n+a*Math.pow(10,-s))*Math.pow(10,l*h)},ai={type:2},li={type:3},ci={type:4},ui={type:13},hi={type:8},di={type:21},pi={type:9},fi={type:10},Ai={type:11},mi={type:12},gi={type:14},_i={type:23},yi={type:1},vi={type:25},xi={type:24},bi={type:26},wi={type:27},Ti={type:28},Bi={type:29},Ci={type:31},Si={type:32},Ei=function(){function e(){this._value=[]}return e.prototype.write=function(e){this._value=this._value.concat(c(e))},e.prototype.read=function(){for(var e=[],t=this.consumeToken();t!==Si;)e.push(t),t=this.consumeToken();return e},e.prototype.consumeToken=function(){var e=this.consumeCodePoint();switch(e){case Ye:return this.consumeStringToken(Ye);case et:var t=this.peekCodePoint(0),i=this.peekCodePoint(1),r=this.peekCodePoint(2);if(ti(t)||ri(i,r)){var n=ni(t,i,r)?He:Ve;return{type:5,value:this.consumeName(),flags:n}}break;case tt:if(this.peekCodePoint(0)===Je)return this.consumeCodePoint(),ui;break;case rt:return this.consumeStringToken(rt);case nt:return ai;case ot:return li;case bt:if(this.peekCodePoint(0)===Je)return this.consumeCodePoint(),gi;break;case wt:if(oi(e,this.peekCodePoint(0),this.peekCodePoint(1)))return this.reconsumeCodePoint(e),this.consumeNumericToken();break;case Tt:return ci;case at:var o=e,s=this.peekCodePoint(0),a=this.peekCodePoint(1);if(oi(o,s,a))return this.reconsumeCodePoint(e),this.consumeNumericToken();if(ni(o,s,a))return this.reconsumeCodePoint(e),this.consumeIdentLikeToken();if(s===at&&a===ut)return this.consumeCodePoint(),this.consumeCodePoint(),xi;break;case St:if(oi(e,this.peekCodePoint(0),this.peekCodePoint(1)))return this.reconsumeCodePoint(e),this.consumeNumericToken();break;case qe:if(this.peekCodePoint(0)===bt)for(this.consumeCodePoint();;){var l=this.consumeCodePoint();if(l===bt&&(l=this.consumeCodePoint())===qe)return this.consumeToken();if(l===kt)return this.consumeToken()}break;case Bt:return bi;case Ct:return wi;case ct:if(this.peekCodePoint(0)===lt&&this.peekCodePoint(1)===at&&this.peekCodePoint(2)===at)return this.consumeCodePoint(),this.consumeCodePoint(),vi;break;case ht:var c=this.peekCodePoint(0),h=this.peekCodePoint(1),d=this.peekCodePoint(2);if(ni(c,h,d))return{type:7,value:this.consumeName()};break;case dt:return Ti;case Ke:if(ri(e,this.peekCodePoint(0)))return this.reconsumeCodePoint(e),this.consumeIdentLikeToken();break;case pt:return Bi;case ft:if(this.peekCodePoint(0)===Je)return this.consumeCodePoint(),hi;break;case At:return Ai;case gt:return mi;case Ut:case Ht:var p=this.peekCodePoint(0),f=this.peekCodePoint(1);return p!==wt||!qt(f)&&f!==mt||(this.consumeCodePoint(),this.consumeUnicodeRangeToken()),this.reconsumeCodePoint(e),this.consumeIdentLikeToken();case _t:if(this.peekCodePoint(0)===Je)return this.consumeCodePoint(),pi;if(this.peekCodePoint(0)===_t)return this.consumeCodePoint(),di;break;case yt:if(this.peekCodePoint(0)===Je)return this.consumeCodePoint(),fi;break;case kt:return Si}return Jt(e)?(this.consumeWhiteSpace(),Ci):$t(e)?(this.reconsumeCodePoint(e),this.consumeNumericToken()):ei(e)?(this.reconsumeCodePoint(e),this.consumeIdentLikeToken()):{type:6,value:u(e)}},e.prototype.consumeCodePoint=function(){var e=this._value.shift();return void 0===e?-1:e},e.prototype.reconsumeCodePoint=function(e){this._value.unshift(e)},e.prototype.peekCodePoint=function(e){return e>=this._value.length?-1:this._value[e]},e.prototype.consumeUnicodeRangeToken=function(){for(var e=[],t=this.consumeCodePoint();qt(t)&&e.length<6;)e.push(t),t=this.consumeCodePoint();for(var i=!1;t===mt&&e.length<6;)e.push(t),t=this.consumeCodePoint(),i=!0;if(i)return{type:30,start:parseInt(u.apply(void 0,e.map((function(e){return e===mt?zt:e}))),16),end:parseInt(u.apply(void 0,e.map((function(e){return e===mt?Vt:e}))),16)};var r=parseInt(u.apply(void 0,e),16);if(this.peekCodePoint(0)===at&&qt(this.peekCodePoint(1))){this.consumeCodePoint(),t=this.consumeCodePoint();for(var n=[];qt(t)&&n.length<6;)n.push(t),t=this.consumeCodePoint();return{type:30,start:r,end:parseInt(u.apply(void 0,n),16)}}return{type:30,start:r,end:r}},e.prototype.consumeIdentLikeToken=function(){var e=this.consumeName();return"url"===e.toLowerCase()&&this.peekCodePoint(0)===nt?(this.consumeCodePoint(),this.consumeUrlToken()):this.peekCodePoint(0)===nt?(this.consumeCodePoint(),{type:19,value:e}):{type:20,value:e}},e.prototype.consumeUrlToken=function(){var e=[];if(this.consumeWhiteSpace(),this.peekCodePoint(0)===kt)return{type:22,value:""};var t=this.peekCodePoint(0);if(t===rt||t===Ye){var i=this.consumeStringToken(this.consumeCodePoint());return 0===i.type&&(this.consumeWhiteSpace(),this.peekCodePoint(0)===kt||this.peekCodePoint(0)===ot)?(this.consumeCodePoint(),{type:22,value:i.value}):(this.consumeBadUrlRemnants(),_i)}for(;;){var r=this.consumeCodePoint();if(r===kt||r===ot)return{type:22,value:u.apply(void 0,e)};if(Jt(r))return this.consumeWhiteSpace(),this.peekCodePoint(0)===kt||this.peekCodePoint(0)===ot?(this.consumeCodePoint(),{type:22,value:u.apply(void 0,e)}):(this.consumeBadUrlRemnants(),_i);if(r===Ye||r===rt||r===nt||ii(r))return this.consumeBadUrlRemnants(),_i;if(r===Ke){if(!ri(r,this.peekCodePoint(0)))return this.consumeBadUrlRemnants(),_i;e.push(this.consumeEscapedCodePoint())}else e.push(r)}},e.prototype.consumeWhiteSpace=function(){for(;Jt(this.peekCodePoint(0));)this.consumeCodePoint()},e.prototype.consumeBadUrlRemnants=function(){for(;;){var e=this.consumeCodePoint();if(e===ot||e===kt)return;ri(e,this.peekCodePoint(0))&&this.consumeEscapedCodePoint()}},e.prototype.consumeStringSlice=function(e){for(var t=5e4,i="";e>0;){var r=Math.min(t,e);i+=u.apply(void 0,this._value.splice(0,r)),e-=r}return this._value.shift(),i},e.prototype.consumeStringToken=function(e){for(var t="",i=0;;){var r=this._value[i];if(r===kt||void 0===r||r===e)return{type:0,value:t+=this.consumeStringSlice(i)};if(r===Ze)return this._value.splice(0,i),yi;if(r===Ke){var n=this._value[i+1];n!==kt&&void 0!==n&&(n===Ze?(t+=this.consumeStringSlice(i),i=-1,this._value.shift()):ri(r,n)&&(t+=this.consumeStringSlice(i),t+=u(this.consumeEscapedCodePoint()),i=-1))}i++}},e.prototype.consumeNumber=function(){var e=[],t=Ge,i=this.peekCodePoint(0);for(i!==wt&&i!==at||e.push(this.consumeCodePoint());$t(this.peekCodePoint(0));)e.push(this.consumeCodePoint());i=this.peekCodePoint(0);var r=this.peekCodePoint(1);if(i===St&&$t(r))for(e.push(this.consumeCodePoint(),this.consumeCodePoint()),t=$e;$t(this.peekCodePoint(0));)e.push(this.consumeCodePoint());i=this.peekCodePoint(0),r=this.peekCodePoint(1);var n=this.peekCodePoint(2);if((i===jt||i===Dt)&&((r===wt||r===at)&&$t(n)||$t(r)))for(e.push(this.consumeCodePoint(),this.consumeCodePoint()),t=$e;$t(this.peekCodePoint(0));)e.push(this.consumeCodePoint());return[si(e),t]},e.prototype.consumeNumericToken=function(){var e=this.consumeNumber(),t=e[0],i=e[1],r=this.peekCodePoint(0),n=this.peekCodePoint(1),o=this.peekCodePoint(2);return ni(r,n,o)?{type:15,number:t,flags:i,unit:this.consumeName()}:r===it?(this.consumeCodePoint(),{type:16,number:t,flags:i}):{type:17,number:t,flags:i}},e.prototype.consumeEscapedCodePoint=function(){var e=this.consumeCodePoint();if(qt(e)){for(var t=u(e);qt(this.peekCodePoint(0))&&t.length<6;)t+=u(this.consumeCodePoint());Jt(this.peekCodePoint(0))&&this.consumeCodePoint();var i=parseInt(t,16);return 0===i||Zt(i)||i>1114111?xt:i}return e===kt?xt:e},e.prototype.consumeName=function(){for(var e="";;){var t=this.consumeCodePoint();if(ti(t))e+=u(t);else{if(!ri(t,this.peekCodePoint(0)))return this.reconsumeCodePoint(t),e;e+=u(this.consumeEscapedCodePoint())}}},e}(),Mi=function(){function e(e){this._tokens=e}return e.create=function(t){var i=new Ei;return i.write(t),new e(i.read())},e.parseValue=function(t){return e.create(t).parseComponentValue()},e.parseValues=function(t){return e.create(t).parseComponentValues()},e.prototype.parseComponentValue=function(){for(var e=this.consumeToken();31===e.type;)e=this.consumeToken();if(32===e.type)throw new SyntaxError("Error parsing CSS component value, unexpected EOF");this.reconsumeToken(e);var t=this.consumeComponentValue();do{e=this.consumeToken()}while(31===e.type);if(32===e.type)return t;throw new SyntaxError("Error parsing CSS component value, multiple values found when expecting only one")},e.prototype.parseComponentValues=function(){for(var e=[];;){var t=this.consumeComponentValue();if(32===t.type)return e;e.push(t),e.push()}},e.prototype.consumeComponentValue=function(){var e=this.consumeToken();switch(e.type){case 11:case 28:case 2:return this.consumeSimpleBlock(e.type);case 19:return this.consumeFunction(e)}return e},e.prototype.consumeSimpleBlock=function(e){for(var t={type:e,values:[]},i=this.consumeToken();;){if(32===i.type||Oi(i,e))return t;this.reconsumeToken(i),t.values.push(this.consumeComponentValue()),i=this.consumeToken()}},e.prototype.consumeFunction=function(e){for(var t={name:e.value,values:[],type:18};;){var i=this.consumeToken();if(32===i.type||3===i.type)return t;this.reconsumeToken(i),t.values.push(this.consumeComponentValue())}},e.prototype.consumeToken=function(){var e=this._tokens.shift();return void 0===e?Si:e},e.prototype.reconsumeToken=function(e){this._tokens.unshift(e)},e}(),Ii=function(e){return 15===e.type},Pi=function(e){return 17===e.type},Li=function(e){return 20===e.type},Fi=function(e){return 0===e.type},ki=function(e,t){return Li(e)&&e.value===t},zi=function(e){return 31!==e.type},Ri=function(e){return 31!==e.type&&4!==e.type},Di=function(e){var t=[],i=[];return e.forEach((function(e){if(4===e.type){if(0===i.length)throw new Error("Error parsing function args, zero tokens for arg");return t.push(i),void(i=[])}31!==e.type&&i.push(e)})),i.length&&t.push(i),t},Oi=function(e,t){return 11===t&&12===e.type||28===t&&29===e.type||2===t&&3===e.type},Ui=function(e){return 17===e.type||15===e.type},Ni=function(e){return 16===e.type||Ui(e)},Qi=function(e){return e.length>1?[e[0],e[1]]:[e[0]]},ji={type:17,number:0,flags:Ge},Vi={type:16,number:50,flags:Ge},Hi={type:16,number:100,flags:Ge},Gi=function(e,t,i){var r=e[0],n=e[1];return[$i(r,t),$i(void 0!==n?n:r,i)]},$i=function(e,t){if(16===e.type)return e.number/100*t;if(Ii(e))switch(e.unit){case"rem":case"em":return 16*e.number;default:return e.number}return e.number},Zi="deg",qi="grad",Ki="rad",Wi="turn",Xi={name:"angle",parse:function(e,t){if(15===t.type)switch(t.unit){case Zi:return Math.PI*t.number/180;case qi:return Math.PI/200*t.number;case Ki:return t.number;case Wi:return 2*Math.PI*t.number}throw new Error("Unsupported angle type")}},Yi=function(e){return 15===e.type&&(e.unit===Zi||e.unit===qi||e.unit===Ki||e.unit===Wi)},Ji=function(e){switch(e.filter(Li).map((function(e){return e.value})).join(" ")){case"to bottom right":case"to right bottom":case"left top":case"top left":return[ji,ji];case"to top":case"bottom":return er(0);case"to bottom left":case"to left bottom":case"right top":case"top right":return[ji,Hi];case"to right":case"left":return er(90);case"to top left":case"to left top":case"right bottom":case"bottom right":return[Hi,Hi];case"to bottom":case"top":return er(180);case"to top right":case"to right top":case"left bottom":case"bottom left":return[Hi,ji];case"to left":case"right":return er(270)}return 0},er=function(e){return Math.PI*e/180},tr={name:"color",parse:function(e,t){if(18===t.type){var i=cr[t.name];if(void 0===i)throw new Error('Attempting to parse an unsupported color function "'+t.name+'"');return i(e,t.values)}if(5===t.type){if(3===t.value.length){var r=t.value.substring(0,1),n=t.value.substring(1,2),o=t.value.substring(2,3);return nr(parseInt(r+r,16),parseInt(n+n,16),parseInt(o+o,16),1)}if(4===t.value.length){r=t.value.substring(0,1),n=t.value.substring(1,2),o=t.value.substring(2,3);var s=t.value.substring(3,4);return nr(parseInt(r+r,16),parseInt(n+n,16),parseInt(o+o,16),parseInt(s+s,16)/255)}if(6===t.value.length)return r=t.value.substring(0,2),n=t.value.substring(2,4),o=t.value.substring(4,6),nr(parseInt(r,16),parseInt(n,16),parseInt(o,16),1);if(8===t.value.length)return r=t.value.substring(0,2),n=t.value.substring(2,4),o=t.value.substring(4,6),s=t.value.substring(6,8),nr(parseInt(r,16),parseInt(n,16),parseInt(o,16),parseInt(s,16)/255)}if(20===t.type){var a=hr[t.value.toUpperCase()];if(void 0!==a)return a}return hr.TRANSPARENT}},ir=function(e){return!(255&e)},rr=function(e){var t=255&e,i=255&e>>8,r=255&e>>16,n=255&e>>24;return t<255?"rgba("+n+","+r+","+i+","+t/255+")":"rgb("+n+","+r+","+i+")"},nr=function(e,t,i,r){return(e<<24|t<<16|i<<8|Math.round(255*r))>>>0},or=function(e,t){if(17===e.type)return e.number;if(16===e.type){var i=3===t?1:255;return 3===t?e.number/100*i:Math.round(e.number/100*i)}return 0},sr=function(e,t){var i=t.filter(Ri);if(3===i.length){var r=i.map(or),n=r[0],o=r[1],s=r[2];return nr(n,o,s,1)}if(4===i.length){var a=i.map(or),l=(n=a[0],o=a[1],s=a[2],a[3]);return nr(n,o,s,l)}return 0};function ar(e,t,i){return i<0&&(i+=1),i>=1&&(i-=1),i<1/6?(t-e)*i*6+e:i<.5?t:i<2/3?6*(t-e)*(2/3-i)+e:e}var lr=function(e,t){var i=t.filter(Ri),r=i[0],n=i[1],o=i[2],s=i[3],a=(17===r.type?er(r.number):Xi.parse(e,r))/(2*Math.PI),l=Ni(n)?n.number/100:0,c=Ni(o)?o.number/100:0,u=void 0!==s&&Ni(s)?$i(s,1):1;if(0===l)return nr(255*c,255*c,255*c,1);var h=c<=.5?c*(l+1):c+l-c*l,d=2*c-h,p=ar(d,h,a+1/3),f=ar(d,h,a),A=ar(d,h,a-1/3);return nr(255*p,255*f,255*A,u)},cr={hsl:lr,hsla:lr,rgb:sr,rgba:sr},ur=function(e,t){return tr.parse(e,Mi.create(t).parseComponentValue())},hr={ALICEBLUE:4042850303,ANTIQUEWHITE:4209760255,AQUA:16777215,AQUAMARINE:2147472639,AZURE:4043309055,BEIGE:4126530815,BISQUE:4293182719,BLACK:255,BLANCHEDALMOND:4293643775,BLUE:65535,BLUEVIOLET:2318131967,BROWN:2771004159,BURLYWOOD:3736635391,CADETBLUE:1604231423,CHARTREUSE:2147418367,CHOCOLATE:3530104575,CORAL:4286533887,CORNFLOWERBLUE:1687547391,CORNSILK:4294499583,CRIMSON:3692313855,CYAN:16777215,DARKBLUE:35839,DARKCYAN:9145343,DARKGOLDENROD:3095837695,DARKGRAY:2846468607,DARKGREEN:6553855,DARKGREY:2846468607,DARKKHAKI:3182914559,DARKMAGENTA:2332068863,DARKOLIVEGREEN:1433087999,DARKORANGE:4287365375,DARKORCHID:2570243327,DARKRED:2332033279,DARKSALMON:3918953215,DARKSEAGREEN:2411499519,DARKSLATEBLUE:1211993087,DARKSLATEGRAY:793726975,DARKSLATEGREY:793726975,DARKTURQUOISE:13554175,DARKVIOLET:2483082239,DEEPPINK:4279538687,DEEPSKYBLUE:12582911,DIMGRAY:1768516095,DIMGREY:1768516095,DODGERBLUE:512819199,FIREBRICK:2988581631,FLORALWHITE:4294635775,FORESTGREEN:579543807,FUCHSIA:4278255615,GAINSBORO:3705462015,GHOSTWHITE:4177068031,GOLD:4292280575,GOLDENROD:3668254975,GRAY:2155905279,GREEN:8388863,GREENYELLOW:2919182335,GREY:2155905279,HONEYDEW:4043305215,HOTPINK:4285117695,INDIANRED:3445382399,INDIGO:1258324735,IVORY:4294963455,KHAKI:4041641215,LAVENDER:3873897215,LAVENDERBLUSH:4293981695,LAWNGREEN:2096890111,LEMONCHIFFON:4294626815,LIGHTBLUE:2916673279,LIGHTCORAL:4034953471,LIGHTCYAN:3774873599,LIGHTGOLDENRODYELLOW:4210742015,LIGHTGRAY:3553874943,LIGHTGREEN:2431553791,LIGHTGREY:3553874943,LIGHTPINK:4290167295,LIGHTSALMON:4288707327,LIGHTSEAGREEN:548580095,LIGHTSKYBLUE:2278488831,LIGHTSLATEGRAY:2005441023,LIGHTSLATEGREY:2005441023,LIGHTSTEELBLUE:2965692159,LIGHTYELLOW:4294959359,LIME:16711935,LIMEGREEN:852308735,LINEN:4210091775,MAGENTA:4278255615,MAROON:2147483903,MEDIUMAQUAMARINE:1724754687,MEDIUMBLUE:52735,MEDIUMORCHID:3126187007,MEDIUMPURPLE:2473647103,MEDIUMSEAGREEN:1018393087,MEDIUMSLATEBLUE:2070474495,MEDIUMSPRINGGREEN:16423679,MEDIUMTURQUOISE:1221709055,MEDIUMVIOLETRED:3340076543,MIDNIGHTBLUE:421097727,MINTCREAM:4127193855,MISTYROSE:4293190143,MOCCASIN:4293178879,NAVAJOWHITE:4292783615,NAVY:33023,OLDLACE:4260751103,OLIVE:2155872511,OLIVEDRAB:1804477439,ORANGE:4289003775,ORANGERED:4282712319,ORCHID:3664828159,PALEGOLDENROD:4008225535,PALEGREEN:2566625535,PALETURQUOISE:2951671551,PALEVIOLETRED:3681588223,PAPAYAWHIP:4293907967,PEACHPUFF:4292524543,PERU:3448061951,PINK:4290825215,PLUM:3718307327,POWDERBLUE:2967529215,PURPLE:2147516671,REBECCAPURPLE:1714657791,RED:4278190335,ROSYBROWN:3163525119,ROYALBLUE:1097458175,SADDLEBROWN:2336560127,SALMON:4202722047,SANDYBROWN:4104413439,SEAGREEN:780883967,SEASHELL:4294307583,SIENNA:2689740287,SILVER:3233857791,SKYBLUE:2278484991,SLATEBLUE:1784335871,SLATEGRAY:1887473919,SLATEGREY:1887473919,SNOW:4294638335,SPRINGGREEN:16744447,STEELBLUE:1182971135,TAN:3535047935,TEAL:8421631,THISTLE:3636451583,TOMATO:4284696575,TRANSPARENT:0,TURQUOISE:1088475391,VIOLET:4001558271,WHEAT:4125012991,WHITE:4294967295,WHITESMOKE:4126537215,YELLOW:4294902015,YELLOWGREEN:2597139199},dr={name:"background-clip",initialValue:"border-box",prefix:!1,type:1,parse:function(e,t){return t.map((function(e){if(Li(e))switch(e.value){case"padding-box":return 1;case"content-box":return 2}return 0}))}},pr={name:"background-color",initialValue:"transparent",prefix:!1,type:3,format:"color"},fr=function(e,t){var i=tr.parse(e,t[0]),r=t[1];return r&&Ni(r)?{color:i,stop:r}:{color:i,stop:null}},Ar=function(e,t){var i=e[0],r=e[e.length-1];null===i.stop&&(i.stop=ji),null===r.stop&&(r.stop=Hi);for(var n=[],o=0,s=0;s<e.length;s++){var a=e[s].stop;if(null!==a){var l=$i(a,t);l>o?n.push(l):n.push(o),o=l}else n.push(null)}var c=null;for(s=0;s<n.length;s++){var u=n[s];if(null===u)null===c&&(c=s);else if(null!==c){for(var h=s-c,d=(u-n[c-1])/(h+1),p=1;p<=h;p++)n[c+p-1]=d*p;c=null}}return e.map((function(e,i){return{color:e.color,stop:Math.max(Math.min(1,n[i]/t),0)}}))},mr=function(e,t,i){var r=t/2,n=i/2,o=$i(e[0],t)-r,s=n-$i(e[1],i);return(Math.atan2(s,o)+2*Math.PI)%(2*Math.PI)},gr=function(e,t,i){var r="number"==typeof e?e:mr(e,t,i),n=Math.abs(t*Math.sin(r))+Math.abs(i*Math.cos(r)),o=t/2,s=i/2,a=n/2,l=Math.sin(r-Math.PI/2)*a,c=Math.cos(r-Math.PI/2)*a;return[n,o-c,o+c,s-l,s+l]},_r=function(e,t){return Math.sqrt(e*e+t*t)},yr=function(e,t,i,r,n){return[[0,0],[0,t],[e,0],[e,t]].reduce((function(e,t){var o=t[0],s=t[1],a=_r(i-o,r-s);return(n?a<e.optimumDistance:a>e.optimumDistance)?{optimumCorner:t,optimumDistance:a}:e}),{optimumDistance:n?1/0:-1/0,optimumCorner:null}).optimumCorner},vr=function(e,t,i,r,n){var o=0,s=0;switch(e.size){case 0:0===e.shape?o=s=Math.min(Math.abs(t),Math.abs(t-r),Math.abs(i),Math.abs(i-n)):1===e.shape&&(o=Math.min(Math.abs(t),Math.abs(t-r)),s=Math.min(Math.abs(i),Math.abs(i-n)));break;case 2:if(0===e.shape)o=s=Math.min(_r(t,i),_r(t,i-n),_r(t-r,i),_r(t-r,i-n));else if(1===e.shape){var a=Math.min(Math.abs(i),Math.abs(i-n))/Math.min(Math.abs(t),Math.abs(t-r)),l=yr(r,n,t,i,!0),c=l[0],u=l[1];s=a*(o=_r(c-t,(u-i)/a))}break;case 1:0===e.shape?o=s=Math.max(Math.abs(t),Math.abs(t-r),Math.abs(i),Math.abs(i-n)):1===e.shape&&(o=Math.max(Math.abs(t),Math.abs(t-r)),s=Math.max(Math.abs(i),Math.abs(i-n)));break;case 3:if(0===e.shape)o=s=Math.max(_r(t,i),_r(t,i-n),_r(t-r,i),_r(t-r,i-n));else if(1===e.shape){a=Math.max(Math.abs(i),Math.abs(i-n))/Math.max(Math.abs(t),Math.abs(t-r));var h=yr(r,n,t,i,!1);c=h[0],u=h[1],s=a*(o=_r(c-t,(u-i)/a))}}return Array.isArray(e.size)&&(o=$i(e.size[0],r),s=2===e.size.length?$i(e.size[1],n):o),[o,s]},xr=function(e,t){var i=er(180),r=[];return Di(t).forEach((function(t,n){if(0===n){var o=t[0];if(20===o.type&&-1!==["top","left","right","bottom"].indexOf(o.value))return void(i=Ji(t));if(Yi(o))return void(i=(Xi.parse(e,o)+er(270))%er(360))}var s=fr(e,t);r.push(s)})),{angle:i,stops:r,type:1}},br=function(e,t){var i=er(180),r=[],n=1,o=0,s=3,a=[];return Di(t).forEach((function(t,i){var o=t[0];if(0===i){if(Li(o)&&"linear"===o.value)return void(n=1);if(Li(o)&&"radial"===o.value)return void(n=2)}if(18===o.type)if("from"===o.name){var s=tr.parse(e,o.values[0]);r.push({stop:ji,color:s})}else if("to"===o.name)s=tr.parse(e,o.values[0]),r.push({stop:Hi,color:s});else if("color-stop"===o.name){var a=o.values.filter(Ri);if(2===a.length){s=tr.parse(e,a[1]);var l=a[0];Pi(l)&&r.push({stop:{type:16,number:100*l.number,flags:l.flags},color:s})}}})),1===n?{angle:(i+er(180))%er(360),stops:r,type:n}:{size:s,shape:o,stops:r,position:a,type:n}},wr="closest-side",Tr="farthest-side",Br="closest-corner",Cr="farthest-corner",Sr="circle",Er="ellipse",Mr="cover",Ir="contain",Pr=function(e,t){var i=0,r=3,n=[],o=[];return Di(t).forEach((function(t,s){var a=!0;if(0===s?a=t.reduce((function(e,t){if(Li(t))switch(t.value){case"center":return o.push(Vi),!1;case"top":case"left":return o.push(ji),!1;case"right":case"bottom":return o.push(Hi),!1}else if(Ni(t)||Ui(t))return o.push(t),!1;return e}),a):1===s&&(a=t.reduce((function(e,t){if(Li(t))switch(t.value){case Sr:return i=0,!1;case Er:return i=1,!1;case Ir:case wr:return r=0,!1;case Tr:return r=1,!1;case Br:return r=2,!1;case Mr:case Cr:return r=3,!1}else if(Ui(t)||Ni(t))return Array.isArray(r)||(r=[]),r.push(t),!1;return e}),a)),a){var l=fr(e,t);n.push(l)}})),{size:r,shape:i,stops:n,position:o,type:2}},Lr=function(e){return 1===e.type},Fr=function(e){return 2===e.type},kr={name:"image",parse:function(e,t){if(22===t.type){var i={url:t.value,type:0};return e.cache.addImage(t.value),i}if(18===t.type){var r=Dr[t.name];if(void 0===r)throw new Error('Attempting to parse an unsupported image function "'+t.name+'"');return r(e,t.values)}throw new Error("Unsupported image type "+t.type)}};function zr(e){return!(20===e.type&&"none"===e.value||18===e.type&&!Dr[e.name])}var Rr,Dr={"linear-gradient":function(e,t){var i=er(180),r=[];return Di(t).forEach((function(t,n){if(0===n){var o=t[0];if(20===o.type&&"to"===o.value)return void(i=Ji(t));if(Yi(o))return void(i=Xi.parse(e,o))}var s=fr(e,t);r.push(s)})),{angle:i,stops:r,type:1}},"-moz-linear-gradient":xr,"-ms-linear-gradient":xr,"-o-linear-gradient":xr,"-webkit-linear-gradient":xr,"radial-gradient":function(e,t){var i=0,r=3,n=[],o=[];return Di(t).forEach((function(t,s){var a=!0;if(0===s){var l=!1;a=t.reduce((function(e,t){if(l)if(Li(t))switch(t.value){case"center":return o.push(Vi),e;case"top":case"left":return o.push(ji),e;case"right":case"bottom":return o.push(Hi),e}else(Ni(t)||Ui(t))&&o.push(t);else if(Li(t))switch(t.value){case Sr:return i=0,!1;case Er:return i=1,!1;case"at":return l=!0,!1;case wr:return r=0,!1;case Mr:case Tr:return r=1,!1;case Ir:case Br:return r=2,!1;case Cr:return r=3,!1}else if(Ui(t)||Ni(t))return Array.isArray(r)||(r=[]),r.push(t),!1;return e}),a)}if(a){var c=fr(e,t);n.push(c)}})),{size:r,shape:i,stops:n,position:o,type:2}},"-moz-radial-gradient":Pr,"-ms-radial-gradient":Pr,"-o-radial-gradient":Pr,"-webkit-radial-gradient":Pr,"-webkit-gradient":br},Or={name:"background-image",initialValue:"none",type:1,prefix:!1,parse:function(e,t){if(0===t.length)return[];var i=t[0];return 20===i.type&&"none"===i.value?[]:t.filter((function(e){return Ri(e)&&zr(e)})).map((function(t){return kr.parse(e,t)}))}},Ur={name:"background-origin",initialValue:"border-box",prefix:!1,type:1,parse:function(e,t){return t.map((function(e){if(Li(e))switch(e.value){case"padding-box":return 1;case"content-box":return 2}return 0}))}},Nr={name:"background-position",initialValue:"0% 0%",type:1,prefix:!1,parse:function(e,t){return Di(t).map((function(e){return e.filter(Ni)})).map(Qi)}},Qr={name:"background-repeat",initialValue:"repeat",prefix:!1,type:1,parse:function(e,t){return Di(t).map((function(e){return e.filter(Li).map((function(e){return e.value})).join(" ")})).map(jr)}},jr=function(e){switch(e){case"no-repeat":return 1;case"repeat-x":case"repeat no-repeat":return 2;case"repeat-y":case"no-repeat repeat":return 3;default:return 0}};!function(e){e.AUTO="auto",e.CONTAIN="contain",e.COVER="cover"}(Rr||(Rr={}));var Vr,Hr={name:"background-size",initialValue:"0",prefix:!1,type:1,parse:function(e,t){return Di(t).map((function(e){return e.filter(Gr)}))}},Gr=function(e){return Li(e)||Ni(e)},$r=function(e){return{name:"border-"+e+"-color",initialValue:"transparent",prefix:!1,type:3,format:"color"}},Zr=$r("top"),qr=$r("right"),Kr=$r("bottom"),Wr=$r("left"),Xr=function(e){return{name:"border-radius-"+e,initialValue:"0 0",prefix:!1,type:1,parse:function(e,t){return Qi(t.filter(Ni))}}},Yr=Xr("top-left"),Jr=Xr("top-right"),en=Xr("bottom-right"),tn=Xr("bottom-left"),rn=function(e){return{name:"border-"+e+"-style",initialValue:"solid",prefix:!1,type:2,parse:function(e,t){switch(t){case"none":return 0;case"dashed":return 2;case"dotted":return 3;case"double":return 4}return 1}}},nn=rn("top"),on=rn("right"),sn=rn("bottom"),an=rn("left"),ln=function(e){return{name:"border-"+e+"-width",initialValue:"0",type:0,prefix:!1,parse:function(e,t){return Ii(t)?t.number:0}}},cn=ln("top"),un=ln("right"),hn=ln("bottom"),dn=ln("left"),pn={name:"color",initialValue:"transparent",prefix:!1,type:3,format:"color"},fn={name:"direction",initialValue:"ltr",prefix:!1,type:2,parse:function(e,t){return"rtl"===t?1:0}},An={name:"display",initialValue:"inline-block",prefix:!1,type:1,parse:function(e,t){return t.filter(Li).reduce((function(e,t){return e|mn(t.value)}),0)}},mn=function(e){switch(e){case"block":case"-webkit-box":return 2;case"inline":return 4;case"run-in":return 8;case"flow":return 16;case"flow-root":return 32;case"table":return 64;case"flex":case"-webkit-flex":return 128;case"grid":case"-ms-grid":return 256;case"ruby":return 512;case"subgrid":return 1024;case"list-item":return 2048;case"table-row-group":return 4096;case"table-header-group":return 8192;case"table-footer-group":return 16384;case"table-row":return 32768;case"table-cell":return 65536;case"table-column-group":return 131072;case"table-column":return 262144;case"table-caption":return 524288;case"ruby-base":return 1048576;case"ruby-text":return 2097152;case"ruby-base-container":return 4194304;case"ruby-text-container":return 8388608;case"contents":return 16777216;case"inline-block":return 33554432;case"inline-list-item":return 67108864;case"inline-table":return 134217728;case"inline-flex":return 268435456;case"inline-grid":return 536870912}return 0},gn={name:"float",initialValue:"none",prefix:!1,type:2,parse:function(e,t){switch(t){case"left":return 1;case"right":return 2;case"inline-start":return 3;case"inline-end":return 4}return 0}},_n={name:"letter-spacing",initialValue:"0",prefix:!1,type:0,parse:function(e,t){return 20===t.type&&"normal"===t.value?0:17===t.type||15===t.type?t.number:0}};!function(e){e.NORMAL="normal",e.STRICT="strict"}(Vr||(Vr={}));var yn,vn={name:"line-break",initialValue:"normal",prefix:!1,type:2,parse:function(e,t){return"strict"===t?Vr.STRICT:Vr.NORMAL}},xn={name:"line-height",initialValue:"normal",prefix:!1,type:4},bn=function(e,t){return Li(e)&&"normal"===e.value?1.2*t:17===e.type?t*e.number:Ni(e)?$i(e,t):t},wn={name:"list-style-image",initialValue:"none",type:0,prefix:!1,parse:function(e,t){return 20===t.type&&"none"===t.value?null:kr.parse(e,t)}},Tn={name:"list-style-position",initialValue:"outside",prefix:!1,type:2,parse:function(e,t){return"inside"===t?0:1}},Bn={name:"list-style-type",initialValue:"none",prefix:!1,type:2,parse:function(e,t){switch(t){case"disc":return 0;case"circle":return 1;case"square":return 2;case"decimal":return 3;case"cjk-decimal":return 4;case"decimal-leading-zero":return 5;case"lower-roman":return 6;case"upper-roman":return 7;case"lower-greek":return 8;case"lower-alpha":return 9;case"upper-alpha":return 10;case"arabic-indic":return 11;case"armenian":return 12;case"bengali":return 13;case"cambodian":return 14;case"cjk-earthly-branch":return 15;case"cjk-heavenly-stem":return 16;case"cjk-ideographic":return 17;case"devanagari":return 18;case"ethiopic-numeric":return 19;case"georgian":return 20;case"gujarati":return 21;case"gurmukhi":case"hebrew":return 22;case"hiragana":return 23;case"hiragana-iroha":return 24;case"japanese-formal":return 25;case"japanese-informal":return 26;case"kannada":return 27;case"katakana":return 28;case"katakana-iroha":return 29;case"khmer":return 30;case"korean-hangul-formal":return 31;case"korean-hanja-formal":return 32;case"korean-hanja-informal":return 33;case"lao":return 34;case"lower-armenian":return 35;case"malayalam":return 36;case"mongolian":return 37;case"myanmar":return 38;case"oriya":return 39;case"persian":return 40;case"simp-chinese-formal":return 41;case"simp-chinese-informal":return 42;case"tamil":return 43;case"telugu":return 44;case"thai":return 45;case"tibetan":return 46;case"trad-chinese-formal":return 47;case"trad-chinese-informal":return 48;case"upper-armenian":return 49;case"disclosure-open":return 50;case"disclosure-closed":return 51;default:return-1}}},Cn=function(e){return{name:"margin-"+e,initialValue:"0",prefix:!1,type:4}},Sn=Cn("top"),En=Cn("right"),Mn=Cn("bottom"),In=Cn("left"),Pn={name:"overflow",initialValue:"visible",prefix:!1,type:1,parse:function(e,t){return t.filter(Li).map((function(e){switch(e.value){case"hidden":return 1;case"scroll":return 2;case"clip":return 3;case"auto":return 4;default:return 0}}))}},Ln={name:"overflow-wrap",initialValue:"normal",prefix:!1,type:2,parse:function(e,t){return"break-word"===t?"break-word":"normal"}},Fn=function(e){return{name:"padding-"+e,initialValue:"0",prefix:!1,type:3,format:"length-percentage"}},kn=Fn("top"),zn=Fn("right"),Rn=Fn("bottom"),Dn=Fn("left"),On={name:"text-align",initialValue:"left",prefix:!1,type:2,parse:function(e,t){switch(t){case"right":return 2;case"center":case"justify":return 1;default:return 0}}},Un={name:"position",initialValue:"static",prefix:!1,type:2,parse:function(e,t){switch(t){case"relative":return 1;case"absolute":return 2;case"fixed":return 3;case"sticky":return 4}return 0}},Nn={name:"text-shadow",initialValue:"none",type:1,prefix:!1,parse:function(e,t){return 1===t.length&&ki(t[0],"none")?[]:Di(t).map((function(t){for(var i={color:hr.TRANSPARENT,offsetX:ji,offsetY:ji,blur:ji},r=0,n=0;n<t.length;n++){var o=t[n];Ui(o)?(0===r?i.offsetX=o:1===r?i.offsetY=o:i.blur=o,r++):i.color=tr.parse(e,o)}return i}))}},Qn={name:"text-transform",initialValue:"none",prefix:!1,type:2,parse:function(e,t){switch(t){case"uppercase":return 2;case"lowercase":return 1;case"capitalize":return 3}return 0}},jn={name:"transform",initialValue:"none",prefix:!0,type:0,parse:function(e,t){if(20===t.type&&"none"===t.value)return null;if(18===t.type){var i=Vn[t.name];if(void 0===i)throw new Error('Attempting to parse an unsupported transform function "'+t.name+'"');return i(t.values)}return null}},Vn={matrix:function(e){var t=e.filter((function(e){return 17===e.type})).map((function(e){return e.number}));return 6===t.length?t:null},matrix3d:function(e){var t=e.filter((function(e){return 17===e.type})).map((function(e){return e.number})),i=t[0],r=t[1];t[2],t[3];var n=t[4],o=t[5];t[6],t[7],t[8],t[9],t[10],t[11];var s=t[12],a=t[13];return t[14],t[15],16===t.length?[i,r,n,o,s,a]:null}},Hn={type:16,number:50,flags:Ge},Gn=[Hn,Hn],$n={name:"transform-origin",initialValue:"50% 50%",prefix:!0,type:1,parse:function(e,t){var i=t.filter(Ni);return 2!==i.length?Gn:[i[0],i[1]]}},Zn={name:"visible",initialValue:"none",prefix:!1,type:2,parse:function(e,t){switch(t){case"hidden":return 1;case"collapse":return 2;default:return 0}}};!function(e){e.NORMAL="normal",e.BREAK_ALL="break-all",e.KEEP_ALL="keep-all"}(yn||(yn={}));for(var qn={name:"word-break",initialValue:"normal",prefix:!1,type:2,parse:function(e,t){switch(t){case"break-all":return yn.BREAK_ALL;case"keep-all":return yn.KEEP_ALL;default:return yn.NORMAL}}},Kn={name:"z-index",initialValue:"auto",prefix:!1,type:0,parse:function(e,t){if(20===t.type)return{auto:!0,order:0};if(Pi(t))return{auto:!1,order:t.number};throw new Error("Invalid z-index number parsed")}},Wn={name:"time",parse:function(e,t){if(15===t.type)switch(t.unit.toLowerCase()){case"s":return 1e3*t.number;case"ms":return t.number}throw new Error("Unsupported time type")}},Xn={name:"opacity",initialValue:"1",type:0,prefix:!1,parse:function(e,t){return Pi(t)?t.number:1}},Yn={name:"text-decoration-color",initialValue:"transparent",prefix:!1,type:3,format:"color"},Jn={name:"text-decoration-line",initialValue:"none",prefix:!1,type:1,parse:function(e,t){return t.filter(Li).map((function(e){switch(e.value){case"underline":return 1;case"overline":return 2;case"line-through":return 3;case"none":return 4}return 0})).filter((function(e){return 0!==e}))}},eo={name:"font-family",initialValue:"",prefix:!1,type:1,parse:function(e,t){var i=[],r=[];return t.forEach((function(e){switch(e.type){case 20:case 0:i.push(e.value);break;case 17:i.push(e.number.toString());break;case 4:r.push(i.join(" ")),i.length=0}})),i.length&&r.push(i.join(" ")),r.map((function(e){return-1===e.indexOf(" ")?e:"'"+e+"'"}))}},to={name:"font-size",initialValue:"0",prefix:!1,type:3,format:"length"},io={name:"font-weight",initialValue:"normal",type:0,prefix:!1,parse:function(e,t){return Pi(t)?t.number:Li(t)&&"bold"===t.value?700:400}},ro={name:"font-variant",initialValue:"none",type:1,prefix:!1,parse:function(e,t){return t.filter(Li).map((function(e){return e.value}))}},no={name:"font-style",initialValue:"normal",prefix:!1,type:2,parse:function(e,t){switch(t){case"oblique":return"oblique";case"italic":return"italic";default:return"normal"}}},oo=function(e,t){return!!(e&t)},so={name:"content",initialValue:"none",type:1,prefix:!1,parse:function(e,t){if(0===t.length)return[];var i=t[0];return 20===i.type&&"none"===i.value?[]:t}},ao={name:"counter-increment",initialValue:"none",prefix:!0,type:1,parse:function(e,t){if(0===t.length)return null;var i=t[0];if(20===i.type&&"none"===i.value)return null;for(var r=[],n=t.filter(zi),o=0;o<n.length;o++){var s=n[o],a=n[o+1];if(20===s.type){var l=a&&Pi(a)?a.number:1;r.push({counter:s.value,increment:l})}}return r}},lo={name:"counter-reset",initialValue:"none",prefix:!0,type:1,parse:function(e,t){if(0===t.length)return[];for(var i=[],r=t.filter(zi),n=0;n<r.length;n++){var o=r[n],s=r[n+1];if(Li(o)&&"none"!==o.value){var a=s&&Pi(s)?s.number:0;i.push({counter:o.value,reset:a})}}return i}},co={name:"duration",initialValue:"0s",prefix:!1,type:1,parse:function(e,t){return t.filter(Ii).map((function(t){return Wn.parse(e,t)}))}},uo={name:"quotes",initialValue:"none",prefix:!0,type:1,parse:function(e,t){if(0===t.length)return null;var i=t[0];if(20===i.type&&"none"===i.value)return null;var r=[],n=t.filter(Fi);if(n.length%2!=0)return null;for(var o=0;o<n.length;o+=2){var s=n[o].value,a=n[o+1].value;r.push({open:s,close:a})}return r}},ho=function(e,t,i){if(!e)return"";var r=e[Math.min(t,e.length-1)];return r?i?r.open:r.close:""},po={name:"box-shadow",initialValue:"none",type:1,prefix:!1,parse:function(e,t){return 1===t.length&&ki(t[0],"none")?[]:Di(t).map((function(t){for(var i={color:255,offsetX:ji,offsetY:ji,blur:ji,spread:ji,inset:!1},r=0,n=0;n<t.length;n++){var o=t[n];ki(o,"inset")?i.inset=!0:Ui(o)?(0===r?i.offsetX=o:1===r?i.offsetY=o:2===r?i.blur=o:i.spread=o,r++):i.color=tr.parse(e,o)}return i}))}},fo={name:"paint-order",initialValue:"normal",prefix:!1,type:1,parse:function(e,t){var i=[0,1,2],r=[];return t.filter(Li).forEach((function(e){switch(e.value){case"stroke":r.push(1);break;case"fill":r.push(0);break;case"markers":r.push(2)}})),i.forEach((function(e){-1===r.indexOf(e)&&r.push(e)})),r}},Ao={name:"-webkit-text-stroke-color",initialValue:"currentcolor",prefix:!1,type:3,format:"color"},mo={name:"-webkit-text-stroke-width",initialValue:"0",type:0,prefix:!1,parse:function(e,t){return Ii(t)?t.number:0}},go=function(){function e(e,t){var i,r;this.animationDuration=vo(e,co,t.animationDuration),this.backgroundClip=vo(e,dr,t.backgroundClip),this.backgroundColor=vo(e,pr,t.backgroundColor),this.backgroundImage=vo(e,Or,t.backgroundImage),this.backgroundOrigin=vo(e,Ur,t.backgroundOrigin),this.backgroundPosition=vo(e,Nr,t.backgroundPosition),this.backgroundRepeat=vo(e,Qr,t.backgroundRepeat),this.backgroundSize=vo(e,Hr,t.backgroundSize),this.borderTopColor=vo(e,Zr,t.borderTopColor),this.borderRightColor=vo(e,qr,t.borderRightColor),this.borderBottomColor=vo(e,Kr,t.borderBottomColor),this.borderLeftColor=vo(e,Wr,t.borderLeftColor),this.borderTopLeftRadius=vo(e,Yr,t.borderTopLeftRadius),this.borderTopRightRadius=vo(e,Jr,t.borderTopRightRadius),this.borderBottomRightRadius=vo(e,en,t.borderBottomRightRadius),this.borderBottomLeftRadius=vo(e,tn,t.borderBottomLeftRadius),this.borderTopStyle=vo(e,nn,t.borderTopStyle),this.borderRightStyle=vo(e,on,t.borderRightStyle),this.borderBottomStyle=vo(e,sn,t.borderBottomStyle),this.borderLeftStyle=vo(e,an,t.borderLeftStyle),this.borderTopWidth=vo(e,cn,t.borderTopWidth),this.borderRightWidth=vo(e,un,t.borderRightWidth),this.borderBottomWidth=vo(e,hn,t.borderBottomWidth),this.borderLeftWidth=vo(e,dn,t.borderLeftWidth),this.boxShadow=vo(e,po,t.boxShadow),this.color=vo(e,pn,t.color),this.direction=vo(e,fn,t.direction),this.display=vo(e,An,t.display),this.float=vo(e,gn,t.cssFloat),this.fontFamily=vo(e,eo,t.fontFamily),this.fontSize=vo(e,to,t.fontSize),this.fontStyle=vo(e,no,t.fontStyle),this.fontVariant=vo(e,ro,t.fontVariant),this.fontWeight=vo(e,io,t.fontWeight),this.letterSpacing=vo(e,_n,t.letterSpacing),this.lineBreak=vo(e,vn,t.lineBreak),this.lineHeight=vo(e,xn,t.lineHeight),this.listStyleImage=vo(e,wn,t.listStyleImage),this.listStylePosition=vo(e,Tn,t.listStylePosition),this.listStyleType=vo(e,Bn,t.listStyleType),this.marginTop=vo(e,Sn,t.marginTop),this.marginRight=vo(e,En,t.marginRight),this.marginBottom=vo(e,Mn,t.marginBottom),this.marginLeft=vo(e,In,t.marginLeft),this.opacity=vo(e,Xn,t.opacity);var n=vo(e,Pn,t.overflow);this.overflowX=n[0],this.overflowY=n[n.length>1?1:0],this.overflowWrap=vo(e,Ln,t.overflowWrap),this.paddingTop=vo(e,kn,t.paddingTop),this.paddingRight=vo(e,zn,t.paddingRight),this.paddingBottom=vo(e,Rn,t.paddingBottom),this.paddingLeft=vo(e,Dn,t.paddingLeft),this.paintOrder=vo(e,fo,t.paintOrder),this.position=vo(e,Un,t.position),this.textAlign=vo(e,On,t.textAlign),this.textDecorationColor=vo(e,Yn,null!==(i=t.textDecorationColor)&&void 0!==i?i:t.color),this.textDecorationLine=vo(e,Jn,null!==(r=t.textDecorationLine)&&void 0!==r?r:t.textDecoration),this.textShadow=vo(e,Nn,t.textShadow),this.textTransform=vo(e,Qn,t.textTransform),this.transform=vo(e,jn,t.transform),this.transformOrigin=vo(e,$n,t.transformOrigin),this.visibility=vo(e,Zn,t.visibility),this.webkitTextStrokeColor=vo(e,Ao,t.webkitTextStrokeColor),this.webkitTextStrokeWidth=vo(e,mo,t.webkitTextStrokeWidth),this.wordBreak=vo(e,qn,t.wordBreak),this.zIndex=vo(e,Kn,t.zIndex)}return e.prototype.isVisible=function(){return this.display>0&&this.opacity>0&&0===this.visibility},e.prototype.isTransparent=function(){return ir(this.backgroundColor)},e.prototype.isTransformed=function(){return null!==this.transform},e.prototype.isPositioned=function(){return 0!==this.position},e.prototype.isPositionedWithZIndex=function(){return this.isPositioned()&&!this.zIndex.auto},e.prototype.isFloating=function(){return 0!==this.float},e.prototype.isInlineLevel=function(){return oo(this.display,4)||oo(this.display,33554432)||oo(this.display,268435456)||oo(this.display,536870912)||oo(this.display,67108864)||oo(this.display,134217728)},e}(),_o=function(){function e(e,t){this.content=vo(e,so,t.content),this.quotes=vo(e,uo,t.quotes)}return e}(),yo=function(){function e(e,t){this.counterIncrement=vo(e,ao,t.counterIncrement),this.counterReset=vo(e,lo,t.counterReset)}return e}(),vo=function(e,t,i){var r=new Ei,n=null!=i?i.toString():t.initialValue;r.write(n);var o=new Mi(r.read());switch(t.type){case 2:var s=o.parseComponentValue();return t.parse(e,Li(s)?s.value:t.initialValue);case 0:return t.parse(e,o.parseComponentValue());case 1:return t.parse(e,o.parseComponentValues());case 4:return o.parseComponentValue();case 3:switch(t.format){case"angle":return Xi.parse(e,o.parseComponentValue());case"color":return tr.parse(e,o.parseComponentValue());case"image":return kr.parse(e,o.parseComponentValue());case"length":var a=o.parseComponentValue();return Ui(a)?a:ji;case"length-percentage":var l=o.parseComponentValue();return Ni(l)?l:ji;case"time":return Wn.parse(e,o.parseComponentValue())}}},xo="data-html2canvas-debug",bo=function(e){switch(e.getAttribute(xo)){case"all":return 1;case"clone":return 2;case"parse":return 3;case"render":return 4;default:return 0}},wo=function(e,t){var i=bo(e);return 1===i||t===i},To=function(){function e(e,t){this.context=e,this.textNodes=[],this.elements=[],this.flags=0,wo(t,3),this.styles=new go(e,window.getComputedStyle(t,null)),ha(t)&&(this.styles.animationDuration.some((function(e){return e>0}))&&(t.style.animationDuration="0s"),null!==this.styles.transform&&(t.style.transform="none")),this.bounds=a(this.context,t),wo(t,4)&&(this.flags|=16)}return e}(),Bo="AAAAAAAAAAAAEA4AGBkAAFAaAAACAAAAAAAIABAAGAAwADgACAAQAAgAEAAIABAACAAQAAgAEAAIABAACAAQAAgAEAAIABAAQABIAEQATAAIABAACAAQAAgAEAAIABAAVABcAAgAEAAIABAACAAQAGAAaABwAHgAgACIAI4AlgAIABAAmwCjAKgAsAC2AL4AvQDFAMoA0gBPAVYBWgEIAAgACACMANoAYgFkAWwBdAF8AX0BhQGNAZUBlgGeAaMBlQGWAasBswF8AbsBwwF0AcsBYwHTAQgA2wG/AOMBdAF8AekB8QF0AfkB+wHiAHQBfAEIAAMC5gQIAAsCEgIIAAgAFgIeAggAIgIpAggAMQI5AkACygEIAAgASAJQAlgCYAIIAAgACAAKBQoFCgUTBRMFGQUrBSsFCAAIAAgACAAIAAgACAAIAAgACABdAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABoAmgCrwGvAQgAbgJ2AggAHgEIAAgACADnAXsCCAAIAAgAgwIIAAgACAAIAAgACACKAggAkQKZAggAPADJAAgAoQKkAqwCsgK6AsICCADJAggA0AIIAAgACAAIANYC3gIIAAgACAAIAAgACABAAOYCCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAkASoB+QIEAAgACAA8AEMCCABCBQgACABJBVAFCAAIAAgACAAIAAgACAAIAAgACABTBVoFCAAIAFoFCABfBWUFCAAIAAgACAAIAAgAbQUIAAgACAAIAAgACABzBXsFfQWFBYoFigWKBZEFigWKBYoFmAWfBaYFrgWxBbkFCAAIAAgACAAIAAgACAAIAAgACAAIAMEFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAMgFCADQBQgACAAIAAgACAAIAAgACAAIAAgACAAIAO4CCAAIAAgAiQAIAAgACABAAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAD0AggACAD8AggACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIANYFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAMDvwAIAAgAJAIIAAgACAAIAAgACAAIAAgACwMTAwgACAB9BOsEGwMjAwgAKwMyAwsFYgE3A/MEPwMIAEUDTQNRAwgAWQOsAGEDCAAIAAgACAAIAAgACABpAzQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFIQUoBSwFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABtAwgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABMAEwACAAIAAgACAAIABgACAAIAAgACAC/AAgACAAyAQgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACACAAIAAwAAgACAAIAAgACAAIAAgACAAIAAAARABIAAgACAAIABQASAAIAAgAIABwAEAAjgCIABsAqAC2AL0AigDQAtwC+IJIQqVAZUBWQqVAZUBlQGVAZUBlQGrC5UBlQGVAZUBlQGVAZUBlQGVAXsKlQGVAbAK6wsrDGUMpQzlDJUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAfAKAAuZA64AtwCJALoC6ADwAAgAuACgA/oEpgO6AqsD+AAIAAgAswMIAAgACAAIAIkAuwP5AfsBwwPLAwgACAAIAAgACADRA9kDCAAIAOED6QMIAAgACAAIAAgACADuA/YDCAAIAP4DyQAIAAgABgQIAAgAXQAOBAgACAAIAAgACAAIABMECAAIAAgACAAIAAgACAD8AAQBCAAIAAgAGgQiBCoECAExBAgAEAEIAAgACAAIAAgACAAIAAgACAAIAAgACAA4BAgACABABEYECAAIAAgATAQYAQgAVAQIAAgACAAIAAgACAAIAAgACAAIAFoECAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAOQEIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAB+BAcACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAEABhgSMBAgACAAIAAgAlAQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAwAEAAQABAADAAMAAwADAAQABAAEAAQABAAEAAQABHATAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAdQMIAAgACAAIAAgACAAIAMkACAAIAAgAfQMIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACACFA4kDCAAIAAgACAAIAOcBCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAIcDCAAIAAgACAAIAAgACAAIAAgACAAIAJEDCAAIAAgACADFAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABgBAgAZgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAbAQCBXIECAAIAHkECAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABAAJwEQACjBKoEsgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAC6BMIECAAIAAgACAAIAAgACABmBAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAxwQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAGYECAAIAAgAzgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAigWKBYoFigWKBYoFigWKBd0FXwUIAOIF6gXxBYoF3gT5BQAGCAaKBYoFigWKBYoFigWKBYoFigWKBYoFigXWBIoFigWKBYoFigWKBYoFigWKBYsFEAaKBYoFigWKBYoFigWKBRQGCACKBYoFigWKBQgACAAIANEECAAIABgGigUgBggAJgYIAC4GMwaKBYoF0wQ3Bj4GigWKBYoFigWKBYoFigWKBYoFigWKBYoFigUIAAgACAAIAAgACAAIAAgAigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWLBf///////wQABAAEAAQABAAEAAQABAAEAAQAAwAEAAQAAgAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAQADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAUAAAAFAAUAAAAFAAUAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUAAQAAAAUABQAFAAUABQAFAAAAAAAFAAUAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAFAAUAAQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUABQAFAAAABwAHAAcAAAAHAAcABwAFAAEAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAcABwAFAAUAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAQABAAAAAAAAAAAAAAAFAAUABQAFAAAABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABwAHAAcAAAAHAAcAAAAAAAUABQAHAAUAAQAHAAEABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABwABAAUABQAFAAUAAAAAAAAAAAAAAAEAAQABAAEAAQABAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABQANAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQABAAEAAQABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAABQAHAAUABQAFAAAAAAAAAAcABQAFAAUABQAFAAQABAAEAAQABAAEAAQABAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUAAAAFAAUABQAFAAUAAAAFAAUABQAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAAAAAAAAAAAAUABQAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAUAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABwAHAAcABwAFAAcABwAAAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAUABwAHAAUABQAFAAUAAAAAAAcABwAAAAAABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAABQAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAABwAHAAcABQAFAAAAAAAAAAAABQAFAAAAAAAFAAUABQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAFAAUABQAFAAUAAAAFAAUABwAAAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAFAAUABwAFAAUABQAFAAAAAAAHAAcAAAAAAAcABwAFAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABwAAAAAAAAAHAAcABwAAAAcABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAABQAHAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAcABwAAAAUABQAFAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABQAHAAcABQAHAAcAAAAFAAcABwAAAAcABwAFAAUAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAFAAcABwAFAAUABQAAAAUAAAAHAAcABwAHAAcABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAHAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAABwAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAUAAAAFAAAAAAAAAAAABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUABQAFAAUAAAAFAAUAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABwAFAAUABQAFAAUABQAAAAUABQAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABQAFAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABQAFAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAHAAUABQAFAAUABQAFAAUABwAHAAcABwAHAAcABwAHAAUABwAHAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABwAHAAcABwAFAAUABwAHAAcAAAAAAAAAAAAHAAcABQAHAAcABwAHAAcABwAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAHAAUABQAFAAUABQAFAAUAAAAFAAAABQAAAAAABQAFAAUABQAFAAUABQAFAAcABwAHAAcABwAHAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAUABQAFAAUABQAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABwAFAAcABwAHAAcABwAFAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAUABQAFAAUABwAHAAUABQAHAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABQAFAAcABwAHAAUABwAFAAUABQAHAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAUABQAFAAUABQAFAAUABQAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAcABQAFAAUABQAFAAUABQAAAAAAAAAAAAUAAAAAAAAAAAAAAAAABQAAAAAABwAFAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUAAAAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAABQAAAAAAAAAFAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAUABQAHAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAHAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABwAFAAUABQAFAAcABwAFAAUABwAHAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAcABwAFAAUABwAHAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAFAAUABQAAAAAABQAFAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAFAAcABwAAAAAAAAAAAAAABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAFAAcABwAFAAcABwAAAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAFAAUABQAAAAUABQAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABwAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABQAFAAUABQAFAAUABQAFAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAHAAcABQAHAAUABQAAAAAAAAAAAAAAAAAFAAAABwAHAAcABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAcABwAAAAAABwAHAAAAAAAHAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABwAHAAUABQAFAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABQAFAAUABQAFAAUABwAFAAcABwAFAAcABQAFAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABQAFAAUABQAAAAAABwAHAAcABwAFAAUABwAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAHAAUABQAFAAUABQAFAAUABQAHAAcABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAFAAcABwAFAAUABQAFAAUABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAcABwAFAAUABQAFAAcABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABQAHAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAAAAAAFAAUABwAHAAcABwAFAAAAAAAAAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABwAHAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAHAAUABQAFAAUABQAFAAUABwAFAAUABwAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAAAAAAAABQAAAAUABQAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAHAAcAAAAFAAUAAAAHAAcABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAAAAAAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAUABQAFAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAABQAFAAUABQAFAAUABQAAAAUABQAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAFAAUABQAFAAUADgAOAA4ADgAOAA4ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAAAAAAAAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAMAAwADAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkAAAAAAAAAAAAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAAAAAAAAAAAAsADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwACwAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAADgAOAA4AAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAAAA4ADgAOAA4ADgAOAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAA4AAAAOAAAAAAAAAAAAAAAAAA4AAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAADgAAAAAAAAAAAA4AAAAOAAAAAAAAAAAADgAOAA4AAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAA4ADgAOAA4ADgAOAA4ADgAOAAAADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4AAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAOAA4ADgAOAA4ADgAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAAAAAAA=",Co="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",So="undefined"==typeof Uint8Array?[]:new Uint8Array(256),Eo=0;Eo<Co.length;Eo++)So[Co.charCodeAt(Eo)]=Eo;for(var Mo=function(e){var t,i,r,n,o,s=.75*e.length,a=e.length,l=0;"="===e[e.length-1]&&(s--,"="===e[e.length-2]&&s--);var c="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array&&void 0!==Uint8Array.prototype.slice?new ArrayBuffer(s):new Array(s),u=Array.isArray(c)?c:new Uint8Array(c);for(t=0;t<a;t+=4)i=So[e.charCodeAt(t)],r=So[e.charCodeAt(t+1)],n=So[e.charCodeAt(t+2)],o=So[e.charCodeAt(t+3)],u[l++]=i<<2|r>>4,u[l++]=(15&r)<<4|n>>2,u[l++]=(3&n)<<6|63&o;return c},Io=function(e){for(var t=e.length,i=[],r=0;r<t;r+=2)i.push(e[r+1]<<8|e[r]);return i},Po=function(e){for(var t=e.length,i=[],r=0;r<t;r+=4)i.push(e[r+3]<<24|e[r+2]<<16|e[r+1]<<8|e[r]);return i},Lo=5,Fo=11,ko=2,zo=65536>>Lo,Ro=(1<<Lo)-1,Do=zo+(1024>>Lo)+32,Oo=65536>>Fo,Uo=(1<<Fo-Lo)-1,No=function(e,t,i){return e.slice?e.slice(t,i):new Uint16Array(Array.prototype.slice.call(e,t,i))},Qo=function(e,t,i){return e.slice?e.slice(t,i):new Uint32Array(Array.prototype.slice.call(e,t,i))},jo=function(e,t){var i=Mo(e),r=Array.isArray(i)?Po(i):new Uint32Array(i),n=Array.isArray(i)?Io(i):new Uint16Array(i),o=24,s=No(n,o/2,r[4]/2),a=2===r[5]?No(n,(o+r[4])/2):Qo(r,Math.ceil((o+r[4])/4));return new Vo(r[0],r[1],r[2],r[3],s,a)},Vo=function(){function e(e,t,i,r,n,o){this.initialValue=e,this.errorValue=t,this.highStart=i,this.highValueIndex=r,this.index=n,this.data=o}return e.prototype.get=function(e){var t;if(e>=0){if(e<55296||e>56319&&e<=65535)return t=((t=this.index[e>>Lo])<<ko)+(e&Ro),this.data[t];if(e<=65535)return t=((t=this.index[zo+(e-55296>>Lo)])<<ko)+(e&Ro),this.data[t];if(e<this.highStart)return t=Do-Oo+(e>>Fo),t=this.index[t],t+=e>>Lo&Uo,t=((t=this.index[t])<<ko)+(e&Ro),this.data[t];if(e<=1114111)return this.data[this.highValueIndex]}return this.errorValue},e}(),Ho="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Go="undefined"==typeof Uint8Array?[]:new Uint8Array(256),$o=0;$o<Ho.length;$o++)Go[Ho.charCodeAt($o)]=$o;var Zo,qo=1,Ko=2,Wo=3,Xo=4,Yo=5,Jo=7,es=8,ts=9,is=10,rs=11,ns=12,os=13,ss=14,as=15,ls=function(e){for(var t=[],i=0,r=e.length;i<r;){var n=e.charCodeAt(i++);if(n>=55296&&n<=56319&&i<r){var o=e.charCodeAt(i++);56320==(64512&o)?t.push(((1023&n)<<10)+(1023&o)+65536):(t.push(n),i--)}else t.push(n)}return t},cs=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(String.fromCodePoint)return String.fromCodePoint.apply(String,e);var i=e.length;if(!i)return"";for(var r=[],n=-1,o="";++n<i;){var s=e[n];s<=65535?r.push(s):(s-=65536,r.push(55296+(s>>10),s%1024+56320)),(n+1===i||r.length>16384)&&(o+=String.fromCharCode.apply(String,r),r.length=0)}return o},us=jo(Bo),hs="",ds="",ps=function(e){return us.get(e)},fs=function(e,t,i){var r=i-2,n=t[r],o=t[i-1],s=t[i];if(o===Ko&&s===Wo)return hs;if(o===Ko||o===Wo||o===Xo)return ds;if(s===Ko||s===Wo||s===Xo)return ds;if(o===es&&-1!==[es,ts,rs,ns].indexOf(s))return hs;if(!(o!==rs&&o!==ts||s!==ts&&s!==is))return hs;if((o===ns||o===is)&&s===is)return hs;if(s===os||s===Yo)return hs;if(s===Jo)return hs;if(o===qo)return hs;if(o===os&&s===ss){for(;n===Yo;)n=t[--r];if(n===ss)return hs}if(o===as&&s===as){for(var a=0;n===as;)a++,n=t[--r];if(a%2==0)return hs}return ds},As=function(e){var t=ls(e),i=t.length,r=0,n=0,o=t.map(ps);return{next:function(){if(r>=i)return{done:!0,value:null};for(var e=hs;r<i&&(e=fs(t,o,++r))===hs;);if(e!==hs||r===i){var s=cs.apply(null,t.slice(n,r));return n=r,{value:s,done:!1}}return{done:!0,value:null}}}},ms=function(e){for(var t,i=As(e),r=[];!(t=i.next()).done;)t.value&&r.push(t.value.slice());return r},gs=function(e){var t=123;if(e.createRange){var i=e.createRange();if(i.getBoundingClientRect){var r=e.createElement("boundtest");r.style.height=t+"px",r.style.display="block",e.body.appendChild(r),i.selectNode(r);var n=i.getBoundingClientRect(),o=Math.round(n.height);if(e.body.removeChild(r),o===t)return!0}}return!1},_s=function(e){var t=e.createElement("boundtest");t.style.width="50px",t.style.display="block",t.style.fontSize="12px",t.style.letterSpacing="0px",t.style.wordSpacing="0px",e.body.appendChild(t);var i=e.createRange();t.innerHTML="function"==typeof"".repeat?"&#128104;".repeat(10):"";var r=t.firstChild,n=c(r.data).map((function(e){return u(e)})),o=0,s={},a=n.every((function(e,t){i.setStart(r,o),i.setEnd(r,o+e.length);var n=i.getBoundingClientRect();o+=e.length;var a=n.x>s.x||n.y>s.y;return s=n,0===t||a}));return e.body.removeChild(t),a},ys=function(){return void 0!==(new Image).crossOrigin},vs=function(){return"string"==typeof(new XMLHttpRequest).responseType},xs=function(e){var t=new Image,i=e.createElement("canvas"),r=i.getContext("2d");if(!r)return!1;t.src="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg'></svg>";try{r.drawImage(t,0,0),i.toDataURL()}catch(e){return!1}return!0},bs=function(e){return 0===e[0]&&255===e[1]&&0===e[2]&&255===e[3]},ws=function(e){var t=e.createElement("canvas"),i=100;t.width=i,t.height=i;var r=t.getContext("2d");if(!r)return Promise.reject(!1);r.fillStyle="rgb(0, 255, 0)",r.fillRect(0,0,i,i);var n=new Image,o=t.toDataURL();n.src=o;var s=Ts(i,i,0,0,n);return r.fillStyle="red",r.fillRect(0,0,i,i),Bs(s).then((function(t){r.drawImage(t,0,0);var n=r.getImageData(0,0,i,i).data;r.fillStyle="red",r.fillRect(0,0,i,i);var s=e.createElement("div");return s.style.backgroundImage="url("+o+")",s.style.height=i+"px",bs(n)?Bs(Ts(i,i,0,0,s)):Promise.reject(!1)})).then((function(e){return r.drawImage(e,0,0),bs(r.getImageData(0,0,i,i).data)})).catch((function(){return!1}))},Ts=function(e,t,i,r,n){var o="http://www.w3.org/2000/svg",s=document.createElementNS(o,"svg"),a=document.createElementNS(o,"foreignObject");return s.setAttributeNS(null,"width",e.toString()),s.setAttributeNS(null,"height",t.toString()),a.setAttributeNS(null,"width","100%"),a.setAttributeNS(null,"height","100%"),a.setAttributeNS(null,"x",i.toString()),a.setAttributeNS(null,"y",r.toString()),a.setAttributeNS(null,"externalResourcesRequired","true"),s.appendChild(a),a.appendChild(n),s},Bs=function(e){return new Promise((function(t,i){var r=new Image;r.onload=function(){return t(r)},r.onerror=i,r.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent((new XMLSerializer).serializeToString(e))}))},Cs={get SUPPORT_RANGE_BOUNDS(){var e=gs(document);return Object.defineProperty(Cs,"SUPPORT_RANGE_BOUNDS",{value:e}),e},get SUPPORT_WORD_BREAKING(){var e=Cs.SUPPORT_RANGE_BOUNDS&&_s(document);return Object.defineProperty(Cs,"SUPPORT_WORD_BREAKING",{value:e}),e},get SUPPORT_SVG_DRAWING(){var e=xs(document);return Object.defineProperty(Cs,"SUPPORT_SVG_DRAWING",{value:e}),e},get SUPPORT_FOREIGNOBJECT_DRAWING(){var e="function"==typeof Array.from&&"function"==typeof window.fetch?ws(document):Promise.resolve(!1);return Object.defineProperty(Cs,"SUPPORT_FOREIGNOBJECT_DRAWING",{value:e}),e},get SUPPORT_CORS_IMAGES(){var e=ys();return Object.defineProperty(Cs,"SUPPORT_CORS_IMAGES",{value:e}),e},get SUPPORT_RESPONSE_TYPE(){var e=vs();return Object.defineProperty(Cs,"SUPPORT_RESPONSE_TYPE",{value:e}),e},get SUPPORT_CORS_XHR(){var e="withCredentials"in new XMLHttpRequest;return Object.defineProperty(Cs,"SUPPORT_CORS_XHR",{value:e}),e},get SUPPORT_NATIVE_TEXT_SEGMENTATION(){var e=!("undefined"==typeof Intl||!Intl.Segmenter);return Object.defineProperty(Cs,"SUPPORT_NATIVE_TEXT_SEGMENTATION",{value:e}),e}},Ss=function(){function e(e,t){this.text=e,this.bounds=t}return e}(),Es=function(e,t,i,r){var n=Fs(t,i),o=[],a=0;return n.forEach((function(t){if(i.textDecorationLine.length||t.trim().length>0)if(Cs.SUPPORT_RANGE_BOUNDS){var n=Is(r,a,t.length).getClientRects();if(n.length>1){var l=Ps(t),c=0;l.forEach((function(t){o.push(new Ss(t,s.fromDOMRectList(e,Is(r,c+a,t.length).getClientRects()))),c+=t.length}))}else o.push(new Ss(t,s.fromDOMRectList(e,n)))}else{var u=r.splitText(t.length);o.push(new Ss(t,Ms(e,r))),r=u}else Cs.SUPPORT_RANGE_BOUNDS||(r=r.splitText(t.length));a+=t.length})),o},Ms=function(e,t){var i=t.ownerDocument;if(i){var r=i.createElement("html2canvaswrapper");r.appendChild(t.cloneNode(!0));var n=t.parentNode;if(n){n.replaceChild(r,t);var o=a(e,r);return r.firstChild&&n.replaceChild(r.firstChild,r),o}}return s.EMPTY},Is=function(e,t,i){var r=e.ownerDocument;if(!r)throw new Error("Node has no owner document");var n=r.createRange();return n.setStart(e,t),n.setEnd(e,t+i),n},Ps=function(e){if(Cs.SUPPORT_NATIVE_TEXT_SEGMENTATION){var t=new Intl.Segmenter(void 0,{granularity:"grapheme"});return Array.from(t.segment(e)).map((function(e){return e.segment}))}return ms(e)},Ls=function(e,t){if(Cs.SUPPORT_NATIVE_TEXT_SEGMENTATION){var i=new Intl.Segmenter(void 0,{granularity:"word"});return Array.from(i.segment(e)).map((function(e){return e.segment}))}return zs(e,t)},Fs=function(e,t){return 0!==t.letterSpacing?Ps(e):Ls(e,t)},ks=[32,160,4961,65792,65793,4153,4241],zs=function(e,t){for(var i,r=je(e,{lineBreak:t.lineBreak,wordBreak:"break-word"===t.overflowWrap?"break-word":t.wordBreak}),n=[],o=function(){if(i.value){var e=i.value.slice(),t=c(e),r="";t.forEach((function(e){-1===ks.indexOf(e)?r+=u(e):(r.length&&n.push(r),n.push(u(e)),r="")})),r.length&&n.push(r)}};!(i=r.next()).done;)o();return n},Rs=function(){function e(e,t,i){this.text=Ds(t.data,i.textTransform),this.textBounds=Es(e,this.text,i,t)}return e}(),Ds=function(e,t){switch(t){case 1:return e.toLowerCase();case 3:return e.replace(Os,Us);case 2:return e.toUpperCase();default:return e}},Os=/(^|\s|:|-|\(|\))([a-z])/g,Us=function(e,t,i){return e.length>0?t+i.toUpperCase():e},Ns=function(e){function i(t,i){var r=e.call(this,t,i)||this;return r.src=i.currentSrc||i.src,r.intrinsicWidth=i.naturalWidth,r.intrinsicHeight=i.naturalHeight,r.context.cache.addImage(r.src),r}return t(i,e),i}(To),Qs=function(e){function i(t,i){var r=e.call(this,t,i)||this;return r.canvas=i,r.intrinsicWidth=i.width,r.intrinsicHeight=i.height,r}return t(i,e),i}(To),js=function(e){function i(t,i){var r=e.call(this,t,i)||this,n=new XMLSerializer,o=a(t,i);return i.setAttribute("width",o.width+"px"),i.setAttribute("height",o.height+"px"),r.svg="data:image/svg+xml,"+encodeURIComponent(n.serializeToString(i)),r.intrinsicWidth=i.width.baseVal.value,r.intrinsicHeight=i.height.baseVal.value,r.context.cache.addImage(r.svg),r}return t(i,e),i}(To),Vs=function(e){function i(t,i){var r=e.call(this,t,i)||this;return r.value=i.value,r}return t(i,e),i}(To),Hs=function(e){function i(t,i){var r=e.call(this,t,i)||this;return r.start=i.start,r.reversed="boolean"==typeof i.reversed&&!0===i.reversed,r}return t(i,e),i}(To),Gs=[{type:15,flags:0,unit:"px",number:3}],$s=[{type:16,flags:0,number:50}],Zs=function(e){return e.width>e.height?new s(e.left+(e.width-e.height)/2,e.top,e.height,e.height):e.width<e.height?new s(e.left,e.top+(e.height-e.width)/2,e.width,e.width):e},qs=function(e){var t=e.type===Xs?new Array(e.value.length+1).join(""):e.value;return 0===t.length?e.placeholder||"":t},Ks="checkbox",Ws="radio",Xs="password",Ys=707406591,Js=function(e){function i(t,i){var r=e.call(this,t,i)||this;switch(r.type=i.type.toLowerCase(),r.checked=i.checked,r.value=qs(i),r.type!==Ks&&r.type!==Ws||(r.styles.backgroundColor=3739148031,r.styles.borderTopColor=r.styles.borderRightColor=r.styles.borderBottomColor=r.styles.borderLeftColor=2779096575,r.styles.borderTopWidth=r.styles.borderRightWidth=r.styles.borderBottomWidth=r.styles.borderLeftWidth=1,r.styles.borderTopStyle=r.styles.borderRightStyle=r.styles.borderBottomStyle=r.styles.borderLeftStyle=1,r.styles.backgroundClip=[0],r.styles.backgroundOrigin=[0],r.bounds=Zs(r.bounds)),r.type){case Ks:r.styles.borderTopRightRadius=r.styles.borderTopLeftRadius=r.styles.borderBottomRightRadius=r.styles.borderBottomLeftRadius=Gs;break;case Ws:r.styles.borderTopRightRadius=r.styles.borderTopLeftRadius=r.styles.borderBottomRightRadius=r.styles.borderBottomLeftRadius=$s}return r}return t(i,e),i}(To),ea=function(e){function i(t,i){var r=e.call(this,t,i)||this,n=i.options[i.selectedIndex||0];return r.value=n&&n.text||"",r}return t(i,e),i}(To),ta=function(e){function i(t,i){var r=e.call(this,t,i)||this;return r.value=i.value,r}return t(i,e),i}(To),ia=function(e){function i(t,i){var r=e.call(this,t,i)||this;r.src=i.src,r.width=parseInt(i.width,10)||0,r.height=parseInt(i.height,10)||0,r.backgroundColor=r.styles.backgroundColor;try{if(i.contentWindow&&i.contentWindow.document&&i.contentWindow.document.documentElement){r.tree=sa(t,i.contentWindow.document.documentElement);var n=i.contentWindow.document.documentElement?ur(t,getComputedStyle(i.contentWindow.document.documentElement).backgroundColor):hr.TRANSPARENT,o=i.contentWindow.document.body?ur(t,getComputedStyle(i.contentWindow.document.body).backgroundColor):hr.TRANSPARENT;r.backgroundColor=ir(n)?ir(o)?r.styles.backgroundColor:o:n}}catch(e){}return r}return t(i,e),i}(To),ra=["OL","UL","MENU"],na=function(e,t,i,r){for(var n=t.firstChild,o=void 0;n;n=o)if(o=n.nextSibling,ca(n)&&n.data.trim().length>0)i.textNodes.push(new Rs(e,n,i.styles));else if(ua(n))if(Sa(n)&&n.assignedNodes)n.assignedNodes().forEach((function(t){return na(e,t,i,r)}));else{var s=oa(e,n);s.styles.isVisible()&&(aa(n,s,r)?s.flags|=4:la(s.styles)&&(s.flags|=2),-1!==ra.indexOf(n.tagName)&&(s.flags|=8),i.elements.push(s),n.slot,n.shadowRoot?na(e,n.shadowRoot,s,r):Ba(n)||ga(n)||Ca(n)||na(e,n,s,r))}},oa=function(e,t){return xa(t)?new Ns(e,t):ya(t)?new Qs(e,t):ga(t)?new js(e,t):pa(t)?new Vs(e,t):fa(t)?new Hs(e,t):Aa(t)?new Js(e,t):Ca(t)?new ea(e,t):Ba(t)?new ta(e,t):ba(t)?new ia(e,t):new To(e,t)},sa=function(e,t){var i=oa(e,t);return i.flags|=4,na(e,t,i,i),i},aa=function(e,t,i){return t.styles.isPositionedWithZIndex()||t.styles.opacity<1||t.styles.isTransformed()||_a(e)&&i.styles.isTransparent()},la=function(e){return e.isPositioned()||e.isFloating()},ca=function(e){return e.nodeType===Node.TEXT_NODE},ua=function(e){return e.nodeType===Node.ELEMENT_NODE},ha=function(e){return ua(e)&&void 0!==e.style&&!da(e)},da=function(e){return"object"==typeof e.className},pa=function(e){return"LI"===e.tagName},fa=function(e){return"OL"===e.tagName},Aa=function(e){return"INPUT"===e.tagName},ma=function(e){return"HTML"===e.tagName},ga=function(e){return"svg"===e.tagName},_a=function(e){return"BODY"===e.tagName},ya=function(e){return"CANVAS"===e.tagName},va=function(e){return"VIDEO"===e.tagName},xa=function(e){return"IMG"===e.tagName},ba=function(e){return"IFRAME"===e.tagName},wa=function(e){return"STYLE"===e.tagName},Ta=function(e){return"SCRIPT"===e.tagName},Ba=function(e){return"TEXTAREA"===e.tagName},Ca=function(e){return"SELECT"===e.tagName},Sa=function(e){return"SLOT"===e.tagName},Ea=function(e){return e.tagName.indexOf("-")>0},Ma=function(){function e(){this.counters={}}return e.prototype.getCounterValue=function(e){var t=this.counters[e];return t&&t.length?t[t.length-1]:1},e.prototype.getCounterValues=function(e){var t=this.counters[e];return t||[]},e.prototype.pop=function(e){var t=this;e.forEach((function(e){return t.counters[e].pop()}))},e.prototype.parse=function(e){var t=this,i=e.counterIncrement,r=e.counterReset,n=!0;null!==i&&i.forEach((function(e){var i=t.counters[e.counter];i&&0!==e.increment&&(n=!1,i.length||i.push(1),i[Math.max(0,i.length-1)]+=e.increment)}));var o=[];return n&&r.forEach((function(e){var i=t.counters[e.counter];o.push(e.counter),i||(i=t.counters[e.counter]=[]),i.push(e.reset)})),o},e}(),Ia={integers:[1e3,900,500,400,100,90,50,40,10,9,5,4,1],values:["M","CM","D","CD","C","XC","L","XL","X","IX","V","IV","I"]},Pa={integers:[9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,900,800,700,600,500,400,300,200,100,90,80,70,60,50,40,30,20,10,9,8,7,6,5,4,3,2,1],values:["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]},La={integers:[1e4,9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,400,300,200,100,90,80,70,60,50,40,30,20,19,18,17,16,15,10,9,8,7,6,5,4,3,2,1],values:["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]},Fa={integers:[1e4,9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,900,800,700,600,500,400,300,200,100,90,80,70,60,50,40,30,20,10,9,8,7,6,5,4,3,2,1],values:["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]},ka=function(e,t,i,r,n,o){return e<t||e>i?Za(e,n,o.length>0):r.integers.reduce((function(t,i,n){for(;e>=i;)e-=i,t+=r.values[n];return t}),"")+o},za=function(e,t,i,r){var n="";do{i||e--,n=r(e)+n,e/=t}while(e*t>=t);return n},Ra=function(e,t,i,r,n){var o=i-t+1;return(e<0?"-":"")+(za(Math.abs(e),o,r,(function(e){return u(Math.floor(e%o)+t)}))+n)},Da=function(e,t,i){void 0===i&&(i=". ");var r=t.length;return za(Math.abs(e),r,!1,(function(e){return t[Math.floor(e%r)]}))+i},Oa=1,Ua=2,Na=4,Qa=8,ja=function(e,t,i,r,n,o){if(e<-9999||e>9999)return Za(e,4,n.length>0);var s=Math.abs(e),a=n;if(0===s)return t[0]+a;for(var l=0;s>0&&l<=4;l++){var c=s%10;0===c&&oo(o,Oa)&&""!==a?a=t[c]+a:c>1||1===c&&0===l||1===c&&1===l&&oo(o,Ua)||1===c&&1===l&&oo(o,Na)&&e>100||1===c&&l>1&&oo(o,Qa)?a=t[c]+(l>0?i[l-1]:"")+a:1===c&&l>0&&(a=i[l-1]+a),s=Math.floor(s/10)}return(e<0?r:"")+a},Va="",Ha="",Ga="",$a="",Za=function(e,t,i){var r=i?". ":"",n=i?"":"",o=i?", ":"",s=i?" ":"";switch(t){case 0:return""+s;case 1:return""+s;case 2:return""+s;case 5:var a=Ra(e,48,57,!0,r);return a.length<4?"0"+a:a;case 4:return Da(e,"",n);case 6:return ka(e,1,3999,Ia,3,r).toLowerCase();case 7:return ka(e,1,3999,Ia,3,r);case 8:return Ra(e,945,969,!1,r);case 9:return Ra(e,97,122,!1,r);case 10:return Ra(e,65,90,!1,r);case 11:return Ra(e,1632,1641,!0,r);case 12:case 49:return ka(e,1,9999,Pa,3,r);case 35:return ka(e,1,9999,Pa,3,r).toLowerCase();case 13:return Ra(e,2534,2543,!0,r);case 14:case 30:return Ra(e,6112,6121,!0,r);case 15:return Da(e,"",n);case 16:return Da(e,"",n);case 17:case 48:return ja(e,"",Va,"",n,Ua|Na|Qa);case 47:return ja(e,"",Ha,"",n,Oa|Ua|Na|Qa);case 42:return ja(e,"",Va,"",n,Ua|Na|Qa);case 41:return ja(e,"",Ha,"",n,Oa|Ua|Na|Qa);case 26:return ja(e,"","",Ga,n,0);case 25:return ja(e,"","",Ga,n,Oa|Ua|Na);case 31:return ja(e,"","",$a,o,Oa|Ua|Na);case 33:return ja(e,"","",$a,o,0);case 32:return ja(e,"","",$a,o,Oa|Ua|Na);case 18:return Ra(e,2406,2415,!0,r);case 20:return ka(e,1,19999,Fa,3,r);case 21:return Ra(e,2790,2799,!0,r);case 22:return Ra(e,2662,2671,!0,r);case 22:return ka(e,1,10999,La,3,r);case 23:return Da(e,"");case 24:return Da(e,"");case 27:return Ra(e,3302,3311,!0,r);case 28:return Da(e,"",n);case 29:return Da(e,"",n);case 34:return Ra(e,3792,3801,!0,r);case 37:return Ra(e,6160,6169,!0,r);case 38:return Ra(e,4160,4169,!0,r);case 39:return Ra(e,2918,2927,!0,r);case 40:return Ra(e,1776,1785,!0,r);case 43:return Ra(e,3046,3055,!0,r);case 44:return Ra(e,3174,3183,!0,r);case 45:return Ra(e,3664,3673,!0,r);case 46:return Ra(e,3872,3881,!0,r);default:return Ra(e,48,57,!0,r)}},qa="data-html2canvas-ignore",Ka=function(){function e(e,t,i){if(this.context=e,this.options=i,this.scrolledElements=[],this.referenceElement=t,this.counters=new Ma,this.quoteDepth=0,!t.ownerDocument)throw new Error("Cloned element does not have an owner document");this.documentElement=this.cloneNode(t.ownerDocument.documentElement,!1)}return e.prototype.toIFrame=function(e,t){var i=this,o=Xa(e,t);if(!o.contentWindow)return Promise.reject("Unable to find iframe window");var s=e.defaultView.pageXOffset,a=e.defaultView.pageYOffset,l=o.contentWindow,c=l.document,u=el(o).then((function(){return r(i,void 0,void 0,(function(){var e,i;return n(this,(function(r){switch(r.label){case 0:return this.scrolledElements.forEach(ol),l&&(l.scrollTo(t.left,t.top),!/(iPad|iPhone|iPod)/g.test(navigator.userAgent)||l.scrollY===t.top&&l.scrollX===t.left||(this.context.logger.warn("Unable to restore scroll position for cloned document"),this.context.windowBounds=this.context.windowBounds.add(l.scrollX-t.left,l.scrollY-t.top,0,0))),e=this.options.onclone,void 0===(i=this.clonedReferenceElement)?[2,Promise.reject("Error finding the "+this.referenceElement.nodeName+" in the cloned document")]:c.fonts&&c.fonts.ready?[4,c.fonts.ready]:[3,2];case 1:r.sent(),r.label=2;case 2:return/(AppleWebKit)/g.test(navigator.userAgent)?[4,Ja(c)]:[3,4];case 3:r.sent(),r.label=4;case 4:return"function"==typeof e?[2,Promise.resolve().then((function(){return e(c,i)})).then((function(){return o}))]:[2,o]}}))}))}));return c.open(),c.write(rl(document.doctype)+"<html></html>"),nl(this.referenceElement.ownerDocument,s,a),c.replaceChild(c.adoptNode(this.documentElement),c.documentElement),c.close(),u},e.prototype.createElementClone=function(e){if(wo(e,2),ya(e))return this.createCanvasClone(e);if(va(e))return this.createVideoClone(e);if(wa(e))return this.createStyleClone(e);var t=e.cloneNode(!1);return xa(t)&&(xa(e)&&e.currentSrc&&e.currentSrc!==e.src&&(t.src=e.currentSrc,t.srcset=""),"lazy"===t.loading&&(t.loading="eager")),Ea(t)?this.createCustomElementClone(t):t},e.prototype.createCustomElementClone=function(e){var t=document.createElement("html2canvascustomelement");return il(e.style,t),t},e.prototype.createStyleClone=function(e){try{var t=e.sheet;if(t&&t.cssRules){var i=[].slice.call(t.cssRules,0).reduce((function(e,t){return t&&"string"==typeof t.cssText?e+t.cssText:e}),""),r=e.cloneNode(!1);return r.textContent=i,r}}catch(e){if(this.context.logger.error("Unable to access cssRules property",e),"SecurityError"!==e.name)throw e}return e.cloneNode(!1)},e.prototype.createCanvasClone=function(e){var t;if(this.options.inlineImages&&e.ownerDocument){var i=e.ownerDocument.createElement("img");try{return i.src=e.toDataURL(),i}catch(t){this.context.logger.info("Unable to inline canvas contents, canvas is tainted",e)}}var r=e.cloneNode(!1);try{r.width=e.width,r.height=e.height;var n=e.getContext("2d"),o=r.getContext("2d");if(o)if(!this.options.allowTaint&&n)o.putImageData(n.getImageData(0,0,e.width,e.height),0,0);else{var s=null!==(t=e.getContext("webgl2"))&&void 0!==t?t:e.getContext("webgl");if(s){var a=s.getContextAttributes();!1===(null==a?void 0:a.preserveDrawingBuffer)&&this.context.logger.warn("Unable to clone WebGL context as it has preserveDrawingBuffer=false",e)}o.drawImage(e,0,0)}return r}catch(t){this.context.logger.info("Unable to clone canvas as it is tainted",e)}return r},e.prototype.createVideoClone=function(e){var t=e.ownerDocument.createElement("canvas");t.width=e.offsetWidth,t.height=e.offsetHeight;var i=t.getContext("2d");try{return i&&(i.drawImage(e,0,0,t.width,t.height),this.options.allowTaint||i.getImageData(0,0,t.width,t.height)),t}catch(t){this.context.logger.info("Unable to clone video as it is tainted",e)}var r=e.ownerDocument.createElement("canvas");return r.width=e.offsetWidth,r.height=e.offsetHeight,r},e.prototype.appendChildNode=function(e,t,i){ua(t)&&(Ta(t)||t.hasAttribute(qa)||"function"==typeof this.options.ignoreElements&&this.options.ignoreElements(t))||this.options.copyStyles&&ua(t)&&wa(t)||e.appendChild(this.cloneNode(t,i))},e.prototype.cloneChildNodes=function(e,t,i){for(var r=this,n=e.shadowRoot?e.shadowRoot.firstChild:e.firstChild;n;n=n.nextSibling)if(ua(n)&&Sa(n)&&"function"==typeof n.assignedNodes){var o=n.assignedNodes();o.length&&o.forEach((function(e){return r.appendChildNode(t,e,i)}))}else this.appendChildNode(t,n,i)},e.prototype.cloneNode=function(e,t){if(ca(e))return document.createTextNode(e.data);if(!e.ownerDocument)return e.cloneNode(!1);var i=e.ownerDocument.defaultView;if(i&&ua(e)&&(ha(e)||da(e))){var r=this.createElementClone(e);r.style.transitionProperty="none";var n=i.getComputedStyle(e),o=i.getComputedStyle(e,":before"),s=i.getComputedStyle(e,":after");this.referenceElement===e&&ha(r)&&(this.clonedReferenceElement=r),_a(r)&&hl(r);var a=this.counters.parse(new yo(this.context,n)),l=this.resolvePseudoContent(e,r,o,Zo.BEFORE);Ea(e)&&(t=!0),va(e)||this.cloneChildNodes(e,r,t),l&&r.insertBefore(l,r.firstChild);var c=this.resolvePseudoContent(e,r,s,Zo.AFTER);return c&&r.appendChild(c),this.counters.pop(a),(n&&(this.options.copyStyles||da(e))&&!ba(e)||t)&&il(n,r),0===e.scrollTop&&0===e.scrollLeft||this.scrolledElements.push([r,e.scrollLeft,e.scrollTop]),(Ba(e)||Ca(e))&&(Ba(r)||Ca(r))&&(r.value=e.value),r}return e.cloneNode(!1)},e.prototype.resolvePseudoContent=function(e,t,i,r){var n=this;if(i){var o=i.content,s=t.ownerDocument;if(s&&o&&"none"!==o&&"-moz-alt-content"!==o&&"none"!==i.display){this.counters.parse(new yo(this.context,i));var a=new _o(this.context,i),l=s.createElement("html2canvaspseudoelement");il(i,l),a.content.forEach((function(t){if(0===t.type)l.appendChild(s.createTextNode(t.value));else if(22===t.type){var i=s.createElement("img");i.src=t.value,i.style.opacity="1",l.appendChild(i)}else if(18===t.type){if("attr"===t.name){var r=t.values.filter(Li);r.length&&l.appendChild(s.createTextNode(e.getAttribute(r[0].value)||""))}else if("counter"===t.name){var o=t.values.filter(Ri),c=o[0],u=o[1];if(c&&Li(c)){var h=n.counters.getCounterValue(c.value),d=u&&Li(u)?Bn.parse(n.context,u.value):3;l.appendChild(s.createTextNode(Za(h,d,!1)))}}else if("counters"===t.name){var p=t.values.filter(Ri),f=(c=p[0],p[1]);if(u=p[2],c&&Li(c)){var A=n.counters.getCounterValues(c.value),m=u&&Li(u)?Bn.parse(n.context,u.value):3,g=f&&0===f.type?f.value:"",_=A.map((function(e){return Za(e,m,!1)})).join(g);l.appendChild(s.createTextNode(_))}}}else if(20===t.type)switch(t.value){case"open-quote":l.appendChild(s.createTextNode(ho(a.quotes,n.quoteDepth++,!0)));break;case"close-quote":l.appendChild(s.createTextNode(ho(a.quotes,--n.quoteDepth,!1)));break;default:l.appendChild(s.createTextNode(t.value))}})),l.className=ll+" "+cl;var c=r===Zo.BEFORE?" "+ll:" "+cl;return da(t)?t.className.baseValue+=c:t.className+=c,l}}},e.destroy=function(e){return!!e.parentNode&&(e.parentNode.removeChild(e),!0)},e}();!function(e){e[e.BEFORE=0]="BEFORE",e[e.AFTER=1]="AFTER"}(Zo||(Zo={}));var Wa,Xa=function(e,t){var i=e.createElement("iframe");return i.className="html2canvas-container",i.style.visibility="hidden",i.style.position="fixed",i.style.left="-10000px",i.style.top="0px",i.style.border="0",i.width=t.width.toString(),i.height=t.height.toString(),i.scrolling="no",i.setAttribute(qa,"true"),e.body.appendChild(i),i},Ya=function(e){return new Promise((function(t){e.complete?t():e.src?(e.onload=t,e.onerror=t):t()}))},Ja=function(e){return Promise.all([].slice.call(e.images,0).map(Ya))},el=function(e){return new Promise((function(t,i){var r=e.contentWindow;if(!r)return i("No window assigned for iframe");var n=r.document;r.onload=e.onload=function(){r.onload=e.onload=null;var i=setInterval((function(){n.body.childNodes.length>0&&"complete"===n.readyState&&(clearInterval(i),t(e))}),50)}}))},tl=["all","d","content"],il=function(e,t){for(var i=e.length-1;i>=0;i--){var r=e.item(i);-1===tl.indexOf(r)&&t.style.setProperty(r,e.getPropertyValue(r))}return t},rl=function(e){var t="";return e&&(t+="<!DOCTYPE ",e.name&&(t+=e.name),e.internalSubset&&(t+=e.internalSubset),e.publicId&&(t+='"'+e.publicId+'"'),e.systemId&&(t+='"'+e.systemId+'"'),t+=">"),t},nl=function(e,t,i){e&&e.defaultView&&(t!==e.defaultView.pageXOffset||i!==e.defaultView.pageYOffset)&&e.defaultView.scrollTo(t,i)},ol=function(e){var t=e[0],i=e[1],r=e[2];t.scrollLeft=i,t.scrollTop=r},sl=":before",al=":after",ll="___html2canvas___pseudoelement_before",cl="___html2canvas___pseudoelement_after",ul='{\n    content: "" !important;\n    display: none !important;\n}',hl=function(e){dl(e,"."+ll+sl+ul+"\n         ."+cl+al+ul)},dl=function(e,t){var i=e.ownerDocument;if(i){var r=i.createElement("style");r.textContent=t,e.appendChild(r)}},pl=function(){function e(){}return e.getOrigin=function(t){var i=e._link;return i?(i.href=t,i.href=i.href,i.protocol+i.hostname+i.port):"about:blank"},e.isSameOrigin=function(t){return e.getOrigin(t)===e._origin},e.setContext=function(t){e._link=t.document.createElement("a"),e._origin=e.getOrigin(t.location.href)},e._origin="about:blank",e}(),fl=function(){function e(e,t){this.context=e,this._options=t,this._cache={}}return e.prototype.addImage=function(e){var t=Promise.resolve();return this.has(e)?t:xl(e)||_l(e)?((this._cache[e]=this.loadImage(e)).catch((function(){})),t):t},e.prototype.match=function(e){return this._cache[e]},e.prototype.loadImage=function(e){return r(this,void 0,void 0,(function(){var t,i,r,o,s=this;return n(this,(function(n){switch(n.label){case 0:return t=pl.isSameOrigin(e),i=!yl(e)&&!0===this._options.useCORS&&Cs.SUPPORT_CORS_IMAGES&&!t,r=!yl(e)&&!t&&!xl(e)&&"string"==typeof this._options.proxy&&Cs.SUPPORT_CORS_XHR&&!i,t||!1!==this._options.allowTaint||yl(e)||xl(e)||r||i?(o=e,r?[4,this.proxy(o)]:[3,2]):[2];case 1:o=n.sent(),n.label=2;case 2:return this.context.logger.debug("Added image "+e.substring(0,256)),[4,new Promise((function(e,t){var r=new Image;r.onload=function(){return e(r)},r.onerror=t,(vl(o)||i)&&(r.crossOrigin="anonymous"),r.src=o,!0===r.complete&&setTimeout((function(){return e(r)}),500),s._options.imageTimeout>0&&setTimeout((function(){return t("Timed out ("+s._options.imageTimeout+"ms) loading image")}),s._options.imageTimeout)}))];case 3:return[2,n.sent()]}}))}))},e.prototype.has=function(e){return void 0!==this._cache[e]},e.prototype.keys=function(){return Promise.resolve(Object.keys(this._cache))},e.prototype.proxy=function(e){var t=this,i=this._options.proxy;if(!i)throw new Error("No proxy defined");var r=e.substring(0,256);return new Promise((function(n,o){var s=Cs.SUPPORT_RESPONSE_TYPE?"blob":"text",a=new XMLHttpRequest;a.onload=function(){if(200===a.status)if("text"===s)n(a.response);else{var e=new FileReader;e.addEventListener("load",(function(){return n(e.result)}),!1),e.addEventListener("error",(function(e){return o(e)}),!1),e.readAsDataURL(a.response)}else o("Failed to proxy resource "+r+" with status code "+a.status)},a.onerror=o;var l=i.indexOf("?")>-1?"&":"?";if(a.open("GET",""+i+l+"url="+encodeURIComponent(e)+"&responseType="+s),"text"!==s&&a instanceof XMLHttpRequest&&(a.responseType=s),t._options.imageTimeout){var c=t._options.imageTimeout;a.timeout=c,a.ontimeout=function(){return o("Timed out ("+c+"ms) proxying "+r)}}a.send()}))},e}(),Al=/^data:image\/svg\+xml/i,ml=/^data:image\/.*;base64,/i,gl=/^data:image\/.*/i,_l=function(e){return Cs.SUPPORT_SVG_DRAWING||!bl(e)},yl=function(e){return gl.test(e)},vl=function(e){return ml.test(e)},xl=function(e){return"blob"===e.substr(0,4)},bl=function(e){return"svg"===e.substr(-3).toLowerCase()||Al.test(e)},wl=function(){function e(e,t){this.type=0,this.x=e,this.y=t}return e.prototype.add=function(t,i){return new e(this.x+t,this.y+i)},e}(),Tl=function(e,t,i){return new wl(e.x+(t.x-e.x)*i,e.y+(t.y-e.y)*i)},Bl=function(){function e(e,t,i,r){this.type=1,this.start=e,this.startControl=t,this.endControl=i,this.end=r}return e.prototype.subdivide=function(t,i){var r=Tl(this.start,this.startControl,t),n=Tl(this.startControl,this.endControl,t),o=Tl(this.endControl,this.end,t),s=Tl(r,n,t),a=Tl(n,o,t),l=Tl(s,a,t);return i?new e(this.start,r,s,l):new e(l,a,o,this.end)},e.prototype.add=function(t,i){return new e(this.start.add(t,i),this.startControl.add(t,i),this.endControl.add(t,i),this.end.add(t,i))},e.prototype.reverse=function(){return new e(this.end,this.endControl,this.startControl,this.start)},e}(),Cl=function(e){return 1===e.type},Sl=function(){function e(e){var t=e.styles,i=e.bounds,r=Gi(t.borderTopLeftRadius,i.width,i.height),n=r[0],o=r[1],s=Gi(t.borderTopRightRadius,i.width,i.height),a=s[0],l=s[1],c=Gi(t.borderBottomRightRadius,i.width,i.height),u=c[0],h=c[1],d=Gi(t.borderBottomLeftRadius,i.width,i.height),p=d[0],f=d[1],A=[];A.push((n+a)/i.width),A.push((p+u)/i.width),A.push((o+f)/i.height),A.push((l+h)/i.height);var m=Math.max.apply(Math,A);m>1&&(n/=m,o/=m,a/=m,l/=m,u/=m,h/=m,p/=m,f/=m);var g=i.width-a,_=i.height-h,y=i.width-u,v=i.height-f,x=t.borderTopWidth,b=t.borderRightWidth,w=t.borderBottomWidth,T=t.borderLeftWidth,B=$i(t.paddingTop,e.bounds.width),C=$i(t.paddingRight,e.bounds.width),S=$i(t.paddingBottom,e.bounds.width),E=$i(t.paddingLeft,e.bounds.width);this.topLeftBorderDoubleOuterBox=n>0||o>0?El(i.left+T/3,i.top+x/3,n-T/3,o-x/3,Wa.TOP_LEFT):new wl(i.left+T/3,i.top+x/3),this.topRightBorderDoubleOuterBox=n>0||o>0?El(i.left+g,i.top+x/3,a-b/3,l-x/3,Wa.TOP_RIGHT):new wl(i.left+i.width-b/3,i.top+x/3),this.bottomRightBorderDoubleOuterBox=u>0||h>0?El(i.left+y,i.top+_,u-b/3,h-w/3,Wa.BOTTOM_RIGHT):new wl(i.left+i.width-b/3,i.top+i.height-w/3),this.bottomLeftBorderDoubleOuterBox=p>0||f>0?El(i.left+T/3,i.top+v,p-T/3,f-w/3,Wa.BOTTOM_LEFT):new wl(i.left+T/3,i.top+i.height-w/3),this.topLeftBorderDoubleInnerBox=n>0||o>0?El(i.left+2*T/3,i.top+2*x/3,n-2*T/3,o-2*x/3,Wa.TOP_LEFT):new wl(i.left+2*T/3,i.top+2*x/3),this.topRightBorderDoubleInnerBox=n>0||o>0?El(i.left+g,i.top+2*x/3,a-2*b/3,l-2*x/3,Wa.TOP_RIGHT):new wl(i.left+i.width-2*b/3,i.top+2*x/3),this.bottomRightBorderDoubleInnerBox=u>0||h>0?El(i.left+y,i.top+_,u-2*b/3,h-2*w/3,Wa.BOTTOM_RIGHT):new wl(i.left+i.width-2*b/3,i.top+i.height-2*w/3),this.bottomLeftBorderDoubleInnerBox=p>0||f>0?El(i.left+2*T/3,i.top+v,p-2*T/3,f-2*w/3,Wa.BOTTOM_LEFT):new wl(i.left+2*T/3,i.top+i.height-2*w/3),this.topLeftBorderStroke=n>0||o>0?El(i.left+T/2,i.top+x/2,n-T/2,o-x/2,Wa.TOP_LEFT):new wl(i.left+T/2,i.top+x/2),this.topRightBorderStroke=n>0||o>0?El(i.left+g,i.top+x/2,a-b/2,l-x/2,Wa.TOP_RIGHT):new wl(i.left+i.width-b/2,i.top+x/2),this.bottomRightBorderStroke=u>0||h>0?El(i.left+y,i.top+_,u-b/2,h-w/2,Wa.BOTTOM_RIGHT):new wl(i.left+i.width-b/2,i.top+i.height-w/2),this.bottomLeftBorderStroke=p>0||f>0?El(i.left+T/2,i.top+v,p-T/2,f-w/2,Wa.BOTTOM_LEFT):new wl(i.left+T/2,i.top+i.height-w/2),this.topLeftBorderBox=n>0||o>0?El(i.left,i.top,n,o,Wa.TOP_LEFT):new wl(i.left,i.top),this.topRightBorderBox=a>0||l>0?El(i.left+g,i.top,a,l,Wa.TOP_RIGHT):new wl(i.left+i.width,i.top),this.bottomRightBorderBox=u>0||h>0?El(i.left+y,i.top+_,u,h,Wa.BOTTOM_RIGHT):new wl(i.left+i.width,i.top+i.height),this.bottomLeftBorderBox=p>0||f>0?El(i.left,i.top+v,p,f,Wa.BOTTOM_LEFT):new wl(i.left,i.top+i.height),this.topLeftPaddingBox=n>0||o>0?El(i.left+T,i.top+x,Math.max(0,n-T),Math.max(0,o-x),Wa.TOP_LEFT):new wl(i.left+T,i.top+x),this.topRightPaddingBox=a>0||l>0?El(i.left+Math.min(g,i.width-b),i.top+x,g>i.width+b?0:Math.max(0,a-b),Math.max(0,l-x),Wa.TOP_RIGHT):new wl(i.left+i.width-b,i.top+x),this.bottomRightPaddingBox=u>0||h>0?El(i.left+Math.min(y,i.width-T),i.top+Math.min(_,i.height-w),Math.max(0,u-b),Math.max(0,h-w),Wa.BOTTOM_RIGHT):new wl(i.left+i.width-b,i.top+i.height-w),this.bottomLeftPaddingBox=p>0||f>0?El(i.left+T,i.top+Math.min(v,i.height-w),Math.max(0,p-T),Math.max(0,f-w),Wa.BOTTOM_LEFT):new wl(i.left+T,i.top+i.height-w),this.topLeftContentBox=n>0||o>0?El(i.left+T+E,i.top+x+B,Math.max(0,n-(T+E)),Math.max(0,o-(x+B)),Wa.TOP_LEFT):new wl(i.left+T+E,i.top+x+B),this.topRightContentBox=a>0||l>0?El(i.left+Math.min(g,i.width+T+E),i.top+x+B,g>i.width+T+E?0:a-T+E,l-(x+B),Wa.TOP_RIGHT):new wl(i.left+i.width-(b+C),i.top+x+B),this.bottomRightContentBox=u>0||h>0?El(i.left+Math.min(y,i.width-(T+E)),i.top+Math.min(_,i.height+x+B),Math.max(0,u-(b+C)),h-(w+S),Wa.BOTTOM_RIGHT):new wl(i.left+i.width-(b+C),i.top+i.height-(w+S)),this.bottomLeftContentBox=p>0||f>0?El(i.left+T+E,i.top+v,Math.max(0,p-(T+E)),f-(w+S),Wa.BOTTOM_LEFT):new wl(i.left+T+E,i.top+i.height-(w+S))}return e}();!function(e){e[e.TOP_LEFT=0]="TOP_LEFT",e[e.TOP_RIGHT=1]="TOP_RIGHT",e[e.BOTTOM_RIGHT=2]="BOTTOM_RIGHT",e[e.BOTTOM_LEFT=3]="BOTTOM_LEFT"}(Wa||(Wa={}));var El=function(e,t,i,r,n){var o=(Math.sqrt(2)-1)/3*4,s=i*o,a=r*o,l=e+i,c=t+r;switch(n){case Wa.TOP_LEFT:return new Bl(new wl(e,c),new wl(e,c-a),new wl(l-s,t),new wl(l,t));case Wa.TOP_RIGHT:return new Bl(new wl(e,t),new wl(e+s,t),new wl(l,c-a),new wl(l,c));case Wa.BOTTOM_RIGHT:return new Bl(new wl(l,t),new wl(l,t+a),new wl(e+s,c),new wl(e,c));case Wa.BOTTOM_LEFT:default:return new Bl(new wl(l,c),new wl(l-s,c),new wl(e,t+a),new wl(e,t))}},Ml=function(e){return[e.topLeftBorderBox,e.topRightBorderBox,e.bottomRightBorderBox,e.bottomLeftBorderBox]},Il=function(e){return[e.topLeftContentBox,e.topRightContentBox,e.bottomRightContentBox,e.bottomLeftContentBox]},Pl=function(e){return[e.topLeftPaddingBox,e.topRightPaddingBox,e.bottomRightPaddingBox,e.bottomLeftPaddingBox]},Ll=function(){function e(e,t,i){this.offsetX=e,this.offsetY=t,this.matrix=i,this.type=0,this.target=6}return e}(),Fl=function(){function e(e,t){this.path=e,this.target=t,this.type=1}return e}(),kl=function(){function e(e){this.opacity=e,this.type=2,this.target=6}return e}(),zl=function(e){return 0===e.type},Rl=function(e){return 1===e.type},Dl=function(e){return 2===e.type},Ol=function(e,t){return e.length===t.length&&e.some((function(e,i){return e===t[i]}))},Ul=function(e,t,i,r,n){return e.map((function(e,o){switch(o){case 0:return e.add(t,i);case 1:return e.add(t+r,i);case 2:return e.add(t+r,i+n);case 3:return e.add(t,i+n)}return e}))},Nl=function(){function e(e){this.element=e,this.inlineLevel=[],this.nonInlineLevel=[],this.negativeZIndex=[],this.zeroOrAutoZIndexOrTransformedOrOpacity=[],this.positiveZIndex=[],this.nonPositionedFloats=[],this.nonPositionedInlineLevel=[]}return e}(),Ql=function(){function e(e,t){if(this.container=e,this.parent=t,this.effects=[],this.curves=new Sl(this.container),this.container.styles.opacity<1&&this.effects.push(new kl(this.container.styles.opacity)),null!==this.container.styles.transform){var i=this.container.bounds.left+this.container.styles.transformOrigin[0].number,r=this.container.bounds.top+this.container.styles.transformOrigin[1].number,n=this.container.styles.transform;this.effects.push(new Ll(i,r,n))}if(0!==this.container.styles.overflowX){var o=Ml(this.curves),s=Pl(this.curves);Ol(o,s)?this.effects.push(new Fl(o,6)):(this.effects.push(new Fl(o,2)),this.effects.push(new Fl(s,4)))}}return e.prototype.getEffects=function(e){for(var t=-1===[2,3].indexOf(this.container.styles.position),i=this.parent,r=this.effects.slice(0);i;){var n=i.effects.filter((function(e){return!Rl(e)}));if(t||0!==i.container.styles.position||!i.parent){if(r.unshift.apply(r,n),t=-1===[2,3].indexOf(i.container.styles.position),0!==i.container.styles.overflowX){var o=Ml(i.curves),s=Pl(i.curves);Ol(o,s)||r.unshift(new Fl(s,6))}}else r.unshift.apply(r,n);i=i.parent}return r.filter((function(t){return oo(t.target,e)}))},e}(),jl=function(e,t,i,r){e.container.elements.forEach((function(n){var o=oo(n.flags,4),s=oo(n.flags,2),a=new Ql(n,e);oo(n.styles.display,2048)&&r.push(a);var l=oo(n.flags,8)?[]:r;if(o||s){var c=o||n.styles.isPositioned()?i:t,u=new Nl(a);if(n.styles.isPositioned()||n.styles.opacity<1||n.styles.isTransformed()){var h=n.styles.zIndex.order;if(h<0){var d=0;c.negativeZIndex.some((function(e,t){return h>e.element.container.styles.zIndex.order?(d=t,!1):d>0})),c.negativeZIndex.splice(d,0,u)}else if(h>0){var p=0;c.positiveZIndex.some((function(e,t){return h>=e.element.container.styles.zIndex.order?(p=t+1,!1):p>0})),c.positiveZIndex.splice(p,0,u)}else c.zeroOrAutoZIndexOrTransformedOrOpacity.push(u)}else n.styles.isFloating()?c.nonPositionedFloats.push(u):c.nonPositionedInlineLevel.push(u);jl(a,u,o?u:i,l)}else n.styles.isInlineLevel()?t.inlineLevel.push(a):t.nonInlineLevel.push(a),jl(a,t,i,l);oo(n.flags,8)&&Vl(n,l)}))},Vl=function(e,t){for(var i=e instanceof Hs?e.start:1,r=e instanceof Hs&&e.reversed,n=0;n<t.length;n++){var o=t[n];o.container instanceof Vs&&"number"==typeof o.container.value&&0!==o.container.value&&(i=o.container.value),o.listValue=Za(i,o.container.styles.listStyleType,!0),i+=r?-1:1}},Hl=function(e){var t=new Ql(e,null),i=new Nl(t),r=[];return jl(t,i,i,r),Vl(t.container,r),i},Gl=function(e,t){switch(t){case 0:return Wl(e.topLeftBorderBox,e.topLeftPaddingBox,e.topRightBorderBox,e.topRightPaddingBox);case 1:return Wl(e.topRightBorderBox,e.topRightPaddingBox,e.bottomRightBorderBox,e.bottomRightPaddingBox);case 2:return Wl(e.bottomRightBorderBox,e.bottomRightPaddingBox,e.bottomLeftBorderBox,e.bottomLeftPaddingBox);default:return Wl(e.bottomLeftBorderBox,e.bottomLeftPaddingBox,e.topLeftBorderBox,e.topLeftPaddingBox)}},$l=function(e,t){switch(t){case 0:return Wl(e.topLeftBorderBox,e.topLeftBorderDoubleOuterBox,e.topRightBorderBox,e.topRightBorderDoubleOuterBox);case 1:return Wl(e.topRightBorderBox,e.topRightBorderDoubleOuterBox,e.bottomRightBorderBox,e.bottomRightBorderDoubleOuterBox);case 2:return Wl(e.bottomRightBorderBox,e.bottomRightBorderDoubleOuterBox,e.bottomLeftBorderBox,e.bottomLeftBorderDoubleOuterBox);default:return Wl(e.bottomLeftBorderBox,e.bottomLeftBorderDoubleOuterBox,e.topLeftBorderBox,e.topLeftBorderDoubleOuterBox)}},Zl=function(e,t){switch(t){case 0:return Wl(e.topLeftBorderDoubleInnerBox,e.topLeftPaddingBox,e.topRightBorderDoubleInnerBox,e.topRightPaddingBox);case 1:return Wl(e.topRightBorderDoubleInnerBox,e.topRightPaddingBox,e.bottomRightBorderDoubleInnerBox,e.bottomRightPaddingBox);case 2:return Wl(e.bottomRightBorderDoubleInnerBox,e.bottomRightPaddingBox,e.bottomLeftBorderDoubleInnerBox,e.bottomLeftPaddingBox);default:return Wl(e.bottomLeftBorderDoubleInnerBox,e.bottomLeftPaddingBox,e.topLeftBorderDoubleInnerBox,e.topLeftPaddingBox)}},ql=function(e,t){switch(t){case 0:return Kl(e.topLeftBorderStroke,e.topRightBorderStroke);case 1:return Kl(e.topRightBorderStroke,e.bottomRightBorderStroke);case 2:return Kl(e.bottomRightBorderStroke,e.bottomLeftBorderStroke);default:return Kl(e.bottomLeftBorderStroke,e.topLeftBorderStroke)}},Kl=function(e,t){var i=[];return Cl(e)?i.push(e.subdivide(.5,!1)):i.push(e),Cl(t)?i.push(t.subdivide(.5,!0)):i.push(t),i},Wl=function(e,t,i,r){var n=[];return Cl(e)?n.push(e.subdivide(.5,!1)):n.push(e),Cl(i)?n.push(i.subdivide(.5,!0)):n.push(i),Cl(r)?n.push(r.subdivide(.5,!0).reverse()):n.push(r),Cl(t)?n.push(t.subdivide(.5,!1).reverse()):n.push(t),n},Xl=function(e){var t=e.bounds,i=e.styles;return t.add(i.borderLeftWidth,i.borderTopWidth,-(i.borderRightWidth+i.borderLeftWidth),-(i.borderTopWidth+i.borderBottomWidth))},Yl=function(e){var t=e.styles,i=e.bounds,r=$i(t.paddingLeft,i.width),n=$i(t.paddingRight,i.width),o=$i(t.paddingTop,i.width),s=$i(t.paddingBottom,i.width);return i.add(r+t.borderLeftWidth,o+t.borderTopWidth,-(t.borderRightWidth+t.borderLeftWidth+r+n),-(t.borderTopWidth+t.borderBottomWidth+o+s))},Jl=function(e,t){return 0===e?t.bounds:2===e?Yl(t):Xl(t)},ec=function(e,t){return 0===e?t.bounds:2===e?Yl(t):Xl(t)},tc=function(e,t,i){var r=Jl(oc(e.styles.backgroundOrigin,t),e),n=ec(oc(e.styles.backgroundClip,t),e),o=nc(oc(e.styles.backgroundSize,t),i,r),s=o[0],a=o[1],l=Gi(oc(e.styles.backgroundPosition,t),r.width-s,r.height-a);return[sc(oc(e.styles.backgroundRepeat,t),l,o,r,n),Math.round(r.left+l[0]),Math.round(r.top+l[1]),s,a]},ic=function(e){return Li(e)&&e.value===Rr.AUTO},rc=function(e){return"number"==typeof e},nc=function(e,t,i){var r=t[0],n=t[1],o=t[2],s=e[0],a=e[1];if(!s)return[0,0];if(Ni(s)&&a&&Ni(a))return[$i(s,i.width),$i(a,i.height)];var l=rc(o);if(Li(s)&&(s.value===Rr.CONTAIN||s.value===Rr.COVER))return rc(o)?i.width/i.height<o!=(s.value===Rr.COVER)?[i.width,i.width/o]:[i.height*o,i.height]:[i.width,i.height];var c=rc(r),u=rc(n),h=c||u;if(ic(s)&&(!a||ic(a)))return c&&u?[r,n]:l||h?h&&l?[c?r:n*o,u?n:r/o]:[c?r:i.width,u?n:i.height]:[i.width,i.height];if(l){var d=0,p=0;return Ni(s)?d=$i(s,i.width):Ni(a)&&(p=$i(a,i.height)),ic(s)?d=p*o:a&&!ic(a)||(p=d/o),[d,p]}var f=null,A=null;if(Ni(s)?f=$i(s,i.width):a&&Ni(a)&&(A=$i(a,i.height)),null===f||a&&!ic(a)||(A=c&&u?f/r*n:i.height),null!==A&&ic(s)&&(f=c&&u?A/n*r:i.width),null!==f&&null!==A)return[f,A];throw new Error("Unable to calculate background-size for element")},oc=function(e,t){var i=e[t];return void 0===i?e[0]:i},sc=function(e,t,i,r,n){var o=t[0],s=t[1],a=i[0],l=i[1];switch(e){case 2:return[new wl(Math.round(r.left),Math.round(r.top+s)),new wl(Math.round(r.left+r.width),Math.round(r.top+s)),new wl(Math.round(r.left+r.width),Math.round(l+r.top+s)),new wl(Math.round(r.left),Math.round(l+r.top+s))];case 3:return[new wl(Math.round(r.left+o),Math.round(r.top)),new wl(Math.round(r.left+o+a),Math.round(r.top)),new wl(Math.round(r.left+o+a),Math.round(r.height+r.top)),new wl(Math.round(r.left+o),Math.round(r.height+r.top))];case 1:return[new wl(Math.round(r.left+o),Math.round(r.top+s)),new wl(Math.round(r.left+o+a),Math.round(r.top+s)),new wl(Math.round(r.left+o+a),Math.round(r.top+s+l)),new wl(Math.round(r.left+o),Math.round(r.top+s+l))];default:return[new wl(Math.round(n.left),Math.round(n.top)),new wl(Math.round(n.left+n.width),Math.round(n.top)),new wl(Math.round(n.left+n.width),Math.round(n.height+n.top)),new wl(Math.round(n.left),Math.round(n.height+n.top))]}},ac="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",lc="Hidden Text",cc=function(){function e(e){this._data={},this._document=e}return e.prototype.parseMetrics=function(e,t){var i=this._document.createElement("div"),r=this._document.createElement("img"),n=this._document.createElement("span"),o=this._document.body;i.style.visibility="hidden",i.style.fontFamily=e,i.style.fontSize=t,i.style.margin="0",i.style.padding="0",i.style.whiteSpace="nowrap",o.appendChild(i),r.src=ac,r.width=1,r.height=1,r.style.margin="0",r.style.padding="0",r.style.verticalAlign="baseline",n.style.fontFamily=e,n.style.fontSize=t,n.style.margin="0",n.style.padding="0",n.appendChild(this._document.createTextNode(lc)),i.appendChild(n),i.appendChild(r);var s=r.offsetTop-n.offsetTop+2;i.removeChild(n),i.appendChild(this._document.createTextNode(lc)),i.style.lineHeight="normal",r.style.verticalAlign="super";var a=r.offsetTop-i.offsetTop+2;return o.removeChild(i),{baseline:s,middle:a}},e.prototype.getMetrics=function(e,t){var i=e+" "+t;return void 0===this._data[i]&&(this._data[i]=this.parseMetrics(e,t)),this._data[i]},e}(),uc=function(){function e(e,t){this.context=e,this.options=t}return e}(),hc=1e4,dc=function(e){function i(t,i){var r=e.call(this,t,i)||this;return r._activeEffects=[],r.canvas=i.canvas?i.canvas:document.createElement("canvas"),r.ctx=r.canvas.getContext("2d"),i.canvas||(r.canvas.width=Math.floor(i.width*i.scale),r.canvas.height=Math.floor(i.height*i.scale),r.canvas.style.width=i.width+"px",r.canvas.style.height=i.height+"px"),r.fontMetrics=new cc(document),r.ctx.scale(r.options.scale,r.options.scale),r.ctx.translate(-i.x,-i.y),r.ctx.textBaseline="bottom",r._activeEffects=[],r.context.logger.debug("Canvas renderer initialized ("+i.width+"x"+i.height+") with scale "+i.scale),r}return t(i,e),i.prototype.applyEffects=function(e){for(var t=this;this._activeEffects.length;)this.popEffect();e.forEach((function(e){return t.applyEffect(e)}))},i.prototype.applyEffect=function(e){this.ctx.save(),Dl(e)&&(this.ctx.globalAlpha=e.opacity),zl(e)&&(this.ctx.translate(e.offsetX,e.offsetY),this.ctx.transform(e.matrix[0],e.matrix[1],e.matrix[2],e.matrix[3],e.matrix[4],e.matrix[5]),this.ctx.translate(-e.offsetX,-e.offsetY)),Rl(e)&&(this.path(e.path),this.ctx.clip()),this._activeEffects.push(e)},i.prototype.popEffect=function(){this._activeEffects.pop(),this.ctx.restore()},i.prototype.renderStack=function(e){return r(this,void 0,void 0,(function(){return n(this,(function(t){switch(t.label){case 0:return e.element.container.styles.isVisible()?[4,this.renderStackContent(e)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))},i.prototype.renderNode=function(e){return r(this,void 0,void 0,(function(){return n(this,(function(t){switch(t.label){case 0:return oo(e.container.flags,16),e.container.styles.isVisible()?[4,this.renderNodeBackgroundAndBorders(e)]:[3,3];case 1:return t.sent(),[4,this.renderNodeContent(e)];case 2:t.sent(),t.label=3;case 3:return[2]}}))}))},i.prototype.renderTextWithLetterSpacing=function(e,t,i){var r=this;0===t?this.ctx.fillText(e.text,e.bounds.left,e.bounds.top+i):Ps(e.text).reduce((function(t,n){return r.ctx.fillText(n,t,e.bounds.top+i),t+r.ctx.measureText(n).width}),e.bounds.left)},i.prototype.createFontStyle=function(e){var t=e.fontVariant.filter((function(e){return"normal"===e||"small-caps"===e})).join(""),i=gc(e.fontFamily).join(", "),r=Ii(e.fontSize)?""+e.fontSize.number+e.fontSize.unit:e.fontSize.number+"px";return[[e.fontStyle,t,e.fontWeight,r,i].join(" "),i,r]},i.prototype.renderTextNode=function(e,t){return r(this,void 0,void 0,(function(){var i,r,o,s,a,l,c,u,h=this;return n(this,(function(n){return i=this.createFontStyle(t),r=i[0],o=i[1],s=i[2],this.ctx.font=r,this.ctx.direction=1===t.direction?"rtl":"ltr",this.ctx.textAlign="left",this.ctx.textBaseline="alphabetic",a=this.fontMetrics.getMetrics(o,s),l=a.baseline,c=a.middle,u=t.paintOrder,e.textBounds.forEach((function(e){u.forEach((function(i){switch(i){case 0:h.ctx.fillStyle=rr(t.color),h.renderTextWithLetterSpacing(e,t.letterSpacing,l);var r=t.textShadow;r.length&&e.text.trim().length&&(r.slice(0).reverse().forEach((function(i){h.ctx.shadowColor=rr(i.color),h.ctx.shadowOffsetX=i.offsetX.number*h.options.scale,h.ctx.shadowOffsetY=i.offsetY.number*h.options.scale,h.ctx.shadowBlur=i.blur.number,h.renderTextWithLetterSpacing(e,t.letterSpacing,l)})),h.ctx.shadowColor="",h.ctx.shadowOffsetX=0,h.ctx.shadowOffsetY=0,h.ctx.shadowBlur=0),t.textDecorationLine.length&&(h.ctx.fillStyle=rr(t.textDecorationColor||t.color),t.textDecorationLine.forEach((function(t){switch(t){case 1:h.ctx.fillRect(e.bounds.left,Math.round(e.bounds.top+l),e.bounds.width,1);break;case 2:h.ctx.fillRect(e.bounds.left,Math.round(e.bounds.top),e.bounds.width,1);break;case 3:h.ctx.fillRect(e.bounds.left,Math.ceil(e.bounds.top+c),e.bounds.width,1)}})));break;case 1:t.webkitTextStrokeWidth&&e.text.trim().length&&(h.ctx.strokeStyle=rr(t.webkitTextStrokeColor),h.ctx.lineWidth=t.webkitTextStrokeWidth,h.ctx.lineJoin=window.chrome?"miter":"round",h.ctx.strokeText(e.text,e.bounds.left,e.bounds.top+l)),h.ctx.strokeStyle="",h.ctx.lineWidth=0,h.ctx.lineJoin="miter"}}))})),[2]}))}))},i.prototype.renderReplacedElement=function(e,t,i){if(i&&e.intrinsicWidth>0&&e.intrinsicHeight>0){var r=Yl(e),n=Pl(t);this.path(n),this.ctx.save(),this.ctx.clip(),this.ctx.drawImage(i,0,0,e.intrinsicWidth,e.intrinsicHeight,r.left,r.top,r.width,r.height),this.ctx.restore()}},i.prototype.renderNodeContent=function(e){return r(this,void 0,void 0,(function(){var t,r,o,a,l,c,u,h,d,p,f,A,m,g,_,y,v,x;return n(this,(function(n){switch(n.label){case 0:this.applyEffects(e.getEffects(4)),t=e.container,r=e.curves,o=t.styles,a=0,l=t.textNodes,n.label=1;case 1:return a<l.length?(c=l[a],[4,this.renderTextNode(c,o)]):[3,4];case 2:n.sent(),n.label=3;case 3:return a++,[3,1];case 4:if(!(t instanceof Ns))return[3,8];n.label=5;case 5:return n.trys.push([5,7,,8]),[4,this.context.cache.match(t.src)];case 6:return _=n.sent(),this.renderReplacedElement(t,r,_),[3,8];case 7:return n.sent(),this.context.logger.error("Error loading image "+t.src),[3,8];case 8:if(t instanceof Qs&&this.renderReplacedElement(t,r,t.canvas),!(t instanceof js))return[3,12];n.label=9;case 9:return n.trys.push([9,11,,12]),[4,this.context.cache.match(t.svg)];case 10:return _=n.sent(),this.renderReplacedElement(t,r,_),[3,12];case 11:return n.sent(),this.context.logger.error("Error loading svg "+t.svg.substring(0,255)),[3,12];case 12:return t instanceof ia&&t.tree?[4,new i(this.context,{scale:this.options.scale,backgroundColor:t.backgroundColor,x:0,y:0,width:t.width,height:t.height}).render(t.tree)]:[3,14];case 13:u=n.sent(),t.width&&t.height&&this.ctx.drawImage(u,0,0,t.width,t.height,t.bounds.left,t.bounds.top,t.bounds.width,t.bounds.height),n.label=14;case 14:if(t instanceof Js&&(h=Math.min(t.bounds.width,t.bounds.height),t.type===Ks?t.checked&&(this.ctx.save(),this.path([new wl(t.bounds.left+.39363*h,t.bounds.top+.79*h),new wl(t.bounds.left+.16*h,t.bounds.top+.5549*h),new wl(t.bounds.left+.27347*h,t.bounds.top+.44071*h),new wl(t.bounds.left+.39694*h,t.bounds.top+.5649*h),new wl(t.bounds.left+.72983*h,t.bounds.top+.23*h),new wl(t.bounds.left+.84*h,t.bounds.top+.34085*h),new wl(t.bounds.left+.39363*h,t.bounds.top+.79*h)]),this.ctx.fillStyle=rr(Ys),this.ctx.fill(),this.ctx.restore()):t.type===Ws&&t.checked&&(this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(t.bounds.left+h/2,t.bounds.top+h/2,h/4,0,2*Math.PI,!0),this.ctx.fillStyle=rr(Ys),this.ctx.fill(),this.ctx.restore())),pc(t)&&t.value.length){switch(d=this.createFontStyle(o),v=d[0],p=d[1],f=this.fontMetrics.getMetrics(v,p).baseline,this.ctx.font=v,this.ctx.fillStyle=rr(o.color),this.ctx.textBaseline="alphabetic",this.ctx.textAlign=Ac(t.styles.textAlign),x=Yl(t),A=0,t.styles.textAlign){case 1:A+=x.width/2;break;case 2:A+=x.width}m=x.add(A,0,0,-x.height/2+1),this.ctx.save(),this.path([new wl(x.left,x.top),new wl(x.left+x.width,x.top),new wl(x.left+x.width,x.top+x.height),new wl(x.left,x.top+x.height)]),this.ctx.clip(),this.renderTextWithLetterSpacing(new Ss(t.value,m),o.letterSpacing,f),this.ctx.restore(),this.ctx.textBaseline="alphabetic",this.ctx.textAlign="left"}if(!oo(t.styles.display,2048))return[3,20];if(null===t.styles.listStyleImage)return[3,19];if(0!==(g=t.styles.listStyleImage).type)return[3,18];_=void 0,y=g.url,n.label=15;case 15:return n.trys.push([15,17,,18]),[4,this.context.cache.match(y)];case 16:return _=n.sent(),this.ctx.drawImage(_,t.bounds.left-(_.width+10),t.bounds.top),[3,18];case 17:return n.sent(),this.context.logger.error("Error loading list-style-image "+y),[3,18];case 18:return[3,20];case 19:e.listValue&&-1!==t.styles.listStyleType&&(v=this.createFontStyle(o)[0],this.ctx.font=v,this.ctx.fillStyle=rr(o.color),this.ctx.textBaseline="middle",this.ctx.textAlign="right",x=new s(t.bounds.left,t.bounds.top+$i(t.styles.paddingTop,t.bounds.width),t.bounds.width,bn(o.lineHeight,o.fontSize.number)/2+1),this.renderTextWithLetterSpacing(new Ss(e.listValue,x),o.letterSpacing,bn(o.lineHeight,o.fontSize.number)/2+2),this.ctx.textBaseline="bottom",this.ctx.textAlign="left"),n.label=20;case 20:return[2]}}))}))},i.prototype.renderStackContent=function(e){return r(this,void 0,void 0,(function(){var t,i,r,o,s,a,l,c,u,h,d,p,f,A,m;return n(this,(function(n){switch(n.label){case 0:return oo(e.element.container.flags,16),[4,this.renderNodeBackgroundAndBorders(e.element)];case 1:n.sent(),t=0,i=e.negativeZIndex,n.label=2;case 2:return t<i.length?(m=i[t],[4,this.renderStack(m)]):[3,5];case 3:n.sent(),n.label=4;case 4:return t++,[3,2];case 5:return[4,this.renderNodeContent(e.element)];case 6:n.sent(),r=0,o=e.nonInlineLevel,n.label=7;case 7:return r<o.length?(m=o[r],[4,this.renderNode(m)]):[3,10];case 8:n.sent(),n.label=9;case 9:return r++,[3,7];case 10:s=0,a=e.nonPositionedFloats,n.label=11;case 11:return s<a.length?(m=a[s],[4,this.renderStack(m)]):[3,14];case 12:n.sent(),n.label=13;case 13:return s++,[3,11];case 14:l=0,c=e.nonPositionedInlineLevel,n.label=15;case 15:return l<c.length?(m=c[l],[4,this.renderStack(m)]):[3,18];case 16:n.sent(),n.label=17;case 17:return l++,[3,15];case 18:u=0,h=e.inlineLevel,n.label=19;case 19:return u<h.length?(m=h[u],[4,this.renderNode(m)]):[3,22];case 20:n.sent(),n.label=21;case 21:return u++,[3,19];case 22:d=0,p=e.zeroOrAutoZIndexOrTransformedOrOpacity,n.label=23;case 23:return d<p.length?(m=p[d],[4,this.renderStack(m)]):[3,26];case 24:n.sent(),n.label=25;case 25:return d++,[3,23];case 26:f=0,A=e.positiveZIndex,n.label=27;case 27:return f<A.length?(m=A[f],[4,this.renderStack(m)]):[3,30];case 28:n.sent(),n.label=29;case 29:return f++,[3,27];case 30:return[2]}}))}))},i.prototype.mask=function(e){this.ctx.beginPath(),this.ctx.moveTo(0,0),this.ctx.lineTo(this.canvas.width,0),this.ctx.lineTo(this.canvas.width,this.canvas.height),this.ctx.lineTo(0,this.canvas.height),this.ctx.lineTo(0,0),this.formatPath(e.slice(0).reverse()),this.ctx.closePath()},i.prototype.path=function(e){this.ctx.beginPath(),this.formatPath(e),this.ctx.closePath()},i.prototype.formatPath=function(e){var t=this;e.forEach((function(e,i){var r=Cl(e)?e.start:e;0===i?t.ctx.moveTo(r.x,r.y):t.ctx.lineTo(r.x,r.y),Cl(e)&&t.ctx.bezierCurveTo(e.startControl.x,e.startControl.y,e.endControl.x,e.endControl.y,e.end.x,e.end.y)}))},i.prototype.renderRepeat=function(e,t,i,r){this.path(e),this.ctx.fillStyle=t,this.ctx.translate(i,r),this.ctx.fill(),this.ctx.translate(-i,-r)},i.prototype.resizeImage=function(e,t,i){var r;if(e.width===t&&e.height===i)return e;var n=(null!==(r=this.canvas.ownerDocument)&&void 0!==r?r:document).createElement("canvas");return n.width=Math.max(1,t),n.height=Math.max(1,i),n.getContext("2d").drawImage(e,0,0,e.width,e.height,0,0,t,i),n},i.prototype.renderBackgroundImage=function(e){return r(this,void 0,void 0,(function(){var t,i,r,o,s,a;return n(this,(function(l){switch(l.label){case 0:t=e.styles.backgroundImage.length-1,i=function(i){var o,s,a,l,c,u,h,d,p,f,A,m,g,_,y,v,x,b,w,T,B,C,S,E,M,I,P,L,F,k,z;return n(this,(function(n){switch(n.label){case 0:if(0!==i.type)return[3,5];o=void 0,s=i.url,n.label=1;case 1:return n.trys.push([1,3,,4]),[4,r.context.cache.match(s)];case 2:return o=n.sent(),[3,4];case 3:return n.sent(),r.context.logger.error("Error loading background-image "+s),[3,4];case 4:return o&&(a=tc(e,t,[o.width,o.height,o.width/o.height]),v=a[0],C=a[1],S=a[2],w=a[3],T=a[4],_=r.ctx.createPattern(r.resizeImage(o,w,T),"repeat"),r.renderRepeat(v,_,C,S)),[3,6];case 5:Lr(i)?(l=tc(e,t,[null,null,null]),v=l[0],C=l[1],S=l[2],w=l[3],T=l[4],c=gr(i.angle,w,T),u=c[0],h=c[1],d=c[2],p=c[3],f=c[4],(A=document.createElement("canvas")).width=w,A.height=T,m=A.getContext("2d"),g=m.createLinearGradient(h,p,d,f),Ar(i.stops,u).forEach((function(e){return g.addColorStop(e.stop,rr(e.color))})),m.fillStyle=g,m.fillRect(0,0,w,T),w>0&&T>0&&(_=r.ctx.createPattern(A,"repeat"),r.renderRepeat(v,_,C,S))):Fr(i)&&(y=tc(e,t,[null,null,null]),v=y[0],x=y[1],b=y[2],w=y[3],T=y[4],B=0===i.position.length?[Vi]:i.position,C=$i(B[0],w),S=$i(B[B.length-1],T),E=vr(i,C,S,w,T),M=E[0],I=E[1],M>0&&I>0&&(P=r.ctx.createRadialGradient(x+C,b+S,0,x+C,b+S,M),Ar(i.stops,2*M).forEach((function(e){return P.addColorStop(e.stop,rr(e.color))})),r.path(v),r.ctx.fillStyle=P,M!==I?(L=e.bounds.left+.5*e.bounds.width,F=e.bounds.top+.5*e.bounds.height,z=1/(k=I/M),r.ctx.save(),r.ctx.translate(L,F),r.ctx.transform(1,0,0,k,0,0),r.ctx.translate(-L,-F),r.ctx.fillRect(x,z*(b-F)+F,w,T*z),r.ctx.restore()):r.ctx.fill())),n.label=6;case 6:return t--,[2]}}))},r=this,o=0,s=e.styles.backgroundImage.slice(0).reverse(),l.label=1;case 1:return o<s.length?(a=s[o],[5,i(a)]):[3,4];case 2:l.sent(),l.label=3;case 3:return o++,[3,1];case 4:return[2]}}))}))},i.prototype.renderSolidBorder=function(e,t,i){return r(this,void 0,void 0,(function(){return n(this,(function(r){return this.path(Gl(i,t)),this.ctx.fillStyle=rr(e),this.ctx.fill(),[2]}))}))},i.prototype.renderDoubleBorder=function(e,t,i,o){return r(this,void 0,void 0,(function(){var r,s;return n(this,(function(n){switch(n.label){case 0:return t<3?[4,this.renderSolidBorder(e,i,o)]:[3,2];case 1:return n.sent(),[2];case 2:return r=$l(o,i),this.path(r),this.ctx.fillStyle=rr(e),this.ctx.fill(),s=Zl(o,i),this.path(s),this.ctx.fill(),[2]}}))}))},i.prototype.renderNodeBackgroundAndBorders=function(e){return r(this,void 0,void 0,(function(){var t,i,r,o,s,a,l,c,u=this;return n(this,(function(n){switch(n.label){case 0:return this.applyEffects(e.getEffects(2)),t=e.container.styles,i=!ir(t.backgroundColor)||t.backgroundImage.length,r=[{style:t.borderTopStyle,color:t.borderTopColor,width:t.borderTopWidth},{style:t.borderRightStyle,color:t.borderRightColor,width:t.borderRightWidth},{style:t.borderBottomStyle,color:t.borderBottomColor,width:t.borderBottomWidth},{style:t.borderLeftStyle,color:t.borderLeftColor,width:t.borderLeftWidth}],o=fc(oc(t.backgroundClip,0),e.curves),i||t.boxShadow.length?(this.ctx.save(),this.path(o),this.ctx.clip(),ir(t.backgroundColor)||(this.ctx.fillStyle=rr(t.backgroundColor),this.ctx.fill()),[4,this.renderBackgroundImage(e.container)]):[3,2];case 1:n.sent(),this.ctx.restore(),t.boxShadow.slice(0).reverse().forEach((function(t){u.ctx.save();var i=Ml(e.curves),r=t.inset?0:hc,n=Ul(i,-r+(t.inset?1:-1)*t.spread.number,(t.inset?1:-1)*t.spread.number,t.spread.number*(t.inset?-2:2),t.spread.number*(t.inset?-2:2));t.inset?(u.path(i),u.ctx.clip(),u.mask(n)):(u.mask(i),u.ctx.clip(),u.path(n)),u.ctx.shadowOffsetX=t.offsetX.number+r,u.ctx.shadowOffsetY=t.offsetY.number,u.ctx.shadowColor=rr(t.color),u.ctx.shadowBlur=t.blur.number,u.ctx.fillStyle=t.inset?rr(t.color):"rgba(0,0,0,1)",u.ctx.fill(),u.ctx.restore()})),n.label=2;case 2:s=0,a=0,l=r,n.label=3;case 3:return a<l.length?0!==(c=l[a]).style&&!ir(c.color)&&c.width>0?2!==c.style?[3,5]:[4,this.renderDashedDottedBorder(c.color,c.width,s,e.curves,2)]:[3,11]:[3,13];case 4:return n.sent(),[3,11];case 5:return 3!==c.style?[3,7]:[4,this.renderDashedDottedBorder(c.color,c.width,s,e.curves,3)];case 6:return n.sent(),[3,11];case 7:return 4!==c.style?[3,9]:[4,this.renderDoubleBorder(c.color,c.width,s,e.curves)];case 8:return n.sent(),[3,11];case 9:return[4,this.renderSolidBorder(c.color,s,e.curves)];case 10:n.sent(),n.label=11;case 11:s++,n.label=12;case 12:return a++,[3,3];case 13:return[2]}}))}))},i.prototype.renderDashedDottedBorder=function(e,t,i,o,s){return r(this,void 0,void 0,(function(){var r,a,l,c,u,h,d,p,f,A,m,g,_,y,v,x;return n(this,(function(n){return this.ctx.save(),r=ql(o,i),a=Gl(o,i),2===s&&(this.path(a),this.ctx.clip()),Cl(a[0])?(l=a[0].start.x,c=a[0].start.y):(l=a[0].x,c=a[0].y),Cl(a[1])?(u=a[1].end.x,h=a[1].end.y):(u=a[1].x,h=a[1].y),d=0===i||2===i?Math.abs(l-u):Math.abs(c-h),this.ctx.beginPath(),3===s?this.formatPath(r):this.formatPath(a.slice(0,2)),p=t<3?3*t:2*t,f=t<3?2*t:t,3===s&&(p=t,f=t),A=!0,d<=2*p?A=!1:d<=2*p+f?(p*=m=d/(2*p+f),f*=m):(g=Math.floor((d+f)/(p+f)),_=(d-g*p)/(g-1),f=(y=(d-(g+1)*p)/g)<=0||Math.abs(f-_)<Math.abs(f-y)?_:y),A&&(3===s?this.ctx.setLineDash([0,p+f]):this.ctx.setLineDash([p,f])),3===s?(this.ctx.lineCap="round",this.ctx.lineWidth=t):this.ctx.lineWidth=2*t+1.1,this.ctx.strokeStyle=rr(e),this.ctx.stroke(),this.ctx.setLineDash([]),2===s&&(Cl(a[0])&&(v=a[3],x=a[0],this.ctx.beginPath(),this.formatPath([new wl(v.end.x,v.end.y),new wl(x.start.x,x.start.y)]),this.ctx.stroke()),Cl(a[1])&&(v=a[1],x=a[2],this.ctx.beginPath(),this.formatPath([new wl(v.end.x,v.end.y),new wl(x.start.x,x.start.y)]),this.ctx.stroke())),this.ctx.restore(),[2]}))}))},i.prototype.render=function(e){return r(this,void 0,void 0,(function(){var t;return n(this,(function(i){switch(i.label){case 0:return this.options.backgroundColor&&(this.ctx.fillStyle=rr(this.options.backgroundColor),this.ctx.fillRect(this.options.x,this.options.y,this.options.width,this.options.height)),t=Hl(e),[4,this.renderStack(t)];case 1:return i.sent(),this.applyEffects([]),[2,this.canvas]}}))}))},i}(uc),pc=function(e){return e instanceof ta||e instanceof ea||e instanceof Js&&e.type!==Ws&&e.type!==Ks},fc=function(e,t){switch(e){case 0:return Ml(t);case 2:return Il(t);default:return Pl(t)}},Ac=function(e){switch(e){case 1:return"center";case 2:return"right";default:return"left"}},mc=["-apple-system","system-ui"],gc=function(e){return/iPhone OS 15_(0|1)/.test(window.navigator.userAgent)?e.filter((function(e){return-1===mc.indexOf(e)})):e},_c=function(e){function i(t,i){var r=e.call(this,t,i)||this;return r.canvas=i.canvas?i.canvas:document.createElement("canvas"),r.ctx=r.canvas.getContext("2d"),r.options=i,r.canvas.width=Math.floor(i.width*i.scale),r.canvas.height=Math.floor(i.height*i.scale),r.canvas.style.width=i.width+"px",r.canvas.style.height=i.height+"px",r.ctx.scale(r.options.scale,r.options.scale),r.ctx.translate(-i.x,-i.y),r.context.logger.debug("EXPERIMENTAL ForeignObject renderer initialized ("+i.width+"x"+i.height+" at "+i.x+","+i.y+") with scale "+i.scale),r}return t(i,e),i.prototype.render=function(e){return r(this,void 0,void 0,(function(){var t,i;return n(this,(function(r){switch(r.label){case 0:return t=Ts(this.options.width*this.options.scale,this.options.height*this.options.scale,this.options.scale,this.options.scale,e),[4,yc(t)];case 1:return i=r.sent(),this.options.backgroundColor&&(this.ctx.fillStyle=rr(this.options.backgroundColor),this.ctx.fillRect(0,0,this.options.width*this.options.scale,this.options.height*this.options.scale)),this.ctx.drawImage(i,-this.options.x*this.options.scale,-this.options.y*this.options.scale),[2,this.canvas]}}))}))},i}(uc),yc=function(e){return new Promise((function(t,i){var r=new Image;r.onload=function(){t(r)},r.onerror=i,r.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent((new XMLSerializer).serializeToString(e))}))},vc=function(){function e(e){var t=e.id,i=e.enabled;this.id=t,this.enabled=i,this.start=Date.now()}return e.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.enabled&&("undefined"!=typeof window&&window.console&&"function"==typeof console.debug?console.debug.apply(console,o([this.id,this.getTime()+"ms"],e)):this.info.apply(this,e))},e.prototype.getTime=function(){return Date.now()-this.start},e.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.enabled&&"undefined"!=typeof window&&window.console&&"function"==typeof console.info&&console.info.apply(console,o([this.id,this.getTime()+"ms"],e))},e.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.enabled&&("undefined"!=typeof window&&window.console&&"function"==typeof console.warn?console.warn.apply(console,o([this.id,this.getTime()+"ms"],e)):this.info.apply(this,e))},e.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.enabled&&("undefined"!=typeof window&&window.console&&"function"==typeof console.error?console.error.apply(console,o([this.id,this.getTime()+"ms"],e)):this.info.apply(this,e))},e.instances={},e}(),xc=function(){function e(t,i){var r;this.windowBounds=i,this.instanceName="#"+e.instanceCount++,this.logger=new vc({id:this.instanceName,enabled:t.logging}),this.cache=null!==(r=t.cache)&&void 0!==r?r:new fl(this,t)}return e.instanceCount=1,e}(),bc=function(e,t){return void 0===t&&(t={}),wc(e,t)};"undefined"!=typeof window&&pl.setContext(window);var wc=function(e,t){return r(void 0,void 0,void 0,(function(){var r,o,c,u,h,d,p,f,A,m,g,_,y,v,x,b,w,T,B,C,S,E,M,I,P,L,F,k,z,R,D,O,U,N,Q,j,V,H;return n(this,(function(n){switch(n.label){case 0:if(!e||"object"!=typeof e)return[2,Promise.reject("Invalid element provided as first argument")];if(!(r=e.ownerDocument))throw new Error("Element is not attached to a Document");if(!(o=r.defaultView))throw new Error("Document is not attached to a Window");return c={allowTaint:null!==(E=t.allowTaint)&&void 0!==E&&E,imageTimeout:null!==(M=t.imageTimeout)&&void 0!==M?M:15e3,proxy:t.proxy,useCORS:null!==(I=t.useCORS)&&void 0!==I&&I},u=i({logging:null===(P=t.logging)||void 0===P||P,cache:t.cache},c),h={windowWidth:null!==(L=t.windowWidth)&&void 0!==L?L:o.innerWidth,windowHeight:null!==(F=t.windowHeight)&&void 0!==F?F:o.innerHeight,scrollX:null!==(k=t.scrollX)&&void 0!==k?k:o.pageXOffset,scrollY:null!==(z=t.scrollY)&&void 0!==z?z:o.pageYOffset},d=new s(h.scrollX,h.scrollY,h.windowWidth,h.windowHeight),p=new xc(u,d),f=null!==(R=t.foreignObjectRendering)&&void 0!==R&&R,A={allowTaint:null!==(D=t.allowTaint)&&void 0!==D&&D,onclone:t.onclone,ignoreElements:t.ignoreElements,inlineImages:f,copyStyles:f},p.logger.debug("Starting document clone with size "+d.width+"x"+d.height+" scrolled to "+-d.left+","+-d.top),m=new Ka(p,e,A),(g=m.clonedReferenceElement)?[4,m.toIFrame(r,d)]:[2,Promise.reject("Unable to find element in cloned iframe")];case 1:return _=n.sent(),y=_a(g)||ma(g)?l(g.ownerDocument):a(p,g),v=y.width,x=y.height,b=y.left,w=y.top,T=Tc(p,g,t.backgroundColor),B={canvas:t.canvas,backgroundColor:T,scale:null!==(U=null!==(O=t.scale)&&void 0!==O?O:o.devicePixelRatio)&&void 0!==U?U:1,x:(null!==(N=t.x)&&void 0!==N?N:0)+b,y:(null!==(Q=t.y)&&void 0!==Q?Q:0)+w,width:null!==(j=t.width)&&void 0!==j?j:Math.ceil(v),height:null!==(V=t.height)&&void 0!==V?V:Math.ceil(x)},f?(p.logger.debug("Document cloned, using foreign object rendering"),[4,new _c(p,B).render(g)]):[3,3];case 2:return C=n.sent(),[3,5];case 3:return p.logger.debug("Document cloned, element located at "+b+","+w+" with size "+v+"x"+x+" using computed rendering"),p.logger.debug("Starting DOM parsing"),S=sa(p,g),T===S.styles.backgroundColor&&(S.styles.backgroundColor=hr.TRANSPARENT),p.logger.debug("Starting renderer for element at "+B.x+","+B.y+" with size "+B.width+"x"+B.height),[4,new dc(p,B).render(S)];case 4:C=n.sent(),n.label=5;case 5:return(null===(H=t.removeContainer)||void 0===H||H)&&(Ka.destroy(_)||p.logger.error("Cannot detach cloned iframe as it is not in the DOM anymore")),p.logger.debug("Finished rendering"),[2,C]}}))}))},Tc=function(e,t,i){var r=t.ownerDocument,n=r.documentElement?ur(e,getComputedStyle(r.documentElement).backgroundColor):hr.TRANSPARENT,o=r.body?ur(e,getComputedStyle(r.body).backgroundColor):hr.TRANSPARENT,s="string"==typeof i?ur(e,i):null===i?hr.TRANSPARENT:4294967295;return t===r.documentElement?ir(n)?ir(o)?s:o:n:s};return bc}();var Xd=Wd.exports;function Yd(e,t={}){const i=[{type:"script",value:`//api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/${t.version}/mapbox-gl-geocoder.min.js`,id:"byk-gc-js"},{type:"link",value:`//api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/${t.version}/mapbox-gl-geocoder.css`,id:"byk-gc-css"}],r=t.customStylesheetUrl;r&&i.push({type:"link",value:r,id:"byk-gcsu-css"});let n=()=>{};return function(e,t){for(const{type:i,value:r,id:n}of e){if(document.getElementById(n))return void("script"===i&&t());const e=document.createElement(i);e.id=n,"script"===i?(e.async=!0,e.defer=!0,e.src=r,e.onload=()=>t()):(e.rel="stylesheet",e.href=r),document.body.appendChild(e)}}(i,(()=>{n=function(e,t){const i=new window.MapboxGeocoder(e);i.addTo(`#${t.id}`),e.value&&i.setInput(e.value);return function(e,t,i,r){const n=[];for(const[o,s]of Object.entries(t)){const t=t=>{const[n,o]=s(e,t,i);r.dispatchEvent(new CustomEvent(n,{detail:o}))};e.on(o,t),n.push([o,t])}return()=>{for(const[t,i]of n)e.off(t,i)}}(i,Jd,!1,t)}(t,e)})),{destroy(){n()}}}const Jd={results:(e,t)=>["results",t],result:(e,t)=>["result",t],loading:(e,t)=>["loading",t],error:(e,t)=>["error",t],clear:(e,t)=>["clear",t],load:e=>["ready",{geocoder:e}]};function ep(e){let i,r,n;return{c(){i=b("div"),E(i,"id",e[0]),E(i,"class","svelte-1k1b3t4")},m(t,o){y(t,i,o),r||(n=[g(Yd.call(null,i,e[1])),S(i,"ready",e[2]),S(i,"results",e[11]),S(i,"result",e[12]),S(i,"loading",e[13]),S(i,"error",e[14]),S(i,"clear",e[15]),S(i,"load",e[16])],r=!0)},p:t,i:t,o:t,d(e){e&&v(i),r=!1,o(n)}}}function tp(e,t,i){let{accessToken:r}=t,{options:n={}}=t,{version:o="v4.5.1"}=t,{types:s=["country","region","postcode","district","place","locality","neighborhood","address"]}=t,{placeholder:a="Search"}=t,{value:l=null}=t,{customStylesheetUrl:c=!1}=t,{geocoder:u}=t;const h=H(),d="bsm-"+Math.random().toString(36).substring(6),p=Object.assign({version:o,accessToken:r,types:s.join(","),placeholder:a,customStylesheetUrl:c,value:l},n);return e.$$set=e=>{"accessToken"in e&&i(4,r=e.accessToken),"options"in e&&i(5,n=e.options),"version"in e&&i(6,o=e.version),"types"in e&&i(7,s=e.types),"placeholder"in e&&i(8,a=e.placeholder),"value"in e&&i(9,l=e.value),"customStylesheetUrl"in e&&i(10,c=e.customStylesheetUrl),"geocoder"in e&&i(3,u=e.geocoder)},[d,p,function({detail:e}){i(3,u=e.geocoder),h("ready")},u,r,n,o,s,a,l,c,function(t){G.call(this,e,t)},function(t){G.call(this,e,t)},function(t){G.call(this,e,t)},function(t){G.call(this,e,t)},function(t){G.call(this,e,t)},function(t){G.call(this,e,t)}]}class ip extends me{constructor(e){super(),Ae(this,e,tp,ep,a,{accessToken:4,options:5,version:6,types:7,placeholder:8,value:9,customStylesheetUrl:10,geocoder:3})}}function rp(e){let t,i,r;return i=new mh({props:{options:e[1].map(np),activeValue:e[0],onSelect:e[2],direction:"down"}}),{c(){t=b("div"),de(i.$$.fragment),E(t,"class","dropdown-container svelte-1yvkhcz")},m(e,n){y(e,t,n),pe(i,t,null),r=!0},p(e,[t]){const r={};2&t&&(r.options=e[1].map(np)),1&t&&(r.activeValue=e[0]),4&t&&(r.onSelect=e[2]),i.$set(r)},i(e){r||(le(i.$$.fragment,e),r=!0)},o(e){ce(i.$$.fragment,e),r=!1},d(e){e&&v(t),fe(i)}}}const np=e=>({label:e,value:e});function op(e,t,i){let r,n;l(e,nt,(e=>i(5,n=e)));let{mode:o}=t,{mapsNum:s}=t;const a=H();let c=o??"",u=pd;const h=e=>{1===e&&i(1,u=pd.filter((e=>"swipe"!==e))),2===e&&i(1,u=pd.filter((e=>"responsive"!==e))),e>2&&e<=4&&i(1,u=pd.filter((e=>"swipe"!==e&&"responsive"!==e))),e>4&&i(1,u=pd.filter((e=>"swipe"!==e&&"phone"!==e&&"responsive"!==e))),n||i(1,u=["mirror"]),u.includes(c)||i(0,c=u[0])};return nt.subscribe((()=>{h(s)})),e.$$set=e=>{"mode"in e&&i(3,o=e.mode),"mapsNum"in e&&i(4,s=e.mapsNum)},e.$$.update=()=>{var t;16&e.$$.dirty&&h(s),1&e.$$.dirty&&(e=>{a("viewMode",{mode:e})})(c),8&e.$$.dirty&&(t=o)!==c&&i(0,c=t)},i(2,r=e=>{i(0,c=e)}),[c,u,r,o,s]}class sp extends me{constructor(e){super(),Ae(this,e,op,rp,a,{mode:3,mapsNum:4})}}function ap(e){let t,i,r;return i=new mh({props:{placeholder:"Go to...",options:e[3],activeValue:e[1],onSelect:e[2],direction:"down"}}),{c(){t=b("div"),de(i.$$.fragment),E(t,"class","dropdown-container svelte-1ho45wf")},m(e,n){y(e,t,n),pe(i,t,null),r=!0},p(e,t){const r={};8&t&&(r.options=e[3]),2&t&&(r.activeValue=e[1]),4&t&&(r.onSelect=e[2]),i.$set(r)},i(e){r||(le(i.$$.fragment,e),r=!0)},o(e){ce(i.$$.fragment,e),r=!1},d(e){e&&v(t),fe(i)}}}function lp(e){let t,i,r=e[0]&&ap(e);return{c(){r&&r.c(),t=C()},m(e,n){r&&r.m(e,n),y(e,t,n),i=!0},p(e,[i]){e[0]?r?(r.p(e,i),1&i&&le(r,1)):(r=ap(e),r.c(),le(r,1),r.m(t.parentNode,t)):r&&(se(),ce(r,1,1,(()=>{r=null})),ae())},i(e){i||(le(r),i=!0)},o(e){ce(r),i=!1},d(e){r&&r.d(e),e&&v(t)}}}function cp(e,t,i){let r,n,{bearing:o}=t,{center:s}=t,{pitch:a}=t,{zoom:l}=t;const c=H();let u;it.subscribe((e=>i(0,({gazetteer:u}=e),u)));const h=(e,t)=>Number.parseFloat(e).toFixed(t),d=e=>{if(!u)return"";const t=Object.keys(u).reduce(((e,t)=>e=e.concat(u[t])),[]).find((t=>{const i=Object.values(t)[0];return Object.keys(i).every((t=>{if("center"===t&&e.center){const{lng:t,lat:r}=i.center,{lng:n,lat:o}=e.center;return h(t,4)===h(n,4)&&h(r,4)===h(o,4)}return h(i[t],2)===h(e[t],2)}))}));return t?JSON.stringify(t):""};let p=d({zoom:l,center:s,pitch:a,bearing:o});const f=()=>{const{options:e}=(e=>{if(!e)return{};try{const t=JSON.parse(e),i=Object.keys(t)[0],r=t[i];return c("mapState",{options:r}),{label:i,options:r}}catch(e){return console.error(e),{}}})(p);e&&c("mapState",{options:e})};return e.$$set=e=>{"bearing"in e&&i(4,o=e.bearing),"center"in e&&i(5,s=e.center),"pitch"in e&&i(6,a=e.pitch),"zoom"in e&&i(7,l=e.zoom)},e.$$.update=()=>{240&e.$$.dirty&&(e=>{const t=d(e);p!==t&&i(1,p=t??"")})({zoom:l,center:s,pitch:a,bearing:o}),2&e.$$.dirty&&f(),1&e.$$.dirty&&i(3,r=Object.entries(u).reduce(((e,[t,i])=>{e.push({header:t});for(const t of i){let[i,r]=Object.entries(t)[0];e.push({label:i,value:JSON.stringify(t)})}return e}),[]))},i(2,n=e=>{i(1,p=e)}),[u,p,n,r,o,s,a,l]}class up extends me{constructor(e){super(),Ae(this,e,cp,lp,a,{bearing:4,center:5,pitch:6,zoom:7})}}function hp(e){let t,i;return{c(){t=b("div"),i=T(e[0]),F(t,"top",e[3]+"px"),F(t,"left",e[2]+"px"),E(t,"class","tooltip svelte-1qc780y")},m(e,r){y(e,t,r),_(t,i)},p(e,r){1&r&&I(i,e[0]),8&r&&F(t,"top",e[3]+"px"),4&r&&F(t,"left",e[2]+"px")},d(e){e&&v(t)}}}function dp(e){let t,i,r,n,s,a;const l=e[8].default,u=c(l,e,e[7],null);let f=e[1]&&hp(e);return{c(){t=b("div"),u&&u.c(),i=B(),f&&f.c(),r=C()},m(o,l){y(o,t,l),u&&u.m(t,null),y(o,i,l),f&&f.m(o,l),y(o,r,l),n=!0,s||(a=[S(t,"mouseover",e[4]),S(t,"mouseleave",e[6]),S(t,"mousemove",e[5])],s=!0)},p(e,[t]){u&&u.p&&(!n||128&t)&&d(u,l,e,e[7],n?h(l,e[7],t,null):p(e[7]),null),e[1]?f?f.p(e,t):(f=hp(e),f.c(),f.m(r.parentNode,r)):f&&(f.d(1),f=null)},i(e){n||(le(u,e),n=!0)},o(e){ce(u,e),n=!1},d(e){e&&v(t),u&&u.d(e),e&&v(i),f&&f.d(e),e&&v(r),s=!1,o(a)}}}function pp(e,t,i){let r,n,{$$slots:o={},$$scope:s}=t,{title:a=""}=t,l=!1;return e.$$set=e=>{"title"in e&&i(0,a=e.title),"$$scope"in e&&i(7,s=e.$$scope)},[a,l,r,n,function(e){i(1,l=!0),i(2,r=e.pageX+5),i(3,n=e.pageY+5)},function(e){i(2,r=e.pageX+5),i(3,n=e.pageY+5)},function(){i(1,l=!1)},s,o]}class fp extends me{constructor(e){super(),Ae(this,e,pp,dp,a,{title:0})}}function Ap(e,t,i){const r=e.slice();return r[27]=t[i],r}function mp(e){let i,r,n,s,a;return r=new Hu({props:{icon:Iu}}),{c(){i=b("button"),de(r.$$.fragment),E(i,"class","fullscreen-btn show-ui svelte-1g6kozd"),E(i,"title","Show UI")},m(t,o){y(t,i,o),pe(r,i,null),n=!0,s||(a=[S(i,"click",e[13]),g(Ju.call(null,i,{shift:!0,control:!0,code:"KeyF",callback:e[13]}))],s=!0)},p:t,i(e){n||(le(r.$$.fragment,e),n=!0)},o(e){ce(r.$$.fragment,e),n=!1},d(e){e&&v(i),fe(r),s=!1,o(a)}}}function gp(e){let t,r,n,s,a,l,c,u,h,d,p,f,A,m,x,w,C,M,I,P,L,k,z,R,D,O,U,N,Q,j,V,H,G,$,Z,q,K,W,X,Y,J,ee,te,ie,re,ne,oe,Ae,me,ge;a=new Hu({props:{icon:e[8]?Lu:Ru}});let _e=e[8]&&_p(e);d=new sp({props:{mode:e[4],mapsNum:e[5].length}}),d.$on("viewMode",e[21]);let ye=e[3]&&yp(e);const ve=[e[6]];let xe={};for(let e=0;e<ve.length;e+=1)xe=i(xe,ve[e]);x=new up({props:xe}),x.$on("mapState",e[22]);let be="swipe"===e[4]&&vp(e);G=new Hu({props:{icon:Fu}}),X=new Hu({props:{icon:Pu}}),ne=new Hu({props:{icon:ku}});let we=e[7].length>0&&bp(e);return{c(){t=b("div"),r=b("div"),n=b("div"),s=b("div"),de(a.$$.fragment),c=B(),_e&&_e.c(),u=B(),h=b("div"),de(d.$$.fragment),p=B(),f=b("div"),ye&&ye.c(),A=B(),m=b("div"),de(x.$$.fragment),w=B(),C=b("div"),M=b("div"),I=b("label"),P=b("span"),P.innerHTML='Label <span class="hotkey svelte-1g6kozd">C</span>ollisions',L=B(),k=b("input"),z=B(),R=b("label"),D=b("span"),D.innerHTML='<span class="hotkey svelte-1g6kozd">T</span>ile Boundaries',O=B(),U=b("input"),N=B(),be&&be.c(),Q=B(),j=b("div"),V=b("div"),H=b("button"),de(G.$$.fragment),$=T(" Add map"),K=B(),W=b("button"),de(X.$$.fragment),Y=T("\n            Copy image"),te=B(),ie=b("div"),re=b("button"),de(ne.$$.fragment),oe=B(),we&&we.c(),E(s,"class","link-button svelte-1g6kozd"),F(s,"margin-right","6px"),E(s,"title",l=e[8]?"Unlink locations":"Link locations"),E(n,"class","control-section svelte-1g6kozd"),E(h,"class","control-section svelte-1g6kozd"),E(f,"class","control-section svelte-1g6kozd"),E(m,"class","control-section svelte-1g6kozd"),E(P,"class","checkbox-label svelte-1g6kozd"),E(k,"type","checkbox"),E(I,"class","checkbox-container svelte-1g6kozd"),E(D,"class","checkbox-label svelte-1g6kozd"),E(U,"type","checkbox"),E(R,"class","checkbox-container svelte-1g6kozd"),E(M,"class","checkboxes svelte-1g6kozd"),E(C,"class","control-section svelte-1g6kozd"),F(H,"margin-right","6px"),H.disabled=Z=e[5].length>=8,E(H,"title",q=e[5].length>=8?"Maximum of 8 maps allowed.":""),W.disabled=J="swipe"===e[4],E(W,"title",ee="swipe"===e[4]?"Must be in phone or mirror mode to screenshot.":"Copy image to clipboard"),E(V,"class","buttons svelte-1g6kozd"),E(j,"class","control-section svelte-1g6kozd"),E(re,"class","fullscreen-btn svelte-1g6kozd"),E(re,"title","Hide UI"),E(ie,"class","control-section svelte-1g6kozd"),E(r,"class","control-row svelte-1g6kozd"),E(t,"class","map-controls svelte-1g6kozd")},m(i,o){y(i,t,o),_(t,r),_(r,n),_(n,s),pe(a,s,null),_(n,c),_e&&_e.m(n,null),_(r,u),_(r,h),pe(d,h,null),_(r,p),_(r,f),ye&&ye.m(f,null),_(r,A),_(r,m),pe(x,m,null),_(r,w),_(r,C),_(C,M),_(M,I),_(I,P),_(I,L),_(I,k),k.checked=e[0],_(M,z),_(M,R),_(R,D),_(R,O),_(R,U),U.checked=e[1],_(M,N),be&&be.m(M,null),_(r,Q),_(r,j),_(j,V),_(V,H),pe(G,H,null),_(H,$),_(V,K),_(V,W),pe(X,W,null),_(W,Y),_(r,te),_(r,ie),_(ie,re),pe(ne,re,null),_(t,oe),we&&we.m(t,null),Ae=!0,me||(ge=[S(s,"click",e[14]),S(k,"change",e[23]),S(U,"change",e[24]),S(H,"click",e[11]),S(W,"click",e[12]),S(re,"click",e[13]),g(Ju.call(null,re,{shift:!0,control:!0,code:"KeyF",callback:e[13]}))],me=!0)},p(e,i){const r={};256&i&&(r.icon=e[8]?Lu:Ru),a.$set(r),(!Ae||256&i&&l!==(l=e[8]?"Unlink locations":"Link locations"))&&E(s,"title",l),e[8]?_e?(_e.p(e,i),256&i&&le(_e,1)):(_e=_p(e),_e.c(),le(_e,1),_e.m(n,null)):_e&&(se(),ce(_e,1,1,(()=>{_e=null})),ae());const o={};16&i&&(o.mode=e[4]),32&i&&(o.mapsNum=e[5].length),d.$set(o),e[3]?ye?(ye.p(e,i),8&i&&le(ye,1)):(ye=yp(e),ye.c(),le(ye,1),ye.m(f,null)):ye&&(se(),ce(ye,1,1,(()=>{ye=null})),ae());const c=64&i?ue(ve,[he(e[6])]):{};x.$set(c),1&i&&(k.checked=e[0]),2&i&&(U.checked=e[1]),"swipe"===e[4]?be?(be.p(e,i),16&i&&le(be,1)):(be=vp(e),be.c(),le(be,1),be.m(M,null)):be&&(se(),ce(be,1,1,(()=>{be=null})),ae()),(!Ae||32&i&&Z!==(Z=e[5].length>=8))&&(H.disabled=Z),(!Ae||32&i&&q!==(q=e[5].length>=8?"Maximum of 8 maps allowed.":""))&&E(H,"title",q),(!Ae||16&i&&J!==(J="swipe"===e[4]))&&(W.disabled=J),(!Ae||16&i&&ee!==(ee="swipe"===e[4]?"Must be in phone or mirror mode to screenshot.":"Copy image to clipboard"))&&E(W,"title",ee),e[7].length>0?we?we.p(e,i):(we=bp(e),we.c(),we.m(t,null)):we&&(we.d(1),we=null)},i(e){Ae||(le(a.$$.fragment,e),le(_e),le(d.$$.fragment,e),le(ye),le(x.$$.fragment,e),le(be),le(G.$$.fragment,e),le(X.$$.fragment,e),le(ne.$$.fragment,e),Ae=!0)},o(e){ce(a.$$.fragment,e),ce(_e),ce(d.$$.fragment,e),ce(ye),ce(x.$$.fragment,e),ce(be),ce(G.$$.fragment,e),ce(X.$$.fragment,e),ce(ne.$$.fragment,e),Ae=!1},d(e){e&&v(t),fe(a),_e&&_e.d(),fe(d),ye&&ye.d(),fe(x),be&&be.d(),fe(G),fe(X),fe(ne),we&&we.d(),me=!1,o(ge)}}}function _p(e){let t,r;const n=[e[6]];let o={};for(let e=0;e<n.length;e+=1)o=i(o,n[e]);return t=new ad({props:o}),t.$on("mapState",e[20]),{c(){de(t.$$.fragment)},m(e,i){pe(t,e,i),r=!0},p(e,i){const r=64&i?ue(n,[he(e[6])]):{};t.$set(r)},i(e){r||(le(t.$$.fragment,e),r=!0)},o(e){ce(t.$$.fragment,e),r=!1},d(e){fe(t,e)}}}function yp(e){let t,i;return t=new ip({props:{accessToken:e[3],geocoder:null}}),t.$on("result",e[10]),{c(){de(t.$$.fragment)},m(e,r){pe(t,e,r),i=!0},p(e,i){const r={};8&i&&(r.accessToken=e[3]),t.$set(r)},i(e){i||(le(t.$$.fragment,e),i=!0)},o(e){ce(t.$$.fragment,e),i=!1},d(e){fe(t,e)}}}function vp(e){let t,i;return t=new fp({props:{title:"Highlights visual differences between two styles.",$$slots:{default:[xp]},$$scope:{ctx:e}}}),{c(){de(t.$$.fragment)},m(e,r){pe(t,e,r),i=!0},p(e,i){const r={};1073741828&i&&(r.$$scope={dirty:i,ctx:e}),t.$set(r)},i(e){i||(le(t.$$.fragment,e),i=!0)},o(e){ce(t.$$.fragment,e),i=!1},d(e){fe(t,e)}}}function xp(e){let t,i,r,n,o,s;return{c(){t=b("label"),i=b("span"),i.innerHTML='Highlight <span class="hotkey svelte-1g6kozd">D</span>ifferences',r=B(),n=b("input"),E(i,"class","checkbox-label svelte-1g6kozd"),E(n,"type","checkbox"),E(t,"class","checkbox-container svelte-1g6kozd")},m(a,l){y(a,t,l),_(t,i),_(t,r),_(t,n),n.checked=e[2],o||(s=S(n,"change",e[25]),o=!0)},p(e,t){4&t&&(n.checked=e[2])},d(e){e&&v(t),o=!1,s()}}}function bp(e){let t,i=e[7],r=[];for(let t=0;t<i.length;t+=1)r[t]=wp(Ap(e,i,t));return{c(){t=b("div");for(let e=0;e<r.length;e+=1)r[e].c();E(t,"class","validation-messages svelte-1g6kozd")},m(e,i){y(e,t,i);for(let e=0;e<r.length;e+=1)r[e]&&r[e].m(t,null)},p(e,n){if(128&n){let o;for(i=e[7],o=0;o<i.length;o+=1){const s=Ap(e,i,o);r[o]?r[o].p(s,n):(r[o]=wp(s),r[o].c(),r[o].m(t,null))}for(;o<r.length;o+=1)r[o].d(1);r.length=i.length}},d(e){e&&v(t),x(r,e)}}}function wp(e){let t,i,r,n=e[27].message+"";return{c(){t=b("div"),i=T(n),E(t,"class",r=m(`validation-message-${e[27].type}`)+" svelte-1g6kozd")},m(e,r){y(e,t,r),_(t,i)},p(e,o){128&o&&n!==(n=e[27].message+"")&&I(i,n),128&o&&r!==(r=m(`validation-message-${e[27].type}`)+" svelte-1g6kozd")&&E(t,"class",r)},d(e){e&&v(t)}}}function Tp(e){let t,i,r,n,o,s;const a=[gp,mp],l=[];function c(e,t){return e[9]?0:1}return t=c(e),i=l[t]=a[t](e),{c(){i.c(),r=C()},m(i,a){l[t].m(i,a),y(i,r,a),n=!0,o||(s=S(window,"keydown",e[15]),o=!0)},p(e,[n]){let o=t;t=c(e),t===o?l[t].p(e,n):(se(),ce(l[o],1,1,(()=>{l[o]=null})),ae(),i=l[t],i?i.p(e,n):(i=l[t]=a[t](e),i.c()),le(i,1),i.m(r.parentNode,r))},i(e){n||(le(i),n=!0)},o(e){ce(i),n=!1},d(e){l[t].d(e),e&&v(r),o=!1,s()}}}function Bp(e,t,i){let r,n;l(e,nt,(e=>i(8,r=e))),l(e,rt,(e=>i(9,n=e)));let{bearing:o}=t,{center:s}=t,{mapboxGlAccessToken:a}=t,{pitch:c}=t,{showCollisions:u}=t,{showBoundaries:h}=t,{showDiff:d}=t,{viewMode:p}=t,{zoom:f}=t;const A=H();let m,g=[],_=[];et.subscribe((e=>i(5,g=e)));return e.$$set=e=>{"bearing"in e&&i(16,o=e.bearing),"center"in e&&i(17,s=e.center),"mapboxGlAccessToken"in e&&i(3,a=e.mapboxGlAccessToken),"pitch"in e&&i(18,c=e.pitch),"showCollisions"in e&&i(0,u=e.showCollisions),"showBoundaries"in e&&i(1,h=e.showBoundaries),"showDiff"in e&&i(2,d=e.showDiff),"viewMode"in e&&i(4,p=e.viewMode),"zoom"in e&&i(19,f=e.zoom)},e.$$.update=()=>{983040&e.$$.dirty&&i(6,m={bearing:o,center:s,pitch:c,zoom:f}),96&e.$$.dirty&&i(7,_=((e,t)=>{const i=[],r=fd(e,t);return e.pitch>=r&&i.push({type:"warning",message:`Pitch capped at ${r} as that is the maximum for this zoom level.`}),i})(m,g)),20&e.$$.dirty&&"swipe"!==p&&d&&i(2,d=!1),7&e.$$.dirty&&A("mapState",{options:{showCollisions:u,showBoundaries:h,showDiff:d}})},[u,h,d,a,p,g,m,_,r,n,({detail:e})=>{const{result:t}=e,i={center:{lat:t.center[1],lng:t.center[0]},zoom:17};t.bbox&&(i.zoom=14),A("mapState",{options:i})},()=>{et.update((e=>{let t=e[e.length-1];t={...t,index:t.index+1};return e.concat([t])})),r||ot.update((e=>[...e,{...e[e.length-1]}]))},async()=>{const e=document.getElementsByClassName("maps")[0];let t=[...document.getElementsByClassName("screenshot-label-transparent")];t.forEach((e=>{e.classList.remove("screenshot-label-transparent"),e.classList.add("screenshot-label")}));let i=[];"mirror"===p&&(i=[...document.getElementsByClassName("map-container-border")],i.forEach((e=>{e.classList.remove("map-container-border"),e.classList.add("map-container-border-transparent")})));Xd(e,{ignoreElements:e=>!(!e.className||"string"!=typeof e.className)&&e.className.includes("map-label")}).then((e=>{e.toBlob((e=>navigator.clipboard.write([new ClipboardItem({"image/png":e})])))})),t.forEach((e=>{e.classList.remove("screenshot-label"),e.classList.add("screenshot-label-transparent")})),"mirror"===p&&i.forEach((e=>{e.classList.remove("map-container-border-transparent"),e.classList.add("map-container-border")}))},()=>{rt.update((e=>!e))},()=>{nt.update((e=>!e))},function(e){"input"!==e.target.tagName.toLowerCase()&&("c"!==e.key&&"C"!==e.key||i(0,u=!u),"t"!==e.key&&"T"!==e.key||i(1,h=!h),"d"!==e.key&&"D"!==e.key||i(2,d=!d))},o,s,c,f,function(t){G.call(this,e,t)},function(t){G.call(this,e,t)},function(t){G.call(this,e,t)},function(){u=this.checked,i(0,u)},function(){h=this.checked,i(1,h)},function(){d=this.checked,i(2,d),i(4,p)}]}class Cp extends me{constructor(e){super(),Ae(this,e,Bp,Tp,a,{bearing:16,center:17,mapboxGlAccessToken:3,pitch:18,showCollisions:0,showBoundaries:1,showDiff:2,viewMode:4,zoom:19})}}let Sp;nt.subscribe((e=>Sp=e));const Ep=["locations"],Mp=["showCollisions","showBoundaries","showDiff"],Ip=["bearing","center","pitch","zoom"],Pp=["bearing","lat","lng","pitch","zoom"],Lp=["map","stylePresets"];const Fp=(e,t)=>[...t.filter((e=>"sublist"!==e.type)),...t.filter((e=>"sublist"===e.type)).flatMap((e=>e.presets))].find((t=>t.id===e)),kp=(e,t)=>{const i=t.find((t=>t.id===e.branchId));return i?{...i,url:_u(i.pattern,e.branch,e.branchStyle)}:null},zp=(e,t)=>JSON.parse(e).map((e=>{let i=Fp(e.id,t?.stylePresets??[]);return i||(i=kp(e,t?.branchPatterns??[])),i?(i=je(i),e?.selectedPrecompileOption&&(i.selectedPrecompileOption=e?.selectedPrecompileOption),{...i,...e}):e})).filter((e=>e)),Rp=({zoom:e,center:t,pitch:i,bearing:r})=>[lt(e,2),lt(t.lat,4),lt(t.lng,4),lt(i??0,1),lt(r??0,1)].join("/"),Dp=e=>{const[t,i,r,n,o]=e.split("/");return{bearing:o,center:{lat:i,lng:r},pitch:n,zoom:t}};const Op=(e,t)=>{let i=Object.fromEntries(Object.entries(e).filter((([e,t])=>!Ip.includes(e)&&"locations"!==e)).map((([e,i])=>{let r=i;return"maps"===e?r=((e,t)=>{const i=e.map((e=>{let i,r={id:e.id};if(e.branchId?(i=kp(e,t?.branchPatterns??[]),r={branchId:i.id,branchStyle:e.branchStyle,branch:e.branch}):i=Fp(e.id,t.stylePresets),!i)return Object.fromEntries(Object.entries(e).filter((([e])=>"style"!==e)));if(e.renderer!==i.renderer&&(r.renderer=e.renderer),e?.selectedPrecompileOption){const t=e.selectedPrecompileOption??[],n=i?.precompile?.options?.default??[];t.every((e=>n.includes(e)))&&n.every((e=>t.includes(e)))||(r.selectedPrecompileOption=e.selectedPrecompileOption)}return r}));return JSON.stringify(i)})(i,t):Ep.includes(e)&&(r=JSON.stringify(i)),[e,r]})));i=(e=>{let t=Object.keys(e).reduce(((t,i)=>{const r=e[i];return Mp.includes(i)&&!r||null!==r&&(t[i]=r),t}),{});return t})(i);const r=Up(window.location.hash,t),n=Object.entries(i).some((e=>{let[t,i]=e;if(Lp.includes(t))return!1;try{i=JSON.parse(i)}catch(e){}return!gd(i,r?.[t])}));let o={...i};o=Sp?{map:Rp(e),...o}:{locations:JSON.stringify(e.locations.map((e=>Rp(e)))),...o};const s=function(e){let t=e.map?`map=${e.map}`:"";return Object.entries(e).forEach((([e,i],r)=>{if(Lp.includes(e))return;let n=encodeURIComponent(i);t=`${t}${""!==t?"&":""}${e}=${n}`})),t}(o);return{nextHash:s,requiresHistoryItem:n}};function Up(e,t){let i=Object.fromEntries(Object.entries(function(e){const t=e.split("#")[1];if(!t)return{};let i=Object.fromEntries(t.split("&").map((e=>e.split("=").map(decodeURIComponent))));return i.map&&(i={...i,...Dp(i.map)}),i.locations&&(i.locations=JSON.stringify(JSON.parse(i.locations).map((e=>Dp(e))))),i}(e)).filter((([e,t])=>!!t)).map((([e,i])=>"maps"===e?[e,zp(i,t)]:Ep.includes(e)?[e,JSON.parse(i)]:Mp.includes(e)?[e,"true"===i]:Pp.includes(e)?[e,+i||0]:[e,i])));return i.map&&delete i.map,i}const Np=e=>{const{mapState:t,maps:i,viewMode:r,stylePresets:n}=e;return{...t,viewMode:r,maps:i,stylePresets:n,...Up(window.location.hash,e)}};var Qp={};Object.defineProperty(Qp,"__esModule",{value:!0}),Qp.updateStyle=Wp=Qp.addLink=void 0;var jp={};Object.defineProperty(jp,"__esModule",{value:!0}),jp.stamenSvg=void 0;function Vp(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var i=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==i)return;var r,n,o=[],s=!0,a=!1;try{for(i=i.call(e);!(s=(r=i.next()).done)&&(o.push(r.value),!t||o.length!==t);s=!0);}catch(e){a=!0,n=e}finally{try{s||null==i.return||i.return()}finally{if(a)throw n}}return o}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Hp(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);"Object"===i&&e.constructor&&(i=e.constructor.name);if("Map"===i||"Set"===i)return Array.from(e);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return Hp(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Hp(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,r=new Array(t);i<t;i++)r[i]=e[i];return r}jp.stamenSvg='<?xml version="1.0" encoding="utf-8"?>\n\x3c!-- Generator: Adobe Illustrator 24.0.3, SVG Export Plug-In . SVG Version: 6.00 Build 0)  --\x3e\n<svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"\n\t viewBox="0 0 98.6 21.7" style="enable-background:new 0 0 98.6 21.7;" xml:space="preserve">\n<g id="palnts">\n</g>\n<path d="M4.1,14.8c0.1,0.9,0.4,1.6,0.8,2.1c0.7,0.8,1.9,1.3,3.7,1.3c1,0,1.9-0.1,2.5-0.3c1.2-0.4,1.8-1.2,1.8-2.4\n\tc0-0.7-0.3-1.2-0.9-1.6c-0.6-0.4-1.6-0.7-2.9-1l-2.2-0.5c-2.2-0.5-3.7-1-4.5-1.6C1,9.9,0.3,8.4,0.3,6.4c0-1.8,0.7-3.4,2-4.6\n\tC3.7,0.6,5.7,0,8.4,0c2.2,0,4.1,0.6,5.6,1.7c1.6,1.2,2.4,2.8,2.4,5h-4.1c-0.1-1.2-0.6-2.1-1.7-2.6C9.9,3.7,9.1,3.6,8.1,3.6\n\tc-1.1,0-2,0.2-2.7,0.7s-1,1.1-1,1.9c0,0.7,0.3,1.3,1,1.6C5.7,8,6.7,8.3,8.1,8.6l3.6,0.9c1.6,0.4,2.8,0.9,3.6,1.5\n\tc1.2,1,1.8,2.4,1.8,4.2c0,1.9-0.7,3.4-2.2,4.7c-1.5,1.2-3.5,1.9-6.2,1.9S3.9,21.2,2.3,20C0.8,18.7,0,17,0,14.8H4.1z" fill=\'white\'/>\n<path d="M17.6,8.9V6.1h2.1V1.9h3.9v4.2h2.5v2.8h-2.5v8c0,0.6,0.1,1,0.2,1.2c0.2,0.2,0.6,0.2,1.5,0.2c0.1,0,0.2,0,0.4,0\n\tc0.1,0,0.3,0,0.4,0v3l-1.9,0.1c-1.9,0.1-3.2-0.3-3.9-1c-0.4-0.5-0.7-1.2-0.7-2.1V8.9H17.6z" fill=\'white\'/>\n<path d="M34.8,11.9c0.7-0.1,1.3-0.2,1.6-0.3c0.6-0.2,0.9-0.6,0.9-1.1c0-0.6-0.2-1.1-0.7-1.3s-1.1-0.4-1.9-0.4c-1,0-1.6,0.2-2,0.7\n\tc-0.3,0.3-0.5,0.8-0.6,1.4h-3.8c0.1-1.3,0.5-2.4,1.1-3.3c1.1-1.3,2.9-2,5.4-2c1.7,0,3.2,0.3,4.5,1s1.9,1.9,1.9,3.7v7\n\tc0,0.5,0,1.1,0,1.8c0,0.5,0.1,0.9,0.2,1.1s0.3,0.3,0.6,0.5v0.6h-4.3c-0.1-0.3-0.2-0.6-0.3-0.9c0-0.3-0.1-0.6-0.1-0.9\n\tc-0.6,0.6-1.2,1.1-1.9,1.5c-0.9,0.5-1.8,0.7-2.9,0.7c-1.4,0-2.5-0.4-3.4-1.2c-0.9-0.8-1.4-1.9-1.4-3.3c0-1.9,0.7-3.2,2.2-4.1\n\tc0.8-0.5,2-0.8,3.5-1L34.8,11.9z M37.2,13.8c-0.3,0.2-0.5,0.3-0.8,0.4c-0.3,0.1-0.6,0.2-1.1,0.3l-0.9,0.2c-0.8,0.1-1.5,0.3-1.8,0.5\n\tc-0.6,0.4-0.9,0.9-0.9,1.7c0,0.7,0.2,1.2,0.6,1.5c0.4,0.3,0.8,0.5,1.4,0.5c0.9,0,1.7-0.3,2.4-0.8s1.1-1.4,1.1-2.8\n\tC37.2,15.3,37.2,13.8,37.2,13.8z" fill=\'white\'/>\n<path d="M63.1,6c0.7,0.3,1.2,0.7,1.8,1.4c0.4,0.5,0.7,1.2,0.9,2c0.1,0.5,0.1,1.3,0.1,2.2v9.6h-4.1v-9.7c0-0.6-0.1-1.1-0.3-1.4\n\tc-0.4-0.7-1-1.1-2-1.1c-1.1,0-1.9,0.5-2.3,1.4c-0.2,0.5-0.3,1.1-0.3,1.7v9.1h-4v-9.1c0-0.9-0.1-1.6-0.3-2c-0.3-0.7-1-1.1-2-1.1\n\tc-1.1,0-1.9,0.4-2.3,1.1c-0.2,0.4-0.3,1-0.3,1.9v9.2h-4V6h3.9v2.2c0.5-0.8,1-1.4,1.4-1.7c0.8-0.6,1.8-0.9,3-0.9s2.1,0.3,2.8,0.8\n\tc0.6,0.5,1,1.1,1.3,1.8c0.5-0.9,1.2-1.6,1.9-2C59.1,5.8,60,5.6,61,5.6C61.7,5.6,62.4,5.8,63.1,6z" fill=\'white\'/>\n<path d="M78.9,6.3c1.1,0.5,1.9,1.2,2.6,2.3c0.6,0.9,1,2,1.2,3.1c0.1,0.7,0.2,1.7,0.1,3H71.7c0.1,1.5,0.6,2.6,1.6,3.2\n\tc0.6,0.4,1.3,0.6,2.2,0.6c0.9,0,1.6-0.2,2.2-0.7c0.3-0.3,0.6-0.6,0.8-1h4.1c-0.1,0.9-0.6,1.8-1.5,2.8c-1.4,1.5-3.3,2.2-5.7,2.2\n\tc-2,0-3.8-0.6-5.4-1.9s-2.3-3.3-2.3-6.1c0-2.6,0.7-4.7,2.1-6.1s3.2-2.1,5.4-2.1C76.6,5.6,77.8,5.8,78.9,6.3z M72.9,9.7\n\tc-0.6,0.6-0.9,1.4-1.1,2.4h6.9c-0.1-1.1-0.4-1.9-1.1-2.4s-1.4-0.8-2.4-0.8C74.2,8.8,73.5,9.1,72.9,9.7z" fill=\'white\'/>\n<path d="M97.1,6.8c1,0.8,1.5,2.2,1.5,4.1v10.3h-4.1v-9.3c0-0.8-0.1-1.4-0.3-1.8c-0.4-0.8-1.1-1.2-2.2-1.2c-1.3,0-2.3,0.6-2.8,1.7\n\tC89,11.2,88.8,12,88.8,13v8.2h-4V6h3.9v2.2c0.5-0.8,1-1.3,1.4-1.7C91,5.9,92,5.6,93.3,5.6C94.8,5.6,96.1,6,97.1,6.8z" fill=\'white\'/>\n</svg>';var Gp=function(e,t){Object.entries(t).forEach((function(t){var i=Vp(t,2),r=i[0],n=i[1];e.style[r]=n}))},$p=document.createElement("img");$p.src="data:image/svg+xml;charset=utf-8,".concat(jp.stamenSvg);var Zp=document.createElement("a");Zp.href="https://stamen.com";var qp=document.createElement("div");Gp($p,{height:"24px",position:"absolute",bottom:"-1px"});Gp(Zp,{width:"110px",position:"relative"});Gp(qp,{position:"fixed",bottom:"0px",right:"12px",zIndex:1e4,display:"flex",flexDirection:"row-reverse"}),Zp.appendChild($p),qp.appendChild(Zp),document.body.appendChild(qp);Qp.updateStyle=function(e){for(var t=0,i=Object.entries(e);t<i.length;t++){var r=Vp(i[t],2),n=r[0],o=r[1];qp.style[n]=o}};var Kp=!1,Wp=Qp.addLink=function(e,t){Zp.style.marginRight="6px";var i=document.createElement("a");i.innerHTML=t,i.href=e;var r=document.createElement("div");r.innerHTML=Kp?"|":" ",qp.appendChild(r),qp.appendChild(i);var n={color:"white",marginRight:"6px",marginBottom:"6px",fontSize:"14px"};Gp(i,n),Gp(r,n),Kp=!0};function Xp(e){let t,r,n,o,s,a,l,c,u,h;o=new Kd({props:{maps:e[2],mapState:e[1],viewMode:e[0].viewMode}}),o.$on("mapState",e[4]),o.$on("setDimensions",e[6]);const d=[{mapboxGlAccessToken:e[3]},e[1],{viewMode:e[0].viewMode}];let p={};for(let e=0;e<d.length;e+=1)p=i(p,d[e]);return u=new Cp({props:p}),u.$on("mapState",e[4]),u.$on("viewMode",e[5]),{c(){t=b("base"),r=B(),n=b("main"),de(o.$$.fragment),s=B(),a=b("div"),l=B(),c=b("div"),de(u.$$.fragment),E(t,"href","/"),E(a,"class","attribution-space svelte-bsitwh"),E(c,"class","map-controls-container svelte-bsitwh"),E(n,"class","svelte-bsitwh")},m(e,i){_(document.head,t),y(e,r,i),y(e,n,i),pe(o,n,null),_(n,s),_(n,a),_(n,l),_(n,c),pe(u,c,null),h=!0},p(e,[t]){const i={};4&t&&(i.maps=e[2]),2&t&&(i.mapState=e[1]),1&t&&(i.viewMode=e[0].viewMode),o.$set(i);const r=11&t?ue(d,[8&t&&{mapboxGlAccessToken:e[3]},2&t&&he(e[1]),1&t&&{viewMode:e[0].viewMode}]):{};u.$set(r)},i(e){h||(le(o.$$.fragment,e),le(u.$$.fragment,e),h=!0)},o(e){ce(o.$$.fragment,e),ce(u.$$.fragment,e),h=!1},d(e){v(t),e&&v(r),e&&v(n),fe(o),fe(u)}}}function Yp(e,t,i){let r;l(e,ot,(e=>i(9,r=e))),Wp("https://stamen.com/blog/","Learn more"),Wp("https://github.com/stamen/maperture","Fork on Github");let{localConfig:n}=t;const o=(e=>({maps:[{id:"mapbox-streets",name:"Mapbox Streets",type:"mapbox-gl",url:"mapbox://styles/mapbox/streets-v11"},{id:"mapbox-light",name:"Mapbox Light",type:"mapbox-gl",url:"mapbox://styles/mapbox/light-v10"}].map(((t,i)=>e?.stylePresets?.[i]??t)),mapState:{bearing:0,center:{lng:-73.92169,lat:40.83962},pitch:0,showCollisions:!1,showBoundaries:!1,showDiff:!1,zoom:13.25},viewMode:"swipe",gazetteer:{Scenarios:[{"Zoomed out":{pitch:0,zoom:10}},{"Zoomed in/Tilted":{pitch:45,zoom:16}}],Locations:[{"San Francisco, CA":{zoom:18,center:{lng:-122.4193,lat:37.7648}}},{"Washington DC":{zoom:12,center:{lng:-77.0435,lat:38.9098}}}]},branchPatterns:[{pattern:"",styles:[]}],stylePresetUrls:[],...e}))(n),{mapboxGlAccessToken:s,stylePresetUrls:a}=o;it.set(o);let c=Np(o),u={},h=!1;const d=()=>location.hash.slice(1)!==Op(c,o)?.nextHash;et.set(c.maps.map(((e,t)=>({...e,index:t})))),tt.set(c.stylePresets),ot.set(c?.locations??null),r&&r.length&&nt.set(!1);let p=[];j((()=>{a.length>0&&a.forEach((async e=>{const t=await(async e=>{const t=await fetch(e),i=await t.json();return at(i)?i:(console.warn(`Style presets at ${e} is not valid, check the format`),[])})(e);tt.update((e=>[...e,...t]))}))})),window.addEventListener("hashchange",(()=>{if(!h&&d()){const e=Np(o);if(i(0,c=e),c.maps.length){const e=c.maps.map(((e,t)=>({...e,index:t})));et.set(e)}}h=!1})),et.subscribe((e=>{const t=je(e).map((e=>(delete e.isPolling,e)));i(0,c={...c,maps:t})})),ot.subscribe((e=>{i(0,c={...c,locations:e})})),nt.subscribe((e=>{if(!e&&!r){const e=p.map((()=>u));ot.set(e)}e&&r&&ot.set(null)}));const f=Ct((()=>{d()&&(h=!0,function(e,t){const{nextHash:i,requiresHistoryItem:r}=Op(e,t);r?window.location.hash=i:window.location.replace(`${window.location.pathname}#${i}`)}(c,o))}),250);return"unavailable"===Ze.getRTLTextPluginStatus()&&Ze.setRTLTextPlugin("https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-rtl-text/v0.2.0/mapbox-gl-rtl-text.js"),"unavailable"===We.getRTLTextPluginStatus()&&We.setRTLTextPlugin("https://unpkg.com/@mapbox/mapbox-gl-rtl-text@0.2.3/mapbox-gl-rtl-text.min.js"),e.$$set=e=>{"localConfig"in e&&i(7,n=e.localConfig)},e.$$.update=()=>{5&e.$$.dirty&&(gd(p,c.maps)||i(2,p=c.maps)),6&e.$$.dirty&&i(1,u=Ad(u,p)),1&e.$$.dirty&&c&&f(),1&e.$$.dirty&&(c||height||width)&&i(1,u=(()=>{const{bearing:e,center:t,pitch:i,showCollisions:r,showBoundaries:n,showDiff:o,zoom:s,height:a,width:l}=c;return{bearing:e,center:t,pitch:i,showCollisions:r,showBoundaries:n,showDiff:o,zoom:s,...a&&{height:a},...l&&{width:l}}})())},[c,u,p,s,e=>{let t={...u,...e.detail.options};i(0,c={...c,...Ad(t,p)})},e=>{i(0,c={...c,viewMode:e.detail.mode})},e=>{i(0,c={...c,...e.detail})},n]}class Jp extends me{constructor(e){super(),Ae(this,e,Yp,Xp,a,{localConfig:7})}}const ef=(e,t)=>new Jp({target:e,props:t});var tf=Object.freeze({__proto__:null,default:undefined}),rf=Object.freeze({__proto__:null,default:undefined});class nf extends Map{#e=0;#t=new Map;#i=new Map;#r;#n;#o;constructor(e={}){if(super(),!(e.maxSize&&e.maxSize>0))throw new TypeError("`maxSize` must be a number greater than 0");if("number"==typeof e.maxAge&&0===e.maxAge)throw new TypeError("`maxAge` must be a number greater than 0");this.#r=e.maxSize,this.#n=e.maxAge||Number.POSITIVE_INFINITY,this.#o=e.onEviction}get __oldCache(){return this.#i}#s(e){if("function"==typeof this.#o)for(const[t,i]of e)this.#o(t,i.value)}#a(e,t){return"number"==typeof t.expiry&&t.expiry<=Date.now()&&("function"==typeof this.#o&&this.#o(e,t.value),this.delete(e))}#l(e,t){if(!1===this.#a(e,t))return t.value}#c(e,t){return t.expiry?this.#l(e,t):t.value}#u(e,t){const i=t.get(e);return this.#c(e,i)}#h(e,t){this.#t.set(e,t),this.#e++,this.#e>=this.#r&&(this.#e=0,this.#s(this.#i),this.#i=this.#t,this.#t=new Map)}#d(e,t){this.#i.delete(e),this.#h(e,t)}*#p(){for(const e of this.#i){const[t,i]=e;if(!this.#t.has(t)){!1===this.#a(t,i)&&(yield e)}}for(const e of this.#t){const[t,i]=e;!1===this.#a(t,i)&&(yield e)}}get(e){if(this.#t.has(e)){const t=this.#t.get(e);return this.#c(e,t)}if(this.#i.has(e)){const t=this.#i.get(e);if(!1===this.#a(e,t))return this.#d(e,t),t.value}}set(e,t,{maxAge:i=this.#n}={}){const r="number"==typeof i&&i!==Number.POSITIVE_INFINITY?Date.now()+i:void 0;return this.#t.has(e)?this.#t.set(e,{value:t,expiry:r}):this.#h(e,{value:t,expiry:r}),this}has(e){return this.#t.has(e)?!this.#a(e,this.#t.get(e)):!!this.#i.has(e)&&!this.#a(e,this.#i.get(e))}peek(e){return this.#t.has(e)?this.#u(e,this.#t):this.#i.has(e)?this.#u(e,this.#i):void 0}delete(e){const t=this.#t.delete(e);return t&&this.#e--,this.#i.delete(e)||t}clear(){this.#t.clear(),this.#i.clear(),this.#e=0}resize(e){if(!(e&&e>0))throw new TypeError("`maxSize` must be a number greater than 0");const t=[...this.#p()],i=t.length-e;i<0?(this.#t=new Map(t),this.#i=new Map,this.#e=t.length):(i>0&&this.#s(t.slice(0,i)),this.#i=new Map(t.slice(i)),this.#t=new Map,this.#e=0),this.#r=e}*keys(){for(const[e]of this)yield e}*values(){for(const[,e]of this)yield e}*[Symbol.iterator](){for(const e of this.#t){const[t,i]=e;!1===this.#a(t,i)&&(yield[t,i.value])}for(const e of this.#i){const[t,i]=e;if(!this.#t.has(t)){!1===this.#a(t,i)&&(yield[t,i.value])}}}*entriesDescending(){let e=[...this.#t];for(let t=e.length-1;t>=0;--t){const i=e[t],[r,n]=i;!1===this.#a(r,n)&&(yield[r,n.value])}e=[...this.#i];for(let t=e.length-1;t>=0;--t){const i=e[t],[r,n]=i;if(!this.#t.has(r)){!1===this.#a(r,n)&&(yield[r,n.value])}}}*entriesAscending(){for(const[e,t]of this.#p())yield[e,t.value]}get size(){if(!this.#e)return this.#i.size;let e=0;for(const t of this.#i.keys())this.#t.has(t)||e++;return Math.min(this.#e+e,this.#r)}get maxSize(){return this.#r}entries(){return this.entriesAscending()}forEach(e,t=this){for(const[i,r]of this.entriesAscending())e.call(t,r,i,this)}get[Symbol.toStringTag](){return"QuickLRU"}toString(){return`QuickLRU(${this.size}/${this.maxSize})`}[Symbol.for("nodejs.util.inspect.custom")](){return this.toString()}}const of=new class{constructor(){this._apiKey="",this._fetch="undefined"!=typeof self?fetch.bind(self):"undefined"!=typeof global&&global.fetch?global.fetch:null,this.tileCacheSize=200}set apiKey(e){this._apiKey=e}get apiKey(){return this._apiKey}set fetch(e){this._fetch=e}get fetch(){return this._fetch}},sf={AUTO:{code:null,flag:"auto",name:"Auto",latin:!1,isMode:!0,geocoding:!0},LATIN:{code:"latin",flag:"name:latin",name:"Latin",latin:!0,isMode:!1,geocoding:!1},NON_LATIN:{code:"nonlatin",flag:"name:nonlatin",name:"Non Latin",latin:!1,isMode:!1,geocoding:!1},LOCAL:{code:null,flag:"name",name:"Local",latin:!0,isMode:!1,geocoding:!1},ALBANIAN:{code:"sq",flag:"name:sq",name:"Albanian",latin:!0,isMode:!1,geocoding:!0},AMHARIC:{code:"am",flag:"name:am",name:"Amharic",latin:!1,isMode:!1,geocoding:!0},ARABIC:{code:"ar",flag:"name:ar",name:"Arabic",latin:!1,isMode:!1,geocoding:!0},ARMENIAN:{code:"hy",flag:"name:hy",name:"Armenian",latin:!1,isMode:!1,geocoding:!0},AZERBAIJANI:{code:"az",flag:"name:az",name:"Azerbaijani",latin:!0,isMode:!1,geocoding:!0},BASQUE:{code:"eu",flag:"name:eu",name:"Basque",latin:!0,isMode:!1,geocoding:!0},BELARUSIAN:{code:"be",flag:"name:be",name:"Belarusian",latin:!1,isMode:!1,geocoding:!0},BENGALI:{code:"bn",flag:"name:bn",name:"Bengali",latin:!0,isMode:!1,geocoding:!0},BOSNIAN:{code:"bs",flag:"name:bs",name:"Bosnian",latin:!0,isMode:!1,geocoding:!0},BRETON:{code:"br",flag:"name:br",name:"Breton",latin:!0,isMode:!1,geocoding:!0},BULGARIAN:{code:"bg",flag:"bg",name:"Bulgarian",latin:!1,isMode:!1,geocoding:!0},CATALAN:{code:"ca",flag:"name:ca",name:"Catalan",latin:!0,isMode:!1,geocoding:!0},CHINESE:{code:"zh",flag:"name:zh",name:"Chinese",latin:!1,isMode:!1,geocoding:!0},TRADITIONAL_CHINESE:{code:"zh-Hant",flag:"name:zh-Hant",name:"Chinese (traditional)",latin:!1,isMode:!1,geocoding:!1},SIMPLIFIED_CHINESE:{code:"zh-Hans",flag:"name:zh-Hans",name:"Chinese (simplified)",latin:!1,isMode:!1,geocoding:!1},CORSICAN:{code:"co",flag:"name:co",name:"Corsican",latin:!0,isMode:!1,geocoding:!0},CROATIAN:{code:"hr",flag:"name:hr",name:"Croatian",latin:!0,isMode:!1,geocoding:!0},CZECH:{code:"cs",flag:"name:cs",name:"Czech",latin:!0,isMode:!1,geocoding:!0},DANISH:{code:"da",flag:"name:da",name:"Danish",latin:!0,isMode:!1,geocoding:!0},DUTCH:{code:"nl",flag:"name:nl",name:"Dutch",latin:!0,isMode:!1,geocoding:!0},GERMAN:{code:"de",flag:"name:de",name:"German",latin:!0,isMode:!1,geocoding:!0},GREEK:{code:"el",flag:"name:el",name:"Greek",latin:!1,isMode:!1,geocoding:!0},ENGLISH:{code:"en",flag:"name:en",name:"English",latin:!0,isMode:!1,geocoding:!0},ESPERANTO:{code:"eo",flag:"name:eo",name:"Esperanto",latin:!0,isMode:!1,geocoding:!0},ESTONIAN:{code:"et",flag:"name:et",name:"Estonian",latin:!0,isMode:!1,geocoding:!0},FINNISH:{code:"fi",flag:"name:fi",name:"Finnish",latin:!0,isMode:!1,geocoding:!0},FRENCH:{code:"fr",flag:"name:fr",name:"French",latin:!0,isMode:!1,geocoding:!0},FRISIAN:{code:"fy",flag:"name:fy",name:"Frisian (West)",latin:!0,isMode:!1,geocoding:!0},GEORGIAN:{code:"ka",flag:"name:ka",name:"Georgian",latin:!1,isMode:!1,geocoding:!0},HEBREW:{code:"he",flag:"name:he",name:"Hebrew",latin:!1,isMode:!1,geocoding:!0},HINDI:{code:"hi",flag:"name:hi",name:"Hindi",latin:!1,isMode:!1,geocoding:!0},HUNGARIAN:{code:"hu",flag:"name:hu",name:"Hungarian",latin:!0,isMode:!1,geocoding:!0},ICELANDIC:{code:"is",flag:"name:is",name:"Icelandic",latin:!0,isMode:!1,geocoding:!0},INDONESIAN:{code:"id",flag:"name:id",name:"Indonesian",latin:!0,isMode:!1,geocoding:!0},IRISH:{code:"ga",flag:"name:ga",name:"Irish",latin:!0,isMode:!1,geocoding:!0},ITALIAN:{code:"it",flag:"name:it",name:"Italian",latin:!0,isMode:!1,geocoding:!0},JAPANESE:{code:"ja",flag:"name:ja",name:"Japanese",latin:!1,isMode:!1,geocoding:!0},JAPANESE_HIRAGANA:{code:"ja-Hira",flag:"name:ja-Hira",name:"Japanese Hiragana form",latin:!1,isMode:!1,geocoding:!1},JAPANESE_2018:{code:"ja-Latn",flag:"name:ja-Latn",name:"Japanese (Latin 2018)",latin:!0,isMode:!1,geocoding:!1},JAPANESE_KANA:{code:"ja_kana",flag:"name:ja_kana",name:"Japanese (Kana)",latin:!1,isMode:!1,geocoding:!1},JAPANESE_LATIN:{code:"ja_rm",flag:"name:ja_rm",name:"Japanese (Latin script)",latin:!0,isMode:!1,geocoding:!1},KANNADA:{code:"kn",flag:"name:kn",name:"Kannada",latin:!0,isMode:!1,geocoding:!0},KAZAKH:{code:"kk",flag:"name:kk",name:"Kazakh",latin:!1,isMode:!1,geocoding:!0},KOREAN:{code:"ko",flag:"name:ko",name:"Korean",latin:!1,isMode:!1,geocoding:!0},KOREAN_LATIN:{code:"ko-Latn",flag:"name:ko-Latn",name:"Korean (Latin script)",latin:!0,isMode:!1,geocoding:!1},KURDISH:{code:"ku",flag:"name:ku",name:"Kurdish",latin:!0,isMode:!1,geocoding:!0},CLASSICAL_LATIN:{code:"la",flag:"name:la",name:"Latin",latin:!0,isMode:!1,geocoding:!0},LATVIAN:{code:"lv",flag:"name:lv",name:"Latvian",latin:!0,isMode:!1,geocoding:!0},LITHUANIAN:{code:"lt",flag:"name:lt",name:"Lithuanian",latin:!0,isMode:!1,geocoding:!0},LUXEMBOURGISH:{code:"lb",flag:"name:lb",name:"Luxembourgish",latin:!0,isMode:!1,geocoding:!0},MACEDONIAN:{code:"mk",flag:"name:mk",name:"Macedonian",latin:!1,isMode:!1,geocoding:!0},MALAYALAM:{code:"ml",flag:"name:ml",name:"Malayalam",latin:!1,isMode:!1,geocoding:!0},MALTESE:{code:"mt",flag:"name:mt",name:"Maltese",latin:!0,isMode:!1,geocoding:!0},NORWEGIAN:{code:"no",flag:"name:no",name:"Norwegian",latin:!0,isMode:!1,geocoding:!0},OCCITAN:{code:"oc",flag:"name:oc",name:"Occitan",latin:!0,isMode:!1,geocoding:!0},PERSIAN:{code:"fa",flag:"name:fa",name:"Persian",latin:!1,isMode:!1,geocoding:!0},POLISH:{code:"pl",flag:"name:pl",name:"Polish",latin:!0,isMode:!1,geocoding:!0},PORTUGUESE:{code:"pt",flag:"name:pt",name:"Portuguese",latin:!0,isMode:!1,geocoding:!0},PUNJABI:{code:"pa",flag:"name:pa",name:"Punjabi",latin:!1,isMode:!1,geocoding:!0},WESTERN_PUNJABI:{code:"pnb",flag:"name:pnb",name:"Western Punjabi",latin:!1,isMode:!1,geocoding:!1},ROMANIAN:{code:"ro",flag:"name:ro",name:"Romanian",latin:!0,isMode:!1,geocoding:!0},ROMANSH:{code:"rm",flag:"name:rm",name:"Romansh",latin:!0,isMode:!1,geocoding:!0},RUSSIAN:{code:"ru",flag:"name:ru",name:"Russian",latin:!1,isMode:!1,geocoding:!0},SERBIAN_CYRILLIC:{code:"sr",flag:"name:sr",name:"Serbian (Cyrillic script)",latin:!1,isMode:!1,geocoding:!0},SERBIAN_LATIN:{code:"sr-Latn",flag:"name:sr-Latn",name:"Serbian (Latin script)",latin:!0,isMode:!1,geocoding:!1},SCOTTISH_GAELIC:{code:"gd",flag:"name:gd",name:"Scottish Gaelic",latin:!0,isMode:!1,geocoding:!0},SLOVAK:{code:"sk",flag:"name:sk",name:"Slovak",latin:!0,isMode:!1,geocoding:!0},SLOVENE:{code:"sl",flag:"name:sl",name:"Slovene",latin:!0,isMode:!1,geocoding:!0},SPANISH:{code:"es",flag:"name:es",name:"Spanish",latin:!0,isMode:!1,geocoding:!0},SWEDISH:{code:"sv",flag:"name:sv",name:"Swedish",latin:!0,isMode:!1,geocoding:!0},TAMIL:{code:"ta",flag:"name:ta",name:"Tamil",latin:!1,isMode:!1,geocoding:!0},TELUGU:{code:"te",flag:"name:te",name:"Telugu",latin:!1,isMode:!1,geocoding:!0},THAI:{code:"th",flag:"name:th",name:"Thai",latin:!1,isMode:!1,geocoding:!0},TURKISH:{code:"tr",flag:"name:tr",name:"Turkish",latin:!0,isMode:!1,geocoding:!0},UKRAINIAN:{code:"uk",flag:"name:uk",name:"Ukrainian",latin:!1,isMode:!1,geocoding:!0},VIETNAMESE:{code:"vi",flag:"name:vi",name:"Vietnamese (Latin script)",latin:!0,isMode:!1,geocoding:!0},WELSH:{code:"cy",flag:"name:cy",name:"Welsh",latin:!0,isMode:!1,geocoding:!0}};function af(e,t=sf){return e in t?e[e]:null}function lf(e,t=sf){for(const i of Object.values(t))if(i.code===e)return i;return null}function cf(e,t=sf){for(const i of Object.values(t))if(i.flag===e)return i;return null}function uf(){if("undefined"==typeof navigator){return lf(Intl.DateTimeFormat().resolvedOptions().locale.split("-")[0])??sf.ENGLISH}const e=Array.from(new Set(navigator.languages.map((e=>e.split("-")[0])))).map((e=>lf(e))).filter((e=>e));return e[0]??sf.ENGLISH}function hf(e){return null!==e&&"object"==typeof e&&"code"in e&&"flag"in e&&"name"in e&&"latin"in e&&"isMode"in e&&"geocoding"in e&&("string"==typeof e.code||null===e.code)&&"string"==typeof e.flag&&"string"==typeof e.name&&"boolean"==typeof e.latin&&"boolean"==typeof e.isMode&&"boolean"==typeof e.geocoding}function df(e,t=sf){return hf(e)?cf(e.flag,t):"string"!=typeof e?null:af(e,t)||lf(e,t)||cf(e,t)||null}async function pf(e,t={}){if(null===of.fetch)throw new Error("The fetch function was not found. If on NodeJS < 18 please specify the fetch function with config.fetch");if(""===new URL(e).searchParams.get("key").trim())throw new Error("The MapTiler Cloud API key is missing. Set it in `config.apiKey` or get one for free at https://maptiler.com");return of.fetch(e,t)}const ff={maptilerApiURL:"https://api.maptiler.com/",mapStyle:"streets-v2"};Object.freeze(ff);class Af extends Error{constructor(e,t=""){super(`Call to enpoint ${e.url} failed with the status code ${e.status}. ${t}`),this.res=e}}const mf={400:"Query too long / Invalid parameters",403:"Key is missing, invalid or restricted"};function gf(e,t){const{language:i}=t;if(void 0===i)return;const r=(Array.isArray(i)?i:[i]).map((e=>function(e){const t=e===sf.AUTO.flag?uf():"string"==typeof e?lf(e):hf(e)?e.flag===sf.AUTO.flag?uf():cf(e.flag):null;return t?.geocoding?t.code:null}(e))).filter((e=>e)),n=Array.from(new Set(r)).join(",");e.set("language",n)}function _f(e,t){const{apiKey:i,limit:r,types:n,excludeTypes:o}=t;e.set("key",i??of.apiKey),void 0!==r&&e.set("limit",String(r)),void 0!==n&&e.set("types",n.join(",")),void 0!==o&&e.set("excludeTypes",String(o)),gf(e,t)}function yf(e,t){_f(e,t);const{bbox:i,proximity:r,country:n,fuzzyMatch:o,autocomplete:s}=t;void 0!==i&&e.set("bbox",i.join(",")),void 0!==r&&e.set("proximity","ip"===r?r:r.join(",")),void 0!==n&&e.set("country",n.join(",")),void 0!==o&&e.set("fuzzyMatch",o?"true":"false"),void 0!==s&&e.set("autocomplete",s?"true":"false")}const vf={forward:async function(e,t={}){if("string"!=typeof e||0===e.trim().length)throw new Error("The query must be a non-empty string");const i=new URL(`geocoding/${encodeURIComponent(e)}.json`,ff.maptilerApiURL);yf(i.searchParams,t);const r=await pf(i.toString());if(!r.ok)throw new Af(r,mf[r.status]??"");return await r.json()},reverse:async function(e,t={}){if(!Array.isArray(e)||e.length<2)throw new Error("The position must be an array of form [lng, lat].");const i=new URL(`geocoding/${e[0]},${e[1]}.json`,ff.maptilerApiURL);_f(i.searchParams,t);const r=await pf(i.toString());if(!r.ok)throw new Af(r,mf[r.status]??"");return await r.json()},byId:async function(e,t={}){const i=new URL(`geocoding/${e}.json`,ff.maptilerApiURL);i.searchParams.set("key",t.apiKey??of.apiKey),gf(i.searchParams,t);const r=await pf(i.toString());if(!r.ok)throw new Af(r,mf[r.status]??"");return await r.json()},batch:async function(e,t={}){if(!e.length)return[];const i=e.map((e=>encodeURIComponent(e))).join(";"),r=new URL(`geocoding/${i}.json`,ff.maptilerApiURL);yf(r.searchParams,t);const n=await pf(r.toString());if(!n.ok)throw new Af(n,mf[n.status]??"");const o=await n.json();return 1===e.length?[o]:o}},xf={403:"Key is missing, invalid or restricted"};const bf={info:async function(e={}){const t=new URL("geolocation/ip.json",ff.maptilerApiURL);t.searchParams.set("key",e.apiKey??of.apiKey);const i=t.toString(),r=await pf(i);if(!r.ok)throw new Af(r,r.status in xf?xf[r.status]:"");return await r.json()}},wf={403:"Key is missing, invalid or restricted"};const Tf={search:async function(e,t={}){if("string"!=typeof e||0===e.trim().length)throw new Error("The query must be a non-empty string");const i=new URL(`coordinates/search/${e}.json`,ff.maptilerApiURL);i.searchParams.set("key",t.apiKey??of.apiKey),"limit"in t&&i.searchParams.set("limit",t.limit.toString()),"transformations"in t&&i.searchParams.set("transformations",t.transformations.toString()),"exports"in t&&i.searchParams.set("exports",t.exports.toString());const r=i.toString(),n=await pf(r);if(!n.ok)throw new Af(n,n.status in wf?wf[n.status]:"");return await n.json()},transform:async function(e,t={}){const i=(Array.isArray(e[0])?e:[e]).map((e=>`${e[0]},${e[1]}`)).join(";"),r=new URL(`coordinates/transform/${i}.json`,ff.maptilerApiURL);r.searchParams.set("key",t.apiKey??of.apiKey),"sourceCrs"in t&&r.searchParams.set("s_srs",t.sourceCrs.toString()),"targetCrs"in t&&r.searchParams.set("t_srs",t.targetCrs.toString()),"operations"in t&&r.searchParams.set("ops",(Array.isArray(t.operations)?t.operations:[t.operations]).join("|"));const n=r.toString(),o=await pf(n);if(!o.ok)throw new Af(o,o.status in wf?wf[o.status]:"");return await o.json()}},Bf={403:"Key is missing, invalid or restricted"};const Cf={get:async function(e,t={}){if("string"!=typeof e||0===e.trim().length)throw new Error("The data ID must be a non-empty string");const i=new URL(`data/${encodeURIComponent(e)}/features.json`,ff.maptilerApiURL);i.searchParams.set("key",t.apiKey??of.apiKey);const r=i.toString(),n=await pf(r);if(!n.ok)throw new Af(n,n.status in Bf?Bf[n.status]:"");return await n.json()}};function Sf(e){let t;const i=e.trim();let r;return r=i.startsWith("http://")||i.startsWith("https://")?i:null!==(t=/^maptiler:\/\/(.*)/.exec(i))?`https://api.maptiler.com/maps/${t[1]}/style.json`:`https://api.maptiler.com/maps/${i}/style.json`,r}class Ef{constructor(e,t,i,r,n,o,s=!1){this.name=e,this.variantType=t,this.id=i,this.referenceStyle=r,this.description=n,this.imageURL=o,this.deprecated=s}getName(){return this.name}getFullName(){return`${this.referenceStyle.getName()} ${this.name}`}getType(){return this.variantType}getId(){return this.id}getDescription(){return this.description}getReferenceStyle(){return this.referenceStyle}hasVariant(e){return this.referenceStyle.hasVariant(e)}getVariant(e){const t=this.referenceStyle.getVariant(e);return this.warnIfDeprecated(t),t}getVariants(){return this.referenceStyle.getVariants().filter((e=>e!==this)).map((e=>(this.warnIfDeprecated(e),e)))}getImageURL(){return this.imageURL}getExpandedStyleURL(){return Sf(this.getId())}warnIfDeprecated(e=this){if(!e.deprecated)return e;const t=e.getFullName();return console.warn(`Style "${t}" is deprecated and will be removed in a future version.`),e}}class Mf{constructor(e,t){this.name=e,this.id=t,this.variants={},this.orderedVariants=[]}getName(){return this.name}getId(){return this.id}addVariant(e){this.variants[e.getType()]=e,this.orderedVariants.push(e)}hasVariant(e){return e in this.variants}getVariant(e){return e in this.variants?this.variants[e]:this.orderedVariants[0]}getVariants(){return Object.values(this.variants)}getDefaultVariant(){return this.orderedVariants[0].warnIfDeprecated()}}const If=[{referenceStyleID:"STREETS",name:"Streets",description:"",variants:[{id:"streets-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"streets-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"streets-v2-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""},{id:"streets-v2-night",name:"Night",variantType:"NIGHT",description:"",imageURL:""},{id:"streets-v2-pastel",name:"Pastel",variantType:"PASTEL",description:"",imageURL:""}]},{referenceStyleID:"OUTDOOR",name:"Outdoor",description:"",variants:[{id:"outdoor-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"outdoor-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""}]},{referenceStyleID:"WINTER",name:"Winter",description:"",variants:[{id:"winter-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"winter-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""}]},{referenceStyleID:"SATELLITE",name:"Satellite",description:"",variants:[{id:"satellite",name:"Default",variantType:"DEFAULT",description:"",imageURL:""}]},{referenceStyleID:"HYBRID",name:"Hybrid",description:"",variants:[{id:"hybrid",deprecated:!0,name:"Default",variantType:"DEFAULT",description:"",imageURL:""}]},{referenceStyleID:"BASIC",name:"Basic",description:"",variants:[{id:"basic-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"basic-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"basic-v2-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""}]},{referenceStyleID:"BRIGHT",name:"Bright",description:"",variants:[{id:"bright-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"bright-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"bright-v2-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""},{id:"bright-v2-pastel",name:"Pastel",variantType:"PASTEL",description:"",imageURL:""}]},{referenceStyleID:"OPENSTREETMAP",name:"OpenStreetMap",description:"",variants:[{id:"openstreetmap",name:"Default",variantType:"DEFAULT",description:"",imageURL:""}]},{referenceStyleID:"TOPO",name:"Topo",description:"",variants:[{id:"topo-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"topo-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"topo-v2-shiny",name:"Shiny",deprecated:!0,variantType:"SHINY",description:"",imageURL:""},{id:"topo-v2-pastel",name:"Pastel",variantType:"PASTEL",description:"",imageURL:""},{id:"topo-v2-topographique",name:"Topographique",variantType:"TOPOGRAPHIQUE",description:"",imageURL:""}]},{referenceStyleID:"VOYAGER",name:"Voyager",description:"",variants:[{id:"voyager-v2",name:"Default",deprecated:!0,variantType:"DEFAULT",description:"",imageURL:""},{id:"voyager-v2-darkmatter",name:"Darkmatter",deprecated:!0,variantType:"DARK",description:"",imageURL:""},{id:"voyager-v2-positron",name:"Positron",deprecated:!0,variantType:"LIGHT",description:"",imageURL:""},{id:"voyager-v2-vintage",name:"Vintage",deprecated:!0,variantType:"VINTAGE",description:"",imageURL:""}]},{referenceStyleID:"TONER",name:"Toner",description:"",variants:[{id:"toner-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"toner-v2-background",name:"Background",variantType:"BACKGROUND",deprecated:!0,description:"",imageURL:""},{id:"toner-v2-lite",name:"Lite",variantType:"LITE",description:"",imageURL:""},{id:"toner-v2-lines",name:"Lines",variantType:"LINES",deprecated:!0,description:"",imageURL:""}]},{referenceStyleID:"DATAVIZ",name:"Dataviz",description:"",variants:[{id:"dataviz",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"dataviz-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"dataviz-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""}]},{referenceStyleID:"BACKDROP",name:"Backdrop",description:"",variants:[{id:"backdrop",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"backdrop-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"backdrop-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""}]},{referenceStyleID:"OCEAN",name:"Ocean",description:"",variants:[{id:"ocean",name:"Default",variantType:"DEFAULT",description:"",imageURL:""}]},{referenceStyleID:"AQUARELLE",name:"Aquarelle",description:"Watercolor map for creative use",variants:[{id:"aquarelle",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"aquarelle-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"aquarelle-vivid",name:"Vivid",variantType:"VIVID",description:"",imageURL:""}]},{referenceStyleID:"LANDSCAPE",name:"Landscape",description:"Terrain map for data overlays and visualisations",variants:[{id:"landscape",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"landscape-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"landscape-vivid",name:"Vivid",variantType:"VIVID",description:"",imageURL:""}]}];function Pf(e){return new Proxy(e,{get(t,i,r){if(t.hasVariant(i))return t.getVariant(i);if(i.toString().toUpperCase()===i)return e.getDefaultVariant();return Reflect.get(t,i,r)}})}function Lf(e){return e?"string"==typeof e||e instanceof String?e.trim().toLowerCase():e instanceof Ef?e.getId():e instanceof Mf?e.getDefaultVariant().getId():void 0:Ff[If[0].referenceStyleID].getDefaultVariant().getId()}const Ff=function(){const e={};for(let t=0;t<If.length;t+=1){const i=If[t],r=Pf(new Mf(i.name,i.referenceStyleID));for(let e=0;e<i.variants.length;e+=1){const t=i.variants[e],n=new Ef(t.name,t.variantType,t.id,r,t.description,t.imageURL,t.deprecated);r.addVariant(n)}e[i.referenceStyleID]=r}return e}();function kf(e,t,i){let r=t[0],n=t[1],o=i[0]-r,s=i[1]-n;if(0!==o||0!==s){const t=((e[0]-r)*o+(e[1]-n)*s)/(o*o+s*s);t>1?(r=i[0],n=i[1]):t>0&&(r+=o*t,n+=s*t)}return o=e[0]-r,s=e[1]-n,o*o+s*s}function zf(e,t,i,r,n){let o,s=r;for(let r=t+1;r<i;r++){const n=kf(e[r],e[t],e[i]);n>s&&(o=r,s=n)}s>r&&(o-t>1&&zf(e,t,o,r,n),n.push(e[o]),i-o>1&&zf(e,o,i,r,n))}function Rf(e,t){const i=e.length-1,r=[e[0]];return zf(e,0,i,t,r),r.push(e[i]),r}const Df={extractLineStrings:function(e){const t=[];function i(e){"LineString"!==e.type&&"MultiLineString"!==e.type||t.push(e)}function r(e){e.geometry&&i(e.geometry)}return"Feature"===e.type?r(e):"FeatureCollection"===e.type?function e(t){for(const i of t.features)"Feature"===i.type?r(i):"FeatureCollection"===i.type&&e(i)}(e):i(e),t},simplify:function(e,t){return e.length<=2?e:Rf(e,void 0!==t?t*t:1)}};function Of(e,t=!0){let i=`${e[0]},${e[1]}`;return 3===e.length&&t&&(i+=`,${e[2]}`),i}function Uf(e,t=3e3){let i=e.map((e=>e.join(","))).join("|"),r=5e-6;for(;i.length>t;){i=Df.simplify(e,r).map((e=>`${e[0]},${e[1]}`)).join("|"),r+=1e-5}return i}const Nf={centered:function(e,t,i={}){const r=Lf(i.style),n=i.hiDPI?"@2x":"",o=i.format??"png";let s=~~(i.width??1024),a=~~(i.height??1024);i.hiDPI&&(s=~~(s/2),a=~~(a/2));const l=new URL(`maps/${encodeURIComponent(r)}/static/${e[0]},${e[1]},${t}/${s}x${a}${n}.${o}`,ff.maptilerApiURL);if("attribution"in i&&l.searchParams.set("attribution",i.attribution.toString()),"markers"in i){let e="";const t="markerIcon"in i;t&&(e+=`icon:${i.markerIcon}|`),t&&"markerAnchor"in i&&(e+=`anchor:${i.markerAnchor}|`),t&&i.hiDPI&&(e+="scale:2|");e+=(Array.isArray(i.markers[0])?i.markers:[i.markers]).map((e=>Of(e,!t))).join("|"),l.searchParams.set("markers",e)}if("path"in i){let e="";if(e+=`fill:${i.pathFillColor??"none"}|`,"pathStrokeColor"in i&&(e+=`stroke:${i.pathStrokeColor}|`),"pathWidth"in i){e+=`width:${(i.pathWidth/(i.hiDPI?2:1)).toString()}|`}e+=Uf(i.path),l.searchParams.set("path",e)}return l.searchParams.set("key",i.apiKey??of.apiKey),l.toString()},bounded:function(e,t={}){const i=Lf(t.style),r=t.hiDPI?"@2x":"",n=t.format??"png";let o=~~(t.width??1024),s=~~(t.height??1024);t.hiDPI&&(o=~~(o/2),s=~~(s/2));const a=new URL(`maps/${encodeURIComponent(i)}/static/${e[0]},${e[1]},${e[2]},${e[3]}/${o}x${s}${r}.${n}`,ff.maptilerApiURL);if("attribution"in t&&a.searchParams.set("attribution",t.attribution.toString()),"padding"in t&&a.searchParams.set("padding",t.padding.toString()),"markers"in t){let e="";const i="markerIcon"in t;i&&(e+=`icon:${t.markerIcon}|`),i&&"markerAnchor"in t&&(e+=`anchor:${t.markerAnchor}|`),i&&t.hiDPI&&(e+="scale:2|");e+=(Array.isArray(t.markers[0])?t.markers:[t.markers]).map((e=>Of(e,!i))).join("|"),a.searchParams.set("markers",e)}if("path"in t){let e="";if(e+=`fill:${t.pathFillColor??"none"}|`,"pathStrokeColor"in t&&(e+=`stroke:${t.pathStrokeColor}|`),"pathWidth"in t){e+=`width:${(t.pathWidth/(t.hiDPI?2:1)).toString()}|`}e+=Uf(t.path),a.searchParams.set("path",e)}return a.searchParams.set("key",t.apiKey??of.apiKey),a.toString()},automatic:function(e={}){if(!("markers"in e)&&!("path"in e))throw new Error("Automatic static maps require markers and/or path to be created.");const t=Lf(e.style),i=e.hiDPI?"@2x":"",r=e.format??"png";let n=~~(e.width??1024),o=~~(e.height??1024);e.hiDPI&&(n=~~(n/2),o=~~(o/2));const s=new URL(`maps/${encodeURIComponent(t)}/static/auto/${n}x${o}${i}.${r}`,ff.maptilerApiURL);if("attribution"in e&&s.searchParams.set("attribution",e.attribution.toString()),"padding"in e&&s.searchParams.set("padding",e.padding.toString()),"markers"in e){let t="";const i="markerIcon"in e;i&&(t+=`icon:${e.markerIcon}|`),i&&"markerAnchor"in e&&(t+=`anchor:${e.markerAnchor}|`),i&&e.hiDPI&&(t+="scale:2|");t+=(Array.isArray(e.markers[0])?e.markers:[e.markers]).map((e=>Of(e,!i))).join("|"),s.searchParams.set("markers",t)}if("path"in e){let t="";if(t+=`fill:${e.pathFillColor??"none"}|`,"pathStrokeColor"in e&&(t+=`stroke:${e.pathStrokeColor}|`),"pathWidth"in e){t+=`width:${(e.pathWidth/(e.hiDPI?2:1)).toString()}|`}t+=Uf(e.path),s.searchParams.set("path",t)}return s.searchParams.set("key",e.apiKey??of.apiKey),s.toString()}},Qf=6371008.8,jf=2*Math.PI*Qf;function Vf(e){return(180+e)/360}function Hf(e){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e*Math.PI/360)))/360}function Gf(e){const t=Kf(e);return[Vf(t[0]),Hf(t[1])]}function $f(e){return 360*e-180}function Zf(e){const t=180-360*e;return 360/Math.PI*Math.atan(Math.exp(t*Math.PI/180))-90}function qf(e,t){const i=Math.PI/180,r=e[1]*i,n=t[1]*i,o=Math.sin(r)*Math.sin(n)+Math.cos(r)*Math.cos(n)*Math.cos((t[0]-e[0])*i);return Qf*Math.acos(Math.min(o,1))}function Kf(e){const t=((e[0]+180)%360+360)%360-180;return[-180===t?180:t,e[1]]}function Wf(e){return jf*Math.cos(e*Math.PI/180)}function Xf(e,t,i=!0){const r=2**t,n=[e[0]*r,e[1]*r];return i?[~~n[0],~~n[1]]:n}function Yf(e){return e*Math.PI/180}function Jf(e){return 180*e/Math.PI}const eA={EARTH_RADIUS:Qf,EARTH_CIRCUMFERENCE:jf,longitudeToMercatorX:Vf,latitudeToMercatorY:Hf,wgs84ToMercator:Gf,mercatorXToLongitude:$f,mercatorYToLatitude:Zf,mercatorToWgs84:function(e){return[$f(e[0]),Zf(e[1])]},haversineDistanceWgs84:qf,wrapWgs84:Kf,circumferenceAtLatitude:Wf,mercatorToTileIndex:Xf,wgs84ToTileIndex:function(e,t,i=!0){return Xf(Gf(e),t,i)},toRadians:Yf,toDegrees:Jf,haversineIntermediateWgs84:function(e,t,i){const r=qf(e,t),n=Yf(e[0]),o=Yf(e[1]),s=Yf(t[0]),a=Yf(t[1]),l=r/Qf,c=Math.sin((1-i)*l)/Math.sin(l),u=Math.sin(i*l)/Math.sin(l),h=c*Math.cos(o)*Math.cos(n)+u*Math.cos(a)*Math.cos(s),d=c*Math.cos(o)*Math.sin(n)+u*Math.cos(a)*Math.sin(s),p=c*Math.sin(o)+u*Math.sin(a),f=Math.atan2(p,Math.sqrt(h*h+d*d));return[Jf(Math.atan2(d,h)),Jf(f)]},haversineCumulatedDistanceWgs84:function(e){const t=Array(e.length);t[0]=0;const i=t.length;for(let r=1;r<i;r++)t[r]=qf(e[r-1],e[r])+t[r-1];return t}};let tA=null;function iA(){return tA||(tA=new nf({maxSize:of.tileCacheSize})),tA}async function rA(e){const t=new Blob([e]),i=await createImageBitmap(t),r=document.createElement("canvas"),n=r.getContext("2d");r.width=i.width,r.height=i.height,n.drawImage(i,0,0);const o=n.getImageData(0,0,r.width,r.height);return{pixels:o.data,width:r.width,height:r.height,components:o.data.length/(r.width*r.height)}}function nA(){if(of.bufferToPixelData)return of.bufferToPixelData;if("undefined"!=typeof window)return rA;throw new Error("An image file buffer to pixel data parser is necessary. Specify it in `config.bufferToPixelData`")}let oA=null;const sA={403:"Key is missing, invalid or restricted"};async function aA(e){const t=new URL("tiles/terrain-rgb-v2/tiles.json",ff.maptilerApiURL);t.searchParams.set("key",e);const i=t.toString(),r=await pf(i);if(r.ok)return oA=await r.json(),oA;if(!r.ok)throw new Af(r,sA[r.status]??"")}async function lA(e,t={}){const i=t.apiKey??of.apiKey;oA||await aA(i);const r=nA(),n=oA.tiles[0],o=iA(),s=oA.maxzoom;let a=~~(t.zoom??s);(a>s||a<0)&&(a=s);const l=e.map((e=>eA.wgs84ToTileIndex(e,a,!1))),c=l.map((e=>[~~e[0],~~e[1]])).map((e=>`terrain_${a.toString()}_${e[0].toString()}_${e[1].toString()}`)),u=Array.from(new Set(c.filter((e=>!o.has(e))))).map((e=>e.split("_").slice(1))),h=u.map((e=>n.replace("{x}",e[1].toString()).replace("{y}",e[2].toString()).replace("{z}",e[0].toString()))).map((e=>pf(e))),d=(await Promise.allSettled(h)).map((e=>"fulfilled"===e.status?e.value:null)).filter((e=>e)),p=d.filter((e=>!e.ok));if(d.length!==h.length)throw new Error("Some tiles could not be fetched.");if(p.length)throw new Af(p[0],sA[p[0].status]??"");const f=await Promise.all(d.map((e=>e.arrayBuffer())));if(!f.every((e=>e.byteLength>0)))throw new Error("Some tiles are not available.");(await Promise.all(f.map((e=>r(e))))).forEach(((e,t)=>{const i=u[t],r=`terrain_${i[0].toString()}_${i[1].toString()}_${i[2].toString()}`;o.set(r,e)}));const A=e.map(((e,t)=>{const i=c[t],r=l[t],n=o.get(i),s=Math.min(Math.round(n.width*(r[0]%1)),n.width-1),a=(Math.min(Math.round(n.height*(r[1]%1)),n.height-1)*n.width+s)*n.components,u=.1*(256*n.pixels[a]*256+256*n.pixels[a+1]+n.pixels[a+2])-1e4;return[e[0],e[1],~~(1e3*u)/1e3]}));if(t.smoothingKernelSize){const e=2*~~(t.smoothingKernelSize/2)+1,i=A.map((e=>e[2])),r=~~(e/2);for(let t=r;t<i.length-r-1;t+=1){let n=0;for(let o=0;o<e;o+=1){n+=i[t-r+o]}n/=e,A[t][2]=n}}return A}const cA={at:async function(e,t={}){const i=t.apiKey??of.apiKey;oA||await aA(i);const r=oA.maxzoom;let n=~~(t.zoom??r);(n>r||n<0)&&(n=r);const o=eA.wgs84ToTileIndex(e,n,!1),s=~~o[0],a=~~o[1];if(!oA.tiles.length)throw new Error("Terrain tileJSON tile list is empty.");const l=`terrain_${n.toString()}_${s.toString()}_${a.toString()}`;let c;const u=iA();if(u.has(l))c=u.get(l);else{const e=oA.tiles[0].replace("{x}",s.toString()).replace("{y}",a.toString()).replace("{z}",n.toString()),t=await pf(e);if(!t.ok)throw new Af(t,sA[t.status]??"");const i=await t.arrayBuffer(),r=nA();c=await r(i),u.set(l,c)}const h=~~(c.width*(o[0]%1)),d=(~~(c.height*(o[1]%1))*c.width+h)*c.components,p=.1*(256*c.pixels[d]*256+256*c.pixels[d+1]+c.pixels[d+2])-1e4;return[e[0],e[1],p]},batch:lA,fromLineString:async function(e,t={}){if("LineString"!==e.type)throw new Error("The provided object is not a GeoJSON LineString");const i=structuredClone(e),r=await lA(i.coordinates,t);return i.coordinates=r,i},fromMultiLineString:async function(e,t={}){if("MultiLineString"!==e.type)throw new Error("The provided object is not a GeoJSON MultiLineString");const i=structuredClone(e),r=i.coordinates.map((e=>e.length)),n=i.coordinates.flat(),o=await lA(n,t),s=[];let a=0;for(const e of r)s.push(o.slice(a,a+e)),a+=e;return i.coordinates=s,i}};var uA,hA={exports:{}},dA="object"==typeof Reflect?Reflect:null,pA=dA&&"function"==typeof dA.apply?dA.apply:function(e,t,i){return Function.prototype.apply.call(e,t,i)};uA=dA&&"function"==typeof dA.ownKeys?dA.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var fA=Number.isNaN||function(e){return e!=e};function AA(){AA.init.call(this)}hA.exports=AA,hA.exports.once=function(e,t){return new Promise((function(i,r){function n(i){e.removeListener(t,o),r(i)}function o(){"function"==typeof e.removeListener&&e.removeListener("error",n),i([].slice.call(arguments))}BA(e,t,o,{once:!0}),"error"!==t&&function(e,t,i){"function"==typeof e.on&&BA(e,"error",t,i)}(e,n,{once:!0})}))},AA.EventEmitter=AA,AA.prototype._events=void 0,AA.prototype._eventsCount=0,AA.prototype._maxListeners=void 0;var mA=10;function gA(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function _A(e){return void 0===e._maxListeners?AA.defaultMaxListeners:e._maxListeners}function yA(e,t,i,r){var n,o,s,a;if(gA(i),void 0===(o=e._events)?(o=e._events=Object.create(null),e._eventsCount=0):(void 0!==o.newListener&&(e.emit("newListener",t,i.listener?i.listener:i),o=e._events),s=o[t]),void 0===s)s=o[t]=i,++e._eventsCount;else if("function"==typeof s?s=o[t]=r?[i,s]:[s,i]:r?s.unshift(i):s.push(i),(n=_A(e))>0&&s.length>n&&!s.warned){s.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",l.emitter=e,l.type=t,l.count=s.length,a=l,console&&console.warn&&console.warn(a)}return e}function vA(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function xA(e,t,i){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:i},n=vA.bind(r);return n.listener=i,r.wrapFn=n,n}function bA(e,t,i){var r=e._events;if(void 0===r)return[];var n=r[t];return void 0===n?[]:"function"==typeof n?i?[n.listener||n]:[n]:i?function(e){for(var t=new Array(e.length),i=0;i<t.length;++i)t[i]=e[i].listener||e[i];return t}(n):TA(n,n.length)}function wA(e){var t=this._events;if(void 0!==t){var i=t[e];if("function"==typeof i)return 1;if(void 0!==i)return i.length}return 0}function TA(e,t){for(var i=new Array(t),r=0;r<t;++r)i[r]=e[r];return i}function BA(e,t,i,r){if("function"==typeof e.on)r.once?e.once(t,i):e.on(t,i);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function n(o){r.once&&e.removeEventListener(t,n),i(o)}))}}Object.defineProperty(AA,"defaultMaxListeners",{enumerable:!0,get:function(){return mA},set:function(e){if("number"!=typeof e||e<0||fA(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");mA=e}}),AA.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},AA.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||fA(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},AA.prototype.getMaxListeners=function(){return _A(this)},AA.prototype.emit=function(e){for(var t=[],i=1;i<arguments.length;i++)t.push(arguments[i]);var r="error"===e,n=this._events;if(void 0!==n)r=r&&void 0===n.error;else if(!r)return!1;if(r){var o;if(t.length>0&&(o=t[0]),o instanceof Error)throw o;var s=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw s.context=o,s}var a=n[e];if(void 0===a)return!1;if("function"==typeof a)pA(a,this,t);else{var l=a.length,c=TA(a,l);for(i=0;i<l;++i)pA(c[i],this,t)}return!0},AA.prototype.addListener=function(e,t){return yA(this,e,t,!1)},AA.prototype.on=AA.prototype.addListener,AA.prototype.prependListener=function(e,t){return yA(this,e,t,!0)},AA.prototype.once=function(e,t){return gA(t),this.on(e,xA(this,e,t)),this},AA.prototype.prependOnceListener=function(e,t){return gA(t),this.prependListener(e,xA(this,e,t)),this},AA.prototype.removeListener=function(e,t){var i,r,n,o,s;if(gA(t),void 0===(r=this._events))return this;if(void 0===(i=r[e]))return this;if(i===t||i.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,i.listener||t));else if("function"!=typeof i){for(n=-1,o=i.length-1;o>=0;o--)if(i[o]===t||i[o].listener===t){s=i[o].listener,n=o;break}if(n<0)return this;0===n?i.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(i,n),1===i.length&&(r[e]=i[0]),void 0!==r.removeListener&&this.emit("removeListener",e,s||t)}return this},AA.prototype.off=AA.prototype.removeListener,AA.prototype.removeAllListeners=function(e){var t,i,r;if(void 0===(i=this._events))return this;if(void 0===i.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==i[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete i[e]),this;if(0===arguments.length){var n,o=Object.keys(i);for(r=0;r<o.length;++r)"removeListener"!==(n=o[r])&&this.removeAllListeners(n);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=i[e]))this.removeListener(e,t);else if(void 0!==t)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this},AA.prototype.listeners=function(e){return bA(this,e,!0)},AA.prototype.rawListeners=function(e){return bA(this,e,!1)},AA.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):wA.call(e,t)},AA.prototype.listenerCount=wA,AA.prototype.eventNames=function(){return this._eventsCount>0?uA(this._events):[]};var CA=hA.exports;const SA=[];for(let e=0;e<256;++e)SA.push((e+256).toString(16).slice(1));let EA;const MA=new Uint8Array(16);var IA={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};const PA="function"==typeof Buffer,LA=("function"==typeof TextDecoder&&new TextDecoder,"function"==typeof TextEncoder&&new TextEncoder,Array.prototype.slice.call("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=")),FA=(()=>{let e={};return LA.forEach(((t,i)=>e[t]=i)),e})(),kA=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,zA=String.fromCharCode.bind(String),RA=("function"==typeof Uint8Array.from&&Uint8Array.from.bind(Uint8Array),e=>e.replace(/=/g,"").replace(/[+\/]/g,(e=>"+"==e?"-":"_"))),DA=e=>e.replace(/[^A-Za-z0-9\+\/]/g,""),OA=e=>{let t,i,r,n,o="";const s=e.length%3;for(let s=0;s<e.length;){if((i=e.charCodeAt(s++))>255||(r=e.charCodeAt(s++))>255||(n=e.charCodeAt(s++))>255)throw new TypeError("invalid character found");t=i<<16|r<<8|n,o+=LA[t>>18&63]+LA[t>>12&63]+LA[t>>6&63]+LA[63&t]}return s?o.slice(0,s-3)+"===".substring(s):o},UA="function"==typeof btoa?e=>btoa(e):PA?e=>Buffer.from(e,"binary").toString("base64"):OA,NA=PA?e=>Buffer.from(e).toString("base64"):e=>{let t=[];for(let i=0,r=e.length;i<r;i+=4096)t.push(zA.apply(null,e.subarray(i,i+4096)));return UA(t.join(""))},QA=(e,t=!1)=>t?RA(NA(e)):NA(e),jA=e=>{if(e=e.replace(/\s+/g,""),!kA.test(e))throw new TypeError("malformed base64.");e+="==".slice(2-(3&e.length));let t,i,r,n="";for(let o=0;o<e.length;)t=FA[e.charAt(o++)]<<18|FA[e.charAt(o++)]<<12|(i=FA[e.charAt(o++)])<<6|(r=FA[e.charAt(o++)]),n+=64===i?zA(t>>16&255):64===r?zA(t>>16&255,t>>8&255):zA(t>>16&255,t>>8&255,255&t);return n},VA=QA;var HA=Object.defineProperty,GA=e=>{throw TypeError(e)},$A=(e,t,i)=>((e,t,i)=>t in e?HA(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i)(e,"symbol"!=typeof t?t+"":t,i),ZA=(e,t,i)=>t.has(e)||GA("Cannot "+i),qA=(e,t,i)=>(ZA(e,t,"read from private field"),i?i.call(e):t.get(e)),KA=(e,t,i)=>t.has(e)?GA("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,i),WA=(e,t,i,r)=>(ZA(e,t,"write to private field"),r?r.call(e,i):t.set(e,i),i),XA=(e,t,i)=>(ZA(e,t,"access private method"),i);const YA={VISITOR:{code:null,flag:"visitor",name:"Visitor",latin:!0,isMode:!0,geocoding:!1},VISITOR_ENGLISH:{code:null,flag:"visitor_en",name:"Visitor English",latin:!0,isMode:!0,geocoding:!1},STYLE:{code:null,flag:"style",name:"Style",latin:!1,isMode:!0,geocoding:!1},STYLE_LOCK:{code:null,flag:"style_lock",name:"Style Lock",latin:!1,isMode:!0,geocoding:!1},...sf};function JA(){if(typeof navigator>"u"){return lf(Intl.DateTimeFormat().resolvedOptions().locale.split("-")[0])||YA.ENGLISH}return Array.from(new Set(navigator.languages.map((e=>e.split("-")[0])))).map((e=>lf(e))).filter((e=>e))[0]??YA.LOCAL}const em={maptilerLogoURL:"https://api.maptiler.com/resources/logo.svg",maptilerURL:"https://www.maptiler.com/",maptilerApiHost:"api.maptiler.com",telemetryURL:"https://api.maptiler.com/metrics",rtlPluginURL:"https://cdn.maptiler.com/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.min.js",primaryLanguage:YA.STYLE,secondaryLanguage:YA.LOCAL,terrainSourceURL:"https://api.maptiler.com/tiles/terrain-rgb-v2/tiles.json",terrainSourceId:"maptiler-terrain"};Object.freeze(em);const tm=function(e,t,i){if(IA.randomUUID&&!t&&!e)return IA.randomUUID();const r=(e=e||{}).random??e.rng?.()??function(){if(!EA){if("undefined"==typeof crypto||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");EA=crypto.getRandomValues.bind(crypto)}return EA(MA)}();if(r.length<16)throw new Error("Random bytes length must be >= 16");if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){if((i=i||0)<0||i+16>t.length)throw new RangeError(`UUID byte range ${i}:${i+15} is out of buffer bounds`);for(let e=0;e<16;++e)t[i+e]=r[e];return t}return function(e,t=0){return(SA[e[t+0]]+SA[e[t+1]]+SA[e[t+2]]+SA[e[t+3]]+"-"+SA[e[t+4]]+SA[e[t+5]]+"-"+SA[e[t+6]]+SA[e[t+7]]+"-"+SA[e[t+8]]+SA[e[t+9]]+"-"+SA[e[t+10]]+SA[e[t+11]]+SA[e[t+12]]+SA[e[t+13]]+SA[e[t+14]]+SA[e[t+15]]).toLowerCase()}(r)}();class im extends CA{constructor(){super(...arguments),$A(this,"primaryLanguage",em.primaryLanguage),$A(this,"secondaryLanguage"),$A(this,"session",!0),$A(this,"caching",!0),$A(this,"telemetry",!0),$A(this,"_unit","metric"),$A(this,"_apiKey","")}set unit(e){this._unit=e,this.emit("unit",e)}get unit(){return this._unit}set apiKey(e){this._apiKey=e,of.apiKey=e,this.emit("apiKey",e)}get apiKey(){return this._apiKey}set fetch(e){of.fetch=e}get fetch(){return of.fetch}}const rm=new im,nm="localcache_source",om="localcache",sm=typeof caches<"u";function am(e,t){if(sm&&rm.caching&&rm.session&&e.host===em.maptilerApiHost){if("Source"===t&&e.href.includes("tiles.json"))return e.href.replace("https://",`${nm}://`);if("Tile"===t||"Glyphs"===t)return e.href.replace("https://",`${om}://`)}return e.href}let lm;async function cm(){return lm||(lm=await caches.open("maptiler_sdk")),lm}let um=0;function hm(){Ke.exports.addProtocol(nm,(async(e,t)=>{if(!e.url)throw new Error("");e.url=e.url.replace(`${nm}://`,"https://");const i=e;i.signal=t.signal;const r=await fetch(e.url,i),n=await r.json();return n.tiles&&n.tiles.length>0&&(n.tiles[0]+=`&last-modified=${r.headers.get("Last-Modified")}`),{data:n,cacheControl:r.headers.get("Cache-Control"),expires:r.headers.get("Expires")}})),Ke.exports.addProtocol(om,(async(e,t)=>{if(!e.url)throw new Error("");e.url=e.url.replace(`${om}://`,"https://");const i=new URL(e.url),r=new URL(i);r.searchParams.delete("mtsid"),r.searchParams.delete("key");const n=r.toString(),o=new URL(i);o.searchParams.delete("last-modified");const s=o.toString(),a=async e=>({data:await e.arrayBuffer(),cacheControl:e.headers.get("Cache-Control"),expires:e.headers.get("Expires")}),l=await cm(),c=await l.match(n);if(c)return a(c);const u=e;u.signal=t.signal;const h=await fetch(s,u);return h.status>=200&&h.status<300&&(l.put(n,h.clone()).catch((()=>{})),++um>100&&(async function(){const e=await cm(),t=await e.keys(),i=t.slice(0,Math.max(t.length-1e3,0));for(const t of i)e.delete(t)}(),um=0)),a(h)}))}function dm(e,t){let i=null;try{i=new URL(e)}catch{return{url:e}}return i.host===em.maptilerApiHost&&(i.searchParams.has("key")||i.searchParams.append("key",rm.apiKey),rm.session&&i.searchParams.append("mtsid",tm)),{url:am(i,t)}}function pm(e){return(t,i)=>{if(null!=e){const r=e(t,i),n=dm((null==r?void 0:r.url)??"",i);return{...r,...n}}return dm(t,i)}}function fm(){return Math.random().toString(36).substring(2)}function Am(e){return/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/gi.test(e)}function mm(){return document.createElement("canvas").getContext("webgl2")?null:typeof WebGL2RenderingContext<"u"?"Graphic rendering with WebGL2 has been disabled or is not supported by your graphic card. The map cannot be displayed.":"Your browser does not support graphic rendering with WebGL2. The map cannot be displayed."}function gm(e,t){return!(!Array.isArray(e)||2!==e.length||"get"!==e[0]||"string"!=typeof e[1]||t&&!e[1].startsWith("name:")||!t&&"name"!==e[1])}function _m(e,t,i){const r=structuredClone(e),n=e=>{if("string"!=typeof e)for(let r=0;r<e.length;r+=1)gm(e[r],i)?e[r]=structuredClone(t):n(e[r])};return gm(r,i)?t:(n(r),r)}function ym(e,t){const i=t?/\{name:\S+\}/:/\{name\}/;return{contains:i.test(e),exactMatch:new RegExp(`^${i.source}$`).test(e)}}function vm(e,t,i){const r=i?/\{name:\S+\}/:/\{name\}/,n=e.split(r);return["concat",...n.flatMap(((e,i)=>i===n.length-1?[e]:[e,t]))]}function xm(e){var t;const i=/\{name(?:\:(?<language>\S+))?\}/g,r=[];for(;;){const n=i.exec(e);if(!n)break;const o=(null==(t=n.groups)?void 0:t.language)??null;r.push(o)}return r}function bm(e){return Array.isArray(e)&&2===e.length&&"get"===e[0]&&"string"==typeof e[1]?"name"===e[1].trim()?{isLanguage:!0,localization:null}:e[1].trim().startsWith("name:")?{isLanguage:!0,localization:e[1].trim().split(":").pop()}:null:null}function wm(e){const t=[],i=structuredClone(e),r=e=>{if("string"!=typeof e)for(let i=0;i<e.length;i+=1){const n=bm(e[i]);n?t.push(n.localization):r(e[i])}};return r([i]),t}let Tm=class extends We.Marker{addTo(e){return super.addTo(e)}};class Bm extends We.Popup{addTo(e){return super.addTo(e)}}class Cm extends We.Style{constructor(e,t={}){super(e,t)}}class Sm extends We.CanvasSource{onAdd(e){super.onAdd(e)}}class Em extends We.GeoJSONSource{onAdd(e){super.onAdd(e)}}class Mm extends We.ImageSource{onAdd(e){super.onAdd(e)}}class Im extends We.RasterTileSource{onAdd(e){super.onAdd(e)}}class Pm extends We.RasterDEMTileSource{onAdd(e){super.onAdd(e)}}class Lm extends We.VectorTileSource{onAdd(e){super.onAdd(e)}}class Fm extends We.VideoSource{onAdd(e){super.onAdd(e)}}class km extends We.NavigationControl{onAdd(e){return super.onAdd(e)}}class zm extends We.GeolocateControl{onAdd(e){return super.onAdd(e)}}class Rm extends We.AttributionControl{onAdd(e){return super.onAdd(e)}}class Dm extends We.LogoControl{onAdd(e){return super.onAdd(e)}}class Om extends We.ScaleControl{onAdd(e){return super.onAdd(e)}}class Um extends We.FullscreenControl{onAdd(e){return super.onAdd(e)}}class Nm extends We.TerrainControl{onAdd(e){return super.onAdd(e)}}class Qm extends We.BoxZoomHandler{constructor(e,t){super(e,t)}}class jm extends We.ScrollZoomHandler{constructor(e,t){super(e,t)}}class Vm extends We.CooperativeGesturesHandler{constructor(e,t){super(e,t)}}class Hm extends We.KeyboardHandler{constructor(e){super(e)}}class Gm extends We.TwoFingersTouchPitchHandler{constructor(e){super(e)}}class $m extends We.MapWheelEvent{constructor(e,t,i){super(e,t,i)}}class Zm extends We.MapTouchEvent{constructor(e,t,i){super(e,t,i)}}class qm extends We.MapMouseEvent{constructor(e,t,i,r={}){super(e,t,i,r)}}class Km extends Dm{constructor(e={}){super(e),$A(this,"logoURL",""),$A(this,"linkURL",""),this.logoURL=e.logoURL??em.maptilerLogoURL,this.linkURL=e.linkURL??em.maptilerURL}onAdd(e){this._map=e,this._compact=this.options.compact??!1,this._container=window.document.createElement("div"),this._container.className="maplibregl-ctrl";const t=window.document.createElement("a");return t.style.backgroundRepeat="no-repeat",t.style.cursor="pointer",t.style.display="block",t.style.height="23px",t.style.margin="0 0 -4px -4px",t.style.overflow="hidden",t.style.width="88px",t.style.backgroundImage=`url(${this.logoURL})`,t.style.backgroundSize="100px 30px",t.style.width="100px",t.style.height="30px",t.target="_blank",t.rel="noopener",t.href=this.linkURL,t.setAttribute("aria-label","MapTiler logo"),t.setAttribute("rel","noopener"),this._container.appendChild(t),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}}var Wm={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};class Xm{constructor(e,t,i,r){this.message=(e?`${e}: `:"")+i,r&&(this.identifier=r),null!=t&&t.__line__&&(this.line=t.__line__)}}function Ym(e,...t){for(const i of t)for(const t in i)e[t]=i[t];return e}class Jm extends Error{constructor(e,t){super(t),this.message=t,this.key=e}}class eg{constructor(e,t=[]){this.parent=e,this.bindings={};for(const[e,i]of t)this.bindings[e]=i}concat(e){return new eg(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const tg={kind:"null"},ig={kind:"number"},rg={kind:"string"},ng={kind:"boolean"},og={kind:"color"},sg={kind:"projectionDefinition"},ag={kind:"object"},lg={kind:"value"},cg={kind:"collator"},ug={kind:"formatted"},hg={kind:"padding"},dg={kind:"resolvedImage"},pg={kind:"variableAnchorOffsetCollection"};function fg(e,t){return{kind:"array",itemType:e,N:t}}function Ag(e){if("array"===e.kind){const t=Ag(e.itemType);return"number"==typeof e.N?`array<${t}, ${e.N}>`:"value"===e.itemType.kind?"array":`array<${t}>`}return e.kind}const mg=[tg,ig,rg,ng,og,sg,ug,ag,fg(lg),hg,dg,pg];function gg(e,t){if("error"===t.kind)return null;if("array"===e.kind){if("array"===t.kind&&(0===t.N&&"value"===t.itemType.kind||!gg(e.itemType,t.itemType))&&("number"!=typeof e.N||e.N===t.N))return null}else{if(e.kind===t.kind)return null;if("value"===e.kind)for(const e of mg)if(!gg(e,t))return null}return`Expected ${Ag(e)} but found ${Ag(t)} instead.`}function _g(e,t){return t.some((t=>t.kind===e.kind))}function yg(e,t){return t.some((t=>"null"===t?null===e:"array"===t?Array.isArray(e):"object"===t?e&&!Array.isArray(e)&&"object"==typeof e:t===typeof e))}function vg(e,t){return"array"===e.kind&&"array"===t.kind?e.itemType.kind===t.itemType.kind&&"number"==typeof e.N:e.kind===t.kind}const xg=.96422,bg=.82521,wg=4/29,Tg=6/29,Bg=3*Tg*Tg,Cg=Tg*Tg*Tg,Sg=Math.PI/180,Eg=180/Math.PI;function Mg(e){return(e%=360)<0&&(e+=360),e}function Ig([e,t,i,r]){let n,o;const s=Lg((.2225045*(e=Pg(e))+.7168786*(t=Pg(t))+.0606169*(i=Pg(i)))/1);e===t&&t===i?n=o=s:(n=Lg((.4360747*e+.3850649*t+.1430804*i)/xg),o=Lg((.0139322*e+.0971045*t+.7141733*i)/bg));const a=116*s-16;return[a<0?0:a,500*(n-s),200*(s-o),r]}function Pg(e){return e<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function Lg(e){return e>Cg?Math.pow(e,1/3):e/Bg+wg}function Fg([e,t,i,r]){let n=(e+16)/116,o=isNaN(t)?n:n+t/500,s=isNaN(i)?n:n-i/200;return n=1*zg(n),o=xg*zg(o),s=bg*zg(s),[kg(3.1338561*o-1.6168667*n-.4906146*s),kg(-.9787684*o+1.9161415*n+.033454*s),kg(.0719453*o-.2289914*n+1.4052427*s),r]}function kg(e){return(e=e<=.00304?12.92*e:1.055*Math.pow(e,1/2.4)-.055)<0?0:e>1?1:e}function zg(e){return e>Tg?e*e*e:Bg*(e-wg)}function Rg(e){if("transparent"===(e=e.toLowerCase().trim()))return[0,0,0,0];const t=Qg[e];if(t){const[e,i,r]=t;return[e/255,i/255,r/255,1]}if(e.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(e)){const t=e.length<6?1:2;let i=1;return[Dg(e.slice(i,i+=t)),Dg(e.slice(i,i+=t)),Dg(e.slice(i,i+=t)),Dg(e.slice(i,i+t)||"ff")]}if(e.startsWith("rgb")){const t=/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/,i=e.match(t);if(i){const[e,t,r,n,o,s,a,l,c,u,h,d]=i,p=[n||" ",a||" ",u].join("");if("  "===p||"  /"===p||",,"===p||",,,"===p){const e=[r,s,c].join(""),i="%%%"===e?100:""===e?255:0;if(i){const e=[Ug(+t/i,0,1),Ug(+o/i,0,1),Ug(+l/i,0,1),h?Og(+h,d):1];if(Ng(e))return e}}return}}const i=e.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(i){const[e,t,r,n,o,s,a,l,c]=i,u=[r||" ",o||" ",a].join("");if("  "===u||"  /"===u||",,"===u||",,,"===u){const e=[+t,Ug(+n,0,100),Ug(+s,0,100),l?Og(+l,c):1];if(Ng(e))return function([e,t,i,r]){function n(r){const n=(r+e/30)%12,o=t*Math.min(i,1-i);return i-o*Math.max(-1,Math.min(n-3,9-n,1))}return e=Mg(e),t/=100,i/=100,[n(0),n(8),n(4),r]}(e)}}}function Dg(e){return parseInt(e.padEnd(2,e),16)/255}function Og(e,t){return Ug(t?e/100:e,0,1)}function Ug(e,t,i){return Math.min(Math.max(t,e),i)}function Ng(e){return!e.some(Number.isNaN)}const Qg={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function jg(e,t,i){return e+i*(t-e)}function Vg(e,t,i){return e.map(((e,r)=>jg(e,t[r],i)))}class Hg{constructor(e,t,i,r=1,n=!0){this.r=e,this.g=t,this.b=i,this.a=r,n||(this.r*=r,this.g*=r,this.b*=r,r||this.overwriteGetter("rgb",[e,t,i,r]))}static parse(e){if(e instanceof Hg)return e;if("string"!=typeof e)return;const t=Rg(e);return t?new Hg(...t,!1):void 0}get rgb(){const{r:e,g:t,b:i,a:r}=this,n=r||1/0;return this.overwriteGetter("rgb",[e/n,t/n,i/n,r])}get hcl(){return this.overwriteGetter("hcl",function(e){const[t,i,r,n]=Ig(e),o=Math.sqrt(i*i+r*r);return[Math.round(1e4*o)?Mg(Math.atan2(r,i)*Eg):NaN,o,t,n]}(this.rgb))}get lab(){return this.overwriteGetter("lab",Ig(this.rgb))}overwriteGetter(e,t){return Object.defineProperty(this,e,{value:t}),t}toString(){const[e,t,i,r]=this.rgb;return`rgba(${[e,t,i].map((e=>Math.round(255*e))).join(",")},${r})`}static interpolate(e,t,i,r="rgb"){switch(r){case"rgb":{const[r,n,o,s]=Vg(e.rgb,t.rgb,i);return new Hg(r,n,o,s,!1)}case"hcl":{const[r,n,o,s]=e.hcl,[a,l,c,u]=t.hcl;let h,d;if(isNaN(r)||isNaN(a))isNaN(r)?isNaN(a)?h=NaN:(h=a,(1===o||0===o)&&(d=l)):(h=r,(1===c||0===c)&&(d=n));else{let e=a-r;a>r&&e>180?e-=360:a<r&&r-a>180&&(e+=360),h=r+i*e}const[p,f,A,m]=function([e,t,i,r]){return e=isNaN(e)?0:e*Sg,Fg([i,Math.cos(e)*t,Math.sin(e)*t,r])}([h,d??jg(n,l,i),jg(o,c,i),jg(s,u,i)]);return new Hg(p,f,A,m,!1)}case"lab":{const[r,n,o,s]=Fg(Vg(e.lab,t.lab,i));return new Hg(r,n,o,s,!1)}}}}Hg.black=new Hg(0,0,0,1),Hg.white=new Hg(1,1,1,1),Hg.transparent=new Hg(0,0,0,0),Hg.red=new Hg(1,0,0,1);class Gg{constructor(e,t,i){this.sensitivity=e?t?"variant":"case":t?"accent":"base",this.locale=i,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,t){return this.collator.compare(e,t)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const $g=["bottom","center","top"];class Zg{constructor(e,t,i,r,n,o){this.text=e,this.image=t,this.scale=i,this.fontStack=r,this.textColor=n,this.verticalAlign=o}}class qg{constructor(e){this.sections=e}static fromString(e){return new qg([new Zg(e,null,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some((e=>0!==e.text.length||e.image&&0!==e.image.name.length))}static factory(e){return e instanceof qg?e:qg.fromString(e)}toString(){return 0===this.sections.length?"":this.sections.map((e=>e.text)).join("")}}class Kg{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Kg)return e;if("number"==typeof e)return new Kg([e,e,e,e]);if(Array.isArray(e)&&!(e.length<1||e.length>4)){for(const t of e)if("number"!=typeof t)return;switch(e.length){case 1:e=[e[0],e[0],e[0],e[0]];break;case 2:e=[e[0],e[1],e[0],e[1]];break;case 3:e=[e[0],e[1],e[2],e[1]]}return new Kg(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,t,i){return new Kg(Vg(e.values,t.values,i))}}class Wg{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const Xg=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Yg{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Yg)return e;if(Array.isArray(e)&&!(e.length<1)&&e.length%2==0){for(let t=0;t<e.length;t+=2){const i=e[t],r=e[t+1];if("string"!=typeof i||!Xg.has(i)||!Array.isArray(r)||2!==r.length||"number"!=typeof r[0]||"number"!=typeof r[1])return}return new Yg(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,t,i){const r=e.values,n=t.values;if(r.length!==n.length)throw new Wg(`Cannot interpolate values of different length. from: ${e.toString()}, to: ${t.toString()}`);const o=[];for(let e=0;e<r.length;e+=2){if(r[e]!==n[e])throw new Wg(`Cannot interpolate values containing mismatched anchors. from[${e}]: ${r[e]}, to[${e}]: ${n[e]}`);o.push(r[e]);const[t,s]=r[e+1],[a,l]=n[e+1];o.push([jg(t,a,i),jg(s,l,i)])}return new Yg(o)}}class Jg{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new Jg({name:e,available:!1}):null}}class e_{constructor(e,t,i){this.from=e,this.to=t,this.transition=i}static interpolate(e,t,i){return new e_(e,t,i)}static parse(e){return e instanceof e_?e:Array.isArray(e)&&3===e.length&&"string"==typeof e[0]&&"string"==typeof e[1]&&"number"==typeof e[2]?new e_(e[0],e[1],e[2]):"object"==typeof e&&"string"==typeof e.from&&"string"==typeof e.to&&"number"==typeof e.transition?new e_(e.from,e.to,e.transition):"string"==typeof e?new e_(e,e,1):void 0}}function t_(e,t,i,r){return"number"==typeof e&&e>=0&&e<=255&&"number"==typeof t&&t>=0&&t<=255&&"number"==typeof i&&i>=0&&i<=255?typeof r>"u"||"number"==typeof r&&r>=0&&r<=1?null:`Invalid rgba value [${[e,t,i,r].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof r?[e,t,i,r]:[e,t,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function i_(e){if(null===e||"string"==typeof e||"boolean"==typeof e||"number"==typeof e||e instanceof e_||e instanceof Hg||e instanceof Gg||e instanceof qg||e instanceof Kg||e instanceof Yg||e instanceof Jg)return!0;if(Array.isArray(e)){for(const t of e)if(!i_(t))return!1;return!0}if("object"==typeof e){for(const t in e)if(!i_(e[t]))return!1;return!0}return!1}function r_(e){if(null===e)return tg;if("string"==typeof e)return rg;if("boolean"==typeof e)return ng;if("number"==typeof e)return ig;if(e instanceof Hg)return og;if(e instanceof e_)return sg;if(e instanceof Gg)return cg;if(e instanceof qg)return ug;if(e instanceof Kg)return hg;if(e instanceof Yg)return pg;if(e instanceof Jg)return dg;if(Array.isArray(e)){const t=e.length;let i;for(const t of e){const e=r_(t);if(i){if(i===e)continue;i=lg;break}i=e}return fg(i||lg,t)}return ag}function n_(e){const t=typeof e;return null===e?"":"string"===t||"number"===t||"boolean"===t?String(e):e instanceof Hg||e instanceof e_||e instanceof qg||e instanceof Kg||e instanceof Yg||e instanceof Jg?e.toString():JSON.stringify(e)}class o_{constructor(e,t){this.type=e,this.value=t}static parse(e,t){if(2!==e.length)return t.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!i_(e[1]))return t.error("invalid value");const i=e[1];let r=r_(i);const n=t.expectedType;return"array"===r.kind&&0===r.N&&n&&"array"===n.kind&&("number"!=typeof n.N||0===n.N)&&(r=n),new o_(r,i)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const s_={string:rg,number:ig,boolean:ng,object:ag};class a_{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");let i,r=1;const n=e[0];if("array"===n){let n,o;if(e.length>2){const i=e[1];if("string"!=typeof i||!(i in s_)||"object"===i)return t.error('The item type argument of "array" must be one of string, number, boolean',1);n=s_[i],r++}else n=lg;if(e.length>3){if(null!==e[2]&&("number"!=typeof e[2]||e[2]<0||e[2]!==Math.floor(e[2])))return t.error('The length argument to "array" must be a positive integer literal',2);o=e[2],r++}i=fg(n,o)}else{if(!s_[n])throw new Error(`Types doesn't contain name = ${n}`);i=s_[n]}const o=[];for(;r<e.length;r++){const i=t.parse(e[r],r,lg);if(!i)return null;o.push(i)}return new a_(i,o)}evaluate(e){for(let t=0;t<this.args.length;t++){const i=this.args[t].evaluate(e);if(!gg(this.type,r_(i)))return i;if(t===this.args.length-1)throw new Wg(`Expected value to be of type ${Ag(this.type)}, but found ${Ag(r_(i))} instead.`)}throw new Error}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}}const l_={"to-boolean":ng,"to-color":og,"to-number":ig,"to-string":rg};class c_{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const i=e[0];if(!l_[i])throw new Error(`Can't parse ${i} as it is not part of the known types`);if(("to-boolean"===i||"to-string"===i)&&2!==e.length)return t.error("Expected one argument.");const r=l_[i],n=[];for(let i=1;i<e.length;i++){const r=t.parse(e[i],i,lg);if(!r)return null;n.push(r)}return new c_(r,n)}evaluate(e){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(e);case"color":{let t,i;for(const r of this.args){if(t=r.evaluate(e),i=null,t instanceof Hg)return t;if("string"==typeof t){const i=e.parseColor(t);if(i)return i}else if(Array.isArray(t)&&(i=t.length<3||t.length>4?`Invalid rgba value ${JSON.stringify(t)}: expected an array containing either three or four numeric values.`:t_(t[0],t[1],t[2],t[3]),!i))return new Hg(t[0]/255,t[1]/255,t[2]/255,t[3])}throw new Wg(i||`Could not parse color from value '${"string"==typeof t?t:JSON.stringify(t)}'`)}case"padding":{let t;for(const i of this.args){t=i.evaluate(e);const r=Kg.parse(t);if(r)return r}throw new Wg(`Could not parse padding from value '${"string"==typeof t?t:JSON.stringify(t)}'`)}case"variableAnchorOffsetCollection":{let t;for(const i of this.args){t=i.evaluate(e);const r=Yg.parse(t);if(r)return r}throw new Wg(`Could not parse variableAnchorOffsetCollection from value '${"string"==typeof t?t:JSON.stringify(t)}'`)}case"number":{let t=null;for(const i of this.args){if(t=i.evaluate(e),null===t)return 0;const r=Number(t);if(!isNaN(r))return r}throw new Wg(`Could not convert ${JSON.stringify(t)} to number.`)}case"formatted":return qg.fromString(n_(this.args[0].evaluate(e)));case"resolvedImage":return Jg.fromString(n_(this.args[0].evaluate(e)));case"projectionDefinition":return this.args[0].evaluate(e);default:return n_(this.args[0].evaluate(e))}}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}}const u_=["Unknown","Point","LineString","Polygon"];class h_{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?u_[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let t=this._parseColorCache[e];return t||(t=this._parseColorCache[e]=Hg.parse(e)),t}}class d_{constructor(e,t,i=[],r,n=new eg,o=[]){this.registry=e,this.path=i,this.key=i.map((e=>`[${e}]`)).join(""),this.scope=n,this.errors=o,this.expectedType=r,this._isConstant=t}parse(e,t,i,r,n={}){return t?this.concat(t,i,r)._parse(e,n):this._parse(e,n)}_parse(e,t){function i(e,t,i){return"assert"===i?new a_(t,[e]):"coerce"===i?new c_(t,[e]):e}if((null===e||"string"==typeof e||"boolean"==typeof e||"number"==typeof e)&&(e=["literal",e]),Array.isArray(e)){if(0===e.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const r=e[0];if("string"!=typeof r)return this.error(`Expression name must be a string, but found ${typeof r} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const n=this.registry[r];if(n){let r=n.parse(e,this);if(!r)return null;if(this.expectedType){const e=this.expectedType,n=r.type;if("string"!==e.kind&&"number"!==e.kind&&"boolean"!==e.kind&&"object"!==e.kind&&"array"!==e.kind||"value"!==n.kind)if("projectionDefinition"!==e.kind||"string"!==n.kind&&"array"!==n.kind)if("color"!==e.kind&&"formatted"!==e.kind&&"resolvedImage"!==e.kind||"value"!==n.kind&&"string"!==n.kind)if("padding"!==e.kind||"value"!==n.kind&&"number"!==n.kind&&"array"!==n.kind)if("variableAnchorOffsetCollection"!==e.kind||"value"!==n.kind&&"array"!==n.kind){if(this.checkSubtype(e,n))return null}else r=i(r,e,t.typeAnnotation||"coerce");else r=i(r,e,t.typeAnnotation||"coerce");else r=i(r,e,t.typeAnnotation||"coerce");else r=i(r,e,t.typeAnnotation||"coerce");else r=i(r,e,t.typeAnnotation||"assert")}if(!(r instanceof o_)&&"resolvedImage"!==r.type.kind&&this._isConstant(r)){const e=new h_;try{r=new o_(r.type,r.evaluate(e))}catch(e){return this.error(e.message),null}}return r}return this.error(`Unknown expression "${r}". If you wanted a literal array, use ["literal", [...]].`,0)}return typeof e>"u"?this.error("'undefined' value invalid. Use null instead."):"object"==typeof e?this.error('Bare objects invalid. Use ["literal", {...}] instead.'):this.error(`Expected an array, but found ${typeof e} instead.`)}concat(e,t,i){const r="number"==typeof e?this.path.concat(e):this.path,n=i?this.scope.concat(i):this.scope;return new d_(this.registry,this._isConstant,r,t||null,n,this.errors)}error(e,...t){const i=`${this.key}${t.map((e=>`[${e}]`)).join("")}`;this.errors.push(new Jm(i,e))}checkSubtype(e,t){const i=gg(e,t);return i&&this.error(i),i}}class p_{constructor(e,t){this.type=t.type,this.bindings=[].concat(e),this.result=t}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const t of this.bindings)e(t[1]);e(this.result)}static parse(e,t){if(e.length<4)return t.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const i=[];for(let r=1;r<e.length-1;r+=2){const n=e[r];if("string"!=typeof n)return t.error(`Expected string, but found ${typeof n} instead.`,r);if(/[^a-zA-Z0-9_]/.test(n))return t.error("Variable names must contain only alphanumeric characters or '_'.",r);const o=t.parse(e[r+1],r+1);if(!o)return null;i.push([n,o])}const r=t.parse(e[e.length-1],e.length-1,t.expectedType,i);return r?new p_(i,r):null}outputDefined(){return this.result.outputDefined()}}class f_{constructor(e,t){this.type=t.type,this.name=e,this.boundExpression=t}static parse(e,t){if(2!==e.length||"string"!=typeof e[1])return t.error("'var' expression requires exactly one string literal argument.");const i=e[1];return t.scope.has(i)?new f_(i,t.scope.get(i)):t.error(`Unknown variable "${i}". Make sure "${i}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}}class A_{constructor(e,t,i){this.type=e,this.index=t,this.input=i}static parse(e,t){if(3!==e.length)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const i=t.parse(e[1],1,ig),r=t.parse(e[2],2,fg(t.expectedType||lg));if(!i||!r)return null;const n=r.type;return new A_(n.itemType,i,r)}evaluate(e){const t=this.index.evaluate(e),i=this.input.evaluate(e);if(t<0)throw new Wg(`Array index out of bounds: ${t} < 0.`);if(t>=i.length)throw new Wg(`Array index out of bounds: ${t} > ${i.length-1}.`);if(t!==Math.floor(t))throw new Wg(`Array index must be an integer, but found ${t} instead.`);return i[t]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}}class m_{constructor(e,t){this.type=ng,this.needle=e,this.haystack=t}static parse(e,t){if(3!==e.length)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const i=t.parse(e[1],1,lg),r=t.parse(e[2],2,lg);return i&&r?_g(i.type,[ng,rg,ig,tg,lg])?new m_(i,r):t.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ag(i.type)} instead`):null}evaluate(e){const t=this.needle.evaluate(e),i=this.haystack.evaluate(e);if(!i)return!1;if(!yg(t,["boolean","string","number","null"]))throw new Wg(`Expected first argument to be of type boolean, string, number or null, but found ${Ag(r_(t))} instead.`);if(!yg(i,["string","array"]))throw new Wg(`Expected second argument to be of type array or string, but found ${Ag(r_(i))} instead.`);return i.indexOf(t)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}}class g_{constructor(e,t,i){this.type=ig,this.needle=e,this.haystack=t,this.fromIndex=i}static parse(e,t){if(e.length<=2||e.length>=5)return t.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const i=t.parse(e[1],1,lg),r=t.parse(e[2],2,lg);if(!i||!r)return null;if(!_g(i.type,[ng,rg,ig,tg,lg]))return t.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ag(i.type)} instead`);if(4===e.length){const n=t.parse(e[3],3,ig);return n?new g_(i,r,n):null}return new g_(i,r)}evaluate(e){const t=this.needle.evaluate(e),i=this.haystack.evaluate(e);if(!yg(t,["boolean","string","number","null"]))throw new Wg(`Expected first argument to be of type boolean, string, number or null, but found ${Ag(r_(t))} instead.`);let r;if(this.fromIndex&&(r=this.fromIndex.evaluate(e)),yg(i,["string"])){const e=i.indexOf(t,r);return-1===e?-1:[...i.slice(0,e)].length}if(yg(i,["array"]))return i.indexOf(t,r);throw new Wg(`Expected second argument to be of type array or string, but found ${Ag(r_(i))} instead.`)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}}class __{constructor(e,t,i,r,n,o){this.inputType=e,this.type=t,this.input=i,this.cases=r,this.outputs=n,this.otherwise=o}static parse(e,t){if(e.length<5)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return t.error("Expected an even number of arguments.");let i,r;t.expectedType&&"value"!==t.expectedType.kind&&(r=t.expectedType);const n={},o=[];for(let s=2;s<e.length-1;s+=2){let a=e[s];const l=e[s+1];Array.isArray(a)||(a=[a]);const c=t.concat(s);if(0===a.length)return c.error("Expected at least one branch label.");for(const e of a){if("number"!=typeof e&&"string"!=typeof e)return c.error("Branch labels must be numbers or strings.");if("number"==typeof e&&Math.abs(e)>Number.MAX_SAFE_INTEGER)return c.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof e&&Math.floor(e)!==e)return c.error("Numeric branch labels must be integer values.");if(i){if(c.checkSubtype(i,r_(e)))return null}else i=r_(e);if(typeof n[String(e)]<"u")return c.error("Branch labels must be unique.");n[String(e)]=o.length}const u=t.parse(l,s,r);if(!u)return null;r=r||u.type,o.push(u)}const s=t.parse(e[1],1,lg);if(!s)return null;const a=t.parse(e[e.length-1],e.length-1,r);return!a||"value"!==s.type.kind&&t.concat(1).checkSubtype(i,s.type)?null:new __(i,r,s,n,o,a)}evaluate(e){const t=this.input.evaluate(e);return(r_(t)===this.inputType&&this.outputs[this.cases[t]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))&&this.otherwise.outputDefined()}}class y_{constructor(e,t,i){this.type=e,this.branches=t,this.otherwise=i}static parse(e,t){if(e.length<4)return t.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return t.error("Expected an odd number of arguments.");let i;t.expectedType&&"value"!==t.expectedType.kind&&(i=t.expectedType);const r=[];for(let n=1;n<e.length-1;n+=2){const o=t.parse(e[n],n,ng);if(!o)return null;const s=t.parse(e[n+1],n+1,i);if(!s)return null;r.push([o,s]),i=i||s.type}const n=t.parse(e[e.length-1],e.length-1,i);if(!n)return null;if(!i)throw new Error("Can't infer output type");return new y_(i,r,n)}evaluate(e){for(const[t,i]of this.branches)if(t.evaluate(e))return i.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[t,i]of this.branches)e(t),e(i);e(this.otherwise)}outputDefined(){return this.branches.every((([e,t])=>t.outputDefined()))&&this.otherwise.outputDefined()}}class v_{constructor(e,t,i,r){this.type=e,this.input=t,this.beginIndex=i,this.endIndex=r}static parse(e,t){if(e.length<=2||e.length>=5)return t.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const i=t.parse(e[1],1,lg),r=t.parse(e[2],2,ig);if(!i||!r)return null;if(!_g(i.type,[fg(lg),rg,lg]))return t.error(`Expected first argument to be of type array or string, but found ${Ag(i.type)} instead`);if(4===e.length){const n=t.parse(e[3],3,ig);return n?new v_(i.type,i,r,n):null}return new v_(i.type,i,r)}evaluate(e){const t=this.input.evaluate(e),i=this.beginIndex.evaluate(e);let r;if(this.endIndex&&(r=this.endIndex.evaluate(e)),yg(t,["string"]))return[...t].slice(i,r).join("");if(yg(t,["array"]))return t.slice(i,r);throw new Wg(`Expected first argument to be of type array or string, but found ${Ag(r_(t))} instead.`)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}}function x_(e,t){const i=e.length-1;let r,n,o=0,s=i,a=0;for(;o<=s;)if(a=Math.floor((o+s)/2),r=e[a],n=e[a+1],r<=t){if(a===i||t<n)return a;o=a+1}else{if(!(r>t))throw new Wg("Input is not a number.");s=a-1}return 0}class b_{constructor(e,t,i){this.type=e,this.input=t,this.labels=[],this.outputs=[];for(const[e,t]of i)this.labels.push(e),this.outputs.push(t)}static parse(e,t){if(e.length-1<4)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");const i=t.parse(e[1],1,ig);if(!i)return null;const r=[];let n=null;t.expectedType&&"value"!==t.expectedType.kind&&(n=t.expectedType);for(let i=1;i<e.length;i+=2){const o=1===i?-1/0:e[i],s=e[i+1],a=i,l=i+1;if("number"!=typeof o)return t.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',a);if(r.length&&r[r.length-1][0]>=o)return t.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',a);const c=t.parse(s,l,n);if(!c)return null;n=n||c.type,r.push([o,c])}return new b_(n,i,r)}evaluate(e){const t=this.labels,i=this.outputs;if(1===t.length)return i[0].evaluate(e);const r=this.input.evaluate(e);if(r<=t[0])return i[0].evaluate(e);const n=t.length;if(r>=t[n-1])return i[n-1].evaluate(e);return i[x_(t,r)].evaluate(e)}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}}function w_(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var T_,B_;var C_=w_(function(){if(B_)return T_;function e(e,t,i,r){this.cx=3*e,this.bx=3*(i-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(r-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=t,this.p2x=i,this.p2y=r}return B_=1,T_=e,e.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,t){if(void 0===t&&(t=1e-6),e<0)return 0;if(e>1)return 1;for(var i=e,r=0;r<8;r++){var n=this.sampleCurveX(i)-e;if(Math.abs(n)<t)return i;var o=this.sampleCurveDerivativeX(i);if(Math.abs(o)<1e-6)break;i-=n/o}var s=0,a=1;for(i=e,r=0;r<20&&(n=this.sampleCurveX(i),!(Math.abs(n-e)<t));r++)e>n?s=i:a=i,i=.5*(a-s)+s;return i},solve:function(e,t){return this.sampleCurveY(this.solveCurveX(e,t))}},T_}());class S_{constructor(e,t,i,r,n){this.type=e,this.operator=t,this.interpolation=i,this.input=r,this.labels=[],this.outputs=[];for(const[e,t]of n)this.labels.push(e),this.outputs.push(t)}static interpolationFactor(e,t,i,r){let n=0;if("exponential"===e.name)n=E_(t,e.base,i,r);else if("linear"===e.name)n=E_(t,1,i,r);else if("cubic-bezier"===e.name){const o=e.controlPoints;n=new C_(o[0],o[1],o[2],o[3]).solve(E_(t,1,i,r))}return n}static parse(e,t){let[i,r,n,...o]=e;if(!Array.isArray(r)||0===r.length)return t.error("Expected an interpolation type expression.",1);if("linear"===r[0])r={name:"linear"};else if("exponential"===r[0]){const e=r[1];if("number"!=typeof e)return t.error("Exponential interpolation requires a numeric base.",1,1);r={name:"exponential",base:e}}else{if("cubic-bezier"!==r[0])return t.error(`Unknown interpolation type ${String(r[0])}`,1,0);{const e=r.slice(1);if(4!==e.length||e.some((e=>"number"!=typeof e||e<0||e>1)))return t.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);r={name:"cubic-bezier",controlPoints:e}}}if(e.length-1<4)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");if(n=t.parse(n,2,ig),!n)return null;const s=[];let a=null;"interpolate-hcl"===i||"interpolate-lab"===i?a=og:t.expectedType&&"value"!==t.expectedType.kind&&(a=t.expectedType);for(let e=0;e<o.length;e+=2){const i=o[e],r=o[e+1],n=e+3,l=e+4;if("number"!=typeof i)return t.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',n);if(s.length&&s[s.length-1][0]>=i)return t.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',n);const c=t.parse(r,l,a);if(!c)return null;a=a||c.type,s.push([i,c])}return vg(a,ig)||vg(a,sg)||vg(a,og)||vg(a,hg)||vg(a,pg)||vg(a,fg(ig))?new S_(a,i,r,n,s):t.error(`Type ${Ag(a)} is not interpolatable.`)}evaluate(e){const t=this.labels,i=this.outputs;if(1===t.length)return i[0].evaluate(e);const r=this.input.evaluate(e);if(r<=t[0])return i[0].evaluate(e);const n=t.length;if(r>=t[n-1])return i[n-1].evaluate(e);const o=x_(t,r),s=t[o],a=t[o+1],l=S_.interpolationFactor(this.interpolation,r,s,a),c=i[o].evaluate(e),u=i[o+1].evaluate(e);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return jg(c,u,l);case"color":return Hg.interpolate(c,u,l);case"padding":return Kg.interpolate(c,u,l);case"variableAnchorOffsetCollection":return Yg.interpolate(c,u,l);case"array":return Vg(c,u,l);case"projectionDefinition":return e_.interpolate(c,u,l)}case"interpolate-hcl":return Hg.interpolate(c,u,l,"hcl");case"interpolate-lab":return Hg.interpolate(c,u,l,"lab")}}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}}function E_(e,t,i,r){const n=r-i,o=e-i;return 0===n?0:1===t?o/n:(Math.pow(t,o)-1)/(Math.pow(t,n)-1)}Hg.interpolate,Kg.interpolate,Yg.interpolate;class M_{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");let i=null;const r=t.expectedType;r&&"value"!==r.kind&&(i=r);const n=[];for(const r of e.slice(1)){const e=t.parse(r,1+n.length,i,void 0,{typeAnnotation:"omit"});if(!e)return null;i=i||e.type,n.push(e)}if(!i)throw new Error("No output type");return r&&n.some((e=>gg(r,e.type)))?new M_(lg,n):new M_(i,n)}evaluate(e){let t,i=null,r=0;for(const n of this.args)if(r++,i=n.evaluate(e),i&&i instanceof Jg&&!i.available&&(t||(t=i.name),i=null,r===this.args.length&&(i=t)),null!==i)break;return i}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}}function I_(e,t){return"=="===e||"!="===e?"boolean"===t.kind||"string"===t.kind||"number"===t.kind||"null"===t.kind||"value"===t.kind:"string"===t.kind||"number"===t.kind||"value"===t.kind}function P_(e,t,i,r){return 0===r.compare(t,i)}function L_(e,t,i){const r="=="!==e&&"!="!==e;return class n{constructor(e,t,i){this.type=ng,this.lhs=e,this.rhs=t,this.collator=i,this.hasUntypedArgument="value"===e.type.kind||"value"===t.type.kind}static parse(e,t){if(3!==e.length&&4!==e.length)return t.error("Expected two or three arguments.");const i=e[0];let o=t.parse(e[1],1,lg);if(!o)return null;if(!I_(i,o.type))return t.concat(1).error(`"${i}" comparisons are not supported for type '${Ag(o.type)}'.`);let s=t.parse(e[2],2,lg);if(!s)return null;if(!I_(i,s.type))return t.concat(2).error(`"${i}" comparisons are not supported for type '${Ag(s.type)}'.`);if(o.type.kind!==s.type.kind&&"value"!==o.type.kind&&"value"!==s.type.kind)return t.error(`Cannot compare types '${Ag(o.type)}' and '${Ag(s.type)}'.`);r&&("value"===o.type.kind&&"value"!==s.type.kind?o=new a_(s.type,[o]):"value"!==o.type.kind&&"value"===s.type.kind&&(s=new a_(o.type,[s])));let a=null;if(4===e.length){if("string"!==o.type.kind&&"string"!==s.type.kind&&"value"!==o.type.kind&&"value"!==s.type.kind)return t.error("Cannot use collator to compare non-string types.");if(a=t.parse(e[3],3,cg),!a)return null}return new n(o,s,a)}evaluate(n){const o=this.lhs.evaluate(n),s=this.rhs.evaluate(n);if(r&&this.hasUntypedArgument){const t=r_(o),i=r_(s);if(t.kind!==i.kind||"string"!==t.kind&&"number"!==t.kind)throw new Wg(`Expected arguments for "${e}" to be (string, string) or (number, number), but found (${t.kind}, ${i.kind}) instead.`)}if(this.collator&&!r&&this.hasUntypedArgument){const e=r_(o),i=r_(s);if("string"!==e.kind||"string"!==i.kind)return t(n,o,s)}return this.collator?i(n,o,s,this.collator.evaluate(n)):t(n,o,s)}eachChild(e){e(this.lhs),e(this.rhs),this.collator&&e(this.collator)}outputDefined(){return!0}}}const F_=L_("==",(function(e,t,i){return t===i}),P_),k_=L_("!=",(function(e,t,i){return t!==i}),(function(e,t,i,r){return!P_(0,t,i,r)})),z_=L_("<",(function(e,t,i){return t<i}),(function(e,t,i,r){return r.compare(t,i)<0})),R_=L_(">",(function(e,t,i){return t>i}),(function(e,t,i,r){return r.compare(t,i)>0})),D_=L_("<=",(function(e,t,i){return t<=i}),(function(e,t,i,r){return r.compare(t,i)<=0})),O_=L_(">=",(function(e,t,i){return t>=i}),(function(e,t,i,r){return r.compare(t,i)>=0}));class U_{constructor(e,t,i){this.type=cg,this.locale=i,this.caseSensitive=e,this.diacriticSensitive=t}static parse(e,t){if(2!==e.length)return t.error("Expected one argument.");const i=e[1];if("object"!=typeof i||Array.isArray(i))return t.error("Collator options argument must be an object.");const r=t.parse(void 0!==i["case-sensitive"]&&i["case-sensitive"],1,ng);if(!r)return null;const n=t.parse(void 0!==i["diacritic-sensitive"]&&i["diacritic-sensitive"],1,ng);if(!n)return null;let o=null;return i.locale&&(o=t.parse(i.locale,1,rg),!o)?null:new U_(r,n,o)}evaluate(e){return new Gg(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}}class N_{constructor(e,t,i,r,n){this.type=rg,this.number=e,this.locale=t,this.currency=i,this.minFractionDigits=r,this.maxFractionDigits=n}static parse(e,t){if(3!==e.length)return t.error("Expected two arguments.");const i=t.parse(e[1],1,ig);if(!i)return null;const r=e[2];if("object"!=typeof r||Array.isArray(r))return t.error("NumberFormat options argument must be an object.");let n=null;if(r.locale&&(n=t.parse(r.locale,1,rg),!n))return null;let o=null;if(r.currency&&(o=t.parse(r.currency,1,rg),!o))return null;let s=null;if(r["min-fraction-digits"]&&(s=t.parse(r["min-fraction-digits"],1,ig),!s))return null;let a=null;return r["max-fraction-digits"]&&(a=t.parse(r["max-fraction-digits"],1,ig),!a)?null:new N_(i,n,o,s,a)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}}class Q_{constructor(e){this.type=ug,this.sections=e}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const i=e[1];if(!Array.isArray(i)&&"object"==typeof i)return t.error("First argument must be an image or text section.");const r=[];let n=!1;for(let i=1;i<=e.length-1;++i){const o=e[i];if(n&&"object"==typeof o&&!Array.isArray(o)){n=!1;let e=null;if(o["font-scale"]&&(e=t.parse(o["font-scale"],1,ig),!e))return null;let i=null;if(o["text-font"]&&(i=t.parse(o["text-font"],1,fg(rg)),!i))return null;let s=null;if(o["text-color"]&&(s=t.parse(o["text-color"],1,og),!s))return null;let a=null;if(o["vertical-align"]){if("string"==typeof o["vertical-align"]&&!$g.includes(o["vertical-align"]))return t.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${o["vertical-align"]}' instead.`);if(a=t.parse(o["vertical-align"],1,rg),!a)return null}const l=r[r.length-1];l.scale=e,l.font=i,l.textColor=s,l.verticalAlign=a}else{const o=t.parse(e[i],1,lg);if(!o)return null;const s=o.type.kind;if("string"!==s&&"value"!==s&&"null"!==s&&"resolvedImage"!==s)return t.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");n=!0,r.push({content:o,scale:null,font:null,textColor:null,verticalAlign:null})}}return new Q_(r)}evaluate(e){return new qg(this.sections.map((t=>{const i=t.content.evaluate(e);return r_(i)===dg?new Zg("",i,null,null,null,t.verticalAlign?t.verticalAlign.evaluate(e):null):new Zg(n_(i),null,t.scale?t.scale.evaluate(e):null,t.font?t.font.evaluate(e).join(","):null,t.textColor?t.textColor.evaluate(e):null,t.verticalAlign?t.verticalAlign.evaluate(e):null)})))}eachChild(e){for(const t of this.sections)e(t.content),t.scale&&e(t.scale),t.font&&e(t.font),t.textColor&&e(t.textColor),t.verticalAlign&&e(t.verticalAlign)}outputDefined(){return!1}}class j_{constructor(e){this.type=dg,this.input=e}static parse(e,t){if(2!==e.length)return t.error("Expected two arguments.");const i=t.parse(e[1],1,rg);return i?new j_(i):t.error("No image name provided.")}evaluate(e){const t=this.input.evaluate(e),i=Jg.fromString(t);return i&&e.availableImages&&(i.available=e.availableImages.indexOf(t)>-1),i}eachChild(e){e(this.input)}outputDefined(){return!1}}class V_{constructor(e){this.type=ig,this.input=e}static parse(e,t){if(2!==e.length)return t.error(`Expected 1 argument, but found ${e.length-1} instead.`);const i=t.parse(e[1],1);return i?"array"!==i.type.kind&&"string"!==i.type.kind&&"value"!==i.type.kind?t.error(`Expected argument of type string or array, but found ${Ag(i.type)} instead.`):new V_(i):null}evaluate(e){const t=this.input.evaluate(e);if("string"==typeof t)return[...t].length;if(Array.isArray(t))return t.length;throw new Wg(`Expected value to be of type string or array, but found ${Ag(r_(t))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}}const H_=8192;function G_(e,t){const i=function(e){return(180+e)/360}(e[0]),r=function(e){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e*Math.PI/360)))/360}(e[1]),n=Math.pow(2,t.z);return[Math.round(i*n*H_),Math.round(r*n*H_)]}function $_(e,t){const i=Math.pow(2,t.z),r=(e[0]/H_+t.x)/i,n=(e[1]/H_+t.y)/i;return[Z_(r),q_(n)]}function Z_(e){return 360*e-180}function q_(e){return 360/Math.PI*Math.atan(Math.exp((180-360*e)*Math.PI/180))-90}function K_(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.max(e[2],t[0]),e[3]=Math.max(e[3],t[1])}function W_(e,t){return!(e[0]<=t[0]||e[2]>=t[2]||e[1]<=t[1]||e[3]>=t[3])}function X_(e,t,i){return t[1]>e[1]!=i[1]>e[1]&&e[0]<(i[0]-t[0])*(e[1]-t[1])/(i[1]-t[1])+t[0]}function Y_(e,t,i){const r=e[0]-t[0],n=e[1]-t[1],o=e[0]-i[0],s=e[1]-i[1];return r*s-o*n==0&&r*o<=0&&n*s<=0}function J_(e,t,i,r){const n=[t[0]-e[0],t[1]-e[1]];return 0!==function(e,t){return e[0]*t[1]-e[1]*t[0]}([r[0]-i[0],r[1]-i[1]],n)&&!(!oy(e,t,i,r)||!oy(i,r,e,t))}function ey(e,t,i){for(const r of i)for(let i=0;i<r.length-1;++i)if(J_(e,t,r[i],r[i+1]))return!0;return!1}function ty(e,t,i=!1){let r=!1;for(const n of t)for(let t=0;t<n.length-1;t++){if(Y_(e,n[t],n[t+1]))return i;X_(e,n[t],n[t+1])&&(r=!r)}return r}function iy(e,t){for(const i of t)if(ty(e,i))return!0;return!1}function ry(e,t){for(const i of e)if(!ty(i,t))return!1;for(let i=0;i<e.length-1;++i)if(ey(e[i],e[i+1],t))return!1;return!0}function ny(e,t){for(const i of t)if(ry(e,i))return!0;return!1}function oy(e,t,i,r){const n=e[0]-i[0],o=e[1]-i[1],s=t[0]-i[0],a=t[1]-i[1],l=r[0]-i[0],c=r[1]-i[1],u=n*c-l*o,h=s*c-l*a;return u>0&&h<0||u<0&&h>0}function sy(e,t,i){const r=[];for(let n=0;n<e.length;n++){const o=[];for(let r=0;r<e[n].length;r++){const s=G_(e[n][r],i);K_(t,s),o.push(s)}r.push(o)}return r}function ay(e,t,i){const r=[];for(let n=0;n<e.length;n++){const o=sy(e[n],t,i);r.push(o)}return r}function ly(e,t,i,r){if(e[0]<i[0]||e[0]>i[2]){const t=.5*r;let n=e[0]-i[0]>t?-r:i[0]-e[0]>t?r:0;0===n&&(n=e[0]-i[2]>t?-r:i[2]-e[0]>t?r:0),e[0]+=n}K_(t,e)}function cy(e,t,i,r){const n=Math.pow(2,r.z)*H_,o=[r.x*H_,r.y*H_],s=[];for(const r of e)for(const e of r){const r=[e.x+o[0],e.y+o[1]];ly(r,t,i,n),s.push(r)}return s}function uy(e,t,i,r){const n=Math.pow(2,r.z)*H_,o=[r.x*H_,r.y*H_],s=[];for(const i of e){const e=[];for(const r of i){const i=[r.x+o[0],r.y+o[1]];K_(t,i),e.push(i)}s.push(e)}if(t[2]-t[0]<=n/2){!function(e){e[0]=e[1]=1/0,e[2]=e[3]=-1/0}(t);for(const e of s)for(const r of e)ly(r,t,i,n)}return s}class hy{constructor(e,t){this.type=ng,this.geojson=e,this.geometries=t}static parse(e,t){if(2!==e.length)return t.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(i_(e[1])){const t=e[1];if("FeatureCollection"===t.type){const e=[];for(const i of t.features){const{type:t,coordinates:r}=i.geometry;"Polygon"===t&&e.push(r),"MultiPolygon"===t&&e.push(...r)}if(e.length){return new hy(t,{type:"MultiPolygon",coordinates:e})}}else if("Feature"===t.type){const e=t.geometry.type;if("Polygon"===e||"MultiPolygon"===e)return new hy(t,t.geometry)}else if("Polygon"===t.type||"MultiPolygon"===t.type)return new hy(t,t)}return t.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(null!=e.geometry()&&null!=e.canonicalID()){if("Point"===e.geometryType())return function(e,t){const i=[1/0,1/0,-1/0,-1/0],r=[1/0,1/0,-1/0,-1/0],n=e.canonicalID();if("Polygon"===t.type){const o=sy(t.coordinates,r,n),s=cy(e.geometry(),i,r,n);if(!W_(i,r))return!1;for(const e of s)if(!ty(e,o))return!1}if("MultiPolygon"===t.type){const o=ay(t.coordinates,r,n),s=cy(e.geometry(),i,r,n);if(!W_(i,r))return!1;for(const e of s)if(!iy(e,o))return!1}return!0}(e,this.geometries);if("LineString"===e.geometryType())return function(e,t){const i=[1/0,1/0,-1/0,-1/0],r=[1/0,1/0,-1/0,-1/0],n=e.canonicalID();if("Polygon"===t.type){const o=sy(t.coordinates,r,n),s=uy(e.geometry(),i,r,n);if(!W_(i,r))return!1;for(const e of s)if(!ry(e,o))return!1}if("MultiPolygon"===t.type){const o=ay(t.coordinates,r,n),s=uy(e.geometry(),i,r,n);if(!W_(i,r))return!1;for(const e of s)if(!ny(e,o))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class dy{constructor(e=[],t=(e,t)=>e<t?-1:e>t?1:0){if(this.data=e,this.length=this.data.length,this.compare=t,this.length>0)for(let e=(this.length>>1)-1;e>=0;e--)this._down(e)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(0===this.length)return;const e=this.data[0],t=this.data.pop();return--this.length>0&&(this.data[0]=t,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:t,compare:i}=this,r=t[e];for(;e>0;){const n=e-1>>1,o=t[n];if(i(r,o)>=0)break;t[e]=o,e=n}t[e]=r}_down(e){const{data:t,compare:i}=this,r=this.length>>1,n=t[e];for(;e<r;){let r=1+(e<<1);const o=r+1;if(o<this.length&&i(t[o],t[r])<0&&(r=o),i(t[r],n)>=0)break;t[e]=t[r],e=r}t[e]=n}}function py(e){let t=0;for(let i,r,n=0,o=e.length,s=o-1;n<o;s=n++)i=e[n],r=e[s],t+=(r.x-i.x)*(i.y+r.y);return t}const fy=1/298.257223563,Ay=fy*(2-fy),my=Math.PI/180;class gy{constructor(e){const t=6378.137*my*1e3,i=Math.cos(e*my),r=1/(1-Ay*(1-i*i)),n=Math.sqrt(r);this.kx=t*n*i,this.ky=t*n*r*(1-Ay)}distance(e,t){const i=this.wrap(e[0]-t[0])*this.kx,r=(e[1]-t[1])*this.ky;return Math.sqrt(i*i+r*r)}pointOnLine(e,t){let i,r,n,o,s=1/0;for(let a=0;a<e.length-1;a++){let l=e[a][0],c=e[a][1],u=this.wrap(e[a+1][0]-l)*this.kx,h=(e[a+1][1]-c)*this.ky,d=0;(0!==u||0!==h)&&(d=(this.wrap(t[0]-l)*this.kx*u+(t[1]-c)*this.ky*h)/(u*u+h*h),d>1?(l=e[a+1][0],c=e[a+1][1]):d>0&&(l+=u/this.kx*d,c+=h/this.ky*d)),u=this.wrap(t[0]-l)*this.kx,h=(t[1]-c)*this.ky;const p=u*u+h*h;p<s&&(s=p,i=l,r=c,n=a,o=d)}return{point:[i,r],index:n,t:Math.max(0,Math.min(1,o))}}wrap(e){for(;e<-180;)e+=360;for(;e>180;)e-=360;return e}}function _y(e,t){return t[0]-e[0]}function yy(e){return e[1]-e[0]+1}function vy(e,t){return e[1]>=e[0]&&e[1]<t}function xy(e,t){if(e[0]>e[1])return[null,null];const i=yy(e);if(t){if(2===i)return[e,null];const t=Math.floor(i/2);return[[e[0],e[0]+t],[e[0]+t,e[1]]]}if(1===i)return[e,null];const r=Math.floor(i/2)-1;return[[e[0],e[0]+r],[e[0]+r+1,e[1]]]}function by(e,t){if(!vy(t,e.length))return[1/0,1/0,-1/0,-1/0];const i=[1/0,1/0,-1/0,-1/0];for(let r=t[0];r<=t[1];++r)K_(i,e[r]);return i}function wy(e){const t=[1/0,1/0,-1/0,-1/0];for(const i of e)for(const e of i)K_(t,e);return t}function Ty(e){return e[0]!==-1/0&&e[1]!==-1/0&&e[2]!==1/0&&e[3]!==1/0}function By(e,t,i){if(!Ty(e)||!Ty(t))return NaN;let r=0,n=0;return e[2]<t[0]&&(r=t[0]-e[2]),e[0]>t[2]&&(r=e[0]-t[2]),e[1]>t[3]&&(n=e[1]-t[3]),e[3]<t[1]&&(n=t[1]-e[3]),i.distance([0,0],[r,n])}function Cy(e,t,i){const r=i.pointOnLine(t,e);return i.distance(e,r.point)}function Sy(e,t,i,r,n){const o=Math.min(Cy(e,[i,r],n),Cy(t,[i,r],n)),s=Math.min(Cy(i,[e,t],n),Cy(r,[e,t],n));return Math.min(o,s)}function Ey(e,t,i,r,n){if(!vy(t,e.length)||!vy(r,i.length))return 1/0;let o=1/0;for(let s=t[0];s<t[1];++s){const t=e[s],a=e[s+1];for(let e=r[0];e<r[1];++e){const r=i[e],s=i[e+1];if(J_(t,a,r,s))return 0;o=Math.min(o,Sy(t,a,r,s,n))}}return o}function My(e,t,i,r,n){if(!vy(t,e.length)||!vy(r,i.length))return NaN;let o=1/0;for(let s=t[0];s<=t[1];++s)for(let t=r[0];t<=r[1];++t)if(o=Math.min(o,n.distance(e[s],i[t])),0===o)return o;return o}function Iy(e,t,i){if(ty(e,t,!0))return 0;let r=1/0;for(const n of t){const t=n[0],o=n[n.length-1];if(t!==o&&(r=Math.min(r,Cy(e,[o,t],i)),0===r))return r;const s=i.pointOnLine(n,e);if(r=Math.min(r,i.distance(e,s.point)),0===r)return r}return r}function Py(e,t,i,r){if(!vy(t,e.length))return NaN;for(let r=t[0];r<=t[1];++r)if(ty(e[r],i,!0))return 0;let n=1/0;for(let o=t[0];o<t[1];++o){const t=e[o],s=e[o+1];for(const e of i)for(let i=0,o=e.length,a=o-1;i<o;a=i++){const o=e[a],l=e[i];if(J_(t,s,o,l))return 0;n=Math.min(n,Sy(t,s,o,l,r))}}return n}function Ly(e,t){for(const i of e)for(const e of i)if(ty(e,t,!0))return!0;return!1}function Fy(e,t,i,r=1/0){const n=wy(e),o=wy(t);if(r!==1/0&&By(n,o,i)>=r)return r;if(W_(n,o)){if(Ly(e,t))return 0}else if(Ly(t,e))return 0;let s=1/0;for(const r of e)for(let e=0,n=r.length,o=n-1;e<n;o=e++){const n=r[o],a=r[e];for(const e of t)for(let t=0,r=e.length,o=r-1;t<r;o=t++){const r=e[o],l=e[t];if(J_(n,a,r,l))return 0;s=Math.min(s,Sy(n,a,r,l,i))}}return s}function ky(e,t,i,r,n,o){if(!o)return;const s=By(by(r,o),n,i);s<t&&e.push([s,o,[0,0]])}function zy(e,t,i,r,n,o,s){if(!o||!s)return;const a=By(by(r,o),by(n,s),i);a<t&&e.push([a,o,s])}function Ry(e,t,i,r,n=1/0){let o=Math.min(r.distance(e[0],i[0][0]),n);if(0===o)return o;const s=new dy([[0,[0,e.length-1],[0,0]]],_y),a=wy(i);for(;s.length>0;){const n=s.pop();if(n[0]>=o)continue;const l=n[1],c=t?50:100;if(yy(l)<=c){if(!vy(l,e.length))return NaN;if(t){const t=Py(e,l,i,r);if(isNaN(t)||0===t)return t;o=Math.min(o,t)}else for(let t=l[0];t<=l[1];++t){const n=Iy(e[t],i,r);if(o=Math.min(o,n),0===o)return 0}}else{const i=xy(l,t);ky(s,o,r,e,a,i[0]),ky(s,o,r,e,a,i[1])}}return o}function Dy(e,t,i,r,n,o=1/0){let s=Math.min(o,n.distance(e[0],i[0]));if(0===s)return s;const a=new dy([[0,[0,e.length-1],[0,i.length-1]]],_y);for(;a.length>0;){const o=a.pop();if(o[0]>=s)continue;const l=o[1],c=o[2],u=t?50:100,h=r?50:100;if(yy(l)<=u&&yy(c)<=h){if(!vy(l,e.length)&&vy(c,i.length))return NaN;let o;if(t&&r)o=Ey(e,l,i,c,n),s=Math.min(s,o);else if(t&&!r){const t=e.slice(l[0],l[1]+1);for(let e=c[0];e<=c[1];++e)if(o=Cy(i[e],t,n),s=Math.min(s,o),0===s)return s}else if(!t&&r){const t=i.slice(c[0],c[1]+1);for(let i=l[0];i<=l[1];++i)if(o=Cy(e[i],t,n),s=Math.min(s,o),0===s)return s}else o=My(e,l,i,c,n),s=Math.min(s,o)}else{const o=xy(l,t),u=xy(c,r);zy(a,s,n,e,i,o[0],u[0]),zy(a,s,n,e,i,o[0],u[1]),zy(a,s,n,e,i,o[1],u[0]),zy(a,s,n,e,i,o[1],u[1])}}return s}function Oy(e,t){const i=e.geometry();if(0===i.length||0===i[0].length)return NaN;const r=function(e){if(e.length<=1)return[e];const t=[];let i,r;for(const n of e){const e=py(n);0!==e&&(n.area=Math.abs(e),void 0===r&&(r=e<0),r===e<0?(i&&t.push(i),i=[n]):i.push(n))}return i&&t.push(i),t}(i).map((t=>t.map((t=>t.map((t=>$_([t.x,t.y],e.canonical))))))),n=new gy(r[0][0][0][1]);let o=1/0;for(const e of t)for(const t of r){switch(e.type){case"Point":o=Math.min(o,Ry([e.coordinates],!1,t,n,o));break;case"LineString":o=Math.min(o,Ry(e.coordinates,!0,t,n,o));break;case"Polygon":o=Math.min(o,Fy(t,e.coordinates,n,o))}if(0===o)return o}return o}function Uy(e){return"MultiPolygon"===e.type?e.coordinates.map((e=>({type:"Polygon",coordinates:e}))):"MultiLineString"===e.type?e.coordinates.map((e=>({type:"LineString",coordinates:e}))):"MultiPoint"===e.type?e.coordinates.map((e=>({type:"Point",coordinates:e}))):[e]}class Ny{constructor(e,t){this.type=ig,this.geojson=e,this.geometries=t}static parse(e,t){if(2!==e.length)return t.error(`'distance' expression requires exactly one argument, but found ${e.length-1} instead.`);if(i_(e[1])){const t=e[1];if("FeatureCollection"===t.type)return new Ny(t,t.features.map((e=>Uy(e.geometry))).flat());if("Feature"===t.type)return new Ny(t,Uy(t.geometry));if("type"in t&&"coordinates"in t)return new Ny(t,Uy(t))}return t.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(null!=e.geometry()&&null!=e.canonicalID()){if("Point"===e.geometryType())return function(e,t){const i=e.geometry(),r=i.flat().map((t=>$_([t.x,t.y],e.canonical)));if(0===i.length)return NaN;const n=new gy(r[0][1]);let o=1/0;for(const e of t){switch(e.type){case"Point":o=Math.min(o,Dy(r,!1,[e.coordinates],!1,n,o));break;case"LineString":o=Math.min(o,Dy(r,!1,e.coordinates,!0,n,o));break;case"Polygon":o=Math.min(o,Ry(r,!1,e.coordinates,n,o))}if(0===o)return o}return o}(e,this.geometries);if("LineString"===e.geometryType())return function(e,t){const i=e.geometry(),r=i.flat().map((t=>$_([t.x,t.y],e.canonical)));if(0===i.length)return NaN;const n=new gy(r[0][1]);let o=1/0;for(const e of t){switch(e.type){case"Point":o=Math.min(o,Dy(r,!0,[e.coordinates],!1,n,o));break;case"LineString":o=Math.min(o,Dy(r,!0,e.coordinates,!0,n,o));break;case"Polygon":o=Math.min(o,Ry(r,!0,e.coordinates,n,o))}if(0===o)return o}return o}(e,this.geometries);if("Polygon"===e.geometryType())return Oy(e,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}const Qy={"==":F_,"!=":k_,">":R_,"<":z_,">=":O_,"<=":D_,array:a_,at:A_,boolean:a_,case:y_,coalesce:M_,collator:U_,format:Q_,image:j_,in:m_,"index-of":g_,interpolate:S_,"interpolate-hcl":S_,"interpolate-lab":S_,length:V_,let:p_,literal:o_,match:__,number:a_,"number-format":N_,object:a_,slice:v_,step:b_,string:a_,"to-boolean":c_,"to-color":c_,"to-number":c_,"to-string":c_,var:f_,within:hy,distance:Ny};class jy{constructor(e,t,i,r){this.name=e,this.type=t,this._evaluate=i,this.args=r}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}static parse(e,t){const i=e[0],r=jy.definitions[i];if(!r)return t.error(`Unknown expression "${i}". If you wanted a literal array, use ["literal", [...]].`,0);const n=Array.isArray(r)?r[0]:r.type,o=Array.isArray(r)?[[r[1],r[2]]]:r.overloads,s=o.filter((([t])=>!Array.isArray(t)||t.length===e.length-1));let a=null;for(const[r,o]of s){a=new d_(t.registry,Zy,t.path,null,t.scope);const s=[];let l=!1;for(let t=1;t<e.length;t++){const i=e[t],n=Array.isArray(r)?r[t-1]:r.type,o=a.parse(i,1+s.length,n);if(!o){l=!0;break}s.push(o)}if(!l){if(Array.isArray(r)&&r.length!==s.length){a.error(`Expected ${r.length} arguments, but found ${s.length} instead.`);continue}for(let e=0;e<s.length;e++){const t=Array.isArray(r)?r[e]:r.type,i=s[e];a.concat(e+1).checkSubtype(t,i.type)}if(0===a.errors.length)return new jy(i,n,o,s)}}if(1===s.length)t.errors.push(...a.errors);else{const i=(s.length?s:o).map((([e])=>{return t=e,Array.isArray(t)?`(${t.map(Ag).join(", ")})`:`(${Ag(t.type)}...)`;var t})).join(" | "),r=[];for(let i=1;i<e.length;i++){const n=t.parse(e[i],1+r.length);if(!n)return null;r.push(Ag(n.type))}t.error(`Expected arguments of type ${i}, but found (${r.join(", ")}) instead.`)}return null}static register(e,t){jy.definitions=t;for(const i in t)e[i]=jy}}function Vy(e,[t,i,r,n]){t=t.evaluate(e),i=i.evaluate(e),r=r.evaluate(e);const o=n?n.evaluate(e):1,s=t_(t,i,r,o);if(s)throw new Wg(s);return new Hg(t/255,i/255,r/255,o,!1)}function Hy(e,t){return e in t}function Gy(e,t){const i=t[e];return typeof i>"u"?null:i}function $y(e){return{type:e}}function Zy(e){if(e instanceof f_)return Zy(e.boundExpression);if(e instanceof jy&&"error"===e.name)return!1;if(e instanceof U_)return!1;if(e instanceof hy)return!1;if(e instanceof Ny)return!1;const t=e instanceof c_||e instanceof a_;let i=!0;return e.eachChild((e=>{i=t?i&&Zy(e):i&&e instanceof o_})),!!i&&(qy(e)&&Wy(e,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"]))}function qy(e){if(e instanceof jy){if("get"===e.name&&1===e.args.length)return!1;if("feature-state"===e.name)return!1;if("has"===e.name&&1===e.args.length)return!1;if("properties"===e.name||"geometry-type"===e.name||"id"===e.name)return!1;if(/^filter-/.test(e.name))return!1}if(e instanceof hy||e instanceof Ny)return!1;let t=!0;return e.eachChild((e=>{t&&!qy(e)&&(t=!1)})),t}function Ky(e){if(e instanceof jy&&"feature-state"===e.name)return!1;let t=!0;return e.eachChild((e=>{t&&!Ky(e)&&(t=!1)})),t}function Wy(e,t){if(e instanceof jy&&t.indexOf(e.name)>=0)return!1;let i=!0;return e.eachChild((e=>{i&&!Wy(e,t)&&(i=!1)})),i}function Xy(e){return{result:"success",value:e}}function Yy(e){return{result:"error",value:e}}function Jy(e){return"data-driven"===e["property-type"]||"cross-faded-data-driven"===e["property-type"]}function ev(e){return!!e.expression&&e.expression.parameters.indexOf("zoom")>-1}function tv(e){return!!e.expression&&e.expression.interpolated}function iv(e){return e instanceof Number?"number":e instanceof String?"string":e instanceof Boolean?"boolean":Array.isArray(e)?"array":null===e?"null":typeof e}function rv(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)}jy.register(Qy,{error:[{kind:"error"},[rg],(e,[t])=>{throw new Wg(t.evaluate(e))}],typeof:[rg,[lg],(e,[t])=>Ag(r_(t.evaluate(e)))],"to-rgba":[fg(ig,4),[og],(e,[t])=>{const[i,r,n,o]=t.evaluate(e).rgb;return[255*i,255*r,255*n,o]}],rgb:[og,[ig,ig,ig],Vy],rgba:[og,[ig,ig,ig,ig],Vy],has:{type:ng,overloads:[[[rg],(e,[t])=>Hy(t.evaluate(e),e.properties())],[[rg,ag],(e,[t,i])=>Hy(t.evaluate(e),i.evaluate(e))]]},get:{type:lg,overloads:[[[rg],(e,[t])=>Gy(t.evaluate(e),e.properties())],[[rg,ag],(e,[t,i])=>Gy(t.evaluate(e),i.evaluate(e))]]},"feature-state":[lg,[rg],(e,[t])=>Gy(t.evaluate(e),e.featureState||{})],properties:[ag,[],e=>e.properties()],"geometry-type":[rg,[],e=>e.geometryType()],id:[lg,[],e=>e.id()],zoom:[ig,[],e=>e.globals.zoom],"heatmap-density":[ig,[],e=>e.globals.heatmapDensity||0],"line-progress":[ig,[],e=>e.globals.lineProgress||0],accumulated:[lg,[],e=>void 0===e.globals.accumulated?null:e.globals.accumulated],"+":[ig,$y(ig),(e,t)=>{let i=0;for(const r of t)i+=r.evaluate(e);return i}],"*":[ig,$y(ig),(e,t)=>{let i=1;for(const r of t)i*=r.evaluate(e);return i}],"-":{type:ig,overloads:[[[ig,ig],(e,[t,i])=>t.evaluate(e)-i.evaluate(e)],[[ig],(e,[t])=>-t.evaluate(e)]]},"/":[ig,[ig,ig],(e,[t,i])=>t.evaluate(e)/i.evaluate(e)],"%":[ig,[ig,ig],(e,[t,i])=>t.evaluate(e)%i.evaluate(e)],ln2:[ig,[],()=>Math.LN2],pi:[ig,[],()=>Math.PI],e:[ig,[],()=>Math.E],"^":[ig,[ig,ig],(e,[t,i])=>Math.pow(t.evaluate(e),i.evaluate(e))],sqrt:[ig,[ig],(e,[t])=>Math.sqrt(t.evaluate(e))],log10:[ig,[ig],(e,[t])=>Math.log(t.evaluate(e))/Math.LN10],ln:[ig,[ig],(e,[t])=>Math.log(t.evaluate(e))],log2:[ig,[ig],(e,[t])=>Math.log(t.evaluate(e))/Math.LN2],sin:[ig,[ig],(e,[t])=>Math.sin(t.evaluate(e))],cos:[ig,[ig],(e,[t])=>Math.cos(t.evaluate(e))],tan:[ig,[ig],(e,[t])=>Math.tan(t.evaluate(e))],asin:[ig,[ig],(e,[t])=>Math.asin(t.evaluate(e))],acos:[ig,[ig],(e,[t])=>Math.acos(t.evaluate(e))],atan:[ig,[ig],(e,[t])=>Math.atan(t.evaluate(e))],min:[ig,$y(ig),(e,t)=>Math.min(...t.map((t=>t.evaluate(e))))],max:[ig,$y(ig),(e,t)=>Math.max(...t.map((t=>t.evaluate(e))))],abs:[ig,[ig],(e,[t])=>Math.abs(t.evaluate(e))],round:[ig,[ig],(e,[t])=>{const i=t.evaluate(e);return i<0?-Math.round(-i):Math.round(i)}],floor:[ig,[ig],(e,[t])=>Math.floor(t.evaluate(e))],ceil:[ig,[ig],(e,[t])=>Math.ceil(t.evaluate(e))],"filter-==":[ng,[rg,lg],(e,[t,i])=>e.properties()[t.value]===i.value],"filter-id-==":[ng,[lg],(e,[t])=>e.id()===t.value],"filter-type-==":[ng,[rg],(e,[t])=>e.geometryType()===t.value],"filter-<":[ng,[rg,lg],(e,[t,i])=>{const r=e.properties()[t.value],n=i.value;return typeof r==typeof n&&r<n}],"filter-id-<":[ng,[lg],(e,[t])=>{const i=e.id(),r=t.value;return typeof i==typeof r&&i<r}],"filter->":[ng,[rg,lg],(e,[t,i])=>{const r=e.properties()[t.value],n=i.value;return typeof r==typeof n&&r>n}],"filter-id->":[ng,[lg],(e,[t])=>{const i=e.id(),r=t.value;return typeof i==typeof r&&i>r}],"filter-<=":[ng,[rg,lg],(e,[t,i])=>{const r=e.properties()[t.value],n=i.value;return typeof r==typeof n&&r<=n}],"filter-id-<=":[ng,[lg],(e,[t])=>{const i=e.id(),r=t.value;return typeof i==typeof r&&i<=r}],"filter->=":[ng,[rg,lg],(e,[t,i])=>{const r=e.properties()[t.value],n=i.value;return typeof r==typeof n&&r>=n}],"filter-id->=":[ng,[lg],(e,[t])=>{const i=e.id(),r=t.value;return typeof i==typeof r&&i>=r}],"filter-has":[ng,[lg],(e,[t])=>t.value in e.properties()],"filter-has-id":[ng,[],e=>null!==e.id()&&void 0!==e.id()],"filter-type-in":[ng,[fg(rg)],(e,[t])=>t.value.indexOf(e.geometryType())>=0],"filter-id-in":[ng,[fg(lg)],(e,[t])=>t.value.indexOf(e.id())>=0],"filter-in-small":[ng,[rg,fg(lg)],(e,[t,i])=>i.value.indexOf(e.properties()[t.value])>=0],"filter-in-large":[ng,[rg,fg(lg)],(e,[t,i])=>function(e,t,i,r){for(;i<=r;){const n=i+r>>1;if(t[n]===e)return!0;t[n]>e?r=n-1:i=n+1}return!1}(e.properties()[t.value],i.value,0,i.value.length-1)],all:{type:ng,overloads:[[[ng,ng],(e,[t,i])=>t.evaluate(e)&&i.evaluate(e)],[$y(ng),(e,t)=>{for(const i of t)if(!i.evaluate(e))return!1;return!0}]]},any:{type:ng,overloads:[[[ng,ng],(e,[t,i])=>t.evaluate(e)||i.evaluate(e)],[$y(ng),(e,t)=>{for(const i of t)if(i.evaluate(e))return!0;return!1}]]},"!":[ng,[ng],(e,[t])=>!t.evaluate(e)],"is-supported-script":[ng,[rg],(e,[t])=>{const i=e.globals&&e.globals.isSupportedScript;return!i||i(t.evaluate(e))}],upcase:[rg,[rg],(e,[t])=>t.evaluate(e).toUpperCase()],downcase:[rg,[rg],(e,[t])=>t.evaluate(e).toLowerCase()],concat:[rg,$y(lg),(e,t)=>t.map((t=>n_(t.evaluate(e)))).join("")],"resolved-locale":[rg,[cg],(e,[t])=>t.evaluate(e).resolvedLocale()]});class nv{constructor(e,t){var i;this.expression=e,this._warningHistory={},this._evaluator=new h_,this._defaultValue=t?"color"===(i=t).type&&rv(i.default)?new Hg(0,0,0,0):"color"===i.type?Hg.parse(i.default)||null:"padding"===i.type?Kg.parse(i.default)||null:"variableAnchorOffsetCollection"===i.type?Yg.parse(i.default)||null:"projectionDefinition"===i.type?e_.parse(i.default)||null:void 0===i.default?null:i.default:null,this._enumValues=t&&"enum"===t.type?t.values:null}evaluateWithoutErrorHandling(e,t,i,r,n,o){return this._evaluator.globals=e,this._evaluator.feature=t,this._evaluator.featureState=i,this._evaluator.canonical=r,this._evaluator.availableImages=n||null,this._evaluator.formattedSection=o,this.expression.evaluate(this._evaluator)}evaluate(e,t,i,r,n,o){this._evaluator.globals=e,this._evaluator.feature=t||null,this._evaluator.featureState=i||null,this._evaluator.canonical=r,this._evaluator.availableImages=n||null,this._evaluator.formattedSection=o||null;try{const e=this.expression.evaluate(this._evaluator);if(null==e||"number"==typeof e&&e!=e)return this._defaultValue;if(this._enumValues&&!(e in this._enumValues))throw new Wg(`Expected value to be one of ${Object.keys(this._enumValues).map((e=>JSON.stringify(e))).join(", ")}, but found ${JSON.stringify(e)} instead.`);return e}catch(e){return this._warningHistory[e.message]||(this._warningHistory[e.message]=!0,typeof console<"u"&&console.warn(e.message)),this._defaultValue}}}function ov(e){return Array.isArray(e)&&e.length>0&&"string"==typeof e[0]&&e[0]in Qy}function sv(e,t){const i=new d_(Qy,Zy,[],t?function(e){const t={color:og,string:rg,number:ig,enum:rg,boolean:ng,formatted:ug,padding:hg,projectionDefinition:sg,resolvedImage:dg,variableAnchorOffsetCollection:pg};return"array"===e.type?fg(t[e.value]||lg,e.length):t[e.type]}(t):void 0),r=i.parse(e,void 0,void 0,void 0,t&&"string"===t.type?{typeAnnotation:"coerce"}:void 0);return r?Xy(new nv(r,t)):Yy(i.errors)}class av{constructor(e,t){this.kind=e,this._styleExpression=t,this.isStateDependent="constant"!==e&&!Ky(t.expression)}evaluateWithoutErrorHandling(e,t,i,r,n,o){return this._styleExpression.evaluateWithoutErrorHandling(e,t,i,r,n,o)}evaluate(e,t,i,r,n,o){return this._styleExpression.evaluate(e,t,i,r,n,o)}}class lv{constructor(e,t,i,r){this.kind=e,this.zoomStops=i,this._styleExpression=t,this.isStateDependent="camera"!==e&&!Ky(t.expression),this.interpolationType=r}evaluateWithoutErrorHandling(e,t,i,r,n,o){return this._styleExpression.evaluateWithoutErrorHandling(e,t,i,r,n,o)}evaluate(e,t,i,r,n,o){return this._styleExpression.evaluate(e,t,i,r,n,o)}interpolationFactor(e,t,i){return this.interpolationType?S_.interpolationFactor(this.interpolationType,e,t,i):0}}function cv(e,t){const i=sv(e,t);if("error"===i.result)return i;const r=i.value.expression,n=qy(r);if(!n&&!Jy(t))return Yy([new Jm("","data expressions not supported")]);const o=Wy(r,["zoom"]);if(!o&&!ev(t))return Yy([new Jm("","zoom expressions not supported")]);const s=uv(r);if(!s&&!o)return Yy([new Jm("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')]);if(s instanceof Jm)return Yy([s]);if(s instanceof S_&&!tv(t))return Yy([new Jm("",'"interpolate" expressions cannot be used with this property')]);if(!s)return Xy(new av(n?"constant":"source",i.value));const a=s instanceof S_?s.interpolation:void 0;return Xy(new lv(n?"camera":"composite",i.value,s.labels,a))}function uv(e){let t=null;if(e instanceof p_)t=uv(e.result);else if(e instanceof M_){for(const i of e.args)if(t=uv(i),t)break}else(e instanceof b_||e instanceof S_)&&e.input instanceof jy&&"zoom"===e.input.name&&(t=e);return t instanceof Jm||e.eachChild((e=>{const i=uv(e);i instanceof Jm?t=i:!t&&i?t=new Jm("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&i&&t!==i&&(t=new Jm("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),t}function hv(e){if(!0===e||!1===e)return!0;if(!Array.isArray(e)||0===e.length)return!1;switch(e[0]){case"has":return e.length>=2&&"$id"!==e[1]&&"$type"!==e[1];case"in":return e.length>=3&&("string"!=typeof e[1]||Array.isArray(e[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==e.length||Array.isArray(e[1])||Array.isArray(e[2]);case"any":case"all":for(const t of e.slice(1))if(!hv(t)&&"boolean"!=typeof t)return!1;return!0;default:return!0}}function dv(e){const t=e.key,i=e.value;return i?[new Xm(t,i,"constants have been deprecated as of v8")]:[]}function pv(e){return e instanceof Number||e instanceof String||e instanceof Boolean?e.valueOf():e}function fv(e){if(Array.isArray(e))return e.map(fv);if(e instanceof Object&&!(e instanceof Number||e instanceof String||e instanceof Boolean)){const t={};for(const i in e)t[i]=fv(e[i]);return t}return pv(e)}function Av(e){const t=e.key,i=e.value,r=e.valueSpec||{},n=e.objectElementValidators||{},o=e.style,s=e.styleSpec,a=e.validateSpec;let l=[];const c=iv(i);if("object"!==c)return[new Xm(t,i,`object expected, ${c} found`)];for(const e in i){const c=e.split(".")[0],u=r[c]||r["*"];let h;if(n[c])h=n[c];else if(r[c])h=a;else if(n["*"])h=n["*"];else{if(!r["*"]){l.push(new Xm(t,i[e],`unknown property "${e}"`));continue}h=a}l=l.concat(h({key:(t&&`${t}.`)+e,value:i[e],valueSpec:u,style:o,styleSpec:s,object:i,objectKey:e,validateSpec:a},i))}for(const e in r)n[e]||r[e].required&&void 0===r[e].default&&void 0===i[e]&&l.push(new Xm(t,i,`missing required property "${e}"`));return l}function mv(e){const t=e.value,i=e.valueSpec,r=e.validateSpec,n=e.style,o=e.styleSpec,s=e.key,a=e.arrayElementValidator||r;if("array"!==iv(t))return[new Xm(s,t,`array expected, ${iv(t)} found`)];if(i.length&&t.length!==i.length)return[new Xm(s,t,`array length ${i.length} expected, length ${t.length} found`)];if(i["min-length"]&&t.length<i["min-length"])return[new Xm(s,t,`array length at least ${i["min-length"]} expected, length ${t.length} found`)];let l={type:i.value,values:i.values};o.$version<7&&(l.function=i.function),"object"===iv(i.value)&&(l=i.value);let c=[];for(let i=0;i<t.length;i++)c=c.concat(a({array:t,arrayIndex:i,value:t[i],valueSpec:l,validateSpec:e.validateSpec,style:n,styleSpec:o,key:`${s}[${i}]`}));return c}function gv(e){const t=e.key,i=e.value,r=e.valueSpec;let n=iv(i);return"number"===n&&i!=i&&(n="NaN"),"number"!==n?[new Xm(t,i,`number expected, ${n} found`)]:"minimum"in r&&i<r.minimum?[new Xm(t,i,`${i} is less than the minimum value ${r.minimum}`)]:"maximum"in r&&i>r.maximum?[new Xm(t,i,`${i} is greater than the maximum value ${r.maximum}`)]:[]}function _v(e){const t=e.valueSpec,i=pv(e.value.type);let r,n,o,s={};const a="categorical"!==i&&void 0===e.value.property,l=!a,c="array"===iv(e.value.stops)&&"array"===iv(e.value.stops[0])&&"object"===iv(e.value.stops[0][0]),u=Av({key:e.key,value:e.value,valueSpec:e.styleSpec.function,validateSpec:e.validateSpec,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{stops:function(e){if("identity"===i)return[new Xm(e.key,e.value,'identity function may not have a "stops" property')];let t=[];const r=e.value;return t=t.concat(mv({key:e.key,value:r,valueSpec:e.valueSpec,validateSpec:e.validateSpec,style:e.style,styleSpec:e.styleSpec,arrayElementValidator:h})),"array"===iv(r)&&0===r.length&&t.push(new Xm(e.key,r,"array must have at least one stop")),t},default:function(e){return e.validateSpec({key:e.key,value:e.value,valueSpec:t,validateSpec:e.validateSpec,style:e.style,styleSpec:e.styleSpec})}}});return"identity"===i&&a&&u.push(new Xm(e.key,e.value,'missing required property "property"')),"identity"!==i&&!e.value.stops&&u.push(new Xm(e.key,e.value,'missing required property "stops"')),"exponential"===i&&e.valueSpec.expression&&!tv(e.valueSpec)&&u.push(new Xm(e.key,e.value,"exponential functions not supported")),e.styleSpec.$version>=8&&(l&&!Jy(e.valueSpec)?u.push(new Xm(e.key,e.value,"property functions not supported")):a&&!ev(e.valueSpec)&&u.push(new Xm(e.key,e.value,"zoom functions not supported"))),("categorical"===i||c)&&void 0===e.value.property&&u.push(new Xm(e.key,e.value,'"property" property is required')),u;function h(e){let i=[];const r=e.value,a=e.key;if("array"!==iv(r))return[new Xm(a,r,`array expected, ${iv(r)} found`)];if(2!==r.length)return[new Xm(a,r,`array length 2 expected, length ${r.length} found`)];if(c){if("object"!==iv(r[0]))return[new Xm(a,r,`object expected, ${iv(r[0])} found`)];if(void 0===r[0].zoom)return[new Xm(a,r,"object stop key must have zoom")];if(void 0===r[0].value)return[new Xm(a,r,"object stop key must have value")];if(o&&o>pv(r[0].zoom))return[new Xm(a,r[0].zoom,"stop zoom values must appear in ascending order")];pv(r[0].zoom)!==o&&(o=pv(r[0].zoom),n=void 0,s={}),i=i.concat(Av({key:`${a}[0]`,value:r[0],valueSpec:{zoom:{}},validateSpec:e.validateSpec,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{zoom:gv,value:d}}))}else i=i.concat(d({key:`${a}[0]`,value:r[0],valueSpec:{},validateSpec:e.validateSpec,style:e.style,styleSpec:e.styleSpec},r));return ov(fv(r[1]))?i.concat([new Xm(`${a}[1]`,r[1],"expressions are not allowed in function stops.")]):i.concat(e.validateSpec({key:`${a}[1]`,value:r[1],valueSpec:t,validateSpec:e.validateSpec,style:e.style,styleSpec:e.styleSpec}))}function d(e,o){const a=iv(e.value),l=pv(e.value),c=null!==e.value?e.value:o;if(r){if(a!==r)return[new Xm(e.key,c,`${a} stop domain type must match previous stop domain type ${r}`)]}else r=a;if("number"!==a&&"string"!==a&&"boolean"!==a)return[new Xm(e.key,c,"stop domain value must be a number, string, or boolean")];if("number"!==a&&"categorical"!==i){let r=`number expected, ${a} found`;return Jy(t)&&void 0===i&&(r+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Xm(e.key,c,r)]}return"categorical"!==i||"number"!==a||isFinite(l)&&Math.floor(l)===l?"categorical"!==i&&"number"===a&&void 0!==n&&l<n?[new Xm(e.key,c,"stop domain values must appear in ascending order")]:(n=l,"categorical"===i&&l in s?[new Xm(e.key,c,"stop domain values must be unique")]:(s[l]=!0,[])):[new Xm(e.key,c,`integer expected, found ${l}`)]}}function yv(e){const t=("property"===e.expressionContext?cv:sv)(fv(e.value),e.valueSpec);if("error"===t.result)return t.value.map((t=>new Xm(`${e.key}${t.key}`,e.value,t.message)));const i=t.value.expression||t.value._styleExpression.expression;if("property"===e.expressionContext&&"text-font"===e.propertyKey&&!i.outputDefined())return[new Xm(e.key,e.value,`Invalid data expression for "${e.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===e.expressionContext&&"layout"===e.propertyType&&!Ky(i))return[new Xm(e.key,e.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===e.expressionContext&&!Ky(i))return[new Xm(e.key,e.value,'"feature-state" data expressions are not supported with filters.')];if(e.expressionContext&&0===e.expressionContext.indexOf("cluster")){if(!Wy(i,["zoom","feature-state"]))return[new Xm(e.key,e.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===e.expressionContext&&!qy(i))return[new Xm(e.key,e.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function vv(e){const t=e.key,i=e.value,r=e.valueSpec,n=[];return Array.isArray(r.values)?-1===r.values.indexOf(pv(i))&&n.push(new Xm(t,i,`expected one of [${r.values.join(", ")}], ${JSON.stringify(i)} found`)):-1===Object.keys(r.values).indexOf(pv(i))&&n.push(new Xm(t,i,`expected one of [${Object.keys(r.values).join(", ")}], ${JSON.stringify(i)} found`)),n}function xv(e){return hv(fv(e.value))?yv(Ym({},e,{expressionContext:"filter",valueSpec:{value:"boolean"}})):bv(e)}function bv(e){const t=e.value,i=e.key;if("array"!==iv(t))return[new Xm(i,t,`array expected, ${iv(t)} found`)];const r=e.styleSpec;let n,o=[];if(t.length<1)return[new Xm(i,t,"filter array must have at least 1 element")];switch(o=o.concat(vv({key:`${i}[0]`,value:t[0],valueSpec:r.filter_operator,style:e.style,styleSpec:e.styleSpec})),pv(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&"$type"===pv(t[1])&&o.push(new Xm(i,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":3!==t.length&&o.push(new Xm(i,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(n=iv(t[1]),"string"!==n&&o.push(new Xm(`${i}[1]`,t[1],`string expected, ${n} found`)));for(let s=2;s<t.length;s++)n=iv(t[s]),"$type"===pv(t[1])?o=o.concat(vv({key:`${i}[${s}]`,value:t[s],valueSpec:r.geometry_type,style:e.style,styleSpec:e.styleSpec})):"string"!==n&&"number"!==n&&"boolean"!==n&&o.push(new Xm(`${i}[${s}]`,t[s],`string, number, or boolean expected, ${n} found`));break;case"any":case"all":case"none":for(let r=1;r<t.length;r++)o=o.concat(bv({key:`${i}[${r}]`,value:t[r],style:e.style,styleSpec:e.styleSpec}));break;case"has":case"!has":n=iv(t[1]),2!==t.length?o.push(new Xm(i,t,`filter array for "${t[0]}" operator must have 2 elements`)):"string"!==n&&o.push(new Xm(`${i}[1]`,t[1],`string expected, ${n} found`))}return o}function wv(e,t){const i=e.key,r=e.validateSpec,n=e.style,o=e.styleSpec,s=e.value,a=e.objectKey,l=o[`${t}_${e.layerType}`];if(!l)return[];const c=a.match(/^(.*)-transition$/);if("paint"===t&&c&&l[c[1]]&&l[c[1]].transition)return r({key:i,value:s,valueSpec:o.transition,style:n,styleSpec:o});const u=e.valueSpec||l[a];if(!u)return[new Xm(i,s,`unknown property "${a}"`)];let h;if("string"===iv(s)&&Jy(u)&&!u.tokens&&(h=/^{([^}]+)}$/.exec(s)))return[new Xm(i,s,`"${a}" does not support interpolation syntax\nUse an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(h[1])} }\`.`)];const d=[];return"symbol"===e.layerType&&("text-field"===a&&n&&!n.glyphs&&d.push(new Xm(i,s,'use of "text-field" requires a style "glyphs" property')),"text-font"===a&&rv(fv(s))&&"identity"===pv(s.type)&&d.push(new Xm(i,s,'"text-font" does not support identity functions'))),d.concat(r({key:e.key,value:s,valueSpec:u,style:n,styleSpec:o,expressionContext:"property",propertyType:t,propertyKey:a}))}function Tv(e){return wv(e,"paint")}function Bv(e){return wv(e,"layout")}function Cv(e){let t=[];const i=e.value,r=e.key,n=e.style,o=e.styleSpec;!i.type&&!i.ref&&t.push(new Xm(r,i,'either "type" or "ref" is required'));let s=pv(i.type);const a=pv(i.ref);if(i.id){const o=pv(i.id);for(let s=0;s<e.arrayIndex;s++){const e=n.layers[s];pv(e.id)===o&&t.push(new Xm(r,i.id,`duplicate layer id "${i.id}", previously used at line ${e.id.__line__}`))}}if("ref"in i){let e;["type","source","source-layer","filter","layout"].forEach((e=>{e in i&&t.push(new Xm(r,i[e],`"${e}" is prohibited for ref layers`))})),n.layers.forEach((t=>{pv(t.id)===a&&(e=t)})),e?e.ref?t.push(new Xm(r,i.ref,"ref cannot reference another ref layer")):s=pv(e.type):t.push(new Xm(r,i.ref,`ref layer "${a}" not found`))}else if("background"!==s)if(i.source){const e=n.sources&&n.sources[i.source],o=e&&pv(e.type);e?"vector"===o&&"raster"===s?t.push(new Xm(r,i.source,`layer "${i.id}" requires a raster source`)):"raster-dem"!==o&&"hillshade"===s?t.push(new Xm(r,i.source,`layer "${i.id}" requires a raster-dem source`)):"raster"===o&&"raster"!==s?t.push(new Xm(r,i.source,`layer "${i.id}" requires a vector source`)):"vector"!==o||i["source-layer"]?"raster-dem"===o&&"hillshade"!==s?t.push(new Xm(r,i.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"===s&&i.paint&&i.paint["line-gradient"]&&("geojson"!==o||!e.lineMetrics)&&t.push(new Xm(r,i,`layer "${i.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new Xm(r,i,`layer "${i.id}" must specify a "source-layer"`)):t.push(new Xm(r,i.source,`source "${i.source}" not found`))}else t.push(new Xm(r,i,'missing required property "source"'));return t=t.concat(Av({key:r,value:i,valueSpec:o.layer,style:e.style,styleSpec:e.styleSpec,validateSpec:e.validateSpec,objectElementValidators:{"*":()=>[],type:()=>e.validateSpec({key:`${r}.type`,value:i.type,valueSpec:o.layer.type,style:e.style,styleSpec:e.styleSpec,validateSpec:e.validateSpec,object:i,objectKey:"type"}),filter:xv,layout:e=>Av({layer:i,key:e.key,value:e.value,style:e.style,styleSpec:e.styleSpec,validateSpec:e.validateSpec,objectElementValidators:{"*":e=>Bv(Ym({layerType:s},e))}}),paint:e=>Av({layer:i,key:e.key,value:e.value,style:e.style,styleSpec:e.styleSpec,validateSpec:e.validateSpec,objectElementValidators:{"*":e=>Tv(Ym({layerType:s},e))}})}})),t}function Sv(e){const t=e.value,i=e.key,r=iv(t);return"string"!==r?[new Xm(i,t,`string expected, ${r} found`)]:[]}const Ev={promoteId:function({key:e,value:t}){if("string"===iv(t))return Sv({key:e,value:t});{const i=[];for(const r in t)i.push(...Sv({key:`${e}.${r}`,value:t[r]}));return i}}};function Mv(e){const t=e.value,i=e.key,r=e.styleSpec,n=e.style,o=e.validateSpec;if(!t.type)return[new Xm(i,t,'"type" is required')];const s=pv(t.type);let a;switch(s){case"vector":case"raster":return a=Av({key:i,value:t,valueSpec:r[`source_${s.replace("-","_")}`],style:e.style,styleSpec:r,objectElementValidators:Ev,validateSpec:o}),a;case"raster-dem":return a=function(e){var t;const i=null!==(t=e.sourceName)&&void 0!==t?t:"",r=e.value,n=e.styleSpec,o=n.source_raster_dem,s=e.style;let a=[];const l=iv(r);if(void 0===r)return a;if("object"!==l)return a.push(new Xm("source_raster_dem",r,`object expected, ${l} found`)),a;const c="custom"===pv(r.encoding),u=["redFactor","greenFactor","blueFactor","baseShift"],h=e.value.encoding?`"${e.value.encoding}"`:"Default";for(const t in r)!c&&u.includes(t)?a.push(new Xm(t,r[t],`In "${i}": "${t}" is only valid when "encoding" is set to "custom". ${h} encoding found`)):o[t]?a=a.concat(e.validateSpec({key:t,value:r[t],valueSpec:o[t],validateSpec:e.validateSpec,style:s,styleSpec:n})):a.push(new Xm(t,r[t],`unknown property "${t}"`));return a}({sourceName:i,value:t,style:e.style,styleSpec:r,validateSpec:o}),a;case"geojson":if(a=Av({key:i,value:t,valueSpec:r.source_geojson,style:n,styleSpec:r,validateSpec:o,objectElementValidators:Ev}),t.cluster)for(const e in t.clusterProperties){const[r,n]=t.clusterProperties[e],s="string"==typeof r?[r,["accumulated"],["get",e]]:r;a.push(...yv({key:`${i}.${e}.map`,value:n,validateSpec:o,expressionContext:"cluster-map"})),a.push(...yv({key:`${i}.${e}.reduce`,value:s,validateSpec:o,expressionContext:"cluster-reduce"}))}return a;case"video":return Av({key:i,value:t,valueSpec:r.source_video,style:n,validateSpec:o,styleSpec:r});case"image":return Av({key:i,value:t,valueSpec:r.source_image,style:n,validateSpec:o,styleSpec:r});case"canvas":return[new Xm(i,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return vv({key:`${i}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:n,validateSpec:o,styleSpec:r})}}function Iv(e){const t=e.value,i=e.styleSpec,r=i.light,n=e.style;let o=[];const s=iv(t);if(void 0===t)return o;if("object"!==s)return o=o.concat([new Xm("light",t,`object expected, ${s} found`)]),o;for(const s in t){const a=s.match(/^(.*)-transition$/);o=a&&r[a[1]]&&r[a[1]].transition?o.concat(e.validateSpec({key:s,value:t[s],valueSpec:i.transition,validateSpec:e.validateSpec,style:n,styleSpec:i})):r[s]?o.concat(e.validateSpec({key:s,value:t[s],valueSpec:r[s],validateSpec:e.validateSpec,style:n,styleSpec:i})):o.concat([new Xm(s,t[s],`unknown property "${s}"`)])}return o}function Pv(e){const t=e.value,i=e.styleSpec,r=i.sky,n=e.style,o=iv(t);if(void 0===t)return[];if("object"!==o)return[new Xm("sky",t,`object expected, ${o} found`)];let s=[];for(const o in t)s=r[o]?s.concat(e.validateSpec({key:o,value:t[o],valueSpec:r[o],style:n,styleSpec:i})):s.concat([new Xm(o,t[o],`unknown property "${o}"`)]);return s}function Lv(e){const t=e.value,i=e.styleSpec,r=i.terrain,n=e.style;let o=[];const s=iv(t);if(void 0===t)return o;if("object"!==s)return o=o.concat([new Xm("terrain",t,`object expected, ${s} found`)]),o;for(const s in t)o=r[s]?o.concat(e.validateSpec({key:s,value:t[s],valueSpec:r[s],validateSpec:e.validateSpec,style:n,styleSpec:i})):o.concat([new Xm(s,t[s],`unknown property "${s}"`)]);return o}function Fv(e){let t=[];const i=e.value,r=e.key;if(Array.isArray(i)){const n=[],o=[];for(const s in i){i[s].id&&n.includes(i[s].id)&&t.push(new Xm(r,i,`all the sprites' ids must be unique, but ${i[s].id} is duplicated`)),n.push(i[s].id),i[s].url&&o.includes(i[s].url)&&t.push(new Xm(r,i,`all the sprites' URLs must be unique, but ${i[s].url} is duplicated`)),o.push(i[s].url);const a={id:{type:"string",required:!0},url:{type:"string",required:!0}};t=t.concat(Av({key:`${r}[${s}]`,value:i[s],valueSpec:a,validateSpec:e.validateSpec}))}return t}return Sv({key:r,value:i})}const kv={"*":()=>[],array:mv,boolean:function(e){const t=e.value,i=e.key,r=iv(t);return"boolean"!==r?[new Xm(i,t,`boolean expected, ${r} found`)]:[]},number:gv,color:function(e){const t=e.key,i=e.value,r=iv(i);return"string"!==r?[new Xm(t,i,`color expected, ${r} found`)]:Hg.parse(String(i))?[]:[new Xm(t,i,`color expected, "${i}" found`)]},constants:dv,enum:vv,filter:xv,function:_v,layer:Cv,object:Av,source:Mv,light:Iv,sky:Pv,terrain:Lv,projection:function(e){const t=e.value,i=e.styleSpec,r=i.projection,n=e.style,o=iv(t);if(void 0===t)return[];if("object"!==o)return[new Xm("projection",t,`object expected, ${o} found`)];let s=[];for(const o in t)s=r[o]?s.concat(e.validateSpec({key:o,value:t[o],valueSpec:r[o],style:n,styleSpec:i})):s.concat([new Xm(o,t[o],`unknown property "${o}"`)]);return s},projectionDefinition:function(e){const t=e.key;let i=e.value;i=i instanceof String?i.valueOf():i;const r=iv(i);return"array"!==r||function(e){return Array.isArray(e)&&3===e.length&&"string"==typeof e[0]&&"string"==typeof e[1]&&"number"==typeof e[2]}(i)||function(e){return!!["interpolate","step","literal"].includes(e[0])}(i)?["array","string"].includes(r)?[]:[new Xm(t,i,`projection expected, invalid type "${r}" found`)]:[new Xm(t,i,`projection expected, invalid array ${JSON.stringify(i)} found`)]},string:Sv,formatted:function(e){return 0===Sv(e).length?[]:yv(e)},resolvedImage:function(e){return 0===Sv(e).length?[]:yv(e)},padding:function(e){const t=e.key,i=e.value;if("array"===iv(i)){if(i.length<1||i.length>4)return[new Xm(t,i,`padding requires 1 to 4 values; ${i.length} values found`)];const r={type:"number"};let n=[];for(let o=0;o<i.length;o++)n=n.concat(e.validateSpec({key:`${t}[${o}]`,value:i[o],validateSpec:e.validateSpec,valueSpec:r}));return n}return gv({key:t,value:i,valueSpec:{}})},variableAnchorOffsetCollection:function(e){const t=e.key,i=e.value,r=iv(i),n=e.styleSpec;if("array"!==r||i.length<1||i.length%2!=0)return[new Xm(t,i,"variableAnchorOffsetCollection requires a non-empty array of even length")];let o=[];for(let r=0;r<i.length;r+=2)o=o.concat(vv({key:`${t}[${r}]`,value:i[r],valueSpec:n.layout_symbol["text-anchor"]})),o=o.concat(mv({key:`${t}[${r+1}]`,value:i[r+1],valueSpec:{length:2,value:"number"},validateSpec:e.validateSpec,style:e.style,styleSpec:n}));return o},sprite:Fv};function zv(e){const t=e.value,i=e.valueSpec,r=e.styleSpec;return e.validateSpec=zv,i.expression&&rv(pv(t))?_v(e):i.expression&&ov(fv(t))?yv(e):i.type&&kv[i.type]?kv[i.type](e):Av(Ym({},e,{valueSpec:i.type?r[i.type]:i}))}function Rv(e){const t=e.value,i=e.key,r=Sv(e);return r.length||(-1===t.indexOf("{fontstack}")&&r.push(new Xm(i,t,'"glyphs" url must include a "{fontstack}" token')),-1===t.indexOf("{range}")&&r.push(new Xm(i,t,'"glyphs" url must include a "{range}" token'))),r}function Dv(e,t=Wm){let i=[];return i=i.concat(zv({key:"",value:e,valueSpec:t.$root,styleSpec:t,style:e,validateSpec:zv,objectElementValidators:{glyphs:Rv,"*":()=>[]}})),e.constants&&(i=i.concat(dv({key:"constants",value:e.constants,style:e,styleSpec:t,validateSpec:zv}))),Uv(i)}function Ov(e){return function(t){return e({...t,validateSpec:zv})}}function Uv(e){return[].concat(e).sort(((e,t)=>e.line-t.line))}function Nv(e){return function(...t){return Uv(e.apply(this,t))}}function Qv(e){if(!e)return{style:Ff[If[0].referenceStyleID].getDefaultVariant().getExpandedStyleURL(),requiresUrlMonitoring:!1,isFallback:!0};if("string"==typeof e){const t=function(e){try{const t=JSON.parse(e),i=Dv(t);return{isValidJSON:!0,isValidStyle:0===i.length,styleObject:0===i.length?t:null}}catch{return{isValidJSON:!1,isValidStyle:!1,styleObject:null}}}(e);return t.isValidStyle?{style:t.styleObject,requiresUrlMonitoring:!1,isFallback:!1}:t.isValidJSON?{style:Ff[If[0].referenceStyleID].getDefaultVariant().getExpandedStyleURL(),requiresUrlMonitoring:!1,isFallback:!0}:e.startsWith("http")?{style:e,requiresUrlMonitoring:!0,isFallback:!1}:e.toLowerCase().includes(".json")?{style:jv(e),requiresUrlMonitoring:!0,isFallback:!1}:{style:Sf(e),requiresUrlMonitoring:!0,isFallback:!1}}return e instanceof Ef?{style:e.getExpandedStyleURL(),requiresUrlMonitoring:!1,isFallback:!1}:e instanceof Mf?{style:e.getDefaultVariant().getExpandedStyleURL(),requiresUrlMonitoring:!1,isFallback:!1}:0===Dv(e).length?{style:e,requiresUrlMonitoring:!1,isFallback:!1}:{style:Ff[If[0].referenceStyleID].getDefaultVariant().getExpandedStyleURL(),requiresUrlMonitoring:!1,isFallback:!0}}function jv(e){try{return new URL(e).href}catch{}return new URL(e,location.origin).href}function Vv(e,t,i){const r=window.document.createElement(e);return void 0!==t&&(r.className=t),i&&i.appendChild(r),r}function Hv(e){e.parentNode&&e.parentNode.removeChild(e)}Dv.source=Nv(Ov(Mv)),Dv.sprite=Nv(Ov(Fv)),Dv.glyphs=Nv(Ov(Rv)),Dv.light=Nv(Ov(Iv)),Dv.sky=Nv(Ov(Pv)),Dv.terrain=Nv(Ov(Lv)),Dv.layer=Nv(Ov(Cv)),Dv.filter=Nv(Ov(xv)),Dv.paintProperty=Nv(Ov(Tv)),Dv.layoutProperty=Nv(Ov(Bv));class Gv{constructor(){$A(this,"_map"),$A(this,"_container"),$A(this,"_terrainButton"),function(e,t){for(const i of e)"function"==typeof t[i]&&(t[i]=t[i].bind(t))}(["_toggleTerrain","_updateTerrainIcon"],this)}onAdd(e){return this._map=e,this._container=Vv("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=Vv("button","maplibregl-ctrl-terrain",this._container),Vv("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){Hv(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}_toggleTerrain(){this._map.hasTerrain()?this._map.disableTerrain():this._map.enableTerrain(),this._updateTerrainIcon()}_updateTerrainIcon(){this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.hasTerrain()?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))}}class $v extends km{constructor(e={}){super({showCompass:e.showCompass??!0,showZoom:e.showZoom??!0,visualizePitch:e.visualizePitch??!0}),$A(this,"_rotateCompassArrow",(()=>{const e=this._map.getBearing(),t=this._map.getPitch(),i=this.options.visualizePitch?`scale(${Math.min(1.5,1/Math.cos(t*(Math.PI/180))**.5)}) rotateX(${Math.min(70,t)}deg) rotateZ(${-e}deg)`:`rotate(${-e}deg)`;this._compassIcon.style.transform=i})),this._compass&&(this._compass.removeEventListener("click",this._compass.clickFunction),this._compass.addEventListener("click",(e=>{0===this._map.getPitch()?this._map.easeTo({pitch:Math.min(this._map.getMaxPitch(),80)}):this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:e}):this._map.resetNorth({},{originalEvent:e})})))}_createButton(e,t){const i=super._createButton(e,t);return i.clickFunction=t,i}}const Zv=We.Marker,qv=We.LngLat,Kv=We.LngLatBounds;class Wv extends zm{constructor(){super(...arguments),$A(this,"lastUpdatedCenter",new qv(0,0)),$A(this,"_updateCamera",(e=>{var t;const i=new qv(e.coords.longitude,e.coords.latitude),r=e.coords.accuracy,n={bearing:this._map.getBearing(),...this.options.fitBoundsOptions,linear:!0},o=this._map.getZoom();o>((null==(t=this.options.fitBoundsOptions)?void 0:t.maxZoom)??30)&&(n.zoom=o),this._map.fitBounds(Kv.fromLngLat(i,r),n,{geolocateSource:!0});let s=!1;const a=()=>{s=!0};this._map.once("click",a),this._map.once("dblclick",a),this._map.once("dragstart",a),this._map.once("mousedown",a),this._map.once("touchstart",a),this._map.once("wheel",a),this._map.once("moveend",(()=>{this._map.off("click",a),this._map.off("dblclick",a),this._map.off("dragstart",a),this._map.off("mousedown",a),this._map.off("touchstart",a),this._map.off("wheel",a),!s&&(this.lastUpdatedCenter=this._map.getCenter())}))})),$A(this,"_finishSetupUI",(e=>{if(this._map){if(!1===e){const e=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=e,this._geolocateButton.setAttribute("aria-label",e)}else{const e=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=e,this._geolocateButton.setAttribute("aria-label",e)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Vv("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Zv({element:this._dotElement}),this._circleElement=Vv("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Zv({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("move",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("moveend",(e=>{const t=e.originalEvent&&"resize"===e.originalEvent.type,i=this.lastUpdatedCenter.distanceTo(this._map.getCenter());!e.geolocateSource&&"ACTIVE_LOCK"===this._watchState&&!t&&i>1&&(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new Event("trackuserlocationend")))}))}})),$A(this,"_onZoom",(()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}))}_updateCircleRadius(){if("BACKGROUND"!==this._watchState&&"ACTIVE_LOCK"!==this._watchState)return;const e=[this._lastKnownPosition.coords.longitude,this._lastKnownPosition.coords.latitude],t=this._map.project(e),i=this._map.unproject([t.x,t.y]),r=this._map.unproject([t.x+20,t.y]),n=i.distanceTo(r)/20,o=Math.ceil(2*this._accuracy/n);this._circleElement.style.width=`${o}px`,this._circleElement.style.height=`${o}px`}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":case"BACKGROUND_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}}var Xv,Yv,Jv,ex,tx,ix,rx,nx,ox,sx;class ax{constructor(e,t){KA(this,rx),KA(this,Xv),$A(this,"map"),KA(this,Yv),KA(this,Jv),KA(this,ex),KA(this,tx,!1),KA(this,ix),void 0!==e.style&&WA(this,tx,!0),WA(this,Xv,{zoomAdjust:-4,position:"top-right",...t,forceNoAttributionControl:!0,attributionControl:!1,navigationControl:!1,geolocateControl:!1,maptilerLogo:!1,minimap:!1,hash:!1,pitchAdjust:!1,...e,containerStyle:{border:"1px solid #000",width:"400px",height:"300px",...e.containerStyle??{}}}),void 0!==e.lockZoom&&(qA(this,Xv).minZoom=e.lockZoom,qA(this,Xv).maxZoom=e.lockZoom)}setStyle(e,t){qA(this,tx)||this.map.setStyle(e,t),XA(this,rx,ox).call(this)}addLayer(e,t){return qA(this,tx)||this.map.addLayer(e,t),XA(this,rx,ox).call(this),this.map}moveLayer(e,t){return qA(this,tx)||this.map.moveLayer(e,t),XA(this,rx,ox).call(this),this.map}removeLayer(e){return qA(this,tx)||this.map.removeLayer(e),XA(this,rx,ox).call(this),this}setLayerZoomRange(e,t,i){return qA(this,tx)||this.map.setLayerZoomRange(e,t,i),XA(this,rx,ox).call(this),this}setFilter(e,t,i){return qA(this,tx)||this.map.setFilter(e,t,i),XA(this,rx,ox).call(this),this}setPaintProperty(e,t,i,r){return qA(this,tx)||this.map.setPaintProperty(e,t,i,r),XA(this,rx,ox).call(this),this}setLayoutProperty(e,t,i,r){return qA(this,tx)||this.map.setLayoutProperty(e,t,i,r),XA(this,rx,ox).call(this),this}setGlyphs(e,t){return qA(this,tx)||this.map.setGlyphs(e,t),XA(this,rx,ox).call(this),this}onAdd(e){WA(this,Yv,e),WA(this,Jv,Vv("div","maplibregl-ctrl maplibregl-ctrl-group"));for(const[e,t]of Object.entries(qA(this,Xv).containerStyle))qA(this,Jv).style.setProperty(e,t);return qA(this,Xv).container=qA(this,Jv),qA(this,Xv).zoom=e.getZoom()+qA(this,Xv).zoomAdjust,this.map=new dx(qA(this,Xv)),this.map.once("style.load",(()=>{this.map.resize()})),this.map.once("load",(()=>{XA(this,rx,nx).call(this,qA(this,Xv).parentRect),WA(this,ix,XA(this,rx,sx).call(this))})),qA(this,Jv)}onRemove(){var e;null==(e=qA(this,ix))||e.call(this),Hv(qA(this,Jv))}}Xv=new WeakMap,Yv=new WeakMap,Jv=new WeakMap,ex=new WeakMap,tx=new WeakMap,ix=new WeakMap,rx=new WeakSet,nx=function(e){void 0===e||void 0===e.linePaint&&void 0===e.fillPaint||(WA(this,ex,{type:"Feature",properties:{name:"parentRect"},geometry:{type:"Polygon",coordinates:[[[],[],[],[],[]]]}}),this.map.addSource("parentRect",{type:"geojson",data:qA(this,ex)}),(void 0!==e.lineLayout||void 0!==e.linePaint)&&this.map.addLayer({id:"parentRectOutline",type:"line",source:"parentRect",layout:{...e.lineLayout},paint:{"line-color":"#FFF","line-width":1,"line-opacity":.85,...e.linePaint}}),void 0!==e.fillPaint&&this.map.addLayer({id:"parentRectFill",type:"fill",source:"parentRect",layout:{},paint:{"fill-color":"#08F","fill-opacity":.135,...e.fillPaint}}),XA(this,rx,ox).call(this))},ox=function(){if(void 0===qA(this,ex))return;const{devicePixelRatio:e}=window,t=qA(this,Yv).getCanvas(),i=t.width/e,r=t.height/e,n=qA(this,Yv).unproject.bind(qA(this,Yv)),o=n([0,0]),s=n([i,0]),a=n([0,r]),l=n([i,r]);qA(this,ex).geometry.coordinates=[[a.toArray(),l.toArray(),s.toArray(),o.toArray(),a.toArray()]];const c=this.map.getSource("parentRect");void 0!==c&&c.setData(qA(this,ex))},sx=function(){const{pitchAdjust:e}=qA(this,Xv),t=()=>{o("parent")},i=()=>{o("minimap")},r=()=>{qA(this,Yv).on("move",t),this.map.on("move",i)},n=()=>{qA(this,Yv).off("move",t),this.map.off("move",i)},o=t=>{n();const i="parent"===t?qA(this,Yv):this.map,o="parent"===t?this.map:qA(this,Yv),s=i.getCenter(),a=i.getZoom()+qA(this,Xv).zoomAdjust*("parent"===t?1:-1),l=i.getBearing(),c=i.getPitch();o.jumpTo({center:s,zoom:a,bearing:l,pitch:e?c:0}),XA(this,rx,ox).call(this),r()};return r(),()=>{n()}};class lx{constructor(){$A(this,"map"),$A(this,"container"),$A(this,"projectionButton")}onAdd(e){return this.map=e,this.container=Vv("div","maplibregl-ctrl maplibregl-ctrl-group"),this.projectionButton=Vv("button","maplibregl-ctrl-projection",this.container),Vv("span","maplibregl-ctrl-icon",this.projectionButton).setAttribute("aria-hidden","true"),this.projectionButton.type="button",this.projectionButton.addEventListener("click",this.toggleProjection.bind(this)),e.on("projectiontransition",this.updateProjectionIcon.bind(this)),this.updateProjectionIcon(),this.container}onRemove(){Hv(this.container),this.map.off("projectiontransition",this.updateProjectionIcon),this.map=void 0}toggleProjection(){void 0===this.map.getProjection()&&this.map.setProjection({type:"mercator"}),this.map.isGlobeProjection()?this.map.enableMercatorProjection():this.map.enableGlobeProjection(),this.updateProjectionIcon()}updateProjectionIcon(){this.projectionButton.classList.remove("maplibregl-ctrl-projection-globe"),this.projectionButton.classList.remove("maplibregl-ctrl-projection-mercator"),this.map.isGlobeProjection()?(this.projectionButton.classList.add("maplibregl-ctrl-projection-mercator"),this.projectionButton.title="Enable Mercator projection"):(this.projectionButton.classList.add("maplibregl-ctrl-projection-globe"),this.projectionButton.title="Enable Globe projection")}}const cx="3.2.0";class ux{constructor(e,t=2e3){$A(this,"map"),$A(this,"registeredModules",new Set),this.map=e,setTimeout((async()=>{if(!rm.telemetry)return;const e=this.preparePayload();try{(await fetch(e,{method:"POST"})).ok||console.warn("The metrics could not be sent to MapTiler Cloud")}catch(e){console.warn("The metrics could not be sent to MapTiler Cloud",e)}}),Math.max(1e3,t))}registerModule(e,t){this.registeredModules.add(`${e}:${t}`)}preparePayload(){const e=new URL(em.telemetryURL);return e.searchParams.append("sdk",cx),e.searchParams.append("key",rm.apiKey),e.searchParams.append("mtsid",tm),e.searchParams.append("session",rm.session?"1":"0"),e.searchParams.append("caching",rm.caching?"1":"0"),e.searchParams.append("lang-updated",this.map.isLanguageUpdated()?"1":"0"),e.searchParams.append("terrain",this.map.getTerrain()?"1":"0"),e.searchParams.append("globe",this.map.isGlobeProjection()?"1":"0"),this.registeredModules.size>0&&e.searchParams.append("modules",Array.from(this.registeredModules).join("|")),e.href}}const hx={POINT:"POINT",COUNTRY:"COUNTRY"};class dx extends We.Map{constructor(e){(function(e){const t=mm();if(!t)return;let i=null;if("string"==typeof e?i=document.getElementById(e):e instanceof HTMLElement&&(i=e),!i)throw new Error("The Map container must be provided.");const r=document.createElement("div");throw r.innerHTML=t,r.classList.add("webgl-warning-div"),i.appendChild(r),new Error(t)})(e.container),e.apiKey&&(rm.apiKey=e.apiKey);const{style:t,requiresUrlMonitoring:i,isFallback:r}=Qv(e.style);r&&console.warn("Invalid style. A style must be a valid URL to a style.json, a JSON string representing a valid StyleSpecification or a valid StyleSpecification object. Fallback to default MapTiler style."),rm.apiKey||console.warn("MapTiler Cloud API key is not set. Visit https://maptiler.com and try Cloud for free!");const n=location.hash;let o={compact:!1};e.customAttribution?o.customAttribution=e.customAttribution:e.attributionControl&&"object"==typeof e.attributionControl&&(o={...o,...e.attributionControl});const s={...e,style:t,maplibreLogo:!1,transformRequest:pm(e.transformRequest),attributionControl:!0!==e.forceNoAttributionControl&&o};delete s.style,super(s),$A(this,"options"),$A(this,"telemetry"),$A(this,"isTerrainEnabled",!1),$A(this,"terrainExaggeration",1),$A(this,"primaryLanguage"),$A(this,"terrainGrowing",!1),$A(this,"terrainFlattening",!1),$A(this,"minimap"),$A(this,"forceLanguageUpdate"),$A(this,"languageAlwaysBeenStyle"),$A(this,"isReady",!1),$A(this,"terrainAnimationDuration",1e3),$A(this,"monitoredStyleUrls"),$A(this,"styleInProcess",!1),$A(this,"curentProjection"),$A(this,"originalLabelStyle",new window.Map),$A(this,"isStyleLocalized",!1),$A(this,"languageIsUpdated",!1),this.options=e,this.setStyle(t),i&&this.monitorStyleUrl(t);const a=()=>{let e="The distant style could not be loaded.";this.getStyle()?e+="Leaving the style as is.":(this.setStyle(Ff.STREETS),e+=`Loading default MapTiler Cloud style "${Ff.STREETS.getDefaultVariant().getId()}" as a fallback.`),console.warn(e)};if(this.on("style.load",(()=>{this.styleInProcess=!1})),this.on("error",(e=>{if(e.error instanceof We.AJAXError){const t=e.error.url,i=new URL(t);i.search="";const r=i.href;this.monitoredStyleUrls&&this.monitoredStyleUrls.has(r)&&(this.monitoredStyleUrls.delete(r),a())}else this.styleInProcess&&a()})),rm.caching&&!sm&&console.warn("The cache API is only available in secure contexts. More info at https://developer.mozilla.org/en-US/docs/Web/API/Cache"),rm.caching&&sm&&hm(),typeof e.language>"u")this.primaryLanguage=rm.primaryLanguage;else{const t=df(e.language,YA);this.primaryLanguage=t??rm.primaryLanguage}this.forceLanguageUpdate=!(this.primaryLanguage===YA.STYLE||this.primaryLanguage===YA.STYLE_LOCK),this.languageAlwaysBeenStyle=this.primaryLanguage===YA.STYLE,this.terrainExaggeration=e.terrainExaggeration??this.terrainExaggeration,this.curentProjection=e.projection,this.on("styledata",(()=>{"mercator"===this.curentProjection?this.setProjection({type:"mercator"}):"globe"===this.curentProjection&&this.setProjection({type:"globe"})})),this.once("styledata",(async()=>{if(!e.geolocate||e.center||e.hash&&n)return;try{if(e.geolocate===hx.COUNTRY)return void await this.fitToIpBounds()}catch(e){console.warn(e.message)}let t;try{await this.centerOnIpPoint(e.zoom),t=this.getCameraHash()}catch(e){console.warn(e.message)}"granted"===(await navigator.permissions.query({name:"geolocation"})).state&&navigator.geolocation.getCurrentPosition((i=>{t===this.getCameraHash()&&(this.terrain?this.easeTo({center:[i.coords.longitude,i.coords.latitude],zoom:e.zoom||12,duration:2e3}):this.once("terrain",(()=>{this.easeTo({center:[i.coords.longitude,i.coords.latitude],zoom:e.zoom||12,duration:2e3})})))}),null,{maximumAge:864e5,timeout:5e3,enableHighAccuracy:!1})})),this.on("styledata",(()=>{this.setPrimaryLanguage(this.primaryLanguage)})),this.on("styledata",(()=>{null===this.getTerrain()&&this.isTerrainEnabled&&this.enableTerrain(this.terrainExaggeration)})),this.once("load",(async()=>{let t={logo:null};try{const e=Object.keys(this.style.sourceCaches).map((e=>this.getSource(e))).filter((e=>e&&"url"in e&&"string"==typeof e.url&&e.url.includes("tiles.json"))),i=new URL(e[0].url);i.searchParams.has("key")||i.searchParams.append("key",rm.apiKey),t=await(await fetch(i.href)).json()}catch{}if(!0!==e.forceNoAttributionControl)if("logo"in t&&t.logo){const i=t.logo;this.addControl(new Km({logoURL:i}),e.logoPosition)}else e.maptilerLogo&&this.addControl(new Km,e.logoPosition);if(e.scaleControl){const t=!0===e.scaleControl||void 0===e.scaleControl?"bottom-right":e.scaleControl,i=new Om({unit:rm.unit});this.addControl(i,t),rm.on("unit",(e=>{i.setUnit(e)}))}if(!1!==e.navigationControl){const t=!0===e.navigationControl||void 0===e.navigationControl?"top-right":e.navigationControl;this.addControl(new $v,t)}if(!1!==e.geolocateControl){const t=!0===e.geolocateControl||void 0===e.geolocateControl?"top-right":e.geolocateControl;this.addControl(new Wv({positionOptions:{enableHighAccuracy:!0,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!0,showAccuracyCircle:!0,showUserLocation:!0}),t)}if(e.terrainControl){const t=!0===e.terrainControl||void 0===e.terrainControl?"top-right":e.terrainControl;this.addControl(new Gv,t)}if(e.projectionControl){const t=!0===e.projectionControl||void 0===e.projectionControl?"top-right":e.projectionControl;this.addControl(new lx,t)}if(e.fullscreenControl){const t=!0===e.fullscreenControl||void 0===e.fullscreenControl?"top-right":e.fullscreenControl;this.addControl(new Um({}),t)}this.isReady=!0,this.fire("ready",{target:this})}));let l,c=!1,u=!1;this.once("ready",(()=>{c=!0,u&&this.fire("loadWithTerrain",l)})),this.once("style.load",(()=>{const{minimap:t}=e;if("object"==typeof t){const{zoom:i,center:r,style:n,language:o,apiKey:s,maptilerLogo:a,canvasContextAttributes:l,refreshExpiredTiles:c,maxBounds:u,scrollZoom:h,minZoom:d,maxZoom:p,boxZoom:f,locale:A,fadeDuration:m,crossSourceCollisions:g,clickTolerance:_,bounds:y,fitBoundsOptions:v,pixelRatio:x,validateStyle:b}=e;this.minimap=new ax(t,{zoom:i,center:r,style:n,language:o,apiKey:s,container:"null",maptilerLogo:a,canvasContextAttributes:l,refreshExpiredTiles:c,maxBounds:u,scrollZoom:h,minZoom:d,maxZoom:p,boxZoom:f,locale:A,fadeDuration:m,crossSourceCollisions:g,clickTolerance:_,bounds:y,fitBoundsOptions:v,pixelRatio:x,validateStyle:b}),this.addControl(this.minimap,t.position??"bottom-left")}else!0===t?(this.minimap=new ax({},e),this.addControl(this.minimap,"bottom-left")):void 0!==t&&!1!==t&&(this.minimap=new ax({},e),this.addControl(this.minimap,t))}));const h=e=>{e.terrain&&(u=!0,l={type:"loadWithTerrain",target:this,terrain:e.terrain},this.off("terrain",h),c&&this.fire("loadWithTerrain",l))};this.on("terrain",h),e.terrain&&this.enableTerrain(e.terrainExaggeration??this.terrainExaggeration),this.once("load",(()=>{this.getCanvas().addEventListener("webglcontextlost",(e=>{!0!==this._removed?(console.warn("[webglcontextlost]","Unexpected loss of WebGL context!"),this.fire("webglContextLost",e)):console.warn("[webglcontextlost]","WebGL context lost after map removal. This is harmless.")}))})),this.telemetry=new ux(this)}recreate(){const e={center:this.getCenter(),zoom:this.getZoom(),bearing:this.getBearing(),pitch:this.getPitch()};this.remove(),Object.assign(this,new dx({...this.options})),this.once("load",(()=>{this.jumpTo(e)}))}setTerrainAnimationDuration(e){this.terrainAnimationDuration=Math.max(e,0)}async onLoadAsync(){return new Promise((e=>{this.loaded()?e(this):this.once("load",(()=>{e(this)}))}))}async onReadyAsync(){return new Promise((e=>{this.isReady?e(this):this.once("ready",(()=>{e(this)}))}))}async onLoadWithTerrainAsync(){return new Promise((e=>{this.isReady&&this.terrain?e(this):this.once("loadWithTerrain",(()=>{e(this)}))}))}monitorStyleUrl(e){typeof this.monitoredStyleUrls>"u"&&(this.monitoredStyleUrls=new Set);const t=new URL(e);t.search="",this.monitoredStyleUrls.add(t.href)}setStyle(e,t){var i;this.originalLabelStyle.clear(),null==(i=this.minimap)||i.setStyle(e),this.forceLanguageUpdate=!0,this.once("idle",(()=>{this.forceLanguageUpdate=!1}));const r=Qv(e);if(r.requiresUrlMonitoring&&this.monitorStyleUrl(r.style),r.isFallback){if(this.getStyle())return console.warn("Invalid style. A style must be a valid URL to a style.json, a JSON string representing a valid StyleSpecification or a valid StyleSpecification object. Keeping the curent style instead."),this;console.warn("Invalid style. A style must be a valid URL to a style.json, a JSON string representing a valid StyleSpecification or a valid StyleSpecification object. Fallback to default MapTiler style.")}return this.styleInProcess=!0,super.setStyle(r.style,t),this}addLayer(e,t){var i;return null==(i=this.minimap)||i.addLayer(e,t),super.addLayer(e,t)}moveLayer(e,t){var i;return null==(i=this.minimap)||i.moveLayer(e,t),super.moveLayer(e,t)}removeLayer(e){var t;return null==(t=this.minimap)||t.removeLayer(e),super.removeLayer(e)}setLayerZoomRange(e,t,i){var r;return null==(r=this.minimap)||r.setLayerZoomRange(e,t,i),super.setLayerZoomRange(e,t,i)}setFilter(e,t,i){var r;return null==(r=this.minimap)||r.setFilter(e,t,i),super.setFilter(e,t,i)}setPaintProperty(e,t,i,r){var n;return null==(n=this.minimap)||n.setPaintProperty(e,t,i,r),super.setPaintProperty(e,t,i,r)}setLayoutProperty(e,t,i,r){var n;return null==(n=this.minimap)||n.setLayoutProperty(e,t,i,r),super.setLayoutProperty(e,t,i,r)}setGlyphs(e,t){var i;return null==(i=this.minimap)||i.setGlyphs(e,t),super.setGlyphs(e,t)}getStyleLanguage(){return this.style&&this.style.stylesheet&&this.style.stylesheet.metadata&&"object"==typeof this.style.stylesheet.metadata&&"maptiler:language"in this.style.stylesheet.metadata&&"string"==typeof this.style.stylesheet.metadata["maptiler:language"]?cf(this.style.stylesheet.metadata["maptiler:language"]):null}setLanguage(e){var t;null==(t=this.minimap)||t.map.setLanguage(e),this.onStyleReady((()=>{this.setPrimaryLanguage(e)}))}setPrimaryLanguage(e){const t=this.getStyleLanguage(),i=df(e,YA);if(!i)return void console.warn(`The language "${i}" is not supported.`);if((i.flag!==YA.STYLE.flag||!t||t.flag!==YA.AUTO.flag&&t.flag!==YA.VISITOR.flag)&&(i.flag!==YA.STYLE.flag&&(this.languageAlwaysBeenStyle=!1),this.languageAlwaysBeenStyle||this.primaryLanguage===i&&!this.forceLanguageUpdate))return;if(this.primaryLanguage.flag===YA.STYLE_LOCK.flag)return void console.warn("The language cannot be changed because this map has been instantiated with the STYLE_LOCK language flag.");this.primaryLanguage=i;let r=i;if(i.flag===YA.STYLE.flag){if(!t)return void console.warn("The style has no default languages or has an invalid one.");r=t}let n=YA.LOCAL.flag,o=["get",n];r.flag===YA.VISITOR.flag?(n=JA().flag,o=["case",["all",["has",n],["has",YA.LOCAL.flag]],["case",["==",["get",n],["get",YA.LOCAL.flag]],["get",YA.LOCAL.flag],["format",["get",n],{"font-scale":.8},"\n",["get",YA.LOCAL.flag],{"font-scale":1.1}]],["get",YA.LOCAL.flag]]):r.flag===YA.VISITOR_ENGLISH.flag?(n=YA.ENGLISH.flag,o=["case",["all",["has",n],["has",YA.LOCAL.flag]],["case",["==",["get",n],["get",YA.LOCAL.flag]],["get",YA.LOCAL.flag],["format",["get",n],{"font-scale":.8},"\n",["get",YA.LOCAL.flag],{"font-scale":1.1}]],["get",YA.LOCAL.flag]]):r.flag===YA.AUTO.flag?(n=JA().flag,o=["coalesce",["get",n],["get",YA.LOCAL.flag]]):r===YA.LOCAL?(n=YA.LOCAL.flag,o=["get",n]):(n=r.flag,o=["coalesce",["get",n],["get",YA.LOCAL.flag]]);const{layers:s}=this.getStyle(),a=0===this.originalLabelStyle.size;if(a){const e=function(e,t){const i=[];for(const r of e){if("symbol"!==r.type)continue;const e=r,{id:n,layout:o}=e;if(!o||!("text-field"in o))continue;const s=t.getLayoutProperty(n,"text-field");if(s)if("string"==typeof s){const e=xm(s);i.push(e)}else{const e=wm(s);i.push(e)}}const r=i.flat(),n={unlocalized:0,localized:{}};for(const e of r)null===e?n.unlocalized+=1:(e in n.localized||(n.localized[e]=0),n.localized[e]+=1);return n}(s,this);this.isStyleLocalized=Object.keys(e.localized).length>0}for(const e of s){if("symbol"!==e.type)continue;const t=e,i=this.getSource(t.source);if(!i||!("url"in i)||"string"!=typeof i.url||new URL(i.url).host!==em.maptilerApiHost)continue;const{id:r,layout:n}=t;if(!n||!("text-field"in n))continue;let s;if(a?(s=this.getLayoutProperty(r,"text-field"),this.originalLabelStyle.set(r,s)):s=this.originalLabelStyle.get(r),"string"==typeof s){const{contains:e,exactMatch:t}=ym(s,this.isStyleLocalized);if(!e)continue;if(t)this.setLayoutProperty(r,"text-field",o);else{const e=vm(s,o,this.isStyleLocalized);this.setLayoutProperty(r,"text-field",e)}}else{const e=_m(s,o,this.isStyleLocalized);this.setLayoutProperty(r,"text-field",e)}}this.languageIsUpdated=!0}getPrimaryLanguage(){return this.primaryLanguage}getTerrainExaggeration(){return this.terrainExaggeration}hasTerrain(){return this.isTerrainEnabled}growTerrain(e){if(!this.terrain)return;const t=performance.now(),i=this.terrain.exaggeration,r=e-i,n=()=>{if(!this.terrain||this.terrainFlattening)return;const o=(performance.now()-t)/this.terrainAnimationDuration;if(o<.99){const e=i+(1-(1-o)**4)*r;this.terrain.exaggeration=e,requestAnimationFrame(n)}else this.terrainGrowing=!1,this.terrainFlattening=!1,this.terrain.exaggeration=e,this.fire("terrainAnimationStop",{terrain:this.terrain});this._elevationFreeze=!1,this.triggerRepaint()};!this.terrainGrowing&&!this.terrainFlattening&&this.fire("terrainAnimationStart",{terrain:this.terrain}),this.terrainGrowing=!0,this.terrainFlattening=!1,requestAnimationFrame(n)}enableTerrain(e=this.terrainExaggeration){if(e<0)return void console.warn("Terrain exaggeration cannot be negative.");const t=i=>{!this.terrain||"data"!==i.type||"source"!==i.dataType||!("source"in i)||"maptiler-terrain"!==i.sourceId||"raster-dem"!==i.source.type||i.isSourceLoaded&&(this.off("data",t),this.growTerrain(e))},i=()=>{this.isTerrainEnabled=!0,this.terrainExaggeration=e,this.on("data",t),this.addSource(em.terrainSourceId,{type:"raster-dem",url:em.terrainSourceURL}),this.setTerrain({source:em.terrainSourceId,exaggeration:0})};if(this.getTerrain())return this.isTerrainEnabled=!0,void this.growTerrain(e);this.loaded()||this.isTerrainEnabled?i():this.once("load",(()=>{this.getTerrain()&&this.getSource(em.terrainSourceId)||i()}))}disableTerrain(){if(!this.terrain)return;this.isTerrainEnabled=!1;const e=performance.now(),t=this.terrain.exaggeration,i=()=>{if(!this.terrain||this.terrainGrowing)return;const r=(performance.now()-e)/this.terrainAnimationDuration;if(this._elevationFreeze=!1,r<.99){const e=t*(1-r)**4;this.terrain.exaggeration=e,requestAnimationFrame(i)}else this.terrain.exaggeration=0,this.terrainGrowing=!1,this.terrainFlattening=!1,this.setTerrain(),this.getSource(em.terrainSourceId)&&this.removeSource(em.terrainSourceId),this.fire("terrainAnimationStop",{terrain:null});this.triggerRepaint()};!this.terrainGrowing&&!this.terrainFlattening&&this.fire("terrainAnimationStart",{terrain:this.terrain}),this.terrainGrowing=!1,this.terrainFlattening=!0,requestAnimationFrame(i)}setTerrainExaggeration(e,t=!0){!t&&this.terrain?(this.terrainExaggeration=e,this.terrain.exaggeration=e,this.triggerRepaint()):this.enableTerrain(e)}onStyleReady(e){this.isStyleLoaded()?e():this.once("styledata",(()=>{e()}))}async fitToIpBounds(){const e=await bf.info();this.fitBounds(e.country_bounds,{duration:0,padding:100})}async centerOnIpPoint(e){const t=await bf.info();this.jumpTo({center:[t.longitude??0,t.latitude??0],zoom:e||11})}getCameraHash(){const e=new Float32Array(5),t=this.getCenter();return e[0]=t.lng,e[1]=t.lat,e[2]=this.getZoom(),e[3]=this.getPitch(),e[4]=this.getBearing(),VA(new Uint8Array(e.buffer))}getSdkConfig(){return rm}getMaptilerSessionId(){return tm}setTransformRequest(e){return super.setTransformRequest(pm(e)),this}isGlobeProjection(){const e=this.getProjection();return!!e&&"globe"===e.type}enableGlobeProjection(){!0!==this.isGlobeProjection()&&(this.setProjection({type:"globe"}),this.curentProjection="globe")}enableMercatorProjection(){!1!==this.isGlobeProjection()&&(this.setProjection({type:"mercator"}),this.curentProjection="mercator")}isLanguageUpdated(){return this.languageIsUpdated}}function px(e){if(typeof DOMParser<"u"){const t=(new DOMParser).parseFromString(e,"application/xml");if(t.querySelector("parsererror"))throw new Error("The provided string is not valid XML");return t}throw new Error("No XML parser found")}function fx(e,t){if(!e.hasChildNodes())return!1;for(const i of Array.from(e.childNodes)){const e=i.nodeName;if("string"==typeof e&&e.trim().toLowerCase()===t.toLowerCase())return!0}return!1}function Ax(e){if(typeof XMLSerializer<"u")return(new XMLSerializer).serializeToString(e);throw new Error("No XML serializer found")}function mx(e){const t="string"==typeof e?px(e):e;if(!fx(t,"gpx"))throw new Error("The XML document is not valid GPX");const i=Ix(t,"trk"),r=Ix(t,"rte"),n=Ix(t,"wpt"),o={type:"FeatureCollection",features:[]};for(const e of Array.from(i)){const t=Tx(e);t&&o.features.push(t)}for(const e of Array.from(r)){const t=Bx(e);t&&o.features.push(t)}for(const e of Array.from(n))o.features.push(Cx(e));return o}function gx(e,t){let i=e;if("string"==typeof i&&(i=px(i)),!fx(i,"kml"))throw new Error("The XML document is not valid KML");const r={type:"FeatureCollection",features:[]},n={},o={},s={},a=Ix(i,"Placemark"),l=Ix(i,"Style"),c=Ix(i,"StyleMap");for(const e of Array.from(l)){const i=Mx(void 0!==t?t(e):Ax(e)).toString(16);n[`#${Px(e,"id")}`]=i,o[i]=e}for(const e of Array.from(c)){n[`#${Px(e,"id")}`]=Mx(void 0!==t?t(e):Ax(e)).toString(16);const i=Ix(e,"Pair"),r={};for(const e of Array.from(i))r[zx(Fx(e,"key"))??""]=zx(Fx(e,"styleUrl"));s[`#${Px(e,"id")}`]=r}for(const e of Array.from(a))r.features=r.features.concat(bx(e,n,o,s));return r}function _x(e){if(null===e)return["#000000",1];let t="",i=1,r=e;return r.startsWith("#")&&(r=r.substring(1)),(6===r.length||3===r.length)&&(t=r),8===r.length&&(i=Number.parseInt(r.substring(0,2),16)/255,t=`#${r.substring(6,8)}${r.substring(4,6)}${r.substring(2,4)}`),[t??"#000000",i??1]}function yx(e){return kx(e.split(" "))}function vx(e){let t=Ix(e,"coord");const i=[],r=[];0===t.length&&(t=Ix(e,"gx:coord"));for(const e of Array.from(t))i.push(yx(zx(e)??""));const n=Ix(e,"when");for(const e of Array.from(n))r.push(zx(e));return{coords:i,times:r}}function xx(e){const t=["Polygon","LineString","Point","Track","gx:Track"];let i,r,n,o,s;const a=[],l=[];if(null!==Fx(e,"MultiGeometry"))return xx(Fx(e,"MultiGeometry"));if(null!==Fx(e,"MultiTrack"))return xx(Fx(e,"MultiTrack"));if(null!==Fx(e,"gx:MultiTrack"))return xx(Fx(e,"gx:MultiTrack"));for(n=0;n<t.length;n++)if(r=Ix(e,t[n]),r)for(o=0;o<r.length;o++)if(i=r[o],"Point"===t[n])a.push({type:"Point",coordinates:Dx(zx(Fx(i,"coordinates"))??"")});else if("LineString"===t[n])a.push({type:"LineString",coordinates:Ox(zx(Fx(i,"coordinates"))??"")});else if("Polygon"===t[n]){const e=Ix(i,"LinearRing"),t=[];for(s=0;s<e.length;s++)t.push(Ox(zx(Fx(e[s],"coordinates"))??""));a.push({type:"Polygon",coordinates:t})}else if("Track"===t[n]||"gx:Track"===t[n]){const e=vx(i);a.push({type:"LineString",coordinates:e.coords}),e.times.length&&l.push(e.times)}return{geoms:a,coordTimes:l}}function bx(e,t,i,r){const n=xx(e),o={},s=zx(Fx(e,"name")),a=zx(Fx(e,"address")),l=zx(Fx(e,"description")),c=Fx(e,"TimeSpan"),u=Fx(e,"TimeStamp"),h=Fx(e,"ExtendedData"),d=Fx(e,"visibility");let p,f=zx(Fx(e,"styleUrl")),A=Fx(e,"LineStyle"),m=Fx(e,"PolyStyle");if(!n.geoms.length)return[];if(s&&(o.name=s),a&&(o.address=a),f){f.startsWith("#")||(f=`#${f}`),o.styleUrl=f,t[f]&&(o.styleHash=t[f]),r[f]&&(o.styleMapHash=r[f],o.styleHash=t[r[f].normal??""]);const e=i[o.styleHash??""];if(e){A||(A=Fx(e,"LineStyle")),m||(m=Fx(e,"PolyStyle"));const t=Fx(e,"IconStyle");if(t){const e=Fx(t,"Icon");if(e){const t=zx(Fx(e,"href"));t&&(o.icon=t)}}}}if(l&&(o.description=l),c){const e=zx(Fx(c,"begin")),t=zx(Fx(c,"end"));e&&t&&(o.timespan={begin:e,end:t})}if(null!==u&&(o.timestamp=zx(Fx(u,"when"))??(new Date).toISOString()),null!==A){const e=_x(zx(Fx(A,"color"))),t=e[0],i=e[1],r=Number.parseFloat(zx(Fx(A,"width"))??"");t&&(o.stroke=t),Number.isNaN(i)||(o["stroke-opacity"]=i),Number.isNaN(r)||(o["stroke-width"]=r)}if(m){const e=_x(zx(Fx(m,"color"))),t=e[0],i=e[1],r=zx(Fx(m,"fill")),n=zx(Fx(m,"outline"));t&&(o.fill=t),Number.isNaN(i)||(o["fill-opacity"]=i),r&&(o["fill-opacity"]="1"===r?o["fill-opacity"]||1:0),n&&(o["stroke-opacity"]="1"===n?o["stroke-opacity"]||1:0)}if(h){const e=Ix(h,"Data"),t=Ix(h,"SimpleData");for(p=0;p<e.length;p++)o[e[p].getAttribute("name")??""]=zx(Fx(e[p],"value"))??"";for(p=0;p<t.length;p++)o[t[p].getAttribute("name")??""]=zx(t[p])??""}null!==d&&(o.visibility=zx(d)??""),0!==n.coordTimes.length&&(o.coordTimes=1===n.coordTimes.length?n.coordTimes[0]:n.coordTimes);const g={type:"Feature",geometry:1===n.geoms.length?n.geoms[0]:{type:"GeometryCollection",geometries:n.geoms},properties:o};return Px(e,"id")&&(g.id=Px(e,"id")??void 0),[g]}function wx(e,t){const i=Ix(e,t),r=[],n=[];let o=[];const s=i.length;if(!(s<2)){for(let e=0;e<s;e++){const t=Ux(i[e]);r.push(t.coordinates),t.time&&n.push(t.time),(t.heartRate||o.length)&&(0===o.length&&(o=new Array(e).fill(null)),o.push(t.heartRate))}return{line:r,times:n,heartRates:o}}}function Tx(e){const t=Ix(e,"trkseg"),i=[],r=[],n=[];let o;for(let e=0;e<t.length;e++)if(o=wx(t[e],"trkpt"),void 0!==o&&(o.line&&i.push(o.line),o.times&&o.times.length&&r.push(o.times),n.length||o.heartRates&&o.heartRates.length)){if(!n.length)for(let t=0;t<e;t++)n.push(new Array(i[t].length).fill(null));o.heartRates&&o.heartRates.length?n.push(o.heartRates):n.push(new Array(o.line.length).fill(null))}if(0===i.length)return;const s={...Ex(e),...Sx(Fx(e,"extensions"))};return 0!==r.length&&(s.coordTimes=1===i.length?r[0]:r),0!==n.length&&(s.heartRates=1===i.length?n[0]:n),1===i.length?{type:"Feature",properties:s,geometry:{type:"LineString",coordinates:i[0]}}:{type:"Feature",properties:s,geometry:{type:"MultiLineString",coordinates:i}}}function Bx(e){const t=wx(e,"rtept");return void 0===t?void 0:{type:"Feature",properties:{...Ex(e),...Sx(Fx(e,"extensions"))},geometry:{type:"LineString",coordinates:t.line}}}function Cx(e){return{type:"Feature",properties:{...Ex(e),...Rx(e,["sym"])},geometry:{type:"Point",coordinates:Ux(e).coordinates}}}function Sx(e){const t={};if(e){const i=Fx(e,"line");if(i){const e=zx(Fx(i,"color")),r=Number.parseFloat(zx(Fx(i,"opacity"))??"0"),n=Number.parseFloat(zx(Fx(i,"width"))??"0");e&&(t.stroke=e),Number.isNaN(r)||(t["stroke-opacity"]=r),Number.isNaN(n)||(t["stroke-width"]=96*n/25.4)}}return t}function Ex(e){const t=Rx(e,["name","cmt","desc","type","time","keywords"]),i=Ix(e,"link");if(0!==i.length){t.links=[];for(const e of Array.from(i)){const i={href:Px(e,"href"),...Rx(e,["text","type"])};t.links.push(i)}}return t}function Mx(e){let t=0;if(!e||!e.length)return t;for(let i=0;i<e.length;i++)t=(t<<5)-t+e.charCodeAt(i)|0;return t}function Ix(e,t){return e.getElementsByTagName(t)}function Px(e,t){return e.getAttribute(t)}function Lx(e,t){return Number.parseFloat(Px(e,t)??"0")}function Fx(e,t){const i=Ix(e,t);return i.length?i[0]:null}function kx(e){return e.map(Number.parseFloat).map((e=>Number.isNaN(e)?null:e))}function zx(e){return e&&function(e){e.normalize&&e.normalize()}(e),e&&e.textContent}function Rx(e,t){const i={};let r,n;for(n=0;n<t.length;n++)r=Fx(e,t[n]),r&&(i[t[n]]=zx(r)??"");return i}function Dx(e){return kx(e.replace(/\s*/g,"").split(","))}function Ox(e){const t=e.replace(/^\s*|\s*$/g,"").split(/\s+/),i=[];for(const e of t)i.push(Dx(e));return i}function Ux(e){const t=[Lx(e,"lon"),Lx(e,"lat")],i=Fx(e,"ele"),r=Fx(e,"gpxtpx:hr")||Fx(e,"hr"),n=Fx(e,"time");let o;return i&&(o=Number.parseFloat(zx(i)??"0"),Number.isNaN(o)||t.push(o)),{coordinates:t,time:n?zx(n):null,heartRate:null!==r?Number.parseFloat(zx(r)??"0"):null}}function Nx(e){let t=e;try{"string"==typeof t&&(t=px(t))}catch{return null}try{return mx(t)}catch{}try{return gx(t)}catch{}return null}const Qx=[["#1D5B79","#468B97","#EF6262","#F3AA60"],["#614BC3","#33BBC5","#85E6C5","#C8FFE0"],["#461959","#7A316F","#CD6688","#AED8CC"],["#0079FF","#00DFA2","#F6FA70","#FF0060"],["#39B5E0","#A31ACB","#FF78F0","#F5EA5A"],["#37E2D5","#590696","#C70A80","#FBCB0A"],["#FFD36E","#FFF56D","#99FFCD","#9FB4FF"],["#00EAD3","#FFF5B7","#FF449F","#005F99"],["#10A19D","#540375","#FF7000","#FFBF00"]];function jx(){return Qx[~~(Math.random()*Qx.length)][~~(4*Math.random())]}function Vx(){return`maptiler_source_${fm()}`}function Hx(){return`maptiler_layer_${fm()}`}function Gx(e,t){if(t<=e[0].zoom)return e[0].value;if(t>=e[e.length-1].zoom)return e[e.length-1].value;for(let i=0;i<e.length-1;i+=1)if(t>=e[i].zoom&&t<e[i+1].zoom){const r=e[i+1].zoom-e[i].zoom,n=(t-e[i].zoom)/r;return n*e[i+1].value+(1-n)*e[i].value}return 0}function $x(e){return["interpolate",["linear"],["zoom"],...e.flatMap((e=>[e.zoom,e.value]))]}function Zx(e){return["interpolate",["linear"],["zoom"],...e.flatMap((e=>[e.zoom,e.value]))]}function qx(e,t){if("number"==typeof t&&"number"==typeof e)return 2*t+e;if("number"==typeof t&&Array.isArray(e))return["interpolate",["linear"],["zoom"],...e.flatMap((e=>[e.zoom,2*t+e.value]))];if("number"==typeof e&&Array.isArray(t))return["interpolate",["linear"],["zoom"],...t.flatMap((t=>[t.zoom,2*t.value+e]))];if(Array.isArray(e)&&Array.isArray(t)){return["interpolate",["linear"],["zoom"],...Array.from(new Set([...e.map((e=>e.zoom)),...t.map((e=>e.zoom))])).sort(((e,t)=>e<t?-1:1)).flatMap((i=>[i,2*Gx(t,i)+Gx(e,i)]))]}return 0}function Kx(e,t){return["interpolate",["linear"],["get",t],...e.flatMap((e=>[e.propertyValue,e.value]))]}function Wx(e){const t=e.trimStart(),i=`${t}${" ".repeat(e.length-t.length)}`,r=Array.from(i);if(!r.every((e=>" "===e||"_"===e)))throw new Error("A dash pattern must be composed only of whitespace and underscore characters.");if(!r.some((e=>"_"===e))||!r.some((e=>" "===e)))throw new Error("A dash pattern must contain at least one underscore and one whitespace character");const n=[1];for(let e=1;e<r.length;e+=1){r[e-1]===r[e]?n[n.length-1]+=1:n.push(1)}return n}function Xx(e,t){return["interpolate",["linear"],["get",t],...e.flatMap((e=>[e.value,e.color]))]}function Yx(e,t,i=!0){return i?["interpolate",["linear"],["zoom"],0,["interpolate",["linear"],["get",t],...e.flatMap((e=>[e.value,.025*e.pointRadius]))],2,["interpolate",["linear"],["get",t],...e.flatMap((e=>[e.value,.05*e.pointRadius]))],4,["interpolate",["linear"],["get",t],...e.flatMap((e=>[e.value,.1*e.pointRadius]))],8,["interpolate",["linear"],["get",t],...e.flatMap((e=>[e.value,.25*e.pointRadius]))],16,["interpolate",["linear"],["get",t],...e.flatMap((e=>[e.value,e.pointRadius]))]]:["interpolate",["linear"],["get",t],...e.flatMap((e=>[e.value,e.pointRadius]))]}function Jx(e,t,i=!0){return i?["interpolate",["linear"],["zoom"],0,["interpolate",["linear"],["get",t],...e.flatMap((e=>[e.propertyValue,.025*e.value]))],2,["interpolate",["linear"],["get",t],...e.flatMap((e=>[e.propertyValue,.05*e.value]))],4,["interpolate",["linear"],["get",t],...e.flatMap((e=>[e.propertyValue,.1*e.value]))],8,["interpolate",["linear"],["get",t],...e.flatMap((e=>[e.propertyValue,.25*e.value]))],16,["interpolate",["linear"],["get",t],...e.flatMap((e=>[e.propertyValue,e.value]))]]:["interpolate",["linear"],["get",t],...e.flatMap((e=>[e.propertyValue,e.value]))]}function eb(e,t){return e.every((t=>t.color[3]===e[0].color[3]))?e[0].color[3]?e[0].color[3]/255:1:["interpolate",["linear"],["get",t],...e.getRawColorStops().flatMap((e=>{const t=e.value,i=e.color;return[t,4===i.length?i[3]/255:1]}))]}function tb(e,t=10){return["interpolate",["linear"],["heatmap-density"],...Array.from({length:t+1},((i,r)=>{const n=r/t;return[n,e.getColorHex(n)]})).flat()]}function ib(e){const t=e.toString(16);return 1===t.length?`0${t}`:t}class rb extends Array{constructor(e={}){super(),$A(this,"min",0),$A(this,"max",1),"min"in e&&(this.min=e.min),"max"in e&&(this.max=e.max),"stops"in e&&this.setStops(e.stops,{clone:!1})}static fromArrayDefinition(e){return new rb({stops:e.map((e=>({value:e[0],color:e[1]})))})}setStops(e,t={clone:!0}){const i=t.clone?this.clone():this;i.length=0;let r=Number.POSITIVE_INFINITY,n=Number.NEGATIVE_INFINITY;for(let t=0;t<e.length;t+=1)r=Math.min(r,e[t].value),n=Math.max(n,e[t].value),i.push({value:e[t].value,color:e[t].color.slice()});return i.sort(((e,t)=>e.value<t.value?-1:1)),this.min=r,this.max=n,i}scale(e,t,i={clone:!0}){const r=i.clone,n=this[0].value,o=this.at(-1).value-n,s=t-e,a=[];for(let t=0;t<this.length;t+=1){const i=(this[t].value-n)/o*s+e;r?a.push({value:i,color:this[t].color.slice()}):this[t].value=i}return r?new rb({stops:a}):this}at(e){return e<0?this[this.length+e]:this[e]}clone(){return new rb({stops:this.getRawColorStops()})}getRawColorStops(){const e=[];for(let t=0;t<this.length;t+=1)e.push({value:this[t].value,color:this[t].color});return e}reverse(e={clone:!0}){const t=e.clone?this.clone():this;for(let e=0;e<~~(t.length/2);e+=1){const i=t[e].color;t[e].color=t.at(-(e+1)).color,t.at(-(e+1)).color=i}return t}getBounds(){return{min:this.min,max:this.max}}getColor(e,t={smooth:!0}){if(e<=this[0].value)return this[0].color;if(e>=this.at(-1).value)return this.at(-1).color;for(let i=0;i<this.length-1;i+=1){if(e>this[i+1].value)continue;const r=this[i].color;if(!t.smooth)return r.slice();const n=this[i].value,o=this[i+1].value,s=this[i+1].color,a=(o-e)/(o-n);return r.map(((e,t)=>Math.round(e*a+s[t]*(1-a))))}return[0,0,0]}getColorHex(e,t={smooth:!0,withAlpha:!1}){return`#${ib((i=this.getColor(e,t))[0])}${ib(i[1])}${ib(i[2])}${4===i.length?ib(i[3]):""}`;var i}getColorRelative(e,t={smooth:!0}){const i=this.getBounds();return this.getColor(i.min+e*(i.max-i.min),t)}getCanvasStrip(e={horizontal:!0,size:512,smooth:!0}){const t=document.createElement("canvas");t.width=e.horizontal?e.size:1,t.height=e.horizontal?1:e.size;const i=t.getContext("2d");if(!i)throw new Error("Canvs context is missing");const r=i.getImageData(0,0,t.width,t.height),n=r.data,o=e.size,s=this[0].value,a=(this.at(-1).value-s)/o;for(let t=0;t<o;t+=1){const i=this.getColor(s+t*a,{smooth:e.smooth});n[4*t]=i[0],n[4*t+1]=i[1],n[4*t+2]=i[2],n[4*t+3]=i.length>3?i[3]:255}return i.putImageData(r,0,0),t}resample(e,t=15){const i=this.getBounds(),r=this.scale(0,1),n=1/(t-1);let o;if("ease-in-square"===e)o=Array.from({length:t},((e,t)=>{const i=t*n,o=i**2;return{value:i,color:r.getColor(o)}}));else if("ease-out-square"===e)o=Array.from({length:t},((e,t)=>{const i=t*n,o=1-(1-i)**2;return{value:i,color:r.getColor(o)}}));else if("ease-out-sqrt"===e)o=Array.from({length:t},((e,t)=>{const i=t*n,o=i**.5;return{value:i,color:r.getColor(o)}}));else if("ease-in-sqrt"===e)o=Array.from({length:t},((e,t)=>{const i=t*n,o=1-(1-i)**.5;return{value:i,color:r.getColor(o)}}));else if("ease-out-exp"===e)o=Array.from({length:t},((e,t)=>{const i=t*n,o=1-2**(-10*i);return{value:i,color:r.getColor(o)}}));else{if("ease-in-exp"!==e)throw new Error("Invalid ressampling method.");o=Array.from({length:t},((e,t)=>{const i=t*n,o=2**(10*i-10);return{value:i,color:r.getColor(o)}}))}return new rb({stops:o}).scale(i.min,i.max)}transparentStart(){const e=this.getRawColorStops();e.unshift({value:e[0].value,color:e[0].color.slice()}),e[1].value+=.001;for(const t of e)3===t.color.length&&t.color.push(255);return e[0].color[3]=0,new rb({stops:e})}hasTransparentStart(){return 4===this[0].color.length&&0===this[0].color[3]}}const nb={NULL:new rb({stops:[{value:0,color:[0,0,0,0]},{value:1,color:[0,0,0,0]}]}),GRAY:new rb({stops:[{value:0,color:[0,0,0]},{value:1,color:[255,255,255]}]}),JET:new rb({stops:[{value:0,color:[0,0,131]},{value:.125,color:[0,60,170]},{value:.375,color:[5,255,255]},{value:.625,color:[255,255,0]},{value:.875,color:[250,0,0]},{value:1,color:[128,0,0]}]}),HSV:new rb({stops:[{value:0,color:[255,0,0]},{value:.169,color:[253,255,2]},{value:.173,color:[247,255,2]},{value:.337,color:[0,252,4]},{value:.341,color:[0,252,10]},{value:.506,color:[1,249,255]},{value:.671,color:[2,0,253]},{value:.675,color:[8,0,253]},{value:.839,color:[255,0,251]},{value:.843,color:[255,0,245]},{value:1,color:[255,0,6]}]}),HOT:new rb({stops:[{value:0,color:[0,0,0]},{value:.3,color:[230,0,0]},{value:.6,color:[255,210,0]},{value:1,color:[255,255,255]}]}),SPRING:new rb({stops:[{value:0,color:[255,0,255]},{value:1,color:[255,255,0]}]}),SUMMER:new rb({stops:[{value:0,color:[0,128,102]},{value:1,color:[255,255,102]}]}),AUTOMN:new rb({stops:[{value:0,color:[255,0,0]},{value:1,color:[255,255,0]}]}),WINTER:new rb({stops:[{value:0,color:[0,0,255]},{value:1,color:[0,255,128]}]}),BONE:new rb({stops:[{value:0,color:[0,0,0]},{value:.376,color:[84,84,116]},{value:.753,color:[169,200,200]},{value:1,color:[255,255,255]}]}),COPPER:new rb({stops:[{value:0,color:[0,0,0]},{value:.804,color:[255,160,102]},{value:1,color:[255,199,127]}]}),GREYS:new rb({stops:[{value:0,color:[0,0,0]},{value:1,color:[255,255,255]}]}),YIGNBU:new rb({stops:[{value:0,color:[8,29,88]},{value:.125,color:[37,52,148]},{value:.25,color:[34,94,168]},{value:.375,color:[29,145,192]},{value:.5,color:[65,182,196]},{value:.625,color:[127,205,187]},{value:.75,color:[199,233,180]},{value:.875,color:[237,248,217]},{value:1,color:[255,255,217]}]}),GREENS:new rb({stops:[{value:0,color:[0,68,27]},{value:.125,color:[0,109,44]},{value:.25,color:[35,139,69]},{value:.375,color:[65,171,93]},{value:.5,color:[116,196,118]},{value:.625,color:[161,217,155]},{value:.75,color:[199,233,192]},{value:.875,color:[229,245,224]},{value:1,color:[247,252,245]}]}),YIORRD:new rb({stops:[{value:0,color:[128,0,38]},{value:.125,color:[189,0,38]},{value:.25,color:[227,26,28]},{value:.375,color:[252,78,42]},{value:.5,color:[253,141,60]},{value:.625,color:[254,178,76]},{value:.75,color:[254,217,118]},{value:.875,color:[255,237,160]},{value:1,color:[255,255,204]}]}),BLUERED:new rb({stops:[{value:0,color:[0,0,255]},{value:1,color:[255,0,0]}]}),RDBU:new rb({stops:[{value:0,color:[5,10,172]},{value:.35,color:[106,137,247]},{value:.5,color:[190,190,190]},{value:.6,color:[220,170,132]},{value:.7,color:[230,145,90]},{value:1,color:[178,10,28]}]}),PICNIC:new rb({stops:[{value:0,color:[0,0,255]},{value:.1,color:[51,153,255]},{value:.2,color:[102,204,255]},{value:.3,color:[153,204,255]},{value:.4,color:[204,204,255]},{value:.5,color:[255,255,255]},{value:.6,color:[255,204,255]},{value:.7,color:[255,153,255]},{value:.8,color:[255,102,204]},{value:.9,color:[255,102,102]},{value:1,color:[255,0,0]}]}),RAINBOW:new rb({stops:[{value:0,color:[150,0,90]},{value:.125,color:[0,0,200]},{value:.25,color:[0,25,255]},{value:.375,color:[0,152,255]},{value:.5,color:[44,255,150]},{value:.625,color:[151,255,0]},{value:.75,color:[255,234,0]},{value:.875,color:[255,111,0]},{value:1,color:[255,0,0]}]}),PORTLAND:new rb({stops:[{value:0,color:[12,51,131]},{value:.25,color:[10,136,186]},{value:.5,color:[242,211,56]},{value:.75,color:[242,143,56]},{value:1,color:[217,30,30]}]}),BLACKBODY:new rb({stops:[{value:0,color:[0,0,0]},{value:.2,color:[230,0,0]},{value:.4,color:[230,210,0]},{value:.7,color:[255,255,255]},{value:1,color:[160,200,255]}]}),EARTH:new rb({stops:[{value:0,color:[0,0,130]},{value:.1,color:[0,180,180]},{value:.2,color:[40,210,40]},{value:.4,color:[230,230,50]},{value:.6,color:[120,70,20]},{value:1,color:[255,255,255]}]}),ELECTRIC:new rb({stops:[{value:0,color:[0,0,0]},{value:.15,color:[30,0,100]},{value:.4,color:[120,0,100]},{value:.6,color:[160,90,0]},{value:.8,color:[230,200,0]},{value:1,color:[255,250,220]}]}),VIRIDIS:new rb({stops:[{value:0,color:[68,1,84]},{value:.13,color:[71,44,122]},{value:.25,color:[59,81,139]},{value:.38,color:[44,113,142]},{value:.5,color:[33,144,141]},{value:.63,color:[39,173,129]},{value:.75,color:[92,200,99]},{value:.88,color:[170,220,50]},{value:1,color:[253,231,37]}]}),INFERNO:new rb({stops:[{value:0,color:[0,0,4]},{value:.13,color:[31,12,72]},{value:.25,color:[85,15,109]},{value:.38,color:[136,34,106]},{value:.5,color:[186,54,85]},{value:.63,color:[227,89,51]},{value:.75,color:[249,140,10]},{value:.88,color:[249,201,50]},{value:1,color:[252,255,164]}]}),MAGMA:new rb({stops:[{value:0,color:[0,0,4]},{value:.13,color:[28,16,68]},{value:.25,color:[79,18,123]},{value:.38,color:[129,37,129]},{value:.5,color:[181,54,122]},{value:.63,color:[229,80,100]},{value:.75,color:[251,135,97]},{value:.88,color:[254,194,135]},{value:1,color:[252,253,191]}]}),PLASMA:new rb({stops:[{value:0,color:[13,8,135]},{value:.13,color:[75,3,161]},{value:.25,color:[125,3,168]},{value:.38,color:[168,34,150]},{value:.5,color:[203,70,121]},{value:.63,color:[229,107,93]},{value:.75,color:[248,148,65]},{value:.88,color:[253,195,40]},{value:1,color:[240,249,33]}]}),WARM:new rb({stops:[{value:0,color:[125,0,179]},{value:.13,color:[172,0,187]},{value:.25,color:[219,0,170]},{value:.38,color:[255,0,130]},{value:.5,color:[255,63,74]},{value:.63,color:[255,123,0]},{value:.75,color:[234,176,0]},{value:.88,color:[190,228,0]},{value:1,color:[147,255,0]}]}),COOL:new rb({stops:[{value:0,color:[125,0,179]},{value:.13,color:[116,0,218]},{value:.25,color:[98,74,237]},{value:.38,color:[68,146,231]},{value:.5,color:[0,204,197]},{value:.63,color:[0,247,146]},{value:.75,color:[0,255,88]},{value:.88,color:[40,255,8]},{value:1,color:[147,255,0]}]}),RAINBOW_SOFT:new rb({stops:[{value:0,color:[125,0,179]},{value:.1,color:[199,0,180]},{value:.2,color:[255,0,121]},{value:.3,color:[255,108,0]},{value:.4,color:[222,194,0]},{value:.5,color:[150,255,0]},{value:.6,color:[0,255,55]},{value:.7,color:[0,246,150]},{value:.8,color:[50,167,222]},{value:.9,color:[103,51,235]},{value:1,color:[124,0,186]}]}),BATHYMETRY:new rb({stops:[{value:0,color:[40,26,44]},{value:.13,color:[59,49,90]},{value:.25,color:[64,76,139]},{value:.38,color:[63,110,151]},{value:.5,color:[72,142,158]},{value:.63,color:[85,174,163]},{value:.75,color:[120,206,163]},{value:.88,color:[187,230,172]},{value:1,color:[253,254,204]}]}),CDOM:new rb({stops:[{value:0,color:[47,15,62]},{value:.13,color:[87,23,86]},{value:.25,color:[130,28,99]},{value:.38,color:[171,41,96]},{value:.5,color:[206,67,86]},{value:.63,color:[230,106,84]},{value:.75,color:[242,149,103]},{value:.88,color:[249,193,135]},{value:1,color:[254,237,176]}]}),CHLOROPHYLL:new rb({stops:[{value:0,color:[18,36,20]},{value:.13,color:[25,63,41]},{value:.25,color:[24,91,59]},{value:.38,color:[13,119,72]},{value:.5,color:[18,148,80]},{value:.63,color:[80,173,89]},{value:.75,color:[132,196,122]},{value:.88,color:[175,221,162]},{value:1,color:[215,249,208]}]}),DENSITY:new rb({stops:[{value:0,color:[54,14,36]},{value:.13,color:[89,23,80]},{value:.25,color:[110,45,132]},{value:.38,color:[120,77,178]},{value:.5,color:[120,113,213]},{value:.63,color:[115,151,228]},{value:.75,color:[134,185,227]},{value:.88,color:[177,214,227]},{value:1,color:[230,241,241]}]}),FREESURFACE_BLUE:new rb({stops:[{value:0,color:[30,4,110]},{value:.13,color:[47,14,176]},{value:.25,color:[41,45,236]},{value:.38,color:[25,99,212]},{value:.5,color:[68,131,200]},{value:.63,color:[114,156,197]},{value:.75,color:[157,181,203]},{value:.88,color:[200,208,216]},{value:1,color:[241,237,236]}]}),FREESURFACE_RED:new rb({stops:[{value:0,color:[60,9,18]},{value:.13,color:[100,17,27]},{value:.25,color:[142,20,29]},{value:.38,color:[177,43,27]},{value:.5,color:[192,87,63]},{value:.63,color:[205,125,105]},{value:.75,color:[216,162,148]},{value:.88,color:[227,199,193]},{value:1,color:[241,237,236]}]}),OXYGEN:new rb({stops:[{value:0,color:[64,5,5]},{value:.13,color:[106,6,15]},{value:.25,color:[144,26,7]},{value:.38,color:[168,64,3]},{value:.5,color:[188,100,4]},{value:.63,color:[206,136,11]},{value:.75,color:[220,174,25]},{value:.88,color:[231,215,44]},{value:1,color:[248,254,105]}]}),PAR:new rb({stops:[{value:0,color:[51,20,24]},{value:.13,color:[90,32,35]},{value:.25,color:[129,44,34]},{value:.38,color:[159,68,25]},{value:.5,color:[182,99,19]},{value:.63,color:[199,134,22]},{value:.75,color:[212,171,35]},{value:.88,color:[221,210,54]},{value:1,color:[225,253,75]}]}),PHASE:new rb({stops:[{value:0,color:[145,105,18]},{value:.13,color:[184,71,38]},{value:.25,color:[186,58,115]},{value:.38,color:[160,71,185]},{value:.5,color:[110,97,218]},{value:.63,color:[50,123,164]},{value:.75,color:[31,131,110]},{value:.88,color:[77,129,34]},{value:1,color:[145,105,18]}]}),SALINITY:new rb({stops:[{value:0,color:[42,24,108]},{value:.13,color:[33,50,162]},{value:.25,color:[15,90,145]},{value:.38,color:[40,118,137]},{value:.5,color:[59,146,135]},{value:.63,color:[79,175,126]},{value:.75,color:[120,203,104]},{value:.88,color:[193,221,100]},{value:1,color:[253,239,154]}]}),TEMPERATURE:new rb({stops:[{value:0,color:[4,35,51]},{value:.13,color:[23,51,122]},{value:.25,color:[85,59,157]},{value:.38,color:[129,79,143]},{value:.5,color:[175,95,130]},{value:.63,color:[222,112,101]},{value:.75,color:[249,146,66]},{value:.88,color:[249,196,65]},{value:1,color:[232,250,91]}]}),TURBIDITY:new rb({stops:[{value:0,color:[34,31,27]},{value:.13,color:[65,50,41]},{value:.25,color:[98,69,52]},{value:.38,color:[131,89,57]},{value:.5,color:[161,112,59]},{value:.63,color:[185,140,66]},{value:.75,color:[202,174,88]},{value:.88,color:[216,209,126]},{value:1,color:[233,246,171]}]}),VELOCITY_BLUE:new rb({stops:[{value:0,color:[17,32,64]},{value:.13,color:[35,52,116]},{value:.25,color:[29,81,156]},{value:.38,color:[31,113,162]},{value:.5,color:[50,144,169]},{value:.63,color:[87,173,176]},{value:.75,color:[149,196,189]},{value:.88,color:[203,221,211]},{value:1,color:[254,251,230]}]}),VELOCITY_GREEN:new rb({stops:[{value:0,color:[23,35,19]},{value:.13,color:[24,64,38]},{value:.25,color:[11,95,45]},{value:.38,color:[39,123,35]},{value:.5,color:[95,146,12]},{value:.63,color:[152,165,18]},{value:.75,color:[201,186,69]},{value:.88,color:[233,216,137]},{value:1,color:[255,253,205]}]}),CUBEHELIX:new rb({stops:[{value:0,color:[0,0,0]},{value:.07,color:[22,5,59]},{value:.13,color:[60,4,105]},{value:.2,color:[109,1,135]},{value:.27,color:[161,0,147]},{value:.33,color:[210,2,142]},{value:.4,color:[251,11,123]},{value:.47,color:[255,29,97]},{value:.53,color:[255,54,69]},{value:.6,color:[255,85,46]},{value:.67,color:[255,120,34]},{value:.73,color:[255,157,37]},{value:.8,color:[241,191,57]},{value:.87,color:[224,220,93]},{value:.93,color:[218,241,142]},{value:1,color:[227,253,198]}]}),CIVIDIS:new rb({stops:[{value:0,color:[0,32,77,255]},{value:.125,color:[5,54,110,255]},{value:.25,color:[65,77,108,255]},{value:.375,color:[97,100,111,255]},{value:.5,color:[125,124,121,255]},{value:.625,color:[156,149,120,255]},{value:.75,color:[190,175,111,255]},{value:.875,color:[225,204,94,255]},{value:1,color:[255,235,70,255]}]}),TURBO:new rb({stops:[{value:0,color:[48,18,59,255]},{value:.125,color:[70,107,227,255]},{value:.25,color:[40,187,236,255]},{value:.375,color:[49,242,153,255]},{value:.5,color:[162,252,60,255]},{value:.625,color:[237,208,58,255]},{value:.75,color:[251,128,34,255]},{value:.875,color:[210,49,5,255]},{value:1,color:[122,4,3,255]}]}),ROCKET:new rb({stops:[{value:0,color:[250,235,221,0]},{value:.133,color:[250,235,221,255]},{value:.266,color:[246,170,130,255]},{value:.4,color:[240,96,67,255]},{value:.533,color:[203,27,79,255]},{value:.666,color:[132,30,90,255]},{value:.8,color:[63,27,68,255]},{value:1,color:[3,5,26,255]}]}),MAKO:new rb({stops:[{value:0,color:[11,4,5,255]},{value:.125,color:[43,28,53,255]},{value:.25,color:[62,53,107,255]},{value:.375,color:[59,86,152,255]},{value:.5,color:[53,123,162,255]},{value:.625,color:[53,158,170,255]},{value:.75,color:[73,193,173,255]},{value:.875,color:[150,221,181,255]},{value:1,color:[222,245,229,255]}]})};const ob=Object.freeze(Object.defineProperty({__proto__:null,addHeatmap:function(e,t){if(t.layerId&&e.getLayer(t.layerId))throw new Error(`A layer already exists with the layer id: ${t.layerId}`);const i=t.sourceId??Vx(),r=t.layerId??Hx(),n=t.minzoom??0,o=t.maxzoom??23,s=t.zoomCompensation??!0,a=t.opacity??[{zoom:n,value:0},{zoom:n+.25,value:1},{zoom:o-.25,value:1},{zoom:o,value:0}];let l=Array.isArray(t.colorRamp)?t.colorRamp:nb.TURBO.transparentStart();const c=l.getBounds();(0!==c.min||1!==c.max)&&(l=l.scale(0,1)),l.hasTransparentStart()||(l=l.transparentStart());const u=t.intensity??[{zoom:0,value:.01},{zoom:4,value:.2},{zoom:16,value:1}],h=t.property??null,d=t.weight??1;let p=1;h?"number"==typeof d?(p=d,"number"==typeof t.weight&&console.warn("The option `.property` is ignored when `.propertyValueWeights` is not of type `PropertyValueWeights`")):Array.isArray(d)?p=Kx(d,h):console.warn("The option `.property` is ignored when `.propertyValueWeights` is not of type `PropertyValueWeights`"):"number"==typeof d?p=d:Array.isArray(d)&&console.warn("The options `.propertyValueWeights` can only be used when `.property` is provided.");const f=[{zoom:0,value:1.25},{zoom:2,value:2.5},{zoom:4,value:5},{zoom:8,value:12.5},{zoom:16,value:50}],A=t.radius??(s?f:10);let m=1;"number"==typeof A?m=A:Array.isArray(A)&&"zoom"in A[0]?m=Zx(A):h&&Array.isArray(A)&&"propertyValue"in A[0]?m=Jx(A,h,s):!h&&Array.isArray(A)&&"propertyValue"in A[0]?(m=Zx(f),console.warn("The option `.radius` can only be property-driven if the option `.property` is provided.")):m=Zx(f);const g={heatmapLayerId:r,heatmapSourceId:i};if(t.data&&!e.getSource(i)){let r=t.data;"string"==typeof r&&Am(r)&&(r=`https://api.maptiler.com/data/${r}/features.json?key=${rm.apiKey}`),e.addSource(i,{type:"geojson",data:r})}return e.addLayer({id:r,type:"heatmap",source:i,minzoom:n,maxzoom:o,paint:{"heatmap-weight":p,"heatmap-intensity":"number"==typeof u?u:Zx(u),"heatmap-color":tb(l),"heatmap-radius":m,"heatmap-opacity":"number"==typeof a?a:Zx(a)}},t.beforeId),g},addPoint:function(e,t){if(t.layerId&&e.getLayer(t.layerId))throw new Error(`A layer already exists with the layer id: ${t.layerId}`);const i=t.minPointRadius??10,r=t.maxPointRadius??50,n=t.cluster??!1,o=20,s=Array.isArray(t.pointColor)?t.pointColor:nb.TURBO.scale(10,t.cluster?1e4:1e3).resample("ease-out-square"),a=s.getBounds(),l=t.sourceId??Vx(),c=t.layerId??Hx(),u=t.showLabel??n,h=t.alignOnViewport??!0,d=t.outline??!1,p=t.outlineOpacity??1,f=t.outlineWidth??1,A=t.outlineColor??"#FFFFFF";let m;const g=t.zoomCompensation??!0,_=t.minzoom??0,y=t.maxzoom??23;m="number"==typeof t.pointOpacity?t.pointOpacity:Array.isArray(t.pointOpacity)?Zx(t.pointOpacity):t.cluster?eb(s,"point_count"):t.property?eb(s,t.property):Zx([{zoom:_,value:0},{zoom:_+.25,value:1},{zoom:y-.25,value:1},{zoom:y,value:0}]);const v={pointLayerId:c,clusterLayerId:"",labelLayerId:"",pointSourceId:l};if(t.data&&!e.getSource(l)){let i=t.data;"string"==typeof i&&Am(i)&&(i=`https://api.maptiler.com/data/${i}/features.json?key=${rm.apiKey}`),e.addSource(l,{type:"geojson",data:i,cluster:n})}if(n){v.clusterLayerId=`${c}_cluster`;const n=Array.from({length:o},((e,t)=>{const n=a.min+t*(a.max-a.min)/19;return{value:n,pointRadius:i+(r-i)*(t/19)**.5,color:s.getColorHex(n)}}));e.addLayer({id:v.clusterLayerId,type:"circle",source:l,filter:["has","point_count"],paint:{"circle-color":"string"==typeof t.pointColor?t.pointColor:Xx(n,"point_count"),"circle-radius":"number"==typeof t.pointRadius?t.pointRadius:Array.isArray(t.pointRadius)?Zx(t.pointRadius):Yx(n,"point_count",!1),"circle-pitch-alignment":h?"viewport":"map","circle-pitch-scale":"map","circle-opacity":m,...d&&{"circle-stroke-opacity":"number"==typeof p?p:Zx(p),"circle-stroke-width":"number"==typeof f?f:Zx(f),"circle-stroke-color":"string"==typeof A?A:$x(A)}},minzoom:_,maxzoom:y},t.beforeId),e.addLayer({id:v.pointLayerId,type:"circle",source:l,filter:["!",["has","point_count"]],paint:{"circle-pitch-alignment":h?"viewport":"map","circle-pitch-scale":"map","circle-color":"string"==typeof t.pointColor?t.pointColor:s.getColorHex(s.getBounds().min),"circle-radius":"number"==typeof t.pointRadius?t.pointRadius:Array.isArray(t.pointRadius)?Zx(t.pointRadius):.75*n[0].pointRadius,"circle-opacity":m,...d&&{"circle-stroke-opacity":"number"==typeof p?p:Zx(p),"circle-stroke-width":"number"==typeof f?f:Zx(f),"circle-stroke-color":"string"==typeof A?A:$x(A)}},minzoom:_,maxzoom:y},t.beforeId)}else{let n="string"==typeof t.pointColor?t.pointColor:Array.isArray(t.pointColor)?t.pointColor.getColorHex(t.pointColor.getBounds().min):jx(),c="number"==typeof t.pointRadius?g?Zx([{zoom:0,value:.025*t.pointRadius},{zoom:2,value:.05*t.pointRadius},{zoom:4,value:.1*t.pointRadius},{zoom:8,value:.25*t.pointRadius},{zoom:16,value:1*t.pointRadius}]):t.pointRadius:Array.isArray(t.pointRadius)?Zx(t.pointRadius):g?Zx([{zoom:0,value:.05*i},{zoom:2,value:.1*i},{zoom:4,value:.2*i},{zoom:8,value:.5*i},{zoom:16,value:1*i}]):i;if(t.property&&Array.isArray(t.pointColor)){const e=Array.from({length:o},((e,n)=>{const o=a.min+n*(a.max-a.min)/19;return{value:o,pointRadius:"number"==typeof t.pointRadius?t.pointRadius:i+(r-i)*(n/19)**.5,color:"string"==typeof t.pointColor?t.pointColor:s.getColorHex(o)}}));n=Xx(e,t.property),c=Yx(e,t.property,g)}e.addLayer({id:v.pointLayerId,type:"circle",source:l,layout:{"circle-sort-key":t.property?["/",1,["get",t.property]]:0},paint:{"circle-pitch-alignment":h?"viewport":"map","circle-pitch-scale":"map","circle-color":n,"circle-opacity":m,"circle-radius":c,...d&&{"circle-stroke-opacity":"number"==typeof p?p:Zx(p),"circle-stroke-width":"number"==typeof f?f:Zx(f),"circle-stroke-color":"string"==typeof A?A:$x(A)}},minzoom:_,maxzoom:y},t.beforeId)}if(!1!==u&&(t.cluster||t.property)){v.labelLayerId=`${c}_label`;const i=t.labelColor??"#fff",r=t.labelSize??12;e.addLayer({id:v.labelLayerId,type:"symbol",source:l,filter:["has",t.cluster?"point_count":t.property],layout:{"text-field":t.cluster?"{point_count_abbreviated}":`{${t.property}}`,"text-font":["Noto Sans Regular"],"text-size":r,"text-pitch-alignment":h?"viewport":"map","symbol-sort-key":["/",1,["get",t.cluster?"point_count":t.property]]},paint:{"text-color":i,"text-opacity":m},minzoom:_,maxzoom:y},t.beforeId)}return v},addPolygon:function(e,t){if(t.layerId&&e.getLayer(t.layerId))throw new Error(`A layer already exists with the layer id: ${t.layerId}`);const i=t.sourceId??Vx(),r=t.layerId??Hx(),n={polygonLayerId:r,polygonOutlineLayerId:t.outline?`${r}_outline`:"",polygonSourceId:i};if(t.data&&!e.getSource(i)){let r=t.data;"string"==typeof r&&Am(r)&&(r=`https://api.maptiler.com/data/${r}/features.json?key=${rm.apiKey}`),e.addSource(i,{type:"geojson",data:r})}let o=t.outlineDashArray??null;const s=t.outlineWidth??1,a=t.outlineColor??"#FFFFFF",l=t.outlineOpacity??1,c=t.outlineBlur??0,u=t.fillColor??jx(),h=t.fillOpacity??1,d=t.outlinePosition??"center",p=t.pattern??null;"string"==typeof o&&(o=Wx(o));const f=(p=null)=>{if(e.addLayer({id:r,type:"fill",source:i,minzoom:t.minzoom??0,maxzoom:t.maxzoom??23,paint:{"fill-color":"string"==typeof u?u:$x(u),"fill-opacity":"number"==typeof h?h:Zx(h),...p&&{"fill-pattern":p}}},t.beforeId),!0===t.outline){let r;r="inside"===d?"number"==typeof s?.5*s:Zx(s.map((({zoom:e,value:t})=>({zoom:e,value:.5*t})))):"outside"===d?"number"==typeof s?-.5*s:Zx(s.map((e=>({zoom:e.zoom,value:-.5*e.value})))):0,e.addLayer({id:n.polygonOutlineLayerId,type:"line",source:i,layout:{"line-join":t.outlineJoin??"round","line-cap":t.outlineCap??"butt"},minzoom:t.minzoom??0,maxzoom:t.maxzoom??23,paint:{"line-opacity":"number"==typeof l?l:Zx(l),"line-color":"string"==typeof a?a:$x(a),"line-width":"number"==typeof s?s:Zx(s),"line-blur":"number"==typeof c?c:Zx(c),"line-offset":r,...o&&{"line-dasharray":o}}},t.beforeId)}};return p?e.hasImage(p)?f(p):e.loadImage(p).then((t=>{e.addImage(p,t.data),f(p)})).catch((e=>{console.error("Could not load the pattern image.",e.message),f()})):f(),n},addPolyline:async function(e,t,i={}){var r,n;if(!t.sourceId&&!t.data)throw new Error("Creating a polyline layer requires an existing .sourceId or a valid .data property");let o=t.data;if("string"==typeof o){if(Am(o))o=`https://api.maptiler.com/data/${t.data}/features.json?key=${rm.apiKey}`;else if("gpx"===(null==(r=o.split(".").pop())?void 0:r.toLowerCase().trim())){o=mx(await(await fetch(o,i)).text())}else if("kml"===(null==(n=o.split(".").pop())?void 0:n.toLowerCase().trim())){o=gx(await(await fetch(o,i)).text())}else{const e=function(e){try{return JSON.parse(e)}catch{}return null}(o)??Nx(o);e&&(o=e)}if(!o)throw new Error("Polyline data was provided as string but is incompatible with valid formats.")}return function(e,t){if(t.layerId&&e.getLayer(t.layerId))throw new Error(`A layer already exists with the layer id: ${t.layerId}`);const i=t.sourceId??Vx(),r=t.layerId??Hx(),n={polylineLayerId:r,polylineOutlineLayerId:"",polylineSourceId:i};t.data&&!e.getSource(i)&&e.addSource(i,{type:"geojson",data:t.data});const o=t.lineWidth??3,s=t.lineColor??jx(),a=t.lineOpacity??1,l=t.lineBlur??0,c=t.lineGapWidth??0;let u=t.lineDashArray??null;const h=t.outlineWidth??1,d=t.outlineColor??"#FFFFFF",p=t.outlineOpacity??1,f=t.outlineBlur??0;if("string"==typeof u&&(u=Wx(u)),!0===t.outline){const s=`${r}_outline`;n.polylineOutlineLayerId=s,e.addLayer({id:s,type:"line",source:i,layout:{"line-join":t.lineJoin??"round","line-cap":t.lineCap??"round"},minzoom:t.minzoom??0,maxzoom:t.maxzoom??23,paint:{"line-opacity":"number"==typeof p?p:Zx(p),"line-color":"string"==typeof d?d:$x(d),"line-width":qx(o,h),"line-blur":"number"==typeof f?f:Zx(f)}},t.beforeId)}return e.addLayer({id:r,type:"line",source:i,layout:{"line-join":t.lineJoin??"round","line-cap":t.lineCap??"round"},minzoom:t.minzoom??0,maxzoom:t.maxzoom??23,paint:{"line-opacity":"number"==typeof a?a:Zx(a),"line-color":"string"==typeof s?s:$x(s),"line-width":"number"==typeof o?o:Zx(o),"line-blur":"number"==typeof l?l:Zx(l),"line-gap-width":"number"==typeof c?c:Zx(c),...u&&{"line-dasharray":u}}},t.beforeId),n}(e,{...t,data:o})},colorDrivenByProperty:Xx,colorPalettes:Qx,computeRampedOutlineWidth:qx,dashArrayMaker:Wx,generateRandomLayerName:Hx,generateRandomSourceName:Vx,getRandomColor:jx,heatmapIntensityFromColorRamp:tb,lerpZoomNumberValues:Gx,opacityDrivenByProperty:eb,paintColorOptionsToPaintSpec:$x,radiusDrivenByProperty:Yx,radiusDrivenByPropertyHeatmap:Jx,rampedOptionsToLayerPaintSpec:Zx,rampedPropertyValueWeight:Kx,takeScreenshot:async function(e,t={}){const i=t.download??!1,r=await function(e){return new Promise(((t,i)=>{e.redraw(),e.once("idle",(()=>{e.getCanvas().toBlob((e=>{e?t(e):i(Error("Screenshot could not be created."))}),"image/png")}))}))}(e);if(i){const e=t.filename??"maptiler_screenshot.png",i=document.createElement("a");i.style.display="none",document.body.appendChild(i),i.href=URL.createObjectURL(r),i.download=e,i.click(),setTimeout((()=>{document.body.removeChild(i),URL.revokeObjectURL(i.href)}),0)}return r}},Symbol.toStringTag,{value:"Module"}));!function(){if(typeof window>"u")return;const e=We.getRTLTextPluginStatus();if("unavailable"===e||"requested"===e)try{We.setRTLTextPlugin(em.rtlPluginURL,!0)}catch{}}();const sb=We.Map,ab=We.Marker,lb=We.Popup,cb=We.Style,ub=We.CanvasSource,hb=We.GeoJSONSource,db=We.ImageSource,pb=We.RasterTileSource,fb=We.RasterDEMTileSource,Ab=We.VectorTileSource,mb=We.VideoSource,gb=We.NavigationControl,_b=We.GeolocateControl,yb=We.AttributionControl,vb=We.LogoControl,xb=We.ScaleControl,bb=We.FullscreenControl,wb=We.TerrainControl,Tb=We.BoxZoomHandler,Bb=We.ScrollZoomHandler,Cb=We.CooperativeGesturesHandler,Sb=We.KeyboardHandler,Eb=We.TwoFingersTouchPitchHandler,Mb=We.MapWheelEvent,Ib=We.MapTouchEvent,Pb=We.MapMouseEvent,Lb=We.config,Fb=We.getVersion,{setRTLTextPlugin:kb,getRTLTextPluginStatus:zb,LngLat:Rb,LngLatBounds:Db,MercatorCoordinate:Ob,Evented:Ub,AJAXError:Nb,prewarm:Qb,clearPrewarmedResources:jb,Hash:Vb,Point:Hb,EdgeInsets:Gb,DragRotateHandler:$b,DragPanHandler:Zb,TwoFingersTouchZoomRotateHandler:qb,DoubleClickZoomHandler:Kb,TwoFingersTouchZoomHandler:Wb,TwoFingersTouchRotateHandler:Xb,getWorkerCount:Yb,setWorkerCount:Jb,getMaxParallelImageRequests:ew,setMaxParallelImageRequests:tw,getWorkerUrl:iw,setWorkerUrl:rw,addSourceType:nw,importScriptInWorkers:ow,addProtocol:sw,removeProtocol:aw}=We;var lw=Object.freeze({__proto__:null,AJAXError:Nb,AttributionControl:Rm,AttributionControlMLGL:yb,BoxZoomHandler:Qm,BoxZoomHandlerMLGL:Tb,CanvasSource:Sm,CanvasSourceMLGL:ub,ColorRamp:rb,ColorRampCollection:nb,CooperativeGesturesHandler:Vm,CooperativeGesturesHandlerMLGL:Cb,DOMcreate:Vv,DOMremove:Hv,DoubleClickZoomHandler:Kb,DragPanHandler:Zb,DragRotateHandler:$b,EdgeInsets:Gb,Evented:Ub,FullscreenControl:Um,FullscreenControlMLGL:bb,GeoJSONSource:Em,GeoJSONSourceMLGL:hb,GeolocateControl:zm,GeolocateControlMLGL:_b,GeolocationType:hx,Hash:Vb,ImageSource:Mm,ImageSourceMLGL:db,KeyboardHandler:Hm,KeyboardHandlerMLGL:Sb,Language:YA,LngLat:Rb,LngLatBounds:Db,LogoControl:Dm,LogoControlMLGL:vb,Map:dx,MapMLGL:sb,MapMouseEvent:qm,MapMouseEventMLGL:Pb,MapStyle:Ff,MapStyleVariant:Ef,MapTouchEvent:Zm,MapTouchEventMLGL:Ib,MapWheelEvent:$m,MapWheelEventMLGL:Mb,MaptilerGeolocateControl:Wv,MaptilerLogoControl:Km,MaptilerNavigationControl:$v,MaptilerProjectionControl:lx,MaptilerTerrainControl:Gv,Marker:Tm,MarkerMLGL:ab,MercatorCoordinate:Ob,NavigationControMLGL:gb,NavigationControl:km,Point:Hb,Popup:Bm,PopupMLGL:lb,RasterDEMTileSource:Pm,RasterDEMTileSourceMLGL:fb,RasterTileSource:Im,RasterTileSourceMLGL:pb,ReferenceMapStyle:Mf,ScaleControl:Om,ScaleControlMLGL:xb,ScrollZoomHandler:jm,ScrollZoomHandlerMLGL:Bb,SdkConfig:im,ServiceError:Af,Style:Cm,StyleMLGL:cb,TerrainControMLGL:wb,TerrainControl:Nm,TwoFingersTouchPitchHandler:Gm,TwoFingersTouchPitchHandlerMLGL:Eb,TwoFingersTouchRotateHandler:Xb,TwoFingersTouchZoomHandler:Wb,TwoFingersTouchZoomRotateHandler:qb,VectorTileSource:Lm,VectorTileSourceMLGL:Ab,VideoSource:Fm,VideoSourceMLGL:mb,addProtocol:sw,addSourceType:nw,areSameLanguages:function(e,t,i=sf){const r=df(e,i),n=df(t,i);return r&&n&&r.flag===n.flag},bufferToPixelDataBrowser:rA,circumferenceAtLatitude:Wf,clearPrewarmedResources:jb,config:rm,configMLGL:Lb,coordinates:Tf,data:Cf,displayWebGLContextLostWarning:function(e){const t=e.getContainer(),i=document.createElement("div");i.innerHTML="The WebGL context was lost.",i.classList.add("webgl-warning-div"),t.appendChild(i)},elevation:cA,expandMapStyle:Sf,geocoding:vf,geolocation:bf,getAutoLanguage:uf,getBrowserLanguage:JA,getBufferToPixelDataParser:nA,getLanguageInfoFromCode:lf,getLanguageInfoFromFlag:cf,getLanguageInfoFromKey:af,getMapLibreVersion:Fb,getMaxParallelImageRequests:ew,getRTLTextPluginStatus:zb,getTileCache:iA,getVersion:function(){return"3.2.0"},getWebGLSupportError:mm,getWorkerCount:Yb,getWorkerUrl:iw,gpx:mx,gpxOrKml:Nx,hasChildNodeWithName:fx,helpers:ob,importScriptInWorkers:ow,isLanguageInfo:hf,kml:gx,mapStylePresetList:If,math:eA,misc:Df,prewarm:Qb,removeProtocol:aw,setMaxParallelImageRequests:tw,setRTLTextPlugin:kb,setWorkerCount:Jb,setWorkerUrl:rw,staticMaps:Nf,str2xml:px,styleToStyle:Lf,toLanguageInfo:df,xml2str:Ax}),cw=Object.freeze({__proto__:null,default:undefined});export{ef as startApp};
//# sourceMappingURL=bundle.js.map

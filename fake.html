<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>MapLibre + Cesium 3D Tiles Hybrid Example</title>
    <link
      href="https://unpkg.com/maplibre-gl@5.2.0/dist/maplibre-gl.css"
      rel="stylesheet"
    />
    <script src="https://unpkg.com/maplibre-gl@5.2.0/dist/maplibre-gl.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/cesium@1.106/Build/Cesium/Cesium.js"></script>
    <link
      href="https://cdn.jsdelivr.net/npm/cesium@1.106/Build/Cesium/Widgets/widgets.css"
      rel="stylesheet"
    />
    <style>
      html,
      body,
      #map,
      #cesiumContainer {
        margin: 0;
        padding: 0;
        width: 100%;
        height: 100%;
        position: absolute;
        top: 0;
        left: 0;
      }
      #cesiumContainer {
        pointer-events: none; /* let mouse events pass to MapLibre if needed */
      }
    </style>
  </head>
  <body>
    <div id="map"></div>
    <div id="cesiumContainer"></div>

    <script>
      Cesium.Ion.defaultAccessToken =
        'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiJjODA5MmYzZi0zYzY1LTQ5ZTYtOTMxOC03YzdlNTY0ZGJmM2UiLCJpZCI6MzU0OTgwLCJpYXQiOjE3NjE2OTg4NDN9.jb6Kw0ESwF3xrvxfGbbZr3kp6BuYoDJePWa3YLp_nyM';
      // 1️⃣ Initialize MapLibre base map
      const map = new maplibregl.Map({
        container: 'map',
        style: 'https://demotiles.maplibre.org/style.json', // basic MapLibre style
        center: [-75.65, 40.05], // Exton, PA
        zoom: 17,
      });

      // 2️⃣ Initialize Cesium 3D Tiles overlay
      const cesiumViewer = new Cesium.Viewer('cesiumContainer', {
        imageryProvider: false, // we already have MapLibre base
        baseLayerPicker: false,
        terrainProvider: Cesium.createWorldTerrain(),
        scene3DOnly: true,
        selectionIndicator: false,
        navigationHelpButton: false,
        timeline: false,
        animation: false,
      });

      // Disable Cesium camera controls so MapLibre handles input
      cesiumViewer.scene.screenSpaceCameraController.enableRotate = false;
      cesiumViewer.scene.screenSpaceCameraController.enableZoom = false;
      cesiumViewer.scene.screenSpaceCameraController.enableTilt = false;
      cesiumViewer.scene.screenSpaceCameraController.enableTranslate = false;

      // 3️⃣ Add HERE 3D Tiles
      const hereTileset = new Cesium.Cesium3DTileset({
        url: 'https://vector.hereapi.com/3dtiles/v1/3dlandmarks/tileset.json?apiKey=pC36c9S2G22-Nc4gvEWW9tXTrGxuo_eJPiHyIW9z5cA',
      });
      cesiumViewer.scene.primitives.add(hereTileset);

      // 4️⃣ Zoom to tileset once loaded
      hereTileset.readyPromise
        .then(() => {
          cesiumViewer.zoomTo(hereTileset);
        })
        .otherwise(error => console.error(error));

      // 5️⃣ Optional: Sync MapLibre camera with Cesium
      // (simple example; for full sync you'd need projection transforms)
      map.on('move', () => {
        const center = map.getCenter();
        const zoom = map.getZoom();
        cesiumViewer.camera.setView({
          destination: Cesium.Cartesian3.fromDegrees(
            center.lng,
            center.lat,
            100
          ),
          orientation: {
            heading: Cesium.Math.toRadians(0),
            pitch: Cesium.Math.toRadians(-30),
            roll: 0,
          },
        });
      });
    </script>
  </body>
</html>
